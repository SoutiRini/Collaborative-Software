[{"count": 0, "tags": [], "text": "BackupManager#stopInternal is as follows.\n\n=====\nprotected synchronized void stopInternal() throws LifecycleException {\n\n    super.stopInternal();\n\n    LazyReplicatedMap map = (LazyReplicatedMap)sessions;\n        if ( map!=null ) {\n            map.breakdown();\n        }\n\n        cluster.removeManager(this);\n}\n=====\n\nIn Tomcat 7.0.0 RC1, super#stopInternal() is called first.\nIn StandardManager#stopInternal() of the super class,\nThe session is stored, and expire all active sessions. \n\nStoring session is unnecessary in BackupManager.\nand\nWhen the session expired, the session is deleted from all cluster nodes.\n\nAs a Result,\nAll primary sessions (of own node has) are deleted  from all cluster nodes.\n\nFor instance,\nNode1 : sessionA(primary), sessionB(proxy), sessionC(backup)\nNode2 : sessionA(backup), sessionB(primary), sessionC(proxy)\nNode3 : sessionA(proxy), sessionB(backup), sessionC(primary)\n\nIf Node1 is stopped, it becomes the following. \n\nNode1 : stopped\nNode2 : sessionB(primary), sessionC(backup)\nNode3 : sessionB(backup), sessionC(primary)\n\nsessionA is expired.\nIt should be the following. \n\nNode1 : stopped\nNode2 : sessionA(primary), sessionB(primary), sessionC(backup)\nNode3 : sessionA(backup), sessionB(backup), sessionC(primary)\n\n\nThere is no problem in Tomcat6.0.x, \nbecause it executes super.stop() after LazyReplicatedMap#breakdown() .\n\nI made a patch against trunk.\n\nBest Regards.", "is_private": false, "bug_id": 49150, "id": 136233, "time": "2010-04-19T03:37:08Z", "creator": "kfujino@apache.org", "creation_time": "2010-04-19T03:37:08Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 49150, "is_private": false, "text": "Created attachment 25323\nI made a patch against trunk.", "id": 136234, "time": "2010-04-19T03:39:46Z", "creator": "kfujino@apache.org", "creation_time": "2010-04-19T03:39:46Z", "attachment_id": 25323}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "is_private": false, "count": 2, "id": 136236, "time": "2010-04-19T05:19:38Z", "bug_id": 49150, "creation_time": "2010-04-19T05:19:38Z", "text": "Its trunk so you can just apply your patch."}, {"count": 3, "tags": [], "text": "Fixed in trunk.", "is_private": false, "bug_id": 49150, "id": 136237, "time": "2010-04-19T06:17:03Z", "creator": "kfujino@apache.org", "creation_time": "2010-04-19T06:17:03Z", "attachment_id": null}]
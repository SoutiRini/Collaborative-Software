[{"count": 0, "tags": [], "creator": "remm@apache.org", "text": "The Websocket client does not provide the functionality usually found in HTTP clients. As a result, it cannot do anything except a straight upgrade from HTTP/1.1 to Websocket.\n\nTo handle more than this, it would need proprietary configuration to handle:\n- Authentication\n- Redirects\n\nFor reference about the possibilities:\nhttps://tyrus.java.net/documentation/1.8/user-guide.html#tyrus-proprietary-config\nAuthentication: https://tyrus.java.net/documentation/1.8/user-guide.html#d0e1524\nRedirects: https://tyrus.java.net/documentation/1.8/user-guide.html#d0e1640\n\nThis is not a critical enhancement however as users can use their own websocket client implementation, they don't have to rely on the one Tomcat provides.", "id": 182145, "time": "2015-03-27T14:53:32Z", "bug_id": 57767, "creation_time": "2015-03-27T14:53:32Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 57767, "attachment_id": null, "id": 186484, "time": "2015-11-22T16:53:28Z", "creator": "markt@apache.org", "creation_time": "2015-11-22T16:53:28Z", "is_private": false, "text": "*** Bug 58623 has been marked as a duplicate of this bug. ***"}, {"count": 2, "attachment_id": null, "bug_id": 57767, "text": "*** Bug 59191 has been marked as a duplicate of this bug. ***", "id": 189541, "time": "2016-03-17T16:53:07Z", "creator": "remm@apache.org", "creation_time": "2016-03-17T16:53:07Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 57767, "text": "Hey, I would like to work on this issue if it's ok :) However, as a newbie  to tomcat, could you tell me where should I look into? BTW, I had clone and set up tomcat locally and my environment is Ubuntu16.04\n\nThank you very much!", "id": 193977, "time": "2016-09-25T03:34:19Z", "creator": "sabergeass@gmail.com", "creation_time": "2016-09-25T03:34:19Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 57767, "attachment_id": null, "text": "I'd suggest supporting 302 responses as a starting point. The code should handle both absolute and relative redirects.\n\nThere is a ready made test case here:\nhttp://svn.apache.org/viewvc/tomcat/trunk/test/org/apache/tomcat/websocket/TestWebSocketFrameClient.java?view=annotate#l100\nif you restore the commented out request.\n\nThe starting point for the client code is here:\nhttp://svn.apache.org/viewvc/tomcat/trunk/java/org/apache/tomcat/websocket/WsWebSocketContainer.java?view=annotate#l341", "id": 193979, "time": "2016-09-25T09:07:50Z", "creator": "markt@apache.org", "creation_time": "2016-09-25T09:07:50Z", "is_private": false}, {"count": 5, "tags": [], "creator": "sabergeass@gmail.com", "attachment_id": null, "id": 194058, "time": "2016-09-28T16:06:03Z", "bug_id": 57767, "creation_time": "2016-09-28T16:06:03Z", "is_private": false, "text": "(In reply to Mark Thomas from comment #4)\n> I'd suggest supporting 302 responses as a starting point. The code should\n> handle both absolute and relative redirects.\n> \n> There is a ready made test case here:\n> http://svn.apache.org/viewvc/tomcat/trunk/test/org/apache/tomcat/websocket/\n> TestWebSocketFrameClient.java?view=annotate#l100\n> if you restore the commented out request.\n> \n> The starting point for the client code is here:\n> http://svn.apache.org/viewvc/tomcat/trunk/java/org/apache/tomcat/websocket/\n> WsWebSocketContainer.java?view=annotate#l341\n\nSorry for the late reply. So, how do I know the Websocket client can handle redirections as expected after I make some changes? It's my first bug in Tomcat, so please tell me what should I do or where should I look into?  Thank you very much! :)"}, {"count": 6, "tags": [], "creator": "markt@apache.org", "text": "Re-read my comment #4 regarding a suitable test case and how to activate it.", "id": 194085, "time": "2016-09-29T12:58:53Z", "bug_id": 57767, "creation_time": "2016-09-29T12:58:53Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 57767, "attachment_id": 35193, "text": "Created attachment 35193\nwebsocket upgrade redirect\n\nHi, this is my first time submitting any open source contribution. Please let me know if any changes are needed or if anything was missed.\n\nRegards", "id": 200127, "time": "2017-08-01T02:42:35Z", "creator": "jfern096@gmail.com", "creation_time": "2017-08-01T02:42:35Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 57767, "text": "Thanks for the patch. It has been applied to:\n- trunk for 9.0.0.M26 onwards\n- 8.5.x for 8.5.20 onwards\n- 8.0.x for 8.0.46 onwards\n- 7.0.x for 7.0.80 onwards\n\nThere were a few minor style things I tweaked. If you enable ChekcStyle and run the validate target it will catch most of them.\n\nI also moved the configuration properties from System properties the user properties. Generally, we try to avoid system properties where we can as they can conflict in some use cases.\n\nI merged the two properties so redirects are disabled by setting the number of allowed redirects to 0. The default I set to 20 which is consistent with most current browsers.\n\nIt might look like a lot of changes but they were all fairly minor. Thanks again for the patch.", "id": 200159, "time": "2017-08-02T19:12:02Z", "creator": "markt@apache.org", "creation_time": "2017-08-02T19:12:02Z", "is_private": false, "attachment_id": null}, {"count": 9, "text": "Where can I learn more about CheckStyle? I assume, there is a formatting file involved. Also, I am interested in adding support for authentication, should I submit a patch to to this thread? Thanks for your time.", "bug_id": 57767, "attachment_id": null, "id": 200164, "time": "2017-08-02T22:04:13Z", "creator": "jfern096@gmail.com", "creation_time": "2017-08-02T22:04:13Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "bug_id": 57767, "attachment_id": null, "id": 200165, "time": "2017-08-02T22:08:13Z", "creator": "markt@apache.org", "creation_time": "2017-08-02T22:08:13Z", "is_private": false, "text": "Add\n\nexecute.validate=true\n\nto your build.properties file and run\n\nant validate\n\nThe configuration files are in res/checkstyle.\n\nPlease open a new bugzilla enhancement for adding authentication support. If you need any pointers, the dev@ list is the place to ask.\n\nThanks again for your contribution and we are looking forward to the next one."}, {"count": 11, "tags": [], "bug_id": 57767, "attachment_id": null, "id": 200168, "time": "2017-08-03T07:41:19Z", "creator": "remm@apache.org", "creation_time": "2017-08-03T07:41:19Z", "is_private": false, "text": "Reopening since authentication is not done and this was for both items, and possibly more."}, {"count": 12, "tags": [], "bug_id": 57767, "attachment_id": 35289, "id": 200650, "time": "2017-09-04T19:16:15Z", "creator": "jfern096@gmail.com", "creation_time": "2017-09-04T19:16:15Z", "is_private": false, "text": "Created attachment 35289\nAuthentication support\n\nPlease find below additional changes.\n\nAdded support for Basic and Digest Authentication.\nAdded support for dynamic loading of other Authentication Schemes.\nCleared redirectSet after invocation to allow for Container reuse."}, {"count": 13, "tags": [], "bug_id": 57767, "attachment_id": null, "text": "Ok, so that's obviously the big item (IMO), that looks good.\nI'm not convinced that digest is useful anymore, do you think it is ? On the plus side, you did it already, on the minus side we'll have to maintain the feature.", "id": 200670, "time": "2017-09-05T14:57:30Z", "creator": "remm@apache.org", "creation_time": "2017-09-05T14:57:30Z", "is_private": false}, {"count": 14, "text": "(In reply to Remy Maucherat from comment #13)\n> Ok, so that's obviously the big item (IMO), that looks good.\n> I'm not convinced that digest is useful anymore, do you think it is ? On the\n> plus side, you did it already, on the minus side we'll have to maintain the\n> feature.\n\nThere is not much need for it nowadays given how ubiquitous SSL is. That being said, it may prove to be useful in certain circumstances. I don't think it should require too much maintenance.", "bug_id": 57767, "attachment_id": null, "id": 200689, "time": "2017-09-06T01:53:28Z", "creator": "jfern096@gmail.com", "creation_time": "2017-09-06T01:53:28Z", "tags": [], "is_private": false}, {"count": 15, "attachment_id": null, "bug_id": 57767, "text": "None of the Java classes in the authentication support patch have any Javadoc. I'm -1 on accepting the patch on that basis alone. I've skimmed the code and it otherwise looks good, but I have not tested it at all.\n\nFor authentication, I wonder how much code can be re-used from Tomcat's existing HTTP Basic and HTTP Digest authenticators. I'd prefer not to have competing implementations of WWW-Authenticate handling in Tomcat.", "id": 200741, "time": "2017-09-07T22:18:43Z", "creator": "chris@christopherschultz.net", "creation_time": "2017-09-07T22:18:43Z", "tags": [], "is_private": false}, {"count": 16, "tags": [], "bug_id": 57767, "attachment_id": null, "id": 200744, "time": "2017-09-08T06:13:24Z", "creator": "markt@apache.org", "creation_time": "2017-09-08T06:13:24Z", "is_private": false, "text": "If there is a possibility of reuse ( this is client side and the existing code is server side) we'd need to be careful about which package / jar we put it in to avoid adding unwanted dependencies for the WebSocket client JAR."}, {"count": 17, "tags": [], "creator": "remm@apache.org", "text": "Yes, I would rather integrate it (if it works) then see about reuse. I also don't think javadoc is a big issue either for this kind of code.", "id": 200745, "time": "2017-09-08T06:26:47Z", "bug_id": 57767, "creation_time": "2017-09-08T06:26:47Z", "is_private": false, "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 57767, "text": "I have spent some time looking for opportunities to reuse but did not find many. We could replace the WWWAuthenticate parser for digest with org.apache.tomcat.util.http.parser, but we will still need the one I added for basic. At that point I am not sure if it's worth it if we can't replace it for both schemes.", "id": 200782, "time": "2017-09-08T18:57:51Z", "creator": "jfern096@gmail.com", "creation_time": "2017-09-08T18:57:51Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "creator": "jfern096@gmail.com", "text": "Are there any additional proposed changes for this patch? I would like to leverage some of the functionality for https://bz.apache.org/bugzilla/show_bug.cgi?id=59758.", "id": 201021, "time": "2017-09-21T01:43:30Z", "bug_id": 57767, "creation_time": "2017-09-21T01:43:30Z", "is_private": false, "attachment_id": null}, {"count": 20, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 201438, "time": "2017-10-13T13:46:19Z", "bug_id": 57767, "creation_time": "2017-10-13T13:46:19Z", "is_private": false, "text": "I committed the patch to trunk, with a few changes:\n- Adding javadocs\n- Merged all client code back to WsWebSocketContainer (the new client class was taking over nearly all its code so I didn't really see the point)\n\nIf nobody complains about other mandatory improvements, I will proceed with backporting the feature addition."}, {"count": 21, "tags": [], "creator": "markt@apache.org", "text": "Wasn't the point of the new class that the redirectSet wasn't thread safe?", "id": 201440, "time": "2017-10-13T14:05:58Z", "bug_id": 57767, "creation_time": "2017-10-13T14:05:58Z", "is_private": false, "attachment_id": null}, {"count": 22, "tags": [], "bug_id": 57767, "attachment_id": null, "text": "Yes, that would be a big problem with my \"simplification\" then. Ooops. I will restore the separate client class, it's a good solution for the issue.", "id": 201441, "time": "2017-10-13T14:09:46Z", "creator": "remm@apache.org", "creation_time": "2017-10-13T14:09:46Z", "is_private": false}, {"count": 23, "tags": [], "bug_id": 57767, "attachment_id": null, "id": 201442, "time": "2017-10-13T14:20:51Z", "creator": "remm@apache.org", "creation_time": "2017-10-13T14:20:51Z", "is_private": false, "text": "I prefer getting rid of the field instead, the GC savings are minimal and not worth it IMO."}, {"count": 24, "tags": [], "bug_id": 57767, "attachment_id": null, "text": "This should make the enhancement \"done\" as it adds the most important features.\n\nThis is included in 9.0.2, 8.5.24, 8.0.48, 7.0.83.", "id": 201456, "time": "2017-10-14T06:26:26Z", "creator": "remm@apache.org", "creation_time": "2017-10-14T06:26:26Z", "is_private": false}, {"count": 25, "tags": [], "bug_id": 57767, "attachment_id": null, "text": "I believe that there are additional benefits for separating the websocket client from the container. For example, we could enhance the redirect flow when behind a proxy by caching the SocketChannel for a connected host:port. We can always, pass the structure as a method argument, but I am not sure that can be manageable long term. In my opinion, as it stands, the container limits flexibility when adding similar features.", "id": 201532, "time": "2017-10-19T03:25:53Z", "creator": "jfern096@gmail.com", "creation_time": "2017-10-19T03:25:53Z", "is_private": false}]
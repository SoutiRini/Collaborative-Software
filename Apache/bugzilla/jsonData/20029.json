[{"count": 0, "tags": [], "bug_id": 20029, "attachment_id": null, "text": "The 'if [ \"$1\" = \"-force\" ]' branch of the stop command is never called because\nof the previous \"exec $_RUNJAVA... org.apache.catalina.startup.Bootstrap $@\nstop\" command (the processing of catalina.sh ends by calling exec). \n\nRemoving the exec command fixes the problem as far as I can see.\n\nFixed code snippet:\n\nelif [ \"$1\" = \"stop\" ] ; then\n\n  shift\n  \"$_RUNJAVA\" $JAVA_OPTS $CATALINA_OPTS \\\n    -Djava.endorsed.dirs=\"$JAVA_ENDORSED_DIRS\" -classpath \"$CLASSPATH\" \\\n    -Dcatalina.base=\"$CATALINA_BASE\" \\\n    -Dcatalina.home=\"$CATALINA_HOME\" \\\n    -Djava.io.tmpdir=\"$CATALINA_TMPDIR\" \\\n    org.apache.catalina.startup.Bootstrap \"$@\" stop\n\n  if [ \"$1\" = \"-force\" ] ; then\n    shift\n    if [ ! -z \"$CATALINA_PID\" ]; then\n       echo \"Killing: `cat $CATALINA_PID`\"\n       kill -9 `cat $CATALINA_PID`\n    fi\n  fi\n\n\nelse", "id": 37418, "time": "2003-05-19T08:57:40Z", "creator": "horombo@gmx.de", "creation_time": "2003-05-19T08:57:40Z", "is_private": false}, {"count": 1, "tags": [], "text": "But removing the exec will make shutdown.sh wait until shutdown is complete, \nnot return right away like now.  For a large system, this can easily be \nseveral seconds (or more, depending on custom shutdown code in user webapps).", "is_private": false, "bug_id": 20029, "id": 39564, "time": "2003-06-27T22:39:50Z", "creator": "yoavs@computer.org", "creation_time": "2003-06-27T22:39:50Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Since I don't see how this can work well in all situations (except if we add a\nnew command which would just kill Tomcat - not that good an idea IMO), I'm\nwilling to make the change. We'll see how it works in practice ...", "is_private": false, "bug_id": 20029, "id": 43596, "time": "2003-09-02T12:26:06Z", "creator": "remm@apache.org", "creation_time": "2003-09-02T12:26:06Z", "attachment_id": null}]
[{"count": 0, "attachment_id": null, "bug_id": 40323, "is_private": false, "id": 92541, "time": "2006-08-25T15:13:31Z", "creator": "rcrawfor@wiley.co.uk", "creation_time": "2006-08-25T15:13:31Z", "tags": [], "text": "Standard httpd.conf directives added for mod_ext_filter:\n\n\nExtFilterDefine myfilterZ cmd=\"/scriptpath/scriptname.pl\"\n<Location /home>\n  SetOutputFilter myfilterZ\n</Location>\n\n\nApache config test passes, but on making a request that should hit the filter,\nthe following error is logged:\n\n[Fri Aug 25 10:07:42 2006] [error] [client 192.168.56.15] couldn't find\ndefinition of filter 'myfilterz'\n\n\nWorkaround was to change mod configuration parameters and location directive to\nall lowercase.\n\nExtFilterDefine myfilterz cmd=\"/scriptpath/scriptname.pl\"\n<Location /home>\n  SetOutputFilter myfilterz\n</Location>"}, {"count": 1, "tags": [], "text": "ahh, mod_ext_filter isn't aware that the core server will normalize the case by\nchanging it to lower case; mod_ext_filter has already added the filtername to a\nhash table using your mixed case and later tries to do a lookup using the\nnormalized name\n\nPlease try this patch and report back.\n\nIndex: modules/filters/mod_ext_filter.c\n===================================================================\n--- modules/filters/mod_ext_filter.c\t(revision 431472)\n+++ modules/filters/mod_ext_filter.c\t(working copy)\n@@ -203,6 +203,7 @@\n                                              &ext_filter_module);\n     const char *token;\n     const char *name;\n+    char *normalized_name;\n     ef_filter_t *filter;\n \n     name = ap_getword_white(cmd->pool, &args);\n@@ -210,7 +211,16 @@\n         return \"Filter name not found\";\n     }\n \n-    if (apr_hash_get(conf->h, name, APR_HASH_KEY_STRING)) {\n+    /* During request processing, we find information about the filter\n+     * by looking up the filter name provided by core server in our\n+     * hash table.  But the core server has normalized the filter\n+     * name by converting it to lower case.  Thus, when adding the\n+     * filter to our hash table we have to use lower case as well.\n+     */\n+    normalized_name = apr_pstrdup(cmd->pool, name);\n+    ap_str_tolower(normalized_name);\n+\n+    if (apr_hash_get(conf->h, normalized_name, APR_HASH_KEY_STRING)) {\n         return apr_psprintf(cmd->pool, \"ExtFilter %s is already defined\",\n                             name);\n     }\n@@ -219,7 +229,7 @@\n     filter->name = name;\n     filter->mode = OUTPUT_FILTER;\n     filter->ftype = AP_FTYPE_RESOURCE;\n-    apr_hash_set(conf->h, name, APR_HASH_KEY_STRING, filter);\n+    apr_hash_set(conf->h, normalized_name, APR_HASH_KEY_STRING, filter);\n \n     while (*args) {\n         while (apr_isspace(*args)) {\n", "is_private": false, "id": 92546, "creator": "trawick@apache.org", "time": "2006-08-25T17:03:51Z", "bug_id": 40323, "creation_time": "2006-08-25T17:03:51Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "rcrawfor@wiley.co.uk", "is_private": false, "text": "Hi Jeff.  Have re-built 2.0.55 with the provided mod_ext_filter patch and can\nconfirm it fixes the problem.\n\nMany thanks for your help.", "id": 92975, "time": "2006-09-04T10:26:20Z", "bug_id": 40323, "creation_time": "2006-09-04T10:26:20Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "is_private": false, "id": 92978, "time": "2006-09-04T11:10:48Z", "bug_id": 40323, "creation_time": "2006-09-04T11:10:48Z", "text": "Thanks for your testing.\n\nThe fix is now in trunk and proposed for backport to 2.2.x branch.  If approved\nfor 2.2.x branch I'll propose it for backport to 2.0.x branch as well.\n"}]
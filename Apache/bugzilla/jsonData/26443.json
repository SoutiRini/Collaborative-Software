[{"attachment_id": null, "tags": [], "bug_id": 26443, "text": "According to the javadoc for zip, if you set update=false, the zip task should \noverwrite the destination zip file.  I have found that this is not the case.\n\nI have included an example below that shows that deleting a file and re-\nzipping does not overwrite the destination zip file.  After running the test, \nview the zip file, and you will notice it still contains file1.txt. If I give \nthe zip a new file name, or remove the old zip first, everything works as \nexpected.\n\n<project name=\"ZipOverwriteProblem\" default=\"test\" basedir=\".\">\n    <description>\n        Zip with update=false is not overwritting zip files\n        when a file is deleted.\n    </description>\n\n    <target name=\"test\" depends=\"clean\">\n        <!-- Create a few test files to zip -->\n        <touch file=\"file1.txt\"/>\n        <touch file=\"file2.txt\"/>\n        \n        <!-- Zip the files -->\n        <zip destfile=\"test.zip\"\n             basedir=\".\"\n             includes=\"file1.txt,file2.txt\"/>\n                \n        <!-- Extract the zip into a tmp directory and delete\n             file1.txt -->\n        <mkdir dir=\"tmpw\"/>\n        <unzip src=\"test.zip\" dest=\"tmpw\"/>\n        <delete file=\"tmpw/file1.txt\"/>      \n\n        <!-- Replace test.zip with a new zip that contains the\n             contents of tmpw.  This does not work properly.\n             test.zip ends up still containing file1.txt!!\n             According to the zip java doc, if update=false, \n             the zip file should be overwritten.\n             -->\n        <echo message=\"Overwriting test.zip file\"/>\n        <echo message=\"Manually verify it no longer contains file1.txt\"/>\n        <zip destfile=\"test.zip\" \n             update=\"false\"\n             basedir=\"tmpw\"/>\n        \n    </target>\n\n    <target name=\"clean\">\n        <delete>\n            <fileset dir=\".\">\n                <include name=\"file1.txt\"/>\n                <include name=\"file2.txt\"/>\n                <include name=\"test.zip\"/>\n                <include name=\"tmpw/**\"/>\n            </fileset>\n        </delete>\n    </target>\n</project>", "count": 0, "id": 51206, "time": "2004-01-26T18:57:52Z", "creator": "mlottman@carefx.com", "creation_time": "2004-01-26T18:57:52Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 26443, "attachment_id": null, "text": "The documentation is probably a bit unclear, but waht you see is expected behavior.\n\nAnt will update/recreate the zip if any of the files in your fileset is newer than\nthe corresponding entry in the archive.  It doesn't even try to look for missing\nfiles.", "id": 51461, "time": "2004-01-30T13:39:23Z", "creator": "bodewig@apache.org", "creation_time": "2004-01-30T13:39:23Z", "is_private": false}, {"count": 2, "tags": [], "creator": "mlottman@carefx.com", "attachment_id": null, "id": 51475, "time": "2004-01-30T15:08:49Z", "bug_id": 26443, "creation_time": "2004-01-30T15:08:49Z", "is_private": false, "text": "The java doc is pretty clear on what update=false (no) should do:\n\n\"The update parameter controls what happens if the ZIP file already exists. \nWhen set to yes, the ZIP file is updated with the files specified. (New files \nare added; old files are replaced with the new versions.) When set to no (the \ndefault) the ZIP file is overwritten.\"\n\nSo I disagree that the way that it is working is the expected behaviour.  If I \nset update to false, the zip file should always be overwritten, it should not \ndepend on any time stamps, in fact it should'nt look at the existing zip at \nall.  I think this is a bug."}, {"count": 3, "tags": [], "creator": "bodewig@apache.org", "text": "\"expected behavior\" is a difficult term.  I meant expected by the guy who has\nimplemented the behavior. 8-)\n\nAlways recreating the archive would lead to really bad performance in situations\nwhere the resulting archive and the original archive are identical - that's why\nthe timestamp checks are there.", "id": 51476, "time": "2004-01-30T15:17:33Z", "bug_id": 26443, "creation_time": "2004-01-30T15:17:33Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 26443, "text": "Ok, I understand.  I think that the Zip task documentation \n(http://ant.apache.org/manual/CoreTasks/zip.html)should be changed to clearly \nstate what the current update=false behaviour is.  I feel that the current \ndocumentation is misleading.", "count": 4, "id": 51478, "time": "2004-01-30T15:29:17Z", "creator": "mlottman@carefx.com", "creation_time": "2004-01-30T15:29:17Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 26443, "attachment_id": null, "text": "OK, I've clarified the docs (at least I think so).\n\nI'm going to close this report - you may be interested in the enhancement request\nbug 25601 which would enable you to always force Ant to recreate your archive.", "id": 51583, "time": "2004-02-02T14:13:34Z", "creator": "bodewig@apache.org", "creation_time": "2004-02-02T14:13:34Z", "is_private": false}]
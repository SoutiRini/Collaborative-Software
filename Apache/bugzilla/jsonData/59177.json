[{"count": 0, "tags": [], "bug_id": 59177, "is_private": false, "text": "Created attachment 33668\nsample websocket app\n\n- Each time a websocket session is closed, it always throw IOException.\nThe reason is when WSSession#onClose method is called, and it changes the state to State.CLOSING, but the WSSesssion#registerFuture fail the checking state, if the State is not OPEN, it throw exception\n\n- This bug not happen on Tomcat 7.0.63\n\n- I have attached the sample app that use websocket, this sample is the \"Echo\" sample downloaded from Tomcat document page.\n- Steps to reproduce issue:\n+ Deploy app and go to : http://localhost:8080/wsSample/test.html\n+ Connect, send messsage\n+ Disconnect --> Throw IOException in tomcat error log\n\n- I guess we should instead check State is not close instead of is OPEN in WSSesssion#registerFuture", "id": 189452, "time": "2016-03-14T10:35:39Z", "creator": "vstorm83@gmail.com", "creation_time": "2016-03-14T10:35:39Z", "attachment_id": 33668}, {"attachment_id": null, "tags": [], "creator": "violetagg@apache.org", "text": "\n\n*** This bug has been marked as a duplicate of bug 59014 ***", "count": 1, "id": 189455, "time": "2016-03-14T11:04:02Z", "bug_id": 59177, "creation_time": "2016-03-14T11:04:02Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 36533, "text": "Something is not right with both twsadjust and ipd settings under certain line\nbreaking conditions. I'll attach a testcase showing the problem. I admit I am a\nbit out of my depth in this area of the code (Line LM - Line Breaking). If\nsomeone else please could have a look.\n\nThe problems as I see them:\n\n1. On the text area in the first fo:block the twsadjust value is set to \"-897\"\nresulting in the output being more \"squished\" than necessary. No other text\nareas in the example have a non zero twsadjust value. This also leads to\ndifferent rendering of this line than the corresponding lines in the next two\nfo:blocks.\n\n2. The second text areas in the second and third fo:block, that is the text\nareas for the string \"and right border at the beginning of the and the end of\nthe inline only. Any lines\" are given an ipd bigger than the line area they\nbelong to. While that is not visible in the output (PDF renderer) for the second\nfo:block on third block one can see it as the inlineparent also has been given\nan ipd wider than the line area.", "id": 79480, "time": "2005-09-07T04:49:06Z", "creator": "mm@arcus.com.au", "creation_time": "2005-09-07T04:49:06Z", "is_private": false, "attachment_id": null}, {"attachment_id": 16321, "tags": [], "creator": "mm@arcus.com.au", "is_private": false, "count": 1, "id": 79481, "time": "2005-09-07T04:50:10Z", "bug_id": 36533, "creation_time": "2005-09-07T04:50:10Z", "text": "Created attachment 16321\nTestcase xml file - no sensible checks yet"}, {"count": 2, "tags": [], "bug_id": 36533, "text": "Created attachment 16322\nThe area tree generated from the testcase", "id": 79482, "time": "2005-09-07T04:51:14Z", "creator": "mm@arcus.com.au", "creation_time": "2005-09-07T04:51:14Z", "is_private": false, "attachment_id": 16322}, {"attachment_id": null, "tags": [], "creator": "mm@arcus.com.au", "is_private": false, "count": 3, "id": 79490, "time": "2005-09-07T09:48:14Z", "bug_id": 36533, "creation_time": "2005-09-07T09:48:14Z", "text": "Re item 2: I think I know what's happening. There is a trailing space at the end\nof all the text areas that end at a linebreak. That space should not be there."}, {"count": 4, "attachment_id": null, "bug_id": 36533, "is_private": false, "id": 79497, "time": "2005-09-07T11:05:19Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2005-09-07T11:05:19Z", "tags": [], "text": "I'm going to have a closer look at what happens: in the testcase, areas should \nnot have any adjustment, as the text is not justified.\n\nYour observation about trailing spaces is very interesting: I thought their \nremoval was ok, but it seems there is something left to fix ...\n\nIf blocks have text-align=\"justify\" everything is ok; if it is \"left\", \"right\" \nor \"center\" it seems that the text is correctly placed, but the inline areas \nare somewhat larger than needed."}, {"count": 5, "tags": [], "text": "I just remembered what happens to the first block: it is not really a \"bug\" in \nthe proper sense.\n\nThe elements added at the end of a sequence in LineLM.Paragraph.endSequence() \ncomprise (under some conditions) a glue whose width is > 0; its aim is for the \nline breaking algorithm to leave a little empty space at the end of the last \nline of a paragraph.\n\nThis is not done when text-align-last=\"justify\" or text-align=\"center\"; maybe \nwe should not do it even if text-align is \"left\" or \"right\", i.e. do it only \nwith justified text, when its importance is bigger (as this helps reader to \nvisually recognize where a paragraph ends)", "is_private": false, "bug_id": 36533, "id": 79500, "time": "2005-09-07T11:22:46Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2005-09-07T11:22:46Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 36533, "attachment_id": null, "is_private": false, "id": 79502, "time": "2005-09-07T11:42:51Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2005-09-07T11:42:51Z", "text": "It's funny to give new names to existing things and see the resulting \nconfusion ... ;-)\n\nThe \"empty space at the end of the last line of a paragraph\" is also known \nas \"last-line-end-indent\". I'm going to make the LineLM use the value of this \nproperty."}, {"attachment_id": null, "tags": [], "creator": "lfurini@cs.unibo.it", "is_private": false, "count": 7, "id": 79637, "time": "2005-09-08T13:16:06Z", "bug_id": 36533, "creation_time": "2005-09-08T13:16:06Z", "text": "Now both items should be fixed (svn commits r279338 and r279551).\n\nThanks for your detailed description of the problem, it really helped finding \nthe errors in a short time!"}, {"count": 8, "attachment_id": null, "bug_id": 36533, "text": "Luca, I am reopening the bug because I found that item 2. (extra space at end \nof line) still seems to occur with hyphenation enabled.\n\nI'll attach a testcase file, the generated area tree, and the generated pdf (as \nit nicely visualises the problem).\n\nPlease note that the fo:inline in the testcase is not required to reproduce the \nproblem (it just allows highlighting the additional space in the PDF).\n\nYou have to have a copy of fop-hyph.jar in the classpath. Just having \nhyphenate=\"true\" is not enough to produce the problem.", "id": 79768, "time": "2005-09-11T10:34:45Z", "creator": "mm@arcus.com.au", "creation_time": "2005-09-11T10:34:45Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "text": "Created attachment 16355\nTestcase xml file (version with hyphenate=\"true\")  - no sensible checks though", "is_private": false, "bug_id": 36533, "id": 79769, "time": "2005-09-11T10:37:27Z", "creator": "mm@arcus.com.au", "creation_time": "2005-09-11T10:37:27Z", "attachment_id": 16355}, {"count": 10, "tags": [], "bug_id": 36533, "attachment_id": 16356, "text": "Created attachment 16356\nArea tree generated from attachment #16355", "id": 79770, "time": "2005-09-11T10:38:37Z", "creator": "mm@arcus.com.au", "creation_time": "2005-09-11T10:38:37Z", "is_private": false}, {"count": 11, "attachment_id": 16357, "bug_id": 36533, "text": "Created attachment 16357\nPDF generated from attachment #16355", "id": 79771, "time": "2005-09-11T10:40:49Z", "creator": "mm@arcus.com.au", "creation_time": "2005-09-11T10:40:49Z", "tags": [], "is_private": false}, {"count": 12, "attachment_id": null, "bug_id": 36533, "is_private": false, "id": 79786, "time": "2005-09-12T11:04:05Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2005-09-12T11:04:05Z", "tags": [], "text": "Oops!\nI see the problem, and I know the reason: I fixed the method \ngetNextKnuthElements() but forgot to fix getChangedKnuthElements() too ...\n\nWell, I think it's time for me to factor out some duplicated lines! :-)"}, {"count": 13, "attachment_id": null, "bug_id": 36533, "is_private": false, "id": 79860, "time": "2005-09-13T11:12:16Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2005-09-13T11:12:16Z", "tags": [], "text": "The commit r280520 has removed duplicated lines in the methods \ngetNextKnuthElements() and getChangedKnuthElements(), solving this bug \ndefinitively ... I hope! ;-)\n\nI'm leaving this issue \"reopened\", as I want to check the behaviour of other \nformatting objects which could have similar problems, especially fo:character."}, {"count": 14, "attachment_id": null, "bug_id": 36533, "is_private": false, "id": 79878, "time": "2005-09-13T16:04:15Z", "creator": "mm@arcus.com.au", "creation_time": "2005-09-13T16:04:15Z", "tags": [], "text": "Sorry Luca, I don't want to annoy you (really), but I think I found another \nproblem (actually two problems).\n\n1. Under text-align=right and hyphenation we are now 2780mpt (= one space) \nshort. You got rid of the excessive spaces and now we are missing one :-). I'll \nattach a testcase for it.\n\n2. If you uncomment the second block in the test (or make the first block text-\nalign=\"center\") you get a ClassCastException on a LeafNodePosition."}, {"attachment_id": 16392, "tags": [], "creator": "mm@arcus.com.au", "text": "Created attachment 16392\nTestcase xml file\n\nYou need to have OFFO fop-hyph.jar in the classpath for the problem to show.", "count": 15, "id": 79879, "time": "2005-09-13T16:06:14Z", "bug_id": 36533, "creation_time": "2005-09-13T16:06:14Z", "is_private": false}, {"count": 16, "tags": [], "bug_id": 36533, "attachment_id": 16393, "is_private": false, "id": 79880, "time": "2005-09-13T16:06:54Z", "creator": "mm@arcus.com.au", "creation_time": "2005-09-13T16:06:54Z", "text": "Created attachment 16393\nPDF generated from attachment #16392"}, {"count": 17, "tags": [], "bug_id": 36533, "attachment_id": null, "text": "Well, it seems I was right (at least) in leaving this issue open! :-)\n\nThanks for your quick feedback, I'm going to see what happens ...", "id": 79886, "time": "2005-09-13T16:32:22Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2005-09-13T16:32:22Z", "is_private": false}, {"count": 18, "tags": [], "bug_id": 36533, "attachment_id": null, "text": "please reverify this bug exists on the current FOP development trunk, updating the test input and resulting output files as needed", "id": 157039, "time": "2012-04-01T21:24:03Z", "creator": "gadams@apache.org", "creation_time": "2012-04-01T21:24:03Z", "is_private": false}, {"count": 19, "tags": [], "bug_id": 36533, "attachment_id": null, "text": "resetting P2 open bugs to P3 pending further review", "id": 157478, "time": "2012-04-07T01:43:35Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:43:35Z", "is_private": false}]
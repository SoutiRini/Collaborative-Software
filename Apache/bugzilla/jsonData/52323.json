[{"count": 0, "tags": [], "text": "Created attachment 28069\nthe patch, based on revision 1213685\n\nCobertura (cobertura.sf.net) is an opensource Java code coverage tool released (with in dependencies) under The Apache Software License, Version 1.1 and/or The GNU General Public License, Version 2.0.\n\nIt can assess how much of the codebase was actually executed during a program run.\nIf the program run means running the test suite, it will produce results showing how much of the code the tests cover, potentially discover weak spots.\n\nThis patch provides support for Cobertura in the build.xml and build.properties.default files. It introduces four new targets:\n * download-cobertura - downloads and unpacks Cobertura in ${base.path}\n * cobertura-enable - enables Cobertura to be used\n * cobertura-instrument - adds Cobertura instrumentation to compiled bytecode\n * cobertura-report - produces reports from Cobertura results. HTML by default\n   (can be overwritten with 'cobertura.report.format' property).\n\nThe behavior of this patch doesn't break existing targets in any way.\n\nTo use this tool, one simply runs 'ant cobertura-enable test' which will instrument the compiled classes before running the tests and also supply all the necessary resources for Cobertura to gather the coverage results.\nOnce the tests are completed 'ant cobertura-report' will produce lovely HTML report about the test coverage in '${tomcat.build}/coverage'.\n\nNOTE: Although the result of the test cases should not be affected by Cobertura, it is not guaranteed.", "is_private": false, "id": 152144, "creator": "mhasko@redhat.com", "time": "2011-12-13T13:57:56Z", "bug_id": 52323, "creation_time": "2011-12-13T13:57:56Z", "attachment_id": 28069}, {"count": 1, "tags": [], "text": "Marking as an enhancement", "attachment_id": null, "bug_id": 52323, "id": 152151, "time": "2011-12-13T19:36:05Z", "creator": "markt@apache.org", "creation_time": "2011-12-13T19:36:05Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 52323, "attachment_id": null, "text": "Just tried to enable Cobertura with Tomcat 8 trunk and the tests fail consistently with NPE's in the instrumented code. Absent a working patch for this with Tomncat 8, this issue is eventually going to be resolved as WONTFIX.", "id": 170958, "time": "2013-11-01T10:09:01Z", "creator": "markt@apache.org", "creation_time": "2013-11-01T10:09:01Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 52323, "attachment_id": 30996, "id": 170989, "time": "2013-11-02T12:51:59Z", "creator": "violetagg@apache.org", "creation_time": "2013-11-02T12:51:59Z", "is_private": false, "text": "Created attachment 30996\nupdated patch\n\nHi,\n\nI touched the script here and there and also updated the version to 2.0.3.\nI think it is working now. Can you check? I tested on Windows.\n\nThe NPE was because the cobertura instrumented our ClassLoaderLogManager and in the same time tried to initialize a static Logger field. [1]\n\nRegards\nVioleta\n\n[1] https://github.com/cobertura/cobertura/blob/master/cobertura/src/main/java/net/sourceforge/cobertura/coveragedata/TouchCollector.java"}, {"count": 4, "tags": [], "bug_id": 52323, "is_private": false, "text": "The patch is against trunk (Tomcat 8)", "id": 170990, "time": "2013-11-02T12:57:12Z", "creator": "violetagg@apache.org", "creation_time": "2013-11-02T12:57:12Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Ah, that makes sense.\n\nI changed the way the patch worked to make it consistent with how we enable things like validation.\n\nCobertura support has been added to 8.0.x (8.0.0-RC6 onwards) and 7.0.x (7.0.48 onwards).", "is_private": false, "id": 171021, "creator": "markt@apache.org", "time": "2013-11-04T09:20:06Z", "bug_id": 52323, "creation_time": "2013-11-04T09:20:06Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "(In reply to Mark Thomas from comment #5)\n> Ah, that makes sense.\n> \n> I changed the way the patch worked to make it consistent with how we enable\n> things like validation.\n> \n> Cobertura support has been added to 8.0.x (8.0.0-RC6 onwards) and 7.0.x\n> (7.0.48 onwards).\n\nSo... what does our code-coverage look like? Is there a CC-report available through Jenkins?", "attachment_id": null, "id": 171026, "creator": "chris@christopherschultz.net", "time": "2013-11-04T15:06:24Z", "bug_id": 52323, "creation_time": "2013-11-04T15:06:24Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 52323, "attachment_id": null, "id": 171036, "time": "2013-11-04T20:57:14Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2013-11-04T20:57:14Z", "is_private": false, "text": "1. It needs some documentation in BUILDING.txt\nE.g. at \"(7.3) Other configuration options\".\n\n\nTesting current trunk, with JDK 7u45. Ant 1.9.2\nCobertura is NOT enabled.\nRunning only NIO tests.\nexecute.test.nio=true\n\nant test 1>ant_test.log 2>&1\n\nI see two problems:\n\n\n2. Cobertura is downloaded even though I have not enabled it.\n\nApparently the \"download-cobertura\" target needs if=\"${test.cobertura}\".\n\n\n3. I see a lot of error messages in the test logs, though the tests themselves do not fail.\n\nE.g. in \nTEST-org.apache.catalina.core.TestStandardContextResources.NIO.txt\n\n05-Nov-2013 00:35:52.555 SEVERE [localhost-startStop-1] org.apache.catalina.startup.ContextConfig.processAnnotationsJar Unable to process Jar entry [com/ibm/icu/impl/data/LocaleElements_zh__PINYIN.class] from Jar [jar:file:/(...)/libraries/tomcat8/cobertura-2.0.3/lib/icu4j-2.6.1.jar!/] for annotations\n org.apache.tomcat.util.bcel.classfile.ClassFormatException: Invalid byte tag in constant pool: 60\n\tat org.apache.tomcat.util.bcel.classfile.Constant.readConstant(Constant.java:124)\n\tat org.apache.tomcat.util.bcel.classfile.ConstantPool.<init>(ConstantPool.java:60)\n\tat org.apache.tomcat.util.bcel.classfile.ClassParser.readConstantPool(ClassParser.java:167)\n\tat org.apache.tomcat.util.bcel.classfile.ClassParser.parse(ClassParser.java:91)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsStream(ContextConfig.java:2027)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJar(ContextConfig.java:1958)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsUrl(ContextConfig.java:1926)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotations(ContextConfig.java:1877)\n\tat org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1147)\n\tat org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:769)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:305)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)\n\tat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5166)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\tat org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1390)\n\tat org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1380)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:744)"}, {"count": 8, "tags": [], "bug_id": 52323, "attachment_id": null, "id": 171045, "time": "2013-11-04T23:58:08Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2013-11-04T23:58:08Z", "is_private": false, "text": "(In reply to Konstantin Kolinko from comment #7)\n> 2. Cobertura is downloaded even though I have not enabled it.\n> \n> Apparently the \"download-cobertura\" target needs if=\"${test.cobertura}\".\n> \n\n\"2.\" has been fixed in trunk and Tomcat 7."}, {"count": 9, "tags": [], "bug_id": 52323, "is_private": false, "text": "(In reply to Christopher Schultz from comment #6)\n> \n> So... what does our code-coverage look like? Is there a CC-report available\n> through Jenkins?\n\nTomcat doesn't use the ASF's Jenkins server for CI, it uses Buildbot.\n\nI've just enabled Cobertura for the trunk build. If I have got it right, something should appear here in the next few hours:\nhttp://ci.apache.org/projects/tomcat/tomcat8/coverage", "id": 171049, "time": "2013-11-05T10:13:57Z", "creator": "markt@apache.org", "creation_time": "2013-11-05T10:13:57Z", "attachment_id": null}, {"count": 10, "tags": [], "text": "1. & 3. have also been fixed in trunk and 7.0.x", "is_private": false, "bug_id": 52323, "id": 171050, "time": "2013-11-05T10:17:34Z", "creator": "markt@apache.org", "creation_time": "2013-11-05T10:17:34Z", "attachment_id": null}]
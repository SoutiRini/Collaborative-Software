[{"count": 0, "tags": [], "text": "Created attachment 33337\nOne triggering file from govdocs1\n\nWhile testing rc1 for 3.14-beta1 (running tika in multithreaded batch mode), I found that we're getting ~7000 of the following exception:\n\norg.apache.poi.hslf.exceptions.HSLFException: Master styles not initialized\n\tat org.apache.poi.hslf.usermodel.HSLFSlideMaster.setSlideShow(HSLFSlideMaster.java:144)\n\tat org.apache.poi.hslf.usermodel.HSLFSlideShow.buildSlidesAndNotes(HSLFSlideShow.java:362)\n\tat org.apache.poi.hslf.usermodel.HSLFSlideShow.<init>(HSLFSlideShow.java:152)\n\tat org.apache.poi.hslf.usermodel.HSLFSlideShow.<init>(HSLFSlideShow.java:185)\n\tat org.apache.tika.parser.microsoft.HSLFExtractor.parse(HSLFExtractor.java:61)\n\tat org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:149)\n\nWe were getting roughly this many with 3.13 (it turns out).\n\nI'm not able to reproduce this with the single-threaded Tika-app, and I'm not able to reproduce this with JUnit running multiple threads again and again on a handful of triggering files. \n\nWe did not have these exceptions in Tika 1.9 (POI 3.12).  I haven't tested more recent intermediate versions yet.", "is_private": false, "bug_id": 58718, "id": 186885, "time": "2015-12-10T19:47:42Z", "creator": "tallison@mitre.org", "creation_time": "2015-12-10T19:47:42Z", "attachment_id": 33337}, {"count": 1, "tags": [], "bug_id": 58718, "text": "Are the Tike-tests that reproduce this available somewhere? If it is possible to consistently reproduce the error somehow it could be a good match for a git-bisect run to determine the exact commit that introduced this behavior...", "id": 186888, "time": "2015-12-11T09:41:49Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-12-11T09:41:49Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 58718, "text": "Y, first step was to find minimal failing set.\n\nI think I found that this is not a multi-threading issue, but it is an issue of file order.\n\nThis code fails in a standalone project with POI 3.13 Note that it is pure POI.\n\nMy current POI trunk isn't building so I can't go pure, pure POI. \n\n\n    @Test\n    public void testSequential() throws Exception {\n        File dir = new File(\"C:\\\\data\\\\badppts\");\n        String[] fileNames = new String[]{\n                \"008495.ppt\",\n                \"008524.ppt\",\n                \"008558.ppt\"\n        };\n        for (String fName : fileNames) {\n            InputStream is = null;\n            try {\n                is = new FileInputStream(new File(dir, fName));\n                PowerPointExtractor ex = new PowerPointExtractor(is);\n                ex.getText();\n            } catch (Exception e) {\n                e.printStackTrace();\n            } finally {\n                if (is != null) {\n                    try {\n                        is.close();\n                    } catch (IOException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n        }\n    }", "id": 186903, "time": "2015-12-11T20:39:42Z", "creator": "tallison@mitre.org", "creation_time": "2015-12-11T20:39:42Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 58718, "is_private": false, "text": "Created attachment 33340\none file that is implicated", "id": 186904, "time": "2015-12-11T20:42:09Z", "creator": "tallison@mitre.org", "creation_time": "2015-12-11T20:42:09Z", "attachment_id": 33340}, {"count": 4, "tags": [], "creator": "tallison@mitre.org", "text": "Created attachment 33341\nOther two files", "id": 186905, "time": "2015-12-11T20:42:23Z", "bug_id": 58718, "creation_time": "2015-12-11T20:42:23Z", "is_private": false, "attachment_id": 33341}, {"count": 5, "tags": [], "bug_id": 58718, "attachment_id": null, "is_private": false, "id": 186906, "time": "2015-12-11T20:52:09Z", "creator": "tallison@mitre.org", "creation_time": "2015-12-11T20:52:09Z", "text": "No exception in 3.13-beta or before.  Exception starts in 3.13.\n\nApologies for the mess of attached files (couldn't zip 3 test files together and fit onto bugzilla).\n\nAlso apologies for the non unit test...wanted to get this finding out asap."}, {"count": 6, "tags": [], "creator": "tallison@mitre.org", "attachment_id": null, "text": "Looks like we can go even more minimal, just use these two files:\n                \"008495.ppt\",\n                \"008558.ppt\"\n\n\nThe first one causes: \njava.lang.ArrayIndexOutOfBoundsException: 110\n\tat org.apache.poi.util.LittleEndian.getInt(LittleEndian.java:161)\n\tat org.apache.poi.hslf.record.TxMasterStyleAtom.init(TxMasterStyleAtom.java:157)\n\tat org.apache.poi.hslf.record.TxMasterStyleAtom.<init>(TxMasterStyleAtom.java:70)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:422)\n\tat org.apache.poi.hslf.record.Record.createRecordForType(Record.java:181)\n\tat org.apache.poi.hslf.record.Record.findChildRecords(Record.java:128)\n\tat org.apache.poi.hslf.record.MainMaster.<init>(MainMaster.java:64)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:422)\n\tat org.apache.poi.hslf.record.Record.createRecordForType(Record.java:181)\n\tat org.apache.poi.hslf.record.Record.buildRecordAtOffset(Record.java:103)\n\tat org.apache.poi.hslf.usermodel.HSLFSlideShowImpl.read(HSLFSlideShowImpl.java:294)\n\tat org.apache.poi.hslf.usermodel.HSLFSlideShowImpl.buildRecords(HSLFSlideShowImpl.java:275)\n\tat org.apache.poi.hslf.usermodel.HSLFSlideShowImpl.<init>(HSLFSlideShowImpl.java:179)\n\tat org.apache.poi.hslf.extractor.PowerPointExtractor.<init>(PowerPointExtractor.java:117)\n\tat org.apache.poi.hslf.extractor.PowerPointExtractor.<init>(PowerPointExtractor.java:98)\n\tat org.apache.poi.hslf.extractor.PowerPointExtractor.<init>(PowerPointExtractor.java\n\nAnd this exception leaves a residue which causes the \"Master styles not initialized\" exception in 008558.ppt.  However, if you just parse 008558.ppt by itself, no exception.", "id": 186907, "time": "2015-12-11T21:20:57Z", "bug_id": 58718, "creation_time": "2015-12-11T21:20:57Z", "is_private": false}, {"count": 7, "attachment_id": null, "bug_id": 58718, "text": "git-bisect came up with the following commit that changed this: r1717351\n\n    - #47904 - Update text styles in HSLF MasterSlide\n    - common sl unification for TextParagraph.setTextAlign", "id": 186909, "time": "2015-12-11T23:25:04Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-12-11T23:25:04Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "text": "Fixed in r1719758\n\nThis was a cloning error in TabStopPropCollection.\nWhenever a tab stop collection was not empty, the tab stops were also added to \nthe global property template\nand copied over to next the parsed properties.", "is_private": false, "id": 186918, "creator": "kiwiwings@apache.org", "time": "2015-12-13T01:55:41Z", "bug_id": 58718, "creation_time": "2015-12-13T01:55:41Z", "attachment_id": null}, {"count": 9, "attachment_id": null, "bug_id": 58718, "text": "Thank you, Andi and Dominik!\n\nI was wrong about the affected versions...Sorry.  This does not appear to affect 3.13-final.  It did start with 3.14-beta1 rc1, which is consistent with Dominik's finding.  This also explains why I didn't find it while we were prepping for the release of Tika 1.11 -- the problem didn't exist then.", "id": 186943, "time": "2015-12-14T18:43:51Z", "creator": "tallison@mitre.org", "creation_time": "2015-12-14T18:43:51Z", "tags": [], "is_private": false}]
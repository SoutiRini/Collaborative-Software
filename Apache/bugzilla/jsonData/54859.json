[{"count": 0, "tags": [], "bug_id": 54859, "text": "I am using the undeployOldVersions option of parallel deployment.  After the war file gets removed I still see the directory and files under the work/Catalina/localhost remain.  I would think the undeployOldVersions option should be removing these files also.", "id": 166685, "time": "2013-04-17T21:35:03Z", "creator": "joe.knudsen@gmail.com", "creation_time": "2013-04-17T21:35:03Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 54859, "attachment_id": null, "id": 166686, "time": "2013-04-18T07:53:27Z", "creator": "violetagg@apache.org", "creation_time": "2013-04-18T07:53:27Z", "is_private": false, "text": "Hi,\n\nCan you give us more information about:\n- configuration - is it standard or you customized it?\n- what do you see in the logs?\n\nFor example I can see the following in the console:\n\n\"\nApr 18, 2013 10:34:45 AM org.apache.catalina.startup.HostConfig deployWAR\nINFO: Deploying web application archive /apache-tomcat-7.0.37/webapps/examples##2.war\nApr 18, 2013 10:35:03 AM org.apache.catalina.startup.HostConfig checkUndeploy\nINFO: Undeploying old version of context [/examples] which has no active session\nApr 18, 2013 10:35:03 AM org.apache.catalina.startup.HostConfig deleteRedeployResources\nINFO: Undeploying context [/examples]\n\"\n\nSo the message below is the important one:\n\"Undeploying old version of context [/examples] which has no active session\"\n\nDo you have active sessions to the previous version of the application?\n\nIf there are active sessions the application will be available. When all active sessions expired, the old version will be undeployed.\n\nRegards\nVioleta"}, {"count": 2, "tags": [], "creator": "joe.knudsen@gmail.com", "text": "I will gather additional information.  I am attempting to use the feature to do continous integration and deployment on Grails builds.   At times builds fail due to problems with the build or running out of Perm memory.  These could be what is causing the undeploy to not work or partially work by just removing the war file and leaving the work/Catalina remaining.", "id": 166756, "time": "2013-04-22T13:14:59Z", "bug_id": 54859, "creation_time": "2013-04-22T13:14:59Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 54859, "text": "Below is the logs of a simple Grails application failing to delete from Catalina/localhost:\n\nINFO: Deploying web application archive E:\\Apache\\Tomcat-7.0.39_7600_x64\\webapps\\dfpeapi##2974.war\nApr 22, 2013 4:53:26 PM org.apache.catalina.startup.HostConfig checkUndeploy\nINFO: Undeploying old version of context [/dfpeapi##2973] which has no active session\nApr 22, 2013 4:53:26 PM org.apache.catalina.startup.HostConfig deleteRedeployResources\nINFO: Undeploying context [/dfpeapi##2973]\nApr 22, 2013 4:53:27 PM org.apache.catalina.loader.WebappClassLoader checkThreadLocalMapForLeaks\nSEVERE: The web application [/dfpeapi##2973] created a ThreadLocal with key of type [org.codehaus.groovy.reflection.ClassInfo.ThreadLocalMapHandler] (value [org.codehaus.groovy.reflection.ClassInfo$ThreadLocalMapHandler@1c551dc1]) and a value of type [java.lang.ref.SoftReference] (value [java.lang.ref.SoftReference@1814786f]) but failed to remove it when the web application was stopped. Threads are going to be renewed over time to try and avoid a probable memory leak.\nApr 22, 2013 4:53:27 PM org.apache.catalina.loader.WebappClassLoader checkThreadLocalMapForLeaks\nSEVERE: The web application [/dfpeapi##2973] created a ThreadLocal with key of type [org.codehaus.groovy.reflection.ClassInfo.ThreadLocalMapHandler] (value [org.codehaus.groovy.reflection.ClassInfo$ThreadLocalMapHandler@1c551dc1]) and a value of type [java.lang.ref.SoftReference] (value [java.lang.ref.SoftReference@6e8362dc]) but failed to remove it when the web application was stopped. Threads are going to be renewed over time to try and avoid a probable memory leak.\nApr 22, 2013 4:53:27 PM org.apache.catalina.loader.WebappClassLoader checkThreadLocalMapForLeaks\nSEVERE: The web application [/dfpeapi##2973] created a ThreadLocal with key of type [org.codehaus.groovy.reflection.ClassInfo.ThreadLocalMapHandler] (value [org.codehaus.groovy.reflection.ClassInfo$ThreadLocalMapHandler@1c551dc1]) and a value of type [java.lang.ref.SoftReference] (value [java.lang.ref.SoftReference@73cf9232]) but failed to remove it when the web application was stopped. Threads are going to be renewed over time to try and avoid a probable memory leak.\nApr 22, 2013 4:53:27 PM org.apache.catalina.loader.WebappClassLoader checkThreadLocalMapForLeaks\nSEVERE: The web application [/dfpeapi##2973] created a ThreadLocal with key of type [org.codehaus.groovy.reflection.ClassInfo.ThreadLocalMapHandler] (value [org.codehaus.groovy.reflection.ClassInfo$ThreadLocalMapHandler@1c551dc1]) and a value of type [java.lang.ref.SoftReference] (value [java.lang.ref.SoftReference@40874c04]) but failed to remove it when the web application was stopped. Threads are going to be renewed over time to try and avoid a probable memory leak.\nApr 22, 2013 4:53:28 PM org.apache.catalina.startup.ExpandWar deleteDir\nSEVERE: [E:\\Apache\\Tomcat-7.0.39_7600_x64\\work\\Catalina\\localhost\\dfpeapi##2973\\WEB-INF\\lib] could not be completely deleted. The presence of the remaining files may cause problems\nApr 22, 2013 4:53:28 PM org.apache.catalina.startup.ExpandWar deleteDir\nSEVERE: [E:\\Apache\\Tomcat-7.0.39_7600_x64\\work\\Catalina\\localhost\\dfpeapi##2973\\WEB-INF] could not be completely deleted. The presence of the remaining files may cause problems\nApr 22, 2013 4:53:28 PM org.apache.catalina.startup.ExpandWar deleteDir\nSEVERE: [E:\\Apache\\Tomcat-7.0.39_7600_x64\\work\\Catalina\\localhost\\dfpeapi##2973] could not be completely deleted. The presence of the remaining files may cause problems\nApr 22, 2013 4:53:28 PM org.apache.catalina.startup.ExpandWar delete\nSEVERE: [E:\\Apache\\Tomcat-7.0.39_7600_x64\\work\\Catalina\\localhost\\dfpeapi##2973] could not be completely deleted. The presence of the remaining files may cause problems", "id": 166767, "time": "2013-04-22T22:05:38Z", "creator": "joe.knudsen@gmail.com", "creation_time": "2013-04-22T22:05:38Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "text": "That is an app / Grails problem, not a Tomcat one.", "attachment_id": null, "bug_id": 54859, "id": 166770, "time": "2013-04-22T22:32:23Z", "creator": "markt@apache.org", "creation_time": "2013-04-22T22:32:23Z", "is_private": false}, {"count": 5, "tags": [], "creator": "joe.knudsen@gmail.com", "attachment_id": null, "id": 166790, "time": "2013-04-23T16:03:05Z", "bug_id": 54859, "creation_time": "2013-04-23T16:03:05Z", "is_private": false, "text": "Looking at the files remaining are just a couple of jars.  The jtds driver and the hibernate-validator and the liqubase-core.  All involved with the DB connections.  I tried using the setting the options for Windows below, both individually and together with no changes in behavior.\n\n<Context antiJARLocking=\"true\" antiResourceLocking=\"true\">"}]
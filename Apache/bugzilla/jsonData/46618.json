[{"count": 0, "tags": [], "creator": "age@hobba.nl", "attachment_id": null, "text": "JDK: 1.6.0_07\nBatik: batik-src-09-01-04.zip\n\nWhen you have an animated element and you change e.g. the border colour you get a NullPointerException.\n\nSVG file cut:\n\n<rect x=\"20\" y=\"20\" width=\"100\" height=\"100\" style=\"stroke:#ffffff;stroke-width:1;\" fill=\"blue\" id=\"hlRect\">\n    <animate attributeType=\"CSS\" attributeName=\"opacity\" from=\"1\" to=\"0\" begin=\"0s;blue_fade_in.end\" dur=\"1s\" id=\"blue_fade_out\"/>\n    <animate attributeType=\"CSS\" attributeName=\"opacity\" from=\"0\" to=\"1\" begin=\"blue_fade_out.end\" dur=\"1s\" id=\"blue_fade_in\"/>\n</rect>\n\n\nIn this case it's a simple rect but the same will happen when you animate a group which contains elements on which you perform the action.\nWhen you start the application the animation will run as expected. As soon as you change e.g. the stroke colour with Java you'll get a NPE.\n\nJava code cut:\n\nsvgCanvas.getUpdateManager().getUpdateRunnableQueue().invokeLater(new Runnable() {\n    public void run() {\n        SVGDocument svgDoc = svgCanvas.getSVGDocument();\n        Element hlElement = svgDoc.getElementById(\"hlRect\");\n        ((org.w3c.dom.svg.SVGStylable)hlElement).getStyle().setProperty(\"stroke\", \"deepskyblue\", \"\");\n    }\n});\n\n\nNPE:\n\njava.lang.NullPointerException\n  at org.apache.batik.anim.timing.TimedElement.addInstanceTime(Unknown Source)\n  at org.apache.batik.anim.timing.SyncbaseTimingSpecifier.newInterval(Unknown Source)\n  at org.apache.batik.anim.timing.TimedElement.notifyNewInterval(Unknown Source)\n  at org.apache.batik.anim.timing.TimedElement.selectNewInterval(Unknown Source)\n  at org.apache.batik.anim.timing.TimedElement.sampleAt(Unknown Source)\n  at org.apache.batik.anim.timing.TimedDocumentRoot.seekTo(Unknown Source)\n  at org.apache.batik.anim.AnimationEngine.tick(Unknown Source)\n  at org.apache.batik.bridge.SVGAnimationEngine.access$600(Unknown Source)\n  at org.apache.batik.bridge.SVGAnimationEngine$AnimationTickRunnable.run(Unknown Source)\n  at org.apache.batik.util.RunnableQueue.run(Unknown Source)\n  at java.lang.Thread.run(Thread.java:619)\n\n\nThis NPE will be displayed repeatedly.\nLet me know if you need any more info.", "id": 124429, "time": "2009-01-28T06:35:10Z", "bug_id": 46618, "creation_time": "2009-01-28T06:35:10Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 46618, "attachment_id": null, "id": 124583, "time": "2009-02-02T03:08:41Z", "creator": "age@hobba.nl", "creation_time": "2009-02-02T03:08:41Z", "is_private": false, "text": "With the latest nightly (batik-src-09-01-28.zip) I get the same result.\n\nAfter some additional testing I came to the conclusion that I included the wrong svg code in the bug report. The issue is caused because of the use of the 'use' element when placed in a 'g' element, referencing the group in the 'use' element.\n\nRevised code:\n<g id=\"hlGroup\">\n<rect x=\"20\" y=\"20\" width=\"100\" height=\"100\"\nstyle=\"stroke:#ffffff;stroke-width:1;\" fill=\"blue\" id=\"hlRect\">\n    <animate attributeType=\"CSS\" attributeName=\"opacity\" from=\"1\" to=\"0\"\nbegin=\"0s;blue_fade_in.end\" dur=\"1s\" id=\"blue_fade_out\"/>\n    <animate attributeType=\"CSS\" attributeName=\"opacity\" from=\"0\" to=\"1\"\nbegin=\"blue_fade_out.end\" dur=\"1s\" id=\"blue_fade_in\"/>\n</rect>\n</g>\n<use xlink:href=\"#hlGroup\" transform=\"translate(0,120)\" />\n\nPlacing the group in the a 'defs' element makes no difference.\n\nWhen you refence the 'rect' element in the 'use' element directly instead of the group, the error does not occur. Though this might just as well be because of, what appears to be, a different bug. When changing the e.g. the stroke colour when refencing the 'rect' element directly, the stroke colour of the 'use' element will not change in the first place."}]
[{"count": 0, "tags": [], "creator": "andy.dowling@framework.ie", "text": "Hi folks,\n\nI've got the nightly build of apache-tomcat, running as a standalone server and \nwith the Apache Server (via AJP13).\n\nFile uploads are OK with the standalone server, but with AJP13, the first call\nto read() on the HttpServletRequest's associated Reader object \n(i.e. in order to get the file upload info) will cause the servlet to block.\n\nNote 1: this problem can be replicated on Tomcat 4.0.4 beta 2\nNote 2: I couldn't replicate this problem with Tomcat 3.2.1.\n\nSample code is attached.\n\nAny help would be appreciated!\n\nCheers,\n\nAndy\n\n--------BEGIN HTML FILE-------\n<html>\n  <head>\n   <title>Upload File</title>\n  </head>\n  <body vlink=\"red\" alink=\"green\" link=\"blue\" bgcolor=\"white\">\n    <p>Select the file you wish to upload using the \"browse\" button below, and \nclick Go!</p>\n\n    <form method=\"POST\" enctype=\"multipart/form-data\" \n          action=\"http://my_server.com/servlet/ExampleFileUpload\">\n      <center>\n        <input type=\"FILE\" name=\"upload\"/><br/>\n        <input type=\"SUBMIT\" value=\"Go!\"/><br/>\n      </center>\n    </form>\n</html>\n--------END HTML FILE--------\n\n--------BEGIN SERVLET SOURCE-------\nimport javax.servlet.*;\nimport javax.servlet.http.*;\nimport java.io.*;\n\npublic class ExampleFileUpload extends HttpServlet\n{\n   public void doPost (HttpServletRequest  request,\n                       HttpServletResponse response) throws IOException,\n                                                             ServletException\n   {\n      if (!request.getContentType().startsWith(\"multipart/form-data\")) \n         throw new ServletException (\"Expecting multipart/form-data\");\n\n      //\n      // Now let's read the file upload\n      //\n      BufferedReader in = new BufferedReader(request.getReader());\n\n      //---------------------\n      //- START HERE!\n      //---------------------\n      System.err.println (\"About to make the first call to readLine()...\");\n      String boundary = in.readLine();\n      System.err.println (\"Got the MIME boundary line: |\" + boundary + \"|\");\n      //---------------------\n      //- END HERE!\n      //---------------------\n\n      //\n      // Any remaining code won't execute due to the blocking call...\n      //\n   }\n }\n--------END SERVLET SOURCE--------", "id": 12805, "time": "2002-04-04T18:01:54Z", "bug_id": 7747, "creation_time": "2002-04-04T18:01:54Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "Could you try again with a newer release using the JK 2 connector on the Java\nside, and reopen the bug if this has not been fixed ?", "id": 35790, "time": "2003-04-22T14:22:21Z", "bug_id": 7747, "creation_time": "2003-04-22T14:22:21Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "andy.dowling@framework.ie", "attachment_id": null, "text": "JK2 addressed this issue some time ago, I should have closed the bug back then -\n apologies!\n\nAndy", "id": 35791, "time": "2003-04-22T14:30:04Z", "bug_id": 7747, "creation_time": "2003-04-22T14:30:04Z", "is_private": false}]
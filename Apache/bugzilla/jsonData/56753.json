[{"count": 0, "tags": [], "creator": "petr.sumbera@oracle.com", "is_private": false, "id": 176560, "creation_time": "2014-07-21T10:15:06Z", "time": "2014-07-21T10:15:06Z", "bug_id": 56753, "text": "Created attachment 31837\nPossible fix.\n\nWhen built with Lua 5.2.1:\n\nhttpd: Syntax error on line 129 of /etc/apache2/2.4/httpd.conf: Cannot load libexec/mod_lua.so into server: ld.so.1: httpd: fatal: relocation error: file /usr/apache2/2.4/libexec/mod_lua.so: symbol luaL_openlib: referenced symbol not found\n\nI have attached patch file which seems to fix the issue. The patch is based on bellow info:\n\nhttp://lua-users.org/wiki/CompatibilityWithLuaFive", "attachment_id": 31837}, {"count": 1, "tags": [], "creator": "humbedooh@apache.org", "attachment_id": null, "text": "Hmmmm, I use 5.2.2 in production with mod_lua, and it compiles just fine :)\nCan you check that you don't have a 5.1 installation as well, as that may be messing up the linking. Or it may be that they changed the compatibility in 5.2.2 - I do remember some things being broken in 5.2.1.", "id": 176561, "time": "2014-07-21T10:50:56Z", "bug_id": 56753, "creation_time": "2014-07-21T10:50:56Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 56753, "is_private": false, "id": 176562, "creation_time": "2014-07-21T12:35:40Z", "time": "2014-07-21T12:35:40Z", "creator": "petr.sumbera@oracle.com", "text": "No. There is no Lua 5.1 on build system.\n\nIt compiles just fine. The problem occurs when Apache is started with mod_lua.\n\nI have quickly built Lua 5.2.2. There is the same problem when I built and execute Apache with this Lua version (no change against Lua 5.2.1).\n\nNote that you can see how we build Lua here:\nhttps://hg.java.net/hg/solaris-userland~gate/file/81f9a60cccb1/components/lua", "attachment_id": null}, {"count": 3, "tags": [], "creator": "rainer.jung@kippdata.de", "is_private": false, "id": 176568, "creation_time": "2014-07-21T19:41:56Z", "time": "2014-07-21T19:41:56Z", "bug_id": 56753, "text": "Are you building against a shared lua library, or a static one?\n\nThe symbol for luaL_openlib should be in the library you build against, e.g. this is my output on Solaris when using a shared lua library:\n\n% nm ..../lib/liblua.so | grep luaL_openlib\n[998]   |    110180|     160|FUNC |GLOB |0    |9      |luaL_openlib\n[993]   |    148228|     128|FUNC |GLOB |0    |9      |luaL_openlibs\n\nThe first one is the symbol we are interested in. It is defined in the library (this case lua 5.2.3 but the same is true at least for 5.1.4, 5.2.1 and 5.2.2).\n\nIf you don't know which lua lib is used during runtime, check your LD_LIBRARY_PATH and use \"ldd ..../mod_lua.so\". It is possible, that you are not building against a shared lua lib and instead use static linking, which I do not use.\n\nThe only known problem with that symbol was not during runtime, but during compile time. It is only available in the include files if LUA_COMPAT_MODULE is defined. But our mod_lua.h already defines LUA_COMPAT_ALL, which in turn defines  LUA_COMPAT_MODULE in luaconf.h.\n\nMaybe your mod_lua.so is dynamically linked against liblua, but does not contain an entry for liblua dependency, so that it doesn't load liblua?\n\nWhat does ldd .../mod_lua.so say?\n\nWhat does (assuming Solaris) elfdump -d .../mod_lua.so say?\n\nWhat is the output of\n\nnm mod_lua.so | grep lua | grep -v ap_lua_ | grep -v lua_ap_", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 56753, "attachment_id": null, "is_private": false, "id": 176577, "time": "2014-07-22T08:10:25Z", "creator": "petr.sumbera@oracle.com", "creation_time": "2014-07-22T08:10:25Z", "text": "(In reply to Rainer Jung from comment #3)\n> Are you building against a shared lua library, or a static one?\n\nShared.\n\n> The symbol for luaL_openlib should be in the library you build against, e.g.\n> this is my output on Solaris when using a shared lua library:\n> \n> % nm ..../lib/liblua.so | grep luaL_openlib\n> [998]   |    110180|     160|FUNC |GLOB |0    |9      |luaL_openlib\n> [993]   |    148228|     128|FUNC |GLOB |0    |9      |luaL_openlibs\n\nOn my system (S12 development build) where is 5.2.1 (and tested with 5.2.2 too) I have:\n\nnm /usr/lib/amd64/liblua.so | grep luaL_openlib\n[607]   |              283824|                 190|FUNC |GLOB |0    |18     |luaL_openlibs\n\nWhere on S11 where is still 5.1.4 it's ok:\n\n$ nm /usr/lib/amd64/liblua.so | grep luaL_openlib\n[419]   |              259480|                 926|FUNC |GLOB |0    |16     |luaL_openlib\n[367]   |              319420|                  89|FUNC |GLOB |0    |16     |luaL_openlibs\n\n> The first one is the symbol we are interested in. It is defined in the\n> library (this case lua 5.2.3 but the same is true at least for 5.1.4, 5.2.1\n> and 5.2.2).\n> \n> If you don't know which lua lib is used during runtime, check your\n> LD_LIBRARY_PATH and use \"ldd ..../mod_lua.so\". It is possible, that you are\n> not building against a shared lua lib and instead use static linking, which\n> I do not use.\n> \n> The only known problem with that symbol was not during runtime, but during\n> compile time. It is only available in the include files if LUA_COMPAT_MODULE\n> is defined. But our mod_lua.h already defines LUA_COMPAT_ALL, which in turn\n> defines  LUA_COMPAT_MODULE in luaconf.h.\n\nThere is only onw Lua on system.\n\n> Maybe your mod_lua.so is dynamically linked against liblua, but does not\n> contain an entry for liblua dependency, so that it doesn't load liblua?\n> \n> What does ldd .../mod_lua.so say?\n\n$ ldd /usr/apache2/2.4/libexec/mod_lua.so \n        liblua.so =>     /usr/lib/64/liblua.so\n        libc.so.1 =>     /lib/64/libc.so.1\n        libm.so.2 =>     /lib/64/libm.so.2\n \n> What does (assuming Solaris) elfdump -d .../mod_lua.so say?\n\n$ elfdump -d /usr/apache2/2.4/libexec/mod_lua.so\n\nDynamic Section:  .dynamic\n    index  tag             value  \n      [0]  POSFLAG_1       0x1      [ LAZY ]\n      [1]  NEEDED          0x23be   liblua.so\n      [2]  NEEDED          0x239b   libc.so.1\n      [3]  SONAME          0x1      mod_lua.so\n      [4]  HASH            0x3440   \n      [5]  STRTAB          0x7220   \n      [6]  STRSZ           0x25c8   \n      [7]  SYMTAB          0x5408   \n      [8]  SYMENT          0x18     \n      [9]  SUNW_SYMTAB     0x3e78   \n     [10]  SUNW_SYMSZ      0x33a8   \n     [11]  SUNW_SORTENT    0x4      \n     [12]  SUNW_SYMSORT    0x9aa0   \n     [13]  SUNW_SYMSORTSZ  0x414    \n     [14]  CHECKSUM        0x6446   \n     [15]  VERNEED         0x97e8   \n     [16]  VERNEEDNUM      0x1      \n     [17]  RELACOUNT       0x8b     \n     [18]  PLTRELSZ        0x1a40   \n     [19]  PLTREL          0x7      \n     [20]  JMPREL          0xaf20   \n     [21]  RELA            0x9eb8   \n     [22]  RELASZ          0x2aa8   \n     [23]  RELAENT         0x18     \n     [24]  SYMINFO         0x2f38   \n     [25]  SYMINSZ         0x504    \n     [26]  SYMINENT        0x4      \n     [27]  SUNW_CAP        0x158    \n     [28]  FLAGS           0        0\n     [29]  FLAGS_1         0x100    [ DIRECT ]\n     [30]  SUNW_STRPAD     0x200    \n     [31]  SUNW_LDMACH     0x3e     EM_AMD64\n     [32]  PLTGOT          0x35000  \n  [33-43]  NULL            0       \n\n> What is the output of\n> \n> nm mod_lua.so | grep lua | grep -v ap_lua_ | grep -v lua_ap_\n\n/usr/apache2/2.4/libexec/mod_lua.so:\n[40]\t|               70144|                 657|FUNC |LOCL |0    |18     |cfg_lua_map_handler\n[275]\t|              137408|                  16|FUNC |LOCL |0    |18     |cleanup_lua\n[329]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_addlstring\n[401]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_buffinit\n[540]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_checkany\n[411]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_checkinteger\n[307]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_checklstring\n[425]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_checktype\n[547]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_checkudata\n[356]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_error\n[555]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_gsub\n[504]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_loadbufferx\n[461]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_loadfilex\n[526]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_newmetatable\n[449]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_newstate\n[453]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_openlib\n[447]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_openlibs\n[325]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_optinteger\n[403]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_optlstring\n[533]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_optnumber\n[513]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |luaL_pushresult\n[94]\t|               86784|                  22|FUNC |LOCL |0    |18     |lua_access_checker_harness\n[93]\t|               86752|                  22|FUNC |LOCL |0    |18     |lua_access_checker_harness_first\n[95]\t|               86816|                  22|FUNC |LOCL |0    |18     |lua_access_checker_harness_last\n[32]\t|                   0|                   0|FILE |LOCL |0    |ABS    |lua_apr.c\n[201]\t|              105360|                 207|FUNC |LOCL |0    |18     |lua_apr_b64decode\n[200]\t|              105136|                 215|FUNC |LOCL |0    |18     |lua_apr_b64encode\n[211]\t|              107568|                 128|FUNC |LOCL |0    |18     |lua_apr_date_parse_rfc\n[206]\t|              106320|                 517|FUNC |LOCL |0    |18     |lua_apr_htpassword\n[204]\t|              105888|                 144|FUNC |LOCL |0    |18     |lua_apr_md5\n[208]\t|              107040|                 177|FUNC |LOCL |0    |18     |lua_apr_mkdir\n[209]\t|              107232|                 177|FUNC |LOCL |0    |18     |lua_apr_mkrdir\n[210]\t|              107424|                 136|FUNC |LOCL |0    |18     |lua_apr_rmdir\n[205]\t|              106032|                 276|FUNC |LOCL |0    |18     |lua_apr_sha1\n[207]\t|              106848|                 189|FUNC |LOCL |0    |18     |lua_apr_touch\n[97]\t|               86880|                  22|FUNC |LOCL |0    |18     |lua_auth_checker_harness\n[96]\t|               86848|                  22|FUNC |LOCL |0    |18     |lua_auth_checker_harness_first\n[98]\t|               86912|                  22|FUNC |LOCL |0    |18     |lua_auth_checker_harness_last\n[133]\t|               91408|                1696|FUNC |LOCL |0    |18     |lua_authz_check\n[132]\t|               91104|                 298|FUNC |LOCL |0    |18     |lua_authz_parse\n[135]\t|              221392|                  16|OBJT |LOCL |0    |21     |lua_authz_provider\n[383]\t|              221600|                   8|OBJT |GLOB |0    |22     |lua_authz_providers\n[86]\t|               86528|                  22|FUNC |LOCL |0    |18     |lua_check_user_id_harness\n[549]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_checkstack\n[561]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_close\n[415]\t|              219728|                1200|OBJT |GLOB |0    |20     |lua_commands\n[38]\t|                   0|                   0|FILE |LOCL |0    |ABS    |lua_config.c\n[562]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_createtable\n[384]\t|              146672|                2300|FUNC |GLOB |0    |18     |lua_db_acquire\n[560]\t|              141008|                 161|FUNC |GLOB |0    |18     |lua_db_active\n[483]\t|              140528|                 300|FUNC |GLOB |0    |18     |lua_db_close\n[398]\t|              141488|                 287|FUNC |GLOB |0    |18     |lua_db_escape\n[589]\t|              140832|                 169|FUNC |GLOB |0    |18     |lua_db_gc\n[551]\t|              141776|                1162|FUNC |GLOB |0    |18     |lua_db_get_row\n[296]\t|              145600|                 587|FUNC |GLOB |0    |18     |lua_db_prepare\n[494]\t|              146192|                 467|FUNC |GLOB |0    |18     |lua_db_prepared\n[584]\t|              144688|                 905|FUNC |GLOB |0    |18     |lua_db_prepared_query\n[556]\t|              143536|                1140|FUNC |GLOB |0    |18     |lua_db_prepared_select\n[479]\t|              141184|                 298|FUNC |GLOB |0    |18     |lua_db_query\n[586]\t|              142944|                 592|FUNC |GLOB |0    |18     |lua_db_select\n[281]\t|                   0|                   0|FILE |LOCL |0    |ABS    |lua_dbd.c\n[539]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_dump\n[530]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_error\n[90]\t|               86656|                  22|FUNC |LOCL |0    |18     |lua_fixup_harness\n[249]\t|              118320|                 149|FUNC |LOCL |0    |18     |lua_get_cookie\n[410]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_getfield\n[559]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_getglobal\n[424]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_getinfo\n[558]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_getstack\n[528]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_gettable\n[457]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_gettop\n[72]\t|               74512|                 998|FUNC |LOCL |0    |18     |lua_handler\n[75]\t|               77744|                1031|FUNC |LOCL |0    |18     |lua_input_filter_handle\n[99]\t|               86944|                   6|FUNC |LOCL |0    |18     |lua_insert_filter_harness\n[327]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_isnumber\n[485]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_isstring\n[247]\t|              117056|                 318|FUNC |LOCL |0    |18     |lua_ivm_get\n[591]\t|              221584|                   8|OBJT |GLOB |0    |22     |lua_ivm_mutex\n[248]\t|              117376|                 930|FUNC |LOCL |0    |18     |lua_ivm_set\n[593]\t|              221568|                   8|OBJT |GLOB |0    |22     |lua_ivm_shm\n[293]\t|              221592|                   8|OBJT |GLOB |0    |22     |lua_ivm_shmfile\n[335]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_load\n[100]\t|               86960|                  19|FUNC |LOCL |0    |18     |lua_log_transaction_harness\n[78]\t|               81296|                2576|FUNC |LOCL |0    |18     |lua_map_handler\n[77]\t|               81088|                 193|FUNC |LOCL |0    |18     |lua_map_handler_fixups\n[91]\t|               86688|                  22|FUNC |LOCL |0    |18     |lua_map_to_storage_harness\n[395]\t|              219616|                 104|OBJT |GLOB |0    |20     |lua_module\n[350]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_newthread\n[348]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_newuserdata\n[67]\t|               72976|                  67|FUNC |LOCL |0    |18     |lua_open_callback\n[68]\t|               73056|                  70|FUNC |LOCL |0    |18     |lua_open_hook\n[74]\t|               76432|                1311|FUNC |LOCL |0    |18     |lua_output_filter_handle\n[287]\t|                   0|                   0|FILE |LOCL |0    |ABS    |lua_passwd.c\n[588]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pcallk\n[141]\t|               93808|                 478|FUNC |LOCL |0    |18     |lua_post_config\n[140]\t|               93760|                  34|FUNC |LOCL |0    |18     |lua_pre_config\n[553]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pushboolean\n[497]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pushcclosure\n[330]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pushfstring\n[472]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pushinteger\n[338]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pushlightuserdata\n[432]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pushlstring\n[313]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pushnil\n[469]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pushnumber\n[499]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pushstring\n[587]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_pushvalue\n[101]\t|               86992|                  35|FUNC |LOCL |0    |18     |lua_quick_harness\n[428]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_rawgeti\n[302]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_rawlen\n[545]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_rawset\n[600]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_rawseti\n[144]\t|               94880|                 699|FUNC |LOCL |0    |18     |lua_register_hooks\n[147]\t|                   0|                   0|FILE |LOCL |0    |ABS    |lua_request.c\n[139]\t|               93744|                  16|FUNC |LOCL |0    |18     |lua_request_hook\n[76]\t|               78784|                2304|FUNC |LOCL |0    |18     |lua_request_rec_hook_harness\n[364]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_resume\n[250]\t|              118480|                1540|FUNC |LOCL |0    |18     |lua_set_cookie\n[423]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_setfield\n[569]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_setglobal\n[419]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_setmetatable\n[397]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_settable\n[402]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_settop\n[73]\t|               75520|                 911|FUNC |LOCL |0    |18     |lua_setup_filter_ctx\n[131]\t|              219592|                   8|OBJT |LOCL |0    |20     |lua_ssl_is_https\n[130]\t|              219600|                   8|OBJT |LOCL |0    |20     |lua_ssl_val\n[35]\t|               69264|                 111|FUNC |LOCL |0    |18     |lua_table_get\n[36]\t|              220992|                  48|OBJT |LOCL |0    |21     |lua_table_methods\n[33]\t|               68864|                 391|FUNC |LOCL |0    |18     |lua_table_set\n[521]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_toboolean\n[379]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_tointegerx\n[381]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_tolstring\n[525]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_tonumberx\n[557]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_topointer\n[391]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_touserdata\n[88]\t|               86592|                  22|FUNC |LOCL |0    |18     |lua_translate_name_harness\n[87]\t|               86560|                  22|FUNC |LOCL |0    |18     |lua_translate_name_harness_first\n[89]\t|               86624|                  22|FUNC |LOCL |0    |18     |lua_translate_name_harness_last\n[422]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_type\n[92]\t|               86720|                  22|FUNC |LOCL |0    |18     |lua_type_checker_harness\n[316]\t|                   0|                   0|FUNC |GLOB |0    |UNDEF  |lua_typename\n[274]\t|                   0|                   0|FILE |LOCL |0    |ABS    |lua_vmprep.c\n[255]\t|              125168|                 146|FUNC |LOCL |0    |18     |lua_websocket_close\n[251]\t|              120032|                 717|FUNC |LOCL |0    |18     |lua_websocket_greet\n[252]\t|              120752|                 162|FUNC |LOCL |0    |18     |lua_websocket_peek\n[256]\t|              125328|                 564|FUNC |LOCL |0    |18     |lua_websocket_ping\n[253]\t|              120928|                3628|FUNC |LOCL |0    |18     |lua_websocket_read\n[254]\t|              124560|                 594|FUNC |LOCL |0    |18     |lua_websocket_write\n[63]\t|                   0|                   0|FILE |LOCL |0    |ABS    |mod_lua.c\n[1]\t|                   0|                   0|FILE |LOCL |0    |ABS    |mod_lua.so\n[127]\t|               90336|                 167|FUNC |LOCL |0    |18     |register_lua_codecache\n[126]\t|               90160|                 167|FUNC |LOCL |0    |18     |register_lua_inherit\n[129]\t|               90992|                  36|FUNC |LOCL |0    |18     |register_lua_root\n[128]\t|               90512|                 478|FUNC |LOCL |0    |18     |register_lua_scope\n[65]\t|               72640|                 329|FUNC |LOCL |0    |18     |report_lua_error\n[149]\t|               96848|                 387|FUNC |LOCL |0    |18     |req_aprtable2luatable_cb\n[276]\t|              137424|                  24|FUNC |LOCL |0    |18     |server_cleanup_lua"}, {"attachment_id": null, "tags": [], "creator": "petr.sumbera@oracle.com", "text": "So the problem is that our liblua was build without -DLUA_COMPAT_ALL.", "count": 5, "id": 176579, "time": "2014-07-22T09:09:46Z", "bug_id": 56753, "creation_time": "2014-07-22T09:09:46Z", "is_private": false}, {"count": 6, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "OK, sorry, I should have double checked: I'm also compiling lua itself with the additional define LUA_COMPAT_ALL. It will add the missing symbol to the library. We should probably document that requirement and work on getting rid of the old calls which do not exist by default in lua 5.2, now that 5.2 exists since more than 2 years.\n\nSummary: You need to compile lua itself and also mod_lua with -DLUA_COMPAT_ALL. It might also be possible to only use -DLUA_COMPAT_MODULE but I never tried that.", "id": 176580, "time": "2014-07-22T09:26:02Z", "bug_id": 56753, "creation_time": "2014-07-22T09:26:02Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "petr.sumbera@oracle.com", "attachment_id": null, "text": "Not sure I can add -DLUA_COMPAT_MODULE to our Solaris Lua version we have there for several years now.\n\nAnyway for short term I will need to use the patch I proposed.", "id": 176581, "time": "2014-07-22T09:31:21Z", "bug_id": 56753, "creation_time": "2014-07-22T09:31:21Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 56753, "is_private": false, "text": "I checked again. At least Lua 5.2.3 (and likely also 5.2.2 and 5.2.1) use -DLUA_COMPAT_ALL in their Makefile *by default*:\n\n...\nCC= gcc\nCFLAGS= -O2 -Wall -DLUA_COMPAT_ALL $(SYSCFLAGS) $(MYCFLAGS)\nLDFLAGS= $(SYSLDFLAGS) $(MYLDFLAGS)\nLIBS= -lm $(SYSLIBS) $(MYLIBS)\n...\n\nThey say you have to adopt according to your needs, but by default compatibility is used. So you might have switched to a more non-default build and thus ran into the problem.\n\nRegards,\n\nRainer", "id": 176584, "time": "2014-07-22T10:00:28Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2014-07-22T10:00:28Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "petr.sumbera@oracle.com", "text": "You are right. We are forcing our CLFAGS here:\n\nhttps://hg.java.net/hg/solaris-userland~gate/file/3a68667fe366/components/lua/patches/4.src.Makefile.patch\n\nThanks for looking at it!\n\nAnd anyway can we change this bug to adopt mod_lua to new Lua API? :-)", "count": 9, "id": 176586, "time": "2014-07-22T10:52:22Z", "bug_id": 56753, "creation_time": "2014-07-22T10:52:22Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 56753, "is_private": false, "id": 176587, "creation_time": "2014-07-22T11:51:36Z", "time": "2014-07-22T11:51:36Z", "creator": "rainer.jung@kippdata.de", "text": "All proposed changes are straightforward, except for the handling of\n\nlua_apr.c: luaL_register(L, \"apr_table\", lua_table_methods);\n\nI didn't find any use of \"apr_table\" in code or docs. So we probably replace it by NULL and handle as proposed in the patch.\n\nAnother change would be to switch from lua_objlen to lua_rawlen in lua_request.c and define the latter in terms of the former in mod_lua.h for LUA_VERSION_NUM <= 501.", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 56753, "is_private": false, "id": 199614, "creation_time": "2017-07-06T20:11:41Z", "time": "2017-07-06T20:11:41Z", "creator": "rainer.jung@kippdata.de", "text": "Since r1800835 we no longer need a lua lib build with COMPAT flags. mod_lua should now be compatible with lua 5.1, 5.2 and 5.3.\nThis will be part of version 2.4.27.", "attachment_id": null}]
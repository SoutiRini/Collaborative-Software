[{"count": 0, "tags": [], "bug_id": 40202, "attachment_id": null, "id": 91999, "time": "2006-08-07T13:24:04Z", "creator": "dhartford@ghsinc.com", "creation_time": "2006-08-07T13:24:04Z", "is_private": false, "text": "see http://comments.gmane.org/gmane.comp.jakarta.slide.user/10691\n\nOn a linux box with jpackage install of tomcat 5.5.9, the\n/var/cache/tomcat5/temp directory (the CATALINA_HOME/temp directory) fills up\nwith binary content_NNNN.tmp files.  These are never cleaned up.\n\n/src/share/org/apache/slide/content/NodeRevisionContent.java is where the\ncontent_NNNN.tmp are created, however minor attempts to handle cleanup haven't\nworked out (particularly when examining retry attempts after failed transactions).\n\nThis problem basically doubles the required disk space as all binary objects\nstored in Slide are stored twice, with one being these .tmp files that are not\ncleaned up."}, {"count": 1, "tags": [], "creator": "eulguignol@gmail.com", "attachment_id": null, "text": "The problem is that there is no reference on the temporary file.\n\nTo solve the problem, I made a TempFileInputStream (extending FileInputStream)\nthat delete the file on fileinputStream close method.\n\n\nThe inner class :\n\n    public class TempFileInputStream extends FileInputStream {\n\n    \tprotected File tmpFile = null;\n\n    \tpublic TempFileInputStream (File file) throws FileNotFoundException {\n    \t\tsuper(file);\n    \t\tthis.tmpFile = file;\n    \t}\n    \t\n    \tpublic void close () {\n\t\t\ttry {\n\t\t\t\tsuper.close();\n\t\t\t\ttmpFile.delete();\n\t\t\t} catch (IOException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n  \t\t\n    \t}\n    }\n\nThe modification in NodeRevisionContent\n\n            long length = FileHelper.globalBufferCopy(is, os);\n---            InputStream bis = new BufferedInputStream(new\nFileInputStream(buffer));\n---            setContent(bis);\n+++            setContent(new TempFileInputStream(buffer));", "id": 104038, "time": "2007-06-04T09:26:08Z", "bug_id": 40202, "creation_time": "2007-06-04T09:26:08Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "gjorgji.josifov.for.apache@gmail.com", "attachment_id": null, "id": 166508, "time": "2013-04-10T09:27:12Z", "bug_id": 54823, "creation_time": "2013-04-10T09:27:12Z", "is_private": false, "text": "Hello, devs from Apache POI\nI got this error while parsing Microsoft Word document using Apache Tika parser.\n\norg.apache.tika.exception.TikaException: Error creating OOXML extractor\n    at org.apache.tika.parser.microsoft.ooxml.OOXMLExtractorFactory.parse(OOXMLExtractorFactory.java:125)\n    at org.apache.tika.parser.microsoft.ooxml.OOXMLParser.parse(OOXMLParser.java:82)\n    at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)\n    at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)\n    at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)\n    at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:136)\n    at xxx.yyyy.services.impl.LuceneServiceImpl.fillDocumentFields(LuceneServiceImpl.java:167)\n    at xxx.yyyy.services.impl.LuceneServiceImpl.createLuceneDocumentForFile(LuceneServiceImpl.java:624)\n    at xxx.yyyy.services.impl.LuceneServiceImpl.indexNewFile(LuceneServiceImpl.java:650)\n    at $LuceneService_63044c23b5df.indexNewFile(Unknown Source)\n    at $LuceneService_63044c23b5e0.advised$indexNewFile_63044c23b5fa(Unknown Source)\n    at $LuceneService_63044c23b5e0$Invocation_indexNewFile_63044c23b5f9.proceedToAdvisedMethod(Unknown Source)\n    at org.apache.tapestry5.internal.plastic.AbstractMethodInvocation.proceed(AbstractMethodInvocation.java:84)\n    at xxx.yyyy.services.logging.LoggingAdvice.advise(LoggingAdvice.java:29)\n    at org.apache.tapestry5.internal.plastic.AbstractMethodInvocation.proceed(AbstractMethodInvocation.java:86)\n    at $LuceneService_63044c23b5e0.indexNewFile(Unknown Source)\n    at $LuceneService_63044c23b59b.indexNewFile(Unknown Source)\n    at xxx.yyyy.services.impl.IndexScheduleServiceImpl.executeDocumentActions(IndexScheduleServiceImpl.java:119)\n    at xxx.yyyy.services.impl.IndexScheduleServiceImpl.access$0(IndexScheduleServiceImpl.java:76)\n    at xxx.yyyy.services.impl.IndexScheduleServiceImpl$1.run(IndexScheduleServiceImpl.java:50)\n    at org.apache.tapestry5.ioc.internal.services.cron.PeriodicExecutorImpl$Job.invoke(PeriodicExecutorImpl.java:178)\n    at org.apache.tapestry5.ioc.internal.services.cron.PeriodicExecutorImpl$Job.invoke(PeriodicExecutorImpl.java:48)\n    at org.apache.tapestry5.ioc.internal.services.ParallelExecutorImpl$1.call(ParallelExecutorImpl.java:58)\n    at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:166)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n    at java.lang.Thread.run(Thread.java:722)\nCaused by: org.apache.xmlbeans.impl.values.XmlValueOutOfRangeException: Invalid int value: 4294934530\n    at org.apache.xmlbeans.impl.values.JavaIntHolder.set_text(JavaIntHolder.java:43)\n    at org.apache.xmlbeans.impl.values.XmlObjectBase.update_from_wscanon_text(XmlObjectBase.java:1135)\n    at org.apache.xmlbeans.impl.values.XmlObjectBase.check_dated(XmlObjectBase.java:1274)\n    at org.apache.xmlbeans.impl.values.JavaIntHolder.intValue(JavaIntHolder.java:53)\n    at org.apache.xmlbeans.impl.values.XmlObjectBase.getIntValue(XmlObjectBase.java:1500)\n    at org.openxmlformats.schemas.officeDocument.x2006.extendedProperties.impl.CTPropertiesImpl.getTotalTime(Unknown Source)\n    at org.apache.tika.parser.microsoft.ooxml.MetadataExtractor.extractMetadata(MetadataExtractor.java:123)\n    at org.apache.tika.parser.microsoft.ooxml.MetadataExtractor.extract(MetadataExtractor.java:61)\n    at org.apache.tika.parser.microsoft.ooxml.OOXMLExtractorFactory.parse(OOXMLExtractorFactory.java:115)\n    ... 27 more\n\nSo I investigate the problem and it's seems that line 123 in class org.apache.tika.parser.microsoft.ooxml.MetadataExtractor\n    addProperty(metadata, OfficeOpenXMLExtended.TOTAL_TIME, propsHolder.getTotalTime());\n\nTotal Time is long at runtime and this excepts only int.\nThis bug is not related with Apache Tika, but with this interface\norg.openxmlformats.schemas.officeDocument.x2006.extendedProperties.CTProperties\nwhich is part of poi-ooxml-schemas ver. 3.8 and used by Apache Tika.\nInterface CTProperties defines return type of the method getTotalTime() as int but at runtime is the value is long and it should be changed with long.\nMy workaround copy classes\nMetadataExtractor, OOXMLExtractorFactory and override class OOXMLParser (add method getUnsupportedTypes) and remove parsing of TOTAL_TIME, because I never use this field.\nThis workaround can be applied when you use Apache Tika for parsing .docx documents.\nBest Regards, Gjorgji\np.s I hope I was very detail in my explanation"}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 166512, "time": "2013-04-10T10:05:14Z", "bug_id": 54823, "creation_time": "2013-04-10T10:05:14Z", "is_private": false, "text": "That class is auto-generated by xmlbeans from the official ooxml schema. Can you check the xml schema and see what that defines the type as being? That'll let us know if it's a bug in xmlbeans, or a bug in the published schema files for the file format..."}, {"count": 2, "attachment_id": null, "bug_id": 54823, "text": "Thanks, Nick for point me in right direction\nI found ooxml schema\nhttp://www.schemacentral.com/sc/ooxml/ss.html\nand here is the schema, which include Total Time property\nhttp://www.schemacentral.com/sc/ooxml/s-shared-documentPropertiesExtended.xsd.html\nIt say that Total Time is defined as int.", "id": 166513, "time": "2013-04-10T11:43:26Z", "creator": "gjorgji.josifov.for.apache@gmail.com", "creation_time": "2013-04-10T11:43:26Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 54823, "is_private": false, "id": 166514, "time": "2013-04-10T11:47:07Z", "creator": "apache@gagravarr.org", "creation_time": "2013-04-10T11:47:07Z", "tags": [], "text": "Oh joy, that's a file format bug then...\n\nDo you know what software produced the file, and what said software makes of the value in it's properties display section?"}, {"count": 4, "tags": [], "creator": "gjorgji.josifov.for.apache@gmail.com", "attachment_id": null, "text": "It's Microsoft Word 2007 and the property is Total editing time which is in minutes that is the value that should be parsed.", "id": 166516, "time": "2013-04-10T12:29:37Z", "bug_id": 54823, "creation_time": "2013-04-10T12:29:37Z", "is_private": false}]
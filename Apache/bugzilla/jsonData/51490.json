[{"count": 0, "tags": [], "creator": "charles@everspeech.com", "attachment_id": 27276, "id": 147837, "time": "2011-07-08T18:05:44Z", "bug_id": 51490, "creation_time": "2011-07-08T18:05:44Z", "is_private": false, "text": "Created attachment 27276\nThree versions of the \"if\" example, including a fix.\n\nSee:\n  apache-tomcat-7.0.16/webapps/examples/jsp/tagplugin/if.jsp\n\nSmall things:\n * Has unclosed font tags and hr tags (old HTML)\n * Has doubled font tags: \"<font <font\" (broken)\n * Uses \"</br>\" sometimes (broken) - should be \"<br/>\" always\n\nMedium thing:\n * The content in the following prints even when it's not working!  E.g., if the jstl.jar is not there!\n    <c:if test=\"${2>0}\">\n        It's true that (2>0)!\n    </c:if>\nThe User Agent simply prints the content of the unknown tag.\n\nPlease add after this:\n    <br/>\n    <c:if test=\"${0>2}\">\n\t  If you see this, then (0>2)! Fail!\n    </c:if>\n\n\nMajor things:\n * Must use the old non-XML syntax with .jsp file suffix:\n      <%@ taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\" %>\n * The scope for \"theTruth\" should be \"page\" to avoid testing issues.\n\nIf the taglib line is removed and the following is added to the <html> tag:\n      xmlns:c=\"http://java.sun.com/jsp/jstl/core\"\nthen the example does NOT work, even though it might look like it does!\nIn this case, \"theTruth\" is still set from if.jsp (if scope=\"session\") and the contents of the c:if tag still appear, even with no JSTL processing.\n\nTo use xmlns:c rather than the taglib line, the developer must\n1) Switch to the .jspx file suffix\n2) Use the jsp:root element\n3) Or configure Tomcat to treat .jsp as XML\n\nThe above is not clear, especially when the example appears to work in many cases when it should not.\n\nI have attached:\n1) A fixed if.jsp - please use this.\n2) An if.jspx version - please include this for contrast.\n3) An if-xmlns.jsp version that does NOT work, but appears to work if if.jsp is visited first.  This is to test the example.\n\nThanks!"}, {"count": 1, "tags": [], "text": "A couple of notes:\n\n1. It might be nice to clean-up the sloppy HTML. Patches, even (especially!) for documentation are always appreciated.\n\n2. For your \"medium thing\", you say neither what the output should be nor what the output actually is. Please be absolutely clear when filing a bug report.\n\n3. Failure to use JSTL properly does not constitute a bug in Tomcat. For example, specifying xmlns:c=\"...\" in the <html> element of a .jsp file is not a valid way to reference a taglib and should not be expected to work. Nor is this something that Tomcat can reasonably detect and protect the user against.\n\n4. For the if-xmlns-works-after-if-but-not-before problem, we'll have to look at that.", "is_private": false, "bug_id": 51490, "id": 147839, "time": "2011-07-08T19:51:02Z", "creator": "chris@christopherschultz.net", "creation_time": "2011-07-08T19:51:02Z", "attachment_id": null}, {"count": 2, "text": "Created attachment 27277\nModified example illustrating issues.", "bug_id": 51490, "is_private": false, "id": 147841, "time": "2011-07-08T20:25:21Z", "creator": "charles@everspeech.com", "creation_time": "2011-07-08T20:25:21Z", "tags": [], "attachment_id": 27277}, {"count": 3, "text": "It would be nice if you were providing patches in svn diff (or diff -u) format,\nhttp://tomcat.apache.org/bugreport.html#Patches_and_enhancement_requests\n\nThe source code for the examples in Tomcat 7 is\nhttp://svn.apache.org/repos/asf/tomcat/trunk/webapps/examples/\n\n\n\nI would be -1 for any cleanup for if.jsp, foreach.jsp and choose.jsp.  Those are examples not for the JSTL library but for Tomcat Tag Plugins. That is a different beast.\n\nI suspect that broken HTML code there is intended (to better test this feature), though I am a bit lazy to look up through the history of those files.", "bug_id": 51490, "is_private": false, "id": 147842, "time": "2011-07-08T20:53:56Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-07-08T20:53:56Z", "tags": [], "attachment_id": null}, {"count": 4, "text": "Hi Christopher,\nThanks for looking at this!\n\nFor (1), I hope that the example is updated at some point in the near future.\n\nFor (2):\n===== Begin Original if.jsp output ===\nTag Plugin Examples - <c:if>\n\nPlugin Introductory Notes\nBrief Instructions for Writing Plugins\n\n\nSet the test result to a variable\nThe result of testing for (1==1) is: true\nConditionally execute the body\nIt's true that (2>0)! \n===== End Original if.jsp output ===\n\nNow we look on the web and see that the taglib line can be replaced with an\nxmlns:c attribute: xmlns:c=\"http://java.sun.com/jsp/jstl/core\".\nWe delete the taglib line and add the attribute.\nSee if-bogus.jsp attached (\"Modified example illustrating the issues\").\n\nIf we visit if-bogus.jsp, the output is exactly the same as above!\nIf we restart Tomcat and visit if-bogus.jsp, then the output is exactly the\nsame again!\nIf we refresh the page, we finally get something slightly different\n(the \"true\" disappears, but the \"2>0\" line remains):\n===== Begin if-bogus.jsp output =====\nTag Plugin Examples - <c:if>\n\nPlugin Introductory Notes\nBrief Instructions for Writing Plugins\n\n\nSet the test result to a variable\nThe result of testing for (1==1) is:\nConditionally execute the body\nIt's true that (2>0)! \n===== End if-bogus.jsp output =====\n\nIf we visit if.jsp again, it sets the \"theTruth\" session variable.\nNow if we go back to if-bogus.jsp and refresh, it looks exactly like the\n\"Original if.jsp output\" - it looks like it's working, but it's not.\n\nI sent an updated if.jsp in the first attachment.\nThis fixes HTML issues and makes it clear when things are actually working:\n1) Use scope=\"page\" to avoid side effects from other example pages\n2) Use a c:if that actually depends on JSTL working.\n\nThe output of the updated if.jsp example is exactly the same as before, but\nonly if things are working.\n\nHere is the output from if-xmlns.jsp (same as if-bogus.jsp except based on the\nupdated if.jsp example):\n\n===== Begin if-xmlns.jsp output =====\nTag Plugin Examples - <c:if>\n\nPlugin Introductory Notes>\nBrief Instructions for Writing Plugins\n\n\nSet the test result to a variable\nThe result of testing for (1==1) is:\nConditionally execute the body\nIt's true that (2>0)!\nIf you see this, then (0>2)! Fail! \n===== Begin if-xmlns.jsp output =====\n\nIn the above output, note that\n1) the \"true\" is not there (as expected)\n2) the misleading (2>0) line is still there, but\n3) a new line gets printed indicating that it's not actually working\n\nNew note:\nApparently, a scope=\"session\" variable will be used by a scope=\"page\" variable\nof the same name.\n\nAfter restarting Tomcat, then it's possible to switch between the updated\nif.jsp and if-xmlns.jsp and the output will not change (no side effects, but a\nrestart is required as explained in \"new note\" above).\n\nI agree with your note on (3) regarding failure to use JSTL properly.\nNote that updating the example will help tremendously with (3)!\nCurrently, people look at the web, create something like if-xmlns.jsp, and then\nthink (at first) that it's working.\n\n(4) the if-xmlns-works-after-if-but-not-before problem\nThis is just a scoping issue for \"theTruth\" as pointed out and as corrected in\nthe updated if.jsp example.\n\nI hope that this helps.", "bug_id": 51490, "attachment_id": null, "id": 147843, "time": "2011-07-08T21:00:56Z", "creator": "charles@everspeech.com", "creation_time": "2011-07-08T21:00:56Z", "tags": [], "is_private": false}, {"count": 5, "text": "(In reply to comment #4)\n> ===== Begin if-xmlns.jsp output =====\n> Tag Plugin Examples - <c:if>\n> \n> Plugin Introductory Notes>\n> Brief Instructions for Writing Plugins\n> \n> \n> Set the test result to a variable\n> The result of testing for (1==1) is:\n> Conditionally execute the body\n> It's true that (2>0)!\n> If you see this, then (0>2)! Fail! \n> ===== End if-xmlns.jsp output =====\n\nShould be \"End\" on the line above rather than \"Begin\".\n\n> After restarting Tomcat, then it's possible to switch between the updated\n> if.jsp and if-xmlns.jsp and the output will not change (no side effects, but a\n> restart is required as explained in \"new note\" above).\n\nClarification:\nThe output will not change for the *respective* updated if.jsp and if-xmlns.jsp examples.  This is how it should be if there are no side effects between the two.", "bug_id": 51490, "is_private": false, "id": 147844, "time": "2011-07-08T21:38:06Z", "creator": "charles@everspeech.com", "creation_time": "2011-07-08T21:38:06Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "text": "The issues with the c:if examples have been fixed in trunk and will be included in the next release.\n\nI echo Konstantin's comments that diffs in the correct format are much easier to work with than an entirely new file.", "is_private": false, "bug_id": 51490, "id": 147860, "time": "2011-07-11T09:39:26Z", "creator": "markt@apache.org", "creation_time": "2011-07-11T09:39:26Z", "attachment_id": null}]
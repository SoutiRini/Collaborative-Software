[{"count": 0, "tags": [], "bug_id": 23272, "attachment_id": null, "text": "Hi,\n\nAttaching a bunch of stuff to help reproduce this...\n\nWhen I use ant to run a number of checkouts and build tasks, all is well on\nlinux (as usual), but on windows, the cvs tasks seem to block the operation of\nthe rest of the target.\n\nWhat I mean by that is, when using the ext access method in CVS, with plink as\nthe ssh bridge, with this very simple build.xml (attached as well for easy\ndownloading):\n\n<?xml version=\"1.0\"?>\n<project name=\"Break stuff\" default=\"all\" basedir=\".\">\n  <description>ANT file showing problems with ant/wincvs/plink</description>\n\n  <property environment=\"env\"/>\n\n  <target name=\"all\">\n    <!-- Initialisation = checkout module binaries -->\n    <cvs cvsRoot=\"${env.CVSROOT}\"\n        cvsRsh=\"${env.CVS_RSH}\"\n        package=\"test1\"/>\n    <cvs cvsRoot=\"${env.CVSROOT}\"\n        cvsRsh=\"${env.CVS_RSH}\"\n        package=\"test2\"/>\n  </target>\n\n</project>\n\nI get the following result:\nC:\\java\\build_env>ant -f build_test.xml\nBuildfile: build_test.xml\n\nall:\n      [cvs] cvs server: Updating test1\n      [cvs] U test1/a\n\n\nAnd after several minutes, I kill the ant instance.\n\nRelevant environment variables, for information:\nCVSROOT=:ext:user@server:/path/to/repos\nCVS_RSH=plink\n\nANT_HOME, JAVA_HOME et al are all set to reasonable values.\n\nI am also attaching the tarred up repository I was using. You will see it really\nis just a dummy CVS repository. This script runs as expected (that is, both\ncheckouts proceed to completion, and we get the command line back) on Linux.\nAlso, when run from the command line, the cvs co test1 and tes2 work fine, and\nreturn control to the command line when finished. \n\nI will attach some more verbose output with cvs -t and ant -v in a minute.\n\nThanks,\nDave.", "id": 44342, "time": "2003-09-19T13:39:54Z", "creator": "d.neary@phenix.fr", "creation_time": "2003-09-19T13:39:54Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 23272, "attachment_id": 8290, "text": "Created attachment 8290\nAnt file exhibiting unexpected behaviour", "id": 44343, "time": "2003-09-19T13:41:17Z", "creator": "d.neary@phenix.fr", "creation_time": "2003-09-19T13:41:17Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 23272, "attachment_id": 8291, "text": "Created attachment 8291\nCVS repository used with the test", "id": 44344, "time": "2003-09-19T13:41:48Z", "creator": "d.neary@phenix.fr", "creation_time": "2003-09-19T13:41:48Z", "is_private": false}, {"count": 3, "tags": [], "creator": "d.neary@phenix.fr", "attachment_id": null, "text": "Some additional information: \nant 1.5.3\nWinCVS 1.3.8.1\ncvs 1.10 (bundled with above)\nputty 0.53\n\nAnt output with ant -v and cvs -t:\n\nC:\\java\\build_env>ant -v -f build_test.xml\nApache Ant version 1.5.3 compiled on April 16 2003\nBuildfile: build_test.xml\nDetected Java version: 1.3 in: c:\\java\\jdk1.3\\jre\nDetected OS: Windows 2000\nparsing buildfile build_test.xml with URI = file:C:/java/build_env/build_test.xml\nProject base dir set to: C:\\java\\build_env\n [property] Loading Environment env.\nBuild sequence for target `all' is [all]\nComplete build sequence is [all]\n\nall:\n      [cvs] Executing 'cvs' with arguments:\n      [cvs] '-d:ext:david@uranus:/home/david/cvs'\n      [cvs] '-t'\n      [cvs] 'co'\n      [cvs] 'test1'\n      [cvs]\n      [cvs] The ' characters around the executable and arguments are\n      [cvs] not part of the command.\n      [cvs]\n      [cvs]\n      [cvs] environment:\n<snipping quite a lot of the environment, leaving relevant stuff>\n      [cvs]\n      [cvs]     ANT_CMD_LINE_ARGS=-v -f build_test.xml\n      [cvs]     ANT_HOME=c:\\java\\apache-ant-1.5.3-1\n      [cvs]     CVSROOT=:ext:david@uranus:/home/david/cvs\n      [cvs]     JAVA_HOME=c:\\java\\jdk1.3\n      [cvs]     OS=Windows_NT\n      [cvs]     Os2LibPath=C:\\WINNT\\system32\\os2\\dll;\n      [cvs]     CVS_RSH=plink\n      [cvs]  -> main loop with CVSROOT=:ext:david@uranus:/home/david/cvs\n      [cvs] S-> do_module (test1, Updating, , )\n      [cvs]  -> rename(CVS/Entries.Backup,CVS/Entries)\n      [cvs]  -> unlink(CVS/Entries.Log)\n      [cvs] S-> do_module (test1, Updating, , )\n      [cvs]  -> unlink(CVS/Entries.Static)\n      [cvs] cvs server: Updating test1\n      [cvs] S-> fopen(/home/david/cvs/CVSROOT/history,a)\n      [cvs] S-> unlink_file(./CVS/Entries.Static)\n      [cvs] S-> Reader_Lock(/home/david/cvs/test1)\n      [cvs] S-> Lock_Cleanup()\n      [cvs] S-> rename(CVS/Entries.Backup,CVS/Entries)\n      [cvs] S-> unlink_file(CVS/Entries.Log)\n\nStalls here.\n\nThanks for the help,\nDave.\n", "id": 44345, "time": "2003-09-19T13:50:54Z", "bug_id": 23272, "creation_time": "2003-09-19T13:50:54Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 23272, "text": "\nI have confirmed that this also happens with CVS_RSH=ssh (cygwin port of\nopenssh) as opposed to plink. This implies to me that it is not plink which\ncauses trouble, but cvs or ant.\n\nI will try a similar test on a local repository to see what happens.\n\nDave.", "id": 44348, "time": "2003-09-19T14:24:18Z", "creator": "d.neary@phenix.fr", "creation_time": "2003-09-19T14:24:18Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "\nWith a local CVSROOT, there are no issues.\n\nAttached is a run of ant -f build_test.xml -v with CVSROOT=c:\\java\\cvs. CVS was\nrun with \"cvs -t\".\n\nC:\\java\\build_env>ant -v -f build_test.xml\nApache Ant version 1.5.3 compiled on April 16 2003\nBuildfile: build_test.xml\nDetected Java version: 1.3 in: c:\\java\\jdk1.3\\jre\nDetected OS: Windows 2000\nparsing buildfile build_test.xml with URI = file:C:/java/build_env/build_test.xm\nl\nProject base dir set to: C:\\java\\build_env\n [property] Loading Environment env.\nBuild sequence for target `all' is [all]\nComplete build sequence is [all]\n\nall:\n      [cvs] Executing 'cvs' with arguments:\n      [cvs] '-dc:\\java\\cvs'\n      [cvs] '-t'\n      [cvs] 'co'\n      [cvs] 'test1'\n      [cvs]\n      [cvs] The ' characters around the executable and arguments are\n      [cvs] not part of the command.\n      [cvs]\n      [cvs]\n      [cvs] environment:\n<again, snipped lots of the environment>\n      [cvs]\n      [cvs]     ANT_CMD_LINE_ARGS=-v -f build_test.xml\n      [cvs]     ANT_HOME=c:\\java\\apache-ant-1.5.3-1\n      [cvs]     CVSROOT=c:\\java\\cvs\n      [cvs]     JAVA_HOME=c:\\java\\jdk1.3\n      [cvs]     OS=Windows_NT\n      [cvs]  -> main loop with CVSROOT=c:\\java\\cvs\n      [cvs]  -> do_module (test1, Updating, , )\n      [cvs]  -> Create_Admin (., test1, c:\\java\\cvs/test1, , , 0, 0)\n      [cvs]  -> unlink(./CVS/Tag)\n      [cvs]  <- Create_Admin\n      [cvs]  -> fopen(c:\\java\\cvs/CVSROOT/history,a)\n      [cvs]  -> unlink(./CVS/Entries.Static)\n      [cvs] cvs checkout: Updating test1\n      [cvs]  -> unlink_file_dir(CVS/,,a)\n      [cvs]  -> checkout (c:\\java\\cvs/test1/a,v, 1.1.1.1, , a)\n      [cvs]  -> chmod(a,100666)\n      [cvs] U test1/a\n      [cvs]  -> Register(a, 1.1.1.1, Fri Sep 19 13:24:26 2003, ,  )\n      [cvs]  -> rename(CVS/Entries.Backup,CVS/Entries)\n      [cvs]  -> unlink(CVS/Entries.Log)\n      [cvs] Executing 'cvs' with arguments:\n      [cvs] '-dc:\\java\\cvs'\n      [cvs] '-t'\n      [cvs] 'co'\n      [cvs] 'test2'\n      [cvs]\n      [cvs] The ' characters around the executable and arguments are\n      [cvs] not part of the command.\n      [cvs]\n      [cvs]\n      [cvs] environment:\n      [cvs]\n<and again, lots of snippage>\n      [cvs]     ANT_CMD_LINE_ARGS=-v -f build_test.xml\n      [cvs]     ANT_HOME=c:\\java\\apache-ant-1.5.3-1\n      [cvs]     CVSROOT=c:\\java\\cvs\n      [cvs]     JAVA_HOME=c:\\java\\jdk1.3\n      [cvs]  -> main loop with CVSROOT=c:\\java\\cvs\n      [cvs]  -> do_module (test2, Updating, , )\n      [cvs]  -> Create_Admin (., test2, c:\\java\\cvs/test2, , , 0, 0)\n      [cvs]  -> unlink(./CVS/Tag)\n      [cvs]  <- Create_Admin\n      [cvs]  -> fopen(c:\\java\\cvs/CVSROOT/history,a)\n      [cvs]  -> unlink(./CVS/Entries.Static)\n      [cvs] cvs checkout: Updating test2\n      [cvs]  -> unlink_file_dir(CVS/,,b)\n      [cvs]  -> checkout (c:\\java\\cvs/test2/b,v, 1.1.1.1, , b)\n      [cvs]  -> chmod(b,100666)\n      [cvs]  -> Register(b, 1.1.1.1, Fri Sep 19 13:24:34 2003, ,  )\n      [cvs] U test2/b\n      [cvs]  -> rename(CVS/Entries.Backup,CVS/Entries)\n      [cvs]  -> unlink(CVS/Entries.Log)\n\nBUILD SUCCESSFUL\nTotal time: 6 seconds\n\nI believe this confirms that there is a problem in the CVS clients ssh handling.\n But again, when run from the command line, all works as expected, so perhaps\ncvs is doing what it should, and ant is not correctly interpreting what's\nhappenning? I really don't know enough about it to say.\n\nAny advice is appreciated. If this is definitely a CVS bug, then I will go fight\nwith them :)\n\nDave.", "is_private": false, "bug_id": 23272, "id": 44349, "time": "2003-09-19T14:35:11Z", "creator": "d.neary@phenix.fr", "creation_time": "2003-09-19T14:35:11Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 23272, "attachment_id": null, "id": 44352, "time": "2003-09-19T15:56:03Z", "creator": "d.neary@phenix.fr", "creation_time": "2003-09-19T15:56:03Z", "is_private": false, "text": "\nWith the following combination of programs:\nCygwin ssh\nCygwin cvs\nant 1.5.4\n\nI got the expected result. It seems from this that there is no problem with Ant.\nIn fact, the only thing ant does is call Process.waitFor(), so if that had been\na problem it would have been with the JRE itself. Given that with a particular\nset of external apps this is not a problem, I think that I can assume this is a\nbug in the command line client that comes with WinCVS 1.3.8.1.\n\nI will go hunt over there for more info on the problem from their website, and\nreport this bug there.\n\nSorry to have bothered you all.\n\nDave.\n"}, {"count": 7, "tags": [], "bug_id": 23272, "attachment_id": null, "id": 44571, "time": "2003-09-24T07:48:45Z", "creator": "d.neary@phenix.fr", "creation_time": "2003-09-24T07:48:45Z", "is_private": false, "text": "\nA final note: The problem appears to be a CVS problem, in the end. With WinCVS\n1.3.13.1 (which includes CVSNT), the child ssh process terminates correctly when\nthe cvs process is finished, at least with plink. There still appears to be a\nproblem when using :extssh:, however, which is strange since in theory that just\nuses putty.\n\nCheers,\nDave."}]
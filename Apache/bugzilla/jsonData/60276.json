[{"count": 0, "tags": [], "bug_id": 60276, "is_private": false, "text": "Gzip compress is work when only use apr.But it doesn't work after upgrade Http/2;", "id": 194533, "time": "2016-10-19T06:10:06Z", "creator": "cnsilvan@gmail.com", "creation_time": "2016-10-19T06:10:06Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 60276, "attachment_id": null, "text": "I don't understand, can you explain the issue more thoroughly ?", "id": 194534, "time": "2016-10-19T06:40:28Z", "creator": "remm@apache.org", "creation_time": "2016-10-19T06:40:28Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 60276, "is_private": false, "text": "In server.xml,like this:\n\n<Connector .....\t\t\tcompressableMimeType=\"text/html,text/javascript\"\ncompression=\"on\" \ncompressionMinSize=\"2048\" \nnoCompressionUserAgents=\"gozilla, traviata\"\nport=\"8443\" \nprotocol=\"org.apache.coyote.http11.Http11AprProtocol\"\n......... >\n<UpgradeProtocol className=\"org.apache.coyote.http2.Http2Protocol\"/>\n<SSLHostConfig\n\t........../>\n\t</SSLHostConfig>\n</Connector>\n\nThe compression=\"on\" doesn't work when use this config.\nBut if I remove \"UpgradeProtocol\" element ,it works;\n\n\nSimply put, when using http / 2, the compression function is not available.", "id": 194535, "time": "2016-10-19T07:09:57Z", "creator": "cnsilvan@gmail.com", "creation_time": "2016-10-19T07:09:57Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 60276, "text": "(In reply to Remy Maucherat from comment #1)\n> I don't understand, can you explain the issue more thoroughly ?\n\nIn server.xml,like this:\n\n<Connector .....\t\t\tcompressableMimeType=\"text/html,text/javascript\"\ncompression=\"on\" \ncompressionMinSize=\"2048\" \nnoCompressionUserAgents=\"gozilla, traviata\"\nport=\"8443\" \nprotocol=\"org.apache.coyote.http11.Http11AprProtocol\"\n......... >\n<UpgradeProtocol className=\"org.apache.coyote.http2.Http2Protocol\"/>\n<SSLHostConfig\n\t........../>\n\t</SSLHostConfig>\n</Connector>\n\nThe compression=\"on\" doesn't work when use this config.\nBut if I remove \"UpgradeProtocol\" element ,it works;\n\n\nSimply put, when using http / 2, the compression function is not available.", "count": 3, "id": 194536, "time": "2016-10-19T07:12:41Z", "creator": "cnsilvan@gmail.com", "creation_time": "2016-10-19T07:12:41Z", "is_private": false}, {"count": 4, "tags": [], "creator": "remm@apache.org", "text": "Ok. I would say it is unlikely integrated compression is implemented in HTTP/2 as it was in the HTTP/1.1. We'll see, but it's probably a good idea to plan to migrate to a different solution for compression.\n\nRight now, there's also no provision to pull configuration from the Connector as well, the UpgradeProtocol element is independent.", "id": 194539, "time": "2016-10-19T07:55:00Z", "bug_id": 60276, "creation_time": "2016-10-19T07:55:00Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "cnsilvan@gmail.com", "attachment_id": null, "text": "(In reply to Remy Maucherat from comment #4)\n> Ok. I would say it is unlikely integrated compression is implemented in\n> HTTP/2 as it was in the HTTP/1.1. We'll see, but it's probably a good idea\n> to plan to migrate to a different solution for compression.\n> \n> Right now, there's also no provision to pull configuration from the\n> Connector as well, the UpgradeProtocol element is independent.\n\nNginx can use gzip compression with http/2 module.\nSo I think, tomcat may also support.\uff08sad...\uff09\nMaybe tomcat will support in the future...", "id": 194546, "time": "2016-10-19T09:58:52Z", "bug_id": 60276, "creation_time": "2016-10-19T09:58:52Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "I think that using compression with dynamic data (as in your configuration) is insecure. There are well-known CRIME and BREACH attacks. See\n\nhttps://en.wikipedia.org/wiki/CRIME\n\nTomcat 8.5 and 9 can be configured to serve pre-compressed static files. This is configured with init-param \"precompressed\" of DefaultServlet.\n\nhttp://tomcat.apache.org/tomcat-8.5-doc/default-servlet.html", "count": 6, "id": 194550, "time": "2016-10-19T13:26:02Z", "bug_id": 60276, "creation_time": "2016-10-19T13:26:02Z", "is_private": false}, {"count": 7, "tags": [], "creator": "cnsilvan@gmail.com", "is_private": false, "text": "(In reply to Konstantin Kolinko from comment #6)\n> I think that using compression with dynamic data (as in your configuration)\n> is insecure. There are well-known CRIME and BREACH attacks. See\n> \n> https://en.wikipedia.org/wiki/CRIME\n> \n> Tomcat 8.5 and 9 can be configured to serve pre-compressed static files.\n> This is configured with init-param \"precompressed\" of DefaultServlet.\n> \n> http://tomcat.apache.org/tomcat-8.5-doc/default-servlet.html\n\nthank u!", "id": 194574, "time": "2016-10-20T09:22:43Z", "bug_id": 60276, "creation_time": "2016-10-20T09:22:43Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "equintanilla@bnext.mx", "text": "I had a similar issue, in my case it worked after adding \nuseSendfile=\"false\".", "count": 8, "id": 194883, "time": "2016-11-09T00:50:48Z", "bug_id": 60276, "creation_time": "2016-11-09T00:50:48Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 60276, "is_private": false, "id": 202511, "creation_time": "2017-12-01T12:01:06Z", "time": "2017-12-01T12:01:06Z", "creator": "markt@apache.org", "text": "Fixed in:\n- trunk for 9.0.3 onwards\n- 8.5.x for 8.5.25 onwards", "attachment_id": null}, {"count": 10, "tags": [], "creator": "pc8888@gmail.com", "text": "tomcat 8.5.27, this problem is still not fixed.\n\nRemoved <UpgradeProtocol className=\"org.apache.coyote.http2.Http2Protocol\"/> and gzip works again.\n\n\n<Connector .....\t\t\ncompression=\"on\" \nport=\"443\" \nprotocol=\"org.apache.coyote.http11.Http11AprProtocol\"\n......... >\n<UpgradeProtocol className=\"org.apache.coyote.http2.Http2Protocol\"/>\n<SSLHostConfig\n\t........../>\n\t</SSLHostConfig>\n</Connector>", "id": 203516, "time": "2018-01-27T05:30:50Z", "bug_id": 60276, "creation_time": "2018-01-27T05:30:50Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "Please do not reopen the report. Please post on the user list if you need further assistance.", "id": 203517, "time": "2018-01-27T06:26:55Z", "bug_id": 60276, "creation_time": "2018-01-27T06:26:55Z", "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Hello,\n\nI have found a NULL deferencing bug in mod_proxy_ftp. If there is a malicious remote\nFTP server and someone uses Apache and mod_proxy_ftp to connect to that FTP server,\nthe server can reply to \"LIST\" with a directory listing showing directories or\nordinary files with no spaces whatsoever in the line. There is a strrchr(3) call\nwith\nno check if it returns NULL, and the following code crashes the Apache child\nwhen the\nserver sends back such lines without spaces.\n\nI have only tested this on 2.0.59 and 2.0.55, but other versions including 2.2.3 and\n1.3.37 also have the offending code.\n\nI do not see any security implications to this bug, despite the remote crashing, as\nit only seems possible to use it to crash the Apache child and not the main process,\nno matter what MPM you use.\n\nI have attached a patch against 2.0.59 and two test scripts that exhibit the\nproblem.\nBelow you can find a capture of me showing how to use them.\n\n// Ulf Harnhammar\n   metaur@telia.com\n\n\n\n$ fgrep ftpspecial /etc/services\nftpspecial      1096/tcp\n$ tail /etc/inetd.conf\n\n#:RPC: RPC based services\n\n#:HAM-RADIO: amateur-radio services\n\n#:OTHER: Other services\n#<off># netbios-ssn     stream  tcp     nowait  root    /usr/sbin/tcpd \n/usr/sbin/smbd\n\nftp     stream  tcp     nowait  root  /usr/bin/perl perl /root/apache-crasher.pl\nftpspecial      stream  tcp     nowait  root    /usr/bin/perl perl\n/root/apache-crasher2.pl\n$ netstat -l --inet\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State\ntcp        0      0 *:ftpspecial            *:*                     LISTEN\ntcp        0      0 *:ftp                   *:*                     LISTEN\ntcp        0      0 h3n2fls33o987.teli:smtp *:*                     LISTEN\nudp        0      0 *:bootpc                *:*\n$ fgrep 'Listen' ../conf/httpd.conf\n# Listen: Allows you to bind Apache to specific IP addresses and/or\n# Change this to Listen on specific IP addresses as shown below to\n#Listen 12.34.56.78:80\nListen 1337\n$ nc localhost 1337\nGET ftp://localhost/ HTTP/1.0\n\nHTTP/1.1 200 OK\nDate: Wed, 11 Oct 2006 20:03:44 GMT\nServer: Apache/2.0.59 (Unix)\nContent-Type: text/html\nConnection: close\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\n<html>\n <head>\n  <title>ftp://localhost/</title>\n </head>\n <body>\n  <h2>Directory of <a href=\"/\">ftp://localhost</a>/</h2>\n\n  <hr />\n\n<pre>Anonymous user logged in.\n</pre>\n\n<hr />\n\n<pre>\n$ cat access_log\n$ cat error_log\n[Wed Oct 11 22:02:34 2006] [notice] Apache/2.0.59 (Unix) configured -- resuming\nnormal operations\n[Wed Oct 11 22:03:47 2006] [notice] child pid 10471 exit signal Segmentation\nfault (11)\n$", "attachment_id": null, "bug_id": 40733, "id": 94736, "time": "2006-10-11T13:40:11Z", "creator": "metaur@telia.com", "creation_time": "2006-10-11T13:40:11Z", "is_private": false}, {"count": 1, "tags": [], "creator": "metaur@telia.com", "text": "Created attachment 18992\npatch for this issue against 2.0.59", "id": 94737, "time": "2006-10-11T13:40:53Z", "bug_id": 40733, "creation_time": "2006-10-11T13:40:53Z", "is_private": false, "attachment_id": 18992}, {"count": 2, "tags": [], "text": "Created attachment 18993\ntesting script #1", "attachment_id": 18993, "id": 94738, "creation_time": "2006-10-11T13:41:21Z", "time": "2006-10-11T13:41:21Z", "creator": "metaur@telia.com", "bug_id": 40733, "is_private": false}, {"count": 3, "tags": [], "creator": "metaur@telia.com", "attachment_id": 18994, "id": 94739, "time": "2006-10-11T13:41:43Z", "bug_id": 40733, "creation_time": "2006-10-11T13:41:43Z", "is_private": false, "text": "Created attachment 18994\ntesting script #2"}, {"count": 4, "tags": [], "bug_id": 40733, "attachment_id": null, "text": "I'm changing Version to 2.0-HEAD, so people will realize that the trunk is\naffected as well.\n", "id": 94754, "time": "2006-10-12T01:48:08Z", "creator": "metaur@telia.com", "creation_time": "2006-10-12T01:48:08Z", "is_private": false}, {"count": 5, "tags": [], "creator": "Wolfram.Joost@dak.de", "text": "Created attachment 20524\nDiff against svn, tries to support filename with spaces", "id": 105714, "time": "2007-07-17T05:44:32Z", "bug_id": 40733, "creation_time": "2007-07-17T05:44:32Z", "is_private": false, "attachment_id": 20524}, {"count": 6, "attachment_id": null, "bug_id": 40733, "text": "Patched in /trunk/ - r574100.", "id": 107920, "time": "2007-09-09T16:11:16Z", "creator": "nick@webthing.com", "creation_time": "2007-09-09T16:11:16Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "nick@webthing.com", "text": "Fixed in 2.2 in r574946.", "id": 108071, "time": "2007-09-12T06:31:00Z", "bug_id": 40733, "creation_time": "2007-09-12T06:31:00Z", "is_private": false, "attachment_id": null}]
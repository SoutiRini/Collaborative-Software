[{"count": 0, "tags": [], "creator": "christ@aw.sgi.com", "attachment_id": null, "is_private": false, "id": 28118, "time": "2002-12-20T15:10:35Z", "bug_id": 15571, "creation_time": "2002-12-20T15:10:35Z", "text": "Overview Description:\n\nNo WWW-Authenticate header is returned when access to a URI indicated in \nthe \"Destination:\" header of a request fails authentication.\n\nSteps to Reproduce:\n\n1. Try copying a file from a normal area to a password-protected area without \nsupplying any authentication information (I used http://test.webdav.org/dav as \nmy normal area, and http://test.webdav.org/auth-basic as my password-protected \narea).\n\nNote: \"normal area\" refers to an area not requiring authorization.\n\nActual Results:\n\nThe copy failed and a \"401 Unauthorized\" message was returned from the server.  \nHowever, the \"401 Unauthorized\" message did not contain a \"WWW-Authenticate\" \nheader as the HTTP/1.1 specs mention it should.\n\nExpected Results:\n\nThe copy should fail and a \"401 Unauthorized\" message should be returned from \nthe server containing a \"WWW-Authenticate\" header.  The HTTP/1.1 specs mention \nthat this header *must* be included in a 401 response.\n\nBuild Date & Platform:\n\nApache/2.0.41-dev (Unix) DAV/2 SVN/0.14.2 (dev build)\nThe server is running the mod_dav and mod_dav_fs modules.\n\nAdditional Builds and Platforms:\n\nIt has been mentioned that this problem occurs with Apache 1.3/mod_dav 1.0.\n\nAdditional Information:\n\nThis also occurs on a MOVE (or any request with a \"Destination\" URI requiring \nAuthorization).\n\nFrom the dav-dev mailing list:\n\"...the 401 is being generated in an Apache \"subrequest\", but the WWW-Auth\nheader is not being promoted to the \"real\" request, so it gets lost...\""}, {"count": 1, "tags": [], "bug_id": 15571, "attachment_id": null, "text": "It would certainly be helpful if you could try this with a more recent\nversion of apache.  2.0.41-dev is quite old.", "id": 28238, "time": "2002-12-23T23:23:28Z", "creator": "slive@apache.org", "creation_time": "2002-12-23T23:23:28Z", "is_private": false}, {"count": 2, "tags": [], "creator": "slive@apache.org", "text": "No response from submitter.  Assuming issue is resolved.", "id": 41444, "time": "2003-07-24T18:02:59Z", "bug_id": 15571, "creation_time": "2003-07-24T18:02:59Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 15571, "text": "This is a real bug, there's a fix in the mod_dav 1.0 tree which can be ported over.", "id": 41452, "time": "2003-07-24T18:56:47Z", "creator": "jorton@redhat.com", "creation_time": "2003-07-24T18:56:47Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 15571, "attachment_id": null, "text": "I suspect that the fix below is what is needed.  I haven't found the mod_dav 1.0\nchange yet, but I found this change entry:\n\n\"if a lock fails due to authentication problems, return a 403 (Forbidden) rather\nthan 401 (Unauthorized). this fixes an HTTP conformance issue where we returned\n401 but no WWW-Authenticate response header. (Joe Orton)\"\n\nI'm guessing this is Joe's fix...  patch to 2.0's mod_dav:\n\nIndex: util.c\n===================================================================\nRCS file: /home/cvs/httpd-2.0/modules/dav/main/util.c,v\nretrieving revision 1.48\ndiff -u -r1.48 util.c\n--- util.c      22 Apr 2003 21:52:46 -0000      1.48\n+++ util.c      11 Nov 2003 21:30:58 -0000\n@@ -1212,7 +1212,7 @@\n                                             \"\\\" submitted a locktoken created \"\n                                             \"by user \\\"\",\n                                             lock->auth_user, \"\\\".\", NULL);\n-                        return dav_new_error(p, HTTP_UNAUTHORIZED, 0, errmsg);\n+                        return dav_new_error(p, HTTP_FORBIDDEN, 0, errmsg);\n                     }\n\n                     /*\n", "id": 47226, "time": "2003-11-11T21:35:06Z", "creator": "trawick@apache.org", "creation_time": "2003-11-11T21:35:06Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 15571, "attachment_id": null, "text": "The fix I used was to copy over the www-auth header from the subrequest to the\nmain request, I can dig it out...", "id": 47228, "time": "2003-11-11T21:40:15Z", "creator": "jorton@redhat.com", "creation_time": "2003-11-11T21:40:15Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 15571, "text": "Committed to HEAD, proposed to backport to 2.0:\n\nhttp://cvs.apache.org/viewcvs/httpd-2.0/modules/dav/main/mod_dav.c.diff?r1=1.100&r2=1.101\n\nThanks for the report.", "id": 48729, "time": "2003-12-09T12:44:45Z", "creator": "jorton@redhat.com", "creation_time": "2003-12-09T12:44:45Z", "tags": [], "is_private": false}]
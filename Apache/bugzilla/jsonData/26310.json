[{"count": 0, "tags": [], "creator": "ths@scandihealth.com", "attachment_id": null, "id": 50879, "time": "2004-01-21T14:07:09Z", "bug_id": 26310, "creation_time": "2004-01-21T14:07:09Z", "is_private": false, "text": "When using ant 1.6 and XDoclet 1.2 I get an error when I try to execute the \nsame target twice, within one session.\n\nWhen executing the target twice via the <antcall> target I don't get an error?\n\nTo illustrate I have made the following small buildfile (testbuild.xml):\n\n<project name=\"AntXdocletTest\" default=\"default\">\n    <description>Test ant script to verify xdoclet error.\n    !You must have the XDoclet jars in the ${basedir}/lib directory!\n    </description>\n\n    <path id=\"main.classpath\">\n        <fileset dir=\"${basedir}/lib\">\n            <include name=\"**/*.jar\"/>\n\t</fileset>\n    </path>\n\n    <target name=\"default\">\n\t<taskdef name=\"doclet\"\n        \tclassname=\"xdoclet.DocletTask\"\n\t\tclasspathref=\"main.classpath\"/>\n\t<doclet destDir=\"${basedir}\">\n\t\t<fileset file=\"${basedir}/testbuild.xml\"/>\n\t</doclet>\t\t\n</target>\n\n<target name=\"testAntCall\">\n\t<antcall target=\"default\"/>\n</target>\n</project>\n\n!Please note that you must have the XDoclet jars in the ${basedir}/lib.!\n\nTestrun 1:\n\nC:\\server\\java>ant -f testbuild.xml\nBuildfile: testbuild.xml\n\ndefault:\n\nBUILD SUCCESSFUL\nTotal time: 3 seconds\n\nTestrun 2:\n\nC:\\server\\java>ant -f testbuild.xml default default\nBuildfile: testbuild.xml\n\ndefault:\n\ndefault:\n   [doclet] C:\\server\\java\\testbuild.xml:14: destDir attribute must be present.\n   [doclet]     at xdoclet.DocletTask.validateOptions(DocletTask.java:491)\n   [doclet]     at xjavadoc.ant.XJavadocTask.execute(XJavadocTask.java:94)\n   [doclet]     at org.apache.tools.ant.Task.perform(Task.java:401)\n   [doclet]     at org.apache.tools.ant.Target.execute(Target.java:338)\n   [doclet]     at org.apache.tools.ant.Target.performTasks(Target.java:365)\n   [doclet]     at org.apache.tools.ant.Project.executeTarget(Project.java:1237)\n   [doclet]     at org.apache.tools.ant.Project.executeTargets\n(Project.java:1094)\n   [doclet]     at org.apache.tools.ant.Main.runBuild(Main.java:669)\n   [doclet]     at org.apache.tools.ant.Main.startAnt(Main.java:220)\n   [doclet]     at org.apache.tools.ant.launch.Launcher.run(Launcher.java:215)\n   [doclet]     at org.apache.tools.ant.launch.Launcher.main(Launcher.java:90)\n\nBUILD FAILED\nC:\\server\\java\\testbuild.xml:14: Unexpected error\n\nTotal time: 4 seconds\n\nTestrun 3:\n\nC:\\server\\java>ant -f testbuild.xml default testAntCall\nBuildfile: testbuild.xml\n\ndefault:\n\ntestAntCall:\n\ndefault:\n\nBUILD SUCCESSFUL\nTotal time: 4 seconds\n\nI have not investigated if the \"dependency\" error is general, ie. not just \nrelated to xdoclet?!\n\nMy reason for beliving it to be an Ant bug, opposed to a XDoclet bug, is that I \ncan't reproduce the errors with Ant1.5.2 or Ant1.5.4"}, {"count": 1, "tags": [], "bug_id": 26310, "attachment_id": null, "text": "I can confirm that this is a problem\nhowever for my simple class the problem also exists in ant 1.5.2\nThe class is:\npackage task;\nimport org.apache.tools.ant.Task;\npublic class ShowDestDir extends Task {\n    private String destDir;\n    public void setDestDir(String n) {\n        this.destDir = n;\n    }\n    public void execute() {\n        log(\"destdir is \" + destDir);\n        destDir = null;\n    }\n}\n\nThe build file is:\n<project default=\"go\">\n  <taskdef name=\"showdestdir\" classname=\"task.ShowDestDir\"\n           classpath=\"classes\"/>\n  <target name=\"go\">\n    <showdestdir destdir=\"hello\"/>\n  </target>\n</project>\n\nThe result for 1.6.0 and 1.5.2 is:\nBuildfile: xdoc.xml\n\ngo:\n[showdestdir] destdir is hello\n\ngo:\n[showdestdir] destdir is null\n\n", "id": 50898, "time": "2004-01-21T17:52:37Z", "creator": "peter.reilly@corvil.com", "creation_time": "2004-01-21T17:52:37Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 26310, "attachment_id": null, "text": "In general ant may call the execute() method of ant tasks multiple times.\nIn your build script, the doclet task instance is created on the first\nrun of the default target. In a finally clause of the doclet task,\nthe destDir is set to null - this breaks the undocumented ant task\nlife cycle. So this is a problem with the doclet task (not present\nin xdoclet1.1).\nThe reason you did not see this in ant 1.5 is that there is a typedef\nof doclet just before the use of the doclet. In ant 1.5, this will cause\nthe current task instance to be \"invalidated\" and a new task instance will\nbe created. For some reason (most likely a bug), this does not happen in ant 1.6.\nThe following build script shows the same \"destDir attribute must be present\"\nerror on ant 1.5 and ant 1.6:\n<project name=\"AntXdocletTest\" default=\"default\">\n  <path id=\"main.classpath\">\n    <fileset dir=\"${user.home}/apps/xdoclet-1.2/lib\">\n      <include name=\"**/*.jar\"/>\n\t</fileset>\n  </path>\n  \n  <taskdef name=\"doclet\"\n           classname=\"xdoclet.DocletTask\"\n           classpathref=\"main.classpath\"/>\n\n  <target name=\"default\">\n\t<doclet destDir=\"${basedir}\">\n      <fileset file=\"${basedir}/testbuild.xml\"/>\n\t</doclet>\t\t\n  </target>\n</project>\n\n> ant -f xdoclet.xml default default\nLeaving open while checking the \"invalidate task\" issue.", "id": 52126, "time": "2004-02-11T15:02:42Z", "creator": "peter.reilly@corvil.com", "creation_time": "2004-02-11T15:02:42Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 26310, "attachment_id": null, "text": "It took me some time to track this down.\nIn ant 1.6, classloaders for type/taskdefs are cached, so that\nwith the two doclet taskdefs, the same class is defined for xdoclet.\nThis means that the old taskdef is *not* invalid.\nThis behaviour is correct, but is different behaviour than ant 1.5.\nThe behaviour change exposes the bug in the xdoclet 1.2 task.\nI am going to mark this as invalid.\n", "id": 53315, "time": "2004-03-02T10:17:17Z", "creator": "peter.reilly@corvil.com", "creation_time": "2004-03-02T10:17:17Z", "is_private": false}, {"count": 4, "tags": [], "creator": "mraible@apache.org", "attachment_id": null, "id": 56276, "time": "2004-04-22T20:21:31Z", "bug_id": 26310, "creation_time": "2004-04-22T20:21:31Z", "is_private": false, "text": "I get this everytime I run \"ant clean webloclet\" using ant 1.6.1.  Are you\nsaying this is a bug in xdoclet?  If so, how do I fix it?\n\nThanks,\n\nMatt"}, {"count": 5, "tags": [], "text": "It is a bug in the xdoclet code.\nAt the end of the execute method, it cleans up (nulls)\nsome internal variables. This code also incorrectly nulls the\ndestdir attribute.\n\nAs regards a fix for your build file, it should\nbe possible to write the build file to work around\nthe problem.", "attachment_id": null, "bug_id": 26310, "id": 56294, "time": "2004-04-23T07:43:02Z", "creator": "peter.reilly@corvil.com", "creation_time": "2004-04-23T07:43:02Z", "is_private": false}]
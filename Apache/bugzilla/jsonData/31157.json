[{"count": 0, "tags": [], "bug_id": 31157, "is_private": false, "text": "The context prefix is hard coded in the content pages of the default pub,\nwhich leads to broken links in Jetty.", "id": 63330, "time": "2004-09-10T08:31:16Z", "creator": "roku@apache.org", "creation_time": "2004-09-10T08:31:16Z", "attachment_id": null}, {"text": "This will be hard to fix :(\n\nThe LinkRewritingTransformer matches on the current context prefix. This makes\nit virtually impossible to migrate content from one servlet engine to another.\n\nA possible solution is to exclude the context prefix from links.", "tags": [], "bug_id": 31157, "is_private": false, "count": 1, "id": 63331, "time": "2004-09-10T08:37:40Z", "creator": "andreas@apache.org", "creation_time": "2004-09-10T08:37:40Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 31157, "attachment_id": null, "id": 63342, "time": "2004-09-10T11:30:03Z", "creator": "roku@apache.org", "creation_time": "2004-09-10T11:30:03Z", "is_private": false, "text": "That means the links in the default's pub pages will only work, if one has a\ncontext prefix called \"lenya\". So Jetty users are pissed off. Funny thing that.\nMaybe the LinkRewriting stuff is not working properly?\n\nRun Lenya with Jetty and try some pages in the default pub which have internal\nlinks. None of the links will work."}, {"count": 3, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "is_private": false, "id": 63344, "time": "2004-09-10T11:58:58Z", "bug_id": 31157, "creation_time": "2004-09-10T11:58:58Z", "text": "> That means the links in the default's pub pages will only work,\n> if one has a context prefix called \"lenya\".\n\nExactly.\n\n> Maybe the LinkRewriting stuff is not working properly?\n\nIt depends on how you define \"properly\". With the current implementation, it is\nnot possible to create internal links which are portable from one servlet\ncontext to another (see bug summary).\n\n> Run Lenya with Jetty and try some pages in the default pub\n> which have internal links. None of the links will work.\n\nThis is exactly the symptom of the problem."}, {"count": 4, "tags": [], "bug_id": 31157, "is_private": false, "text": "Shouldn't be fixed in 1.2.1\nbecause of the major impact on the code base.\nUnless someone finds a way to fix them without much\neffort, it is fine with me to defer them to 1.4.", "id": 63717, "time": "2004-09-17T08:58:35Z", "creator": "roku@apache.org", "creation_time": "2004-09-17T08:58:35Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 31157, "attachment_id": null, "id": 65684, "creation_time": "2004-10-26T02:17:41Z", "time": "2004-10-26T02:17:41Z", "creator": "gregor@apache.org", "text": "defered as per discussion", "is_private": false}, {"count": 6, "tags": [], "bug_id": 31157, "attachment_id": null, "id": 71464, "creation_time": "2005-02-24T16:38:48Z", "time": "2005-02-24T16:38:48Z", "creator": "josias.thoeny@wyona.org", "text": "What has to be changed if we want to remove the context prefix from the hrefs?\nHere is what came to my mind:\n- Link lookup in editors does not prepend contextprefix\n- LinkRewritingTransformer recognizes urls without prefix\n- LinkRewritingTransformer prepends prefix to rewritten urls\n- LinkRewriter recognizes urls without prefix\n- Migration of existing documents, e.g. in the default publication\n\nWhat else?", "is_private": false}, {"count": 7, "tags": [], "bug_id": 31157, "attachment_id": null, "id": 71465, "time": "2005-02-24T16:46:03Z", "creator": "andreas@apache.org", "creation_time": "2005-02-24T16:46:03Z", "is_private": false, "text": "At a first glance, that could be sufficient. Should we start a vote about the\nchange?"}, {"count": 8, "tags": [], "bug_id": 31157, "attachment_id": null, "id": 71466, "creation_time": "2005-02-24T16:48:55Z", "time": "2005-02-24T16:48:55Z", "creator": "gregor@apache.org", "text": "(In reply to comment #7)\n> At a first glance, that could be sufficient. Should we start a vote about the\n> change?\n\ni also think that's about it. let's vote on it.", "is_private": false}, {"count": 9, "tags": [], "bug_id": 31157, "attachment_id": null, "id": 71562, "time": "2005-02-26T13:09:43Z", "creator": "michi@apache.org", "creation_time": "2005-02-26T13:09:43Z", "is_private": false, "text": "How does the LinkRewriter recognize internal links? Just by checking if a\nrelative exists within Lenya? What about relative links within another URL Space\nseparated by mod_proxy or something similar?"}, {"count": 10, "tags": [], "bug_id": 31157, "attachment_id": null, "id": 71595, "time": "2005-02-28T09:50:49Z", "creator": "andreas@apache.org", "creation_time": "2005-02-28T09:50:49Z", "is_private": false, "text": "> How does the LinkRewriter recognize internal links?\n\nDocumentBuilder.isDocument(url)\n\n> What about relative links within another URL Space\n> separated by mod_proxy or something similar?\n\nThey are not valid internal links and therefore not rewritten."}, {"text": "Created attachment 14450\nant task to rewrite link prefix\n\nThis is a migration ant task which rewrites all internal links of a\npublication. It's 2 classes and an ant xml, and the idea is to call this task\ndirectly from the shell (not from Lenya) in order to migrate the content, i.e.\nremove the lenya prefix. The xml file contains properties to specify the\nlocation of the publication, the area, the oldPrefix, and the newPrefix.\nInternal links starting with oldPrefix will then be rewritten using newPrefix.\n\nIt's based on the code from the LinkRewriter, and it's written for 1.4-dev, but\nI can port it to 1.2 if requested.\nI didn't know what might be a suitable package/directory structure, feel free\nto change that. I put the classes into o.a.l.util.migration, and the ant file\ninto your_lenya_directory/migration/. (if you change the location of the ant\nfile, please update the basedir variable)\n\nIt uses the link-attribute elements from publication.xconf to recognize links: \n\n<link-attribute xpath=\"//*[namespace-uri() =\n'http://www.w3.org/1999/xhtml']/@href\"/>\n(btw, this is currently missing in the default pub in 1.4)\n\nI didn't test on Windows.", "tags": [], "bug_id": 31157, "is_private": false, "count": 11, "id": 72087, "time": "2005-03-09T22:22:32Z", "creator": "josias.thoeny@wyona.org", "creation_time": "2005-03-09T22:22:32Z", "attachment_id": 14450}, {"count": 12, "tags": [], "bug_id": 31157, "attachment_id": null, "id": 96263, "time": "2006-11-28T05:48:26Z", "creator": "andreas@apache.org", "creation_time": "2006-11-28T05:48:26Z", "is_private": false, "text": "The link syntax has changed in 1.4."}]
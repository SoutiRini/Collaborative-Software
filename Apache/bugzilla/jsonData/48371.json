[{"attachment_id": null, "tags": [], "creator": "java@leeclemens.net", "is_private": false, "count": 0, "id": 132741, "time": "2009-12-10T18:16:34Z", "bug_id": 48371, "creation_time": "2009-12-10T18:16:34Z", "text": "If there is a commented-out <security-constraint> or commented-out <servlet> tag and addWebXmlMappings=\"true\", the JSP's servlet and servlet-mapping tags are placed incorrectly and Tomcat will not start due to \"--\" being inside a comment.\n\nBasically, it seems the web.xml is not parsed correctly when using addWebXmlMappings and you cannot have above tags commented out, or new servlet tags will be placed incorrectly and comment tags not respected."}, {"count": 1, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 133070, "time": "2009-12-22T19:23:15Z", "bug_id": 48371, "creation_time": "2009-12-22T19:23:15Z", "is_private": false, "text": "Can you provide step-by-step instructions, how to reproduce it on a fresh instance of Tomcat?"}, {"count": 2, "tags": [], "bug_id": 48371, "attachment_id": null, "text": "In the webapp's web.xml, have display-name and then description.  Before the listener, include the snippet below(commented out).\n\nRun an ANT script to precompile JSPs:\n\n<import file=\"${tomcat.home}/bin/catalina-tasks.xml\"/>\n<jasper validateXml=\"false\"\n                uriroot=\"${work.core}\"\n                webXmlFragment=\"${jsp.generated.web.xml}\"\n                addWebXmlMappings=\"true\"\n                outputDir=\"${work.src}\"/>\n\nThe resulting web.xml ${jsp.generated.web.xml} is malformed.\n\nHere is the snippet from the web.xml before instructing jasper to addWebXmlMappings.\n\n  <!--\n    <security-constraint>\n        <web-resource-collection>\n            <web-resource-name>Entire Application</web-resource-name>\n            <url-pattern>/*</url-pattern>\n        </web-resource-collection>\n        <user-data-constraint>\n            <transport-guarantee>CONFIDENTIAL</transport-guarantee>\n        </user-data-constraint>\n    </security-constraint>\n    -->\n\n    <!--<security-constraint>\n        <web-resource-collection>\n            <web-resource-name>Deny Direct Access</web-resource-name>\n            <description>Deny direct access to JSPs. All such requests should be\n                handled by the Container in the protection domain\n            </description>\n            <url-pattern>*.jsp</url-pattern>\n        </web-resource-collection>\n        <auth-constraint>\n            <role-name>NoOneCanAccess</role-name>\n        </auth-constraint>\n    </security-constraint>\n    <security-role>\n        <role-name>NoOneCanAccess</role-name>\n    </security-role>-->\n\n\n    <!-- modify in web.xml in tomcat/conf/\n   <servlet>\n       <servlet-name>jsp</servlet-name>\n       <servlet-class>org.apache.jasper.servlet.JspServlet</servlet-class>\n       <init-param>\n           <param-name>fork</param-name>\n           <param-value>false</param-value>\n       </init-param>\n       <init-param>\n           <param-name>xpoweredBy</param-name>\n           <param-value>false</param-value>\n       </init-param>\n       <init-param>\n           <param-name>compilerSourceVM</param-name>\n           <param-value>1.5</param-value>\n       </init-param>\n       <init-param>\n           <param-name>compilerTargetVM</param-name>\n           <param-value>1.5</param-value>\n       </init-param>\n       <load-on-startup>3</load-on-startup>\n   </servlet> -->", "id": 133107, "time": "2009-12-24T09:29:06Z", "creator": "java@leeclemens.net", "creation_time": "2009-12-24T09:29:06Z", "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 48371, "text": "This has been fixed in trunk and proposed for 6.0.x", "id": 134474, "time": "2010-02-13T19:24:11Z", "creator": "markt@apache.org", "creation_time": "2010-02-13T19:24:11Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "is_private": false, "count": 4, "id": 135023, "time": "2010-03-03T17:40:52Z", "bug_id": 48371, "creation_time": "2010-03-03T17:40:52Z", "text": "This has been fixed for 6.0.x and will be included in 6.0.26 onwards."}]
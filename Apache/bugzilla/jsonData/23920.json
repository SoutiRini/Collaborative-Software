[{"count": 0, "tags": [], "bug_id": 23920, "attachment_id": null, "id": 45898, "time": "2003-10-19T15:24:31Z", "creator": "jkf@apache.org", "creation_time": "2003-10-19T15:24:31Z", "is_private": false, "text": "The contains selector test fails on JDK 1.2.2 and IBM JDK 1.4.1 with an\nMalformedInputException,\n\nWhile the testcase uses Binary files,  the ContainsSelector plainly opens the\nfile (also not supporting the setting of the encoding) which leads to this Exception\n\nThe error reported in the test output:\n\nTestcase:\ntestSelectionBehaviour(org.apache.tools.ant.types.selectors.ContainsSelectorTest):\n   Caused an ERROR\nCould not read file asf-logo.gif.bz2\nCould not read file asf-logo.gif.bz2\n        at\norg.apache.tools.ant.types.selectors.ContainsSelector.isSelected(ContainsSelector.java:227)\n        at\norg.apache.tools.ant.types.selectors.BaseSelectorTest.selectionString(BaseSelectorTest.java:176)\n        at\norg.apache.tools.ant.types.selectors.BaseSelectorTest.selectionString(BaseSelectorTest.java:154)\n        at\norg.apache.tools.ant.types.selectors.ContainsSelectorTest.testSelectionBehaviour(ContainsSelectorTest.java:126)\n<truncated>\n\nModifying the source of the contains selector to give more infor on the received\nIO exception gives:\n\n    [junit] sun.io.MalformedInputException\n    [junit]     at sun.io.ByteToCharUTF8.convert(ByteToCharUTF8.java(Compiled Code))\n    [junit]     at\nsun.nio.cs.StreamDecoder$ConverterSD.convertInto(StreamDecoder.java:286)\n    [junit]     at\nsun.nio.cs.StreamDecoder$ConverterSD.implRead(StreamDecoder.java:336)\n    [junit]     at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:222)\n    [junit]     at java.io.InputStreamReader.read(InputStreamReader.java:207)\n    [junit]     at java.io.BufferedReader.fill(BufferedReader.java:152)\n    [junit]     at java.io.BufferedReader.readLine(BufferedReader.java(Compiled\nCode))\n    [junit]     at java.io.BufferedReader.readLine(BufferedReader.java:378)\n    [junit]     at\norg.apache.tools.ant.types.selectors.ContainsSelector.isSelected(ContainsSelector.java:212)\n    [junit]     at\norg.apache.tools.ant.types.selectors.BaseSelectorTest.selectionString(BaseSelectorTest.java:176)\n<truncated>\n\nHow is it meant to work?\nShould the ContainsSelector work on other files than textfiles?\nShouldn't it be possible to set the encoding used in the comparison?\n\nI am willing to look to find an solution, provided the above questions are answered."}, {"count": 1, "tags": [], "bug_id": 23920, "text": "<contains> like any other selector that tries to look into the files may\nbenefit from an encoding attribute, I agree.\n\nAlthough I doubt that you'd find an encoding that would work for arbitrary\nbinary files at all - so maybe the selector should skip the file (and log a\nmessage about being unable to read binary file XYZ?).\n", "id": 46051, "time": "2003-10-22T13:27:48Z", "creator": "bodewig@apache.org", "creation_time": "2003-10-22T13:27:48Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 23920, "text": "Well, as it is hard to validate a file against a certain encoding (being it\ndefault or another, relying on Readers one just gets an IOException on certain\nJDK's), I thought of encoding the string to be sought by the provided encoding\n(default if not provided) and then binary match the file.", "id": 46172, "time": "2003-10-23T19:47:26Z", "creator": "jkf@apache.org", "creation_time": "2003-10-23T19:47:26Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 23920, "text": "\"fixed\" by no longer supporting the JDKs at runtime.", "id": 172080, "time": "2014-01-05T13:00:26Z", "creator": "bodewig@apache.org", "creation_time": "2014-01-05T13:00:26Z", "tags": [], "is_private": false}]
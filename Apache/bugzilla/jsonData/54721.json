[{"count": 0, "tags": [], "text": "Created attachment 30076\nPatch to resolve issue\n\nIf I specify a j.w.Encoder.BinaryStream<T> or j.w.Encoder.TextStream<T> as the encoder for my endpoint, sendObject() never completes. This is because (A) sendObjectByCompletion does not close the OutputStream or Reader (methods that accept closeable resources as arguments should not close those resources; the calling method should) AND (B) onResult is never called on the SendHandler in sendObjectByCompletion for these two cases. Patch attached. Thread dump below.\n\n\"http-nio-8080-exec-10@4030\" daemon prio=5 tid=0x38 nid=NA waiting\n  java.lang.Thread.State: WAITING\n\t  at sun.misc.Unsafe.park(Unsafe.java:-1)\n\t  at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n\t  at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n\t  at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:995)\n\t  at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1302)\n\t  at java.util.concurrent.CountDownLatch.await(CountDownLatch.java:231)\n\t  at org.apache.tomcat.websocket.WsRemoteEndpointImplBase$FutureToSendHandler.get(WsRemoteEndpointImplBase.java:703)\n\t  at org.apache.tomcat.websocket.WsRemoteEndpointImplBase$FutureToSendHandler.get(WsRemoteEndpointImplBase.java:666)\n\t  at org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendObject(WsRemoteEndpointImplBase.java:406)\n\t  at org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendObject(WsRemoteEndpointBasic.java:74)\n\t  at com.wrox.chat.ChatEndpoint.onOpen(ChatEndpoint.java:92)\n\t  at sun.reflect.NativeMethodAccessorImpl.invoke0(NativeMethodAccessorImpl.java:-1)\n\t  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\t  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\t  at java.lang.reflect.Method.invoke(Method.java:487)\n\t  at org.apache.tomcat.websocket.pojo.PojoEndpointBase.doOnOpen(PojoEndpointBase.java:51)\n\t  at org.apache.tomcat.websocket.pojo.PojoEndpointServer.onOpen(PojoEndpointServer.java:69)\n\t  at org.apache.tomcat.websocket.server.WsProtocolHandler.init(WsProtocolHandler.java:109)\n\t  at org.apache.coyote.http11.upgrade.AbstractProcessor.<init>(AbstractProcessor.java:51)\n\t  at org.apache.coyote.http11.upgrade.NioProcessor.<init>(NioProcessor.java:31)\n\t  at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.createUpgradeProcessor(Http11NioProtocol.java:309)\n\t  at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:634)\n\t  at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.process(Http11NioProtocol.java:223)\n\t  at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1581)\n\t  at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1540)\n\t  - locked <0x13a6> (a org.apache.tomcat.util.net.NioChannel)\n\t  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n\t  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n\t  at java.lang.Thread.run(Thread.java:722)", "attachment_id": 30076, "id": 165976, "creation_time": "2013-03-18T22:01:43Z", "time": "2013-03-18T22:01:43Z", "creator": "nicholas@nicholaswilliams.net", "bug_id": 54721, "is_private": false}, {"count": 1, "tags": [], "text": "Many thanks. Patch applied.", "is_private": false, "id": 165994, "creator": "markt@apache.org", "time": "2013-03-19T14:26:57Z", "bug_id": 54721, "creation_time": "2013-03-19T14:26:57Z", "attachment_id": null}]
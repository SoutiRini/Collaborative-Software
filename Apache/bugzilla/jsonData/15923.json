[{"count": 0, "tags": [], "bug_id": 15923, "attachment_id": null, "id": 29071, "time": "2003-01-09T16:19:28Z", "creator": "imacat@mail.imacat.idv.tw", "creation_time": "2003-01-09T16:19:28Z", "is_private": false, "text": "I had built a standard httpd, which includes mod_mime, mod_dir,\nmod_autoindex and mod_negotiation.  Also I was using content negotiation on my\nmulti-lingual website.  But content negotiation failed on the directory index\nwhen it is under some <DirectoryMatch>.\n\n    I tried to build a simpliest environment.  I built Apache as:\n\nimacat@rinse ~ % /usr/sbin/httpd2 -l\nCompiled in modules:\n  core.c\n  worker.c\n  http_core.c\n  mod_mime.c\n  mod_autoindex.c\n  mod_negotiation.c\n  mod_dir.c\nimacat@rinse ~ %\n\n    My document root is:\n\nimacat@rinse ~ % ls /var/tmp/htdocs\nindex.html.en  index.html.zh-tw\nimacat@rinse ~ %\n\n    If my httpd.conf is:\n\nimacat@rinse ~ % cat /etc/apache/httpd2.conf\nUser            nobody\nGroup           nogroup\nDocumentRoot    /var/tmp/htdocs\nPidFile         /var/run/httpd2.pid\nListen          50080\nLogLevel        debug\nErrorLog        /var/log/apache/error_log\nOptions         +MultiViews\nDirectoryIndex  index.html\n\nAddLanguage             en              .en\nAddLanguage             zh-tw           .zh-tw\nLanguagePriority        zh-tw en\nimacat@rinse ~ % /usr/sbin/httpd2 -t -f /etc/apache/httpd2.conf\nSyntax OK\nimacat@rinse ~ %\n\n    Then I can work properly.\n\nimacat@rinse ~ % lynx -dump http://localhost:50080/\n                            Test Page index.html.en\n\n   This is test page index.html.en.\nimacat@rinse ~ % lynx -dump http://localhost:50080/index.html\n                            Test Page index.html.en\n\n   This is test page index.html.en.\nimacat@rinse ~ %\n\n    But if I add an arbitrarily <DirectoryMatch> there:\n\nimacat@rinse ~ % cat /etc/apache/httpd2.conf\nUser            nobody\nGroup           nogroup\nDocumentRoot    /var/tmp/htdocs\nPidFile         /var/run/httpd2.pid\nListen          50080\nLogLevel        debug\nErrorLog        /var/log/apache/error_log\nOptions         +MultiViews\nDirectoryIndex  index.html\n\nAddLanguage             en              .en\nAddLanguage             zh-tw           .zh-tw\nLanguagePriority        zh-tw en\n\n<DirectoryMatch /var/tmp/htdocs>\n</DirectoryMatch>\nimacat@rinse ~ % /usr/sbin/httpd2 -t -f /etc/apache/httpd2.conf\nSyntax OK\nimacat@rinse ~ %\n\n    Then it breaks the content-negotiation on the directory index:\n\nimacat@rinse ~ % lynx -dump http://localhost:50080/\n                                  Index of /\n\n     * [1]index.html.en\n     * [2]index.html.zh-tw\n\nReferences\n\n   1. http://localhost:50080/index.html.en\n   2. http://localhost:50080/index.html.zh-tw\nimacat@rinse ~ % lynx -dump http://localhost:50080/index.html\n                            Test Page index.html.en\n\n   This is test page index.html.en.\nimacat@rinse ~ % cp /var/tmp/htdocs/index.html.en /var/tmp/htdocs/index.html\nimacat@rinse ~ % lynx -dump http://localhost:50080/\n\n                            Test Page index.html.en\n\n   This is test page index.html.en.\nimacat@rinse ~ % \n\n    It breaks if directory index and content negotiation work together\nunder some <DirectoryMatch>.  But they work well seperately.\n\n    My environment is Linux 2.4.20, Debian 3.0r0, gcc 3.2.1, glibc 2.3.1.  But I\nhave also tested it on an Linux 2.4.20, Red Hat 7.3, gcc 3.2.1, glibc 2.2.5;\nLinux 2.4.20, Red Hat 7.3, gcc 2.96, glibc 2.2.5; Linux 2.4.20, Debian 3.0r0,\ngcc 2.95, glibc 2.2.5.  Please tell me if you have any question about the above\nprocedure.\n\n    Please tell me if you need more infomation or help on this problem."}, {"count": 1, "tags": [], "text": "Sorry, the Summary line has a typo.  It should be <DirectoryMatch>, not\n<DirectoryIndex>", "attachment_id": null, "bug_id": 15923, "id": 29072, "time": "2003-01-09T16:26:01Z", "creator": "imacat@mail.imacat.idv.tw", "creation_time": "2003-01-09T16:26:01Z", "is_private": false}, {"count": 2, "tags": [], "text": "This is very likely caused by a known bug in directorymatch processing\nthat will be fixed in the next release.\n\n*** This bug has been marked as a duplicate of 14147 ***", "attachment_id": null, "bug_id": 15923, "id": 29076, "time": "2003-01-09T16:57:44Z", "creator": "slive@apache.org", "creation_time": "2003-01-09T16:57:44Z", "is_private": false}]
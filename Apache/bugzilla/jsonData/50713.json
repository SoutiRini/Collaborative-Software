[{"count": 0, "tags": [], "bug_id": 50713, "attachment_id": 26601, "is_private": false, "id": 143947, "time": "2011-02-03T02:38:46Z", "creator": "mashmk02@gmail.com", "creation_time": "2011-02-03T02:38:46Z", "text": "Created attachment 26601\npatch for context.xml of the Manager application\n\nThe Manager application has the \"roles\" command that list the security role names. But now this command doesn't work correctly.\n\nThe \"roles\" command returns following message:\n FAIL - Cannot resolve user database reference\nAnd gets Exception:\nSEVERE: Manager: java:comp/env/users\njavax.naming.NamingException: Cannot create resource instance\n        at org.apache.naming.factory.ResourceEnvFactory.getObjectInstance(ResourceEnvFactory.java:117)\n        at javax.naming.spi.NamingManager.getObjectInstance(NamingManager.java:304)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:826)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:145)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:814)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:145)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:814)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:159)\n        at org.apache.naming.SelectorContext.lookup(SelectorContext.java:158)\n        at javax.naming.InitialContext.lookup(InitialContext.java:392)\n        at org.apache.catalina.manager.ManagerServlet.roles(ManagerServlet.java:1055)\n        at org.apache.catalina.manager.ManagerServlet.doGet(ManagerServlet.java:366)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:621)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:722)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:306)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:240)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:161)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:589)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:164)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100)\n        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:541)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:382)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:243)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:188)\n        at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:288)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:619)\n\nTomcat 6.x contains same issue.\n\nThe workaround for this issue is to add <ResourceLink> to context.xml of the Manager application.\nAnd I made the patch for this issue.\n\nregards."}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 144153, "time": "2011-02-10T14:06:38Z", "bug_id": 50713, "creation_time": "2011-02-10T14:06:38Z", "is_private": false, "text": "The more I consider this issue, the more I am inclinded to remove the roles command from the manager in Tomcat 7. My reasoning is follows:\n- The manager can be used with any realm\n- Most realms do not expose a role list\n- It is not practical to list all roles for some realms (e.g. JNDI)\n- I don't see what the use case is for this feature"}, {"count": 2, "tags": [], "bug_id": 50713, "attachment_id": null, "id": 144267, "time": "2011-02-14T14:12:59Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-02-14T14:12:59Z", "is_private": false, "text": "The \"Cannot resolve user database reference\" message and the necessity to create a <ResourceLink> are already documented, [1]\n\n[1] http://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html#List_Available_Security_Roles\n\n\nI see nothing to fix here. Though the doc can be improved a bit:\n\n1) This is \"Cannot resolve user database reference\" message, though the solution for it is listed with the \"No user database is available\" message.\n\n2) IIRC, there is no \"<ResourceParams>\" element in modern Tomcat versions.\n\n\nRegardless of that, I agree with Mark that I do not see much reason in keeping this command around. Especially I miss a plausible use case. Maybe it was used for some demos?\n\nNote, that besides this command being present inside manager webapp, there is also RolesTask ANT task."}, {"count": 3, "tags": [], "bug_id": 50713, "attachment_id": null, "is_private": false, "id": 144278, "time": "2011-02-14T20:13:13Z", "creator": "mashmk02@gmail.com", "creation_time": "2011-02-14T20:13:13Z", "text": "Thanks for comments.\n\nI encountered this issue when I used the Tomcat maven plugin's \"tomcat:roles\" command that uses the \"roles\" command of the Manager app.\nThe \"tomcat:roles\" command can display the available security roles. But I can't think of a case where it's necessary.\n\nAnd I have no objection to remove the \"roles\" command.\n\nBest regards."}, {"count": 4, "tags": [], "bug_id": 50713, "attachment_id": null, "text": "The roles command has been removed from Tomcat 7 trunk. This will take affect from 7.0.9 onwards.", "id": 144344, "time": "2011-02-16T08:46:28Z", "creator": "markt@apache.org", "creation_time": "2011-02-16T08:46:28Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 17877, "text": "Using Apache as a reverse proxy with mod_proxy and mod_rewrite, POST requests\nsent using 'Transfer-Encoding: chunked' are rejected by mod_proxy and thus do\nnot make it to the origin server.\n\nThis type of requests is being seen more often as J2ME application using MIDP\nare being rolled out.\n\nIn order to be fully HTTP/1.1 compliant I suppose mod_proxy should accept such\nrequests.", "id": 32953, "time": "2003-03-11T14:32:57Z", "creator": "Mathias.Herberts@iroise.net", "creation_time": "2003-03-11T14:32:57Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 17877, "text": "I seem to be unable to create an attachment for this bug so I include a proposed\npatch as a comment.\n\nThis patch modifies the module behavior so that requests sent using\n'Transfer-Encoding: chunked' are sent as is to the origin server.\n\nThe patch solves my initial problem but is far from having been fully tested,\nplease provide comments about its adequation with mod_proxy HTTP conformance.\n\n---8<------8<------8<------8<------8<------8<------8<------8<------8<---\n--- apache_1.3.27/src/modules/proxy/proxy_http.c.orig\tMon Mar 10 15:36:43 2003\n+++ apache_1.3.27/src/modules/proxy/proxy_http.c\tTue Mar 11 10:56:13 2003\n@@ -404,6 +404,14 @@\n         ap_bvputs(f, reqhdrs_elts[i].key, \": \", reqhdrs_elts[i].val, CRLF, NULL);\n     }\n \n+    /*\n+     * Output a Transfer-Encoding: chunked header if request used it.\n+     */\n+\n+    if (r->read_chunked) {\n+      ap_bvputs(f, \"Transfer-Encoding: chunked\", CRLF, NULL);\n+    }\n+\n     /* the obligatory empty line to mark the end of the headers */\n     ap_bputs(CRLF, f);\n \n--- apache_1.3.27/src/modules/proxy/mod_proxy.c.orig\tMon Mar 10 15:36:48 2003\n+++ apache_1.3.27/src/modules/proxy/mod_proxy.c\tMon Mar 10 15:39:16 2003\n@@ -319,7 +319,7 @@\n                 ap_psprintf(r->pool, \"%ld\", (maxfwd > 0) ? maxfwd - 1 : 0));\n     }\n \n-    if ((rc = ap_setup_client_block(r, REQUEST_CHUNKED_ERROR)))\n+    if ((rc = ap_setup_client_block(r, REQUEST_CHUNKED_PASS)))\n         return rc;\n \n     url = r->filename + 6;\n", "id": 32955, "time": "2003-03-11T14:45:22Z", "creator": "Mathias.Herberts@iroise.net", "creation_time": "2003-03-11T14:45:22Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 17877, "text": "There is some question on whether allowing the proxy to \"pass\" chunked encoding \n(which is a hop-by-hop header??) is RFC compliant. If so, then this will be added in.", "id": 34729, "time": "2003-04-08T15:02:10Z", "creator": "jim@apache.org", "creation_time": "2003-04-08T15:02:10Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "I'm going through the bug db to make sure patches are findable.  Please see \nhttp://httpd.apache.org/dev/patches.html\n", "is_private": false, "id": 47832, "creator": "trawick@apache.org", "time": "2003-11-21T18:11:01Z", "bug_id": 17877, "creation_time": "2003-11-21T18:11:01Z", "attachment_id": null}]
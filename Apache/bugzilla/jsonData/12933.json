[{"count": 0, "tags": [], "bug_id": 12933, "attachment_id": null, "text": "In some cases, the UpdateTraker will update the field primitiveBounds of a \nShapeNode while calculating the dirty regions related to a change in the GVT \ntree.\n\nbelow is an example. the red rectangle should be the bounding box of the <rect \nid=\"r\" > in the file, but is in fact the dirty region resulting of the \nchanging made by the script.\n\nhere is the path I proposed :\n\ncvs diff sources\\org\\apache\\batik\\gvt\\UpdateTracker.java (in directory \nC:\\batik-1.1.1\\xml-batik\\xml-batik\\)\nIndex: sources/org/apache/batik/gvt/UpdateTracker.java\n===================================================================\nRCS file: /home/cvspublic/xml-\nbatik/sources/org/apache/batik/gvt/UpdateTracker.java,v\nretrieving revision 1.13\ndiff -r1.13 UpdateTracker.java\n174c174,179\n<         Rectangle2D r2d = gnce.getFrom();\n---\n>         Rectangle2D r2d = null;\n> \n>         if ( gnce.getFrom() != null ){\n>             r2d = (Rectangle2D)gnce.getFrom().clone();\n>         }\n> \n184c189,192\n<         r2d = gnce.getTo();\n---\n>         if ( gnce.getTo() != null ){\n>             r2d = (Rectangle2D)gnce.getTo().clone();\n>         }\n> \n\nhere is the example :\n\n<?xml version=\"1.0\"?>\n\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG \n20000802//EN\" \"http://www.w3.org/TR/2000/CR-SVG-20000802/DTD/svg-20000802.dtd\" \n>\n<!--  Created by BitFlash Brilliance  -->\n\n<svg width=\"160.0px\"\n    height=\"160.0px\" onload=\"show(evt)\">\n\n<script ><![CDATA[\n    var target;\n    var doc;\n\n  function show(evt){\n    target = evt.target;\n    doc = target.getOwnerDocument();\n    setTimeout('show1()',1000);\n  }\n  function show1(){\n    \n    var c = doc.getElementById(\"c\");\n    var r = doc.getElementById(\"r\");\n    var p = doc.getElementById(\"p\");\n\n    target.insertBefore(p,c);\n    target.insertBefore(r,p);\n\n    var rect = r.getBBox();\n\n    var newRect = doc.createElementNS(\"http://www.w3.org/2000/svg\",\"rect\");\n\n    newRect.setAttributeNS(null,\"x\",rect.getX());\n    newRect.setAttributeNS(null,\"y\",rect.getY());\n    newRect.setAttributeNS(null,\"width\",rect.getWidth());\n    newRect.setAttributeNS(null,\"height\",rect.getHeight());\n\n    newRect.setAttributeNS(null,\"style\",\"fill:none;stroke:red\");\n\n    target.appendChild(newRect);\n  }\n]]></script>\n  <ellipse id=\"c\" fill=\"#ffffff\"\n      rx=\"15.0\"\n      cx=\"34.0\"\n      ry=\"12.0\"\n      cy=\"32.0\"\n      stroke=\"#000000\"/>\n  <rect id=\"r\" x=\"85.0\"\n      y=\"24.0\"\n      fill=\"#ffffff\"\n      width=\"33.0\"\n      height=\"20.0\"\n      stroke=\"#000000\"/>\n  <polygon id=\"p\" fill=\"#ffffff\"\n      stroke-width=\"1.0\"\n      points=\"41,125 63,93 78,128 78,128 63,122 63,122 55,122 \"\n      stroke=\"#000000\"/>\n</svg>", "id": 23267, "time": "2002-09-23T19:54:23Z", "creator": "nicolas.socheleau@bitflash.com", "creation_time": "2002-09-23T19:54:23Z", "is_private": false}, {"count": 1, "tags": [], "creator": "nicolas.socheleau@bitflash.com", "text": "Fixed the UpdateTraker to get a copy of the bounding box of the updated \nelements instead of directly using them.\nsee new revision: 1.14 of org/apache/batik/gvt/UpdateTracker.java", "id": 26588, "time": "2002-11-19T16:55:37Z", "bug_id": 12933, "creation_time": "2002-11-19T16:55:37Z", "is_private": false, "attachment_id": null}]
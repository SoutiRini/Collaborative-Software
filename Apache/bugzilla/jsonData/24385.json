[{"count": 0, "tags": [], "creator": "urs.gloor@bit.admin.ch", "text": "In a combination of tomcat on a linux server and IE or Mozilla on a windows \nclient you get a wrong character conversion. In the following example you call \ntest1.jsp, the parameter value shown in test2.jsp is in UTF-8 instead of ISO-\n8859-1.\n\ntest1.jsp\n-----------------------------------------------------------------\n<%@ page language=\"java\" contentType=\"text/html; charset=ISO-8859-1\" %>\n<jsp:forward page=\"test2.jsp\">\n  <jsp:param name=\"param01\" value='Test Umlaut \u00c4-\u00d6-\u00dc-\u00e4-\u00f6-\u00fc' />\n</jsp:forward>\n-----------------------------------------------------------------\n\ntest2.jsp\n-----------------------------------------------------------------\n<%@ page language=\"java\" contentType=\"text/html; charset=ISO-8859-1\" %>\n<html>\n  <head>\n    <meta content=\"text/html; charset=ISO-8859-1\" http-equiv=\"Content-Type\">\n    <title>Test Umlaut \u00c4-\u00d6-\u00dc-\u00e4-\u00f6-\u00fc</title>\n  </head>\n  <body>\n    <p>Template Text: Test Umlaut \u00c4-\u00d6-\u00dc-\u00e4-\u00f6-\u00fc</p>\n    <p>Text from Parameter: <%= request.getParameter(\"param01\") %></p>\n    <p>Text from Parameter (Workaround): <%= new String(request.getParameter\n(\"param01\").getBytes(\"ISO-8859-1\")) %></p>\n  </body>\n</html>\n-----------------------------------------------------------------\n\nResult\n-----------------------------------------------------------------\nTemplate Text: Test Umlaut \u00c4-\u00d6-\u00dc-\u00e4-\u00f6-\u00fc\nText from Parameter: Test Umlaut \u00c3\u201e-\u00c3\u2013-\u00c3\u0153-\u00c3\u00a4-\u00c3\u00b6-\u00c3\u00bc\nText from Parameter (Workaround): Test Umlaut \u00c4-\u00d6-\u00dc-\u00e4-\u00f6-\u00fc\n-----------------------------------------------------------------\n\nDoesn't occur in template texts or in parameters, which are filled in a HTML \nform.\nDoesn't occur with tomcat on windows server and browser on windows client.", "id": 46750, "time": "2003-11-04T13:36:07Z", "bug_id": 24385, "creation_time": "2003-11-04T13:36:07Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "kin-man.chung@sun.com", "text": "request.getParameter() uses the request encoding when reading the parameters,\nwhile <jsp:param> in 4.1.x encodes the parameter with URLEncoder.encode(String),\nwhich uses the platform default encoding.  If they are different, you'll likely\nget problem like this.\n\nTry setting the request encoding to the platform default encoding by inserting a\n\n\t<% request.setCharacterEncoding(\"ISO-8859-1\"); %>\n\nat the beginning of test1.jsp.  Alternately, you can also use JSTL:\n\n\t<fmt:requestEncoding value=\"ISO-8859-1\"/>\n\nThis bug is unlikely to get fixed for 4.1.x, since the JSP 1.2 spec is unclear\nregarding parameter encodings.  JSP 2.0 specifies that the jsp:param values\nshould be encoded with the request encoding, so Tomcat 5 might work better for\nyou.  Since most browsers do not set request encodings, you are still advised to\nexplictily set it with request.setCharacterEncoding(), but then you can set it\nanything other than the platform default, such as UTF-8.", "id": 46944, "time": "2003-11-06T21:33:41Z", "bug_id": 24385, "creation_time": "2003-11-06T21:33:41Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 24385, "text": "Thank you for your answer. I've tried the first proposion:\n \n<% request.setCharacterEncoding(\"ISO-8859-1\"); %>\ngives strange results, but\n<% request.setCharacterEncoding(\"UTF-8\"); %>\nworks (on the other hand the workaround fails).\n\nResult\n-----------------------------------------------------------------\nTemplate Text: Test Umlaut \u00c4-\u00d6-\u00dc-\u00e4-\u00f6-\u00fc\nText from Parameter: Test Umlaut \u00c4-\u00d6-\u00dc-\u00e4-\u00f6-\u00fc\nText from Parameter (Workaround): Test Umlaut ?-?-?-?-?\n-----------------------------------------------------------------\n\nWithout setCharacterEncoding the system browser/tomcat seems to do the \nconversion ISO-8859-1 to UTF-8 twice in one direction, but only once in the \nother.\nFor me the workaround does the job at the moment - so I wait for Tomcat 5.", "id": 46973, "attachment_id": null, "creator": "urs.gloor@bit.admin.ch", "creation_time": "2003-11-07T09:15:36Z", "time": "2003-11-07T09:15:36Z", "is_private": false}, {"count": 3, "tags": [], "text": "I have tested TC4-Head and TC5-Head on windows and your test case passes.\n\nGiven the lack of clarity in the JSP1.2 spec and that setting the request \nencoding works for you in TC4 I am closing this bug as worksforme. Please re-\nopen it if you find the problem still exists in TC5 on the linux/windows \ncombination. ", "is_private": false, "id": 47064, "creator": "medthomas@ntlworld.com", "time": "2003-11-09T19:33:13Z", "bug_id": 24385, "creation_time": "2003-11-09T19:33:13Z", "attachment_id": null}]
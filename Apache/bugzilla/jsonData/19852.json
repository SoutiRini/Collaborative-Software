[{"count": 0, "tags": [], "bug_id": 19852, "text": "If in a <Context> definition in the server.xml a <Parameter> element is \nspecified this element is only available through the getServletContext\n().getInitParameter() at startup and not after webapp reload. Actually this is \nnot certain. For example, if a file in the WEB-INF/classes directory is \nmodified the Parameter is still available after reload but if WEB-INF/web.xml \nis touched the parameter disappears(becomes null) after reload.\nSo I conclude that reloading is different depending on the two cases.\n\nAfter looking at when ApplicationContext is initialized I have realized that \nwhen web.xml is touched a new ApplicationContext is created(and the init \nparameters are lost) whereas if a file in WEB-INF/classes is touched a new \nApplicationContext is not created so the ApplicationContext.parameters variable \ncreated at startup is still used which explains why they don't disappear.\nThe problem is the case where a new ApplicationContext is created. in \nApplicationContext.mergeParameters the call to context.findApplicationParameters\n() returns a zero length ApplicationParameters[] after reload, so i suppose \nthat the problem is in the StandardContext. Perhaps addApplicationParameters() \nis not called after a reload but only at startup?\nThats all I've found out; hope it helps.\n\n/Mikkel", "id": 37069, "time": "2003-05-12T15:00:29Z", "creator": "mihy@q8.dk", "creation_time": "2003-05-12T15:00:29Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 19852, "text": "Further snooping around in the code has directed me in the direction of the \nContextConfig class. When a lifecycle STOP_EVENT is recieved by ContextConfig \nit removes all ApplicationParameters from the StandardContext. On the other \nhand, when a lifecycle START_EVENT is fired by the StandardContext only the \nParameters from WEB-INF/web.xml and conf/web.xml are added to the \nStandardContext but not server.xml <Parameter> elements. Since this is the way \nContextConfig functions at the present a quick fix would be to remove the call \nin ContextConfig.stop() to context.removeApplicationParameter().\nPerhaps this has side-effects that I am unaware of but it seems to work fine \nhere.\n\n/Mikkel\n", "id": 37193, "time": "2003-05-14T14:13:29Z", "creator": "mihy@q8.dk", "creation_time": "2003-05-14T14:13:29Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 19852, "text": "I've had experience of this on Win2K with versions 4.1.18 and 4.1.27, and on\nLinux with 4.1.18.  Platform->All, OS->All\n\nIt also occurs if the parameter is specified in a context.xml file, rather than\nserver.xml.", "id": 44929, "time": "2003-10-01T08:24:12Z", "creator": "gavin.long@cdl.co.uk", "creation_time": "2003-10-01T08:24:12Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 19852, "text": "Application reloads are notories for causing problems, in Tomcat 4.1.x and\nprobably won't be fixed, does an application stop/start work OK?", "id": 44931, "time": "2003-10-01T08:53:31Z", "creator": "drees76@gmail.com", "creation_time": "2003-10-01T08:53:31Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "gavin.long@cdl.co.uk", "is_private": false, "text": "> does an application stop/start work OK?\n\nNo.  The only way we've found to make the parameter available again is to\nrestart Tomcat itself. ", "id": 44932, "time": "2003-10-01T08:58:30Z", "bug_id": 19852, "creation_time": "2003-10-01T08:58:30Z", "attachment_id": null}, {"text": "I've fixed it by removing the call in  ContextConfig.stop() to \ncontext.removeApplicationParameter(). This works but possibly has some side \neffects. I've been running with this new ContextConfig for the past months \nwhich has solved the problem: presently I can reload the application and still \nhave the parameters specified in the server.xml file available.\n", "tags": [], "creator": "mihy@q8.dk", "attachment_id": null, "count": 5, "id": 44934, "time": "2003-10-01T10:01:18Z", "bug_id": 19852, "creation_time": "2003-10-01T10:01:18Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 19852, "text": "This bug is causing me headaches and chronic disruption on a production server... \nAs mentioned, the only way to get back to normal when it occurs is to restart\nTomcat, which is pretty disruptive.\nI think Mikkel did a very good job on it, and nearly all information is\navailable to fix it, IMHO. What about integrating his change ?\nTIA\n", "id": 45752, "time": "2003-10-15T16:42:05Z", "creator": "didier@dfr.ch", "creation_time": "2003-10-15T16:42:05Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 19852, "text": "AFAIK, this was fixed in the latest build", "id": 51972, "time": "2004-02-09T01:54:04Z", "creator": "funkman@joedog.org", "creation_time": "2004-02-09T01:54:04Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "This is not fixed in the latest CVS version. I'll commit a fix shortly.", "id": 53399, "time": "2004-03-03T21:03:57Z", "bug_id": 19852, "creation_time": "2004-03-03T21:03:57Z", "attachment_id": null}, {"count": 9, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "*** Bug 16373 has been marked as a duplicate of this bug. ***", "id": 53401, "time": "2004-03-03T21:04:24Z", "bug_id": 19852, "creation_time": "2004-03-03T21:04:24Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 19852, "text": "This is now fixed in CVS.", "id": 53403, "time": "2004-03-03T21:51:04Z", "creator": "markt@apache.org", "creation_time": "2004-03-03T21:51:04Z", "is_private": false, "attachment_id": null}]
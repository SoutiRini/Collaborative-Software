[{"count": 0, "tags": [], "bug_id": 56726, "attachment_id": 31815, "id": 176413, "creation_time": "2014-07-16T05:39:32Z", "time": "2014-07-16T05:39:32Z", "creator": "md.nawazish.khan@gmail.com", "text": "Created attachment 31815\nException Stack Trace (FileNotFoundException - Access is denied)\n\nWe are using Tomcat 7.0.52 in the development environment. And for file upload operation I am using Part interface from JEE standard.\n\nPart.write (fileName) still throws \"FileNotFoundException: ... (Access is denied)\". \n\nIt is interesting to note that a similar bug was raised at Bug 54971 and there it has been said that the issue has been resolved with 7.0.41 and onwards releases, however, even with Tomcat 7.0.52 similar problem persists.\n\nI have attached the stack trace of the exception in the attachment.\n\nI eagerly hope and urgent look into it, please. \n\nSincerely,\nNawazish", "is_private": false}, {"count": 1, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "is_private": false, "id": 176420, "time": "2014-07-16T12:32:41Z", "bug_id": 56726, "creation_time": "2014-07-16T12:32:41Z", "text": "Perhaps your access is denied to that file/directory. Bug 54971 seems unrelated unless you think this has something to do with relative versus absolute path specifications.\n\nIf you want any reasonable reply, you need to:\n\na) post your multipart configuration (whether from web.xml or @Annotations)\nb) tell us the effective user under which Tomcat is running\nc) give details about the ownership of the directories mentioned in your error report attachment"}, {"count": 2, "attachment_id": null, "creator": "knst.kolinko@gmail.com", "text": "The Manager web application uses this API and is known to work successfully.\n\nSee the following line in HTMLManagerServlet:\n> warPart.write(file.getAbsolutePath());\n\n\nI think you are doing something wrong. Ask for help on the users mailing list, or provide specific steps (and working example) to reproduce this issue.", "id": 176454, "time": "2014-07-17T11:48:49Z", "bug_id": 56726, "creation_time": "2014-07-17T11:48:49Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 56726, "text": "(In reply to Christopher Schultz from comment #1)\n> Perhaps your access is denied to that file/directory. Bug 54971 seems\n> unrelated unless you think this has something to do with relative versus\n> absolute path specifications.\n> \n> If you want any reasonable reply, you need to:\n> \n> a) post your multipart configuration (whether from web.xml or @Annotations)\n> b) tell us the effective user under which Tomcat is running\n> c) give details about the ownership of the directories mentioned in your\n> error report attachment\n\n@Christopher Schultz\n\nThanks for your note. Following are the details as required:\n\na) We are using Spring's DispatcherServlet as the front-controller to the application so the web.xml looks like this:\n<servlet>\n  <servlet-name>spring</servlet-name>\n\n  <servlet-class>\n     org.springframework.web.servlet.DispatcherServlet\n  </servlet-class>\n\n\t<multipart-config>\n\t\t<max-file-size>10485760</max-file-size>\n\t\t<max-request-size>20971520</max-request-size>\n\t\t<file-size-threshold>5242880</file-size-threshold>\n\t\t</multipart-config>\n\t<load-on-startup>1</load-on-startup>\n</servlet>\n\nb) By \"effective user\" I understand the Operating System. If so, then Tomcat is running on Windows 7. Albeit, Tomcat is launched/handled from Eclipse IDE.\n\nc) The directories are given \"Full Control\".\n\nHope these were useful. Looking forward for your reply.", "id": 176485, "time": "2014-07-18T09:07:44Z", "creator": "md.nawazish.khan@gmail.com", "creation_time": "2014-07-18T09:07:44Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 56726, "text": "(In reply to Christopher Schultz from comment #1)\n> Perhaps your access is denied to that file/directory. Bug 54971 seems\n> unrelated unless you think this has something to do with relative versus\n> absolute path specifications.\n> \n> If you want any reasonable reply, you need to:\n> \n> a) post your multipart configuration (whether from web.xml or @Annotations)\n> b) tell us the effective user under which Tomcat is running\n> c) give details about the ownership of the directories mentioned in your\n> error report attachment\n\n@Christopher Schultz\n\nThanks for your note. Following are the details as required:\n\na) We are using Spring's DispatcherServlet as the front-controller to the application so the web.xml looks like this:\n<servlet>\n  <servlet-name>spring</servlet-name>\n\n  <servlet-class>\n     org.springframework.web.servlet.DispatcherServlet\n  </servlet-class>\n\n\t<multipart-config>\n\t\t<max-file-size>10485760</max-file-size>\n\t\t<max-request-size>20971520</max-request-size>\n\t\t<file-size-threshold>5242880</file-size-threshold>\n\t\t</multipart-config>\n\t<load-on-startup>1</load-on-startup>\n</servlet>\n\nb) By \"effective user\" I understand the Operating System. If so, then Tomcat is running on Windows 7. Albeit, Tomcat is launched/handled from Eclipse IDE.\n\nc) The directories are given \"Full Control\".\n\nHope these were useful. Looking forward for your reply.\n\n(In reply to Konstantin Kolinko from comment #2)\n> The Manager web application uses this API and is known to work successfully.\n> \n> See the following line in HTMLManagerServlet:\n> > warPart.write(file.getAbsolutePath());\n> \n> \n> I think you are doing something wrong. Ask for help on the users mailing\n> list, or provide specific steps (and working example) to reproduce this\n> issue.\n\n@Konstantin Kolinko\n\nBelow I provide the specific steps and working code which is failing to reproduce the issue:\n\n// Step1: Create String representation of directory structure where the uploaded // file would be saved. Get \"real path\" to the appliation.\n// Below, \"authRole\" and \"uid\" are String variables. Their values are captured // from Session object. \"directoryLocation\" returns the String representation\n// of actual location where the file would be uploaded. \nString appPath = request.getServletContext().getRealPath(\"\");\n\n\t\tDate date = new Date();\n\t\tSimpleDateFormat fmt = new SimpleDateFormat(\"yyyy-MM-dd\");\n\t\tString attachmentDate = fmt.format(date).toString();\n\nString directoryLocation = appPath + File.separator + \"attachments\"\n\t\t\t+ File.separator + authRole + File.separator + uid\n\t\t\t\t+ File.separator + attachmentDate;\n\n\t\treturn directoryLocation;\n\t}\n\n//step2: Create directory structure, if one does not exist.\n\tpublic static void saveUploadedFileToDisk(HttpServletRequest request,\n\t\t\tString directoryLocation)\n\t\t\tthrows IOException, ServletException {\n\t\tFile fileObject = new File(directoryLocation);\n\t\tif (!fileObject.exists()) {\n\t\t\tfileObject.mkdirs();\n\t\t}\n\n//step3: Get all the parts from HttpServletRequest and get the name of the \n//uploaded files from each part.\n//step4: \"write\" the part to the pre-created location.\n\n\t\tfor (Part part : request.getParts()) {\n\t\t\tString fileName = getFileName(part);\n\t\t\tif (fileName != null) {\n\t\t\t\tpart.write(directoryLocation + File.separator + fileName);\n\t\t\t}\n\t\t}\n\t}\n}\n\nprivate static String getFileName(Part part) {\n\t\tString headerContent = part.getHeader(\"content-disposition\");\n\t\tString[] s = headerContent.split(\";\");\n\t\tfor (String str : s) {\n\t\t\tif (str.trim().startsWith(\"filename\")) {\n\t\t\t\treturn str.substring(str.indexOf(\"=\") + 2, str.length() - 1);\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\nHope that would be helpful. Let me know for further elaboration.", "id": 176486, "time": "2014-07-18T09:28:29Z", "creator": "md.nawazish.khan@gmail.com", "creation_time": "2014-07-18T09:28:29Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "chris@christopherschultz.net", "is_private": false, "id": 176507, "time": "2014-07-18T17:50:11Z", "bug_id": 56726, "creation_time": "2014-07-18T17:50:11Z", "tags": [], "text": "(In reply to Nawazish from comment #3)\n> b) By \"effective user\" I understand the Operating System. If so, then Tomcat\n> is running on Windows 7. Albeit, Tomcat is launched/handled from Eclipse IDE.\n\nWhich OS user is it? There is no \"Operating System\" user AFAIK.\n\n> c) The directories are given \"Full Control\".\n\nWho which user(s)?\n\n> Below I provide the specific steps and working code which is failing to reproduce the issue:\n\nPlease attach a WAR file and instructions for which requests to make. It's no fun for us to wrap harness code around your stray lines of code and try to make it work."}, {"count": 6, "tags": [], "bug_id": 56726, "is_private": false, "text": "> fileObject.mkdirs();\n\nYou are not checking whether \"mkdirs\" call was successful.\n\n\nAsk on the users mailing list. I see no Tomcat bug here.\n\nBTW, it may be not a good idea to trust user-provided file names like that.", "id": 176711, "time": "2014-07-28T09:26:22Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-07-28T09:26:22Z", "attachment_id": null}]
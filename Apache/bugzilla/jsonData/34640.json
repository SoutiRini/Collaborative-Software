[{"count": 0, "tags": [], "bug_id": 34640, "attachment_id": null, "is_private": false, "id": 74154, "time": "2005-04-27T00:11:41Z", "creator": "tara.talbott@pnl.gov", "creation_time": "2005-04-27T00:11:41Z", "text": "We have noticed that if a collection is created and a resource added to it, \nthen if you copy or move the collection the bindings between it and the child \nare lost (although typically this isn't noticed until the server is restarted \nbecause of caching).  This is because in the clear bindings method of the \nMySqlRDMSAdapter it deletes bindings based on the updated child uris only.  \nAnd on a copy or move the children for the original ObjectNode are passed in. \nIf the method is modified to check the for the parent half of the binding as \nwell as the child in the delete binding statement it seems to fix the problem.\n\nBelow are changes to MySqlRDBMSAdapter which should fix the problem.\n\n~line 219 \n                statement =\n+                    connection.prepareStatement(\n+                        deleteStatement(\"BINDING\",\"c\",\", URI u, URI u2 where \n+u.URI_ID = c.CHILD_UURI_ID and u2.URI_ID = c.URI_ID and u.URI_STRING IN \"\n+                            + bindings + \" and u2.URI_STRING = ?\") );\n-                    connection.prepareStatement(\n-                        deleteStatement(\"BINDING\",\"c\",\", URI u where \n-u.URI_ID = c.CHILD_UURI_ID and u.URI_STRING IN \"\n-                            + bindings ) );\n\n\n~lines 225 - 230\n+               int i = 0;\n+                for (i = 1; iter.hasNext(); i++) {\n-                for (int i = 1; iter.hasNext(); i++) {\n                    String next = iter.next().toString();\n                    statement.setString(i, next);\n                }\n+                statement.setString(i++, uri.toString());"}]
[{"count": 0, "text": "The FirstPassVisitor in org.apache.jasper.compiler.PageDataImpl adds all \nattributes (except \"version\") of jsp:root elements of included JSPs to \njsp:root of expanded XML view. The expanded XML view is thus, often malformed.\n\nAny entity, such as a TagLibraryValidator, that tries to subsequently parse \nthe malformed expanded XML view, fails. For example:\n\nmain.jspx (using Jakarta Taglibs \"standard\" JSTL impl):\n--------------------------------------------------------------\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<jsp:root xmlns:jsp=\"http://java.sun.com/JSP/Page\" \n xmlns:c=\"http://java.sun.com/jsp/jstl/core\" version=\"2.0\" >\n    <jsp:directive.include file=\"one.jspx\"/>\n</jsp:root>\n\nwhere one.jspx is:\n----------------------\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<jsp:root xmlns:jsp=\"http://java.sun.com/JSP/Page\" version=\"2.0\" />\n\ngives:\n<top-of-stack-trace>\norg.apache.jasper.JasperException: <h3>Validation error messages from \nTagLibraryValidator for c</h3><p>null: org.xml.sax.SAXParseException: \nAttribute \"jsp\" bound to namespace \"http://www.w3.org/2000/xmlns/\" was already \nspecified for element \"jsp:root\".</p>\n</top-of-stack-trace>\n\nas, in this scenario, attribute xmlns:jsp gets added twice.\n\n[Problem reported by \"Dino Klein\" <zagzag@speakeasy.net> on taglibs-dev@j.a.o]\n\nI'm proposing a patch that causes FirstPassVisitor to only add those \nattributes to the jsp:root of the expanded XML view that have not been already \nadded.\n\nIndex: PageDataImpl.java\n===================================================================\nRCS file: /usr/local/cvsroot/apache/jakarta-tomcat-5.0.28-src/jakarta-tomcat-\njasper/jasper2/src/share/org/apache/jasper/compiler/PageDataImpl.java,v\nretrieving revision 1.1\ndiff -c -r1.1 PageDataImpl.java\n*** PageDataImpl.java\t7 Jun 2005 02:29:52 -0000\t1.1\n--- PageDataImpl.java\t7 Jun 2005 02:33:19 -0000\n***************\n*** 205,218 ****\n  \t    if (attrs != null) {\n  \t\tint len = attrs.getLength();\n  \t\tfor (int i=0; i<len; i++) {\n! \t\t    if (\"version\".equals(attrs.getQName(i))) {\n  \t\t\tcontinue;\n  \t\t    }\n! \t\t    rootAttrs.addAttribute(attrs.getURI(i),\n  \t\t\t\t\t   attrs.getLocalName(i),\n! \t\t\t\t\t   attrs.getQName(i),\n  \t\t\t\t\t   attrs.getType(i),\n  \t\t\t\t\t   attrs.getValue(i));\n  \t\t}\n  \t    }\n  \t}\n--- 205,221 ----\n  \t    if (attrs != null) {\n  \t\tint len = attrs.getLength();\n  \t\tfor (int i=0; i<len; i++) {\n! \t\t    String qName = attrs.getQName(i);\n! \t\t    if (\"version\".equals(qName)) {\n  \t\t\tcontinue;\n  \t\t    }\n! \t\t    if (rootAttrs.getIndex(qName) == -1) {\n! \t\t    \trootAttrs.addAttribute(attrs.getURI(i),\n  \t\t\t\t\t   attrs.getLocalName(i),\n! \t\t\t\t\t   qName,\n  \t\t\t\t\t   attrs.getType(i),\n  \t\t\t\t\t   attrs.getValue(i));\n+ \t\t    }\n  \t\t}\n  \t    }\n  \t}", "bug_id": 35252, "attachment_id": null, "id": 76123, "time": "2005-06-07T07:36:43Z", "creator": "akolkar@us.ibm.com", "creation_time": "2005-06-07T07:36:43Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "zagzag@speakeasy.net", "attachment_id": null, "text": "This is still a problem with 5.5.12.\nPerhaps the version in this bug should be changed in order to reflect that.", "id": 81185, "time": "2005-10-16T06:58:55Z", "bug_id": 35252, "creation_time": "2005-10-16T06:58:55Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 35252, "text": "Updated versions (which by the way anyone can do), will fix right now.", "id": 81186, "time": "2005-10-16T07:04:07Z", "creator": "yoavs@computer.org", "creation_time": "2005-10-16T07:04:07Z", "is_private": false, "attachment_id": null}, {"text": "Fixed.", "tags": [], "bug_id": 35252, "is_private": false, "count": 3, "id": 81187, "time": "2005-10-16T07:20:42Z", "creator": "yoavs@computer.org", "creation_time": "2005-10-16T07:20:42Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 35252, "attachment_id": null, "id": 85136, "time": "2006-01-27T21:49:34Z", "creator": "nnemer@ieee.org", "creation_time": "2006-01-27T21:49:34Z", "is_private": false, "text": "is this really fixed?  i have tomcat 5.5.15 and get the exact same error:  \norg.apache.jasper.JasperException: Error on line 1 of document  : Attribute\n\"star\" bound to namespace \"http://www.w3.org/2000/xmlns/\" was already specified\nfor element \"star:content-block\". Nested exception: Attribute \"star\" bound to\nnamespace \"http://www.w3.org/2000/xmlns/\" was already specified for element\n\"star:content-block\".\n\nthanks.\nnn"}, {"count": 5, "tags": [], "creator": "fabio.grassi@ggsinformatica.it", "attachment_id": null, "is_private": false, "id": 88558, "time": "2006-04-27T14:21:16Z", "bug_id": 35252, "creation_time": "2006-04-27T14:21:16Z", "text": "It looks fixed in 5.5.16. Is it really? Should the bug be closed?\nFabio."}, {"count": 6, "text": "The duplicate has more info on how to reproduce.\n\n*** This bug has been marked as a duplicate of 39557 ***", "bug_id": 35252, "is_private": false, "id": 94357, "time": "2006-10-01T20:46:00Z", "creator": "markt@apache.org", "creation_time": "2006-10-01T20:46:00Z", "tags": [], "attachment_id": null}]
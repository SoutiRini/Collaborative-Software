[{"text": "Note: my version of 1.6 includes the fix to Bug #40681 (which is also checked\ninto SVN and part of 1.7). It may be that this bug was created/relvealed by the\npatch that was applied to fix Bug #40681.\n\nMy Swing GUI locked up. CTRL-\\ revealed a deadlock between the Swing thread and\nthe Batik updater thread:\n\nSwing thread:\n\n     [java] \"AWT-EventQueue-0\" prio=1 tid=0x083fec88 nid=0x79da waiting for\nmonitor entry [0x5cf64000..0x5cf65020]\n     [java]     at org.apache.batik.bridge.UpdateManager.interrupt(Unknown Source)\n     [java]     - waiting to lock <0x630f6c00> (a\norg.apache.batik.util.RunnableQueue)\n     [java]     - locked <0x630f9470> (a org.apache.batik.bridge.UpdateManager)\n     [java]     at\norg.apache.batik.swing.svg.JSVGComponent.stopProcessing(Unknown Source)\n     [java]     at\ncom.awarix.trak.client.svg.SVGLoadManager$1.run(SVGLoadManager.java:328)\n     [java]     at java.awt.event.InvocationEvent.dispatch(InvocationEvent.java:209)\n     [java]     at java.awt.EventQueue.dispatchEvent(EventQueue.java:461)\n     [java]     at\njava.awt.EventDispatchThread.pumpOneEventForHierarchy(EventDispatchThread.java:242)\n     [java]     at\njava.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:163)\n     [java]     at\njava.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:157)\n     [java]     at\njava.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:149)\n     [java]     at java.awt.EventDispatchThread.run(EventDispatchThread.java:110)\n\nBatik update manager thread:\n\n     [java] \"RunnableQueue-2\" daemon prio=1 tid=0x5bda1810 nid=0x7a88 in\nObject.wait() [0x5d47f000..0x5d480120]\n     [java]     at java.lang.Object.wait(Native Method)\n     [java]     - waiting on <0x61a2a490> (a java.awt.EventQueue$1AWTInvocationLock)\n     [java]     at java.lang.Object.wait(Object.java:474)\n     [java]     at java.awt.EventQueue.invokeAndWait(EventQueue.java:846)\n     [java]     - locked <0x61a2a490> (a java.awt.EventQueue$1AWTInvocationLock)\n     [java]     at\norg.apache.batik.swing.svg.JSVGComponent$SVGListener.updateCompleted(Unknown Source)\n     [java]     at org.apache.batik.bridge.UpdateManager$9.dispatch(Unknown Source)\n     [java]     at org.apache.batik.util.EventDispatcher.dispatchEvent(Unknown\nSource)\n     [java]     at org.apache.batik.util.EventDispatcher.fireEvent(Unknown Source)\n     [java]     at org.apache.batik.bridge.UpdateManager.fireEvent(Unknown Source)\n     [java]     at org.apache.batik.bridge.UpdateManager.updateRendering(Unknown\nSource)\n     [java]     at org.apache.batik.bridge.UpdateManager.repaint(Unknown Source)\n     [java]     at\norg.apache.batik.bridge.UpdateManager$UpdateManagerRunHander.runnableInvoked(Unknown\nSource)\n     [java]     at org.apache.batik.util.RunnableQueue.runnableInvoked(Unknown\nSource)\n     [java]     - locked <0x630f6c00> (a org.apache.batik.util.RunnableQueue)\n     [java]     at org.apache.batik.util.RunnableQueue.run(Unknown Source)\n     [java]     at java.lang.Thread.run(Thread.java:595)\n\nMy code looks like this:\n\n      SwingUtilities.invokeLater(new Runnable() {\n          public void run() {\n              canvas.stopProcessing();\n              canvas.dispose();\n          }\n      });\n\nThe root of the problem seems to be that\nJSVGComponent$SVGListener.updateCompleted() is calling invokeAndWait() instead\nof invokeLater().\n\nNot sure why this is necessary, but it in effect means that no code that runs in\nthe swing thread can ever try to lock the runnable queue or risk a deadlock!\n\nIf that's really the intent, then this needs to be documented. Otherwise, the\ncode needs to be changed to allow locking the runnable queue from within the\nSwing thread.", "tags": [], "bug_id": 42268, "is_private": false, "count": 0, "id": 102517, "time": "2007-04-26T11:36:10Z", "creator": "archie@dellroad.org", "creation_time": "2007-04-26T11:36:10Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 42268, "is_private": false, "id": 102518, "creation_time": "2007-04-26T12:16:17Z", "time": "2007-04-26T12:16:17Z", "creator": "archie@dellroad.org", "text": "Created attachment 20054\nPatch to fix this bug\n\nPerhaps it would be best to revert the patch applied for Bug #40681 and instead\nsolve that problem in another way that doesn't require locking the\nRunnableQueue. The attached patch should do the trick.", "attachment_id": 20054}]
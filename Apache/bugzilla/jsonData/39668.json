[{"count": 0, "tags": [], "bug_id": 39668, "is_private": false, "text": "Apache httpd 2.2.2 build against local openssl lib does not use that lib for all\ncomponents.  The httpd binary uses the system default, but mod_ssl.so uses the\nlocal version of openssl.\n\nOn use, the Server header states that openssl is version 0.9.7.a (system wide\ndefault), but was compiled w/0.9.8.a in /usr/local/openssl.  Further\ninvestigation shows that httpd is linked against system openssl, but mod_ssl.so\nis linked against local install.\n\n$ ldd /usr/local/apache/bin/httpd\n        /etc/libcwait.so => /etc/libcwait.so (0x00a1f000)\n        libm.so.6 => /lib/tls/libm.so.6 (0x00df4000)\n        libaprutil-1.so.0 => /usr/local/apache/lib/libaprutil-1.so.0 (0x00e7e000)\n        libldap.so.2 => /usr/lib/libldap.so.2 (0x00a7e000)\n        liblber.so.2 => /usr/lib/liblber.so.2 (0x00b3e000)\n        libexpat.so.0 => /usr/lib/libexpat.so.0 (0x00d4d000)\n        libapr-1.so.0 => /usr/local/apache/lib/libapr-1.so.0 (0x007ca000)\n        libuuid.so.1 => /lib/libuuid.so.1 (0x00c3b000)\n        librt.so.1 => /lib/tls/librt.so.1 (0x009e5000)\n        libcrypt.so.1 => /lib/libcrypt.so.1 (0x005d9000)\n        libpthread.so.0 => /lib/tls/libpthread.so.0 (0x00ad7000)\n        libdl.so.2 => /lib/libdl.so.2 (0x00a3c000)\n        libc.so.6 => /lib/tls/libc.so.6 (0x00625000)\n        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x0030a000)\n        libsasl.so.7 => /usr/lib/libsasl.so.7 (0x0015c000)\n        libssl.so.4 => /lib/libssl.so.4 (0x00111000)\n        libcrypto.so.4 => /lib/libcrypto.so.4 (0x00168000)\n        libgdbm.so.2 => /usr/lib/libgdbm.so.2 (0x00145000)\n        libpam.so.0 => /lib/libpam.so.0 (0x008a2000)\n        libresolv.so.2 => /lib/libresolv.so.2 (0x00259000)\n        libgssapi_krb5.so.2 => /usr/kerberos/lib/libgssapi_krb5.so.2 (0x009bf000)\n        libkrb5.so.3 => /usr/kerberos/lib/libkrb5.so.3 (0x00355000)\n        libcom_err.so.3 => /usr/kerberos/lib/libcom_err.so.3 (0x0091e000)\n        libk5crypto.so.3 => /usr/kerberos/lib/libk5crypto.so.3 (0x00cae000)\n        libz.so.1 => /usr/lib/libz.so.1 (0x0014c000)\n        liblaus.so.1 => /lib/liblaus.so.1 (0x005d6000)\n\n$ ldd /usr/local/apache/modules/mod_ssl.so\n        /etc/libcwait.so => /etc/libcwait.so (0x00ee5000)\n        libssl.so.0.9.8 => /usr/local/openssl/lib/libssl.so.0.9.8 (0x002ae000)\n        libcrypto.so.0.9.8 => /usr/local/openssl/lib/libcrypto.so.0.9.8 (0x0014a000)\n        libgssapi_krb5.so.2 => /usr/kerberos/lib/libgssapi_krb5.so.2 (0x004a7000)\n        libkrb5.so.3 => /usr/kerberos/lib/libkrb5.so.3 (0x002e8000)\n        libcom_err.so.3 => /usr/kerberos/lib/libcom_err.so.3 (0x0057c000)\n        libk5crypto.so.3 => /usr/kerberos/lib/libk5crypto.so.3 (0x00de6000)\n        libresolv.so.2 => /lib/libresolv.so.2 (0x00be0000)\n        libdl.so.2 => /lib/libdl.so.2 (0x00ebb000)\n        libz.so.1 => /usr/lib/libz.so.1 (0x00c97000)\n        libpthread.so.0 => /lib/tls/libpthread.so.0 (0x00d6a000)\n        libc.so.6 => /lib/tls/libc.so.6 (0x0070d000)\n        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x009d9000)\n\n\n\nI have build apache 2.2.2 as follows on RedHat AS3 (x86):\n\nVersions:\ngcc (GCC) 3.2.3 20030502 (Red Hat Linux 3.2.3-42)\nGNU Make version 3.79.1, by Richard Stallman and Roland McGrath.\nGNU ld version 2.14.90.0.4 20030523\n\n\nPREFIX=/usr/local/apache\nSSL_DIR=/apps/local/openssl\nLDAP_DIR=/apps/local/openldap\nexport CFLAGS=\"-O2\"\nexport LDFLAGS=\"-L$SSL_DIR/lib -L$LDAP_DIR/lib\"\nexport CPPFLAGS=\"-I$SSL_DIR/include -I$LDAP_DIR/include\"\nexport LD_LIBRARY_PATH=\"$SSL_DIR/lib:$LDAP_DIR/lib:$LD_LIBRARY_PATH\"\n\n./configure \\\n  --with-ldap-include=$LDAP_DIR/include \\\n  --with-ldap-lib=$LDAP_DIR/lib \\\n  --with-ldap \\\n  --with-ssl=$SSL_DIR \\\n  --with-mpm=worker \\\n  --enable-mods-shared=all \\\n  --enable-ssl=shared \\\n  --enable-proxy=shared \\\n  --enable-proxy_balancer=shared \\\n  --enable-proxy_ajp=shared \\\n  --enable-proxy_ftp=shared \\\n  --enable-proxy_http=shared \\\n  --enable-authnz-ldap=shared \\\n  --enable-ldap \\\n  --prefix=$PREFIX\n\nmake && make install\n\n\n\nStartup with:\n\nexport\nLD_LIBRARY_PATH=\"/usr/local/openssl/lib:/usr/local/openldap/lib:/usr/local/sasl2/lib:/usr/local/libxml/lib:$LD_LIBRARY_PATH\"\nexport SASL_PATH=\"/usr/local/sasl2/lib/sasl2\"\n\n\nWhat am I missing here?  Is this a bug?\n\n-B", "id": 89528, "time": "2006-05-26T19:35:44Z", "creator": "brectanu@gmail.com", "creation_time": "2006-05-26T19:35:44Z", "attachment_id": null}, {"text": "One inconsistency: in the description of your build process, you set SSL_DIR to /apps/local/openssl. \nYet, your mod_ssl gets linked to /usr/local/openssl, and your httpd to /lib. Then, you set your \nLD_LIBRARY_PATH TO /usr/local/openssl. \n\nIf I recall correctly (although ld.so(8) doesn't mention this), the linked binary keeps reference to the \nabsolute paths of the libraries it was linked against. What happens to the ldd calls if you unset \nLD_LIBRARY_PATH?\n\nCould you paste the config.log and config.status document from your build? \n\nYou will find that the Server: response header is set by mod_ssl itself (in modules/ssl/ssl_engine_init.c), \nand it aks the SSL library for version information at runtime. You can rest assured that httpd and \nmod_ssl are using the same SSL library: unless I'm mistaken horrible things would happen if they tried \nto load a different one. ", "tags": [], "creator": "sander@temme.net", "is_private": false, "count": 1, "id": 89531, "time": "2006-05-26T21:34:32Z", "bug_id": 39668, "creation_time": "2006-05-26T21:34:32Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 39668, "is_private": false, "text": "The problem is that at least one of the delivered ldap libraries (either\nlibldap.so.2 or liblber.so.2) on RH3 are compiled against the system openssl\nlibrary. It is not a wise idea to mix this. If you want to use a different\nopenssl version on RH3 you need to check all system libraries of RH3 that are\nlinked against httpd if they are linked against the system openssl. To avoid\ntrouble you need to recompile each of these libaries yourself against your\nopenssl and compile httpd later against your openssl and these libraries.\nSorry, but this is not a bug of httpd.", "id": 89533, "time": "2006-05-26T22:03:39Z", "creator": "rpluem@apache.org", "creation_time": "2006-05-26T22:03:39Z", "attachment_id": null}]
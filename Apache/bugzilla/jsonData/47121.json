[{"count": 0, "attachment_id": null, "creator": "vlad@hollebcons.com", "text": "I have tried to install mod_jk 1.2.27 on Netware 6.5 per CVE-2008-5519:\nApache Tomcat mod_jk information disclosure vulnerability.\n\nI downloaded the binary mod_jk-1.2.27-httpd-2.0.63-nw.zip\n<http://archive.apache.org/dist/tomcat/tomcat-connectors/jk/binaries/netware/jk-1.2.27/mod_jk-1.2.27-httpd-2.0.63-nw.zip>\nfrom\nhttp://archive.apache.org/dist/tomcat/tomcat-connectors/jk/binaries/netware/jk-1.2.27/\nand tried to use it.\n\nUnfortunately I was getting the following in the httpd message screen:\n\nSyntax error on line 638 of SYS:/apache2/conf/httpd.conf:\nJkWorkersFile only allowed once\n\nHere is the part of the httpd.conf where the loader failed:\nLine 636   #  TABLE: (4)\nLine 637   <IfModule mod_jk.c>\nLine 638   JkWorkersFile \"sys:/adminsrv/conf/mod_jk/workers.properties\"\nLine 639   JkLogFile \"logs/mod_jk.log\"\nLine 640   JkLogLevel error\nLine 641   </IfModule>\n\nNetWare loads httpd in the Admin and then in the OS memory spaces.  The\nproblem is observed on the second load.\n\nCurrently installed mod_jk ver. 1.2.23 works fine.", "id": 126631, "time": "2009-04-29T15:37:41Z", "bug_id": 47121, "creation_time": "2009-04-29T15:37:41Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "The version seems to work in principal also on Netware. Please double check, whether you have two times JkWorkersFile defined, maybe once in a separate file included into your main httpd.conf, like a mod_jk.conf or similar.", "attachment_id": null, "id": 127024, "creator": "rainer.jung@kippdata.de", "time": "2009-05-14T14:00:50Z", "bug_id": 47121, "creation_time": "2009-05-14T14:00:50Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 47121, "attachment_id": null, "id": 127025, "time": "2009-05-14T14:46:07Z", "creator": "vlad@hollebcons.com", "creation_time": "2009-05-14T14:46:07Z", "is_private": false, "text": "No I do not have duplicates. NetWare loads the second instance by design. This is how it works with prior mod_jk versions. With version 1.2.27 something became broken.\n\nDo you want me to post http.conf here? I did not modify a single line in it? Standard Novell distribution."}, {"count": 3, "tags": [], "creator": "eflash@gmx.net", "attachment_id": null, "text": "(In reply to comment #2)\n> No I do not have duplicates. NetWare loads the second instance by design. This\nBut with different conf files and into different address spaces, as you self stated - so this doesnt matter.\n> is how it works with prior mod_jk versions. With version 1.2.27 something\n> became broken.\nThere's nothing broken, but instead there was code added with 1.2.26 which checks for duplicates of this direction. I have running 1.2.27 on a public webserver with GroupWise, and have just build 1.2.28 and tested on a fresh NW65SP8 installation, and both work fine.\n\n> Do you want me to post http.conf here? I did not modify a single line in it?\n> Standard Novell distribution.\nno need, I have. Since I dont see the issue it must certainly come from another non-standard product's include file. Please check every additional conf files which get loaded via 'include ....' from your sys:/apache2/cond/httpd.conf; a very first candidate is the GroupWise include conf.\nOnce you figured out from where the duplicate came please update the BZ here, and then you might also want to use latest version:\nhttp://people.apache.org/~fuankg/mod_jk/1.2.28/", "id": 127028, "time": "2009-05-14T17:07:06Z", "bug_id": 47121, "creation_time": "2009-05-14T17:07:06Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 47121, "text": "Guenter,\n\nI went ahead and downloaded the latest 1.2.28.\n\nFirst, I verified that mod_jk v.1.2.23 was running 2 times, in address spaces \"os\" and \"adminsrv\" respectively.\n\nThen I shut down all instances of Tomcat and both instances of Apache by issuing the following commands:\ntcadmdn\ntc4stop\ntc5stop\nap2webdn\nunload address space = adminsrv apache2\n\nThen I verified that mod_jk.nlm was not loaded.\n\nAfter that I issued ap2rsall. The following messages were displayed in the Apach 2.0.63 for Netawre screen:\n\n[Sun May 17 21:10:27 2009] [warn] module rewrite_module is already loaded, skipp\ning                                                                             \n[Sun May 17 21:10:27 2009] [warn] module ldap_module is already loaded, skipping\n                                                                                \n[Sun May 17 21:10:27 2009] [warn] module auth_ldap_module is already loaded, ski\npping                                                                           \n[Sun May 17 21:10:27 2009] [warn] module jk_module is already loaded, skipping  \nSyntax error on line 638 of SYS:/apache2/conf/httpd.conf:                       \nJkWorkersFile only allowed once                                                 \n<Press any key to continue...>\n\nThe following messages were displayed in the Apache2 Web Manager screen:\n\nApache/2.0.63 (NETWARE) mod_jk/1.2.28 PHP/5.0.5    \n   Running in address space ADMINSRV               \n   Listening on port(s): 2200 2211                 \n   Loaded dynamic module mod_jk.c                  \n   Loaded dynamic module mod_headers.c             \n   Loaded dynamic module mod_rewrite.c             \n   Loaded dynamic module sapi_apache2.\n\nPlease pay attention, normally the \"Apache2 Web Manager screen\" is hidden, prefixed by the \"*\" before the screen name in the screen list. This time it was not.\n\nAfter pressing \"any key\" in the first of the two screens I verified mod_jk.nlm v1.2.28 being loaded once in adminsrv address space.\n\nAll attempts to start Apache in address space OS failed.\n\nPlease verify that you can reproduce the behavior I describe.\n\nSystem details: NetWare 6.5 SP8, Small Business Suite. Runs GroupWise 8 HP1 with WebAccess.\n\nAs far as your request to analyze all includes in httpd.conf goes this is what I discovered.\n\nInclude \"SYS:/qfsearch/WEB-INF/QFSrchApache.conf\" is issued in the httpd.conf.\n\nQFSrchApache.conf contains the following code:\n\n    #########################################################\n    # Make sure Apache - Tomcat connector is loaded\n    #########################################################\n    Include \"SYS:/qfsearch/WEB-INF/QFTomcatConnector.conf\"\n\nQFTomcatConnector.conf\" contains:\n\n     <IfModule !mod_jk.c>\n        LoadModule jk_module modules/mod_jk.nlm\n        JkWorkersFile \"sys:/adminsrv/conf/mod_jk/workers.properties\"\n        JkLogFile \"logs/mod_jk.log\"\n        JkLogLevel error\n    </IfModule>\n\n\nPlease let me know if you need more details.\n\nThank you,\nVladimir", "id": 127089, "time": "2009-05-17T20:15:32Z", "creator": "vlad@hollebcons.com", "creation_time": "2009-05-17T20:15:32Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 47121, "text": "Hello Vladimir!\nWell, seems I was correct regarding the product include files, and you found the culprit with the QFSrchApache.conf file.\nThe other issues you see are a bit strange, and since you issue strange NCF files I dont know about I cant help here - but I can recommend to use the default start/stop files which are:\nadmsrvdn.ncf -> stop admin server\nadmsrvup.ncf -> start admin server\nap2webdn.ncf -> stop web server in OS address space\nap2webup.ncf -> start web server in OS address space\nif you use these then you should not see the issues you saw about 'already loaded';\nand finally the fix for the duplicate usage of JkWorkersFile is this:\n- make sure that the QFSrchApache.conf include happens _after_ the IfModule block in your httpd.conf:\n<IfModule mod_jk.c>\n   JkWorkersFile \"sys:/adminsrv/conf/mod_jk/workers.properties\"\n   JkLogFile \"logs/mod_jk.log\"\n   JkLogLevel error\n</IfModule>\n# QFSrchApache.conf must be included after the mod_jk block!!\nInclude \"SYS:/qfsearch/WEB-INF/QFSrchApache.conf\"\n\nthat's all! Now when the QFSrchApache.conf is included then mod_jk is already loaded, and the block in QFSrchApache.conf should therefore not be executed because its surrounded with <IfModule !mod_jk.c> which means its only executed when mod_jk is not loaded.\n\nHTH, Guenter.", "id": 127329, "time": "2009-05-23T07:34:09Z", "creator": "eflash@gmx.net", "creation_time": "2009-05-23T07:34:09Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 47121, "text": "(In reply to comment #5)\n\nGuenter,\n\nI do not believe it matters which specific .NCFs I used as long as Apache and Mod_JK were unloaded in all Address Spaces and they were. I unloaded Tomcat as well just to be on the safe side.  Next time I can skip that step.\n\nBefore I go ahead and run the same experiment again can you please confirm that you noticed the difference in 2 IF statements.\n\nQFTomcatConnector.conf\" contains:\n\n     <IfModule !mod_jk.c>\n**** Pay attention to \"!\" *****\n\nWhereas httpd.conf contains:\n#  TABLE: (4)\n     <IfModule mod_jk.c>\n\nCondition checked is the opposite. Shouldn't it be the same?\n\nThank you,\nVladimir", "id": 127340, "time": "2009-05-23T21:52:31Z", "creator": "vlad@hollebcons.com", "creation_time": "2009-05-23T21:52:31Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "eflash@gmx.net", "attachment_id": null, "text": "Hi Vladimir,\n(In reply to comment #6)\n> I do not believe it matters which specific .NCFs I used as long as Apache and\n> Mod_JK were unloaded in all Address Spaces and they were.\nIn fact it does: you use something which sounds for restarting - but if you try a restart, and Apache is not loaded (because you stopped it) then the shutdown command starts Apache instead of shutting down, and the following load command gives you then the 'already loaded' - makes sense? Therefore please use only the NCFs I suggested, even if these need two steps: first a down followed by an up; anyway you cant do a restart since you intent to load a new build of a module.\n> I unloaded Tomcat as well just to be on the safe side.\n> Next time I can skip that step.\ncorrect, not needed.\n\n> Before I go ahead and run the same experiment again can you please confirm that\n> you noticed the difference in 2 IF statements.\nyes, and I explained in detail how it works. Please re-read my last comment where I stated that the block in QFTomcatConnector.conf only is active when mod_jk is _NOT_ loaded.\n\n> Condition checked is the opposite. Shouldn't it be the same?\nNo, and I explain again. In httpd.conf you can find:\n\n# The following line instructs Apache to load the jk module\nLoadModule jk_module modules/mod_jk.nlm\n<IfModule mod_jk.c>\n   JkWorkersFile \"sys:/adminsrv/conf/mod_jk/workers.properties\"\n   JkLogFile \"logs/mod_jk.log\"\n   JkLogLevel error\n</IfModule>\n\nthat means: mod_jk gets unconditionally loaded, and the following block gets conditionally active when mod_jk is loaded.\n\nIn QFTomcatConnector.conf you have:\n\n<IfModule !mod_jk.c>\n   LoadModule jk_module modules/mod_jk.nlm\n   JkWorkersFile \"sys:/adminsrv/conf/mod_jk/workers.properties\"\n   JkLogFile \"logs/mod_jk.log\"\n   JkLogLevel error\n</IfModule>\n\nthat means: this block gets only active if mod_jk is _NOT_ already loaded, and is then loaded, and its config stuff is set.\n\nNow the problem is this:\nif QFTomcatConnector.conf is included in httpd.conf _BEFORE_ mod_jk gets loaded from httpd.conf then the whole block in QFTomcatConnector.conf gets active, and loads mod_jk + sets JkWorkersFile. Then a bit later comes the unconditional load of mod_jk from httpd.conf which just gets ignored by the Apache loader with 'module already loaded', then follows the mod_jk config block which conditionally gets active when mod_jk is loaded -- and at this time its loaded, and there then happens the second JkWorkersFile setting which then makes mod_jk refuse loading.\n\nNow if you just move the include of QFTomcatConnector.conf down _AFTER_ the mod_jk configure block everything is fine - then mod_jk is loaded already when QFTomcatConnector.conf is processed, and no second config happens.\n\nI agree that Novell's config is somewhat crazy, and even more worse is that they then dont care about the order things happen, and where to include QFTomcatConnector.conf from httpd.conf; though the change we did with mod_jk is fully correct - realize that with the old behaviour you would never get aware of a second JkWorkersFile usage, and if it would point to another file than the standard you would be lost.\nFeel free to open a bug report at Novell and tell them they should use same config block as what they use in QFTomcatConnector.conf - then it wouldnt matter if mod_jk gets loaded + configured either from QFTomcatConnector.conf, or from httpd.conf, and there would never happen a second configure; the first one would just win! Though I doubt it makes much sense to tell Novell for two reasons:\n1.) I've heard that they stopped working on SP9, so anyway we probably dont get any updates anymore from Novell.\n2.) The whole webservice stuff including mod_jk support is moved to Novell India, and asked Rainer and me last time for SP8 already about the new stuff with mod_jk later 1.2.23, and AFAICT they couldnt make sense of our replies - so they backported some patches so they could avoid later versions.\n\nGuenter.", "id": 127384, "time": "2009-05-25T11:32:48Z", "bug_id": 47121, "creation_time": "2009-05-25T11:32:48Z", "is_private": false}, {"count": 8, "tags": [], "creator": "vlad@hollebcons.com", "attachment_id": null, "text": "(In reply to comment #7)\n\nHi Guenter,\n\nThank you for detailed comments and for the mod_jk loading logic explanation.\n\nThis is what I did.\n\nFirst, in httpd.conf I commented out the following sections:\n\n1.  LoadModule jk_module modules/mod_jk.nlm\n\n2.  <IfModule mod_jk.c>\n       JkWorkersFile \"sys:/adminsrv/conf/mod_jk/workers.properties\"\n       JkLogFile \"logs/mod_jk.log\"\n       JkLogLevel error\n    </IfModule>\n\nThen I inserted the block from QFTomcatConnector.conf immediately after section #1 being commented out by that time, \"# LoadModule jk_module modules/mod_jk.nlm\"\n\n<IfModule !mod_jk.c>\n   LoadModule jk_module modules/mod_jk.nlm\n   JkWorkersFile \"sys:/adminsrv/conf/mod_jk/workers.properties\"\n   JkLogFile \"logs/mod_jk.log\"\n   JkLogLevel error\n</IfModule>\n\nIt made the trick. I used the NCFs you suggested, did not touch the Tomcat. Both instances of Apache loaded fine.\n\nI did run into some issues with NDSAUDIT being unable to reload itself in protected mode, so I ended up rebooting the server, which I still meant to do as a final test. All loaded well after reboot.\n\nYes, in fact it IS Novel's configuration issue.  Thank you for helping me to resolve it.\n\n-Vladimir\n\n\nPS. Unfortunately I needed to roll mod_jk.nlm back to ver. 1.2.23. Virtual Office would not start with either 1.2.27 or 1.2.28.\n\nI tried to move the line 'Include \"SYS:/qfsearch/WEB-INF/QFSrchApache.conf\"' to the end of http.conf per your recommendation while removing all my modifications. mod_jk loaded fine either way but VO would not start. As soon as I restored mod_jk v.1.2.23 VO started immediately.\n\nThis is what I received in sys:/apache2/logs/error_log:\n\n[Tue May 26 00:50:22 2009] [warn] module rewrite_module is already loaded, skipp\ning\n[Tue May 26 00:50:22 2009] [warn] module ldap_module is already loaded, skipping\n[Tue May 26 00:50:22 2009] [warn] module auth_ldap_module is already loaded, ski\npping\n[Tue May 26 00:50:22 2009] [notice] LDAP: Built with Novell LDAP SDK\n[Tue May 26 00:50:22 2009] [notice] LDAP: SSL support available\n[Tue May 26 00:50:22 2009] [notice] LDAP: Built with Novell LDAP SDK\n[Tue May 26 00:50:22 2009] [notice] LDAP: SSL support available\n[Tue May 26 00:50:26 2009] [notice] Apache/2.0.63 (NETWARE) mod_jk/1.2.28 config\nured -- resuming normal operations\n[Tue May 26 00:51:11 2009] [error] [client 69.128.xxx.xxx] File does not exist:\nsys:/tomcat/4/webapps/vo/servlet\n[Tue May 26 00:51:13 2009] [error] [client 69.128.xxx.xxx] File does not exist:\nsys:/tomcat/4/webapps/vo/servlet\n\nThese are the respective records form sys:/apache2/logs/access_log:\n\n69.128.xxx.xxx - - [26/May/2009:00:51:11 -0500] \"GET /vo/servlet/portal?render=o\nn HTTP/1.1\" 404 1127\n69.128.xxx.xxx - - [26/May/2009:00:51:13 -0500] \"GET /vo/servlet/portal?render=o\nn HTTP/1.1\" 404 1127\n\nDo you have any ideas or is it strictly Novell's business?\n\nThank you,\nVladimir", "id": 127399, "time": "2009-05-25T23:29:45Z", "bug_id": 47121, "creation_time": "2009-05-25T23:29:45Z", "is_private": false}, {"count": 9, "text": "All JkMount and JkMountFile either need to be put into the VirtualHost you are using, or you add \"JkMountCopy All\" to the global server, e.g. directly agfter your JkLogLevel line.", "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 127401, "time": "2009-05-26T02:24:39Z", "bug_id": 47121, "creation_time": "2009-05-26T02:24:39Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "bug_id": 47121, "attachment_id": null, "id": 127412, "time": "2009-05-26T08:54:34Z", "creator": "vlad@hollebcons.com", "creation_time": "2009-05-26T08:54:34Z", "is_private": false, "text": "(In reply to comment #9)\n> All JkMount and JkMountFile either need to be put into the VirtualHost you are\n> using, or you add \"JkMountCopy All\" to the global server, e.g. directly agfter\n> your JkLogLevel line.\n\nGuenter,\n\nCan you please elaborate a little bit on what has changed in 1.2.27/28 compared to 1.2.23 which warrants changing config files? Or am I missing something?\n\nThank you,\nVladimir"}, {"count": 11, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "That comment came from me, Rainer.\n\nThe change about putting JkMount into virtual hosts or use JkMountCopy was done a couple of revisions ago. That was the major configuration incompatibility that happened during the last two years\n\nI suggest yo proceed this discussion - if neceaasry - on the tomcat users list, because Bugzilla is not a support forum. You can come back to bugzilla and open a new issue, if you do detect a bug, but for discussion of configuration questions please use the users list.", "id": 127416, "time": "2009-05-26T09:14:47Z", "bug_id": 47121, "creation_time": "2009-05-26T09:14:47Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 47121, "attachment_id": null, "id": 127431, "time": "2009-05-26T16:51:33Z", "creator": "eflash@gmx.net", "creation_time": "2009-05-26T16:51:33Z", "is_private": false, "text": "(In reply to comment #11)\n> I suggest yo proceed this discussion - if neceaasry - on the tomcat users list,\n> because Bugzilla is not a support forum.\nSince many NetWare users download binaries directly from my site, and read my forum posts, I have created a forum post where I summarized the results of this BZ:\nhttp://www.gknw.net/phpbb/viewtopic.php?p=1436\nfeel free to subscribe and add further related issues there.\n\nG\u00fcnter."}]
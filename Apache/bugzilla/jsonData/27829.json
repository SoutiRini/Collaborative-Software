[{"count": 0, "tags": [], "bug_id": 27829, "attachment_id": null, "text": "even if there is a temporary network problem, I don't see why tomcat should\nshutdown totally?\n\nGlobalResourcesLifecycleListener: Destroying MBeans for Global JNDI Resources\nStopping service Privasphere-Standalone\nMar 21, 2004 9:22:02 PM org.apache.tomcat.util.net.PoolTcpEndpoint closeServerSocket\nSEVERE: Caught exception trying to unlock accept.\njava.net.SocketException: Network is unreachable\n        at java.net.PlainSocketImpl.socketConnect(Native Method)\n        at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:305)\n        at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:171)\n        at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:158)\n        at java.net.Socket.connect(Socket.java:452)\n        at java.net.Socket.connect(Socket.java:402)\n        at java.net.Socket.connect(Socket.java:452)\n        at java.net.Socket.connect(Socket.java:402)\n        at java.net.Socket.<init>(Socket.java:309)\n        at java.net.Socket.<init>(Socket.java:124)\n        at org.apache.tomcat.util.net.PoolTcpEndpoint.closeServerSocket(PoolTcp\\\nEndpoint.java:326)\n        at org.apache.tomcat.util.net.PoolTcpEndpoint.stopEndpoint(PoolTcpEndpo\\\nint.java:316)\n        at org.apache.coyote.http11.Http11Protocol.destroy(Http11Protocol.java:\\\n170)\n        at org.apache.coyote.tomcat4.CoyoteConnector.stop(CoyoteConnector.java:\\\n1205)\n        at org.apache.catalina.core.StandardService.stop(StandardService.java:5\\\n46)\n        at org.apache.catalina.core.StandardServer.stop(StandardServer.java:222\\\n5)\n        at org.apache.catalina.startup.Catalina$CatalinaShutdownHook.run(Catali\\\nna.java:624)\nFATAL [Thread-1] (MyServlet.java:242) - Mar 21, 2004 9:22:03 PM: shutting down\nMyServlet?\nStopping service Privasphere-Port8080\nHttpConnector[8080] Stopping background thread\nEngineConfig: EngineConfig: Processing STOP\nHostConfig[www.privasphere.com]: HostConfig: Processing STOP\nHostConfig[www.privasphere.com]: Undeploying deployed web applications\nHostConfig[www.privasphere.com]: Undeploying web application at context path\nStandardHost[www.privasphere.com]: Removing web application at context path\nStandardContext[]: Stopping\nStandardContext[]: Stopping filters\nStandardContext[]: Sending application stop events\nStandardContext[]: Processing standard container shutdown\nContextConfig[]: ContextConfig: Processing STOP\nStandardContext[]: Stopping complete\nStopping service myApp\njava.lang.Exception\n        at com.privasphere.myApp.MyServlet.destroy(MyServlet.java:235)\n        at org.apache.catalina.core.StandardWrapper.unload(StandardWrapper.java\\\n:1124)\n        at org.apache.catalina.core.StandardWrapper.unload(StandardWrapper.java\\\n:1124)\n        at org.apache.catalina.core.StandardWrapper.stop(StandardWrapper.java:1\\\n356)\n        at org.apache.catalina.core.ContainerBase.removeChild(ContainerBase.jav\\\na:1036)\n        at org.apache.catalina.startup.ContextConfig.stop(ContextConfig.java:70\\\n1)\n        at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConf\\\nig.java:245)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(Lifecyc\\\nleSupport.java:166)\n        at org.apache.catalina.core.StandardContext.stop(StandardContext.java:3\\\n676)\n        at org.apache.catalina.core.ContainerBase.removeChild(ContainerBase.jav\\\na:1036)\n        at org.apache.catalina.core.StandardHostDeployer.remove(StandardHostDep\\\nloyer.java:470)\n        at org.apache.catalina.core.StandardHost.remove(StandardHost.java:852)\n        at org.apache.catalina.startup.HostConfig.undeployApps(HostConfig.java:\\\n758)\n        at org.apache.catalina.startup.HostConfig.undeployApps(HostConfig.java:\\\n758)\n        at org.apache.catalina.startup.HostConfig.stop(HostConfig.java:738)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.jav\\\na:360)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(Lifecyc\\\nleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1221)\n        at org.apache.catalina.core.ContainerBase.stop(ContainerBase.java:1233)\n        at org.apache.catalina.core.StandardService.stop(StandardService.java:5\\\n54)\n        at org.apache.catalina.core.StandardServer.stop(StandardServer.java:222\\\n5)\n        at org.apache.catalina.startup.Catalina$CatalinaShutdownHook.run(Catali\\\nna.java:624)\n\nIs this a regression of Bug 344 ?", "id": 54364, "time": "2004-03-22T07:03:45Z", "creator": "hauser@acm.org", "creation_time": "2004-03-22T07:03:45Z", "is_private": false}, {"count": 1, "text": "This is not a regression of 344.\n\nTomcat is stopping because something has caused the JVM to exit which in turn \nhas called the regisitered shutdown hook. It is the running of the shutdown \nhook that is causing the SEVERE, not the other way around.\n\nSince tomcat is shutting down in response to a request to do exactly that I am \nclosing this bug as invalid.", "creator": "markt@apache.org", "attachment_id": null, "id": 60446, "time": "2004-07-11T18:27:44Z", "bug_id": 27829, "creation_time": "2004-07-11T18:27:44Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 27829, "attachment_id": null, "id": 60469, "time": "2004-07-12T12:40:38Z", "creator": "hauser@acm.org", "creation_time": "2004-07-12T12:40:38Z", "is_private": false, "text": "Sure, the exception came from the JVM, but why do you claim that the JVM is\nshutting down due to this? \n\nTo me, it rather appears that the tomcat code neither bothers to \ni) catch and analyze java.net.SocketException which may well be of very\ntemporary nature nor \nii) provides a useful log-output that helps an admin to fix the issue without\nhaving to fully restart tomcat.\n\nit appears that unlockAccept() in PoolTcpEndpoint.java isn't prepared to do\nanything smart when a SocketException comes along - or am I wrong?"}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "I think you are wrong. Let me try to explain.\n\nIn your initial report you quote two stack straces. Both of these start at\norg.apache.catalina.startup.Catalina$CatalinaShutdownHook.run\n\nThis is a shutdown hook that is registered with the JVM at tomcat startup. \nWhen JVM shuts down (System.exit(), CTRL-C on windows, catalina stop etc) this \nshutdown hook is executed. The exceptions you are seeing are as a result of \nthis shutdown code.\n\nMy point is that something is causing the JVM to shutdown. As part of the \nshutdown process the JVM calls the shutdown hook. During the running of the \nshutdown hook some exceptions occur and this is what you are seeing.\n\nThe hard part here is trying to work out what is causing the JVM to exit in \nthe first place. I have previously checked every call in the tomcat code to \nSystem.exit() and they are all preceeded by a log message. On this basis I \nthink you can rule out any tomcat code. Is there a System.exit() in one of \nyour webapps? Something that might be worth trying is running under a security \nmanager that would thow a security exception if a webapp tried something like \nthis. It is also possible that the OS is signalling the JVM to shutdown. \nTracking this down could be trickier.\n\nIf you wish to discuss this further please use the tomcat-user mailing list as \nit is more appropriate to this type of discussion.\n\n", "id": 60509, "time": "2004-07-12T18:23:47Z", "bug_id": 27829, "creation_time": "2004-07-12T18:23:47Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 27829, "text": "*** Bug 27141 has been marked as a duplicate of this bug. ***", "id": 60512, "time": "2004-07-12T18:32:36Z", "creator": "markt@apache.org", "creation_time": "2004-07-12T18:32:36Z", "tags": [], "is_private": false}]
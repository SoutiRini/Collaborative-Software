[{"attachment_id": null, "tags": [], "creator": "ruhland@telmat.fr", "is_private": false, "count": 0, "id": 73775, "time": "2005-04-18T16:50:10Z", "bug_id": 34504, "creation_time": "2005-04-18T16:50:10Z", "text": "We are using apache 2.0.53 as INTRANET-PROXY server with mod_proxy.\n\nSo generally the accesses to the whole of Internet site are fast, certain \naccesses are particularly slow.\n\nIn this example, access to www.inttra.com never end (loaded in a few seconds \nwith direct access).\n\nAbove the result of gdb backtrace :\n\n(gdb) backtrace full\n#0  0x4025ff32 in fts_children () from /lib/libc.so.6\nNo symbol table info available.\n#1  0x403a6614 in __res_nsend () from /lib/libresolv.so.2\nNo symbol table info available.\n#2  0x403a5bd5 in __res_queriesmatch () from /lib/libresolv.so.2\nNo symbol table info available.\n#3  0x403a4b37 in __libc_res_nquery () from /lib/libresolv.so.2\nNo symbol table info available.\n#4  0x403a527b in __res_nsearch () from /lib/libresolv.so.2\nNo symbol table info available.\n#5  0x403a4e33 in __libc_res_nsearch () from /lib/libresolv.so.2\nNo symbol table info available.\n#6  0x4039b179 in _nss_dns_gethostbyname2_r () from /lib/libnss_dns.so.2\nNo symbol table info available.\n#7  0x40251fc4 in sched_setaffinity () from /lib/libc.so.6\nNo symbol table info available.\n#8  0x40252f37 in getaddrinfo () from /lib/libc.so.6\nNo symbol table info available.\n#9  0x400ad734 in call_resolver (sa=0xbfffd7c8, \nhostname=0x8165ba0 \"www.inttra.com\", family=-4, port=80, flags=0, p=0x81655f0) \nat sockaddr.c:360\n        hints = {ai_flags = 0, ai_family = 0, ai_socktype = 1, ai_protocol = 0, \nai_addrlen = 0, ai_addr = 0x0, ai_canonname = 0x0, ai_next = 0x0}\n        ai = (struct addrinfo *) 0x8165ba0\n        ai_list = (struct addrinfo *) 0x0\n        prev_sa = (apr_sockaddr_t *) 0xba\n        error = -4\n        servname = 0x1f5 <Address 0x1f5 out of bounds>\n#10 0x40310da2 in ap_proxy_http_determine_connection (p=0x81655f0, r=0x8179678, \np_conn=0x8165b30, c=0x8165700, conf=0x80e3b78, uri=0x8165b00,\n    url=0xbfffd888, proxyname=0x0, proxyport=0, \nserver_portstr=0xbfffd840 \" \u00ab\\027\\b\\003\", server_portstr_size=32) at \nproxy_http.c:192\n        server_port = 135682816\n        err = 0\n        uri_addr = (apr_sockaddr_t *) 0x0\n#11 0x403127c4 in ap_proxy_http_handler (r=0x8179678, conf=0x80e3b78, \nurl=0x817aace \"http://www.inttra.com/images/NewHomeTopPicLeft.jpg\",\n    proxyname=0x0, proxyport=0) at proxy_http.c:1088\n        status = 135681520\n        server_portstr = \" \u00ab\\027\\b\\003\\0\\0\\0x\u00d8\u00ff\u00bfy_\\n@ \u00ab\\027\\b\\b\u00ab\\027\\b\\003\\0\\0\n\\0>_\\n@\"\n        origin = (conn_rec *) 0x0\n        backend = (proxy_conn_rec *) 0x8165b48\n        is_ssl = 0\n        p = (apr_pool_t *) 0x81655f0\n        bb = (apr_bucket_brigade *) 0x8165ae0\n        uri = (apr_uri_t *) 0x8165b00\n#12 0x402ff34f in proxy_run_scheme_handler (r=0x8179678, conf=0x80e3b78, \nurl=0x817aace \"http://www.inttra.com/images/NewHomeTopPicLeft.jpg\",\n    proxyhost=0x0, proxyport=0) at mod_proxy.c:1116\n        pHook = (proxy_LINK_scheme_handler_t *) 0xfffffffc\n        n = 0\n        rv = -4\n#13 0x402fdd84 in proxy_handler (r=0x8179678) at mod_proxy.c:420\n        url = 0x817aace \"http://www.inttra.com/images/NewHomeTopPicLeft.jpg\"\n        scheme = 0x817ab28 \"http\"\n        sconf = (void *) 0x1f5\n        conf = (proxy_server_conf *) 0x80e3b78\n        proxies = (apr_array_header_t *) 0x80e3c28\n        ents = (struct proxy_remote *) 0x80e3c40\n        i = 135170528\n        rc = -4\n        access_status = -4\n        direct_connect = 501\n        str = 0xfffffffc <Address 0xfffffffc out of bounds>\n        maxfwd = 501\n#14 0x08067bd6 in ap_run_handler (r=0x8179678) at config.c:153\n---Type <return> to continue, or q <return> to quit---\n        pHook = (ap_LINK_handler_t *) 0xfffffffc\n        n = 0\n        rv = -4\n#15 0x080681a8 in ap_invoke_handler (r=0x8179678) at config.c:364\n        handler = 0x817a2f8 \"(\u00e5\\t\\bx\u00a3\\027\\b(\u00a8\\027\\bx\\226\\027\\b\"\n        result = 135766800\n        old_handler = 0x403013a7 \"proxy-server\"\n#16 0x0806511f in ap_process_request (r=0x8179678) at http_request.c:249\n        access_status = 501\n#17 0x08060c89 in ap_process_http_connection (c=0x8165700) at http_core.c:251\n        r = (request_rec *) 0x8179678\n        csd_set = 0\n        csd = (apr_socket_t *) 0x0\n#18 0x08070d66 in ap_run_process_connection (c=0x8165700) at connection.c:43\n        pHook = (ap_LINK_process_connection_t *) 0x3\n        n = 0\n        rv = 3\n#19 0x08066544 in child_main (child_num_arg=3) at prefork.c:610\n        ptrans = (apr_pool_t *) 0x81655f0\n        allocator = (apr_allocator_t *) 0x80dc0a0\n        current_conn = (conn_rec *) 0x8165700\n        status = 135681792\n        i = 501\n        lr = (ap_listen_rec *) 0x8165700\n        curr_pollfd = 501\n        last_pollfd = 0\n        pollset = (apr_pollfd_t *) 0x8163690\n        offset = 3\n        csd = (void *) 0x8165628\n        sbh = (ap_sb_handle_t *) 0x8163660\n        rv = 3\n        bucket_alloc = (apr_bucket_alloc_t *) 0x8169600\n#20 0x08066670 in make_child (s=0x809fb28, slot=0) at prefork.c:704\n        pid = 0\n#21 0x0806677f in startup_children (number_to_start=1) at prefork.c:722\n        i = 0\n#22 0x08066f19 in ap_mpm_run (_pconf=0x0, plog=0x80c7e20, s=0x809fb28) at \nprefork.c:941\n        index = 1\n        remaining_children_to_start = 1\n        rv = 3\n#23 0x0806c6c8 in main (argc=4, argv=0xbfffdb84) at main.c:618\n        c = 68 'D'\n        configtestonly = 0\n        confname = 0x8089b1f \"conf/httpd.conf\"\n        def_server_root = 0x808aa44 \"/usr/local/apache\"\n        temp_error_log = 0x0\n        process = (process_rec *) 0x809bdf0\n        server_conf = (server_rec *) 0x809fb28\n        pglobal = (apr_pool_t *) 0x809bd70\n        pconf = (apr_pool_t *) 0x809dd78\n        plog = (apr_pool_t *) 0x80c7e20\n        ptemp = (apr_pool_t *) 0x80b7de0\n        pcommands = (apr_pool_t *) 0x809fd80\n        opt = (apr_getopt_t *) 0x809fe18\n        rv = 3\n        mod = (module **) 0x809fb28\n        optarg = 0xbffffbb6 \"SSL\"\n        signal_server = (apr_OFN_ap_signal_server_t *) 0x1f5\n#24 0x4019cd06 in __libc_start_main () from /lib/libc.so.6\n---Type <return> to continue, or q <return> to quit---\nNo symbol table info available.\n\nThanks for help."}, {"count": 1, "tags": [], "bug_id": 34504, "attachment_id": null, "is_private": false, "id": 73777, "time": "2005-04-18T17:31:27Z", "creator": "jorton@redhat.com", "creation_time": "2005-04-18T17:31:27Z", "text": "That process is doing a DNS lookup, so it's most likely that you either have\nsome DNS issue, or you have some issue with the libc resolver.  Is there a\npattern to which sites/hostnames are slow to load - can you narrow down a way to\nreliably reproduce the issue for a particular site?  I suggest you try a user\nsupport forum for further help; http://httpd.apache.org/lists.html#http-users"}, {"count": 2, "text": "(In reply to comment #1)\n> That process is doing a DNS lookup, so it's most likely that you either have\n> some DNS issue, or you have some issue with the libc resolver.  Is there a\n> pattern to which sites/hostnames are slow to load - can you narrow down a way \nto\n> reliably reproduce the issue for a particular site?  I suggest you try a user\n> support forum for further help; http://httpd.apache.org/lists.html#http-users\n\nI will look at this forum. But while waiting, the problem is solved by \ncompiling apache with the option --disable-ipv6 (option mainly used on APR \nsubdirs).\n\nThanks for your help.", "bug_id": 34504, "attachment_id": null, "id": 73794, "time": "2005-04-19T13:58:11Z", "creator": "ruhland@telmat.fr", "creation_time": "2005-04-19T13:58:11Z", "tags": [], "is_private": false}]
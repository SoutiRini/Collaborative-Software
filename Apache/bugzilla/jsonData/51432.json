[{"count": 0, "tags": [], "creator": "zhh200910@gmail.com", "attachment_id": null, "text": "In the example \"examples\\WEB-INF\\classes\\async\\Async1.java\",\nif we change some value to let the sleeping time of the AsyncThread greater than async timeout value, there will be a NullPointerException.\nPlease see the detailed information as the following:\n\njava code:\n====================================================================\n    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n        final AsyncContext actx = req.startAsync();\n        actx.setTimeout(8*1000);\n        Runnable run = new Runnable() {\n            @Override\n            public void run() {\n                try {\n                    String path = \"/jsp/async/async1.jsp\";\n                    Thread.currentThread().setName(\"Async1-Thread\");\n                    log.info(\"Putting AsyncThread to sleep\");\n                    Thread.sleep(12*1000);\n                    log.info(\"Dispatching to \"+path);\n                    actx.dispatch(path);\n                }catch (InterruptedException x) {\n                    log.error(\"Async1\",x);\n                }catch (IllegalStateException x) {\n                    log.error(\"Async1\",x);\n                }\n            }\n        };\n        Thread t = new Thread(run);\n        t.start();\n    }\n\n\nerror:\n====================================================================\n2011-6-25 10:32:11 org.apache.coyote.AbstractProtocol start\n\u4fe1\u606f: Starting ProtocolHandler [\"http-bio-8080\"]\n2011-6-25 10:32:11 org.apache.coyote.AbstractProtocol start\n\u4fe1\u606f: Starting ProtocolHandler [\"ajp-bio-8009\"]\n2011-6-25 10:32:11 org.apache.catalina.startup.Catalina start\n\u4fe1\u606f: Server startup in 497 ms\n2011-6-25 10:32:14 async.Async1$1 run\n\u4fe1\u606f: Putting AsyncThread to sleep\n2011-6-25 10:32:26 async.Async1$1 run\n\u4fe1\u606f: Dispatching to /jsp/async/async1.jsp\nException in thread \"Async1-Thread\" java.lang.NullPointerException\n        at org.apache.catalina.connector.Request.getServletContext(Request.java:1606)\n        at org.apache.catalina.core.AsyncContextImpl.dispatch(AsyncContextImpl.java:138)\n        at async.Async1$1.run(Async1.java:49)\n        at java.lang.Thread.run(Thread.java:619)", "id": 147476, "time": "2011-06-25T03:18:20Z", "bug_id": 51432, "creation_time": "2011-06-25T03:18:20Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 51432, "attachment_id": null, "id": 147503, "time": "2011-06-25T18:01:58Z", "creator": "markt@apache.org", "creation_time": "2011-06-25T18:01:58Z", "is_private": false, "text": "This is similar to bug 50353. Like that bug, as far as I can see, it is not covered by the spec. I'm leaning towards throwing an IllegalStateExcpetion in both cases."}, {"count": 2, "tags": [], "bug_id": 51432, "text": "The fix is the same and there is overlap in the issue reported so marking these as duplicates.\n\n*** This bug has been marked as a duplicate of bug 50353 ***", "id": 147568, "time": "2011-06-28T17:23:38Z", "creator": "markt@apache.org", "creation_time": "2011-06-28T17:23:38Z", "is_private": false, "attachment_id": null}]
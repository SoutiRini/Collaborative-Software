[{"count": 0, "tags": [], "creator": "vladimir@contera.sp.ru", "attachment_id": null, "id": 58039, "time": "2004-05-25T11:55:25Z", "bug_id": 29202, "creation_time": "2004-05-25T11:55:25Z", "is_private": false, "text": "Regular expression engine works incorrectly (sometimes!!!) when a test has many \nthreads.JMeter Version 2_0_20040523.\n\nOur test is modelling work of 50 users (let them named c1-c50). \nEvery user logins to the server, opens its file (let them named CFR1-CFR50) on \nit and enters some data. \nThe main problem - test works non stable. Sometimes it works fine, another \ntime - any users can not open its files. \nLast time only c13 could not open its file CFR13.\nWe think regular expression engine works incorrectly (sometimes!!!) when a test \nhas many threads.\nShort explanation.\nTest script has 50 threads (one thread for every user).\nTo define the field of request 9 ContainerID we used the next regular \nexpression:\n${__regexFunction(<option \nvalue=\"(.*)\">spb1,$1,${__threadNum},,,refContainerID)}.\nThe part of page for finding is:\n\n<option value=\"373\" >spb1 - CFR 10</option>\n<option value=\"374\" >spb1 - CFR 11</option>\n<option value=\"375\" >spb1 - CFR 12</option>\n<option value=\"376\" >spb1 - CFR 13</option>\n<option value=\"377\" >spb1 - CFR 14</option>\n<option value=\"378\" >spb1 - CFR 15</option>\n\nFor all 50 threads except the thread 13 it worked fine. For the tread 13 it \nfound value 377 (belong to the thread 14) instead of 376.\nRequests for c13 and c14 looked like:\n\nc13:GET http://test.athenium.com/teamthink/rqa1/teamthink?\nPageHandler=SelectContainer.DashboardModuleSelect&FilterWhat=6&ContainerID=377&O\npenContainer=+Open+&SessionID=B0oooUbBZiTSRTednpqjaFmUJKqbAEIATK2dfmcAfHjhhOFl2Q\nLjklDSVW\n\nc14:GET http://test.athenium.com/teamthink/rqa1/teamthink?\nPageHandler=SelectContainer.DashboardModuleSelect&FilterWhat=6&ContainerID=377&O\npenContainer=+Open+&SessionID=IrjFj2RdATPJHQBdOiKiMfSJJKkgaVP0ocfIWMTaQpXeVblIWR\ne0FM\n\nHTML pages of requests 8 and 9 for users c13 and c14 are in the file \"requests8-\n9_for_c13-c14.txt\" attached."}, {"count": 1, "tags": [], "bug_id": 29202, "attachment_id": 11654, "text": "Created attachment 11654\nrequests8-9_for_c13-c14.txt", "id": 58040, "time": "2004-05-25T11:57:31Z", "creator": "vladimir@contera.sp.ru", "creation_time": "2004-05-25T11:57:31Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 29202, "attachment_id": 11657, "text": "Created attachment 11657\ntest script T_AIM-AnyCFR-multi-2.jmx", "id": 58050, "time": "2004-05-25T12:48:50Z", "creator": "vladimir@contera.sp.ru", "creation_time": "2004-05-25T12:48:50Z", "is_private": false}, {"count": 3, "tags": [], "creator": "vladimir@contera.sp.ru", "attachment_id": null, "id": 58053, "time": "2004-05-25T14:13:22Z", "bug_id": 29202, "creation_time": "2004-05-25T14:13:22Z", "is_private": false, "text": "Notice. It might be connected with area of common parameters and variables of \nthreads. As we understand every thread has a variable \"refContainerID\" (as a \nresult of finding according to the regular expression).\nThat time thread 14 started before thread 13. Maybe it is a reason of problems? "}, {"count": 4, "tags": [], "text": "I've had a look at the code, and the Regex function is one of the few \nfunctions that has an execute() method that is *not* synchronized.\n\nFunctions can be called from multiple threads, so this seems a likely cause of \nthe problem, especially as the execute() method also uses some instance \nvariables. (Though most of the instance fields only seem to be needed for the \nduration of the execute function.)\n\nI'm working on fixing this - should be able to apply the updates in a short \nwhile.", "attachment_id": null, "bug_id": 29202, "id": 58394, "time": "2004-05-29T23:48:45Z", "creator": "sebb@apache.org", "creation_time": "2004-05-29T23:48:45Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 29202, "attachment_id": null, "is_private": false, "id": 58395, "time": "2004-05-30T00:33:10Z", "creator": "sebb@apache.org", "creation_time": "2004-05-30T00:33:10Z", "text": "Updated version has been checked into 2.0 branch.\nLeaving the call open for now in case of further problems."}, {"count": 6, "tags": [], "bug_id": 29202, "attachment_id": null, "text": "We tried to insert synchronization for execute() methods of classes \nRegexFunction.class and ThreadNumber.class (it was not synchronized either) for \nJMeter Version 2_0_20040523. Unfortunately, it has not helped.\nIt needs to do something else. It is still not clear.\n\n", "id": 58463, "time": "2004-06-01T15:37:57Z", "creator": "vladimir@contera.sp.ru", "creation_time": "2004-06-01T15:37:57Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 29202, "attachment_id": null, "text": "Bother! I hoped that would fix things. It was certainly necessary - pity it was \nnot sufficient.\n\nSwitching on full debug logging would probably slow the test down too much.\n\nGiven that you can build the code, it might be worth adding some minimal debug \nstatements to try to narrow down the bug.\n\nOther than that, I think we will need a simple test case that demonstrates the \nproblem, e.g. using Tomcat. Or it might be possible to use the Java Sampler to \ngenerate the data for the regex function.", "id": 58472, "time": "2004-06-01T16:50:17Z", "creator": "sebb@apache.org", "creation_time": "2004-06-01T16:50:17Z", "is_private": false}, {"count": 8, "tags": [], "creator": "vladimir@contera.sp.ru", "attachment_id": null, "id": 58613, "time": "2004-06-03T10:43:15Z", "bug_id": 29202, "creation_time": "2004-06-03T10:43:15Z", "is_private": false, "text": "Could you please say me what class or classes of JMeter perform the next \nactions: create RegexFunction objects and call the method execute()?  We tried \nto find but failed."}, {"count": 9, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "id": 58629, "time": "2004-06-03T12:41:38Z", "bug_id": 29202, "creation_time": "2004-06-03T12:41:38Z", "is_private": false, "text": "One way to find out where a method is called from is to add a log message to \nthe functions you are interested in, and include a throwable in the call, e.g.\n\nlog.debug(\"Called by\",new Throwable(\"Trace\"));\n\nAnother way is to use a Java IDE, e.g. Eclipse.\n\nBy the way, it might be worth trying adding \"synchronized\" to the regex \nfunction setup() call - I doubt that it will help, but it won't do any harm..."}, {"attachment_id": null, "tags": [], "bug_id": 29202, "is_private": false, "count": 10, "id": 89462, "time": "2006-05-25T02:19:46Z", "creator": "sebb@apache.org", "creation_time": "2006-05-25T02:19:46Z", "text": "I assume this is now fixed. If not, please re-open with further details"}]
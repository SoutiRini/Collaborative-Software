[{"count": 0, "tags": [], "bug_id": 41360, "attachment_id": null, "is_private": false, "id": 98016, "time": "2007-01-13T02:51:11Z", "creator": "henka@cityweb.co.za", "creation_time": "2007-01-13T02:51:11Z", "text": "Hello,\n\nApologies if this is not a bug, or already noted elsewhere.  I searched around\nbut found no mention of it.\n\nUsing apache 1.3.x or 2.0.x the following rewrite presents no problems:\n\nRewriteEngine on\nRewriteCond %{REQUEST_URI}\\?%{QUERY_STRING}\n\\&quot|awstats|xmlrpc|chmod|wget|echo|lynx|rsync [NC]\nRewriteRule   ^.* /log/index.php [NC,L]\n#\nRewriteCond %{HTTP_HOST} ^www\\.abc\\.com$ [NC]\nRewriteRule ^(.*)$ http://abc.com$1 [R=301,L]\n#\n#\nRewriteCond %{HTTP_HOST} ^www\\.sabc\\.com$ [NC]\nRewriteRule ^(.*)$ http://abc.com$1 [R=301,L]\n#\nRewriteCond %{HTTP_HOST} ^sabc\\.com$ [NC]\nRewriteRule ^(.*)$ http://abc.com$1 [R=301,L]\n\n\nHowever, with apache 2.2.3 and 2.2.4, the httpd process seems to go into an\nendless loop consuming more and more memory (3GB+ within a few seconds) very\nrapidly.\n\nUsing RewriteLog I can see that if one of the conditions are met, things work\nfine.  If NONE of the conditions are met (and it does a \"pass through\"), then\nthings go to neverland.\n\nDisabling mod_rewrite naturally makes the problem go away."}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "is_private": false, "id": 98017, "time": "2007-01-13T03:01:00Z", "bug_id": 41360, "creation_time": "2007-01-13T03:01:00Z", "text": "Please attach your rewritelog here. Furthermore it would be helpful if you can\nattach a gdb to such a process and obtain a stacktrace (see\nhttp://httpd.apache.org/dev/debugging.html#backtrace). Please execute the gdb\ncommand\nthread apply all bt full\nto obtain the stacktrace.\nWhat MPM are you using and what OS?"}, {"count": 2, "tags": [], "creator": "henka@cityweb.co.za", "attachment_id": null, "is_private": false, "id": 98018, "time": "2007-01-13T03:04:31Z", "bug_id": 41360, "creation_time": "2007-01-13T03:04:31Z", "text": "(In reply to comment #1)\n> Please attach your rewritelog here. Furthermore it would be helpful if you can\n> attach a gdb to such a process and obtain a stacktrace (see\n> http://httpd.apache.org/dev/debugging.html#backtrace). Please execute the gdb\n> command\n> thread apply all bt full\n> to obtain the stacktrace.\n> What MPM are you using and what OS?\n\nwow - that was quick response!\n\nOK - I'll attach the needed info in a few minutes.\nI'm using prefork, and it's on SUSE 10 linux (Linux zsearch0 2.6.16.21-0.8-smp\n#1 SMP Mon Jul 3 18:25:39 UTC 2006 x86_64 x86_64 x86_64 GNU/Linux)."}, {"count": 3, "tags": [], "bug_id": 41360, "text": "I was also going to mention (but got a mid-air collision):  the problem appears\nto be not only restricted to mod_rewrite.  It crops up occasionally with\nmod_rewrite disabled - so that was premature of me.  My apologies.", "id": 98019, "time": "2007-01-13T03:06:25Z", "creator": "henka@cityweb.co.za", "creation_time": "2007-01-13T03:06:25Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 41360, "text": "Recompiled with debug, and found that the problem is related to PHP/GD.  Please\naccept apologies for bogus bug:\n\n(gdb) where\n#0  php_gd_gdImageSetPixel (im=0x2b506b053790, x=439847419, y=-7, color=1) at\n/home/arc/apache/2007/modules/php/php-5.2.0/ext/gd/libgd/gd.c:750\n#1  0x00002b506ce4144c in php_gd_gdImageEllipse (im=0x2b506b053790, mx=<value\noptimized out>, my=0, w=<value optimized out>, h=<value optimized out>, c=1)\n    at /home/arc/apache/2007/modules/php/php-5.2.0/ext/gd/libgd/gd.c:1709\n#2  0x00002b506ce34036 in zif_imageellipse (ht=<value optimized out>,\nreturn_value=0x2b506b055bf0, return_value_ptr=<value optimized out>,\nthis_ptr=<value optimized out>,\n    return_value_used=<value optimized out>) at\n/home/arc/apache/2007/modules/php/php-5.2.0/ext/gd/gd.c:3328\n#3  0x00002b506d006cef in zend_do_fcall_common_helper_SPEC\n(execute_data=0x7fff3fad0c40) at\n/home/arc/apache/2007/modules/php/php-5.2.0/Zend/zend_vm_execute.h:200\n#4  0x00002b506cff669c in execute (op_array=0x8a2830) at\n/home/arc/apache/2007/modules/php/php-5.2.0/Zend/zend_vm_execute.h:92\n#5  0x00002b506d00677f in zend_do_fcall_common_helper_SPEC\n(execute_data=0x7fff3fad20d0) at\n/home/arc/apache/2007/modules/php/php-5.2.0/Zend/zend_vm_execute.h:234\n#6  0x00002b506cff669c in execute (op_array=0x2b506b042790) at\n/home/arc/apache/2007/modules/php/php-5.2.0/Zend/zend_vm_execute.h:92\n#7  0x00002b506cfd96f9 in zend_execute_scripts (type=8, retval=<value optimized\nout>, file_count=3) at /home/arc/apache/2007/modules/php/php-5.2.0/Zend/zend.c:1097\n#8  0x00002b506cf9a2fb in php_execute_script (primary_file=0x7fff3fad4620) at\n/home/arc/apache/2007/modules/php/php-5.2.0/main/main.c:1758\n#9  0x00002b506d056d11 in php_handler (r=0x895d68) at\n/home/arc/apache/2007/modules/php/php-5.2.0/sapi/apache2handler/sapi_apache2.c:592\n#10 0x000000000043a70c in ap_run_handler ()\n#11 0x000000000043afb1 in ap_invoke_handler ()\n#12 0x000000000044bdd8 in ap_process_request ()\n#13 0x0000000000448a92 in ap_process_http_connection ()\n#14 0x0000000000443c16 in ap_run_process_connection ()\n#15 0x000000000044404a in ap_process_connection ()\n#16 0x00000000004524dc in child_main ()\n#17 0x0000000000452678 in make_child ()\n#18 0x00000000004526e6 in startup_children ()\n#19 0x0000000000452ba0 in ap_mpm_run ()\n#20 0x00000000004215dd in main ()", "id": 98020, "time": "2007-01-13T03:17:24Z", "creator": "henka@cityweb.co.za", "creation_time": "2007-01-13T03:17:24Z", "is_private": false, "attachment_id": null}]
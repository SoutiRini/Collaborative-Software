[{"count": 0, "tags": [], "creator": "cfeldmann@rogers.com", "attachment_id": null, "id": 108783, "time": "2007-09-28T15:23:04Z", "bug_id": 43511, "creation_time": "2007-09-28T15:23:04Z", "is_private": false, "text": "While using bcel to read in and then write out an annotation that has a default\nvalue without making any changes to it, I discovered that the resulting class\ndid not contain the annotation default.  The annotation looks something like this:\n\n@Target(ElementType.TYPE) @Retention(RetentionPolicy.RUNTIME)\npublic @interface Foo\n{\n   String name() default \"\";\n}\n\nThe missing bytes caused a (very misleading) NoClassDefFoundError when I tried\nto load the new class.  \nWhen I tried to decompile the new class, I got this error:\nItemCollectionInvalidIndex: constants: requested 1280, limit 27\n\nAfter comparing the original class with the new class in a hex editor, I\ndetermined that the bytes for the AnnotationDefault were missing.  The problem\nis that the AnnotationDefault class does not have a dump method.  I added a dump\nmethod and this fixed the problem.  Here's a diff of the new method:\n\n$ svn diff\nIndex: src/main/java/org/apache/bcel/classfile/AnnotationDefault.java\n===================================================================\n--- src/main/java/org/apache/bcel/classfile/AnnotationDefault.java     \n(revision 573325)\n+++ src/main/java/org/apache/bcel/classfile/AnnotationDefault.java      (working\ncopy)\n@@ -18,6 +18,7 @@\n\n import java.io.DataInputStream;\n import java.io.IOException;\n+import java.io.DataOutputStream;\n import org.apache.bcel.Constants;\n\n /**\n@@ -105,4 +106,10 @@\n        {\n                throw new RuntimeException(\"Not implemented yet!\");\n        }\n+\n+    public final void dump(DataOutputStream dos) throws IOException\n+    {\n+      super.dump(dos);\n+      default_value.dump(dos);\n+    }\n }"}, {"text": "Thanks, applied to trunk", "tags": [], "creator": "tcurdt@apache.org", "is_private": false, "count": 1, "id": 108791, "time": "2007-09-29T02:30:07Z", "bug_id": 43511, "creation_time": "2007-09-29T02:30:07Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 59164, "attachment_id": null, "id": 189350, "time": "2016-03-11T02:00:32Z", "creator": "shimizuhiroto123@gmail.com", "creation_time": "2016-03-11T02:00:32Z", "is_private": false, "text": "If host names were not resolved , and first access(curl http://localhost/).\nAfter that , crash occurred.\nThis behavior is 1.2.38 or later.\n\n---configuration\nJkMount /* worker1\nworker.list=worker1\nworker.worker1.type=ajp13\nworker.worker1.host=testhost\n---\n\n---mod_jk.log\n[Tue Feb 23 17:24:08.475 2016] [14936:140647557949504] [error] ajp_validate::jk_ajp_common.c (2867): worker worker1 can't resolve tomcat address testhost\n[Tue Feb 23 17:24:08.475 2016] [14936:140647557949504] [info] init_jk::mod_jk.c (3591): mod_jk/1.2.41 initialized\n[Tue Feb 23 17:24:08.509 2016] [14936:140647557949504] [error] ajp_validate::jk_ajp_common.c (2867): worker worker1 can't resolve tomcat address testhost\n[Tue Feb 23 17:24:08.510 2016] [14936:140647557949504] [info] init_jk::mod_jk.c (3591): mod_jk/1.2.41 initialized\n[Tue Feb 23 17:24:25.218 2016] [14938:140647313106688] [error] jk_open_socket::jk_connect.c (639): socket() failed (errno=97)\n---\n\n---error_log\n[Tue Feb 23 17:24:08.511135 2016] [mpm_worker:notice] [pid 14936:tid 140647557949504] AH00292: Apache/2.4.6 (CentOS) mod_jk/1.2.41 configured -- resuming normal operations\n[Tue Feb 23 17:24:08.511173 2016] [core:notice] [pid 14936:tid 140647557949504] AH00094: Command line: '/usr/sbin/httpd -D FOREGROUND'\n[Tue Feb 23 17:24:26.531681 2016] [core:notice] [pid 14936:tid 140647557949504] AH00051: child pid 14938 exit signal Segmentation fault (11), possible coredump in /tmp\n---\n\nHostname were not resolved in apr_sockaddr_info_get() , and JK_FALSE is returned.\ninet_ntop6() caused segmentation fault, because of saddr=null.\n\n---jk_connect.c\n:\nint jk_resolve(const char *host, int port, jk_sockaddr_t *saddr,\n               void *pool, int prefer_ipv6, jk_logger_t *l)\n{\n:\n    memset(saddr, 0, sizeof(jk_sockaddr_t));\n:\n        if (apr_sockaddr_info_get(&remote_sa, host, APR_UNSPEC, (apr_port_t)port,\n                                  0, jk_apr_pool) != APR_SUCCESS) {\n            JK_TRACE_EXIT(l);\n            return JK_FALSE;\n        }\n---\n\n---\n# gdb /usr/sbin/httpd core.14938\n:\n(gdb) bt\n#0  inet_ntop6 (src=0x0, dst=dst@entry=0x7feb0122c750 \"\\030\", size=size@entry=64) at jk_connect.c:1201\n#1  0x00007feb02289691 in jk_dump_hinfo (saddr=0x7feb1013e258, buf=buf@entry=0x7feb0122c750 \"\\030\", size=size@entry=64) at jk_connect.c:1293\n#2  0x00007feb022a7fcb in ajp_connect_to_endpoint (ae=ae@entry=0x7feb1019e1a0, l=l@entry=0x7feb1016e840) at jk_ajp_common.c:1068\n#3  0x00007feb022a93ab in ajp_send_request (e=0x7feb101a01f0, op=<synthetic pointer>, ae=0x7feb1019e1a0, l=0x7feb1016e840, s=0x7feb0122c9e0) at jk_ajp_common.c:1727\n#4  ajp_service (e=0x7feb101a01f0, s=0x7feb0122c9e0, l=0x7feb1016e840, is_error=0x7feb0122c994) at jk_ajp_common.c:2639\n:\n(gdb) f 1\n#1  0x00007feb02289691 in jk_dump_hinfo (saddr=0x7feb1013e258, buf=buf@entry=0x7feb0122c750 \"\\030\", size=size@entry=64) at jk_connect.c:1293\n1293            inet_ntop6(saddr->ipaddr_ptr, buf, size);\n(gdb) p *saddr\n$1 = {family = 0, port = 0, salen = 0, ipaddr_len = 0, ipaddr_ptr = 0x0, sa = {sin = {sin_family = 0, sin_port = 0, sin_addr = {s_addr = 0},\n      sin_zero = \"\\000\\000\\000\\000\\000\\000\\000\"}, sin6 = {sin6_family = 0, sin6_port = 0, sin6_flowinfo = 0, sin6_addr = {__in6_u = {__u6_addr8 = '\\000' <repeats 15 times>,\n          __u6_addr16 = {0, 0, 0, 0, 0, 0, 0, 0}, __u6_addr32 = {0, 0, 0, 0}}}, sin6_scope_id = 0}, sas = {ss_family = 0, __ss_align = 0, __ss_padding = '\\000' <repeats 111 times>}}}\n---"}, {"count": 1, "tags": [], "bug_id": 59164, "attachment_id": null, "id": 193684, "time": "2016-09-13T21:29:40Z", "creator": "markt@apache.org", "creation_time": "2016-09-13T21:29:40Z", "is_private": false, "text": "Thanks for the report and the back trace. This has been fixed in trunk and will be included in 1.2.42 onwards."}]
[{"count": 0, "tags": [], "creator": "epikhinm@gmail.com", "text": "Created attachment 31806\nadding threadLocal support\n\nHello comrades!\n\nI have a problem with big testplan and many If controllers using jexl2 with complex expressions.\nMany threads are locking on JexlEngine. So, JMeter support jdk 1.6+, maybe we should start to use ThreadLocal?:)\n\nThreadLocal support in java since 1.6 http://docs.oracle.com/javase/6/docs/api/java/lang/ThreadLocal.html\n\nThis simple patch scaleup overall throughput of my test. I think we can commit it and increase performance of logic controllers:)\n\nWhat about add similar patches for other functions? It would be nice!", "id": 176327, "time": "2014-07-10T14:40:03Z", "bug_id": 56708, "creation_time": "2014-07-10T14:40:03Z", "is_private": false, "attachment_id": 31806}, {"count": 1, "tags": [], "bug_id": 56708, "attachment_id": null, "text": "Method \"getJexlEngine\" should be static. My fault.", "id": 176328, "time": "2014-07-10T14:53:03Z", "creator": "epikhinm@gmail.com", "creation_time": "2014-07-10T14:53:03Z", "is_private": false}, {"count": 2, "tags": [], "text": "Hello,\nThanks for analysis and contribution.\nWould it be possible to attach the proof of contention in the Bugzilla ?\nUsing ThreadLocal might impact memory usage negatively (note by the way it is used frequently in JMeter :-) ) even before JDK6.\n\n\nThanks\n@ubikloadpack", "attachment_id": null, "bug_id": 56708, "id": 176329, "time": "2014-07-10T14:56:27Z", "creator": "support@ubikloadpack.com", "creation_time": "2014-07-10T14:56:27Z", "is_private": false}, {"attachment_id": 31807, "tags": [], "bug_id": 56708, "text": "Created attachment 31807\n1024 threads are blocked on one jexl2 execute method", "count": 3, "id": 176330, "time": "2014-07-10T15:16:18Z", "creator": "epikhinm@gmail.com", "creation_time": "2014-07-10T15:16:18Z", "is_private": false}, {"count": 4, "tags": [], "creator": "epikhinm@gmail.com", "text": "I can't attach test-case for NDA reasons. In test-case i have problems on throughput ~200rps. Applying patch increased throughput to 700rps and system under test are broken under load.", "id": 176331, "time": "2014-07-10T15:19:59Z", "bug_id": 56708, "creation_time": "2014-07-10T15:19:59Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "epikhinm@gmail.com", "attachment_id": null, "id": 176349, "time": "2014-07-11T08:05:04Z", "bug_id": 56708, "creation_time": "2014-07-11T08:05:04Z", "is_private": false, "text": "For decrease memory consumption we can use method setCache(int size) of JexlEngine. By default Jmeter have cache size 512 per jexl instance. We can decrease than parameter or set value from jmeter configs."}, {"count": 6, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Affects version from at least 2.5 up to 2.11", "id": 176363, "time": "2014-07-12T13:25:09Z", "bug_id": 56708, "creation_time": "2014-07-12T13:25:09Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Hello,\nThanks for contribution.\nCommited with addition of ThreadListener interface implementation to cleanup thread local at thread end.\n\nIf you can test nightly build and give feedback, it would be great.\nThanks\n\n\nDate: Sat Jul 12 13:30:51 2014\nNew Revision: 1609915\n\nURL: http://svn.apache.org/r1609915\nLog:\nBug 56708 - __jexl2 doesn't scale with multiple CPU cores\nBugzilla Id: 56708\n\nModified:\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/Jexl2Function.java\n    jmeter/trunk/xdocs/changes.xml", "id": 176364, "time": "2014-07-12T13:32:30Z", "bug_id": 56708, "creation_time": "2014-07-12T13:32:30Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 56708, "attachment_id": null, "text": "Thank you, folks!:)", "id": 176372, "time": "2014-07-12T17:48:23Z", "creator": "epikhinm@gmail.com", "creation_time": "2014-07-12T17:48:23Z", "is_private": false}]
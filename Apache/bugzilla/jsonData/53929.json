[{"count": 0, "text": "The following .htaccess configuration worked fine in 2.2.21:\n\n  RewriteCond %{DOCUMENT_ROOT}/index-cached.html -f\n  RewriteRule ^$ /index-cached.html [L]\n\n  RewriteCond %{DOCUMENT_ROOT}/$1-cached.html -f\n  RewriteRule ^([^/]+?)/$ /$1-cached.html [L]\n\n  RewriteRule ^index\\.php$ - [L]\n  RewriteCond %{REQUEST_FILENAME} !-f\n  RewriteRule . /index.php [L]\n\nwhere browsing to \"http://test.local\" returns the contents of index-cached.html correctly.\n\nHowever, in 2.4.2, processing falls through to index.php, even though the logs seem to indicate that the first condition was matched:\n\n  [rid#13ad0b0/initial] [perdir C:/test/] strip per-dir prefix: C:/test/ ->\n  [rid#13ad0b0/initial] [perdir C:/test/] applying pattern '^$' to uri ''\n  [rid#13ad0b0/initial] [perdir C:/test/] RewriteCond: input='C:/test/index-cached.html' pattern='-f' => matched\n  [rid#13ad0b0/initial] [perdir C:/test/] rewrite '' -> '/index-cached.html'\n  [rid#13ad0b0/initial] [perdir C:/test/] trying to replace prefix C:/test/ with /\n  [rid#13ad0b0/initial] [perdir C:/test/] internal redirect with /index-cached.html [INTERNAL REDIRECT]\n  [rid#13b30c8/subreq] [perdir C:/test/] strip per-dir prefix: C:/test/index.php -> index.php\n  [rid#13b30c8/subreq] [perdir C:/test/] applying pattern '^$' to uri 'index.php'\n  [rid#13b30c8/subreq] [perdir C:/test/] strip per-dir prefix: C:/test/index.php -> index.php\n  [rid#13b30c8/subreq] [perdir C:/test/] applying pattern '^([^/]+?)/$' to uri 'index.php'\n  [rid#13b30c8/subreq] [perdir C:/test/] strip per-dir prefix: C:/test/index.php -> index.php\n  [rid#13b30c8/subreq] [perdir C:/test/] applying pattern '^index\\\\.php$' to uri 'index.php'\n  [rid#13b30c8/subreq] [perdir C:/test/] pass through C:/test/index.php\n\nNotice that after the \"initial\" request finishes, a \"subreq\" is generated, whereas \"initial/redir#1\" was expected.\n\nBoth of my 2.2.21 and 2.4.2 environments have mod_dir enabled, which may or may not have bearing on this issue.\n\nNote also that the second rule works in both versions; that is, browsing to \"http://test.local/a/\" correctly returns the contents of a-cached.html.", "bug_id": 53929, "attachment_id": null, "id": 162368, "time": "2012-09-24T09:03:43Z", "creator": "victor.shih@gmail.com", "creation_time": "2012-09-24T09:03:43Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 53929, "is_private": false, "text": "I am also experiencing this issue. The issue is caused by the DirectoryIndex directive. mod_dir is not respecting the result of the rewrite execution. If DirectoryIndex is set to disabled, it starts working correctly. Similarly, using SetHandler also resolved the problem.\n\nUnfortunately, since both the directives are inherited by files/sub directories, it is not a proper solution.\n\nI was able to work around it by setting an environment variable using the mod_rewrite, and Disabling DirectoryIndex for those requests.\n\n    RewriteEngine on \n    RewriteRule ^$ /test/home.php [NC,QSA,END,E=IS_DIR_INDEX:1] \n\n    <If \"env('IS_DIR_INDEX') == 1\"> \n    SetHandler default_handler \n    </If> \n\nThere is a related issue which is present in 2.2 too. DirectoryIndex directive does not pass requests for directories to FallbackResource, if the index file is not found.", "id": 168952, "time": "2013-07-30T16:29:08Z", "creator": "contact@joycebabu.com", "creation_time": "2013-07-30T16:29:08Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 53929, "text": "Not so useful as I thought, but maybe it could help someone. Using git-bisect I've found out this is caused by following commit:\n\nhttp://svn.apache.org/viewvc?view=revision&revision=233369", "id": 170067, "attachment_id": null, "creator": "jkaluza@redhat.com", "creation_time": "2013-09-12T12:48:30Z", "time": "2013-09-12T12:48:30Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jkaluza@redhat.com", "is_private": false, "text": "Created attachment 30827\nproposed patch\n\nThis patch fixes this issue for me without breaking ABI. Normally r->uri and r->filename ends with \"/\" in the case of directory request. If mod_rewrite rewrites URL later in hook_fixup, it changes r->filename. In this patch, I check if the r->filename still ends with \"/\" and if not, return DECLINED in mod_dir fixup hook.\n\nI think there is still problem if you rewrite r->filename from directory to directory, but it should fix case when you rewrite from directory to file. I don't see immediate solution for directory to directory rewrite.", "id": 170080, "time": "2013-09-13T05:45:47Z", "bug_id": 53929, "creation_time": "2013-09-13T05:45:47Z", "attachment_id": 30827}, {"count": 4, "tags": [], "bug_id": 53929, "attachment_id": null, "id": 171534, "time": "2013-12-02T17:48:13Z", "creator": "john@zerocrates.org", "creation_time": "2013-12-02T17:48:13Z", "is_private": false, "text": "The same issue seems to still be present as of 2.4.6.\n\nI see the same behavior described here: for the \"initial\" request, my rule is applied as I expect, the substitution happens and there's an [INTERNAL REDIRECT] with my correct, desired URL. Then, the next log lines are all \"subreq\" and are operating on the DirectoryIndex file. Basically, DirectoryIndex seems to take precedence over RewriteRules.\n\nThese same rules work correctly in 2.2, and disabling DirectoryIndex allows the rewrite to take place as expected.\n\nThis also seems to be the same problem as described in Bug 53794. There is a different proposed patch there."}, {"count": 5, "tags": [], "creator": "markjenkins@mailfish.de", "attachment_id": null, "text": "I have the same problem here. Any chance to see a fix soon? This bug has been around for more than a year now and it's pretty annoying.", "id": 171854, "time": "2013-12-20T12:32:36Z", "bug_id": 53929, "creation_time": "2013-12-20T12:32:36Z", "is_private": false}, {"count": 6, "text": "Hi Jan, can you check out the approach these two commits before I propose them for backport?\n\nhttp://svn.apache.org/r1557640\nhttp://svn.apache.org/r1557641", "bug_id": 53929, "is_private": false, "id": 172317, "time": "2014-01-13T01:54:18Z", "creator": "covener@gmail.com", "creation_time": "2014-01-13T01:54:18Z", "tags": [], "attachment_id": null}, {"count": 7, "text": "I see that there's a related commit(s) for this on the trunk.\n\nIs there any chance of seeing this fixed in the 2.4 series?", "bug_id": 53929, "is_private": false, "id": 174375, "time": "2014-04-08T19:05:42Z", "creator": "john@zerocrates.org", "creation_time": "2014-04-08T19:05:42Z", "tags": [], "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 53929, "attachment_id": null, "id": 174376, "time": "2014-04-08T19:09:06Z", "creator": "covener@gmail.com", "creation_time": "2014-04-08T19:09:06Z", "is_private": false, "text": "(In reply to John Flatness from comment #7)\n> I see that there's a related commit(s) for this on the trunk.\n> \n> Is there any chance of seeing this fixed in the 2.4 series?\n\nCan you test with the patches in the previous comment?(In reply to John Flatness from comment #7)\n> I see that there's a related commit(s) for this on the trunk.\n> \n> Is there any chance of seeing this fixed in the 2.4 series?\n\nCan you try with 2.4.9? Supposd to be fixed there."}, {"count": 9, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "text": "> Can you test with the patches in the previous comment?(In reply to John\n> Flatness from comment #7)\n\nignore this part in last comment, forgot it was actually backported and available in 2.4.9.", "id": 174377, "time": "2014-04-08T19:09:35Z", "bug_id": 53929, "creation_time": "2014-04-08T19:09:35Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 53929, "attachment_id": null, "text": "Aha, thanks for that update. 2.4.9 does appear to fix the problem I was having.\n\nThe behavior now seems to be consistent with 2.2, and a rewrite rule that conflicts with a DirectoryIndex gets applied.", "id": 174391, "time": "2014-04-09T05:18:04Z", "creator": "john@zerocrates.org", "creation_time": "2014-04-09T05:18:04Z", "is_private": false}, {"count": 11, "tags": [], "creator": "covener@gmail.com", "text": "Thanks for testing", "id": 174392, "time": "2014-04-09T05:56:17Z", "bug_id": 53929, "creation_time": "2014-04-09T05:56:17Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "id": 174739, "time": "2014-04-20T18:14:05Z", "bug_id": 53929, "creation_time": "2014-04-20T18:14:05Z", "is_private": false, "text": "*** Bug 56434 has been marked as a duplicate of this bug. ***"}]
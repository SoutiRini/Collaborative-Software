[{"count": 0, "tags": [], "bug_id": 35280, "attachment_id": null, "id": 76193, "time": "2005-06-09T10:03:09Z", "creator": "timo.viipuri@f-secure.com", "creation_time": "2005-06-09T10:03:09Z", "is_private": false, "text": "The logic in making passive connections through FTP proxy are correctly\nimplemented in Apache, i.e. first try to use EPSV -> if that fails, try PASV\n-> if that fails, try PORT. However, only error codes 500 (\"Syntax error,\ncommand unrecognized\"), 501 (\"Syntax error in parameters or arguments\") and\n502 (\"Command not implemented\") are accepted for the decision of trying to use\nPASV if EPSV fails. For all other error codes, the connection is reseted.\n\nIn RFC 2428, it is stated that if the server doesn't support EPSV it MUST return\nerror message 522 (\"Protocol not supported\"). I think Apache should be changed\nso that PASV is tried when receiving message 522 as well.\n\nAlso, some firewall vendors (at least Checkpoint) seem to have adopted the\nchoice of returning error message 505 (\"Command Blocked\") if the firewall\ndoesn't allow EPSV to be passed. Thus, it should also be included that PASV is\ntried in Apache when receiving message 505 as well."}, {"count": 1, "tags": [], "bug_id": 35280, "is_private": false, "text": "Created attachment 15344\nPatch to fix bug 35280", "id": 76194, "time": "2005-06-09T10:08:16Z", "creator": "timo.viipuri@f-secure.com", "creation_time": "2005-06-09T10:08:16Z", "attachment_id": 15344}, {"count": 2, "tags": [], "text": "Added patch which makes ftp_proxy try to use PASV if message 522 (\"Protocol not\nsupported\") or 505 (\"Command blocked\") is received when trying to use EPSV.", "is_private": false, "id": 76196, "creator": "timo.viipuri@f-secure.com", "time": "2005-06-09T10:10:54Z", "bug_id": 35280, "creation_time": "2005-06-09T10:10:54Z", "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "lhboi@yahoo.com", "is_private": false, "id": 89692, "time": "2006-06-02T10:11:56Z", "bug_id": 35280, "creation_time": "2006-06-02T10:11:56Z", "tags": [], "text": "Some server like download.fedora.redhat.com \n     220 Fedora FTP server ready. All transfers are logged. [no EPSV]\nreturns \"550 Permission denied.\" to EPSV, and accepts PASV command.\n\nApache FTP proxy should fall back to PASV when receiving 550 too.\n"}, {"count": 4, "tags": [], "text": "Created attachment 20730\nUpdating to mod_proxy_ftp.c, includes the codes requested in comments, and is more lenient\n\nUpdating to the new mod_proxy_ftp.c file.\nThis patch checks only if the return code is a 5XX variety for EPSV as a\ncondition\nfor falling back to PASV. This is smaller and faster than checking for multiple\n\nint values too.", "attachment_id": 20730, "id": 107411, "creator": "rahul.g.nair@gmail.com", "time": "2007-08-29T11:16:12Z", "bug_id": 35280, "creation_time": "2007-08-29T11:16:12Z", "is_private": false}, {"count": 5, "tags": [], "creator": "chead@chead.ca", "text": "Some old firewalls seem not to even understand the EPSV command, but rather pass it through intact. This of course prevents the data connection from being properly established. It would be nice if either (1) a failure to establish the data connection would cause a fallback to PASV, or (2) an option were provided in the configuration to not use ESPV at all. #2 is preferable, of course, because it eliminates the delay while waiting for the data connection to time out.", "id": 121884, "time": "2008-10-26T13:21:09Z", "bug_id": 35280, "creation_time": "2008-10-26T13:21:09Z", "is_private": false, "attachment_id": null}]
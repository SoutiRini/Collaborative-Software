[{"count": 0, "tags": [], "creator": "ismeet@ms-technology.com", "attachment_id": null, "id": 191344, "time": "2016-06-01T14:11:12Z", "bug_id": 59649, "creation_time": "2016-06-01T14:11:12Z", "is_private": false, "text": "With this tomcat version. Working under stress with http POST calls being fired for uploading and downloading of files. After about 10 to 15 into the test we started seeing broken responses.\n\nOn investigating the logs we noticed below errors:\n\n01-Jun-2016 18:52:16.153 INFO [http-nio-8080-exec-2] org.apache.coyote.http11.Http11Processor.service Error parsing HTTP request header\n Note: further occurrences of HTTP header parsing errors will be logged at DEBUG level.\n java.lang.IllegalStateException: Unexpected state: headers already parsed. Buffer not recycled?\n\tat org.apache.coyote.http11.Http11InputBuffer.parseHeaders(Http11InputBuffer.java:589)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1002)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:788)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1485)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Unknown Source)\n\n01-Jun-2016 18:52:16.154 SEVERE [http-nio-8080-exec-4] org.apache.coyote.http11.Http11Processor.service Error processing request\n java.lang.NullPointerException\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:389)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1102)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:788)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1485)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Unknown Source)\n\n01-Jun-2016 18:52:16.160 SEVERE [http-nio-8080-exec-4] org.apache.coyote.http11.Http11Processor.endRequest Error finishing response\n java.lang.NullPointerException\n\tat org.apache.coyote.http11.Http11OutputBuffer.commit(Http11OutputBuffer.java:351)\n\tat org.apache.coyote.http11.Http11Processor.action(Http11Processor.java:646)\n\tat org.apache.coyote.http11.Http11Processor.endRequest(Http11Processor.java:1785)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1143)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:788)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1485)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Unknown Source)"}, {"count": 1, "tags": [], "bug_id": 59649, "attachment_id": null, "text": "Steps to reproduce please. We need the minimal possible test case that demonstrates the issue.", "id": 191346, "time": "2016-06-01T15:09:43Z", "creator": "markt@apache.org", "creation_time": "2016-06-01T15:09:43Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 59649, "text": "Dropping severity to default.", "id": 191347, "attachment_id": null, "creator": "markt@apache.org", "creation_time": "2016-06-01T15:10:14Z", "time": "2016-06-01T15:10:14Z", "is_private": false}, {"count": 3, "tags": [], "creator": "zmircmircea@gmail.com", "text": "I have just experienced this error with 8.5.4\nExactly identical logs.\nThe solution was to restart the server. I set the log level on DEBUG, so now I'll have more info when it happens again.", "id": 193303, "time": "2016-08-24T12:05:04Z", "bug_id": 59649, "creation_time": "2016-08-24T12:05:04Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 59649, "attachment_id": null, "is_private": false, "id": 193304, "time": "2016-08-24T12:08:52Z", "creator": "zmircmircea@gmail.com", "creation_time": "2016-08-24T12:08:52Z", "text": "Here is my stacktrace with Tomcat 8.5.4. Seems to be almost identical:\n\n2016-08-24 07:48:38,236 INFO  [http-nio-8080-exec-10] o.a.coyote.http11.Http11Processor DirectJDKLog.java:181 Error parsing HTTP request header\n Note: further occurrences of HTTP header parsing errors will be logged at DEBUG level.\njava.lang.IllegalStateException: Unexpected state: headers already parsed. Buffer not recycled?\n\tat org.apache.coyote.http11.Http11InputBuffer.parseHeaders(Http11InputBuffer.java:587)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1010)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:785)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1425)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:745)\n2016-08-24 07:48:38,255 ERROR [http-nio-8080-exec-6] o.a.c.c.C.[.[.[.[.w.w.a.b.p.ApiProjectList] DirectJDKLog.java:181 Servlet.service() for servlet [dk.wordmaps.wordmaps4.api.boundary.project.ApiProjectList] in context with path [/api] threw exception\njava.lang.NullPointerException: null\n\tat org.apache.catalina.connector.Request.getServletContext(Request.java:1618)\n\tat org.apache.catalina.connector.Request.getContextPath(Request.java:1975)\n\tat org.apache.catalina.connector.RequestFacade.getContextPath(RequestFacade.java:784)\n\tat dk.wordmaps.wordmaps4.api.boundary.util.security.StatelessSecurityFilter.doFilter(StatelessSecurityFilter.java:58)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n\tat dk.wordmaps.wordmaps4.api.boundary.util.UTF8ServletFilter.doFilter(UTF8ServletFilter.java:25)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:522)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:79)\n\tat ch.qos.logback.access.tomcat.LogbackValve.invoke(LogbackValve.java:256)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:349)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1110)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:785)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1425)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:745)\n2016-08-24 07:48:38,256 ERROR [http-nio-8080-exec-6] o.a.c.c.C.[Catalina].[localhost] DirectJDKLog.java:181 Exception Processing null\njava.lang.NullPointerException: null\n\tat org.apache.catalina.connector.Request.notifyAttributeAssigned(Request.java:1519)\n\tat org.apache.catalina.connector.Request.setAttribute(Request.java:1505)\n\tat org.apache.catalina.core.StandardWrapperValve.exception(StandardWrapperValve.java:313)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:249)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:522)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:79)\n\tat ch.qos.logback.access.tomcat.LogbackValve.invoke(LogbackValve.java:256)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:349)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1110)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:785)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1425)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:745)\n2016-08-24 07:48:38,257 ERROR [http-nio-8080-exec-6] o.a.coyote.http11.Http11Processor DirectJDKLog.java:181 Error processing request\njava.lang.NullPointerException: null\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:389)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1110)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:785)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1425)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:745)\n2016-08-24 07:48:38,257 ERROR [http-nio-8080-exec-6] o.a.coyote.http11.Http11Processor DirectJDKLog.java:181 Error finishing response\njava.lang.NullPointerException: null\n\tat org.apache.coyote.http11.Http11OutputBuffer.commit(Http11OutputBuffer.java:351)\n\tat org.apache.coyote.http11.Http11Processor.action(Http11Processor.java:658)\n\tat org.apache.coyote.http11.Http11Processor.endRequest(Http11Processor.java:1786)\n\tat org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1149)\n\tat org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n\tat org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:785)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1425)\n\tat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:745)"}, {"count": 5, "tags": [], "bug_id": 59649, "text": "As a continuation to my previous 2 comments...\n\nThe Tomcat 8.5.4 server was started yesterday at noon. Everything was fine.\nBy midnight, this error appeared, then most of the POST request triggered this error, even though the requests were totally identical to those sent between noon and midnight.\n\nThe solution was to restart Tomcat.", "id": 193305, "attachment_id": null, "creator": "zmircmircea@gmail.com", "creation_time": "2016-08-24T12:20:26Z", "time": "2016-08-24T12:20:26Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 59649, "attachment_id": null, "text": "Restoring state to NEDDINFO. Absent a way to reproduce this, there is little we can do to investigate.", "id": 193307, "time": "2016-08-24T12:59:37Z", "creator": "markt@apache.org", "creation_time": "2016-08-24T12:59:37Z", "is_private": false}, {"count": 7, "tags": [], "creator": "markt@apache.org", "text": "No test case has been provided so this is being resolved as works for me. Should a test case be provided that demonstrates this issue, it can be re-opened.", "id": 194769, "time": "2016-11-02T09:35:11Z", "bug_id": 59649, "creation_time": "2016-11-02T09:35:11Z", "is_private": false, "attachment_id": null}]
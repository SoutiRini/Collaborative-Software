[{"count": 0, "tags": [], "text": "If using the File-Upload with Servlet 3.1 and selecting a file with name e.g. foo\"bar\".jpg the method call part.getHeader(\"Content-Disposition\") results to e.g. form-data; name=\"file\"; filename=\"foo-\\\"bar\\\".jpg\".\n\nThe call of part.getSubmittedFileName() results to foo-\\\"bar\\\".jpg but should foo-\"bar\".jpg because the quotes are not part of the name.\n\nThe parsing problem may also affect other functions...", "is_private": false, "id": 189087, "creator": "lofwyr@apache.org", "time": "2016-03-04T10:43:23Z", "bug_id": 59115, "creation_time": "2016-03-04T10:43:23Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Thanks for the report. The submitted file name is either a token or quoted-string and we weren't handling the quoted-string case.\n\nThis has been fixed for 9.0.x (9.0.0.M4 onwards), 8.0.x (8.0.33 onwards) and 7.0.x (7.0.69 onwards).", "id": 189109, "time": "2016-03-04T17:29:34Z", "bug_id": 59115, "creation_time": "2016-03-04T17:29:34Z", "is_private": false}, {"count": 2, "tags": [], "text": "Thanks for the quick response. I've just testet it with 8.0/trunk but it there was an Exception:\nThe replaceAll need a regexp, and so the quoted backslash needs to be quoted again:\nreplaceAll(\"\\\\\\\\\", \"\") instead of replaceAll(\"\\\\\", \"\")", "is_private": false, "id": 189110, "creator": "lofwyr@apache.org", "time": "2016-03-04T19:26:46Z", "bug_id": 59115, "creation_time": "2016-03-04T19:26:46Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "lofwyr@apache.org", "attachment_id": null, "text": "I've made some tests with different browsers and I found these encodings in the filename part:\n\n(filename) -> (content-disposition)\n: -> :\n/ -> :\n\\ -> \\\n\\\\ -> \\\n\" -> \\\" (Firefox) and %22 (Chrome+Safari)\n%22 -> %22\n\nThis leads to 3 problems:\n1. The resulting string : doesn't differ between : and / so there is not possibility to know what was the source.\n2. The resulting string \\ doesn't differ between \\\\ and \\ so there is also not possibility to find the source.\n3. In Chrome+Safari we cannot differ between \" and %22\n\nI know these character are unusual, but not invalid on some OS.\n\nFor the moment I have best results with this code:\n\nfileName = fileName.trim().replaceAll(\"\\\\\\\\\\\\\\\"\", \"\\\"\"); // replaces \\\" with \"\n\nI don't know which RFC is relevant here? But it looks for me, that we have different file names \nresulting in same header information.", "id": 189119, "time": "2016-03-04T21:34:30Z", "bug_id": 59115, "creation_time": "2016-03-04T21:34:30Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 59115, "attachment_id": null, "id": 189139, "time": "2016-03-05T16:07:00Z", "creator": "markt@apache.org", "creation_time": "2016-03-05T16:07:00Z", "is_private": false, "text": "I've fixed the initial exception.\n\nThe relevant spec here is RFC6266. I'm leaving this issue open until I have a chance to look through that spec."}, {"count": 5, "tags": [], "text": "This has been fixed so Tomcat follows RFC 6266.\n\nIf some UAs do strange things outside of RFC 6266 then bugs need to be raised with those browsers in the first instance.", "attachment_id": null, "id": 189146, "creator": "markt@apache.org", "time": "2016-03-05T18:30:17Z", "bug_id": 59115, "creation_time": "2016-03-05T18:30:17Z", "is_private": false}, {"count": 6, "tags": [], "text": "This Change destroy the file upload in Internet-Explorer 11.\n\nThe \"Content-Disposition\" Header contains the filename with path \nform-data; name=\"Datei\"; filename=\"D:\\temp\\test.xml\".\nThe call of part.getSubmittedFileName() return \"D:temptest.xml\". Befor this change it returns \"D:\\temp\\test.xml\".", "is_private": false, "id": 192499, "creator": "marco@lordzodiac.de", "time": "2016-07-18T19:21:20Z", "bug_id": 59115, "creation_time": "2016-07-18T19:21:20Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 59115, "attachment_id": null, "is_private": false, "id": 192525, "time": "2016-07-19T10:55:03Z", "creator": "markt@apache.org", "creation_time": "2016-07-19T10:55:03Z", "text": "IE 11 is not specification compliant. As per comment #5, you'll need to raise a bug with Microsoft in the first instance. In the meantime, you can manually parse the header yourself with custom rules for IE11 if you need that information.\n\nIf Microsoft refuse to fix the bug then you should open a new enhancement request for Tomcat to apply special handling in this case. There is no guarantee that such an enhancement request will be implemented. The Tomcat team generally does not implement work-arounds for bugs in third-party code."}, {"count": 8, "tags": [], "text": "Sending full file path is a rather odd and insecure behaviour. Is this IE 11 not up-to-date, or does this behaviour depend on its security settings (e.g. server being in trusted network)?\n\nSome links\n\nhttps://tools.ietf.org/html/rfc6266\nhttps://tools.ietf.org/html/rfc1867\nhttps://www.w3.org/TR/2014/REC-html5-20141028/forms.html#file-upload-state-(type=file)\nhttp://commons.apache.org/proper/commons-fileupload/", "is_private": false, "id": 192530, "creator": "knst.kolinko@gmail.com", "time": "2016-07-19T13:00:45Z", "bug_id": 59115, "creation_time": "2016-07-19T13:00:45Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 59115, "is_private": false, "count": 9, "id": 192538, "time": "2016-07-19T19:13:33Z", "creator": "marco@lordzodiac.de", "creation_time": "2016-07-19T19:13:33Z", "text": "This option is in all Internet Explorer Version (8,9,10,11) for local and trusted networks present. The entry name is \" Include local directory path when uploading files to a server\". This entry is default enabled for trusted networks.\nI don't need this information. But when the \"\\\" character is removed i has no chance to extract the correct filename."}, {"count": 10, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "*** Bug 59891 has been marked as a duplicate of this bug. ***", "id": 192564, "time": "2016-07-21T19:54:58Z", "bug_id": 59115, "creation_time": "2016-07-21T19:54:58Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "This needs further investigation.\n\nUsing RFC 6266 is an error: it defines a response header, not a request one.\n\nSection \"1. Introduction\" of RFC 6266 has the following note:\n\n      Note: This document does not apply to Content-Disposition header\n      fields appearing in payload bodies transmitted over HTTP, such as\n      when using the media type \"multipart/form-data\" ([RFC2388]).\n\nLinks:\nhttps://tools.ietf.org/html/rfc6266\nhttps://tools.ietf.org/html/rfc2388 (Obsoleted by: 7578)\nhttps://tools.ietf.org/html/rfc7578", "is_private": false, "id": 192625, "creator": "knst.kolinko@gmail.com", "time": "2016-07-25T14:28:05Z", "bug_id": 59115, "creation_time": "2016-07-25T14:28:05Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "So, starting with RFC7578:\nSection 4.2 points to RFC2183 for the definition of the content disposition header.\n\nRFC2183 defines:\nfilename-parm := \"filename\" \"=\" value\nand points to RFC2045 for value\n\nRFC2045\nvalue := token / quoted-string\nand points to RFC822\n\nRFC822:\nquoted-string = <\"> *(qtext/quoted-pair) <\">\n\nqtext         =  <any CHAR excepting <\">,\n                  \"\\\" & CR, and including\n                  linear-white-space>\n\nAnd this is what Tomcat currently implements.\n\nThere are lots up updates to these RFCs around i18n values. Browsers don't seem to be using them. We can update Tomcat if / when browsers start supporting them.\n\nOn the grounds Tomcat is adhering to the relevant RFCs and IE is not, I am re-resolving this issue as fixed.", "id": 192826, "time": "2016-08-02T18:10:38Z", "bug_id": 59115, "creation_time": "2016-08-02T18:10:38Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 59115, "is_private": false, "count": 13, "id": 194576, "time": "2016-10-20T10:26:37Z", "creator": "masahiroyamada.tkk@gmail.com", "creation_time": "2016-10-20T10:26:37Z", "text": "I sent this problem to Microsoft.\nhttps://developer.microsoft.com/en-us/microsoft-edge/platform/issues/9440110/"}, {"count": 14, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "*** Bug 60371 has been marked as a duplicate of this bug. ***", "id": 194992, "time": "2016-11-14T20:48:17Z", "bug_id": 59115, "creation_time": "2016-11-14T20:48:17Z", "is_private": false}, {"count": 15, "tags": [], "text": "Not surpringly, Microsoft closed as wontfix.", "attachment_id": null, "id": 195007, "creator": "1983-01-06@gmx.net", "time": "2016-11-15T15:19:27Z", "bug_id": 59115, "creation_time": "2016-11-15T15:19:27Z", "is_private": false}]
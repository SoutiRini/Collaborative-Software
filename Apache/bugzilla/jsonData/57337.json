[{"count": 0, "attachment_id": null, "bug_id": 57337, "is_private": false, "id": 179693, "time": "2014-12-10T13:05:46Z", "creator": "kees@tweakers.net", "creation_time": "2014-12-10T13:05:46Z", "tags": [], "text": "When there is a conditional redirect in a vhost, Multiviews/negotiation does not work anymore.\n\nSteps to reproduce this bug; use this config:\n\n-=-=-=-=-=-\nDocumentRoot /var/www\n<Directory /var/www/>\n\tOptions MultiViews\n\tMultiviewsMatch Any\n</Directory>\n<Virtualhost *:80>\n\tServerName foo\n\t<If \"req('X-FOO-BAR') != '1'\">\n\t\tRedirect permanent / http://apache.org/\n\t</If>\n</Virtualhost>\n<Virtualhost *:80>\n\tServerName bar\n</Virtualhost>\n-=-=-=-=-=-\nCreate a file in /var/www. Content doesn't matter, i used test.html\n\nRequest the file:\nwget http://bar/test -> HTTP/1.1 200 OK\nwget http://foo/test -> HTTP/1.1 404 Not Found (Expected: HTTP/1.1 301 Moved Permanently)\nwget http://foo/test --header \"X-FOO-BAR: 1\" -> HTTP/1.1 404 Not Found (Expected HTTP/1.1 200 OK)\n\nIn the logs:\n==> /var/log/apache2/other_vhosts_access.log <==\nbar:80 172.17.42.1 - - [10/Dec/2014:12:48:01 +0000] \"GET /test HTTP/1.1\" 200 377 \"-\" \"Wget/1.15 (linux-gnu)\"\nfoo:80 172.17.42.1 - - [10/Dec/2014:12:48:02 +0000] \"GET /test HTTP/1.1\" 404 486 \"-\" \"Wget/1.15 (linux-gnu)\"\nfoo:80 172.17.42.1 - - [10/Dec/2014:12:54:05 +0000] \"GET /test HTTP/1.1\" 404 486 \"-\" \"Wget/1.15 (linux-gnu)\"\n\n==> /var/log/apache2/error.log <==\n[Wed Dec 10 12:48:02.859625 2014] [negotiation:error] [pid 48:tid 140525715056384] [client 172.17.42.1:41853] AH00687: Negotiation: discovered file(s) matching request: /var/www/test (None could be negotiated).\n[Wed Dec 10 12:54:05.512771 2014] [negotiation:error] [pid 49:tid 140075132299008] [client 172.17.42.1:39714] AH00687: Negotiation: discovered file(s) matching request: /var/www/test (None could be negotiated).\n\nA Redirect without the <If> works. Something else besides a Redirect in the <If> works (using Header for example works and sets a header). However the Redirect in combination with the <If> fails."}, {"count": 1, "tags": [], "bug_id": 57337, "attachment_id": null, "text": "retested in 2.5-HEAD, still an issue.", "id": 185514, "time": "2015-09-28T11:06:41Z", "creator": "kees@tweakers.net", "creation_time": "2015-09-28T11:06:41Z", "is_private": false}]
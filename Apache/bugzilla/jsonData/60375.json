[{"count": 0, "text": "Created attachment 34448\nPatch fixing the issue\n\nApache httpd returns \"200 OK\" for a request exceeding LimitRequestBody when enabling mod_ext_filter.\n\nVersion:\nhttpd-2.4.23\n\nSteps to Reproduce:\n\n1. Configure LimitRequestBody and mod_ext_filter:\n\n    LimitRequestBody 100\n    ExtFilterDefine testfilter mode=output cmd=\"/bin/sed s/foo/bar/g\"\n    SetOutputFilter testfilter\n\n2. Prepare a test file which is larger than LimitRequestBody\n\n    dd if=/dev/zero of=/tmp/testfile bs=1 count=101\n\n3. Create testing page\n    \n    echo \"HELLO\" > /var/www/html/test.html \n\n4. Start httpd\n    \n    systemctl start httpd\n\n5. Sent a POST request with the file \n\n    curl -X POST -v -s -T /tmp/testfile http://127.0.0.1/test.html\n\n\nActual results:\n\nApache httpd returns \"200 OK\"\n\n~~~\n$ curl -X POST -v -s -T /tmp/testfile 127.0.0.1/test.html\n...\n*   Trying 127.0.0.1...\n* Connected to 127.0.0.1 (127.0.0.1) port 80 (#0)\n> POST /test.html HTTP/1.1\n> Host: 127.0.0.1\n> User-Agent: curl/7.47.1\n> Accept: */*\n> Content-Length: 101\n> Expect: 100-continue\n> \n< HTTP/1.1 200 OK\n< Date: Tue, 15 Nov 2016 15:37:30 GMT\n< Server: Apache/2.4.23 (Fedora)\n< Content-Length: 0\n< Connection: close\n< Content-Type: text/html; charset=UTF-8\n< \n* Excess found in a non pipelined read: excess = 6 url = /test.html (zero-length body)\n* Closing connection 0\n~~~\n\n\nExpected results:\n\nApache httpd should return \"413 Request Entity Too Large\".\n\n\n\nAttaching proposed patch.", "bug_id": 60375, "attachment_id": 34448, "id": 195008, "time": "2016-11-15T15:44:08Z", "creator": "luhliari@redhat.com", "creation_time": "2016-11-15T15:44:08Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 60375, "attachment_id": null, "text": "I didn't see there was already a patch. The problem is that 2.4 input filter uses error buckets and mod_ext_filter does not preserve them for output.\n\nI lifted this stanza from mod_request and it makes the test pass for me:\n\nIndex: mod_ext_filter.c\n===================================================================\n--- mod_ext_filter.c    (revision 1775678)\n+++ mod_ext_filter.c    (working copy)\n@@ -756,6 +756,12 @@\n             eos = b;\n             break;\n         }\n+        if (AP_BUCKET_IS_ERROR(b)) {\n+            apr_bucket *cpy;\n+            apr_bucket_copy(b, &cpy);\n+            APR_BRIGADE_INSERT_TAIL(bb_tmp, cpy);\n+            break;\n+        }\n \n         rv = apr_bucket_read(b, &data, &len, APR_BLOCK_READ);\n         if (rv != APR_SUCCESS) {", "id": 195628, "time": "2016-12-22T22:59:10Z", "creator": "covener@gmail.com", "creation_time": "2016-12-22T22:59:10Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 60375, "text": "Many thanks Eric for fixing this!  trunk -> r1775770 trunk -> r1775832", "id": 197077, "time": "2017-02-16T17:36:38Z", "creator": "jorton@redhat.com", "creation_time": "2017-02-16T17:36:38Z", "is_private": false, "attachment_id": null}, {"count": 3, "text": "Oops. 2.4.x -> r1775832", "bug_id": 60375, "attachment_id": null, "id": 197078, "time": "2017-02-16T17:37:08Z", "creator": "jorton@redhat.com", "creation_time": "2017-02-16T17:37:08Z", "tags": [], "is_private": false}]
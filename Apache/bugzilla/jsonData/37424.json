[{"count": 0, "attachment_id": null, "creator": "petermenzel@gmx.de", "text": "When a client requests a partial uri in a webapp with no matching static\nresource or servlet/jsp in the DD, Tomcat should process the <welcome-file list>\nin the DD and append each <welcome-file> entry to the partial request. After\nappending Tomcat should look for a matching static resource or servlet. [1]\n\nProblem as follows:\nWhen using a <welcome-file>foo.bar</welcome-file> and having a servlet matching\nthe pattern *.bar, this servlet is not invoked.\nUsing a normal path extension in the welcome file works.\n\nworking:\n<servlet-mapping>\n    <servlet-name>BarServlet</servlet-name>\n    <url-pattern>/home</url-pattern>\n</servlet-mapping>\n<welcome-file-list>\n    <welcome-file>home</welcome-file>\n</welcome-file-list>\n\nnot working:\n<servlet-mapping>\n    <servlet-name>BarServlet</servlet-name>\n    <url-pattern>*.bar</url-pattern>\n</servlet-mapping>\n<welcome-file-list>\n    <welcome-file>foo.bar</welcome-file>\n</welcome-file-list>\n\nI know that the deafult servlet maps to <url-pattern>/</url-pattern> so that it\nwill be invoked before any extension matching servlet, when accessing\nhttp://example.com/mywebapp/ , but when going deeper in the directory structure\nthe BarServlet should be invoked when accessing e.g.\nhttp://example.com/mywebapp/buzz/ .\nThe partial request \"/buzz/\" should be extended by \"foo.bar\" becoming\n\"/buzz/foo.bar\" and a match with *.bar should invoke BarServlet.\n\nI used Tomcat 5.5.12.\n\nRegards, Peter Menzel\n\n[1] The Servlet spec 2.4 (SRV 9.10) states: \"The web server must append each\nwelcome file in the order specified in the DD to the partial request and check\nwhether a static resource or servlet in the WAR is mapped to that request URI.\"", "id": 82285, "time": "2005-11-09T12:59:28Z", "bug_id": 37424, "creation_time": "2005-11-09T12:59:28Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 37424, "text": "That's normal, it can't be implemented.", "id": 82286, "time": "2005-11-09T13:01:53Z", "creator": "remm@apache.org", "creation_time": "2005-11-09T13:01:53Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "So you mean the expressiveness of the Java language is not sufficient to solve\nthis problem? \n\nBy not implementing this feature, Tomcat does not implement the full Servlet 2.4\nspec. So what happens about its status as a reference implementation of this spec. ?\n\n", "is_private": false, "id": 82288, "creation_time": "2005-11-09T13:21:59Z", "time": "2005-11-09T13:21:59Z", "creator": "petermenzel@gmx.de", "bug_id": 37424, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 37424, "text": "(In reply to comment #2)\n> By not implementing this feature, Tomcat does not implement the full Servlet 2.4\n> spec. So what happens about its status as a reference implementation of this\nspec. ?\n> \n\nAnother day in BZ, another round of useless statements, another round of\nwhining. Tomcat IS NOT the \"reference implementation of this spec\".\n\nThis feature is not desirable, and has very bad consequences. As a result, it is\nnot implemented. If you don't like it, you can either tweak your Tomcat version\nor use another implementation of the Servlet specification.\n", "id": 82290, "time": "2005-11-09T13:43:51Z", "creator": "remm@apache.org", "creation_time": "2005-11-09T13:43:51Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 37424, "text": "Oh sorry, I did not know that Tomcat is NOT the official reference implementation.\nObviously I misunderstood the first sentence on http://tomcat.apache.org which\nstates:\n\"Apache Tomcat is the servlet container that is used in the official Reference\nImplementation for the Java Servlet and JavaServer Pages technologies.\"\n;-)\n\nCan you tell which very bad consequences this feature involves ?\n\n", "id": 82292, "time": "2005-11-09T13:57:20Z", "creator": "petermenzel@gmx.de", "creation_time": "2005-11-09T13:57:20Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "lilianne_blaze@tlen.pl", "is_private": false, "count": 5, "id": 82295, "time": "2005-11-09T14:13:59Z", "bug_id": 37424, "creation_time": "2005-11-09T14:13:59Z", "text": "not working:\n<servlet-mapping>\n    <servlet-name>BarServlet</servlet-name>\n    <url-pattern>*.bar</url-pattern>\n</servlet-mapping>\n<welcome-file-list>\n    <welcome-file>foo.bar</welcome-file>\n</welcome-file-list>\n\nWorkaround:\n\nCreate empty \"foo.bar\" file in every directory you need BarServlet to execute."}, {"count": 6, "attachment_id": null, "creator": "remm@apache.org", "text": "(In reply to comment #4)\n> Oh sorry, I did not know that Tomcat is NOT the official reference implementation.\n> Obviously I misunderstood the first sentence on http://tomcat.apache.org which\n> states:\n> \"Apache Tomcat is the servlet container that is used in the official Reference\n> Implementation for the Java Servlet and JavaServer Pages technologies.\"\n> ;-)\n\n\"used\" does not mean \"used as is\".\n\n> Can you tell which very bad consequences this feature involves ?\n\nThe (mandatory) default configuration includes \"index.jsp\" in the welcome file\nlist, as well as a servlet mapped to \"*.jsp\". This will not work well at all if\nyour interpretation of the specification is correct.\n", "id": 82297, "time": "2005-11-09T14:24:29Z", "bug_id": 37424, "creation_time": "2005-11-09T14:24:29Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "text": "I'd suggest you might get further if you provide an example of a container \nwhere it is actually implemented as you say. Might be wrong, but I think \nnearly all the container implementations behave the same way as Tomcat (at \nleast I can't remember one that acts like you mentioned).", "is_private": false, "bug_id": 37424, "id": 82298, "time": "2005-11-09T14:31:16Z", "creator": "rick@knowleses.org", "creation_time": "2005-11-09T14:31:16Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 37424, "is_private": false, "text": "(In reply to comment #6)\nCan you tell which very bad consequences this feature involves ?\n> The (mandatory) default configuration includes \"index.jsp\" in the welcome file\n> list, as well as a servlet mapped to \"*.jsp\". This will not work well at all if\n> your interpretation of the specification is correct.\n\nSo why should this bear problems? \nWhen having \"index.jsp\" in the welcome-file-list and accessing \"/buzz/\",\n\"index.jsp\" is appended, resulting in \"/buzz/index.jsp\", which in turn is mapped\nto the JspServlet which matches \"*.jsp\".\nWhen this works, why should the \".bar\" extension not?\n\n<servlet-mapping>\n    <servlet-name>BarServlet</servlet-name>\n    <url-pattern>*.bar</url-pattern>\n</servlet-mapping>\n<welcome-file-list>\n    <welcome-file>foo.bar</welcome-file>\n</welcome-file-list>\n", "id": 82302, "time": "2005-11-09T15:06:45Z", "creator": "petermenzel@gmx.de", "creation_time": "2005-11-09T15:06:45Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 37424, "is_private": false, "text": "(In reply to comment #8)\n> (In reply to comment #6)\n> Can you tell which very bad consequences this feature involves ?\n> > The (mandatory) default configuration includes \"index.jsp\" in the welcome file\n> > list, as well as a servlet mapped to \"*.jsp\". This will not work well at all if\n> > your interpretation of the specification is correct.\n> \n> So why should this bear problems? \n> When having \"index.jsp\" in the welcome-file-list and accessing \"/buzz/\",\n> \"index.jsp\" is appended, resulting in \"/buzz/index.jsp\", which in turn is mapped\n> to the JspServlet which matches \"*.jsp\".\n> When this works, why should the \".bar\" extension not?\n\nNote it works only if \"index.jsp\" exists. Same with \"foo.bar\" - you want it\nserved, you have to make sure it exists.", "id": 82326, "time": "2005-11-10T02:07:05Z", "creator": "lilianne_blaze@tlen.pl", "creation_time": "2005-11-10T02:07:05Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 37424, "text": "Hi Lilianne, Remy,\n\nI work in what has been a BEA shop for longer than the 3 years I've been here \nand have been been trying to convince management that Tomcat provides a better \nvalue proposition than WL.  We've just been presented with an opportunity to \nuse Tomcat instead of WLX in a new server environment but when migrating apps \nfound this bug.\n\nI have a couple of points to make:\n1. Whilst the JSP Servlet is only invoked if index.jsp is present I see no \nproblem with it being invoked regardless (as it is if you request /index.jsp \ndirectly).  Either way I'd expect a 404 (although yes I acknowledge other \nwelcome file list options might match successfully).\n2. WL 8.1 SP3 does implement the spec correctly in this area (in relation to \ncomment 7).\n\nIs it unreasonable to request a configuration switch that enables the spec \nbehaviour? ", "id": 83819, "time": "2005-12-20T02:22:55Z", "creator": "colebatchd@gmail.com", "creation_time": "2005-12-20T02:22:55Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 37424, "is_private": false, "id": 85138, "creation_time": "2006-01-27T23:51:38Z", "time": "2006-01-27T23:51:38Z", "creator": "jan.luehe@sun.com", "text": "I don't see where exactly the problem of supporting an extension match for\nwelcome pages lies.\n\nI've searched both the servlet and jsp specs for references to default\n(implicit) welcome pages, but could not find any.\n\nNotice that in the list of welcome pages declared in default-web.xml:\n\n  <welcome-file-list>\n    <welcome-file>index.html</welcome-file>\n    <welcome-file>index.htm</welcome-file>\n    <welcome-file>index.jsp</welcome-file>\n  </welcome-file-list>\n\nindex.jsp comes last. Also notice this comment in default-web.xml:\n\n  <!-- If you define welcome files in your own application's web.xml      -->\n  <!-- deployment descriptor, that list *replaces* the list configured    -->\n  <!-- here, so be sure that you include any of the default values that   -->\n  <!-- you wish to include.           \n\nTherefore, the welcome pages declared in default-web.xml, and in particular the\nindex.jsp welcome page, will never interfere with any application-defined\nwelcome pages.\n\nThis means that if a webapp declares its own welcome file list, the index.jsp\nwelcome file from the default-web.xml, for which an extension mapping always\nexists, will not be considered and will not be able to \"hijack\" any of the\nwebapp's welcome pages.\n\nI think Mapper.java could be modified as follows: I've moved the existing Rule\n4c to 4d, and inserted a new rule 4c that performs the extension mapping. That\nfailing, Rule 4d is invoked, which checks if the welcome file exists as a\nphysical resource, and if so, maps it to the default servlet. That still\nfailing, the next welcome file in the list is checked:\n\n    // Rule 4a -- Welcome resources processing for exact macth\n    internalMapExactWrapper(exactWrappers, path, mappingData);\n\n    // Rule 4b -- Welcome resources processing for prefix match\n    if (mappingData.wrapper == null) {\n        internalMapWildcardWrapper\n            (wildcardWrappers, context.nesting, \n             path, mappingData);\n    }\n\n    // Rule 4c -- Welcome resources extension match\n    if (mappingData.wrapper == null) {\n        internalMapExtensionWrapper(extensionWrappers,\n                                    path, mappingData);\n    }\n\n    // Rule 4d -- Welcome resources processing\n    //            for physical folder\n    if (mappingData.wrapper == null\n            && context.resources != null) {\n        Object file = null;\n        String pathStr = path.toString();\n        try {\n            file = context.resources.lookup(pathStr);\n        } catch(NamingException nex) {\n            // Swallow not found, since this is normal\n        }\n        if (file != null && !(file instanceof DirContext)\n                && context.defaultWrapper != null) {\n            mappingData.wrapper = context.defaultWrapper.object;\n            mappingData.requestPath.setChars\n                (path.getBuffer(), path.getStart(), \n                 path.getLength());\n            mappingData.wrapperPath.setChars\n                (path.getBuffer(), path.getStart(), \n                 path.getLength());\n            mappingData.requestPath.setString(pathStr);\n            mappingData.wrapperPath.setString(pathStr);\n        }\n    }\n\nPlease let me know what you think and if you want me to supply any diffs.\n\nI don't think we need any configuration switch for this feature: It should be\nsupported by default if approved.\n\nJan", "attachment_id": null}, {"count": 12, "tags": [], "text": "I agree that if you do not override the welcome-file-list from default-web.xml\n(by providing your own welcome-file-list in your web.xml), dir listings will\nalways be disabled (since index.jsp will always be mapped to JspServlet), and\nthe JspServlet will return a 404 if index.jsp does not exist.\n\nBut this goes back to my original question: I searched again, and could not find\nany reference in the Servlet or JSP specs about a list of built-in welcome pages\na container must support. If a webapp relied on the welcome-file-list in\ndefault-web.xml, it would be non-portable.\n\nSo in order to support extension mappings for welcome pages, we need to remove\nindex.jsp from the welcome-file-list in default-web.xml.", "is_private": false, "bug_id": 37424, "id": 85226, "time": "2006-01-30T21:31:43Z", "creator": "jan.luehe@sun.com", "creation_time": "2006-01-30T21:31:43Z", "attachment_id": null}, {"count": 13, "tags": [], "text": "(In reply to comment #12)\n> I agree that if you do not override the welcome-file-list from default-web.xml\n> (by providing your own welcome-file-list in your web.xml), dir listings will\n> always be disabled (since index.jsp will always be mapped to JspServlet), and\n> the JspServlet will return a 404 if index.jsp does not exist.\n\nI understand you have an interest in forcing Tomcat into supporting nonsensical\nspecification features, as your own server has to do. This project fortunately\ndoes not have to do that anymore. In a way, this is the role of the RI: finiding\nout what really doesn't make sense when comes the time of implementing\nsomething. Personally, I think you need to make more useful contributions to\nthis project rather than attempt to fix non issues that bother everyone else,\nincluding:\n- the getId stuff\n- the charset encoding nonsense\n- and now, this one\n", "is_private": false, "id": 85230, "creation_time": "2006-01-30T22:43:22Z", "time": "2006-01-30T22:43:22Z", "creator": "remm@apache.org", "bug_id": 37424, "attachment_id": null}, {"count": 14, "attachment_id": null, "creator": "jan.luehe@sun.com", "text": "Here's an additional requirement from the servlet spec that can be\nsupported only if extension mappings were applied to welcome pages in\nthe same fashion as they are for any other types of resources:\n\nSRV.9.10 (\"Welcome Files\") has this:\n\n  The container may send the request to the welcome page resource with a\n  forward, a redirect, or a container specific mechanism that is\n  indistinguishable from a direct request.\n\nFor a server than sends a request to a welcome page using a redirect,\nit will be impossible to later determine whether the target resource is\nbeing accessed directly or as the result of the redirect, and suppress\nor perform extension mappings accordingly.\n\n", "id": 85234, "time": "2006-01-30T23:31:38Z", "bug_id": 37424, "creation_time": "2006-01-30T23:31:38Z", "tags": [], "is_private": false}, {"count": 15, "tags": [], "bug_id": 37424, "is_private": false, "id": 85236, "creation_time": "2006-01-30T23:49:14Z", "time": "2006-01-30T23:49:14Z", "creator": "jan.luehe@sun.com", "text": "In response to Comment#13:\n\nPlease notice that the extension mapping for welcome pages issue was\nnot initially raised by me. It was first reported by\npetermenzel@gmx.de, and I only jumped on it recently because this very\nissue has been raised by others. Considering the number of replies on\nthis thread, I would not consider this a \"non-issue\".\n\nI agree if the Servlet or JSP specs required support for a built-in\nwelcome page \"index.jsp\" (as you implied in one of your comments), the\nspecs would have an issue. But fortunately, neither spec requires\nthis.\n\nI just read your email to the EG. I hope this issue can be clarified\nto everybody's satisfaction.\n\nI'm not sure what you mean by the \"getId stuff\". Are you referring to\nthe new method that was added to javax.servlet.jsp.tagext.TagSupport?\nIf so, please check with the JSF and JSP expert groups for the motivation\nbehind this new method.\n\nThe \"charset encoding nonsense\" has been the result of alignment work\nbetween the JSP and Servlet EGs. It was not suggested by me.\n", "attachment_id": null}, {"count": 16, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 85239, "time": "2006-01-31T00:36:30Z", "bug_id": 37424, "creation_time": "2006-01-31T00:36:30Z", "text": "I have problems with Tomcat only getting the annoyances and no useful\ncontributions at all. I do not find that acceptable. Hopefully you understand\nwhat I mean.\n\nIndeed, I did just send an email to the expert group in an attempt to resolve\nsome points of the specification which do not make any sense in the real world.\nI expect to be ignored.\n\n(about the getId stuff, I mean HttpSession.getId throwing an ISE for no reason)\n"}, {"count": 17, "attachment_id": null, "creator": "jan.luehe@sun.com", "is_private": false, "id": 85242, "time": "2006-01-31T02:33:40Z", "bug_id": 37424, "creation_time": "2006-01-31T02:33:40Z", "tags": [], "text": "Hi Remy,\n\nI'm not pointing fingers at Tomcat at all. Look at it this way: I am just trying\nto help resolve a customer issue, so I hope you find this a somewhat useful\ncontribution. ;-)\n\nAs for HttpSession.getId() throwing an ISE on an invalidated session, I agree\nthis is useless and requires all kinds of workarounds, but I claim innocence on\nthis as well.\n\nThis issue has a long history: Apparently, getId() and getLastAccessedTime()\nwere always supposed to throw this exception, but there used to be a typo in the\ntag name (\"@exeption\" instead of \"@exception\") in the HttpSession.java source\nfile, which meant the exception was never reflected in the javadocs.\nUnfortunately, the EG decided to \"fix\" this in the 2.4 Errata. I with they had\ntaken this as a hint and removed this exception, at least in the case of\ngetId(). You have my support on this! :)\n\nI will reply separately to your email that you just sent to the EG.\n"}, {"count": 18, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "text": "I'm going to have to vote with Remy on this one.  As Remy has pointed out, \nTomcat isn't the RI any more so supporting silly and (as writen in the 2.4 \nspec) unclear requirements in Tomcat isn't really an issue.  And, in any case \nthere is a simple, one-line way to get this working under Tomcat (just create \nan empty 'index.do' file under all subdirectories).\n\n+1 for leaving as WONTFIX.\n", "id": 85248, "time": "2006-01-31T08:49:24Z", "bug_id": 37424, "creation_time": "2006-01-31T08:49:24Z", "is_private": false}, {"count": 19, "tags": [], "bug_id": 37424, "is_private": false, "id": 85250, "creation_time": "2006-01-31T10:46:39Z", "time": "2006-01-31T10:46:39Z", "creator": "remm@apache.org", "text": "(In reply to comment #17)\n> Hi Remy,\n> \n> I'm not pointing fingers at Tomcat at all. Look at it this way: I am just trying\n> to help resolve a customer issue, so I hope you find this a somewhat useful\n> contribution. ;-)\n> \n> As for HttpSession.getId() throwing an ISE on an invalidated session, I agree\n> this is useless and requires all kinds of workarounds, but I claim innocence on\n> this as well.\n\nGuess what: I got some customer issues too about the getId stuff :) So after\ntrying it out, I now think this sort of fix is actually negative, and impacts\nproduction usage.\n\nI don't know from where the default welcome file list comes from (for some\nreason, I cannot find it anymore). It has always been there like it is now, I think.\n", "attachment_id": null}, {"count": 20, "attachment_id": null, "creator": "funkman@joedog.org", "text": "+1 on Bill's -1. \n\nIt will be very painful for users if they change their welcome file order to\nmake *.jsp a higher precendence than index.html. Doing so will NEVER allow a\nuser to serve an html file as a welcome file with the proposed change. That is\nhorrible usability. [I don't even want to touch the topic of the struts folks\nwith the index.do mapping]\n\nThe servlet spec's notion of mapping is full of holes. An example: when asking\nfor a RequestDispatcher for a non-existant resource - a RequestDispatcher is\nstill returned. And if the RequesDispatcher is executed - a 404 or ISE occurs\n(depending on how and when it was executed). This is confusing from a developer\npoint of view due to the mappings of the default servlet. \n\n", "id": 85251, "time": "2006-01-31T13:15:17Z", "bug_id": 37424, "creation_time": "2006-01-31T13:15:17Z", "tags": [], "is_private": false}, {"count": 21, "tags": [], "bug_id": 37424, "is_private": false, "id": 85253, "creation_time": "2006-01-31T14:08:38Z", "time": "2006-01-31T14:08:38Z", "creator": "pr@objektpark.de", "text": "Currently the SingleSignOn Valve not working anymore with the getLastAccessTime() ISE!\n    s. user mailing thread last week.\n\nI thing we can implement that a \"*.do\" mapping can handle by welcome file directly. The\nidea to generate index.do files is not very acceptable to end user. ", "attachment_id": null}, {"count": 22, "tags": [], "text": "(In reply to comment #21)\n> Currently the SingleSignOn Valve not working anymore with the\ngetLastAccessTime() ISE!\n>     s. user mailing thread last week.\n> \n> I thing we can implement that a \"*.do\" mapping can handle by welcome file\ndirectly. The\n> idea to generate index.do files is not very acceptable to end user. \n\nFor the first part, this is OT, but session events should be sent while the\nsession is still considered valid (I was talking about session attributes\nimplementing the binding listener interface, and most of these are using getId -\nfor example, our own example/test webapps were). Please post a reference to the\npost.\n\nNote: Can you make an effort with your English ?\n", "is_private": false, "bug_id": 37424, "id": 85256, "time": "2006-01-31T14:35:04Z", "creator": "remm@apache.org", "creation_time": "2006-01-31T14:35:04Z", "attachment_id": null}, {"count": 23, "attachment_id": null, "creator": "pr@objektpark.de", "text": "Here is the missing discussion link:\nhttp://marc.theaimsgroup.com/?l=tomcat-dev&w=2&r=1&s=llegalstate+during+invalidate+delta&q=b", "id": 85259, "time": "2006-01-31T15:33:11Z", "bug_id": 37424, "creation_time": "2006-01-31T15:33:11Z", "tags": [], "is_private": false}]
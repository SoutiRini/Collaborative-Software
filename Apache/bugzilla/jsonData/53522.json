[{"count": 0, "text": "From dev mailing list discussion on 07 july 2012:\nSebb:\n\"I don't have the source to hand at present, but we should not cache at\nall if Cache-Control=no-cache; the max-age is then not relevant.\"\n\nPhilippe M.\n\"Looking at existing code, I noticed that with no-cache we store an entry in Cache for which CacheManager#inCache will return false .\n\nI don't understand why we just skip the entry, currently we use one entry in map for nothing.\"\n\nConclusion of discussion:\n- Staled entries for \"no-cache\" will not be stored anymore\n- Cache-control will only be checked for no-cache, for other values, responses will be stored in cache using max-age value", "bug_id": 53522, "attachment_id": null, "id": 160505, "time": "2012-07-08T14:19:38Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-07-08T14:19:38Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "Date: Sun Jul  8 14:23:54 2012\nNew Revision: 1358746\n\nURL: http://svn.apache.org/viewvc?rev=1358746&view=rev\nLog:\nBug 53522 - Cache Manager should not store at all response with header \"no-cache\" and store other types of Cache-Control having max-age value\nBugzilla Id: 53522\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/control/TestCacheManager.java\n    jmeter/trunk/xdocs/changes.xml\n    jmeter/trunk/xdocs/usermanual/component_reference.xml", "attachment_id": null, "bug_id": 53522, "id": 160506, "time": "2012-07-08T14:24:52Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-07-08T14:24:52Z", "is_private": false}, {"count": 2, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 160508, "time": "2012-07-08T14:57:26Z", "bug_id": 53522, "creation_time": "2012-07-08T14:57:26Z", "is_private": false, "text": "Date: Sun Jul  8 14:56:27 2012\nNew Revision: 1358753\n\nURL: http://svn.apache.org/viewvc?rev=1358753&view=rev\nLog:\nBug 53522 - Cache Manager should not store at all response with header \"no-cache\" and store other types of Cache-Control having max-age value\nBugzilla Id: 53522\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java"}, {"count": 3, "tags": [], "creator": "sebb@apache.org", "text": "Following further discussion on the developer list it was pointed out that \"no-cache\" does not mean the response should not be cached.\n\nRather, it means that the cache entry must not be used without re-validation.", "id": 160569, "time": "2012-07-10T19:48:01Z", "bug_id": 53522, "creation_time": "2012-07-10T19:48:01Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Date: Tue Jul 10 21:00:33 2012\nNew Revision: 1359898\n\nURL: http://svn.apache.org/viewvc?rev=1359898&view=rev\nLog:\nBug 53522 - Cache Manager should not store at all response with header \"no-cache\" and store other types of Cache-Control having max-age value (edit)\n\nFix broken test\nBugzilla Id: 53522\n\nModified:\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/control/TestCacheManager.java", "id": 160570, "time": "2012-07-10T21:01:13Z", "bug_id": 53522, "creation_time": "2012-07-10T21:01:13Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 53522, "attachment_id": null, "text": "URL: http://svn.apache.org/viewvc?rev=1359858&view=rev\nLog:\nno-cache responses should be stored, but must be revalidated, so don't store an expiry date for them\nBugzilla Id: 53522\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java", "id": 160574, "time": "2012-07-10T23:02:15Z", "creator": "sebb@apache.org", "creation_time": "2012-07-10T23:02:15Z", "is_private": false}, {"count": 6, "text": "Date: Sat Jul 14 14:25:11 2012\nNew Revision: 1361551\n\nURL: http://svn.apache.org/viewvc?rev=1361551&view=rev\nLog:\nBug 53522 - Cache Manager should not store at all response with header \"no-cache\" and store other types of Cache-Control having max-age value\nChanged to store entry forever if no max-age and no expires header which is what specification says in my understanding:\nhttp://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html\nBugzilla Id: 53522\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\n    jmeter/trunk/xdocs/usermanual/component_reference.xml\n\n\n\nDate: Sat Jul 14 14:26:03 2012\nNew Revision: 1361552\n\nURL: http://svn.apache.org/viewvc?rev=1361552&view=rev\nLog:\nBug 53522 - Cache Manager should not store at all response with header \"no-cache\" and store other types of Cache-Control having max-age value\nAdded test case\nAdded sleep to ensure entries become invalid after their expiration date has passed\nBugzilla Id: 53522\n\nModified:\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/control/TestCacheManager.java", "bug_id": 53522, "is_private": false, "id": 160639, "time": "2012-07-14T14:26:55Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-07-14T14:26:55Z", "tags": [], "attachment_id": null}, {"count": 7, "tags": [], "text": "(In reply to comment #6)\n\n> Changed to store entry forever if no max-age and no expires header which is\n> what specification says in my understanding:\n> http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html\n\nI'm not sure that's a valid interpretation of the spec.\n\nI cannot find any reference to a missing expiry date as never expiring.\nBut I could be wrong.\n\nNote that section 14.21 says:\n\n\"To mark a response as \"never expires,\" an origin server sends an Expires date approximately one year from the time the response is sent.\"\n\nSo if it is valid to assume a missing expiry date means \"never expires\", then using two weeks is non-standard; we should use 1 year instead.\n\nBut first we need to establish that a missing expires/max-age really means \"never expires\".", "is_private": false, "bug_id": 53522, "id": 160640, "time": "2012-07-14T15:02:45Z", "creator": "sebb@apache.org", "creation_time": "2012-07-14T15:02:45Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 53522, "attachment_id": null, "text": "http://www.ietf.org/rfc/rfc2616.txt 13.2.4\n\nFrom :\nhttps://developer.mozilla.org/en/HTTP_Caching_FAQ\n\nYou are right I put 2 weeks for infinite (as I thought no test would last 2 weeks).\nBut now I am implementing the what the RFC says.", "id": 160641, "time": "2012-07-14T15:44:31Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-07-14T15:44:31Z", "is_private": false}, {"count": 9, "text": "Date: Sat Jul 14 15:49:16 2012\nNew Revision: 1361555\n\nURL: http://svn.apache.org/viewvc?rev=1361555&view=rev\nLog:\nBug 53522 - Cache Manager should not store at all response with header \"no-cache\" and store other types of Cache-Control having max-age value\nImplemented RFC 2616 section 13.2.4. \nBugzilla Id: 53522\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/util/HTTPConstantsInterface.java\n    jmeter/trunk/xdocs/usermanual/component_reference.xml", "bug_id": 53522, "is_private": false, "id": 160642, "time": "2012-07-14T15:50:30Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-07-14T15:50:30Z", "tags": [], "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 53522, "attachment_id": null, "text": "Note if server does not send Last-Modified time , I don't see what the spec says about it.", "id": 160643, "time": "2012-07-14T15:58:39Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-07-14T15:58:39Z", "is_private": false}, {"count": 11, "text": "Date: Sat Jul 14 15:55:11 2012\nNew Revision: 1361556\n\nURL: http://svn.apache.org/viewvc?rev=1361556&view=rev\nLog:\nBug 53522 - Cache Manager should not store at all response with header \"no-cache\" and store other types of Cache-Control having max-age value\nFixed test case\n\nBugzilla Id: 53522\n\nModified:\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/control/TestCacheManager.java", "bug_id": 53522, "is_private": false, "id": 160644, "time": "2012-07-14T15:58:48Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-07-14T15:58:48Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Date: Sat Jul 14 19:03:54 2012\nNew Revision: 1361574\n\nURL: http://svn.apache.org/viewvc?rev=1361574&view=rev\nLog:\nBug 53522 - Cache Manager should not store at all response with header \"no-cache\" and store other types of Cache-Control having max-age value\nIF Last-Modified or Date are missing or invalid, set expiration date to one year in future\nBugzilla Id: 53522\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java", "count": 12, "id": 160649, "time": "2012-07-14T19:04:32Z", "bug_id": 53522, "creation_time": "2012-07-14T19:04:32Z", "is_private": false}, {"count": 13, "tags": [], "text": "For the sake of completeness some relevant parts from the specs:\n\nRFC2616:\n\n13.2.2 Heuristic Expiration\n\n   Since origin servers do not always provide explicit expiration times,\n   HTTP caches typically assign heuristic expiration times, employing\n   algorithms that use other header values (such as the Last-Modified\n   time) to estimate a plausible expiration time. The HTTP/1.1\n   specification does not provide specific algorithms, but does impose\n   worst-case constraints on their results. Since heuristic expiration\n   times might compromise semantic transparency, they ought to used\n   cautiously, and we encourage origin servers to provide explicit\n   expiration times as much as possible.\n\n...\n\n13.2.4 Expiration Calculations\n\n...\n\n   If none of Expires, Cache-Control: max-age, or Cache-Control: s-\n   maxage (see section 14.9.3) appears in the response, and the response\n   does not include other restrictions on caching, the cache MAY compute\n   a freshness lifetime using a heuristic. The cache MUST attach Warning\n   113 to any response whose age is more than 24 hours if such warning\n   has not already been added.\n\n   Also, if the response does have a Last-Modified time, the heuristic\n   expiration value SHOULD be no more than some fraction of the interval\n   since that time. A typical setting of this fraction might be 10%.\n\nThe current Draft document for HTTPbis (draft-ietf-httpbis-p6-cache-19) formulates it a bit different and mentions further restrictions:\n\n2.3.1.1.  Calculating Heuristic Freshness\n\n   If no explicit expiration time is present in a stored response that\n   has a status code whose definition allows heuristic freshness to be\n   used (including the following in Section 7 of [Part2]: 200, 203, 206,\n   300, 301 and 410), a cache MAY calculate a heuristic expiration time.\n   A cache MUST NOT use heuristics to determine freshness for responses\n   with status codes that do not explicitly allow it.\n\n   When a heuristic is used to calculate freshness lifetime, a cache\n   SHOULD attach a Warning header field with a 113 warn-code to the\n   response if its current_age is more than 24 hours and such a warning\n   is not already present.\n\n   Also, if the response has a Last-Modified header field (Section 2.2\n   of [Part4]), caches are encouraged to use a heuristic expiration\n   value that is no more than some fraction of the interval since that\n   time.  A typical setting of this fraction might be 10%.\n\n      Note: RFC 2616 ([RFC2616], Section 13.9) required that caches do\n      not calculate heuristic freshness for URIs with query components\n      (i.e., those containing '?').  In practice, this has not been\n      widely implemented.  Therefore, servers are encouraged to send\n      explicit directives (e.g., Cache-Control: no-cache) if they wish\n      to preclude caching.\n\nRegards,\n\nRainer", "is_private": false, "bug_id": 53522, "id": 160650, "time": "2012-07-14T21:59:02Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-07-14T21:59:02Z", "attachment_id": null}]
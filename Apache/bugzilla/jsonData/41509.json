[{"count": 0, "tags": [], "bug_id": 41509, "attachment_id": null, "id": 98833, "time": "2007-01-31T05:49:22Z", "creator": "valder@yandex.ru", "creation_time": "2007-01-31T05:49:22Z", "is_private": false, "text": "Javadoc: \nhttp://java.sun.com/javase/6/docs/api/java/security/Policy.html#getPermissions\n(java.security.CodeSource)\nPolicy Javadoc says that method getPermissions(java.security.CodeSource) is \noptional and policies do not have to implement it. At least nobody said that \nreturned collection will be editable. So to avoid exceptions a possible \nsolution is to check whether permissions can be added before trying to do that.\n\nStacktrace:\njava.lang.SecurityException: attempt to add a Permission to a readonly \nPermissions object\n\tat java.security.Permissions.add(Permissions.java:110)\n\tat java.security.Policy$UnsupportedEmptyCollection.add(Policy.java:790)\n\tat org.apache.jasper.compiler.JspRuntimeContext.initSecurity\n(JspRuntimeContext.java:487)\n\tat org.apache.jasper.compiler.JspRuntimeContext.<init>\n(JspRuntimeContext.java:142)\n\tat org.apache.jasper.servlet.JspServlet.init(JspServlet.java:121)"}, {"count": 1, "tags": [], "creator": "jongjin.choe@gmail.com", "attachment_id": null, "text": "(In reply to comment #0)\nHow can I reproduce this situation? Do you have any test cases?\n", "id": 103767, "time": "2007-05-29T06:03:56Z", "bug_id": 41509, "creation_time": "2007-05-29T06:03:56Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 41509, "attachment_id": null, "text": "(In reply to comment #1)\n> (In reply to comment #0)\n> How can I reproduce this situation? Do you have any test cases?\n> \n\nIt isn't very easy to write testcase for jasper :(\n\nidea:\n\n1) set Policy to\nPolicy.setPolicy(new Policy() {\n        public boolean implies(ProtectionDomain domain, Permission permission) {\n          return true;\n        }\n\n        public PermissionCollection getPermissions(ProtectionDomain domain) {\n          return Policy.UNSUPPORTED_EMPTY_COLLECTION;\n        }\n\n        public PermissionCollection getPermissions(CodeSource codesource) {\n          return Policy.UNSUPPORTED_EMPTY_COLLECTION;\n        }\n      });\n\nsuch policy won't break the vm, since it allows everything.\n2) set SecurityManager\nSystem.setSecurityManager(new SecurityManager())\n3) instantiate JspRuntimeContext", "id": 103804, "time": "2007-05-30T00:50:00Z", "creator": "valder@yandex.ru", "creation_time": "2007-05-30T00:50:00Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 41509, "attachment_id": null, "id": 122144, "time": "2008-11-03T06:35:38Z", "creator": "markt@apache.org", "creation_time": "2008-11-03T06:35:38Z", "is_private": false, "text": "Without those added permissions, a web application is likely to fail.\n\nIt may be possible for some applications to operate without these permissions and the failure to add the permission isn't - on its own - sufficient to prevent the application from starting.\n\nTherefore, this issue will not be addressed."}, {"count": 4, "tags": [], "creator": "stevel@apache.org", "attachment_id": null, "text": "It is a shame that this is a WONTFIX as it may stop Jasper working with RMI Java6+ JVM. One needs security for its classloader to work, the other bangs up against a changed semantics of Sun's JVM. It is also hard to see how this can be fixed in Jasper.\n\nHere is what the Java6 javadocs have to say on the topic:\n\n\"Applications are discouraged from calling this method since this operation may not be supported by all policy implementations. Applications should solely rely on the implies method to perform policy checks. If an application absolutely must call a getPermissions method, it should call getPermissions(ProtectionDomain).\nThe default implementation of this method returns Policy.UNSUPPORTED_EMPTY_COLLECTION. This method can be overridden if the policy implementation can return a set of permissions granted to a CodeSource.\"\n\nWhat would happen if Jasper could recognise the situation in which there was a read-only policy and skip trying to set permissions -or could it perhaps check to see if the permissions were already granted by the security manager before trying to set them?\n\nSee also\nhttp://mail-archives.apache.org/mod_mbox/incubator-river-user/200810.mbox/%3C20081015181649.GB4649@east%3E", "id": 126490, "time": "2009-04-24T08:41:28Z", "bug_id": 41509, "creation_time": "2009-04-24T08:41:28Z", "is_private": false}, {"count": 5, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Jasper already tries to set the permission, catches the exception it if fails and carries on anyway. What other changes are you looking for?", "id": 126493, "time": "2009-04-24T08:49:06Z", "bug_id": 41509, "creation_time": "2009-04-24T08:49:06Z", "is_private": false}]
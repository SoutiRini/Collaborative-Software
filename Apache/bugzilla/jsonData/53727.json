[{"count": 0, "attachment_id": null, "creator": "sokann@gmail.com", "is_private": false, "id": 161454, "time": "2012-08-16T05:41:34Z", "bug_id": 53727, "creation_time": "2012-08-16T05:41:34Z", "tags": [], "text": "1. Create a simple web app and serve it with ajp\n2. In the web app, create a normal page (with .js, .css, and images), then craft a slow page that only returns a response after 1 second\n3. Setup a reversed proxy to the web app with mod_proxy_ajp (a plain ProxyPass line)\n4. Enable mod_deflate for the usual content types\n5. Open Firefox, go to about:config, and set network.http.accept-encoding from \"gzip, deflate\" to an empty string\n6. Restart Firefox, clear cache\n7. With Firefox, access the normal page and let it load to completion, then access the slow page and press \"Ctrl-W\" to close the tab before the response is returned\n8. Open Chrome, clear cache\n9. With Chrome, access the normal page and see things go haywire, e.g. a request for a .js file will receive a response of image/png\n\nThe symptom of mixed up response is similar to bug 40310 and bug 47714. In production system, other than broken functionality caused by .js file returned as image, our users were able to see responses intended for others.\n\nOnce things go haywire, a graceful reload of Apache will get things to work again (leaving browser and proxy caching aside), until the next non-gzip client abandons a page load."}, {"count": 1, "tags": [], "bug_id": 53727, "is_private": false, "text": "Actually, step 4 and 5 are just red herring. I can reproduce the bug without enabling mod_deflate and with a normal Firefox.", "id": 161457, "time": "2012-08-16T09:27:01Z", "creator": "sokann@gmail.com", "creation_time": "2012-08-16T09:27:01Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "(In reply to comment #1)\n> Actually, step 4 and 5 are just red herring. I can reproduce the bug without\n> enabling mod_deflate and with a normal Firefox.\n\nWhich version of Tomcat did you use?\nAny changes to the default configuration of the Tomcat AJP connector or (apart from the mentioned one ProxyPass line) to mod_proxy configuration?\n\nCould you please provide your Tomcat server.xml?\n\nCan you reproduce with the Tomcat standard ROOT context plus a slow.jsp with the following contents?\n\n<%Thread.sleep(4000);%>\nDone.\n\nRegards,\n\nRainer", "id": 161459, "time": "2012-08-16T11:40:55Z", "bug_id": 53727, "creation_time": "2012-08-16T11:40:55Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 53727, "text": "This was assigned CVE-2012-3507.\n\nIt has been fixed in r1373955 for trunk and r1374297 for 2.4.x and was released today with version 2.4.3.\n\nNot 2.2 version is affected.", "id": 161567, "time": "2012-08-21T15:41:49Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-08-21T15:41:49Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "rainer.jung@kippdata.de", "text": "Oups, I meant CVE-2012-3502.", "id": 161594, "time": "2012-08-21T16:43:19Z", "bug_id": 53727, "creation_time": "2012-08-21T16:43:19Z", "tags": [], "is_private": false}]
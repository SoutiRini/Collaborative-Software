[{"count": 0, "tags": [], "creator": "mhilpert@gmx.de", "attachment_id": null, "id": 36834, "time": "2003-05-07T15:13:12Z", "bug_id": 19737, "creation_time": "2003-05-07T15:13:12Z", "is_private": false, "text": "<loadproperties> does not load the current file that was changed within the \nsame target (or even the same run when the file is changed in another target \nthat occurs in the \"depends=\" parameter of the target.\n\nexample: a target updates the build.number file with the <buildnumber> task. \ntha <loadproperties> task then reads this properties file. the resulting value \nof the build.number property is the value before <buildnumber> was called:\n\n-------\n    <target name=\"build.number++\" depends=\"info\" description=\"increase build \nnumber\">\n        <!-- increase build number in file build.number: -->\n        <buildnumber file=\"${java}${fs}build.number\"/>\n        <touch file=\"${java}${fs}build.number\"/>\n        \n        <!-- get new build number: -->\n        <loadproperties srcfile=\"${java}${fs}build.number\"/>\n        <property name=\"bn\" value=\"BUILD_NUMBER = ${build.number}\"/>\n        <echo message=\"Old bn=(nothing) new bn=${bn}\"/>\n        <!-- update build number in Version class: -->\n        <replace file=\"${src}${fs}de${fs}icomps${fs}amc${fs}amr${fs}\nVersion.java\" token=\"${oldbn}\" value=\"${bn}\"/>\n    </target>\n-------"}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 36835, "time": "2003-05-07T15:22:21Z", "bug_id": 19737, "creation_time": "2003-05-07T15:22:21Z", "is_private": false, "text": "Please spare yourself some frustration and make yourself familiar with how\nproperties work in Ant.  If you reread my comment when I closed Bug 19730 you'll\nsee I said - no matter which task you've used to set it.\n\nYou say the build number doesn't change, this in turn implies that the property\nhas a value before you start the loadproperties task.  The task will read the\nfile (believe me, it does), but it will not change the value of the property\nbecause properties are immutable in Ant."}, {"text": "nope, as the code states:\n\n    <target name=\"build.number++\" depends=\"info\" description=\"increase build \nnumber\">\n        <!-- increase build number in file build.number: -->\n        <buildnumber file=\"${java}${fs}build.number\"/>\n        \n        <!-- get new build number: -->\n        <loadproperties srcfile=\"${java}${fs}build.number\"/>\n        <property name=\"bn\" value=\"BUILD_NUMBER = ${build.number}\"/>\n        <!-- update build number in Version class: -->\n        <replace file=\"${src}${fs}de${fs}icomps${fs}amc${fs}amr${fs}\nVersion.java\" token=\"${oldbn}\" value=\"${bn}\"/>\n    </target>\n\nthe property is just loaded once (this is the only target in the ant build file \nthat handles with the build.number). so the property is just set once, after the \n<buildnumber> task was called. and i assume that this <buildnumber> task does \nnot have an internal property \"build.number\" ... ?", "tags": [], "bug_id": 19737, "is_private": false, "count": 2, "id": 36866, "time": "2003-05-07T20:13:03Z", "creator": "mhilpert@gmx.de", "creation_time": "2003-05-07T20:13:03Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 19737, "attachment_id": null, "text": "Your assumption is wrong. <buildnumber> sets the property.\n\nhttp://ant.apache.org/manual/CoreTasks/buildnumber.html\n\n\"then set the property build.number to the value that was read in\"", "id": 36886, "time": "2003-05-08T03:56:41Z", "creator": "conor@apache.org", "creation_time": "2003-05-08T03:56:41Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 19737, "is_private": false, "id": 36889, "creation_time": "2003-05-08T08:52:01Z", "time": "2003-05-08T08:52:01Z", "creator": "mhilpert@gmx.de", "text": "but the build.number is not set to the current value. here's a test case:\n\n--------\n    <target name=\"build.number++\" description=\"increase build number\">\n        <echo message=\"current bn=${build.number}\"/>\n        <!-- increase build number in file build.number: -->\n        <buildnumber file=\"${java}${fs}build.number\"/>\n        <echo message=\"next bn=${build.number}\"/>\n        <!-- get new build number: -->\n        <loadproperties srcfile=\"${java}${fs}build.number\"/>\n        <echo message=\"new bn=${build.number}\"/>\n    </target>\n-------\n\noutput is:\n\n-------\nbuild.number++:\n        [echo] current bn=${build.number}\n        [echo] next bn=9\n        [echo] new bn=9\n-------\n\nalthough the build.number file has a build.number property value of 10! i run \nthis a dozen times and the output is always 1 lower than the value in the \nbuild.number file.\n\n", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 19737, "attachment_id": null, "id": 36890, "time": "2003-05-08T09:05:38Z", "creator": "bodewig@apache.org", "creation_time": "2003-05-08T09:05:38Z", "is_private": false, "text": "We can this INVALID/REOPEN game for ages.  Please read the manual for buildnumber\nand what Conor has written below \"to the value that was read in\".\n\nThe buildnumber task reads your old file and sets the build.number property to\nthe value found therein.  After that it increases the number in the file.\n\nloadproperties read the file but doesn't reset the value of the property because\nno task in Ant will do so."}]
[{"count": 0, "tags": [], "creator": "charles.fisher@alcoa.com", "text": "I realize that this involves libraries outside of your control, but any assistance that you can offer would be very much appreciated.\n\nRandom child server crashes, seemingly related to clone(), Oracle Instant Client, and pthreads. If MPM is not configured for prefork, PHP functions appear in the backtrace.\n\nPlatform is Oracle Linux 5.10. Configure directives below.\n\n[Mon Jan 27 13:24:03.830719 2014] [core:notice] [pid 2831] AH00051: child pid 2835 exit signal Segmentation fault (11), possible coredump in /home/oracle/httpd/core\n\n[root@prdoi httpd]# ll core\ntotal 302768\n-rw------- 1 oracle dba 157147136 Jan 27 13:24 core.2835\n-rw------- 1 oracle dba 156528640 Jan 27 13:24 core.2838\n-rw------- 1 oracle dba 155570176 Jan 27 13:24 core.2877 #all corefiles result in similar bt\n\n[root@prdoi httpd]# gdb bin/httpd\nGNU gdb (GDB) Red Hat Enterprise Linux (7.0.1-45.0.1.el5)\nCopyright (C) 2009 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"i386-redhat-linux-gnu\".\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>...\nReading symbols from /home/oracle/httpd/bin/httpd...done.\n\n(gdb) core core/core.2835\n[New Thread 2857]\n[New Thread 2835]\nwarning: .dynamic section for \"/lib/librt.so.1\" is not at the expected address\n...\nLoaded symbols for /usr/lib/oracle/10.2.0.5/client/lib/libociei.so\nCore was generated by `bin/httpd'.\nProgram terminated with signal 11, Segmentation fault.\n#0  0x00331410 in __kernel_vsyscall ()\n\n(gdb) bt\n#0  0x00331410 in __kernel_vsyscall ()\n#1  0x00bdda96 in nanosleep () from /lib/libc.so.6\n#2  0x00bdd8bf in sleep () from /lib/libc.so.6\n#3  0x03a5d994 in kpucpincrtime () from /usr/lib/oracle/10.2.0.5/client/lib/libclntsh.so.10.1\n#4  0x00143912 in start_thread () from /lib/libpthread.so.0\n#5  0x00c1f7ce in clone () from /lib/libc.so.6\n\n(gdb) bt full\n#0  0x00331410 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x00bdda96 in nanosleep () from /lib/libc.so.6\nNo symbol table info available.\n#2  0x00bdd8bf in sleep () from /lib/libc.so.6\nNo symbol table info available.\n#3  0x03a5d994 in kpucpincrtime () from /usr/lib/oracle/10.2.0.5/client/lib/libclntsh.so.10.1\nNo symbol table info available.\n#4  0x00143912 in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#5  0x00c1f7ce in clone () from /lib/libc.so.6\nNo symbol table info available.\n\n\n\n--Apache config:\n#APR:\n./configure --prefix=/home/oracle/httpd/apr\n\n#APR-UTIL:\n./configure --prefix=/home/oracle/httpd/apr-util \\\n        --with-apr=/home/oracle/httpd/apr\n\n./configure \\\n        --prefix=/home/oracle/httpd \\\n        --enable-suexec --with-suexec --enable-so \\\n        --with-apr=/home/oracle/httpd/apr \\\n        --with-mpm=prefork \\\n        --with-apr-util=/home/oracle/httpd/apr-util \\\n        --with-suexec-uidmin=500 --with-suexec-gidmin=100 \\\n        $*\n\n--PHP config:\n        ./configure \\\n        --with-zlib-dir \\\n        --with-png-dir \\\n        --with-gd \\\n        --enable-gd-native-ttf \\\n        --with-freetype-dir \\\n        --with-gettext \\\n        --with-ldap \\\n        --without-mysql \\\n        --with-oci8=instantclient,/usr/lib/oracle/10.2.0.5/client/lib \\\n        --enable-ftp \\\n        --enable-sockets \\\n        --with-lib-dir=/home/oracle/httpd/php/lib \\\n        --with-apxs2=/home/oracle/httpd/bin/apxs", "id": 172712, "time": "2014-01-27T19:40:44Z", "bug_id": 56069, "creation_time": "2014-01-27T19:40:44Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "covener@gmail.com", "text": "That's not the problematic thread, try \n\nthread apply all bt. \n\nYou might find it easier to summarize by piping the above output through this script, but I've only used it a few times.\n\n  http://people.apache.org/~covener/uniqstack", "id": 172713, "time": "2014-01-27T19:47:55Z", "bug_id": 56069, "creation_time": "2014-01-27T19:47:55Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 56069, "attachment_id": null, "text": "I guess PHP is all over this. Move on to them?\n\n(gdb) thread apply all bt\n\nThread 2 (Thread 0xb7f2b700 (LWP 2835)):\n#0  0x00331410 in __kernel_vsyscall ()\n#1  0x00b73266 in kill () from /lib/libc.so.6\n#2  0x080942fd in sig_coredump (sig=2835) at mpm_unix.c:977\n#3  <signal handler called>\n#4  0x042b1c8f in lmsaicmt () from /usr/lib/oracle/10.2.0.5/client/lib/libclntsh.so.10.1\n#5  0x0410cd34 in kpugemlc () from /usr/lib/oracle/10.2.0.5/client/lib/libclntsh.so.10.1\n#6  0x0410ca6d in kpugeml () from /usr/lib/oracle/10.2.0.5/client/lib/libclntsh.so.10.1\n#7  0x039ec3f4 in kpugdr () from /usr/lib/oracle/10.2.0.5/client/lib/libclntsh.so.10.1\n#8  0x03ab9033 in OCIErrorGet () from /usr/lib/oracle/10.2.0.5/client/lib/libclntsh.so.10.1\n#9  0x0123c364 in php_oci_create_env (charsetid=17124, tsrm_ls=0x84ffc70) at /dpwusers/fishecj/php-5.5.7/ext/oci8/oci8.c:2927\n#10 0x0123da09 in php_oci_create_spool (username=0xb7f06d90 \"WEBAPPL_FULL_ACCESS\", username_len=19, password=0xb7f0abb8 \"OURPASSWORD\", password_len=10,\n    dbname=0xb7f0a674 \"(description=(address=(protocol=tcp)(host=prdoi.dpw.alcoa.com)(port=1521))(connect_data=(sid=prdapps)))\", dbname_len=103,\n    hash_key=0xb7f0ad24 \"oci8spool***webappl_full_access****3038584789**(description=(address=(protocol=tcp)(host=prdoi.dpw.alcoa.com)(port=1521))(connect_data=(sid=prdapps)))**1\", hash_key_len=153, charsetid=1, tsrm_ls=0x8336c58) at /dpwusers/fishecj/php-5.5.7/ext/oci8/oci8.c:2731\n#11 0x01243228 in php_oci_get_spool (username=0xb7f06d90 \"WEBAPPL_FULL_ACCESS\", username_len=19, password=0xb7f0abb8 \"OURPASSWORD\", password_len=10,\n    new_password=0x0, new_password_len=0,\n    dbname=0xb7f0a674 \"(description=(address=(protocol=tcp)(host=prdoi.dpw.alcoa.com)(port=1521))(connect_data=(sid=prdapps)))\", dbname_len=103,\n    charset=0x0, session_mode=0, persistent=0, exclusive=0, tsrm_ls=0x8336c58) at /dpwusers/fishecj/php-5.5.7/ext/oci8/oci8.c:2875\n#12 php_oci_do_connect_ex (username=0xb7f06d90 \"WEBAPPL_FULL_ACCESS\", username_len=19, password=0xb7f0abb8 \"OURPASSWORD\", password_len=10, new_password=0x0,\n    new_password_len=0, dbname=0xb7f0a674 \"(description=(address=(protocol=tcp)(host=prdoi.dpw.alcoa.com)(port=1521))(connect_data=(sid=prdapps)))\",\n    dbname_len=103, charset=0x0, session_mode=0, persistent=0, exclusive=0, tsrm_ls=0x8336c58) at /dpwusers/fishecj/php-5.5.7/ext/oci8/oci8.c:2082\n#13 0x01243e0f in php_oci_do_connect (ht=3, return_value=0xb7f06dc8, return_value_ptr=0x0, this_ptr=0x0, return_value_used=1, tsrm_ls=0x8336c58,\n    persistent=0, exclusive=0) at /dpwusers/fishecj/php-5.5.7/ext/oci8/oci8.c:1745\n#14 0x01256e84 in zif_oci_connect (ht=3, return_value=0xb7f06dc8, return_value_ptr=0x0, this_ptr=0x0, return_value_used=1, tsrm_ls=0x8336c58)\n    at /dpwusers/fishecj/php-5.5.7/ext/oci8/oci8_interface.c:1606\n#15 0x0140c0e0 in zend_do_fcall_common_helper_SPEC (execute_data=0xb7eec300, tsrm_ls=0x8336c58) at /dpwusers/fishecj/php-5.5.7/Zend/zend_vm_execute.h:550\n#16 0x0140b469 in execute_ex (execute_data=0xb7eec300, tsrm_ls=0x8336c58) at /dpwusers/fishecj/php-5.5.7/Zend/zend_vm_execute.h:363\n#17 0x013d4eeb in zend_execute_scripts (type=8, tsrm_ls=0x8336c58, retval=0x0, file_count=3) at /dpwusers/fishecj/php-5.5.7/Zend/zend.c:1320\n#18 0x0136e058 in php_execute_script (primary_file=0xbfea7560, tsrm_ls=0x8336c58) at /dpwusers/fishecj/php-5.5.7/main/main.c:2489\n#19 0x0148d558 in php_handler (r=0x84cec60) at /dpwusers/fishecj/php-5.5.7/sapi/apache2handler/sapi_apache2.c:667\n#20 0x08087a5b in ap_run_handler (r=0x84cec60) at config.c:169\n#21 0x0808b69b in ap_invoke_handler (r=0x84cec60) at config.c:439\n#22 0x0809dac7 in ap_process_async_request (r=0x84cec60) at http_request.c:317\n#23 0x0809dbfd in ap_process_request (r=0x84cec60) at http_request.c:363\n#24 0x0809a130 in ap_process_http_sync_connection (c=0x84c8a88) at http_core.c:190\n#25 ap_process_http_connection (c=0x84c8a88) at http_core.c:231\n#26 0x0809204b in ap_run_process_connection (c=0x84c8a88) at connection.c:41\n#27 0x080a4110 in child_main (child_num_arg=<value optimized out>) at prefork.c:704\n#28 0x080a4483 in make_child (s=0x831fee8, slot=0) at prefork.c:800\n#29 0x080a4544 in startup_children (number_to_start=5) at prefork.c:818\n#30 0x080a4b93 in prefork_run (_pconf=0x82fb0a8, plog=0x83219b0, s=0x831fee8) at prefork.c:976\n#31 0x0806fd19 in ap_run_mpm (pconf=0x82fb0a8, plog=0x83219b0, s=0x831fee8) at mpm_common.c:96\n#32 0x0806a43a in main (argc=137334944, argv=0x84c68a8) at main.c:777\n\nThread 1 (Thread 0x7852b90 (LWP 2857)):\n#0  0x00331410 in __kernel_vsyscall ()\n#1  0x00bdda96 in nanosleep () from /lib/libc.so.6\n#2  0x00bdd8bf in sleep () from /lib/libc.so.6\n#3  0x03a5d994 in kpucpincrtime () from /usr/lib/oracle/10.2.0.5/client/lib/libclntsh.so.10.1\n#4  0x00143912 in start_thread () from /lib/libpthread.so.0\n#5  0x00c1f7ce in clone () from /lib/libc.so.6", "id": 172714, "time": "2014-01-27T19:59:36Z", "creator": "charles.fisher@alcoa.com", "creation_time": "2014-01-27T19:59:36Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 56069, "attachment_id": null, "text": "yes, nothing can be done here.", "id": 172715, "time": "2014-01-27T20:03:56Z", "creator": "covener@gmail.com", "creation_time": "2014-01-27T20:03:56Z", "is_private": false}]
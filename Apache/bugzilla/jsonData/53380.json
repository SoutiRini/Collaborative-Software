[{"count": 0, "text": "Created attachment 28901\noffending word doc\n\nOut of bounds exception occurs (stack trace below) when parsing attached word 97 doc\n\n\nException in thread \"main\" org.apache.tika.exception.TikaException: Unexpected RuntimeException from org.apache.tika.parser.microsoft.OfficeParser@393e6226\n\tat org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:244)\n\tat org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)\n\tat org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)\n\tat org.apache.tika.cli.TikaCLI$OutputType.process(TikaCLI.java:133)\n\tat org.apache.tika.cli.TikaCLI.process(TikaCLI.java:400)\n\tat org.apache.tika.cli.TikaCLI.main(TikaCLI.java:101)\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 18\n\tat org.apache.poi.util.LittleEndian.getInt(LittleEndian.java:163)\n\tat org.apache.poi.hwpf.model.Colorref.<init>(Colorref.java:81)\n\tat org.apache.poi.hwpf.model.types.SHDAbstractType.fillFields(SHDAbstractType.java:56)\n\tat org.apache.poi.hwpf.usermodel.ShadingDescriptor.<init>(ShadingDescriptor.java:38)\n\tat org.apache.poi.hwpf.sprm.CharacterSprmUncompressor.unCompressCHPOperation(CharacterSprmUncompressor.java:582)\n\tat org.apache.poi.hwpf.sprm.CharacterSprmUncompressor.uncompressCHP(CharacterSprmUncompressor.java:65)\n\tat org.apache.poi.hwpf.model.StyleSheet.createChp(StyleSheet.java:288)\n\tat org.apache.poi.hwpf.model.StyleSheet.<init>(StyleSheet.java:121)\n\tat org.apache.poi.hwpf.HWPFDocument.<init>(HWPFDocument.java:346)\n\tat org.apache.tika.parser.microsoft.WordExtractor.parse(WordExtractor.java:77)\n\tat org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:185)\n\tat org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:160)\n\tat org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)\n\t... 5 more", "bug_id": 53380, "attachment_id": 28901, "id": 159800, "time": "2012-06-07T10:43:27Z", "creator": "tim.barrett@comcor.nl", "creation_time": "2012-06-07T10:43:27Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "acougarm@bwc.org", "attachment_id": null, "id": 162042, "time": "2012-09-10T05:40:40Z", "bug_id": 53380, "creation_time": "2012-09-10T05:40:40Z", "is_private": false, "text": "We're running into this same issue with many of our DOC files. When will it be addressed? Thank you."}, {"count": 2, "tags": [], "bug_id": 53380, "is_private": false, "id": 162043, "creation_time": "2012-09-10T06:41:19Z", "time": "2012-09-10T06:41:19Z", "creator": "acougarm@bwc.org", "text": "Created attachment 29349\nBlank DOC file that generates the same error in POI.\n\nThis file contains no text (completely blank) and it still generates the POI exception: ArrayIndexOutOfBounds", "attachment_id": 29349}, {"count": 3, "text": "Fixed in trunk.\n\nWe had incorrect implementation for sprmCShd80 (0x4866) 0x66 processing, Shd was used instead of Shd80", "bug_id": 53380, "attachment_id": null, "id": 162079, "time": "2012-09-11T19:50:47Z", "creator": "vlsergey@gmail.com", "creation_time": "2012-09-11T19:50:47Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 53380, "is_private": false, "id": 162080, "time": "2012-09-11T19:53:41Z", "creator": "acougarm@bwc.org", "creation_time": "2012-09-11T19:53:41Z", "tags": [], "text": "Thanks, Sergey, for fixing this :)\nWhere can we download the latest build? Thanks again!"}, {"count": 5, "tags": [], "text": "I believe it will be here https://builds.apache.org/job/POI/lastSuccessfulBuild/artifact/build/dist/ today (USA time?)", "is_private": false, "id": 162081, "creation_time": "2012-09-11T19:56:32Z", "time": "2012-09-11T19:56:32Z", "creator": "vlsergey@gmail.com", "bug_id": 53380, "attachment_id": null}, {"count": 6, "text": "Thanks, Sergey. Your build with the fix will probably show up today; the one listed there right now is from 10 September.", "bug_id": 53380, "attachment_id": null, "id": 162097, "time": "2012-09-12T05:41:47Z", "creator": "acougarm@bwc.org", "creation_time": "2012-09-12T05:41:47Z", "tags": [], "is_private": false}, {"count": 7, "text": "(In reply to comment #6)\n> Thanks, Sergey. Your build with the fix will probably show up today; the one\n> listed there right now is from 10 September.\n\nHi guys, Looks like the build (46) failed. Any chance of getting one out today? :-)", "bug_id": 53380, "attachment_id": null, "id": 162134, "time": "2012-09-13T07:52:13Z", "creator": "tim.barrett@comcor.nl", "creation_time": "2012-09-13T07:52:13Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "id": 162137, "time": "2012-09-13T08:49:56Z", "bug_id": 53380, "creation_time": "2012-09-13T08:49:56Z", "is_private": false, "text": "It was an internal error in Jenkins:\n\nFATAL: Cannot find executable from the choosen Ant installation \"Ant (latest)\"\nBuild step 'Invoke Ant' marked build as failure\n[WARNINGS] Skipping publisher since build result is FAILURE\nArchiving artifacts\n\nToday's rebuild #47 was successfull. \n\nYegor\n\n(In reply to comment #7)\n> (In reply to comment #6)\n> > Thanks, Sergey. Your build with the fix will probably show up today; the one\n> > listed there right now is from 10 September.\n> \n> Hi guys, Looks like the build (46) failed. Any chance of getting one out\n> today? :-)"}, {"count": 9, "text": "Thank you, Sergey and Yegor. The issue has been resolved with Build #47: https://builds.apache.org/job/POI/47/", "bug_id": 53380, "attachment_id": null, "id": 162142, "time": "2012-09-13T10:49:29Z", "creator": "acougarm@bwc.org", "creation_time": "2012-09-13T10:49:29Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "creator": "tim.barrett@comcor.nl", "attachment_id": 29398, "id": 162276, "time": "2012-09-19T06:55:23Z", "bug_id": 53380, "creation_time": "2012-09-19T06:55:23Z", "is_private": false, "text": "Created attachment 29398\nbuild 47 fixed some but not all of the errors with old word 97 docs. Attached still throws an exception (array out of bounds)"}, {"count": 11, "text": "Still some issus with old word 97 docs", "bug_id": 53380, "attachment_id": null, "id": 162277, "time": "2012-09-19T06:56:02Z", "creator": "tim.barrett@comcor.nl", "creation_time": "2012-09-19T06:56:02Z", "tags": [], "is_private": false}, {"count": 12, "tags": [], "creator": "vlsergey@gmail.com", "attachment_id": null, "id": 162310, "time": "2012-09-21T07:15:19Z", "bug_id": 53380, "creation_time": "2012-09-21T07:15:19Z", "is_private": false, "text": "Tim,\n\nall three files are opened without exceptions. Please try again.\n\nSergey"}, {"count": 13, "tags": [], "creator": "acougarm@bwc.org", "attachment_id": null, "is_private": false, "id": 162351, "time": "2012-09-23T09:03:38Z", "bug_id": 53380, "creation_time": "2012-09-23T09:03:38Z", "text": "Thanks for the fix. The latest build (49) is broken right now: https://builds.apache.org/job/POI/49/"}, {"count": 14, "tags": [], "text": "There was additional problem with 3rd document provided by Tim. This problem was linked to broken internal structure of lists information in the document (i.e. document was not well-formed).\n\nToday I refactored lists processing, and added a \"safe-path\" to extract text (HTML, FO) information from such documents.\n\nAll HWPF-tests passed, so need to wait for the next build :)", "attachment_id": null, "bug_id": 53380, "id": 162356, "time": "2012-09-23T13:39:37Z", "creator": "vlsergey@gmail.com", "creation_time": "2012-09-23T13:39:37Z", "is_private": false}, {"count": 15, "tags": [], "creator": "acougarm@bwc.org", "attachment_id": 29416, "id": 162381, "time": "2012-09-25T06:59:23Z", "bug_id": 53380, "creation_time": "2012-09-25T06:59:23Z", "is_private": false, "text": "Created attachment 29416\nBug persists with Word DOC files and latest build (50)\n\nThe ArrayIndexOutOfBounds bug persists with the latest build (#50) of POI. Please test using the attached blank_2.doc Word DOC file to reproduce."}, {"count": 16, "text": "acougarm, current code doesn't throw any errors on simple file parsing or text extraction. Could you please attach stack trace?", "bug_id": 53380, "attachment_id": null, "id": 162391, "time": "2012-09-25T21:41:45Z", "creator": "vlsergey@gmail.com", "creation_time": "2012-09-25T21:41:45Z", "tags": [], "is_private": false}, {"count": 17, "text": "Thanks, Sergey. We downloaded the latest build from here: https://builds.apache.org/job/POI/50/artifact/build/dist/poi-bin-3.9-beta1-20120924.tar.gz\n\nHere is the stack trace from a Curl command against Solr, using the above build files:\n\ncurl \"http://localhost:8983/solr/update/extract?extractOnly=true&fmap.content=text\" -F \"myfile=@blank_2.doc\"\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<response>\n<lst name=\"responseHeader\"><int name=\"status\">500</int><int name=\"QTime\">356</in\nt></lst><lst name=\"error\"><str name=\"msg\">org.apache.tika.exception.TikaExceptio\nn: Unexpected RuntimeException from org.apache.tika.parser.microsoft.OfficeParse\nr@2c164804</str><str name=\"trace\">org.apache.solr.common.SolrException: org.apac\nhe.tika.exception.TikaException: Unexpected RuntimeException from org.apache.tik\na.parser.microsoft.OfficeParser@2c164804\n        at org.apache.solr.handler.extraction.ExtractingDocumentLoader.load(Extr\nactingDocumentLoader.java:230)\n        at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(Co\nntentStreamHandlerBase.java:74)\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandl\nerBase.java:129)\n        at org.apache.solr.core.RequestHandlers$LazyRequestHandlerWrapper.handle\nRequest(RequestHandlers.java:240)\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1656)\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter\n.java:454)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilte\nr.java:275)\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(Servlet\nHandler.java:1337)\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java\n:484)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.j\nava:119)\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.jav\na:524)\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandl\ner.java:233)\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandl\ner.java:1065)\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:\n413)\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandle\nr.java:192)\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandle\nr.java:999)\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.j\nava:117)\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(Cont\nextHandlerCollection.java:250)\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerColl\nection.java:149)\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper\n.java:111)\n        at org.eclipse.jetty.server.Server.handle(Server.java:351)\n        at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(Abstrac\ntHttpConnection.java:454)\n        at org.eclipse.jetty.server.BlockingHttpConnection.handleRequest(Blockin\ngHttpConnection.java:47)\n        at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(Abstra\nctHttpConnection.java:890)\n        at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.header\nComplete(AbstractHttpConnection.java:944)\n        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:642)\n        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:230)\n\n        at org.eclipse.jetty.server.BlockingHttpConnection.handle(BlockingHttpCo\nnnection.java:66)\n        at org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(So\ncketConnector.java:254)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPoo\nl.java:599)\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool\n.java:534)\n        at java.lang.Thread.run(Unknown Source)\nCaused by: org.apache.tika.exception.TikaException: Unexpected RuntimeException\nfrom org.apache.tika.parser.microsoft.OfficeParser@2c164804\n        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:244\n)\n        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242\n)\n        at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:1\n20)\n        at org.apache.solr.handler.extraction.ExtractingDocumentLoader.load(Extr\nactingDocumentLoader.java:224)\n        ... 31 more\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 7\n        at org.apache.poi.util.LittleEndian.getInt(LittleEndian.java:163)\n        at org.apache.poi.hwpf.model.Colorref.&lt;init&gt;(Colorref.java:81)\n        at org.apache.poi.hwpf.model.types.SHDAbstractType.fillFields(SHDAbstrac\ntType.java:56)\n        at org.apache.poi.hwpf.usermodel.ShadingDescriptor.&lt;init&gt;(ShadingD\nescriptor.java:38)\n        at org.apache.poi.hwpf.sprm.CharacterSprmUncompressor.unCompressCHPOpera\ntion(CharacterSprmUncompressor.java:582)\n        at org.apache.poi.hwpf.sprm.CharacterSprmUncompressor.uncompressCHP(Char\nacterSprmUncompressor.java:65)\n        at org.apache.poi.hwpf.model.StyleSheet.createChp(StyleSheet.java:288)\n        at org.apache.poi.hwpf.model.StyleSheet.&lt;init&gt;(StyleSheet.java:121\n)\n        at org.apache.poi.hwpf.HWPFDocument.&lt;init&gt;(HWPFDocument.java:346)\n        at org.apache.tika.parser.microsoft.WordExtractor.parse(WordExtractor.ja\nva:77)\n        at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java\n:185)\n        at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java\n:160)\n        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242\n)\n        ... 34 more\n</str><int name=\"code\">500</int></lst>\n</response>", "bug_id": 53380, "attachment_id": null, "id": 162394, "time": "2012-09-26T06:53:15Z", "creator": "acougarm@bwc.org", "creation_time": "2012-09-26T06:53:15Z", "tags": [], "is_private": false}, {"count": 18, "tags": [], "creator": "vlsergey@gmail.com", "attachment_id": null, "is_private": false, "id": 162395, "time": "2012-09-26T07:19:00Z", "bug_id": 53380, "creation_time": "2012-09-26T07:19:00Z", "text": "acougarm, it's a stack trace from some old version. Current SVN doesn't have code on CharacterSprmUncompressor.java:582 line neither call to ShadingDescriptor.<init> from CharacterSprmUncompressor::unCompressCHPOperation()"}, {"count": 19, "tags": [], "text": "Sorry about that, Sergey! Please attribute this to operator error :)\n\nI hadn't replaced all the old POI files, and so some of the previous build files were still lingering around. Once I deleted those, everything working beautifully!\n\nThanks again for your patience.", "attachment_id": null, "bug_id": 53380, "id": 162414, "time": "2012-09-26T13:40:55Z", "creator": "acougarm@bwc.org", "creation_time": "2012-09-26T13:40:55Z", "is_private": false}]
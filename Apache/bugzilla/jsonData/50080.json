[{"count": 0, "tags": [], "creator": "jens_0@hotmail.com", "attachment_id": null, "text": "When using the settings \"Generate parent sample\" checked and \"Include timer duration in generated sample\" unchecked, samples generated by the transaction controller nevertheless include the duration of timers that are existing as children.\n\nWhen \"Generate parent sample\" is unchecked, the reported times correctly do not include the timers.\n\nWith other words: \"Include timer duration in generated sample\" does not have any effect if \"Generate parent sample\" is checked.", "id": 140694, "time": "2010-10-12T08:18:43Z", "bug_id": 50080, "creation_time": "2010-10-12T08:18:43Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 50080, "text": "Excludes timer option came with the Bug 41418, but the patch 41418 don't manage Excludes timer when Generate parent is on.\n\n(in code : Bug 41418 => TC.next2() but not TC.next1())\n\nIt's seems hard to solve.", "id": 140738, "time": "2010-10-14T03:38:40Z", "creator": "milamber@apache.org", "creation_time": "2010-10-14T03:38:40Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "jens_0@hotmail.com", "attachment_id": null, "text": "Here's a suggestion to solve the problem.\n\nIt requires changing the visibility of SampleResult's setEndTime from protected to public.\n\nAny concerns?\n\noriginal/src/core/org/apache/jmeter/control/TransactionSampler.java Thu Jul 08 22:42:36 2010\n+++ new/src/core/org/apache/jmeter/control/TransactionSampler.java Wed Oct 27 16:19:32 2010\n@@ -49,0 +50,2 @@\n+    private int totalTime = 0;\n+   \n@@ -101,0 +104 @@\n+        totalTime += res.getTime();\n@@ -113,0 +117,8 @@\n+       \n+        if (!transactionController.isIncludeTimers()) {\n+         long end = SampleResult.currentTimeInMs();\n+         \n+         transactionSampleResult.setIdleTime(end - transactionSampleResult.getStartTime() - totalTime);\n+         transactionSampleResult.setEndTime(end);\n+        }\n+", "id": 141096, "time": "2010-10-27T10:33:14Z", "bug_id": 50080, "creation_time": "2010-10-27T10:33:14Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jens_0@hotmail.com", "attachment_id": null, "text": "(In reply to comment #2)\nOr without changing the visibility of setEndTime:\n\nsrc/core/org/apache/jmeter/control/TransactionSampler.java\n \n@@ -49,0 +50,2 @@\n+    private int totalTime = 0;\n+   \n@@ -65 +67,2 @@\n-        transactionSampleResult.sampleStart();\n+        if (transactionController.isIncludeTimers())\n+         transactionSampleResult.sampleStart();\n@@ -101 +104,9 @@\n-        transactionSampleResult.addSubResult(res);\n+        if (transactionController.isIncludeTimers()) {\n+         transactionSampleResult.addSubResult(res);\n+        } else {\n+         transactionSampleResult.setBytes(transactionSampleResult.getBytes() + res.getBytes());\n+         transactionSampleResult.addRawSubResult(res);\n+         \n+         totalTime += res.getTime();\n+        }\n+       \n@@ -112,0 +124,7 @@\n+        }\n+       \n+        if (!transactionController.isIncludeTimers()) {\n+         long end = SampleResult.currentTimeInMs();\n+         transactionSampleResult.setStampAndTime(end - totalTime, totalTime);\n+         //transactionSampleResult.setIdleTime(end - transactionSampleResult.getStartTime() - totalTime);\n+         //transactionSampleResult.setEndTime(end);", "id": 141120, "time": "2010-10-28T04:50:25Z", "bug_id": 50080, "creation_time": "2010-10-28T04:50:25Z", "is_private": false}, {"count": 4, "tags": [], "text": "Thanks for your work and patch.\nThe first approach seems better. The second approach comes with more changes in internal logic (addRawSubResult / setBytes vs addSubResult)\nI thinks changing visibility to public for setEndTime() isn't a problem.\n\n(next time: please used the file attachment field for your patch, Bugzilla cutting long lines)\n\nURL: http://svn.apache.org/viewvc?rev=1028437&view=rev\nLog:\nBug 50080 - Transaction controller incorrectly creates samples including timer duration\n\nModified:\n    jakarta/jmeter/trunk/src/core/org/apache/jmeter/control/TransactionSampler.java\n    jakarta/jmeter/trunk/src/core/org/apache/jmeter/samplers/SampleResult.java\n    jakarta/jmeter/trunk/xdocs/changes.xml", "attachment_id": null, "bug_id": 50080, "id": 141128, "time": "2010-10-28T15:14:39Z", "creator": "milamber@apache.org", "creation_time": "2010-10-28T15:14:39Z", "is_private": false}]
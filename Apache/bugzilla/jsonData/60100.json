[{"count": 0, "text": "After some months of normal work one of our servlets started giving null pointer exception due to the received requests, so we thought the problem was the calling application, but when we debugged it we saw it was doing good requests so last resort was to restart Tomcat then everything worked fine.\n\nThese are the details from localhost_access_log:\n\n\nBad requests had all these \"%20HTTP/1.1%22%20200%20111\" in the end:\n \n10.160.252.23 - - [09/Sep/2016:11:26:44 +0200] \"GET /EkoLoyServlet/EkoLoyServlet?codiceCarta=088800002401&priOutMode=vs5&retrieveFloatBal=true&srcLoyChan=001&encodingValue=ISO-8859-1&isRetrievePsxData=false&retrieveVchTmplList=true&isVchResActive=true&isCoopJsdr3Version=true&isBalanceDetails=true%20HTTP/1.1%22%20200%20111 HTTP/1.1\" 200 2842\n\n\nGood request are like these:\n\n10.160.252.24 - - [09/Sep/2016:11:29:30 +0200] \"GET /EkoLoyServlet/EkoLoyServlet?codiceCarta=088800002401&priOutMode=vs5&retrieveFloatBal=true&srcLoyChan=001&encodingValue=ISO-8859-1&isRetrievePsxData=false&retrieveVchTmplList=true&isVchResActive=true&isCoopJsdr3Version=true&isBalanceDetails=true HTTP/1.1\" 200 111\n\n\nTomcat version is 8.0.32, I've searched the change notes for 8.0.x version released after our and I've not recognized problems like these.", "creator": "giovacchini.andrea@konvergence.it", "is_private": false, "id": 193570, "time": "2016-09-09T10:34:49Z", "bug_id": 60100, "creation_time": "2016-09-09T10:34:49Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 60100, "attachment_id": null, "text": "That is most strange. The sequence:\n\n%20HTTP/1.1%22%20200%20111\n\ndecodes to\n\n HTTP/1.1\" 200 111\n\nWhich is the string from the end of the access log. I don't see how that ended up in the request line.\n\nThe only place those values are available in that format (the decoded form) is the access log. But I cannot see how they could end up in the request line. Or even how the AccessLogValve could corrupt the value of the request line - especially with the encoding since the AccessLogValve doesn't encode anything.\n\nWe are going to need more information to progress this.\n\nWhen the problem occurred, did all requests fail or just some. Was the a pattern?\n\nHow repeatable is this? I'd like to see a tcpdump of a faulty request to confirm a=exactly what is on the wire.\n\nWhat is the architecture of the system. Is it multiple clients connecting directly to a single Tomcat instance or are the reverse proxies / load-balancers involved?", "id": 193675, "time": "2016-09-13T11:05:19Z", "creator": "markt@apache.org", "creation_time": "2016-09-13T11:05:19Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 60100, "attachment_id": null, "text": "Are those rquests coming from valid clients? (Is value of user-agent header as expected? Note that it can be logged with %{User-Agent}i)\n\nMaybe some bot is reading your access logs and tries URLs that are mentioned in them? Or some human? If browser interprets some text as url, it will automatically encode spaces as '%20' when doing a request.\n\n\nI can imagine \"HTTP/1.1\" being in URL if request line is parsed incorrectly (as such characters are naturally present on the first line of HTTP request), but seeing \"200 111\" there is odd. The only place where strings \"HTTP/1.1\" and \"200 111\" are near each other is your access log, and the log lines are generated on the fly when writing the data out. Format of the log is configurable.", "id": 193676, "time": "2016-09-13T13:07:01Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2016-09-13T13:07:01Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 60100, "text": "(In reply to Konstantin Kolinko from comment #2)\n\nHi, the request were coming from valid clients, I was doing them with one of our applications and no one else was calling, it's a test environment in a private network.\n\nI can't see what the %{User-Agent} will print if added to logging because the problem disappeared after restarting Tomcat and the has been no way I was able to reproduce it again.", "id": 193916, "time": "2016-09-22T10:29:56Z", "creator": "giovacchini.andrea@konvergence.it", "creation_time": "2016-09-22T10:29:56Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "Restoring the NEEDINFO state. Comment #1 has a number of unanswered questions.", "attachment_id": null, "id": 193917, "creator": "markt@apache.org", "time": "2016-09-22T10:34:23Z", "bug_id": 60100, "creation_time": "2016-09-22T10:34:23Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 60100, "attachment_id": null, "text": "On the basis the OP has been unable to reproduce this, resolve this as works for me. It can always be re-opened if further information comes to light.", "id": 194766, "time": "2016-11-02T09:28:08Z", "creator": "markt@apache.org", "creation_time": "2016-11-02T09:28:08Z", "is_private": false}]
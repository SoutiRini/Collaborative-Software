[{"count": 0, "tags": [], "creator": "Michael.Szalay@basis06.com", "attachment_id": null, "id": 34270, "time": "2003-04-01T19:12:03Z", "bug_id": 18579, "creation_time": "2003-04-01T19:12:03Z", "is_private": false, "text": "As we needed Apache with mod_proxy as accelerator for a java web server, we had\nthe problem that the proxied server needed location awareness but could retrieve\nthe client's port address. The clients ip address is read from the header\nX-Forwarded-For, for the remote port informationen, we added the following code\nsnippet to mod_proxy so that it creates  X-Forwarded-Port as an additional\nrequest header. \n\n /* Add X-Forwarded-Server: so that upstream knows what the\n         * name of this proxy server is (if there are more than one)\n         * XXX: This duplicates Via: - do we strictly need it?\n         */\n        ap_table_mergen(req_hdrs, \"X-Forwarded-Server\", r->server->server_hostname);\n\n\t/** ADDED BY MICHAEL SZALAY */\n\n\t/* Add  X-Forwarded Port: some webservers need to know this\n\t */\n\t int remote_port = r->connection->remote_addr.sin_port;\n\n\t /* use sprintf to convert string to int */\n\t char str[50];\n\t int i;\n \t i = sprintf(str, \"%d\", remote_port);\n\n\t /* put into header */\n\t ap_table_mergen(req_hdrs, \"X-Forwarded-Port\", str);\n\n\t /* END ADDED BY MICHAEL SZALAY */"}, {"count": 1, "tags": [], "bug_id": 18579, "text": "I'm going through the bug db to make sure patches are findable.  Please see \nhttp://httpd.apache.org/dev/patches.html\n", "id": 47834, "time": "2003-11-21T18:12:10Z", "creator": "trawick@apache.org", "creation_time": "2003-11-21T18:12:10Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "abakker@gmx.net", "attachment_id": null, "id": 116417, "time": "2008-05-09T03:37:04Z", "bug_id": 44962, "creation_time": "2008-05-09T03:37:04Z", "is_private": false, "text": "Apache crashes if a lot of file_get_contents of a localhost file are done. The following PHP script reproduces the problem:\n\n<?php\necho '<pre>';\nfor ($i=1;;$i++)\n{ echo $i.\"\\n\";\n  flush();ob_flush();\n  $contents = file_get_contents('http://localhost/test.htm');\n}\n?>\n\nAfter 203 iterations the Apache server crashes and has to be stopped and started (a restart does not get the server working again, only a stop and start works).\n\nThe error.log only contains this (I guess this just confirms that the Apache server has crashed and no longer responds):\n[Fri May 09 12:15:04 2008] [error] [client 192.168.0.1] PHP Warning:  file_get_contents(http://localhost/test.htm) [<a href='function.file-get-contents'>function.file-get-contents</a>]: failed to open stream: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.\\r\\n in C:\\\\Andre\\\\Apache\\\\test.php on line 6\n\nThe problem depends on the contents of the test.htm file. If it only contains\n\n<html>\n<body>\n</body>\n</html>\n\nthe script runs until it reaches the max execution time.\n\nIf the localhost is replaced with the IP address or domain name the problem does not occur (but the script becomes much slower due to the network access).\n\nThe test.htm that reproduces the problem contains:\n\n<html>\n<head>\n<link rel=\"stylesheet\" href=\"/systeem/style/style.css\">\n<title>V.V. De Meern</title>\n<meta name=\"description\" content=\"V.V. De Meern\">\n<meta name=\"robots\" content=\"index,follow\">\n<script src=\"/beheer/include/header.js\"></script>\n</head>\n<body>\n<script src=\"menu.js\"></script>\n<a href=\"menu.html\"></a>\n<h1>Home pagina A1</h1>\n<p><img src=\"a1.jpg\" border=\"0\" alt=\"\" /></p>\n<h1>Spelers</h1>\n<p>Nicky Vermeulen, Jon Gruters, Jerryl Smeenk, Bram van Wiggen, Rolf van Elderen, Sander van der Woude, Melvin van Nood, Jorgos Katsivilis, Leo Wakelkamp, Chen Margolin, Luis Plein, Danny Berkhouwer, Whaheed Khodabaks, Alessandro Damen, Thomas van Amerongen</p>\n<h1>Leiders</h1>\n<p>John Dunsbergen, Joost Satink, Lex van der Woude</p>\n<script src=\"/beheer/include/footer.js\"></script>\n</body>\n</html>"}, {"count": 1, "tags": [], "bug_id": 44962, "attachment_id": null, "text": "This is not php bugzilla. Please open a report at http://bugs.php.net/.", "id": 116418, "time": "2008-05-09T03:50:47Z", "creator": "rpluem@apache.org", "creation_time": "2008-05-09T03:50:47Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 44962, "is_private": false, "id": 116440, "time": "2008-05-10T01:32:27Z", "creator": "abakker@gmx.net", "creation_time": "2008-05-10T01:32:27Z", "tags": [], "text": "I filed a PHP bug report, but this may still be an Apache problem as well. Surely a problem in the PHP layer should not cause the Apache server to crash? Now one user can run a PHP script, cause the Apache server to crash, and no user can access web pages anymore until someone stops and start the Apache server. It is acceptable that the PHP script crashes for one user, but not the entire Apache server for all users. I assume that the Apache core should be robust enough not to crash because of PHP problems?"}, {"count": 3, "tags": [], "bug_id": 44962, "is_private": false, "text": "Every module can crash httpd at will, because it runs native code in the same process. If you want to avoid this run your php scripts via cgi and not via mod_php.", "id": 116443, "time": "2008-05-10T04:14:47Z", "creator": "rpluem@apache.org", "creation_time": "2008-05-10T04:14:47Z", "attachment_id": null}]
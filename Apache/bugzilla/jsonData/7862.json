[{"count": 0, "tags": [], "creator": "y-koga@apache.or.jp", "text": "suexec never log a group name.\nI think the following patch works fine:\n\nIndex: support/suexec.c\n===================================================================\nRCS file: /Apache/CVS/httpd-2.0-cvs/support/suexec.c,v\nretrieving revision 1.19\ndiff -u -r1.19 suexec.c\n--- support/suexec.c\t13 Mar 2002 20:48:06 -0000\t1.19\n+++ support/suexec.c\t9 Apr 2002 11:16:02 -0000\n@@ -399,7 +399,11 @@\n     }\n     else {\n         gid = atoi(target_gname);\n-        actual_gname = strdup(target_gname);\n+\tif ((gr = getgrgid(gid)) == NULL) {\n+\t    log_err(\"invalid target group name: (%s)\\n\", target_gname);\n+\t    exit(106);\n+\t}\n+        actual_gname = strdup(gr->gr_name);\n     }\n \n #ifdef _OSD_POSIX", "id": 13081, "time": "2002-04-09T11:19:53Z", "bug_id": 7862, "creation_time": "2002-04-09T11:19:53Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 7862, "attachment_id": null, "id": 26733, "time": "2002-11-21T19:58:03Z", "creator": "trawick@apache.org", "creation_time": "2002-11-21T19:58:03Z", "is_private": false, "text": "A few comments...\n\nThe change with this patch is that\n\n1) if group name is specified as a number, the patched code now does\n   a lookup to find the name so that log messages show the name\n\n2) if the group name is specified as a number and it is invalid,\n   the error will be caught a little sooner\n\nThe cost of this patch is an extra group database lookup.\n\nIt could be considered a feature that suexec won't read /etc/groups\nif the group is specified numerically.\n\n"}, {"count": 2, "tags": [], "bug_id": 7862, "attachment_id": null, "id": 47002, "time": "2003-11-07T16:43:16Z", "creator": "pb@bieringer.de", "creation_time": "2003-11-07T16:43:16Z", "is_private": false, "text": "Still the same on 2.0.48:\n\n[2003-11-07 17:39:33]: uid: (1234/user) gid: (1234/1234) cmd: some.cgi\n\nAny result of discussions now whether or not group name should be shown?\n\nIf not, why then log the gid twice...disabling of the second one will save from\n2 to 6 chars per log line ;-) like.\n[2003-11-07 17:39:33]: uid: (1234/user) gid: (1234) cmd: some.cgi\n\nBTW: on most systems, ncsd is running by default, so group name lookup should\nnot cost so much extra time.\n"}, {"count": 3, "tags": [], "bug_id": 7862, "attachment_id": null, "id": 47789, "creation_time": "2003-11-21T17:00:24Z", "time": "2003-11-21T17:00:24Z", "creator": "trawick@apache.org", "text": "I'm going through the bug db to make sure patches are findable.  Please see \nhttp://httpd.apache.org/dev/patches.html\n", "is_private": false}, {"count": 4, "tags": [], "bug_id": 7862, "attachment_id": null, "text": "*** Bug 28690 has been marked as a duplicate of this bug. ***", "id": 56638, "time": "2004-04-29T16:32:08Z", "creator": "jorton@redhat.com", "creation_time": "2004-04-29T16:32:08Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 7862, "attachment_id": null, "text": "*** Bug 32220 has been marked as a duplicate of this bug. ***", "id": 66837, "time": "2004-11-13T07:48:59Z", "creator": "jorton@redhat.com", "creation_time": "2004-11-13T07:48:59Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 7862, "attachment_id": null, "text": "To be more precise (referring to the support/suexec.c found in the current\nversion of httpd-2.0.52), the suexec actual_gname is incorrectly reported as a\nnumeric group id and not as an alphanumeric group name.\n\nI will attach my patch and ask people to try it out.  However I'd like to list\nthe changes here to be clear in psuedo code.\n\n1.0) If the string does not contain only characters that represent\n     numbers 0-9 (numeric group id),\n     then we assume it is an alphanumeric group name,\n1.1) and we try to look for the group by name.\n1.2) If the alphanumeric group name can not be found, we log an error and exit.\n2.0) Otherwise we assume that the string contains only characters\n     that represent numbers 0-9 (numeric group id),\n2.1) we convert the string to an integer,\n2.2) and we try to look for the group by number.\n2.3) If the numeric group id can not be found, we log an error and exit.\n3.0) If we made it this far, we assume that we have found a valid group.\n3.1) We assign the actual numeric group id to a placeholder variable,\n3.2) and we assign the actual group name to a placeholder variable.\n\nNote: Contrary to previous concern, there is only one call to access the group\nfile.  The string can either be all characters which represent numbers, or it\ncan have one ormore non-numeric characters.  It can not be both.  Either\ngetgrnam or getgrgid will be called, but not both.  Furthermore, the redundant\nassignments are consolidated.  Once the group data is available, the assignments\nare exactly the same, such that they can logically follow the outer if/else\nconstruct because they will be performed in either case, so long as either of\nthe inner ifs do not exit.  If they exit, we don't have to worry beyond that point.\n\nPatched code:\n\n    /*\n     * Error out if the target group name is invalid.\n     */\n    if (strspn(target_gname, \"1234567890\") != strlen(target_gname)) {\n        if ((gr = getgrnam(target_gname)) == NULL) {\n            log_err(\"invalid target group name: (%s)\\n\", target_gname);\n            exit(106);\n        }\n    }\n    else {\n        if ((gr = getgrgid(atoi(target_gname))) == NULL) {\n            log_err(\"invalid target group id: (%s)\\n\", target_gname);\n            exit(106);\n        }\n    }\n\n    gid = gr->gr_gid;\n    actual_gname = strdup(gr->gr_name);\n", "id": 66838, "time": "2004-11-13T09:00:30Z", "creator": "warp-9.9@usa.net", "creation_time": "2004-11-13T09:00:30Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 7862, "attachment_id": 13429, "id": 66839, "creation_time": "2004-11-13T09:04:13Z", "time": "2004-11-13T09:04:13Z", "creator": "warp-9.9@usa.net", "text": "Created attachment 13429\nPatch addresses bug: suexec actual_gname always numeric", "is_private": false}, {"count": 8, "tags": [], "bug_id": 7862, "attachment_id": null, "id": 66841, "creation_time": "2004-11-13T09:21:23Z", "time": "2004-11-13T09:21:23Z", "creator": "warp-9.9@usa.net", "text": "Sorry for the multiple posts.  I just noticed that this bug is listed under the\ncomponent \"mod_suexec\" when I think it is actually a \"support\" component.  Can\nsomeone else more familiar please verify and correct?  I modified a single file,\nhttpd-2.0.52/support/suexec.c.  I did not touch\nhttpd-2.0.52/modules/generators/mod_suexec.*, and these modules were not rebuilt\nafter my changes.  Therefore I really think it is a \"support\" component.  This\nwould presumably ensure the right people are aware of the bug.  :-)\n\nI look forward to hearing about tests performed with this patch.  I have tried\ngroup names with alpha-only and mixed alpha-numeric, but not with all numeric\ncharacters.  My Linux distribution's adduser script does not like usernames with\nall numeric characterrs.  If someone can explain how to make (or even why one\nwould want to) a user name with only digits 0-9, then I can manually make the\nhome directory, and edit the users and group files, and updated my shadowed\npasswords.", "is_private": false}, {"count": 9, "attachment_id": null, "creator": "fielding@apache.org", "text": "Patch applied to trunk (r655711).  Thanks!", "id": 116541, "time": "2008-05-12T19:25:44Z", "bug_id": 7862, "creation_time": "2008-05-12T19:25:44Z", "tags": [], "is_private": false}]
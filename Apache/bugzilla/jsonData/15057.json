[{"count": 0, "tags": [], "creator": "lendl@nic.at", "text": "While working on an Apache 2.0 connection handler to implement EPP within Apache\n(see https://sourceforge.net/projects/aepps/) I noticed the following:\n\nIf I turn on StdEnvVars httpd will dump core in ssl_var_lookup_ssl as\nSSL_get_session returns a NULL pointer. After spending an afternoon with gdb,\netherreal and ssl-telnet I have no clue why connecting with ssl-telnet to \nan SSL/HTTP port gives me a non-NULL session variable whereas using the same\nclient to connect to my connection-handler returns a NULL value.\n\nI'm using openssl 0.9.6g.\n\nTo work around the issue until I eventually find the real cause, I applied\nthe folllowing patch to my 2.0.43 source-tree:\n\n--- ssl_engine_vars.c   2002/12/04 11:27:14     1.1\n+++ ssl_engine_vars.c   2002/12/04 11:27:34\n@@ -280,7 +280,8 @@\n     else if (ssl != NULL && strcEQ(var, \"SESSION_ID\")) {\n         char buf[SSL_SESSION_ID_STRING_LEN];\n         SSL_SESSION *pSession = SSL_get_session(ssl);\n-        result = apr_pstrdup(p, SSL_SESSION_id2sz(\n+       if (pSession)\n+               result = apr_pstrdup(p, SSL_SESSION_id2sz(\n                                 SSL_SESSION_get_session_id(pSession),\n                                 SSL_SESSION_get_session_id_length(pSession),\n                                 buf, sizeof(buf)));\n\n\nI'm not sure whether this is an issue with mod_ssl, my connection-handler or\nopenssl. As the patch is simple enough, I would recommend to apply it to\nthe offcial tree in any case.\n\ncheers,\n\n/ol", "id": 27401, "time": "2002-12-04T12:13:51Z", "bug_id": 15057, "creation_time": "2002-12-04T12:13:51Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "jorton@redhat.com", "text": "Ah, I just found a repro case for SSL_get_session returning NULL: when serving\nthe \"you sent a plain HTTP request over an SSL connection\" error message.\n\nThanks for the patch! It's committed to 2.1 and will be proposed for backport\nfor 2.0.", "id": 50398, "time": "2004-01-12T10:53:17Z", "bug_id": 15057, "creation_time": "2004-01-12T10:53:17Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "While I was looking at rotatelogs.c searching for the reason of the cryptic docs\nwarning about using \"-l\", I had the idea for slight improvements. I'll attach a\nsmall patch, that includes:\n\n- when using \"-l\" reduce two consecutive calls to apr_time_now() to one.\n  This will not change the logic if no \"-l\" gets used, and it will spare\n  one call to apr_time_now() in case \"-l\" gets used and more important\n  it gives the code better atomicity, because in fact between the two calls\n  there is a slight change of jumping oder the DST boundary\n\n- for historic reasons the same code block is used two times with a\n  slightly different way of transforming apr_time_t to int\n  (once division by APR_USEC_PER_SEC, once call to apr_time_sec()),\n  so let's unify it.\n\n- finally move the block into a function, because it gets used already\n  two times.\n\nNote that the patch eliminates a side effect, namely in case use_localtime is\ntrue the global variable utc_offset could change in main(). We now use\nutc_offset in main() only for the offset given by the command line flags, which\nis OK, because either use_localtime is true, or an offset can be given.\n\nThe attached patch works for trunk (r596796) and the 2.2 branch (r598272),\nbecause at the moment both versions of rotatelogs.c are identical (recently\nbackported).", "id": 111317, "time": "2007-12-01T02:26:53Z", "bug_id": 44004, "creation_time": "2007-12-01T02:26:53Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 44004, "attachment_id": 21212, "text": "Created attachment 21212\nPatch against trunk and 2.2 branch (identical)", "id": 111318, "time": "2007-12-01T02:28:06Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-12-01T02:28:06Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 44004, "is_private": false, "id": 111322, "time": "2007-12-01T08:15:55Z", "creator": "rpluem@apache.org", "creation_time": "2007-12-01T08:15:55Z", "tags": [], "text": "Committed to trunk as r600154\n(http://svn.apache.org/viewvc?rev=600154&view=rev). Thanks for the patch."}]
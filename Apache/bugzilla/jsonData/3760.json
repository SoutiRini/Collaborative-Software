[{"count": 0, "tags": [], "creator": "sebastian.kanthak@muehlheim.de", "is_private": false, "id": 5869, "attachment_id": null, "bug_id": 3760, "creation_time": "2001-09-21T03:59:12Z", "time": "2001-09-21T03:59:12Z", "text": "Symptom: When forwaring from one servlet to another, path info may get lost\nTomcat version: 3.2.3\n\nIt gets lost under these two circumstances:\n\n1. It is forwarded to /servlet/* (no mapping in server.xml) and this\nserlvet has not been accessed so far. On the second request, path info\nis transmitted correctly.\n\n2. It is forwarded to /someurl and in web.xml there is a mapping\nfor /someurl (not /someurl/*) to a servlet.\n\nIt works, however, if the request is forwarded to /someurl and there\nis a mapping for /someurl/* in web.xml.\n\nThat 2 does not work may be acceptable, although I think it should\nwork (does somebody know, what the spec says?), but 1 is not\nacceptable in my eyes.\n\nDiagonistics:\n\nThe reasons, why it does not work, are different:\n\n1. On the first request, the dynamic wrapping for\n/servlet/SecondServlet is not present. So in SimpleMapper1.contextMap\n\n\t    Container container =(Container)map.getLongestPrefixMatch(  host,\n\t\t\t\t\t\t\t\t\tpath );\nreturns a default container. This leads to erasure of path info in\nSimpleMapper1.fixRequestPaths:\n\tcase Container.DEFAULT_MAP:\n\t    s=path.substring( ctxPLen );\n\t    pathI= null ;\n\nIf this request was not created by forwarding, this would be solved by\nInvokerIntercetor.requestMap:\n\t// Now we need to fix path info and servlet path\n    // [cut irrelevant code]\n\tint secondSlash=servletPath.indexOf(\"/\", prefixLen );\n\tif ( secondSlash > -1) {\n\t    servletName = servletPath.substring(prefixLen, secondSlash );\n\t    newPathInfo = servletPath.substring( secondSlash );\n\t} else {\n\t    servletName = servletPath.substring( prefixLen );\n\t}\nbut this does obviously not work, as servletPath does not contain the\npath info, because it was a forward request.\n\n2. Path info is removed by SimpleMapper1.contextMap calling\nfixRequestPaths, because container is of type PATH_MAP.\n\nPossible Solution:\n\nIn RequestDispatcherImpl (which starts the forwarding process) add a\nspecial attribute \"isForwarded\" to\nrequest. SimpleMapper1.fixRequestPaths should check for this attribute\nbefore \"fixing\" path info, because this has already been done by its\ninvocation for the original servlet.\n\nIs there a chance, you will fix this (I can supply a diff) and\nrelease something like 3.2.3p1 or do I have to live with a patched\ntomcat?"}, {"count": 1, "tags": [], "bug_id": 3760, "attachment_id": null, "id": 5936, "time": "2001-09-23T11:11:31Z", "creator": "cmanolache@yahoo.com", "creation_time": "2001-09-23T11:11:31Z", "is_private": false, "text": "Same problem, we'll try to resolve for 3.3RC2\n\n*** This bug has been marked as a duplicate of 3727 ***"}]
[{"count": 0, "tags": [], "bug_id": 46971, "text": "Using Apache 2.2.11 as a forward proxy.  mod_proxy_ftp/http/connect each return a different error in the case where connection could not be established to the target host:\n\nconnect: HTTP_BAD_GATEWAY\nftp: HTTP_UNAVAILABLE\nhttp: HTTP_NOT_FOUND\najp: HTTP_UNAVAILABLE\n\nThe proxy should return a consistent error across protocols for the same problem.  HTTP_UNAVAILABLE seems most reasonable.  NOT_FOUND prevents distinguishing between the end server being (temporarily) unreachable and a (permanent) file not found.\n\nPatches to change mod_proxy_connect/http to return HTTP_UNAVAILABLE.\n\n*** orig/httpd-2.2.11/modules/proxy/mod_proxy_connect.c Sun Sep  2 17:42:59 2007\n--- httpd-2.2.11/modules/proxy/mod_proxy_connect.c      Sun Apr  5 14:23:44 2009\n***************\n*** 201,207 ****\n              return DECLINED;\n          }\n          else {\n!             return HTTP_BAD_GATEWAY;\n          }\n      }\n\n--- 201,207 ----\n              return DECLINED;\n          }\n          else {\n!             return HTTP_SERVICE_UNAVAILABLE;\n          }\n      }\n\n*** orig/httpd-2.2.11/modules/proxy/mod_proxy_http.c    Tue Nov 11 20:04:34 2008\n--- httpd-2.2.11/modules/proxy/mod_proxy_http.c Sun Apr  5 14:26:09 2009\n***************\n*** 1954,1963 ****\n\n      /* Step Two: Make the Connection */\n      if (ap_proxy_connect_backend(proxy_function, backend, worker, r->server)) {\n!         if (r->proxyreq == PROXYREQ_PROXY)\n!             status = HTTP_NOT_FOUND;\n!         else\n!             status = HTTP_SERVICE_UNAVAILABLE;\n          goto cleanup;\n      }\n\n--- 1954,1960 ----\n\n      /* Step Two: Make the Connection */\n      if (ap_proxy_connect_backend(proxy_function, backend, worker, r->server)) {\n!         status = HTTP_SERVICE_UNAVAILABLE;\n          goto cleanup;\n      }", "id": 126009, "time": "2009-04-05T07:35:01Z", "creator": "evanc@nortel.com", "creation_time": "2009-04-05T07:35:01Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "id": 129856, "time": "2009-08-22T19:01:34Z", "bug_id": 46971, "creation_time": "2009-08-22T19:01:34Z", "is_private": false, "text": "I agree with your diagnosis.  Fixed in trunk in r806920.  Thanks for the report."}, {"count": 2, "tags": [], "bug_id": 46971, "text": "backported to 2.2\nhttp://svn.apache.org/viewvc?view=revision&revision=882153", "id": 133160, "time": "2009-12-28T20:51:12Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2009-12-28T20:51:12Z", "is_private": false, "attachment_id": null}]
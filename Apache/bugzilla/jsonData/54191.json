[{"count": 0, "tags": [], "creator": "smithh032772@gmail.com", "attachment_id": null, "text": "Overview: \n\nAfter discussing this with user community, it is believed that TomEE is struggling with the following xhtml post/after AJAX submit (and during AJAX render/update):\n\np:calendar readonlyInput=\"#{pf_usersController.loggedInViaIpad == 'Y' ? 'true' : 'false'}\"\n\n1. readonlyInput=\"...\" is a property of PrimeFaces' p:calendar component.\n\n2. To meet a business requirement, I decided to populate this attribute via EL\n\n3. After AJAX submit (and render), p:calendar loses its p:calendar client-side attributes/behavior; an inputText is rendered only\n\n4. This EL works as designed (and without issues) on Glassfish 3.1.2.2 and MyFaces Core 2.1.9.\n\n\nSteps to Reproduce: \n\n1. Add EL (above) to the readonlyInput=\"...\" attribute of PrimeFaces p:calendar component\n2. Select a date via the p:calendar component after xhtml page is rendered in the browser; AJAX submit is triggered\n3. Repeat step # 2 above until p:calendar is rendered WITHOUT (jQuery datepicker) 'button' and calendar popup/dropdown\n\n\nActual Results:\n\nSporadically, p:calendar is rendered WITHOUT (jQuery datepicker) 'button' and calendar popup/dropdown\n\n\nExpected Results:\n\np:calendar ALWAYS rendered WITH (jQuery datepicker) 'button' and calendar popup/dropdown\n\n\nBuild Date & Platform: Date and platform of the build in which you first encountered the bug.\n\nINFO: Starting Servlet Engine: Apache Tomcat (TomEE)/7.0.32\napache-tomee-1.5.1-20121117.041542-74-plus.zip\n\n\nAdditional Builds and Platforms:\n\nPrimeFaces 3.5 SNAPSHOT, JUEL 2.2.5, OmniFaces 1.3 SNAPSHOT\n\n\nAdditional Information: \n\nScreen captures:\n\n1. BEFORE AJAX submit: http://imageshack.us/photo/my-images/163/20121121ajaxcalendariss.jpg/\n\n2. AFTER AJAX submit: http://imageshack.us/photo/my-images/600/20121121ajaxcalendariss.jpg/\n\n\nORIGINAL xhtml below:\n\n\n    <p:calendar id=\"filterTripDateFrom\"\n                value=\"#{pf_ordersController.filterTripDateFrom}\"\n                mode=\"popup\" showOn=\"button\" readonlyInput=\"#{pf_usersController.loggedInViaIpad == 'Y' ? 'true' : 'false'}\"\n                navigator=\"true\" effect=\"fadeIn\"\n                pattern=\"MM/dd/yyyy\" size=\"10\">\n        <p:ajax partialSubmit=\"false\"\n                event=\"dateSelect\" listener=\"#{pf_ordersController.filterTripDateFromSelected}\"\n                update=\":ordersBrowseForm:ordersDataTable :ordersBrowseForm:formMessages :ordersBrowseForm:_ajax_status\" />\n    </p:calendar>\n    <h:outputText value=\"To:\" />\n    <p:calendar id=\"filterTripDateTo\" value=\"#{pf_ordersController.filterTripDateTo}\"\n                mode=\"popup\" showOn=\"button\" readonlyInput=\"#{pf_usersController.loggedInViaIpad == 'Y' ? 'true' : 'false'}\"\n                navigator=\"true\" effect=\"fadeIn\" pattern=\"MM/dd/yyyy\" size=\"10\">\n        <p:ajax partialSubmit=\"false\"\n                event=\"dateSelect\" listener=\"#{pf_ordersController.filterTripDateToSelected}\"\n                update=\":ordersBrowseForm:ordersDataTable :ordersBrowseForm:formMessages :ordersBrowseForm:_ajax_status\" />\n    </p:calendar>\n\n\n\nWORKAROUND: use rendered=\"#{...}\" to render appropriate xhtml content (see xhtml below)\n\n<h:outputText value=\"From:\" />\n<p:calendar id=\"filterTripDateFrom\"\n\t    value=\"#{pf_ordersController.filterTripDateFrom}\"\n\t    mode=\"popup\" showOn=\"button\"\n\t    navigator=\"true\" effect=\"fadeIn\"\n\t    pattern=\"MM/dd/yyyy\" size=\"10\"\n\t    rendered=\"#{pf_usersController.loggedInViaIpad == 'N'}\">\n    <p:ajax partialSubmit=\"false\"\n\t    event=\"dateSelect\" listener=\"#{pf_ordersController.filterTripDateFromSelected}\"\n\t    update=\":ordersBrowseForm:ordersDataTable :ordersBrowseForm:formMessages :ordersBrowseForm:_ajax_status\" />\n</p:calendar>\n<p:calendar id=\"filterTripDateFromOnIpad\"\n\t    value=\"#{pf_ordersController.filterTripDateFrom}\"\n\t    mode=\"popup\" showOn=\"button\" readonlyInput=\"true\"\n\t    navigator=\"true\" effect=\"fadeIn\"\n\t    pattern=\"MM/dd/yyyy\" size=\"10\"\n\t    rendered=\"#{pf_usersController.loggedInViaIpad == 'Y'}\">\n    <p:ajax partialSubmit=\"false\"\n\t    event=\"dateSelect\" listener=\"#{pf_ordersController.filterTripDateFromSelected}\"\n\t    update=\":ordersBrowseForm:ordersDataTable :ordersBrowseForm:formMessages :ordersBrowseForm:_ajax_status\" />\n</p:calendar>\n<h:outputText value=\"To:\" />\n<p:calendar id=\"filterTripDateTo\" value=\"#{pf_ordersController.filterTripDateTo}\"\n\t    mode=\"popup\" showOn=\"button\"\n\t    navigator=\"true\" effect=\"fadeIn\" pattern=\"MM/dd/yyyy\" size=\"10\"\n\t    rendered=\"#{pf_usersController.loggedInViaIpad == 'N'}\">\n    <p:ajax partialSubmit=\"false\"\n\t    event=\"dateSelect\" listener=\"#{pf_ordersController.filterTripDateToSelected}\"\n\t    update=\":ordersBrowseForm:ordersDataTable :ordersBrowseForm:formMessages :ordersBrowseForm:_ajax_status\" />\n</p:calendar>\n<p:calendar id=\"filterTripDateToOnIpad\" value=\"#{pf_ordersController.filterTripDateTo}\"\n\t    mode=\"popup\" showOn=\"button\" readonlyInput=\"true\"\n\t    navigator=\"true\" effect=\"fadeIn\" pattern=\"MM/dd/yyyy\" size=\"10\"\n\t    rendered=\"#{pf_usersController.loggedInViaIpad == 'Y'}\">", "id": 163609, "time": "2012-11-22T20:38:53Z", "bug_id": 54191, "creation_time": "2012-11-22T20:38:53Z", "is_private": false}, {"count": 1, "tags": [], "creator": "smithh032772@gmail.com", "attachment_id": 29623, "id": 163610, "time": "2012-11-22T21:01:31Z", "bug_id": 54191, "creation_time": "2012-11-22T21:01:31Z", "is_private": false, "text": "Created attachment 29623\np:calendar WITH button BEFORE AJAX submit"}, {"count": 2, "tags": [], "bug_id": 54191, "attachment_id": 29624, "text": "Created attachment 29624\np:calendar WITHOUT button AFTER AJAX submit", "id": 163611, "time": "2012-11-22T21:02:03Z", "creator": "smithh032772@gmail.com", "creation_time": "2012-11-22T21:02:03Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 54191, "attachment_id": null, "text": "Below, is xhtml that has EL in the readonlyInput property, but I am not able to duplicate this issue on the EL. I thought I may share this, so this xhtml can be compared to the xhtml in the OP.\n\n<p:dataTable id=\"dt_tripsToConfirm\" var=\"order\"\n\t     value=\"#{pf_ordersController.tripsToConfirm}\">\n\n    <p:column headerText=\"Trip Date\">\n\t<h:outputText escape=\"false\"\n\t\t      value=\"#{pf_ordersController.getTripDateDisplay(order.tripDateTime, order.returnDateTime, true, true, true)}\"/>\n    </p:column>\n\n    <p:column headerText=\"Customer\">\n\t<h:outputText value=\"#{order.customerId.customerName}\" /><br/>\n\t<h:outputText escape=\"false\"\n\t\t      value=\"#{pf_ordersController.getOrderCustomerPointOfContactListDisplay(order)}\" />\n    </p:column>\n\n    <p:column headerText=\"Confirmed?\" style=\"text-align: center !important;\">\n\t<h:selectOneMenu value=\"#{order.confirmed}\" label=\"Confirmed\">\n\t    <f:selectItem itemValue=\"#{bundle.DropdownOptionValueYes}\" itemLabel=\"#{bundle.DropdownOptionLabelYes}\"/>\n\t    <f:selectItem itemValue=\"#{bundle.DropdownOptionValueNo}\" itemLabel=\"#{bundle.DropdownOptionLabelNo}\"/>\n\t    <p:ajax partialSubmit=\"false\"\n\t\t    listener=\"#{pf_ordersController.confirmedChangedOnConfirmTrips(order)}\"\n\t\t    update=\":pageContentPanel\"/>\n\t</h:selectOneMenu>\n    </p:column>\n\n    <p:column headerText=\"Confirmed Date\" style=\"text-align: center !important;\">\n\t<p:calendar value=\"#{order.confirmedDate}\"\n\t\t    rendered=\"#{order.confirmed == 'Y'}\"\n\t\t    label=\"Confirmed Date\"\n\t\t    mode=\"popup\" showOn=\"button\" readonlyInput=\"#{pf_usersController.loggedInViaIpad == 'Y' ? 'true' : 'false'}\"\n\t\t    navigator=\"true\" effect=\"fadeIn\"\n\t\t    pattern=\"MM/dd/yyyy\" size=\"8\">\n\t    <f:convertDateTime pattern=\"MM/dd/yyyy\" />\n\t</p:calendar>\n    </p:column>\n\n</p:dataTable>", "id": 163614, "time": "2012-11-23T05:37:41Z", "creator": "smithh032772@gmail.com", "creation_time": "2012-11-23T05:37:41Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 54191, "attachment_id": null, "text": "There are way too many moving parts here. The problem needs to be isolated to a reproducible test case that fails on the latest Tomcat 7.0.x release (not TomEE). Without such a test case (which should be the simplest possible web application that exhibits the issue) this will get resolved as WORKSFORME.", "id": 163616, "time": "2012-11-23T09:11:13Z", "creator": "markt@apache.org", "creation_time": "2012-11-23T09:11:13Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 54191, "attachment_id": null, "text": "It has been over a week with no response to my request for further information. I'll leave this open a little longer but without the requested information this is going to get resolved as WORKSFORME.", "id": 163774, "time": "2012-12-03T09:49:47Z", "creator": "markt@apache.org", "creation_time": "2012-12-03T09:49:47Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 54191, "attachment_id": null, "text": "It looks as if your pf_usersController.loggedInViaIpad returns 'Y' occasionally.\n\nHow that property is evaluated? Do you parse the user-agent header of each request?\n\nMaybe your ajax calls are loosing the session, or the session expires.\n(-> ask on the users list).\n\n\nAs Mark already wrote, you have to provide a simple web application that reproduces the issue.\n(It does not need to be a plain JSP application. Using myfaces in it is OK. If you use any custom code in it, the source code for it will be needed).", "id": 163860, "time": "2012-12-04T21:52:06Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-12-04T21:52:06Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 54191, "attachment_id": null, "text": "Thanks for reviewing the issue and the responses. Honestly, right now, I am too busy to build a simple project that duplicates the issue. I really just wanted to report the issue.\n\nI am quite sure that I'm not losing the session, but I could or would need to confirm or test for that. Yes, I am using some reusable code (that was posted in a forum) that parses the user agent on every request. Coincidentally, I did modify this code when migrating from JSF managed beans to CDI managed beans (running on TomEE 1.5.1 SNAPSHOT). I am willing to attach LoginFilter.java and the code that parses the user agent.\n\nI resolved the issue already with a workaround, and I am fine with the issue being marked with the WORKSFORME status.\n\nThanks,\nHoward", "id": 163862, "time": "2012-12-04T22:36:23Z", "creator": "smithh032772@gmail.com", "creation_time": "2012-12-04T22:36:23Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 54191, "attachment_id": 29691, "id": 163863, "time": "2012-12-04T22:38:44Z", "creator": "smithh032772@gmail.com", "creation_time": "2012-12-04T22:38:44Z", "is_private": false, "text": "Created attachment 29691\nLoginFilter.java parses user agent and populates user bean, etc...\n\nAttached LoginFilter.java"}, {"count": 9, "tags": [], "bug_id": 54191, "attachment_id": 29692, "id": 163864, "time": "2012-12-04T22:39:56Z", "creator": "smithh032772@gmail.com", "creation_time": "2012-12-04T22:39:56Z", "is_private": false, "text": "Created attachment 29692\nParses user agent\n\nAttached UserAgentInfo.java"}, {"count": 10, "tags": [], "bug_id": 54191, "attachment_id": null, "id": 163866, "time": "2012-12-04T22:54:07Z", "creator": "smithh032772@gmail.com", "creation_time": "2012-12-04T22:54:07Z", "is_private": false, "text": "Even though I developed a workaround for this issue, I tried to half-way revert my code back to the code that initially could duplicate this issue. I only added the EL to the readonlyInput=\"...\" property of p:calendar. See below.\n\n    <p:calendar id=\"filterTripDateFrom\"\n                value=\"#{pf_ordersController.filterTripDateFrom}\"\n                mode=\"popup\" showOn=\"button\"\n                readonlyInput=\"#{pf_usersController.loggedInViaIpad == 'Y' ? 'true' : 'false'}\"\n                navigator=\"true\" effect=\"fadeIn\"\n                pattern=\"MM/dd/yyyy\" size=\"10\"\n                rendered=\"#{pf_usersController.loggedInViaIpad == 'N'}\">\n        <p:ajax partialSubmit=\"false\"\n                event=\"dateSelect\" listener=\"#{pf_ordersController.filterTripDateFromSelected}\"\n                update=\":ordersBrowseForm:ordersDataTable :ordersBrowseForm:formMessages :ordersBrowseForm:_ajax_status\" />\n    </p:calendar>\n    <p:calendar id=\"filterTripDateFromOnIpad\"\n                value=\"#{pf_ordersController.filterTripDateFrom}\"\n                mode=\"popup\" showOn=\"button\" readonlyInput=\"true\"\n                navigator=\"true\" effect=\"fadeIn\"\n                pattern=\"MM/dd/yyyy\" size=\"10\"\n                rendered=\"#{pf_usersController.loggedInViaIpad == 'Y'}\">\n        <p:ajax partialSubmit=\"false\"\n                event=\"dateSelect\" listener=\"#{pf_ordersController.filterTripDateFromSelected}\"\n                update=\":ordersBrowseForm:ordersDataTable :ordersBrowseForm:formMessages :ordersBrowseForm:_ajax_status\" />\n    </p:calendar>\n\nI attempted to duplicate this issue, but I was 'not' able to duplicate this issue with yesterday's version of TomEE 1.5.1 SNAPSHOT, apache-tomee-1.5.1-20121203.041800-97-plus.zip.\n\nI set debug = true in LoginFilter, and the following was in server log:\n\n\nDec 04, 2012 5:45:47 PM org.apache.catalina.startup.Catalina start\nINFO: Server startup in 26926 ms\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/login.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): agent.getUserAgent() = mozilla/5.0 (windows nt 6.0; wow64) applewebkit/537.11 (khtml, like gecko) chrome/23.0.1271.95 safari/537.11\nDec 04, 2012 5:45:55 PM org.apache.myfaces.el.unified.ResolverBuilderBase sortELResolvers\nINFO: Chain of EL resolvers for Faces sorted with: org.apache.myfaces.el.unified.OpenWebBeansELResolverComparator@3707cedb and the result order is [org.apache.myfaces.el.unified.resolver.implicitobject.ImplicitObjectResolver@619da816, org.apache.myfaces.el.unified.resolver.CompositeComponentELResolver@35866e6b, org.apache.myfaces.el.FlashELResolver@cbb4e41, org.apache.myfaces.el.unified.resolver.ManagedBeanResolver@5d0e93ee, org.apache.myfaces.el.unified.resolver.ResourceResolver@68121dfc, javax.el.ResourceBundleELResolver@7d6ec0c4, org.apache.myfaces.el.unified.resolver.ResourceBundleResolver@7231c431, javax.el.MapELResolver@2147a789, javax.el.ListELResolver@67482470, javax.el.ArrayELResolver@31506a09, javax.el.BeanELResolver@16618e2a, org.apache.webbeans.el.WebBeansELResolver@5ebc72e0]\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/login.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\n[EL Info]: 2012-12-04 17:45:57.189--ServerSession(534087359)--EclipseLink, version: Eclipse Persistence Services - 2.3.2.v20111125-r10461\n[EL Info]: 2012-12-04 17:45:57.776--ServerSession(534087359)--file:/C:/apache-tomee-plus-1.5.1-SNAPSHOT/webapps/mcmsweb/WEB-INF/classes/_mcmsPU login successful\nGoogleCalendarUtil: calendarList.getEntries().size() = 2\nGoogleCalendarUtil: calendar ID/summary = oletaweb@gmail.com/mcmsweb\nGoogleCalendarUtil: calendar ID/summary = 998449989713@developer.gserviceaccount.com/998449989713@developer.gserviceaccount.com\nGoogleCalendarUtil: events.getItems().size() = 250\npf_UsersController.loginUser(): administrator logged in at Tue Dec 04 17:45:58 EST 2012\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = true; ajaxHeader = XMLHttpRequest\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = true; ajaxHeader = XMLHttpRequest\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = true; ajaxHeader = XMLHttpRequest\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = true; ajaxHeader = XMLHttpRequest\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = true; ajaxHeader = XMLHttpRequest\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = true; ajaxHeader = XMLHttpRequest\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = true; ajaxHeader = XMLHttpRequest\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = true; ajaxHeader = XMLHttpRequest"}, {"count": 11, "tags": [], "text": "As I mentioned earlier, please mark this issue as WORKSFORME.\n\nThanks,\nHoward", "attachment_id": null, "bug_id": 54191, "id": 163867, "time": "2012-12-04T22:54:41Z", "creator": "smithh032772@gmail.com", "creation_time": "2012-12-04T22:54:41Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 54191, "attachment_id": null, "text": "Your UserAgentInfo class does not support multithreading.\n\nThe problem is that you store a reference to this class in a field of your LoginFilter class.\n\nNote that the Filter is created only once and the single instance of the filter processes all incoming requests. So the same UserAgentInfo instance is reused by multiple requests in parallel and thus contains wrong data.", "id": 163868, "time": "2012-12-04T22:55:28Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-12-04T22:55:28Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 54191, "attachment_id": null, "text": "Per my experience and per test results, my LoginFilter supports multithreading and any/all requests. Per design (and working as expected), userAgentInfo is only referenced when user is not logged in. Once user is logged in and user agent info is stored in user bean, then there is no longer a need for user agent. This is all working as designed.\n\nI just ran another test to confirm what I stated above.\n\nBelow, you will see that I 1st logged in via my laptop (Google chrome browser), and then afterwards, I logged in via my galaxy nexus (google chrome browser as well), and the last request was from my laptop to look at my users page, which shows how many sessions each user have open (a homegrown session monitor).\n\nDec 04, 2012 6:01:41 PM org.apache.catalina.startup.Catalina start\nINFO: Server startup in 19674 ms\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/javax.faces.resource/images/ui-bg_flat_0_2d5972_40x100.png.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): agent.getUserAgent() = mozilla/5.0 (windows nt 6.0; wow64) applewebkit/537.11 (khtml, like gecko) chrome/23.0.1271.95 safari/537.11\nLoginFilter.doFilter(): agent.getUserAgent() = mozilla/5.0 (windows nt 6.0; wow64) applewebkit/537.11 (khtml, like gecko) chrome/23.0.1271.95 safari/537.11\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/login.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): agent.getUserAgent() = mozilla/5.0 (windows nt 6.0; wow64) applewebkit/537.11 (khtml, like gecko) chrome/23.0.1271.95 safari/537.11\nDec 04, 2012 6:02:11 PM org.apache.myfaces.el.unified.ResolverBuilderBase sortELResolvers\nINFO: Chain of EL resolvers for Faces sorted with: org.apache.myfaces.el.unified.OpenWebBeansELResolverComparator@7850c424 and the result order is [org.apache.myfaces.el.unified.resolver.implicitobject.ImplicitObjectResolver@7e7d5531, org.apache.myfaces.el.unified.resolver.CompositeComponentELResolver@566444d7, org.apache.myfaces.el.FlashELResolver@50e3ab90, org.apache.myfaces.el.unified.resolver.ManagedBeanResolver@1314a46d, org.apache.myfaces.el.unified.resolver.ResourceResolver@3036f9e4, javax.el.ResourceBundleELResolver@69500076, org.apache.myfaces.el.unified.resolver.ResourceBundleResolver@34e78fe, javax.el.MapELResolver@14e96d64, javax.el.ListELResolver@690ccaf5, javax.el.ArrayELResolver@46e0d0b4, javax.el.BeanELResolver@51a5fdc6, org.apache.webbeans.el.WebBeansELResolver@68b7fc0a]\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/login.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\n[EL Info]: 2012-12-04 18:02:28.03--ServerSession(1717835602)--EclipseLink, version: Eclipse Persistence Services - 2.3.2.v20111125-r10461\n[EL Info]: 2012-12-04 18:02:28.593--ServerSession(1717835602)--file:/C:/apache-tomee-plus-1.5.1-SNAPSHOT/webapps/mcmsweb/WEB-INF/classes/_mcmsPU login successful\nGoogleCalendarUtil: calendarList.getEntries().size() = 2\nGoogleCalendarUtil: calendar ID/summary = oletaweb@gmail.com/mcmsweb\nGoogleCalendarUtil: calendar ID/summary = 998449989713@developer.gserviceaccount.com/998449989713@developer.gserviceaccount.com\nGoogleCalendarUtil: events.getItems().size() = 250\npf_UsersController.loginUser(): administrator logged in at Tue Dec 04 18:02:29 EST 2012\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/login.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): isAndroid = true\nLoginFilter.doFilter(): agent.getUserAgent() = mozilla/5.0 (linux; android 4.1.1; galaxy nexus build/jro03u) applewebkit/535.19 (khtml, like gecko) chrome/18.0.1025.166 mobile safari/535.19\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/loginViaMobile.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): isAndroid = true\nLoginFilter.doFilter(): agent.getUserAgent() = mozilla/5.0 (linux; android 4.1.1; galaxy nexus build/jro03u) applewebkit/535.19 (khtml, like gecko) chrome/18.0.1025.166 mobile safari/535.19\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/loginViaMobile.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\npf_UsersController.loginUser(): administrator logged in at Tue Dec 04 18:03:20 EST 2012\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/javax.faces.resource/images/ui-bg_flat_0_2d5972_40x100.png.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null\nLoginFilter.doFilter(): session = NOT null\nLoginFilter.doFilter(): pf_usersController = NOT null\nLoginFilter.doFilter(): req.getRequestURI() = /mcmsweb/index.jsf\nLoginFilter.doFilter(): ajaxRequest = false; ajaxHeader = null", "id": 163870, "time": "2012-12-04T23:06:51Z", "creator": "smithh032772@gmail.com", "creation_time": "2012-12-04T23:06:51Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 54191, "text": "(In reply to comment #12)\n> Your UserAgentInfo class does not support multithreading.\n> \n> The problem is that you store a reference to this class in a field of your\n> LoginFilter class.\n> \n\ns/UserAgentInfo/pf_UsersController/ above. It is pf_UsersController instance that is stored in LoginFilter.userBEan field and is shared across requests.", "id": 163871, "time": "2012-12-04T23:20:22Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-12-04T23:20:22Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "text": "> It is pf_UsersController instance that is stored in LoginFilter.userBEan field and is shared across requests.\n\nYou are correct. pf_UsersController is CDI @SessionScoped bean that is available and referenced by LoginFilter during each request.\n\n> It looks as if your pf_usersController.loggedInViaIpad returns 'Y' occasionally.\n\nloggedInViaIpad will only be true when iPad device/user is logged in. This is why I was 'not' able to duplicate this issue...today. I didn't login via iPad. I logged in via laptop and Android device/phone. :)\n\n> How that property is evaluated? Do you parse the user-agent header of each request?\n\nWe've already discussed this. :)\n\n> Maybe your ajax calls are loosing the session, or the session expires.\n(-> ask on the users list).\n\nI did not see this behavior at all. My opinion is that the earlier version of TomEE 1.5.1 SNAPSHOT (tomcat 7.0.32 at the time, I think) had some issue with the EL, but I might be wrong. I just wanted to log the defect, just in case, it really was an issue.\n\nMy workaround resolves this issue for me, and anyone else that does an internet search might possibly discover this issue and my workaround. Hope it helps someone.\n\nThanks again.", "attachment_id": null, "bug_id": 54191, "id": 163872, "time": "2012-12-04T23:31:22Z", "creator": "smithh032772@gmail.com", "creation_time": "2012-12-04T23:31:22Z", "is_private": false}, {"count": 16, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "id": 163961, "time": "2012-12-07T22:15:39Z", "bug_id": 54191, "creation_time": "2012-12-07T22:15:39Z", "is_private": false, "text": "Sorry, your filter simply is not threadsafe, even if you have a CDI @SessionScoped annotation (in fact, that's exactly what makes it unsafe). Your code will fail at some point in other environments even if you don't seem to have time to debug it, now.\n\nThere is almost certainly no Tomcat/TomEE/EL bug here."}]
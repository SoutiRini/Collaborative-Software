[{"count": 0, "attachment_id": null, "creator": "jahuong@yahoo.com", "is_private": false, "id": 40498, "time": "2003-07-11T18:32:53Z", "bug_id": 21523, "creation_time": "2003-07-11T18:32:53Z", "tags": [], "text": "Based on\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=9222\n\nmod_deflate shouldn't do anything when let's say my\nPHP script outputs with the header;\n\nContent-Encoding: deflate\n\nUnfortunately, I've noticed that it still does it\noccasionally.\n\nHere's part of the transmission that I've managed to\nlog.\nBegin client request:\nPOST http://cimserv.1stsi.com/fans/dsasoapserver.php\nAccept: text/xml\nAccept: multipart/*\nAccept-Encoding: deflate\nUser-Agent: SOAP::Lite/Perl/0.55\nContent-Encoding: deflate\nContent-Length: 327\nContent-Type: text/xml; charset=utf-8\nSOAPAction: \"http://cimserv#check\"\n\n<snip out contents of requests>\n\nBegin server response:\nHTTP/1.1 200 OK\nConnection: Close\nDate: Fri, 11 Jul 2003 16:29:13 GMT\nServer: NuSOAP Server v0.6.4\nVary: Accept-Encoding\nContent-Encoding: deflate, gzip\nContent-Length: 267\nContent-Type: text/xml; charset=UTF-8\nClient-Date: Fri, 11 Jul 2003 16:31:04 GMT\nClient-Peer: 172.16.104.14:80\nStatus: 200 OK\nX-Powered-By: PHP/4.3.2\n\n<snip out the contents of response>\n\n\nOne thing is for sure, I definitely didn't add \",\ngzip\" to the server's response. Strange thing\nthough... it happens on and off."}, {"count": 1, "tags": [], "text": "First: please try 2.0.47, which contains some further fixes.\nSecond: I can't believe, that mod_deflate compresses gzip if Accept-Encoding:\ncontains no gzip. I'd guess the compression takes place somewhere else.", "is_private": false, "bug_id": 21523, "id": 40499, "time": "2003-07-11T18:44:18Z", "creator": "nd@perlig.de", "creation_time": "2003-07-11T18:44:18Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 21523, "attachment_id": null, "text": "Hi, sorry for the cross post. Anyway I'm sure it is a mod_deflate problem as \neverything works fine for the last 5 hours after I try the work around as \ndescribe in bug 9222. My problem would normally appear every now and then \nwithin an hour or two. I will try Apache 2.0.47 later on and see if I get the \nsame problem.", "id": 40531, "time": "2003-07-12T03:01:31Z", "creator": "jahuong@yahoo.com", "creation_time": "2003-07-12T03:01:31Z", "is_private": false}, {"count": 3, "tags": [], "text": "Ok I've upgraded to 2.0.47 this morning. I've done the tests with 5 SOAP::Lite \nclients sending 500 various types of requests(both valid and errorneous) each \nand without any special setenvif settings, and none of the server responses are \ngzipped. Looks great. Just curious, how come the 2.0.47 release didn't mention \nanything about fixing mod_deflate.. or was this problem attributed to other \nApache components? Thanks.", "attachment_id": null, "bug_id": 21523, "id": 40542, "time": "2003-07-12T10:50:41Z", "creator": "jahuong@yahoo.com", "creation_time": "2003-07-12T10:50:41Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 21523, "is_private": false, "text": "Oops... In fact,the changes were made in 2.0.46. Strange. This points to other\nsources of error as well, IMHO.\nI'll close the report for now. Don't hesitate to reopen it, if there are further\nissues.\n\nThanks for using Apache!", "id": 40544, "time": "2003-07-12T12:00:18Z", "creator": "nd@perlig.de", "creation_time": "2003-07-12T12:00:18Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "jahuong@yahoo.com", "attachment_id": 7491, "id": 41331, "time": "2003-07-24T15:33:27Z", "bug_id": 21523, "creation_time": "2003-07-24T15:33:27Z", "is_private": false, "text": "Created attachment 7491\nLoop test log file"}, {"count": 6, "tags": [], "creator": "jahuong@yahoo.com", "attachment_id": null, "id": 41333, "time": "2003-07-24T15:34:25Z", "bug_id": 21523, "creation_time": "2003-07-24T15:34:25Z", "is_private": false, "text": "Looks like I spoke too soon.\nI'm attaching the complete log file of my most recent loop test.\n"}, {"count": 7, "attachment_id": null, "creator": "nd@perlig.de", "is_private": false, "id": 41362, "time": "2003-07-24T16:01:46Z", "bug_id": 21523, "creation_time": "2003-07-24T16:01:46Z", "tags": [], "text": "Hmm. The point is, mod_deflate only gets active, if the filter (DEFLATE) is\nadded *and* Accept-Encoding contains the gzip token.\nDid you add the filter somehow? What's the particular configuration?"}, {"count": 8, "tags": [], "text": "Here are my settings for the filters.\n\n<Directory />\n    Options FollowSymLinks\n    AllowOverride None\nOrder Deny,Allow \nDeny from all \nAddOutputFilterByType DEFLATE text/html text/plain text/xml\nAddOutputFilterByType DEFLATE application/ms* application/vnd* \napplication/postscript\n</Directory>\n\n#\nDeflateFilterNote Input instream\nDeflateFilterNote Output outstream\nDeflateFilterNote Ratio ratio\n\n\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" In:%\n{instream}n Out:%{outstream}n:%{ratio}npct\" comdef\n", "attachment_id": null, "bug_id": 21523, "id": 41463, "time": "2003-07-24T22:56:45Z", "creator": "jahuong@yahoo.com", "creation_time": "2003-07-24T22:56:45Z", "is_private": false}, {"count": 9, "attachment_id": null, "creator": "jahuong@yahoo.com", "is_private": false, "id": 41464, "time": "2003-07-24T22:58:38Z", "bug_id": 21523, "creation_time": "2003-07-24T22:58:38Z", "tags": [], "text": "Oh by the way.. the workaround in bug 9222 doesn't work either... the problem \nstill happens intermittently."}, {"count": 10, "tags": [], "bug_id": 21523, "is_private": false, "text": "Well, and it does actually log instream/outstream/ratio for these requests?", "id": 41466, "time": "2003-07-24T23:09:47Z", "creator": "nd@perlig.de", "creation_time": "2003-07-24T23:09:47Z", "attachment_id": null}, {"count": 11, "tags": [], "creator": "jahuong@yahoo.com", "attachment_id": null, "is_private": false, "id": 41471, "time": "2003-07-25T00:53:57Z", "bug_id": 21523, "creation_time": "2003-07-25T00:53:57Z", "text": "I'll attach the access logs once I return from work."}, {"count": 12, "tags": [], "bug_id": 21523, "is_private": false, "text": "Here is the line in the access log that matches the last entry in the attached \nlog file.\n\n127.0.0.1 - - [23/Jul/2003:08:07:50 +0800] \"POST /testsoap.php HTTP/1.1\" 200 \n268 \"-\" \"SOAP::Lite/Perl/0.55\" In:245 Out:250:102pct", "id": 41496, "time": "2003-07-25T10:31:07Z", "creator": "jahuong@yahoo.com", "creation_time": "2003-07-25T10:31:07Z", "attachment_id": null}, {"count": 13, "attachment_id": null, "creator": "jorton@redhat.com", "is_private": false, "id": 41502, "time": "2003-07-25T12:36:51Z", "bug_id": 21523, "creation_time": "2003-07-25T12:36:51Z", "tags": [], "text": "Just to separate the two separate issues here:\n\n1) if you think that mod_deflate is gzip-encoding a response where the request\ndid not have \"gzip\" in an Accept-Encoding header, can you attach a network trace\nagainst 2.0.47, or a log which includes the input and output headers (e.g a\nCustomLog with \"%{accept-encoding}i {content-encoding}o\"\n\n2) mod_deflate will indeed gzip-encode a response which already has\nContent-Encoding: deflate (given Accept-Encoding: gzip in the request, etc);\nthis is a different issue."}, {"count": 14, "tags": [], "creator": "jahuong@yahoo.com", "attachment_id": null, "is_private": false, "id": 41525, "time": "2003-07-25T15:39:47Z", "bug_id": 21523, "creation_time": "2003-07-25T15:39:47Z", "text": "Ok I just tried what was recommended.. and I hit it again. Here is the output \nof the log.\n\n127.0.0.1 - - [25/Jul/2003:23:35:52 +0800] \"POST /testsoap.php HTTP/1.1\" 200 \n268 \"-\" \"SOAP::Lite/Perl/0.55\" In:245 Out:250:102pct \"deflate\" \"deflate, gzip\"\n\nHere's the logformat from my httpd.conf\n\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" In:%\n{instream}n Out:%{outstream}n:%{ratio}npct \\\"%{Accept-Encoding}i\\\" \\\"%{Content-\nEncoding}o\\\"\" comdef"}, {"count": 15, "tags": [], "creator": "jorton@redhat.com", "attachment_id": 7518, "id": 41527, "time": "2003-07-25T16:43:59Z", "bug_id": 21523, "creation_time": "2003-07-25T16:43:59Z", "is_private": false, "text": "Created attachment 7518\naccept-encoding parsing fix"}, {"count": 16, "tags": [], "text": "I may be on a wild goose chase, but can you try that patch?", "attachment_id": null, "id": 41528, "creation_time": "2003-07-25T16:44:27Z", "time": "2003-07-25T16:44:27Z", "creator": "jorton@redhat.com", "bug_id": 21523, "is_private": false}, {"count": 17, "tags": [], "bug_id": 21523, "attachment_id": null, "text": "Sorry, unfortunately I don't have any compilers with me right now on my Windows \nsystem and at home. Is there something like a nightly build I could run my \ntests against?", "id": 41529, "time": "2003-07-25T16:53:59Z", "creator": "jahuong@yahoo.com", "creation_time": "2003-07-25T16:53:59Z", "is_private": false}, {"count": 18, "tags": [], "text": "Any chances of this being fixed in 2.0.48?", "is_private": false, "id": 42962, "creation_time": "2003-08-19T02:30:28Z", "time": "2003-08-19T02:30:28Z", "creator": "jahuong@yahoo.com", "bug_id": 21523, "attachment_id": null}, {"count": 19, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "id": 42986, "time": "2003-08-19T12:34:06Z", "bug_id": 21523, "creation_time": "2003-08-19T12:34:06Z", "is_private": false, "text": "Ha, Joe, you've found the problem! We skip the \\0 delimiter and search somewhere\nin the memory... Therefore it occurs *sometimes*.\nI've finally committed a fix to 2.1 and proposed it for backport.\n\nThanks!"}, {"count": 20, "tags": [], "text": "already fixed in 2.0.48 :)", "is_private": false, "bug_id": 21523, "id": 47890, "time": "2003-11-21T22:25:48Z", "creator": "trawick@apache.org", "creation_time": "2003-11-21T22:25:48Z", "attachment_id": null}]
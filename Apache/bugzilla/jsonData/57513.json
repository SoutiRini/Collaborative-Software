[{"count": 0, "tags": [], "creator": "KoscheY@gmail.com", "attachment_id": null, "text": "Was trying to extract about 50k rows from a database to .xlsx where one column is formatted as Date and noticed that after 32767 rows Date format disappears. \nIt does not matter if you start with rownum 0 or rownum 500, after 32767 rows formatting disappears. \n\n-------------------\nCode:\npackage orat_reports;\n\nimport java.sql.DriverManager;\nimport java.sql.Connection;\nimport java.sql.SQLException;\nimport java.sql.ResultSet;\nimport java.sql.PreparedStatement;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.FileNotFoundException;\n\nimport org.apache.poi.ss.usermodel.Cell;\nimport org.apache.poi.ss.usermodel.CellStyle;\nimport org.apache.poi.ss.usermodel.Row;\nimport org.apache.poi.ss.usermodel.Sheet;\nimport org.apache.poi.xssf.streaming.SXSSFWorkbook;\nimport org.apache.poi.xssf.usermodel.XSSFDataFormat;\n\npublic class SQL_SH_to_XLSX {\n\n\tpublic static void main(String[] args) {\n\t\t// TODO Auto-generated method stub\n\t\t\n\t\tString url = \"jdbc:oracle:thin:@//localhost:1521/orcl\";\n\t\tString username = \"User\";\n\t\tString password = \"Password\";\n\t\t\n\t\tString sqlQuerry = \"Select * from customers\";\n\t\t\n\t\t// Create new workbook\n\t\tSXSSFWorkbook wb = new SXSSFWorkbook();\n\t\tSheet sh = wb.createSheet();\n\t\twb.setSheetName(0, \"SQL Test\");\n\t\tint rownum = 0;\n\t\t\n\t\ttry{\n\t\t\tConnection con = DriverManager.getConnection(url, username, password);\n\t\t\tPreparedStatement st = con.prepareStatement(sqlQuerry);\n\t\t\tResultSet rs = st.executeQuery();\n\t\t\t\n\t\t\twhile(rs.next()) {\n\n\t\t\t\tRow row = sh.createRow(rownum);\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\tCell c = row.createCell(0);\n\t\t\t\t\tc.setCellValue(rs.getDouble(1));\n\t\t\t\t\t\n\t\t\t\t\tc = row.createCell(1);\n\t\t\t\t\tc.setCellValue(rs.getString(2));\n\t\t\t\t\t\n\t\t\t\t\tc = row.createCell(2);\n\t\t\t\t\tc.setCellValue(rs.getDate(21));\n\t\t\t\t\t// Date format for cell\n\t\t\t\t\tXSSFDataFormat df = (XSSFDataFormat)wb.createDataFormat();\n\t\t\t\t\tCellStyle cs = wb.createCellStyle();\n\t\t\t\t\tcs.setDataFormat(df.getFormat(\"dd-mm-yyyy\"));\n\t\t\t\t\tc.setCellStyle(cs);\n\t\t\t\t\t\n\t\t\t\trownum++;\n\t\t\t}\t\t\t\n\t\t\t\n\t\t} catch (SQLException e) {\n\t\t\tSystem.out.println(e.getErrorCode());\n\t\t} \n\t\t\n\t\t//Write file\n\t\ttry {\n\t\t\tFileOutputStream out = new FileOutputStream(\"SQL Test.xlsx\");\n\t\t\ttry {\n\t\t\t\twb.write(out);\n\t\t\t\tout.close();\n\t\t\t\twb.close();\n\t\t\t} catch (IOException ioe) {\n\t\t\t\tSystem.out.println(ioe.getMessage());\n\t\t\t}\n\n\t\t} catch (FileNotFoundException fnfe) {\n\t\t\tSystem.out.println(fnfe.getMessage());\n\t\t}\n\t\t\n\t\tSystem.out.println(\"Happy Days\");\n\t}\n\n}", "id": 180650, "time": "2015-01-29T21:27:17Z", "bug_id": 57513, "creation_time": "2015-01-29T21:27:17Z", "is_private": false}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "text": "Cell Styles are workbook scoped, not cell scoped, so you're running out of available styles. You need to move the cell style creation out of your loop", "id": 180652, "time": "2015-01-30T06:57:42Z", "bug_id": 57513, "creation_time": "2015-01-30T06:57:42Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 56029, "text": "The following JSPX file worked upto Tomcat 7.0.47:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<jsp:root xmlns:jsp=\"http://java.sun.com/JSP/Page\" version=\"2.1\"\n\txmlns:c=\"http://java.sun.com/jsp/jstl/core\" \n\txmlns:fmt=\"http://java.sun.com/jsp/jstl/fmt\"\t\n>\n\t<jsp:directive.page contentType=\"text/html; charset=utf-8\"  pageEncoding=\"UTF-8\" />\n\t<jsp:directive.page session=\"false\" />\n\t<jsp:output omit-xml-declaration=\"true\" />\n\t<div>\t\n\t\t<span id=\"mainNavNews\" class=\"${currentController eq 'News' ? 'selectedItem' : ''}\">foobar</span>\t\n\t</div>\t\n</jsp:root>\n\nWith tomcat 7.0.50 it fails with the following exception:\n\norg.apache.jasper.JasperException: /WEB-INF/views/layouts/mainNavigation.jspx (line: 10, column: 87) \"${currentController eq 'News' ? 'selectedItem' : ''}\" contains invalid expression(s): javax.el.ELException: Failed to parse the expression [${currentControllereq'News'?'selectedItem':''}]\n\tat org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:42)\n\tat org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:443)\n\tat org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:199)\n\tat org.apache.jasper.compiler.Validator$ValidateVisitor.getJspAttribute(Validator.java:1399)\n\tat org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:772)\n\tat org.apache.jasper.compiler.Node$UninterpretedTag.accept(Node.java:1251)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2375)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2427)\n\tat org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:779)\n\tat org.apache.jasper.compiler.Node$UninterpretedTag.accept(Node.java:1251)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2375)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2427)\n\tat org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:529)\n\tat org.apache.jasper.compiler.Node$JspRoot.accept(Node.java:564)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2375)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2427)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2433)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:474)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2375)\n\tat org.apache.jasper.compiler.Validator.validateExDirectives(Validator.java:1817)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:217)\n\tat org.apache.jasper.compiler.Compiler.__compile(Compiler.java:373)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:353)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:340)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:657)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:357)\n\tat org.apache.jasper.servlet.JspServlet._serviceJspFile(JspServlet.java:390)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:334)\n\nIt works when the ternary operation doesn't appear inside an attribute or instead of eq '==' is used.", "id": 172471, "time": "2014-01-18T12:42:47Z", "creator": "michael@simons.ac", "creation_time": "2014-01-18T12:42:47Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "michael@simons.ac", "is_private": false, "text": "Happens with all named operators\n\n<span class=\"${foo == 'bar' and 1==1 ? 'bar-span' : 'other-span'}\">span</span>\t\n\n\nwill break as well.\n\nIf used in jspx it only works now as \n\n<span class=\"${foo == 'bar' &amp;&amp; 1==1 ? 'bar-span' : 'other-span'}\">span</span>\t\n\nwhich is not a really acceptable solution.", "id": 172472, "time": "2014-01-18T13:09:13Z", "bug_id": 56029, "creation_time": "2014-01-18T13:09:13Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 56029, "text": "Ack. Reproducible with your sample file from Comment 0 minus the 'xmlns:c' and 'xmlns:fmt' attributes.\n\n\n> javax.el.ELException: Failed to parse the expression [${currentControllereq'News'?'selectedItem':''}]\n\nNotes:\n\n1. \"currentControllereq\" is printed without spaces in the above message. Also the rest of whitespaces are also missing in the message.\n\n2. A workaround is to add braces around the variable name.\nThe following does work:\n\n... class=\"${(currentController) eq 'News' ? 'selectedItem' : ''}\" ...\n\n\n3. This issue happens when EL in the value of a tag attribute.\n\nThis issue does not happen when EL is in the plain text (body of a tag).\nThe following does work successfully:\n\n<jsp:root version=\"2.0\" xmlns:jsp=\"http://java.sun.com/JSP/Page\"\n><jsp:directive.page contentType=\"text/plain\"/>\n${currentController eq 'News' ? 'selectedItem' : ''}</jsp:root>", "id": 172475, "time": "2014-01-18T15:34:27Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-01-18T15:34:27Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 56029, "attachment_id": null, "is_private": false, "id": 172476, "time": "2014-01-18T15:44:16Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-01-18T15:44:16Z", "text": "(In reply to Konstantin Kolinko from comment #2)\n> Ack. Reproducible with your sample file from Comment 0 minus the 'xmlns:c'\n> and 'xmlns:fmt' attributes.\n> \n\nReproducible in 8.0-RC10 and 6.0.38 (release candidate) as well."}, {"count": 4, "attachment_id": null, "bug_id": 56029, "text": "I suspected when I read this report that it was a regression caused by the fix for Bug 55198 and given the versions of Tomcat affected it looks to be very much the case (although I haven't confirmed it yet).", "id": 172477, "time": "2014-01-18T17:23:11Z", "creator": "markt@apache.org", "creation_time": "2014-01-18T17:23:11Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 56029, "text": "Fixed in 8.0.x for 8.0.0 onwards and in 7.0.x for 7.0.51 onwards.\n\nProposed for 6.0.x.", "id": 172478, "time": "2014-01-18T19:46:43Z", "creator": "markt@apache.org", "creation_time": "2014-01-18T19:46:43Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 56029, "text": "*** Bug 56031 has been marked as a duplicate of this bug. ***", "id": 172481, "time": "2014-01-18T21:04:27Z", "creator": "markt@apache.org", "creation_time": "2014-01-18T21:04:27Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 56029, "text": "Konstantin: Your addendum is fully correct, i can confirm this.\n\nThanks for your kind reply and the quick solution, highly appreciated. Also thanks for the workaround, but i guess i'll wait to 7.0.51.", "id": 172482, "time": "2014-01-18T21:11:32Z", "creator": "michael@simons.ac", "creation_time": "2014-01-18T21:11:32Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 56029, "text": "Created attachment 31231\ntest.jspx - Failure to trim leading space from fn prefix\n\nRe: r1559555\n\nNot yet.\n\nTesting current 7.0.x (at r1559663) I see the following error\n1. Place attached test.jspx into webapps/examples\n2. Access http://localhost:8080/examples/test.jspx\n3. Expected: \"[1]\". Actual:\n\norg.apache.jasper.JasperException: /test.jspx (line: 7, column: 63) The attribute prefix  fn does not correspond to any imported tag library\n org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:42)\n org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:443)\n org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:149)\n org.apache.jasper.compiler.Validator$ValidateVisitor$1FVVisitor.visit(Validator.java:1563)\n ...\n org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2375)\n org.apache.jasper.compiler.Validator.validateExDirectives(Validator.java:1817)\n org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:217)\n ...\n\nIn the message the prefix is printed as \" fn\" with leading whitespace.\nThe expression on the page is ${1 + fn:length(list)}", "id": 172537, "time": "2014-01-20T12:10:03Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-01-20T12:10:03Z", "is_private": false, "attachment_id": 31231}, {"count": 9, "text": "If fixed the white space issue in 8.0.x and 7.0.x and added it to the proposal for 6.0.x", "bug_id": 56029, "is_private": false, "id": 172552, "time": "2014-01-20T14:32:26Z", "creator": "markt@apache.org", "creation_time": "2014-01-20T14:32:26Z", "tags": [], "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 56029, "attachment_id": null, "is_private": false, "id": 172648, "time": "2014-01-23T21:53:02Z", "creator": "markt@apache.org", "creation_time": "2014-01-23T21:53:02Z", "text": "This has been fixed in 6.0.x and will be included in 6.0.39 onwards."}, {"count": 11, "tags": [], "bug_id": 56029, "text": "*** Bug 56124 has been marked as a duplicate of this bug. ***", "id": 172972, "time": "2014-02-10T09:09:24Z", "creator": "markt@apache.org", "creation_time": "2014-02-10T09:09:24Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "pansa05@ca.com", "is_private": false, "text": "It seems this issue is fixed now. Can anyone advice in which 7.0.x version can I expect the fix to be delivered?", "id": 172973, "time": "2014-02-10T09:20:44Z", "bug_id": 56029, "creation_time": "2014-02-10T09:20:44Z", "attachment_id": null}, {"count": 13, "tags": [], "text": "(In reply to Santosh from comment #12)\n> It seems this issue is fixed now. Can anyone advice in which 7.0.x version\n> can I expect the fix to be delivered?\n\nSantosh,\n\nMark Thomson mentioned that will be in 8.0.0 and 7.0.51 onwards. Not sure when will the 7.0.51 be available.. :-)", "is_private": false, "id": 172974, "creator": "Yuvaraju.Nataraj@ca.com", "time": "2014-02-10T10:18:44Z", "bug_id": 56029, "creation_time": "2014-02-10T10:18:44Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "loic.oudot@gmail.com", "text": "In the case where the war is not completly expanded in the work directory, the code introduce by the commit http://svn.apache.org/viewvc?view=revision&revision=1663784 doesn't catch the case where the file 'war_tracker' is not present and do not re-expand the war file accordingly.\n\nWe can see the code in org.apache.catalina.startup.ExpandWar.java:\n\n        // Check to see of the WAR has been expanded previously\n        if (docBase.exists()) {\n            // A WAR was expanded. Tomcat will have set the last modified\n            // time of warTracker file to the last modified time of the WAR so\n            // changes to the WAR while Tomcat is stopped can be detected\n            if (!warTracker.exists() || warTracker.lastModified() == warLastModified) {\n                // No (detectable) changes to the WAR\n                success = true;\n                return (docBase.getAbsolutePath());\n            }\n\nThe test should be more thinner :\nif (warTracker.exists() && warTracker.lastModified() == warLastModified) {\n                // No (detectable) changes to the WAR\n                success = true;\n                return (docBase.getAbsolutePath());\n}\n\nI don't catch when this use case appear exactly, but I face this problem one or two times a day.", "id": 186433, "time": "2015-11-18T13:54:07Z", "bug_id": 58625, "creation_time": "2015-11-18T13:54:07Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 58625, "text": "there is duplicate code in org.apache.catalina.startup.HostConfig :\n        if (xml.exists() && unpackWARs &&\n                (!warTracker.exists() || warTracker.lastModified() == war.lastModified())) {\n            useXml = true;\n        }\n\nthe same pacth might be included also:\n        if (xml.exists() && unpackWARs &&\n                (warTracker.exists() && warTracker.lastModified() == war.lastModified())) {\n            useXml = true;\n        }", "id": 186434, "time": "2015-11-18T14:01:52Z", "creator": "loic.oudot@gmail.com", "creation_time": "2015-11-18T14:01:52Z", "tags": [], "is_private": false}, {"count": 2, "attachment_id": null, "creator": "markt@apache.org", "text": "Sorry, we aren't going to be making that change. If a user upgrades from a Tomcat version without this feature to a Tomcat version with this feature it is going to trigger removal of the expanded dir and re-expansion of the WAR. That is unexpected and is likely to cause problems for some users.\n\nIf you can identify exactly what is going wrong in your use case then we can take another look to see if we can handle that specific case.", "id": 186453, "time": "2015-11-19T19:51:13Z", "bug_id": 58625, "creation_time": "2015-11-19T19:51:13Z", "tags": [], "is_private": false}]
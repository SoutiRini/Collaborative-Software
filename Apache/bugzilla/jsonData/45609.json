[{"count": 0, "tags": [], "bug_id": 45609, "text": "Created attachment 22424\nscreenshots and source code to generate the problem\n\nplease see screenshots for this problem.\n\nthe problem sometime occur if we have 1 jsp that contentType=image/png or image/jpg and that JSP write image to the out stream.\nwhen other jsp call that page many times.  the server throws java.lang.IllegalStateException. and sometime the character encoding is become \"?????\"\n\n\nplease see attached phone.jsp,  it is the jsp that write image to the output stream and get parameter id=[number].\nyou can call phone.jsp?id=123 without any problem or Exception.\n\nBut if you call it many times (please use testphone.jsp to test).\nwhen you refresh the testphone.jsp page many times.  the UTF-8 encoding become broken and you can see only \"????\" character.\n\nI tried on both Windows and Unix and it has the same problem.\n\nHere are the error from localhost logs.\nAug 11, 2008 11:35:12 AM org.apache.catalina.core.StandardWrapperValve invoke\nSEVERE: Servlet.service() for servlet default threw exception\njava.lang.IllegalStateException\n\tat org.apache.catalina.connector.ResponseFacade.sendError(ResponseFacade.java:407)\n\tat org.apache.catalina.servlets.DefaultServlet.serveResource(DefaultServlet.java:662)\n\tat org.apache.catalina.servlets.DefaultServlet.doGet(DefaultServlet.java:325)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:690)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:803)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:230)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:104)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:261)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:844)\n\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:581)\n\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447)\n\tat java.lang.Thread.run(Unknown Source)", "id": 119667, "time": "2008-08-10T22:06:01Z", "creator": "jirat_s@hotmail.com", "creation_time": "2008-08-10T22:06:01Z", "is_private": false, "attachment_id": 22424}, {"count": 1, "attachment_id": null, "creator": "markt@apache.org", "text": "We have seen this sort of issue in the past.\n\nRemy looked into it and found that the graphics library was accessing the output stream outside of the service method and it was this that was causing the issue.\n\nI did a search of the archives and found bug 37516 which had the same root cause (although different symptoms) and I am sure there were others.", "id": 119683, "time": "2008-08-11T08:18:24Z", "bug_id": 45609, "creation_time": "2008-08-11T08:18:24Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 45609, "attachment_id": null, "text": "Thank you very much,\nbut then how can we fix this issues?\nI already follow your link but it doesn't provide the solution.\nI also searched for Java2D or stream or outside service and not found any useful solution.\n\nBest Regards,", "id": 119687, "time": "2008-08-11T08:45:13Z", "creator": "jirat_s@hotmail.com", "creation_time": "2008-08-11T08:45:13Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 47374, "attachment_id": null, "text": "I create three groups being the root node. I collapse each group as well using setRowGroupCollapsed. However, when I expand the first node on the Excel File generated, all the other nodes are also expanded.\nTo prevent this I apply this patch in the class org.apache.poi.hssf.record.aggregates.RowRecordsAggregate, method collapseRow :\n\n public void collapseRow( int rowNumber )\n    {\n        // Find the start of the group.\n        int startRow = findStartOfRowOutlineGroup( rowNumber );\n        RowRecord rowRecord = getRow( startRow );\n\n        //I add this line\n        rowRecord.setColapsed(true);\n\n\n        // Hide all the columns until the end of the group\n        int lastRow = writeHidden( rowRecord, startRow, true );\n\n        // Write collapse field\n        if (getRow(lastRow + 1) != null)\n        {\n            getRow(lastRow + 1).setColapsed( true );\n        }\n        else\n        {\n            RowRecord row = createRow( lastRow + 1);\n            row.setColapsed( true );\n            insertRow( row );\n        }\n    }", "id": 127979, "time": "2009-06-16T09:57:02Z", "creator": "julien.bittard@logica.com", "creation_time": "2009-06-16T09:57:02Z", "is_private": false}, {"count": 1, "tags": [], "creator": "julien.bittard@logica.com", "attachment_id": 23816, "id": 127980, "time": "2009-06-16T09:57:44Z", "bug_id": 47374, "creation_time": "2009-06-16T09:57:44Z", "is_private": false, "text": "Created attachment 23816\nThe classe RowRecordsAggregate"}, {"count": 2, "tags": [], "creator": "josh@apache.org", "attachment_id": null, "is_private": false, "id": 128001, "time": "2009-06-16T17:02:31Z", "bug_id": 47374, "creation_time": "2009-06-16T17:02:31Z", "text": "Your comment was:\nThanks for the bug-report and suggested fix.  So your proposed change was to\nadd the line \"rowRecord.setColapsed(true);\" in collapseRow(int):\n\n    public void collapseRow(int rowNumber) {\n\n        // Find the start of the group.\n        int startRow = findStartOfRowOutlineGroup(rowNumber);\n        RowRecord rowRecord = getRow(startRow);\n\n+        rowRecord.setColapsed(true);\n        // Hide all the columns until the end of the group\n        int nextRowIx = writeHidden(rowRecord, startRow);\n\n\nUnfortunately this is NQR.  I think we need to mark the previous row as\n'collapsed', not the first row.\n\nFor example, with the following POI calls:\n\n    sheet.setRowSumsBelow(false);\n    sheet.groupRow(3, 5);\n    sheet.setRowGroupCollapsed(3, true);\n\nWe should get the following 'outline levels' and flags in the rows:\n\n2 ol=0 collapsed\n3 ol=1 hidden\n4 ol=1 hidden\n5 ol=1 hidden\n\nCurrently POI does this:\n\n3 ol=1 hidden\n4 ol=1 hidden\n5 ol=1 hidden\n6 ol=0 collapsed\n(Which is actually correct only if sheet.rowSumsBelow == true)\n\nI've done some experimenting with how Excel collapses rows and it appears that\nthe row with the 'collapsed' flag should appear above *or* below the group\naccording to the state of the 'rowSumsBelow' flag on the sheet.  POI assumes\nthe 'collapsed' flag belongs on the group subsequent row which is wrong if\nrowSumsBelow is false.\n\nPOI should also be changed so that the 'rowSumsBelow' property in HSSFSheet\ngets coordinated with the underlying RowRecordsAggregate.  The\nRowRecordsAggregate needs to know the value of this flag in order to find the\nright row to update the 'collapsed' flag on.  Furthermore, when 'rowSumsBelow'\nchanges in the sheet, the RowRecordsAggregate will also need to transfer the\n'collapsed' flags of each row group accordingly.\n\n\nNote - Excel's overall model for collapsing row groups works OK as long as\nevery group has its own dedicated summary row (above or below).  It's not too\nhard to create groups that have no summary row, and Excel behaves a little\nweirdly in these cases.  POI probably shouldn't bother supporting such\nanomalous use cases, and that should be mentioned in the javadoc."}, {"count": 3, "tags": [], "creator": "julien.bittard@logica.com", "attachment_id": null, "id": 128022, "time": "2009-06-17T06:37:58Z", "bug_id": 47374, "creation_time": "2009-06-17T06:37:58Z", "is_private": false, "text": "Thank you for your comments. But I think I have not good explain my problem.\nIn my example, I have one root group, and two sub-group. And when I expand the root group, the sub-group are also expanded. I attach a file example.\nMy patch fixes the problem.\nIn my example the 'rowSumsBelow' property is false.\nI hope you understand what I mean."}, {"count": 4, "tags": [], "bug_id": 47374, "attachment_id": 23824, "id": 128023, "time": "2009-06-17T06:44:53Z", "creator": "julien.bittard@logica.com", "creation_time": "2009-06-17T06:44:53Z", "is_private": false, "text": "Created attachment 23824\ntest case"}, {"count": 5, "tags": [], "text": "This patch is now quite outdated and thus it is very hard to see what the actual changes were here because a full file was provided instead of a clean patch with only the relevant changes. \n\nSetting this to NEEDINFO unless someone comes up with a refreshed patch that applies cleanly to the current version again.", "attachment_id": null, "bug_id": 47374, "id": 189400, "time": "2016-03-12T15:08:21Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-03-12T15:08:21Z", "is_private": false}]
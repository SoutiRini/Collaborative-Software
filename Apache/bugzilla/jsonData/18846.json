[{"count": 0, "tags": [], "creator": "kamoshida.toshiaki@future.co.jp", "attachment_id": null, "id": 34779, "time": "2003-04-09T09:56:05Z", "bug_id": 18846, "creation_time": "2003-04-09T09:56:05Z", "is_private": false, "text": "Because there is a danger of mixing any mistakes or problems or confuses about \nthe transformation between byte array and String object(because of platform and \nlocale and any bugs:D),I request to refactor the operations in sources about it.\n\nThe rest is only an idea,maybe there is better one,please discuss about it :).\n\n1.Refactor the class org.apache.poi.util.StringUtil like;\n\npublic static String getFromUnicodeHigh(final byte[] string,\n\u0081@final int offset, final int len){\n  try{\n    return new String(string,offset,len*2,\"UTF-16LE\");\n  }\n  catch(UnsupportedEncodingException e){\n    throw new InternalError();/*unreachable*/\n  }\n}\n\npublic static String getFromUnicode(final byte[] string,\n\u0081@final int offset, final int len){\n  try{\n    return new String(string,offset,len*2,\"UTF-16BE\");\n  }\n  catch(UnsupportedEncodingException e){\n    throw new InternalError();/*unreachable*/\n  }\n}\n\n//add new method\npublic static String getFromCompressedUnicode(final byte[] string,\n\u0081@final int offset, final int len){\n  try{\n    return new String(string,offset,len,\"ISO-8859-1\");\n  }\n  catch(UnsupportedEncodingException e){\n    throw new InternalError();/*unreachable*/\n  }\n}\n\npublic static void putCompressedUnicode(final String input,\n  final byte[] output,final int offset){\n  try{\n    byte[] bytes = input.getBytes(\"ISO-8859-1\");\n    System.arraycopy(output,offset,bytes,0,bytes.length);\n  }\n  catch(UnsupportedEncodingException e){\n    throw new InternalError();/*unreachable*/\n  }\n}\n\npublic static void putUncompressedUnicode(final String input,\n  final byte[] output,final int offset){\n  try{\n    byte[] bytes = input.getBytes(\"UTF-16LE\");\n    System.arraycopy(output,offset,bytes,0,bytes.length);\n  }\n  catch(UnsupportedEncodingException e){\n    throw new InternalError();/*unreachable*/\n  }\n}\npublic static void putUncompressedUnicodeHigh(final String input,\n  final byte[] output,final int offset){\n  try{\n    byte[] bytes = input.getBytes(\"UTF-16BE\");\n    System.arraycopy(output,offset,bytes,0,bytes.length);\n  }\n  catch(UnsupportedEncodingException e){\n    throw new InternalError();/*unreachable*/\n  }\n}\n\n2.Replace all phrases \"new String(args)\"\nto \"StringUtil.getFromCompressedUnicode(args)\""}, {"count": 1, "tags": [], "bug_id": 18846, "text": "Created attachment 5765\nSample to show that System Encoder/Decoder works like StringUtil want to do.Please execute main and see console.", "id": 34858, "time": "2003-04-10T09:18:05Z", "creator": "kamoshida.toshiaki@future.co.jp", "creation_time": "2003-04-10T09:18:05Z", "is_private": false, "attachment_id": 5765}, {"attachment_id": null, "tags": [], "creator": "kamoshida.toshiaki@future.co.jp", "text": "We need a 6 way to transform from/to byte array to/from String Object in POI.\n\n1. Encode char seq 16Bit Uncompressed Unicode \n-> byte array with 16Bit Unicode on LittleEndian(like \"UTF-16LE\"builtin Encoder)\n2. Encode char seq 16Bit Uncompressed Unicode \n-> byte array with 16Bit Unicode on BigEndian(like \"UTF-16BE\"builtin Encoder)\n3. Encode char seq 8Bit Compressed Unicode\n-> byte array with 8Bit Compressed Unicode(like \"ISO-8859-1\"builtin Encoder)\n4. Decode byte array with 16Bit Unicode on LittleEndian\n->char seq 16Bit Uncomressed Unicode(like \"UTF-16LE\"builtin Decoder)\n5. Decode byte array with 16Bit Unicode on BigEndian\n->char seq 16Bit Uncomressed Unicode(like \"UTF-16BE\"builtin Decoder)\n6. Decode byte array with 8Bit Compressed Unicode\n->char seq 8Bit Comressed Unicode(like \"ISO-8859-1\"builtin Decoder)\n\nAnd now,in POI,there are doing with the ways like;\n\n1.call StringUtil#getFromUnicodeHigh()\n2.perhaps call StringUtil#getFromUnicode()\n3.call constractor of java.lang.String() with no Decode Indicator\n4.call StringUtil#putUncompressedUnicode()\n5.perhaps call StringUtil#putUncompressedUnicodeHigh()\n6.call StringUtil#putCompressedUnicode()\n\nSo,It seems for me,there is some confusion and problems.\n\n(1)StringUtil#getFromUnicode()&#putUncompressedUnicodeHigh() has bugs,so these \nare always not works as you expect(see Bug 18837)\n(2)To do 1 you should use StringUtil#getFromUnicodeHigh() but to do 4 you \nshould use putUncompressedUnicode().the name of metods shows some confuse.\n(3)The way to do 3 is isolated from others.\n(4)The functions of thease method is already existed at J2SE API(Constractor of \njava.lang.String).The implementations of these methods may be \"Reinvention of \nwheel\".\n\nI feel,to refine thease places may makes your burden a little lighter.\nBut the priority of this matter is low,because the change works no effect at \nruntime,but only refine the landscape of sources...\nI feel and afraid,this may be one of the \"broken window\" in POI.", "count": 2, "id": 34942, "time": "2003-04-11T05:40:54Z", "bug_id": 18846, "creation_time": "2003-04-11T05:40:54Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 18846, "attachment_id": null, "is_private": false, "id": 34966, "time": "2003-04-11T12:13:35Z", "creator": "poi-support@buni.org", "creation_time": "2003-04-11T12:13:35Z", "text": "I totally support refactoring this.  It looks like you know the most about it\nand have the know-how to do it.  Send patches...They will be applied!  "}, {"count": 4, "tags": [], "creator": "kamoshida.toshiaki@future.co.jp", "attachment_id": null, "id": 35083, "time": "2003-04-14T03:04:17Z", "bug_id": 18846, "creation_time": "2003-04-14T03:04:17Z", "is_private": false, "text": "After fixing Bug 18947,I'll submit a patch for implementations in StringUtil.\n\n...I could only 4 testcases to find the problems about Bug 18947,please help me!\nI found the easy way to change \"Default Encoding\" at runtime on Sun JRE(see the \nsubmitted testcase at Bug 18947),so perhaps the way help your works to find and \nsolve any \"Problems on Encoding\" after now...\n\nAnd,if you can,please change the names of method XXXUnicode and XXXUnicodeHigh.\nbecause of section(2).\n\nRenaming methods is a easy work over any IDE(I can do it easily on Eclipse JDT).\nBut if I do so,many points will cange by the work,so it's difficurt to submit \nas a patch.And I feel,I shouldn't give new names at these methods,but you do:D"}, {"count": 5, "tags": [], "creator": "poi-support@buni.org", "attachment_id": null, "id": 35111, "time": "2003-04-14T12:21:41Z", "bug_id": 18846, "creation_time": "2003-04-14T12:21:41Z", "is_private": false, "text": "I disagree.  I think submitting patches would be the perfect way to fix the\nproblem and that you are the perfect person to rename methods."}, {"count": 6, "tags": [], "bug_id": 18846, "text": "OK,I'll make a PATCH.\n\nI'll rename these methods to;\n#getFromCompressedUnicode()\n#getFromUnicodeLE()\n#getFromUnicodeBE()\n#putCompressedUnicode()\n#putUnicodeLE()\n#putUnicodeBE()\n\nIf there are opinions against it,please tell me your objections:D", "id": 35698, "time": "2003-04-21T11:34:11Z", "creator": "kamoshida.toshiaki@future.co.jp", "creation_time": "2003-04-21T11:34:11Z", "is_private": false, "attachment_id": null}, {"count": 7, "attachment_id": 6270, "bug_id": 18846, "text": "Created attachment 6270\nPATCH for this matter. test passed in my env.", "id": 36899, "time": "2003-05-08T12:18:52Z", "creator": "kamoshida.toshiaki@future.co.jp", "creation_time": "2003-05-08T12:18:52Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "text": "I submitted a PATCH.\nBecause it is only a refactor,so there is no any new testcases.\nPlz check and eval it.\n\nLine feeds in StringUtil has broken now,so I fixed it with this works.", "attachment_id": null, "id": 36900, "creator": "kamoshida.toshiaki@future.co.jp", "time": "2003-05-08T12:22:26Z", "bug_id": 18846, "creation_time": "2003-05-08T12:22:26Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 18846, "is_private": false, "text": "BTW,there is some calling get/setUnicodeBE() in hssf,but there may be no place \nto store the Unicode-character-sequences with BigEndian in XLS format...\nI guess the places may contain some problems without showing as any bugs with \ntestcases now exist.\nBut I didn't know what the places do.I made the PATCH only by replacing with \nthe \"REFACTOR\" command of \"Eclipse JDT\":D", "id": 37459, "time": "2003-05-20T05:26:16Z", "creator": "kamoshida.toshiaki@future.co.jp", "creation_time": "2003-05-20T05:26:16Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 18846, "text": "this patch looks funny...  We should work on this though.  Maybe Tetsuya can help.", "id": 41372, "time": "2003-07-24T16:11:41Z", "creator": "poi-support@buni.org", "creation_time": "2003-07-24T16:11:41Z", "is_private": false, "attachment_id": null}, {"count": 11, "attachment_id": null, "bug_id": 18846, "text": "Fixed Weird LineFeed. Toshiaki, please supply the \"cvs diff -u\" style patch \nagain for other parts.", "id": 41417, "time": "2003-07-24T17:02:34Z", "creator": "tetsuya.kitahata@nifty.com", "creation_time": "2003-07-24T17:02:34Z", "tags": [], "is_private": false}]
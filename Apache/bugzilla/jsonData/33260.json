[{"count": 0, "tags": [], "creator": "jay_anderson@capgroup.com", "attachment_id": null, "is_private": false, "id": 70133, "time": "2005-01-27T03:07:05Z", "bug_id": 33260, "creation_time": "2005-01-27T03:07:05Z", "text": "The p4change task does not set the p4.change property or the p4change task sets \nthe p4.change property to the changelist number with a \"1\" appended.  Problem \noccurs with some users but not others.\nCause appears to be when the Perforce user in question has jobs associated with \nthem through their jobview.  If one job is associated, the p4.change property \nhas the actual changelist with a \"1\" appended.  If many jobs are associated \nwith the user, p4.change is not set.\nNote that the native Perforce command \"p4 change -o\" (which is used by the \np4change task) reports all jobs associated with a user.  I'm guessing that when \njobs are associated and are reported by this command, the resulting text \nis \"unexpected\" and not handled correctly by the code implementing the p4change \ntask."}, {"count": 1, "tags": [], "bug_id": 33260, "attachment_id": null, "id": 72229, "time": "2005-03-11T19:45:21Z", "creator": "antoine@apache.org", "creation_time": "2005-03-11T19:45:21Z", "is_private": false, "text": "can you enter the exacts step to reproduce the bug,\nthe versions of the Perforce client and of the Perforce server which are involved.\nMaybe if you can create a build.xml simulating the complete problem, including\ncreating the job (may be with an exec task), ... and attach it to this bug\nreport it can help.\nCheers, Antoine"}, {"count": 2, "tags": [], "bug_id": 33260, "text": "We are having the same problem.\n\nPerforce:\nClient Version: 2004.2 72642\nServer Version: P4D/LINUX24X86/2005.1/83219 (2005/07/26)\n\nAnt:\n1.6.5\n\nOur xml file contains:\n\n  <p4change description=\"Change Build Number in Script\"/>\n  <p4edit\n    view=\"${JavaLispCommonResources}/currentResources.properties...\"\n    change=\"${p4.change}\"/>\n  <propertyfile file=\"${JavaLispCommonResources}/currentResources.properties\">\n  <entry  key=\"build.date\" type=\"date\" value=\"now\" pattern=\"yyyy.MM.dd\"/>\n  <entry  key=\"build.num\" type=\"int\" default=\"0000\" operation=\"+\" value=\"1\"\npattern=\"0000\"/>\n  </propertyfile>\n  <p4submit change=\"${p4.change}\"/>\n\nIt gets to the <p4edit/> and complains about ${p4.change} not being set.", "id": 87160, "time": "2006-03-23T18:31:59Z", "creator": "frail.knight@gmail.com", "creation_time": "2006-03-23T18:31:59Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 33260, "attachment_id": null, "text": "(In reply to comment #1)\n> can you enter the exacts step to reproduce the bug,\n> the versions of the Perforce client and of the Perforce server which are \ninvolved.\n> Maybe if you can create a build.xml simulating the complete problem, including\n> creating the job (may be with an exec task), ... and attach it to this bug\n> report it can help.\n> Cheers, Antoine\n(In reply to comment #1)\n> can you enter the exacts step to reproduce the bug,\n> the versions of the Perforce client and of the Perforce server which are \ninvolved.\n> Maybe if you can create a build.xml simulating the complete problem, including\n> creating the job (may be with an exec task), ... and attach it to this bug\n> report it can help.\n> Cheers, Antoine\n\nThe key point to reproduce is to create a user with a valid job specified in \nthe JobView.\n1) Create a Job: \n   >p4 job testing1\n2) create a JobView for the user - add the following line to the user spec at \nthe bottom:\n   >p4 user\n   JobView:\ttesting1\n3) Then run the p4change task and print or try and use ${p4.change} and see \nthat it has an extra 1 on the end.\n\nServer date: 2006/12/12 12:07:11 -0700 Mountain Standard Time\nServer version: P4D/NTX86/2005.2/93627 (2006/02/14)\n", "id": 96825, "time": "2006-12-12T11:08:44Z", "creator": "duncan_mcnaught@intuit.com", "creation_time": "2006-12-12T11:08:44Z", "is_private": false}, {"count": 4, "tags": [], "creator": "cmclouth@perforce.com", "attachment_id": 20126, "is_private": false, "id": 102831, "time": "2007-05-03T14:24:05Z", "bug_id": 33260, "creation_time": "2007-05-03T14:24:05Z", "text": "Created attachment 20126\nFix for reported problem\n\nThis problem occurs because the code did not correctly create an empty\nchangelist (jobview jobs were included) and it also did not correctly parse the\nresult of the command.\tfixed with the patch where\n//apache/ant/src_1_7_0.org/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Change.java\nis the original and\n//apache/ant/src_1_7_0.mine/src/main/org/apache/tools/ant/taskdefs/optional/perforce/P4Change.java\ncontains my modifications."}, {"count": 5, "tags": [], "creator": "daniel.draes@hilti.com", "attachment_id": null, "is_private": false, "id": 114974, "time": "2008-03-26T03:23:04Z", "bug_id": 33260, "creation_time": "2008-03-26T03:23:04Z", "text": "I have the same problem here. Setup is as follows:\n\nPerforce client:\nPerforce - The Fast Software Configuration Management System.\nCopyright 1995-2007 Perforce Software.  All rights reserved.\nRev. P4/NTX86/2007.2/122958 (2007/05/22).\n\nPerforce server:\nServer date: 2008/03/26 10:23:12 +0000 GMT\nServer version: P4D/LINUX26X86_64/2007.3/143793 (2008/01/09)\n\n\nMy Ant task looks as follows:\n\t<target name=\"update_manifest\">\n\t\t<property name=\"p4.globalopts\" value=\"-P xxxxxxxx\"/>\n\t\t<property name=\"p4.client\" value=\"zzzz\"/>\n\t\t<property name=\"p4.user\" value=\"yyyyyy\"/>\n\t\t<property name=\"p4.port\" value=\"host:1667\"/>\n\t\t<property name=\"p4.change\" value=\"\"/>\n\t\t\n\t\t<p4change description=\"Change Build Number in Script\"/>\n\t\t<echo message=\"changeno: ${p4.change}\"></echo>\n\t\t<p4edit\n\t\t   \tview=\"//cid_dev/java_src/MANIFEST.MF\"\n\t\t\tchange=\"${p4.change}\"\n\t\t    globalopts=\"${p4.globalopts}\"/>\n\t\t<echo message=\"changeno: ${p4.change}\"></echo>\n\t\t<p4submit change=\"${p4.change}\" globalopts=\"${p4.globalopts}\"/>\n     </target>\n\nThis does unfortunatly not work. The p4change-command does not set the p4.change-property as it should the echo reads as:\n[echo] changeno: \n\n\n"}, {"count": 6, "tags": [], "creator": "Udo.Walker@abas.de", "attachment_id": null, "is_private": false, "id": 135926, "time": "2010-04-07T08:44:12Z", "bug_id": 33260, "creation_time": "2010-04-07T08:44:12Z", "text": "For me it works if I use the not documented attributes client and user which all p4 tasks know.\n\nSo if you use\n\n<p4change user=\"ooo\" client=\"iiii\" description=\"my new changelist\"/>\n\n<echo>${p4.change}</echo>\n\nyou will get a changelist number.\n\nTo use it you need to use the 2 attributes in all p4 tasks, e.g.\n\n<p4edit user=\"ooo\" client=\"iiii\" ..../>\n\netc."}, {"count": 7, "tags": [], "creator": "daniel.draes@hilti.com", "attachment_id": null, "is_private": false, "id": 135927, "time": "2010-04-07T09:10:53Z", "bug_id": 33260, "creation_time": "2010-04-07T09:10:53Z", "text": "Hi Udo,\n\nastonishing, just two years later ;)\n\nAnyway, your way works for me as well! Finally task solved...\n\nThanks a lot!\n\nDaniel"}]
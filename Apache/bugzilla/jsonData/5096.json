[{"count": 0, "tags": [], "bug_id": 5096, "text": "The XML View of a JSP page is an XML document without an encoding declaration.\nAccording to the XML spec, such a document must use UTF-8 encoding, but the \nPageData implementation in Jasper returns a stream with the platform's\ndefault encoding instead.\n\nThe error can be fixed in the org.apache.jasper.compiler.XmlOutputter class,\nby hardcoding UTF-8 in the getPageData() method:\n\n    PageData getPageData() {\n        StringBuffer buff = new StringBuffer();\n        AttributesImpl attrs = new AttributesImpl();\n        \n        append(\"jsp:root\", rootAttrs, buff, false);\n        buff.append(sb.toString());\n        buff.append(\"</jsp:root>\");\n        // Current code:\n        //InputStream is = new byteArrayInputStream(buff.toString().getBytes());\n        InputStream is = null;\n        try {\n            is = new ByteArrayInputStream(buff.toString().getBytes(\"UTF-8\"));\n        }\n        catch (java.io.UnsupportedEncodingException e) {\n            // Can never happen? I assume all platforms support UTF-8\n        }\n        //System.out.println(\"XmlOutputter: \\n\" + buff);\n        PageData pageData = new PageDataImpl(is);\n        return pageData;\n    }\n\nWithout this patch, a the TagLibraryValidator used in the Jakarta Taglibs\n\"standard\" library (i.e. the JSTL RI, EA2) throws a SaxParseException if\nthe page contains European national characters (e.g. \u00e5, \u00e4, \u00f6):\n\n  Character conversion error: \"Malformed UTF-8 char -- is an XML encoding \n  declaration missing?\" (line number may be too low).", "id": 8273, "time": "2001-11-26T11:35:50Z", "creator": "hans@gefionsoftware.com", "creation_time": "2001-11-26T11:35:50Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "kin-man.chung@sun.com", "attachment_id": null, "id": 8756, "time": "2001-12-10T10:43:34Z", "bug_id": 5096, "creation_time": "2001-12-10T10:43:34Z", "is_private": false, "text": "Patch applied (nightly build 20011211).   Thanks Hans Bergsten for the patch."}]
[{"count": 0, "tags": [], "bug_id": 53697, "attachment_id": null, "text": "I hit tomcat with ~20 different urls in ~2 seconds, test some functionality, wait ~3 minutes, then do it again and I always get this exception and then I get (intermitent) connection interrupted messages in the browser.  Here's the full trace:\n\nAug 10, 2012 6:33:14 PM org.apache.catalina.connector.CoyoteAdapter event\nSEVERE: null\nAug 10, 2012 6:33:14 PM org.apache.catalina.connector.CoyoteAdapter event\njava.lang.NullPointerException\n\tat org.apache.coyote.http11.Http11AprProcessor.actionInternal(Http11AprProcessor.java:277)\n\tat org.apache.coyote.http11.AbstractHttp11Processor.action(AbstractHttp11Processor.java:846)\n\tat org.apache.coyote.Response.action(Response.java:172)\n\tat org.apache.catalina.connector.CoyoteAdapter.event(CoyoteAdapter.java:229)\n\tat org.apache.coyote.http11.Http11AprProcessor.event(Http11AprProcessor.java:133)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:581)\n\tat org.apache.tomcat.util.net.AprEndpoint$SocketProcessor.run(AprEndpoint.java:1770)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n\tat java.lang.Thread.run(Thread.java:722)\n\nAug 10, 2012 6:33:14 PM org.apache.coyote.http11.Http11AprProcessor event\nSEVERE: Error processing request\njava.lang.NullPointerException\n\tat org.apache.coyote.http11.Http11AprProcessor.actionInternal(Http11AprProcessor.java:277)\n\tat org.apache.coyote.http11.AbstractHttp11Processor.action(AbstractHttp11Processor.java:846)\n\tat org.apache.coyote.Request.action(Request.java:346)\n\tat org.apache.catalina.connector.Request.getRemoteAddr(Request.java:1281)\n\tat org.apache.catalina.connector.Request.getRemoteHost(Request.java:1296)\n\tat org.apache.catalina.valves.AccessLogValve$HostElement.addElement(AccessLogValve.java:1327)\n\tat org.apache.catalina.valves.AccessLogValve.log(AccessLogValve.java:953)\n\tat org.apache.catalina.core.AccessLogAdapter.log(AccessLogAdapter.java:51)\n\tat org.apache.catalina.core.ContainerBase.logAccess(ContainerBase.java:1263)\n\tat org.apache.catalina.core.ContainerBase.logAccess(ContainerBase.java:1270)\n\tat org.apache.catalina.connector.CoyoteAdapter.event(CoyoteAdapter.java:250)\n\tat org.apache.coyote.http11.Http11AprProcessor.event(Http11AprProcessor.java:133)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:581)\n\tat org.apache.tomcat.util.net.AprEndpoint$SocketProcessor.run(AprEndpoint.java:1770)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n\tat java.lang.Thread.run(Thread.java:722)\n\nAdditional information:\n - hp Proliant DL360 with two 3ghz processors\n - CentOS 6.3\n - One app runs websockets under bleading edge Atmosphere and Grails\n - the 20 urls come from chrome and firefox, simulatneously", "id": 161253, "time": "2012-08-11T08:33:54Z", "creator": "lacycb@gmail.com", "creation_time": "2012-08-11T08:33:54Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 53697, "attachment_id": null, "text": "Without a test case to reproduce the problem there is little the Tomcat developers can do. It looks like multiple threads are acting on the same socket at the same time. What I can't tell is if that is intentional, the result of a Tomcat bug or something the frameworks/app is doing.\n\nThe NPE is avoidable in one of the two stack traces provided but I am not yet sure avoiding it is a good thing (depending on the root cause).\n\nI would add that a test case isn't essential - the Tomcat developers have made changes in the past for hard to reproduce bugs based purely on the bug reporters analysis of their code, the Tomcat code and what is going wrong where. That said, it is also the case that the Tomcat developers have refused to apply speculative patches that the bug reporter claims fixes the issue that did not come with an explanation of what the bug was and why the patch fixed it.", "id": 161272, "time": "2012-08-11T19:59:16Z", "creator": "markt@apache.org", "creation_time": "2012-08-11T19:59:16Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 53697, "text": "Please find the test case at:\nhttps://chrislacy.net/downloads/tomcat-bug-53697.tar.gz\n\nSteps:\n- install apr and dependencies\n- compile and install native\n- startup tomcat (./startup.sh)\n- hit https://localhost:8443/AtmosphereTest\n- hit http://localhost:8080/AtmosphereTest\n- repeat hits if necessary (usually first round does it, but sometimes\nanother hit to https is needed)\n\nI used firefox and tested on both the server I mentioned and another\ndevelopment box.  A second, related, error that happends ~1/2 of the time, is currently in catalina.out\nand has the pid error file in CATALINA_HOME - copied here:\n\n#\n# A fatal error has been detected by the Java Runtime Environment:\n#\n#  SIGSEGV (0xb) at pc=0x00007fd3840a78d0, pid=28351, tid=140546779842304\n#\n# JRE version: 7.0_05\n# Java VM: OpenJDK 64-Bit Server VM (23.0-b21 mixed mode linux-amd64 compressed oops)\n# Problematic frame:\n# C  0x00007fd3840a78d0\n#\n# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try \"ulimit -c unlimited\" before starting Java again\n#\n# An error report file with more information is saved as:\n# /home/chris/Documents/apache-tomcat-7.0.29/bin/hs_err_pid28351.log\n#\n# If you would like to submit a bug report, please include\n# instructions on how to reproduce the bug and visit:\n#   http://icedtea.classpath.org/bugzilla\n#", "id": 161309, "time": "2012-08-12T21:31:53Z", "creator": "lacycb@gmail.com", "creation_time": "2012-08-12T21:31:53Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 53697, "attachment_id": null, "text": "https://chrislacy.net/downloads/tomcat-bug-53697.tar.gz returns a 404 reponse\n\nWithout a test case that demonstrates the issue, this is going to get closed as wontfix.", "id": 161432, "time": "2012-08-15T18:31:16Z", "creator": "markt@apache.org", "creation_time": "2012-08-15T18:31:16Z", "is_private": false}, {"count": 4, "tags": [], "creator": "lacycb@gmail.com", "attachment_id": null, "text": "Please try again.  Server overhaul yesterday evening took download down.", "id": 161433, "time": "2012-08-15T19:05:17Z", "bug_id": 53697, "creation_time": "2012-08-15T19:05:17Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 53697, "attachment_id": null, "text": "I don't think a 43MB download could be classed as a minimal test case.\n\nWhile it is true that having a complete copy of the entire Tomcat directory means we have all the config info we might ever need, normally the WAR would suffice.", "id": 161442, "time": "2012-08-15T20:59:00Z", "creator": "markt@apache.org", "creation_time": "2012-08-15T20:59:00Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 53697, "attachment_id": null, "is_private": false, "id": 161444, "time": "2012-08-15T21:18:09Z", "creator": "markt@apache.org", "creation_time": "2012-08-15T21:18:09Z", "text": "OK. I can reproduce this now. I'm not sure how long it will take to track down the root cause."}, {"count": 7, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Found it. It is a regression in the HTTP APR connector introduced by the fix for bug 51881. The isComet flag for instances of Http11AprProcessor (which gets re-used across connections) was not being reset in some circumstances so Tomcat was attempting to handle a new HTTP request using the Comet processing chain. Chaos ensued.\n\nThis has been fixed in trunk and 7.0.x and will be included in 7.0.30 onwards.", "id": 161451, "time": "2012-08-15T22:56:47Z", "bug_id": 53697, "creation_time": "2012-08-15T22:56:47Z", "is_private": false}, {"count": 8, "tags": [], "creator": "lacycb@gmail.com", "attachment_id": null, "is_private": false, "id": 161452, "time": "2012-08-16T00:17:33Z", "bug_id": 53697, "creation_time": "2012-08-16T00:17:33Z", "text": "Testing now, but wanted to give you a quick thanks."}, {"count": 9, "tags": [], "bug_id": 53697, "text": "*** Bug 56201 has been marked as a duplicate of this bug. ***", "id": 173561, "time": "2014-02-28T21:09:48Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-02-28T21:09:48Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "There is a problem with the range flag when trying to access a file located on \nthe second hard disk.\n------\nFor better undersanding i'll explain my configuration (simplified paths) :\n/home/\t\tis my web directory, shared by apache as root\n/home/mir/\tis a mountpoint\n\n/home2/\t\tis my second hard disk\n/home2/a.avi\tis a file i want to share\n/home2/mir/\tis my \"public\" directory on the second hard disk\n\ni'v plugged in my web directory the second disk by doing\nmount --bind /home2/mir/ /home/mir/\n\nthen i've created a hardlink on /home2/mir/b.avi -> /home2/a.avi\nln /home2/a.avi /home2/mir/b.avi\n\nso i can access the \"real\" /home2/a.avi by doing /home/mir/b.avi\n\na.avi size is 735'344'640 bytes, so b.avi has the sams size\n------\nWhen i do the following request\n\nGET /mir/b.avi HTTP/1.1\nHost: server\n\nApache/2.0.46 (Red Hat) replies 200 OK and send the data (no problem)\nThen the problem appears when I want to resume my file\n\nGET /mir/b.avi HTTP/1.1\nHost: server\nRange: bytes=506469-\n\nApache replies 416 Requested Range Not Satisfiable\nInstead of this message it should reply 206 Partial Content\nMaybe there is a problem in the evaluation of the size of an hardlink.\nIf anyone has an idea or can help me in another manner to access AND resume\na file located on a second drive... Thank you very much.", "is_private": false, "bug_id": 29700, "id": 59627, "time": "2004-06-20T19:02:09Z", "creator": "tck@tcknetwork.com", "creation_time": "2004-06-20T19:02:09Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Note : The same bug appears when I try to make a symbolic link from /home/mir \nto /home2/mir. instead of binding the directory with [mount] so I think the \nproblem appears when trying to evaluate the size of the hardlink. But when I \ndo exactely the same (same kind of files, same HTTP request) with a file \nlocated on the primary hard disk it works perfectely.", "is_private": false, "bug_id": 29700, "id": 59633, "time": "2004-06-20T21:18:16Z", "creator": "tck@tcknetwork.com", "creation_time": "2004-06-20T21:18:16Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 29700, "attachment_id": null, "is_private": false, "id": 59634, "time": "2004-06-20T21:28:24Z", "creator": "nd@perlig.de", "creation_time": "2004-06-20T21:28:24Z", "text": "It sounds somehow not like an apache bug.\nYou might wanna try\n\nEnableSendfile Off\nor\nEnableMMap Off\nor both.\n\nDoes it change anything?"}, {"count": 3, "tags": [], "creator": "tck@tcknetwork.com", "attachment_id": null, "is_private": false, "id": 59635, "time": "2004-06-20T21:59:01Z", "bug_id": 29700, "creation_time": "2004-06-20T21:59:01Z", "text": "> It sounds somehow not like an apache bug.\nMaybe a deeper problem in the ext3 or with the ln command I don't know where...\nIn fact I use the link() function in PHP. But when I do [ls -ls] in /home/mir/ \nit gives the right size. What's annoying is that when I use 2 different method \n(mount --bind / symbolic link) to access this file it doesn't work => it seems \nwe can exclude a dir binding problem, and when it works on the first hard \ndisk, it seems we can exclude a hardlink error. So where is the bug ? I have \nto say \"maybe\" in the buffering system. But in that case, why does it works \nwhen we ask for the full file and not when we request a part of it ?\n\n> You might wanna try EnableSendfile Off or EnableMMap Off or both.\n> Does it change anything?\nUnfortunately nothing :("}, {"count": 4, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "id": 59636, "attachment_id": null, "bug_id": 29700, "creation_time": "2004-06-20T22:19:46Z", "time": "2004-06-20T22:19:46Z", "text": "Do you get an error in the error log associated with the request which returns a\n416?"}, {"count": 5, "tags": [], "text": "(meant to add: mentioning \"apr_brigade_partition() failed\" for instance)", "is_private": false, "bug_id": 29700, "id": 59637, "time": "2004-06-20T22:24:10Z", "creator": "jorton@redhat.com", "creation_time": "2004-06-20T22:24:10Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 29700, "is_private": false, "id": 59639, "time": "2004-06-21T00:16:35Z", "creator": "tck@tcknetwork.com", "creation_time": "2004-06-21T00:16:35Z", "tags": [], "text": "> Do you get an error in the error log associated with the request which\n> returns a 416?\n\nSorry but none of the request generated an error. Here are my 'common' error \nmessages :\n\n[warn] child process XXXX still did not exit, sending a SIGTERM\n[notice] caught SIGTERM, shutting down\n[notice] suEXEC mechanism enabled (wrapper: /usr/sbin/suexec)\n[warn] RSA server certificate CommonName (CN) `plesk' does NOT match server \nname!?\n[notice] Apache/2.0.46 (Red Hat) configured -- resuming normal operations\n\nHere is my httpd.conf section about logs\n\nErrorLog logs/error_log\nLogLevel warn\n\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" \ncombined\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %b\" common\nLogFormat \"%{Referer}i -> %U\" referer\nLogFormat \"%{User-agent}i\" agent\n\nCustomLog logs/access_log combined\n\nMaybe the error report is not properly configurated. If you want to catch some \nspecial message please do give me the directives to add to my httpd.conf.\nThanks"}, {"count": 7, "tags": [], "bug_id": 29700, "attachment_id": null, "id": 59652, "time": "2004-06-21T09:28:35Z", "creator": "jorton@redhat.com", "creation_time": "2004-06-21T09:28:35Z", "is_private": false, "text": "Are you testing using a real HTTP client or just using telnet to send the GET?\n\nI did manage to reproduce a 416 response using a variety of\nsymlink/hardlink/mount-bind resources... when accidentally adding a trailing\nspace character to the Range header, e.g.\n\nRange: bytes=1000-<SPACE><CRLF>\n\nnot\n\nRange: bytes=1000-<CRLF>\n\nOtherwise I can't reproduce any 416's."}, {"count": 8, "tags": [], "text": "In fact I built my own software for downloading (win32), so I send 'manually' \n(like in telnet) my request. You were right i didn't put a space after [Range: \nbytes=1000-] but unfortunately your trick didn't solve my problem. If you \nwant, I can send you the url of a file that makes this bug. (Send me directely \na mail) Thank you.", "is_private": false, "bug_id": 29700, "id": 59654, "time": "2004-06-21T10:08:23Z", "creator": "tck@tcknetwork.com", "creation_time": "2004-06-21T10:08:23Z", "attachment_id": null}, {"count": 9, "tags": [], "text": "> In fact I built my own software for downloading (win32)\n\nmight seem to indicate this is some client issue.  But anyway, is this problem\nstill reproducible?", "is_private": false, "bug_id": 29700, "id": 80032, "time": "2005-09-16T09:41:43Z", "creator": "jorton@redhat.com", "creation_time": "2005-09-16T09:41:43Z", "attachment_id": null}, {"count": 10, "tags": [], "text": "Is resolved if we mount the second hard disk using /etc/fstab directly into \nthe final directory (without using mount --bind).\n/dev/hdb1 --> /home/data/\n(don't ask me for how to mount it so, it's not me who did that fix)\nthen i added a .htaccess to disable the sharing\nfinally i made a softlink /home/mir/ --> /home/data/mir/\n\nAnd it works. Certainly some error related with mount --bind...\nUnfortunately the server is no more running so impossible to do more testing :(", "is_private": false, "bug_id": 29700, "id": 80233, "time": "2005-09-20T22:37:40Z", "creator": "tck@tcknetwork.com", "creation_time": "2005-09-20T22:37:40Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 43808, "attachment_id": null, "is_private": false, "id": 110303, "time": "2007-11-07T08:33:55Z", "creator": "alanmurt@yahoo.ie", "creation_time": "2007-11-07T08:33:55Z", "text": "After upgrading FOP from 0.20 to 0.94, I can no longer create valid pdf files \non the fly.\n\nI can create the pdf files in the conventional way OK, after updating the java \ncode as recommended in the upgrade guide and swapping in the new jars into my \napplication.  \n\nThe problem is we also create pdfs on the fly in a servlet. The code works \ndifferently here also (see: \nhttp://xmlgraphics.apache.org/fop/0.94/servlets.html). However, having \nimplemented the changes recommended there exactly, the resulting pdf generated \nis damaged, and will not open. I get the message \"Adobe Reader could not \nopen 'letter.pdf' because it is either not a supported file type or because the \nfile has been damaged.\"\n\nNo other errors or exceptions signalling why the pdf is corrupted.\n\nThe pdf generation works fine every other way, but not through the servlet. \n\nMy code is as follows:\npublic void convert2PDF(File xml, File xsl, \n\tHttpServletResponse response) \n\tthrows IOException, FOPException, TransformerException {\n\t\tFopFactory fopFactory = FopFactory.newInstance();\n\t\tTransformerFactory tFactory = TransformerFactory.newInstance();\n\t\tfopFactory.setStrictValidation(false);\n\t    //Setup a buffer to obtain the content length\n\n\t    ByteArrayOutputStream out = new ByteArrayOutputStream();\n\t\ttry{\n\n\t\t    //Setup FOP\n\t\t    Fop fop = fopFactory.newFop(MimeConstants.MIME_PDF, out);\n\t\n\t\t    //Setup Transformer\n\t\t    Source xsltSrc = new StreamSource(xsl);\n\t\t    Transformer transformer = tFactory.newTransformer(xsltSrc);\n\t\n\t\t    //Make sure the XSL transformation's result is piped \nthrough to FOP\n\t\t    Result res = new SAXResult(fop.getDefaultHandler());\n\t\n\t\t    //Setup input\n\t\t    Source src = new StreamSource(xml);\n\t\t    \n\t\t    //Start the transformation and rendering process\n\t\t    transformer.transform(src, res);\n\t\n\t\t    //Prepare response\n\t\t    response.setContentType(\"application/pdf\");\n\t\t    response.setContentLength(out.size());\n\t\t    response.setHeader(\"Content-Disposition\", \"attachment; \nfilename=Letter.pdf\"); \n\n\t\t    //Send content to Browser\n\t\t    response.getOutputStream().write(out.toByteArray());\n\t\t    response.getOutputStream().flush();\netc...."}, {"count": 1, "text": "No idea. Code looks good. Try writing the byte array to a file besides sending\nit back to the browser. If the written PDF is fine, then it's not something in\nFOP but something between the servlet (or web container) and the browser.\n\nYou can also \"wget\" the PDF from the servlet and check if it's just the browser\nhaving a problem or if it's rather on the web container side.\n\nGood luck.", "creator": "jeremias@apache.org", "is_private": false, "id": 110480, "time": "2007-11-13T08:14:07Z", "bug_id": 43808, "creation_time": "2007-11-13T08:14:07Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "text": "I got the exact same problem with FOP on Linux.\n\nI've done the WGET to the servlet and it resulted in a PDF file of 15 KB (which is 'damaged')\n\nI see this bug is reported in 2007 and has a Prio 1 - Critical importance, when would this be fixed?", "is_private": false, "id": 131454, "creation_time": "2009-10-28T05:42:35Z", "time": "2009-10-28T05:42:35Z", "creator": "gerard@xsarus.nl", "bug_id": 43808, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 43808, "is_private": false, "count": 3, "id": 157253, "time": "2012-04-07T01:26:57Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:26:57Z", "text": "no input FO file or example (problem) PDF file is provided; cannot reproduce problem; suggest reporter re-try on current trunk to verify problem still exists"}, {"count": 4, "tags": [], "creator": "gadams@apache.org", "text": "batch transition resolved+wontfix to closed+wontfix", "id": 158569, "time": "2012-04-30T00:14:51Z", "bug_id": 43808, "creation_time": "2012-04-30T00:14:51Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 43808, "attachment_id": null, "is_private": false, "id": 158614, "time": "2012-04-30T00:17:18Z", "creator": "gadams@apache.org", "creation_time": "2012-04-30T00:17:18Z", "text": "batch transition resolved+wontfix to closed+wontfix; if you believe this remains a bug and can demonstrate it with appropriate input FO file and output PDF file (as applicable), then you may reopen"}]
[{"text": "I'm trying to run hudson (tried with 1.361 and 1.352) on tomcat 7.0.0 rc4.\n\nI'm deploying it by putting the following hudson.xml file (it works with tomcat-6.0.26):\n\n# cat /etc/tomcat/Catalina/localhost/hudson.xml                                                     \n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!-- $Id: hudson-context.xml,v 1.2 2009/02/01 23:26:40 pawelz Exp $ -->\n<Context path=\"/hudson\" docBase=\"/usr/share/hudson\"\n        privileged=\"false\" allowLinking=\"true\">\n\n</Context>\n\ninto Catalina/localhost directory. I have also tried to deploy .war file directly via web interface, with no luck.\n\nAfter deploying tomcat, manager says: \u2018OK - Started application at context path /hudson\u2019, but when I navigate to /hudson/, I'm getting e404', but when I navigate to /hudson/, I get HTTP 404 NOT FOUND error. There are no errors/exceptions in catalina log. Other applications work correctly (nexus, JIRA).\n\nI don't know whether it is bug in tomcat or in nexus, so I've also filed a bug report in hudson JIRA: http://issues.hudson-ci.org/browse/HUDSON-6738\n\nMy environment is:\n  PLD Linux th\n  tomcat 7.0.0 rc4\n  icedtea6 1.8 (also tried with java-sun-1.6.0.20 with no luck)\n\nPlease let me know if I can provide you with more details/information.", "tags": [], "bug_id": 49422, "is_private": false, "count": 0, "id": 137538, "time": "2010-06-10T08:18:58Z", "creator": "pawelz@pld-linux.org", "creation_time": "2010-06-10T08:18:58Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 49422, "is_private": false, "text": "(In reply to comment #0)\n> I don't know whether it is bug in tomcat or in nexus, so I've also filed a bug\nI meant \u2018hudson\u2019, not \u2018nexus\u2019 of course.", "id": 137539, "time": "2010-06-10T08:26:37Z", "creator": "pawelz@pld-linux.org", "creation_time": "2010-06-10T08:26:37Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 49422, "attachment_id": null, "text": "There are comments of HUDSON developers, they asked me to paste them here. I hope they will be helpful in tracking the problem:\n\n=============================\n\nmindless added a comment - 11/Jun/10 01:09 PM\n\nThere may be crazy parts of Hudson bootstrapping  but I don't think this part is crazy. war/resources/WEB-INF/web.xml is pretty basic, with:\n\n<servlet-mapping>\n    <servlet-name>Stapler</servlet-name>\n    <url-pattern>/</url-pattern>\n</servlet-mapping>\n\nwhich should map everything to stapler for handling..\n\n=============================\n\njieryn added a comment - 11/Jun/10 01:36 PM\n\nChange this to\n\n<servlet-mapping>\n  <servlet-name>Stapler</servlet-name>\n  <url-pattern>/*</url-pattern>\n</servlet-mapping>\n\nand it will work. I tested this and things appear to be working sanely now.", "id": 137585, "time": "2010-06-11T16:42:26Z", "creator": "pawelz@pld-linux.org", "creation_time": "2010-06-11T16:42:26Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 49422, "text": "This was triggered by fixing bug47378 which implemented a spec mandated requirement for welcome file mapping. This has its issues - see that bug report and the linked Jetty discussion for details.\n\nThe upshot is that welcome files are inherited from Tomcat's default web.xml and include index.jsp. Tomcat is (correctly as per the spec) matching the index.jsp welcome file to the JSP servlet which in turn is returning a 404 to the user since index.jsp doesn't exist.\n\nI have doubled checked the Servlet 3.0 spec wording on welcome files and I believe Tomcat is spec complaint here.\n\nI hate to bounce this one back to Hudson, but I think fixing this is going to require a change to Hudson. The simplest change is to switch the mapping to \"/*\" rather than \"/\". This effectively bypasses the welcome file process and ensures *all* requests are mapped to the desired servlet.\n\nAlternative options include:\n- requiring users to remove any global welcome files\n- setting an empty set of welcome files in Hudson's web.xml\n\nSince the desired behaviour is to map everything to the Stapler servlet and not use use welcome files then I would recommend switching to a mapping of \"/*\" since that will always bypass any welcome file settings as is desired in this case.\n\nI am closing this as invalid since Tomcat is implementing the spec correctly here.", "id": 137633, "time": "2010-06-14T14:47:38Z", "creator": "markt@apache.org", "creation_time": "2010-06-14T14:47:38Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 49422, "is_private": false, "id": 138623, "attachment_id": null, "creator": "kk@kohsuke.org", "creation_time": "2010-07-21T22:16:42Z", "time": "2010-07-21T22:16:42Z", "text": "I'm the developer of Hudson, and I'm not sure if I agree with the conclusion.\n\nIn the servlet 3.0 spec section 10.10, one of the examples reads:\n\n  A request URI of /catalog/products/ will be passed to the \"default\" servlet,\n  if any. If no \"default\" servlet is mapped, the request may cause a 404 not \n  found, may cause a directory listing including shop.jsp and register.jsp, or\n  may cause other behavior defined by the container. See Section 12.2, \n  \"Specification of Mappings\" for the definition of \"default\" servlet.\n\nThis is with the following contents in the WAR:\n\n  /foo/index.html\n  /foo/default.jsp\n  /foo/orderform.html\n  /foo/home.gif\n  /catalog/default.jsp\n  /catalog/products/shop.jsp\n  /catalog/products/register.jsp\n\nThe \"default\" servlet defined in section 12.2 is the servlet with url-pattern=\"/\", which in our case is \"Stapler\".\n\nIn Hudson, we don't have /index.html nor /index.jsp. So I expect the same logic to dispatch the request to the default servlet, instead of 404.\n\nTo put this another way, while the section 10.10 says the following, it shouldn't be interpreted that the container can really do whatever it wants --- otherwise it doesn't explain why the above /catalog/products/ would map to the default servlet. It should be interpreted that the default servlet be consulted:\n\n  If no matching welcome file is found in the manner described, the container may\n  handle the request in a manner it finds suitable. For some configurations this may\n  mean returning a directory listing or for others returning a 404 response."}, {"count": 5, "tags": [], "bug_id": 49422, "text": "Mark is correct with his reading of the Servlet 3.0 spec.  The default web.xml includes \"index.jsp\" in the welcome-file list.  This pattern is also mapped to the JspServlet.  As a result, Tomcat is required to pass the request to JspServlet by the spec.  The Tomcat developers have a long history of resisting this change to the spec, but it is there now, and Tomcat has to follow it. \n\nOther than what Mark has suggested above, another possibility is for Hudson to include a welcome-file in their web.xml for, say, index.hds, which is suffix mapped to their default servlet.", "id": 138625, "time": "2010-07-21T23:19:19Z", "creator": "billbarker@apache.org", "creation_time": "2010-07-21T23:19:19Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "*** Bug 50073 has been marked as a duplicate of this bug. ***", "attachment_id": null, "bug_id": 49422, "id": 140659, "time": "2010-10-11T06:37:06Z", "creator": "markt@apache.org", "creation_time": "2010-10-11T06:37:06Z", "is_private": false}, {"count": 7, "attachment_id": null, "bug_id": 49422, "text": "*** Bug 50161 has been marked as a duplicate of this bug. ***", "id": 141101, "time": "2010-10-27T11:32:43Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-10-27T11:32:43Z", "tags": [], "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 49422, "text": "The new Servlet 3.0 requirements have caused a number of issues. As of Tomcat 7.0.5 a new context option is available \"resourceOnlyServlets\" that can be used to list Servlets that expect physical resources to exist. By default the JSP Servlet is included in this list that should restore 7.0.5+ to the current 6.0.x behaviour regarding welcome files.", "id": 141138, "time": "2010-10-28T18:32:17Z", "creator": "markt@apache.org", "creation_time": "2010-10-28T18:32:17Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "bug_id": 49422, "attachment_id": null, "text": "Changed the resolution from INVALID to FIXED since there was an actual change to the code to change the behavior.", "id": 141288, "time": "2010-10-31T17:38:26Z", "creator": "slaurent@apache.org", "creation_time": "2010-10-31T17:38:26Z", "is_private": false}]
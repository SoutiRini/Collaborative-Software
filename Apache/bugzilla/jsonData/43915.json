[{"count": 0, "tags": [], "creator": "rfrovarp@apache.org", "attachment_id": null, "text": "One of my testers has found an easy way to escalate rights in Lenya. If someone\nhas admin rights to a subtree, they can use these rights to gain full access to\nthe admin tab. This is not desirable as one would grant admin on a subtree so\nthat the sub-admin can administer rights on that subtree.\n\nTo replicate:\nLogin as lenya\nGrant editor group admin to editors under AC Auth from index\nLogout\nLogin as alice\nGoto admin tab\nCreate users\nGo back to site\nChange to sibling of index/home\nGo back to admin, you will now be blocked (so long as you didn't add alice to\nadmin group, which you easily could have).", "id": 110860, "time": "2007-11-20T09:08:05Z", "bug_id": 43915, "creation_time": "2007-11-20T09:08:05Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 43915, "text": "It would appear that the problem is admin is typically under the authoring\nsubtree. There is an admin subtree-policy.acml, however the URL is never\nswitched over to that area. Manually switching authoring to admin does work,\nhowever the authoring tab changes name to admin and the site tab stays in the\nadmin area as well. ", "id": 110861, "time": "2007-11-20T09:11:25Z", "creator": "rfrovarp@apache.org", "creation_time": "2007-11-20T09:11:25Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "text": "Strange, why isn't this blocked by the usecase policies? The per-URL protection\nof the admin area is obsolete. Actually there should be no admin area anymore.", "id": 110863, "time": "2007-11-20T09:20:29Z", "bug_id": 43915, "creation_time": "2007-11-20T09:20:29Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43915, "is_private": false, "text": "(In reply to comment #2)\n> Strange, why isn't this blocked by the usecase policies? The per-URL protection\n> of the admin area is obsolete. Actually there should be no admin area anymore.\n\nWell, this method is granting a group a role of admin,and usecase policies only\nlooks at roles, not groups.", "id": 110864, "time": "2007-11-20T09:23:17Z", "creator": "rfrovarp@apache.org", "creation_time": "2007-11-20T09:23:17Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 43915, "is_private": false, "text": "(In reply to comment #2)\n> Strange, why isn't this blocked by the usecase policies? The per-URL protection\n> of the admin area is obsolete. Actually there should be no admin area anymore.\n\nAh, of course, if the PolicyManager grants the roles, the usecase policies are\ncomplied.(In reply to comment #3)\n> (In reply to comment #2)\n> > Strange, why isn't this blocked by the usecase policies? The per-URL protection\n> > of the admin area is obsolete. Actually there should be no admin area anymore.\n> \n> Well, this method is granting a group a role of admin,and usecase policies only\n> looks at roles, not groups.\n\nOf course, sorry for my stupid remark :)\n\n", "id": 110865, "time": "2007-11-20T09:26:16Z", "creator": "andreas@apache.org", "creation_time": "2007-11-20T09:26:16Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 43915, "text": "(In reply to comment #0)\n> One of my testers has found an easy way to escalate rights in Lenya. If someone\n> has admin rights to a subtree, they can use these rights to gain full access to\n> the admin tab. This is not desirable as one would grant admin on a subtree so\n> that the sub-admin can administer rights on that subtree.\n\nIMO this would mean that we need two \"administrator\" roles:\n\n- a website administrator who is allowed to grant/deny roles etc.\n- an application administrator who is allowed to execute the admin.* usecases", "id": 110866, "time": "2007-11-20T09:30:30Z", "creator": "andreas@apache.org", "creation_time": "2007-11-20T09:30:30Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 43915, "attachment_id": null, "text": "(In reply to comment #5)\n>\n> \n> IMO this would mean that we need two \"administrator\" roles:\n> \n> - a website administrator who is allowed to grant/deny roles etc.\n> - an application administrator who is allowed to execute the admin.* usecases\n\nThat could work. We obviously wouldn't want to give editors the rights to\ntab.ac*. And giving reviewers the rights doesn't make sense either. So it would\nappear that we do need another role. ", "id": 110875, "time": "2007-11-20T09:42:53Z", "creator": "rfrovarp@apache.org", "creation_time": "2007-11-20T09:42:53Z", "is_private": false}, {"count": 7, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "text": "(In reply to comment #6)\n> (In reply to comment #5)\n> >\n> > \n> > IMO this would mean that we need two \"administrator\" roles:\n> > \n> > - a website administrator who is allowed to grant/deny roles etc.\n> > - an application administrator who is allowed to execute the admin.* usecases\n> \n> That could work. We obviously wouldn't want to give editors the rights to\n> tab.ac*. And giving reviewers the rights doesn't make sense either. So it would\n> appear that we do need another role. \n\nI'm working on it.\n\n", "id": 110909, "time": "2007-11-21T03:08:05Z", "bug_id": 43915, "creation_time": "2007-11-21T03:08:05Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 43915, "text": "I introduced a method Role.isAssignable() and a role \"sitemanager\" with a group\nof the same name. All users have to update their policies accordingly.\n\nPlease test and re-open if this doesn't resolve the issue. TIA!", "id": 110910, "time": "2007-11-21T03:17:40Z", "creator": "andreas@apache.org", "creation_time": "2007-11-21T03:17:40Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 43915, "text": "I forgot to check for URL manipulation attacks.", "id": 110912, "time": "2007-11-21T03:20:30Z", "creator": "andreas@apache.org", "creation_time": "2007-11-21T03:20:30Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "text": "OK, now it should really be fixed.", "id": 110916, "time": "2007-11-21T05:04:58Z", "bug_id": 43915, "creation_time": "2007-11-21T05:04:58Z", "is_private": false}]
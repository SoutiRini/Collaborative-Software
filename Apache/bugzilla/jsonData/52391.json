[{"count": 0, "tags": [], "bug_id": 52391, "is_private": false, "text": "Dear,\n\nAt a certain point in time, httpd.exe starts using 100% cpu (one thread, so 12,5% on my 8-core machine). Over time, this shifts to 25%, 37,5%, 50% and higher, so I restart the service. I started noticing it since version 2.2.17.\n\nThe configuration file httpd.conf is the standard one with the following additions:\n\n#Begin custom modules SVB\n\nLoadModule cache_module modules/mod_cache.so\nLoadModule disk_cache_module modules/mod_disk_cache.so\n\nLoadModule proxy_module modules/mod_proxy.so\nLoadModule proxy_ajp_module modules/mod_proxy_ajp.so\nLoadModule proxy_balancer_module modules/mod_proxy_balancer.so\nLoadModule proxy_connect_module modules/mod_proxy_connect.so\nLoadModule proxy_ftp_module modules/mod_proxy_ftp.so\nLoadModule proxy_http_module modules/mod_proxy_http.so\nLoadModule proxy_scgi_module modules/mod_proxy_scgi.so\n\n#End custom modules SVB\n\n#Begin custom settings SVB\n\n<IfModule mod_cache.c>\n\t<IfModule mod_disk_cache.c>\n\t\tCacheDirLength 1\n\t\tCacheDirLevels 2\n\t\tCacheMaxFileSize 1000000000\n\t\tCacheMinFileSize 1\n\t\tCacheRoot T:\\Apache\\HTTPD\\CacheRoot\n\t\tCacheEnable disk /\n\t</IfModule>\n</IfModule>\n\nProxyRequests On\nProxyVia On\n\n<Proxy *>\n\tOrder deny,allow\n\tDeny from all\n\tAllow from 192.168.1\n</Proxy>\n\n#End custom settings SVB\n\nCan I help you by adding a memory dump file and some log files?\n\nKind regards,\n\nSam", "id": 152426, "time": "2011-12-27T19:07:14Z", "creator": "sam.vanbrussel@linqed.be", "creation_time": "2011-12-27T19:07:14Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "First, begin by setting both EnableSendfile / EnableMMAP off - and then also\ntry DisableWin32AcceptEx.\n\nIt's important to eliminate these optimizations to be sure it doesn't have\nsomething to do with your network driver stack.", "attachment_id": null, "id": 152432, "creator": "wrowe@apache.org", "time": "2011-12-27T22:55:58Z", "bug_id": 52391, "creation_time": "2011-12-27T22:55:58Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 52391, "attachment_id": null, "id": 152471, "time": "2011-12-29T23:10:48Z", "creator": "sam.vanbrussel@linqed.be", "creation_time": "2011-12-29T23:10:48Z", "is_private": false, "text": "Dear,\n\nI've uncommented the EnableMMAP and EnableSendfile lines in the httpd.conf file\n\n#\n# EnableMMAP and EnableSendfile: On systems that support it, \n# memory-mapping or the sendfile syscall is used to deliver\n# files.  This usually improves server performance, but must\n# be turned off when serving from networked-mounted \n# filesystems or if support for these functions is otherwise\n# broken on your system.\n#\nEnableMMAP off\nEnableSendfile off\n\nI'll re-evaluate the new configuration. I couldn't find much documentation about the DisableWin32AcceptEx and haven't applied it yet.\n\nKind regards,\n\nSam"}, {"count": 3, "tags": [], "bug_id": 52391, "attachment_id": null, "is_private": false, "id": 152472, "time": "2011-12-30T08:57:02Z", "creator": "sam.vanbrussel@linqed.be", "creation_time": "2011-12-30T08:57:02Z", "text": "The issue seems to occur a lot less. Before your fix, it was pretty easy to get load on the httpd.exe process and even move to 100% CPU (one idle httpd.exe and one httpd.exe that moves all cores to 100%). After your fix, I've only got a single spike to 12,5%.\n\nI even noted something interesting: as soon as I closed my browser, httpd.exe went completely idle.\n\nI use Firefox and enable the pipeline settings (I'm doing that for years).\n\nnetwork.http.pipelining;true\nnetwork.http.pipelining.maxrequests;8\nnetwork.http.pipelining.ssl;true\nnetwork.http.proxy.pipelining;true\n\nCould it be that Firefox overloads Apache?\n\nKind regards,\n\nSam"}, {"count": 4, "tags": [], "bug_id": 52391, "attachment_id": null, "is_private": false, "id": 190997, "time": "2016-05-16T15:16:24Z", "creator": "covener@gmail.com", "creation_time": "2016-05-16T15:16:24Z", "text": "Last update 4.5 years ago"}]
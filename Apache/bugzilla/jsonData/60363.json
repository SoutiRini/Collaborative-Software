[{"count": 0, "tags": [], "text": "To create a password protected workbook using Encryptor, an instance of POIFSFileSystem is required to create the encrypted data stream. There is no XSSF implementation of POIFSFileSystem and the encryption is therefore not possible. The following example illustrates the problem, an exception occures in the line where the POIFSFileSystem is created.\n\n public static void main(String[] args)\n    {\n        try(Workbook wb = new XSSFWorkbook())\n        {\n            Sheet sheet = wb.createSheet();\n            Row r = sheet.createRow(0);\n            Cell cell = r.createCell(0);\n            cell.setCellType(Cell.CELL_TYPE_STRING);\n            cell.setCellValue(\"Test\");\n            try(ByteArrayOutputStream baos = new ByteArrayOutputStream())\n            {\n                wb.write(baos);\n                byte[] res = baos.toByteArray();\n                try(ByteArrayInputStream bais = new ByteArrayInputStream(res))\n                {\n                    try(POIFSFileSystem fileSystem = new POIFSFileSystem(bais);) // Exception here\n                    {\n                        EncryptionInfo info = new EncryptionInfo(EncryptionMode.agile);\n                        Encryptor enc = info.getEncryptor();\n                        enc.confirmPassword(\"pass\");\n                        OutputStream encryptedDS = enc.getDataStream(fileSystem);\n                        OPCPackage opc = OPCPackage.open(new File(\"example.xlsx\"), PackageAccess.READ_WRITE);\n                        opc.save(encryptedDS);\n                        opc.close();\n                    }\n                }\n            }\n        }\n        catch(Exception e)\n        {\n            e.printStackTrace();\n        }\n    }", "attachment_id": null, "bug_id": 60363, "id": 194924, "time": "2016-11-11T10:05:42Z", "creator": "smear1@gmx.de", "creation_time": "2016-11-11T10:05:42Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 60363, "text": "Please note: There is no example.xlsx, but this line is not reached anyway.", "count": 1, "id": 194925, "time": "2016-11-11T10:07:27Z", "creator": "smear1@gmx.de", "creation_time": "2016-11-11T10:07:27Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 60363, "text": "You don't open the POIFS with the document to be encrypted, you start with a new empty one and populate it. Working code shown at https://poi.apache.org/encryption.html#XML-based+formats+-+Encryption", "id": 194926, "time": "2016-11-11T10:11:25Z", "creator": "apache@gagravarr.org", "creation_time": "2016-11-11T10:11:25Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "smear1@gmx.de", "text": "Thank you very much for you help and sorry for the unnecessary ticket!", "id": 194928, "time": "2016-11-11T14:05:05Z", "bug_id": 60363, "creation_time": "2016-11-11T14:05:05Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 56568, "attachment_id": null, "text": "Since JSP 2.3 (Tomcat 8) only supported method for JSP is GET POST or HEAD:\n\nhttps://jcp.org/aboutJava/communityprocess/maintenance/jsr245/245-MR3.html http://svn.apache.org/viewvc/tomcat/trunk/java/org/apache/jasper/servlet/JspServlet.java?view=diff&r1=1497877&r2=1497878&pathrev=1497878\n\nBut, I suppose, it is a big incompatible change as, for example, for exception handler it is used to forward to JSP for rendering exception and iso JSP view since JSP 2.3 response is:\n\nMethod Not Allowed\nHTTP Status 405 - JSPs only permit GET POST or HEAD \n\ndescription The specified HTTP method is not allowed for the requested resource.\nApache Tomcat/8.0.3\n\nIf we use REST and Spring HandlerExceptionResolver in case of exception we bump into this problem for sure. Are there any workaround for this problem (iso change http method type)?\n\n\nhttp://stackoverflow.com/questions/23886941/http-status-405-jsps-only-permit-get-post-or-head", "id": 175494, "time": "2014-05-27T10:28:42Z", "creator": "gkislin@yandex.ru", "creation_time": "2014-05-27T10:28:42Z", "is_private": false}, {"count": 1, "tags": [], "text": "http://stackoverflow.com/questions/23886941/http-status-405-jsps-only-permit-get-post-or-head", "attachment_id": null, "id": 175495, "creator": "gkislin@yandex.ru", "time": "2014-05-27T10:29:19Z", "bug_id": 56568, "creation_time": "2014-05-27T10:29:19Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 56568, "text": "My original proposal [1] included a page directive to make this configurable. That part was rejected.\n\nOptions at this point:\n1. Go ahead and add the page directive anyway \n2. Add an init param to the JSP Servlet to control the default methods supported\n3. Check the method via an over-ridable method that could be over-riden by invididual JSPs.\n4. Do 2 & 3.\n5. Skip the method check if the JSP is an error page.\n\nI stil think that the page directive is the way to handle this but I'd really like to do that with support from the JSP EG. Is 5 a sufficient solution for now? Can you think of any other use cases that might break because of this change?\n\n[1] https://java.net/jira/browse/JSP-33", "id": 175511, "time": "2014-05-27T22:11:06Z", "creator": "markt@apache.org", "creation_time": "2014-05-27T22:11:06Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 56568, "attachment_id": null, "is_private": false, "id": 175512, "time": "2014-05-27T23:13:36Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-05-27T23:13:36Z", "text": "The specification requirement is not to reject, but to provide \"undefined behaviour\". The rejection behaviour is a security hardening.\n\n(In reply to Mark Thomas from comment #2)\n\n> 3. Check the method via an over-ridable method that could be over-riden\n> by invididual JSPs.\n\nI think implementing \"3.\" means that the check is moved from org.apache.jasper.servlet.JspServlet#service(...)\ninto \norg.apache.jasper.runtime.HttpJspBase#service(...)\n\nIn this case there may be an alternative base class e.g. \"AnyMethodHttpJspBase\" and the JSP pages may be patched to use\n<%page extends=\"o.a.j.runtime.AnyMethodHttpJspBase\" %>\n\nThis strikes me as ugly / hacky.\n\n> 2. Add an init param to the JSP Servlet to control the default methods supported\n\nMaybe. As a regexp?"}, {"count": 4, "tags": [], "bug_id": 56568, "attachment_id": null, "is_private": false, "id": 175673, "time": "2014-06-05T14:18:36Z", "creator": "markt@apache.org", "creation_time": "2014-06-05T14:18:36Z", "text": "I'm leaning towards 5. but remain tempted by 1."}, {"count": 5, "tags": [], "text": "The \"5.\" means a JSP page that is served with ServletRequest.getDispatcherType() == DispatcherType.ERROR ?\n\nThere is also an option to interpret that as <%@page isErrorPage=\"true\"%>.", "attachment_id": null, "id": 175674, "creator": "knst.kolinko@gmail.com", "time": "2014-06-05T14:26:36Z", "bug_id": 56568, "creation_time": "2014-06-05T14:26:36Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 56568, "attachment_id": null, "text": "(In reply to Konstantin Kolinko from comment #5)\n> The \"5.\" means a JSP page that is served with\n> ServletRequest.getDispatcherType() == DispatcherType.ERROR ?\n\nThis looks to be the easiest solution.\n\nMark", "id": 175676, "time": "2014-06-05T14:55:11Z", "creator": "markt@apache.org", "creation_time": "2014-06-05T14:55:11Z", "is_private": false}, {"count": 7, "tags": [], "text": "(In reply to Mark Thomas from comment #6)\n\nOK.\nMaybe also allow for DispatcherType.INCLUDE ?\n\nIf I remember correctly, Spring (as an example of an MVC framework) allows to switch view rendering from one using forward to one using include with a single boolean option. If it is an INCLUDE it means that the request has already been handled somehow, so it is likely safe for the JSP page to handle it.", "attachment_id": null, "id": 175680, "creator": "knst.kolinko@gmail.com", "time": "2014-06-05T15:27:25Z", "bug_id": 56568, "creation_time": "2014-06-05T15:27:25Z", "is_private": false}, {"count": 8, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "This specific issue (JSPs and error pages) has been fixed in 8.0.x for 8.0.9 onwards. The broader problem is still with the JSP EG.", "id": 175681, "time": "2014-06-05T15:28:29Z", "bug_id": 56568, "creation_time": "2014-06-05T15:28:29Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 56568, "attachment_id": null, "text": "(In reply to Konstantin Kolinko from comment #7)\n> (In reply to Mark Thomas from comment #6)\n> \n> OK.\n> Maybe also allow for DispatcherType.INCLUDE ?\n> \n> If I remember correctly, Spring (as an example of an MVC framework) allows\n> to switch view rendering from one using forward to one using include with a\n> single boolean option. If it is an INCLUDE it means that the request has\n> already been handled somehow, so it is likely safe for the JSP page to\n> handle it.\n\nHmm. Not sure. Let's wait and see if anyone hits this issue before the EG makes a decision. The Spring developers and I share an employer so if there were issues here I'd have expected to have been asked to fix them by now.", "id": 175682, "time": "2014-06-05T15:31:41Z", "creator": "markt@apache.org", "creation_time": "2014-06-05T15:31:41Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 56568, "attachment_id": null, "is_private": false, "id": 175740, "time": "2014-06-09T13:05:36Z", "creator": "gkislin@yandex.ru", "creation_time": "2014-06-09T13:05:36Z", "text": "Hello.\nVote for 5.) easiest solution.\nI suppose this incompatibility prevent from switch to Tomcat 8 and need be fixed asap. Afterwards it could be expand for possible other cases."}, {"count": 11, "tags": [], "bug_id": 56568, "attachment_id": null, "is_private": false, "id": 175741, "time": "2014-06-09T13:11:00Z", "creator": "markt@apache.org", "creation_time": "2014-06-09T13:11:00Z", "text": "Restore the status to FIXED."}, {"count": 12, "tags": [], "bug_id": 56568, "attachment_id": null, "is_private": false, "id": 176334, "time": "2014-07-10T18:11:52Z", "creator": "gkislin@yandex.ru", "creation_time": "2014-07-10T18:11:52Z", "text": "UPDATE: As of Tomcat 8.0.9 when a JSP is used to generate an error page, any HTTP method will be allowed.\nGood news, thanks!"}, {"count": 13, "tags": [], "bug_id": 56568, "attachment_id": null, "is_private": false, "id": 176542, "time": "2014-07-20T15:26:33Z", "creator": "gkislin@yandex.ru", "creation_time": "2014-07-20T15:26:33Z", "text": "Hello Mark.\nSorry for late question: I only now install Tomcat 8.09 I try my case: redirect via org.springframework.web.servlet.handler.AbstractHandlerExceptionResolver implementation to exception.jsp with HTTP DELETE.\n\nIn case of \nresponse.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\njsp is ignored.\n\nSet <%@page isErrorPage=\"true\"%> inside jsp doesn't help from\n\nMethod Not Allowed\nHTTP Status 405 - JSPs only permit GET POST or HEAD\n\nHow can tell Tomcat that treat this jsp as error page?"}, {"count": 14, "tags": [], "bug_id": 56568, "attachment_id": null, "text": "Hello.\nI use Tomcat 8.09 and redirect DELETE to JSP (via Spring @ExceptionHandler)\n\nJSP header:\n\n<%@page isErrorPage=\"true\" contentType=\"application/json\" pageEncoding=\"UTF-8\" %>\n\nResult is HTTP Status 405 - JSPs only permit GET POST or HEAD", "id": 177266, "time": "2014-08-19T11:51:47Z", "creator": "gkislin@yandex.ru", "creation_time": "2014-08-19T11:51:47Z", "is_private": false}, {"count": 15, "tags": [], "text": "I've added an additional check for isErrorPage. Will be in 8.0.12 onwards.", "attachment_id": null, "id": 177379, "creator": "markt@apache.org", "time": "2014-08-26T14:31:41Z", "bug_id": 56568, "creation_time": "2014-08-26T14:31:41Z", "is_private": false}]
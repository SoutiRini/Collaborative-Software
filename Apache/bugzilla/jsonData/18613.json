[{"count": 0, "tags": [], "bug_id": 18613, "attachment_id": null, "id": 34346, "time": "2003-04-02T15:18:05Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-04-02T15:18:05Z", "is_private": false, "text": "For an object to interact with ant, it needs to have an project\nobject. This is implemented by ant calling setproject on the\nobject soon after creating it. The current mechanism is not\nwide enough:\n\n   1) task objects that do not extend task that have\n      a setProject method, the setProject method gets\n      called after all the other sets, adds and creates are\n      called (example the Condition task)\n   2) data objects created by project and by introspection\n      helper need to extend ProjectComponent to have setProject\n      called. As ProjectComponent is a class and not an interface\n      this percludes extending other classes\n   3) custom mappers, selectors and filters do not set the project\n      (or only if the object is a ProjectComponent)\n   4) general objects created by introspection helper do not set the\n      object if the object does not extend ProjectComponent.\n\nI have made a patch that sets the project for these cases.\nThe changes are:\n\nsrc/main/org/apache/tools/ant/Project.java\n   * add a new static method setProjectOnObject(project, object)\n     this checks to see if the object has a setProject(Project) method\n     and if so calls it.\n   * call setProjectOnObject when creating a task\n   * call setProjectOnObject when creating a dataobject\n\nsrc/main/org/apache/tools/ant/ComponentHelper.java\n   * call setProjectOnObject when creating a task\n   * call setProjectOnObject when creating a dataobject\n  \nsrc/main/org/apache/tools/ant/IntrospectionHelper.java\n   * call setProjectOnObject instead of ProjectComponent#setProject()\nsrc/main/org/apache/tools/ant/Main.java\n   * call set projectOnObject for listeners and inputhandlers\nsrc/main/org/apache/tools/ant/filters/util/ChainReaderHelper.java\n   * call setProjectOnObject for filterreaders instead of\n     ProjectComponent#setProject()\nsrc/main/org/apache/tools/ant/types/Mapper.java\n   * call setProjectOnObject for created mapper objects\nsrc/main/org/apache/tools/ant/types/selectors/ExtendSelector.java\n   * call setProjectOnObject for created dynamic selector objects\n     (see bugzilla: 18563)\n\nI have ran into this problem a number of times :- when adding custom conditions\n(bugzilla: 17199) and when adding tokenfilter (bugzilla: 18312). This\npatch superceeds their changes to TaskAdapter and UnknownElement."}, {"count": 1, "tags": [], "bug_id": 18613, "attachment_id": 5607, "id": 34347, "time": "2003-04-02T15:19:23Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-04-02T15:19:23Z", "is_private": false, "text": "Created attachment 5607\ncvs -u on the files modified"}, {"count": 2, "tags": [], "bug_id": 18613, "text": "On reviewing the patch I found the following issues:\n\n1) if the object that setproject is called on is not a public scoped object\n   but does contain a public setproject method, the setproject method\n   method is not found by getmethod. To work around this, the\n   Project.setProjectOnObject() method now checks it the object extends\n   ProjectComponent and if so calls setProject on a casted object - this\n   should make the code functionally backward compatible\n\n2) The same issue occuried in ChainReaderHelper. Also in this class, the\n   setProject needs to be called in more places so a new private method\n   method was added. Also I removed a needless check on the type of\n   object in the filterchain being a Reader and ChainableReader, the\n   code uses the object as a factory to create a reader.\n\nA new patch follows...\n", "id": 34453, "time": "2003-04-03T17:28:05Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-04-03T17:28:05Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "peter.reilly@corvil.com", "attachment_id": 5628, "text": "Created attachment 5628\nUpdated patch", "id": 34455, "time": "2003-04-03T17:30:21Z", "bug_id": 18613, "creation_time": "2003-04-03T17:30:21Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 18613, "attachment_id": null, "id": 35130, "time": "2003-04-14T17:24:29Z", "creator": "umagesh@apache.org", "creation_time": "2003-04-14T17:24:29Z", "is_private": false, "text": "Patched CVS Head - Thanks!"}, {"count": 5, "tags": [], "text": "*** Bug 18563 has been marked as a duplicate of this bug. ***", "is_private": false, "id": 42458, "creator": "conor@apache.org", "time": "2003-08-09T11:44:51Z", "bug_id": 18613, "creation_time": "2003-08-09T11:44:51Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 50334, "text": "When compiling using :\n\n../httpd-2.2.17/configure \\\n    --prefix=/path/to/install/dir \\\n    --enable-proxy \\\n    --enable-proxy-connect \\\n    --enable-proxy-ftp \\\n    --enable-proxy-http \\\n    --enable-ssl \\\n    --with-ssl=/path/to/openssl\n\nThe compilation fails because somewhere libs '-lrt-lcrypt' is added to the EXTRA_LIBS variable (rather than '-lrt -lcrypt'). This causes the following message :\n\n--------------\n/bin/bash /root/src/httpd-2.2.17-build/srclib/apr/libtool --silent --mode=link  gcc -pthread   -DHAVE_CONFIG_H -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE   -I./include -I/root/src/httpd-2.2.17/srclib/apr/include/arch/unix -I./include/arch/unix -I/root/src/httpd-2.2.17/srclib/apr/include/arch/unix -I/root/src/httpd-2.2.17/srclib/apr/include  -version-info 4:2:4    -o libapr-1.la -rpath /usr/local/simpl/apache/2.2.17/lib passwd/apr_getpass.lo strings/apr_cpystrn.lo strings/apr_strtok.lo strings/apr_snprintf.lo strings/apr_strnatcmp.lo strings/apr_fnmatch.lo strings/apr_strings.lo tables/apr_tables.lo tables/apr_hash.lo dso/unix/dso.lo file_io/unix/mktemp.lo file_io/unix/seek.lo file_io/unix/copy.lo file_io/unix/filedup.lo file_io/unix/dir.lo file_io/unix/flock.lo file_io/unix/buffer.lo file_io/unix/filepath_util.lo file_io/unix/readwrite.lo file_io/unix/open.lo file_io/unix/fileacc.lo file_io/unix/tempdir.lo file_io/unix/pipe.lo file_io/unix/filepath.lo file_io/unix/filestat.lo file_io/unix/fullrw.lo locks/unix/thread_rwlock.lo locks/unix/thread_mutex.lo locks/unix/global_mutex.lo locks/unix/proc_mutex.lo locks/unix/thread_cond.lo memory/unix/apr_pools.lo misc/unix/rand.lo misc/unix/start.lo misc/unix/otherchild.lo misc/unix/getopt.lo misc/unix/env.lo misc/unix/version.lo misc/unix/charset.lo misc/unix/errorcodes.lo mmap/unix/common.lo mmap/unix/mmap.lo network_io/unix/socket_util.lo network_io/unix/inet_ntop.lo network_io/unix/inet_pton.lo network_io/unix/sockets.lo network_io/unix/sockaddr.lo network_io/unix/multicast.lo network_io/unix/sockopt.lo network_io/unix/sendrecv.lo poll/unix/pollcb.lo poll/unix/port.lo poll/unix/select.lo poll/unix/epoll.lo poll/unix/pollset.lo poll/unix/kqueue.lo poll/unix/poll.lo random/unix/apr_random.lo random/unix/sha2.lo random/unix/sha2_glue.lo shmem/unix/shm.lo support/unix/waitio.lo threadproc/unix/procsup.lo threadproc/unix/threadpriv.lo threadproc/unix/proc.lo threadproc/unix/thread.lo threadproc/unix/signals.lo time/unix/timestr.lo time/unix/time.lo user/unix/userinfo.lo user/unix/groupinfo.lo atomic/unix/mutex.lo atomic/unix/solaris.lo atomic/unix/ia32.lo atomic/unix/s390.lo atomic/unix/builtins.lo atomic/unix/ppc.lo   -lrt-lcrypt -lpthread -ldl\n/usr/bin/ld: cannot find -lrt-lcrypt\n-----------\n\nThe value EXTRA_LIBS=-lrt-lcrypt can be found in the config.log.\n\nNote : the path /path/to/openssl used is not a valid path to OpenSSL (I've had troubles compiling that too). I'm not sure if a valid SSL path would work properly because configure would add the correct libs. (I'll add additional information here when I've tested.)", "id": 141991, "attachment_id": null, "creator": "eugaia@gmail.com", "creation_time": "2010-11-25T05:49:01Z", "time": "2010-11-25T05:49:01Z", "is_private": false}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 141992, "time": "2010-11-25T05:58:57Z", "bug_id": 50334, "creation_time": "2010-11-25T05:58:57Z", "is_private": false, "text": "So if you don't have OpenSSL available, why don't you simply use\n\n   --without-ssl\n\ninstead of\n\n   --with-ssl=/path/to/openssl\n\nwith a broken path? Does it work using the \"without\" syntax?"}, {"count": 2, "tags": [], "creator": "eugaia@gmail.com", "attachment_id": null, "id": 141993, "time": "2010-11-25T06:19:12Z", "bug_id": 50334, "creation_time": "2010-11-25T06:19:12Z", "is_private": false, "text": "(In reply to comment #1)\n> So if you don't have OpenSSL available, why don't you simply use\n> \n>    --without-ssl\n> \n> instead of\n> \n>    --with-ssl=/path/to/openssl\n> \n> with a broken path? Does it work using the \"without\" syntax?\n\nI want to use a custom path to OpenSSL, but because of issues with the latest version of OpenSSL (1.0.0b), I'm having difficulties in both compiling it and compiling Apache with it.\n\nAlthough logically there is no difference to --without-ssl and providing a non-working path, it may be that the bug lies in ./configure when testing for an OpenSSL path that isn't valid. Just having --without-ssl may not reproduce the bug (though I'm in the process of testing it to see if that's the case, and will report back here).\n\nI'm using a virtualized system for testing, so each compilation test takes quite a long time, and I wanted to report the bug early and add extra info as I'd tested."}, {"count": 3, "attachment_id": null, "bug_id": 50334, "text": "I've now tested with a valid path to OpenSSL (/usr/local/openssl/default), and get the following information provided by ./configure :\n\n-------\nchecking for SSL/TLS toolkit base... /usr/local/openssl/default\n  adding \"-I/usr/local/openssl/default/include\" to CPPFLAGS\n  adding \"-I/usr/local/openssl/default/include\" to INCLUDES\n  adding \"-L/usr/local/openssl/default/lib\" to LDFLAGS\nchecking for OpenSSL version... checking openssl/opensslv.h usability... yes\nchecking openssl/opensslv.h presence... yes\nchecking for openssl/opensslv.h... yes\nchecking openssl/ssl.h usability... yes\nchecking openssl/ssl.h presence... yes\nchecking for openssl/ssl.h... yes\nOK\n  forcing SSL_LIBS to \"-lssl -lcrypto  -lrt-lcrypt -lpthread -ldl\"\n  adding \"-lssl\" to LIBS\n  adding \"-lcrypto\" to LIBS\n  adding \"-lrt-lcrypt\" to LIBS\n  adding \"-lpthread\" to LIBS\n  adding \"-ldl\" to LIBS\nchecking openssl/engine.h usability... yes\nchecking openssl/engine.h presence... yes\nchecking for openssl/engine.h... yes\nchecking for SSLeay_version... no\nchecking for SSL_CTX_new... no\nchecking for ENGINE_init... no\nchecking for ENGINE_load_builtin_engines... no\nchecking for SSL_set_cert_store... no\nconfigure: error: ... Error, SSL/TLS libraries were missing or unusable\n-------------\n\nThe problem is in the line :\n\n  forcing SSL_LIBS to \"-lssl -lcrypto  -lrt-lcrypt -lpthread -ldl\"\n\nFrom looking at config.log, the configure test (at least for SSL_set_cert_store) include these libs, and so fail.\n\nI'll see if I can track down where -lrt-lcrypt is being added.", "id": 141995, "time": "2010-11-25T07:11:14Z", "creator": "eugaia@gmail.com", "creation_time": "2010-11-25T07:11:14Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 50334, "attachment_id": null, "id": 142014, "time": "2010-11-25T13:25:43Z", "creator": "eugaia@gmail.com", "creation_time": "2010-11-25T13:25:43Z", "is_private": false, "text": "I have tracked the problem to file $src_dir/srclib/apr/configure line 48747 (in version 2.2.17) : \n\n    EXTRA_LIBS=`echo $LIBS | sed -e \"s%${apr_ste_save_LIBS}%%\"`\n\nThe issue is that $apr_ste_save_LIBS = ' ', so the first space in $LIBS is translated to nothing, hence joining '-lrt -lcrypt' to make '-lrt-lcrypt'.\n\nThere appear to be two solutions to this :\n\n1 - guarantee that $apr_ste_save_LIBS does not = ' '\n2 - handle the case when $apr_ste_save_LIBS = ' '\n\nGiven that this code is generate from a template, and given that it's likely to be less error-prone in the future, it seems to make more sense to me to do 2.\n\nHaving a quick look at the configure.in file, it appears that the code is generated from the APR_RESTORE_THE_ENVIRONMENT() macro.\n\nI'll try to track down that, and post a patch here soon."}, {"count": 5, "tags": [], "creator": "eugaia@gmail.com", "text": "Created attachment 26347\nPatch to correctly handle *empty* value in variables like $LIBS under srclib/apr where the value is a space rather than completely empty.", "id": 142016, "time": "2010-11-25T14:22:32Z", "bug_id": 50334, "creation_time": "2010-11-25T14:22:32Z", "is_private": false, "attachment_id": 26347}, {"count": 6, "tags": [], "creator": "eugaia@gmail.com", "attachment_id": null, "id": 142017, "time": "2010-11-25T14:25:21Z", "bug_id": 50334, "creation_time": "2010-11-25T14:25:21Z", "is_private": false, "text": "The posted patch fixes this issue.  Until it is merged into the main distribution, anyone applying the patch should run $src_dir/srclib/apr/buildconf after applying the patch before re-running ./configure."}, {"count": 7, "tags": [], "creator": "eugaia@gmail.com", "attachment_id": null, "id": 142018, "time": "2010-11-25T14:34:33Z", "bug_id": 50334, "creation_time": "2010-11-25T14:34:33Z", "is_private": false, "text": "(In reply to comment #6)\n\ni.e.\n\ncd $src_dir/srclib/apr && ./buildconf\n\nJust executing in one command won't work."}, {"count": 8, "tags": [], "creator": "binki@gentoo.org", "text": "Created attachment 27532\napr-r1152852-build-flags-extra.patch\n\nThis is still a hacky method to handle the case where CPPFLAGS=' '. But it fixes the issue.\n\nSee Gentoo bug #383549 (https://bugs.gentoo.org/383549) where -D_GNU_SOURCE is clobbered against -D_REENTRANT, resulting in `-D_REENTRANT-D_GNU_SOURCE'.", "id": 149472, "time": "2011-09-19T03:31:13Z", "bug_id": 50334, "creation_time": "2011-09-19T03:31:13Z", "is_private": false, "attachment_id": 27532}, {"count": 9, "tags": [], "creator": "binki@gentoo.org", "text": "Example 2, https://bugs.gentoo.org/383549 :\n\nchecking for a sed that does not truncate output... /bin/sed\nApplying APR hints file rules for x86_64-pc-linux-gnu\n  adding \"-D_REENTRANT\" to CPPFLAGS\n  adding \"-D_GNU_SOURCE\" to CPPFLAGS\n(Default will be unix)\nchecking whether make sets $(MAKE)... yes\n...\nRestore user-defined environment settings...\n  restoring CPPFLAGS to \" \"\n  setting EXTRA_CPPFLAGS to \"-D_REENTRANT-D_GNU_SOURCE\"\n  restoring CFLAGS to \"-march=nocona -O2 -pipe \"\n  setting EXTRA_CFLAGS to \"-pthread\"\n  restoring LDFLAGS to \"-Wl,-O1 -Wl,--as-needed \"\n  setting EXTRA_LDFLAGS to \"\"\n  restoring LIBS to \"\"\n  setting EXTRA_LIBS to \"-luuid -lrt -lcrypt  -lpthread -ldl\"\n  restoring INCLUDES to \"\"\n  setting EXTRA_INCLUDES to \"\"\n...\n/bin/bash /usr/bin/libtool --silent --mode=compile x86_64-pc-linux-gnu-gcc -pthread  -march=nocona -O2 -pipe  -DHAVE_CONFIG_H -D_REENTRANT-D_GNU_SOURCE   -I./include -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include/arch/unix -I./include/arch/unix -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include/arch/unix -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include  -o locks/unix/proc_mutex.lo -c locks/unix/proc_mutex.c && touch locks/unix/proc_mutex.lo\n<command-line>:0:11: warning: missing whitespace after the macro name\n<command-line>:0:0: warning: \"_REENTRANT\" redefined\n<command-line>:0:0: note: this is the location of the previous definition\n/bin/bash /usr/bin/libtool --silent --mode=compile x86_64-pc-linux-gnu-gcc -pthread  -march=nocona -O2 -pipe  -DHAVE_CONFIG_H -D_REENTRANT-D_GNU_SOURCE   -I./include -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include/arch/unix -I./include/arch/unix -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include/arch/unix -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include  -o locks/unix/thread_cond.lo -c locks/unix/thread_cond.c && touch locks/unix/thread_cond.lo\n<command-line>:0:11: warning: missing whitespace after the macro name\n<command-line>:0:0: warning: \"_REENTRANT\" redefined\n<command-line>:0:0: note: this is the location of the previous definition\n/bin/bash /usr/bin/libtool --silent --mode=compile x86_64-pc-linux-gnu-gcc -pthread  -march=nocona -O2 -pipe  -DHAVE_CONFIG_H -D_REENTRANT-D_GNU_SOURCE   -I./include -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include/arch/unix -I./include/arch/unix -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include/arch/unix -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include  -o locks/unix/thread_mutex.lo -c locks/unix/thread_mutex.c && touch locks/unix/thread_mutex.lo\n<command-line>:0:11: warning: missing whitespace after the macro name\n<command-line>:0:0: warning: \"_REENTRANT\" redefined\n<command-line>:0:0: note: this is the location of the previous definition\n/bin/bash /usr/bin/libtool --silent --mode=compile x86_64-pc-linux-gnu-gcc -pthread  -march=nocona -O2 -pipe  -DHAVE_CONFIG_H -D_REENTRANT-D_GNU_SOURCE   -I./include -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include/arch/unix -I./include/arch/unix -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include/arch/unix -I/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5/include  -o locks/unix/thread_rwlock.lo -c locks/unix/thread_rwlock.c && touch locks/unix/thread_rwlock.lo\nlocks/unix/proc_mutex.c: In function 'proc_mutex_proc_pthread_create':\nlocks/unix/proc_mutex.c:393:53: error: 'PTHREAD_PRIO_INHERIT' undeclared (first use in this function)\nlocks/unix/proc_mutex.c:393:53: note: each undeclared identifier is reported only once for each function it appears in\nmake[1]: *** [locks/unix/proc_mutex.lo] Error 1\nmake[1]: *** Waiting for unfinished jobs....\n<command-line>:0:11: warning: missing whitespace after the macro name\n<command-line>:0:0: warning: \"_REENTRANT\" redefined\n<command-line>:0:0: note: this is the location of the previous definition\n<command-line>:0:11: warning: missing whitespace after the macro name\n<command-line>:0:0: warning: \"_REENTRANT\" redefined\n<command-line>:0:0: note: this is the location of the previous definition\nmake[1]: Leaving directory `/var/tmp/portage/dev-libs/apr-1.4.5/work/apr-1.4.5'\nmake: *** [all-recursive] Error 1\nemake failed\n\n\nThis is all caused by CPPFLAGS=\" \" .", "id": 149473, "time": "2011-09-19T03:37:27Z", "bug_id": 50334, "creation_time": "2011-09-19T03:37:27Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "sf@sfritsch.de", "text": "Created attachment 27545\nalternate patch to preserve the space\n\nI think the problem is more that the leading space is lost due to missing quoting.  Does this patch work, too?", "id": 149548, "time": "2011-09-20T21:45:42Z", "bug_id": 50334, "creation_time": "2011-09-20T21:45:42Z", "is_private": false, "attachment_id": 27545}, {"count": 11, "tags": [], "creator": "binki@gentoo.org", "text": "Comment on attachment 27545\nalternate patch to preserve the space\n\nThis patch fixes this particular bug but does not solve the root problem. ./configure need to treat the user's CPPFLAGS value as a string potentially containing any number of any sorts of characters in it.\n\n- The user may use the '%' character in CPPFLAGS, changing the action of the sed expression.\n\n- The user may use BRE metacharacters, such as `.', `*', `[', or `\\', in CPPFLAGS. sed's s command is not a strict string find-and-replace mechanism, it first matches BREs.\n\nOf course, I cannot think of an obvious reason for the user to do any of these things. But leaving ./configure _this_ obviously sensitive to the contents of any of the *FLAGS seems to be asking for further trouble similar in nature to this bug.\n\nMy patch, on the other hand, follows POSIX shell rules and it handles any string... though I still use sed which feels like overkill for this...", "id": 149558, "time": "2011-09-21T00:22:24Z", "bug_id": 50334, "creation_time": "2011-09-21T00:22:24Z", "is_private": false, "attachment_id": 27545}, {"count": 12, "tags": [], "bug_id": 50334, "attachment_id": 27550, "text": "Created attachment 27550\napr-r1152852-build-flags-extra-r1.patch\n\nThis version avoids sed completely.", "id": 149559, "time": "2011-09-21T00:23:07Z", "creator": "binki@gentoo.org", "creation_time": "2011-09-21T00:23:07Z", "is_private": false}, {"count": 13, "attachment_id": null, "bug_id": 50334, "text": "r1183686, r1183710, r1183711\n\nwill be in 1.4.6", "id": 150626, "time": "2011-10-15T21:18:24Z", "creator": "sf@sfritsch.de", "creation_time": "2011-10-15T21:18:24Z", "tags": [], "is_private": false}, {"count": 14, "tags": [], "bug_id": 50334, "text": "Switched back to using sed because /bin/sh on Solaris doesn't support ${A#B}.\n\nThe whitespace problem should be still fixed.", "id": 151281, "attachment_id": null, "creator": "rainer.jung@kippdata.de", "creation_time": "2011-11-08T03:10:14Z", "time": "2011-11-08T03:10:14Z", "is_private": false}, {"count": 15, "tags": [], "creator": "binki@gentoo.org", "text": "(In reply to comment #14)\n> Switched back to using sed because /bin/sh on Solaris doesn't support ${A#B}.\n\nMay you please point to the revisions this change is made in? Thanks.", "id": 151282, "time": "2011-11-08T03:13:11Z", "bug_id": 50334, "creation_time": "2011-11-08T03:13:11Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 50334, "attachment_id": null, "text": "Revisions r1199072 (trunk), r1199076 (1.5.x) and 1199078 (1.4.x).", "id": 151283, "time": "2011-11-08T07:23:09Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2011-11-08T07:23:09Z", "is_private": false}, {"count": 17, "tags": [], "creator": "trawick@apache.org", "text": "Fixed in 1.4.6 and later releases", "id": 172597, "time": "2014-01-21T13:03:41Z", "bug_id": 50334, "creation_time": "2014-01-21T13:03:41Z", "is_private": false, "attachment_id": null}]
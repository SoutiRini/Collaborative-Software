[{"count": 0, "tags": [], "text": "Set up a SSL Connector with a keystore in JKS format:\n\n<Connector ... SSLEnabled=\"true\"\nkeystoreFile=\"tomcat.keystore\" keystoreType=\"JKS\">\n\nLet's say you need a custom truststore (e.g. for authenticating self-signed \nclient certificates), and that this truststore is also needed by some of your \nwebapps, not only Tomcat. The natural thing to do then is to configure this \ntruststore globally for the whole JVM, not in server.xml.\n\nLet's also assume this truststore is in a different format (e.g. PKCS#12). So \nbefore starting Tomcat, you do this:\n\nexport JAVA_OPTS=\"-Djavax.net.ssl.trustStore=trusted.keystore -\nDjavax.net.ssl.trustStoreType=PKCS12\"\n\nWell, it doesn't work. If you look at tomcat/logs/catalina.out, you will see a \nkeystore-related exception. Upon further debugging, you will discover the \nproblem is that Tomcat is trying to open the truststore as if it were in JKS \nformat, even though it is clearly specified as type PKCS12 in JAVA_OPTS above.", "is_private": false, "id": 112804, "creator": "grnch@gmx.net", "time": "2008-01-14T04:24:16Z", "bug_id": 44223, "creation_time": "2008-01-14T04:24:16Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 21383\nsimple fix", "attachment_id": 21383, "bug_id": 44223, "id": 112805, "time": "2008-01-14T04:26:15Z", "creator": "grnch@gmx.net", "creation_time": "2008-01-14T04:26:15Z", "is_private": false}, {"count": 2, "tags": [], "creator": "markt@apache.org", "text": "Tomcat ignores any of the SSL configuration system properties.\n\nI was going to say it has always been this way, I didn't know why and if you\nprovided a patch that addressed all of them it would be considered.\n\nHowever, my brain is now in gear and the problem seems obvious. When using\nsystem properties for configuration then everything is fine until two components\nrequire conflicting settings. In a container environment this pretty much a\ngiven. We had a similar issue with logging which is why Remy wrote JULI.\n\nTherefore, I am marking this as a WONTFIX on the grounds I see it causing more\nproblems than it solves.", "id": 112840, "time": "2008-01-14T13:13:06Z", "bug_id": 44223, "creation_time": "2008-01-14T13:13:06Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 44223, "attachment_id": null, "text": "(In reply to comment #2)\n> Tomcat ignores any of the SSL configuration system properties.\n\nBut this statement is not true. Tomcat already consults the \n\"javax.net.ssl.trustStore\" and \"javax.net.ssl.trustStorePassword\" properties, \nonly it was ignoring the third one, \"javax.net.ssl.trustStoreType\". I am not \nasking for a new feature here, this bug is about the inconsistent \nimplementation of an existing feature. Look at the \nJSSESocketFactory.getTrustStore() method to see what's going on.\n\n> I was going to say it has always been this way, I didn't know why and if you\n> provided a patch that addressed all of them it would be considered.\n\nWell this patch completes the addressing of all of them. Only 2 out of 3 trust \nstore related properties are being taken into account at the moment, and this \npatch adds support for the 3rd one. Either this inconsistency should be fixed, \nor else remove support for ALL trust store properties. The current situation is \ninconsistent and leads to maddening configuration issues (i.e. any reasonable \nperson would assume that since 2 trust store properties appear supported the \nthird one would be also, and then scratch their head when a non-descriptive \nJSSE exception hits them).\n\n> However, my brain is now in gear and the problem seems obvious. When using\n> system properties for configuration then everything is fine until two \ncomponents\n> require conflicting settings. In a container environment this pretty much a\n> given. We had a similar issue with logging which is why Remy wrote JULI.\n> \n> Therefore, I am marking this as a WONTFIX on the grounds I see it causing more\n> problems than it solves.\n\nWhile I agree with your reasoning about container environments, I disagree with \nthe WONTFIX assessment. Currently you have partial support for an arbitrary \nsubset of trust store properties, which is the worst of both worlds.  Either \nsupport all of them or none of them.\n", "id": 112944, "time": "2008-01-17T04:12:09Z", "creator": "grnch@gmx.net", "creation_time": "2008-01-17T04:12:09Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 44223, "attachment_id": null, "id": 112998, "time": "2008-01-18T13:00:47Z", "creator": "markt@apache.org", "creation_time": "2008-01-18T13:00:47Z", "is_private": false, "text": "Fair point. I didn't realise we were using the others. Still don't like it but\nthat is an issue for another time.\n\nPatch applied to trunk and proposed for 6.0.x.\n\nMany thanks."}, {"count": 5, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 113232, "time": "2008-01-28T13:34:43Z", "bug_id": 44223, "creation_time": "2008-01-28T13:34:43Z", "is_private": false, "text": "This has been fixed in svn and will be included in 6.0.16 onwards."}]
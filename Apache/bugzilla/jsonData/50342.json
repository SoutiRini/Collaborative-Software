[{"count": 0, "attachment_id": null, "creator": "knight@nhn.com", "is_private": false, "id": 142028, "time": "2010-11-26T02:04:01Z", "bug_id": 50342, "creation_time": "2010-11-26T02:04:01Z", "tags": [], "text": "Hello.\n\nIf A tomcat receive a request contained the Host request-header field included colon, java.io.CharConversionException is thrown.\n\nException is below\n2010. 11. 26 SEVERE 3:43:37 org.apache.jk.common.HandlerRequest invoke\nSEVERE: Error decoding request \njava.io.CharConversionException: Invalid char in port: 103\n        at org.apache.jk.common.HandlerRequest.parseHost(HandlerRequest.java:655)\n        at org.apache.jk.common.HandlerRequest.decodeRequest(HandlerRequest.java:403)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:260)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:754)\n        at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:684)\n        at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:876)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)\n        at java.lang.Thread.run(Thread.java:619)\n2010. 11. 26  SEVERE 3:43:37 org.apache.jk.common.ChannelSocket processConnection\nSEVERE\u00ed: processCallbacks status 2\n2010. 11. 26SEVERE 3:43:37 org.apache.jk.common.HandlerRequest invoke\nSEVERE: Error decoding request \njava.io.CharConversionException: Invalid char in port: 103\n        at org.apache.jk.common.HandlerRequest.parseHost(HandlerRequest.java:655)\n        at org.apache.jk.common.HandlerRequest.decodeRequest(HandlerRequest.java:403)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:260)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:754)\n        at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:684)\n        at org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:876)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)\n        at java.lang.Thread.run(Thread.java:619)\n2010. 11. 26 SEVERE 3:43:37 org.apache.jk.common.ChannelSocket processConnection\nSEVERE\u00ed: processCallbacks status 2\n\n\nSo. the sample request is below :\n(Host field contained two domain name ; tomcat.apache.org and www.apache.org)\n\ntelnet localhost 80\nTrying 127.0.0.1...\nConnected to localhost.localdomain (127.0.0.1).\nEscape character is '^]'.\nGET http://myweb.com/search.nhn HTTP/1.1\nAccept-Language: ko-KR\nUser-Agent: Mozilla/4.0\nAccept-Encoding: gzip, deflate\nHost:  tomcat.apache.org:www.apache.org   \nConnection: Keep-Alive\n\nHTTP/1.1 502 Bad Gateway\nDate: Fri, 26 Nov 2010 06:43:36 GMT\n.....\n\n\nIt looks like the HTTP 1.1 specification allows to do such call, here's the content of HTTP 1.1 specification.\n\nhttp://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.23\n\n14.23 Host\nThe Host request-header field specifies the Internet host and port number of the resource being requested, as obtained from the original URI given by the user or referring resource (generally an HTTP URL, \n\nas described in section 3.2.2). The Host field value MUST represent the naming authority of the origin server or gateway given by the original URL. This allows the origin server or gateway to differentiate between internally-ambiguous URLs, such as the root \"/\" URL of a server for multiple host names on a single IP address. \n\n       Host = \"Host\" \":\" host [ \":\" port ] ; Section 3.2.2\n\n\nBecause http specification 1.1 support multiple host name, I think tomcat may support this. If I am wrong, let me know it. \nEvery tomcat I tested show the exception. \n\nThank you."}, {"count": 1, "tags": [], "creator": "chuck.caldarale@unisys.com", "text": "(In reply to comment #0)\n> If A tomcat receive a request contained the Host request-header field included\n> colon, java.io.CharConversionException is thrown.\n\nNot true.  The exception is thrown because the request contains an invalid port number after the colon.\n\n> Host:  tomcat.apache.org:www.apache.org   \n\nThe above is invalid.\n\n> It looks like the HTTP 1.1 specification allows to do such call\n\nIt certainly does not.\n\n> Host = \"Host\" \":\" host [ \":\" port ] ; Section 3.2.2\n\nThe first colon separates the header name from the header value; the second colon, when present, separates the host name from the port number.\n\n> Because http specification 1.1 support multiple host name\n\nIt does not.\n\n - Chuck", "id": 142031, "time": "2010-11-26T03:06:24Z", "bug_id": 50342, "creation_time": "2010-11-26T03:06:24Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "Thank you!\nI got confused about host field, I understand what you said.", "is_private": false, "bug_id": 50342, "id": 142100, "time": "2010-11-28T21:18:52Z", "creator": "knight@nhn.com", "creation_time": "2010-11-28T21:18:52Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 50342, "text": "Thank you!\n\nI got confused about Host field of HTTP 1.1. \n\nI understand what you mentioned.", "id": 142101, "attachment_id": null, "creator": "knight@nhn.com", "creation_time": "2010-11-28T21:19:59Z", "time": "2010-11-28T21:19:59Z", "is_private": false}, {"count": 4, "tags": [], "text": "Could you give more information when java.io.CharConversionException is thrown.\n\nIn present, I do not know why the exception is thrown and what character is transfered from client. \n\nSo, I hope to add a information below. \n\n<in org.apache.jk.commo.HandlerRequest.java>\n\nin present :\nthrow new CharConversionException(\"Invalid char in port: \" + valueB[i + valueS]); \n\nto be :\nthrow new CharConversionException(\"Invalid char in port: \" + valueB[i + valueS] + \", invalid string is \" + new String(valueB));", "is_private": false, "id": 142880, "creator": "knight@nhn.com", "time": "2010-12-21T04:40:46Z", "bug_id": 50342, "creation_time": "2010-12-21T04:40:46Z", "attachment_id": null}]
[{"count": 0, "attachment_id": 35302, "bug_id": 61497, "is_private": false, "id": 200707, "time": "2017-09-06T15:08:22Z", "creator": "gmilewski@celerant.com", "creation_time": "2017-09-06T15:08:22Z", "tags": [], "text": "Created attachment 35302\nZip containing key, cert, chain, and keystore.\n\nAttached are throwaway key/cert/keystore\n\nConfiguring a Tomcat instance with an internal CA and Java Keystore in Tomcat 8.5.16 works without issue.  Migrating the same install to 8.5.19 or 8.5.20 results in \"java.security.KeyStoreException: Cannot store non-PrivateKeys\", failing to create the SSL port.\n\nTaking the SAME keystore, extracting to PKCS12 via keytool.exe, then to PEM through OpenSSL, then configuring server.xml to use PEM results in a working/trusted SSL port in 8.5.20, however we need the keystore method.\n\nKeystore password is: 6d454df3d881bf61ccc0540d36cff1a5\n\n8.5.16 KEYSTORE:\n\n06-Sep-2017 10:12:46.247 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent Loaded APR based Apache Tomcat Native library [1.2.12] using APR version [1.5.2].\n06-Sep-2017 10:12:46.247 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR capabilities: IPv6 [true], sendfile [true], accept filters [false], random [true].\n06-Sep-2017 10:12:46.247 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR/OpenSSL configuration: useAprConnector [false], useOpenSSL [true]\n06-Sep-2017 10:12:46.966 INFO [main] org.apache.catalina.core.AprLifecycleListener.initializeSSL OpenSSL successfully initialized [OpenSSL 1.0.2k  26 Jan 2017]\n06-Sep-2017 10:12:47.153 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\"http-nio-8080\"]\n06-Sep-2017 10:12:47.294 INFO [main] org.apache.tomcat.util.net.NioSelectorPool.getSharedSelector Using a shared selector for servlet write/read\n06-Sep-2017 10:12:47.310 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\"https-openssl-nio-8443\"]\n06-Sep-2017 10:12:47.591 INFO [main] org.apache.tomcat.util.net.NioSelectorPool.getSharedSelector Using a shared selector for servlet write/read\n06-Sep-2017 10:12:47.591 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\"ajp-nio-127.0.0.1-8009\"]\n06-Sep-2017 10:12:47.591 INFO [main] org.apache.tomcat.util.net.NioSelectorPool.getSharedSelector Using a shared selector for servlet write/read\n06-Sep-2017 10:12:47.591 INFO [main] org.apache.catalina.startup.Catalina.load Initialization processed in 1882 ms\n\n8.5.20 KEYSTORE:\n\n\n06-Sep-2017 10:15:44.562 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent Loaded APR based Apache Tomcat Native library [1.2.12] using APR version [1.5.2].\n06-Sep-2017 10:15:44.562 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR capabilities: IPv6 [true], sendfile [true], accept filters [false], random [true].\n06-Sep-2017 10:15:44.562 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR/OpenSSL configuration: useAprConnector [false], useOpenSSL [true]\n06-Sep-2017 10:15:45.345 INFO [main] org.apache.catalina.core.AprLifecycleListener.initializeSSL OpenSSL successfully initialized [OpenSSL 1.0.2k  26 Jan 2017]\n06-Sep-2017 10:15:45.579 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\"http-nio-8080\"]\n06-Sep-2017 10:15:45.720 INFO [main] org.apache.tomcat.util.net.NioSelectorPool.getSharedSelector Using a shared selector for servlet write/read\n06-Sep-2017 10:15:45.735 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\"https-openssl-nio-8443\"]\n06-Sep-2017 10:15:46.014 SEVERE [main] org.apache.coyote.AbstractProtocol.init Failed to initialize end point associated with ProtocolHandler [\"https-openssl-nio-8443\"]\n java.lang.IllegalArgumentException: java.security.KeyStoreException: Cannot store non-PrivateKeys\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.createSSLContext(AbstractJsseEndpoint.java:114)\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.initialiseSsl(AbstractJsseEndpoint.java:85)\n\tat org.apache.tomcat.util.net.NioEndpoint.bind(NioEndpoint.java:225)\n\tat org.apache.tomcat.util.net.AbstractEndpoint.init(AbstractEndpoint.java:982)\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.init(AbstractJsseEndpoint.java:244)\n\tat org.apache.coyote.AbstractProtocol.init(AbstractProtocol.java:620)\n\tat org.apache.coyote.http11.AbstractHttp11Protocol.init(AbstractHttp11Protocol.java:66)\n\tat org.apache.catalina.connector.Connector.initInternal(Connector.java:997)\n\tat org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:107)\n\tat org.apache.catalina.core.StandardService.initInternal(StandardService.java:549)\n\tat org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:107)\n\tat org.apache.catalina.core.StandardServer.initInternal(StandardServer.java:875)\n\tat org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:107)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:607)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:630)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:311)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:494)\nCaused by: java.security.KeyStoreException: Cannot store non-PrivateKeys\n\tat sun.security.provider.JavaKeyStore.engineSetKeyEntry(JavaKeyStore.java:258)\n\tat sun.security.provider.JavaKeyStore$JKS.engineSetKeyEntry(JavaKeyStore.java:56)\n\tat sun.security.provider.KeyStoreDelegator.engineSetKeyEntry(KeyStoreDelegator.java:117)\n\tat sun.security.provider.JavaKeyStore$DualFormatJKS.engineSetKeyEntry(JavaKeyStore.java:70)\n\tat java.security.KeyStore.setKeyEntry(KeyStore.java:1140)\n\tat org.apache.tomcat.util.net.jsse.JSSEUtil.getKeyManagers(JSSEUtil.java:226)\n\tat org.apache.tomcat.util.net.openssl.OpenSSLUtil.getKeyManagers(OpenSSLUtil.java:79)\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.createSSLContext(AbstractJsseEndpoint.java:112)\n\t... 20 more\n\n06-Sep-2017 10:15:46.030 SEVERE [main] org.apache.catalina.core.StandardService.initInternal Failed to initialize connector [Connector[HTTP/1.1-8443]]\n org.apache.catalina.LifecycleException: Failed to initialize component [Connector[HTTP/1.1-8443]]\n\tat org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:112)\n\tat org.apache.catalina.core.StandardService.initInternal(StandardService.java:549)\n\tat org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:107)\n\tat org.apache.catalina.core.StandardServer.initInternal(StandardServer.java:875)\n\tat org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:107)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:607)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:630)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:311)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:494)\nCaused by: org.apache.catalina.LifecycleException: Protocol handler initialization failed\n\tat org.apache.catalina.connector.Connector.initInternal(Connector.java:999)\n\tat org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:107)\n\t... 12 more\nCaused by: java.lang.IllegalArgumentException: java.security.KeyStoreException: Cannot store non-PrivateKeys\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.createSSLContext(AbstractJsseEndpoint.java:114)\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.initialiseSsl(AbstractJsseEndpoint.java:85)\n\tat org.apache.tomcat.util.net.NioEndpoint.bind(NioEndpoint.java:225)\n\tat org.apache.tomcat.util.net.AbstractEndpoint.init(AbstractEndpoint.java:982)\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.init(AbstractJsseEndpoint.java:244)\n\tat org.apache.coyote.AbstractProtocol.init(AbstractProtocol.java:620)\n\tat org.apache.coyote.http11.AbstractHttp11Protocol.init(AbstractHttp11Protocol.java:66)\n\tat org.apache.catalina.connector.Connector.initInternal(Connector.java:997)\n\t... 13 more\nCaused by: java.security.KeyStoreException: Cannot store non-PrivateKeys\n\tat sun.security.provider.JavaKeyStore.engineSetKeyEntry(JavaKeyStore.java:258)\n\tat sun.security.provider.JavaKeyStore$JKS.engineSetKeyEntry(JavaKeyStore.java:56)\n\tat sun.security.provider.KeyStoreDelegator.engineSetKeyEntry(KeyStoreDelegator.java:117)\n\tat sun.security.provider.JavaKeyStore$DualFormatJKS.engineSetKeyEntry(JavaKeyStore.java:70)\n\tat java.security.KeyStore.setKeyEntry(KeyStore.java:1140)\n\tat org.apache.tomcat.util.net.jsse.JSSEUtil.getKeyManagers(JSSEUtil.java:226)\n\tat org.apache.tomcat.util.net.openssl.OpenSSLUtil.getKeyManagers(OpenSSLUtil.java:79)\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.createSSLContext(AbstractJsseEndpoint.java:112)\n\t... 20 more\n\n06-Sep-2017 10:15:46.030 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\"ajp-nio-127.0.0.1-8009\"]\n06-Sep-2017 10:15:46.030 INFO [main] org.apache.tomcat.util.net.NioSelectorPool.getSharedSelector Using a shared selector for servlet write/read\n06-Sep-2017 10:15:46.030 INFO [main] org.apache.catalina.startup.Catalina.load Initialization processed in 2099 ms\n\n\n8.5.20 PEM FILES:\n\n06-Sep-2017 10:28:35.271 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent Loaded APR based Apache Tomcat Native library [1.2.12] using APR version [1.5.2].\n06-Sep-2017 10:28:35.271 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR capabilities: IPv6 [true], sendfile [true], accept filters [false], random [true].\n06-Sep-2017 10:28:35.271 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR/OpenSSL configuration: useAprConnector [false], useOpenSSL [true]\n06-Sep-2017 10:28:36.052 INFO [main] org.apache.catalina.core.AprLifecycleListener.initializeSSL OpenSSL successfully initialized [OpenSSL 1.0.2k  26 Jan 2017]\n06-Sep-2017 10:28:36.271 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\"http-nio-8080\"]\n06-Sep-2017 10:28:36.427 INFO [main] org.apache.tomcat.util.net.NioSelectorPool.getSharedSelector Using a shared selector for servlet write/read\n06-Sep-2017 10:28:36.427 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\"https-openssl-nio-8443\"]\n06-Sep-2017 10:28:36.442 INFO [main] org.apache.tomcat.util.net.NioSelectorPool.getSharedSelector Using a shared selector for servlet write/read\n06-Sep-2017 10:28:36.442 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\"ajp-nio-127.0.0.1-8009\"]\n06-Sep-2017 10:28:36.442 INFO [main] org.apache.tomcat.util.net.NioSelectorPool.getSharedSelector Using a shared selector for servlet write/read\n06-Sep-2017 10:28:36.458 INFO [main] org.apache.catalina.startup.Catalina.load Initialization processed in 1768 ms"}, {"count": 1, "tags": [], "bug_id": 61497, "attachment_id": null, "is_private": false, "id": 200715, "time": "2017-09-06T18:43:42Z", "creator": "markt@apache.org", "creation_time": "2017-09-06T18:43:42Z", "text": "\n\n*** This bug has been marked as a duplicate of bug 61451 ***"}, {"count": 2, "tags": [], "bug_id": 61497, "text": "Thank you kindly - search did not turn up that bug, nor the autosearch, sorry!", "id": 200717, "attachment_id": null, "creator": "gmilewski@celerant.com", "creation_time": "2017-09-06T18:57:13Z", "time": "2017-09-06T18:57:13Z", "is_private": false}]
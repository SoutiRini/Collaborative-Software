[{"count": 0, "tags": [], "creator": "hossman_apachebugzilla@fucit.org", "attachment_id": 26216, "text": "Created attachment 26216\nwar file demonstrating the bug\n\nWhen registering a Filter with a wildcarded url-patterm (ie: \"/*\") tomcat 7.0.4 seems to be adding \"index.jsp\" to the end of any url which ends in a \"/\" prior to invoking the Filter's doFilter method.\n\nThis is a change in behavior from tomcat 6.0.29 (and certainly seems like a bug, but i'm not an expert on the servlet spec)\n\nThe attached war file includes a filter (and it's source) which is mapped to the url-pattern \"/*\".  This filter causes a 400 response for any request it sees, specifying the path information included in the HttpServletRequest as the error message.\n\nIf you start up tomcat 6.0.* using port 8080, running this war, a URL like this....\n\n  http://localhost:8080/filter-bug/asdf\n\n...will produce an error message like...\n\n  FilterBugDemo@24988707 Got:/asdf + null\n\n...likewise a URL like this...\n\n  http://localhost:8080/filter-bug/asdf/\n\n...will produce the error message...\n\n  FilterBugDemo@24988707 Got:/asdf/ + null\n\n\nUsing Tomcat 7.0.4 however, the last URL method above produces this error...\n\n  FilterBugDemo@4a8d3d62 Got:/asdf/index.jsp + null\n\n...indicating that the Filter did not receive an HttpServletRequest \ncontaining the \"correct\" URL sent by the client.\n\n\n(Note: This behavior may exist in other versions of Tomcat 7.0.*, i only tested 7.0.4)", "id": 141084, "time": "2010-10-27T01:58:20Z", "bug_id": 50161, "creation_time": "2010-10-27T01:58:20Z", "is_private": false}, {"count": 1, "tags": [], "creator": "hossman_apachebugzilla@fucit.org", "text": "Note: this is (evidently) the root cause of SOLR-2022...\n\nhttps://issues.apache.org/jira/browse/SOLR-2022", "id": 141085, "attachment_id": null, "bug_id": 50161, "creation_time": "2010-10-27T01:59:45Z", "time": "2010-10-27T01:59:45Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 50161, "attachment_id": null, "text": "Looks like another case of bug 49422.\n\nMore discussions in http://tomcat.markmail.org/thread/xvuophujspik5liq\n\nShort version:\n- Tomcat is stricter in applying the spec rules for welcome files\n- Some EG members think the spec does not reflect what was agreed in the EG\n- Tomcat will be adding some new options to handle this - probably defaulting to previous behaviour", "id": 141089, "time": "2010-10-27T05:22:41Z", "creator": "markt@apache.org", "creation_time": "2010-10-27T05:22:41Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 50161, "attachment_id": null, "id": 141100, "time": "2010-10-27T11:32:42Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-10-27T11:32:42Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of bug 49422 ***"}, {"count": 4, "tags": [], "text": "While i appreciate that the underlying change that caused this bug is most certainly the same as that of bug#49422 i would like to point out that the actual issue is (to me at least) fairly distinct.\n\nHaving read the comments in bug#49422 I (somewhat) understand the reasons why a servlet wishing to receive requests for \"/foo/\" should be registered with a url-mapping of \"/foo/*\" in order to receive the implicit request for \"/foo/index.jsp\" but in the case of this bug (bug#50161) We are already using a url-mapping of \"/*\" for the Filter in question.\n\nThe issue at hand is what the return value of HttpServletRequest.getServletPath() should be when the Servlet (or in our case Filter) processes the request.\n\nShouldn't that method (per the javadocs) \"Returns the part of this request's URL that calls the servlet\" ... w/o having additional (implicit) values tacked on to the end?", "attachment_id": null, "bug_id": 50161, "id": 141104, "time": "2010-10-27T14:35:17Z", "creator": "hossman_apachebugzilla@fucit.org", "creation_time": "2010-10-27T14:35:17Z", "is_private": false}, {"count": 5, "tags": [], "creator": "kiralyattila.hu@gmail.com", "text": "Don't know how legal it is but I use the following workaround in the web.xml (works with 7.0.4):\n\n<welcome-file-list>\n\t<welcome-file></welcome-file>\n</welcome-file-list>\n\nThis turns off the default welcome file list and adds nothing to the end of the url.", "id": 141106, "attachment_id": null, "bug_id": 50161, "creation_time": "2010-10-27T15:52:31Z", "time": "2010-10-27T15:52:31Z", "is_private": false}, {"count": 6, "tags": [], "creator": "markt@apache.org", "text": "(In reply to comment #4)\n> The issue at hand is what the return value of\n> HttpServletRequest.getServletPath() should be when the Servlet (or in our case\n> Filter) processes the request.\n> \n> Shouldn't that method (per the javadocs) \"Returns the part of this request's\n> URL that calls the servlet\" ... w/o having additional (implicit) values tacked\n> on to the end?\n\nThere are a couple of ambiguities in the spec in this area:\n- It isn't clear if filter mapping occurs before or after welcome file processing. The implication is that filter mapping is after welcome file processing.\n- It isn't clear if the welcome file should be included in getServletPath() etc. The implication is that it should.\n\nBoth of these issues - and a bunch of others - are on my list of things to nag the EG about.\n\nThe option(s) that get added for the next 7.0.x release should fix this for you - or at least enable you to work around it.", "id": 141113, "attachment_id": null, "bug_id": 50161, "creation_time": "2010-10-27T21:30:44Z", "time": "2010-10-27T21:30:44Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 4036, "is_private": false, "text": "When the servlets container is under heavy load I often get this stack trace:\n\njava.lang.NumberFormatException:\n        at java.lang.Long.parseLong(Long.java:331)\n        at java.lang.Long.parseLong(Long.java:363)\n        at java.text.DigitList.getLong(DigitList.java:153)\n        at java.text.DecimalFormat.parse(DecimalFormat.java:820)\n        at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1201)\n        at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:730)\n        at java.text.DateFormat.parse(DateFormat.java:322)\n        at org.apache.tomcat.util.RequestUtil.toDate(RequestUtil.java:573)\n        at\norg.apache.tomcat.facade.HttpServletRequestFacade.getDateHeader(HttpServletRequestFacade.java:165)\n        at\nhox.corem.servlets.GeneratorServlet.service(GeneratorServlet.java:449)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at\norg.apache.tomcat.core.ServletWrapper.doService(ServletWrapper.java:405)\n        at org.apache.tomcat.core.Handler.service(Handler.java:287)\n        at\norg.apache.tomcat.core.ServletWrapper.service(ServletWrapper.java:372)\n        at\norg.apache.tomcat.core.ContextManager.internalService(ContextManager.java:797)\n        at\norg.apache.tomcat.core.ContextManager.service(ContextManager.java:743)\n        at\norg.apache.tomcat.service.http.HttpConnectionHandler.processConnection(HttpConnectionHandler.java:213)\n        at\norg.apache.tomcat.service.TcpWorkerThread.runIt(PoolTcpEndpoint.java:416)\n        at\norg.apache.tomcat.util.ThreadPool$ControlRunnable.run(ThreadPool.java:501)\n        at java.lang.Thread.run(Thread.java:484)\n\nAfter some research I found that the static method RequestUtil.toDate uses the\nsame SimpleDateFormat for every call. Unfortunatly Sun's implemention of a\nSimpleDateFormat is not thread safe since it holds a DecimalFormat as a member\nvaraible. The decimalFormat itself has other member variables holding state\ninformation.\nSo when two threads try to get a date header at the same time the internal state\ninformation of the SimpleDateFormat gets corrupted and various exceptions\nhappen.\nCould you please fix that toDate() method to be thread safe?\n\nthanks,\nDaniel", "id": 6491, "time": "2001-10-09T02:31:18Z", "creator": "d.spilker@web.de", "creation_time": "2001-10-09T02:31:18Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 4036, "text": "This has been fixed in 3.3.", "id": 6554, "time": "2001-10-10T11:26:55Z", "creator": "william.barker@wilshire.com", "creation_time": "2001-10-10T11:26:55Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "fmisiak@network-intelligence.com", "text": "I don't see any protection against concurrent access to the various \nSimpleDateFormat instances in \"org.apache.tomcat.util.buf.DateTool.parseDate()\".\n\nstack trace using tomcat 3.3.1:\n2002-11-25 10:06:28 - Ctx() : Exception in R(  + /treemenu/deeptree.css + \nnull) - java.lang.NumberFormatException: \n\tat java.lang.Long.parseLong(Long.java:331)\n\tat java.lang.Long.parseLong(Long.java:363)\n\tat java.text.DigitList.getLong(DigitList.java:153)\n\tat java.text.DecimalFormat.parse(DecimalFormat.java:820)\n\tat java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1201)\n\tat java.text.SimpleDateFormat.parse(SimpleDateFormat.java:730)\n\tat java.text.DateFormat.parse(DateFormat.java:322)\n\tat org.apache.tomcat.util.buf.DateTool.parseDate(DateTool.java:196)\n\tat org.apache.tomcat.util.buf.DateTool.parseDate(DateTool.java:190)\n\tat org.apache.tomcat.util.buf.DateTool.parseDate(DateTool.java:138)\n\tat org.apache.tomcat.util.buf.MessageBytes.getTime\n(MessageBytes.java:555)\n\tat org.apache.tomcat.modules.generators.FileHandler.doService\n(StaticInterceptor.java:332)\n\tat org.apache.tomcat.core.Handler.invoke(Handler.java:322)\n\tat org.apache.tomcat.core.Handler.service(Handler.java:235)\n\tat org.apache.tomcat.core.ContextManager.internalService\n(ContextManager.java:917)\n\tat org.apache.tomcat.core.ContextManager.service\n(ContextManager.java:833)\n\tat org.apache.tomcat.modules.server.Http10Interceptor.processConnection\n(Http10Interceptor.java:176)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:494)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:516)\n\tat java.lang.Thread.run(Thread.java:484)\n", "id": 26959, "time": "2002-11-25T18:53:27Z", "bug_id": 4036, "creation_time": "2002-11-25T18:53:27Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 4036, "is_private": false, "text": "Fixed in the nightly", "id": 26962, "time": "2002-11-25T20:11:38Z", "creator": "william.barker@wilshire.com", "creation_time": "2002-11-25T20:11:38Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "thomas.phlips@accenture.com", "text": "Same problem occurs still in tomcat v3.3.1,v 1.2 (2002/03/01 01:32:06).\nIt occurs e.g. when accessing a static html page containing some relative image \nlinks (depending on server config. etc, it occurs in almost 5% of the cases, \neven without havy load, just refreshing the page with one user). Cause seems to \nbe the same:\nThe static method DateUtil.parseDate uses the\nsame SimpleDateFormat (e.g. the rfc1123Format static final attribute) for every \ncall. Unfortunatly Sun's implemention of a\nSimpleDateFormat is not thread safe since it holds a DecimalFormat as a member\nvariable. The decimalFormat itself has other member variables holding state\ninformation.\n\nTo be sure, I modified the DateUtil parseDate method to use local newly created \nvariables for the dateformats every time, ... and indeed the problem no longer \noccurs then.\n\n", "id": 37058, "time": "2003-05-12T11:48:57Z", "bug_id": 4036, "creation_time": "2003-05-12T11:48:57Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 4036, "text": "\n\n*** This bug has been marked as a duplicate of 8562 ***", "id": 37084, "time": "2003-05-12T18:14:03Z", "creator": "william.barker@wilshire.com", "creation_time": "2003-05-12T18:14:03Z", "is_private": false, "attachment_id": null}]
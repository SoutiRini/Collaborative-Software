[{"count": 0, "tags": [], "creator": "bernhard.huemer@gmail.com", "attachment_id": null, "text": "I'll attach a sample web application reproducing the error. Note that this error\nonly occurs when using Tomcat 6.0.x (i.e. it works with Jetty as it uses Sun's\nEL RI). Moreover it doesn't matter which JSF implementation you're using to\nreproduce the error (I just wanted to mention that as it's definitely no bug in\nMyFaces even though the following stack trace shows a FacesException).\n\nThe exception stack trace:\njavax.faces.FacesException: Exception while calling broadcast on component :\n{Component-Path : [Class: javax.faces.component.UIViewRoot,ViewId: /home.jsp][\nClass: javax.faces.component.html.HtmlForm,Id: j_id_jsp_923754602_1][Class:\njavax.faces.component.html.HtmlCommandButton,Id: j_id_jsp_923754602_3]}\n        at javax.faces.component.UIComponentBase.broadcast(UIComponentBase.java:494)\n        at javax.faces.component.UICommand.broadcast(UICommand.java:105)\n        at javax.faces.component.UIViewRoot._broadcastForPhase(UIViewRoot.java:292)\n        at javax.faces.component.UIViewRoot.process(UIViewRoot.java:209)\n        at javax.faces.component.UIViewRoot.processApplication(UIViewRoot.java:117)\n        at\norg.apache.myfaces.lifecycle.InvokeApplicationExecutor.execute(InvokeApplicationExecutor.java:32)\n        at\norg.apache.myfaces.lifecycle.LifecycleImpl.executePhase(LifecycleImpl.java:95)\n        at org.apache.myfaces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:70)\n        at javax.faces.webapp.FacesServlet.service(FacesServlet.java:144)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175)\n        at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)\n        at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n        at\norg.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:263)\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:844)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:584)\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447)\n        at java.lang.Thread.run(Thread.java:619)\nCaused by: org.apache.jasper.el.JspELException: /home.jsp(12,3)\n'#{numberBean.number}' java.lang.IllegalArgumentException: argument type mismatch\n        at\norg.apache.jasper.el.JspValueExpression.setValue(JspValueExpression.java:94)\n        at\norg.apache.myfaces.event.SetPropertyActionListener.processAction(SetPropertyActionListener.java:72)\n        at javax.faces.event.ActionEvent.processListener(ActionEvent.java:48)\n        at javax.faces.component.UIComponentBase.broadcast(UIComponentBase.java:489)\n        ... 20 more\nCaused by: java.lang.IllegalArgumentException: argument type mismatch\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at javax.el.BeanELResolver.setValue(BeanELResolver.java:108)\n        at javax.el.CompositeELResolver.setValue(CompositeELResolver.java:68)\n        at\norg.apache.myfaces.el.unified.resolver.FacesCompositeELResolver.access$501(FacesCompositeELResolver.java:46)\n        at\norg.apache.myfaces.el.unified.resolver.FacesCompositeELResolver$6.invoke(FacesCompositeELResolver.java:132)\n        at\norg.apache.myfaces.el.unified.resolver.FacesCompositeELResolver.invoke(FacesCompositeELResolver.java:148)\n        at\norg.apache.myfaces.el.unified.resolver.FacesCompositeELResolver.setValue(FacesCompositeELResolver.java:128)\n        at org.apache.el.parser.AstValue.setValue(AstValue.java:114)\n        at org.apache.el.ValueExpressionImpl.setValue(ValueExpressionImpl.java:249)\n        at\norg.apache.jasper.el.JspValueExpression.setValue(JspValueExpression.java:85)\n        ... 23 more", "id": 107627, "time": "2007-09-02T13:14:26Z", "bug_id": 43285, "creation_time": "2007-09-02T13:14:26Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 43285, "attachment_id": 20757, "text": "Created attachment 20757\nSample web application reproducing the error", "id": 107631, "time": "2007-09-02T13:19:01Z", "creator": "bernhard.huemer@gmail.com", "creation_time": "2007-09-02T13:19:01Z", "is_private": false}, {"count": 2, "tags": [], "creator": "bernhard.huemer@gmail.com", "attachment_id": 20759, "text": "Created attachment 20759\nProposed patch", "id": 107633, "time": "2007-09-02T13:20:34Z", "bug_id": 43285, "creation_time": "2007-09-02T13:20:34Z", "is_private": false}, {"count": 3, "tags": [], "creator": "funkman@joedog.org", "attachment_id": null, "text": "patch applied to trunk\nvote in place on 6.0.x HEAD\n", "id": 112218, "time": "2007-12-26T18:13:36Z", "bug_id": 43285, "creation_time": "2007-12-26T18:13:36Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 43285, "text": "This has been committed to 6.0.x and will be included in 6.0.16 onwards.\n\nThanks for the patch.", "id": 112303, "time": "2007-12-30T14:11:41Z", "creator": "markt@apache.org", "creation_time": "2007-12-30T14:11:41Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 43285, "attachment_id": null, "text": "This introduced a new bug now. In 6.0.14, when you have a selecItem whose empty\nvalue is selected (value=\"\"), and the binding datatype was Long, EL evaluation\nwould set it to NULL. Now, its setting it to 0. ", "id": 113905, "time": "2008-02-19T15:38:24Z", "creator": "Subba.Ayyagari@fnf.com", "creation_time": "2008-02-19T15:38:24Z", "is_private": false}, {"count": 6, "tags": [], "creator": "Subba.Ayyagari@fnf.com", "text": "To add to my comment above: \n\nHere is my bean:\nMyBean { \n   private Long number; \n   ...//getter \n   .. //setter \n   .. // other methods\n}\n\nHere is my JSP (JSF Page rather):\n<h:selectOneMenu\n    value=\"#{myBean.number}\"\n    required=\"false\"\n    converterMessage=\"Number value is invalid\">\n    <f:selectItems value=\"#{myBean.allNumbers}\"/>\n</h:selectOneMenu>\n\nmyBean.allNumbers is implemented as follows:\n\npublic List<SelectItem> getAllNumbers() {\n   List<SelectItem> list = new ArrayList<SelectItem>(0);\n   list.add(new SelectItem(\"\", \"--SELECT--\"));   // NOTE: this causes the issue\n   list.add(new SelectItem(\"1\", \"ONE\"));\n   list.add(new SelectItem(\"2\", \"TWO\"));\n   list.add(new SelectItem(\"1\", \"THREE\"));\n   return list;\n}\n\nNow, when i don't select a value (ie., leave the drop down on --SELECT--) for\nthe Number and submit the form, Tomcat 6.0.16 would set the myBean.number to 0.\nUntil Tomcat 6.0.14, the value is NULL.\n\nWhy is this important? It ends up putting 0's in the database instead of NULL's.\n\nThanks", "id": 113906, "attachment_id": null, "bug_id": 43285, "creation_time": "2008-02-19T15:48:56Z", "time": "2008-02-19T15:48:56Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 43285, "attachment_id": null, "text": "Note that the Expression Language specification requires this behaviour, see \"1.2.1.1 Eval-expressions as value expressions\": \"In the case of lvalues [...] the provided value is coerced to the actual type of the property the expression points to, before that property is set.\" Furthermore, according to the coercion rules defined in the section \"1.18.3 Coerce A to Number type N\" the Expression Language implementation has to coerce both null and \"\" to 0. \nAs you can see, this behaviour is not only what one would expect but also what the specification requires.", "id": 114900, "time": "2008-03-23T13:05:39Z", "creator": "bernhard.huemer@gmail.com", "creation_time": "2008-03-23T13:05:39Z", "is_private": false}, {"count": 8, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Changing back to fixed based on previous comment.", "id": 115474, "time": "2008-04-09T15:37:17Z", "bug_id": 43285, "creation_time": "2008-04-09T15:37:17Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 43285, "text": "As far as this fix changes the behavior in a significant way it is a major change that will cause a lot of trouble.\n\nWith this fix it is not possible to deal with 'optional' number fields. We don't no whether the user entered the value 0L or 'nothing'. All of our SearchForms where we add restrictions for not-null fields are not working any more. To use bindings for such a simple thing is as nonpractical as using String for number fields. \n\nYou are right that your fix follows the JSP 2.1 specification. But even Sun's reference implementation allows null-values.\n\nTo enable Tomcat < 6.0.15 and JSF 1.2 Users to update to Tomcat > 6.0.16 I would recommend to make this behavoir configurable (e.g. with an context-param) or follow the RI and allow null-values.\n\nI will provided an other patch that solves Bernhards problem but is aware of null values. It assigns the value without coercion if it is assignable and uses coerceToType instead.\n", "id": 116616, "time": "2008-05-14T14:03:33Z", "creator": "mail@nils-eckert.de", "creation_time": "2008-05-14T14:03:33Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 43285, "text": "Created attachment 21962\nProposed patch taking care of primitive types\n\nThis patch extends the original AstValue.java with care about primitive types and not assignable values. It does not take care about the JSP 2.1 specification as far as it makes Objects nullable. It follows Suns RI EL-Implementation.", "id": 116617, "time": "2008-05-14T14:07:42Z", "creator": "mail@nils-eckert.de", "creation_time": "2008-05-14T14:07:42Z", "is_private": false, "attachment_id": 21962}, {"count": 11, "tags": [], "bug_id": 43285, "attachment_id": null, "id": 116755, "time": "2008-05-17T10:48:44Z", "creator": "markt@apache.org", "creation_time": "2008-05-17T10:48:44Z", "is_private": false, "text": "That the RI has a bug and is not spec compliant is not a justification for deliberately inserting the same bug in Tomcat. That said, I am not against an enhancement that makes this configurable.\n\nJasper can't get at the Tomcat context configuration without making Jasper dependant on Tomcat internals, something we try not do to. To be consistent with similar configuration options it could be done with a system property (see http://svn.apache.org/repos/asf/tomcat/trunk/webapps/docs/config/systemprops.xml for examples). The code would need to ensure that setting org.apache.catalina.STRICT_SERVLET_COMPLIANCE overrides the new setting that allows nulls."}, {"count": 12, "tags": [], "creator": "mail@nils-eckert.de", "attachment_id": 21981, "text": "Created attachment 21981\nProposed patch taking care of primitive types (configurable)\n\nConfigurable with VM-parameter \"org.apache.catalina.STRICT_JSP_COMPLIANCE\"", "id": 116803, "time": "2008-05-19T04:11:14Z", "bug_id": 43285, "creation_time": "2008-05-19T04:11:14Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 43285, "attachment_id": 21982, "text": "Created attachment 21982\nProposed patch taking care of primitive types (configurable)\n\nI renamed the parameter to \"org.apache.catalina.STRICT_JSP_COMPLIANCE\" and had forgotten to refactor the corresponding  field-name. Please feel free to rename this field / parameter if needed.", "id": 116805, "time": "2008-05-19T04:23:09Z", "creator": "mail@nils-eckert.de", "creation_time": "2008-05-19T04:23:09Z", "is_private": false}, {"count": 14, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "*** Bug 45040 has been marked as a duplicate of this bug. ***", "id": 116822, "time": "2008-05-19T11:49:04Z", "bug_id": 43285, "creation_time": "2008-05-19T11:49:04Z", "is_private": false}, {"count": 15, "tags": [], "creator": "mail@nils-eckert.de", "attachment_id": 22028, "text": "Created attachment 22028\nProposed patch taking care of primitive types (configurable)\n\nFixing NullpointerException in isAssignable when assigning values to a Map (targetClass is null then).", "id": 117103, "time": "2008-05-29T02:28:09Z", "bug_id": 43285, "creation_time": "2008-05-29T02:28:09Z", "is_private": false}, {"count": 16, "tags": [], "bug_id": 43285, "attachment_id": null, "id": 117511, "time": "2008-06-09T09:45:39Z", "creator": "markt@apache.org", "creation_time": "2008-06-09T09:45:39Z", "is_private": false, "text": "I have applied your patch to make this optional to trunk and proposed it for 6.0.x"}, {"count": 17, "tags": [], "bug_id": 43285, "text": "The patch is applied to 6.0 in r671358 (2008-06-24) and is in 6.0.17 onwards.\n\nThe system property that controls this feature is\norg.apache.el.parser.COERCE_TO_ZERO\n\nhttp://svn.apache.org/viewvc?rev=671358&view=rev\nhttp://tomcat.apache.org/tomcat-6.0-doc/config/systemprops.html", "id": 126753, "time": "2009-05-04T03:42:42Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2009-05-04T03:42:42Z", "is_private": false, "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 43285, "attachment_id": null, "id": 128004, "time": "2009-06-16T19:39:30Z", "creator": "richard@kennardconsulting.com", "creation_time": "2009-06-16T19:39:30Z", "is_private": false, "text": "Please note this feature/bug is being tracked (and hopefully fixed!) at:\n\nhttps://jsp-spec-public.dev.java.net/issues/show_bug.cgi?id=183"}]
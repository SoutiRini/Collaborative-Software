[{"count": 0, "tags": [], "bug_id": 43345, "text": "The apr-util bundled with Apache httpd 2.2.6 changed behaviour for the\n--with-expat switch of configure. Previously it was allowed to use\n--with-expat=xml/expat to compile the bundled expat, now only\n--with-expat=builtin does this.\n\nThe change was done in r493791 as a fix to BZ\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=28205.\n\nStrictly speaking it is nowhere documented, that a value of xml/expat should be\nused for building with the internal version, but it worked like this for a long\ntime, and still is the most logical interpretation of this value.\n\nProblem analysis: in file apr-util/build/apu-conf.m4 there is now:\n\n    125 AC_DEFUN([APU_FIND_EXPAT], [\n    126\n    127 apu_has_expat=0\n    128\n    129 # Default: will use either external or bundled expat.\n    130 apu_try_external_expat=1\n    131 apu_try_builtin_expat=1\n\nOK, we allow building with builtin expat\n\n    132\n    133 AC_ARG_WITH([expat],\n    134 [  --with-expat=DIR        specify Expat location, or 'builtin'], [\n    135   if test \"$withval\" = \"yes\"; then\n    136     AC_MSG_ERROR([a directory must be specified for --with-expat])\n    137   elif test \"$withval\" = \"no\"; then\n    138     AC_MSG_ERROR([Expat cannot be disabled (at this time)])\n    139   elif test \"$withval\" = \"builtin\"; then\n    140     apu_try_external_expat=0\n    141   else\n\nif we gave a path to configure, like xml/expat, we get into this part\n\n    142     # Add given path to standard search paths if appropriate:\n    143     if test \"$withval\" != \"/usr\"; then\n    144       APR_ADDTO(LDFLAGS, [-L$withval/lib])\n    145       APR_ADDTO(CPPFLAGS, [-I$withval/include])\n    146       APR_ADDTO(APRUTIL_INCLUDES, [-I$withval/include])\n    147     fi\n    148     # ...and refuse to fall back on the builtin expat.\n    149     apu_try_builtin_expat=0\n\nand we disable use of the builtin variant.\n\n    150   fi\n    151 ])\n    152\n\nI think, apu_try_builtin_expat should only be set to \"0\", if withval is !=\n\"xml/expat\". Possible patch would be:\n\n--- build/apu-conf.m4.orig      2007-09-10 13:00:21.000000000 +0200\n+++ build/apu-conf.m4   2007-09-10 20:36:46.000000000 +0200\n@@ -146,7 +146,11 @@\n       APR_ADDTO(APRUTIL_INCLUDES, [-I$withval/include])\n     fi\n     # ...and refuse to fall back on the builtin expat.\n-    apu_try_builtin_expat=0\n+    if test \"$withval\" != \"xml/expat\"; then\n+      apu_try_builtin_expat=0\n+    else\n+      apu_try_external_expat=0\n+    fi\n   fi\n ])", "id": 107984, "time": "2007-09-10T11:48:41Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-09-10T11:48:41Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 43345, "attachment_id": null, "is_private": false, "id": 108009, "time": "2007-09-11T02:48:44Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-09-11T02:48:44Z", "text": "This problem actually occured with the most recently tagged version (bundled\nwith httpd 2.2.6), which is not yet available in the bugzilla version list."}, {"count": 2, "attachment_id": null, "creator": "jorton@redhat.com", "text": "Sorry, but this was intentional.  Passing paths to unbuilt expat versions is\nundocumented, as you say, and is unsupportable in general - there is no way to\nwork out what version/type of the bundled expat.", "id": 109198, "time": "2007-10-10T08:53:12Z", "bug_id": 43345, "creation_time": "2007-10-10T08:53:12Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "text": "Following is a context diff of the changes I had to make to \norg.apache.tools.ant.taskdefs.Execute.java to support the evironment attribute \nof the property task on OS/390.  Sorry for the context diff, diff -u did not \nwork on my platforms.\n\nThanks,\nBob Withers\n\n*** Execute.java.orig Mon May 13 13:09:38 2002\n--- Execute.java Mon May 13 13:04:56 2002\n***************\n*** 164,171 ****\n                  // Just try to use what we got\n              }\n  \n!             BufferedReader in =\n!                 new BufferedReader(new StringReader(out.toString()));\n              String var = null;\n              String line, lineSep = System.getProperty(\"line.separator\");\n              while ((line = in.readLine()) != null) {\n--- 164,175 ----\n                  // Just try to use what we got\n              }\n  \n!             BufferedReader in;\n!             if (\"os/390\".equalsIgnoreCase(System.getProperty(\"os.name\")))\n!                 in = new BufferedReader(new StringReader(out.toString\n(\"Cp1047\")));\n!             else\n!                 in = new BufferedReader(new StringReader(out.toString()));\n! \n              String var = null;\n              String line, lineSep = System.getProperty(\"line.separator\");\n              while ((line = in.readLine()) != null) {\n***************\n*** 238,243 ****\n--- 242,251 ----\n                  String[] cmd = {\"command.com\", \"/c\", \"set\" };\n                  return cmd;\n              }\n+         }\n+         else if (osname.indexOf(\"os/390\") >= 0) {\n+             String[] cmd = {\"env\"};\n+             return(cmd);\n          }\n          else {\n              // Generic UNIX", "attachment_id": null, "id": 16022, "creator": "bwit@pobox.com", "time": "2002-05-13T18:20:05Z", "bug_id": 9043, "creation_time": "2002-05-13T18:20:05Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "text": "Could you please try the latest Ant 1.5beta branch version from \n<http://cvs.apache.org/~bodewig/gump/ant1.5beta/> or wait for 1.5beta2?\n\nThis is supposed to be fixed for zOS and I'd like to know whether the fix\n(using /bin/env) works for OS/390 as well.", "id": 16055, "time": "2002-05-14T06:00:35Z", "bug_id": 9043, "creation_time": "2002-05-14T06:00:35Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 9043, "is_private": false, "text": "1.5 doesn't seem to work for me on OS/390.  Running the following build file:\n<?xml version=\"1.0\"?>\n<project name=\"envtest\" default=\"all\">\n    <target name=\"all\">\n        <property environment=\"env\"/>\n        <property name=\"home\" value=\"${env.ANT_HOME}\"/>\n        <echo message=\"${home}\"/>\n    </target>\n</project>\n\nI get the following:\nwithers:/bea/work/withers: >ant -version\nApache Ant version 1.5Beta1 compiled on April 30 2002\nwithers:/bea/work/withers: >ant\nBuildfile: build.xml\n\nall:\n [property] Ignoring: \n [property] (\u00a0\u00f1<t\u00cd\u00cb\u00ca_/\u00d1%\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb\u00e0\u00ee<\u00ef|\u00ea.t\u00cd\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb\u00cf?\u00ca,&\u00a0\u00e8\u00e7t\u00c2\u00c1/\u00cf?\n\u00ca,\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb/>\u00c8\u00c2\u00d1>\u00c2\u00d1>e\u00cd\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb\u00cd\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb\u00c2\u00d1>\u00eeu\u00ea\u2018\u00c2\u00c1/%?/\u00c0\u00cb\u00c8\u00cd\u00cc\u2022^\u00ca\u00c1%\n\u00c2\u00d1>\u00e8\u00ed\u00ec\u00e0\u00f1\u00eat\u00c2\u00c1/%?/\u00c0\u00cb\u00c8\u00cd\u00cc\u2022^\u00ca\u00c1%\u00e1\u00e0\u00f1\u00e8|\u00eat\u00ce\u00d1\u00eb\u00e7\u00e1<<t\u00c2\u00d1>\u00cb\u00c7&\u00eb\u2018t\n         <|\u00e5+\u00a0(\u00e1\n                &\u00ef\u00e0\u20ac^t\u00c2\u00d1>\u00c1>\u00ce\u00eb\u00e8\u00e1&<\u00f1\u00e2t>?\n>\u00c1<|\u00e5+\u00a0(\u00e1t\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb|\u00ea\u00f1\u00e5^&\u00a0\u00e8\u00e7t\u00c2\u00d1>e\u00cd\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb\u00cd\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb\u00c2\u00d1>\u00eeu\u00ea\u2018\u00c2\u00c1/%?/\u00c0\u00cb\u00c8\u00cd\u00cc\u2022^\u00ca\u00c1%\n\u00c2\u00d1><\u00a0+\u00e5t\u00e4\u00ef\u00f1+\u00e0|\u00ef\u00f1\u00e0t\u201d\u2018\u2122\u201d\u201c\u2018<\u00f1\u00e2&\u00a0\u00e8\u00e7t\u00f8\u00cd\u00c2\u00a2\u2018e\u201c\u00c2\u00d1>\u00f8\u00cd\u00c2\u00a2\u2018e\u201c\u00c2\u00d1>\u00c4%/\u00cb\u00cb\u00d1\u00c4\u00c2\u00c1/%?/\u00c0\u00cb\u00c8\u00cd\u00cc\u2022^\u00ca\u00c1%%\u00d1\u00c2%\n\u00d1\u00c2\u00cd\u00cb\u00ca%\u00d1\u00c2e\u00e0\u00f1\u00eb&<\u00a0\u00dftue\u2018\u2122\u00e4\u00ee\u00eb\u00ea||\u00e8t\u00f8\u00cb\u00c1\u00ca\u00ce\u00c1\u00ca\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb\u00c2 \u00c0/%\u00ca\u00c1\u00f8?\u00cb\u00ca\u00c1\u00f8?\u00cb\u00e8\u00e1\u00ea\n(t\u00cc\u00c8\u00c1\u00ca_^\u00e2&\u00ec^\u00eb\u00e7\u00a0\u00ea\u00e1\u00a0\u00ebt\u00df\u00e1\u00eb(\u00a0+&\u00a0\u00e5\u00e1\u00eat\u00cd\u00cb\u00ca%?\u00c4/%\u00c2\u00d1>%\u00c1\u00cb\u00cb\u20ac\u00c1\u20ac&\u00c1\u20ac\n\u00c0\u2030|(\u00e1t\u00cd\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb\u00a2\u00a0\u00ee\u00a0^\u00e7|(\u00e1t\u00f8\u00cd\u00c2\u00a2\u2018e\u201c\u00e8!t\u00e4\u00eb\u00e8\u00e4\u00e0\u00e8\u00a0+\u00e8^\u00e7|(\u00e1t\u00c2\u00c1/\u00cf?\u00ca,\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb/>\u00c8(\u00a0+&\u00a0\u00e8\u00e7t\u00cd\u00cb\u00ca_/>\n<|\u00ea\u00f1\u00e5^<\u00f1\u00e2&\u00a0\u00e8\u00e7t\u00c2\u00c1/%?/\u00c0\u00cb\u00c8\u00cd\u00cc\u2022^\u00ca\u00c1%%\u00d1\u00c2%\u00d1\u00c2\u00cd\u00cb\u00ca%\u00d1\u00c2e+<\u00eb&\u00a0\u00e8\u00e7t\u00cd\u00cb\u00ca%\u00d1\u00c2>%\u00cb_\u00cb\u00c5\n<\n+\u00f1\u00e2(^\u00a2\u00a0\u00ee\u00a0^\u00e4|((\u00a0+\u00e0^<\u00f1+\u00e1t\u00f8\u00cd\u00c2\u00a2\u2018e\u201c\u00c2\u00d1>\u00a6/\u00ce/\u20ac\u00c4%/\u00cb\u00cb\u00f8/\u00c8\u00c7\u20ac\u00c2\u00c1/\u00cf?\u00ca,\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb/>\u00c8%\u00d1\u00c2\u00cc_%\n\u00f8/\u00ca\u00cb\u00c1\u00ca/\u00f8\u00d1\u00cbe\u00a6/\u00ca\u00c2\u00c1/\u00cf?\u00ca,\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb/>\u00c8%\u00d1\u00c2\u00cc_%&/\u00ca\u00cb\u00c1\u00ca\u00a0&\u00f1\u00cbe\u00a6/\u00ca\u00c2\u00c1/\u00cf?\u00ca,\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb/>\u00c8%\n\u00d1\u00c2\u00cc\u00c1\u00ca\u00c4\u00c1\u00cb\u00d1_\u00f8%e\u00a6/\u00ca\u00c2\u00c1/\u00cf?\u00ca,\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb/>\u00c8%\u00d1\u00c2\u00cc\u00c1\u00ca\u00c4\u00c1\u00cb\u00f1_\u00f8%e\u00a6/\u00ca\u00c2\u00c1/\u00cf?\u00ca,\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb/>\u00c8%\u00d1\u00c2?\u00f8\u00c8\u00d1?>/%\ne\u00a6/\u00ca\u00c2\u00c1/\u00cf?\u00ca,\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb/>\u00c8%\u00d1\u00c2/>\u00c8e\u00a6/\u00ca\u00f8\u00cd\u00c2\u00a2\u2018e\u201c%\u00d1\u00c2\u00c8??%\u00cbe\u00a6/\u00ca\u20ac\u00e0/>\u00c8e\u00c7?_\u00c1t\u00c2\u00c1/\u00cf?\u00ca,\u00cf\u00d1\u00c8\u00c7\u00c1\u00ca\u00cb/>\u00c8\u20ac?\n\u00ca\u00c5e/\u00f8/\u00c4\u00c7\u00c1e\u00c8??%\u00cbe/>\u00c8e(/\u00d1>\n     [echo] ${env.ANT_HOME}\n\nBUILD SUCCESSFUL\nTotal time: 5 seconds\nwithers:/bea/work/withers: >?1;2c^[[?1;2c^[[?1;2c^[[?1;2c  \n", "id": 16070, "time": "2002-05-14T13:04:03Z", "creator": "bwit@pobox.com", "creation_time": "2002-05-14T13:04:03Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 9043, "attachment_id": null, "is_private": false, "id": 16074, "time": "2002-05-14T13:44:20Z", "creator": "bodewig@apache.org", "creation_time": "2002-05-14T13:44:20Z", "text": "OK, so we need to change the encoding for OS/390.  Do you know whether this\nis also true on z/OS?  I wonder why Java doesn't use Cp1047 as the platform's\ndefault encoding."}, {"count": 4, "tags": [], "creator": "bwit@pobox.com", "attachment_id": null, "id": 16080, "time": "2002-05-14T14:05:09Z", "bug_id": 9043, "creation_time": "2002-05-14T14:05:09Z", "is_private": false, "text": "Sorry, I don't know about zOS.  I get the same results if I add \n-Dnative.encoding=Cp1047 to the ant shell script.\n\nFollowing is the VM info I'm using:\nwithers:/bea/work/withers: >java -version\njava version \"1.3.1\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.3.1)\nClassic VM (build 1.3.1, J2RE 1.3.1 IBM OS/390 Persistent Reusable VM build \nhm131s-20020207 (JIT enabled: jitc))\n"}, {"count": 5, "tags": [], "bug_id": 9043, "text": "I think this may be a deeper problem that it seems at first glance.\n\nDo other <exec> commands work as expected or do you get garbled output here as\nwell?  Using <exec>'s outputproperty would be very interesting.\n\nThe problem seems to be that we are \"tunneling\" the process output through a\nByteArrayOutputStream and may be losing encoding information there AFAICS.", "id": 16090, "time": "2002-05-14T16:08:10Z", "creator": "bodewig@apache.org", "creation_time": "2002-05-14T16:08:10Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "bwit@pobox.com", "text": "Stefan,\n\nI don't know about other exec's, if I get time I'll see what I can find out.  \nThe patch I submitted mades the environment attribute of ant 1.4x work \ncorrectly on my platform.  I haven't looked at how this code has changed for \n1.5.  Perhaps there is something unique about what I'm running on that makes it \nunsuitable for general use but it works for me.\n\nBob", "id": 16097, "time": "2002-05-14T17:44:58Z", "bug_id": 9043, "creation_time": "2002-05-14T17:44:58Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 9043, "attachment_id": null, "is_private": false, "id": 16159, "time": "2002-05-15T14:19:51Z", "creator": "bodewig@apache.org", "creation_time": "2002-05-15T14:19:51Z", "text": "The only thing that makes your stuff unique is OS/390, I guess.\n\nIt would be very easy to adapt your patch to 1.5 (no need for you to do it),\nbut I'd really like to explore whether we are dealing with a deeper problem\nthat needs a more general solution first."}, {"count": 8, "attachment_id": null, "creator": "bodewig@apache.org", "text": "Could you please try the latest version from\n<http://cvs.apache.org/~bodewig/gump/ant1.5beta/> and verify that it works now?\n", "id": 16804, "time": "2002-05-28T08:50:41Z", "bug_id": 9043, "creation_time": "2002-05-28T08:50:41Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "creator": "bodewig@apache.org", "text": "Bob, could you please confirm that it works in 1.5beta2?", "id": 17565, "time": "2002-06-11T10:24:22Z", "bug_id": 9043, "creation_time": "2002-06-11T10:24:22Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 9043, "text": "Stefan,\n\nI tested ant1.5-beta2 under both OS/390 and z/OS.  It works correctly under \nboth.  Thanks.\n\nBob", "id": 17578, "time": "2002-06-11T12:36:48Z", "creator": "bwit@pobox.com", "creation_time": "2002-06-11T12:36:48Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "text": "Thank you for testing.", "attachment_id": null, "id": 17580, "creator": "bodewig@apache.org", "time": "2002-06-11T13:12:35Z", "bug_id": 9043, "creation_time": "2002-06-11T13:12:35Z", "is_private": false}]
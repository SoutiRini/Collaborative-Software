[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "The following is based on reviewing the code of CoyoteAdapter.postParseRequest(..)\n\nSuppose the following scenario:\n\n1) There are multiple versions of /foo web application.\n2) Both /foo and ROOT web application create session cookies\n3) A new version of /foo is deployed in parallel to the old one\n4) Browser sends several SESSIONID cookies: for the ROOT webapp and for the old version of /foo webapp.\n\nWill the old version of /foo selected in this scenario?\n\nThe problem is that Tomcat first selects the only sessionID among several cookies (in CoyoteAdapter.parseSessionCookiesId(..)) and then uses that only sessionID to select webapp version (in CoyoteAdapter.postParseRequest(..)).\n\n\nAll works if there is a cookie that belongs to the latest version of the webapp. On the first mapping the request is mapped to the latest version. Thus 'parseSessionCookiesId(..)' by default looks for sessionid that belongs to the latest version of the web application.\n\nIf the cookie belongs to an earlier version, the 'parseSessionCookiesId(..)' method selects sessionID value from the last cookie among SESSIONID cookies sent by browser.", "id": 173788, "time": "2014-03-13T10:19:00Z", "bug_id": 56256, "creation_time": "2014-03-13T10:19:00Z", "is_private": false}, {"count": 1, "tags": [], "text": "The call to isRequestedSessionIdValid() checks all versions of the app for a match.", "attachment_id": null, "id": 173820, "creator": "markt@apache.org", "time": "2014-03-14T15:08:45Z", "bug_id": 56256, "creation_time": "2014-03-14T15:08:45Z", "is_private": false}]
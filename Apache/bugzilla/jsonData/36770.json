[{"count": 0, "attachment_id": null, "bug_id": 36770, "text": "It's not possible to assign different values of KeepAliveTimeout\nto different <VirtualHost>s. In every VirtualHost (in which KeepAlive is set to\nOn) the value of KeepAliveTimeout from the first VirtualHost is used.", "id": 80312, "time": "2005-09-22T13:52:48Z", "creator": "jaeschke@bbf.dipf.de", "creation_time": "2005-09-22T13:52:48Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "creator": "jeremyk@newdream.net", "text": "I'm currently experiencing this bug as well.  I do have a little more\ninformation about it, however.\n\nIt appears that the limit is not per server overall, it's per IP address.\n\nSay we have something like this:\n<VirtualHost 127.0.1.2:80>\nServerName virt1.example.com\nKeepAliveTimeout 20\n</VirtualHost>\n\n<VirtualHost 127.1.2.3:80>\nServerName virt2.example.com\nKeepAliveTimeout 14\n</VirtualHost>\n\n<VirtualHost 127.0.1.2:80>\nServerName virt3.example.com\nKeepAliveTimeout 3\n</VirtualHost>\n\n<VirtualHost 127.1.2.3:80>\nServerName virt4.example.com\nKeepAliveTimeout 12\n</VirtualHost>\n\nThen the keepalivetimeouts per domain will be the following:\nvirt1.example.com: 20\nvirt2.example.com: 14\nvirt3.example.com: 20\nvirt4.example.com: 14\n\nAdditionally, if we remove the KeepAliveTimeout setting from the\nvirt1.example.com virtualdomains, then both virt1.example.com and\nvirt3.example.com will revert to the default of 15 (or the global setting\nspecified outside of a virtualhost)\n\nCoincidentally, you can still toggle keepalives on and off per domain,\nregardless of load order.  If we change our config to look something like this:\n<VirtualHost 127.0.1.2:80>\nServerName virt1.example.com\nKeepAliveTimeout 20\n</VirtualHost>\n\n<VirtualHost 127.1.2.3:80>\nServerName virt2.example.com\nKeepAliveTimeout 14\nKeepAlive Off\n</VirtualHost>\n\n<VirtualHost 127.0.1.2:80>\nServerName virt3.example.com\nKeepAliveTimeout 3\n</VirtualHost>\n\n<VirtualHost 127.1.2.3:80>\nServerName virt4.example.com\nKeepAliveTimeout 12\n</VirtualHost>\n\nthen virt2.example.com will not allow keepalives, and virt4.example.com will\nhave a 14 second keepalive timeout.\n\nI can provide a full config file if need be.  I'm using apache 2.0.54 with the\nfollowing modules loaded (not in any particular order):\nmod_autoindex\nmod_auth\nmod_auth_digest\nmod_auth_mysql\nlibphp4\nmod_access\nmod_actions\nmod_alias\nmod_cgi\nmod_deflate\nmod_dir\nmod_env\nmod_expires\nmod_headers\nmod_include\nmod_log_config\nmod_logio\nmod_mime\nmod_negotiation\nmod_rewrite\nmod_ssl\nmod_suexec\nmod_fastcgi\nmod_security\nmod_setenvif\nmod_encoding\nmod_dav\nmod_dav_fs\nmod_cband\nmod_dav_svn\nmod_authz_svn\nmod_limitipconn\n\nSome of those modules might be in-house, although I don't think so.  If one\nisn't recognized, let me know and I will find out where it came from.\n\nIf you need any additional information, I can provide anything required, just\nsay the words :)", "id": 107082, "time": "2007-08-22T16:24:25Z", "bug_id": 36770, "creation_time": "2007-08-22T16:24:25Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 36770, "text": "This works as designed. KeepaliveTimeout is a connection property (you can sent\nrequests to different name based virtual hosts over the same TCP/IP connection)\nthus is cannot be set differently in name based virtual hosts. As you have seen\nit is perfectly possible to adjust it individually for IP/Port based virtual\nhosts. In the case of name based virtual hosts it is the usual behaviour to use\nthe setting of the first name based virtual host (the default host) for such\nproperties.\nI admit that this is not clearly expressed in the documentation. So I leave this\nreport open as a documentation bug.\n", "id": 107180, "time": "2007-08-23T11:34:21Z", "creator": "rpluem@apache.org", "creation_time": "2007-08-23T11:34:21Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 36770, "is_private": false, "id": 107182, "creation_time": "2007-08-23T11:53:42Z", "time": "2007-08-23T11:53:42Z", "creator": "jeremyk@newdream.net", "text": "it's strange though, that you can *disable* keepalives on a per virtualhost\nbasis, but not change the timeout?", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 36770, "is_private": false, "text": "(In reply to comment #3)\n> it's strange though, that you can *disable* keepalives on a per virtualhost\n> basis, but not change the timeout?\n\nThis is a partial valid point, but\n\nIf a request goes to a name based host that has set keepalive off the connection\ncan be shutdown by the server and this seems to be the right thing to do in this\nsituation.\nOn the other hand if a request goes to a name based virtual host and the next\nrequest on this connection goes to a different name based virtual host. What is\nthe correct keepalive timeout to use?\nYou could find arguments for both options:\n1. It should be the one of the host that just processed the request.\n2. It should be the one of the host that processes the next request.\n", "id": 107192, "time": "2007-08-23T12:34:38Z", "creator": "rpluem@apache.org", "creation_time": "2007-08-23T12:34:38Z", "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "jeremyk@newdream.net", "is_private": false, "id": 107198, "time": "2007-08-23T13:24:49Z", "bug_id": 36770, "creation_time": "2007-08-23T13:24:49Z", "tags": [], "text": "(In reply to comment #4)\n> This is a partial valid point, but\n> \n> If a request goes to a name based host that has set keepalive off the connection\n> can be shutdown by the server and this seems to be the right thing to do in this\n> situation.\n\nAgreed.\n\n> On the other hand if a request goes to a name based virtual host and the next\n> request on this connection goes to a different name based virtual host. What is\n> the correct keepalive timeout to use?\n> You could find arguments for both options:\n> 1. It should be the one of the host that just processed the request.\n> 2. It should be the one of the host that processes the next request.\n\nwe can't possibly know what host is going to process the next request though,\nsince we haven't even gotten the request.  I would say it makes the most sense\nto use the keepalivetimeout setting for the virtualhost that processed the most\nrecent request.  Not to mention that such a scenario is probably pretty highly\nunlikely."}, {"count": 6, "attachment_id": 21432, "creator": "takashi.asfbugzilla@tks.st", "text": "Created attachment 21432\nadd a note", "id": 113151, "time": "2008-01-25T16:30:07Z", "bug_id": 36770, "creation_time": "2008-01-25T16:30:07Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "text": "committed as r653856 for trunk", "is_private": false, "bug_id": 36770, "id": 116308, "time": "2008-05-06T10:58:46Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-05-06T10:58:46Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "An improved patch was committed in r655438.\nbackported to 2.2 as r655477.\n2.0 as r655483.", "is_private": false, "bug_id": 36770, "id": 116510, "time": "2008-05-12T08:52:01Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-05-12T08:52:01Z", "attachment_id": null}]
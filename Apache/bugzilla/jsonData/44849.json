[{"count": 0, "tags": [], "text": "I've been investigating a problem with loading 3rd-party tasks like ivy, obfuscate, and jalopy from the ~/.ant/lib directory on a Fedora Core 6 system with the vendor-provided ant-1.6.5 package.  When I upgraded to ant-1.7.0 from FC8 it had the same problem, but the problem does not exist with ant-1.6.2 from FC4.  When I build and install ant-1.7.0 in my home directory, it will work only if the vendor ant package is not installed or I run ant with the --noconfig option.\n\nAfter trying to start the launcher directly with various configurations, I discovered that while the following command works:\n\njava -classpath /home/tbeattie/src/ant-1.7.0/lib/ant-launcher.jar -Dant.home=/home/tbeattie/src/ant-1.7.0 -Dant.library.dir=/home/tbeattie/src/ant-1.7.0/lib org.apache.tools.ant.launch.Launcher -cp ''\n\nthis command fails:\n\njava -classpath /home/tbeattie/src/ant-1.7.0/lib/ant-launcher.jar:/home/tbeattie/src/ant-1.7.0/lib/ant.jar -Dant.home=/home/tbeattie/src/ant-1.7.0 -Dant.library.dir=/home/tbeattie/src/ant-1.7.0/lib org.apache.tools.ant.launch.Launcher -cp ''\n\nThe only difference is adding ant.jar to the -classpath (and this is the locally installed ant.jar, not the vendor ant.jar).  The error is:\n\n----------------------------------------------\nBuildfile: build.xml\n\nresolve:\n\nBUILD FAILED\n/home/tbeattie/src/apache-ivy-2.0.0-beta2/src/example/hello-ivy/build.xml:38: Problem: failed to create task or type antlib:org.apache.ivy.ant:retrieve\nCause: The name is undefined.\nAction: Check the spelling.\nAction: Check that any custom tasks/types have been declared.\nAction: Check that any <presetdef>/<macrodef> declarations have taken place.\n\nThis appears to be an antlib declaration. \nAction: Check that the implementing library exists in one of:\n        -/home/tbeattie/src/ant-1.7.0/lib\n        -/home/tbeattie/.ant/lib\n        -a directory added on the command line with the -lib argument\n\n\nTotal time: 0 seconds\n==============================================\n\nNote that the system-wide ant configuration file /etc/ant.conf installed by Fedora sets rpm_mode=true by default, which causes the ant startup script to set LOCALCLASSPATH to include ant.jar.  Since build-classpath only searches system java directories, I don't think it's possible to test a local install of the ant startup script with \"rpm_mode=true\" (it can't find ant-launcher).  You can only test with a system install.\n\nThe converse cannot be directly tested on a vendor ant install because it cannot find org.apache.tools.ant.Main if ant.jar is not on the classpath.\n\nI believe this is the same bug that was reported in 35060.  I am not certain whether it is related to bug 41587.", "attachment_id": null, "id": 115754, "creator": "tbeattie@boingo.com", "time": "2008-04-21T13:25:26Z", "bug_id": 44849, "creation_time": "2008-04-21T13:25:26Z", "is_private": false}, {"count": 1, "tags": [], "text": "?why is this a bug?\n\nant.jar is *not* meant to be on the classpath,\nI have *no* idea why it would work with ant 1.6.2\nas the way that ~/.ant/lib and $ANT_HOME/lib work\nis that ant_launcher.jar creates a classloader\nthat contains ant.jar + all the jars in $ANT_HOME/lib\n+ all the jars in ~/.ant/lib and any jars in directories\nspecified on the the command line specified by -lib.\n\nThis means that ant.jar classes have (import) access to jars in ~/.ant/lib\nand $ANT_HOME/lib - which is the way that optional tasks work.\n\nIf ant.jar is on the classpath, this mechanism does not work.\n\n(I.e the jpackage version of ant does not support ~/.ant/lib).\n\nPeter\n", "is_private": false, "id": 115757, "creator": "peterreilly@apache.org", "time": "2008-04-21T15:30:31Z", "bug_id": 44849, "creation_time": "2008-04-21T15:30:31Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "I did not know that.  Apparently, neither does the JPackage Project, which is the basis for the Red Hat / Fedora packages.  I'll open a bug report with Red Hat.\n", "attachment_id": null, "id": 115758, "creator": "tbeattie@boingo.com", "time": "2008-04-21T15:47:26Z", "bug_id": 44849, "creation_time": "2008-04-21T15:47:26Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 51559, "text": "Created attachment 27319\nfiles causing the problems\n\nIn our application we process MS Outlook files (msg) with POIFS.\n\nWith the file attached I get various exceptions:\n\npoi-3.2-FINAL\n{code}\njava.io.IOException: Cannot remove block[ 114 ]; out of range[ 0 - 23 ]\n      at org.apache.poi.poifs.storage.BlockListImpl.remove(BlockListImpl.java:104)\n      at org.apache.poi.poifs.storage.BlockAllocationTableReader.fetchBlocks(BlockAllocationTableReader.java:190)\n      at org.apache.poi.poifs.storage.BlockListImpl.fetchBlocks(BlockListImpl.java:130)\n      at org.apache.poi.poifs.filesystem.POIFSFileSystem.processProperties(POIFSFileSystem.java:524)\n      at org.apache.poi.poifs.filesystem.POIFSFileSystem.<init>(POIFSFileSystem.java:176)\n{code}\n\nPOI-3.8 beta 3 and SVN trunk (rev. 1151057)\n{code}\njava.lang.ArrayIndexOutOfBoundsException: 0\n\tat org.apache.poi.poifs.storage.SmallDocumentBlock.getDataInputBlock(SmallDocumentBlock.java:194)\n\tat org.apache.poi.poifs.filesystem.POIFSDocument.getDataInputBlock(POIFSDocument.java:282)\n\tat org.apache.poi.poifs.filesystem.ODocumentInputStream.getDataInputBlock(ODocumentInputStream.java:107)\n\tat org.apache.poi.poifs.filesystem.ODocumentInputStream.<init>(ODocumentInputStream.java:71)\n\tat org.apache.poi.poifs.filesystem.DocumentInputStream.<init>(DocumentInputStream.java:60)\n{code}\n\nI've also attached a code snippet to reproduce this behaviour.\n\nAs this msg file is not produced by Outlook itself but by a 3rd party application, I'm not sure if there is a bug in POIFS or if the file is corrupt.\nThe producer of this application argues that Outlook can open that file, so \"it must be correct\".\n\nDo you have a hint for me what might be the problem here or possibly a work around?\n\nThanks a lot,\nBenjamin", "id": 148170, "time": "2011-07-26T10:54:16Z", "creator": "b.geisselmeier@levigo.de", "creation_time": "2011-07-26T10:54:16Z", "is_private": false, "attachment_id": 27319}, {"count": 1, "tags": [], "creator": "b.geisselmeier@levigo.de", "text": "Created attachment 27320\ncode snippet to reproduce error", "id": 148171, "time": "2011-07-26T10:56:25Z", "bug_id": 51559, "creation_time": "2011-07-26T10:56:25Z", "is_private": false, "attachment_id": 27320}, {"count": 2, "attachment_id": null, "creator": "apache@gagravarr.org", "is_private": false, "id": 148193, "time": "2011-07-26T21:15:41Z", "bug_id": 51559, "creation_time": "2011-07-26T21:15:41Z", "tags": [], "text": "Any chance you could try with NPOIFSFileSystem from POI 3.8 beta 3? Rather than opening a POIFSFileSystem, open a NPOIFSFileSytem, and pass the root of that to HSMF. There's a fair chance it'll work with the new NPOIFS code where it may have previously failed for POIFS"}, {"count": 3, "tags": [], "bug_id": 51559, "attachment_id": null, "is_private": false, "id": 148240, "time": "2011-07-28T08:13:30Z", "creator": "b.geisselmeier@levigo.de", "creation_time": "2011-07-28T08:13:30Z", "text": "Thank you for this hint. With the _N_POIFSFileSytem this file can be accessed.\n\nSo I close this issue now and wait for the final release of POI 3.8\n\nBest Regards,\nBenjamin"}]
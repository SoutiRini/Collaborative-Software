[{"count": 0, "tags": [], "bug_id": 29051, "is_private": false, "text": "Also present in 1.5 and 1.5.4.\n\nWe have a three level build system:\n\nbuild.xml        builds the entire project\nsub_build.xml    builds a subsystem within the project\ncommon.xml       encapsulates common targets that do actual work\n                 eg <javac ...>\n\nIn build.xml we have\n\n  <!-- Want to use top.filter.id to parameterise build.xml for different\n       projects using the same subsystem, to exclude parts of subsystems\n       that are not required. -->\n\n  <!-- Problem happens even if patternset is nested in target below. -->\n  <patternset id=\"top.filter.id\">\n    <exclude name=\"**/unwanted/directory/**\"\n    ...\n  </patternset>\n\n  <target name=\"subsysname\" depends=\"...\">\n    <ant antfile=\"path/to/sub_build.xml\"\n         target=\"${subtarget}\"\n         inheritAll=\"true\"\n         inheritRefs=\"true\">\n       <!-- Problem happens even if we add an explicit reference, with or\n            without torefid to a new id for the sub_build.xml to use, and\n            even with inheritRefs=\"false\" and an explicit reference. -->\n       <reference refid=\"top.filter.id\"/>\n    </ant>\n  </target>\n\nThe value of subtarget above defaults to 'all', and there is a set of standard\ntargets that must be available in all sub_build.xml files.\nVarying the value of subtarget property varies which target runs in sub_build.\n\nIn sub_build.xml we have targets which are driven by the standard targets, eg\n'all', to do work. To standardize how that work is defined, we have common.xml\n\n  <patternset id=\"sub.filter.id\">\n    <!-- HERE IS   THE PROBLEM -->\n    <!-- ant reports Reference top.filter.id not found, so part one of the\n         workaround is to comment this out and 'hack' my common.xml . -->\n    <patternset refid=\"top.filter.id\"/>\n    <!-- HERE ENDS THE PROBLEM -->\n\n    <exclude name=\"**/unwanted/directory/**\"\n    ...\n  </patternset>\n\n  <target name=\"compile_main\">\n    <ant antfile=\"path/to/common.xml\"\n         target=\"compile_main\"\n         inheritAll=\"true\"\n         inheritRefs=\"true\">\n      <property name=\"subname\" value=\"sub-build-name\"/>\n      <property name=\"subdir\" value=\"sub/build/dir\"/>\n    </ant>\n  </target>\n\nIn common.xml we have\n\n  <target name=\"compile_main\">\n    ...\n    <javac taskname=\"${subname}.javac\"\n           destdir=\"${main.classes}\"\n           deprecation=\"${main.deprecation}\"\n           listfiles=\"${main.listfiles}\">\n      <classpath refid=\"main.classpath\"/> <!-- inherited property -->\n      <src path=\"${src}\"/>\n      <include name=\"${subdir}/**/*.java\"/>\n      <patternset refid=\"sub.filter.id\"/> <!-- inherited reference -->\n      <!-- WORKAROUND is to use top.filter.id directly in common.xml\n      <patternset refid=\"top.filter.id\"/>\n      -->\n    </javac>\n  </target>", "id": 57581, "time": "2004-05-18T05:36:01Z", "creator": "johnk@nstc.nec.com.au", "creation_time": "2004-05-18T05:36:01Z", "attachment_id": null}, {"count": 1, "text": "\n\n*** This bug has been marked as a duplicate of 22690 ***", "bug_id": 29051, "is_private": false, "id": 58037, "time": "2004-05-25T11:54:09Z", "creator": "bodewig@apache.org", "creation_time": "2004-05-25T11:54:09Z", "tags": [], "attachment_id": null}]
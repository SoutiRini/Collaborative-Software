[{"count": 0, "tags": [], "bug_id": 50553, "attachment_id": null, "id": 143132, "time": "2011-01-06T13:36:02Z", "creator": "moped03@gmail.com", "creation_time": "2011-01-06T13:36:02Z", "is_private": false, "text": "For some situations, it is insufficient to have srcfile (and probably also targetfile) available only as a tag in the arguments to the apply executable.  \n\nFor example: if the source file is a sql script, and my executable is psql, I need to pass an argument -f sourcefile.sql like so:\n\npsql -f sourcefile.sql dbname\n\nThe following does not work, because there is no way to make srcfile the optarg to -f.\n\n  <apply executable=\"${psql.bin}\">\n    <fileset dir=\"${sqlscripts.home}\" includes=\"**/*.sql\" />\n    <!-- whoops, this doesn't work -->\n    <srcfile />\n    <arg value=\"${db.name}\" />\n  </apply>\n\nWhat would be simply awesome is if you could do something like this:\n\n  <apply executable=\"${psql.bin}\" srcfileproperty=\"sqlinput\"\n        addsourcefile=\"false\">\n    <fileset dir=\"${sqlscripts.home}\" includes=\"**/*.sql\" />\n    <arg value=\"-f${sqlinput}\" />\n    <arg value=\"${db.name}\" />\n  </apply>\n\nThis would follow the existing convention for outputproperty and errorproperty, and make apply much more flexible.\n\nThe workaround I've been using in the meantime is to apply a shell script which can put the -f and the source file together before calling psql.  This is kind of gross and kind of defeats the purpose of using ant in the first place."}, {"count": 1, "tags": [], "bug_id": 50553, "text": "Using properties is not possible because they are immutable.\nHaving that said, the \"valid\" alternative would be attributes like in <macrodef>. So your example would look like\n\n  <apply executable=\"${psql.bin}\" srcfileproperty=\"sqlinput\"\n        addsourcefile=\"false\">\n    <fileset dir=\"${sqlscripts.home}\" includes=\"**/*.sql\" />\n    <arg value=\"-f@{sqlinput}\" /> <!-- see the @ instead the $ here -->\n    <arg value=\"${db.name}\" />\n  </apply>\n\nOr with standard names\n\n  <apply executable=\"${psql.bin}\" addsourcefile=\"false\">\n    <fileset dir=\"${sqlscripts.home}\" includes=\"**/*.sql\" />\n    <arg value=\"-f@{srcfile}\" /> <!-- the same name as the tag -->\n    <arg value=\"${db.name}\" />\n  </apply>\n\nBut I am not sure if you can't achieve your goal with the current implementation:\n\n  <apply executable=\"${psql.bin}\">\n    <fileset dir=\"${sqlscripts.home}\" includes=\"**/*.sql\" />\n    <arg value=\"-f\"/>\n    <srcfile/>\n    <arg value=\"${db.name}\" />\n  </apply>\n\n(Haven't tested that ... but that's what I read in the manual)", "id": 143134, "time": "2011-01-06T14:30:09Z", "creator": "jan@materne.de", "creation_time": "2011-01-06T14:30:09Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 50553, "attachment_id": null, "id": 143136, "time": "2011-01-06T14:53:20Z", "creator": "moped03@gmail.com", "creation_time": "2011-01-06T14:53:20Z", "is_private": false, "text": "I'll have to take a look at the source to understand the issue with immutable properties, since I'm not sure how the errorproperty and outputproperty would get set.\n\nThat said, it actually does work to use <arg value=\"-f\" /><srcfile />.  I just tried.  I thought I had seen in the past that in some cases separating the option from it's optarg (<arg value=\"-o\" /><arg value=\"optarg\" />) caused the executable being invoked to not correctly see the optarg as being associated with its option.  This would subsequently cause a failure when the executable parsed its arguments.\n\nInteresting.  Thanks for the help.\n\nYou've resolved my issue; I suppose we can go ahead and close the bug unless you want to tackle the much more broadly-scoped issue of getting the dirname of srcfile and passing *that* as an argument to the executable ;-)"}, {"count": 3, "tags": [], "bug_id": 50553, "attachment_id": null, "id": 143137, "time": "2011-01-06T15:44:54Z", "creator": "jan@materne.de", "creation_time": "2011-01-06T15:44:54Z", "is_private": false, "text": "closed as suggested"}, {"count": 4, "tags": [], "text": "the issue with immutable properties would be that once the property was set\n(after the first file) it couldn't be changed for the second file.\n\nIf you really needed -fFILENAME as a single argument, <srcfile prefix=\"-f\"/>\nwould solve it.", "is_private": false, "id": 143162, "creator": "bodewig@apache.org", "time": "2011-01-07T03:19:22Z", "bug_id": 50553, "creation_time": "2011-01-07T03:19:22Z", "attachment_id": null}]
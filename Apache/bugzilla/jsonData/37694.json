[{"count": 0, "tags": [], "bug_id": 37694, "attachment_id": null, "is_private": false, "id": 82985, "time": "2005-11-29T17:10:52Z", "creator": "andreas.krueger@famsik.de", "creation_time": "2005-11-29T17:10:52Z", "text": "I recently had reason to code something like this, in an ant build.xml file:\n\n      <java\n         classname=\"org.apache.tools.ant.launch.Launcher\"\n         fork=\"true\"\n         failonerror=\"true\"\n         dir=\"${sub.builddir}\"\n         timeout=\"4000000\"\n      >\n         <classpath>\n            <pathelement location=\"${env.ANT_HOME}/lib/ant-launcher.jar\"/>\n         </classpath>\n         <arg value=\"-buildfile\"/><arg file=\"${sub.buildfile}\"/>\n         <arg value=\"-Dthis=this\"/>\n         <arg value=\"-Dthat=that\"/>\n         <arg value=\"-Dthe.other=the.other\"/>\n         <arg value=\"${sub.target}\"/>\n      </java>\n\nThe code at first did not work.\n\nMy ant files have come to rely on the property \"basedir\". This was not set for\n${sub.buildfile}. After I found that out, the fix was easy:\n\n         <arg value=\"-Dbasedir=${sub.builddir}\"/>\n\nIn my opinion, the property \"basedir\" should always be set by the launcher.\n\nIf that cannot be done for some reason, the second best solution is: The\ncircumstances when it is set and when not should be documented.\n\nMy suggestion:\n\napache-ant-1.6.5/docs/manual/running.html#viajava"}, {"count": 1, "tags": [], "text": "Maybe I should have included the following code snipped before the one I quoted:\n\n      <property environment=\"env\" />\n      <fail message=\"ANT_HOME not set in the environment - sorry.\"\n            unless=\"env.ANT_HOME\" />", "is_private": false, "id": 82987, "creator": "andreas.krueger@famsik.de", "time": "2005-11-29T17:13:58Z", "bug_id": 37694, "creation_time": "2005-11-29T17:13:58Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "stevel@apache.org", "text": "I've just been looking at the launcher code. It doesnt set -basedir. I dont know\nexactly where it is being set, it kind of looks like it happens in the XML parse\nprocess. \n\nSo I dont know what to make of this bug. Something is happening, but it is not\nin the launcher.\n\n", "id": 91233, "time": "2006-07-12T21:41:44Z", "bug_id": 37694, "creation_time": "2006-07-12T21:41:44Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 37694, "attachment_id": null, "text": "I do not see the problem:\nI build an build.xml like:\n<project default=\"call\">\n    <target name=\"call\">\n        <property environment=\"env\"/>\n        <java\n            classname=\"org.apache.tools.ant.launch.Launcher\"\n            fork=\"true\"\n            failonerror=\"true\"\n            dir=\".\"\n            timeout=\"4000000\"\n            >\n            <classpath>\n                <pathelement location=\"${env.ANT_HOME}/lib/ant-launcher.jar\"/>\n            </classpath>\n            <arg value=\"-buildfile\"/><arg file=\"build.xml\"/>\n            <arg value=\"callee\"/>\n        </java>\n        \n    </target>\n    <target name=\"callee\">\n        <echo>basedir is ${basedir}</echo>\n    </target>\n</project>\n\nbasedir gets outputed correctly in ant.1.6.5.\n\nbasedir gets set in ProjectHelper2 when it\nis parsing the <project> tag of the build file.\n\nMarking as NEEDINFO, could you run the build file?\n", "id": 93314, "time": "2006-09-10T22:46:19Z", "creator": "peterreilly@apache.org", "creation_time": "2006-09-10T22:46:19Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 37694, "is_private": false, "text": "Peter - your build file runs with no problems.\n\nThe good news: I cannot produce my own problem precisely, as described almost a\nyear ago. So I take the liberty of renaming the bug, from \"does not set basedir\"\nto \"sets ... - undocumented\".\n\nI tried the following:\n\nI have a directory, with three contents:\n\nFirstly, it has a file parent.xml, which looks like this:\n\n<project default=\"call\">\n\n    <target name=\"call\">\n        <fail message=\"ant.home not set.\"\n            unless=\"ant.home\" />\n        <property name=\"sub.builddir\" location=\".\" />\n        <property name=\"sub.buildfile\" location=\"../subfile.xml\" />\n\n        <echo>basedir is ${basedir}</echo>\n        <echo>sub.builddir is ${sub.builddir}</echo>\n        <echo>sub.buildfile is ${sub.buildfile}</echo>\n\n        <java\n            classname=\"org.apache.tools.ant.launch.Launcher\"\n            fork=\"true\"\n            failonerror=\"true\"\n            dir=\"${sub.builddir}\"\n            timeout=\"4000000\"\n            >\n            <classpath>\n                <pathelement location=\"${ant.home}/lib/ant-launcher.jar\"/>\n            </classpath>\n            <arg value=\"-buildfile\"/><arg file=\"${sub.buildfile}\"/>\n            <arg value=\"callee\"/>\n        </java>\n        \n    </target>\n\n</project>\n\nSecondly, it has a file subfile.xml, which looks like this:\n\n<project>\n\n    <target name=\"callee\">\n        <echo>basedir is ${basedir}</echo>\n    </target>\n\n</project>\n\nAnd finally, that directory has a sub directory \"subdir\".\n\nI change into that sub directory, and call\n\nant -Dbasedir=. -buildfile ../parent.xml\n\nI have not found a way to predict, from the documentation, what callee will show\nas its subdir.\n\nHere is what indeed does happen, as of ant 1.6.5 :\n\n$ ant -Dbasedir=. -buildfile ../parent.xml\nBuildfile: ../parent.xml\n\ncall:\n     [echo] basedir is .\n     [echo] sub.builddir is /home/andreas/radio/comp/ant/antbug/subdir\n     [echo] sub.buildfile is /home/andreas/radio/comp/ant/antbug/subfile.xml\n     [java] Buildfile: /home/andreas/radio/comp/ant/antbug/subfile.xml\n\n     [java] callee:\n     [java]      [echo] basedir is /home/andreas/radio/comp/ant/antbug\n\n     [java] BUILD SUCCESSFUL\n     [java] Total time: 0 seconds\n\nBUILD SUCCESSFUL\nTotal time: 4 seconds\n\nSo, through the call to <java>, the build's basedir climbed one level up.\n\nFrom other experiments, it seems that I always get, as the basedir, the\ndirectory that contains the sub buildfile. The value I hand down through\n<java dir=\"\"> seems to be ignored.\n\nI don't mind this particular behaviour of ant. But I suggest this behaviour\nshould be documented.", "id": 94482, "time": "2006-10-04T11:13:33Z", "creator": "andreas.krueger@famsik.de", "creation_time": "2006-10-04T11:13:33Z", "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "andreas.krueger@famsik.de", "text": "Well, the behaviour I have now seen is documented after all, in\n\nhttp://ant.apache.org/manual/using.html#projects\n\nWhen I was filing the initial bug report, that bug (basedir not set at all)\noccured on Windows.\n\nAs I have written, I can now not reproduce the original problem, but this is on\nLinux.  What I see is documented.\n\nIf Steve can reproduce the original problem, change the title back to \"basedir\nnot set\". If the problem continues to be non-reproducable, I'd be happy if the\nbug is closed as \"worksforme\".", "id": 94485, "time": "2006-10-04T11:49:40Z", "bug_id": 37694, "creation_time": "2006-10-04T11:49:40Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "creator": "peterreilly@apache.org", "text": "Thanks for looking at problem again.\nI am currently using windows, so I will\nmark this as worksforme.\nThe trick of using classname=org.apache.tools.ant.Laucher is\nquite nice.", "id": 94494, "time": "2006-10-04T13:55:46Z", "bug_id": 37694, "creation_time": "2006-10-04T13:55:46Z", "is_private": false, "attachment_id": null}]
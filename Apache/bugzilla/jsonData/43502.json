[{"count": 0, "tags": [], "text": "If httpd is configured to log to a file in a non-existing directory, it refuses\nto start up, e.g.:\n[Fri Sep 28 03:58:13 2007] [notice] caught SIGTERM, shutting down\n(2)No such file or directory: httpd: could not open error log file\n/etc/httpd/logs/mailman/error_log.\nUnable to open logs\n\nIt's useful when restarting Apache to check if any configuration changes will\nprevent the restart from being successful (and thus result in down time when the\nrestart command is issued). However the configuration syntax check doesn't check\nif log file directories exist and so doesn't catch this problem\n\nOther non-existing directories (for serving files out of etc) don't prevent the\nentire process from starting up and so aren't such critical errors.\n\nIt would be great if either\n1) the inability to create a log file did not prevent httpd from starting\n2) the config test (or another test) checked for this condition (and possible\nother config options that would prevent startup)", "is_private": false, "id": 108740, "creator": "davidf@sjsoft.com", "time": "2007-09-28T02:11:47Z", "bug_id": 43502, "creation_time": "2007-09-28T02:11:47Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 43502, "attachment_id": null, "text": "Tried to code a patch for this but couldn't find where ap_run_test_config is\ndefined :-(", "id": 108742, "time": "2007-09-28T02:32:41Z", "creator": "davidf@sjsoft.com", "creation_time": "2007-09-28T02:32:41Z", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 22281\nuse test_config to check if errorlog can be opened\n\nA tiny patch to see if errorlog can be opened during httpd -t\nSince test_config does not let me return a value, This will still return\nSyntax OK after printing the warning.", "is_private": false, "id": 118803, "creator": "rahul.g.nair@gmail.com", "time": "2008-07-18T03:41:08Z", "bug_id": 43502, "creation_time": "2008-07-18T03:41:08Z", "attachment_id": 22281}, {"count": 3, "tags": [], "bug_id": 43502, "text": "Note: The above patch assumes that mod_log_config is loaded.\n", "id": 118804, "time": "2008-07-18T03:42:41Z", "creator": "rahul.g.nair@gmail.com", "creation_time": "2008-07-18T03:42:41Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 43502, "attachment_id": 23280, "id": 124969, "time": "2009-02-19T06:10:26Z", "creator": "davidf@sjsoft.com", "creation_time": "2009-02-19T06:10:26Z", "is_private": false, "text": "Created attachment 23280\nChecks error logs and custom logs for the main host\n\nThanks for the patch rahul! Got me started...\n\nThe new patch I'm attaching now also checks files mentioned in CustomLog or TransferLog directives.\n\nProblems that remain:\n * The attempt is made relative to the current directory, not the eventual ServerRoot\n * Virtual Host configurations are not checked"}, {"count": 5, "tags": [], "bug_id": 43502, "attachment_id": 23281, "id": 124975, "time": "2009-02-19T06:44:41Z", "creator": "davidf@sjsoft.com", "creation_time": "2009-02-19T06:44:41Z", "is_private": false, "text": "Created attachment 23281\nChecks error logs and custom logs with relative paths for the main host and virtual hosts\n\nAdjusted patch to address the problems above: it now iterates over the virtual hosts, and relative paths are used too.\n\nIt also checks whether the error log is even defined, and adjusts the language to indicate which config file it is looking at.\n\nSample output:\n[root@kulma httpd]# /etc/init.d/httpd configtest\n(2)No such file or directory: Could not open error log file /etc/httpd/logs2/error_log for server defined in main config file.\n(2)No such file or directory: Could not open log file /etc/httpd/logs2/access_log for server defined in main config file.\n(2)No such file or directory: Could not open log file /etc/httpd/logs2/access_log for server defined in /etc/httpd/conf.d/virtual.d/zimbra.conf.\n(2)No such file or directory: Could not open error log file /etc/httpd/logs2/trac/error_log for server defined in /etc/httpd/conf.d/virtual.d/trac.conf.\n(2)No such file or directory: Could not open log file /etc/httpd/logs2/trac/access_log for server defined in /etc/httpd/conf.d/virtual.d/trac.conf.\n(2)No such file or directory: Could not open error log file /etc/httpd/logs2/error_log for server defined in /etc/httpd/conf.d/virtual.d/test.conf.\n(2)No such file or directory: Could not open error log file /etc/httpd/logs2/error_log for server defined in /etc/httpd/conf.d/virtual.d/staging.conf.\n(2)No such file or directory: Could not open log file /etc/httpd/logs2/access_log for server defined in /etc/httpd/conf.d/virtual.d/old.conf.\n(2)No such file or directory: Could not open log file /etc/httpd/logs2/access_log for server defined in /etc/httpd/conf/httpd.conf.\nSyntax OK\n\nThe patch is against 2.2.8, and is complete from my side."}, {"count": 6, "tags": [], "bug_id": 43502, "attachment_id": null, "text": "I'm not familiar with Apache procedures, so not sure where to go from here...", "id": 124977, "time": "2009-02-19T06:53:09Z", "creator": "davidf@sjsoft.com", "creation_time": "2009-02-19T06:53:09Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 43502, "attachment_id": null, "id": 124982, "time": "2009-02-19T08:04:29Z", "creator": "nick@webthing.com", "creation_time": "2009-02-19T08:04:29Z", "is_private": false, "text": "(In reply to comment #6)\n> I'm not familiar with Apache procedures, so not sure where to go from here...\n> \n\nPosting a patch and marking the bug report PatchAvailable is a good start.  If you're lucky, someone notices and reviews the patch.  If nothing happens, you can raise it on the dev list.\n\nFirst at-a-glance comment on this patch: how does it work with piped logs?"}, {"count": 8, "tags": [], "text": "It seems pretty odd to do this.  If you have some process which is randomly making your log directory unwritable outside of your control (or knowledge), who is to say that the log directory isn't going to become unwritable between when the testconfig hook runs, and startup completes?", "is_private": false, "id": 124986, "creator": "jorton@redhat.com", "time": "2009-02-19T08:41:42Z", "bug_id": 43502, "creation_time": "2009-02-19T08:41:42Z", "attachment_id": null}, {"count": 9, "attachment_id": null, "bug_id": 43502, "is_private": false, "id": 124991, "time": "2009-02-19T10:00:37Z", "creator": "davidf@sjsoft.com", "creation_time": "2009-02-19T10:00:37Z", "tags": [], "text": "(In reply to comment #8)\n> It seems pretty odd to do this.  If you have some process which is randomly\n> making your log directory unwritable outside of your control (or knowledge),\n> who is to say that the log directory isn't going to become unwritable between\n> when the testconfig hook runs, and startup completes?\n> \n\nThe original use case for this was not someone making the log directory unwriteable, but someone (myself!) forgetting to add the directory referred to in the ErrorLog directive. I would then run configtest and since it said everything looked OK, thought I was good to go - but restarting the server would actually stop it dead.\n\nAt least printing out a warning gives you a flag that that needs to be fixed. It needn't actually try writing to the files - just checking that their directories exist would be OK for me..."}, {"count": 10, "tags": [], "bug_id": 43502, "attachment_id": null, "id": 124993, "time": "2009-02-19T12:43:09Z", "creator": "davidf@sjsoft.com", "creation_time": "2009-02-19T12:43:09Z", "is_private": false, "text": "(In reply to comment #7)\n> (In reply to comment #6)\n> > I'm not familiar with Apache procedures, so not sure where to go from here...\n> > \n> \n> Posting a patch and marking the bug report PatchAvailable is a good start.  If\n> you're lucky, someone notices and reviews the patch.  If nothing happens, you\n> can raise it on the dev list.\nGreat, thanks\n> First at-a-glance comment on this patch: how does it work with piped logs?\nIt didn't, thanks :-)\nWill attach a new version..."}, {"count": 11, "attachment_id": 23282, "bug_id": 43502, "is_private": false, "id": 124994, "time": "2009-02-19T12:48:07Z", "creator": "davidf@sjsoft.com", "creation_time": "2009-02-19T12:48:07Z", "tags": [], "text": "Created attachment 23282\nChecks error logs and custom logs with relative paths for the main host and virtual hosts, ignoring pipes\n\nAttached new patch ignoring piped logs"}, {"attachment_id": null, "tags": [], "bug_id": 43502, "is_private": false, "count": 12, "id": 131386, "time": "2009-10-26T08:55:34Z", "creator": "martin.smith@torchbox.com", "creation_time": "2009-10-26T08:55:34Z", "text": "Apache also doesn't bother checking if log directories exist when you reload it with /etc/init.d/httpd reload and just fails silently, meaning your sites go down because you added a new vhost and forgot to make the log directory.\n\nIt also would be nice if the reload init script printed something to stderr if something went wrong."}, {"count": 13, "tags": [], "bug_id": 43502, "text": "Seriously, we're 5 years onwards and this still has not made it into the stable release?", "id": 174610, "time": "2014-04-16T07:53:42Z", "creator": "julius@driebit.nl", "creation_time": "2014-04-16T07:53:42Z", "is_private": false, "attachment_id": null}, {"count": 14, "tags": [], "text": "Almost 7 years and counting. This is still an issue in most recent versions. What the heck, Apache?", "attachment_id": null, "bug_id": 43502, "id": 175799, "time": "2014-06-13T11:12:00Z", "creator": "aeoris@gmail.com", "creation_time": "2014-06-13T11:12:00Z", "is_private": false}, {"count": 15, "attachment_id": null, "bug_id": 43502, "is_private": false, "id": 187497, "time": "2016-01-08T09:53:25Z", "creator": "anthony.geoghegan@gmail.com", "creation_time": "2016-01-08T09:53:25Z", "tags": [], "text": "Over the past few years, I've been bitten by this issue on a number of occasions where the *Error Log* for a virtual host configuration had its directory moved / renamed but the `configtest` still reports that everything is OK.\n\nI created an account to report this as a bug / feature request only to discover that a patch for this issue was already submitted over 7 years ago. As a user, I'd love to see this patch (or a revised version of it) added to the production code."}]
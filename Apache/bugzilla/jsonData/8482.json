[{"count": 0, "tags": [], "text": "i'm using a nph- CGI, which isn't working properly with apache 2.0.35, although \nthe changelog says, that nph- is working again!\n\ndescription:\nafter starting the nph- CGI, any browser receives some data (no prob so far)\nbut after a certain (almost everytime the same) amount, the browers stops \ngetting data.\nthe more strange thing is .. the cgi (cgi-irc) still works!\nand after quiting that CGI, the browers receives the rest of the data-packets.\n\nso i assume, that the server-pushed method gets a kind of overflow ..", "attachment_id": null, "bug_id": 8482, "id": 14653, "time": "2002-04-24T18:11:25Z", "creator": "box@uni.de", "creation_time": "2002-04-24T18:11:25Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 8482, "attachment_id": null, "id": 14654, "time": "2002-04-24T18:12:45Z", "creator": "box@uni.de", "creation_time": "2002-04-24T18:12:45Z", "is_private": false, "text": "forget to say: that script worked on apache 1.3.19"}, {"count": 2, "attachment_id": null, "bug_id": 8482, "is_private": false, "id": 15710, "time": "2002-05-08T11:09:24Z", "creator": "andy@warmcat.com", "creation_time": "2002-05-08T11:09:24Z", "tags": [], "text": "I am also experiencing this with a nph- cgi.  It seems to be after 64K-128K of \ndata the remainder is corrupted when sent through to the requesting web \nbrowser.  The data is clean FOR SURE when it is issued by the cgi.\n"}, {"count": 3, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "id": 15715, "time": "2002-05-08T14:11:24Z", "bug_id": 8482, "creation_time": "2002-05-08T14:11:24Z", "is_private": false, "text": "Do you have a sample which exhibits the problem?  How is the data generated?  \nSlowly over time?  In one burst?  This nph- script works for me (all data \nreceived by browser):\n#!/bin/sh\n\necho \"HTTP/1.1 200 OK\"\necho \"Date: Thu Nov 29 16:22:33 CET 2001\"\necho \"Server: Apache\"\necho \"Connection: close\"\necho \"Content-Type: text/html\"\necho\ncat /home/trawick/apacheinst/manual/mod/mod_ssl.html\ncat /home/trawick/apacheinst/manual/mod/mod_ssl.html\n"}, {"count": 4, "attachment_id": null, "creator": "box@uni.de", "text": "well, i'm not using such a simple one. i'm using cgi-irc \n(http://cgiirc.sourceforge.net). it's a chat skript, so the data is generated \nslowly over time. anonther point maybe could be the multipart content-type:\n\n#!/usr/bin/perl\n   print \"HTTP/1.0 200 OK\\n\";\n   print \"Cache-Control: no-cache\\nExpires: -1\\nPragma: no-cache\\n\";\n   print \"Content-type: multipart/x-mixed-replace;boundary=BOUNDARY\\n\\n\";\n", "id": 15886, "time": "2002-05-10T10:17:36Z", "bug_id": 8482, "creation_time": "2002-05-10T10:17:36Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "creator": "box@uni.de", "attachment_id": null, "text": "still the same problem in version 2.0.36\n", "id": 15948, "time": "2002-05-11T16:00:10Z", "bug_id": 8482, "creation_time": "2002-05-11T16:00:10Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 8482, "attachment_id": null, "id": 18073, "time": "2002-06-19T14:18:36Z", "creator": "box@uni.de", "creation_time": "2002-06-19T14:18:36Z", "is_private": false, "text": "still not working in 2.0.39\n\nthe problem, that the browsers gets only a certain amount of data, seems to \nfixed, but now it looks like the connection isn't a keep-alive one.\n\nas mentioned, the problem apears using the cgi-irc (cgiirc.sourceforge.net).\nwhile the browser still can send data to the server (which this cgi is handling \nproperly), the data which should be sent from the cgi, never reaches the \nbrowser.\n\nit's working on apache 1.3.19 .. but not on apache 2.0.39\nif you wish to take a look:\n\nhttp://www.galgenberg.net/cgi-bin/cgiirc/irc.cgi <-- apache 2.0.39\n\nhttp://132.187.222.249/cgi-bin/cgiirc/irc.cgi <-- apache 1.3.19"}, {"count": 7, "attachment_id": null, "creator": "dgl-apache@otherwize.co.uk", "text": "Hi, i'm the author of CGI:IRC - thanks to zapp for pointing me at this bug. \nI've now written a test-case that shows this working on apache 1.3 but not \napache 2.\n\nIt doesn't seem to be related to nph scripts, just anything sending content \nthat shouldn't be buffered.\n\nThe test makes use of javascript in the stream and for me works fine on apache \n1.3 (two installs tested).\n\nApache 2: http://cgiirc.blitzed.org/teststream.cgi\nApache 1.3: http://dgl.cx/test/teststream.cgi\n(Also nph- scripts at same locations as above to show it affects both nph and \nnon-nph scripts).\nSource code: http://cgiirc.sourceforge.net/files/teststream.cgi\n\nHope this helps.", "id": 18167, "time": "2002-06-20T13:09:41Z", "bug_id": 8482, "creation_time": "2002-06-20T13:09:41Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "creator": "dgl-apache@otherwize.co.uk", "attachment_id": null, "id": 18168, "time": "2002-06-20T13:11:41Z", "bug_id": 8482, "creation_time": "2002-06-20T13:11:41Z", "is_private": false, "text": "(Note that if the test fails but these values only differ by a second then it's \nlikely to be a laggy connection). On apache 2 they nearly all appear at the \nsame time. Also I know CGI:IRC has problems with opera and konqueror so don't \ntest on those browsers)."}, {"count": 9, "attachment_id": null, "bug_id": 8482, "is_private": false, "id": 18169, "time": "2002-06-20T13:12:43Z", "creator": "dgl-apache@otherwize.co.uk", "creation_time": "2002-06-20T13:12:43Z", "tags": [], "text": "And sourceforge appear broken for serving scripts so use \nhttp://cgiirc.sourceforge.net/files/teststream.pl.txt and rename it.."}, {"count": 10, "attachment_id": null, "bug_id": 8482, "is_private": false, "id": 18172, "time": "2002-06-20T13:17:54Z", "creator": "trawick@apache.org", "creation_time": "2002-06-20T13:17:54Z", "tags": [], "text": "Thanks for the recent updates.  Just to avoid wasting anybody's time:\n\nthis is an acknowledged problem that multiple developers have been able\nto reproduce\n\nit is considered high-priority (tracked in STATUS file)\n\nhopefully this will be resolved before long\n"}, {"count": 11, "tags": [], "creator": "dgl-apache@otherwize.co.uk", "attachment_id": null, "id": 18778, "time": "2002-06-30T21:25:34Z", "bug_id": 8482, "creation_time": "2002-06-30T21:25:34Z", "is_private": false, "text": "Originally I said non-nph scripts had problems too, this doesn't seem to be the\ncase and i've now got cgiirc.blitzed.org working on apache 2.0 by not using an\nnph script.\n\nI think this problem might be related to bug number 8388? As The only thing\nremaining is the script doesn't always seem to be correctly killed by apache\nwhen the connection terminates, on apache 1.3 I'm quite sure it used to send a\nSIGINT (or similar) to the cgi script when the connection was closed, but apache\n2 doesn't appear to be doing that?\n"}, {"count": 12, "tags": [], "text": "We have a CGI script which works fine in 1.3.20 (and on the command line: 'su -\nnobody -c \"/opt/bin/perl /blah/cgi-bin/dpradm\npage=18.html\\&arg1=val1\\&arg2=val2\"') but never returns all the data to the\nbrowser (or telnet port80 session).\n\nThis is on Solaris 2.6.\n\nAs a result, it looks like our only Apache 2 box is going to roll back to 1.3.26.", "is_private": false, "id": 20471, "creator": "nic@niss.ac.uk", "time": "2002-07-31T11:06:59Z", "bug_id": 8482, "creation_time": "2002-07-31T11:06:59Z", "attachment_id": null}, {"count": 13, "tags": [], "creator": "nic@niss.ac.uk", "attachment_id": null, "id": 20905, "time": "2002-08-12T10:49:21Z", "bug_id": 8482, "creation_time": "2002-08-12T10:49:21Z", "is_private": false, "text": "I believe that Apache 2.0.40 has fixed this bug for me. (only build difference\nbeing: --disable-threads)."}, {"count": 14, "tags": [], "text": "Bug still exists in 2.0.40\n", "is_private": false, "bug_id": 8482, "id": 21363, "time": "2002-08-20T09:14:18Z", "creator": "box@uni.de", "creation_time": "2002-08-20T09:14:18Z", "attachment_id": null}, {"count": 15, "tags": [], "creator": "nic@niss.ac.uk", "attachment_id": null, "id": 21364, "time": "2002-08-20T09:17:38Z", "bug_id": 8482, "creation_time": "2002-08-20T09:17:38Z", "is_private": false, "text": "Agreed - bug still exists (but occurs less). I dont think this is limited to NPH\neither."}, {"count": 16, "tags": [], "text": "[This is a mass bug update.]\nThis bug reports a problem in an older version of Apache 2.\nCould you please update to the most recent version and see\nif you can reproduce this problem.  If the bug still exists,\nplease update the bug with the latest version number.  If \nthe bug no longer exists, please close the bug report.\n\nSorry for this impersonal response, but we get many more bug\nreports than our volunteers can keep up with.\nThanks for using Apache!", "is_private": false, "bug_id": 8482, "id": 24700, "time": "2002-10-17T02:34:22Z", "creator": "slive@apache.org", "creation_time": "2002-10-17T02:34:22Z", "attachment_id": null}, {"count": 17, "tags": [], "text": "sry guys, but it's still not working in 2.0.43", "is_private": false, "bug_id": 8482, "id": 24776, "time": "2002-10-17T12:59:05Z", "creator": "box@uni.de", "creation_time": "2002-10-17T12:59:05Z", "attachment_id": null}, {"count": 18, "attachment_id": null, "creator": "dgl-apache@otherwize.co.uk", "text": "I haven't had chance to try apache 2 recently, but people are still reporting\nthis and asking about it.\nAny chance of some sort of update about when it might be fixed?\n", "id": 25081, "time": "2002-10-23T22:39:59Z", "bug_id": 8482, "creation_time": "2002-10-23T22:39:59Z", "tags": [], "is_private": false}, {"count": 19, "tags": [], "text": "Zapp, were you using mod_cgi or mod_cgid when you tried with 2.0.43?\n\n2.0.43 has some fixes to help streaming in general (nph or not).\n\nA problem specific to mod_cgid which broke streaming with wasn't fixed \nuntil right after 2.0.43 was released.\n\n", "attachment_id": null, "id": 25085, "creator": "trawick@apache.org", "time": "2002-10-23T22:55:37Z", "bug_id": 8482, "creation_time": "2002-10-23T22:55:37Z", "is_private": false}, {"count": 20, "tags": [], "text": "hi trawick\n\nLoadModule cgi_module libexec/apache2/mod_cgi.so\n\nwe're going to update to the latest CVS version this (maybe tomorrow) \nafternoon. keep u informed!\n\nany ideas, when v2.0.43++ will be released?", "is_private": false, "bug_id": 8482, "id": 25114, "time": "2002-10-24T10:23:48Z", "creator": "box@uni.de", "creation_time": "2002-10-24T10:23:48Z", "attachment_id": null}, {"count": 21, "attachment_id": null, "bug_id": 8482, "is_private": false, "id": 25122, "time": "2002-10-24T12:01:36Z", "creator": "trawick@apache.org", "creation_time": "2002-10-24T12:01:36Z", "tags": [], "text": "If you were using mod_cgi with 2.0.43, you have all the fixes that are\navailable.\n\nHere is teststream.pl on cvs HEAD with mod_cgid:\n\n---------\nTesting streaming of content (with scripting)\nIf most of the tests below succeed then it is likely streaming of content works\nfine. If they fail then either the webserver, a proxy between you and the\nwebserver or your browser is having problems with streams (and sometimes scripts\nembedded inside streams). If the difference in any failed tests is only a second\nthen it is more likely that your internet connection to the server is slow.\n\nTest 0: OK\nTest 1: Failed: 1035460289 != 1035460288\nTest 2: Failed: 1035460294 != 1035460293\nTest 3: Failed: 1035460299 != 1035460298\nTest 4: Failed: 1035460304 != 1035460303\nTest 5: Failed: 1035460309 != 1035460308\nLess than 4 tests were successful. You probably have a problem with streaming of\ncontent (or a slow internet connection)\nEnd of test.\n------------\n\nNote that the failures were all only 1 second too late.\n\nHere is teststream.pl on cvs HEAD with mod_cgi:\n\n------\nTesting streaming of content (with scripting)\nIf most of the tests below succeed then it is likely streaming of content works\nfine. If they fail then either the webserver, a proxy between you and the\nwebserver or your browser is having problems with streams (and sometimes scripts\nembedded inside streams). If the difference in any failed tests is only a second\nthen it is more likely that your internet connection to the server is slow.\n\nTest 0: OK\nTest 1: OK\nTest 2: OK\nTest 3: OK\nTest 4: OK\nTest 5: OK\n6 out of 6 tests were OK, looks like streaming is working\nEnd of test.\n-----\n\nShould I assume that there is a functional problem with mod_cgid based\non this test, or perhaps it is just a bit slower than mod_cgi?\n"}, {"count": 22, "tags": [], "creator": "box@uni.de", "attachment_id": null, "id": 25126, "time": "2002-10-24T12:58:06Z", "bug_id": 8482, "creation_time": "2002-10-24T12:58:06Z", "is_private": false, "text": "weird..\n\ntesting with CGI:IRC v0.5\n\n2.0.43:\nclient receives an exact number of bytes, then nothing for about 10 secs. after \nthat, CGI:IRC connects to the IRC-Server and the client completely receives the \nrest. the connection is now closed. (data can be sent to (irc-)server, but \ncannot be received)\n\n2.0.44-dev: (httpd-2.0_20021024101256.tar.gz)\nclient receives exact number of bytes, too. no waiting. CGI:IRC starts \nimmediately. BUT the client doesn't receive the all the data. the amount of \nbytes, received by the client after CGI:IRC has connected to IRC-Server, is \nchanging from time to time; after a dozen tests, the data hasn't been fully \nreceived one single time.\nthe connection stays alive till termination (by user =)\n(same as above: data sending, not receiving...)\n\nmaybe david can provide some more details, what's going on that could terminate \nthe data-flow."}, {"count": 23, "tags": [], "creator": "dgl-apache@otherwize.co.uk", "attachment_id": null, "id": 25131, "time": "2002-10-24T14:38:34Z", "bug_id": 8482, "creation_time": "2002-10-24T14:38:34Z", "is_private": false, "text": "I've just installed apache 2.0.43 to test with - using mod_cgi and prefork\n(default ./configure options). \n\nteststream works fine -but- if it is called nph-teststream.cgi all but one of\nthe tests fail (and it's out by much more than a second).\n\nSo, the first problem is fixed by renaming it something not beinging with nph-\n(I don't understand that - I thought the idea was to do less processing on nph-\nscripts). For CGI:IRC renaming nph-irc.cgi to something like irc-main.cgi and\nupdating config (and removing the 'HTTP/1.0 200 OK' line on non-CVS versions)\nfixes it. \n\nThe other problem briefly mentioned above is still present, no signal is sent to\nthe process to terminate it when the user stops the request, Apache 1.3 does,\nalthough I can't find this in any CGI specification, but it's a very useful feature."}, {"count": 24, "tags": [], "text": "Thanks for the reminder about calling the script nph-...  Nothing written\nto the network in that case, so I'll start debugging that.\n", "is_private": false, "bug_id": 8482, "id": 25138, "time": "2002-10-24T15:43:17Z", "creator": "trawick@apache.org", "creation_time": "2002-10-24T15:43:17Z", "attachment_id": null}, {"count": 25, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "id": 25145, "time": "2002-10-24T18:10:26Z", "bug_id": 8482, "creation_time": "2002-10-24T18:10:26Z", "is_private": false, "text": "The nph flavor of teststream.pl works fine for me with this patch.\n\nWanna try the patch with the more complicated test (irc script)?\n\nIndex: server/core.c\n===================================================================\nRCS file: /home/cvs/httpd-2.0/server/core.c,v\nretrieving revision 1.213\ndiff -u -r1.213 core.c\n--- server/core.c       14 Oct 2002 20:08:15 -0000      1.213\n+++ server/core.c       24 Oct 2002 17:26:10 -0000\n@@ -3653,6 +3653,7 @@\n     conn_rec *c = f->c;\n     core_net_rec *net = f->ctx;\n     core_output_filter_ctx_t *ctx = net->out_ctx;\n+    apr_read_type_e eblock = APR_NONBLOCK_READ;\n\n     if (ctx == NULL) {\n         ctx = apr_pcalloc(c->pool, sizeof(*ctx));\n@@ -3728,7 +3729,16 @@\n                 const char *str;\n                 apr_size_t n;\n\n-                rv = apr_bucket_read(e, &str, &n, APR_BLOCK_READ);\n+                rv = apr_bucket_read(e, &str, &n, eblock);\n+                if (APR_STATUS_IS_EAGAIN(rv)) {\n+                    /* send what we have so far since we shouldn't expect more\n+                     * output for a while...  next time we read, block\n+                     */\n+                    more = apr_brigade_split(b, e);\n+                    eblock = APR_BLOCK_READ;\n+                    break;\n+                }\n+                eblock = APR_NONBLOCK_READ;\n                 if (n) {\n                     if (!fd) {\n                         if (nvec == MAX_IOVEC_TO_WRITE) {\n"}, {"count": 26, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "id": 25197, "time": "2002-10-25T15:38:13Z", "bug_id": 8482, "creation_time": "2002-10-25T15:38:13Z", "is_private": false, "text": "The last patch posted to this PR has been tested successfully and will be\nin the next release of Apache.\n\nThere is still a concern about the issue described in PR 8388, but the\nissue of server-pushed output for nph- and non-nph- seems to be resolved.\n"}, {"count": 27, "tags": [], "text": "Apache/2.0.46 (Unix) mod_perl/1.99_09 Perl/v5.6.1 mod_ssl/2.0.46 OpenSSL/0.9.6c\nServer at valk.ath.cx Port 443\n\nUsing https connection it not work... with http it work some helps?", "attachment_id": null, "id": 39070, "creator": "valk@mojodo.it", "time": "2003-06-19T01:55:32Z", "bug_id": 8482, "creation_time": "2003-06-19T01:55:32Z", "is_private": false}, {"count": 28, "tags": [], "bug_id": 8482, "is_private": false, "text": "Valk: your question would appear to be unrelated to this bug report.  And it doesn't \nappear to be a bug report of its own, but rather a user-support question.  Please \nemail your question to modssl-users@modssl.org.  They will, no doubt, want more \ndetails on your configuration in order to help diagnose your problem. ", "id": 39071, "time": "2003-06-19T02:02:32Z", "creator": "jwoolley@apache.org", "creation_time": "2003-06-19T02:02:32Z", "attachment_id": null}]
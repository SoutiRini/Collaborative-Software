[{"count": 0, "attachment_id": null, "bug_id": 44695, "text": "Actually there are two problems:\n (1) In some cases formulas are broken after save. \n (2) POI can't read the saved file with the broken formulas. I'm getting the following exception:\n\nException in thread \"main\" org.apache.poi.hssf.record.RecordFormatException: Unable to construct record instance\n\tat org.apache.poi.hssf.record.RecordFactory.createRecord(RecordFactory.java:204)\n\tat org.apache.poi.hssf.record.RecordFactory.createRecords(RecordFactory.java:122)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:204)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:256)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:237)\n\tat org.apache.poi.hssf.scratchpad.Scratchpad.main(Scratchpad.java:44)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat com.intellij.rt.execution.application.AppMain.main(Unknown Source)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:494)\n\tat org.apache.poi.hssf.record.RecordFactory.createRecord(RecordFactory.java:192)\n\t... 10 more\nCaused by: java.lang.IllegalArgumentException: Illegal length 17478\n\tat org.apache.poi.hssf.record.RecordInputStream.readCompressedUnicode(RecordInputStream.java:270)\n\tat org.apache.poi.hssf.record.ExternalNameRecord.fillFields(ExternalNameRecord.java:162)\n\tat org.apache.poi.hssf.record.Record.<init>(Record.java:55)\n\tat org.apache.poi.hssf.record.ExternalNameRecord.<init>(ExternalNameRecord.java:54)\n\t... 15 more\n\n\nThis bug has appeared recently. The attached unit test passes with POI 3.0.2 but fails with trunk.\n\nI attached a failing unit test and two files:\n\nformulas.xls \t\tinitial file with a formula in A1\nformulas-saved.xls \tsaved by POI. The formula in A1 is broken\n\n\nIt seems to be related to bug #44504. Josh, any ideas?  \n\n\nRegards,\nYegor", "id": 115043, "time": "2008-03-27T11:30:49Z", "creator": "yegor@dinom.ru", "creation_time": "2008-03-27T11:30:49Z", "tags": [], "is_private": false}, {"attachment_id": 21723, "tags": [], "creator": "yegor@dinom.ru", "text": "Created attachment 21723\ninitial file", "count": 1, "id": 115044, "time": "2008-03-27T11:31:25Z", "bug_id": 44695, "creation_time": "2008-03-27T11:31:25Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 44695, "text": "Created attachment 21724\nsaved by POI", "id": 115045, "time": "2008-03-27T11:32:06Z", "creator": "yegor@dinom.ru", "creation_time": "2008-03-27T11:32:06Z", "is_private": false, "attachment_id": 21724}, {"count": 3, "tags": [], "bug_id": 44695, "is_private": false, "text": "Created attachment 21725\nfailing test", "id": 115046, "time": "2008-03-27T11:33:39Z", "creator": "yegor@dinom.ru", "creation_time": "2008-03-27T11:33:39Z", "attachment_id": 21725}, {"count": 4, "tags": [], "creator": "josh@apache.org", "text": "Fixed in svn r641967/r641964\n\nThis was a problem in ExternalNameRecord.serialize(int, byte[]).  I originally\nleft a TODO in that method to write a junit, because the code seemed difficult\nto read.\n\nPerhaps at some stage we could re-visit these serialize() / fillFields()\nmethods of the org.apache.poi.hssf.record.Record hierarchy.  It's difficult to\nkeep track of byte array offsets while streaming record fields.  The JDK (with\nDataInputStream / DataOutputStream) shows better examples of how to do this.\n", "id": 115048, "time": "2008-03-27T13:15:41Z", "bug_id": 44695, "creation_time": "2008-03-27T13:15:41Z", "is_private": false, "attachment_id": null}]
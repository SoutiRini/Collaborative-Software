[{"count": 0, "tags": [], "text": "Hi,\n\napplying a font to a HSSFRichTextString with poi-3.0.1-FINAL-20070705.jar can\nlead to that the file can't be loaded by Excel any more (I tried Excel 2003 and\nExcel 2007).\n\nThere are no problems in saving the file. However, when opening the file with\nExcel, I get the error message \"Excel found unreadable content in foo.xls\".\n\nAttached a small test case  and some sample data which reproduce the problem.\nThe created excel file works fine if the font is not applied to the text in row\n2775. But if the font is applied to the text in row 2775, the excel file can't\nbe loaded any more.\nThere is nothing special about the particular String in row 2775. When applying\nthe font to this String only, the excel file can be loaded as well. It's just in\nthis scenario, when applying the fonts to line 1 - 2774, the excel file can be\nloaded. But when applying the fonts to line 1 - 2775, the excel file can't be\nloaded any more.  \n\nActually this problem occurs all the time when I export a big table. As a\nworkaround, I do not apply fonts at all. \n\nimport java.io.BufferedReader;\nimport java.io.FileOutputStream;\nimport java.io.FileReader;\n\nimport org.apache.poi.hssf.usermodel.HSSFCell;\nimport org.apache.poi.hssf.usermodel.HSSFFont;\nimport org.apache.poi.hssf.usermodel.HSSFRichTextString;\nimport org.apache.poi.hssf.usermodel.HSSFRow;\nimport org.apache.poi.hssf.usermodel.HSSFSheet;\nimport org.apache.poi.hssf.usermodel.HSSFWorkbook;\n\npublic class ApplyFont {\n\n    public static void main(String args[]) throws Exception {\n\n        HSSFWorkbook workBook = new HSSFWorkbook();\n        HSSFSheet sheet = workBook.createSheet();\n        HSSFFont font = workBook.createFont();\n       \n        BufferedReader br = new BufferedReader(new FileReader(\"testdata.txt\"));\n        \n        String line;\n        short currentRow = 0;\n        \n        while ( (line = br.readLine()) != null) {\n            HSSFRow row = sheet.createRow(currentRow++);\n            HSSFCell cell = row.createCell((short)0);\n                \n            HSSFRichTextString text = new HSSFRichTextString(line); \n            \n            // if we don't apply the font to this particular line,\n            // everything works fine \n            // if (currentRow != 2775) {\n                text.applyFont(0, line.length(), font);\n            // }\n            \n            cell.setCellValue(text);\n        }\n        \n        workBook.write(new FileOutputStream(\"foo.xls\"));\n    }\n}\n\nRegards,\nJan", "attachment_id": null, "bug_id": 43091, "id": 106639, "time": "2007-08-11T06:33:53Z", "creator": "jan.dostert@sap.com", "creation_time": "2007-08-11T06:33:53Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 43091, "attachment_id": 20646, "id": 106640, "time": "2007-08-11T06:35:26Z", "creator": "jan.dostert@sap.com", "creation_time": "2007-08-11T06:35:26Z", "is_private": false, "text": "Created attachment 20646\nTestcase"}, {"count": 2, "tags": [], "bug_id": 43091, "attachment_id": null, "text": "Alas cryptic error messages from Excel aren't much help for debugging :/\n\nProbably your best bet is to apply the font change to the file in excel, and to\na copy of the file in POI. Then, compare the two with the poi debugging tools\n(hssf.dev and poifs.dev) to try to spot the difference, which might give a clue\nto what Excel doesn't like about the POI edited file", "id": 106784, "time": "2007-08-15T06:11:34Z", "creator": "apache@gagravarr.org", "creation_time": "2007-08-15T06:11:34Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43091, "attachment_id": null, "id": 106785, "time": "2007-08-15T06:17:49Z", "creator": "dfisher@jmlafferty.com", "creation_time": "2007-08-15T06:17:49Z", "is_private": false, "text": "We had similar trouble when migrating from development to a staging server.\n\nWe had to make sure that you really have the font in the proper location in the\njava setup on the machine where it is created by POI."}, {"count": 4, "tags": [], "bug_id": 43091, "attachment_id": null, "text": "Is this bug fixed? What is the resolution?", "id": 107259, "time": "2007-08-25T15:06:43Z", "creator": "aruna.gadige@gmail.com", "creation_time": "2007-08-25T15:06:43Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 43091, "attachment_id": null, "text": "I could not reproduce this in a quick try, likely the Font setup of Java is related here and we cannot do much about it from within POI. Maybe also some changes in newer versions improved this. \n\nIf you still see this problem and have a reproducable test-case please reopen this issue or file a new bug.", "id": 182798, "time": "2015-05-01T21:03:46Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-05-01T21:03:46Z", "is_private": false}]
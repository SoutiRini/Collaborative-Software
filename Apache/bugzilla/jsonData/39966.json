[{"count": 0, "tags": [], "creator": "nikolaymetchev@gmail.com", "is_private": false, "text": "I have written a Custom tag which extends SimpleTagSupport. I am getting a very\nspurious error occuring very rarely.\n\nIf I have a JSP page which is very simple and just uses the custom tag itself\nthen everything works as expected. However in a more complicated application I\nget the exception below. I am curious under what circumstances does the\nTagHandlerPool get used instead of just instantiating the tag class directly?\nShould it be checking to see if it is a SimpleTag and converting it using a\nTagAdapter on line 116?\n\n\njava.lang.ClassCastException: com.teamphone.common.jsp.image.ImageTag\n\tat org.apache.jasper.runtime.TagHandlerPool.get(TagHandlerPool.java:116)\n\tat\norg.apache.jsp.WEB_002dINF.views.default_.authentication.LogonRenderer_jspx._jspx_meth_image_image_0(LogonRenderer_jspx.java:373)\n\tat\norg.apache.jsp.WEB_002dINF.views.default_.authentication.LogonRenderer_jspx._jspService(LogonRenderer_jspx.java:140)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:97)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:332)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:264)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:672)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:463)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:398)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:301)\n\tat\ncom.teamphone.common.servlet.http.HttpDocumentFactory$ForwardDocument.writeBody(HttpDocumentFactory.java:329)\n\tat\ncom.teamphone.common.servlet.http.HttpDocumentFactory$AbstractDocument.write(HttpDocumentFactory.java:200)\n\tat com.teamphone.common.servlet.http.HttpServlet.doRequest(HttpServlet.java:173)\n\tat com.teamphone.common.servlet.http.HttpServlet.doGet(HttpServlet.java:100)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:689)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)\n\tat\norg.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)\n\tat\norg.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)\n\tat\norg.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)\n\tat java.lang.Thread.run(Thread.java:595)", "id": 90891, "time": "2006-07-05T12:13:37Z", "bug_id": 39966, "creation_time": "2006-07-05T12:13:37Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "scott@indosoft.ca", "is_private": false, "text": "> Should it be checking to see if it is a SimpleTag and converting it using a\n> TagAdapter on line 116?\n\nSimpleTagSupport iirc wasn't added until JSP 2.0.  Make sure you specify\n<jspversion>2.0</jspversion>\n\nin your TLD.", "id": 93638, "time": "2006-09-15T16:33:24Z", "bug_id": 39966, "creation_time": "2006-09-15T16:33:24Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 39966, "is_private": false, "text": "I filed this bug a while ago and have since changed jobs so I cannot reproduce\nit. However from what I recall I was using <jspversion>2.0</jspversion>. \nIt is unclear from your comment but are you trying to say that TagHandlerPool is\nonly used for older versions of JSP? ", "id": 93654, "time": "2006-09-16T13:19:39Z", "creator": "nikolaymetchev@gmail.com", "creation_time": "2006-09-16T13:19:39Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 39966, "attachment_id": null, "text": "(In reply to comment #2)\n> I filed this bug a while ago and have since changed jobs so I cannot reproduce\n> it. However from what I recall I was using <jspversion>2.0</jspversion>. \n> It is unclear from your comment but are you trying to say that TagHandlerPool is\n> only used for older versions of JSP? \n\nNope, just saying I had the exact same problem.  As far as I can tell,\nTagHandlerPool is still used, but the overall handling of tags is slightly\ndifferent in 2.0 (interface JspTag was shunted to be a superinterface of Tag). \nSo I think if you specify <2.0 in the TLD, the translator will go ahead and\nexpect the Tag interface in your custom tags.  It'll use TagAdapter to link them\nboth together (so getParent() works properly when you mix and match\nSimpleTag[Support] subclasses with implementors of Tag).", "id": 93667, "time": "2006-09-16T23:15:59Z", "creator": "scott@indosoft.ca", "creation_time": "2006-09-16T23:15:59Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 39966, "text": "Without a test JSP or test WAR to reproduce this problem, it's all theoretical.\n However, looking at the code path assuming a JSP 2.0 valid TLD and\nconfiguration, it looks fine to me.  If you can provide a test WAR we can use to\nreproduce this problem, I'd be glad to try it out.", "id": 100928, "attachment_id": null, "creator": "yoavs@computer.org", "creation_time": "2007-03-25T15:10:52Z", "time": "2007-03-25T15:10:52Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 41080, "is_private": false, "id": 96394, "attachment_id": null, "creator": "andy.wood@yoomedia.com", "creation_time": "2006-11-30T04:19:56Z", "time": "2006-11-30T04:19:56Z", "text": "When using the xmlproperty task to read in an external XML file such as:\n<root>\n   <element value=\"a\" />\n   <element value=\"b\" />\n</root>\n\nafter previously setting a property value in the ant file such as:\n<property name=\"root.element.value\" value=\"c\" />\n\nwill cause ${root.element.value} to change from c to a,b.  This doesn't happen \nif there aren't duplicate elements in the XML file.  The behaviour is present \nin 1.6.5 and looks unchanged in the latest version of 1.7 on the trunk in SVN.\n\nSuggested fix is to modify\nprivate void addProperty (String name, String value, String id)\nin src/main/org/apache/tools/ant/taskdefs/XmlProperty.java to:\n\n         if (addedAttributes.containsKey(name)) {\n            // If this attribute was added by this task, then\n            // we append this value to the existing value.\n            // We use the setProperty method which will\n            // forcibly override the property if it already exists.\n            // We need to put these properties into the project\n            // when we read them, though (instead of keeping them\n            // outside of the project and batch adding them at the end)\n            // to allow other properties to reference them.\n            value = (String) addedAttributes.get(name) + \",\" + value;\n        }\n        if (getProject().getProperty(name) == null) {\n            getProject().setProperty(name, value);\n            addedAttributes.put(name, value);\n        }\n        else {\n            log(\"Override ignored for property \" + name, Project.MSG_VERBOSE);\n        }\n        if (id != null) {\n            getProject().addReference(id, value);\n        }"}, {"count": 1, "tags": [], "bug_id": 41080, "text": "Oops - the suggested fix should read:\n\n         if (addedAttributes.containsKey(name)) {\n             // If ...\n             value = (String) addedAttributes.get(name) + \",\" + value;\n             getProject().setProperty(name, value);\n         }\n         else if (getProject().getProperty(name) == null) {\n             getProject().setProperty(name, value);\n             addedAttributes.put(name, value);\n         }\n         else {\n             log(\"Override ignored for property \" + name, Project.MSG_VERBOSE);\n         }\n         if (id != null) {\n             getProject().addReference(id, value);\n         }", "id": 96396, "attachment_id": null, "creator": "andy.wood@yoomedia.com", "creation_time": "2006-11-30T05:32:07Z", "time": "2006-11-30T05:32:07Z", "is_private": false}, {"count": 2, "tags": [], "creator": "peterreilly@apache.org", "text": "Committed to svn HEAD, thanks for the report.", "id": 96429, "time": "2006-11-30T13:05:05Z", "bug_id": 41080, "creation_time": "2006-11-30T13:05:05Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "attachment_id": null, "bug_id": 36250, "text": "Hi,\n\nThis issue is related to http://issues.apache.org/bugzilla/show_bug.cgi?id=26372\nand http://www.netbeans.org/issues/show_bug.cgi?id=62529\n\nI personally consider this issue to be a bug but if you believe it to be a RFE\nplease feel free to modify the severity accordingly. In a nutshell, we're\nexpecting Tomcat to return something other than \"FAIL\" on a redeploy if a\nThreadDeath occurs along the way. Since ThreadDeath does not actually indicate a\nfailure in this case, it would make sense for Tomcat to return something other\nthan \"FAIL\".", "id": 78641, "time": "2005-08-18T17:11:44Z", "creator": "cowwoc@bbs.darktech.org", "creation_time": "2005-08-18T17:11:44Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 36250, "text": "\n\n*** This bug has been marked as a duplicate of 26372 ***", "id": 78648, "time": "2005-08-18T19:21:47Z", "creator": "remm@apache.org", "creation_time": "2005-08-18T19:21:47Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 36250, "attachment_id": null, "id": 78651, "time": "2005-08-18T19:33:53Z", "creator": "cowwoc@bbs.darktech.org", "creation_time": "2005-08-18T19:33:53Z", "is_private": false, "text": "Remy... Closing this as DUPLICATE makes no logical sense. I am not complaining\nthat ThreadDeath is occuring (as the original issue does). If you had actually\nread my full report you would know this.\n\nI *understand* why ThreadDeath is occuring. I understand this is normal. I am\nsimply saying that Tomcat should not return FAIL under this condition because as\nyou yourself said in the other discussion thread this is not a failure condition\nbut rather quite normal.\n\nSo please explain: why is it alright for Tomcat to return FAIL if ThreadDeath is\nnot a failure condition? And also, I have tried all your workarounds mentioned\nin the other bug report and none of them work so there really is no way to\nworkaround this issue."}, {"count": 3, "tags": [], "bug_id": 36250, "text": "I can confirm that the behaviour of Tomcat according to an occuring ThreadDeath feels not correct. After \nsuch an failed application reloading, Tomcat should start the application or at least give the possibility to \nstart the application manually. Currently you have to restart Tomcat to get one failed application working \nagain.", "id": 78758, "time": "2005-08-20T22:36:49Z", "creator": "ralf@dreivier.net", "creation_time": "2005-08-20T22:36:49Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "cowwoc@bbs.darktech.org", "attachment_id": null, "id": 78759, "creation_time": "2005-08-20T22:41:52Z", "time": "2005-08-20T22:41:52Z", "bug_id": 36250, "text": "I'm tempted to reopen this issue again. Remy has yet to give an explanation for\nwhy he considers this issue to be a duplicate.", "is_private": false}, {"count": 5, "tags": [], "text": "Remy, I'm reopening this issue because you've not explained why this is a\nduplicate (and I believe otherwise). I'm not trying to waste your time. I'm\nhonestly interested in your answer. Thank you.", "attachment_id": null, "id": 78824, "creator": "cowwoc@bbs.darktech.org", "time": "2005-08-22T18:00:46Z", "bug_id": 36250, "creation_time": "2005-08-22T18:00:46Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 36250, "text": "\n\n*** This bug has been marked as a duplicate of 26372 ***", "id": 78827, "time": "2005-08-22T18:24:56Z", "creator": "remm@apache.org", "creation_time": "2005-08-22T18:24:56Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "text": "Remy, I'm reopening this issue since it does not seem to me to be a duplicate of\nissue 26372.\n\nThe description of this issue says that the tomcat manager should not return\nFAIL when ThreadDeath occurs, if it is not considered as a real failure.", "attachment_id": null, "id": 79808, "creator": "sherold@netbeans.org", "time": "2005-09-12T16:27:39Z", "bug_id": 36250, "creation_time": "2005-09-12T16:27:39Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 36250, "attachment_id": null, "id": 79809, "time": "2005-09-12T16:34:53Z", "creator": "remm@apache.org", "creation_time": "2005-09-12T16:34:53Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of 26372 ***"}, {"count": 9, "tags": [], "bug_id": 36250, "attachment_id": null, "text": "Marked as duplicate by mistake - because there's no explanation.", "id": 79811, "time": "2005-09-12T16:38:57Z", "creator": "zikmund@netbeans.org", "creation_time": "2005-09-12T16:38:57Z", "is_private": false}, {"count": 10, "tags": [], "text": "\n\n*** This bug has been marked as a duplicate of 26372 ***", "is_private": false, "id": 79812, "creator": "remm@apache.org", "time": "2005-09-12T16:41:17Z", "bug_id": 36250, "creation_time": "2005-09-12T16:41:17Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "(In reply to comment #9)\n> Marked as duplicate by mistake - because there's no explanation.\n\nExplanation: don't be annoying :) More seriously, this error means a\nclassloading problem. No attempt will be made at trying to recover from it. As\nfor its cause and its resolution, it's the same as the bug marked as its\nduplicate: if you can identify a situation where Tomcat sets bad classloader as\ncontext classloader, or similar bad behavior, I will make sure to fix it. This\nis really trivial logic, and it should be easy to understand without me having\nto state it in black & white and wasting time.\n\nOf course, if you reopen this again, I'll mark it as duplicate again.", "attachment_id": null, "id": 79816, "creator": "remm@apache.org", "time": "2005-09-12T16:44:47Z", "bug_id": 36250, "creation_time": "2005-09-12T16:44:47Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 36250, "attachment_id": null, "id": 79818, "time": "2005-09-12T16:51:53Z", "creator": "cowwoc@bbs.darktech.org", "creation_time": "2005-09-12T16:51:53Z", "is_private": false, "text": "Maybe I should restate this another way for Remy...\n\nLet A = \"Tomcat should not return FAIL if this classloading problem occurs\"\n    B = \"Tomcat should recover from this classloading problem\"\n\nNow bear with me.... A != B\nHow come everyone CCed on this issue understands this except you? :)"}, {"count": 13, "tags": [], "bug_id": 36250, "attachment_id": null, "id": 79819, "time": "2005-09-12T17:11:28Z", "creator": "remm@apache.org", "creation_time": "2005-09-12T17:11:28Z", "is_private": false, "text": "(In reply to comment #12)\n> A = \"Tomcat should not return FAIL if this classloading problem occurs\"\n\nWhich would be equal to considering this normal. It is not normal, except in the\nsense that it is to be expected if you do bad things, and is not recoverable.\nThe library, its usage, or whatever else is causing this should be fixed instead.\n\nAgain, if you can identify a situation where Tomcat sets bad classloaders as\ncontext classloader, or similar bad behavior (both which happened in the past,\nsince it's not trivial stuff, unfortunately), I will make sure to fix it."}, {"count": 14, "tags": [], "bug_id": 36250, "text": "(In reply to comment #12)\n> Maybe I should restate this another way for Remy...\n> \n> Let A = \"Tomcat should not return FAIL if this classloading problem occurs\"\n>     B = \"Tomcat should recover from this classloading problem\"\n> \n> Now bear with me.... A != B\n> How come everyone CCed on this issue understands this except you? :)\n\n\"A\" do you mean that Tomcat fails completely after a ThreadDeath ?\n\nMy own findings when a ThreadDeath error message occurs, even though in the\nmessage it says this error is okay, tomcat is still okay, all is right in the\nworld, this is infact not the case.\n\nFrom the point the ThreadDeath occur the web-app for which it related to no\nlonger works, can no longer be reloaded, will no longer accept HTTP requests. \nThe only way out is a container restart.\n\n\nI would agree with Remy if the ThreadDeath had occured in relation to Tomcat's\ninternal code.  But these thread death's occur from executing web-app related\ncode and I think its possible for the container to be robust enough to recover\nfrom that.\n\n\nWhat if we created a TomcatWepappClassLoaderError sub-class of java.lang.Error,\nwhich could store and pass back ThreadId, ThreadName, StackTrace, ClassForName\nbeing loaded and override printStackTrack with warning message.\n\nThen in the part of Tomcat internal code that passed control from Tomcat to web-app:\n\ntry {\n  callWebappContextMethod();\n} catch(TomcatWebappClassLoaderError e) {\n  // Take defensive action to cleanup, try to keep the thread alive and\nterminate normally\n  if(weReallyDoWantToKillThisThread) {\n    e.printFancyStackDumpToHelpDeveloperFixBug();\n    throw new ThreadDeath();\n  }\n}\n\nBut the argument here is that if control can be returned back into tomcat\ninternal code there is no need for this thread to die in this way, just treat\nthe situation like regular web-app exceptions, cleanup and keep going.\n\n\nNow if the thread in question is a background thread started by the web-app,\nthen it will die without being handled, we want to see a stackTrace and\noverloading printStampTrace() function with the warning info gives us a bespoke\ndump.\n\nI dont fully understand how this background thread ThreadDeath upsets TC, but I\nthink it does.\n\nIt is possible to setup a ThreadGroup and a defaultUncaughtExceptionHandler,\nthis must be done before any webapp related code is called (to affect new Thread\ncreation) this means that during TC startup the initial loading of web-apps\nshould no longer occur from the \"main\" thread as it does now, but from a\nsub-Thread.  This feels like a good thing to me.\n\nThere then should be documentation to assit uses to be TC friendly if they need\nto change the uncaughtExcpetionHandler in their code, the initial suggestion\nwould be to advise the code chains and invokes the default handler it was given\nfrom the container.\n\nThese are just thoughts on a way forward at this time, I would prefer if someone\ncould find a way to shoot them down (so I dont have the implement them :)", "id": 83514, "time": "2005-12-10T16:56:22Z", "creator": "darryl@darrylmiles.org", "creation_time": "2005-12-10T16:56:22Z", "is_private": false, "attachment_id": null}]
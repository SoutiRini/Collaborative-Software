[{"count": 0, "tags": [], "bug_id": 43533, "is_private": false, "id": 108884, "creation_time": "2007-10-02T03:54:41Z", "time": "2007-10-02T03:54:41Z", "creator": "noah@hd.se", "text": "Over the past years Apache has crashed several times every hour.\nI've been running Apache 2 since 2.0.40 and now we're up at 2.0.61 and still\nexperiencing these crashes so I guess it's about time I report this bug.\n\nOur site heavily relies on SSI, in particular <!--#include virtual=..-->\n(they're often nested aswell), and mod_rewrite. Output is compressed with\nmod_deflate. Often the crashdumps looks like this:\n\ncrashdump[26541]: crashdump[26541]: Thread 20 Crashed:\ncrashdump[26541]: 0   httpd                      0x000047a0 bndm + 120\n(mod_include.c:317)\ncrashdump[26541]: 1   httpd                      0x0000a100 find_start_sequence\n+ 136 (mod_include.c:2388)\ncrashdump[26541]: 2   httpd                      0x0000bad0 send_parsed_content\n+ 1288 (mod_include.c:3054)\ncrashdump[26541]: 3   httpd                      0x0000dbf8 includes_filter +\n1468 (mod_include.c:3591)\ncrashdump[26541]: 4   httpd                      0x00068e30 ap_pass_brigade +\n236 (util_filter.c:512)\ncrashdump[26541]: 5   httpd                      0x0004a5c8 default_handler +\n1888 (core.c:3648)\ncrashdump[26541]: 6   httpd                      0x00060038 ap_run_handler + 136\n(config.c:152)\ncrashdump[26541]: 7   httpd                      0x00060d8c ap_invoke_handler +\n424 (config.c:364)\ncrashdump[26541]: 8   httpd                      0x00051f98 ap_run_sub_req + 104\n(request.c:1855)\ncrashdump[26541]: 9   httpd                      0x00005a68 handle_include + 968\n(mod_include.c:782)\ncrashdump[26541]: 10  httpd                      0x0000cc80 send_parsed_content\n+ 5816 (mod_include.c:3309)\ncrashdump[26541]: 11  httpd                      0x0000dbf8 includes_filter +\n1468 (mod_include.c:3591)\ncrashdump[26541]: 12  httpd                      0x00068e30 ap_pass_brigade +\n236 (util_filter.c:512)\ncrashdump[26541]: 13  httpd                      0x0004a5c8 default_handler +\n1888 (core.c:3648)\ncrashdump[26541]: 14  httpd                      0x00060038 ap_run_handler + 136\n(config.c:152)\ncrashdump[26541]: 15  httpd                      0x00060d8c ap_invoke_handler +\n424 (config.c:364)\ncrashdump[26541]: 16  httpd                      0x0001d980 ap_process_request +\n148 (http_request.c:249)\ncrashdump[26541]: 17  httpd                      0x000145a4\nap_process_http_connection + 136 (http_core.c:255)\ncrashdump[26541]: 18  httpd                      0x0006bcdc\nap_run_process_connection + 136 (connection.c:43)\ncrashdump[26541]: 19  httpd                      0x0006c318\nap_process_connection + 132 (connection.c:178)\ncrashdump[26541]: 20  httpd                      0x0003b408 process_socket + 196\n(worker.c:523)\ncrashdump[26541]: 21  httpd                      0x0003befc worker_thread + 552\n(worker.c:843)\ncrashdump[26541]: 22  libapr-0.0.dylib           0x003796f0 dummy_worker + 68\n(thread.c:105)\ncrashdump[26541]: 23  libSystem.B.dylib          0x9002bd08 _pthread_body + 96\n--------------------------\ncrashdump[4103]: crashdump[4103]: Thread 15 Crashed:\ncrashdump[4103]: 0   httpd                       0x000047a0 bndm + 120\n(mod_include.c:317)\ncrashdump[4103]: 1   httpd                       0x0000a100 find_start_sequence\n+ 136 (mod_include.c:2388)\ncrashdump[4103]: 2   httpd                       0x0000bad0 send_parsed_content\n+ 1288 (mod_include.c:3054)\ncrashdump[4103]: 3   httpd                       0x0000dbf8 includes_filter +\n1468 (mod_include.c:3591)\ncrashdump[4103]: 4   httpd                       0x00068e30 ap_pass_brigade +\n236 (util_filter.c:512)\ncrashdump[4103]: 5   httpd                       0x0004a5c8 default_handler +\n1888 (core.c:3648)\ncrashdump[4103]: 6   httpd                       0x00060038 ap_run_handler + 136\n(config.c:152)\ncrashdump[4103]: 7   httpd                       0x00060d8c ap_invoke_handler +\n424 (config.c:364)\ncrashdump[4103]: 8   httpd                       0x00051f98 ap_run_sub_req + 104\n(request.c:1855)\ncrashdump[4103]: 9   httpd                       0x00005a68 handle_include + 968\n(mod_include.c:782)\ncrashdump[4103]: 10  httpd                       0x0000cc80 send_parsed_content\n+ 5816 (mod_include.c:3309)\ncrashdump[4103]: 11  httpd                       0x0000dbf8 includes_filter +\n1468 (mod_include.c:3591)\ncrashdump[4103]: 12  httpd                       0x00068e30 ap_pass_brigade +\n236 (util_filter.c:512)\ncrashdump[4103]: 13  httpd                       0x0004a5c8 default_handler +\n1888 (core.c:3648)\ncrashdump[4103]: 14  httpd                       0x00060038 ap_run_handler + 136\n(config.c:152)\ncrashdump[4103]: 15  httpd                       0x00060d8c ap_invoke_handler +\n424 (config.c:364)\ncrashdump[4103]: 16  httpd                       0x0001d980 ap_process_request +\n148 (http_request.c:249)\ncrashdump[4103]: 17  httpd                       0x000145a4\nap_process_http_connection + 136 (http_core.c:255)\ncrashdump[4103]: 18  httpd                       0x0006bcdc\nap_run_process_connection + 136 (connection.c:43)\ncrashdump[4103]: 19  httpd                       0x0006c318\nap_process_connection + 132 (connection.c:178)\ncrashdump[4103]: 20  httpd                       0x0003b408 process_socket + 196\n(worker.c:523)\ncrashdump[4103]: 21  httpd                       0x0003befc worker_thread + 552\n(worker.c:843)\ncrashdump[4103]: 22  libapr-0.0.dylib            0x003796f0 dummy_worker + 68\n(thread.c:105)\ncrashdump[4103]: 23  libSystem.B.dylib           0x9002bd08 _pthread_body + 96\n------------------\n\n\nI saw someone else having a similar problem here. There was an open bug about\nrandom crashes in crc32 and bndm, but with Apache 2.2.\n\nI've tried to log the PID along with the HTTP requests into a logfile and\ngrepping out the PID after the crash but I guess the thread crashes before the\nlog is written since I'm not finding anything interesting there.\n\nI've not been able to reproduce this but it keeps happening several times each\nhour. Since we've got a fair share of traffic to this host I can't really gdb\nApache and wait for a crash and see what's going on. \n\nIt might be a memory corruption since we're getting crashes in other places\naswell. It's not likely to be a hardware problem since the box have been\nreplaced two times already (for performance reasons) and the crashes have\ncontinued on the new hardware aswell.\n\nHere's one of the other crashes we're getting quite frequently but not as\nfrequently as with bndm():\ncrashdump[14604]: crashdump[14604]: Thread 7 Crashed:\ncrashdump[14604]: 0   httpd                      0x0000a6c0 find_directive + 284\n(mod_include.c:2552)\ncrashdump[14604]: 1   httpd                      0x0000bf14 send_parsed_content\n+ 2380 (mod_include.c:3118)\ncrashdump[14604]: 2   httpd                      0x0000dbf8 includes_filter +\n1468 (mod_include.c:3591)\ncrashdump[14604]: 3   httpd                      0x00068e30 ap_pass_brigade +\n236 (util_filter.c:512)\ncrashdump[14604]: 4   httpd                      0x0004a5c8 default_handler +\n1888 (core.c:3648)\ncrashdump[14604]: 5   httpd                      0x00060038 ap_run_handler + 136\n(config.c:152)\ncrashdump[14604]: 6   httpd                      0x00060d8c ap_invoke_handler +\n424 (config.c:364)\ncrashdump[14604]: 7   httpd                      0x00051f98 ap_run_sub_req + 104\n(request.c:1855)\ncrashdump[14604]: 8   httpd                      0x00005a68 handle_include + 968\n(mod_include.c:782)\ncrashdump[14604]: 9   httpd                      0x0000cc80 send_parsed_content\n+ 5816 (mod_include.c:3309)\ncrashdump[14604]: 10  httpd                      0x0000dbf8 includes_filter +\n1468 (mod_include.c:3591)\ncrashdump[14604]: 11  httpd                      0x00068e30 ap_pass_brigade +\n236 (util_filter.c:512)\ncrashdump[14604]: 12  httpd                      0x0004a5c8 default_handler +\n1888 (core.c:3648)\ncrashdump[14604]: 13  httpd                      0x00060038 ap_run_handler + 136\n(config.c:152)\ncrashdump[14604]: 14  httpd                      0x00060d8c ap_invoke_handler +\n424 (config.c:364)\ncrashdump[14604]: 15  httpd                      0x00051f98 ap_run_sub_req + 104\n(request.c:1855)\ncrashdump[14604]: 16  httpd                      0x00005a68 handle_include + 968\n(mod_include.c:782)\ncrashdump[14604]: 17  httpd                      0x0000cc80 send_parsed_content\n+ 5816 (mod_include.c:3309)\ncrashdump[14604]: 18  httpd                      0x0000dbf8 includes_filter +\n1468 (mod_include.c:3591)\ncrashdump[14604]: 19  httpd                      0x00068e30 ap_pass_brigade +\n236 (util_filter.c:512)\ncrashdump[14604]: 20  httpd                      0x0004a5c8 default_handler +\n1888 (core.c:3648)\ncrashdump[14604]: 21  httpd                      0x00060038 ap_run_handler + 136\n(config.c:152)\ncrashdump[14604]: 22  httpd                      0x00060d8c ap_invoke_handler +\n424 (config.c:364)\ncrashdump[14604]: 23  httpd                      0x0001d980 ap_process_request +\n148 (http_request.c:249)\ncrashdump[14604]: 24  httpd                      0x000145a4\nap_process_http_connection + 136 (http_core.c:255)\ncrashdump[14604]: 25  httpd                      0x0006bcdc\nap_run_process_connection + 136 (connection.c:43)\ncrashdump[14604]: 26  httpd                      0x0006c318\nap_process_connection + 132 (connection.c:178)\ncrashdump[14604]: 27  httpd                      0x0003b408 process_socket + 196\n(worker.c:523)\ncrashdump[14604]: 28  httpd                      0x0003befc worker_thread + 552\n(worker.c:843)\ncrashdump[14604]: 29  libapr-0.0.dylib           0x003796f0 dummy_worker + 68\n(thread.c:105)\n------\n\n\nThis problem has occured on Mac OS X 10.3 and up to 10.4.10, both Server\nversions. We've been running a broad list of different versions of Apache 2,\nfrom .40 to .61.\nThis problem occurs with the threaded worker.\n\n\nDoes anyone have any idea what's going on here?", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 43533, "attachment_id": null, "text": "I recently worked with a user to track down an issue with identical backtraces -\nthe root cause was PR 36780; (optimistically?) marking as a duplicate.\n\n\n*** This bug has been marked as a duplicate of 36780 ***", "id": 109244, "time": "2007-10-11T06:26:53Z", "creator": "jorton@redhat.com", "creation_time": "2007-10-11T06:26:53Z", "is_private": false}, {"count": 2, "tags": [], "creator": "jorton@redhat.com", "text": "Reporter says the patch for bug 36780 didn't help, so re-opening.\n\nNoah:\n\n1) can you reproduce this with prefork rather than worker?\n2) can you get a coredump and do some debugging with gdb?\n\nWhat is needed out of the core dump is:\n\n# gdb /path/to/httpd core.dump\n(gdb) source /patch/to/httpd/src/.gdbinit\n\nthen select a frame with a apr_bucket_brigade * in scope, e.g.\nsend_parsed_content, e.g. \"up 2\" from that first \"Thread 20\", and do:\n\n(gdb) dump_brigade bb\n\nto dump the contents of the brigade.\n\n", "id": 109295, "time": "2007-10-12T01:28:13Z", "bug_id": 43533, "creation_time": "2007-10-12T01:28:13Z", "is_private": false, "attachment_id": null}, {"text": "(In reply to comment #2)\n> Reporter says the patch for bug 36780 didn't help, so re-opening.\n> \n> Noah:\n> \n> 1) can you reproduce this with prefork rather than worker?\n\nI'll try.\nIs it crucial for the debugging part or just interesting to know whether it\nmight be a threading related problem or not?\n\n\n> 2) can you get a coredump and do some debugging with gdb?\n> \n> What is needed out of the core dump is:\n> \n> # gdb /path/to/httpd core.dump\n> (gdb) source /patch/to/httpd/src/.gdbinit\n> \n> then select a frame with a apr_bucket_brigade * in scope, e.g.\n> send_parsed_content, e.g. \"up 2\" from that first \"Thread 20\", and do:\n> \n> (gdb) dump_brigade bb\n> \n> to dump the contents of the brigade.\n\nI've enabled coredumps and I'll see if I can find some time to look into it.", "tags": [], "creator": "noah@hd.se", "is_private": false, "count": 3, "id": 109296, "time": "2007-10-12T02:13:58Z", "bug_id": 43533, "creation_time": "2007-10-12T02:13:58Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 43533, "text": "This is what Mac OS X's crashdump process have to say.\n\nThread 2 Crashed:\n0   httpd                       0x00004760 bndm + 120 (mod_include.c:317)\n1   httpd                       0x0000a0c0 find_start_sequence + 136\n(mod_include.c:2388)\n2   httpd                       0x0000ba90 send_parsed_content + 1288\n(mod_include.c:3054)\n3   httpd                       0x0000dbb8 includes_filter + 1468\n(mod_include.c:3591)\n4   httpd                       0x00068e20 ap_pass_brigade + 236 (util_filter.c:512)\n5   httpd                       0x0004a588 default_handler + 1888 (core.c:3648)\n6   httpd                       0x00060028 ap_run_handler + 136 (config.c:152)\n7   httpd                       0x00060d7c ap_invoke_handler + 424 (config.c:364)\n8   httpd                       0x00051f58 ap_run_sub_req + 104 (request.c:1855)\n9   httpd                       0x00005a28 handle_include + 968 (mod_include.c:782)\n10  httpd                       0x0000cc40 send_parsed_content + 5816\n(mod_include.c:3309)\n11  httpd                       0x0000dbb8 includes_filter + 1468\n(mod_include.c:3591)\n12  httpd                       0x00068e20 ap_pass_brigade + 236 (util_filter.c:512)\n13  httpd                       0x0004a588 default_handler + 1888 (core.c:3648)\n14  httpd                       0x00060028 ap_run_handler + 136 (config.c:152)\n15  httpd                       0x00060d7c ap_invoke_handler + 424 (config.c:364)\n16  httpd                       0x0001d940 ap_process_request + 148\n(http_request.c:249)\n17  httpd                       0x00014564 ap_process_http_connection + 136\n(http_core.c:255)\n18  httpd                       0x0006bcdc ap_run_process_connection + 136\n(connection.c:43)\n19  httpd                       0x0006c318 ap_process_connection + 132\n(connection.c:178)\n20  httpd                       0x0003b3c8 process_socket + 196 (worker.c:523)\n21  httpd                       0x0003bebc worker_thread + 552 (worker.c:843)\n22  libapr-0.0.dylib            0x003796f0 dummy_worker + 68 (thread.c:105)\n23  libSystem.B.dylib           0x9002bd08 _pthread_body + 96\n\n\n\nNow, if I'm running GDB, I'm getting this.\n\n# gdb -q /opt/FrontA/apache/bin/httpd core.9148 \nReading symbols for shared libraries ........... done\n#0  0x900148a8 in read ()\n(gdb) source /data/FrontA/software/httpd-2.0.61/.gdbinit\n(gdb) thread 2\n[Switching to thread 2 (core thread 1)]\n#0  0x9001f88c in select ()\n(gdb) bt\n#0  0x9001f88c in select ()\n#1  0x003851ec in ?? ()\n#2  0x00386728 in ?? ()\n#3  0x00372e2c in ?? ()\n#4  0x001af150 in ?? ()\n#5  0x001aba20 in ?? ()\n#6  0x0004ac48 in core_input_filter (f=0x133d060, b=0x11d4bd0,\nmode=AP_MODE_GETLINE, block=APR_BLOCK_READ, readbytes=0) at core.c:3802\n#7  0x00068d04 in ap_get_brigade (next=0x133d060, bb=0x11d4bd0,\nmode=AP_MODE_GETLINE, block=APR_BLOCK_READ, readbytes=0) at util_filter.c:475\n#8  0x0004a83c in net_time_filter (f=0x137ff70, b=0x11d4bd0,\nmode=AP_MODE_GETLINE, block=APR_BLOCK_READ, readbytes=0) at core.c:3705\n#9  0x00068d04 in ap_get_brigade (next=0x137ff70, bb=0x11d4bd0,\nmode=AP_MODE_GETLINE, block=APR_BLOCK_READ, readbytes=0) at util_filter.c:475\n#10 0x0005b51c in ap_rgetline_core (s=0x1327c58, n=8192, read=0xf0101b40,\nr=0x1327c40, fold=0, bb=0x11d4bd0) at protocol.c:230\n#11 0x0005beac in read_request_line (r=0x1327c40, bb=0x11d4bd0) at protocol.c:586\n#12 0x0005cb70 in ap_read_request (conn=0x133ce10) at protocol.c:877\n#13 0x00014648 in ap_process_http_connection () at apr_xml.c:737\n#14 0x0006bcdc in ap_run_process_connection (c=0x133ce10) at connection.c:43\n#15 0x0006c318 in ap_process_connection (c=0x133ce10, csd=0x1321200) at\nconnection.c:176\n#16 0x0003b3c8 in process_socket (p=0x11973a0, sock=0x1321200, my_child_num=7,\nmy_thread_num=0, bucket_alloc=0x185fc18) at worker.c:522\n#17 0x0003bebc in worker_thread (thd=0x416c60, dummy=0x469760) at worker.c:842\n#18 0x003796f0 in ?? ()\n#19 0x9002bd08 in _pthread_body ()\n\n\nGDB and crashdump sees different addresses for \"0x00014648 in\nap_process_http_connection\". Is this normal? \nAfter that it seems that the stackframes differs wildly, at least in my eyes.\n\n\ngdb -v says\nGNU gdb 6.1-20040303 (Apple version gdb-384) (Mon Mar 21 00:05:26 GMT 2005)\n\nApache was compiled using:\n./configure --enable-so --enable-mods-shared=auth-anon auth-digest file-cache\ncache disk-cache mem-cache deflate mime-magic expires headers use\nrtrack unique-id proxy proxy-http ssl vhost-alias cgi info speling rewrite\n--with-mpm=prefork --mandir=/usr/share/man --prefix=/opt/FrontA/apache-2\n.0.61-prefork --enable-pool-debug\n\n\nFive years back or so when I last used GDB I recall it had issues with threads,\nis that still so?\n\nMaybe I should try to see if the problem occurs with MPM prefork unless you've\ngot some input on this thing?\n\nI tried doing a bunch of backtraces on other core files aswell but their\nbacktraces all look like the one above.", "id": 109315, "attachment_id": null, "creator": "noah@hd.se", "creation_time": "2007-10-12T15:09:54Z", "time": "2007-10-12T15:09:54Z", "is_private": false}, {"count": 5, "tags": [], "creator": "Markus.Linnala@plenware.fi", "attachment_id": null, "id": 122592, "creation_time": "2008-11-18T04:02:45Z", "time": "2008-11-18T04:02:45Z", "bug_id": 43533, "text": "You need to have #include virtual on file which changes during request. I guess as file is mmapped and if it is not complete or changes during request you get these crashes.\n\nReproducible. RHEL4 x86_64 Stock 2.2.10, compiled:\nCFLAGS='-O0 -g' ./configure --with-mpm=prefork --enable-maintainer-mode\n\nCreate shtml file with include virtual, so that it includes complex shtml-file.\n\n# cat html/test-43533.shtml \n<html><body>\n<!--#include virtual=\"inc-43533.shtml\" -->\n</body></html>\n# cat html/inc-43533-orig.shtml \n<!--#config timefmt=\"%M\" -->\n<!--#if expr=\"$date_local > 00 && $date_local < 10\" -->\n  <!--#include virtual=\"/foo2.html\" -->\n<!--#endif -->\n<!--#if expr=\"$date_local > 09 && $date_local < 20\" -->\n  <!--#include virtual=\"/foo2.html\" -->\n<!--#endif -->\n<!--#if expr=\"$date_local > 19 && $date_local < 30\" -->\n  <!--#include virtual=\"/foo2.html\" -->\n<!--#endif -->\n<!--#if expr=\"$date_local > 29 && $date_local < 40\" -->\n  <!--#include virtual=\"/foo2.html\" -->\n<!--#endif -->\n<!--#if expr=\"$date_local > 39 && $date_local < 50\" -->\n  <!--#include virtual=\"/foo2.html\" -->\n<!--#endif -->\n<!--#if expr=\"$date_local > 49 && $date_local < 60\" -->\n  <!--#include virtual=\"/foo2.html\" -->\n<!--#endif -->\n\nCreate job that changes file continuously:\n# (while sleep 1;do cp html/inc-43533-orig.shtml html/inc-43533.shtml;done)&\n\nStart prefork (or worker) apache with -X option. \n\nRequest test-43533.shtml with ab and wait it to crash.\n\nBelow several points.\n\nProgram received signal SIGBUS, Bus error.\n[Switching to Thread 182897648736 (LWP 13275)]\n0x0000000000450d71 in find_directive (ctx=0x65f7a8, \n    data=0x2a959131de \"if expr=\\\"$date_local > 39 && $date_local < 50\\\" -->\\n  <!--#include virtual=\\\"/foo2.html\\\" -->\\n<!--#endif -->\\n<!--#if expr=\\\"$date_local > 49 && $date_local < 60\\\" -->\\n  <!--#include virtual=\\\"/foo2.html\\\" --\"..., \n    len=217, store=0x7fbfffee20, store_len=0x7fbfffee18) at mod_include.c:2726\n2726            while (p < ep && !apr_isspace(*p)) {\n(gdb) where\n#0  0x0000000000450d71 in find_directive (ctx=0x65f7a8, \n    data=0x2a959131de \"if expr=\\\"$date_local > 39 && $date_local < 50\\\" -->\\n  <!--#include virtual=\\\"/foo2.html\\\" -->\\n<!--#endif -->\\n<!--#if expr=\\\"$date_local > 49 && $date_local < 60\\\" -->\\n  <!--#include virtual=\\\"/foo2.html\\\" --\"..., \n    len=217, store=0x7fbfffee20, store_len=0x7fbfffee18) at mod_include.c:2726\n#1  0x0000000000452068 in send_parsed_content (f=0x65f5e8, bb=0x65f768) at mod_include.c:3300\n#2  0x0000000000453075 in includes_filter (f=0x65f5e8, b=0x65f768) at mod_include.c:3651\n#3  0x00000000004490c4 in ap_pass_brigade (next=0x65f5e8, bb=0x65f768) at util_filter.c:526\n#4  0x0000000000434b44 in default_handler (r=0x65da78) at core.c:3740\n#5  0x000000000043bc88 in ap_run_handler (r=0x65da78) at config.c:157\n#6  0x000000000043c52f in ap_invoke_handler (r=0x65da78) at config.c:372\n#7  0x0000000000439128 in ap_run_sub_req (r=0x65da78) at request.c:1876\n#8  0x000000000044e027 in handle_include (ctx=0x654128, f=0x653e90, bb=0x654c40) at mod_include.c:1737\n#9  0x00000000004527b8 in send_parsed_content (f=0x653e90, bb=0x6540e8) at mod_include.c:3432\n#10 0x0000000000453075 in includes_filter (f=0x653e90, b=0x6540e8) at mod_include.c:3651\n#11 0x00000000004490c4 in ap_pass_brigade (next=0x653e90, bb=0x6540e8) at util_filter.c:526\n#12 0x0000000000434b44 in default_handler (r=0x64fa08) at core.c:3740\n#13 0x000000000043bc88 in ap_run_handler (r=0x64fa08) at config.c:157\n#14 0x000000000043c52f in ap_invoke_handler (r=0x64fa08) at config.c:372\n#15 0x000000000045bd5f in ap_process_request (r=0x64fa08) at http_request.c:258\n#16 0x0000000000458f84 in ap_process_http_connection (c=0x64bbd8) at http_core.c:190\n#17 0x0000000000444d25 in ap_run_process_connection (c=0x64bbd8) at connection.c:43\n#18 0x0000000000445156 in ap_process_connection (c=0x64bbd8, csd=0x64b9e8) at connection.c:178\n#19 0x00000000004747a6 in child_main (child_num_arg=0) at prefork.c:650\n#20 0x0000000000474876 in make_child (s=0x5b9160, slot=0) at prefork.c:690\n#21 0x0000000000474e0a in ap_mpm_run (_pconf=0x5b0138, plog=0x5f2348, s=0x5b9160) at prefork.c:966\n#22 0x0000000000423bea in main (argc=6, argv=0x7fbffff7d8) at main.c:740\n\n\nProgram received signal SIGBUS, Bus error.\n[Switching to Thread 182897648736 (LWP 15546)]\n0x00000000004508d4 in bndm (t=0x6559b8, \n    h=0x2a95913247 \"\\n<!--#if expr=\\\"$date_local > 49 && $date_local < 60\\\" -->\\n  <!--#include virtual=\\\"/foo2.html\\\" -->\\n<!--#endif -->\\n\", hl=112) at mod_include.c:2520\n2520                d &= T[(unsigned char) *p--];\n#0  0x00000000004508d4 in bndm (t=0x6559b8, \n    h=0x2a95913247 \"\\n<!--#if expr=\\\"$date_local > 49 && $date_local < 60\\\" -->\\n  <!--#include virtual=\\\"/foo2.html\\\" -->\\n<!--#endif -->\\n\", hl=112) at mod_include.c:2520\n#1  0x00000000004509bf in find_start_sequence (ctx=0x659778, \n    data=0x2a95913247 \"\\n<!--#if expr=\\\"$date_local > 49 && $date_local < 60\\\" -->\\n  <!--#include virtual=\\\"/foo2.html\\\" -->\\n<!--#endif -->\\n\", len=112) at mod_include.c:2561\n#2  0x0000000000451d20 in send_parsed_content (f=0x6595b8, bb=0x659738) at mod_include.c:3238\n#3  0x0000000000453075 in includes_filter (f=0x6595b8, b=0x659738) at mod_include.c:3651\n...\n\n\nProgram received signal SIGBUS, Bus error.\n[Switching to Thread 182897648736 (LWP 16265)]\n0x0000000000450d71 in find_directive (ctx=0x65b788, data=0x2a959131de \"\", len=217, store=0x7fbfffee20, \n    store_len=0x7fbfffee18) at mod_include.c:2726\n2726            while (p < ep && !apr_isspace(*p)) {\n\n\nProgram received signal SIGBUS, Bus error.\n[Switching to Thread 182897648736 (LWP 16695)]\n0x000000000045102b in find_arg_or_tail (ctx=0x6637c8, \n    data=0x2a959130e7 \" -->\\n<!--#endif -->\\n<!--#if expr=\\\"$date_local > 19 && $date_local < 30\\\" -->\\n  <!--#include virtual=\\\"/foo2.html\\\" -->\\n<!--#endif -->\\n<!--#if expr=\\\"$date_local > 29 && $date_local < 40\\\" -->\\n  <!--#includ\"..., len=464)\n    at mod_include.c:2823\n2823        while (p < ep && apr_isspace(*p)) {\n\n\n\nProgram received signal SIGBUS, Bus error.\n[Switching to Thread 182897648736 (LWP 17474)]\n0x0000003f31072584 in memcpy () from /lib64/tls/libc.so.6\n(gdb) where\n#0  0x0000003f31072584 in memcpy () from /lib64/tls/libc.so.6\n#1  0x0000002a955731ff in apr_brigade_flatten (bb=0x657830, c=0x65baa8 \"/foo2.html\", len=0x7fbfffed98)\n    at buckets/apr_brigade.c:252\n#2  0x0000002a955732a6 in apr_brigade_pflatten (bb=0x657830, c=0x65ba88, len=0x65ba90, pool=0x65b9e8)\n    at buckets/apr_brigade.c:294\n#3  0x00000000004523e1 in send_parsed_content (f=0x6575a8, bb=0x657728) at mod_include.c:3370\n...\n\n\nProgram received signal SIGBUS, Bus error.\n[Switching to Thread 182897648736 (LWP 17906)]\n0x00000000004516ca in find_argument (ctx=0x659778, \n    data=0x2a9591306d \"/foo2.html\\\" -->\\n<!--#endif -->\\n<!--#if expr=\\\"$date_local > 09 && $date_local < 20\\\" -->\\n  <!--#include virtual=\\\"/foo2.html\\\" -->\\n<!--#endif -->\\n<!--#if expr=\\\"$date_local > 19 && $date_local < 30\\\" -->\\n  \"..., \n    len=586, store=0x7fbfffee20, store_len=0x7fbfffee18) at mod_include.c:3028\n3028                if (intern->quote && *p == '\\\\') {\n\n\n(gdb) print *(*b->list->next)->type\n$16 = {name = 0x2a9558b054 \"MMAP\", num_func = 5, is_metadata = APR_BUCKET_DATA, \n  destroy = 0x2a95575042 <mmap_bucket_destroy>, read = 0x2a95574f98 <mmap_bucket_read>, \n  setaside = 0x2a9557519a <mmap_bucket_setaside>, split = 0x422698, copy = 0x421cb8}", "is_private": false}, {"count": 6, "tags": [], "creator": "noah@hd.se", "text": "(In reply to comment #5)\n> You need to have #include virtual on file which changes during request. I guess\n> as file is mmapped and if it is not complete or changes during request you get\n> these crashes.\n\nNice catch. It could very well be just that.\nWe do have frequent updates of those files (via FTP) on the server and they're rewritten each time they're updated, not moved in place. \n\n", "id": 122593, "time": "2008-11-18T04:07:40Z", "bug_id": 43533, "creation_time": "2008-11-18T04:07:40Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "karolbe@gmail.com", "attachment_id": null, "text": "I am consistently getting following exception when trying to process different documents on multiple threads:\n\norg.w3c.dom.DOMException: file:/tmp/layer_3139666847115514441Complex%20SVG%20intro.svg:\nThe attribute \"style\" represents an invalid CSS declaration (\"fill:#148409;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:17.00787354;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none;stroke-dashoffset:0\").\nOriginal message:\njava.lang.NullPointerException\n        at org.apache.batik.css.engine.CSSEngine.getCascadedStyleMap(CSSEngine.java:825)\n        at org.apache.batik.css.engine.CSSEngine.getComputedStyle(CSSEngine.java:868)\n        at org.apache.batik.bridge.CSSUtilities.getComputedStyle(CSSUtilities.java:82)\n        at org.apache.batik.bridge.CSSUtilities.convertDisplay(CSSUtilities.java:564)\n        at org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:206)\n        at org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n        at org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:219)\n        at org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n        at org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:219)\n        at org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n        at org.apache.batik.bridge.GVTBuilder.build(GVTBuilder.java:82)\n        at org.apache.batik.transcoder.SVGAbstractTranscoder.transcode(SVGAbstractTranscoder.java:208)\n        at org.apache.batik.transcoder.print.PrintTranscoder.transcode(PrintTranscoder.java:159)\n        at org.apache.batik.transcoder.XMLAbstractTranscoder.transcode(XMLAbstractTranscoder.java:142)\n        at org.apache.batik.transcoder.SVGAbstractTranscoder.transcode(SVGAbstractTranscoder.java:156)\n        at org.apache.batik.transcoder.print.PrintTranscoder.print(PrintTranscoder.java:307)\n\n\nThis is a code fragment (which I have written) which causes the issue:\n\n        String parser = XMLResourceDescriptor.getXMLParserClassName();\n        SAXSVGDocumentFactory f = new SAXSVGDocumentFactory(parser);\n        Document doc = f.createDocument(svgUri);\n...\n...\n\n    final  public void render(Graphics2D graphics2D, float width, float height) throws Exception {\n        TranscoderInput input = new TranscoderInput(doc);\n        PrintTranscoder printTranscoder = new PrintTranscoder();\n        printTranscoder.addTranscodingHint(PrintTranscoder.KEY_SCALE_TO_PAGE, Boolean.TRUE);\n        printTranscoder.addTranscodingHint(PrintTranscoder.KEY_PAGE_WIDTH,\n                                 new Float(width));\n        printTranscoder.addTranscodingHint(PrintTranscoder.KEY_PAGE_HEIGHT,\n                                 new Float(height));\n        printTranscoder.addTranscodingHint(PrintTranscoder.KEY_WIDTH,\n                                 new Float(width));\n        printTranscoder.addTranscodingHint(PrintTranscoder.KEY_HEIGHT,\n                                 new Float(height));\n        printTranscoder.transcode(input, null);\n        PageFormat pageFormat = new PageFormat();\n        Paper paper = new Paper();\n        paper.setSize(width, height);\n        paper.setImageableArea(0, 0, width, height);\n        pageFormat.setPaper(paper);\n        printTranscoder.print(graphics2D, pageFormat, 0);\n    }\n\nWhen I make the method 'synchronized' all works fine (also, when there is only one thread then it works fine too). I am testing it with 5 threads and the exception is thrown always.\n\nI am using current (trunk from SVN) version of Batik.\n\nAt first I thought that it is connected to the bug #46360 in FOP but I am not using FOP in this case (and even if I am wrong about it I have the latest FOP from SVN which should have that bug fixed).", "id": 143030, "time": "2011-01-02T14:21:41Z", "bug_id": 50536, "creation_time": "2011-01-02T14:21:41Z", "is_private": false}, {"text": "(In reply to comment #0)\n> I am consistently getting following exception when trying to process different\n> documents on multiple threads [...]\n\nAre you sure to be following the tips at \"Writing thread-safe code\" [1]?\n\nIf so, then please attach more information (Java version, Java vendor, operating system, reduced code snippet, etc.). Otherwise, this is just another issue needing to be added to the FAQ [2] (if so, would you help creating a generic FAQ item for this symptoms? Thanks!).\n\n\n[1] http://xmlgraphics.apache.org/batik/using/scripting/java.html#Threads\n[2] http://xmlgraphics.apache.org/batik/faq.html", "tags": [], "bug_id": 50536, "attachment_id": null, "count": 1, "id": 143272, "time": "2011-01-11T14:50:25Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2011-01-11T14:50:25Z", "is_private": false}]
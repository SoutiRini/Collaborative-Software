[{"count": 0, "tags": [], "creator": "daniel.lescohier@cnet.com", "text": "Created attachment 21691\nmod_rewrite mapfunc_hash hash_make patch\n\nI checked trunk, and this problem still exists there.\n\nap_register_rewrite_mapfunc calls apr_hash_set on a hashtable.  However, mod_rewrite registers ap_register_rewrite_mapfunc as an optional function before the hashtable is initialized with apr_hash_make.  That makes the ap_register_rewrite_mapfunc function available to other modules before the memory is initialized.\n\nI found this out when writing a custom module that registers a function with ap_register_rewrite_mapfunc.  My module has to do it in the pre_config stage, because mod_rewrite requires the map function to be registered before it reads a config line referencing it.\n\nIf I have in the apache config a LoadModule of my module before a LoadModule of mod_rewrite, then I get a segmentation fault in the pre-config stage, because it's dereferencing a null pointer to a non-existent hashtable.  If I change the order of the LoadModule commands to load mod_rewrite first, then it works fine.  If I have LoadModule of my module first, the segmentation fault happens even though I register my hook to happen after mod_rewrite, like this:\n\n    static const char * const preModules[] = { \"mod_rewrite.c\", NULL };\n    ap_hook_pre_config(register_rewrite_whitelist_functions,\n\t\t\tpreModules,NULL,APR_HOOK_MIDDLE);\n\nI fixed the problem with the mod_rewrite.c patch I'm including (-1 code line, +1 code line).  With this patch applied, I do not even have to list mod_rewrite.c to be run first in the pre_config stage; my module can be like this:\n\n    ap_hook_pre_config(register_rewrite_whitelist_functions,\n\t\t\tNULL,NULL,APR_HOOK_MIDDLE);\n\nWith the patch I'm attaching applied, and with my module using the pre_config hook without listing mod_rewrite.c, I get no segmentation fault, even if my module is LoadModule'd first.\n\nI think this should be fixed in trunk, and backported to 2.2 and 2.0.", "id": 114770, "attachment_id": 21691, "bug_id": 44641, "creation_time": "2008-03-19T13:17:59Z", "time": "2008-03-19T13:17:59Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 44641, "is_private": false, "count": 1, "id": 114831, "time": "2008-03-20T14:39:00Z", "creator": "rpluem@apache.org", "creation_time": "2008-03-20T14:39:00Z", "text": "Thanks for the patch. Committed to trunk as r639465 (http://svn.apache.org/viewvc?rev=639465&view=rev)."}, {"text": "Proposed for backport to 2.2.x as r660284 (http://svn.apache.org/viewvc?rev=660284&view=rev).", "tags": [], "bug_id": 44641, "is_private": false, "count": 2, "id": 116980, "time": "2008-05-26T13:04:42Z", "creator": "rpluem@apache.org", "creation_time": "2008-05-26T13:04:42Z", "attachment_id": null}, {"text": "Backport to 2.2.x as r660572\n(http://svn.apache.org/viewvc?rev=660572&view=rev).", "tags": [], "bug_id": 44641, "is_private": false, "count": 3, "id": 117020, "time": "2008-05-27T09:03:56Z", "creator": "rpluem@apache.org", "creation_time": "2008-05-27T09:03:56Z", "attachment_id": null}]
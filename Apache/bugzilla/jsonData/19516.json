[{"count": 0, "tags": [], "bug_id": 19516, "text": "I use the <ear> task with compress='false' to create a 33MB .ear file, \nincluding a 17MB .war file and some smaller .jars.\n\nZip.addResources() calls Zip.zipFile() here:\n   zipFile(zf.getInputStream(ze), ... );\nThe zipFile() method in turn checks whether the InputStream param has \nmarkSupported: if so, it marks, reads, and resets.  Else, it buffers the entire \nInputStream into a ByteArrayOutputStream/byte[].  That byte[] (for my build \nscript) is huge!\n\nSolution: change the line of code above to an InputStream that supports marking.\n    zipFile( new BufferedInputStream(zf.getInputStream(ze)), ... );\nAND, probably, close that InputStream!\n\nregards,\nGlen Lewis\n\nHPROF output:\n\n\nSITES BEGIN (ordered by live bytes) Thu May 01 09:42:37 2003\n          percent         live       alloc'ed  stack class\n rank   self  accum    bytes objs   bytes objs trace name\n    1 58.28% 58.28% 33554448    1 110366624  250 13654 [B\n    2 30.62% 88.89% 17629416    1 33432128   44 13656 [B\n    3  4.10% 92.99%  2359296    2 2359296    2     0 [I\n... remaining sites each consume <100kb of memory, not important\n\n\nTRACE 13654:\n\tjava.io.ByteArrayOutputStream.write(ByteArrayOutputStream.java:104)\n\torg.apache.tools.ant.taskdefs.Zip.zipFile(Zip.java:609)\n\torg.apache.tools.ant.taskdefs.Jar.zipFile(Jar.java:238)\n\torg.apache.tools.ant.taskdefs.Zip.zipFile(Zip.java:651)\n\torg.apache.tools.ant.taskdefs.Jar.zipFile(Jar.java:220)\n\torg.apache.tools.ant.taskdefs.Ear.zipFile(Ear.java:134)\n\torg.apache.tools.ant.taskdefs.Zip.addFiles(Zip.java:394)\n\torg.apache.tools.ant.taskdefs.Zip.execute(Zip.java:271)\n\torg.apache.tools.ant.Task.perform(Task.java:217)\n\torg.apache.tools.ant.Target.execute(Target.java:184)\n\torg.apache.tools.ant.Target.performTasks(Target.java:202)\n\torg.apache.tools.ant.Project.executeTarget(Project.java:601)\n\torg.apache.tools.ant.taskdefs.Ant.execute(Ant.java:266)\n\torg.apache.tools.ant.taskdefs.CallTarget.execute(CallTarget.java:120)\n\torg.apache.tools.ant.Task.perform(Task.java:217)\n\torg.apache.tools.ant.Target.execute(Target.java:184)\n\torg.apache.tools.ant.Target.performTasks(Target.java:202)\n\torg.apache.tools.ant.Project.executeTarget(Project.java:601)\n\torg.apache.tools.ant.Project.executeTargets(Project.java:560)\n\torg.apache.tools.ant.Main.runBuild(Main.java:454)\n\torg.apache.tools.ant.Main.start(Main.java:153)\n\torg.apache.tools.ant.Main.main(Main.java:176)\n\n\nTRACE 13656:\n\tjava.io.ByteArrayOutputStream.toByteArray\n(ByteArrayOutputStream.java:146)\n\torg.apache.tools.ant.taskdefs.Zip.zipFile(Zip.java:612)\n\torg.apache.tools.ant.taskdefs.Jar.zipFile(Jar.java:238)\n\torg.apache.tools.ant.taskdefs.Zip.zipFile(Zip.java:651)\n\torg.apache.tools.ant.taskdefs.Jar.zipFile(Jar.java:220)\n\torg.apache.tools.ant.taskdefs.Ear.zipFile(Ear.java:134)\n\torg.apache.tools.ant.taskdefs.Zip.addFiles(Zip.java:394)\n\torg.apache.tools.ant.taskdefs.Zip.execute(Zip.java:271)\n\torg.apache.tools.ant.Task.perform(Task.java:217)\n\torg.apache.tools.ant.Target.execute(Target.java:184)\n\torg.apache.tools.ant.Target.performTasks(Target.java:202)\n\torg.apache.tools.ant.Project.executeTarget(Project.java:601)\n\torg.apache.tools.ant.taskdefs.Ant.execute(Ant.java:266)\n\torg.apache.tools.ant.taskdefs.CallTarget.execute(CallTarget.java:120)\n\torg.apache.tools.ant.Task.perform(Task.java:217)\n\torg.apache.tools.ant.Target.execute(Target.java:184)\n\torg.apache.tools.ant.Target.performTasks(Target.java:202)\n\torg.apache.tools.ant.Project.executeTarget(Project.java:601)\n\torg.apache.tools.ant.Project.executeTargets(Project.java:560)\n\torg.apache.tools.ant.Main.runBuild(Main.java:454)\n\torg.apache.tools.ant.Main.start(Main.java:153)\n\torg.apache.tools.ant.Main.main(Main.java:176)", "id": 36447, "time": "2003-05-01T14:48:36Z", "creator": "glen_lewis@hotmail.com", "creation_time": "2003-05-01T14:48:36Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "jaikiran@apache.org", "attachment_id": null, "text": "Thank you for suggesting the change. A pull request with this change has been submitted https://github.com/apache/ant/pull/51", "id": 202731, "time": "2017-12-12T11:28:25Z", "bug_id": 19516, "creation_time": "2017-12-12T11:28:25Z", "is_private": false}, {"count": 2, "tags": [], "text": "Fixed and will be available in 1.9.10 and 1.10.2 releases.", "attachment_id": null, "id": 202755, "creation_time": "2017-12-13T13:52:20Z", "time": "2017-12-13T13:52:20Z", "creator": "jaikiran@apache.org", "bug_id": 19516, "is_private": false}]
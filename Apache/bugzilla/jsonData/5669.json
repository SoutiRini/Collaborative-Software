[{"count": 0, "tags": [], "creator": "vincent.aumont@vsl.ca", "attachment_id": null, "id": 9310, "time": "2002-01-02T22:36:52Z", "bug_id": 5669, "creation_time": "2002-01-02T22:36:52Z", "is_private": false, "text": "My environment:\n- jdk 1.3\n- tomcat 4.0.1\n- NT\n-log4f 1.1.3\n\nProblem Description:\nThe SMTPAppender fails to include the log message for errors logged by a \nservlet.\n\nCode Sample:\nIn the following piece of code, when the method logAnError is called from the \nmain line, the email includes the stack trace ('ERROR 2002-01-02 22:02:15,454  \nfoo.bar - this is an error'). However, when called from the servlet, the \nappender sends an empty email.\n\nI read somewhere \n(http://www.geocrawler.com/archives/3/8359/2001/2/0/5217549/)that a similar bug \nwas fixed in 1.1b1 but I'm using 1.1.3.\n\nimport java.io.*;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\n\nimport java.util.*;\nimport org.apache.log4j.*;\n\n\npublic class TestServlet extends HttpServlet\n{\n  public void doGet(HttpServletRequest req, HttpServletResponse res)\n    throws ServletException, IOException\n  {\n    logAnErrorMessage(); // The email does not contain the stack trace\n    res.setContentType(\"text/html\");\n    PrintWriter out = res.getWriter();\n\n    out.println(\"<html><body>hello world</body></html>\");\n  }\n\n  private static void logAnErrorMessage()\n  {\n\n    Properties props = new Properties();\n    props.setProperty(\"log4j.rootCategory\",\"debug, stdout, mail\");\n\n    props.setProperty(\"log4j.appender.stdout\",\n                      \"org.apache.log4j.ConsoleAppender\");\n    props.setProperty(\"log4j.appender.stdout.layout\",\n                      \"org.apache.log4j.PatternLayout\");\n    props.setProperty(\"log4j.appender.stdout.layout.ConversionPattern\",\n                      \"%-5p %d  %c - %m%n\");\n\n    props.setProperty(\"log4j.appender.mail\",\n                      \"org.apache.log4j.net.SMTPAppender\");\n    props.setProperty(\"log4j.appender.mail.To\",\"<my email>\");\n    props.setProperty(\"log4j.appender.mail.From\",\"scriptum@annotate.ca\");\n    props.setProperty(\"log4j.appender.mail.Subject\",\"An error occurred\");\n    props.setProperty(\"log4j.appender.mail.SMTPHost\",\"smtp.telus.net\");\n    props.setProperty(\"log4j.appender.mail.layout\",\n                      \"org.apache.log4j.PatternLayout\");\n    props.setProperty(\"log4j.appender.mail.layout.ConversionPattern\",\n                      \"%-5p %d  %c - %m%n\");\n\n    PropertyConfigurator.configure(props);\n\n\n    Category cat = Category.getInstance(\"foo.bar\");\n    cat.error(\"this is an error\");\n\n  }\n\n  public static void main (String[] args)\n  {\n    logAnErrorMessage(); // The email contains the stack trace\n  }\n\n}\n\n\n-Vincent."}, {"count": 1, "tags": [], "bug_id": 5669, "attachment_id": null, "is_private": false, "id": 9324, "time": "2002-01-03T12:12:46Z", "creator": "vincent.aumont@vsl.ca", "creation_time": "2002-01-03T12:12:46Z", "text": "Sorry about that, it was caused by a conflict in the jar files. I had not \nnoticed that Tomcat 4 comes with a mail.jar and a activation.jar stored in \n$CATALINA_HOME/common/lib.\n     \n-Vincent."}]
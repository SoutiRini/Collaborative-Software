[{"count": 0, "tags": [], "bug_id": 56178, "is_private": false, "text": "Certain characters have special meaning to the keytool application when used in the command-line -dname parameter. For example:\n\nkeytool -genkeypair -dname \"OU=Foobar, INC\" -keyalg RSA -keystore proxyserver.jks -storepass password\nkeytool error: java.io.IOException: Incorrect AVA format\n\nand\n\nkeytool -genkeypair -dname \"CN=DOMAIN\\USER\" -keyalg RSA -keystore proxyserver.jks -storepass password\nkeytool error: java.io.IOException: Invalid escaped character in AVA: 'U'\n\nThe keytool doc [1] only mentions comma as requiring escape.\nHowever there are some others that are apparently not allowed, such as + (plus). It also looks like ; (semi-colon) is not allowed without escaping\n\nUnfortunately keytool complains if escaping is used when it is not necessary, so it's important to only escape where necessary.\n\nThe problem arises in JMeter because it uses the value of the system property \"user.name\" when creating the certificate. This defaults to the user login name, which may be of the form DOMAIN\\USER.\n\nThe simplest solution would be to drop the user name from the certificate, however the intention is to identify to whom the certificate belongs.\n\nThe name needs to be sanitised somehow.\nNot yet clear how to do this without perhaps losing useful information.\n\n[1] http://docs.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html#DName\nend of section refers to comma escaping", "id": 173431, "time": "2014-02-22T12:11:56Z", "creator": "sebb@apache.org", "creation_time": "2014-02-22T12:11:56Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "sebb@apache.org", "text": "The issue was first noticed because of a user.name with the form\n\nDOMAIN\\USER\n\nUser names can potentially include punctuation (O'Reilly) and may have non-ASCII characters. And some OSes may allow arbitrary login names, so might allow +;, in names.\n\nThe simplest approach would be to just allow for the backslash case, and assume that the other cases cannot occur. If they do, then there is the work-round of overriding user.name - if necessary just for creating the certificate.\n\nExperimentation shows that DOMAIN\\USER will appear in the certificate as DOMAIN\\\\USER (other escapes are removed).\nIt might look better to display the field as DOMAIN/USER so rather than doubling backslashes they could be converted to forward slashes.", "id": 173432, "time": "2014-02-22T12:31:33Z", "bug_id": 56178, "creation_time": "2014-02-22T12:31:33Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 56178, "text": "Initial workround - replace \\ by /\n\nURL: http://svn.apache.org/r1571123\nLog:\nkeytool error: Invalid escaped character in AVA: - some characters must be escaped\nBugzilla Id: 56178\n\nModified:\n    jmeter/trunk/src/jorphan/org/apache/jorphan/exec/KeyToolUtils.java\n    jmeter/trunk/xdocs/changes.xml", "id": 173443, "time": "2014-02-24T00:58:11Z", "creator": "sebb@apache.org", "creation_time": "2014-02-24T00:58:11Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "p.mouawad@ubik-ingenierie.com", "text": "Is this one fixed ?", "id": 174022, "time": "2014-03-22T21:27:42Z", "bug_id": 56178, "creation_time": "2014-03-22T21:27:42Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "sebb@apache.org", "text": "The specific case that caused the original problem is fixed, however the general case - escaping characters that are special to AVA entries - is not.\n\nBut given that there is a work-round, I guess we can close the issue for now.", "id": 174025, "time": "2014-03-22T22:37:14Z", "bug_id": 56178, "creation_time": "2014-03-22T22:37:14Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "graham@ham1.co.uk", "attachment_id": null, "id": 178426, "time": "2014-10-13T21:25:36Z", "bug_id": 56178, "creation_time": "2014-10-13T21:25:36Z", "is_private": false, "text": "Looking at lines 72-74 of KeyToolUtils.java:\n    String userName = System.getProperty(\"user.name\"); // $NON-NLS-1$\n    userName.replace('\\\\','/'); // Backslash is special (Bugzilla 56178)\n    addElement(sb, \"OU=Username: \", userName); // $NON-NLS-1$\nit looks like the fix didn't actually do anything. Should we remove this code or replace line 73 with:\n    userName = userName.replace('\\\\','/');"}, {"count": 6, "tags": [], "creator": "felix.schumacher@internetallee.de", "attachment_id": null, "id": 178435, "time": "2014-10-14T08:27:36Z", "bug_id": 56178, "creation_time": "2014-10-14T08:27:36Z", "is_private": false, "text": "ate: Tue Oct 14 08:17:53 2014\nNew Revision: 1631670\n\nURL: http://svn.apache.org/r1631670\nLog:\nBug 56178 - Return value of String#replace has to be used.\nBugzilla Id: 56178\n\nModified:\n    jmeter/trunk/src/jorphan/org/apache/jorphan/exec/KeyToolUtils.java"}, {"count": 7, "tags": [], "creator": "felix.schumacher@internetallee.de", "attachment_id": null, "id": 178436, "time": "2014-10-14T08:28:24Z", "bug_id": 56178, "creation_time": "2014-10-14T08:28:24Z", "is_private": false, "text": "Thanks for the report."}]
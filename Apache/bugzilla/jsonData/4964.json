[{"count": 0, "tags": [], "text": "popBody() is called before doEndTag() is called in a BodyTag.\n\nThis seems to contradicts with the JSP 1.2 spec.\nSection JSP.10.2 (page 182):\n\"The content of a BodyContent instance remains available until after the\ninvocation of its associated doEndBody() method.\"", "attachment_id": null, "id": 8084, "creator": "alex.yiu@oracle.com", "time": "2001-11-20T01:39:25Z", "bug_id": 4964, "creation_time": "2001-11-20T01:39:25Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 4964, "text": "Fixed in jasper2, which will be included in tc 4.1.x\n\nI also have a fix for the 4.0.x branch, but unfortunately ran into a problem\nwith javac in sun.tools.javac (though OK with com.sun.tools.javac).  The same\njavac works for jasper2, presumably because of the now flatten try/catch\nblocks.  :-)", "count": 1, "id": 15838, "time": "2002-05-09T18:52:46Z", "creator": "kin-man.chung@sun.com", "creation_time": "2002-05-09T18:52:46Z", "is_private": false}, {"count": 2, "tags": [], "creator": "kin-man.chung@sun.com", "attachment_id": null, "text": "Reopened because the fix has been reverted.  It has been reverted because it\nbreaks struts and other applications.  Apparently, people have been depending on\nthis \"feature\".  :-(\n\nThe usual problem is that for a tag handler that implements BodyTag, it is\nincorrect in doEndTag to write to the JspWriter obtained from\npageContext.getOut(), without following up with a call to writeOut() to flush\nout the current buffer.  Alternately, if the page buffer is not used, and it is\ndesirable to write directly to the enclosing tag buffer, then getPreviousOout()\nis the one to use to get the JspWriter to write to.  I have seen cases where\nthis is not followed in struts (e.g. org.apache.struts.taglib.html.LinkTag)\n\nAnyone from struts development community care to make comments?", "id": 16113, "time": "2002-05-14T23:35:46Z", "bug_id": 4964, "creation_time": "2002-05-14T23:35:46Z", "is_private": false}, {"count": 3, "tags": [], "creator": "kin-man.chung@sun.com", "attachment_id": null, "text": "Upon closer examination of the spec, I am convinced that the current tomcat\nimplementation in in compliance.\n\nIt is true that 10.2 says (page 174)\n\n\t\"The content of a BodyContent instance remains available until\n\tafter the invocation of its associated doEndBody() method.\"\n\nHowever, this does not necessarily imply that popBody() must be called after\ndoEndTag().  It only means that the content of the body cannot be released until\nafter doEndBody(), and it can still be accessible (e.g. using getBodyContent())\nin popBody().\n\nAs further evidence, 10.1.2.4, 2nd paragraph (page 169) says:\n\n\t\"..., the value of out will be restored using the popBody method\n\tpageContext, and then doEndTag will be invoked.\"\n\nso it seems clear to me that doEndTag does indeed follow popBody.", "id": 16447, "time": "2002-05-21T00:12:48Z", "bug_id": 4964, "creation_time": "2002-05-21T00:12:48Z", "is_private": false}]
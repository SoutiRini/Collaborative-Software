[{"count": 0, "tags": [], "bug_id": 5994, "attachment_id": null, "id": 9826, "time": "2002-01-23T23:21:06Z", "creator": "odela01@ca.com", "creation_time": "2002-01-23T23:21:06Z", "is_private": false, "text": "I was finding that if a servlet used HttpServletResponse.setDateHeader, it worked fine for the first request. On subsequent requests, however, the value of the header would always be the same as that from the first request, regardless of what was set by the servlet.\n\nI tracked it down to src/share/org/apache/tomcat/util/buf/DateTool.java. It uses  modulus, when surely integer division is wanted (I think it wants to discard the millisecond component of the time value):\n\n\n--- DateTool.java.orig  Wed Jan 23 15:29:26 2002\n+++ DateTool.java       Tue Jan 15 13:47:10 2002\n@@ -142,7 +142,7 @@\n     /** \n      */\n     public static String format1123( Date d ) {\n-        long dt = d.getTime() % 1000;\n+        long dt = d.getTime() / 1000;\n         if ((rfc1123DS != null) && (dt == rfc1123Sec))\n             return rfc1123DS;\n         rfc1123DS  = rfc1123Format.format( d );\n@@ -151,7 +151,7 @@\n     } \n \n     public static String format1123( Date d,DateFormat df ) {\n-        long dt = d.getTime() % 1000;\n+        long dt = d.getTime() / 1000;\n         if ((rfc1123DS != null) && (dt == rfc1123Sec))\n             return rfc1123DS;\n         rfc1123DS  = df.format( d );\n\n\nThis patch fixed the problem I was seeing."}, {"count": 1, "tags": [], "creator": "bojan@binarix.com", "attachment_id": null, "is_private": false, "id": 9896, "time": "2002-01-25T00:00:36Z", "bug_id": 5994, "creation_time": "2002-01-25T00:00:36Z", "text": "Thanks. It is now in CVS.\n\nBojan"}, {"count": 2, "tags": [], "creator": "william.barker@wilshire.com", "is_private": false, "text": "*** Bug 6616 has been marked as a duplicate of this bug. ***", "id": 11055, "time": "2002-02-21T19:33:40Z", "bug_id": 5994, "creation_time": "2002-02-21T19:33:40Z", "attachment_id": null}]
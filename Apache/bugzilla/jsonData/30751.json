[{"count": 0, "tags": [], "creator": "eric.fayol@netsecureone.com", "text": "I would like to update a jar and merge its manifest with manifests from the \nfilesets.\n   <jar destfile=\"jar1.jar\" update=\"true\" filesetmanifest=\"merge\">\n      <zipfileset src=\"jar2.jar\" includes=\"**\"/>\n   </jar>\n\nThis doesn't work because filesetmanifest=\"true\" makes <jar> build a new \narchive after updating as we can see in the Ant ouput:\n      [jar] Updating jar: E:\\jar1.jar\n      [jar] Building jar: E:\\jar1.jar\nConsequently, the jar now contains only files from jar2, except for manifest \nwhich intriguingly is jar1's original. \nNot setting filesetmanifest attribute would have produced an archive with both \njar1 and jar2's files but would not have updated manifest.\n\nWhat I currently have to do to get the correct merged jar is:\n   <jar destfile=\"copy-of-jar1.jar\" filesetmanifest=\"merge\">\n      <zipfileset src=\"${LIB}/jar1.jar\" includes=\"**\"/>\n      <zipfileset src=\"${LIB}/jar2.jar\" includes=\"**\"/>\n   </jar>\n   <move file=\"copy-of-jar1.jar\" tofile=\"jar1.jar\" overwrite=\"true\"/>", "id": 62172, "time": "2004-08-19T12:09:01Z", "bug_id": 30751, "creation_time": "2004-08-19T12:09:01Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "I have the same problem. Here is a simple testcase:\n\n<target name=\"jarUpdateBug\" \n        description=\"Testcase for jar update=true and filesetmanifest=[merge, \nmergewithoutmain] does not preserve the original content.\">\n  <property name=\"dest\" value=\"c:/temp/jarUpdateBug\"/>\n  <delete dir=\"${dest}\" failonerror=\"false\"/>\n  <mkdir dir=\"${dest}\"/>\n  <echo file=\"${dest}/jarUpdateBugFile1.txt\" message=\"Test File 1\"/>\n  <echo file=\"${dest}/jarUpdateBugFile2.txt\" message=\"Test File 2\"/>\n  <!-- This works not: \n   For filesetmanifest=[merge, mergewithoutmain] only the last file is \n   contained in the jarUpdateBug.jar.\n  -->\n  <jar jarfile=\"${dest}/jarUpdateBug.jar\" basedir=\"${dest}\"\n        update=\"false\" \n        includes=\"**/*1.txt\"\n        filesetmanifest=\"merge\"/>\n  <jar jarfile=\"${dest}/jarUpdateBug.jar\" basedir=\"${dest}\"\n        update=\"true\" \n        includes=\"**/*2.txt\"\n        filesetmanifest=\"merge\"/>\n  <!-- This works (filesetmanifest=\"skip\"). \n       Both files contained in jarUpdateOk.jar\n  -->\n  <jar jarfile=\"${dest}/jarUpdateOk.jar\" basedir=\"${dest}\"\n        update=\"false\" \n        filesetmanifest=\"skip\"\n        includes=\"**/*1.txt\"/>\n  <jar jarfile=\"${dest}/jarUpdateOk.jar\" basedir=\"${dest}\"\n        update=\"true\"\n        filesetmanifest=\"skip\"\n        includes=\"**/*2.txt\"/>\n</target>\n\nBtw. Also happens with update=\"true\" and filesetmanifest=\"mergewithoutmain\".", "is_private": false, "id": 67531, "creation_time": "2004-11-29T09:52:54Z", "time": "2004-11-29T09:52:54Z", "creator": "markus.schneider@med.ge.com", "bug_id": 30751, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 30751, "attachment_id": null, "id": 128905, "time": "2009-07-16T04:36:09Z", "creator": "bodewig@apache.org", "creation_time": "2009-07-16T04:36:09Z", "is_private": false, "text": "The \"does not update\" part has been fixed some time in the past since tests I added already passed when I started to work on it.\n\nThe \"the manifest isn't merged\" part only happened if the manifest in the jar to be updated was more recent than any manifest of the filesets - that way the manifests didn't look \"out of date\" and were never considered.\n\nsvn revision 794630 fixes this."}]
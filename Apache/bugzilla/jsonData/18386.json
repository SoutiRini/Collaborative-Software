[{"count": 0, "tags": [], "text": "We have here an weard problem. If we put in httpd.conf more than 350 include \nfiles (with virtualhosts into them) our cgi (like cgi of qmailadmin) stops \nworking (INTERNAL SERVER ERROR) and the php stops working too (\"too many open \nfiles\"). The apache was configurated with only '--prefix=/usr/local/apache'. Is \nthere a problem or a misconfiguration?\n\nSorry for the english!\n\nVinicius", "attachment_id": null, "bug_id": 18386, "id": 33860, "time": "2003-03-26T19:54:50Z", "creator": "vinicius@teracom.com.br", "creation_time": "2003-03-26T19:54:50Z", "is_private": false}, {"count": 1, "tags": [], "text": "2.0.44 leaks some file descriptors, which is fixed in the next version (coming \nout very soon).\n\nThe question in your case is: is it the problem of Include or of the open \nlogfiles you have probably in your VHs? What happens if you\n\ncat all_includes >one_include\n\nand in your httpd.conf:\n\nInclude one_include\n\n?", "attachment_id": null, "bug_id": 18386, "id": 33864, "time": "2003-03-26T20:10:01Z", "creator": "nd@perlig.de", "creation_time": "2003-03-26T20:10:01Z", "is_private": false}, {"count": 2, "tags": [], "creator": "vinicius@teracom.com.br", "attachment_id": null, "id": 34359, "time": "2003-04-02T17:30:57Z", "bug_id": 18386, "creation_time": "2003-04-02T17:30:57Z", "is_private": false, "text": "I made what you post... cat all_includes > one_include... and the problems get \nworst. With only one include, apache do not starts anymore. Apachectl \nconfigtest returns sintax ok and no log shows the error, but httpd do not \nstarts.\n"}, {"count": 3, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "is_private": false, "id": 34527, "time": "2003-04-04T13:16:12Z", "bug_id": 18386, "creation_time": "2003-04-04T13:16:12Z", "text": "hmm. Does the problem persist in that form in the current version (2.0.45)?"}, {"count": 4, "tags": [], "text": "I changed my web server to apache 2.0.45 and the occurs the same problem!", "attachment_id": null, "bug_id": 18386, "id": 35007, "time": "2003-04-11T17:50:19Z", "creator": "vinicius@teracom.com.br", "creation_time": "2003-04-11T17:50:19Z", "is_private": false}, {"count": 5, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "is_private": false, "id": 35018, "time": "2003-04-11T19:15:33Z", "bug_id": 18386, "creation_time": "2003-04-11T19:15:33Z", "text": "does it give some log entries if you set the LogLevel to 'debug'?\n\nWhat OS are you running?"}, {"count": 6, "tags": [], "text": "Do we have any reason to believe that this isn't simply a problem of\ninsufficient file descriptors as the log says?  Have you increased\nyour OS file descriptor limits?", "attachment_id": null, "bug_id": 18386, "id": 35025, "time": "2003-04-11T19:34:10Z", "creator": "slive@apache.org", "creation_time": "2003-04-11T19:34:10Z", "is_private": false}, {"count": 7, "tags": [], "creator": "vinicius@teracom.com.br", "attachment_id": null, "is_private": false, "id": 35051, "time": "2003-04-12T12:16:39Z", "bug_id": 18386, "creation_time": "2003-04-12T12:16:39Z", "text": "I raised the file descriptors to 4000 (was 1024) and nothing changed... I put \nLoglevel to debug and show this:\n\n[Sat Apr 12 09:11:06 2003] [info] Server built: Apr  9 2003 16:15:25\n[Sat Apr 12 09:11:06 2003] [debug] prefork.c(1039): AcceptMutex: sysvsem \n(default: sysvsem)\n\nBut... i put one more virtualhost and restart server... and i got the problem:\n\n[Sat Apr 12 09:12:18 2003] [notice] caught SIGTERM, shutting down\n(24)Too many open files: httpd: could not open error log \nfile /usr/local/apache/logs/teracom.log.\nUnable to open logs\n\nI'll have to change my method of logging? Isn't it a bug?"}, {"count": 8, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "is_private": false, "id": 35052, "time": "2003-04-12T12:26:20Z", "bug_id": 18386, "creation_time": "2003-04-12T12:26:20Z", "text": "Oh. How many logfiles are opened (probably at least two per virtual host)?\nDo you log into pipes or something?"}, {"count": 9, "tags": [], "text": "A couple of questions:\n\nDid you raise the hard limit on file descriptors (ulimit -H -n xxx) or just the\nsoft limit?  apachectl bumps up the soft limit as far as possible anyway, but\ndoes not touch the hard limit.\n\nWhat OS is this?\n\nHere is some doc that might help if the answers to the barrage of questions\ndon't uncover the problem:\n\nIf your Apache configuration fails to initialize because of this condition,\nplz attach a system call trace (strace/truss) of Apache startup showing the file\nopen calls.\n\nIf your Apache configuration initializes properly but fails later, plz attach\nthe output of lsof showing the open files httpd processes once initialization is\ncomplete.\n\nThanks!\n", "attachment_id": null, "bug_id": 18386, "id": 35053, "time": "2003-04-12T12:34:52Z", "creator": "trawick@apache.org", "creation_time": "2003-04-12T12:34:52Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 18386, "is_private": false, "text": "I forgot to say.. i'm using redhat 8.0 with apache 2.0.45\n\nI removed the logs and restart apache. It's is now with 693 logs. If i put 2 \nmore virtualhosts (4 log files) it crashes.", "id": 35054, "time": "2003-04-12T12:37:20Z", "creator": "vinicius@teracom.com.br", "creation_time": "2003-04-12T12:37:20Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 18386, "is_private": false, "id": 35057, "creation_time": "2003-04-12T12:45:22Z", "time": "2003-04-12T12:45:22Z", "creator": "vinicius@teracom.com.br", "text": "i've tried to raise hard limit... no success... the same problem (unable to \nopen logs).\n\n", "attachment_id": null}, {"count": 12, "tags": [], "creator": "vinicius@teracom.com.br", "attachment_id": null, "is_private": false, "id": 35059, "time": "2003-04-12T12:47:06Z", "bug_id": 18386, "creation_time": "2003-04-12T12:47:06Z", "text": "(24)Too many open files: httpd: could not open error log \nfile /usr/local/apache/logs/teracom.log.\nUnable to open logs\n\nteracom.log is my first entry to open logs... it crashes in the beggining...\n\nI'm not using pipes... (the question you made before)"}, {"count": 13, "tags": [], "creator": "vinicius@teracom.com.br", "attachment_id": null, "is_private": false, "id": 35359, "time": "2003-04-16T17:43:28Z", "bug_id": 18386, "creation_time": "2003-04-16T17:43:28Z", "text": "so... what do i do know?"}, {"count": 14, "text": "Hmm, I have no further idea at the moment. I have the strong impression that\nyour server is somewhat overloaded and runs out of its hard limits. But it's\njust a guess.\n\nSomeone else an idea?", "bug_id": 18386, "is_private": false, "id": 35637, "time": "2003-04-19T21:52:40Z", "creator": "nd@perlig.de", "creation_time": "2003-04-19T21:52:40Z", "tags": [], "attachment_id": null}, {"count": 15, "text": "Unless we can see lsof output and/or syscall trace showing that Apache has left\nfiles open inappropriately, we'll have to assume that this is not an Apache\nproblem and that submitter needs OS-specific help on addressing the inability to\nopen additional files from Apache process.\n\nIf you want to pursue further, try with latest Apache and submit syscall trace\nor lsof output so we can see which files Apache has open that it should have\nclosed already.\n", "bug_id": 18386, "is_private": false, "id": 49104, "time": "2003-12-14T18:56:46Z", "creator": "trawick@apache.org", "creation_time": "2003-12-14T18:56:46Z", "tags": [], "attachment_id": null}]
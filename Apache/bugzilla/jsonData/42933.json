[{"count": 0, "tags": [], "bug_id": 42933, "is_private": false, "id": 105761, "creation_time": "2007-07-18T14:22:39Z", "time": "2007-07-18T14:22:39Z", "creator": "jake.happs@gdc4s.com", "text": "I am using a custom subclass of FileAppender to write log messages to a file.  \nIf the log file being written is being actively tailed (using 'tail -f') and \nthe software calls closeFile() or setFile() (which calls closeFile()) on the \nFileAppender superclass, an IllegalStateException is thrown.  The stack trace \nis included below.  This exception is thrown every time closeFile() or setFile\n() are called after the exception is first thrown, even if the active tail has \nbeen closed.\n\nThe partial stack trace is:\n\nException in thread \"AWT-EventQueue-0\" java.lang.IllegalStateException: Current \nstate = FLUSHED, new state = CODING_END\n        at java.nio.charset.CharsetEncoder.throwIllegalStateException\n(CharsetEncoder.java:941)\n        at java.nio.charset.CharsetEncoder.encode(CharsetEncoder.java:537)\n        at sun.nio.cs.StreamEncoder$CharsetSE.flushLeftoverChar\n(StreamEncoder.java:358)\n        at sun.nio.cs.StreamEncoder$CharsetSE.implClose(StreamEncoder.java:414)\n        at sun.nio.cs.StreamEncoder.close(StreamEncoder.java:160)\n        at java.io.OutputStreamWriter.close(OutputStreamWriter.java:222)\n        at java.io.FilterWriter.close(FilterWriter.java:92)\n        at org.apache.log4j.FileAppender.closeFile(FileAppender.java:183)\n        at org.apache.log4j.FileAppender.reset(FileAppender.java:338)\n        at org.apache.log4j.FileAppender.setFile(FileAppender.java:283)\n        ...\n        ...", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 42933, "attachment_id": null, "is_private": false, "id": 107137, "time": "2007-08-23T02:16:52Z", "creator": "bayard@apache.org", "creation_time": "2007-08-23T02:16:52Z", "text": "JVM bug maybe?"}, {"count": 2, "text": "We are also seeing this problem but with Log4j's DailyRollingFileAppender and \nFileAppender.  It occurs in jdk 1.5.0_11 and jdk1.5.0_13 but not in \nj2sdk1.3.1_20.\n\nHere is a dorky test program to reproduce it:\n\nimport org.apache.log4j.FileAppender;\nimport org.apache.log4j.Logger;\nimport org.apache.log4j.Priority;\nimport org.apache.log4j.PatternLayout;\nimport org.apache.log4j.spi.LoggingEvent;\n\npublic class TailBug\n{\n    public static void main(String[] args) throws InterruptedException\n    {\n        final String filename = \"tailme\";\n\n        FileAppender fa = new FileAppender();\n        fa.setName(\"myappender\");\n        fa.setFile(filename);\n        fa.setLayout(new PatternLayout(\"%d %m%n\"));\n        fa.activateOptions();\n\n        writeSomeMessages(fa);\n\n        System.out.println(\"NOW Start tailing \" + filename + \"!!!!!\\n\");\n        System.out.println(\"The logfile will be rotated to in 10 seconds\");\n\n        Thread.sleep(10000);\n\n        final String newfilename = \"tailme2\";\n\n        fa.setFile(newfilename);\n        fa.activateOptions();   // Exception will be thrown here\n\n        writeSomeMessages(fa);\n\n        System.out.println(\"Done!\");\n    }\n\n    private static void writeSomeMessages(FileAppender fa)\n    {\n        System.out.println(\"Logging 5 messages to file \" + fa.getFile() \n+ \"...\\n\");\n        for( int i = 0; i < 5; i++ )\n        {\n            fa.append(new LoggingEvent(\"\", Logger.getLogger(\"log\"), \nPriority.WARN, \"This is a test message\", null));\n        }\n    }\n}\n", "creator": "jlindwall@yahoo.com", "attachment_id": null, "id": 109010, "time": "2007-10-04T23:15:08Z", "bug_id": 42933, "creation_time": "2007-10-04T23:15:08Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "text": "This seems to be Sun JVM bug 5005426 (which was also later reported in a \nduplicate bug 5005419).\n\nIt does not affect JVM 1.3.1 or Java 6, in my experimentation.  I'll see if I \ncan get this bug re-opened in JDK 1.5.0.\n\n\n\nhttp://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5005426\n\n5005426 \n\nhttp://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5005419\n\n5005419 \n", "attachment_id": null, "id": 109405, "creator": "jlindwall@yahoo.com", "time": "2007-10-16T14:00:46Z", "bug_id": 42933, "creation_time": "2007-10-16T14:00:46Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 42933, "attachment_id": null, "id": 109407, "time": "2007-10-16T14:18:38Z", "creator": "jlindwall@yahoo.com", "creation_time": "2007-10-16T14:18:38Z", "is_private": false, "text": "I've opened a bug request with Sun to notify them that this bug (which was \nfixed in 1.3.1 and 1.4.2 AND Java 6) is affecting Java 5.\n\nI'll report any status here; for now their automated system has simply \naccepted my report."}, {"count": 5, "tags": [], "text": "Sun has been very helpful and speedy in addressing this regression bug.  They \nhave a fix for it, and it will roll it out ASAP (probably for jdk 1.5.0_15).\n\n-------------\n\nProblem Description\n(Expand on problem statement as necessary)\n\nEscalate Bug 5005426 for JDK 5.0.  This bug was fixed in 1.4.2 and in 6.0, but \nstill existed in 5.0.\n\n-------------------------------------------------------\n\nSolution Note\n(Root Cause, Possible Causes or Actions taken for Closure)\n\nSustaining will backport the fix into a 5.0 update release (most likely _15).\n", "is_private": false, "id": 109957, "creator": "jlindwall@yahoo.com", "time": "2007-10-30T09:04:31Z", "bug_id": 42933, "creation_time": "2007-10-30T09:04:31Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "If this has been identified to be a Sun bug and they have accepted it, would it be reasonable to close this bug?", "is_private": false, "id": 118134, "creator": "thorbjoern@gmail.com", "time": "2008-06-30T13:28:00Z", "bug_id": 42933, "creation_time": "2008-06-30T13:28:00Z", "attachment_id": null}, {"count": 7, "text": "No response in a month.  Setting to NEEDINFO.", "creator": "thorbjoern@gmail.com", "attachment_id": null, "id": 119267, "time": "2008-08-02T12:36:19Z", "bug_id": 42933, "creation_time": "2008-08-02T12:36:19Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "text": "Not sure if this is a bug or just my mis-coding...\n\nI've been using the Embedded component in Tomcat 6.0.29 for integration testing. Something like this:\n\n    server = new EmbeddedTomcat(\"/test\", 7890, \"JVM-1\");\n    PeerToPeerCacheLifecycleListener p2pListener = new PeerToPeerCacheLifecycleListener();\n    p2pListener.setProperty(\"mcast-port\", \"19991\");\n    server.getEmbedded().addLifecycleListener(p2pListener);\n    sessionManager = new DeltaSessionManager();\n    server.getRootContext().setManager(sessionManager);\n\nHere the EmbeddedTomcat class is simply a wrapper for Embedded - I'm passing in the context, port and 'JVM route' - nothing special. Then I add a listener which should be the programmatic equivalent of having the following server.xml snippet:\n\n<Server>\n    <Listener className=\"PeerToPeerCacheLifecycleListener\"/>\n</Server>\n\nDeltaSessionManager performs custom session management and thus extends ManagerBase and implements Lifecycle and SessionManager.\n\nDuring the start of DeltaSessionManager I initialize the listener by doing\n\n    this.lifecycle.fireLifecycleEvent(START_EVENT, null);\n\nThe listener picks up this event and starts.\n\nAll works nicely under Tomcat 6, but breaks under Tomcat 7.0.12. My initial investigation shows that the LifecycleEvent, being fired, is not reaching the Embedded component which is where the listener is registered.\n\nRemoving the overridden Lifecycle methods from Embedded (so that the Lifecyle processing happens in LifecycleBase) seems to work as the triggered event then reaches my listener.", "is_private": false, "id": 146974, "creation_time": "2011-06-08T21:35:55Z", "time": "2011-06-08T21:35:55Z", "creator": "jdeppe@vmware.com", "bug_id": 51344, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 51344, "text": "Thanks for the report and the analysis.\n\nThis has been fixed in 7.0.x and will be included in 7.0.16 onwards.", "id": 147000, "time": "2011-06-09T19:04:51Z", "creator": "markt@apache.org", "creation_time": "2011-06-09T19:04:51Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "saurabhsule82@yahoo.co.in", "attachment_id": null, "id": 159258, "time": "2012-05-23T17:14:59Z", "bug_id": 53281, "creation_time": "2012-05-23T17:14:59Z", "is_private": false, "text": "Steps to reproduce the issue:\n\n1. Configure server.xml to have a single SSL HTTP/1.1 Connector on port 443.\n\n2. Access your site using 'http' as shown below:\n\n   http://localhost:443/\n\nTomcat will return some garbage characters and the header information will contain\n\nHTTP/0.9 200 OK\n\nExpected behavior:\n\nTomcat should terminate the connection without returning any data or HTTP/1.1 400 Bad Request response."}, {"count": 1, "tags": [], "bug_id": 53281, "attachment_id": null, "text": "This is simply not possible if the SSL connector is correctly configured. Please use the users mailing list to identify your configuration error.", "id": 159649, "time": "2012-06-03T16:12:04Z", "creator": "markt@apache.org", "creation_time": "2012-06-03T16:12:04Z", "is_private": false}, {"count": 2, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "id": 159714, "time": "2012-06-05T19:36:26Z", "bug_id": 53281, "creation_time": "2012-06-05T19:36:26Z", "is_private": false, "text": "Apache httpd does do something like this; not sure if it's possible using JSSE:\n\n$ telnet my.secure.site.com 443\nTrying 208.85.173.131...\nConnected to my.secure.site.com.\nEscape character is '^]'.\nGET /\n\nblah\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>400 Bad Request</title>\n</head><body>\n<h1>Bad Request</h1>\n<p>Your browser sent a request that this server could not understand.<br />\nReason: You're speaking plain HTTP to an SSL-enabled server port.<br />\nInstead use the HTTPS scheme to access this URL, please.<br />\n<blockquote>Hint: <a href=\"https://my.secure.site.com/\"><b>https://my.secure.site.com/</b></a></blockquote></p>\n<hr>\n<address>Apache/2.2 Server at my.secure.site.com Port 443</address>\n</body></html>\nConnection closed by foreign host."}, {"count": 3, "tags": [], "creator": "saurabhsule82@yahoo.co.in", "attachment_id": null, "id": 159739, "time": "2012-06-06T03:02:17Z", "bug_id": 53281, "creation_time": "2012-06-06T03:02:17Z", "is_private": false, "text": "Yes, Apache httpd does that. But I haven't been able to produce the same behavior using JSSE in Apache Tomcat."}, {"count": 4, "tags": [], "bug_id": 53281, "attachment_id": null, "text": "My question isn't whether Tomcat can be configured to do that (it cannot currently do it), but if JSSE will even allow that handling to occur. If JSSE can't do it, Tomcat certainly can't do it using JSSE.", "id": 159753, "time": "2012-06-06T13:33:15Z", "creator": "chris@christopherschultz.net", "creation_time": "2012-06-06T13:33:15Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 53281, "attachment_id": null, "text": "@Christopher Schultz - So if I understand you correctly, the issues lies with JSSE and not Tomcat,  may I right? And that, there is no way we can change the behavior using Tomcat Configuration ?", "id": 159754, "time": "2012-06-06T13:38:26Z", "creator": "saurabhsule82@yahoo.co.in", "creation_time": "2012-06-06T13:38:26Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 53281, "attachment_id": null, "text": "No, I'm not saying that the issue is JSSE (though it may be). What I'm saying is that responding to an HTTP request over HTTPS is not impossible under all circumstances: httpd is an example of how it is possible.", "id": 159762, "time": "2012-06-06T17:56:33Z", "creator": "chris@christopherschultz.net", "creation_time": "2012-06-06T17:56:33Z", "is_private": false}, {"count": 7, "tags": [], "creator": "wbinglee@gmail.com", "text": "Why is it resolved as invalid? Is there any solution to this issue?", "id": 163873, "time": "2012-12-05T01:00:57Z", "bug_id": 53281, "creation_time": "2012-12-05T01:00:57Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 53281, "attachment_id": null, "text": "There are several reasons.\nThe first one is that one has to prove that there is an issue. So far nobody reproduced this issue. Tomcat connectors do not behave as the OP describes.", "id": 163874, "time": "2012-12-05T04:49:59Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-12-05T04:49:59Z", "is_private": false}, {"count": 9, "attachment_id": null, "bug_id": 53281, "text": "With Tomcat 6.0.37, it it straightforward to reproduce this issue using the following Connector (redacted):\n\n    <Connector port=\"9876\" protocol=\"HTTP/1.1\" SSLEnabled=\"true\"\n               maxThreads=\"150\" scheme=\"https\" secure=\"true\"\n               keyAlias=\"mykey\" keystorePass=\"mypass\"\n               clientAuth=\"false\" sslProtocol=\"TLS\" />\n\n$ curl -f  http://www.myhost.com:9876\n\u0015\u0003\u0001\u0002\u0002<garbage returned>", "id": 170486, "time": "2013-10-08T15:18:31Z", "creator": "robchek@knowledgetree.com", "creation_time": "2013-10-08T15:18:31Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "creator": "chris@christopherschultz.net", "text": "Note that I tested this with Tomcat 8 trunk.\n\n$ keytool -genkey -alias tomcat  -keystore ~/.keystore -keyalg RSA -keysize 4096\nEnter keystore password:  \nRe-enter new password: \nWhat is your first and last name?\n  [Unknown]:  Christopher Schultz\nWhat is the name of your organizational unit?\n  [Unknown]:  Testing\nWhat is the name of your organization?\n  [Unknown]:  Snake Oil, Ltd.\nWhat is the name of your City or Locality?\n  [Unknown]:  Washington\nWhat is the name of your State or Province?\n  [Unknown]:  District of Columbia\nWhat is the two-letter country code for this unit?\n  [Unknown]:  US\nIs CN=Christopher Schultz, OU=Testing, O=\"Snake Oil, Ltd.\", L=Washington, ST=District of Columbia, C=US correct?\n  [no]:  yes\n\nEnter key password for <tomcat>\n\t(RETURN if same as keystore password):  [left blank]\n\nI Modified your <Connector> slightly to match the key alias from the Tomcat documentation:\n\n<Connector port=\"9876\" protocol=\"HTTP/1.1\" SSLEnabled=\"true\"\n               maxThreads=\"150\" scheme=\"https\" secure=\"true\"\n               keyAlias=\"tomcat\" keystorePass=\"mypass\"\n               clientAuth=\"false\" sslProtocol=\"TLS\" />\n\n$ curl -f http://localhost:9876\ncurl: (52) Empty reply from server\n\n$ telnet localhost 9876\nTrying ::1...\nConnected to localhost.\nEscape character is '^]'.\nGET /\nConnection closed by foreign host.\n\n$ telnet localhost 9876\nTrying ::1...\nConnected to localhost.\nEscape character is '^]'.\nGET / HTTP/1.1\nConnection closed by foreign host.\n\nTomcat is behaving as expected, here. I can test against Tomcat 6 to help corroborate, but I want to make sure that I have my process correct. To those who have reported problems, please verify that my steps-to-reproduce are correct.", "id": 170489, "time": "2013-10-08T16:53:15Z", "bug_id": 53281, "creation_time": "2013-10-08T16:53:15Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "text": "Tested with 6.0.x and confirmed that:\n\n- connecting to the https port using http with a browser returns garbage (as expected)\n- connecting to the https port with telnet and sending a valid HTTP request list results in garbage being returned and the connection closed (as expected)\n- at no point is an HTTP/0.9 response line returned\n\nMy comment #1 from over a year ago stands.", "is_private": false, "id": 170498, "creation_time": "2013-10-08T22:51:17Z", "time": "2013-10-08T22:51:17Z", "creator": "markt@apache.org", "bug_id": 53281, "attachment_id": null}, {"count": 12, "tags": [], "creator": "saurabhsule82@yahoo.co.in", "attachment_id": 30912, "id": 170502, "time": "2013-10-09T06:09:46Z", "bug_id": 53281, "creation_time": "2013-10-09T06:09:46Z", "is_private": false, "text": "Created attachment 30912\nHTTP 0.9 response from the server\n\nI tried the identical steps that have been provided and the browser receives garbage value with HTTP/0.9 response. I've attached the Live HTTP headers capture of the same.\n\nI've also tried using curl and telnet as indicated in the comments above.\n\nHere is the output of both the commands:\n\n[root@host ~]# curl -f http://myhost:9876\n                    <-- blank line\nNote: the blank line means the server is returning some response. Not the same as has been indicated in the comments above.\n\n[root@host ~]# telnet myhost 9876\nTrying 10.10.10.1...\nConnected to myhost (10.10.10.1).\nEscape character is '^]'.\nGET / HTTP/1.1\n\nConnection closed by foreign host.\n\nSo, I tried running tcpdump to take the captures for all the three ways of accessing the server namely Browser, Curl and Telnet and in each capture I saw a response being received from the server.\n\nNote: I'm using Firefox as the Browser but the behavior is consistent with IE as well.\n\nNote: I'm using JSSE with Tomcat for the SSL."}, {"count": 13, "tags": [], "creator": "robchek@knowledgetree.com", "attachment_id": null, "id": 170508, "time": "2013-10-09T13:32:06Z", "bug_id": 53281, "creation_time": "2013-10-09T13:32:06Z", "is_private": false, "text": "(In reply to Mark Thomas from comment #11)\n> Tested with 6.0.x and confirmed that:\n> - connecting to the https port using http with a browser returns garbage (as\n> expected)\n> - connecting to the https port with telnet and sending a valid HTTP request\n> list results in garbage being returned and the connection closed (as\n> expected)\n> - at no point is an HTTP/0.9 response line returned\n\nJust want to articulate that it seems that there are 2 issues in play here:\n\n1. garbage data: I think this is the intent of the original posting; that Tomcat should not return garbage data, but instead return code 400 similar to Apache behavior.\n\n2. HTTP/0.9 response returned: I have not seen this aspect."}, {"count": 14, "tags": [], "creator": "kpreisser@apache.org", "attachment_id": null, "id": 170509, "time": "2013-10-09T13:36:48Z", "bug_id": 53281, "creation_time": "2013-10-09T13:36:48Z", "is_private": false, "text": "(In reply to saurabh from comment #12)\n> Created attachment 30912 [details]\n> HTTP 0.9 response from the server\n> \n> I tried the identical steps that have been provided and the browser receives\n> garbage value with HTTP/0.9 response. I've attached the Live HTTP headers\n> capture of the same.\n\nJust because some Browser Add-on reports a \"HTTP/0.9 200 OK\" response it doesn't necessarily mean that this is what Tomcat is actually sending (otherwise you should have seen that response when you are connecting with telnet.\n\nMy guess would be that the add-on (or even the browser) is trying to interpret SSL bytes as plain HTTP response, and because it fails, displayes some \"HTTP/0.9\" response.\n\nI verified this by setting up Tomcat 6.0.37 with a SSL connector using JSSE, and downloadeding the Live HTTP headers addon for Firefox. I use a tool to intercept the TCP connections and record the exact data packets that were sent.\n\nI then opened the URL \"http://localhost:8443/\" with Firefox. This is what was sent from Firefox to Tomcat (309 bytes):\n\n47 45 54 20 2F 20 48 54 54 50 2F 31 2E 31 0D 0A   GET / HTTP/1.1..\n48 6F 73 74 3A 20 6C 6F 63 61 6C 68 6F 73 74 3A   Host: localhost:\n38 34 34 33 0D 0A 55 73 65 72 2D 41 67 65 6E 74   8443..User-Agent\n3A 20 4D 6F 7A 69 6C 6C 61 2F 35 2E 30 20 28 57   : Mozilla/5.0 (W\n69 6E 64 6F 77 73 20 4E 54 20 36 2E 33 3B 20 57   indows NT 6.3; W\n4F 57 36 34 3B 20 72 76 3A 32 34 2E 30 29 20 47   OW64; rv:24.0) G\n65 63 6B 6F 2F 32 30 31 30 30 31 30 31 20 46 69   ecko/20100101 Fi\n72 65 66 6F 78 2F 32 34 2E 30 0D 0A 41 63 63 65   refox/24.0..Acce\n70 74 3A 20 74 65 78 74 2F 68 74 6D 6C 2C 61 70   pt: text/html,ap\n70 6C 69 63 61 74 69 6F 6E 2F 78 68 74 6D 6C 2B   plication/xhtml+\n78 6D 6C 2C 61 70 70 6C 69 63 61 74 69 6F 6E 2F   xml,application/\n78 6D 6C 3B 71 3D 30 2E 39 2C 2A 2F 2A 3B 71 3D   xml;q=0.9,*/*;q=\n30 2E 38 0D 0A 41 63 63 65 70 74 2D 4C 61 6E 67   0.8..Accept-Lang\n75 61 67 65 3A 20 64 65 2D 64 65 2C 64 65 3B 71   uage: de-de,de;q\n3D 30 2E 38 2C 65 6E 2D 75 73 3B 71 3D 30 2E 35   =0.8,en-us;q=0.5\n2C 65 6E 3B 71 3D 30 2E 33 0D 0A 41 63 63 65 70   ,en;q=0.3..Accep\n74 2D 45 6E 63 6F 64 69 6E 67 3A 20 67 7A 69 70   t-Encoding: gzip\n2C 20 64 65 66 6C 61 74 65 0D 0A 43 6F 6E 6E 65   , deflate..Conne\n63 74 69 6F 6E 3A 20 6B 65 65 70 2D 61 6C 69 76   ction: keep-aliv\n65 0D 0A 0D 0A                                    e....\n\n\nThis is what Tomcat responded (7 bytes):\n15 03 01 00 02 02 0A                              .......\n(Connection closed)\n\n\nThis is what Live HTTP headers reported:\n\nhttp://localhost:8443/\n\nGET / HTTP/1.1\nHost: localhost:8443\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:24.0) Gecko/20100101 Firefox/24.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: de-de,de;q=0.8,en-us;q=0.5,en;q=0.3\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\n\nHTTP/0.9 200 OK\n----------------------------------------------------------\n\n\nAs you can see, Tomcat didn't returin anything like \"HTTP/0.9 200 OK\" plain text in its SSL response although Live HTTP Headers reports this. Instead it sends some some SSL reply (though I do not have examined what kind of reply it is), since actually you are sending some garbage to a SSL connector here.\n\nIf Tomcat could be enhanced to recognize a erroneously sent plain HTTP request to a HTTPS/SSL connector (like HTTPD does) is another question."}, {"count": 15, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 170510, "time": "2013-10-09T13:39:15Z", "bug_id": 53281, "creation_time": "2013-10-09T13:39:15Z", "is_private": false, "text": "(In reply to Konstantin Prei\u00dfer from comment #14)\n> As you can see, Tomcat didn't returin anything like \"HTTP/0.9 200 OK\" plain\n> text in its SSL response although Live HTTP Headers reports this. Instead it\n> sends some some SSL reply (though I do not have examined what kind of reply\n> it is), since actually you are sending some garbage to a SSL connector here.\n\nIt should be the start of the SSL handshake.\n\n> If Tomcat could be enhanced to recognize a erroneously sent plain HTTP\n> request to a HTTPS/SSL connector (like HTTPD does) is another question.\n\nIt can't."}, {"count": 16, "tags": [], "bug_id": 53281, "attachment_id": null, "text": "Mark, can you comment on why Tomcat is limited further than, say, httpd? I think that might help drive the final nail in the coffin, here.\n\nIs the problem that the Java SSL layer is so far below what Tomcat controls that catching an invalid client HELLO before the Java SSL layer replies is not possible?", "id": 170512, "time": "2013-10-09T14:53:19Z", "creator": "chris@christopherschultz.net", "creation_time": "2013-10-09T14:53:19Z", "is_private": false}, {"count": 17, "tags": [], "creator": "saurabhsule82@yahoo.co.in", "attachment_id": null, "id": 170530, "time": "2013-10-10T09:54:15Z", "bug_id": 53281, "creation_time": "2013-10-10T09:54:15Z", "is_private": false, "text": "(In reply to Konstantin Prei\u00dfer from comment #14)\n> (In reply to saurabh from comment #12)\n> > Created attachment 30912 [details]\n> > HTTP 0.9 response from the server\n> > \n> > I tried the identical steps that have been provided and the browser receives\n> > garbage value with HTTP/0.9 response. I've attached the Live HTTP headers\n> > capture of the same.\n> \n> Just because some Browser Add-on reports a \"HTTP/0.9 200 OK\" response it\n> doesn't necessarily mean that this is what Tomcat is actually sending\n> (otherwise you should have seen that response when you are connecting with\n> telnet.\n> \n> My guess would be that the add-on (or even the browser) is trying to\n> interpret SSL bytes as plain HTTP response, and because it fails, displayes\n> some \"HTTP/0.9\" response.\n> \n> I verified this by setting up Tomcat 6.0.37 with a SSL connector using JSSE,\n> and downloadeding the Live HTTP headers addon for Firefox. I use a tool to\n> intercept the TCP connections and record the exact data packets that were\n> sent.\n> \n> I then opened the URL \"http://localhost:8443/\" with Firefox. This is what\n> was sent from Firefox to Tomcat (309 bytes):\n> \n> 47 45 54 20 2F 20 48 54 54 50 2F 31 2E 31 0D 0A   GET / HTTP/1.1..\n> 48 6F 73 74 3A 20 6C 6F 63 61 6C 68 6F 73 74 3A   Host: localhost:\n> 38 34 34 33 0D 0A 55 73 65 72 2D 41 67 65 6E 74   8443..User-Agent\n> 3A 20 4D 6F 7A 69 6C 6C 61 2F 35 2E 30 20 28 57   : Mozilla/5.0 (W\n> 69 6E 64 6F 77 73 20 4E 54 20 36 2E 33 3B 20 57   indows NT 6.3; W\n> 4F 57 36 34 3B 20 72 76 3A 32 34 2E 30 29 20 47   OW64; rv:24.0) G\n> 65 63 6B 6F 2F 32 30 31 30 30 31 30 31 20 46 69   ecko/20100101 Fi\n> 72 65 66 6F 78 2F 32 34 2E 30 0D 0A 41 63 63 65   refox/24.0..Acce\n> 70 74 3A 20 74 65 78 74 2F 68 74 6D 6C 2C 61 70   pt: text/html,ap\n> 70 6C 69 63 61 74 69 6F 6E 2F 78 68 74 6D 6C 2B   plication/xhtml+\n> 78 6D 6C 2C 61 70 70 6C 69 63 61 74 69 6F 6E 2F   xml,application/\n> 78 6D 6C 3B 71 3D 30 2E 39 2C 2A 2F 2A 3B 71 3D   xml;q=0.9,*/*;q=\n> 30 2E 38 0D 0A 41 63 63 65 70 74 2D 4C 61 6E 67   0.8..Accept-Lang\n> 75 61 67 65 3A 20 64 65 2D 64 65 2C 64 65 3B 71   uage: de-de,de;q\n> 3D 30 2E 38 2C 65 6E 2D 75 73 3B 71 3D 30 2E 35   =0.8,en-us;q=0.5\n> 2C 65 6E 3B 71 3D 30 2E 33 0D 0A 41 63 63 65 70   ,en;q=0.3..Accep\n> 74 2D 45 6E 63 6F 64 69 6E 67 3A 20 67 7A 69 70   t-Encoding: gzip\n> 2C 20 64 65 66 6C 61 74 65 0D 0A 43 6F 6E 6E 65   , deflate..Conne\n> 63 74 69 6F 6E 3A 20 6B 65 65 70 2D 61 6C 69 76   ction: keep-aliv\n> 65 0D 0A 0D 0A                                    e....\n> \n> \n> This is what Tomcat responded (7 bytes):\n> 15 03 01 00 02 02 0A                              .......\n> (Connection closed)\n> \n> \n> This is what Live HTTP headers reported:\n> \n> http://localhost:8443/\n> \n> GET / HTTP/1.1\n> Host: localhost:8443\n> User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:24.0) Gecko/20100101\n> Firefox/24.0\n> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n> Accept-Language: de-de,de;q=0.8,en-us;q=0.5,en;q=0.3\n> Accept-Encoding: gzip, deflate\n> Connection: keep-alive\n> \n> HTTP/0.9 200 OK\n> ----------------------------------------------------------\n> \n> \n> As you can see, Tomcat didn't returin anything like \"HTTP/0.9 200 OK\" plain\n> text in its SSL response although Live HTTP Headers reports this. Instead it\n> sends some some SSL reply (though I do not have examined what kind of reply\n> it is), since actually you are sending some garbage to a SSL connector here.\n> \n> If Tomcat could be enhanced to recognize a erroneously sent plain HTTP\n> request to a HTTPS/SSL connector (like HTTPD does) is another question.\n\nI tried to figure out the SSL bytes --> 15 03 01 00 02 02 0A using the following link:\n\nhttp://pic.dhe.ibm.com/infocenter/tpfhelp/current/index.jsp?topic=%2Fcom.ibm.ztpf-ztpfdf.doc_put.cur%2Fgtps5%2Fs5rcd.html\n\nThis is what I think those bytes mean:\n\n0x15 --> SSL3_RT_ALERT\n0x03 0x01 --> TLS1_VERSION\n0x00 0x02 --> Length of data in the record (excluding the header itself)\n0x02 --> SSL3_MT_SERVER_HELLO or SSL3_AL_FATAL\n0x0A --> SSL3_AD_UNEXPECTED_MESSAGE"}, {"count": 18, "tags": [], "creator": "xu-dong.liu@sap.com", "attachment_id": null, "id": 176396, "time": "2014-07-15T03:07:44Z", "bug_id": 53281, "creation_time": "2014-07-15T03:07:44Z", "is_private": false, "text": "I meet the same issue in my test.\nI want to know if this issue can be fixed? Why it's status is marked invalid?"}]
[{"count": 0, "tags": [], "creator": "markus.gaisbauer@gmail.com", "is_private": false, "id": 113338, "attachment_id": null, "bug_id": 44340, "creation_time": "2008-02-01T07:56:32Z", "time": "2008-02-01T07:56:32Z", "text": "Profiling BCEL showed that a lot of time is spent in very little code. I have\ntracked down some of those problems, fixed them and saw a performance gain of\nmore than 100%. Later I have also found out that the AspectJ team and probably a\nfew other people had done the same a long time ago. Why these changes were never\nincorporated into BCEL trunk, I do not know.\n\nI understand, that from a performance perspective, I should use ASM anyway\n(which is crazily optimized:\nhttp://asm.objectweb.org/doc/developer-guide.html#optimizations).\n\nNevertheless some improvement probably would not hurt.\n\nHere is the log that shows the performance gains of all the optimisations I\napplied: \n\n// SVN\n\nClassParser.parse: 0.680119516 s\nClassGen.init: 0.596259385 s\nMethodGen.init: 7.627294121 s\nMethodGen.getMethod: 2.415617407 s\nClassGen.getJavaClass.getBytes: 0.573408268 s\nTotal: 12.358684516 s\n\nClassParser.parse: 0.486115354 s\nClassGen.init: 0.60449182 s\nMethodGen.init: 7.111806585 s\nMethodGen.getMethod: 2.137157344 s\nClassGen.getJavaClass.getBytes: 0.514757783 s\nTotal: 11.262602001 s\n\nClassParser.parse: 0.513113271 s\nClassGen.init: 0.596378125 s\nMethodGen.init: 7.09741055 s\nMethodGen.getMethod: 2.095376224 s\nClassGen.getJavaClass.getBytes: 0.472800383 s\nTotal: 11.161931208 s\n\n\n// Tune Instruction.readInstruction: Replace Reflection with SWITCH\n\nClassParser.parse: 0.675918174 s\nClassGen.init: 0.644816324 s\nMethodGen.init: 2.37364546 s\nMethodGen.getMethod: 2.350236018 s\nClassGen.getJavaClass.getBytes: 0.556582776 s\nTotal: 7.04360494 s\n\nClassParser.parse: 0.476201456 s\nClassGen.init: 0.579783983 s\nMethodGen.init: 2.099810171 s\nMethodGen.getMethod: 2.181126984 s\nClassGen.getJavaClass.getBytes: 0.488192476 s\nTotal: 6.227110003 s\n\nClassParser.parse: 0.477742278 s\nClassGen.init: 0.624694793 s\nMethodGen.init: 2.130978382 s\nMethodGen.getMethod: 2.002330381 s\nClassGen.getJavaClass.getBytes: 0.465331297 s\nTotal: 6.066029749 s\n\n// Tune ConstantPoolGen.init: Use StringBuffer\n\nClassParser.parse: 0.659908237 s\nClassGen.init: 0.519261101 s\nMethodGen.init: 2.305224708 s\nMethodGen.getMethod: 2.148664254 s\nClassGen.getJavaClass.getBytes: 0.617371665 s\nTotal: 6.710080325 s\n\nClassParser.parse: 0.466696673 s\nClassGen.init: 0.451812126 s\nMethodGen.init: 2.017315203 s\nMethodGen.getMethod: 1.995585551 s\nClassGen.getJavaClass.getBytes: 0.495333748 s\nTotal: 5.812121207 s\n\nClassParser.parse: 0.446558571 s\nClassGen.init: 0.409762396 s\nMethodGen.init: 1.937347861 s\nMethodGen.getMethod: 2.118172599 s\nClassGen.getJavaClass.getBytes: 0.453922767 s\nTotal: 5.715940347 s\n\n// Tune InstructionList.findHandle: Search directly\n\nClassParser.parse: 0.654898115 s\nClassGen.init: 0.55573093 s\nMethodGen.init: 1.670222455 s\nMethodGen.getMethod: 2.061828405 s\nClassGen.getJavaClass.getBytes: 0.540762239 s\nTotal: 5.888046098 s\n\nClassParser.parse: 0.452568062 s\nClassGen.init: 0.423769764 s\nMethodGen.init: 1.369177618 s\nMethodGen.getMethod: 2.015685293 s\nClassGen.getJavaClass.getBytes: 0.435557417 s\nTotal: 5.059064222 s\n\nClassParser.parse: 0.494708779 s\nClassGen.init: 0.455453825 s\nMethodGen.init: 1.24245897 s\nMethodGen.getMethod: 1.937969884 s\nClassGen.getJavaClass.getBytes: 0.441652383 s\nTotal: 4.911468856 s\n\n// Tune InvokeInstruction: Determine size directly\n\nClassParser.parse: 0.660422314 s\nClassGen.init: 0.515718571 s\nMethodGen.init: 1.522720755 s\nMethodGen.getMethod: 1.321707714 s\nClassGen.getJavaClass.getBytes: 0.542893948 s\nTotal: 4.963233706 s\n\nClassParser.parse: 0.447217948 s\nClassGen.init: 0.402592348 s\nMethodGen.init: 1.30743097 s\nMethodGen.getMethod: 1.242607624 s\nClassGen.getJavaClass.getBytes: 0.445710399 s\nTotal: 4.194830316 s\n\nClassParser.parse: 0.442218102 s\nClassGen.init: 0.449956988 s\nMethodGen.init: 1.335540618 s\nMethodGen.getMethod: 1.136129872 s\nClassGen.getJavaClass.getBytes: 0.441781442 s\nTotal: 4.132813855 s"}, {"count": 1, "attachment_id": null, "creator": "tcurdt@apache.org", "text": "Applied ....thanks!", "id": 113384, "time": "2008-02-02T13:06:00Z", "bug_id": 44340, "creation_time": "2008-02-02T13:06:00Z", "tags": [], "is_private": false}]
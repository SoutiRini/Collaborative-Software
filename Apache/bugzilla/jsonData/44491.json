[{"count": 0, "tags": [], "creator": "yegor@dinom.ru", "is_private": false, "text": "POI 3.0.2 includes handy accessors to DocumentSummary and Summary information\nstreams.\n\nUnfortunately old-style setting of POIFS properties doesn't work any more in all\ncases. By \"old-style\" I mean direct constructing \nof DocumentSummaryInformation and SummaryInformation from POIFSFileSystem.\n\n\"old-style\" usage is important, this is how I discovered this bug just before\ncopying POI 3.0.2 to production. \n\n\nConsider two code snippets:\n\n(1) set POIFS properties before constructing HSSFWorkbook (works fine)\n\n        POIFSFileSystem fs = new POIFSFileSystem(new FileInputStream(\"test.xls\"));\n \n        //set POIFS properties after constructing HSSFWorkbook\n        //(a piece of code that used to work up to POI 3.0.2)\n        SummaryInformation summary1 =\n(SummaryInformation)PropertySetFactory.create(fs.createDocumentInputStream(SummaryInformation.DEFAULT_STREAM_NAME));\n        summary1.setTitle(title);\n        //write the modified property back to POIFS\n        fs.getRoot().getEntry(SummaryInformation.DEFAULT_STREAM_NAME).delete();\n        fs.createDocument(summary1.toInputStream(),\nSummaryInformation.DEFAULT_STREAM_NAME);\n\n        HSSFWorkbook wb = new HSSFWorkbook(fs);\n\n        OutputStream out = new FileOutputStream(\"\"test-saved.xls\"\");\n        wb.write(out);\n        out.close();\n\n\n(2) set POIFS properties after constructing HSSFWorkbook (used to work up to POI\n3.0.2, fails now)\n\n        POIFSFileSystem fs = new POIFSFileSystem(new FileInputStream(\"test.xls\"));\n \n        HSSFWorkbook wb = new HSSFWorkbook(fs);\n\n        //set POIFS properties after constructing HSSFWorkbook\n        //(a piece of code that used to work up to POI 3.0.2)\n        SummaryInformation summary1 =\n(SummaryInformation)PropertySetFactory.create(fs.createDocumentInputStream(SummaryInformation.DEFAULT_STREAM_NAME));\n        summary1.setTitle(title);\n        //write the modified property back to POIFS\n        fs.getRoot().getEntry(SummaryInformation.DEFAULT_STREAM_NAME).delete();\n        fs.createDocument(summary1.toInputStream(),\nSummaryInformation.DEFAULT_STREAM_NAME);\n\n\n        OutputStream out = new FileOutputStream(\"\"test-saved.xls\"\");\n        wb.write(out);\n        out.close();\n\n\nUnfortunately (2) doesn't work any more  with POI 3.0.2. See the unit test in\nthe patch.\n\n\nI think I found a workaround but I don't want to commit it without discussing.\nThe idea is simple: don't read DocumentSummary and Summary\nin constructor. Instead, read them on first call of\nPOIDocument.getSummaryInformation() or POIDocument.getDocumentSummaryInformation(). \n\nNick, would you please confirm this change is OK to you?\n\n\nRegards,\nYegor", "id": 100378, "time": "2008-02-26T07:41:16Z", "bug_id": 44491, "creation_time": "2008-02-26T07:41:16Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "yegor@dinom.ru", "is_private": false, "text": "Created attachment 21594\nThe patch", "id": 99270, "time": "2008-02-26T07:42:00Z", "bug_id": 44491, "creation_time": "2008-02-26T07:42:00Z", "attachment_id": 21594}, {"count": 2, "text": "Since this is not an HPSF bug I don't care.", "creator": "klute@apache.org", "attachment_id": null, "id": 114044, "time": "2008-02-27T04:26:09Z", "bug_id": 44491, "creation_time": "2008-02-27T04:26:09Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 44491, "attachment_id": null, "id": 114189, "time": "2008-03-03T07:03:35Z", "creator": "apache@gagravarr.org", "creation_time": "2008-03-03T07:03:35Z", "is_private": false, "text": "This sounds sane to me. I figured it'd be handy for them to be available to everyone, save each user needing to repeat the code to get at them (I was getting bored of coding it every time at least!)\n\nHaving them read on demand works for me too though, so I'll apply it in a sec"}, {"count": 4, "tags": [], "bug_id": 44491, "attachment_id": null, "id": 114190, "time": "2008-03-03T07:10:05Z", "creator": "apache@gagravarr.org", "creation_time": "2008-03-03T07:10:05Z", "is_private": false, "text": "Patch committed"}]
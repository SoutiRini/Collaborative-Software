[{"count": 0, "attachment_id": null, "bug_id": 20991, "text": "Hi,\nI have tomcat 4.1.18 on a win2k. I setup a db-pool with the basic tags within \nthe context(see-reference 1 below) and then added resource ref elements(see-\nreference 2 below) in the web.xml file. \n \nLogger(\"State 1\");\nContext ctx = new InitialContext();\nLogger(\"State 2\");\nDataSource ds =(DataSource)ctx.lookup(\"java:comp/env/jdbc/jjcp);\nLogger(\"State 3 \" +ds);\nconnection= ds.getConnection();\n\n\nOutput:\nState 1\nState 2\nState 3 org.apache.commons.dbcp.BasicDataSource@19da967\n\n(and then no response)\n\nIt retrieves the datasource, but when it tries fetching a connection, there is \nno response back. I checked on mysql end, and it showed new process being \ncreated and dumped(status:login/freeing items). So, the connection-pool was \ninfact active. However, the datasource never returns with the connection. I \nhave got the mysql-connector-java-3.0.8-stable-bin.jar and jdbc2_0-stdext.jar \nin the TOMCAT_HOME/common/lib directory and I dont see why, this should be a \nclassloader issue.\n\nReference\n1.-------------------------------------------------\n         <Resource name=\"jdbc/jjcp\" auth=\"Container\" \ntype=\"javax.sql.DataSource\"/>\n <ResourceParams name=\"jdbc/jjcp\">\n      <parameter>\n        <name>validationQuery</name>\n        <value></value>\n      </parameter>\n      <parameter>\n        <name>maxWait</name>\n        <value>5000</value>\n      </parameter>\n      <parameter>\n        <name>maxActive</name>\n        <value>1</value>\n      </parameter>\n      <parameter>\n        <name>password</name>\n        <value>password</value>\n      </parameter>\n      <parameter>\n        <name>url</name>\n        <value>jdbc:mysql://localhost:3306/mysql</value>\n      </parameter>\n      <parameter>\n        <name>driverClassName</name>\n        <value>com.mysql.jdbc.Driver</value>\n      </parameter>\n      <parameter>\n        <name>maxIdle</name>\n        <value>1</value>\n      </parameter>\n      <parameter>\n        <name>username</name>\n        <value>root</value>\n      </parameter>\n      <parameter>\n        <name>factory</name>\n        <value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n      </parameter>\n    </ResourceParams>\n\n2.-------------------------------------------------\n\n   <resource-ref>\n      <description>\n         Resource reference to a factory for java.sql.Connection\n         instances that may be used for talking to a particular\n         database that is configured in the server.xml file.\n      </description>\n      <res-ref-name>\n         jdbc/jjcp\n      </res-ref-name>\n      <res-type>\n         javax.sql.DataSource\n      </res-type>\n      <res-auth>\n         Container\n      </res-auth>\n   </resource-ref>", "id": 39240, "time": "2003-06-22T03:44:14Z", "creator": "chirags@hotmail.com", "creation_time": "2003-06-22T03:44:14Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "This happens whenever the ValidationQuery is empty.\nIt keeps on connecting and trying to send this query.\nThere should be a check at this point to avoid sending a validation\nquery that contains something like /\\ *;\\ */\n\n\n", "attachment_id": null, "id": 43620, "creator": "melero@eurolands.com", "time": "2003-09-02T17:12:39Z", "bug_id": 20991, "creation_time": "2003-09-02T17:12:39Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 20991, "attachment_id": null, "is_private": false, "id": 43795, "time": "2003-09-06T10:14:05Z", "creator": "tagunov@motor.ru", "creation_time": "2003-09-06T10:14:05Z", "text": "Chirag, you input is very much appreciated. Could you please resubmit this bug under Jakarta \nCommons / DBCP as there is nobody among Tomcat developers to fix it?\n\nOn the other hand you may \nwell just NOT set any validation query at all, I guess it will work that way, won't it?"}, {"count": 3, "tags": [], "bug_id": 20991, "attachment_id": null, "id": 44147, "time": "2003-09-13T14:40:42Z", "creator": "dirk.verbeeck@pandora.be", "creation_time": "2003-09-13T14:40:42Z", "is_private": false, "text": "Bugzilla Bug 23081 has been created under Jakarta Commons DBCP"}]
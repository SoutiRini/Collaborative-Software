[{"count": 0, "tags": [], "bug_id": 44508, "text": "Created attachment 21601\nthe excel file, edited by Open Office Calc, contains boolean values that are considered as functions\n\nReading an excel file, created with Open Office Calc, where the boolean flags are apparently saved as cells of type FORMULA, causes number format exceptions at evaluation time\n\nCaused by: java.lang.NumberFormatException: You cannot get a boolean value from a non-boolean cell\n\tat org.apache.poi.hssf.usermodel.HSSFCell.getBooleanCellValue(HSSFCell.java:850)\n\tat org.apache.poi.hssf.usermodel.HSSFCell.setCellType(HSSFCell.java:468)\n\tat org.apache.poi.hssf.usermodel.HSSFCell.setCellType(HSSFCell.java:329)\n\tat org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateInCell(HSSFFormulaEvaluator.java:289)", "id": 114120, "time": "2008-02-29T03:02:37Z", "creator": "java@essers.com", "creation_time": "2008-02-29T03:02:37Z", "is_private": false, "attachment_id": 21601}, {"text": "Created attachment 21605\nsvn diff of changes to HSSFCell.java", "tags": [], "bug_id": 44508, "is_private": false, "count": 1, "id": 114137, "time": "2008-02-29T11:02:47Z", "creator": "josh@apache.org", "creation_time": "2008-02-29T11:02:47Z", "attachment_id": 21605}, {"count": 2, "tags": [], "bug_id": 44508, "text": "HSSFFormulaEvaluator.evaluateInCell() does an evaluation of the cell formula and then replaces the formula with the evaluation result.\n\nCan you tell me why you are using this non-idempotent method?  Is it a question of performance?  \n\n\nHSSFCell has a method setCellType() which both gets and sets the cell value.  The cell value accessor methods are mostly type checked, preventing setting or getting a value of the wrong type.  The combination of these causes some convoluted logic.\n\nThis patch I have submitted only fixes the case where the formula result is a boolean.  Here is a test case specifically for this patch:\n\n    private void testEvaluateBooleanInCell_bug44508() {\n        HSSFWorkbook wb = new HSSFWorkbook();\n        HSSFSheet sheet = wb.createSheet();\n        wb.setSheetName(0, \"Sheet1\");\n        HSSFRow row = sheet.createRow(0);\n        HSSFCell cell = row.createCell((short)0);\n\n        cell.setCellFormula(\"1=1\");\n        \n        HSSFFormulaEvaluator fe = new HSSFFormulaEvaluator(sheet, wb);\n        fe.setCurrentRow(row);\n        try {\n            fe.evaluateInCell(cell);\n        } catch (NumberFormatException e) {\n            fail(\"Identified bug 44508\");\n        }\n        assertEquals(true, cell.getBooleanCellValue());\n   }\n", "id": 114138, "time": "2008-02-29T11:24:41Z", "creator": "josh@apache.org", "creation_time": "2008-02-29T11:24:41Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 44508, "text": "Thanks for the patch and test, applied to svn trunk", "id": 114197, "time": "2008-03-03T08:54:49Z", "creator": "apache@gagravarr.org", "creation_time": "2008-03-03T08:54:49Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "With JK 2.0.4 it was possible to handle authentication completely within the \nwebapp (for example using jCIFS) as if the tomcat http connector would be used. \nThe virtual directory \"jakarta\" is configured to do no (basic/windows) \nauthentication (i.e. anonymous). \nWith JK 1.2.13 I was not able to configure the same behaviour. IIS/JK 1.2.13 \ninterferes with the authentication process. Authentication headers which should \nbe forwarded to tomcat are removed from the request.\nIt should be possible to authenticate using tomcat/webapp means independent from \nthe used connector (http or JK). That means for example the tomcat manager could \nbe simply used over IIS/JK without doing any extra authentication configuration \nand/or usermanagement at IIS side. The userdatabase would be conf\\tomcat-users.\nxml. Tomcat users could use IIS, but keep the authentication process within \nTomcat. I found some mails in the tomcat-users mailinglist about authentication \nprobs with JK/IIS, so I assume this RFE would be also useful for others.\n\nIt seems when a IIS version before IIS 5 is recognized, IIS/JK will not \ninterfere with authentication process. Tomcat or the webapp could do \nauthentication undisturbed.\nI have made a modification to jk_isapi_plugin.c, which will provide the \nfunctionality for doing this for me.\n\nWith this modification ISAPI_redirect will operate as if an IIS Version before 5 \nis recognized but only if the registry key \nSoftware\\Apache Software Foundation\\Jakarta Isapi Redirector\\1.\n0\\bypass_iis5_auth = '1' exists. Without this key the modification has no \neffect, so this should not break current installations.\n\nCould someone apply this patch or at least the functionality to the JK codebase?\nPlease feel free to change the patch code, if it does not fit source code \nrequirements. (I am not a C developer)\n\n*** jk-1.2.13-src\\jk\\native\\iis\\jk_isapi_plugin.c 2005-05-15 13:10:12.000000000 \n+-0200\n--- jk-1.2.13-src\\jk\\native\\iis\\jk_isapi_plugin_modified.c 2005-06-08 11:31:38.\n000000000 +-0200\n***************\n*** 64,69 ****\n--- 64,71 ----\n  #define REGISTRY_LOCATION       (\"Software\\\\Apache Software \nFoundation\\\\Jakarta Isapi Redirector\\\\1.0\")\n  #define EXTENSION_URI_TAG       (\"extension_uri\")\n  \n! #define BYPASS_IIS5_AUTH       (\"bypass_iis5_auth\")\n! \n  #define URI_SELECT_TAG              (\"uri_select\")\n  #define URI_SELECT_PARSED_VERB      (\"parsed\")\n  #define URI_SELECT_UNPARSED_VERB    (\"unparsed\")\n***************\n*** 120,125 ****\n--- 122,128 ----\n  static int is_inited = JK_FALSE;\n  static int is_mapread = JK_FALSE;\n  static int iis5 = -1;\n+ static int bypass_iis5 = 0;\n  \n  static jk_uri_worker_map_t *uw_map = NULL;\n  static jk_logger_t *logger = NULL;\n***************\n*** 694,699 ****\n--- 697,706 ----\n              iis5 = (atof(serverSoftware + 14) >= 5.0);\n              if (iis5) {\n                  jk_log(logger, JK_LOG_DEBUG, \"Detected IIS >= 5.0\");\n+ \t\t\t\tif (bypass_iis5) {\n+ \t                jk_log(logger, JK_LOG_DEBUG, \"bypass_iis5_auth>0 set iis5=0\")\n;\n+ \t\t\t        iis5 = 0;\n+ \t\t\t\t}\n              }\n              else {\n                  jk_log(logger, JK_LOG_DEBUG, \"Detected IIS < 5.0\");\n***************\n*** 1323,1328 ****\n--- 1330,1343 ----\n              }\n          }\n  \n!         if (get_registry_config_parameter(hkey,\n!                                           BYPASS_IIS5_AUTH,\n!                                           tmpbuf, sizeof(tmpbuf))) {\n! \t\t\tif (tmpbuf[0]>'0')  {\n! \t\t\t\tbypass_iis5=1;\n! \t\t\t}\n!         }\n! \n          RegCloseKey(hkey);\n      }\n      return ok;", "attachment_id": null, "id": 76328, "creator": "charly41434@yahoo.de", "time": "2005-06-12T23:48:58Z", "bug_id": 35336, "creation_time": "2005-06-12T23:48:58Z", "is_private": false}, {"count": 1, "tags": [], "text": "You should use the proper configuration for IIS. If the authorization is\nrequired, then you should set that with IIS. It will be handled with\nTomcat.", "attachment_id": null, "id": 76951, "creator": "mturk@apache.org", "time": "2005-07-03T11:31:01Z", "bug_id": 35336, "creation_time": "2005-07-03T11:31:01Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "levanttran@yahoo.com", "attachment_id": null, "id": 99287, "time": "2007-02-12T10:30:59Z", "bug_id": 41596, "creation_time": "2007-02-12T10:30:59Z", "is_private": false, "text": "Description:\n\n    Ant tar task with bzip2 compression option or ant bzip2 task generates\n    corrupted output for filesize of roughly 170+MB (before compression).\n\n    This problem occurs with ant version 1.7 installed in 12/06.\n    Tested on linux with both jdk 1.5 and jdk 1.6\n\nWork around: replace <tar compress=bzip2..> or <bzip2 ..>\n         with 2 steps: <tar ..> and <exec ...bzip2>\n\nFor example,\n\n Replace this:\n    <bzip2 src=\"${out.file}.dmp.tar\"\n        destfile=\"${out.file}.dmp.tar.bz2\">\n      <tarfileset dir=\"${dumps.dir}\">\n        <include name=\"${dist.schema}.dmp\"/>\n      </tarfileset>\n    </bzip2>\n Or this:\n    <tar destfile=\"${out.file}.dmp.tar\"\n        compression=\"bzip2\">\n      <tarfileset dir=\"${dumps.dir}\">\n        <include name=\"${dist.schema}.dmp\"/>\n      </tarfileset>\n    </tar>\n\n\n With:\n\n    <tar destfile=\"${out.file}.dmp.tar\">\n      <tarfileset dir=\"${dumps.dir}\">\n        <include name=\"${dist.schema}.dmp\"/>\n      </tarfileset>\n    </tar>\n\n    <exec dir=\"${dumps.dir}\"\n        executable=\"bzip2\">\n        <arg value=\"${out.file}.dmp.tar\"/>\n    </exec>"}, {"count": 1, "tags": [], "bug_id": 41596, "attachment_id": null, "id": 99290, "time": "2007-02-12T11:30:29Z", "creator": "peterreilly@apache.org", "creation_time": "2007-02-12T11:30:29Z", "is_private": false, "text": "I have not been able to reproduce this.\nI have tested with the Knoppix.iso file as\nan example of a large (~700M) file:\n\n    <tar destfile=\"iso.tar.bz2\"\n         compression=\"bzip2\">\n      <tarfileset dir=\".\">\n       <include name=\"big.iso\"/>\n     </tarfileset>\n   </tar>\n\nThe resultant tar bz2 file seems ok,\ntar xjf works on it and the cmp program\nreports no difference:\n\n~/learning/a/big> ls\nbig.iso  big.iso.save  build.xml  iso.tar.bz2\n~/learning/a/big> tar tjf iso.tar.bz2\nbig.iso\n~/learning/a/big> mkdir z\n~/learning/a/big> cd z\n~/learning/a/big/z> tar xjf ../iso.tar.bz2\n~/learning/a/big/z> cmp big.iso ../big.iso\n~/learning/a/big/z>      \n"}, {"count": 2, "tags": [], "bug_id": 41596, "attachment_id": null, "id": 102459, "time": "2007-04-26T06:38:30Z", "creator": "tensberg@gmx.net", "creation_time": "2007-04-26T06:38:30Z", "is_private": false, "text": "I've run into the same problem with the bzip2 task. The src file was originally\n837MB, but through repeatedly splitting the file I could create a 22MB test file\nwhich when bzipped with the ant task creates a corrupt bz2 file (verified with\nbzip2 -t). I'll attach this file as a testcase. If I cut the file to 21MB, ant\ncreates a working bz2 file.\n\nI could reproduce this error on both Windows XP and Linux, so I changed the OS\nfield to \"All\".\n\nThe error happens with both Java 1.5.0_10 and Java 1.6.0. I also tested the\nfollowing ant versions:\n\nCorrupted bz2 file:\nApache Ant version 1.7.1alpha compiled on April 25 2007 (nightly build)\nApache Ant version 1.7.0 compiled on December 13 2006\n\nWorking:\nApache Ant version 1.6.5 compiled on June 2 2005"}, {"count": 3, "tags": [], "text": "I can't attach the testcase, since its compressed size (1.4M) exceeds the\nbugzilla limit for uploads. Does anyone have a server where I can upload and\nlink it?", "attachment_id": null, "bug_id": 41596, "id": 102464, "time": "2007-04-26T06:57:01Z", "creator": "tensberg@gmx.net", "creation_time": "2007-04-26T06:57:01Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 41596, "attachment_id": null, "id": 102500, "time": "2007-04-26T08:52:07Z", "creator": "levanttran@yahoo.com", "creation_time": "2007-04-26T08:52:07Z", "is_private": false, "text": "(In reply to comment #0)\n> Description:\n> \n>     Ant tar task with bzip2 compression option or ant bzip2 task generates\n>     corrupted output for filesize of roughly 170+MB (before compression).\n> \n>     This problem occurs with ant version 1.7 installed in 12/06.\n>     Tested on linux with both jdk 1.5 and jdk 1.6\n> \n> Work around: replace <tar compress=bzip2..> or <bzip2 ..>\n>          with 2 steps: <tar ..> and <exec ...bzip2>\n> \n> For example,\n> \n>  Replace this:\n>     <bzip2 src=\"${out.file}.dmp.tar\"\n>         destfile=\"${out.file}.dmp.tar.bz2\">\n>       <tarfileset dir=\"${dumps.dir}\">\n>         <include name=\"${dist.schema}.dmp\"/>\n>       </tarfileset>\n>     </bzip2>\n>  Or this:\n>     <tar destfile=\"${out.file}.dmp.tar\"\n>         compression=\"bzip2\">\n>       <tarfileset dir=\"${dumps.dir}\">\n>         <include name=\"${dist.schema}.dmp\"/>\n>       </tarfileset>\n>     </tar>\n> \n> \n>  With:\n> \n>     <tar destfile=\"${out.file}.dmp.tar\">\n>       <tarfileset dir=\"${dumps.dir}\">\n>         <include name=\"${dist.schema}.dmp\"/>\n>       </tarfileset>\n>     </tar>\n> \n>     <exec dir=\"${dumps.dir}\"\n>         executable=\"bzip2\">\n>         <arg value=\"${out.file}.dmp.tar\"/>\n>     </exec>\n\n(In reply to comment #3)\n> I can't attach the testcase, since its compressed size (1.4M) exceeds the\n> bugzilla limit for uploads. Does anyone have a server where I can upload and\n> link it?\n\n\nI believe it's the content specific.  However I couldn't upload our data because\nit's confidential.  Your testcase is crucial in this case.\nHopefully ant developers will contact you to get your testcase."}, {"count": 5, "tags": [], "creator": "tensberg@gmx.net", "attachment_id": null, "id": 102531, "time": "2007-04-26T23:02:40Z", "bug_id": 41596, "creation_time": "2007-04-26T23:02:40Z", "is_private": false, "text": "I have updated the summary to better describe the problem."}, {"count": 6, "tags": [], "creator": "mbenson@apache.org", "attachment_id": null, "id": 102600, "time": "2007-04-28T13:41:36Z", "bug_id": 41596, "creation_time": "2007-04-28T13:41:36Z", "is_private": false, "text": "So is it the content of your specific file, or might it be possible to create a\nbuildfile or other program capable of -producing- a file that would show the\nsame problems?"}, {"count": 7, "tags": [], "creator": "levanttran@yahoo.com", "is_private": false, "id": 102647, "creation_time": "2007-04-29T21:08:03Z", "time": "2007-04-29T21:08:03Z", "bug_id": 41596, "text": "(In reply to comment #6)\n> So is it the content of your specific file, or might it be possible to create a\n> buildfile or other program capable of -producing- a file that would show the\n> same problems?\n\nMy file was an oracle dump file.", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 41596, "attachment_id": null, "is_private": false, "id": 102648, "time": "2007-04-29T22:53:05Z", "creator": "tensberg@gmx.net", "creation_time": "2007-04-29T22:53:05Z", "text": "(In reply to comment #6)\n> So is it the content of your specific file, or might it be possible to create a\n> buildfile or other program capable of -producing- a file that would show the\n> same problems?\n\nI tried at first to set up a script which creates files with random data of\nincreasing length to generate a smaller testcase, but the script ran very slow\n(mainly because of /dev/random taking long to generate random data). I am also\nnot sure how the bzip2 algorithm behaves on pseudorandom data and if the error\nwill be triggered at all.\n\nI think that to create a testcase, knowledge of the algorithms used is needed to\ngenerate testcases for the boundary conditions; in other words you already need\nto have a good idea what the error might be to write a testcase for it (and I\nhave no understanding of how bzip2 works)."}, {"count": 9, "tags": [], "creator": "tensberg@gmx.net", "is_private": false, "id": 102736, "creation_time": "2007-05-02T03:06:57Z", "time": "2007-05-02T03:06:57Z", "bug_id": 41596, "text": "Created attachment 20086\nTestcase with datafile for which the bzip2 task creates a corrupted bz2 file\n\nI have managed to reduce the size of my testcase to 10MB uncompressed (should\nhave done that earlier). Note that if I only take the last 9MB of the testcase\nfile, the created bzip2 file is correct.\n\nThe attached archive contains a testcase data file for which the ant bzip2 task\ncreates a corrupted bz2 archive and an ant buildfile which demonstrates the\nbehavior. The buildfile creates the bz2 archive and then executes the\ncommand-line bzip2 -tv, which shows the error.", "attachment_id": 20086}, {"count": 10, "tags": [], "bug_id": 41596, "attachment_id": null, "id": 102737, "time": "2007-05-02T03:08:35Z", "creator": "tensberg@gmx.net", "creation_time": "2007-05-02T03:08:35Z", "is_private": false, "text": "Changing status and reassigning to peterreilly@apache.org as requested in the\nNEEDINFO status description."}, {"count": 11, "tags": [], "bug_id": 41596, "attachment_id": null, "is_private": false, "id": 102739, "time": "2007-05-02T03:20:53Z", "creator": "peterreilly@apache.org", "creation_time": "2007-05-02T03:20:53Z", "text": "Thanks for the test build file and data.\nI can confirm that I see the same error.\nreassigning to dev@ant.apache.org"}, {"count": 12, "tags": [], "bug_id": 41596, "attachment_id": null, "is_private": false, "id": 103750, "time": "2007-05-28T08:34:14Z", "creator": "peterreilly@apache.org", "creation_time": "2007-05-28T08:34:14Z", "text": "Tested with ant 1.6.5.\nant 1.6.5 works with this build file - so this is a regression.\ncomment #2 also says this.\n\nLooking at the SVN repository the main change that\nI can see is: revison 278185\nhttp://svn.apache.org/viewvc?view=rev&revision=276208\n\nwhich was applied as a result of:\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=24798\n\nthis was done to make bzip2 faster and use less memory - however\non some edge cases it does seem to generate corrupt files.\nI would suggest rolling back the changes.\n\n\n\n"}, {"count": 13, "tags": [], "bug_id": 41596, "attachment_id": null, "id": 103751, "time": "2007-05-28T08:39:31Z", "creator": "peterreilly@apache.org", "creation_time": "2007-05-28T08:39:31Z", "is_private": false, "text": "\nOpps THAT should be: !\nhttp://svn.apache.org/viewvc?view=rev&revision=278185\n"}, {"count": 14, "tags": [], "bug_id": 41596, "attachment_id": null, "id": 103811, "time": "2007-05-30T06:30:53Z", "creator": "peterreilly@apache.org", "creation_time": "2007-05-30T06:30:53Z", "is_private": false, "text": "I have reverted the bzip2 output stream code, and the example\nfiles that were provided now work. Thanks a lot for providing\nthe example files - they were extremely useful."}, {"count": 15, "tags": [], "bug_id": 41596, "attachment_id": null, "is_private": false, "id": 125531, "time": "2009-03-12T18:25:33Z", "creator": "rschmidt@facebook.com", "creation_time": "2009-03-12T18:25:33Z", "text": "\nI have a patch for the buggy CBZip2OutputStream:\n\nhttps://issues.apache.org/jira/browse/HADOOP-5326\n\nWhat is the best way to correct it on Ant, since the code has already been reverted?"}, {"count": 16, "tags": [], "bug_id": 41596, "attachment_id": null, "id": 125845, "time": "2009-03-27T06:56:02Z", "creator": "bodewig@apache.org", "creation_time": "2009-03-27T06:56:02Z", "is_private": false, "text": "Rodrigo's patch is in svn trunk now and will be part of Ant 1.8.0."}]
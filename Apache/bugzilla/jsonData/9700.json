[{"attachment_id": null, "tags": [], "creator": "jemiller@uchicago.edu", "is_private": false, "count": 0, "id": 17414, "time": "2002-06-07T16:45:36Z", "bug_id": 9700, "creation_time": "2002-06-07T16:45:36Z", "text": "I found that if you configure Tomcat to use JNDIRealm in the configuration \nwhere it binds as the remote user to the LDAP server (i.e. if you leave the \nuserPassword attribute blank as described under bullet point 4 in the \nJNDIRealm documentation in the Catalina documentation), that it allows users \nto authenticate successfully with a blank password.\n\nI think this is because LDAP considers authentication with a valid DN and a \nblank password an anonymous authentication. i.e. authentication doesn't fail, \nit just logs you in anonymously instead.\n\nSo, I'm thinking that JNDIRealm should probably check to make sure that \npassword isn't blank and if it is a blank password, it should fail.\n\nI'm using the following configuration in my server.xml.\n\n<Realm className=\"org.apache.catalina.realm.JNDIRealm\"\n\tdebug=\"99\"\n\tconnectionName=\"cn=Manager, dc=mydomain\"\n\tconnectionPassword=\"mypassword\"\n\tconnectionURL=\"ldap://myldapserver\"\n\troleBase=\"ou=roles, dc=mydomain\"\n\troleName=\"cn\"\n\troleSearch=\"(uniqueMember={0})\"\n\troleSubtree=\"false\"\n\tuserPattern=\"uid={0}, ou=People, dc=mydomain\"/>\n\nI've tested this with OpenLDAP and iPlanet Directory Server and the behavior \nis the same."}, {"attachment_id": null, "tags": [], "creator": "jemiller@uchicago.edu", "text": "I think I have a fix for this bug. There is a statement that I believe should \nbe on line 719 in the authenticate() method in JNDIRealm.java that is the \nfollowing,\n\nif (username == null || credentials == null)\n\nif you change it to the following, that seems to fix the problem.\n\nif (username == null || credentials == null || (username != null && \nusername.equals(\"\")) || (credentials != null && credentials.equals(\"\")))\n\nAs you can see, it already checks for a null user name or password. The fix \nthat I have just checks for an empty string as well.\n\nCan someone put this fix in for me? I'm new to using CVS. If there is a CVS \ncommand that I should use, please let me know. Thanks!\n", "count": 1, "id": 17540, "time": "2002-06-10T23:49:27Z", "bug_id": 9700, "creation_time": "2002-06-10T23:49:27Z", "is_private": false}, {"count": 2, "tags": [], "creator": "j.g.holman@qmul.ac.uk", "attachment_id": null, "is_private": false, "id": 17560, "time": "2002-06-11T08:43:59Z", "bug_id": 9700, "creation_time": "2002-06-11T08:43:59Z", "text": "Thanks for reporting this - please would a committer fix it as soon as possible.\n\nIt's obviously a serious security problem for anyone using the new JNDIRealm\nfunctionality (doesn't affect previous functionality)\n\nif (username == null || username.equals(\"\"\") || credentials == null ||\ncredentials.equals(\"\"))\n\nwould be a bit simpler than the suggested patch.\n"}, {"attachment_id": null, "tags": [], "creator": "remm@apache.org", "text": "The patch has been applied, and will be integrated in the 4.1.5 milestone.", "count": 3, "id": 17719, "time": "2002-06-12T23:49:26Z", "bug_id": 9700, "creation_time": "2002-06-12T23:49:26Z", "is_private": false}]
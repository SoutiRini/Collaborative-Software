[{"count": 0, "attachment_id": null, "bug_id": 55556, "text": "I've been running the command:\n\nulimit -n 20010 ; ab -n 20000 -c 20000 http://my.host.com/\n\nAnd found that after running it a few times, it refuses to run and gives the following error:\n\napr_socket_connect(): Cannot assign requested address (99)\n\nIt would appear that all tcp sockets are in a WAIT state, and can't be reused until the timer expires on some of the sockets.\n\nIf the sockets that ab uses were marked with 'SO_REUSEADDR', this problem might go away.\n\nThanks!", "id": 170097, "time": "2013-09-13T22:39:26Z", "creator": "issues.apache.org@ch.pkts.ca", "creation_time": "2013-09-13T22:39:26Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "ylavic.dev@gmail.com", "text": "Even with SO_REUSEADDR, you can't reuse a TIME_WAITing client's IP:port to connect the same server's IP:port.\n\nOn linux, you can do things like \"sysctl -w net.ipv4.tcp_tw_recycle=1\" to kind of ignore TIME_WAIT delays, but your network should better not loose/retransmit packets that could interfere with subsequent connections, that's the purpose of the TIME_WAIT state, however it can be a temporary setting for the duration of the bench...\n\nThe best option (though more expensive) is to use multiple ab clients on as much machines or NICs (with \"ip route add ... dev NIC\").", "id": 170098, "time": "2013-09-14T00:23:02Z", "bug_id": 55556, "creation_time": "2013-09-14T00:23:02Z", "is_private": false, "attachment_id": null}]
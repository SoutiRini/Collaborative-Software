[{"count": 0, "tags": [], "bug_id": 23710, "text": "Due to a bug in Rev 1.19 of jk_isapi_plugin.c path mappings are not correctly\nmapped from IIS to tomcat.\n\nuriworkermap.properties:\n/servlet/* = local\n\njk_isapi_plugin.c tries to support virtual host mapping entries in uriworkermap\nby pre-pending the hostname as a directory, to the pattern.\n\nEx: \"/test1.imarketinc.com/servlet/*\"\n\nIf that pattern does not match, it is supposed to then try without the\nhostname... (the log message \"In HttpFilterProc test Default redirection...\").\n\njk 1.2.5, jk_isapi_plugin.c introduced a bug, which causes the default check to\nnever happen. Below is the relevant log output, you can see that the default\npattern is never checked for a match. To compound the problem, the log message\nis now incorrect, and logs the wrong variable (says one thing, but does another).\n\nmod_jk.log (debug level):\n[Thu Oct 09 15:58:00 2003]  [jk_isapi_plugin.c (655)]: Detected IIS >= 5.0\n[Thu Oct 09 15:58:00 2003]  [jk_isapi_plugin.c (696)]: HttpFilterProc started\n[Thu Oct 09 15:58:00 2003]  [jk_isapi_plugin.c (759)]: In HttpFilterProc Virtual\nHost redirection of /test1.zapdata.com/servlet/TestServlet\n[Thu Oct 09 15:58:00 2003]  [jk_isapi_plugin.c (766)]: In HttpFilterProc test\nDefault redirection of /servlet/TestServlet\n[Thu Oct 09 15:58:00 2003]  [jk_uri_worker_map.c (486)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Thu Oct 09 15:58:00 2003]  [jk_uri_worker_map.c (500)]: Attempting to map URI\n'/test1.zapdata.com/servlet/TestServlet'\n[Thu Oct 09 15:58:00 2003]  [jk_uri_worker_map.c (618)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n[Thu Oct 09 15:58:00 2003]  [jk_isapi_plugin.c (830)]: HttpFilterProc\n[/servlet/TestServlet] is not a servlet url\n\n\nHere is the relevent block of code:\n\n            if (szHost > 0) {\n                strcat(snuri,Host);\n                strcat(snuri,uri);\n                jk_log(logger, JK_LOG_DEBUG, \n                       \"In HttpFilterProc Virtual Host redirection of %s\\n\", \n                       snuri);\n            } else {\n\t      strncpy(snuri, uri, sizeof(snuri));\n\t    }\n            if (!worker) {\n                jk_log(logger, JK_LOG_DEBUG, \n                       \"In HttpFilterProc test Default redirection of %s\\n\", \n                       uri);\n                worker = map_uri_to_worker(uw_map, snuri, logger);\n            }", "id": 45321, "time": "2003-10-09T21:37:04Z", "creator": "mark@tweakt.net", "creation_time": "2003-10-09T21:37:04Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 23710, "is_private": false, "id": 45323, "attachment_id": null, "creator": "mark@tweakt.net", "creation_time": "2003-10-09T21:50:08Z", "time": "2003-10-09T21:50:08Z", "text": "For comparison, here is the output of jk 1.2.4, showing correct bahviour:\n\n[Thu Oct 09 17:45:11 2003]  [jk_isapi_plugin.c (696)]: HttpFilterProc started\n[Thu Oct 09 17:45:11 2003]  [jk_isapi_plugin.c (759)]: In HttpFilterProc Virtual\nHost redirection of /test1.zapdata.com/servlet/TestServlet\n[Thu Oct 09 17:45:11 2003]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Thu Oct 09 17:45:11 2003]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/test1.zapdata.com/servlet/TestServlet'\n[Thu Oct 09 17:45:11 2003]  [jk_uri_worker_map.c (599)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n[Thu Oct 09 17:45:11 2003]  [jk_isapi_plugin.c (765)]: In HttpFilterProc test\nDefault redirection of /servlet/TestServlet\n[Thu Oct 09 17:45:11 2003]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Thu Oct 09 17:45:11 2003]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/servlet/TestServlet'\n[Thu Oct 09 17:45:11 2003]  [jk_uri_worker_map.c (502)]:\njk_uri_worker_map_t::map_uri_to_worker, Found a context match local -> /servlet/\n[Thu Oct 09 17:45:11 2003]  [jk_isapi_plugin.c (775)]: HttpFilterProc\n[/servlet/TestServlet] is a servlet url - should redirect to local"}, {"count": 2, "tags": [], "bug_id": 23710, "is_private": false, "id": 59509, "attachment_id": null, "creator": "markt@apache.org", "creation_time": "2004-06-18T18:43:12Z", "time": "2004-06-18T18:43:12Z", "text": "This component is now deprecated. If you still experience this issue, please \nupgrade to the Coyote JK2 connector.\n\nNo further work will take place against this bug report.\n\n"}]
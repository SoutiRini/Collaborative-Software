[{"count": 0, "tags": [], "creator": "christian.schuhegger@cern.ch", "attachment_id": null, "text": "in the following patch you can see that i added a check for an array index out\nof bounds and a check for a null pointer. \n\nit is quite possible that the two methods i fixed state in their pre-conditions\nthat something like that should not happen, but then the bug is somewhere else\nbecause these pre-conditions were violated.\n\nIndex: src/java/org/apache/poi/hssf/record/UnknownRecord.java\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-poi/src/java/org/apache/poi/hssf/record/UnknownRecord.java,v\nretrieving revision 1.9\ndiff -c -r1.9 UnknownRecord.java\n*** src/java/org/apache/poi/hssf/record/UnknownRecord.java\t9 Apr 2004 13:05:20\n-0000\t1.9\n--- src/java/org/apache/poi/hssf/record/UnknownRecord.java\t30 Jun 2004 17:31:44\n-0000\n***************\n*** 62,68 ****\n      {\n          sid     = id;\n          thedata = new byte[size];\n!         System.arraycopy(data, offset, thedata, 0, size);\n      }   \n  \n      /**\n--- 62,69 ----\n      {\n          sid     = id;\n          thedata = new byte[size];\n!         int len = Math.min(size, data.length - offset);\n!         System.arraycopy(data, offset, thedata, 0, len);\n      }   \n  \n      /**\nIndex: src/java/org/apache/poi/hssf/usermodel/HSSFSheet.java\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-poi/src/java/org/apache/poi/hssf/usermodel/HSSFSheet.java,v\nretrieving revision 1.27\ndiff -c -r1.27 HSSFSheet.java\n*** src/java/org/apache/poi/hssf/usermodel/HSSFSheet.java\t9 Apr 2004 13:05:24\n-0000\t1.27\n--- src/java/org/apache/poi/hssf/usermodel/HSSFSheet.java\t30 Jun 2004 17:31:44 -0000\n***************\n*** 308,313 ****\n--- 308,315 ----\n  \n      public HSSFRow getRow(int rownum)\n      {\n+         if(null == this.sheet.getRow(rownum))\n+             return null;\n          HSSFRow retval = new HSSFRow(book, sheet, this.sheet.getRow(rownum));\n  \n          return retval;", "id": 60379, "time": "2004-07-09T18:33:47Z", "bug_id": 30008, "creation_time": "2004-07-09T18:33:47Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 30008, "text": "without the change to UnknowRecord.java (i hit this and basically coded the\nsame) i cannot use HSSF to read spreadsheets with pivot tables (and probably\npivot charts).  so this is a pretty important change to get back to the mothership.", "id": 73455, "time": "2005-04-08T19:50:20Z", "creator": "jameisonb@yahoo.com", "creation_time": "2005-04-08T19:50:20Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 30008, "attachment_id": null, "text": "The Excel template when read using HSSF throws the arrayIndexException. Just \nfor kicks when I altered the code in UnknownRecord (Line 62):\nfrom System.arraycopy(data, offset, thedata, 0, size); to\n\ntry {\n            System.arraycopy(data, offset, thedata, 0, size);\n        } catch (Exception e) {\n            // Hack to clear the bug\n            thedata = new byte[data.length - offset];\n            System.arraycopy(data, offset, thedata, 0, data.length - offset);\n        }\n\nthings went ahead fine. But I guess this may not be the correct solution even \nthough it worked for me. I can provide a test template if it is of any help \n(amit_vijayant@yahoo.com).", "id": 74462, "time": "2005-05-05T01:55:08Z", "creator": "amit_vijayant@yahoo.com", "creation_time": "2005-05-05T01:55:08Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 30008, "is_private": false, "text": "I believe that this is an invalid fix. If someone has an excel file that\ngenerates this exception please REOPEN this bug and attach the file. Sorry cant\ndo much with this limited information.\n\nJason", "id": 78865, "time": "2005-08-23T04:55:43Z", "creator": "jheight@apache.org", "creation_time": "2005-08-23T04:55:43Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "jameisonb@yahoo.com", "attachment_id": 16158, "is_private": false, "id": 78871, "time": "2005-08-23T07:54:03Z", "bug_id": 30008, "creation_time": "2005-08-23T07:54:03Z", "text": "Created attachment 16158\njust load this up in hssf and it will blow up without the suggested fixes"}, {"count": 5, "tags": [], "creator": "jameisonb@yahoo.com", "attachment_id": null, "text": "try reading in the attached .xls. unless something has changed it will blow up\nas described without the fixes described.\n\nis that still too 'limited' or do you need a sample program that will invoke it\nas well?", "id": 78872, "time": "2005-08-23T07:55:42Z", "bug_id": 30008, "creation_time": "2005-08-23T07:55:42Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 30008, "text": "Using HEAD and the latest CVS snapshot the following works for me:\n\n      HSSFWorkbook wb = new HSSFWorkbook(new FileInputStream(new File(\n          \"c:/TestPivot.xls\")));\n      wb.write(new FileOutputStream(new File(\"c:/TestPivot_out.xls\")));\n\nI can even open and use the out file in excel!!\n\nJameison can you please confirm that the above would have previously failed.\n\nJason", "id": 78873, "time": "2005-08-23T08:00:48Z", "creator": "jheight@apache.org", "creation_time": "2005-08-23T08:00:48Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "jheight@apache.org", "text": "I believe that this has been fixed in HEAD. Based on the earlier comments it\nwould explode on read, now it will read and write the workbook without problems.\n\nJason", "count": 7, "id": 78898, "time": "2005-08-24T00:23:24Z", "bug_id": 30008, "creation_time": "2005-08-24T00:23:24Z", "is_private": false}]
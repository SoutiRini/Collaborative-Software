[{"count": 0, "tags": [], "bug_id": 31562, "is_private": false, "text": "The lack of an \"excludes\" parameter in JspC was a major factor in delaying our \nmigration to TC 5.0. Our app build relies on being able to exclude certain jsp \nfiles (reusable static include files) which do not compile out of their \nintended context. Whilst we could get the app to compile by ignoring the \nfailures, the resulting web.xml, as well as being twice the size was also full \nof incorrect mappings.\n\nI've attached the JspC.java patch I use which adds support for an \"excludes\" \nparameter for consideration.\n\nThe \"excludes\" parameter is an ant style comma separated list of paths \nincluding \"*\" and \"**\" wildcards e.g. **/test.jsp,/do_not_include.jsp. This is \nparsed and compiled into a org.apache.regexp.RE which is used to determine \nwhether an individual file is excluded.\n\nAll diffs are against the 5.0.28 release code.\n\nIt creates a dependency with jakarta-regexp and my nieve patch to the \njasper/build.xml is also attached and patches to jasper/resources files in \nEnglish, Spanish and French.", "id": 64672, "time": "2004-10-06T13:05:27Z", "creator": "andrew.chapman@clicktools.com", "creation_time": "2004-10-06T13:05:27Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 31562, "attachment_id": 12954, "text": "Created attachment 12954\nJspC.java against 5.0.28", "id": 64673, "time": "2004-10-06T13:06:32Z", "creator": "andrew.chapman@clicktools.com", "creation_time": "2004-10-06T13:06:32Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 31562, "is_private": false, "text": "Created attachment 12955\nbuild.xml against 5.0.28", "id": 64674, "time": "2004-10-06T13:07:28Z", "creator": "andrew.chapman@clicktools.com", "creation_time": "2004-10-06T13:07:28Z", "attachment_id": 12955}, {"count": 3, "tags": [], "bug_id": 31562, "attachment_id": 12956, "is_private": false, "id": 64675, "time": "2004-10-06T13:08:19Z", "creator": "andrew.chapman@clicktools.com", "creation_time": "2004-10-06T13:08:19Z", "text": "Created attachment 12956\nmesages.properties"}, {"count": 4, "tags": [], "bug_id": 31562, "attachment_id": 12957, "text": "Created attachment 12957\nmessages_es.properties against 5.0.28", "id": 64676, "time": "2004-10-06T13:08:50Z", "creator": "andrew.chapman@clicktools.com", "creation_time": "2004-10-06T13:08:50Z", "is_private": false}, {"count": 5, "tags": [], "text": "Created attachment 12958\nmessages_fr.properties against 5.0.28", "attachment_id": 12958, "id": 64677, "creator": "andrew.chapman@clicktools.com", "time": "2004-10-06T13:09:17Z", "bug_id": 31562, "creation_time": "2004-10-06T13:09:17Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 31562, "is_private": false, "text": "Right. I read it right: \"delaying\".\nHow about customizing just a little the Ant script in the deployer to avoid\ncopying whatever \"JSP\" you have which isn't really a JSP ? Is it so difficult ?\nWhy add complexity for no reason ?\n\n-1 for the proposed changes.", "id": 64678, "time": "2004-10-06T13:14:09Z", "creator": "remm@apache.org", "creation_time": "2004-10-06T13:14:09Z", "attachment_id": null}, {"count": 7, "attachment_id": null, "creator": "andrew.chapman@clicktools.com", "text": "If there is solution with a simple modification to the ant build script, then \nthat suites me perfectly. So far it has eluded me.\n\nThe problem, as I see it, is that the \"include\" files must (obviously) be \npresent and the java/servlet generation and web.xml servlet mapping are \ncoupled in JspC there is no easy way to prevent the include files being \nincluded in the generated web.xml fragment.\n\nWhat simple change to the ant script did you have in mind?\n", "id": 64679, "time": "2004-10-06T13:31:23Z", "bug_id": 31562, "creation_time": "2004-10-06T13:31:23Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "text": "If fined grained ctonrl of jsp compilation is needed, then Ant's  <fileset> or\nother file like mechanisms is needed. (functionality not in JspC.java today and\nI have no desire to create a patch for)\n\nFor example:\n<jasper>\n   <fileset  dir=\"${whateverdir}\">\n     <include name=\"cowbell.jsp\" />\n     <exclude name=\"more.jsp\" />\n   </fileset>\n</jasper>\n\n\nIf you are using ant, there is a property called jspFiles which is a comma\ndelimited list of files to process. See JspC.java for details.\n", "attachment_id": null, "id": 64680, "creator": "funkman@joedog.org", "time": "2004-10-06T13:43:43Z", "bug_id": 31562, "creation_time": "2004-10-06T13:43:43Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 31562, "is_private": false, "text": "If your \"JSP\"s are .jsp files, which should otherwise not be compiled, but are\nactually needed during the compilation phase of your application, then you are\nnot following the specification. There's a special extension for JSP fragments\n(I think it's jspf). If you are in this case, then your fix will work for you,\nbut has no legitimate use case.\n\nIf the files are useful to your webapp, but not during JSP compilation, then\ncopy them just after your compilation. That's what I originally understood from\nyour description, but it can go both ways I suppose.", "id": 64681, "time": "2004-10-06T13:45:48Z", "creator": "remm@apache.org", "creation_time": "2004-10-06T13:45:48Z", "attachment_id": null}, {"count": 10, "tags": [], "text": "You are of course absolutely right. From JSP 2.0 Spec (JSP.1.1.8): \"The .jsp \nextension is used only for files corresponding to top level JSP files,\nforming a JSP page when processed.\n\nStatically included segments use any other extension. As included segments\nwere called \u2018JSP fragments\u2019 in past versions of this specification, the \nextension .jspf was offered as a suggestion. This extension is still suggested \nfor consistency reasons, despite that they are now called \u2018jsp segments\u2019.\"\n\nThe files we exclude in the build are indeed JSP segments/fragments and should \nnot therefore have the .jsp extension.\n\nIt is just unfortunate that we chose to prefix the file names of these files \ninstead of changing the extension. This was done to maintain IDE support \nfor .jsp files.\n\nThanks for your wise words :o)", "attachment_id": null, "id": 64689, "creator": "andrew.chapman@clicktools.com", "time": "2004-10-06T14:31:58Z", "bug_id": 31562, "creation_time": "2004-10-06T14:31:58Z", "is_private": false}]
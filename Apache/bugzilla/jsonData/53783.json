[{"count": 0, "tags": [], "bug_id": 53783, "text": "Created attachment 29283\nExample\n\nHi,\n\nAccording to Servlet Specification, Servlet container should serve static resources and jsp files, located in META-INF/resources in any jar file under WEB-INF/lib.\n\n\"\n10.5  Directory Structure\nA Web application exists as a structured hierarchy of directories. The root of this hierarchy serves as the document root for files that are part of the application. For example, for a Web application with the context path /catalog in a Web container, the index.html file at the base of the Web application hierarchy or in a JAR file inside WEB-INF/lib that includes the index.html under META-INF/resources directory can be served to satisfy a request from /catalog/index.html. If an index.html is present both in the root context and in the META-INF/resources directory of a JAR file in the WEB-INF/lib directory of the application, then the file that is available in the root context MUST be used.\n\"\n\nWhen requesting such static resource/jsp file, Tomcat returns 404 Not Found.\n\nExample is attached.\nRequest:\nhttp://localhost:8080/test-meta-inf-resources/test.jsp\nhttp://localhost:8080/test-meta-inf-resources/meta_inf_resource.jsp\n\nAfter investigating the issue I think that the problem is in the following code:\norg.apache.catalina.startup.ContextConfig\nprotected void processResourceJARs(Set<WebXml> fragments) {\n...\n    if (jar.entryExists(\"META-INF/resources/\")) {\n        context.addResourceJarUrl(url);\n...\n}\n\nWhen I list the entries in jar, I receive:\nINFO: Deploying web application archive C:\\apache-tomcat-7.0.29\\webapps\\test-met\na-inf-resources.war\n META-INF/MANIFEST.MF\n META-INF/resources/meta_inf_resource.jsp\n\nThere is no entry \"META-INF/resources/\"\n\nI would like to propose a patch (attached) with which the request URLs above are working as expected.\n\nBest Regards\nVioleta Georgieva", "id": 161728, "time": "2012-08-27T13:32:16Z", "creator": "violetagg@apache.org", "creation_time": "2012-08-27T13:32:16Z", "is_private": false, "attachment_id": 29283}, {"count": 1, "tags": [], "bug_id": 53783, "text": "Created attachment 29284\nPatch proposal", "id": 161729, "time": "2012-08-27T13:32:45Z", "creator": "violetagg@apache.org", "creation_time": "2012-08-27T13:32:45Z", "is_private": false, "attachment_id": 29284}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "Does specification allow JAR files that do not have directory entries?\n\n1. The \"jar\" tool always creates entries for directories.\nThere are no options to omit them,\n\nhttp://docs.oracle.com/javase/7/docs/technotes/tools/solaris/jar.html\n\n2. The spec says \"in the META-INF/resources directory of a JAR file\".\nThere is no such \"directory\" in this resource.jar.\n\n\nThat said, I am OK with the patch.\n\nFor stream access to a jar file (o.a.t.util.scan.UrlJar) the entryExists() method does such iteration internally, so proposed patch would not slow it down.\n\nFor random access to a jar file (o.a.t.util.scan.FileUrlJar) the ZIP archive index is read when JAR file is opened and iteration over the index (JarFile.entries()) should not waste much time.", "id": 161730, "time": "2012-08-27T14:07:59Z", "bug_id": 53783, "creation_time": "2012-08-27T14:07:59Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 53783, "attachment_id": null, "text": "(In reply to comment #2)\n> Does specification allow JAR files that do not have directory entries?\n> \n> 1. The \"jar\" tool always creates entries for directories.\n> There are no options to omit them,\n> \n\nEclipse IDE is used for jar creation (project type 'java project' and export artifact jar)", "id": 161737, "time": "2012-08-27T17:04:50Z", "creator": "violetagg@apache.org", "creation_time": "2012-08-27T17:04:50Z", "is_private": false}, {"count": 4, "tags": [], "creator": "markt@apache.org", "text": "The JAR spec (nor the ZIP spec) states one way or the other if an entry should be made for a directory - empty or not. On that basis and given the performance impacts described by Konstantin I am OK with this patch.\n\nFixed in trunk and 7.0.x and will be included in 7.0.30 onwards.", "id": 161740, "time": "2012-08-27T18:43:57Z", "bug_id": 53783, "creation_time": "2012-08-27T18:43:57Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "violetagg@apache.org", "text": "Thanks", "id": 161742, "time": "2012-08-27T18:58:35Z", "bug_id": 53783, "creation_time": "2012-08-27T18:58:35Z", "is_private": false, "attachment_id": null}]
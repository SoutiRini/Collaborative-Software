[{"count": 0, "tags": [], "creator": "contact@ruslan.org", "text": "Created attachment 26605\nSimple test web application\n\nI am using web.xml in it simplest, incomlete form (note that making it\n100% Servlet API 3.0 compliant does not help)\n\n<?xml version=\"1.0\" encoding=\"Windows-1251\"?>\n<web-app>\n<!-- below are word testing Testoviy in cyrillic, try to use another symbols -->\n<display-name>\u0422\u0435\u0441\u0442\u043e\u0432\u044b\u0439 web.xml</display-name>\n<servlet>\n<servlet-name>TestJSPMount</servlet-name>\n<jsp-file>/test.jsp</jsp-file>\n</servlet>\n<servlet-mapping>\n<servlet-name>TestJSPMount</servlet-name>\n<url-pattern>/test.html</url-pattern>\n</servlet-mapping>\n</web-app>\n\nDuring startup, tomcat throws exception:\n04/02/2011 16:07:39 S - - StandardContext.loadOnStartup: Servlet\n/testcyrwebxml threw load() exception\ncom.sun.org.apache.xerces.internal.impl.io.MalformedByteSequenceException:\nInvalid byte 2 of 2-byte UTF-8 sequence.\n       at com.sun.org.apache.xerces.internal.impl.io.UTF8Reader.invalidByte(Unknown\nSource)\n       at com.sun.org.apache.xerces.internal.impl.io.UTF8Reader.read(Unknown Source)\n       at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.load(Unknown\nSource)\n       at com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.peekChar(Unknown\nSource)\n       at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(Unknown\nSource)\n       at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(Unknown\nSource)\n       at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(Unknown\nSource)\n       at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown\nSource)\n       at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(Unknown\nSource)\n       at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(Unknown\nSource)\n       at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(Unknown Source)\n       at com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(Unknown Source)\n       at com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(Unknown\nSource)\n       at org.apache.jasper.xmlparser.ParserUtils.parseXMLDocument(ParserUtils.java:96)\n       at org.apache.jasper.compiler.JspConfig.processWebDotXml(JspConfig.java:83)\n       at org.apache.jasper.compiler.JspConfig.init(JspConfig.java:231)\n       at org.apache.jasper.compiler.JspConfig.findJspProperty(JspConfig.java:290)\n       at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:113)\n       at org.apache.jasper.compiler.Compiler.compile(Compiler.java:365)\n       at org.apache.jasper.compiler.Compiler.compile(Compiler.java:345)\n       at org.apache.jasper.compiler.Compiler.compile(Compiler.java:332)\n       at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:594)\n       at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:342)\n       at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:391)\n       at org.apache.jasper.servlet.JspServlet.init(JspServlet.java:128)\n       at org.apache.catalina.core.StandardWrapper.initServlet(StandardWrapper.java:1133)\n       at org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1087)\n       at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:996)\n       at org.apache.catalina.core.StandardContext.loadOnStartup(StandardContext.java:4741)\n       at org.apache.catalina.core.StandardContext$3.call(StandardContext.java:5062)\n       at org.apache.catalina.core.StandardContext$3.call(StandardContext.java:5057)\n       at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source)\n       at java.util.concurrent.FutureTask.run(Unknown Source)\n       at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)\n       at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n       at java.lang.Thread.run(Unknown Source)\n\nPlatform in use:\n\nTomcat 7.0.6 binary windows release\nJDK 1.6.0_18 x86\nWindows 7 x64\n\nIf I change encoding of web.xml to UTF-8 it does not help also.\nThe only fix for this problem is to use only ISO-8859-1 characters.\n\nI believe it is somehow related to some early initialization sequence,\nwhen jsp is mapped as servlet.", "id": 143984, "time": "2011-02-04T09:07:57Z", "bug_id": 50720, "creation_time": "2011-02-04T09:07:57Z", "is_private": false, "attachment_id": 26605}, {"count": 1, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 143985, "time": "2011-02-04T09:12:28Z", "bug_id": 50720, "creation_time": "2011-02-04T09:12:28Z", "is_private": false, "text": "This is caused by the following line in o.a.j.compiler.WebXml.java:\n\nis = new ByteArrayInputStream(webXml.getBytes());\n\nThe above uses system encoding to convert MERGED_WEB_XML from String to byte[].\n\nActually InputStream is not needed there. One should use \"new InputSource(Reader)\"."}, {"count": 2, "tags": [], "bug_id": 50720, "text": "I couldn't repeat this even with either your test case or one of my own. However, I can see the problem the Konstantin has pointed out and I have fixed this in 7.0.x and it will be included in 7.0.9 onwards. If you are able to build 7.0.x from source and confirm that the issue s fixed that would be helpful.", "id": 144152, "attachment_id": null, "creator": "markt@apache.org", "creation_time": "2011-02-10T14:00:54Z", "time": "2011-02-10T14:00:54Z", "is_private": false}, {"count": 3, "tags": [], "creator": "contact@ruslan.org", "text": "> If you are able to build 7.0.x from source and confirm that the issue is \n> fixed that would be  helpful.\n\nJust checked on trunk, revision 1070840. The above test works fine.", "id": 144294, "time": "2011-02-15T06:38:34Z", "bug_id": 50720, "creation_time": "2011-02-15T06:38:34Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 144767, "time": "2011-03-06T01:18:53Z", "bug_id": 50720, "creation_time": "2011-03-06T01:18:53Z", "is_private": false, "text": "*** Bug 50877 has been marked as a duplicate of this bug. ***"}]
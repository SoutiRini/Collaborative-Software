[{"count": 0, "tags": [], "text": "Hi,\nObserved a slow performance when using mod_proxy to access an unresolved IP \naddress. I have setup a web site with the IP address only to test this issue \n(http://65.123.25.70) . This is tested by Apache Windows installation. In \norder to figure out the problem, I have run a debug in the Apache mod_proxy \nsource. The following is what I found:\n\n(1)In 'ap_proxy_host2addr' function in the file \nof 'proxy_util.c', 'gethostbyaddr' function call is slow because of the \nunresolved IP address. \n\n(2)comment out the function 'gethostbyaddr' and set hp=NULL seems fix this \nperformance issue.\n\n(3)I didn't find any reason why we need to call 'gethostbyaddr' here. Further \nanalysis is required.\n\n(4)If we do need to call 'gethostbyaddr', I suggest that we make a new \ndirective to turn on/off this behavior.\n\nregard\nFan", "is_private": false, "id": 16011, "creator": "fan_xia@hotmail.com", "time": "2002-05-13T15:03:52Z", "bug_id": 9037, "creation_time": "2002-05-13T15:03:52Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 9037, "is_private": false, "id": 35429, "creation_time": "2003-04-17T14:45:14Z", "time": "2003-04-17T14:45:14Z", "creator": "federico.mennite@lifeware.ch", "text": "Created attachment 5877\nPatch to make reverse lookups behave as configured in the apache core", "attachment_id": 5877}, {"count": 2, "tags": [], "text": "I confirm the same issue.\nThe real problem here is the dns server not responding timely (slow network,\nslow dns server, broken dns servers ...)\nThe point is to avoid reverse lookups for outgoing connections and maybe in\nother situations when:\na) it's totally unneed\nb) it might be needed but not mandatory to accomplish the task correctly\nAfter a debating a bit on the devel mailing list I've come up with the\npreviously attached patch.\nQuoted text from the mail:\n\nHi,\nas suggested a while back (I've been a bit busy) by members of this list I\nchanged the patch so that mod_proxy respects HostnameLookups when dealing\nreverse lookups.\n\nI'm not happy with it tough, because I had to add an API funtcion to the apache\ncore. Since i'm quite new to apache internals here's a question:\nIs there an alternative path to follow? If not, what about an API function\nsimilar to ap_get_remote_logname() but that instead of returning a string, works\nwith the same kind of parameters of *ap_proxy_host2addr()?\n\nNotes:\n- in proxy_util.c/proxy_match_ipaddr(): the call to ap_proxy_host2addr() has\nbeen forced to reverse lookups indipendently from configuration settings.\nOtherwhise when the parameter for NoProxy is an IP address, it wouldn't have the\nsame matching it had previously. I think tough, it could be made configuration\ndependent.\n- in proxy_util.c/ap_proxy_is_hostname(): the call to ap_proxy_host2addr() has\nbeen forced to NOT perform any reverse lookups. It simply doesn't make sense\nunless I'm missing something.\n- in mod_proxy.c/set_proxy_exclude() and set_cache_exclude(): the calls to\nap_proxy_host2addr() depend on configuration. Probably they could be forced to\nNO reverse lookups.", "attachment_id": null, "id": 35430, "creator": "federico.mennite@lifeware.ch", "time": "2003-04-17T14:46:40Z", "bug_id": 9037, "creation_time": "2003-04-17T14:46:40Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 1649, "text": "When turning on validation in Xerces 1.3.1, the API \nprints out error messages stating for example that \n\"validator for e-dtype not found\" (approx). This only \nhappens if I call the parser from several concurrent \nthreads for some time and appears intermittently. \n\nThe provided example document and DTD will cause \nthis behaviour. Sample Java code to provoke the bug\nis also included. Compile the class and invoke as\n\"java XMLTest <threads> <iterations/thread>\". When\nthreads == 1, no problem is seen. Increase\nthreads to 10 and iterations to 500 and the problem\nshould appear. If not, increase even more.\n\nMy environment:\nXerces 1.3.1, J2SE 1.3 (both client and server JVM),\nNT4SP6 and Solaris 8.0.\n\ntest.dtd: \n=== \n<?xml version='1.0' encoding='UTF-8' ?> \n<!ELEMENT ROOTID (OrderNumber, User)> \n<!ATTLIST ROOTID ProcessCode (BuyOrder) #REQUIRED > \n<!ELEMENT OrderNumber (#PCDATA)> \n<!ATTLIST OrderNumber e-dtype NMTOKEN  #FIXED 'NMTOKEN' > \n<!ELEMENT User (#PCDATA)> \n\ntest.xml \n=== \n<?xml version=\"1.0\"?> \n<!DOCTYPE ROOTID SYSTEM \"file:///dtd/test.dtd\"> \n<ROOTID ProcessCode=\"BuyOrder\"> \n        <OrderNumber>QWE123123</OrderNumber> \n        <User>ABC123</User> \n</ROOTID > \n\nXMLTest.java\n===\nimport java.io.*;\nimport org.xml.sax.*;\nimport org.w3c.dom.*;\n/**\n * Xerces stress parsing bug provoker.\n * @author: Henrik St\u00e5hl\n * @company: Icon Medialab AB\n * @version: 1.0\n */\nclass XMLTest implements Runnable {\n\tprivate static int ITERATIONS = 10;\n\tprivate static int THREADS = 2;\n\tprivate org.apache.xerces.parsers.DOMParser parser = new \norg.apache.xerces.parsers.DOMParser();\npublic static void main(java.lang.String[] args) throws Exception {\n\n\tif (args.length > 0) {\n\t\tTHREADS = (new Integer(args[0])).intValue();\n\t}\n\tif (args.length > 1) {\n\t\tITERATIONS = (new Integer(args[1])).intValue();\n\t}\n\n\tint i = 0;\n\tXMLTest test[] = new XMLTest[THREADS];\n\tThread t[] = new Thread[THREADS];\n\n\tfor (i = 0; i < THREADS; i++) {\n\t\ttest[i] = new XMLTest();\n\t\tt[i] = new Thread(test[i], \"T\" + i);\n\t}\n\n\tfor (i = 0; i < THREADS; i++) {\n\t\tt[i].start();\n\t}\n\n\tfor (i = 0; i < THREADS; i++) {\n\t\tt[i].join();\n\t}\n\n}\npublic void run() {\n\ttry {\n\t\tparser.setFeature(\"http://xml.org/sax/features/validation\", \ntrue);\n\t} catch (Exception e) {\n\t\te.printStackTrace();\n\t\treturn;\n\t}\n\n\tfor (int i = 0; i < ITERATIONS; i++) {\n\t\ttry {\n\t\t\tInputSource input = new InputSource(new FileInputStream\n(\"test.xml\"));\n\t\t\tparser.parse(input);\n\t\t\tDocument doc = parser.getDocument();\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n}\n}", "id": 2305, "time": "2001-05-08T03:42:56Z", "creator": "henrik.stahl@iconmedialab.se", "creation_time": "2001-05-08T03:42:56Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 1649, "is_private": false, "id": 2343, "creation_time": "2001-05-09T00:52:20Z", "time": "2001-05-09T00:52:20Z", "creator": "henrik.stahl@iconmedialab.se", "text": "It turned out that the wrong version of Xerces had been deployed to our\ntest environment (1.1.2!). After updating the test environment to 1.3.1,\nthe problem no longer appears.", "attachment_id": null}]
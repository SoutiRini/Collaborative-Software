[{"count": 0, "tags": [], "text": "Created attachment 24469\nmaven project to build the testcase.\n\nIn the about-to-be-attached test case, the code uses the new JAXP 1.4 APIs that\nare intended to avoid the need for the 'endorsed' mechanism. One can call\n(e.g.)\nXPathFactory.newInstance(\"the name of a class\", aClassloader) to as for a\nspecific implementation.\n\nAll this works fine standalone, and (as it happens) in Jety.\n\nIn tomcat 6.0.20, this leads to the following stacktrace. Note in the\nstacktrace that one piece of Apache Xpath code is looking for a nonexistent\nfunction of another piece and not finding it. \n\nroot cause\n\njava.lang.NoSuchMethodError: org.apache.xpath.XPathContext.<init>(Z)V\n    org.apache.xpath.jaxp.XPathImpl.eval(XPathImpl.java:207)\n    org.apache.xpath.jaxp.XPathImpl.evaluate(XPathImpl.java:281)\n    org.apache.mtomcatbug.Serviette.doGet(Serviette.java:58)\n    javax.servlet.http.HttpServlet.service(HttpServlet.java:617)\n    javax.servlet.http.HttpServlet.service(HttpServlet.java:717)", "attachment_id": 24469, "id": 131656, "creator": "bimargulies@gmail.com", "time": "2009-11-03T17:01:46Z", "bug_id": 48116, "creation_time": "2009-11-03T17:01:46Z", "is_private": false}, {"count": 1, "tags": [], "text": "Note that this test case and entire bug depends on running with JDK 1.6.", "attachment_id": null, "id": 131657, "creator": "bimargulies@gmail.com", "time": "2009-11-03T17:03:26Z", "bug_id": 48116, "creation_time": "2009-11-03T17:03:26Z", "is_private": false}, {"count": 2, "tags": [], "text": "Hate to say this: it works for me. When I could not reproduce an error, I hot-eployed a second copy of the war and tried to other context. It works always:\n\n06.11.2009 09:07:10 org.apache.coyote.http11.Http11Protocol init\nINFO: Initializing Coyote HTTP/1.1 on http-8080\n06.11.2009 09:07:10 org.apache.catalina.startup.Catalina load\nINFO: Initialization processed in 982 ms\n06.11.2009 09:07:10 org.apache.catalina.core.StandardService start\nINFO: Starting service Catalina\n06.11.2009 09:07:10 org.apache.catalina.core.StandardEngine start\nINFO: Starting Servlet Engine: Apache Tomcat/6.0.20\n06.11.2009 09:07:11 org.apache.catalina.startup.HostConfig deployWAR\nINFO: Deploying web application archive classpath-disaster.war\n06.11.2009 09:07:11 org.apache.catalina.startup.HostConfig deployWAR\nINFO: Deploying web application archive classpath-disaster2.war\n06.11.2009 09:07:12 org.apache.coyote.http11.Http11Protocol start\nINFO: Starting Coyote HTTP/1.1 on http-8080\n06.11.2009 09:07:12 org.apache.jk.common.ChannelSocket init\nINFO: JK: ajp13 listening on /0.0.0.0:8009\n06.11.2009 09:07:12 org.apache.jk.server.JkMain start\nINFO: Jk running ID=0 time=0/32  config=null\n06.11.2009 09:07:12 org.apache.catalina.startup.Catalina start\nINFO: Server startup in 1751 ms\n\n06.11.2009 09:07:44 org.apache.catalina.core.ApplicationContext log\nINFO: *GET /a/b/c\n06.11.2009 09:07:45 org.apache.catalina.core.ApplicationContext log\nINFO: *Success\n06.11.2009 09:07:53 org.apache.catalina.core.ApplicationContext log\nINFO: *GET /a/b/c\n06.11.2009 09:07:53 org.apache.catalina.core.ApplicationContext log\nINFO: *Success\n\nJava was 1.6.0_16. Commandline:\n\nC:\\Programme\\Java\\jdk1.6.0_16\\bin\\java \n-Djava.util.logging.config.file=C:\\Programme\\apache-tomcat-6.0.20\\conf\\logging.properties\n-Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager\n-Djava.endorsed.dirs=\"C:\\Programme\\apache-tomcat-6.0.20\\endorsed\"\n-classpath \"C:\\Programme\\Java\\jdk1.6.0_16\\lib\\tools.jar;C:\\Programme\\apache-tomcat-6.0.20bin\\bootstrap.jar\"\n-Dcatalina.base=\"C:\\Programme\\apache-tomcat-6.0.20\" -Dcatalina.home=\"C:\\Programme\\apache-tomcat-6.0.20\" -Djava.io.tmpdir=\"C:\\Programme\\apache-tomcat-6.0.20\\temp\" org.apache.catalina.startup.Bootstrap  start\n\nYou can add -Djaxp.debug=1 and will get more info:\n\nI got the following output for startup and two requests (using two different contexts):\n\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nJAXP: using thread context class loader (WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@18385e3\n) for search\nJAXP: createInstance(org.apache.xerces.jaxp.validation.XMLSchemaFactory)\nJAXP: loaded org.apache.xerces.jaxp.validation.XMLSchemaFactory from null\nJAXP: created new instance of class org.apache.xerces.jaxp.DocumentBuilderFactoryImpl using ClassLoader: WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@18385e3\n\nJAXP: using thread context class loader (WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@18385e3\n) for search\nJAXP: createInstance(org.apache.xpath.jaxp.XPathFactoryImpl)\nJAXP: loaded org.apache.xpath.jaxp.XPathFactoryImpl from null\nJAXP: created new instance of class org.apache.xalan.processor.TransformerFactoryImpl using ClassLoader: WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@18385e3\n\n06.11.2009 09:11:07 org.apache.catalina.startup.HostConfig deployWAR\nINFO: Deploying web application archive classpath-disaster2.war\nJAXP: using thread context class loader (WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@18385e3\n) for search\nJAXP: createInstance(org.apache.xerces.jaxp.validation.XMLSchemaFactory)\nJAXP: loaded org.apache.xerces.jaxp.validation.XMLSchemaFactory from null\nJAXP: created new instance of class org.apache.xerces.jaxp.DocumentBuilderFactoryImpl using ClassLoader: WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@18385e3\n\nJAXP: using thread context class loader (WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@18385e3\n) for search\nJAXP: createInstance(org.apache.xpath.jaxp.XPathFactoryImpl)\nJAXP: loaded org.apache.xpath.jaxp.XPathFactoryImpl from null\nJAXP: created new instance of class org.apache.xalan.processor.TransformerFactoryImpl using ClassLoader: WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@18385e3\n\nJAXP: created new instance of class org.apache.xerces.jaxp.DocumentBuilderFactoryImpl using ClassLoader: WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@18385e3\n\nJAXP: created new instance of class org.apache.xerces.jaxp.DocumentBuilderFactoryImpl using ClassLoader: WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@18385e3", "attachment_id": null, "id": 131756, "creator": "rainer.jung@kippdata.de", "time": "2009-11-06T00:15:03Z", "bug_id": 48116, "creation_time": "2009-11-06T00:15:03Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 48116, "attachment_id": null, "text": "I wonder if this is a gift from Apple somehow. Let me try it on a Linux VM. That would explain why I am the apparent first to run into it.", "id": 131763, "time": "2009-11-06T03:21:29Z", "creator": "bimargulies@gmail.com", "creation_time": "2009-11-06T03:21:29Z", "is_private": false}, {"count": 4, "tags": [], "text": "... and have a look, whether -Djaxp.debug=1 helps to understand ...", "attachment_id": null, "id": 131770, "creator": "rainer.jung@kippdata.de", "time": "2009-11-06T10:56:37Z", "bug_id": 48116, "creation_time": "2009-11-06T10:56:37Z", "is_private": false}, {"count": 5, "tags": [], "creator": "bimargulies@gmail.com", "attachment_id": null, "text": "What does the 'from null' mean in the following fragment from the longer trace below?\n\nJAXP: using thread context class loader (WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@211d0a4f\n) for search\nJAXP: createInstance(org.apache.xpath.jaxp.XPathFactoryImpl)\n[Deprecated] Xalan: org.apache.xpath.jaxp.XPathFactoryImpl\nJAXP: loaded org.apache.xpath.jaxp.XPathFactoryImpl from null\n\n\n\n\n\n\n\nNov 6, 2009 4:53:55 PM org.apache.catalina.startup.Catalina load\nINFO: Initialization processed in 856 ms\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nNov 6, 2009 4:53:55 PM org.apache.catalina.core.StandardService start\nINFO: Starting service Catalina\nNov 6, 2009 4:53:55 PM org.apache.catalina.core.StandardEngine start\nINFO: Starting Servlet Engine: Apache Tomcat/6.0.20\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nJAXP: find factoryId =javax.xml.parsers.SAXParserFactory\nJAXP: loaded from fallback value: com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl\nJAXP: created new instance of class com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl using ClassLoader: null\nNov 6, 2009 4:53:55 PM org.apache.catalina.startup.HostConfig deployWAR\nINFO: Deploying web application archive classpath-disaster.war\nJAXP: using thread context class loader (WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@211d0a4f\n) for search\nJAXP: createInstance(org.apache.xerces.jaxp.validation.XMLSchemaFactory)\nJAXP: loaded org.apache.xerces.jaxp.validation.XMLSchemaFactory from null\nJAXP: created new instance of class org.apache.xerces.jaxp.DocumentBuilderFactoryImpl using ClassLoader: WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@211d0a4f\n\nJAXP: using thread context class loader (WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@211d0a4f\n) for search\nJAXP: createInstance(org.apache.xpath.jaxp.XPathFactoryImpl)\n[Deprecated] Xalan: org.apache.xpath.jaxp.XPathFactoryImpl\nJAXP: loaded org.apache.xpath.jaxp.XPathFactoryImpl from null\nJAXP: created new instance of class org.apache.xalan.processor.TransformerFactoryImpl using ClassLoader: WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@211d0a4f\n\nNov 6, 2009 4:53:57 PM org.apache.coyote.http11.Http11Protocol start\nINFO: Starting Coyote HTTP/1.1 on http-8080\nNov 6, 2009 4:53:57 PM org.apache.jk.common.ChannelSocket init\nINFO: JK: ajp13 listening on /0.0.0.0:8009\nNov 6, 2009 4:53:57 PM org.apache.jk.server.JkMain start\nINFO: Jk running ID=0 time=0/37  config=null\nNov 6, 2009 4:53:57 PM org.apache.catalina.startup.Catalina start\nINFO: Server startup in 2166 ms\nJAXP: created new instance of class org.apache.xerces.jaxp.DocumentBuilderFactoryImpl using ClassLoader: WebappClassLoader\n  delegate: false\n  repositories:\n    /WEB-INF/classes/\n----------> Parent Classloader:\norg.apache.catalina.loader.StandardClassLoader@211d0a4f", "id": 131778, "time": "2009-11-06T13:56:31Z", "bug_id": 48116, "creation_time": "2009-11-06T13:56:31Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 48116, "attachment_id": null, "text": "I've got it from -verbose:class.\n\n[Loaded org.apache.xpath.XPathContext from file:/System/Library/Frameworks/JavaVM.framework/Versions/A/Resources/.compatibility/14compatibility.jar]\n\nThanks, Apple.", "id": 131779, "time": "2009-11-06T13:59:27Z", "creator": "bimargulies@gmail.com", "creation_time": "2009-11-06T13:59:27Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 48116, "text": "JVM issue therefore, not a Tomcat bug.", "id": 132219, "time": "2009-11-22T15:15:29Z", "creator": "markt@apache.org", "creation_time": "2009-11-22T15:15:29Z", "is_private": false, "attachment_id": null}]
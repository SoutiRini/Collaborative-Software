[{"count": 0, "tags": [], "bug_id": 28806, "attachment_id": null, "text": "Im using batik 1.5.1 in a java (build 1.4.2-b28) application to scale and crop \nuser uploaded images by including them as an <image> tag within an svg graphic,\n\nI have discovered that an animated gif hangs the transcode(TranscoderInput, \nFileOutputStream) method of the JPEGTranscoder. Non-animated gif images appear \nto cause no problems, nor to jpegs in the source  svg file, but any animated \ngif included in the source svg file causes the application to hang. No error is \nthrown, the app just halts, suspending the command line it was called from.\nbelow is the line copied direcly from the sample SaveAsJpeg class from the \nbatik examples : below that is a simple svg file i used to reproduce the error \nin isolation from my app\n\ncode sample: \n-----------------------------------------------\n       JPEGTranscoder t = new JPEGTranscoder();\n        t.addTranscodingHint(JPEGTranscoder.KEY_QUALITY, new Float(.8));\n        String svgURI = new File(args[0]).toURL().toString();\n        TranscoderInput input = new TranscoderInput(svgURI);\n        OutputStream ostream = new FileOutputStream(\"out.jpg\");\n        TranscoderOutput output = new TranscoderOutput(ostream);\n        \n        // this is where it hangs\n        t.transcode(input, output);\n----------------------------------------------\n\n svg sample: (gif on second-from-last line )\n\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 20000303 \nStylable//EN\"  \"http://www.w3.org/TR/2000/03/WD-SVG-20000303/DTD/svg-20000303-\nstylable.dtd\" >\n\n<svg width=\"155\" height=\"110\">\n<image xlink:href=\"animated.gif\" x=\"0\" y=\"0\" width=\"190\" height=\"150\" />\n</svg>", "id": 56925, "time": "2004-05-06T13:02:21Z", "creator": "john@johntheother.com", "creation_time": "2004-05-06T13:02:21Z", "is_private": false}, {"count": 1, "tags": [], "creator": "deweese@apache.org", "attachment_id": null, "id": 62773, "time": "2004-08-30T11:48:57Z", "bug_id": 28806, "creation_time": "2004-08-30T11:48:57Z", "is_private": false, "text": "Can you provide a sample animated gif to go with the sample SVG?\n(Bugzilla supports 'attachments'."}, {"count": 2, "tags": [], "creator": "deweese@apache.org", "text": "Reassigning all open bugs to the development list.\nSorry for the mass mailing.", "id": 40392, "time": "2005-03-22T12:16:01Z", "bug_id": 28806, "creation_time": "2005-03-22T12:16:01Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "gareth-hunt@rocketmail.com", "text": "Created attachment 24262\nExample animated gif, also available here: http://www.iconator.com/banners/iconator88.gif", "id": 130386, "time": "2009-09-14T11:03:41Z", "bug_id": 28806, "creation_time": "2009-09-14T11:03:41Z", "is_private": false, "attachment_id": 24262}, {"count": 4, "tags": [], "bug_id": 28806, "attachment_id": null, "id": 130387, "time": "2009-09-14T11:06:34Z", "creator": "gareth-hunt@rocketmail.com", "creation_time": "2009-09-14T11:06:34Z", "is_private": false, "text": "Setting bug to NEW as example animated gif has been attached."}, {"count": 5, "tags": [], "creator": "kujawa.cezary@consileon.pl", "text": "Created attachment 26880\na patch", "id": 145745, "time": "2011-04-13T10:16:48Z", "bug_id": 28806, "creation_time": "2011-04-13T10:16:48Z", "is_private": false, "attachment_id": 26880}, {"count": 6, "tags": [], "creator": "kujawa.cezary@consileon.pl", "text": "Created attachment 26881\nsource file for test", "id": 145746, "time": "2011-04-13T10:17:24Z", "bug_id": 28806, "creation_time": "2011-04-13T10:17:24Z", "is_private": false, "attachment_id": 26881}, {"count": 7, "tags": [], "bug_id": 28806, "attachment_id": 26882, "text": "Created attachment 26882\nreference file for test", "id": 145747, "time": "2011-04-13T10:18:01Z", "creator": "kujawa.cezary@consileon.pl", "creation_time": "2011-04-13T10:18:01Z", "is_private": false}, {"count": 8, "tags": [], "creator": "kujawa.cezary@consileon.pl", "attachment_id": null, "id": 145748, "time": "2011-04-13T10:24:12Z", "bug_id": 28806, "creation_time": "2011-04-13T10:24:12Z", "is_private": false, "text": "I attached a patch proposed and two binary (test source and reference) files. I think that none of infoflags that wake waiting thread is passed to the ImageObserver in case of animated GIF. Waking it on java.awt.image.ImageObserver.FRAMEBITS prevents from hanging."}]
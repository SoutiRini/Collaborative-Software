[{"count": 0, "tags": [], "text": "The following code, around line 375 of server/request.c, contains an error  \nthat may lead to failures in SymlinksIfOwnerMatch on some platforms: \n    \n  /* OPT_SYM_OWNER only works if we can get the owner of     \n   * both the file and symlink.  First fill in a missing     \n   * owner of the symlink, then get the info of the target.     \n   */     \n  if (!(lfi->valid & APR_FINFO_OWNER)) {     \n      if ((res = apr_stat(&fi, d,      \n                          lfi->valid | APR_FINFO_LINK | APR_FINFO_OWNER, p))     \n          != APR_SUCCESS) {     \n          return HTTP_FORBIDDEN;     \n      }     \n  }     \n     \n  if ((res = apr_stat(&fi, d, lfi->valid & ~(APR_FINFO_NAME), p))     \n      != APR_SUCCESS) {     \n      return HTTP_FORBIDDEN;     \n  }     \n     \n  if (apr_uid_compare(fi.user, lfi->user) != APR_SUCCESS) {     \n      return HTTP_FORBIDDEN;     \n  }     \n    \nThe apr_stat calls are supposed to set lfi->user and fi.user so they can be   \ncompared. However, they're both operating on &fi, meaning that lfi->user   \ndoesn't get set. \n     \nOn platforms where FINFO_OWNER isn't already valid when we reach this code \n(including Win32, according to William A. Rowe, Jr.), lfi->user could be \nrandom junk when compared, likely leading to a incorrect HTTP_FORBIDDEN result \n(and perhaps the small possibility of an incorrect OK result).  \n    \nThe first apr_stat() call should set lfi instead of &fi:  \n    \n  if (!(lfi->valid & APR_FINFO_OWNER)) {     \n      if ((res = apr_stat(lfi, d,", "is_private": false, "bug_id": 36783, "id": 80370, "time": "2005-09-23T15:58:54Z", "creator": "rob-apache.org.bugs@tigertech.net", "creation_time": "2005-09-23T15:58:54Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "rob-apache.org.bugs@tigertech.net", "attachment_id": 16500, "id": 80371, "time": "2005-09-23T16:01:41Z", "bug_id": 36783, "creation_time": "2005-09-23T16:01:41Z", "is_private": false, "text": "Created attachment 16500\nPatch for trunk\n\nThis patch is for the version of request.c in the 2.2 trunk."}, {"count": 2, "tags": [], "bug_id": 36783, "attachment_id": 16501, "id": 80372, "time": "2005-09-23T16:03:58Z", "creator": "rob-apache.org.bugs@tigertech.net", "creation_time": "2005-09-23T16:03:58Z", "is_private": false, "text": "Created attachment 16501\nPatch for 2.0.x\n\nThis patch is for the 2.0.x series."}, {"count": 3, "tags": [], "text": "Out of interest, what platform triggered this?  My testing never hits the code path you fixed, 'cos the test \"if (!(lfi->valid & APR_FINFO_OWNER)) {\" fails.\n\nAnyway, fixed in trunk in r632947 - thanks.", "attachment_id": null, "id": 114182, "creator": "nick@webthing.com", "time": "2008-03-02T22:37:46Z", "bug_id": 36783, "creation_time": "2008-03-02T22:37:46Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 36783, "attachment_id": null, "is_private": false, "id": 114267, "time": "2008-03-04T11:53:07Z", "creator": "rob-apache.org.bugs@tigertech.net", "creation_time": "2008-03-04T11:53:07Z", "text": "(In reply to comment #3)\n> Out of interest, what platform triggered this?  My testing never hits the code\n> path you fixed, 'cos the test \"if (!(lfi->valid & APR_FINFO_OWNER)) {\" fails.\n\nThe bug doesn't happen on my platform (Linux); I caught it just by looking at the code while making an unrelated change to how FollowSymLinks works on our copy of Apache.\n\nBut according to this post, it might happen on Win32:\n\nhttp://mail-archives.apache.org/mod_mbox/httpd-dev/200509.mbox/<43339114.3060705%40rowe-clan.net>\n\n\n> Anyway, fixed in trunk in r632947\n\nThanks!\n"}, {"count": 5, "tags": [], "bug_id": 36783, "attachment_id": null, "id": 138565, "time": "2010-07-20T09:41:44Z", "creator": "nick@webthing.com", "creation_time": "2010-07-20T09:41:44Z", "is_private": false, "text": "*** Bug 29647 has been marked as a duplicate of this bug. ***"}, {"count": 6, "tags": [], "bug_id": 36783, "attachment_id": null, "is_private": false, "id": 149388, "time": "2011-09-17T15:47:34Z", "creator": "sf@sfritsch.de", "creation_time": "2011-09-17T15:47:34Z", "text": "2.2.17 / r989124"}]
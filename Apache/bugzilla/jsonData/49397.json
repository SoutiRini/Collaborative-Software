[{"count": 0, "tags": [], "creator": "united_zele_3@hotmail.com", "attachment_id": 25538, "id": 137406, "time": "2010-06-07T02:43:56Z", "bug_id": 49397, "creation_time": "2010-06-07T02:43:56Z", "is_private": false, "text": "Created attachment 25538\nthe excel file\n\nHi,\n\nOverview:\nI have a problem that when i read in an excel file and evaluate a function, he always returns the value 0.\n\nI attached the excel file. It has 2 sheets. The first sheet is \"Bereik\" and the second sheet is \"Meetnet\". In the sheet \"Meetnet\" in the second column i need this function that refers to the first sheet to know the intern id for the selected \"Bereik\" in \"Meetnet\".\n\nReproduce:\nI attached a txt file with the code to reproduce the problem. I'm sorry but i couldn't do more because of the lack of time her at work.\n\nExpected result:\nThe program should return the iternal id's of \"Bereik\". For example when the first column in \"Meetnet\" is \"Europees\" then the second column in \"Meetnet\" should have the value 3 because that's the id of \"Europees\" in the sheet \"Bereik\".\n\nThe problem accured on Windows 7 instead of Windows Vista."}, {"count": 1, "tags": [], "bug_id": 49397, "attachment_id": null, "id": 137407, "time": "2010-06-07T02:44:48Z", "creator": "united_zele_3@hotmail.com", "creation_time": "2010-06-07T02:44:48Z", "is_private": false, "text": "i couldn't upload the code file, so here is it:\n\n\nFile file = new File(path to file);\nInputStream is = new FileInputStream(file);\nHSSFWorkbook wb = new HSSFWorkbook(is);\nHSSFFormulaEvaluator formulaEvaluator = new HSSFFormulaEvaluator(wb);\n\nint countSheets = wb.getNumberOfSheets();\nfor (int i = 0; i < countSheets - 1; i++) {\n\tHSSFSheet sheet = wb.getSheetAt(i);\n\tString name = sheet.getSheetName().split(\"\\\\-\")[1];\n\tif (name.equals(\"MEETNET\") {\n\t\tint countRows = sheet.getPhysicalNumberOfRows();\n\t\tfor (int i = 1; i < countRows; i++) {\n\t\t\tInteger internId = null;\n\t\t\tInteger internBereikId = null;\n\t\t\tfor (int j = 0; j <countCells; j++) {\n\t\t\t\tHSSFCell cell = row.getCell(j);\n\t\t\t\t\n\t\t\t\tif (j == 1) {\n\t\t\t\t\tif (cell.getCellType() == HSSFCell.CELL_TYPE_FORMULA) {\n\t\t\t\t\t\tinternBereikId = formulaEvaluator.evaluateFormulaCell(cell);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}"}, {"count": 2, "tags": [], "creator": "chris.pijl@cofely.nl", "attachment_id": null, "id": 137648, "time": "2010-06-15T05:29:13Z", "bug_id": 49397, "creation_time": "2010-06-15T05:29:13Z", "is_private": false, "text": "I've got the same problem :\n\n<poi:cell NumberFormat=\"0\" type=\"formula\" value=\"COUNTA(A8:A#CurrentDataLine-2#)\" index=\"#5+I#\" />\n\nIt shows =COUNTA(A8:A354) in the cell, but the result is 1.\nAfter giving an Enter in de formulabar the 1 turns into 347..."}, {"count": 3, "tags": [], "creator": "yegor@dinom.ru", "text": "You are using a wrong method to retrieve results.\n\nFormulaEvaluator#evaluateFormulaCell evaluates the formula and returns the type of the formula result, not the result itself. In your case it returned 0 which corresponds to Cell.CELL_TYPE_NUMERIC, that is the result of formula was number.\n\nUse FormulaEvaluator#evaluate to get the result. The code below worked fine to me:\n\n        HSSFWorkbook wb = new HSSFWorkbook(new FileInputStream(inputFile));\n        HSSFFormulaEvaluator formulaEvaluator = new HSSFFormulaEvaluator(wb);\n        HSSFSheet sheet = wb.getSheet(\"20-MEETNET\");\n\n        for (int i = 1; i <= sheet.getLastRowNum(); i++) {\n            HSSFRow row = sheet.getRow(i);\n            HSSFCell cell = row.getCell(1);\n            CellValue val = formulaEvaluator.evaluate(cell);\n            int internBereikId = (int)val.getNumberValue();\n            System.out.println(i + \": \" + internBereikId);\n        }\n\nYegor", "id": 138721, "time": "2010-07-29T02:29:06Z", "bug_id": 49397, "creation_time": "2010-07-29T02:29:06Z", "is_private": false, "attachment_id": null}]
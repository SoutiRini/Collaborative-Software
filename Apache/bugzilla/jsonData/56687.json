[{"count": 0, "tags": [], "bug_id": 56687, "text": "Created attachment 31775\npatch: copy source_address in ap_proxy_connect_to_backend\n\nWhen I use ProxySourceAddress together with mod_proxy_connect to proxy https connections I get occasional error messages in error_log like:\n\n[proxy:error] [pid 8703:tid 139730268100352] (98)Address already in use: [client 192.168.1.192:50519] AH00938: CONNECT: failed to bind socket to local address\n\nand the ProxySourceAddress for that request is ignored.\n\nThe cause seems to be that ap_proxy_connect_to_backend (called by mod_proxy_connect) calls apr_socket_bind with conf->source_address directly passed as argument, so the selected local port is stored in conf->source_address and used in subsequent binds. This fails if that port is still in use.\n\nThe function ap_proxy_connect_backend (used by mod_proxy_http) makes a copy of conf->source_address before passing it to apr_socket_bind, and when I tried that for ap_proxy_connect_to_backend the problem disappeared (see patch).", "id": 176126, "time": "2014-07-01T09:38:01Z", "creator": "apache@arbruijn.dds.nl", "creation_time": "2014-07-01T09:38:01Z", "is_private": false, "attachment_id": 31775}, {"count": 1, "tags": [], "bug_id": 56687, "attachment_id": null, "id": 181140, "time": "2015-02-18T14:40:39Z", "creator": "frantisek.repkovsky@gmail.com", "creation_time": "2015-02-18T14:40:39Z", "is_private": false, "text": "We experience the same issue with Apache 2.4.10. When this will be fixed in Apache 2.4, please?"}, {"count": 2, "attachment_id": null, "bug_id": 56687, "text": "As a workaround for this bug, you can add the following to your Apache config:\n\nMaxRequestsPerChild 1\n\nThis will create a new process for each request, with a fresh conf->source_address. \n\nOf course this will hurt performance!", "id": 183767, "time": "2015-06-26T14:26:42Z", "creator": "apache.org@augusteijn.com", "creation_time": "2015-06-26T14:26:42Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "text": "I have used Arne's patch posted previously with the bug report and it seems to be working fine. thanks Arne!\n\nThanks Robert for workaround too.\n\nI hope, once this bug will be solved officially in some next release of Apache...", "attachment_id": null, "id": 184564, "creator": "frantisek.repkovsky@gmail.com", "time": "2015-08-14T07:28:20Z", "bug_id": 56687, "creation_time": "2015-08-14T07:28:20Z", "is_private": false}, {"text": "Thanks, committed in r1703902.", "tags": [], "creator": "ylavic.dev@gmail.com", "attachment_id": null, "count": 4, "id": 185345, "time": "2015-09-18T16:44:21Z", "bug_id": 56687, "creation_time": "2015-09-18T16:44:21Z", "is_private": false}, {"text": "Backport proposed to 2.4.x in r1703903.", "tags": [], "creator": "ylavic.dev@gmail.com", "attachment_id": null, "count": 5, "id": 185346, "time": "2015-09-18T16:58:13Z", "bug_id": 56687, "creation_time": "2015-09-18T16:58:13Z", "is_private": false}, {"text": "This is part of 2.4.17", "tags": [], "creator": "christophe.jaillet@wanadoo.fr", "attachment_id": null, "count": 6, "id": 185919, "time": "2015-10-25T05:45:10Z", "bug_id": 56687, "creation_time": "2015-10-25T05:45:10Z", "is_private": false}]
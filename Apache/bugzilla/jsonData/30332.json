[{"count": 0, "tags": [], "bug_id": 30332, "is_private": false, "id": 61152, "attachment_id": null, "creator": "peilinz@hotmail.com", "creation_time": "2004-07-26T21:51:22Z", "time": "2004-07-26T21:51:22Z", "text": "We are still having problems with response content-type to have \";charset=UTF-8\"\nautomatically attached even though we explicitly called\nHttpServletResponse.setContentType(\"application/pdf\") and never called\nsetCharacterEncoding() in the same request. As a matter of fact, after putting\nsome debugging code in org.apache.coyote.Response.setCharacterEncoding(), I\nfound out it was never called in the request that we use to send the PDF file.\nThe debugging also showed that the member variable \"charsetSet\" was true before\nsetContentType() was called. Therefore, I suspect the recycle()/reset() method\nin this class wasn't called when it needs to be called. On the other hand, does\nit make sense to add \"charsetSet = false;\" at the beginning of the\nsetContentType() method?"}, {"count": 1, "tags": [], "bug_id": 30332, "text": "A simple test case works for me and a check with telnet comfirms that the \nheader is as expected.\n\nCan you provide a simple test case, perferably as a ready to deploy war, that \nexhibits this behaviour?\n", "id": 61155, "time": "2004-07-26T23:01:46Z", "creator": "markt@apache.org", "creation_time": "2004-07-26T23:01:46Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "Created attachment 12244\nA test web app that shows the problem", "is_private": false, "id": 61194, "creation_time": "2004-07-27T20:19:13Z", "time": "2004-07-27T20:19:13Z", "creator": "peilinz@hotmail.com", "bug_id": 30332, "attachment_id": 12244}, {"count": 3, "attachment_id": null, "bug_id": 30332, "is_private": false, "id": 61195, "time": "2004-07-27T20:22:14Z", "creator": "peilinz@hotmail.com", "creation_time": "2004-07-27T20:22:14Z", "tags": [], "text": "I have uploaded a WAR file that shows the problem when deployed.\nThe index.jsp page describes the problem.\n(Couldn't figure out what mime-type to choose for the WAR file, so it ended with\nwith application/octet-stream.)"}, {"count": 4, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "is_private": false, "id": 61200, "time": "2004-07-27T21:17:18Z", "bug_id": 30332, "creation_time": "2004-07-27T21:17:18Z", "text": "You have explictly set the characterEncoding on the response (or, rather, told \nstruts to do it for you), so the servlet spec requires that Tomcat sends this \ninformation.\n\nYou need to call response.reset() before response.setContentType to clear the \ncharacterEncoding."}, {"count": 5, "tags": [], "creator": "peilinz@hotmail.com", "attachment_id": null, "text": "It makes a lot of sense to me now.\nThanks a lot for the reply.", "id": 61201, "time": "2004-07-27T21:43:40Z", "bug_id": 30332, "creation_time": "2004-07-27T21:43:40Z", "is_private": false}]
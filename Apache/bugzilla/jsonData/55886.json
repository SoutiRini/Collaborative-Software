[{"count": 0, "tags": [], "creator": "_lek@inbox.ru", "attachment_id": null, "id": 171752, "time": "2013-12-15T13:54:21Z", "bug_id": 55886, "creation_time": "2013-12-15T13:54:21Z", "is_private": false, "text": "I use Apache 2.4 with mod_realip and it works fine for custom_log - with LogFormat modifier %a i get user IP in access_log from nginx X-Real-IP HTTP header. But on status page i see nginx proxy address 127.0.0.1\n\nIn config i have:\nRemoteIPHeader X-Real-IP\nRemoteIPInternalProxy 127.0.0.0/8 ::1 \n<Location /server-status>\n    SetHandler server-status\n    Require host 127.0.0.1\n</Location>\n\nI spent about half of a day to find a solution but with no success. Some people tried to use ported mod_praf for 2.4, some did not find any solution.\n\nhttp://www.gossamer-threads.com/lists/apache/users/426859"}, {"count": 1, "tags": [], "bug_id": 55886, "text": "Okay, I did some research on this.\n\nFirst of all, I get the same results in httpd trunk.\n\nThe timing between logging and mod_status appears to be okay.\nBut the two modules are taking information from two different locations.\n\nmod_status is getting the client information from the \"client\" field in the scoreboard record.\nThe \"client\" field in the scoreboard record is updated in update_child_status_internal() in server/scoreboard.c by calling ap_get_remote_host().\n\nBut as for the logging format fields:\n%a comes from request->useragent_ip\n%{c}a comes from request->connection->client_ip\n%h comes from ap_get_remote_host()\n\nSo according to the code what you see in the %h field in the log is what you will see in the client fields in the server_status page.\n\nBut this disagrees with what I see in the mod_remoteip documentation:\n- http://httpd.apache.org/docs/trunk/mod/mod_remoteip.html\n\"Once replaced as instructed, this overridden useragent IP address is then used for the mod_authz_host <Require ip> feature, is reported by mod_status, and is recorded by mod_log_config %a and core %a format strings. The underlying client IP of the connection is available in the %{c}a format string.\"\n\nSo either the documentation should be changed or update_child_status_internal() should be using request->useragent_ip to update the \"client\" field.", "id": 172068, "time": "2014-01-03T17:11:06Z", "creator": "mike.rumph@oracle.com", "creation_time": "2014-01-03T17:11:06Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "Any news about the issue?", "attachment_id": null, "id": 174525, "creator": "phpfpm1@gmail.com", "time": "2014-04-13T10:51:39Z", "bug_id": 55886, "creation_time": "2014-04-13T10:51:39Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 55886, "attachment_id": 31706, "text": "Created attachment 31706\nRecord useragent IP in scoreboard", "id": 175764, "time": "2014-06-11T10:27:27Z", "creator": "apache-b6e@deemzed.uk", "creation_time": "2014-06-11T10:27:27Z", "is_private": false}, {"count": 4, "tags": [], "creator": "apache-b6e@deemzed.uk", "attachment_id": null, "id": 175765, "time": "2014-06-11T10:30:15Z", "bug_id": 55886, "creation_time": "2014-06-11T10:30:15Z", "is_private": false, "text": "I've also noticed this - a simple solution is to record the useragent instead of connection IP in the scoreboard, although it may not be the behaviour expected or desired by everyone."}, {"count": 5, "tags": [], "bug_id": 55886, "attachment_id": null, "text": "It's fixed in trunk now: https://github.com/apache/httpd/commit/4587109ba9396e5581c66f8fa8db2fd80a809313#diff-4daad1c6042697da3da10556cbc8615f", "id": 177797, "time": "2014-09-12T10:35:53Z", "creator": "phpfpm1@gmail.com", "creation_time": "2014-09-12T10:35:53Z", "is_private": false}, {"count": 6, "attachment_id": null, "creator": "ylavic.dev@gmail.com", "text": "Reopening until backported to 2.4.x.", "id": 177822, "time": "2014-09-12T17:26:34Z", "bug_id": 55886, "creation_time": "2014-09-12T17:26:34Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "ylavic.dev@gmail.com", "attachment_id": null, "id": 180522, "time": "2015-01-23T10:17:36Z", "bug_id": 55886, "creation_time": "2015-01-23T10:17:36Z", "is_private": false, "text": "Backported to 2.4.11 in r1627744."}]
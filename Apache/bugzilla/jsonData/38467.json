[{"count": 0, "tags": [], "bug_id": 38467, "attachment_id": null, "is_private": false, "id": 85269, "time": "2006-01-31T18:48:26Z", "creator": "chsalvia@gmail.com", "creation_time": "2006-01-31T18:48:26Z", "text": "Using Debian 2.6, Apache 2.2.0 and gcc 4.0.2, I am unable to output wide\ncharacters of a non-ASCII type through Apache using a CGI script written in C++.\n\nTo reproduce this problem, use the following source code:\n\n#include <iostream>\nusing namespace std;\n\nint main()\n{\n\tsetlocale(LC_ALL, \"\");\n\twcout << L\"Content-Type: text/html; charset=UTF-8\" << endl << endl;\t\n\twcout << L\"aaaa \u00c3 \u00c6 \u00c7 \u00f1\" << endl;\n\treturn 0;\n}\n\nI compile this as: \n\n$ g++ test.cpp -otest.cgi\n\nWhen I execute this program on the console, I get the following (correct) output:\n\naaaa \u00c3 \u00c6 \u00c7 \u00f1\n\nAdditionally, if I output this code to an html file (locally) by typing\n\n$ ./test.cgi > result.htm\n\nThe browser displays the following (correct) output:\n\naaaa \u00c3 \u00c6 \u00c7 \u00f1\n\nHowever, if I run this program as a CGI \"script\" through Apache on a localhost,\nI get the following (INcorrect) output:\n\naaaa ? AE ? ?"}, {"attachment_id": null, "tags": [], "bug_id": 38467, "is_private": false, "count": 1, "id": 99821, "time": "2007-02-26T17:36:18Z", "creator": "basant.kukreja@sun.com", "creation_time": "2007-02-26T17:36:18Z", "text": "I was able to reproduce the issue. I think \"apache\" behavior is correct.\nHere is my experiment :\n\n#include <iostream>\n#include <fstream>\n#include <stdlib.h>\n#include <unistd.h>\nusing namespace std;\n\n\nint main()\n{\n\tsetlocale(LC_ALL, \"\");\n\twcout << L\"Content-Type: text/html; charset=UTF-8\" << endl << endl;\t\n\n\twcout << L\"aaaa \u00c3\u00bf \u00c3\u00bf \u00c3\u00bf \u00c3\u00b1\" << endl;\n    system(\"locale\");\n\treturn 0;\n}\n\nI modified your sample a bit and added system call to figure out what was the\nlocale.\nI got the output similar to you \n\nHTTP/1.1 200 OK\nDate: Tue, 27 Feb 2007 00:59:43 GMT\nServer: Apache/2.2.5-dev (Unix) mod_ssl/2.2.5-dev OpenSSL/0.9.8a DAV/2 SVN/1.4.3\nmod_perl/2.0.4-dev Perl/v5.8.8\nContent-Length: 293\nContent-Type: text/html; charset=UTF-8\n\nenviron = 0xbff5613c\nwrite error\naaaa ? ? ? ?\nLANG=\nLC_CTYPE=\"POSIX\"\nLC_NUMERIC=\"POSIX\"\nLC_TIME=\"POSIX\"\nLC_COLLATE=\"POSIX\"\nLC_MONETARY=\"POSIX\"\nLC_MESSAGES=\"POSIX\"\nLC_PAPER=\"POSIX\"\nLC_NAME=\"POSIX\"\nLC_ADDRESS=\"POSIX\"\nLC_TELEPHONE=\"POSIX\"\nLC_MEASUREMENT=\"POSIX\"\nLC_IDENTIFICATION=\"POSIX\"\nLC_ALL=\n\nSince the locale is set to POSIX so C++ application prints ?.\n\nNow set the locale to en_US for cgi-bin and restart apache.\n\n<Directory \"/disk/apache/apache2/cgi-bin\">\n    SetEnv LANG \"en_US\"\n    AllowOverride None\n    Options None\n    Order allow,deny\n    Allow from all\n</Directory>\n\nI got the right output :\n\nHTTP/1.1 200 OK\nDate: Tue, 27 Feb 2007 01:05:44 GMT\nServer: Apache/2.2.5-dev (Unix) mod_ssl/2.2.5-dev OpenSSL/0.9.8a DAV/2 SVN/1.4.3\nmod_perl/2.0.4-dev Perl/v5.8.8\nContent-Length: 265\nContent-Type: text/html; charset=UTF-8\n\naaaa \u00ff \u00ff \u00ff \u00f1\nLANG=en_US\nLC_CTYPE=\"en_US\"\nLC_NUMERIC=\"en_US\"\nLC_TIME=\"en_US\"\nLC_COLLATE=\"en_US\"\nLC_MONETARY=\"en_US\"\nLC_MESSAGES=\"en_US\"\nLC_PAPER=\"en_US\"\nLC_NAME=\"en_US\"\nLC_ADDRESS=\"en_US\"\nLC_TELEPHONE=\"en_US\"\nLC_MEASUREMENT=\"en_US\"\nLC_IDENTIFICATION=\"en_US\"\nLC_ALL=\n\n\nIf you setup the locale to POSIX on shell and run the cgi script,\nyou will see the same output (question marks)\n\nCharles, can you confirm the issue. I will wait for your response before\nmaking the bug as invalid.\n\nI think the bug is invalid and if there is a bug then it is in C++ runtime."}, {"count": 2, "tags": [], "creator": "chsalvia@gmail.com", "text": "Basant, thank you for your reply.  Yes you are correct - the locale was set to\nPOSIX.  Changing the locale to en_US fixes the problem.  The bug report is invalid.", "id": 99823, "time": "2007-02-26T18:13:54Z", "bug_id": 38467, "creation_time": "2007-02-26T18:13:54Z", "is_private": false, "attachment_id": null}]
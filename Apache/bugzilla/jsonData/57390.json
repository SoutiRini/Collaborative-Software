[{"count": 0, "tags": [], "bug_id": 57390, "attachment_id": null, "id": 179970, "time": "2014-12-22T18:28:37Z", "creator": "vitavaque@gmail.com", "creation_time": "2014-12-22T18:28:37Z", "is_private": false, "text": "Consider following simple example:\n\n        HSSFWorkbook wb = new HSSFWorkbook();\n        HSSFRow row = wb.createSheet().createRow(0);\n        row.createCell(0).setCellValue(\"09\");\n        row.createCell(1).setCellFormula(\"MATCH(TRIM(A1),{\\\"09\\\"},0)\");\n        try (FileOutputStream fos = new FileOutputStream(\"match_test_poi.xls\"))\n        {\n            wb.write(fos);\n        }\n\nResulting file will contain formula MATCH(TRIM(A1),{\"09\"},0) in B1. When this file is opened in MS Excel 2007/2010 it results in \"File error: data may have been lost\". Then in B1 there is a \"=#N/A\" value. FYI, same file opens just fine in OpenOffice.\n\nI have checked poi 3.6 and latest poi 3.11. Both version have this issue.\n\nAny help appreciated."}, {"count": 1, "tags": [], "bug_id": 57390, "attachment_id": null, "is_private": false, "id": 179971, "time": "2014-12-22T18:34:03Z", "creator": "vitavaque@gmail.com", "creation_time": "2014-12-22T18:34:03Z", "text": "Same example with XSSF works just fine:\n\n        XSSFWorkbook wb = new XSSFWorkbook();\n        XSSFRow row = wb.createSheet().createRow(0);\n        row.createCell(0).setCellValue(\"09\");\n        row.createCell(1).setCellFormula(\"MATCH(TRIM(A1),{\\\"09\\\"},0)\");\n        try (FileOutputStream fos = new FileOutputStream(\"match_test_poi.xlsx\"))\n        {\n            wb.write(fos);\n        }"}, {"count": 2, "tags": [], "bug_id": 57390, "attachment_id": null, "id": 179988, "time": "2014-12-23T01:34:10Z", "creator": "apache@gagravarr.org", "creation_time": "2014-12-23T01:34:10Z", "is_private": false, "text": "Does it work if you re-do it without an array reference?\n\nIIRC, there was some work done on array formulas a year or two back, but it stalled before completing as the community provided patch needed more work and no-one volunteered to finish it :/"}, {"text": "Thanks for your answer.\n\nI am not sure what you meant, but I have tried putting formula MATCH(TRIM(A1),A1:A1,0) in same example and it works just fine. So, what can I do with array? I would appreciate if you can point me to these issue(s) with patch. Maybe I can finish them and contribute it to POI project.", "tags": [], "bug_id": 57390, "attachment_id": null, "count": 3, "id": 179992, "time": "2014-12-23T10:17:07Z", "creator": "vitavaque@gmail.com", "creation_time": "2014-12-23T10:17:07Z", "is_private": false}, {"count": 4, "tags": [], "creator": "vitavaque@gmail.com", "attachment_id": null, "id": 179996, "time": "2014-12-23T13:26:47Z", "bug_id": 57390, "creation_time": "2014-12-23T13:26:47Z", "is_private": false, "text": "I guess you are talking about https://issues.apache.org/bugzilla/show_bug.cgi?id=48292, is that right?"}, {"count": 5, "tags": [], "bug_id": 57390, "attachment_id": null, "is_private": false, "id": 180008, "time": "2014-12-24T03:43:27Z", "creator": "apache@gagravarr.org", "creation_time": "2014-12-24T03:43:27Z", "text": "That's the bug, yes. There are basically 5 tasks:\n * Get the FormulaParser to be able to generate the correct (same as Excel) Ptgs for an array formula\n * Get HSSFFormulaParser.toFormulaString able to correctly turn those Ptgs back into the formula string\n * Get HSSFFormulaEvaluator to process the array ptgs correctly\n * Get XSSFFormulaEvaluator to process the array ptgs correctly\n * Get the Match function to handle the array ptgs correctly\n\nI'm not sure how many of those are currently sorted by the work on bug #48292 and friends, but that's roughly \"all\" you need to do..."}]
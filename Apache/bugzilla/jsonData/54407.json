[{"count": 0, "tags": [], "creator": "joro@liquidsoft.eu", "attachment_id": null, "id": 164584, "time": "2013-01-11T16:08:14Z", "bug_id": 54407, "creation_time": "2013-01-11T16:08:14Z", "is_private": false, "text": "When I do the suggested code:\n\nXSLFSlide srcSlide = slides[Integer.parseInt(args[2])];\nXSLFSlideLayout src_sl = srcSlide.getSlideLayout();\nXSLFSlideMaster src_sm = srcSlide.getSlideMaster();\n                \nXSLFSlide newSlide = ppto.createSlide(); \nXSLFSlideLayout new_sl = newSlide.getSlideLayout(); \nnew_sl.importContent(src_sl); \n                \nXSLFSlideMaster new_sm = newSlide.getSlideMaster();\nnew_sm.importContent(src_sm);\n                \nnewSlide.importContent(srcSlide);\n\nI get this exception:\n\nException in thread \"main\"\norg.apache.xmlbeans.impl.values.XmlValueDisconnectedException\nat\norg.apache.xmlbeans.impl.values.XmlObjectBase.check_orphaned(XmlObjectBase.java:1213)\nat\norg.openxmlformats.schemas.drawingml.x2006.main.impl.CTShapePropertiesImpl.getLn(Unknown\nSource)\nat\norg.apache.poi.xslf.usermodel.RenderableShape$5.fetch(RenderableShape.java:401)\nat\norg.apache.poi.xslf.usermodel.XSLFSimpleShape.fetchShapeProperty(XSLFSimpleShape.java:602)\nat\norg.apache.poi.xslf.usermodel.RenderableShape.getLinePaint(RenderableShape.java:417)\nat\norg.apache.poi.xslf.usermodel.XSLFSimpleShape.getLineColor(XSLFSimpleShape.java:288)\nat\norg.apache.poi.xslf.usermodel.XSLFSimpleShape.copy(XSLFSimpleShape.java:663)\nat org.apache.poi.xslf.usermodel.XSLFTextShape.copy(XSLFTextShape.java:561)\nat org.apache.poi.xslf.usermodel.XSLFSheet.importContent(XSLFSheet.java:310)\nat org.apache.poi.xslf.usermodel.XSLFSlide.importContent(XSLFSlide.java:226)\n\nIf I run it only with slides from the first slideshow, it works fine. Although if I try merging it with both PPTX files, it crashes with that exception."}, {"count": 1, "tags": [], "bug_id": 54407, "attachment_id": 29846, "is_private": false, "id": 164585, "time": "2013-01-11T16:13:24Z", "creator": "joro@liquidsoft.eu", "creation_time": "2013-01-11T16:13:24Z", "text": "Created attachment 29846\nPPTX 2"}, {"count": 2, "tags": [], "bug_id": 54407, "attachment_id": 29847, "is_private": false, "id": 164586, "time": "2013-01-11T16:15:51Z", "creator": "joro@liquidsoft.eu", "creation_time": "2013-01-11T16:15:51Z", "text": "Created attachment 29847\nPPTX 1\n\nThis is not the original testing file, I can send the links to the original testing files, but it basically happens with any file"}, {"count": 3, "tags": [], "bug_id": 54407, "attachment_id": null, "text": "XmlValueDisconnectedException  happens when you call importContent on the same sheets multuple times. In the current implementation you can do it only once:\n\nlayout.importContent(srcLayout); // OK\nlayout.importContent(srcLayout); // fails with XmlValueDisconnectedException  \n\nthe workaround is to track visited sheets and remember them in a set. Below is a modification of your code that passes without exceptions:\n\n        XMLSlideShow ppt1 = new XMLSlideShow(new FileInputStream(\"/temp/54407/10steps.pptx\"));\n        XSLFSlide[] slides = ppt1.getSlides();\n\n\n        XMLSlideShow ppt_out = new XMLSlideShow();\n        // track already imported sheets\n        HashSet<XSLFSheet> visited = new HashSet<XSLFSheet>();\n\n        for(XSLFSlide srcSlide : slides) {\n            XSLFSlideLayout src_sl = srcSlide.getSlideLayout();\n            XSLFSlideMaster src_sm = srcSlide.getSlideMaster();\n\n            XSLFSlide newSlide = ppt_out.createSlide();\n            XSLFSlideLayout new_sl = newSlide.getSlideLayout();\n            if(!visited.contains(new_sl)) {\n                new_sl.importContent(src_sl);\n                visited.add(new_sl);\n            }\n\n            XSLFSlideMaster new_sm = newSlide.getSlideMaster();\n            if(!visited.contains(new_sm)) {\n                new_sm.importContent(src_sm);\n                visited.add(new_sm);\n            }\n            newSlide.importContent(srcSlide);\n        }", "id": 164609, "time": "2013-01-13T10:50:27Z", "creator": "yegor@dinom.ru", "creation_time": "2013-01-13T10:50:27Z", "is_private": false}, {"count": 4, "tags": [], "creator": "joro@liquidsoft.eu", "attachment_id": null, "id": 164633, "time": "2013-01-15T09:04:10Z", "bug_id": 54407, "creation_time": "2013-01-15T09:04:10Z", "is_private": false, "text": "Since because of the file limitations, I have uploaded the original code + the test files here:\n\nhttp://projects.liquidsoft.eu/FlexiaJava.zip\n\nHere is my use case:\n\njava -jar dist\\FlexiaJava.jar out.pptx 10steps.pptx 3\n\njava -jar dist\\FlexiaJava.jar out.pptx 10steps.pptx 5\n\njava -jar dist\\FlexiaJava.jar out.pptx 10steps.pptx 2\n\njava -jar dist\\FlexiaJava.jar out.pptx dash.pptx 3\n\nStrangly the first time importing from the other file works fine(although not producing the correct output).\n\nThen we try to add another slide from the second presentation.\n\njava -jar dist\\FlexiaJava.jar out.pptx dash.pptx 5\n\nAnd it crashes:\n\nException in thread \"main\"\norg.apache.xmlbeans.impl.values.XmlValueDisconnectedException\n        at\norg.apache.xmlbeans.impl.values.XmlObjectBase.check_orphaned(XmlObjectBase.java:1213)\n        at\norg.openxmlformats.schemas.drawingml.x2006.main.impl.CTShapePropertiesImpl.isSetNoFill(Unknown\nSource)\n        at\norg.apache.poi.xslf.usermodel.RenderableShape$4.fetch(RenderableShape.java:352)\n        at\norg.apache.poi.xslf.usermodel.XSLFSimpleShape.fetchShapeProperty(XSLFSimpleShape.java:602)\n        at\norg.apache.poi.xslf.usermodel.RenderableShape.getFillPaint(RenderableShape.java:364)\n        at\norg.apache.poi.xslf.usermodel.XSLFSimpleShape.getFillColor(XSLFSimpleShape.java:490)\n        at\norg.apache.poi.xslf.usermodel.XSLFSimpleShape.copy(XSLFSimpleShape.java:649)\n\n        at\norg.apache.poi.xslf.usermodel.XSLFTextShape.copy(XSLFTextShape.java:561)\n        at\norg.apache.poi.xslf.usermodel.XSLFSheet.importContent(XSLFSheet.java:310)\n        at\norg.apache.poi.xslf.usermodel.XSLFSlide.importContent(XSLFSlide.java:226)\n        at flexiajava.FlexiaJava.main(FlexiaJava.java:73)"}, {"count": 5, "tags": [], "creator": "joro@liquidsoft.eu", "attachment_id": null, "id": 164765, "time": "2013-01-21T16:41:41Z", "bug_id": 54407, "creation_time": "2013-01-21T16:41:41Z", "is_private": false, "text": "I'm currently offering $500(over paypal) for a bugfix on this issue if I'm able to merge 2 presentations properly(no XMLDisconnects), proper master pages and styles. This has to be done today!"}, {"count": 6, "tags": [], "bug_id": 54407, "attachment_id": null, "is_private": false, "id": 164767, "time": "2013-01-21T18:07:54Z", "creator": "yegor@dinom.ru", "creation_time": "2013-01-21T18:07:54Z", "text": "OK, I will try to find time to look into it. Will give my feedback within 24 hours.\n\nYegor\n\n(In reply to comment #5)\n> I'm currently offering $500(over paypal) for a bugfix on this issue if I'm\n> able to merge 2 presentations properly(no XMLDisconnects), proper master\n> pages and styles. This has to be done today!"}, {"count": 7, "tags": [], "bug_id": 54407, "attachment_id": null, "is_private": false, "id": 164792, "time": "2013-01-22T13:58:08Z", "creator": "yegor@dinom.ru", "creation_time": "2013-01-22T13:58:08Z", "text": "Should be fixed in r1436913 and r1436608.\n\nThe following problems have been fixed:\n\n - image format .wdp was not supported. That resulted in NPE. \n - image relations under ExtLst element were not imported. importContent silently passed but PowerPoint showed \"unreadable content\" when opening the result. \n - cached placeholders were not invalidated after calling importContent. That resulted in XmlValueDisconnectedException\n - relationships for the diagram shapes were not copied. That resulted in \"unreadable content\" when opening the result in PowerPoint. \n\nAll presentations attached in http://projects.liquidsoft.eu/FlexiaJava.zip merge without exceptions and PowerPoint is happy to open the result. \n\nPlease try with the latest build from trunk. If there are still errors then please attach more test files/cases. \n\nRegards,\nYegor"}, {"count": 8, "tags": [], "bug_id": 54407, "attachment_id": null, "id": 172675, "time": "2014-01-24T15:14:54Z", "creator": "shea.brock@logicaloperations.com", "creation_time": "2014-01-24T15:14:54Z", "is_private": false, "text": "Latest build from trunk solved this issue for me.  Thank you for the timely fix!"}]
[{"attachment_id": null, "tags": [], "creator": "bangrazi@aprisma.com", "text": "I've found what I think is a bug with Tomcat automatically redirecting requests \nthrough SSL (from 8080 to 8443) if the request is made to a directory rather \nthan to a specific file.\n\nThe setup:\nInstalled Tomcat 4.0.3 (final) (run with J2SDK 1.3.1_03). To configure SSL, I \ncreated a self-signed certificate, and configured Tomcat (via server.xml) to \nuse it, by uncommenting the \"Define an SSL HTTP/1.1 Connector on port 8443\" \nelement and congifuring appropriately.\n\nI then created a web app whose web.xml's \"security-constraint\" included \na \"transport-guarantee\" of CONFIDENTIAL. The web-app consisted of a single JSP \nfile that said basically \"hello, [remote-user]\". The web application's \ndeployment descriptor indicated that this page should be accessed via SSL.\n\nIf I point my browser (IE) directly to the JSP file \n(http://localhost:8080/ssl/index.jsp\"), the redirect happens as I expected \n(https://localhost:8443/ssl/index.jsp) and the \"lock\" shows up in the browser.\n\nIf, however, I point my browser at http://localhost:8080/ssl/, and have \na \"welcome-file\" specification of \"/index.jsp\", the browser seems to time-out \n(give up on the request) waiting for the server to respond. This is what I \nthink is the bug. I would expect the server to correctly use the welcome-file \nwhen browsing to a path, even when using SSL.\n\nHere is the code of my web app:\n\nssl/index.jsp:\n<html>\n<body>\n\n  <h1>Hello, <%= request.getRemoteUser( ) %>!</h1>\n\n  <p>You should be seeing this via HTTPS.</p>\n\n</body>\n</html>\n\nssl/WEB-INF/web.xml:\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<!DOCTYPE web-app PUBLIC\n          \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n          \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n\n<web-app>\n\n  <welcome-file-list>\n    <welcome-file>/index.jsp</welcome-file>\n  </welcome-file-list>\n\n  <security-constraint>\n    <web-resource-collection>\n      <web-resource-name>SSL Test</web-resource-name>\n      <url-pattern>/*</url-pattern>\n    </web-resource-collection>\n    <auth-constraint>\n      <description>All roles</description>\n      <role-name>*</role-name>\n    </auth-constraint>\n    <user-data-constraint>\n      <description>force use of SSL</description>\n      <transport-guarantee>CONFIDENTIAL</transport-guarantee>\n    </user-data-constraint>\n  </security-constraint>\n\n  <login-config>\n    <auth-method>BASIC</auth-method>\n    <realm-name>SSL Test</realm-name>\n  </login-config>\n\n</web-app>\n\nbuild.xml:\n<?xml version=\"1.0\"?>\n<project name=\"ssl\" default=\"all\" basedir=\".\">\n\n  <property name=\"app.name\" value=\"ssl\"/>\n  <property name=\"catalina.home\"\n            value=\"<path-to-my-catalina-home>\" />\n\n  <target name=\"war\">\n    <jar jarfile=\"${app.name}.war\" basedir=\"war\"/>\n  </target>\n\n\n  <target name=\"deploy\">\n    <delete dir=\"${catalina.home}/webapps/${app.name}\"/>\n    <delete file=\"${catalina.home}/webapps/${app.name}.war\"/>\n    <copy file=\"${app.name}.war\" todir=\"${catalina.home}/webapps\"/>\n  </target>\n\n\n  <target name=\"all\" depends=\"war\"/>\n\n\n  <target name=\"clean\">\n    <delete file=\"${app.name}.war\"/>\n  </target>\n\n</project>", "count": 0, "id": 15356, "time": "2002-05-02T18:56:29Z", "bug_id": 8752, "creation_time": "2002-05-02T18:56:29Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 8752, "is_private": false, "text": "This problem still exists in 4.1.12 as well.  Duplicated same as original \nreporter.", "id": 24299, "time": "2002-10-10T17:40:42Z", "creator": "shall@gaic.com", "creation_time": "2002-10-10T17:40:42Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "remm@apache.org", "is_private": false, "count": 2, "id": 35850, "time": "2003-04-23T07:55:52Z", "bug_id": 8752, "creation_time": "2003-04-23T07:55:52Z", "text": "*** Bug 10028 has been marked as a duplicate of this bug. ***"}, {"attachment_id": null, "tags": [], "creator": "remm@apache.org", "is_private": false, "count": 3, "id": 35852, "time": "2003-04-23T07:58:25Z", "bug_id": 8752, "creation_time": "2003-04-23T07:58:25Z", "text": "This other report details the root cause of the problem, and indicates a workaround.\n\n*** This bug has been marked as a duplicate of 19145 ***"}, {"attachment_id": null, "tags": [], "creator": "jemiller@uchicago.edu", "text": "Which bug is it that indicates the workaround? The one that says to use \nstandard ports? What if you can't use the standard ports? Why not just fix the \nbug? If I remember correctly, older versions of Tomcat didn't have this \nproblem.\n", "count": 4, "id": 37619, "time": "2003-05-22T17:16:42Z", "bug_id": 8752, "creation_time": "2003-05-22T17:16:42Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "medthomas@ntlworld.com", "text": "As the root cause of this is an IE bug (see bugs 13861 and 19145) this will \nnot be fixed.", "count": 5, "id": 44711, "time": "2003-09-25T18:59:02Z", "bug_id": 8752, "creation_time": "2003-09-25T18:59:02Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "jemiller@uchicago.edu", "text": "It's been years that this has been broken, so, I could be misremembering, but, \nI'd swear that this used to work. Why is this possible for Apache HTTP server \nand impossible for Tomcat?", "count": 6, "id": 44714, "time": "2003-09-25T19:17:55Z", "bug_id": 8752, "creation_time": "2003-09-25T19:17:55Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "medthomas@ntlworld.com", "text": "I have just double checked this with the test case provided. This is \nabsolutely, definitely, postively, certainly and without the slightest iota of \ndoubt NOT a tomcat bug. This is an IE bug. I have tried exactly the same test \ncase with Mozilla and it works perfectly.\n\nYou see it when there is a sequence of two redirects. In this case there is \none redirect to use SSL and another to the welcome page (I haven't bothered to \ncheck the order in which this happens in but I am fairly sure it is SSL first).\n\nThis is what happens:\nWhen the page is requested, Tomcat first redirects to SSL and then performs a \nsecond redirect to the welcome file.\nThe response sent by IE to the first redirect comes in on port 8443 but the \nrequest headers refer to port 8080 (read in \norg.apache.coyote.http11.Http11Processor.parseHost()). This causes the second \nredirect to fail because the port in the request is used when constructing the \nsecond redirect.\n\nYou will not see this problem if the standard ports are used because standard \nports are not included in the request and Tomcat defaults to these if the port \nis not specified in the headers.\n\nWork arounds are:\n1. Use the standard ports\n2. Use a two stage re-direct\n\nI initiated a discussion on tomcat-dev about options to solve this a few \nmonths ago and after going around in circles, concluded that the best thing to \ndo was to leave it as is. The main reasons for this were:\n- It is an IE not a tomcat bug\n- Production systems tend to use standard ports and will therefore be fine\n- All of the fixes identified broke something else or intoduced security \nissues.\n\nIf you search the tomat-dev archives for \"13861\" you should find the various e-\nmails that went back and forth.", "count": 7, "id": 44753, "time": "2003-09-26T18:30:35Z", "bug_id": 8752, "creation_time": "2003-09-26T18:30:35Z", "is_private": false}]
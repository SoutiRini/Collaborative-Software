[{"count": 0, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Created attachment 26197\nScreenshot showing bug\n\nHello,\nI have a case where I nested a TransactionController inside another.\nSee attached test JMX called bug.jmx.\nWhat happens is root TransactionController cumulates times of its insider transaction controller, see attached screenshot.\nscenario4 has time of 16124 instead of having 8063.\n\nThis issue affects 2.4 and nightly build of 21/10/2010.\n\nI will submit a patch in minutes.\nRegards\nPhilippe M.\nhttp://www.ubik-ingenierie.com", "id": 140882, "time": "2010-10-21T03:43:56Z", "bug_id": 50134, "creation_time": "2010-10-21T03:43:56Z", "is_private": false, "attachment_id": 26197}, {"count": 1, "tags": [], "bug_id": 50134, "attachment_id": 26198, "id": 140884, "time": "2010-10-21T03:46:10Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2010-10-21T03:46:10Z", "is_private": false, "text": "Created attachment 26198\nJMX Plan showing issue"}, {"count": 2, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Created attachment 26199\nJSP for test case\n\nPut this JSP in standard Tomcat 6 inside folder:\nexamples/jsp/test", "id": 140885, "time": "2010-10-21T03:48:02Z", "bug_id": 50134, "creation_time": "2010-10-21T03:48:02Z", "is_private": false, "attachment_id": 26199}, {"count": 3, "tags": [], "bug_id": 50134, "attachment_id": 26200, "text": "Created attachment 26200\nPatch to the bug\n\nThis patch corrects the issue.", "id": 140886, "time": "2010-10-21T03:56:51Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2010-10-21T03:56:51Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 50134, "attachment_id": null, "text": "Hello,\nI submitted the patch, hope you can take it into account soon.\n\nThank you \nRegards\nPhilippe M.\nhttp://www.ubik-ingenierie.com", "id": 140887, "time": "2010-10-21T03:58:02Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2010-10-21T03:58:02Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 50134, "attachment_id": null, "text": "Would it be possible to provide a simpler test case using just Java Request samplers?", "id": 140893, "time": "2010-10-21T06:36:58Z", "creator": "sebb@apache.org", "creation_time": "2010-10-21T06:36:58Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 50134, "attachment_id": 26201, "text": "Created attachment 26201\nSimpler Test plan\n\nHere is a simpler test based on java samplers.\n\nPhilippe M.\nhttp://www.ubik-ingenierie.com", "id": 140906, "time": "2010-10-21T10:06:57Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2010-10-21T10:06:57Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 50134, "attachment_id": 26202, "text": "Created attachment 26202\nScreenshot showing bug with new Java Sampler JMX", "id": 140907, "time": "2010-10-21T10:07:44Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2010-10-21T10:07:44Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 50134, "attachment_id": null, "id": 140908, "time": "2010-10-21T11:08:43Z", "creator": "sebb@apache.org", "creation_time": "2010-10-21T11:08:43Z", "is_private": false, "text": "Sorry, but the test plan is still quite difficult to follow, as it has disabled entries and assertions, several thread groups etc.\n\nI've no idea which parts of the plan are relevant.\nTime spent fixing the test plan is time that cannot be spent fixing the bug.\n\nPlease can you provide the simplest possible plan that shows the problem?"}, {"count": 9, "tags": [], "bug_id": 50134, "attachment_id": null, "text": "Sorry sebb, You can remove all disabled objects, th\u00e9 sc\u00e9nario to use is S5.\nYou run it and in r\u00e9sults you Will see that sc\u00e9nario 5 has wrong response Time it cumulates all its inner response Time even when on transactioncontroller contains another one.\nI Can upload new jmx within tomorrow if you really need it.\n\nI submitted th\u00e9 patch to bug and tested it successfully.\n\nThank you", "id": 140912, "time": "2010-10-21T12:49:50Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2010-10-21T12:49:50Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 50134, "attachment_id": 26203, "text": "Created attachment 26203\nCleaned up JMX\n\nSorry It seems I messed up with my JMX, this one is the good one.\nThank you again for your time.\n\nRegards", "id": 140915, "time": "2010-10-21T14:39:02Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2010-10-21T14:39:02Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 50134, "attachment_id": 26200, "text": "Comment on attachment 26200\nPatch to the bug\n\nPatch is not working.\nThere is some other case it does not solve.", "id": 140922, "time": "2010-10-22T08:13:29Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2010-10-22T08:13:29Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 50134, "attachment_id": 26245, "text": "Created attachment 26245\nPatch to issue\n\nHello,\nI analyzed a bit more what was happening.\nI think I understood where the issue comes from.\n\nAs the plan is built, here is how sampleOccured in TransactionController is called:\nSampleOccured :s4-1-s1 in :s4-chapeau\nSampleOccured :s4-1-s1 in :scenario5\nSampleOccured :s4-1-s2 in :s4-chapeau\nSampleOccured :s4-1-s2 in :scenario5\nSampleOccured :s4-chapeau in :scenario5\n\nThis is because scenario5 and s4-chapeau are both registered as listeners for each sample, this end up in the upper most parent recording twice things and mixing up pause time.\n\n\nIn my analysis there are 2 types of SampleEvent:\n- One that is initiated by a real Sample\n- One that is initiated \"artificially\" by TransactionController#next2, this one should not be used in computations\n\n\nSo my idea was to distinguish them by an additional attribute called isTransactionSampleEvent.\nI use this attribute setting it to true in next2() to build the SampleEvent\nand use it in sampleOccured() to use it in computation or not.\n\n\nI tested with the existing test plan and the one that is a bit more complicated and it works.\nBut I think you have the big picture to validate this modification.\n\nBy the way you will notice some changes in SampleEvent because I made some refactoring in the constructor to make them use each others instead of copy/paste.\n\n\nThank you for your time and great product and hope you will have some time to take this patch into account.\n\nRegards\nPhilippe M.\nhttp://www.ubik-ingenierie.com", "id": 141295, "time": "2010-11-01T06:11:47Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2010-11-01T06:11:47Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 50134, "attachment_id": null, "text": "Yes, I think your analysis is correct, and the patch approach is reasonable.\n\nApplied the fix to SVN with some minor changes:\n- dropped unnecessary setTransactionSampleEvent and made boolean final\n- made new ctor private, as not used externally\n- simplified nested conditional block.\n- replaced tabs with spaces, and removed spurious blank lines\n\n\nURL: http://svn.apache.org/viewvc?rev=1029746&view=rev\nLog:\nBug 50134 - TransactionController : Reports bad response time when it contains other TransactionControllers\n\nModified:\n   jakarta/jmeter/trunk/src/core/org/apache/jmeter/control/TransactionController.java\n   jakarta/jmeter/trunk/src/core/org/apache/jmeter/samplers/SampleEvent.java\n   jakarta/jmeter/trunk/xdocs/changes.xml", "id": 141310, "time": "2010-11-01T13:01:39Z", "creator": "sebb@apache.org", "creation_time": "2010-11-01T13:01:39Z", "is_private": false}]
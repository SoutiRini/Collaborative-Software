[{"count": 0, "tags": [], "creator": "dsl@ts.com", "attachment_id": null, "id": 9463, "time": "2002-01-08T10:43:49Z", "bug_id": 5747, "creation_time": "2002-01-08T10:43:49Z", "is_private": false, "text": "Yesterday's fix for bug 5719 leads us into a new one during shutdown..\n\nWhilst trying to get the request dispatcher to service a request that came in\njust before the stop request, getRequestDispatcher calls findChild in\nContainerBase and this requires a lock on the Container's children set.  This\nlock is held by the shutdown thread which holds..\n\nthe shutdown thread looks like this \n  sleep:Thread\n   unload:StandardWrapper\n    stop:StandardWrapper\n     removeChild:ContainerBase\n      stop:ContextConfig\n       lifecycleEvent:ContextConfig\n        fireLifecycleEvent:LifecycleSupport\n         stop:StandardContext\n           stop:StandardHost\n             stop:ManagerServlet\n\nand my application thread looks like this:\n     findChild:ContainerBase\n      map:StandardContextMapper\n       map:ContainerBase\n        getRequestDispatcher:ApplicationContext\n         getRequestDispatcher:HttpRequestBase\n          getRequestDispatcher:RequestFacade\n           getRequestDispatcher:ServletRequestWrapper\n            include:JspRuntimeLibrary\n             _jspService:base$1.jsp\n              service:...\n\netc.\nI'm running 4.0.1 with the yesterday's fix manually applied.\n\nThe example I gave in bug 5719 will also reproduce this bug."}, {"count": 1, "text": "In ContainerBase, stopping the child outside of the synchronization would solve \nthe problem I think, but could have some slight synchronization issue.\nThe main problem is with findChild syncing, and I don't understand why it is \nneeded. Craig ?", "bug_id": 5747, "is_private": false, "id": 9465, "time": "2002-01-08T11:21:32Z", "creator": "remm@apache.org", "creation_time": "2002-01-08T11:21:32Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "creator": "remm@apache.org", "text": "Fixed (and tested using the test case). Thanks.", "id": 9469, "time": "2002-01-08T14:23:40Z", "bug_id": 5747, "creation_time": "2002-01-08T14:23:40Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "*** Bug 4488 has been marked as a duplicate of this bug. ***", "is_private": false, "bug_id": 5747, "id": 9528, "time": "2002-01-10T12:28:11Z", "creator": "remm@apache.org", "creation_time": "2002-01-10T12:28:11Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "remm@apache.org", "text": "*** Bug 6023 has been marked as a duplicate of this bug. ***", "id": 9950, "time": "2002-01-27T01:33:28Z", "bug_id": 5747, "creation_time": "2002-01-27T01:33:28Z", "is_private": false, "attachment_id": null}]
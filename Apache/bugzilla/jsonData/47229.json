[{"count": 0, "tags": [], "bug_id": 47229, "is_private": false, "text": "I get the following exception when trying to read in an Excel document with the following record:\n\n Offset=0x0000121D(4637) recno=199 sid=0x01AE size=0x000A(10)\n     [java] org.apache.poi.hssf.record.SupBookRecord [SUPBOOK External References nSheets=0 url=BLP^CM]\n     [java] Offset=0x0000122B(4651) recno=200 sid=0x0023 size=0x005C(92)\n     [java] [UNKNOWNRECORD] (0x23)\n     [java]   rawData=[E2, 7F, 00, 00, 00, 00, 37, 00, 30, 31, 30, 36, 37, 32, 41, 54, 30, 20, 4D, 55, 4E, 49, 2C, 5B, 52, 54, 47, 5F, 4D, 4F, 4F, 44, 59, 5F, 55, 4E, 44, 45, 52, 4C, 59, 49, 4E, 47, 2C, 52, 54, 47, 5F, 53, 50, 5F, 55, 4E, 44, 45, 52, 4C, 59, 49, 4E, 47, 5D, 01, 00, 00, 02, 09, 00, 00, 23, 4E, 2F, 41, 20, 4E, 2E, 41, 2E, 02, 09, 00, 00, 23, 4E, 2F, 41, 20, 4E, 2E, 41, 2E]\n     [java] [/UNKNOWNRECORD]\n\nI've fixed this by changing hasNextRecord in RecordInputStream as follows to read the remaining bytes:\n\nIndex: RecordInputStream.java\n===================================================================\n--- RecordInputStream.java\t(revision 776494)\n+++ RecordInputStream.java\t(working copy)\n@@ -121,7 +121,9 @@\n \t */\n \tpublic boolean hasNextRecord() throws LeftoverDataException {\n \t\tif (_currentDataLength != -1 && _currentDataLength != _currentDataOffset) {\n-\t\t\tthrow new LeftoverDataException(_currentSid, remaining());\n+\t\t    \n+\t\t\t//throw new LeftoverDataException(_currentSid, remaining());\n+\t\t    byte[] remainder = readRemainder();\n \t\t}\n \t\tif (_currentDataLength != DATA_LEN_NEEDS_TO_BE_READ) {\n \t\t\t_nextSid = readNextSid();\n\nI appreciate the exception still needs to be thrown in some cases, I just need to do this in order for it to be more a little more forgiving of weird Excel records.  Just so that you know there might be an issue here.\n\nthis is with the 3.5-beta6 (latest SVN code)", "id": 127224, "time": "2009-05-20T16:45:08Z", "creator": "jonathan.holloway@gmail.com", "creation_time": "2009-05-20T16:45:08Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 47229, "attachment_id": null, "text": "Thanks for the hex dump - it made it easy to reproduce this error.\n\nThis bug was manifested slightly differently on trunk (A very specific RecordFormatException instead of LeftoverDataException). Somehow you seem to be missing the fix for bug 44792\n\nFixed in svn r777275\njunit added\n\n\nThe sample ExternalNameRecord seems to be a DDE link named '010672AT0 MUNI...'. Are you able to give a quick description of how to create a similar DDE link via the standard Excel GUI?\n\n\n\nRegarding your fix for RecordInputStream, this is something you should only ever apply locally (definitely not in production), knowing that POI may silently corrupt Excel files as a a result.  This code used to be very lax, and many bugs reported here were actually obscure downstream effects of POI ignoring unread BIFF record data.", "id": 127256, "time": "2009-05-21T15:04:31Z", "creator": "josh@apache.org", "creation_time": "2009-05-21T15:04:31Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 52926, "attachment_id": null, "id": 154973, "time": "2012-03-16T08:19:25Z", "creator": "morten@ethlo.com", "creation_time": "2012-03-16T08:19:25Z", "is_private": false, "text": "We have sporadic issues triggering 502 proxy errors using the NIO connector behind Nginx, caused by dropped connections/end of streams in Tomcat. The Tomcat log shows:\n\nSEVERE: Error allocating socket processor\njava.lang.NullPointerException \nat org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:721)\nat org.apache.tomcat.util.net.NioEndpoint$Poller.cancelledKey(NioEndpoint.java:1048)\nat org.apache.tomcat.util.net.NioEndpoint$Poller.timeout(NioEndpoint.java:1392)\nat org.apache.tomcat.util.net.NioEndpoint$Poller.run(NioEndpoint.java:1174)\nat java.lang.Thread.run(Thread.java:662)\n\nLooking at the code in processSocket I see the line in NioEndpoint(721): \nattachment.setCometNotify(false); //will get reset upon next reg\n\nAttachment is fetched in line 720:\nKeyAttachment attachment = (KeyAttachment)socket.getAttachment(false);\n\nLooking at socket.getAttachement() method I see that this method is indeed capable of returning null, but no null-check for this is done (although it is in multiple other locations, so it seems inconsistent)."}, {"count": 1, "tags": [], "bug_id": 52926, "attachment_id": null, "text": "Thanks for the report. Fixed in trunk and 7.0.x and will be included in 7.0.27 onwards.", "id": 155097, "time": "2012-03-20T11:11:14Z", "creator": "markt@apache.org", "creation_time": "2012-03-20T11:11:14Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 52926, "attachment_id": null, "id": 185930, "time": "2015-10-25T18:35:12Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2015-10-25T18:35:12Z", "is_private": false, "text": "This fix (r1302839) was backported to Tomcat 6 in r1710473 and will be in 6.0.45 onwards."}]
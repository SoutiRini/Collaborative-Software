[{"count": 0, "attachment_id": null, "bug_id": 19165, "is_private": false, "id": 35612, "time": "2003-04-18T22:31:33Z", "creator": "joshua@safeweb.com", "creation_time": "2003-04-18T22:31:33Z", "tags": [], "text": "From ap_proxy_http_handler() in proxy_http.c, in the following code fragment\n(whether or not SINIX_D_RESOLVER_BUG is defined), variable i will never be\nproperly initialized if the loops are never entered.\n\n#ifdef SINIX_D_RESOLVER_BUG\n    {\n        struct in_addr *ip_addr = (struct in_addr *)*server_hp.h_addr_list;\n\n        for (; ip_addr->s_addr != 0; ++ip_addr) {\n            memcpy(&server.sin_addr, ip_addr, sizeof(struct in_addr));\n            i = ap_proxy_doconnect(sock, &server, r);\n            if (i == 0)\n                break;\n        }\n    }\n#else\n    j = 0;\n    while (server_hp.h_addr_list[j] != NULL) {\n        memcpy(&server.sin_addr, server_hp.h_addr_list[j],\n               sizeof(struct in_addr));\n        i = ap_proxy_doconnect(sock, &server, r);\n        if (i == 0)\n            break;\n        j++;\n    }\n#endif\n    if (i == -1) {\n        if (proxyhost != NULL)\n            return DECLINED;    /* try again another way */\n        else\n            return ap_proxyerror(r, HTTP_BAD_GATEWAY, ap_pstrcat(r->pool,\n                                    \"Could not connect to remote machine: \",\n                                                    strerror(errno), NULL));\n    }\n\n\nHere is a suggested patch:\nRCS file: /home/cvspublic/apache-1.3/src/modules/proxy/proxy_http.c,v\nretrieving revision 1.103\ndiff -c -r1.103 proxy_http.c\n*** proxy_http.c        3 Feb 2003 17:13:26 -0000       1.103\n--- proxy_http.c        18 Apr 2003 22:28:47 -0000\n***************\n*** 259,264 ****\n--- 259,265 ----\n      }\n  #endif\n  \n+   i = -1;\n  #ifdef SINIX_D_RESOLVER_BUG\n      {\n          struct in_addr *ip_addr = (struct in_addr *)*server_hp.h_addr_list;"}, {"count": 1, "tags": [], "bug_id": 19165, "text": "Please verify my analysis:\n\nThere will always be at least one address in server_hp.h_addr_list[] (or\nap_proxy_host2addr() would have failed).  Thus we'll always enter the loop. \nThus i will always be 0 or -1 after the loop.\n", "id": 37408, "time": "2003-05-18T15:27:43Z", "creator": "trawick@apache.org", "creation_time": "2003-05-18T15:27:43Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 19165, "attachment_id": null, "is_private": false, "id": 37413, "time": "2003-05-18T16:40:28Z", "creator": "joshua@safeweb.com", "creation_time": "2003-05-18T16:40:28Z", "text": "Sounds reasonable.\n\n"}]
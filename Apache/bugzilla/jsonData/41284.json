[{"count": 0, "tags": [], "creator": "joe.thompson@lmco.com", "attachment_id": null, "id": 97602, "time": "2007-01-03T16:12:57Z", "bug_id": 41284, "creation_time": "2007-01-03T16:12:57Z", "is_private": false, "text": "dependset throws a NullPointerException.  The failure appears to occur at the\npoint where DependSet.uptodate() sorts the list of sources, and gets the first\nelement of the list. (line 233 in DependSet.java). \nThis works correctly in Version 1.6.5.\n\nStack trace from log:\n--- Nested Exception ---\njava.lang.NullPointerException\n\tat\norg.apache.tools.ant.types.resources.Sort$SortedBag$MutableInt.access$100(Sort.java:44)\n\tat\norg.apache.tools.ant.types.resources.Sort$SortedBag$MyIterator.next(Sort.java:60)\n\tat org.apache.tools.ant.types.resources.FailFast.next(FailFast.java:115)\n\tat org.apache.tools.ant.taskdefs.DependSet.uptodate(DependSet.java:233)\n\tat org.apache.tools.ant.taskdefs.DependSet.execute(DependSet.java:202)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\n\tat org.apache.tools.ant.Target.execute(Target.java:357)\n\tat org.apache.tools.ant.Target.performTasks(Target.java:385)\n\tat org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)\n\tat org.apache.tools.ant.Project.executeTarget(Project.java:1298)\n\tat\norg.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n\tat org.apache.tools.ant.Project.executeTargets(Project.java:1181)\n\tat org.apache.tools.ant.Main.runBuild(Main.java:698)\n\tat org.apache.tools.ant.Main.startAnt(Main.java:199)\n\tat org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\n\tat org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)"}, {"count": 1, "tags": [], "bug_id": 41284, "text": "Created attachment 19350\nContains test files and output log.", "id": 97603, "time": "2007-01-03T16:14:34Z", "creator": "joe.thompson@lmco.com", "creation_time": "2007-01-03T16:14:34Z", "is_private": false, "attachment_id": 19350}, {"count": 2, "tags": [], "bug_id": 41284, "text": "Note that the problem only occurs when the target file exists.", "id": 97605, "time": "2007-01-03T16:17:02Z", "creator": "joe.thompson@lmco.com", "creation_time": "2007-01-03T16:17:02Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 41284, "text": "Hi Joseph,\n  I have DLd your attachment but it does not contain a complete self-hosting\nenvironment.  I tried to compensate for that fact but have not been able to\nreproduce the NPE.  A more complete build would be helpful.  It might also be\nhelpful to know what Java version you are using.\n\nThanks,\nMatt", "id": 97644, "time": "2007-01-04T09:02:33Z", "creator": "mbenson@apache.org", "creation_time": "2007-01-04T09:02:33Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 41284, "text": "The source (src) directory for the sandbox where this bug occurred contains 5448\n.java files and 127 .jsp files in numerous directories. Can't really share all\nthat (size is prohibitive, and the source is proprietary). \n\njava -version returns\njava version \"1.5.0_09\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_09-b03)\nJava HotSpot(TM) Client VM (build 1.5.0_09-b03, mixed mode, sharing)", "id": 97646, "time": "2007-01-04T09:10:43Z", "creator": "joe.thompson@lmco.com", "creation_time": "2007-01-04T09:10:43Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 41284, "text": "(In reply to comment #4)\n> The source (src) directory for the sandbox where this bug occurred contains 5448\n> .java files and 127 .jsp files in numerous directories. Can't really share all\n> that (size is prohibitive, and the source is proprietary). \n> \n> java -version returns\n> java version \"1.5.0_09\"\n> Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_09-b03)\n> Java HotSpot(TM) Client VM (build 1.5.0_09-b03, mixed mode, sharing)\n\nBased on size alone, I certainly wouldn't want you to share all that.  At the\nsame time, I can slap a few files into various directories under src/ and I\ndon't get the NPE.  So there must be something unique to your directory\nstructure that triggers the error.  The most important component of a bugreport\nis as small as possible a self-contained example that triggers the problem. \nYou've got to help us help you...  :|\n", "id": 97648, "time": "2007-01-04T10:29:22Z", "creator": "mbenson@apache.org", "creation_time": "2007-01-04T10:29:22Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 41284, "text": "In an artificial environment where I have only tested the SortedBag I am able to\nreproduce this error, that is the same error occurs in case the object in the\nTreeMap is changed, so that its position in the map changes. Because of this the\nkey retrieved using the key iterator cannot be found anymore in the map (because\nits position according to its ordering has changed.)\n\nIn this case it probably implies that the Newest File isn't the Newest anymore...", "id": 98612, "time": "2007-01-27T14:41:37Z", "creator": "jkf@apache.org", "creation_time": "2007-01-27T14:41:37Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "jkf@apache.org", "attachment_id": null, "text": "If this was the cause it is fixed in head now, please verify.", "id": 98615, "time": "2007-01-27T15:43:14Z", "bug_id": 41284, "creation_time": "2007-01-27T15:43:14Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 41284, "text": "Created attachment 19478\nOutput log and fragment of correctly sorted list of java files\n\nI have tested the fix (nightly build apache-ant-20070128). The NPE is gone, but\nthe sort is not working correctly. I tested this in both in our actual\ndevelopment sandbox and in the ant directory. If you drop the test files I\noriginally attached into the ant directory and run ant -f problem.xml, the\nfirst time thru it should create the BuildID.properties file (because it\ndoesn't exist). If you then touch an arbitrary .java source file and re-run, it\nshould create a new BuildID.properties with a new date-time stamp. It doesn't.\nI've attached a zip with the log from such a run on my machine and a fragment\nof an externally-sorted list of all the .java files, and this clearly shows\nthat the sort in DependSet is not properly ordering the files.", "id": 98710, "time": "2007-01-29T14:10:21Z", "creator": "joe.thompson@lmco.com", "creation_time": "2007-01-29T14:10:21Z", "is_private": false, "attachment_id": 19478}, {"count": 9, "tags": [], "text": "The nightly builds do not seem to pick up the recent changes, (also this bug is\nnot fixed in the nightly build of the 29th) these builds still contain the wrong\nclasses. The behaviour you observed is described in another report.\n\n(Bugzilla report 41411)", "attachment_id": null, "id": 98776, "creator": "jkf@apache.org", "time": "2007-01-30T12:09:30Z", "bug_id": 41284, "creation_time": "2007-01-30T12:09:30Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 41284, "text": "I have put a manual build (on windows, unix permission will be wrong!) on:\n\nhttp://people.apache.org/~jkf/apache-ant-20070130-bin.tgz", "id": 98777, "time": "2007-01-30T12:20:08Z", "creator": "jkf@apache.org", "creation_time": "2007-01-30T12:20:08Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 41284, "attachment_id": null, "text": "The manual build supplied (apache-ant-20070130-bin.tgz) does appear to fix the\nproblem. \n\nThanks, guys!\n\nJoe T.", "id": 98783, "time": "2007-01-30T13:29:33Z", "creator": "joe.thompson@lmco.com", "creation_time": "2007-01-30T13:29:33Z", "is_private": false}, {"count": 12, "tags": [], "creator": "jkf@apache.org", "attachment_id": null, "id": 113575, "time": "2008-02-08T10:33:19Z", "bug_id": 41284, "creation_time": "2008-02-08T10:33:19Z", "is_private": false, "text": "*** Bug 44368 has been marked as a duplicate of this bug. ***"}]
[{"count": 0, "tags": [], "bug_id": 3896, "attachment_id": null, "is_private": false, "id": 6223, "time": "2001-10-01T03:58:43Z", "creator": "faensen@inf.fu-berlin.de", "creation_time": "2001-10-01T03:58:43Z", "text": "When invoking a servlet that is a subclass of org.webmacro.http.WMServlet (which \nin turn is a direct subclass of HTTPServlet) the Catalina core throws a \nServletException that is a linked to a ClassCastException:\n\nHere is a snippet from the log file\n2001-10-01 12:19:59 \nStandardWrapper[:org.apache.catalina.INVOKER.hermes.web.HelloWorld]: Marking \nservlet org.apache.ca\ntalina.INVOKER.hermes.web.HelloWorld as unavailable\n2001-10-01 12:19:59 invoker: Cannot allocate servlet instance for path \n/servlet/hermes.web.HelloWorld\njavax.servlet.ServletException: Class hermes.web.HelloWorld is not a Servlet\n        at \norg.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:848)\n        at \norg.apache.catalina.core.StandardWrapper.allocate(StandardWrapper.java:621)\n        at org.apache.catalina.servlets.InvokerServlet.serveRequest(Unknown \nSource)\n        at org.apache.catalina.servlets.InvokerServlet.doGet(Unknown Source)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:740)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at \norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Unknown Source)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(Unknown \nSource)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(Unknown Source)\n        at org.apache.catalina.core.StandardPipeline.invokeNext(Unknown Source)\n        at org.apache.catalina.core.StandardPipeline.invoke(Unknown Source)\n        at org.apache.catalina.core.ContainerBase.invoke(Unknown Source)\n        at org.apache.catalina.core.StandardContextValve.invoke(Unknown Source)\n\nThe problem seems to occur in the following lines in \norg.apache.catalina.core.StandardWrapper:\n\n        try {\n            servlet = (Servlet) classClass.newInstance();\n        } catch (ClassCastException e) {\n            unavailable(null);\n            // Restore the context ClassLoader\n            throw new ServletException\n                (sm.getString(\"standardWrapper.notServlet\", actualClass), e);\n        }\n\n\nBy splitting the line \n  servlet = (Servlet) classClass.newInstance();\nand adding some debugging output \n\t    log(\"Trying to instantiate \" + classClass.getName());\n \t    Object instance =  classClass.newInstance();\n\t    log(\"Instantiated, instance is  \" + instance);\n\t    log(\"Trying to cast ...\");\n\t    servlet = (Servlet) instance;\n\none can focus that instance (which is of class hermes.web.HelloWorld) cannot be \ncasted to Servlet.\n\nThe class hierarchy is as follows\n\n    Interface javax.servlet.Servlet\n                     ^\n                     | implements\n                     |\n    Class javax.servlet.GenericServlet\n                     ^\n                     | extends\n                     |\n    Class javax.servlet.http.HttpServlet\n                     ^\n                     | extends\n                     |\n    Class org.webmacro.servlet.WMServlet\n                     ^\n                     | extends\n                     |\n    Class hermes.web.HelloWorld\n\nClearly, HelloWorld should be castable to Servlet.\nI have no idea why the cast fails. May be something is wrong with the class \nloader.\n\nDaniel Faensen"}, {"count": 1, "tags": [], "bug_id": 3896, "attachment_id": null, "text": "*** Bug 3907 has been marked as a duplicate of this bug. ***", "id": 6242, "time": "2001-10-01T12:37:39Z", "creator": "amyroh@apache.org", "creation_time": "2001-10-01T12:37:39Z", "is_private": false}, {"count": 2, "tags": [], "creator": "amyroh@apache.org", "attachment_id": null, "id": 6244, "time": "2001-10-01T12:42:21Z", "bug_id": 3896, "creation_time": "2001-10-01T12:42:21Z", "is_private": false, "text": "Check the location of servlet.jar and make sure that your web application \ndoesn't have servlet.jar in web-inf/lib.  Could you reply back if you're still \nhaving the problem?  "}, {"count": 3, "tags": [], "creator": "amyroh@apache.org", "text": "It's also important that \"servlet.jar\" not be in the Java system\nextensions directory ($JAVA_HOME/jre/lib/ext).  Reopened until confirmation.", "id": 6251, "time": "2001-10-01T13:56:24Z", "bug_id": 3896, "creation_time": "2001-10-01T13:56:24Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 3896, "text": "Removing the servlet.jar file from WEB-INF/lib fixed the problem.  Thanks for\nthe help.  Sorry I couldn't find the bug when I searched the database.", "id": 6253, "time": "2001-10-01T14:29:17Z", "creator": "tdavis@msfw.com", "creation_time": "2001-10-01T14:29:17Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "creator": "faensen@inf.fu-berlin.de", "attachment_id": null, "id": 6263, "time": "2001-10-02T00:48:06Z", "bug_id": 3896, "creation_time": "2001-10-02T00:48:06Z", "is_private": false, "text": "I still get the error message.\n  - $JAVA_HOME/jre/lib/ext is empty.\n  - WEB-INF/lib does not exist\nI start tomcat with the following CLASSPATH (which contains servlet.jar, \notherwise no servlets are found):\n\n/home/jefe/ag-db/hermes/src:/home/jefe/ag-db/hermes/etc:/home/jefe/ag-db/hermes/\nlib/webmacro.jar:/home/jefe/ag-db/hermes/lib/xerces.jar:/home/jefe/ag-db/hermes/\nlib/activation.jar:/home/jefe/ag-db/hermes/lib/jakarta-tomcat-4.0/common/lib/ser\nvlet.jar\n\n... and with the following command line:\nbin/catalina.sh start -config conf/server_hermes.xml -debug \n"}, {"count": 6, "tags": [], "bug_id": 3896, "is_private": false, "id": 6265, "creation_time": "2001-10-02T00:55:41Z", "time": "2001-10-02T00:55:41Z", "creator": "remm@apache.org", "text": "Do not edit the startup scripts, or otherwise, you're on your own.\nIf the system CL contains servlet.jar, you have to remove servlet.jar from \ncommon/lib (just put it somewhere else on your hard drive), otherwise, it will \nget loaded twice (because of a class loading delegation problem in 4.0 final) \nand you'll get class conflicts.", "attachment_id": null}, {"text": "Putting servlet.jar in the classpath and removing it from common/lib solved the \nproblem.\n\nThank you.", "tags": [], "creator": "faensen@inf.fu-berlin.de", "attachment_id": null, "count": 7, "id": 6266, "time": "2001-10-02T02:17:48Z", "bug_id": 3896, "creation_time": "2001-10-02T02:17:48Z", "is_private": false}]
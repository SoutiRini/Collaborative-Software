[{"count": 0, "tags": [], "bug_id": 54747, "attachment_id": 30099, "text": "Created attachment 30099\ncluster setting\n\nI setup two Tomcat nodes with Apache mod_jk to build cluster environment. In the startup log, I find the following message.\n\nMar 25, 2013 2:13:59 PM org.apache.catalina.ha.tcp.SimpleTcpCluster registerManager\nWARNING: Manager [ org.apache.catalina.session.StandardManager[/test]] does not implement ClusterManager, addition to cluster has been aborted.\n\nTo reproduce the issue\n1. Start both Tomcat nodes and Apache Http server.\n2. Navigation test.jsp and refresh several times, shall see counter increased.\n3. Stop one Tomcat node, refresh the page again, the counter restart from 1 again.\n\nThe attached files are my settings and simple test case.", "id": 166126, "time": "2013-03-25T06:37:16Z", "creator": "vincentjian@potix.com", "creation_time": "2013-03-25T06:37:16Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 30100\nTest case (test.jsp)", "attachment_id": 30100, "id": 166127, "creator": "vincentjian@potix.com", "time": "2013-03-25T06:37:36Z", "bug_id": 54747, "creation_time": "2013-03-25T06:37:36Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 54747, "attachment_id": null, "text": "I also test it with Tomcat 7.0.16 and it works fine.", "id": 166128, "time": "2013-03-25T06:39:31Z", "creator": "vincentjian@potix.com", "creation_time": "2013-03-25T06:39:31Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 54747, "text": "Is your /test context marked as \"distributable\" in web.xml?", "id": 166131, "time": "2013-03-25T09:26:16Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2013-03-25T09:26:16Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 54747, "attachment_id": null, "text": "Yes, I have the <distributable /> tag in web.xml", "id": 166133, "time": "2013-03-25T10:06:08Z", "creator": "vincentjian@potix.com", "creation_time": "2013-03-25T10:06:08Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 54747, "attachment_id": null, "id": 166192, "time": "2013-03-28T08:52:30Z", "creator": "kfujino@apache.org", "creation_time": "2013-03-28T08:52:30Z", "is_private": false, "text": "According to the log message above, your /test context is using org.apache.catalina.session.StandardManager as a session manager.\n\nIn this case, since you have a <distributable /> in web.xml,\nMaybe <Manager className=\"org.apache.catalina.session.StandardManager\" /> has been defined in context.xml.\n\nYou can check the following context.xml.\n-webapps/test/META-INF/context.xml\n-conf/context.xml\n-conf/Catalina/localhost/test.xml"}, {"count": 6, "tags": [], "bug_id": 54747, "attachment_id": null, "id": 166194, "time": "2013-03-28T09:14:26Z", "creator": "vincentjian@potix.com", "creation_time": "2013-03-28T09:14:26Z", "is_private": false, "text": "(In reply to comment #5)\n> According to the log message above, your /test context is using\n> org.apache.catalina.session.StandardManager as a session manager.\n> \n> In this case, since you have a <distributable /> in web.xml,\n> Maybe <Manager className=\"org.apache.catalina.session.StandardManager\" />\n> has been defined in context.xml.\n> \n> You can check the following context.xml.\n> -webapps/test/META-INF/context.xml\n> -conf/context.xml\n> -conf/Catalina/localhost/test.xml\n\nI checked the following three place.\n1. -webapps/test/META-INF/context.xml\nI don't have context.xml file under web project.\n2. -conf/context.xml\nThe content is default, I didn't edit the file.\n3. -conf/Catalina/localhost/test.xml\nI can't find the file in the path.\n\nAre there other settings I need to check?"}, {"count": 7, "attachment_id": null, "creator": "knst.kolinko@gmail.com", "text": "(In reply to comment #4)\n> Yes, I have the <distributable /> tag in web.xml\n\n- What version of specification is your web.xml marked with?\n\n- Do you have metadata-complete=\"true\" in your web.xml?\n\nNote that distributable feature is not enables unless all web fragments have the <distributable /> tag.\n\n(In reply to comment #6)\n> \n> I checked the following three place.\n> 1. -webapps/test/META-INF/context.xml\n> I don't have context.xml file under web project.\n> 2. -conf/context.xml\n> The content is default, I didn't edit the file.\n> 3. -conf/Catalina/localhost/test.xml\n> I can't find the file in the path.\n> \n> Are there other settings I need to check?\n\nAlso\n4. conf/Catalina/localhost/context.xml.default\n\nhttp://tomcat.apache.org/tomcat-7.0-doc/config/context.html#Defining_a_context", "id": 166206, "time": "2013-03-28T16:39:35Z", "bug_id": 54747, "creation_time": "2013-03-28T16:39:35Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 54747, "text": "(In reply to comment #7)\n> (In reply to comment #4)\n> > Yes, I have the <distributable /> tag in web.xml\n> \n> - What version of specification is your web.xml marked with?\n\nVersion number is 3.0\n\n> \n> - Do you have metadata-complete=\"true\" in your web.xml?\n\nNo\n\n> \n> Note that distributable feature is not enables unless all web fragments have\n> the <distributable /> tag.\n\nMy webapp doesn't contains any web fragments.\n\n> \n> (In reply to comment #6)\n> > \n> > I checked the following three place.\n> > 1. -webapps/test/META-INF/context.xml\n> > I don't have context.xml file under web project.\n> > 2. -conf/context.xml\n> > The content is default, I didn't edit the file.\n> > 3. -conf/Catalina/localhost/test.xml\n> > I can't find the file in the path.\n> > \n> > Are there other settings I need to check?\n> \n> Also\n> 4. conf/Catalina/localhost/context.xml.default\n> \n\nActually, the folder is empty in my machine.\n\n> http://tomcat.apache.org/tomcat-7.0-doc/config/context.\n> html#Defining_a_context\n\nIt is really strange that the same war file work fine for Tomcat 7.0.16 but not with Tomcat 7.0.37.", "id": 166217, "time": "2013-03-29T03:33:46Z", "creator": "vincentjian@potix.com", "creation_time": "2013-03-29T03:33:46Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 54747, "attachment_id": 30116, "id": 166218, "time": "2013-03-29T03:35:13Z", "creator": "vincentjian@potix.com", "creation_time": "2013-03-29T03:35:13Z", "is_private": false, "text": "Created attachment 30116\nTest war\n\nAdd the war file I test on Tomcat 7.0.16 and 7.0.37."}, {"count": 10, "tags": [], "bug_id": 54747, "attachment_id": null, "id": 166237, "time": "2013-03-29T21:44:24Z", "creator": "markt@apache.org", "creation_time": "2013-03-29T21:44:24Z", "is_private": false, "text": "That test WAR works for me with a clean Tomcat 7.0.x install and uncommenting the cluster section in server.xml."}, {"count": 11, "tags": [], "bug_id": 54747, "text": "(In reply to comment #8)\n> (In reply to comment #7)\n> > (In reply to comment #4)\n> > > Yes, I have the <distributable /> tag in web.xml\n> > \n> > - What version of specification is your web.xml marked with?\n> \n> Version number is 3.0\n> \n> > \n> > - Do you have metadata-complete=\"true\" in your web.xml?\n> \n> No\n> \n> > \n> > Note that distributable feature is not enables unless all web fragments have\n> > the <distributable /> tag.\n> \n> My webapp doesn't contains any web fragments.\n> \n\nYou have not disabled scanning for web fragments. Thus there may be jar in your classpath that have one.\n\nJust an example,\nhttps://jira.springsource.org/browse/SPR-10219", "id": 166243, "time": "2013-03-30T08:47:06Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2013-03-30T08:47:06Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 54747, "text": "(In reply to comment #10)\n> That test WAR works for me with a clean Tomcat 7.0.x install and\n> uncommenting the cluster section in server.xml.\n\nDoes the session replication works in your test, because I also test with clean Tomcat 7.0.37, but the session replication doesn't work but 7.0.16 works fine.\n\nHere is the step that I reproduce the issue\n1. Start both Tomcat nodes and Apache Http server.\n2. Navigation test.jsp and refresh several times, shall see counter increased.\n3. Stop one Tomcat node, refresh the page again, the counter restart from 1 again.", "id": 166283, "time": "2013-04-01T01:40:54Z", "creator": "vincentjian@potix.com", "creation_time": "2013-04-01T01:40:54Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 54747, "attachment_id": null, "text": "(In reply to comment #11)\n> (In reply to comment #8)\n> > (In reply to comment #7)\n> > > (In reply to comment #4)\n> > > > Yes, I have the <distributable /> tag in web.xml\n> > > \n> > > - What version of specification is your web.xml marked with?\n> > \n> > Version number is 3.0\n> > \n> > > \n> > > - Do you have metadata-complete=\"true\" in your web.xml?\n> > \n> > No\n> > \n> > > \n> > > Note that distributable feature is not enables unless all web fragments have\n> > > the <distributable /> tag.\n> > \n> > My webapp doesn't contains any web fragments.\n> > \n> \n> You have not disabled scanning for web fragments. Thus there may be jar in\n> your classpath that have one.\n> \n> Just an example,\n> https://jira.springsource.org/browse/SPR-10219\n\nI test the war file with no jars in WEB-INF/lib folder. I think there is no web fragments issue here.", "id": 166284, "time": "2013-04-01T01:42:11Z", "creator": "vincentjian@potix.com", "creation_time": "2013-04-01T01:42:11Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 54747, "attachment_id": null, "id": 166285, "time": "2013-04-01T01:44:55Z", "creator": "vincentjian@potix.com", "creation_time": "2013-04-01T01:44:55Z", "is_private": false, "text": "BTW, here is the cluster settings in my server.xml.\n\n<Cluster className=\"org.apache.catalina.ha.tcp.SimpleTcpCluster\"/>\n\nI still see the following log message:\nWARNING: Manager [ org.apache.catalina.session.StandardManager[/test]] does not implement ClusterManager, addition to cluster has been aborted.\n\nI also change the cluster setting following Tomcat document like attachment I added. Still see the warning log."}, {"count": 15, "tags": [], "bug_id": 54747, "attachment_id": null, "text": "I trace the source code and found where the warning message is logged in SimpleTcpCluster.registerManager\n\nif (! (manager instanceof ClusterManager)) {\n    log.warn(\"Manager [ \" + manager + \"] does not implement ClusterManager, addition to cluster has been aborted.\");\n    return;\n}\nClusterManager cmanager = (ClusterManager) manager ;\ncmanager.setDistributable(true);\n\n\nSo I assume <distributable /> tag is not the problem here.", "id": 166286, "time": "2013-04-01T02:02:48Z", "creator": "vincentjian@potix.com", "creation_time": "2013-04-01T02:02:48Z", "is_private": false}, {"count": 16, "tags": [], "text": "I still have the problem, did you really test the session replication with my sample war and not seeing any warning message in catalina.log?", "attachment_id": null, "id": 166346, "creator": "vincentjian@potix.com", "time": "2013-04-03T01:22:00Z", "bug_id": 54747, "creation_time": "2013-04-03T01:22:00Z", "is_private": false}, {"count": 17, "tags": [], "bug_id": 54747, "attachment_id": null, "id": 166474, "time": "2013-04-08T13:41:41Z", "creator": "markt@apache.org", "creation_time": "2013-04-08T13:41:41Z", "is_private": false, "text": "This works for me. There is no evidence of a bug here. Bugzilla is not a support forum. The users list is the place to seek help with what looks very much like a configuration error. If further investigations via the users list does identify a bug then feel free to re-open this and provide the exact steps to reproduce the issue with a clean installation of the latest Tomcat 7.0.x release."}]
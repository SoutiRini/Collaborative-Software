[{"count": 0, "tags": [], "bug_id": 6178, "attachment_id": null, "text": "The color palette of .bmp files with 1 bit/pixel is not used when loading image.\nExample of a bmp header I've received from Alchemy on Unix:\n\n0000  424DAE8E01000000 00003E0000002800\n0010  000016030000FC03 0000010001000000\n0020  0000708E0100C21E 0000C21E00000000\n0030  000000000000FFFF FF00000000000000\n0040  0000000000000000 0000000000000000\n\nThe palette is inverted (why, I don't know). So a 0 bit means a white pixel and \na 1 bit means a black pixel.\nIn class org.apache.fop.image.BmpImage, method loadImage ignores the palette in \nthat case (it's not even constructed). For FOP, a 0 bit means always black \npixel and a 1 bit means always white pixel.\nSo my image appears in Acrobat Reader as inverted video.\n\nI have fixed the bug with the following statements :\n\nif (headermap[28] == 4 || headermap[28] == 8 || headermap[28] == 1) {\n\nto always build the palette and \n\nfor (int countr = 0; countr < 8 && x < this.m_width;\n\t\tcountr++) {\n\tif ((p & 0x80) != 0) {\n\t\tthis.m_bitmaps[3 * (i * this.m_width + x)] =\n//\t\t\t(byte)0xFF;\n\t\t\tpalette[3];\n\t\tthis.m_bitmaps[3 * (i * this.m_width + x) + 1] =\n//\t\t\t(byte)0xFF;\n\t\t\tpalette[4];\n\t\tthis.m_bitmaps[3 * (i * this.m_width + x) + 2] =\n//\t\t\t(byte)0xFF;\n\t\t\tpalette[5];\n\t} else {\n\t\tthis.m_bitmaps[3 * (i * this.m_width + x)] =\n//\t\t\t(byte)0;\n\t\t\tpalette[0];\n\t\tthis.m_bitmaps[3 * (i * this.m_width + x) + 1] =\n//\t\t\t(byte)0;\n\t\t\tpalette[1];\n\t\tthis.m_bitmaps[3 * (i * this.m_width + x) + 2] =\n//\t\t\t(byte)0;\n\t\t\tpalette[2];\n}\n\nto use it.\nI think it could help.\n\nFr\u00e9d\u00e9ric.", "id": 10166, "time": "2002-02-01T15:19:13Z", "creator": "fgachet@questel.fr", "creation_time": "2002-02-01T15:19:13Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 6178, "text": "Could you please provide a small example of such bml image?", "id": 26600, "attachment_id": null, "creator": "oleg@tkachenko.com", "creation_time": "2002-11-19T17:50:20Z", "time": "2002-11-19T17:50:20Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 6178, "text": "Fixed.", "id": 26652, "attachment_id": null, "creator": "oleg@tkachenko.com", "creation_time": "2002-11-20T14:11:52Z", "time": "2002-11-20T14:11:52Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 6178, "attachment_id": null, "is_private": false, "id": 156301, "time": "2012-04-01T07:08:58Z", "creator": "gadams@apache.org", "creation_time": "2012-04-01T07:08:58Z", "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed"}]
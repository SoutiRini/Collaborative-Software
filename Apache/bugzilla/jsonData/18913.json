[{"count": 0, "tags": [], "bug_id": 18913, "attachment_id": null, "is_private": false, "id": 34896, "time": "2003-04-10T17:45:55Z", "creator": "scottb@bxwa.com", "creation_time": "2003-04-10T17:45:55Z", "text": "When my client app sends this request against a 60KB file\n\nGET /test/ad1s_0001.fbs?u=none&0.6456 HTTP/1.1\nAccept: */*\nRange: bytes=0-6455\nIf-Modified-Since: Mon, 10 Mar 2003 19:54:40 GMT\n\nThe response is:\nHTTP/1.1 416 Requested Range Not Satisfiable\n\nExpecting\nHTTP/1.1 304 Not Changed\nor\nHTTP/1.1 206 Partial Content\ndepending on the timestamp\n\nWithout the If-Modified-Since header I get 206.\nWithout the Range header I get 304 or 200.\n\nBut not together. It appears that it's trying to process the range header after\nit has already determined that the response is 304 and there is no response body.\n\nWorks fine in 1.3. I've come up with this patch which works for me but I'm not\nintimate with the system so I'm not positive that it's the proper approach to\nsolve the problem. (Also not sure of the diff options.)\n\nI've tried reproducing the problem with 2.0.45 but I don't have the libs, mods,\nperl, etc. to run it. The source looks the same and I couldn't find any bug\nreport related to it.\n\nNot a major problem but a \"Must Patch\" for our operation.\n\nThanks\nScott Becker\n\n\n--- http-2.0.40/modules/http_protocol.c.orig        2002-08-04\n11:24:10.000000000 -0700\n+++ http-2.0.40/modules/http_protocol.c     2003-04-08 15:28:09.000000000 -0700\n@@ -2794,6 +2794,15 @@\n     apr_status_t rv;\n     int found = 0;\n\n+\n+    if (r->status == HTTP_NOT_MODIFIED) {\n+       /* we can't process byte ranges when we are not returning a body at all */\n+        ap_remove_output_filter(f);\n+        return ap_pass_brigade(f->next, bb);\n+    }\n+\n+\n+\n     if (!ctx) {\n         int num_ranges = ap_set_byterange(r);"}, {"attachment_id": null, "tags": [], "bug_id": 18913, "is_private": false, "count": 1, "id": 34908, "time": "2003-04-10T19:08:46Z", "creator": "scottb@bxwa.com", "creation_time": "2003-04-10T19:08:46Z", "text": "I just found a web site using 2.0.45-dev which gave a timestamp so I could test\nit with the latest release. Sure enough it works fine.\n\n# curl -i -r bytes=0-9 -z 'Thu, 10 Apr 2003 13:31:20 GMT' http://perl.apache.org/\nHTTP/1.1 304 Not Modified\nDate: Thu, 10 Apr 2003 18:30:51 GMT\nServer: Apache/2.0.45-dev (Unix)\nETag: \"41a9cb-71c1-dd22da00\"\n\nI just dug the patch out of CVS with the proper way to ignore Range which was\napplied to 2.0.44.\n\nSorry for bothering. At least now there's a closed bug report documenting it.\n\nScott Becker"}]
[{"count": 0, "tags": [], "bug_id": 10088, "is_private": false, "text": "TraverseSchema will throw a NPE in its openRedefinedSchema method if the \nEntityResolver returns an InputSource from its resolveEntity method which has a \nnull systemId.\n\nThe source code that is causing the problem is:\n\n    private void openRedefinedSchema(Element redefineDecl, SchemaInfo store) \nthrows Exception {\n        Attr locationAttr = redefineDecl.getAttributeNode\n(SchemaSymbols.ATT_SCHEMALOCATION);\n        if (locationAttr == null) {\n            // REVISIT: Localize\n            fRedefineSucceeded = false;\n            reportGenericSchemaError(\"a schemaLocation attribute must be \nspecified on a <redefine> element\");\n            return;\n        }\n        String location = locationAttr.getValue();\n\n        // expand it before passing it to the parser\n        InputSource source = null;\n        if (fEntityResolver != null) {\n            source = fEntityResolver.resolveEntity(\"\", location);\n        }\n\n        if (source == null) {\n            location = expandSystemId(location, fCurrentSchemaURL);\n            source = new InputSource(location);\n        }\n        // Make sure we don't redefine the same schema twice; it's allowed\n        // but the specs encourage us to avoid it.\n        // algorithm:  string is pubId+sysId or if both null then filename\n        String pubId = \"\";\n        String sysId = \"\";\n        if (source.getPublicId () != null)\n            pubId = source.getPublicId ();\n        if (source.getSystemId () != null)\n            sysId = source.getSystemId ();\n\n        if(pubId.length() != 0 || sysId.length() != 0)\n            location += pubId+sysId;\n\n        // make sure we're not redefining ourselves!\n        if(source.getSystemId().equals(fCurrentSchemaURL)) { // NPE if \nsource.getSystemId() == null!\n\nPossible solutions are to use the sysId variable which was previously set, or \nto require that the redefined schema's systemId be non-null and throw an \nexception with the appropriate message, or to require that either the current \nschema's systemId or the redefined schema's systemId be non-null and throw the \nappropriate exception.", "id": 18242, "time": "2002-06-20T19:59:35Z", "creator": "clyde.gerber@lawson.com", "creation_time": "2002-06-20T19:59:35Z", "attachment_id": null}]
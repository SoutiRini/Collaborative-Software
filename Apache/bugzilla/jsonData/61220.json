[{"count": 0, "tags": [], "bug_id": 61220, "attachment_id": null, "text": "macmini:httpd-2.2.33 mark$ telnet localhost 8033\nTrying ::1...\nConnected to localhost.\nEscape character is '^]'.\nGET / HTTP/1.1\nHost: foobar\nx: 0\n\nHTTP/1.1 400 Bad Request\nDate: Sun, 25 Jun 2017 21:43:53 GMT\nServer: Apache/2.2.33 (Unix)\nContent-Length: 226\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>400 Bad Request</title>\n</head><body>\n<h1>Bad Request</h1>\n<p>Your browser sent a request that this server could not understand.<br />\n</p>\n</body></html>\nConnection closed by foreign host.", "id": 199406, "time": "2017-06-25T21:53:58Z", "creator": "mark@blackmans.org", "creation_time": "2017-06-25T21:53:58Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 61220, "is_private": false, "id": 199407, "time": "2017-06-25T21:55:11Z", "creator": "mark@blackmans.org", "creation_time": "2017-06-25T21:55:11Z", "tags": [], "text": "Note that the configuration directive\n\nHttpProtocolOptions Unsafe LenientMethods Allow0.9\n\nmust be used to trigger this effect."}, {"count": 2, "tags": [], "bug_id": 61220, "attachment_id": null, "text": "Verbose logging shows\n\n[[Sun Jun 25 23:27:25 2017] [notice] Apache/2.2.33 (Unix) configured -- resuming normal operations\n[Sun Jun 25 23:27:25 2017] [info] Server built: Jun 25 2017 22:42:22\n[Sun Jun 25 23:27:25 2017] [debug] prefork.c(1023): AcceptMutex: sysvsem (default: sysvsem)\n[Sun Jun 25 23:27:32 2017] [debug] protocol.c(1111): [client ::1] Request header field name was empty\n[Sun Jun 25 23:27:32 2017] [debug] protocol.c(1298): [client ::1] request failed: error reading the headers", "id": 199409, "time": "2017-06-25T22:28:45Z", "creator": "mark@blackmans.org", "creation_time": "2017-06-25T22:28:45Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 61220, "text": "https://github.com/apache/httpd/blob/2.2.x/server/protocol.c#L1109  \n\nthat comparison is probably inappropriate for the case of a single character header and some other logic will be required. Can't decide which exactly.", "id": 199410, "time": "2017-06-25T22:43:30Z", "creator": "mark@blackmans.org", "creation_time": "2017-06-25T22:43:30Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 61220, "is_private": false, "id": 199412, "time": "2017-06-26T03:05:15Z", "creator": "wrowe@apache.org", "creation_time": "2017-06-26T03:05:15Z", "tags": [], "text": "Yes, that line 1109 is a issue. But it was caused by a late bugfix at https://github.com/apache/httpd/blob/2.2.x/server/protocol.c#L1085\n\nThinking that since the zero-char and single-char resolve to the same pointers, a really simple fix to line 1109 is;\n\n                if (tmp_field == last_field && !*last_field) {\n\nif you want to test that fix out.\n\nThe idea of this code block is to look as similar to this code as possible;\n\nhttps://github.com/apache/httpd/blob/2.2.31/server/protocol.c#L810\n\nwith two exceptions; empty fields always prohibited, and trailing whitespace after the field name always prohibited. There may be a cleaner path than the current release plus the hack above to get from point A to point B."}, {"count": 5, "tags": [], "creator": "mark@blackmans.org", "attachment_id": null, "is_private": false, "id": 199449, "time": "2017-06-27T14:24:33Z", "bug_id": 61220, "creation_time": "2017-06-27T14:24:33Z", "text": "I can confirm that change to line 1109\n\n                if (tmp_field == last_field && !*last_field) {\n\nachieves the goal of permitting single-character headers and returns a 400 for a zero character header, ie.\n\n\"x: 0\"  returns 200\n\": 0\" returns 400\n\n\nSomewhat confusingly, things like \n\n\"   : 0\" return 200"}, {"count": 6, "tags": [], "bug_id": 61220, "text": "> things like \"   : 0\" return 200\n\nAs the first line, yes, in subsequent lines it is a continuation of the previous header line.\n\nUnsafe is strongly discouraged for many reasons, and may be worth removing altogether from the next 2.x/3.0 major release of httpd.", "id": 199452, "time": "2017-06-27T18:58:26Z", "creator": "wrowe@apache.org", "creation_time": "2017-06-27T18:58:26Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 61220, "attachment_id": null, "id": 199454, "time": "2017-06-27T22:13:34Z", "creator": "wrowe@apache.org", "creation_time": "2017-06-27T22:13:34Z", "is_private": false, "text": "(In reply to William A. Rowe Jr. from comment #6)\n> > things like \"   : 0\" return 200\n> \n> As the first line, yes, in subsequent lines it is a continuation of the\n> previous header line.\n\nRetesting, I was wrong. The first line \" x-y: test\" or simply \" :\" the leading space results in a 400 response, in both strict and unsafe modes, as expected, since the 2.2.32 / 2.4.25 releases.\n\nWhat you thought in subsequent lines was a header line was not; it was a continuation of the previous header line (they are merged, you will see that colon appended to the header field named in the previous line.)\n\nE.g.\nHost:localhost\n :test\nresults in a Host header value \"localhost :test\"\n\nThat's called an obs-fold and is permitted by design."}, {"count": 8, "attachment_id": null, "bug_id": 61220, "is_private": false, "id": 199458, "time": "2017-06-28T05:58:48Z", "creator": "wrowe@apache.org", "creation_time": "2017-06-28T05:58:48Z", "tags": [], "text": "Fixed in trunk; http://svn.apache.org/r1800111 and proposed for backport."}, {"count": 9, "tags": [], "text": "Great, looking forward to it. I believe there's an alternate patch proposed as well", "is_private": false, "id": 199494, "creator": "mark@blackmans.org", "time": "2017-06-29T18:54:45Z", "bug_id": 61220, "creation_time": "2017-06-29T18:54:45Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 61220, "attachment_id": null, "text": "(In reply to mark from comment #9)\n> I believe there's an alternate patch proposed\n> as well\n\nCorrect, r1800215 and r1800216 are the final backports for next 2.4.27 and 2.2.34.", "id": 199498, "time": "2017-06-29T20:40:31Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2017-06-29T20:40:31Z", "is_private": false}]
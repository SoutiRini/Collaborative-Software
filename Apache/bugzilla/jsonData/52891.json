[{"count": 0, "tags": [], "bug_id": 52891, "is_private": false, "text": "We have written a modules for apache that for certain reasons requires\none hit per child.\nOn apache 1.3 this worked fine with a minor tweak to\nSCOREBOARD_MAINTENANCE_INTERVAL\nsetting it to 10000 from 1000000.\n\nNote that this behavior can be tested without our module by setting\n\"MaxRequestsPerChild 1\"\n\nWe have been running apache 1.3.41 with:\nMinSpareServers 500\nMaxSpareServers 600\nStartServers 550\n\nUsing JMeter to send some requests if we request a single page using 3\nthreads, apache has no problem keeping up and\ndoesn't dip below 485 idle servers. With debug logging on you see it\njumping from spawning 8 to 16 to 32 children. We didn't\nneed to increase the MAX_SPAWN_RATE from the default of 32 for apache to\nkeep up just fine.\n\nOutput from apachectl status\n   197 requests/sec - 28.6 kB/second - 148 B/request\n   5 requests currently being processed, 492 idle servers\n________________________________________________________________\n__________________________.___._________________________________\n________________________________._____________________________..\n__.___._.W_WW..WW_______________________________________________\n__________..__________________._..______________________________\n________________________________________________________________\n________________________________________________________________\n____________________________________....._..._.___________..__..\n........._________.____.........................................\n\n\nRecently we decided we should update our module for apache 2.2 . However\nwe found the performance of apache 2.2 was falling short\ncompared to apache 1.3.\n\nRunning apache 2.2.22 with the same number of servers falls down pretty\nquickly with the same load from JMeter.\nWithin a few seconds it drops down to 0 idle connections. In the\nerror_log you see apache constantly saying it's spawning\n32 children but the number of children are really low.  Example log\nentry \"spawning 32 children, there are 2 idle, and 9 total children\"\nOccasionally it will start catching up but quickly drop back down.\nExample log entry \"spawning 32 children, there are 169 idle, and 180\ntotal child\"\n\napachectl status:\n   27.8 requests/sec - 7.0 kB/second - 256 B/request\n   13 requests currently being processed, 0 idle workers\n CCCWCWRSSS............................CCCCCC....................\n ................................................................\n\n\napachectl status when it starts catching back up:\n  161 requests/sec - 11.4 kB/second - 72 B/request\n   4 requests currently being processed, 477 idle workers\n ___________C____WR____________________._________________________\n ________________________________________________________________\n ________.______.._......_...C___________________________________\n\n\nI have tried upping the MAX_SPAWN_RATE to 512 and starting off the\nidle_spawn_rate at 128 and never letting\nit fall below that. It seemed like things got marginally better but not\nby much. I realize most people would think\nwe are crazy for running one hit per child but it's just something we\nneed to do. This has all been tested on the\nsame hardware also. I tried stracing and running gprof but nothing\nseemed obvious. My best guess at this point\nis apache is taking to long to close connections or there is some other\nsleeps or something that I'm not seeing.\n\nAny thoughts on what could be the issue would be most appreciated.", "id": 154845, "time": "2012-03-12T20:11:55Z", "creator": "williamt@corp.sonic.net", "creation_time": "2012-03-12T20:11:55Z", "attachment_id": null}]
[{"count": 0, "attachment_id": null, "bug_id": 54440, "text": "In 7.0.35, I see the following NPE when compiling JSPX files via the <jasper> Ant task:\n\n   [jasper] java.lang.NullPointerException\n   [jasper] \tat org.apache.jasper.compiler.TagPluginManager.init(TagPluginManager.java:83)\n   [jasper] \tat org.apache.jasper.compiler.TagPluginManager.apply(TagPluginManager.java:57)\n   [jasper] \tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:240)\n   [jasper] \tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:373)\n   [jasper] \tat org.apache.jasper.JspC.processFile(JspC.java:1179)\n   [jasper] \tat org.apache.jasper.JspC.execute(JspC.java:1329)\n   [jasper] \tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)\n   [jasper] \tat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n   [jasper] \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [jasper] \tat java.lang.reflect.Method.invoke(Method.java:601)\n   [jasper] \tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n   [jasper] \tat org.apache.tools.ant.Task.perform(Task.java:348)\n   [jasper] \tat org.apache.tools.ant.Target.execute(Target.java:390)\n   [jasper] \tat org.apache.tools.ant.Target.performTasks(Target.java:411)\n   [jasper] \tat org.apache.tools.ant.Project.executeSortedTargets(Project.java:1399)\n   [jasper] \tat org.apache.tools.ant.Project.executeTarget(Project.java:1368)\n   [jasper] \tat org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n   [jasper] \tat org.apache.tools.ant.Project.executeTargets(Project.java:1251)\n   [jasper] \tat org.apache.tools.ant.Main.runBuild(Main.java:809)\n   [jasper] \tat org.apache.tools.ant.Main.startAnt(Main.java:217)\n   [jasper] \tat org.apache.tools.ant.launch.Launcher.run(Launcher.java:280)\n   [jasper] \tat org.apache.tools.ant.launch.Launcher.main(Launcher.java:109)\n\nThis didn't happen in 7.0.34.\n\nGiven the line and change from 7.0.34 (http://svn.apache.org/viewvc/tomcat/tc7.0.x/trunk/java/org/apache/jasper/compiler/TagPluginManager.java?r1=1402119&r2=1431228&diff_format=h) I assume that in...\n\n    urls = ctxt.getClassLoader().getResources(\n84\t \t                     META_INF_JASPER_TAG_PLUGINS_XML);\n\nthe ClassLoader is null, since ctxt was used here before and evidently not null.\n\nFall back to Thread.currentThread().getContextClassLoader() in this case?\n\n\nMy Ant snippet:\n\n    <import file=\"${tomcat.home}/bin/catalina-tasks.xml\"/>\n    ...\n    <jasper validateXml=\"false\"\n            failonerror=\"true\"\n            listerrors=\"true\"\n            trimspaces=\"true\"\n            uriroot=\"${module.web.basedir}/docs\"\n            outputDir=\"${module.web.basedir}/gen\"\n            package=\"*****\"\n            xpoweredBy=\"false\"/>", "id": 164685, "time": "2013-01-17T03:29:19Z", "creator": "srowen@apache.org", "creation_time": "2013-01-17T03:29:19Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 54440, "attachment_id": 29860, "id": 164687, "time": "2013-01-17T08:43:38Z", "creator": "xshao@ebay.com", "creation_time": "2013-01-17T08:43:38Z", "is_private": false, "text": "Created attachment 29860\nPatch for this issue\n\nThe root cause is that there is no ClassLoader was set in JspCServletContext.\nJspC holds the ClassLoader, but doesn't pass it to JspCServletContext.\n\nCould you try this patch ?"}, {"text": "Thank you, yes this patch appears to work. The <jasper> task succeeds, JSPX are compiled and then compile themselves, the app works. Looks good to me.", "tags": [], "bug_id": 54440, "attachment_id": null, "count": 2, "id": 164689, "time": "2013-01-17T10:29:18Z", "creator": "srowen@apache.org", "creation_time": "2013-01-17T10:29:18Z", "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 54440, "text": "Thanks all for the report, the patch and testing. That patch has been applied to trunk and will be included in 7.0.36 onwards.", "id": 164691, "time": "2013-01-17T13:21:55Z", "creator": "markt@apache.org", "creation_time": "2013-01-17T13:21:55Z", "tags": [], "is_private": false}, {"text": "*** Bug 54472 has been marked as a duplicate of this bug. ***", "tags": [], "bug_id": 54440, "is_private": false, "count": 4, "id": 164820, "time": "2013-01-23T09:07:47Z", "creator": "markt@apache.org", "creation_time": "2013-01-23T09:07:47Z", "attachment_id": null}]
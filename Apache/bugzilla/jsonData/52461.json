[{"count": 0, "tags": [], "bug_id": 52461, "attachment_id": null, "is_private": false, "id": 152732, "time": "2012-01-12T20:34:28Z", "creator": "violetagg@apache.org", "creation_time": "2012-01-12T20:34:28Z", "text": "Hello,\n\nI have a project that embeds Apache Tomcat in OSGi. I provide the default web.xml from my bundles (jar files) directly; I do not provide it in a separate folder on the file system. \n\nI am using Apache Tomcat 7.0.21, but now I want to migrate to Apache Tomcat 7.0.23. \n\nUnfortunately there is a change between these two versions and with Apache Tomcat 7.0.23 the following exception is thrown:\n\nCaused by: java.lang.IllegalArgumentException: URI scheme is not \"file\"\n\tat java.io.File.<init>(File.java:366)\n\tat org.apache.catalina.startup.ContextConfig.getDefaultWebXmlFragment(ContextConfig.java:1317)\n\tat org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1168)\n\tat org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:828)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:302)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)\n\tat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5148)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\t... 71 more|\n\nIn OSGi environment URI scheme is not \"file\", but \"bundleresource\". \nThe call \"globalWebXml.getSystemId()\" in OSGi environment returns \"bundleresource://94.fwk2102834054/conf/web.xml\"\n\nI would like to propose a change (below) in ContextConfig.getDefaultWebXmlFragment() method because there is no guarantee that the URI scheme will always be \"file\". The patch is made against 7.0.x trunc.\n\nI\u2019m looking forward to your comments.\n\nBest Regards\nVioleta Georgieva\n\nPatch proposal:\n\nIndex: ContextConfig.java\n===================================================================\n--- ContextConfig.java\t(revision 1230565)\n+++ ContextConfig.java\t(working copy)\n@@ -29,7 +29,6 @@\n import java.io.UnsupportedEncodingException;\n import java.net.JarURLConnection;\n import java.net.MalformedURLException;\n-import java.net.URI;\n import java.net.URISyntaxException;\n import java.net.URL;\n import java.net.URLConnection;\n@@ -1324,20 +1323,24 @@\n         \n         if (globalWebXml != null) {\n             try {\n-                File f = new File(new URI(globalWebXml.getSystemId()));\n-                globalTimeStamp = f.lastModified();\n-            } catch (URISyntaxException e) {\n+                URL f = new URL(globalWebXml.getSystemId());\n+                globalTimeStamp = f.openConnection().getLastModified();\n+            } catch (MalformedURLException e) {\n                 globalTimeStamp = -1;\n-            }\n+            } catch (IOException e) {\n+            \tglobalTimeStamp = -1;\n+\t\t\t}\n         }\n         \n         if (hostWebXml != null) {\n             try {\n-                File f = new File(new URI(hostWebXml.getSystemId()));\n-                hostTimeStamp = f.lastModified();\n-            } catch (URISyntaxException e) {\n+                URL f = new URL(hostWebXml.getSystemId());\n+                hostTimeStamp = f.openConnection().getLastModified();\n+            } catch (MalformedURLException e) {\n                 hostTimeStamp = -1;\n-            }\n+            } catch (IOException e) {\n+            \tglobalTimeStamp = -1;\n+\t\t\t}\n         }\n         \n         if (entry != null && entry.getGlobalTimeStamp() == globalTimeStamp &&"}, {"count": 1, "tags": [], "bug_id": 52461, "attachment_id": null, "text": "Fixed in trunk and 7.0.x and will be included in 7.0.24 onwards.", "id": 152762, "time": "2012-01-13T20:46:41Z", "creator": "markt@apache.org", "creation_time": "2012-01-13T20:46:41Z", "is_private": false}, {"count": 2, "tags": [], "creator": "violetagg@apache.org", "text": "Thank you!\nVioleta", "id": 152786, "time": "2012-01-14T18:20:33Z", "bug_id": 52461, "creation_time": "2012-01-14T18:20:33Z", "is_private": false, "attachment_id": null}]
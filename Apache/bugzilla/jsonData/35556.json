[{"count": 0, "tags": [], "creator": "jhaar@trimble.co.nz", "text": "I have a CentOS 4.1 server running httpd-2.0.52-12.ent.centos4 using client\ncertificates for authentication. \n\nWe have an internal CA that regenerates CRLs every hour, and they are signed as\nbeing valid for 24 hours. We have an automated process for pushing those CRL\nfiles out to Web servers and other devices that need them.\n\nOn this 2.0.52 server, the revocation data is referenced via:\n\nSSLCARevocationFile /etc/httpd/conf/ssl.crl/Our-CA.crl\n\nWhat is happening is that even though that file is being updated with a new CRL\nfile every hour, only a full restart (stop, start) of Apache makes it re-read\nthe CRL! If we send a HUP, it doesn't re-read it.\n\nAt that stage you see the \"Found CRL is expired - revoking all certificates\nuntil you get updated CRL\" error message and noone can access the server via\ncerts any more.", "id": 76824, "time": "2005-06-30T01:35:28Z", "bug_id": 35556, "creation_time": "2005-06-30T01:35:28Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "I don't know, what this package includes. Have you tried using a more recent\nversion (2.0.54 is current)? Does the error log show something (that the restart\nreally happend, errors from mod_ssl)? Tried a vanilla httpd?", "is_private": false, "id": 78480, "creator": "nd@perlig.de", "time": "2005-08-14T12:29:24Z", "bug_id": 35556, "creation_time": "2005-08-14T12:29:24Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "count": 2, "id": 79447, "time": "2005-09-06T15:11:43Z", "bug_id": 35556, "creation_time": "2005-09-06T15:11:43Z", "text": "Can't reproduce here.  Could be a permissions/SELinux issue, possibly.  Can you\ntry running:\n\n  strace -eopen `cat /var/run/httpd.pid`\n\nas root and then HUP the server, and check whether the CRL file is opened OK."}, {"count": 3, "tags": [], "text": "This may be a more general, but related, bug.  We are using 2.0.58 and have \nsimmilar issues when we change the crt or key files.  We have patches:\n\napache-ssldos apxs.envvars apxs.no-httpd-check http_banner http_method\n\nHere I changed the crt:\n\n# strace -eopen -p 1460\nProcess 1460 attached - interrupt to quit\n--- SIGHUP (Hangup) @ 0 (0) ---\n--- SIGHUP (Hangup) @ 0 (0) ---\n--- SIGCHLD (Child exited) @ 0 (0) ---\nopen(\"/etc/httpd/conf/httpd.conf\", O_RDONLY) = 5\nopen(\"/var/run/config/httpd.conf.d\", \nO_RDONLY|O_NONBLOCK|O_LARGEFILE|O_DIRECTORY) = 6\nopen(\"/var/run/config/httpd.conf.d/mod_auth_pam.conf\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_auth_pam.so\", O_RDONLY) = 14\nopen(\"/etc/ld.so.cache\", O_RDONLY)      = 14\nopen(\"/lib/libpam.so.0\", O_RDONLY)      = 14\nopen(\"/var/run/config/httpd.conf.d/ssl.conf\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_ssl.so\", O_RDONLY) = 14\nopen(\"/etc/httpd/modules/mod_access.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_auth.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_auth_anon.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_auth_f5_auth_token.so\", O_RDONLY) = 6\nopen(\"/etc/ld.so.cache\", O_RDONLY)      = 6\nopen(\"/usr/lib/libf5util.so\", O_RDONLY) = 6\nopen(\"/usr/lib/libcpp.so.11\", O_RDONLY) = 6\nopen(\"/usr/lib/libmcp.so\", O_RDONLY)    = 6\nopen(\"/usr/lib/libstdc++.so.5\", O_RDONLY) = 6\nopen(\"/lib/libgcc_s.so.1\", O_RDONLY)    = 6\nopen(\"/etc/httpd/modules/mod_include.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_log_config.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_env.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_expires.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_headers.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_setenvif.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_mime.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_autoindex.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_asis.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_negotiation.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_dir.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_actions.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_alias.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_cgi.so\", O_RDONLY) = 6\nopen(\"/etc/httpd/modules/mod_jk2.so\", O_RDONLY) = 6\nopen(\"/usr/lib/httpd/modules/mod_fastcgi.so\", O_RDONLY) = 6\nopen(\"/etc/passwd\", O_RDONLY)           = 5\nopen(\"/etc/group\", O_RDONLY)            = 5\nopen(\"/etc/group\", O_RDONLY)            = 5\nopen(\"/etc/passwd\", O_RDONLY)           = 5\nopen(\"/etc/hosts\", O_RDONLY)            = 5\nopen(\"/dev/null\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 2\nopen(\"/etc/httpd/conf/ssl.crt/server.crt\", O_RDONLY) = 14\nopen(\"/etc/httpd/conf/ssl.crt/server.crt\", O_RDONLY) = 14\nopen(\"/etc/httpd/conf/ssl.key/server.key\", O_RDONLY) = 14\nopen(\"/etc/httpd/conf/ssl.key/server.key\", O_RDONLY) = 14\nopen(\"/etc/httpd/logs/ssl_mutex.1456\", O_WRONLY|O_CREAT|O_EXCL, 0644) = 14\nopen(\"/var/cache/mod_ssl/scache.dir\", O_RDWR|O_CREAT, 0644) = 16\nopen(\"/var/cache/mod_ssl/scache.pag\", O_RDWR|O_CREAT, 0644) = 17\nopen(\"/var/cache/mod_ssl/scache.dir\", O_RDWR|O_CREAT, 0644) = 16\nopen(\"/var/cache/mod_ssl/scache.pag\", O_RDWR|O_CREAT, 0644) = 17\nopen(\"/var/cache/mod_ssl/scache.dir\", O_RDWR|O_CREAT, 0644) = 16\nopen(\"/var/cache/mod_ssl/scache.pag\", O_RDWR|O_CREAT, 0644) = 17\nProcess 1460 detached\n", "is_private": false, "id": 105759, "creator": "m.miller@f5.com", "time": "2007-07-18T11:39:47Z", "bug_id": 35556, "creation_time": "2007-07-18T11:39:47Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "After further investigation, it looks like it is working as advertised except \nfor /etc/rc.d/init.d/httpd reload.  The command and output:\n\n# /etc/init.d/httpd reload\nReloading httpd: [  OK  ]\n\nHere are the messages in httpd_errors:\n\nJul 18 11:34:12 mmiller-bigip1 httpd[1460]: [error] Unable to configure RSA \nserver private key\nJul 18 11:34:12 mmiller-bigip1 httpd[1460]: [error] SSL Library Error: \n185073780 error:0B080074:x509 certificate routines:X509_check_private_key:key \nvalues mismatch\n", "attachment_id": null, "id": 105760, "creator": "m.miller@f5.com", "time": "2007-07-18T11:56:25Z", "bug_id": 35556, "creation_time": "2007-07-18T11:56:25Z", "is_private": false}]
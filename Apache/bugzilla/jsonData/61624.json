[{"count": 0, "attachment_id": null, "creator": "hbenfeghoul@wideagency.com", "text": "My formula : &(COUNTIFS(G5:G{0},\"DISPO\",T5:T{0},\"IDF\",C5:C{0},\"<>STOP\")+COUNTIFS(G5:G{0},\"DISPO PA\",T5:T{0},\"IDF\",C5:C{0},\"<>STOP\")+COUNTIFS(G5:G{0},\"DISPO PARTIELLE\",T5:T{0},\"IDF\",C5:C{0},\"<>STOP\")/2)&\"  / dont PA : \"&COUNTIFS(G5:G{0},\"DISPO PA\",T5:T{0},\"IDF\",C5:C{0},\"<>STOP\")\n\nMy code :\nCell cellG = myRow.createCell(7);\n    cellG.setCellFormula(formuleXSemaine);\n    FormulaEvaluator evaluatorG = workbook.getCreationHelper().createFormulaEvaluator();\n    CellValue evaluateG = evaluatorG.evaluate(cellG);\n\nWhen i evaluate my formule the result is good, but when i open my XLS File the formula doesn't work i have #NOM? and COUNTIFS isn't converted to NB.SI.ENS", "id": 201489, "time": "2017-10-17T08:42:24Z", "bug_id": 61624, "creation_time": "2017-10-17T08:42:24Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "POI doesn't do any formula translation, that's all done in Excel UI localization code.  \n\nPOI operates only on the OOXML file, and the OOXML spec (and all files saved by internationalized versions of Excel) save all formulas and formats in US locale forms.\n\nThus if you want to set a formula for a cell using POI, you need to set the US English function names, the ones listed as supported by POI [1]\n\n[1] https://poi.apache.org/spreadsheet/formula.html", "is_private": false, "id": 201508, "creator": "gwoolsey@apache.org", "time": "2017-10-17T23:16:13Z", "bug_id": 61624, "creation_time": "2017-10-17T23:16:13Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 61624, "is_private": false, "id": 201511, "time": "2017-10-18T14:03:22Z", "creator": "hbenfeghoul@wideagency.com", "creation_time": "2017-10-18T14:03:22Z", "tags": [], "text": "COUNTIFS is not supported, so i will write FROMULA in FRENCH VERSION and users must execute in local the formule\nThanks for your answers"}, {"count": 3, "attachment_id": null, "creator": "onealj@apache.org", "is_private": false, "id": 201514, "time": "2017-10-18T15:04:40Z", "bug_id": 61624, "creation_time": "2017-10-18T15:04:40Z", "tags": [], "text": "(In reply to Herve from comment #2)\n> COUNTIFS is not supported\n\nThe COUNTIFS function *is* supported for XLSX files as part of the AnalysisToolPak, which must be loaded at runtime. COUNTIFS is not available in XLS.\n\nSupported for COUNTIFS was added in POI 3.10 via bug 55873\nhttps://poi.apache.org/changes.html#3.10-FINAL\n\nSupported functions:\nhttps://poi.apache.org/spreadsheet/eval-devguide.html#Appendix+A\n\nImplementation\nhttps://svn.apache.org/viewvc/poi/trunk/src/java/org/apache/poi/ss/formula/functions/Countifs.java\n\nAnalysisToolPak:\nhttps://svn.apache.org/viewvc/poi/trunk/src/java/org/apache/poi/ss/formula/atp/AnalysisToolPak.java\n\nUnit tests:\nhttps://svn.apache.org/viewvc/poi/trunk/src/ooxml/testcases/org/apache/poi/ss/formula/functions/CountifsTests.java\n\nOOXML saves formulas as strings instead of binary Ptgs, so it's possible that your version of Excel expects the function names to be translated into your locale.\n\nThe curly brackets ({0}) in your formula don't look like they're part of the standard Excel formula language spec and very likely not supported by POI. Maybe this is the source of the problem."}, {"count": 4, "tags": [], "bug_id": 61624, "text": "Perfect ! My formula works !\nThanks you for your quickly help !", "id": 201522, "time": "2017-10-18T16:09:21Z", "creator": "hbenfeghoul@wideagency.com", "creation_time": "2017-10-18T16:09:21Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "onealj@apache.org", "is_private": false, "id": 201523, "time": "2017-10-18T16:23:45Z", "bug_id": 61624, "creation_time": "2017-10-18T16:23:45Z", "tags": [], "text": "I'm curious if there is some language translation that should be performed for non-English Locales when reading or writing an XLS or XLSX file.\n\nIf there's anything that POI can reasonably do to make this easier, I'd be happy to entertain the idea."}, {"count": 6, "attachment_id": null, "creator": "gwoolsey@apache.org", "is_private": false, "id": 201526, "time": "2017-10-18T17:30:57Z", "bug_id": 61624, "creation_time": "2017-10-18T17:30:57Z", "tags": [], "text": "If I remember right, in the past I've experimented a bit and noticed that Excel always saves things in US-English locale.  That may even be part of the OOXML spec.  For example, number formats are saved with . for decimal separator and , for grouping, and translated dynamically by the UI based on Windows Locale settings.  Same with formula function names I think.\n\nI tried once to force different number conventions, but couldn't do it, having to tell users to make their Windows settings match the display they wanted."}, {"text": "Nothing left to do here as far as I see, the spec seems to mandate storing formulas in ENGLISH locale and thus we do it correctly already.", "tags": [], "bug_id": 61624, "is_private": false, "count": 7, "id": 202947, "time": "2017-12-28T13:55:01Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2017-12-28T13:55:01Z", "attachment_id": null}]
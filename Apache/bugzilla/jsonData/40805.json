[{"count": 0, "tags": [], "bug_id": 40805, "attachment_id": null, "text": "Environment:\n\nOSX & Linux\nApache 2.2.3\n\nProblem:\n\nUsing mod_rewrite in conjunction with mod_cache, when a requested object is\ncached, the path to the cache object is calculated by hashing on the requested\nURL (http://localhost/real). However, when retrieval of the object is attempted\non subsequent requests, the path to the cache object is calculated by hashing on\nthe requested URL *plus* the query string in the target of the RewriteRule.\n\n\nDetails:\n========\n\nhttpd config is the default config, plus:\n\nLogLevel debug\nExpiresActive on\nExpiresDefault A86400\n\n\nrewrite config:\n\nRewriteEngine on\nRewriteRule ^/real /index.html?foo=bar\n\ncache config:\n\nCacheEnable disk /\nCacheRoot /tmp/CACHE\n\nRequest:\n\nab -c 1 -n 1 'http://localhost:8000/real'\n\n\nRequest #1\n[Fri Oct 20 16:33:00 2006] [debug] mod_cache.c(129): Adding CACHE_SAVE filter\nfor /real\n[Fri Oct 20 16:33:00 2006] [debug] mod_cache.c(136): Adding CACHE_REMOVE_URL\nfilter for /real\n[Fri Oct 20 16:33:00 2006] [debug] mod_cache.c(602): cache: Caching url: /real\n[Fri Oct 20 16:33:00 2006] [debug] mod_cache.c(608): cache: Removing\nCACHE_REMOVE_URL filter.\n[Fri Oct 20 16:33:00 2006] [debug] mod_cache.c(651): cache: Added date header\n[Fri Oct 20 16:33:00 2006] [debug] mod_disk_cache.c(954): disk_cache: Stored\nheaders for URL http://localhost:8000/real?foo=bar\n[Fri Oct 20 16:33:00 2006] [debug] mod_disk_cache.c(1043): disk_cache: Body for\nURL http://localhost:8000/real?foo=bar cached.\n\nRequest #2\n\n[Fri Oct 20 16:33:06 2006] [debug] mod_cache.c(129): Adding CACHE_SAVE filter\nfor /real\n[Fri Oct 20 16:33:06 2006] [debug] mod_cache.c(136): Adding CACHE_REMOVE_URL\nfilter for /real\n[Fri Oct 20 16:33:06 2006] [debug] mod_cache.c(602): cache: Caching url: /real\n[Fri Oct 20 16:33:06 2006] [debug] mod_cache.c(608): cache: Removing\nCACHE_REMOVE_URL filter.\n[Fri Oct 20 16:33:06 2006] [debug] mod_cache.c(651): cache: Added date header\n[Fri Oct 20 16:33:06 2006] [debug] mod_disk_cache.c(954): disk_cache: Stored\nheaders for URL http://localhost:8000/real?foo=bar\n[Fri Oct 20 16:33:06 2006] [debug] mod_disk_cache.c(1043): disk_cache: Body for\nURL http://localhost:8000/real?foo=bar cached.\n\n(note that the object is re-cached, rather than being served from cache)\n\nIf I remove the query string from the RHS of the rewrite rule:\n\nrewrite config #2:\n\nRewriteEngine on\nRewriteRule ^/real /index.html\n\nI see this:\n\nRequest: ab -c 1 -n 1 'http://localhost:8000/real'\n\nRequest #1:\n\n[Fri Oct 20 16:38:12 2006] [debug] mod_cache.c(129): Adding CACHE_SAVE filter\nfor /real\n[Fri Oct 20 16:38:12 2006] [debug] mod_cache.c(136): Adding CACHE_REMOVE_URL\nfilter for /real\n[Fri Oct 20 16:38:12 2006] [debug] mod_cache.c(602): cache: Caching url: /real\n[Fri Oct 20 16:38:12 2006] [debug] mod_cache.c(608): cache: Removing\nCACHE_REMOVE_URL filter.\n[Fri Oct 20 16:38:12 2006] [debug] mod_cache.c(651): cache: Added date header\n[Fri Oct 20 16:38:12 2006] [debug] mod_disk_cache.c(954): disk_cache: Stored\nheaders for URL http://localhost:8000/real?\n[Fri Oct 20 16:38:12 2006] [debug] mod_disk_cache.c(1043): disk_cache: Body for\nURL http://localhost:8000/real? cached.\n\nRequest #2:\n\n[Fri Oct 20 16:38:17 2006] [debug] mod_disk_cache.c(477): disk_cache: Recalled\ncached URL info header http://localhost:8000/real?\n[Fri Oct 20 16:38:17 2006] [debug] mod_disk_cache.c(750): disk_cache: Recalled\nheaders for URL http://localhost:8000/real?\n[Fri Oct 20 16:38:17 2006] [debug] mod_cache.c(261): cache: running CACHE_OUT filter\n[Fri Oct 20 16:38:17 2006] [debug] mod_cache.c(275): cache: serving /real\n\nThis time, the object is served from cache.\n\nFinally, if I place the query string *back* into the RewriteRule:\n\n\nrewrite config #3:\n\nRewriteEngine on\nRewriteRule ^/real /index.html?foo=bar\n\nAnd issue a request which appends the query string on the RHS of the RewriteRule\nto the URI on the LHS of the RewriteRule:\n\nRequest: ab -c 1 -n 1 'http://localhost:8000/real?foo=bar'\n\nRequest #1:\n\n[Fri Oct 20 16:42:49 2006] [debug] mod_cache.c(129): Adding CACHE_SAVE filter\nfor /real\n[Fri Oct 20 16:42:49 2006] [debug] mod_cache.c(136): Adding CACHE_REMOVE_URL\nfilter for /real\n[Fri Oct 20 16:42:49 2006] [debug] mod_cache.c(602): cache: Caching url:\n/real?foo=bar\n[Fri Oct 20 16:42:49 2006] [debug] mod_cache.c(608): cache: Removing\nCACHE_REMOVE_URL filter.\n[Fri Oct 20 16:42:49 2006] [debug] mod_cache.c(651): cache: Added date header\n[Fri Oct 20 16:42:49 2006] [debug] mod_disk_cache.c(954): disk_cache: Stored\nheaders for URL http://localhost:8000/real?foo=bar\n[Fri Oct 20 16:42:49 2006] [debug] mod_disk_cache.c(1043): disk_cache: Body for\nURL http://localhost:8000/real?foo=bar cached.\n\nRequest #2:\n\n[Fri Oct 20 16:42:51 2006] [debug] mod_disk_cache.c(477): disk_cache: Recalled\ncached URL info header http://localhost:8000/real?foo=bar\n[Fri Oct 20 16:42:51 2006] [debug] mod_disk_cache.c(750): disk_cache: Recalled\nheaders for URL http://localhost:8000/real?foo=bar\n[Fri Oct 20 16:42:51 2006] [debug] mod_cache.c(261): cache: running CACHE_OUT filter\n[Fri Oct 20 16:42:51 2006] [debug] mod_cache.c(275): cache: serving /real\n\nAgain, served correctly from cache.\n\nRequested behavior:\n\nFor mod_rewrite URLs where the RHS contains a query string, mod_cache should\nboth store and retrieve the cached object from the same path.", "id": 95018, "time": "2006-10-20T13:45:38Z", "creator": "sitz@aol.net", "creation_time": "2006-10-20T13:45:38Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 40805, "attachment_id": null, "text": "Can you please try the attached patch?", "id": 95071, "time": "2006-10-24T13:44:24Z", "creator": "rpluem@apache.org", "creation_time": "2006-10-24T13:44:24Z", "is_private": false}, {"count": 2, "tags": [], "creator": "rpluem@apache.org", "attachment_id": 19038, "id": 95072, "time": "2006-10-24T13:45:25Z", "bug_id": 40805, "creation_time": "2006-10-24T13:45:25Z", "is_private": false, "text": "Created attachment 19038\nPatch against trunk"}, {"count": 3, "tags": [], "bug_id": 40805, "attachment_id": null, "text": "Yep, that works.", "id": 95083, "time": "2006-10-25T09:19:12Z", "creator": "sitz@aol.net", "creation_time": "2006-10-25T09:19:12Z", "is_private": false}, {"count": 4, "tags": [], "creator": "sitz@aol.net", "text": "Is this patch going to be applied against the 2.2 branch?", "id": 95629, "time": "2006-11-09T12:38:59Z", "bug_id": 40805, "creation_time": "2006-11-09T12:38:59Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 40805, "attachment_id": null, "text": "I need to commit this to trunk first and propose it for backport to 2.2.x.\nPlease bug me here if you see no update on this here within the next week. Thanks.", "id": 95630, "time": "2006-11-09T14:30:09Z", "creator": "rpluem@apache.org", "creation_time": "2006-11-09T14:30:09Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 40805, "attachment_id": null, "text": "Committed to trunk as r476625 (http://svn.apache.org/viewvc?view=rev&rev=476625).", "id": 95958, "time": "2006-11-18T14:39:22Z", "creator": "rpluem@apache.org", "creation_time": "2006-11-18T14:39:22Z", "is_private": false}, {"count": 7, "tags": [], "creator": "sitz@aol.net", "attachment_id": null, "id": 97023, "time": "2006-12-18T08:27:34Z", "bug_id": 40805, "creation_time": "2006-12-18T08:27:34Z", "is_private": false, "text": "Any update on getting this backported to 2.2?"}, {"count": 8, "tags": [], "bug_id": 40805, "attachment_id": null, "text": "Proposed for backport to 2.2.x as r488411\n(http://svn.apache.org/viewvc?view=rev&rev=488411). Thanks for the reminder.", "id": 97033, "time": "2006-12-18T12:54:27Z", "creator": "rpluem@apache.org", "creation_time": "2006-12-18T12:54:27Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 40805, "attachment_id": null, "text": "What are the chances of this making it into 2.2.5?", "id": 98147, "time": "2007-01-16T08:52:49Z", "creator": "sitz@aol.net", "creation_time": "2007-01-16T08:52:49Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 40805, "attachment_id": null, "text": "Backported to 2.2.x as r535903 (http://svn.apache.org/viewvc?view=rev&rev=535903).", "id": 102907, "time": "2007-05-07T08:35:40Z", "creator": "rpluem@apache.org", "creation_time": "2007-05-07T08:35:40Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 40805, "attachment_id": null, "text": "Hello,\n\nexcuse my poor english, I'm french.\n\nCan someone explain to me how to apply this patch, please ?\nI have the 2.2.4 version of Apache. I need to apply the patch on a linux and on\na Windows plateform.\n\nThanks.", "id": 104701, "time": "2007-06-25T12:50:07Z", "creator": "portalez@caramail.com", "creation_time": "2007-06-25T12:50:07Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 40805, "attachment_id": null, "text": "Go to the directory from where the patch is being created e.g Apache root\ndirectory in this patch and run the command.\n$ patch -p 0 -u -i <patchfile>", "id": 104703, "time": "2007-06-25T13:58:57Z", "creator": "basant.kukreja@sun.com", "creation_time": "2007-06-25T13:58:57Z", "is_private": false}]
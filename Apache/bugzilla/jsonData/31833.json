[{"count": 0, "tags": [], "text": "My jar task is such:\n<jar manifest=${base}/${classes}/meta-inf/MANIFEST.MF\"\n     destfile=\"${base}/${lib}/deleteme.jar\" \n     basedir=\"${base}/${classes}\"/>\n\nThe MANIFEST.MF file contains several entries, such as:\n\nName: com/sun/msv/reader/trex/ng/comp/DefAttCompatibilityChecker$DefAt\n tMap.class\nSHA1-Digest: zUbCbacRjUSc7G+3JLftrRVJ50k=\n\n\nThe jar task concatenates the Name: entry onto 1 line, thusly:\n\nName: com/sun/msv/reader/trex/ng/comp/DefAttCompatibilityChecker$DefAttMap.class\nSHA1-Digest: zUbCbacRjUSc7G+3JLftrRVJ50k=\n\nThis is causing an invalid MANIFEST.MF, since the line exceeds the 72-char \nlimit defined in the JAR file spec.", "is_private": false, "id": 65459, "creator": "danesub@yahoo.com", "time": "2004-10-21T18:03:37Z", "bug_id": 31833, "creation_time": "2004-10-21T18:03:37Z", "attachment_id": null}, {"count": 1, "text": "I can't reproduce this.\n\nI wrote this build file:\n\n<project>\n  <delete file=\"test.jar\"/>\n  <jar manifest=\"manifest.mf\"\n       destfile=\"test.jar\"/>\n  <unjar src=\"test.jar\" dest=\"unjared\" overwrite=\"true\"/>\n  <concat>\n    <fileset dir=\"unjared\"/>\n  </concat>\n</project>\n\nIt will create a manifest-only jar from the manifest.mf file and then unjar it,\ndisplaying its contents with concat. I created a manifest.mf file as you\nspecified (and I also added a few other test entries such as longer lines, lines\nwith no continuation space, etc).\n\nHere is the output for me:\n   [delete] Deleting: D:\\development\\apache\\ant-bugs\\31833\\test.jar\n      [jar] Building MANIFEST-only jar:\nD:\\development\\apache\\ant-bugs\\31833\\test.jar\n      [jar] Building jar: D:\\development\\apache\\ant-bugs\\31833\\test.jar\n   [delete] Deleting directory D:\\development\\apache\\ant-bugs\\31833\\unjared\n    [unjar] Expanding: D:\\development\\apache\\ant-bugs\\31833\\test.jar into\nD:\\development\\apache\\ant-bugs\\31833\\unjared\n   [concat] Manifest-Version: 1.0\n   [concat] Ant-Version: Apache Ant 1.7alpha\n   [concat] Created-By: 1.5.0-beta2-b51 (Sun Microsystems Inc.)\n   [concat] Main-Class: blah\n\n   [concat] Name: com/sun/msv/reader/trex/ng/comp/DefAttCompatibilityChecker$DefAt\n   [concat]  tMap.class\n   [concat] SHA1-Digest: zUbCbacRjUSc7G+3JLftrRVJ50k=\n\n   [concat] Name: com/sun/msv/reader/trex/ng/comp/DefAttCompatibilityChecker$DefAt\n   [concat]  tMap2.class\n   [concat] SHA1-Digest: zUbCbacRjUSc7G+3JLftrRVJ50k=\n\n   [concat] Name: com/sun/msv/reader/trex/ng/comp/DefAttCompatibilityChecker$DefAt\n   [concat]  tMapAreallyBigClassName.class\n   [concat] SHA1-Digest: zUbCbacRjUSc7G+3JLftrRVJ50k=\n\nIt all looks ok to me. I tries with Ant 1.6.0 and Ant 1.7 (CVS)\n\nCan you give us more detail on your problem? In particular you say \"The jar task\nconcatenates the Name: entry onto 1 line\". How are you seeing that?", "bug_id": 31833, "attachment_id": null, "id": 65492, "time": "2004-10-22T11:40:37Z", "creator": "conor@apache.org", "creation_time": "2004-10-22T11:40:37Z", "tags": [], "is_private": false}, {"count": 2, "text": "Created attachment 13183\nThis ant script creates 2 jar files, and reveals an issue with the jar task", "bug_id": 31833, "attachment_id": 13183, "id": 65500, "time": "2004-10-22T13:11:09Z", "creator": "danesub@yahoo.com", "creation_time": "2004-10-22T13:11:09Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "danesub@yahoo.com", "attachment_id": 13184, "is_private": false, "id": 65501, "time": "2004-10-22T13:12:15Z", "bug_id": 31833, "creation_time": "2004-10-22T13:12:15Z", "text": "Created attachment 13184\nThis is the sample MANIFEST.MF file used by the ant script"}, {"count": 4, "attachment_id": 13185, "creator": "danesub@yahoo.com", "text": "Created attachment 13185\nOne of the jar files needed for the test case. This file is available from Sun.", "id": 65502, "time": "2004-10-22T13:15:08Z", "bug_id": 31833, "creation_time": "2004-10-22T13:15:08Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": 13186, "creator": "danesub@yahoo.com", "text": "Created attachment 13186\nThis is a jar file needed for the test case. This file is also available from Sun.", "id": 65503, "time": "2004-10-22T13:15:44Z", "bug_id": 31833, "creation_time": "2004-10-22T13:15:44Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "creator": "danesub@yahoo.com", "attachment_id": null, "id": 65504, "time": "2004-10-22T13:36:10Z", "bug_id": 31833, "creation_time": "2004-10-22T13:36:10Z", "is_private": false, "text": "\nThe attached ant script will recreate the problem. The mangling of the\nmanifest.mf file only appears to happen when I run this on a Mac.\nHowever, on both a Mac and an PC, the jar task ultimately yields a \n.jar file that won't pass verification.\n\nThis ant script creates 2 jar files: jartask.jar and ziptask.jar\nAfter running ant, run\n\njarsigner -verify jartask.jar\n\nand\n\njarsigner -verify ziptask.jar\n\nThe jartask.jar fails verification. The ziptask.jar gets warnings\nabout unsigned entries.\n\nNote: I wasn't able to attach the jaxb-libs.jar file. However, all three\nof the jaxb jar files are from Sun's JWSDP 1.4 kit; they're found in\nthe jwsdb-1.4/jaxb/lib directory. The web services developer pack is \navailable at \n\nhttp://java.sun.com/webservices/downloads/webservicespack.html\n\n\n\n"}, {"count": 7, "tags": [], "bug_id": 31833, "text": "Just for future reference, please don't attach someone else's jars to a bug report. \n\nIt would seem that changing the structure of the Name: line does indeed\ninvalidate the signature. I'm not sure why that is. \n\nThere is a slight bug in Ant whereby the line limit check is not quite correct.\nI will fix this presently. The effect of this is that Ant 1.6+ will create\nManifest lines up to 72 characters long - the limit should be 70 (allowing 2 for\nthe CR/LF)\n\nI'll investigate further.\n\nBTW, there is a slight issue in your copying of the manifest when building the\nzip version since it won't overwrite the version extracted from the last jar -\nyou need to add an overwrite attribute there, I'd say.", "id": 65514, "time": "2004-10-22T16:06:03Z", "creator": "conor@apache.org", "creation_time": "2004-10-22T16:06:03Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "danesub@yahoo.com", "text": "\nAfter some more digging, I'm not sure my test conditions are\nactually valid. That is, I believe unjarring a signed jar, then\nrejarring it, invalidates the signing. Thus, it is correct for \njarsigner -verify to fail the jartask.jar after all.\n\n", "id": 65645, "time": "2004-10-25T12:06:02Z", "bug_id": 31833, "creation_time": "2004-10-25T12:06:02Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "id": 65704, "time": "2004-10-26T10:23:51Z", "bug_id": 31833, "creation_time": "2004-10-26T10:23:51Z", "is_private": false, "text": "I think you are correct, after you jar the files, you\nwould need to resign the jar file."}]
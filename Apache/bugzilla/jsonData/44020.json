[{"count": 0, "tags": [], "bug_id": 44020, "attachment_id": null, "text": "It seems that when a Redirect directive with an absolute path as\ntarget, like in the configuration below, is specified in server config\ncontext, no scheme or hostname will get prefixed to the absolute path\nfor matching requests, which is not according to the documentation of\nthe Redirect directive:\n\n\"The new URL should be an absolute URL beginning with a scheme and\nhostname, but a URL-path beginning with a slash may also be used, in\nwhich case the scheme and hostname of the current server will be\nadded.\"\n\nAnd, this also differs from how Redirect directives with absolute path\ntargets are handled, for example, in directory context, which is in\nline with the documentation, it seems. To demonstrate the problem,\nconsider the following configuration:\n\nRedirect /test/source1 /test/dest\n\n<Directory /var/www/test>\n  Redirect /test/source2 /test/dest\n</Directory>\n\n\nWith the above configuration, the command\ncurl --include http://localhost/test/source1/\ngives the following output:\n\nHTTP/1.1 302 Found\nDate: Mon, 03 Dec 2007 22:04:32 GMT\nServer: Apache/2.2.6 (Debian) PHP/5.2.4-2 with Suhosin-Patch\nLocation: /test/dest/\nContent-Length: 300\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>302 Found</title>\n</head><body>\n<h1>Found</h1>\n<p>The document has moved <a href=\"/test/dest/\">here</a>.</p>\n<hr>\n<address>Apache/2.2.6 (Debian) PHP/5.2.4-2 with Suhosin-Patch Server at\nlocalhost Port 80</address>\n</body></html>\n\n\nWhile the command\ncurl --include http://localhost/test/source2/\ngives this output:\n\nHTTP/1.1 302 Found\nDate: Mon, 03 Dec 2007 22:04:44 GMT\nServer: Apache/2.2.6 (Debian) PHP/5.2.4-2 with Suhosin-Patch\nLocation: http://localhost/test/dest/\nContent-Length: 316\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>302 Found</title>\n</head><body>\n<h1>Found</h1>\n<p>The document has moved <a href=\"http://localhost/test/dest/\">here</a>.</p>\n<hr>\n<address>Apache/2.2.6 (Debian) PHP/5.2.4-2 with Suhosin-Patch Server at\nlocalhost Port 80</address>\n</body></html>\n\n\nNote how the Location header in the HTTP response differ in the\noutput of the two commands. I believe the cause for this discrepancy\nis in the function translate_alias_redir in file mod_alias.c, which\nseems to process redirections (as well as aliases) specified in server\nconfig context, while the function fixup_redir seems to process\nredirections specified in directory context. Note how the blocks of\nthe if statements which test for redirection (with condition\nap_is_HTTP_REDIRECT(status)) differ. I think these should be almost,\nif not completely, the same, and I'll also attach a patch suggesting\nthis.\n\nSince the patch simply makes the two if statements identical, a change\nnot directly related, is also introduced, meaning that a query string\nfollowing a '?' in the URL is also handled the same way in both\ncontexts. While this also seems reasonable, I think, I have not much\nexperience with Apache internals, so the patch is merely a suggestion,\nof course.\n\nNote, I use the version of Apache packaged by Debian, but the source\nfile mod_alias.c, which I think contains the cause of the problem, has\nnot been modified by Debian, as far as I can see.", "id": 111429, "time": "2007-12-04T10:44:35Z", "creator": "hakon@stordahl.org", "creation_time": "2007-12-04T10:44:35Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 44020, "attachment_id": 21229, "text": "Created attachment 21229\nAttempt to improve handling of absolute paths in Redirect directives", "id": 111431, "time": "2007-12-04T10:49:50Z", "creator": "hakon@stordahl.org", "creation_time": "2007-12-04T10:49:50Z", "is_private": false}, {"count": 2, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "id": 127433, "time": "2009-05-26T18:25:19Z", "bug_id": 44020, "creation_time": "2009-05-26T18:25:19Z", "is_private": false, "text": "Reviewing your patch, it's basically good (thanks!), but it's too strict for 2.2 (we'll get complaints about returning internal server error on configs that previously \"worked\" - as far as the user was concerned).  Any objection to my changing that to just log a warning and fall back to old-behaviour if it doesn't construct a valid URL?"}, {"count": 3, "tags": [], "creator": "hakon@stordahl.org", "attachment_id": null, "id": 127489, "time": "2009-05-28T16:00:01Z", "bug_id": 44020, "creation_time": "2009-05-28T16:00:01Z", "is_private": false, "text": "No, I think that seems reasonable.\nThanks."}, {"count": 4, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "id": 128015, "time": "2009-06-17T05:46:58Z", "bug_id": 44020, "creation_time": "2009-06-17T05:46:58Z", "is_private": false, "text": "I've committed your patch to /trunk/ in r785575.\n\nI'll propose a modified patch for backport to 2.2:\nhttp://people.apache.org/~niq/patches/44020.patch"}, {"count": 5, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "id": 128812, "time": "2009-07-13T15:27:36Z", "bug_id": 44020, "creation_time": "2009-07-13T15:27:36Z", "is_private": false, "text": "Backported to 2.2 in r791541"}, {"count": 6, "tags": [], "bug_id": 44020, "attachment_id": null, "text": "Because write \"Redirect permanent /xxx /yyy\" is correct usage according to the documentation, I consider logging leven \"warn\" too high and propose to change\n\nap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,\n  \"incomplete redirection target of '%s' for \"\n  \"URI '%s' modified to '%s'\",\n  orig_target, r->uri, ret);\n\nto\n\nap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,\n  \"incomplete redirection target of '%s' for \"\n  \"URI '%s' modified to '%s'\",\n  orig_target, r->uri, ret);\n\nin mod_alias.c.\n\n(In our environment where different webservers serve the same content, writing the short URL for server-local redirects avoids the need for different .htaccess files for each server. But using the short URLs pollutes our error logs with these warnings.)\n\n\nThank you.", "id": 139235, "time": "2010-08-19T05:54:01Z", "creator": "perske@uni-muenster.de", "creation_time": "2010-08-19T05:54:01Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 44020, "attachment_id": null, "text": "Currently the 'incomplete redirection target' message occurres twice in mod_alias.c, once with APLOG_DEBUG, once with APLON_WARNING. Both should be\nAPLOG_DEBUG. Thank you.", "id": 139236, "time": "2010-08-19T06:06:22Z", "creator": "perske@uni-muenster.de", "creation_time": "2010-08-19T06:06:22Z", "is_private": false}, {"count": 8, "tags": [], "text": "as per #c7, these messages still go to the warning log & pollute the logfile quite a bit. if the syntax is correct, it should all go to the debug loglevel", "attachment_id": null, "bug_id": 44020, "id": 144249, "time": "2011-02-14T06:24:00Z", "creator": "richlv@nakts.net", "creation_time": "2011-02-14T06:24:00Z", "is_private": false}, {"count": 9, "attachment_id": null, "bug_id": 44020, "text": "Fixed in r1165101 / 2.2.21", "id": 149382, "time": "2011-09-17T15:26:19Z", "creator": "sf@sfritsch.de", "creation_time": "2011-09-17T15:26:19Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "text": "I'm getting junk output from the JUnit task when there are test failures.  It seems that the internal logging facility assumes all logged output will be a single line, but doesn't guarantee that this is the case.\n\nI'm using Ant 1.7.0 (the standard distribution for Mac OS X), and (I believe) JUnit 3.8.1.\n\n$ -> ant -version\nApache Ant version 1.7.0 compiled on February 29 2008\n\nHere's some example output:\n\nsimple-test:\n    [junit] messed up)\n    [junit] crashed)\n    [junit] Test SimpleTest FAILED\n\nThose first two [junit] lines should not appear.\n\nTo reproduce, here's the target source:\n\n  <target name=\"simple-test\">\n    <junit fork=\"yes\">\n      <classpath>\n        <pathelement location=\"classes/test\" />\n      </classpath>\n      <test name=\"SimpleTest\" />\n    </junit>\n  </target>\n\nAnd here is the SimpleTest class's source:\n\npublic class SimpleTest extends junit.framework.TestCase {\n  public void testFoo() { assertTrue(\"testFoo \\nmessed up\", false); }\n  public void testBar() { assertTrue(\"testBar \\ndidn't work\", true); }\n  public void testFee() { assertTrue(\"testFee \\ncrashed\", false); }\n  public void testFie() { assertTrue(\"testFie \\nbroke\", true); }\n}\n\nI can avoid the junk output by turning off forking or removing the \"\\n\" characters from the assertion failure messages.\n\nMy workaround (because I need forking and multi-line failures) is to use reflection to turn off logging:\n\n    private void turnOffLogging(TestResult result) {\n      try {\n        java.lang.reflect.Field listenersF = result.getClass().getDeclaredField(\"fListeners\");\n        listenersF.setAccessible(true);\n        for (Object listener : (Iterable<?>) listenersF.get(result)) {\n          Object antRunner = listener; // by default, the listener is the runner\n          try {\n            java.lang.reflect.Field antRunnerF = listener.getClass().getDeclaredField(\"this$0\");\n            antRunnerF.setAccessible(true);\n            antRunner = antRunnerF.get(listener);\n          }\n          catch (Throwable t) { /* not an anonymous class */ }\n          try {\n            java.lang.reflect.Field logFlagF = antRunner.getClass().getDeclaredField(\"logTestListenerEvents\");\n            logFlagF.setAccessible(true);\n            logFlagF.setBoolean(antRunner, false);\n          }\n          catch (Throwable t) { /* not an Ant test runner */ }\n        }\n      }\n      catch (Throwable t) { /* not a standard JUnit TestResult */ }\n    }", "attachment_id": null, "id": 118735, "creator": "dlsmith@rice.edu", "time": "2008-07-16T12:15:23Z", "bug_id": 45411, "creation_time": "2008-07-16T12:15:23Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 45411, "attachment_id": null, "text": "confirmed with (disabled) test in svn revision 691622", "id": 120312, "time": "2008-09-03T07:17:46Z", "creator": "bodewig@apache.org", "creation_time": "2008-09-03T07:17:46Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 45411, "attachment_id": null, "id": 120313, "time": "2008-09-03T07:38:52Z", "creator": "bodewig@apache.org", "creation_time": "2008-09-03T07:38:52Z", "is_private": false, "text": "svn revision 691627"}]
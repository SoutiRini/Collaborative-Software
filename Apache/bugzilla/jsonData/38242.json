[{"count": 0, "tags": [], "bug_id": 38242, "attachment_id": null, "text": "On the class org.apache.catalina.session.StandardSession, method invalidate() it\ncalls expire() which flags the session as invalid; setValid(false), then in the\nsame expire method it calls removeAttributeInternal(keys[i], notify), this\nmethod makes a method call of: ((HttpSessionBindingListener)\nvalue).valueUnbound(event).    When the implementing class tries to call:\nttpSessionBindingEvent bindingEvent, bindingEvent.getSession().getId(); you get\na IllegalStateException, the Session is Already Invalidated.  This is caused\nbecause the setValid(false) should be set at the end of the expire() method\nafter all objects are unbound.  The implementation example I am having the\nproblem with is on UPortal org.jasig.portal.jndi.JNDIManger.java class @Version\n$Revision: 1.32, on the valueUnbound (HttpSessionBindingEvent bindingEvent) method.", "id": 84545, "time": "2006-01-12T17:44:00Z", "creator": "robbyoung21@gmail.com", "creation_time": "2006-01-12T17:44:00Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 38242, "attachment_id": null, "is_private": false, "id": 84546, "time": "2006-01-12T17:47:07Z", "creator": "robbyoung21@gmail.com", "creation_time": "2006-01-12T17:47:07Z", "text": "JBoss has implemented their ClusteredSession class correctly.  See\nhttp://docs.jboss.org/jbossas/javadoc/4.0.2/org/jboss/web/tomcat/tc5/session/ClusteredSession.java.html\n\nTake note of their expire() method, the setValid(false) is at the end of the method."}, {"count": 2, "tags": [], "bug_id": 38242, "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of 34107 ***", "id": 84549, "time": "2006-01-12T18:12:52Z", "creator": "william.barker@wilshire.com", "creation_time": "2006-01-12T18:12:52Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 38242, "attachment_id": null, "is_private": false, "id": 89657, "time": "2006-06-01T15:28:35Z", "creator": "robbyoung21@gmail.com", "creation_time": "2006-06-01T15:28:35Z", "text": "This an issue with UPortal not implementing the specification correctly.  Many\nof their classes are implementing HttpSessionBindingListener when they should be\nimplementing HttpSessionListener.  \n\nSee.  http://www.ja-sig.org/issues/browse/UP-1524"}]
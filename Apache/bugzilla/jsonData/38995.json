[{"count": 0, "tags": [], "creator": "kiranm@hp.com", "attachment_id": null, "text": "While running the bench marking tool, ab (options are -c 30 -n 400), on a cgi\nscript that takes about 30 seconds to complete, I notice the following error in\nthe logfile when I do a graceful shutdown. This is on 2.0.55 version of Apache.\nThe error I get is :\n\n[Thu Mar 02 17:23:11 2006] [error] [client 15.42.227.146] daemon couldn't find C\nGI process for connection 5\n[Thu Mar 02 17:23:11 2006] [error] [client 15.42.227.146] daemon couldn't find C\nGI process for connection 67\n\nFor every concurrent request issued, there seems to be an error.\n\nI could fix this with some modifications to mod_cgid.c. I found that the httpd\nprocess serving the CGI request tries to contact the daemon in the cleanup\ncallback even when a graceful restart has been issued. A check for a graceful\nrestart situation should be made before the connect. The following condition at\nthe beginning of cleanup_script() solves the problem :\n\n   if (ap_graceful_stop_signalled())\n       return APR_EGENERAL;", "id": 86912, "time": "2006-03-16T13:00:24Z", "bug_id": 38995, "creation_time": "2006-03-16T13:00:24Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 38995, "attachment_id": null, "text": "Although this bug was raised against 2.0 in 2006, this behavior still exists on the latest 2.4. It can easily be reproduced by restarting Apache while running a simple curl loop against a phpinfo script (in other words while the server is only handling a single request to the CGI)\n\nAs ap_graceful_stop_signalled() was removed in 2.3, I suspect a modern equivalent before the connect() in cleanup_script() would be:\n\n    /* Don't connect while we're shutting down */\n    if (ap_mpm_query(AP_MPMQ_MPM_STATE, &rc) == APR_SUCCESS &&\n        rc == AP_MPMQ_STOPPING) {\n        return APR_EGENERAL;\n    }\n\nalthough I cannot vouch for the appropriateness of the reported workaround.", "id": 168289, "time": "2013-07-05T10:21:35Z", "creator": "apache-b6e@deemzed.uk", "creation_time": "2013-07-05T10:21:35Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "Stefan.Kuehnel@frontis.com", "attachment_id": null, "id": 25430, "time": "2002-10-31T14:53:19Z", "bug_id": 14129, "creation_time": "2002-10-31T14:53:19Z", "is_private": false, "text": "RequestUtil.parseParameters() doesn't check for incomplete encoded characters \nat the end of query parameters. An URL of the form\n\n  http://localhost:8080/context/page.jsp?param=abc%4\n\nwill result in an ArrayIndexOutOfBoundsException.\n\nThe offending method is below with the place that causes the bug hilighted:\n\n   public static void parseParameters(Map map, byte[] data, String encoding)\n        throws UnsupportedEncodingException {\n\n        if (data != null && data.length > 0) {\n            int    pos = 0;\n            int    ix = 0;\n            int    ox = 0;\n            String key = null;\n            String value = null;\n            while (ix < data.length) {\n                byte c = data[ix++];\n                switch ((char) c) {\n                case '&':\n                    value = new String(data, 0, ox, encoding);\n                    if (key != null) {\n                        putMapEntry(map, key, value);\n                        key = null;\n                    }\n                    ox = 0;\n                    break;\n                case '=':\n                    key = new String(data, 0, ox, encoding);\n                    ox = 0;\n                    break;\n                case '+':\n                    data[ox++] = (byte)' ';\n                    break;\n                case '%':\n                    // ***************************************************\n                    // ix+2<len needs to be checked here!\n                    // ***************************************************\n                    data[ox++] = (byte)((convertHexDigit(data[ix++]) << 4)\n                                    + convertHexDigit(data[ix++]));\n                    break;\n                default:\n                    data[ox++] = c;\n                }\n            }\n            //The last value does not end in '&'.  So save it now.\n            if (key != null) {\n                value = new String(data, 0, ox, encoding);\n                putMapEntry(map, key, value);\n            }\n        }\n\n    }\n\nBelow is a complete stack trace:\n\njava.lang.ArrayIndexOutOfBoundsException: 246\n\tat org.apache.catalina.util.RequestUtil.parseParameters\n(RequestUtil.java:517)\n\tat org.apache.catalina.util.RequestUtil.parseParameters\n(RequestUtil.java:337)\n\tat org.apache.catalina.connector.HttpRequestBase.parseParameters\n(HttpRequestBase.java:625)\n\tat org.apache.catalina.connector.HttpRequestBase.getParameterNames\n(HttpRequestBase.java:723)\n\tat org.apache.catalina.connector.RequestFacade.getParameterNames\n(RequestFacade.java:165)\n\tat org.apache.struts.util.RequestUtils.populate(RequestUtils.java:950)\n\tat org.apache.struts.action.RequestProcessor.processPopulate\n(RequestProcessor.java:779)\n\tat org.apache.struts.action.RequestProcessor.process\n(RequestProcessor.java:246)\n\tat org.apache.struts.action.ActionServlet.process\n(ActionServlet.java:1292)\n\tat org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:492)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:740)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:243)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:190)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(AuthenticatorBase.java:531)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.CertificatesValve.invoke\n(CertificatesValve.java:246)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2347)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.AccessLogValve.invoke\n(AccessLogValve.java:468)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.connector.http.HttpProcessor.process\n(HttpProcessor.java:1027)\n\tat org.apache.catalina.connector.http.HttpProcessor.run\n(HttpProcessor.java:1125)\n\tat java.lang.Thread.run(Thread.java:536)"}, {"count": 1, "tags": [], "bug_id": 14129, "text": "In previous versions of Tomcat I could specify a percent sign as a parameter as \ntwo per cents.  (www.somewhere.com/test.jsp?argument=%%).    However, now I \nhave to enter it as %25 instead  (www.somewhere.com/test.jsp?argument=%25).", "id": 30210, "time": "2003-01-28T22:15:20Z", "creator": "john.weidner@studystack.com", "creation_time": "2003-01-28T22:15:20Z", "is_private": false, "attachment_id": null}, {"text": "This has been fixed in Tomcat 4.1.23+ by the changes made in revision 1.20 of \nRequestUtil.java to use the encoding specified or the platform default if none \nis specified. This catches any malformed parameters before execution reaches \nthe point where the ArrayIndexOutOfBoundsException was thrown.", "tags": [], "bug_id": 14129, "attachment_id": null, "count": 2, "id": 53551, "time": "2004-03-06T12:43:01Z", "creator": "markt@apache.org", "creation_time": "2004-03-06T12:43:01Z", "is_private": false}]
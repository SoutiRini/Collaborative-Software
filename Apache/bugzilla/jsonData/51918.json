[{"count": 0, "attachment_id": null, "bug_id": 51918, "is_private": false, "id": 149951, "time": "2011-09-29T15:48:35Z", "creator": "kai.mattern@edict.de", "creation_time": "2011-09-29T15:48:35Z", "tags": [], "text": "We are testing against a Glassfish App connected to an Apache Server via mod_jk. SSL is in place.\n\nTests against the server are as expected until we enable mod_deflate on the server. Afterwards we completely randomly get error response when collecting the page fragments.\n\nIt seems that the gzipper is not able to decompress the http response. We just see the error (in the http response window in the \"View Result Tree\" report):\n\njava.io.IOException: Corrupt GZIP trailer\n\tat java.util.zip.GZIPInputStream.readTrailer(GZIPInputStream.java:203)\n\tat java.util.zip.GZIPInputStream.read(GZIPInputStream.java:94)\n\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:218)\n\tat java.io.BufferedInputStream.read1(BufferedInputStream.java:258)\n\tat java.io.BufferedInputStream.read(BufferedInputStream.java:317)\n\tat java.io.FilterInputStream.read(FilterInputStream.java:90)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.readResponse(HTTPSamplerBase.java:1541)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPAbstractImpl.readResponse(HTTPAbstractImpl.java:236)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPJavaImpl.readResponse(HTTPJavaImpl.java:286)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPJavaImpl.sample(HTTPJavaImpl.java:518)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:62)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase$ASyncSample.call(HTTPSamplerBase.java:1674)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase$ASyncSample.call(HTTPSamplerBase.java:1659)\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:138)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:662)\n\nNo further notice in the jmeter.log.\n\nOriginal setting:\n- 10 Threads with the option to open 5 sub connections\n- 3-4 sec think time\n- 50 repeats\n- Client HTTP 3.1\n\nWe tried to play with the settings until we knew that the only thing that stops the error is to deny the sub connections.\n\nIt kind of seems that something connected to the gzip decompression of the resonse stumbles from time to time. The error seems to be completely random. Somtimes neatly distributed, sometimes packed at so time in the test - sometimes a lot - sometimes only one error. But never in the main request - always in a sub request.\n\nI can provide the test-script if needed and give out some further details about the apache config, if needed."}, {"count": 1, "tags": [], "text": "One quick remark: When manually querying the page in question via Firefox, there never is a broken response.", "attachment_id": null, "id": 149952, "creator": "kai.mattern@edict.de", "time": "2011-09-29T15:50:34Z", "bug_id": 51918, "creation_time": "2011-09-29T15:50:34Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 51918, "text": "Created attachment 27637\nFix to issue\n\nHello,\nPatch synchronizes methods that modify CookieManager content.\n\n\nRegards\nPhilippe", "id": 149955, "time": "2011-09-29T21:32:33Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-09-29T21:32:33Z", "is_private": false, "attachment_id": 27637}, {"count": 3, "tags": [], "text": "Isn't this the same as Bug 51919?\n\nIf so, the workround is to disable concurrent downloads.", "is_private": false, "id": 149998, "creator": "sebb@apache.org", "time": "2011-09-30T23:05:19Z", "bug_id": 51918, "creation_time": "2011-09-30T23:05:19Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 51918, "attachment_id": 27653, "text": "Created attachment 27653\nreadBuffer local in readResponse()\n\nthe readResponse() in HTTPSampleBase isn't thread safe because there iss this line:\nbyte[] readBuffer = getThreadContext().getReadBuffer();\n\nThe getReadBuffer() (from JMeterContext) is:\nA temporary buffer that can be shared between samplers in a thread.\n\nI thinks that it isn't necessary to have a temp share buffer?\n\nI purpose to use a local readBuffer at each call method (patch)", "id": 150002, "time": "2011-10-01T07:23:51Z", "creator": "milamber@apache.org", "creation_time": "2011-10-01T07:23:51Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 51918, "attachment_id": null, "is_private": false, "id": 150004, "time": "2011-10-01T09:42:55Z", "creator": "sebb@apache.org", "creation_time": "2011-10-01T09:42:55Z", "text": "(In reply to comment #4)\n> Created attachment 27653 [details]\n> readBuffer local in readResponse()\n> \n> the readResponse() in HTTPSampleBase isn't thread safe because there iss this\n> line:\n> byte[] readBuffer = getThreadContext().getReadBuffer();\n> \n> The getReadBuffer() (from JMeterContext) is:\n> A temporary buffer that can be shared between samplers in a thread.\n> \n> I thinks that it isn't necessary to have a temp share buffer?\n\nIt was only there to save recreating it for each sample.\n\n> I purpose to use a local readBuffer at each call method (patch)\n\nAgreed.\n\nIn the meantime, the work-round is to avoid using concurrent downloads entirely.\n\nAs far as I can tell, all such downloads are potentially affected."}, {"count": 6, "tags": [], "text": "(In reply to comment #3)\n> Isn't this the same as Bug 51919?\n> \n> If so, the workround is to disable concurrent downloads.\n\nIt was a manipulation error", "is_private": false, "id": 150015, "creation_time": "2011-10-01T13:07:35Z", "time": "2011-10-01T13:07:35Z", "creator": "p.mouawad@ubik-ingenierie.com", "bug_id": 51918, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 51918, "attachment_id": null, "id": 150016, "time": "2011-10-01T13:18:44Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-10-01T13:18:44Z", "is_private": false, "text": "Also agree with Milamber patch"}, {"count": 8, "tags": [], "bug_id": 51918, "text": "Fixed. \n\nURL: http://svn.apache.org/viewvc?rev=1178129&view=rev\nLog:\nBug 51918 - GZIP compressed traffic produces errors, when multiple connections allowed\n\nModified:\n    jakarta/jmeter/trunk/src/core/org/apache/jmeter/threads/JMeterContext.java\n    jakarta/jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerBase.java\n    jakarta/jmeter/trunk/xdocs/changes.xml", "id": 150043, "time": "2011-10-02T05:53:29Z", "creator": "milamber@apache.org", "creation_time": "2011-10-02T05:53:29Z", "is_private": false, "attachment_id": null}]
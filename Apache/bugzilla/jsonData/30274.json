[{"attachment_id": null, "tags": [], "bug_id": 30274, "text": "A my javax.servlet.Filter implemtation threw java.lang.ClassCastException on the\nline marked by \">>>>>>\". \n-------------------------------------------------------------------------------\nThis is the doFilter method implementation:\n-------------------------------------------------------------------------------\n    public void doFilter(ServletRequest request, ServletResponse response,\nFilterChain chain) throws IOException, ServletException {\n        HttpServletRequest req = (HttpServletRequest)request;\n        String type = req.getHeader(\"Content-Type\");\n\n        // If this is not a multipart/form-data request continue\n        if (type == null || !type.startsWith(\"multipart/form-data\")) {\n            chain.doFilter(request, response);\n        }\n        else {\n            HttpSession session = ((HttpServletRequest)request).getSession();\n            dir = (String)session.getAttribute(\"target\");\n            if ((dir == null) || (\"\".equals(dir))) {\n                throw new ServletException(\"Invalid target dir.\");\n            }\n            MultipartWrapper multi = new MultipartWrapper(req, dir);\n            System.err.println(\"Is multi instance of ServletRequest? \" + (multi\ninstanceof ServletRequest));\n            System.err.println(\"Is response instance of ServletResponse? \" +\n(response instanceof ServletResponse));\n            System.err.println(\"Multi class is \" + multi.getClass().getName());\n            System.err.println(\"Response class is \" +\nresponse.getClass().getName());\n/*>>>>>>*/            chain.doFilter(multi, response);\n        }\n\n    }\n\nThis is debug output produced by \"System.err.println...\" lines:\n---------------------------------------------------------------\nIs multi instance of ServletRequest? true\nIs response instance of ServletResponse? true\nMulti class is com.oreilly.servlet.MultipartWrapper\nResponse class is org.apache.coyote.tomcat5.CoyoteResponseFacade\n\nThis the result in log:\n-----------------------\n2004-07-22 23:17:43 StandardContext[/manager]Manager: start: Starting web\napplication at '/wfs'\n2004-07-22 23:18:25 StandardWrapperValve[jsp]: Servlet.service() for servlet jsp\nthrew exception\njava.lang.ClassCastException\n\tat org.apache.jsp.upload_jsp._jspService(upload_jsp.java:47)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:311)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:284)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:204)\n\tat cz.pve.fs.MultipartFilter.doFilter(MultipartFilter.java:61)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:233)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:204)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:257)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:184)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:833)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:732)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:619)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:688)\n\tat java.lang.Thread.run(Thread.java:534)", "count": 0, "id": 60999, "time": "2004-07-22T21:30:24Z", "creator": "pve@casd.cz", "creation_time": "2004-07-22T21:30:24Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 30274, "attachment_id": null, "id": 61001, "time": "2004-07-22T21:42:51Z", "creator": "remm@apache.org", "creation_time": "2004-07-22T21:42:51Z", "is_private": false, "text": "You should provide a ready to use test case: there might be a mistake somewhere."}, {"count": 2, "tags": [], "text": "Well, seeing as how the exception is in your code, maybe you can post \nupload.jsp?\n\nAs an aside, you might want to use the mailing list for bug discussions and \nassitance, as they are more widely and frequently read than the Bugzilla issues.", "attachment_id": null, "id": 61135, "creation_time": "2004-07-26T15:54:32Z", "time": "2004-07-26T15:54:32Z", "creator": "yoavs@computer.org", "bug_id": 30274, "is_private": false}, {"count": 3, "tags": [], "text": "More than a month passed, no patch, no test case, no comment, no discussion on \nmailing list => no issue.", "attachment_id": null, "id": 62806, "creation_time": "2004-08-30T20:04:21Z", "time": "2004-08-30T20:04:21Z", "creator": "yoavs@computer.org", "bug_id": 30274, "is_private": false}]
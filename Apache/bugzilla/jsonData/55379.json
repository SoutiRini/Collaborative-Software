[{"count": 0, "tags": [], "creator": "jmv_deb@nirgal.com", "text": "Hello\n\nI was helping triaging apache2 bugs reports in Debian and found that one:\nhttp://bugs.debian.org/564722\n\n> Running \"htdigest -c <file> <domain> <user>\" provides inconsistent\n> results, sometimes removing entries for this or another <user> and\n> othertimes doubling up entries for <user>. I suggest that invoking the\n> command in this way with the -c flag should cause the programme to bail\n> out if the file <file> already exists.\n\nFirst, there really is a bug with -c parameter, which behaviour is inconsistent.\n\nMan page says:\n-c     Create  the  passwdfile.  If  passwdfile  already  exists, it is\n              deleted first.\n\nThis is a regression^Wchange introduced 13 years ago:\nhttps://svn.apache.org/viewvc/httpd/httpd/trunk/support/htdigest.c?r1=85063&r2=85064\n\nfile was truncated fopen(\"w\") and now it is no more, since we use\napr_file_open(APR_WRITE | APR_CREATE)\n\nIt is missing APR_TRUNCATE\n\nYou can reproduce with\n$ htdigest -c ~/toto realm nirgal # file created\n$ htdigest ~/toto realm nirgal2 # second entry added\n$ htdigest -c ~/toto realm nirgal # file should be truncated. It's not.\n$ wc -l ~/toto\n3 /home/nirgal/toto\n\nPatch is available at:\nhttp://bugs.debian.org/cgi-bin/bugreport.cgi?msg=12;filename=564722.diff;att=1;bug=564722\n\nHowever, original bug repport suggest -c should fail if file exists.\n\nIt makes sense to forbid file truncation of existing file, but it is opposition to man description,\nto htpasswd -c behavior, and it might break a few scripts.\n\nWhat is your feeling about that wish?", "id": 169228, "attachment_id": null, "bug_id": 55379, "creation_time": "2013-08-07T11:20:31Z", "time": "2013-08-07T11:20:31Z", "is_private": false}]
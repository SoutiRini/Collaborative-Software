[{"count": 0, "tags": [], "creator": "spamik@yum.pl", "text": "FcgidMaxProcessesPerClass only counts inside virtualhost (or maybe virtualhosts with same ServerName? - which should be none). In original fastcgi implementation MaxProcessesPerClass could be used to limit max number of spawned process for same file (wrapper) thus making it possible to limit also \"per virtual/system user\". In fcgid such limit can't be established.", "id": 139773, "time": "2010-09-08T22:56:31Z", "bug_id": 49902, "creation_time": "2010-09-08T22:56:31Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "spamik@yum.pl", "is_private": false, "text": "in other words there is still a huge need for \"class\" to span over multiple virtualhosts.", "id": 139774, "time": "2010-09-08T23:04:58Z", "bug_id": 49902, "creation_time": "2010-09-08T23:04:58Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 49902, "is_private": false, "text": "(In reply to comment #0)\n> FcgidMaxProcessesPerClass only counts inside virtualhost (or maybe virtualhosts\n> with same ServerName? - which should be none). In original fastcgi\n> implementation MaxProcessesPerClass could be used to limit max number of\n> spawned process for same file (wrapper) thus making it possible to limit also\n> \"per virtual/system user\". In fcgid such limit can't be established.\n\nI fully support this statement.\nWhen comparing to mod_fcgid-2.2 process management, ASF version spawns tons of unnecessary processes. Unnecessary at least when using the same FcgidWrapper+PHP for the same system user, just different VirtualHost.\n\nHad to downgrade almost immediately after upgrade, due to server load jumping sky high...\n\nIs there a way to achieve the old mod_fcgid proces management behaviour with proper config directives?\nIf not, I'm unhappily stuck with Ryan Pan version...", "id": 141828, "time": "2010-11-19T09:16:27Z", "creator": "gacek@intertele.pl", "creation_time": "2010-11-19T09:16:27Z", "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 49902, "is_private": false, "id": 141896, "time": "2010-11-21T21:04:19Z", "creator": "trawick@apache.org", "creation_time": "2010-11-21T21:04:19Z", "tags": [], "text": ">Had to downgrade almost immediately after upgrade, due to server load jumping\nsky high...\n\nIf you're referring to mod_fcgid 2.3.6, the issue is likely a regression in 2.3.6 which is fixed by the following:\n\nIndex: fcgid_spawn_ctl.c\n===================================================================\n--- fcgid_spawn_ctl.c\t(revision 1037483)\n+++ fcgid_spawn_ctl.c\t(working copy)\n@@ -178,7 +178,7 @@\n         if (current_node->inode == command->inode\n             && current_node->deviceid == command->deviceid\n             && !strcmp(current_node->cmdline, command->cmdline)\n-            && current_node->vhost_id == sconf->vhost_id\n+            && current_node->vhost_id == command->vhost_id\n             && current_node->uid == command->uid\n             && current_node->gid == command->gid)\n             break;"}, {"count": 4, "tags": [], "creator": "gacek@intertele.pl", "text": "(In reply to comment #3)\n> >Had to downgrade almost immediately after upgrade, due to server load jumping\n> sky high...\n> \n> If you're referring to mod_fcgid 2.3.6, the issue is likely a regression in\n> 2.3.6 which is fixed by the following:\n\nYou got me wrong.\nServer load was not affected by wrong accounting on processess.\nIt is affected by NUMBER of started processess, eating up available RAM, causing excessive swapping...\n\nIn mod_fcgid-2.2 processess started by fcgiwrapper were of the same class if they were run with same wrapper by the same owner.\n\nIn mod_fcgid-2.3 these processess have different class also if they are run in  different virtual hosts.\n\nwith mod_fcgid-2.2 and fcgi wrapper for php, we could serve dozens of virtual hosts (i.e. subdomains) for single customer with single php process. mod_fcgid-2.3 needs dozens of PHP processess to do the same job.\nThat's simple waste as whole virtual host environment goes with http request in fcgi protocol.\n\nI think there shoud be at least alternative for default process management in mod_fcgid-2.3. Maybe optional explicit class name in FcgidWrapper and/or FcgidCmdOptions directive?", "id": 142565, "time": "2010-12-10T08:56:59Z", "bug_id": 49902, "creation_time": "2010-12-10T08:56:59Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "info@nederlandlive.nl", "attachment_id": null, "id": 147925, "time": "2011-07-14T22:15:45Z", "bug_id": 49902, "creation_time": "2011-07-14T22:15:45Z", "is_private": false, "text": "It looks like this is still happening on a Debian Squeeze system with mod fcgid 2.3.6. Has there been any progress regarding this issue?! I rather not compile the mod myself and go back to 2.2, but if that's the only solution right now i probably have to."}, {"count": 6, "tags": [], "bug_id": 49902, "attachment_id": null, "text": "Small update: Applying Jeff Trawick's patch (see above) to the Debian mod_fcgid 2.3.6 sources fixed it for me. With this patch FcgidMaxProcessesPerClass now works per vhost again, no matter which user, servername or wrapper is used within that vhost. Probably best to fix this before the mass switches over to 2.3.6 (/7) or a lot of servers will go OOM. Thanks Jeff, u saved the day!", "id": 147949, "time": "2011-07-16T22:18:54Z", "creator": "info@nederlandlive.nl", "creation_time": "2011-07-16T22:18:54Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 49902, "attachment_id": null, "is_private": false, "id": 150402, "time": "2011-10-10T09:21:24Z", "creator": "piotr.kloc@poszkole.pl", "creation_time": "2011-10-10T09:21:24Z", "text": "Hello !\n\nAny news with this bug ?"}, {"count": 8, "tags": [], "creator": "mvadkert@redhat.com", "text": "Acorrding to the docs of FcgidMaxProcessesPerClass Directive:\n\nThis directive sets the maximum number of processes that can be started for each process class.\n\nThis setting will apply to all applications spawned for this server or virtual host. Use FcgidCmdOptions to apply this setting to a single application.\n\nSo shouldn't this solve your problem?\nFcgidCmdOptions /usr/local/bin/wrapper MaxRequestsPerProcess 10", "id": 151773, "time": "2011-11-24T21:02:20Z", "bug_id": 49902, "creation_time": "2011-11-24T21:02:20Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "mvadkert@redhat.com", "attachment_id": null, "id": 151774, "creation_time": "2011-11-24T21:07:09Z", "time": "2011-11-24T21:07:09Z", "bug_id": 49902, "text": "Ehm, I meant of course MaxProcesses:\nFcgidCmdOptions /usr/local/bin/wrapper MaxProcesses 10", "is_private": false}, {"count": 10, "tags": [], "bug_id": 49902, "attachment_id": null, "text": "I have been building out a tweaked LAMP set up on a fresh Debian Squeeze server.\n\nServer version: Apache/2.2.16 (Debian)\nArchitecture:   64-bit\nServer MPM:     Worker\n\nUtilising fcgid_module (shared), 2.3.6-1 (Squeeze stable as of writing).\n\nMy story is similar to @Joost I guess.\n\nI've had zero luck trying to make FcgidMaxProcessesPerClass work, either at the Server or Virtual level. I put in some serious effort to get it to work but to no avail. So I think that is another confirmed case of this bug in action.\n\nI apt-get source libapache2-mod-fcgid, applied Jeff's patch listed here (by hand), installed etc and *shit started to work*. Kudos @Jeff for sharing this :)\n\nI was then able to set a default server FcgidMaxProcessesPerClass and then override for specific vhosts too. I am still in the testing phase with my latest cfg's but its looking very promising indeed.\n\n----\n\n@Miroslav, when I had zero luck with FcgidMaxProcessesPerClass, I moved on to try FcgidCmdOptions but no matter what I tried, I couldn't get any of the potential options to take effect :(\nSpecifically, I tried passing env vars to the wrapper, they were not being set (or I was doing it wrong).\nI also tried specifying MaxProcesses but that didn't work either.\n\nThe docs are not that clear on what to specify as the *command*, apache docs suggest the wrapper but that seems to have no effect. I also tried specificing php5-cgi as the command, also no effect.\n\nI have _NOT_ re-tested FcgidCmdOptions since patching but I doubt that is fixed or perhaps I'm just *doing it wrong*.", "id": 152138, "time": "2011-12-13T07:52:44Z", "creator": "ASFBugzilla@milnes.biz", "creation_time": "2011-12-13T07:52:44Z", "is_private": false}, {"count": 11, "attachment_id": null, "bug_id": 49902, "is_private": false, "id": 152959, "time": "2012-01-19T23:06:35Z", "creator": "wrowe@apache.org", "creation_time": "2012-01-19T23:06:35Z", "tags": [], "text": "Revision 1037727 - Directory Listing\nModified Mon Nov 22 14:08:29 2010 UTC (13 months, 3 weeks ago) by trawick\n\nFix regression in 2.3.6 which broke process controls when using vhost-\nspecific configuration.\n\nvhost_id was referenced from the wrong structure, and never matched\nunless there were no vhost-specific directives in the vhost of the\nrequest.\n\n\nFixed for 2.3.7.  Closing"}, {"count": 12, "tags": [], "creator": "dkg@fifthhorseman.net", "text": "Due to the risk of DoS, i've requested a CVE for this bug:\n\n  http://www.openwall.com/lists/oss-security/2012/03/15/10\n\nHaving a released upstream version that respects the administrator's configuration for FcgidMaxProcessesPerClass would be great :)", "id": 154951, "time": "2012-03-15T19:11:04Z", "bug_id": 49902, "creation_time": "2012-03-15T19:11:04Z", "is_private": false, "attachment_id": null}, {"count": 13, "attachment_id": null, "bug_id": 49902, "is_private": false, "id": 154967, "time": "2012-03-16T00:55:16Z", "creator": "dkg@fifthhorseman.net", "creation_time": "2012-03-16T00:55:16Z", "tags": [], "text": "This is now known as CVE-2012-1181"}, {"count": 14, "attachment_id": null, "bug_id": 49902, "is_private": false, "id": 160190, "time": "2012-06-22T21:43:02Z", "creator": "wrowe@apache.org", "creation_time": "2012-06-22T21:43:02Z", "tags": [], "text": "*** Bug 52695 has been marked as a duplicate of this bug. ***"}]
[{"count": 0, "tags": [], "creator": "peak@argo.troja.mff.cuni.cz", "attachment_id": null, "is_private": false, "id": 137332, "time": "2010-06-03T16:27:11Z", "bug_id": 49382, "creation_time": "2010-06-03T16:27:11Z", "text": "ab has trouble receiving responses from many HTTPS non-Apache servers (IIS 6.0, Lotus Domino, Google gws), complaining that \"SSL read failed\":\n\n$ ./ab https://www.google.com/\n...\nThis is ApacheBench, Version 2.3 <$Revision: 655654 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking www.google.com (be patient)...SSL read failed - closing connection\n..done\n\nThose servers seem to terminate TCP connection after the response without shutting down SSL session properly (using close_notify).\n\nA possible workaround is to stop reading after Content-Length bytes have been received. I have implemented that that workaround (see the attachment). It appears to work in most cases, the only notable exception is Google gws because it does not send Content-Length in responses to HTTP/1.0 request.\n\nTrunk (2.3) appears to be affected too."}, {"count": 1, "tags": [], "creator": "peak@argo.troja.mff.cuni.cz", "text": "Created attachment 25520\nproposed patch", "id": 137333, "time": "2010-06-03T16:35:34Z", "bug_id": 49382, "creation_time": "2010-06-03T16:35:34Z", "is_private": false, "attachment_id": 25520}, {"count": 2, "tags": [], "creator": "aroth@arsoft-online.com", "attachment_id": null, "is_private": false, "id": 143786, "time": "2011-01-29T02:12:49Z", "bug_id": 49382, "creation_time": "2011-01-29T02:12:49Z", "text": "HI,\n\ni experienced the same problem with the apache2-utils package version 2.2.16-1ubuntu3.1 installed on my maverick machine.\nI get the following output from ab:\nThis is ApacheBench, Version 2.3 <$Revision: 655654 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking www.google.com (be patient)...SSL read failed - closing connection\n..done\n\n\nServer Software:        gws\nServer Hostname:        www.google.com\nServer Port:            443\nSSL/TLS Protocol:       TLSv1/SSLv3,RC4-SHA,1024,128\n\nDocument Path:          /\nDocument Length:        0 bytes\n\nConcurrency Level:      1\nTime taken for tests:   0.205 seconds\nComplete requests:      1\nFailed requests:        1\n   (Connect: 0, Receive: 0, Length: 1, Exceptions: 0)\nWrite errors:           0\nNon-2xx responses:      1\nTotal transferred:      840 bytes\nHTML transferred:       226 bytes\nRequests per second:    4.89 [#/sec] (mean)\nTime per request:       204.524 [ms] (mean)\nTime per request:       204.524 [ms] (mean, across all concurrent requests)\nTransfer rate:          4.01 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:      152  152   0.0    152     152\nProcessing:    52   52   0.0     52      52\nWaiting:       52   52   0.0     52      52\nTotal:        204  204   0.0    204     204\n\nI haven't check the newer versions of ab, since i haven't got a system ready to build apache on my own. Is there any progress on this issue?\n\nRegards,\nAndreas"}, {"count": 3, "tags": [], "text": "Created attachment 28435\nUpdated patch for 2.4.1\n\nConfirmed that this bug still exists in the 2.4.1 release. Updated the patch for 2.4.1 and it's working for me now. Any chance we could get this committed to trunk?", "attachment_id": 28435, "bug_id": 49382, "id": 154651, "time": "2012-03-07T19:50:34Z", "creator": "i_webb@acs.org", "creation_time": "2012-03-07T19:50:34Z", "is_private": false}, {"count": 4, "tags": [], "creator": "i_webb@acs.org", "text": "Upon further testing, I've found some sites this still doesn't work on.\n\nIn particular, I've verified that ab will now work fine with -n1 against https://www.google.com/ and https://www.facebook.com/, but will fail with -n2 or higher. The failure modes seem slightly different but both Google and Facebook \"cheat\" in various ways for performance (such as defeating slow-start) so I'm not too surprised this fails on those two. (Other Google properties, such as https://gmail.com/, work fine.)\n\nIn testing against most sites I monitor in production it works fine. This represents a mix of Apache, IIS, nginx, and F5 BigIP HTTPS servers.\n\nI have found one Tomcat 5.5 that fails, unfortunately this may be exposing a serious error. The first request resolves with a 200, then subsequent requests seem to be continuing the data flow from that first request and interpreting it as a 500. Note that the function (this was with -v2, the failure happens in a part of the page that has JavaScript so that's just page data) is cut off in the middle by a 500 response code. Not sure what's going on.\n\nfunction popWindowSecure(url,winnam\nWARNING: Response code not 2xx (500)\nLOG: header received:\ne,width,height)", "id": 154653, "time": "2012-03-07T20:37:40Z", "bug_id": 49382, "creation_time": "2012-03-07T20:37:40Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "Created attachment 28564\nPatch for ab to stop \"SSL read failed\"\n\nThis is another patch for making ab work with SSL.\nAlso includes the removal of unnecessary apr_socket_bind() call, and the version string of ab will include the openssl version with this patch.", "attachment_id": 28564, "bug_id": 49382, "id": 157731, "time": "2012-04-09T12:49:05Z", "creator": "masaoki@techfirm.co.jp", "creation_time": "2012-04-09T12:49:05Z", "is_private": false}, {"count": 6, "tags": [], "creator": "masaoki@techfirm.co.jp", "text": "I don't think watching Content-Length on http layer is good idea.\nContent-Length on http does not always exist because there are other mechanism like \"Transfer-Encoding: chunked\" or like \"100 Continue\" or something, even if the http layer is enough neat and honest.\nWe can still take care of chunked coding, but it seems meaningless because the server still can respond incorrectly.  Generally they are sloppy and unreliable.\n\nMy patch is easy one which just treats zero-byte read as the end of communication.", "id": 157732, "time": "2012-04-09T13:02:32Z", "bug_id": 49382, "creation_time": "2012-04-09T13:02:32Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "peak@argo.troja.mff.cuni.cz", "attachment_id": null, "is_private": false, "id": 158154, "time": "2012-04-18T00:29:57Z", "bug_id": 49382, "creation_time": "2012-04-18T00:29:57Z", "text": "(In reply to comment #4)\nDoes the problem with Tomcat occur when keepalive is NOT enabled?\n\n(In reply to comment #6)\n1. ab sends HTTP/1.0 requests. See RFC 2616\n(a) 3.6 Transfer Codings: \"A server MUST NOT send transfer-codings to an HTTP/1.0 client.\"\n(b) 8.2.3 Use of the 100 (Continue) Status: \"An origin server ... MUST NOT send a 100 (Continue) response if such a request comes from an HTTP/1.0 (or earlier) client.\"\n2. Indeed, a server can respond incorrectly. Such a server is broken."}, {"count": 8, "tags": [], "text": "Bump. We're experiencing a lot of SSL write failed and some read failed. Not sure if it's the same issue.\nAnyways, last entry was from APR-18, has this been integrated/what's the status?", "attachment_id": null, "bug_id": 49382, "id": 163085, "time": "2012-10-31T13:49:21Z", "creator": "olivier.suritz@gmail.com", "creation_time": "2012-10-31T13:49:21Z", "is_private": false}, {"count": 9, "tags": [], "text": "Created attachment 30307\nupdate of patch attachment ID # 28564, with failed hunks removed\n\nA couple of hunks in patch attachment ID # 28564 were failing due to some changes in the code. So I stripped these out to get it applying again on my system to httpd-2.2.22.\n\nCan we please figure out what we need to do to get this finished and merged? Right now it's crippling a tried and true utility that's survived for ages, and it's kind of sad to watch.\n\nLet me know if I can help, too!", "attachment_id": 30307, "bug_id": 49382, "id": 167345, "time": "2013-05-22T02:45:28Z", "creator": "mhall@mhcomputing.net", "creation_time": "2013-05-22T02:45:28Z", "is_private": false}, {"count": 10, "tags": [], "text": "IMHO fixed in 2.4.x via r1373084.", "attachment_id": null, "bug_id": 49382, "id": 179442, "time": "2014-12-02T12:53:21Z", "creator": "rpluem@apache.org", "creation_time": "2014-12-02T12:53:21Z", "is_private": false}]
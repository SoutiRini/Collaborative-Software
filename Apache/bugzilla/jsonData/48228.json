[{"count": 0, "tags": [], "bug_id": 48228, "attachment_id": 24558, "text": "Created attachment 24558\nThe error log with LogLevel debug\n\nAfter connecting to an URL without client authentication, connection to an URL\nthat requires it and lists the content of a directory using mod_autoindex,\nstart a SSL renegociation several times instead of only once.\n\nReloading that page starts the SSL renegociation again.\n\nThe reproduction procedure is almost the same as for bug 48215.\nI changed SSLVerifyDepth location, and to use NULL encryption to make analyzing\nthe SSL traffic easier (despite having the key, tshark sometimes fails to\ndecrypt).\n\n- edit the default httpd.conf and add/replace the following in the default\nconfiguration :\nListen *:443\n\nLoadModule ssl_module modules/mod_ssl.so\nLoadModule autoindex_module modules/mod_autoindex.so\n\nSSLSessionCache        \"shmcb:${path}/apache/logs/ssl_scache(512000)\"\nSSLSessionCacheTimeout  3000\nSSLCipherSuite NULL+RSA+SHA1\n# Use this instead if you don't need the clear text traffic \n# SSLCipherSuite AES+RSA+SHA1\n\nNameVirtualHost *:443\n<VirtualHost *:443>\n   SSLEngine On \n   SSLCertificateFile \"${path}/apache/conf/authentication.cer\"\n   SSLCertificateKeyFile \"${path}/apache/conf/authentication.key\"\n   SSLVerifyDepth 0\n   <Location /authentication/>\n    SSLVerifyClient optional_no_ca\n   </Location>\n   DocumentRoot \"${path}/www\"\n</VirtualHost>\n- create a index.html file in /www\n    <html><head><title> authentication test </title></head>\n    <body>authentication test<hr>\n    <a href=\"/authentication\" >authentication link</a>\n    </body></html>\n- create /www/authentication\n- create 10 files inside authentication 1.html through 10.html, the content of\nthe files is not important\n- If you have the NULL cipher suite configured :\n    Inside firefox, in about:config, set security.ssl3.rsa_null_sha to true\n(you'll need to set this value to false again later for security)\n- connect firefox to /\n- follow the link on the page to /authentication\n- You'll need a client certificate (a sample p12 is included in the repro\nfiles)\n- Have the \"remember certificate\" option unchecked\n- Apache will immediately request authentication a second time\n- Reload the page with the reload button \n- Apache will request authentication again two times in a row (in bug 48215,\nreloading the page does not cause the same problem)\n\nThe big plus of NULL encryption is that with it (BIO dump follows) in error_log\nshows all the HTTP traffic in the clear.", "id": 132099, "time": "2009-11-18T09:27:15Z", "creator": "jmdesp@gmail.com", "creation_time": "2009-11-18T09:27:15Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 48228, "text": "Comment on attachment 24558\nThe error log with LogLevel debug\n\nAs NULL encryption is used, all the request from the client can be seen", "id": 132101, "time": "2009-11-18T09:35:44Z", "creator": "jmdesp@gmail.com", "creation_time": "2009-11-18T09:35:44Z", "is_private": false, "attachment_id": 24558}, {"count": 2, "tags": [], "creator": "jorton@redhat.com", "attachment_id": 24563, "text": "Created attachment 24563\ndebugging patch\n\nPart of this is probably bug 47055.\n\nI'm not sure why the initial renegotiation is forced, though - it's for a subrequest but it isn't obvious why.\n\nCan you rebuild with this patch applied to mod_ssl, and attach the new error_log produced?", "id": 132133, "time": "2009-11-19T00:23:35Z", "bug_id": 48228, "creation_time": "2009-11-19T00:23:35Z", "is_private": false}]
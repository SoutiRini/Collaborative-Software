[{"count": 0, "tags": [], "text": "From time to time I get NullPointerException in StandardContextValve during Comet-based application. After this the request isn't handled correctly. Here is the stack trace. This issue pops up periodically, but inconsistently, I cannot describe how to reproduce it. Here is the exception stack trace.\n\n23.09.2011 16:48:44 org.apache.catalina.connector.CoyoteAdapter service\nSEVERE: An exception or error occurred in the container during the request processing\njava.lang.NullPointerException\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:124)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:164)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:851)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:405)\n\tat org.apache.coyote.http11.Http11NioProcessor.process(Http11NioProcessor.java:313)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:515)\n\tat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1544)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n\tat java.lang.Thread.run(Thread.java:636)", "attachment_id": null, "id": 149693, "creation_time": "2011-09-23T13:05:38Z", "time": "2011-09-23T13:05:38Z", "creator": "stfighter@mail.ru", "bug_id": 51883, "is_private": false}, {"count": 1, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 149694, "time": "2011-09-23T13:30:13Z", "bug_id": 51883, "creation_time": "2011-09-23T13:30:13Z", "is_private": false, "text": "In TOMCAT_7_0_19: (The code is the same in the current trunk)\nIt is inside the following method:\n  public final void invoke(Request request, Response response)\n  throws IOException, ServletException {\n\n122 \t// Wait if we are reloading\n123 \tboolean reloaded = false;\n124 \twhile (context.getPaused()) {\n125 \treloaded = true;\n126 \ttry {\n127 \tThread.sleep(1000);\n128 \t} catch (InterruptedException e) {\n129 \t// Ignore\n130 \t}\n131 \t}\n\nThe only reason that I see why context can be null on line 124 is that the webapp has been stopped.\n\nIn that case you would not be able to process the request anyway. The NPE is unexpected, but it saves you from infinite looping there."}, {"count": 2, "tags": [], "bug_id": 51883, "attachment_id": null, "text": "The app is definitely running", "id": 149695, "time": "2011-09-23T13:37:14Z", "creator": "stfighter@mail.ru", "creation_time": "2011-09-23T13:37:14Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 51883, "attachment_id": null, "id": 149788, "creation_time": "2011-09-27T00:55:40Z", "time": "2011-09-27T00:55:40Z", "creator": "knst.kolinko@gmail.com", "text": "It looks a lot like bug 51494 (NPE in StandardContextValve if request is being processed while webapp is being redeployed), but that should have been fixed in 7.0.19.\n\nNote, that it contradicts with your\n> The app is definitely running\n\nbut I see no other way how this issue can occur in StandardContextValve.", "is_private": false}, {"count": 4, "tags": [], "creator": "markt@apache.org", "text": "There are a number of things that are odd about this bug report.\n\n1. It states that this occurs for Comet requests but the stack trace shows that a non-Comet request is being processed since Http11NioProcessor.process() appears rather than Http11NioProcessor.event()\n\n2. The NPE can only occur if the Context has been stopped but it is stated that the application is running.\n\nThere is more going on here than the information available so far suggests. Without further information that explains what is happening this issue will eventually get resolved as WONTFIX.\n\nWhat we really need to know is how to reproduce this issue or enough clues to enable us to make an educated guess as to how this is happening. The questions that spring to mind at this point are:\n- Has the application ever been reloaded?\n- Might these errors be triggered as an inactive request times out?\n- Access log entries for the relevant requests would also help", "id": 149819, "time": "2011-09-27T10:59:44Z", "bug_id": 51883, "creation_time": "2011-09-27T10:59:44Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 150766, "time": "2011-10-19T16:25:09Z", "bug_id": 51883, "creation_time": "2011-10-19T16:25:09Z", "is_private": false, "text": "Three weeks and no further information. Closing as WONTFIX as per previous comment."}]
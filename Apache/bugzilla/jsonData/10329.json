[{"count": 0, "tags": [], "creator": "jdc@nextjet.com", "attachment_id": null, "is_private": false, "id": 18721, "time": "2002-06-28T16:35:05Z", "bug_id": 10329, "creation_time": "2002-06-28T16:35:05Z", "text": "The default behavior is if depends=\"a\" is referenced by multiple targets, \nthat \"a\" is only run once.\nIn parallel though, is appears the call to \"a\" is not synchornized - and can \nhave several threads trying to execute it simultanteously the first time. \n(until whatever flag is asserted that \"a\" has already run)"}, {"count": 1, "tags": [], "creator": "stevel@apache.org", "attachment_id": null, "id": 18751, "time": "2002-06-28T23:30:19Z", "bug_id": 10329, "creation_time": "2002-06-28T23:30:19Z", "is_private": false, "text": "What do you mean, a call to \"a\"? Are you using <antcall> inside parallel to run\ntasks in parallel? Post the relevant snippet of your build file, please. \n\n\nI would advise you not to use parallel except in special cases such as\ndeployment or execution of external code. Ant tasks make no guarantees about\nthread safety, and things like <javac> are not re-entrant when the underlying\nlibs arent reentrant."}, {"count": 2, "tags": [], "bug_id": 10329, "text": "I believe in the case below -- \"b\" will sometimes run more than once...\n\n<target name=\"main\">\n <parallel>\n   <antcall target=\"a\">\n    <param name=\"something\" value=\"1\"/>\n   </antcall>\n   <antcall target=\"a\">\n    <param name=\"something\" value=\"2\"/>\n   </antcall> </parallel>\n </parallel>\n</target>\n\n<target name=\"a\" depends=\"b\">\n ...\n</target>\n\n<target name=\"b\">\n <echo message=\"You should only see me once!\"/>\n</target>\n\n\nI understand some of the internals of a target may not be entirely thread \nsafe... but the basis of the 'depends' function as is listed in the ant \ndocs: \"A target gets executed only once, even when more than one target depends \non it (see the previous example).\" I would hope at least this could be upheld.\n", "id": 18822, "time": "2002-07-01T21:42:17Z", "creator": "jdc@nextjet.com", "creation_time": "2002-07-01T21:42:17Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "stevel@apache.org", "attachment_id": null, "id": 18825, "time": "2002-07-02T06:27:25Z", "bug_id": 10329, "creation_time": "2002-07-02T06:27:25Z", "is_private": false, "text": "the good news: there is no inconsistency here between stuff executed in parallel\nwith stuff executed normally.\n\nthe bad news: works as designed. From the antcall documentation\n\"When a target is invoked by antcall, all of its dependent targets will also be\ncalled within the context of any new parameters. For example. if the target\n\"doSomethingElse\" depended on the target \"init\", then the antcall of\n\"doSomethingElse\" will call \"init\" during the call. Of course, any properties\ndefined in the antcall task or inherited from the calling target will be fixed\nand not overridable in the init task -or indeed in the \"doSomethingElse\" task. \"\n\n\nSo, you thought there was some kind of race condition causing dependencies to\nexecute more than once; really that always happens when you run antcall, that is\neffectively executing a target graph. Sorry for the confusion.\n\nmarking as not-a-bug"}]
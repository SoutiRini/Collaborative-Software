[{"count": 0, "tags": [], "text": "Configuration is: Apache 2.0.36, mod_jk 1.2.0 from CVS, Tomcat 3.3.1.\n\nApache configuration relevant to this:\n\n------------------------\n<IfModule mod_dir.c>\n    DirectoryIndex index.shtml index.html index.jsp index.vm index.php index.php\n</IfModule>\n------------------------\n\nmod_jk configuration:\n\n------------------------\n<IfModule mod_jk.c>\n\nJkWorkersFile /etc/tomcat/workers.properties\nJkLogFile     /var/apache/logs/mod_jk.log\nJkLogLevel    debug\n\nJkMount /*.jsp                  ajp13\nJkMount /*.vm                   ajp13\nJkMount /servlet/*              ajp13\nJkMount /login/j_security_check ajp13\n\n</IfModule>\n------------------------\n\nThe problem only occurs with default pages, in this case index.vm. When a\ndirectory URL is requested (e.g. http://www.testsite.dev/) the default page\nmapped through mod_jk is not picked up.\n\nHere is the log for mod_jk:\n\n------------------------\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI '/'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (599)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/index.shtml'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (599)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/index.html'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (599)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/index.jsp'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (558)]:\njk_uri_worker_map_t::map_uri_to_worker, Found a suffix match ajp13 -> *.jsp\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/index.vm'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (558)]:\njk_uri_worker_map_t::map_uri_to_worker, Found a suffix match ajp13 -> *.vm\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/index.php'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (599)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/index.php3'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (599)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/HEADER'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (599)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/README'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (599)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/icons/blank.gif'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (599)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/icons/unknown.gif'\n[Mon Jun 17 20:33:10 2002]  [jk_uri_worker_map.c (599)]:\njk_uri_worker_map_t::map_uri_to_worker, done without a match\n------------------------\n\nHowever, when the file is reffered to explicitly, it does work.\n\nBojan", "attachment_id": null, "bug_id": 9913, "id": 17908, "time": "2002-06-17T11:04:35Z", "creator": "bojan@rexursive.com", "creation_time": "2002-06-17T11:04:35Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bojan@rexursive.com", "attachment_id": null, "is_private": false, "id": 19653, "time": "2002-07-17T02:12:37Z", "bug_id": 9913, "creation_time": "2002-07-17T02:12:37Z", "text": "Finally had some more time to play with this. Here is what the problem is...\n\njk_handler starts with this (line 1184 in mod_jk.c):\n\n------------------------------\nif(strcmp(r->handler,JK_HANDLER))\n      return DECLINED;\n------------------------------\n\nwhen page is explicitly referenced, r->handler is jakarta-servlet, so all goes\nwell. However, when the page is the default page, r->handler is\nhttpd/unix-directory so jk_handler simply declines to serve the request.\n\nThe most obvious fix for this is:\n\n------------------------------\nif(strcmp(r->handler,JK_HANDLER) && strcmp(r->handler,DIR_MAGIC_TYPE))\n      return DECLINED;\n------------------------------\n\nI don't know enough about Apache 2 and mod_jk to vouch for this fix, so any of\nthe Apache/mod_jk specialists out there, please review before I commit.\n\nThe fix does cause (at least) one problem... The getServletPath() call returns\n'/' rather than actual page, for instance '/index.jsp' or '/index.vm', which is\ndifferent from 1.3.x.\n\nAnyway, some progress..."}, {"count": 2, "tags": [], "text": "... the getServletPath() returning '/' or '/path/to/page/' definitely causes\nmajor dramas ...\n\nIt causes the rewriten URL's to not have any extension (e.g. they end up being\nsomething like this: '/path/to/page/;jsessionid=xxxxxxxx'), which then causes\nmod_jk not to be picked to serve the request at all and Apache just proclaims\nthat the page does not exist...\n\nBack to the drawing board ;-)\n\nBojan", "is_private": false, "bug_id": 9913, "id": 19655, "time": "2002-07-17T03:01:18Z", "creator": "bojan@rexursive.com", "creation_time": "2002-07-17T03:01:18Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 9913, "attachment_id": null, "id": 19660, "time": "2002-07-17T04:50:56Z", "creator": "miesfeld@acm.org", "creation_time": "2002-07-17T04:50:56Z", "is_private": false, "text": "I am not sure but this seems to me to be like the bug I opened, #10789, \nagainst mod_jk2.  At least the symptom is the same, when a directory URL is \nrequested, the DirectoryIndex file (default page) is not being handled by \nmod_jk2 (mod_jk).\n\nI just built mod_jk and put some fprintf statements in it to trace the entry \nof the hook functions for the module.  This is the print out from requesting \nhttp://my.numeric.ip/.  It looks exactly the same as it does for mod_jk2, i.e. \nthe translate and map_to_storage hooks pick up index.jsp, but then the handler \nhook is not getting invoked.\n\nG:\\Apache32\\Apache2\\bin>apache -X\njk_translate( )       ENTER\n  Unparsed uri: /\n  Return DECLINED\njk_map_to_storage( )  ENTER\n  Unparsed uri: /\n  Return DECLINED\njk_translate( )       ENTER\n  Unparsed uri: /index.html\n  Return DECLINED\njk_map_to_storage( )  ENTER\n  Unparsed uri: /index.html\n  Return DECLINED\njk_translate( )       ENTER\n  Unparsed uri: /index.jsp\n  Return OK\njk_map_to_storage( )  ENTER\n  Unparsed uri: /index.jsp\n  Return OK\njk_translate( )       ENTER\n  Unparsed uri: /error/HTTP_FORBIDDEN.html.var\n  Return DECLINED\njk_map_to_storage( )  ENTER\n  Unparsed uri: /error/HTTP_FORBIDDEN.html.var\n  Return DECLINED\njk_translate( )       ENTER\n  Unparsed uri: /error/include/top.html\n  Return DECLINED\njk_map_to_storage( )  ENTER\n  Unparsed uri: /error/include/top.html\n  Return DECLINED\njk_handler( )         ENTER\n  Unparsed uri: /error/include/top.html\n  Return DECLINED\njk_translate( )       ENTER\n  Unparsed uri: /error/include/bottom.html\n  Return DECLINED\njk_map_to_storage( )  ENTER\n  Unparsed uri: /error/include/bottom.html\n  Return DECLINED\njk_handler( )         ENTER\n  Unparsed uri: /error/include/bottom.html\n  Return DECLINED\njk_translate( )       ENTER\n  Unparsed uri: /error/include/../contact.html.var\n  Return DECLINED\njk_map_to_storage( )  ENTER\n  Unparsed uri: /error/include/../contact.html.var\n  Return DECLINED\n\nDo you think 9913 and 10789 are the same thing?"}, {"count": 4, "tags": [], "creator": "bojan@rexursive.com", "attachment_id": null, "is_private": false, "id": 19661, "time": "2002-07-17T05:13:40Z", "bug_id": 9913, "creation_time": "2002-07-17T05:13:40Z", "text": "Yep, I'd say so.\n\nBojan"}, {"count": 5, "tags": [], "text": "Actually, the fix works quite fine for JSP's, since Tomcat 3.3.x automagically\nredirects all requests that end in '/' to the correct JSP. The only problem that\nthe fix was causing was related to Velocity pages served by my own PumpServlet,\nwhich depended upon getServletPath() returning the actual page. And since that's\neasy to fix...\n\nSo, unless there is a better fix out there, the above goes in.\n\nBojan", "attachment_id": null, "bug_id": 9913, "id": 19663, "time": "2002-07-17T05:41:42Z", "creator": "bojan@rexursive.com", "creation_time": "2002-07-17T05:41:42Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "bojan@rexursive.com", "text": "Ropen to change the fix.", "count": 6, "id": 19884, "time": "2002-07-20T12:18:10Z", "bug_id": 9913, "creation_time": "2002-07-20T12:18:10Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 9913, "attachment_id": null, "text": "Revert the old fix. No longer needed.\n\nA slightly more complicated fix to accomodate mod_dir, which performs 'what if'\nsub-requests and expects to see r->finfo.filetype back. Also includes making\nr->filename absolute rather then relative.\n\nBojan", "id": 19885, "time": "2002-07-20T12:20:16Z", "creator": "bojan@rexursive.com", "creation_time": "2002-07-20T12:20:16Z", "is_private": false}]
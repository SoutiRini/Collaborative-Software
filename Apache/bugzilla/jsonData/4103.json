[{"count": 0, "tags": [], "creator": "vicentesalvador@netscape.net", "text": "In the expire method of StandardSession, the session and all of his attibutes are \nremoved before calling the listeners. This mades unavailable to the listeners to\nlog any information of the session expired.\n\nThis is the patch to solve this situation (Can it be solved on 4.0.1 timaframe?):\n\n542,551d541\n<         setValid(false);\n< \n<         // Remove this session from our manager's active sessions\n<         if (manager != null)\n<             manager.remove(this);\n< \n<         // Unbind any objects associated with this session\n<         String keys[] = keys();\n<         for (int i = 0; i < keys.length; i++)\n<             removeAttribute(keys[i]);\n580a571,582\n>         // Invalidate the session\n>         setValid(false);\n> \n>         // Remove this session from our manager's active sessions\n>         if (manager != null)\n>             manager.remove(this);\n> \n>         // Unbind any objects associated with this session\n>         String keys[] = keys();\n>         for (int i = 0; i < keys.length; i++)\n>             removeAttribute(keys[i]);\n>", "id": 6585, "time": "2001-10-11T05:56:48Z", "bug_id": 4103, "creation_time": "2001-10-11T05:56:48Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 4103, "attachment_id": null, "is_private": false, "id": 6597, "time": "2001-10-11T09:09:14Z", "creator": "remm@apache.org", "creation_time": "2001-10-11T09:09:14Z", "text": "This is not specified in the spec, but it seems normal to me to notify after \nthe operation is successful."}, {"count": 2, "attachment_id": null, "bug_id": 4103, "is_private": false, "id": 6635, "time": "2001-10-12T09:44:35Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-10-12T09:44:35Z", "tags": [], "text": "A request for clarification from the specification lead has been submitted.\n\nIn the mean time, your listener can still be aware of what attributes WERE in\nthe session by implementing both HttpSessionListener and\nHttpSessionAttributesListener.  You will hear about the attributes being removed\nbefore the sessionDestroyed() event is executed.\n"}, {"count": 3, "tags": [], "bug_id": 4103, "text": "The current behavior is in accordance with the Javadocs (which are part of the\nServlet 2.3 spec language now):\n\n[HttpSessionListener.sessionDestroyed()]\n    Notification that a session was invalidated.\n\n[HttpSession.invalidate()]\n    Invalidates this session then unbinds any objects bound to it.\n\nIn other words, by the time the invalidation is completed, all attributes have\nbeen removed.  And, invalidation is completed before sessionDestroyed() is\ncalled.\n", "id": 6655, "time": "2001-10-12T15:59:55Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-10-12T15:59:55Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "As of today, I quote this reference: \nhttp://java.sun.com/webservices/docs/1.3/api/javax/servlet/http/HttpSessionListener.html \n \nwhere it says: \n\"public void sessionDestroyed(HttpSessionEvent se) \n Notification that a session is about to be invalidated. \" \n                                ^^^^^^^^^^^ \nAny other behavior is totally nonsensical since this listener is exactly meant \nto dispose of resources in session attributes, in the easiest way. \n ", "attachment_id": null, "id": 54148, "creator": "evrard@sibio.fr", "time": "2004-03-17T15:22:40Z", "bug_id": 4103, "creation_time": "2004-03-17T15:22:40Z", "is_private": false}, {"count": 5, "tags": [], "creator": "funkman@joedog.org", "attachment_id": null, "id": 54153, "time": "2004-03-17T15:30:27Z", "bug_id": 4103, "creation_time": "2004-03-17T15:30:27Z", "is_private": false, "text": "Your doc link covers servlet api 2.4. The behavior change from 2.3 to 2.4.\n\n(IIRC) Tomcat 4 (based on servlet spec 2.3) and 5 (based on servlet spec 2.4)\nhandle this correctly."}]
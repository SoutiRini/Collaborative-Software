[{"count": 0, "tags": [], "bug_id": 7319, "attachment_id": null, "text": "I'm struggling with this for weeks now: with pre-4.0.3 releases, I was unable \nto grant permissions to my webapp using codeBase. Just specifiying \"grant {}\" \nworked fine, however. After upgrading to 4.0.3, the following happens if I \nstart Tomcat with \"-security\" and using the default catalina.policy:\n\nException initializing TldLocationsCache: XML parsing error on file /WEB-\nINF/web.xml: Internal Error: File /javax/servlet/resources/web-app_2_3.dtd not \nfound\n\nThis just appears in the logfile (no AccessControlException is thrown) and \nprevents my webapp from working as the web.xml is obviously not parsed and \ntherefore no init-params are available to my servlets.\n\nI'm not too familiar with the Tomcat source but after playing around for a \nwhile I'm convinced that it has something to do with the codeBase applied to \njar files: everything works fine if I unpack ALL jars (from my webapp, my libs \nas well as the jars that come with tomcat) or if I simply omit \"codeBase\" in \ncatalina.policy (which is obviously just like running Tomcat without \nSecurityManager).", "id": 12124, "time": "2002-03-21T13:02:15Z", "creator": "kim@deepfx.com", "creation_time": "2002-03-21T13:02:15Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 7319, "attachment_id": null, "text": "Since the report doesn't mention any webapp deployed on Tomcat, or the OS used,\nI tried running a stock TC 4.0.3 on my PC (Win2k / JDK 1.3.1) with the security\nmanager, and it worked.", "id": 12153, "time": "2002-03-21T19:39:27Z", "creator": "remm@apache.org", "creation_time": "2002-03-21T19:39:27Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 7319, "is_private": false, "count": 2, "id": 12158, "time": "2002-03-21T21:21:32Z", "creator": "kim@deepfx.com", "creation_time": "2002-03-21T21:21:32Z", "text": "Ok, bugzilla quirks :-\\ :\n\nI tried TC 4.0 / TC 4.0.3 / TC 4.0.3-LE with Sun JDK 1.4 / Sun JDK 1.3.1 / IBM \nJDK 1.3 on both Linux (RedHat 7.2 / SuSE 7.2) and Win2k. The only webapp \ndeployed is my own, mapped to path=\"\". The webapp is broken into several jars \nthat, along with any 3rd party libs, live in /WEB-INF/lib (except the JSPs, \nhowever).\n\n- TC 4.0* / Sun 1.3: \"codeBase\"-granting to my webapp does not work, everything \nelse runs just fine (except that I get parsing errors for tld files, but that's \nanother issue).\n\n- TC 4.0* / IBM 1.3:  like above.\n\n- TC 4.0.3* / Sun 1.4: codeBase for my webapp does not work PLUS the error with \nthe \"TldLocationsCache\".\n\nSo is it a JDK 1.4 issue? Is it likely that things get worse with new \nreleases? ;)\n\nPLEASE, no one out there having the same trouble? Am I suffering from voodoo?"}, {"count": 3, "tags": [], "creator": "randy.watson@guidant.com", "text": "I get the same error you do:\n\n2002-05-15 14:29:23 action: Mapping for servlet 'action' = '*.do'\n2002-05-15 14:29:23 jsp: init\n2002-05-15 14:29:24 Exception initializing TldLocationsCache: XML parsing error\non file /WEB-INF/web.xml:\n Internal Error: File /javax/servlet/resources/web-app_2_3.dtd not found\n2002-05-15 14:29:24 debugjsp: init\n2002-05-15 14:29:24 Specified compiler plugin class\ncom.borland.jbuilder.webserverglue.tomcat.jsp.JasperS\nunJavaCompiler not found. Will default to Sun Java Compiler.\n2002-05-15 14:29:24 Exception initializing TldLocationsCache: XML parsing error\non file /WEB-INF/web.xml:\n Internal Error: File /javax/servlet/resources/web-app_2_3.dtd not found\n\nThis started with tomcat 4.0.1, when I was trying to deploy another webapp I've\njust written that requires RMI.  When I enabled the security manager it broke my\nother webapp (that up till now was working fine).  I decided to focus on the\nwebapp that works without the security manager.  I couldn't get the codebase\nproperty to work, but if I just grant without it I could get my app to work.  I\nupgraded to 4.0.3, and the previous problem went away to be replaced with this\nproblem.  When I try to load the app from a browser,  I get:\n\n<html><head><title>Apache Tomcat/4.0.3 - Error\nreport</title><STYLE><!--H1{font-family : sans-serif,Arial,Tahoma;color :\nwhite;background-color : #0086b2;} BODY{font-family :\nsans-serif,Arial,Tahoma;color : black;background-color : white;} B{color :\nwhite;background-color : #0086b2;} HR{color : #0086b2;} --></STYLE>\n</head><body><h1>Apache Tomcat/4.0.3 - HTTP Status 500 - Internal Server\nError</h1><HR size=\"1\" noshade><p><b>type</b> Exception\nreport</p><p><b>message</b> <u>Internal Server\nError</u></p><p><b>description</b> <u>The server encountered an internal error\n(Internal Server Error) that prevented it from fulfilling this\nrequest.</u></p><p><b>exception</b> <pre>org.apache.jasper.JasperException: XML\nparsing error on file /WEB-INF/struts-bean.tld: Internal Error: File\n/javax/servlet/jsp/resources/web-jsptaglibrary_1_1.dtd not found\n\n", "id": 16192, "time": "2002-05-15T19:18:07Z", "bug_id": 7319, "creation_time": "2002-05-15T19:18:07Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "You can see this if you have an XML parser in your /WEB-INF/lib directory.\nJasper will use that XML parser instead of the global XML parser installed\nwith Tomcat.  The parser in your /WEB-INF/lib does not have the permissions\nrequired to read the dtd from the jasper-runtime.jar.\n\nHmmm... This might be fixable if there is a way to force the JSP Page\nCompiler in Jasper to use the Tomcat XML parser classes rather than the\nxml parser installed in /WEB-INF/lib.\n\n", "is_private": false, "id": 16209, "creator": "glenn@apache.org", "time": "2002-05-15T23:25:26Z", "bug_id": 7319, "creation_time": "2002-05-15T23:25:26Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Interesting!  I rebuilt the war file, didn't include the parser, and now I get a\ndifferent error.  If I set security to:\ngrant {\n  permission java.security.AllPermission;\n};\n\nEverything works fine.  If I try to lock things down to the webapp dir/subdirs:\n\ngrant codeBase \"file:${catalina.home}/webapps/prm_web/-\" {\n  permission java.security.AllPermission;\n};\n\nreport</p><p><b>message</b> <u>Internal Server\nError</u></p><p><b>description</b> <u>The server encountered an internal error\n(Internal Server Error) that prevented it from fulfilling this\nrequest.</u></p><p><b>exception</b> <pre>java.lang.NullPointerException\n\tat prm_db_query.PrmDataSource.submitQuery(PrmDataSource.java:147)\n\tat prm_db_forms.QueryManagerAction.submitQuery(QueryManagerAction.java:205)\n\tat prm_db_forms.QueryManagerAction.perform(QueryManagerAction.java:106)\n\nI've also tried setting the permissions also with the lib/- and the classes/-. \nIt works to the point of the remote query to a postgresql db, but dies there. \nI'm thinking that this is less of a bug and more of a config issue, since it\nworks if I wide open things with the security manager.\n", "is_private": false, "id": 16235, "creator": "randy.watson@guidant.com", "time": "2002-05-16T15:30:02Z", "bug_id": 7319, "creation_time": "2002-05-16T15:30:02Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 7319, "is_private": false, "count": 6, "id": 17242, "time": "2002-06-05T23:54:01Z", "creator": "remm@apache.org", "creation_time": "2002-06-05T23:54:01Z", "text": "4.0.x uses URLs prefixed with jar:file: for the JAR codeBases, so your\ndeclarations won't work.\n4.1.x use more conventional file URLs for codeBases (indentical to those used by\nthe URL classloader), so the URLs you mention in your examples would work better.\n\nI mark the bug as enhancement, sonce I am convinced it works fine when using the\nright URLs (although it is not very convinient at all)."}]
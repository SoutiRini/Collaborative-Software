[{"count": 0, "tags": [], "bug_id": 34107, "attachment_id": null, "id": 47673, "time": "2005-03-21T16:41:12Z", "creator": "bmilbratz@outstart.com", "creation_time": "2005-03-21T16:41:12Z", "is_private": false, "text": "This may not be a bug, as it appears the servlet 2.4 spec is not precise on this\nmatter.\n\nThe issue is that in previous versions of Tomcat and Weblogic an implementation\nof javax.servlet.http.HttpSessionBindingListener could successfully make this call:\n\n   public void valueUnbound(HttpSessionBindingEvent event)\n   {\n      long lastAccessedTime =  event.getSession().getLastAccessedTime();\n\nIn Tomcat 5, the Session is already invalidated by the time the container calls\n'valueUnbound', so the call to getLastAccessedTime() fails.\n\n\nSections 7.4-7.6 of the 2.4 servlet specification do not precisely specify\nwhether or not the session is valid at the time the container calls valueUnbound().\n\nThis code has functioned fine in previous versions of Catalina/Tomcat as well as\nweblogic. \n\nI have a code workaround for this, but wanted to determine if this was an issue."}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "Why not ...\n\nCan you test this kind of patch ? (the lines won't match exactly as this is for\nthe 5.5 branch, but you should get the idea)\n\n  Index: StandardSession.java\n  ===================================================================\n  RCS file:\n/home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/catalina/session/StandardSession.java,v\n  retrieving revision 1.49\n  retrieving revision 1.50\n  diff -u -r1.49 -r1.50\n  --- StandardSession.java\t22 Nov 2004 16:35:18 -0000\t1.49\n  +++ StandardSession.java\t21 Mar 2005 16:25:53 -0000\t1.50\n  @@ -709,14 +709,14 @@\n                   fireSessionEvent(Session.SESSION_DESTROYED_EVENT, null);\n               }\n   \n  -            // We have completed expire of this session\n  -            expiring = false;\n  -\n               // Unbind any objects associated with this session\n               String keys[] = keys();\n               for (int i = 0; i < keys.length; i++)\n                   removeAttributeInternal(keys[i], notify);\n   \n  +            // We have completed expire of this session\n  +            expiring = false;\n  +\n           }\n   \n       }\n", "id": 47277, "time": "2005-03-21T17:27:23Z", "bug_id": 34107, "creation_time": "2005-03-21T17:27:23Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 34107, "attachment_id": null, "id": 45996, "time": "2005-03-21T20:43:52Z", "creator": "william.barker@wilshire.com", "creation_time": "2005-03-21T20:43:52Z", "is_private": false, "text": "The patch is bad (and I will veto it).  \nThis is per the servlet-spec:\n<spec-quote version=\"2.4\" section=\"15.1.7\">\nFor session that are invalidated or expire, notifications are sent after the \nsession has been invalidated or expired.\n</spec-quote>\n\nThe spec doesn't mandate a isValid check in getLastAccessedTime, so it would \nbe possible to simply remove the check there."}, {"count": 3, "tags": [], "bug_id": 34107, "text": "Sorry for the trouble.", "id": 45841, "time": "2005-03-21T21:13:59Z", "creator": "remm@apache.org", "creation_time": "2005-03-21T21:13:59Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "*** Bug 38242 has been marked as a duplicate of this bug. ***", "attachment_id": null, "id": 84550, "creator": "william.barker@wilshire.com", "time": "2006-01-12T18:12:52Z", "bug_id": 34107, "creation_time": "2006-01-12T18:12:52Z", "is_private": false}, {"count": 5, "attachment_id": null, "creator": "apernoud@sopragroup.com", "text": "I'm sorry but I also think this is a bug of tomcat 5.\nSee this mail (called session.invalidate() change) :\nhttp://www.mail-archive.com/users@tomcat.apache.org/msg01377.html\n\nI have the exact same trouble, and while testing tomcat 5.5.15 with our apps, I\nconfirm this is the only webapp server I know that doesn't at least allow the\nservlet to get the ID of the session that was invalidated (and why not all the\nother stuff... after all it's up to the developper to know what he's doing...).\n\nWe need this id for cache cleaning here, so far I can't validate tomcat 5.x with\nour webapps because we'll have memory leak, unless users properly exit the\napplication everytime, which they do of course not :)\n\nAny reason for this change ?", "id": 85355, "time": "2006-02-02T17:54:57Z", "bug_id": 34107, "creation_time": "2006-02-02T17:54:57Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 34107, "attachment_id": null, "id": 85356, "time": "2006-02-02T18:08:20Z", "creator": "apernoud@sopragroup.com", "creation_time": "2006-02-02T18:08:20Z", "is_private": false, "text": "Another question : what's the use of the valueUnbound that gives us an\nHttpSessionBindingEvent if we can't make any call at it whithout getting this\nexception ?\nThe \"event\" most important stuff is the HttpSession (I would even say it's the\nonly stuff, and we can't work at all with it whithout getting the\nIllegalStateException.\n\nAnd reading the spec, I agree that any call made \"by a request\" after the\nsession was invalidated must throw the Exception, but not the ones made in the\nvalueUnbound. If you don't agree I'd like to be explained the interest of the\nSessionListener."}, {"count": 7, "tags": [], "creator": "apache.org@tisc.de", "attachment_id": null, "text": "I've came across this issue too - we've got a SessionListener here to expose a\nsession overview to the user/admin (without sesion IDs, of course).\n\nI reverted to storing the HttpSession itself in a WeakHashMap and use it as an\nindex. I'm not sure whether this is safe or maybe a disaster waiting to happen.", "id": 85358, "time": "2006-02-02T18:21:10Z", "bug_id": 34107, "creation_time": "2006-02-02T18:21:10Z", "is_private": false}, {"count": 8, "tags": [], "text": "Seems like you disagree, but can you explain where is your disagreement please ?\n\nI've read the discussion, the forums, spent time on it, understanding why our\nwebapps didn't work fine on tomcat 5, not simply opened a new bug in the database.\nI tried to explain why I also think (because I'm not alone in this case, see the\nmail-archive, and the bug database resolved as duplicated) this is a bug of\ntomcat 5, other webapp servers allow access to session in the valueUnbound\n(including Tomcat 3.x, Tomcat 4.x, Websphere 5.x, JBoss, Weblogic, Oracle\nApplication Server...)\n\nand all I get is a \"Resolved : Invalid\"...", "attachment_id": null, "id": 85359, "creator": "apernoud@sopragroup.com", "time": "2006-02-02T18:23:10Z", "bug_id": 34107, "creation_time": "2006-02-02T18:23:10Z", "is_private": false}, {"count": 9, "attachment_id": null, "creator": "apernoud@sopragroup.com", "text": "(In reply to comment #7)\n> I've came across this issue too - we've got a SessionListener here to expose a\n> session overview to the user/admin (without sesion IDs, of course).\n> \n> I reverted to storing the HttpSession itself in a WeakHashMap and use it as an\n> index. I'm not sure whether this is safe or maybe a disaster waiting to happen.\n\nI've also thought of such a way to bypass the stuff, using HttpSession.hashCode\ninstead of the session ID, but I find it awful ;)\n", "id": 85360, "time": "2006-02-02T18:24:04Z", "bug_id": 34107, "creation_time": "2006-02-02T18:24:04Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "text": "(In reply to comment #8)\n> and all I get is a \"Resolved : Invalid\"...\n\nIt was invalid before: it remains invalid. All this is implemented as expected\nso there is no bug.", "attachment_id": null, "id": 85364, "creator": "remm@apache.org", "time": "2006-02-02T18:58:01Z", "bug_id": 34107, "creation_time": "2006-02-02T18:58:01Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 34107, "text": "And it doesn't bother you that Tomcat 5.x is the only webapp server \nimplementing it this way ?\n\nMarking the session has invalid (so that a call to isValid() returns false), \nwhy not, that's what the spec may say, but throwing an exception and prevent \ndevelopers from using it, I'd like to see the part of the spec saying that.", "id": 85365, "time": "2006-02-02T19:16:30Z", "creator": "apernoud@sopragroup.com", "creation_time": "2006-02-02T19:16:30Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 34107, "text": "Well re-reading the spec, it finally seems that this the way the 2.4 servlet \nis interpreted, but honestly I don't get the interest of it.\nSorry for inconvenience", "id": 85366, "time": "2006-02-02T19:22:27Z", "creator": "apernoud@sopragroup.com", "creation_time": "2006-02-02T19:22:27Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "text": "(In reply to comment #12)\n> Well re-reading the spec, it finally seems that this the way the 2.4 servlet \n> is interpreted, but honestly I don't get the interest of it.\n\nDon't worry, I don't see it either.", "attachment_id": null, "id": 85367, "creator": "remm@apache.org", "time": "2006-02-02T19:25:05Z", "bug_id": 34107, "creation_time": "2006-02-02T19:25:05Z", "is_private": false}, {"count": 14, "attachment_id": null, "creator": "apernoud@sopragroup.com", "text": "(In reply to comment #13)\n> (In reply to comment #12)\n> > Well re-reading the spec, it finally seems that this the way the 2.4 \nservlet \n> > is interpreted, but honestly I don't get the interest of it.\n> Don't worry, I don't see it either.\n\nThat's fun, I've since found a lot of threads about it :\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=36994\nhttp://jira.opensymphony.com/browse/CACHE-229\n\nSomeone even told to complain to servletapi-feedback@eng.sun.com , and \napparently \"they\" kept it in 2.4 and even in 2.5.\n\nDo you think it may change anything to complain ? Cause I really agree with \ndevelopers taking part of the discussion, this \"simple\" change will break a \nlot of framework, and I really really don't get the interest of the \nsessionListener anymore :))))))", "id": 85368, "time": "2006-02-02T19:35:47Z", "bug_id": 34107, "creation_time": "2006-02-02T19:35:47Z", "tags": [], "is_private": false}, {"count": 15, "attachment_id": null, "creator": "robbyoung21@gmail.com", "text": "Duplicate bug:\n\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=38242\n\nThis is implemented properly.  See above bug issue.", "id": 89658, "time": "2006-06-01T15:30:38Z", "bug_id": 34107, "creation_time": "2006-06-01T15:30:38Z", "tags": [], "is_private": false}]
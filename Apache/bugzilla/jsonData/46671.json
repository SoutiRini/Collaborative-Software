[{"count": 0, "tags": [], "bug_id": 46671, "text": "FreeBSD 7.0 with PAE.\ncimpiled with libpth (with pthread more problems, but i didn't fix it)\n\nAfter start Apache working up to some hours and got Segmentation fault error in logs.\n[Sat Feb 07 19:46:50 2009] [notice] Apache/2.2.11 (Unix) PHP/5.2.8 configured -- resuming normal operations\n[Sat Feb 07 20:23:28 2009] [notice] child pid 51670 exit signal Segmentation fault (11)\n[Sat Feb 07 20:39:34 2009] [notice] caught SIGTERM, shutting down\n[Sat Feb 07 20:40:02 2009] [notice] Apache/2.2.11 (Unix) PHP/5.2.8 configured -- resuming normal operations\n[Sat Feb 07 20:41:25 2009] [notice] child pid 55560 exit signal Segmentation fault (11)\n\nAfter each segfault one of server died and didn't start. Its look in server -status like this:\nBEFORE:\nR__R_C___R__RR___RR______R_RR_R____W____C___C_____R___________R_\n____R___RR__C___C______CCR__R___R___RR____C_R___C______WR___RR_W\n_C____C__RR___RCC___R_RR_RR_______R_____R_____CC__RC______C____R\n__RRW__RR__C_____R__C_R_R___C_C__R___R_R_W____WR____RC__R_C_C_W_\n_W_______R_______RW__RW___C_______RR_R_R____R_R_R___WR_WCC___RR_\n_______C__R____R__R______R____R___R________C_RRCC______R__R__R__\nC___R_____W____R_W__C_C_____C_RC_______RRR_R_C___RC_R______R__W_\n__RW_R_____CW_R_RR_C_R_W_R___R____R____R_R__C___C___W__R________\n__C__RR____________R____WC______C____C__R_R_CW______C____R__C__R\nRWC__R_______C___________W___C___R____R__R_R_RR____RWC_W__RR__R_\n\nAFTER first sighfault:\nR__R_C___R__RR___RR______R_RR_R____W____C___C_____R___________R_\n____R___RR__C___C______CCR__R___R___RR____C_R___C______WR___RR_W\n_C____C__RR___RCC___R_RR_RR_______R_____R_____CC__RC______C____R\n................................................................\n__RRW__RR__C_____R__C_R_R___C_C__R___R_R_W____WR____RC__R_C_C_W_\n_W_______R_______RW__RW___C_______RR_R_R____R_R_R___WR_WCC___RR_\n_______C__R____R__R______R____R___R________C_RRCC______R__R__R__\nC___R_____W____R_W__C_C_____C_RC_______RRR_R_C___RC_R______R__W_\n__RW_R_____CW_R_RR_C_R_W_R___R____R____R_R__C___C___W__R________\n__C__RR____________R____WC______C____C__R_R_CW______C____R__C__R\nRWC__R_______C___________W___C___R____R__R_R_RR____RWC_W__RR__R_\n\nAFTER second sighfault:\nR__R_C___R__RR___RR______R_RR_R____W____C___C_____R___________R_\n____R___RR__C___C______CCR__R___R___RR____C_R___C______WR___RR_W\n_C____C__RR___RCC___R_RR_RR_______R_____R_____CC__RC______C____R\n................................................................\n__RRW__RR__C_____R__C_R_R___C_C__R___R_R_W____WR____RC__R_C_C_W_\n_W_______R_______RW__RW___C_______RR_R_R____R_R_R___WR_WCC___RR_\n................................................................\n_______C__R____R__R______R____R___R________C_RRCC______R__R__R__\nC___R_____W____R_W__C_C_____C_RC_______RRR_R_C___RC_R______R__W_\n__RW_R_____CW_R_RR_C_R_W_R___R____R____R_R__C___C___W__R________\n__C__RR____________R____WC______C____C__R_R_CW______C____R__C__R\nRWC__R_______C___________W___C___R____R__R_R_RR____RWC_W__RR__R_\n\n\nWhen maximum of allowed server (ServerLimit) is reached (with dead lines)- apache died. For each of segfault I got a apache core.\n\nCore was generated by `httpd'.\nProgram terminated with signal 11, Segmentation fault.\nReading symbols from /lib/libm.so.5...done.\nLoaded symbols for /lib/libm.so.5\nReading symbols from /usr/local/lib/libaprutil-1.so.3...done.\nLoaded symbols for /usr/local/lib/libaprutil-1.so.3\nReading symbols from /usr/local/lib/libexpat.so.1...done.\nLoaded symbols for /usr/local/lib/libexpat.so.1\nReading symbols from /usr/local/lib/libapr-1.so.3...done.\nLoaded symbols for /usr/local/lib/libapr-1.so.3\nReading symbols from /lib/libcrypt.so.4...done.\nLoaded symbols for /lib/libcrypt.so.4\nReading symbols from /lib/libthr.so.3...done.\nLoaded symbols for /lib/libthr.so.3\nReading symbols from /lib/libc.so.7...done.\nLoaded symbols for /lib/libc.so.7\nReading symbols from /usr/local/libexec/apache2/mod_authz_host.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_authz_host.so\nReading symbols from /usr/local/libexec/apache2/mod_env.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_env.so\nReading symbols from /usr/local/libexec/apache2/mod_headers.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_headers.so\nReading symbols from /usr/local/libexec/apache2/mod_setenvif.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_setenvif.so\nReading symbols from /usr/local/libexec/apache2/mod_mime.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_mime.so\nReading symbols from /usr/local/libexec/apache2/mod_status.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_status.so\nReading symbols from /usr/local/libexec/apache2/mod_cgi.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_cgi.so\nReading symbols from /usr/local/libexec/apache2/mod_negotiation.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_negotiation.so\nReading symbols from /usr/local/libexec/apache2/mod_dir.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_dir.so\nReading symbols from /usr/local/libexec/apache2/mod_actions.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_actions.so\nReading symbols from /usr/local/libexec/apache2/mod_alias.so...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_alias.so\nReading symbols from /usr/local/libexec/apache2/libphp5.so...done.\nLoaded symbols for /usr/local/libexec/apache2/libphp5.so\nReading symbols from /usr/local/lib/mysql/libmysqlclient_r.so.15...done.\nLoaded symbols for /usr/local/lib/mysql/libmysqlclient_r.so.15\nReading symbols from /usr/local/lib/libfreetype.so.9...done.\nLoaded symbols for /usr/local/lib/libfreetype.so.9\nReading symbols from /usr/local/lib/libpng.so.5...done.\nLoaded symbols for /usr/local/lib/libpng.so.5\nReading symbols from /lib/libz.so.4...done.\nLoaded symbols for /lib/libz.so.4\nReading symbols from /usr/local/lib/libjpeg.so.9...done.\nLoaded symbols for /usr/local/lib/libjpeg.so.9\nReading symbols from /usr/local/lib/libcurl.so.4...done.\nLoaded symbols for /usr/local/lib/libcurl.so.4\nReading symbols from /usr/lib/libssl.so.5...done.\nLoaded symbols for /usr/lib/libssl.so.5\nReading symbols from /lib/libcrypto.so.5...done.\nLoaded symbols for /lib/libcrypto.so.5\nReading symbols from /usr/local/lib/libxml2.so.5...done.\nLoaded symbols for /usr/local/lib/libxml2.so.5\nReading symbols from /usr/local/lib/libiconv.so.3...done.\nLoaded symbols for /usr/local/lib/libiconv.so.3\nReading symbols from /usr/local/lib/php/extensions/no-debug-zts-20060613/eaccelerator.so...done.\nLoaded symbols for /usr/local/lib/php/extensions/no-debug-zts-20060613/eaccelerator.so\nReading symbols from /usr/local/lib/php/extensions/no-debug-zts-20060613/imagick.so...done.\nLoaded symbols for /usr/local/lib/php/extensions/no-debug-zts-20060613/imagick.so\nReading symbols from /usr/local/lib/libMagickWand.so.2...done.\nLoaded symbols for /usr/local/lib/libMagickWand.so.2\nReading symbols from /usr/local/lib/libMagickCore.so.2...done.\nLoaded symbols for /usr/local/lib/libMagickCore.so.2\nReading symbols from /usr/lib/libbz2.so.3...done.\nLoaded symbols for /usr/lib/libbz2.so.3\nReading symbols from /usr/lib/libgomp.so.1...done.\nLoaded symbols for /usr/lib/libgomp.so.1\nReading symbols from /libexec/ld-elf.so.1...done.\nLoaded symbols for /libexec/ld-elf.so.1\n#0  0x28163188 in sem_init () from /lib/libthr.so.3\n[New Thread 0x28301100 (LWP 100564)]\n(gdb) thread apply all bt full\n\nThread 1 (Thread 0x28301100 (LWP 100564)):\n#0  0x28163188 in sem_init () from /lib/libthr.so.3\nNo symbol table info available.\n#1  0x282fc5b9 in GOMP_ordered_start () from /usr/lib/libgomp.so.1\nNo symbol table info available.\n#2  0x282fd145 in omp_get_nested () from /usr/lib/libgomp.so.1\nNo symbol table info available.\n#3  0x280c63f4 in ?? () from /libexec/ld-elf.so.1\nNo symbol table info available.\n#4  0x280cefc0 in ?? ()\nNo symbol table info available.\n#5  0xbf7fe9f8 in ?? ()\nNo symbol table info available.\n#6  0x282f9bc1 in ?? () from /usr/lib/libgomp.so.1\nNo symbol table info available.\n#7  0x280c6560 in ?? () from /libexec/ld-elf.so.1\nNo symbol table info available.\n#8  0x280c63f4 in ?? () from /libexec/ld-elf.so.1\nNo symbol table info available.\n#9  0xbf7fe9f8 in ?? ()\nNo symbol table info available.\n#10 0x280a43bf in dlsym () from /libexec/ld-elf.so.1\nNo symbol table info available.\n\nSo, I tried to change AcceptMutex, change \"worker\" options, but it doesn't help\nMy option is now:\nServerLimit 64\nStartServers 10\nMaxClients 1024\nMinSpareThreads 75\nMaxSpareThreads 1024\n\nThreadsPerChild 64\n#ThreadLimit 100\n\nMaxRequestsPerChild 0\n\nKeepAlive Off\nMaxKeepAliveRequests 600\nKeepAliveTimeout 3", "id": 124708, "time": "2009-02-07T12:01:05Z", "creator": "tooriun@gmail.com", "creation_time": "2009-02-07T12:01:05Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "tooriun@gmail.com", "attachment_id": null, "text": "*** Bug 46684 has been marked as a duplicate of this bug. ***", "id": 124741, "time": "2009-02-09T10:48:43Z", "bug_id": 46671, "creation_time": "2009-02-09T10:48:43Z", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 23242\nCrash core dump", "attachment_id": 23242, "id": 124742, "creator": "tooriun@gmail.com", "time": "2009-02-09T10:49:45Z", "bug_id": 46671, "creation_time": "2009-02-09T10:49:45Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 46671, "text": "You are using a threaded MPM not only with mod_php, but with a number of libraries known not to be thread-safe.  When you do that, occasional segfaults are to be expected.", "id": 127390, "time": "2009-05-25T15:10:57Z", "creator": "nick@webthing.com", "creation_time": "2009-05-25T15:10:57Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 46671, "text": "(In reply to comment #3)\n> You are using a threaded MPM not only with mod_php, but with a number of\n> libraries known not to be thread-safe.  When you do that, occasional segfaults\n> are to be expected.\nIt's possible, but I talk not about segfault, but about behaviour after segfault. As described in doc, apache child must restart (or just die) after segfault, but his not. So, after this happend many times apache have no more limit for run new childs and crashes as result of limit excedeed (not because segfault happend).", "id": 127701, "time": "2009-06-06T02:14:04Z", "creator": "tooriun@gmail.com", "creation_time": "2009-06-06T02:14:04Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "chris.tandiono@gmail.com", "attachment_id": null, "text": "I'm getting the exact same error with almost the exact same backtrace, but I'm using prefork MPM. This doesn't seem possible. This is FreeBSD 8.1.", "id": 147709, "time": "2011-07-03T18:07:35Z", "bug_id": 46671, "creation_time": "2011-07-03T18:07:35Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 31472, "attachment_id": null, "text": "The magic file provided with mod_mime_magic contains a typo in the line for QuickTime videos of type \n'moov'.  \n\nDiscovered in 2.0.50; confirmed by inspection in 2.0.52.\n\nThe result is a parse error:\n\n[Wed Sep 29 10:03:57 2004] [error] [client 10.1.6.217] mod_mime_magic: unexpected state 3; could be \ncaused by bad data in magic file\n\n... and an Internal Server Error\n\nOf course, this only arises if the file has not already been recognized based on file name, which I \nbelieve is done by mod_mime.\n\nThe typo is a trailing space at the end of the line.\n\n\nTo reproduce:\n- get yourself an Apple Quicktime movie of type 'moov' (you can grab\n   http://u2.netgate.net/~jack/file_14.mov or .../file_14.dat\n- rename it, if necessary, to some unobvious name, if necessary (\"file_14.dat\" is unobvious enough)\n- drop it into your htdocs directrory\n- add a link to it in some page \n- make sure mod_mime and mod_mime_magic are enabled \n   (http://httpd.apache.org/docs-2.0/mod/mod_mime_magic.html)  \n- hit the link\n\nExpected: it should show the movie\nActual result: it chokes\n\nFix: remove the trailing space on the line (patch attached momentarily, as if you really needed that); \nrestart server\n\nHit the link again:\nResult: see the movie", "id": 64379, "time": "2004-09-29T19:48:56Z", "creator": "jrepenning@collab.net", "creation_time": "2004-09-29T19:48:56Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 31472, "attachment_id": 12897, "text": "Created attachment 12897\npatch for magic file docs/conf/magic", "id": 64380, "time": "2004-09-29T19:49:45Z", "creator": "jrepenning@collab.net", "creation_time": "2004-09-29T19:49:45Z", "is_private": false}, {"count": 2, "tags": [], "creator": "jrepenning@collab.net", "attachment_id": null, "text": "Oops, sorry wrong URL.  The sample 'moov' file is\nhttp://www.repenning.homeip.net/file_14.mov\n\nThere's nothing special about it, though: any QTime movie file will do.\n\n", "id": 64639, "time": "2004-10-05T19:10:38Z", "bug_id": 31472, "creation_time": "2004-10-05T19:10:38Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jrepenning@collab.net", "is_private": false, "text": "Note that there's also some evidence that this typo affects other file types.  \n\nThat is: there's only one typo, the one for files of type 'moov'.  But it affects parsing of the magic \nfile: mod_mime_magic croaks--really, before it's read the entry, and hence it's not reacting \nspecifically to the fact that the file being touched is 'moov', but rather to the fact that it's not any \nof the *other* types named earlier in the file.  So something amounting to the same problem arises \nfor any file of any type that's completely unknown to the magic file (the reported case is Stuffit! \narchives, which are not described anywhere in the magic file).  \n\nReproducing the false behavior in these cases is harder, I can't provide you a complete recipe: \nthese cases produce the same error_log output as the 'moov', but since they're not described at all, \nthe resulting behavior is not so far from correct.  In our case, we're also providing a .htaccess file \nfor these, which includes MIME info, and the croak in mod_mime_magic seems to mean that \n.htaccess is never consulted, and hence we're not getting the right behavior from these other file \ntypes, either.  I'm not sure of all the steps necessary to set up such a .htaccess file, but I have \nexperimentally confirmed that, if I fix the typo on the 'moov' line, the .htaccess files for StuffIt! files \ncomes back into play, and everything's peachy again.", "id": 64642, "time": "2004-10-05T19:40:07Z", "bug_id": 31472, "creation_time": "2004-10-05T19:40:07Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Thanks Jack, committed for 2.0.53.", "is_private": false, "id": 66327, "creator": "jorton@redhat.com", "time": "2004-11-02T23:37:07Z", "bug_id": 31472, "creation_time": "2004-11-02T23:37:07Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 50887, "attachment_id": 26742, "text": "Created attachment 26742\nPatches to set a securityProvider \n\nWe need support of X.509 certificates using elliptic curves for client-auth\nwithin an servlet-application.\n\nThe certificates we use are coded using DomainParameters within the\nPublicKey object. When using the sun-jdk this will\nlead to an error because the sun-jce implementation only supports elliptic\ncurves as NamedCurves.\n\nThe best way to fix this is to use another security-provider e.g.\nbouncycastle.\nFor that we need a way to configure it within tomcat.", "id": 144818, "time": "2011-03-08T04:49:48Z", "creator": "pknopp@mtg.de", "creation_time": "2011-03-08T04:49:48Z", "is_private": false}, {"count": 1, "tags": [], "creator": "pknopp@mtg.de", "attachment_id": null, "id": 144819, "time": "2011-03-08T05:19:58Z", "bug_id": 50887, "creation_time": "2011-03-08T05:19:58Z", "is_private": false, "text": "Mark Thomas has commented by email:\n\n>The patch raises a couple of questions for me.\n> - Security providers are normally configured at the JVM level.\n> - Patches that change one of 5 connectors usually mean the other\n>connectors need changing too\n> - There are other places where CertificateFactory is used that may\n>conflict with this patch.\n\n\nI will not define the provider in the JVM. For that I have to insert e.g. bouncycastle at the first position to not get sun security-provider for X.509 CertificateFactory. With that definition bouncycastle is used anywhere within the JVM first. This could lead to some other effects I cannot estimate.\n\n\nI'm not able to see if the changes are necessary for other connectors. \nFor Http11AprProcessor and AjpProcessor it is nearly the same as for AjpArProcessor. \nHttp11NioProcessor and Http11Processor are not using CertificateFactory. \n\nThe last remark is unclear for me. With my proposed patch all other places are unchanged. So there will be no conflict."}, {"count": 2, "tags": [], "bug_id": 50887, "attachment_id": null, "text": "I've had a chance to look at this further. With regard to the three points I raised previously:\n\n> - Security providers are normally configured at the JVM level\n\nI can see why you don't like this and your reasoning is consistent with the design of the Tomcat SSL connector implementation. It is meant to be possible to configure each connector independently of any JVM configuration.\n\n> - Patches that change one of 5 connectors usually mean the other\n>connectors need changing too\n\nAll of the connectors use CertifcateFactory. HTTP BIO & NIO use it via JSSESupport so all five connectors will need changes.\n\n> - There are other places where CertificateFactory is used that may\n>conflict with this patch.\n\nMy point is that it isn't just the connectors that create client certificates from SSL data. The SSL Valve also does this and will also need a configuration option for this.\n\nI'll work on a patch for 7.0.x which will then be back-ported to 6.0.x.", "id": 144949, "time": "2011-03-12T04:57:53Z", "creator": "markt@apache.org", "creation_time": "2011-03-12T04:57:53Z", "is_private": false}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "Fixed in 7.0.x and will be in 7.0.12 onwards.", "id": 144966, "time": "2011-03-13T10:01:45Z", "bug_id": 50887, "creation_time": "2011-03-13T10:01:45Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "markt@apache.org", "attachment_id": 26765, "id": 144970, "time": "2011-03-13T14:08:46Z", "bug_id": 50887, "creation_time": "2011-03-13T14:08:46Z", "is_private": false, "text": "Created attachment 26765\nProposed patch for Tomcat 6"}, {"count": 5, "tags": [], "bug_id": 50887, "attachment_id": null, "text": "(In reply to comment #4)\n> Created an attachment (id=26765) [details]\n> Proposed patch for Tomcat 6\n\nI have tested the proposed patch within Tomcat 6.0.32, it works fine. \nThe client-certificate with a ECDSA-key is converted correctly within tomcat. \n\n\nOne remark to your patch: You use different logging within the class SSLValve, but not within the Connectors. It would be nice for debbuging if the messages differ between a CertificateException and a NoSuchProviderException.", "id": 144999, "time": "2011-03-14T12:58:25Z", "creator": "pknopp@mtg.de", "creation_time": "2011-03-14T12:58:25Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 50887, "attachment_id": null, "text": "Fixed in 6.0.x and will be included in 6.0.33 onwards.", "id": 146831, "time": "2011-06-03T08:16:53Z", "creator": "markt@apache.org", "creation_time": "2011-06-03T08:16:53Z", "is_private": false}]
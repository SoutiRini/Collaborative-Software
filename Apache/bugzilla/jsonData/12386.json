[{"count": 0, "tags": [], "bug_id": 12386, "attachment_id": null, "id": 22403, "time": "2002-09-07T04:46:32Z", "creator": "jc@mega-bucks.co.jp", "creation_time": "2002-09-07T04:46:32Z", "is_private": false, "text": "The docs at: http://httpd.apache.org/docs/logs.html\n\nstate that the following directive will cause apache to pipe it's logs to gzip\nbefore writing them to disk.\n\nCustomLog \"|/usr/bin/gzip -c >>  /var/log/access_log.gz\" common\n\nI have tried this directive on apache 1.3.26 running on RH Linux with kernel\n2.4.7-10 and it does *not* work. All I get is a 20 byte file called\naccess_log/gz being created and nothing ever gets written to it. Gunzip'ing the\nfile give me a 0 byte file.\n\nThis is either a bug in apache or the docs.\n\nOthers have reported the same problem on the ML but no one seems to have found a\nreason or solution.\n\nThanks!"}, {"count": 1, "tags": [], "bug_id": 12386, "attachment_id": null, "id": 22425, "time": "2002-09-07T18:30:53Z", "creator": "slive@apache.org", "creation_time": "2002-09-07T18:30:53Z", "is_private": false, "text": "It is probably a bug in the docs.  I wrote that example without testing it\n(Bad Joshua!).  But I don't really know why it doesn't work, so I am hesitant\nto rewrite that section.  Is it that gzip just won't compress in a stream like\nthat (it seems to work with cat file | gzip -c > file2.gz), or am I missing\nsomething fundamental about piped logs?\n\nAny help appreciated."}, {"count": 2, "tags": [], "bug_id": 12386, "attachment_id": null, "text": "I *wish* I could help. Piping to gzip would be godsend for me as my logs get\nquite large (>1GB/day) and are causing a Disk I/O bottleneck. I have lots of CPU\nto spare ...\n\nOh! Hey, gzip can't compress a file without knowing all of the data first ... it\nneeds to scan all the data first so that it can come up with a good compression\nscheme.\n\nSo until the stream is closed gzip just can't do anything?\n\nThat would seem to make sense except that even if I stop apache the log file\nnever receives anything if I try to pipe the log to gzip.\n\nIf you can spare the cycles please look into it ... piping to gzip wouldb be\n*very* nice.", "id": 22426, "time": "2002-09-07T18:49:11Z", "creator": "jc@mega-bucks.co.jp", "creation_time": "2002-09-07T18:49:11Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "jc@mega-bucks.co.jp", "text": "I was wrong about gzip needing an EOF. It doesn't.\n\nThe problem is with BUFSIZ in gzip. Gzip won't write to file until it has\nreceived BUFSIZ bytes. (I have no idea how big BUFSIZ is but it's big enough\nthat I didn't reach it just by typing at the keyboard).\n\n*BUT* one problem I did find is that if apache is stopped nothing is written to\nthe log file (if piped to gzip).\n\nAlso, I haven't verified that piping to gzip actually works. I've set up the\ndirective on my test web server but I don't seem to ahve managed enough hits on\nit yet to get over BUFSIZ ...\n\nIf anything ever does get written to the zipped log file I'll make sure and let\nyou know ...\n\nJc", "count": 3, "id": 22443, "time": "2002-09-08T07:54:13Z", "bug_id": 12386, "creation_time": "2002-09-08T07:54:13Z", "is_private": false}, {"count": 4, "tags": [], "text": "Any change on the status of this bug report?", "attachment_id": null, "id": 23305, "creator": "jc@mega-bucks.co.jp", "time": "2002-09-24T13:36:20Z", "bug_id": 12386, "creation_time": "2002-09-24T13:36:20Z", "is_private": false}, {"count": 5, "tags": [], "creator": "slive@apache.org", "text": "I never did figure out why these examples don't work, but piped logs do\nwork in general, and I have removed this examples from the docs.", "id": 34600, "time": "2003-04-07T02:06:09Z", "bug_id": 12386, "creation_time": "2003-04-07T02:06:09Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 12386, "attachment_id": null, "id": 34601, "time": "2003-04-07T02:12:03Z", "creator": "jc@mega-bucks.co.jp", "creation_time": "2003-04-07T02:12:03Z", "is_private": false, "text": "Ok. Too bad a solution couldn't be found ...\n\nA note should be added to the docs to saying that piped log *do* in general\nwork, but may *not* work in all situations (for piping log output to gzip does\nnot seem to work properly)."}, {"count": 7, "tags": [], "text": "*** Bug 13027 has been marked as a duplicate of this bug. ***", "attachment_id": null, "id": 35417, "creator": "bodewig@apache.org", "time": "2003-04-17T13:54:15Z", "bug_id": 12386, "creation_time": "2003-04-17T13:54:15Z", "is_private": false}]
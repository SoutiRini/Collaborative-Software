[{"count": 0, "tags": [], "creator": "slaurent@apache.org", "attachment_id": null, "text": "Using servlet 3 async features, when asyncContext.complete(); is called from an async thread, the AsyncListener onComplete() method is not called though it should be.\n\nExample Servlet :\n\n\npackage test;\n\nimport java.io.IOException;\n\nimport javax.servlet.AsyncContext;\nimport javax.servlet.AsyncEvent;\nimport javax.servlet.AsyncListener;\nimport javax.servlet.ServletException;\nimport javax.servlet.annotation.WebServlet;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\n/**\n * Servlet implementation class MyServlet\n */\n@WebServlet(value = \"/MyServlet\", asyncSupported = true)\npublic class MyServlet extends HttpServlet implements AsyncListener {\n\tprivate static final long serialVersionUID = 1L;\n\n\tprotected void doGet(HttpServletRequest request,\n\t\t\tHttpServletResponse response) throws ServletException, IOException {\n\t\tfinal AsyncContext asyncContext = request.startAsync(request, response);\n\t\tasyncContext.addListener(this);\n\n\t\tasyncContext.start(new Runnable() {\n\n\t\t\t@Override\n\t\t\tpublic void run() {\n\t\t\t\ttry {\n\t\t\t\t\tThread.sleep(5 * 1000);\n\t\t\t\t\tasyncContext.getResponse().getWriter().write(\"Hello world\");\n\t\t\t\t\tasyncContext.complete();\n\t\t\t\t} catch (Exception e) {\n\t\t\t\t\te.printStackTrace();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t@Override\n\tpublic void onComplete(AsyncEvent arg0) throws IOException {\n\t\tSystem.out.println(\"onComplete \" + arg0);\n\t}\n\n\t@Override\n\tpublic void onError(AsyncEvent arg0) throws IOException {\n\t\tSystem.out.println(\"onError \" + arg0);\n\t}\n\n\t@Override\n\tpublic void onStartAsync(AsyncEvent arg0) throws IOException {\n\t\tSystem.out.println(\"onStartAsync \" + arg0);\n\t}\n\n\t@Override\n\tpublic void onTimeout(AsyncEvent arg0) throws IOException {\n\t\tSystem.out.println(\"onTimeout \" + arg0);\n\t}\n}", "id": 142058, "time": "2010-11-27T16:30:59Z", "bug_id": 50352, "creation_time": "2010-11-27T16:30:59Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 50352, "is_private": false, "id": 142133, "time": "2010-11-29T12:00:30Z", "creator": "markt@apache.org", "creation_time": "2010-11-29T12:00:30Z", "tags": [], "text": "Fixed in 7.0.x and will be included in 7.0.6 onwards."}]
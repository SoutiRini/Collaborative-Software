[{"count": 0, "tags": [], "creator": "abatko@cs.mcgill.ca", "attachment_id": null, "text": "We recently discovered hundreds of stale process entries\nin the process table, and they were all cgi programs.\n\nWe're running 2.0.39 with suexec.\n\nIt seems that EVERY cgi program that's run leaves behind\na process entry.\n\nBelow is an example just for one user (abatko):\n\n% ps auxwwww | sort | grep ^abatko | wc -l\n     412\n\n# now run a cgi program\n\n% ps auxwwww  | sort | grep ^abatko | wc -l\n     413\n\n# now stop/start apache\n\n% apachectl stop\n% apachectl start\n\n% ps auxwwww  | sort | grep ^abatko | wc -l\n       0\n\n# now run a cgi program\n\n% ps auxwwww  | sort | grep ^abatko | wc -l\n       1\n\n# now run another cgi program\n\n% ps auxwwww  | sort | grep ^abatko | wc -l\n       2\n\n\nHere's an example of what the process table looks like\nfor the two cgi programs run above:\n\nUSER      PID %CPU %MEM   VSZ  RSS  TT  STAT STARTED      TIME COMMAND\nabatko  26979  0.0  0.0     0    0  ??  Z    10:18AM   0:00.00  (perl)\nabatko  26987  0.0  0.0     0    0  ??  Z    10:18AM   0:00.00  (c.cgi)\n\n\nPlease let me know if you need any other information.", "id": 20487, "time": "2002-07-31T14:31:27Z", "bug_id": 11331, "creation_time": "2002-07-31T14:31:27Z", "is_private": false}, {"count": 1, "tags": [], "creator": "abatko@cs.mcgill.ca", "attachment_id": null, "text": "Just to let you know, I checked out the 2.0.36 webserver that I built several\nweeks ago (on a different machine), and I found similar stale cgi processes\nthere too.\n\nOver the weekend, Amanda couldn't even start running because the process\ntable was exausted... there were literally thousands of processes left behind.\n\nToday I upgraded to 2.0.40, and the problem is still there.\n\nHere are a few more examples of what the output of ps looks like:\n\nUSER     PID %CPU %MEM   VSZ  RSS  TT  STAT STARTED      TIME COMMAND\nabatko 56729  0.0  0.0     0    0  ??  Z     2:49PM   0:00.00  (python)\nabatko 56731  0.0  0.0     0    0  ??  Z     2:50PM   0:00.00  (sh)\nabatko 56734  0.0  0.0     0    0  ??  Z     2:50PM   0:00.00  (perl)\nabatko 56735  0.0  0.0     0    0  ??  Z     2:50PM   0:00.00  (sh)\nabatko 56742  0.0  0.0     0    0  ??  Z     2:51PM   0:00.00  (c.cgi)\nabatko 56743 10.0  0.0     0    0  ??  Z     2:51PM   0:00.00  (perl)\nabatko 56750  0.0  0.0     0    0  ??  Z     2:51PM   0:00.00  (perl)\nabatko 56755  3.0  0.0     0    0  ??  Z     2:51PM   0:00.00  (perl)\nabatko 56756 19.0  0.0     0    0  ??  Z     2:51PM   0:00.00  (perl)\n\n\nSometimes (but I haven't figured out how, or why), there will be an\nentry that ends with ``(suexec)''.\n\nPlease let me know if you need any other information in this regard.", "id": 20984, "time": "2002-08-13T19:14:02Z", "bug_id": 11331, "creation_time": "2002-08-13T19:14:02Z", "is_private": false}, {"count": 2, "tags": [], "creator": "abatko@cs.mcgill.ca", "attachment_id": null, "text": "The entry that ends with ``(suexec)'' that I described in my previous\ncomment occurs anytime there is a server error (500).  The message\ndisplayed in the web browser is always  \"Premature end of script headers\"\nbut httpd-suexec.log usually has something like \"file has no execute permission\"\nor \"directory is writable by others\".\n\nHere's a process table example of these ``(suexec)'' entries:\n\nUSER       PID %CPU %MEM   VSZ  RSS  TT  STAT STARTED      TIME COMMAND\nabatko   89180  0.0  0.0     0    0  ??  Z     3:36AM   0:00.00  (suexec)\nabatko   89192  0.0  0.0     0    0  ??  Z     3:40AM   0:00.00  (suexec)\nabatko   89219  0.0  0.0     0    0  ??  Z     3:50AM   0:00.00  (suexec)\nabatko   90753  0.0  0.0     0    0  ??  Z    11:09AM   0:00.00  (suexec)\n\n\nYou may also consider fixing this so that it reports the name of the script,\nand not just the word \"suexec\".\n\nThanks a lot, and I hope this helps somehow.", "id": 21033, "time": "2002-08-14T15:20:16Z", "bug_id": 11331, "creation_time": "2002-08-14T15:20:16Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 11331, "text": "Was this with mod_cgi or mod_cgid?\n", "id": 26829, "time": "2002-11-22T20:55:28Z", "creator": "trawick@apache.org", "creation_time": "2002-11-22T20:55:28Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 11331, "text": "According to what I recall, the 2.0.36 server ran with cgi (not cgid).\nI don't remember what I used with 2.0.39; however 2.0.40 was with cgid (not \ncgi).\n\nI don't know what version is running currently as I'm away for a *long* time, \nbut I'm hoping that one of my co-workers will join the tricket and answer your \nquestions.\n\nThanks a lot for looking into this.", "id": 26861, "time": "2002-11-23T13:43:35Z", "creator": "abatko@cs.mcgill.ca", "creation_time": "2002-11-23T13:43:35Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 11331, "text": "Just FYI...  I was unable to recreate the problem a few days ago using 2.0.43 on\nFreeBSD 4.7 and mod_cgi.  I tried working cgis and broken (non-executable)\ncgis but didn't see any zombies.  That was a production site and I wasn't able\nto try mod_cgid there.\n\nI'll try to find the time to see what happens with httpd-2.0 HEAD and mod_cgid\n(also on FreeBSD 4.7).\n\n", "id": 26908, "time": "2002-11-24T21:51:26Z", "creator": "trawick@apache.org", "creation_time": "2002-11-24T21:51:26Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 11331, "text": "I was able to resolve the problem by using mod_cgi instead of mod_cgid. \nTherefore the problem lies in mod_cgid.  We are using 2.0.43 on FreeBSD 4.6.\n\nThanks for the info.\n\nPhil", "id": 26956, "time": "2002-11-25T18:41:27Z", "creator": "vola@cs.mcgill.ca", "creation_time": "2002-11-25T18:41:27Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 11331, "text": "Thanks a bunch for the update!  That will greatly help narrow down the\nproblem.", "id": 26974, "time": "2002-11-25T23:04:57Z", "creator": "trawick@apache.org", "creation_time": "2002-11-25T23:04:57Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "chip@force-elite.com", "attachment_id": null, "text": "Using mod_cgid on FreebSD 4.X implies using the Worker MPM.  This MPM is not\nsupported on FreeBSD 4.x.\n\n-> WONTFIX\n\n", "id": 60346, "time": "2004-07-09T09:10:14Z", "bug_id": 11331, "creation_time": "2004-07-09T09:10:14Z", "is_private": false}]
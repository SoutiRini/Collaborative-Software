[{"count": 0, "tags": [], "bug_id": 46686, "text": "Created attachment 23243\nPatch to FontCache to use a fallback if the user directory is not writable\n\nMethod getDefaultCacheFile() returns an invalid file handle because it doesn't check to see if the directory is writable.\n{code}\n\nprivate static File getUserHome() {\n        String s = System.getProperty(\"user.home\");\n        if (s != null) {\n            File userDir = new File(s);\n            if (userDir.exists()) {\n                return userDir;\n            }\n        }\n        return null;\n    }\n\n\n/**\n     * Returns the default font cache file.\n     * @param forWriting true if the user directory should be created\n     * @return the default font cache file\n     */\n    public static File getDefaultCacheFile(boolean forWriting) {\n        File userHome = getUserHome();\n        if (userHome != null) {\n            File fopUserDir = new File(userHome, FOP_USER_DIR);\n            if (forWriting) {\n                fopUserDir.mkdir();\n            }\n            return new File(fopUserDir, DEFAULT_CACHE_FILENAME);\n        }\n        return new File(FOP_USER_DIR);\n\n}\n{code}\nThe method getUserHome() can return a directory that is not a writable directory. In most cases, the user who is running the webserver has access to user.home, but some in some environments, it is possible that user.home is not writable. Anyway, a simple way to fix it would be to fall back to a the java.io.tmpdir if the userHome is not writable. See attached patch that has that fix", "id": 124756, "time": "2009-02-09T15:33:38Z", "creator": "alok@jivesoftware.com", "creation_time": "2009-02-09T15:33:38Z", "is_private": false, "attachment_id": 23243}, {"count": 1, "tags": [], "text": "Thanks for the patch. I've applied it with modifications:\nhttp://svn.apache.org/viewvc?rev=743273&view=rev\n\nThe problem was that your code didn't handle the case correctly that the font cache already existed in the user home. It always switched to the temporary directory. I've also had trouble automatically applying the patch. Not sure what was wrong. Had to do it manually.", "is_private": false, "id": 124770, "creator": "jeremias@apache.org", "time": "2009-02-11T00:42:58Z", "bug_id": 46686, "creation_time": "2009-02-11T00:42:58Z", "attachment_id": null}, {"count": 2, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed", "creator": "gadams@apache.org", "is_private": false, "id": 156303, "time": "2012-04-01T07:09:02Z", "bug_id": 46686, "creation_time": "2012-04-01T07:09:02Z", "tags": [], "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "funkman@joedog.org", "attachment_id": null, "id": 23028, "time": "2002-09-18T13:10:10Z", "bug_id": 12771, "creation_time": "2002-09-18T13:10:10Z", "is_private": false, "text": "An IllegalState exception is thrown on .include() if the included file has an\nextension not mapped to any mime types.\n\nTo reproduce: \n- create 2 files foo.jsp and foo.nomimetype\n- foo.jsp has 1 line  <jsp:include page=\"foo.nomimetype\"/>\n- foo.nomimetype can be any file with \"stuff\" text prefered\n- accessing foo.jsp throws IllegalException error\n\nTemporary Workaround:\nAdding a mime-type mapping in web.xml for file extension \"nomimetype\" alleviates\nthe problem.\n\nPatch will be attached to fix DefaultServlet. Currently it does this:\n----------------------------------------\n    try {\n        ostream = response.getOutputStream();\n    } catch (IllegalStateException e) {\n        // If it fails, we try to get a Writer instead if we're\n        // trying to serve a text file\n        if ( (contentType != null)\n             && (contentType.startsWith(\"text\")) ) {\n            writer = response.getWriter();\n        } else {\n            throw e;\n        }\n    }\n----------------------------------------\nSo if NO mime type is mapped, an exception will be thrown. My patch will change\n++++++++++++++++++++++++++++++++++++++++++\n        if ( (contentType != null)\n             && (contentType.startsWith(\"text\")) ) {\n++++++++++++++++++++++++++++++++++++++++++\nto\n++++++++++++++++++++++++++++++++++++++++++\n        if ( (contentType == null)\n             || (contentType.startsWith(\"text\")) ) {\n++++++++++++++++++++++++++++++++++++++++++\n\nSo on not finding a mime-type it will default to obtaining a the Writer. \n\nThis will be helpful for people who use .inc as a text include but don't have it\nmapped."}, {"count": 1, "tags": [], "bug_id": 12771, "attachment_id": 3116, "text": "Created attachment 3116\nPatch of org/apache/catalina/servlets/DefaultServlet.java", "id": 23029, "time": "2002-09-18T13:11:51Z", "creator": "funkman@joedog.org", "creation_time": "2002-09-18T13:11:51Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 12771, "text": "Ok, I am willing to apply the patch to avoid user complaints. Now, it should be\nclear that if you try to include a binary, this will not produce any useful results.", "id": 23030, "time": "2002-09-18T13:13:36Z", "creator": "remm@apache.org", "creation_time": "2002-09-18T13:13:36Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "remm@apache.org", "text": "I have applied the patch. This will be in 4.1.11.", "id": 23031, "time": "2002-09-18T13:18:35Z", "bug_id": 12771, "creation_time": "2002-09-18T13:18:35Z", "tags": [], "is_private": false}]
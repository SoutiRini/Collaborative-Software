[{"count": 0, "tags": [], "creator": "lei.g.tong@gmail.com", "attachment_id": 33399, "text": "Created attachment 33399\nTest file for reproducing the error message.\n\nThe attached file was generated by POI to allow user to edit the metadata and import back into the application.  However, after I edited the file with LibreOffice Calc on Linux, it gives me an exception trying to load a user uploaded file into XSSFWorkbook.\nSteps to Reproduce:\n1. Open the attached file into a InputStream\n2. Create a workbook from the InputStream\nInputStream inp2 = new FileInputStream(\"/home/lei/Downloads/Test combine new.xlsx\");\nXSSFWorkbook xlsxWb2 = (XSSFWorkbook) WorkbookFactory.create(inp2); \n\n\nActual Results - the application threw the following Error Messages:\norg.apache.poi.POIXMLException: java.lang.reflect.InvocationTargetException\n\tat org.apache.poi.xssf.usermodel.XSSFFactory.createDocumentPart(XSSFFactory.java:62)\n\tat org.apache.poi.POIXMLDocumentPart.read(POIXMLDocumentPart.java:465)\n\tat org.apache.poi.POIXMLDocumentPart.read(POIXMLDocumentPart.java:470)\n\tat org.apache.poi.POIXMLDocument.load(POIXMLDocument.java:173)\n\tat org.apache.poi.xssf.usermodel.XSSFWorkbook.<init>(XSSFWorkbook.java:278)\n\tat com.ngc.brc.util.common.ExcelHelper.getExcelWorkbook(ExcelHelper.java:135)\n\tat com.ngc.brc.web.actions.workbench.helper.UploadFileTemplateParser.parseDefline(UploadFileTemplateParser.java:49)\n\tat com.ngc.brc.web.actions.workbench.UploadedFileController.updateMetadata(UploadedFileController.java:1004)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:176)\n\tat org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:440)\n\tat org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:428)\n\tat org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:925)\n\tat org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:856)\n\tat org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:953)\n\tat org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:855)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:650)\n\tat org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:829)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:731)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:303)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\n\tat com.ngc.brc.web.filters.BrcSercurityFilter.doFilter(BrcSercurityFilter.java:56)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:330)\n\tat org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:118)\n\tat org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:84)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:113)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:103)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:113)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.authentication.rememberme.RememberMeAuthenticationFilter.doFilter(RememberMeAuthenticationFilter.java:146)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:154)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:45)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:199)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:110)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:50)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:87)\n\tat org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:342)\n\tat org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:192)\n\tat org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:160)\n\tat org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343)\n\tat org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\n\tat org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:232)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\n\tat org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:232)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\n\tat org.springframework.orm.hibernate3.support.OpenSessionInViewFilter.doFilterInternal(OpenSessionInViewFilter.java:232)\n\tat org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\n\tat com.ngc.brc.web.filters.BrcServletFilter.doFilter(BrcServletFilter.java:63)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\n\tat com.ngc.brc.web.filters.MetricsFilter.doFilter(MetricsFilter.java:82)\n\tat org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:343)\n\tat org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:260)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:220)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:122)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:505)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:170)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:956)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:116)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:423)\n\tat org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1079)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:625)\n\tat org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:316)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n\tat org.apache.poi.xssf.usermodel.XSSFFactory.createDocumentPart(XSSFFactory.java:60)\n\t... 97 more\nCaused by: org.apache.xmlbeans.XmlException: error: duplicate attribute 'type'\n\tat org.apache.xmlbeans.impl.store.Locale$SaxLoader.load(Locale.java:3511)\n\tat org.apache.xmlbeans.impl.store.Locale.parseToXmlObject(Locale.java:1277)\n\tat org.apache.xmlbeans.impl.store.Locale.parseToXmlObject(Locale.java:1264)\n\tat org.apache.xmlbeans.impl.schema.SchemaTypeLoaderBase.parse(SchemaTypeLoaderBase.java:345)\n\tat org.apache.xmlbeans.XmlObject$Factory.parse(XmlObject.java:688)\n\tat org.apache.poi.xssf.usermodel.XSSFVMLDrawing.read(XSSFVMLDrawing.java:108)\n\tat org.apache.poi.xssf.usermodel.XSSFVMLDrawing.<init>(XSSFVMLDrawing.java:103)\n\t... 102 more\nCaused by: org.xml.sax.SAXParseException; systemId: file:; lineNumber: 1; columnNumber: 344; duplicate attribute 'type'\n\tat org.apache.xmlbeans.impl.piccolo.xml.Piccolo.reportFatalError(Piccolo.java:1038)\n\tat org.apache.xmlbeans.impl.piccolo.xml.Piccolo.parse(Piccolo.java:723)\n\tat org.apache.xmlbeans.impl.store.Locale$SaxLoader.load(Locale.java:3479)\n\t... 108 more", "id": 187372, "time": "2016-01-04T18:26:10Z", "bug_id": 58801, "creation_time": "2016-01-04T18:26:10Z", "is_private": false}, {"count": 1, "attachment_id": null, "creator": "lei.g.tong@gmail.com", "is_private": false, "id": 187374, "time": "2016-01-04T18:32:43Z", "bug_id": 58801, "creation_time": "2016-01-04T18:32:43Z", "tags": [], "text": "I forgot to mention that when I edited and saved the same file with Microsoft Excel or Google Spreadsheet, this error did not occur."}, {"count": 2, "tags": [], "bug_id": 58801, "is_private": false, "text": "This is a known bug of windows excel. The generated xml can contain multiple instances of the same attribute in a single tag. The only workaround I found is to modify the org.apache.xmlbeans.impl.piccolo.xml.AttributeHolder class in order to ignore duplicate attributes.\nExample:\npublic void addAndCheckAttribute(String uri, String localName, String qName, String type, String value)\tthrows SAXException\n{\n  for (int i = 0; i < this.length; ++i) {\n    if (this.data[(i * 5 + 2)] == qName) {\n     //throw new FatalParsingException(\"duplicate attribute '\" + qName + \"'\");\n       setAttribute(i, uri, localName, qName, type, value);\n    }\n  }\n  addAttribute(uri, localName, qName, type, value);\n}", "id": 187390, "time": "2016-01-05T08:36:16Z", "creator": "francesco.petruzzi@innovery.net", "creation_time": "2016-01-05T08:36:16Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "lei.g.tong@gmail.com", "attachment_id": null, "text": "It works fine when I modified and saved the file with Microsoft Excel or Google Spreadsheet.   But it does not work when I modified and saved it with LibreOffice Calc 4.2.8.2 on CentOS 6.", "id": 188252, "time": "2016-02-05T18:12:10Z", "bug_id": 58801, "creation_time": "2016-02-05T18:12:10Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 58801, "is_private": false, "text": "As far as I read the discussion this is not caused by POI itself, but rather by LibreOffice, right? Therefore I am closing this for now, if this is really a problem in POI, then please reopen with a unit-test that can be used to reproduce this.", "id": 201092, "time": "2017-09-22T17:41:07Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2017-09-22T17:41:07Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "vanbochove@firstbase.nl", "text": "I think 1 line needs to be added to the doStartTag method of class\nCloseConnectionTag. After closing the connection \"conn\" it needs to be set to\nnull, to assure a pooled connection will be put back to the connection pool:\n\n  public int doStartTag() {\n\n    try {\n      Connection conn = (Connection)pageContext.getAttribute(_connId);\n      conn.close();\n      conn = null;\n    } catch (SQLException e) {\n      // failing to close a connection is not fatal\n      e.printStackTrace();\n    }\n    \n    return EVAL_BODY_INCLUDE;\n  }\n\nIf the added we have to trust the garbage collector to return the connection. I\nsometimes get this exception (stacktrace)\n\nDBCP object created 2003-05-17 17:05:05 by the following code was never closed:\njava.lang.Exception\n        at org.apache.commons.dbcp.AbandonedTrace.init(AbandonedTrace.java)\n        at org.apache.commons.dbcp.AbandonedTrace.<init>(AbandonedTrace.java)\n        at\norg.apache.commons.dbcp.DelegatingConnection.<init>(DelegatingConnection.java)\n        at\norg.apache.commons.dbcp.PoolableConnection.<init>(PoolableConnection.java)\n        at\norg.apache.commons.dbcp.PoolableConnectionFactory.makeObject(PoolableConnectionFactory.java)\n        at\norg.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java)\n        at\norg.apache.commons.dbcp.AbandonedObjectPool.borrowObject(AbandonedObjectPool.java)\n        at\norg.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java)\n        at\norg.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java)\n        at\norg.apache.taglibs.dbtags.connection.ConnectionTag.doEndTag(ConnectionTag.java:214)\n        at org.apache.jsp.show_prod_jsp._jspService(show_prod_jsp.java:335)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:137)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:204)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n        at\norg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:493)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at\norg.apache.catalina.core.StandardContext.invoke(StandardContext.java:2415)\n        at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n        at\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n        at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.catalina.connector.warp.WarpRequestHandler.handle(Unknown\nSource)\n        at org.apache.catalina.connector.warp.WarpConnection.run(Unknown Source)\n        at java.lang.Thread.run(Thread.java:536)", "id": 33302, "time": "2003-03-17T17:27:58Z", "bug_id": 18074, "creation_time": "2003-03-17T17:27:58Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 18074, "is_private": false, "id": 53123, "creation_time": "2004-02-27T13:55:18Z", "time": "2004-02-27T13:55:18Z", "creator": "nagoya@felipeal.net", "text": "Fixed.\n", "attachment_id": null}]
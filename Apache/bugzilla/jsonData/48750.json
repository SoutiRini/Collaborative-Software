[{"count": 0, "tags": [], "bug_id": 48750, "attachment_id": null, "is_private": false, "id": 134555, "time": "2010-02-16T11:42:13Z", "creator": "mhn4dev@googlemail.com", "creation_time": "2010-02-16T11:42:13Z", "text": "I noticed serious performance problems with JSF 1.2 and Tomcat which seems to be caused by Tomcat.\nThe corresponding discussion is available here: http://marc.info/?l=tomcat-user&m=126607491020706&w=2\n\nMetadata-complete is set to true in web.xml \n(see https://issues.apache.org/bugzilla/show_bug.cgi?id=48600)\n\nI deployed two web apps to Tomcat and Jetty and compared performance data.\nAverage results of 500 calls of a simple jsf page (jsp) with 1000 h:output tags:\n\nJSF 1.1:\n  Tomcat 6.0.24: 26ms\n  Jetty 7.0.1: 35ms\n \nJSF 1.2:\n  Tomcat 6.0.24: 72ms\n  Jetty 7.0.1: 41ms\n\nResult:\nTomcat is much faster with JSF 1.1 but terrible slow with JSF 1.2!\n\nOne difference between Tomcat and Jetty in the compiled jsp is the AnnotationHelper.\n\nCompiled method for a single outputtext tag:\nTomcat:\nprivate boolean _jspx_meth_h_005foutputText_005f999(javax.servlet.jsp.tagext.JspTag _jspx_th_h_005fform_005f0, PageContext _jspx_page_context)\n        throws Throwable {\n  PageContext pageContext = _jspx_page_context;\n  JspWriter out = _jspx_page_context.getOut();\n  //  h:outputText\n  org.apache.myfaces.taglib.html.HtmlOutputTextTag _jspx_th_h_005foutputText_005f999 = new org.apache.myfaces.taglib.html.HtmlOutputTextTag();\n  org.apache.jasper.runtime.AnnotationHelper.postConstruct(_jsp_annotationprocessor, _jspx_th_h_005foutputText_005f999);\n  _jspx_th_h_005foutputText_005f999.setPageContext(_jspx_page_context);\n  _jspx_th_h_005foutputText_005f999.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_h_005fform_005f0);\n  // /1000hout.jsp(1021,0) name = value type = javax.el.ValueExpression reqTime = false required = false fragment = false deferredValue = true expectedTypeName = java.lang.Object deferredMethod = false methodSignature = null\n  _jspx_th_h_005foutputText_005f999.setValue(new org.apache.jasper.el.JspValueExpression(\"/1000hout.jsp(1021,0) '1'\",_el_expressionfactory.createValueExpression(\"1\",java.lang.Object.class)));\n  // /1000hout.jsp(1021,0) name = style type = javax.el.ValueExpression reqTime = false required = false fragment = false deferredValue = true expectedTypeName = java.lang.Object deferredMethod = false methodSignature = null\n  _jspx_th_h_005foutputText_005f999.setStyle(new org.apache.jasper.el.JspValueExpression(\"/1000hout.jsp(1021,0) 'z-index:29202;'\",_el_expressionfactory.createValueExpression(\"z-index:29202;\",java.lang.Object.class)));\n  _jspx_th_h_005foutputText_005f999.setJspId(\"jsp_711124934_1001\");\n  int _jspx_eval_h_005foutputText_005f999 = _jspx_th_h_005foutputText_005f999.doStartTag();\n  if (_jspx_th_h_005foutputText_005f999.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {\n    _jspx_th_h_005foutputText_005f999.release();\n    org.apache.jasper.runtime.AnnotationHelper.preDestroy(_jsp_annotationprocessor, _jspx_th_h_005foutputText_005f999);\n    return true;\n  }\n  _jspx_th_h_005foutputText_005f999.release();\n  org.apache.jasper.runtime.AnnotationHelper.preDestroy(_jsp_annotationprocessor, _jspx_th_h_005foutputText_005f999);\n  return false;\n}\n  \nJetty:\nprivate boolean _jspx_meth_h_outputText_999(javax.servlet.jsp.tagext.JspTag _jspx_th_h_form_0, PageContext _jspx_page_context)\n        throws Throwable {\n  PageContext pageContext = _jspx_page_context;\n  JspWriter out = _jspx_page_context.getOut();\n  //  h:outputText\n  org.apache.myfaces.taglib.html.HtmlOutputTextTag _jspx_th_h_outputText_999 = new org.apache.myfaces.taglib.html.HtmlOutputTextTag();\n  if (_jspx_resourceInjector != null) {\n    _jspx_resourceInjector.inject(_jspx_th_h_outputText_999      );\n  }\n  _jspx_th_h_outputText_999.setPageContext(_jspx_page_context);\n  _jspx_th_h_outputText_999.setParent((javax.servlet.jsp.tagext.Tag) _jspx_th_h_form_0);\n  _jspx_th_h_outputText_999.setJspId(\"id2019\");\n  _jspx_th_h_outputText_999.setValue(org.apache.jasper.runtime.PageContextImpl.getValueExpression(\"1\", (PageContext)_jspx_page_context, java.lang.Object.class, null));\n  _jspx_th_h_outputText_999.setStyle(org.apache.jasper.runtime.PageContextImpl.getValueExpression(\"z-index:29202;\", (PageContext)_jspx_page_context, java.lang.Object.class, null));\n  int _jspx_eval_h_outputText_999 = _jspx_th_h_outputText_999.doStartTag();\n  if (_jspx_th_h_outputText_999.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE) {\n    _jspx_tagPool_h_outputText_value_style_nobody.reuse(_jspx_th_h_outputText_999);\n    return true;\n  }\n  _jspx_tagPool_h_outputText_value_style_nobody.reuse(_jspx_th_h_outputText_999);\n  return false;\n}\n\nA demo web app is attached\nJust call http://<server>:<port>/jsf12/faces/1000hout.jsp\n\nCan the AnnotationHelper be turned off completely?"}, {"count": 1, "tags": [], "bug_id": 48750, "attachment_id": 25001, "id": 134557, "time": "2010-02-16T12:24:01Z", "creator": "mhn4dev@googlemail.com", "creation_time": "2010-02-16T12:24:01Z", "is_private": false, "text": "Created attachment 25001\nJsps - source and java\n\n- Source jsp 1000hout.jsp\n- JSP compiled with Tomcat and Jetty (java and class)"}, {"count": 2, "tags": [], "bug_id": 48750, "attachment_id": null, "id": 134558, "time": "2010-02-16T12:42:44Z", "creator": "mhn4dev@googlemail.com", "creation_time": "2010-02-16T12:42:44Z", "is_private": false, "text": "The demo web app is available here:\nhttp://www.datafilehost.com/download-9e9da3b8.html"}, {"count": 3, "tags": [], "bug_id": 48750, "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of bug 48600 ***", "id": 134559, "time": "2010-02-16T13:00:02Z", "creator": "remm@apache.org", "creation_time": "2010-02-16T13:00:02Z", "is_private": false}, {"count": 4, "tags": [], "text": "Could anybody pls explain why this is a duplicate of bug #48600?\n\nI set metadata-complete=\"true\" in web.xml\nMoreover the patch attached in 48600 does not improve speed further more therefore I thought this would be another issue.\n\n#48600 is classified as P2 enhancement. It is much more critical from my point of view because the performance is really poor. This means more parallel requests and at the end we can serve just half of the users anymore.", "is_private": false, "id": 134561, "creator": "mhn4dev@googlemail.com", "time": "2010-02-16T13:17:13Z", "bug_id": 48750, "creation_time": "2010-02-16T13:17:13Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 48750, "attachment_id": null, "text": "The performance levels do not seem catastrophic, so the severity is very appropriate.", "id": 134564, "time": "2010-02-16T13:56:03Z", "creator": "remm@apache.org", "creation_time": "2010-02-16T13:56:03Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "mlopez@sescam.org", "text": "I am trying to implement a custom JAAS login module for tomcat 6.0.14 that is\nworking now over 5.5.25.\n\nThis configuration works perfectly on tomcat 5.5.25 but not over 6.0.14.\n\nI think the problem is with accesing JNDI objects out of context without\nResourceLink element. I need to access this way from LoginModule implementation.\n\nThe configuration is the following:\n\nserver.xml:\n\n  <Server port=\"9085\" shutdown=\"SHUTDOWN\">\n  ....\n\t<GlobalNamingResources>\n\t    <Resource name=\"jdbc/dataSource_usuarios_aplicaciones_Local\" \n\t              auth=\"Container\"\n\t              type=\"javax.sql.DataSource\"\n\t              driverClassName=\"com.mysql.jdbc.Driver\" \n                   factory=\"org.apache.tomcat.dbcp.dbcp.BasicDataSourceFactory\" \n\t              maxActive=\"20\" maxIdle=\"10\" maxWait=\"30000\" \n\t              minEvictableIdleTimeMillis=\"30000\" \n\t              username=\"----\" \n\t              password=\"----\" \n\t              testOnBorrow=\"true\" \n\t              testWhileIdle=\"true\" \n\t              timeBetweenEvictionRunsMillis=\"10000\" \nurl=\"jdbc:mysql://localhost:3306/usuarios_aplicaciones?autoReconnectForPools=true&amp;connectTimeout=30000\"\n\t              validationQuery=\"SELECT 1\" />\n\t  </GlobalNamingResources>\n\t....\n\t....\n\t<Engine name=\"Catalina\" defaultHost=\"localhost\">\n\t\t...\n\t\t<Realm className=\"org.apache.catalina.realm.JAASRealm\" \n\t\t             resourceName=\"jdbc/dataSource_usuarios_aplicaciones_Local\"\n\t\t             appName=\"UsuariosAplicaciones\" \n\t\t            \nuserClassNames=\"org.sescam.chua.AutenticacionTomcatChua.UsuarioChuaLDAP\"\n\t\t            \nroleClassNames=\"org.sescam.chua.AutenticacionTomcatChua.GrupoChuaPrincipal\"/>\n\t\t...\n\t</Engine>\n  ....\n  </Server>\n\nThe class that implements 'LoginModule' interface has the following code in\ninitialize method:\n\n  DataSource dataSourceSQL = null;\n  try {\n    Context ctx = new InitialContext();\n    Context envContext = (Context) ctx.lookup(\"java:comp/env\");\n    dataSourceSQL = (DataSource) \n          envContext.lookup(\"jdbc/dataSource_usuarios_aplicaciones_Local\");\n    LoginModuloChua.entidadesDAO = new EntidadesDAO(dataSourceSQL);\n  } catch (NamingException ex) {\n    LoginModuloChua.entidadesDAO = null;\n    log_ERROR(\"Se ha producido una NamingException con \" +\n              \"nombreJndiDBCP: '\" + this.nombreJndiDBCP + \"' en \" +\n              \"'initialize' -> iniciando 'entidadesDAO': \" +\n              ex.getMessage());\n    ex.printStackTrace();\n  }\n\nAnd always throws the following exception:\n\n  javax.naming.NameNotFoundException: Name jdbc is not bound in this Context", "id": 112449, "attachment_id": null, "bug_id": 44162, "creation_time": "2008-01-03T00:08:42Z", "time": "2008-01-03T00:08:42Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 44162, "text": "You are not obtaining the initial context correctly for a realm that is not\ninside a context. As per my users list response, look at the DataSourceRealm code.", "id": 112471, "time": "2008-01-03T11:51:16Z", "creator": "markt@apache.org", "creation_time": "2008-01-03T11:51:16Z", "is_private": false, "attachment_id": null}]
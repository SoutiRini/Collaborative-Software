[{"count": 0, "text": "We have a webapp that must be able to start logging during production.\n\nOur solution is to start a timer thread from its ContextListener that regularly \nre-initializes the configuration from a log4j.properties file:\n\n   LogManager.resetConfiguration();\n      ClassLoader cl = this.getClass().getClassLoader();\n      URL log4jPropsUrl = cl.getResource(\"log4j.properties\");\n      if (log4jPropsUrl != null)\n         PropertyConfigurator.configure(log4jPropsUrl);\n      else\n         log.warn(\"log4j properties not found\");\n\nHowever, this locks the log4j.properties file, located in the webapp directory, \nso that a hot redeploy fails; Tomcat can't delete log4j.properties since it is \nlocked. That is a show-stopper for us.\n\nI have checked the source code of PropertyConfigurator, and think I have found \nthe bug. The method doConfigure calls\n\n   props.load(configUrl.openStream());\n\nbut it does not call close() on the resulting InputStream. It must be closed, \nor the file will be locked, at least on Windows. A fix may look like:\n\n  InputStream is = configUrl.openStream();\n  props.load(is);\n  is.close();\n\nWe have encountered serveral other problems with files locked by log4j, but \nthey are harder to track down. Searching the web also turns up several \nfrustrations with files unnecessarily locked by log4j. It would therefore \nprobably be a very good idea to search the log4j source code for similar \nconstructs elsewhere and add close() wherever necessary.", "bug_id": 42148, "is_private": false, "id": 101810, "time": "2007-04-17T07:52:00Z", "creator": "per.lindberg@implior.com", "creation_time": "2007-04-17T07:52:00Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 42148, "text": "This looks exactly like bug 40944 which is fixed in the SVN.  The fix was in the first release candidate for \nlog4j 1.2.15 (currently at http://people.apache.org/builds/logging/log4j/1.2.15/) which failed to be \nreleased due to lack of sufficient votes.  Please check if that takes care of your observed problem.\n\n*** This bug has been marked as a duplicate of 40944 ***", "id": 101814, "attachment_id": null, "creator": "carnold@apache.org", "creation_time": "2007-04-17T08:44:19Z", "time": "2007-04-17T08:44:19Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 42148, "is_private": false, "id": 101934, "creation_time": "2007-04-19T06:22:32Z", "time": "2007-04-19T06:22:32Z", "creator": "per.lindberg@implior.com", "text": "Yes, I have just verified that the fix in log4j 1.2.15 RC1 solves the problem.\nExcellent! Many thanks!\n\n", "attachment_id": null}]
[{"attachment_id": null, "tags": [], "bug_id": 44686, "text": "I seem to be experiencing some issues with this migration I am attempting. I have read through some of the threads that pertain to this issue, however I am still encountering problems.\n\nThe following is used in this webapp :\n\njstl 1.1.2\njspx\n\nI am receiving the following exception :\n\njavax.servlet.ServletException: javax.servlet.jsp.JspTagException\n        org.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:850)\n        org.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:779)\n        com.a.userMovementsByDate_jspx._jspService(userMovementsByDate_jspx.java:289)\n        org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\n        javax.servlet.http.HttpServlet.service(HttpServlet.java:803)\n\nroot cause\n\njavax.servlet.jsp.JspTagException\n        org.apache.taglibs.standard.tag.common.core.SetSupport.doEndTag(SetSupport.java:174)\n        org.apache.jsp.tag.web.dateChooser_tagx._jspx_meth_c_005fset_005f0(dateChooser_tagx.java:231)\n        org.apache.jsp.tag.web.dateChooser_tagx.doTag(dateChooser_tagx.java:157)\n        com.a.userMovementsByDate_jspx._jspService(userMovementsByDate_jspx.java:166)\n        org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\n        javax.servlet.http.HttpServlet.service(HttpServlet.java:803)\n\nNow it seems in the generated code from JspC that lines of code go amiss. For instance if I have :\n\n<?xml version=\"1.0\"?>\n<jsp:root version=\"1.2\"\n          xmlns:jsp=\"http://java.sun.com/JSP/Page\"\n          xmlns:c=\"urn:jsptld:/WEB-INF/tld/jstl.tld\"\n          xmlns:rx=\"urn:jsptld:/WEB-INF/tld/regexp.tld\"\n          xmlns:dt=\"urn:jsptld:/WEB-INF/tld/datetime.tld\">\n    <jsp:directive.tag display-name=\"Date chooser tag\" isELIgnored=\"false\" body-content=\"empty\" description=\"Selects two dates\"/>\n    <jsp:directive.attribute name=\"varStart\" required=\"true\" rtexprvalue=\"false\" type=\"java.lang.String\" description=\"Name of variable for start date\"/>\n    <jsp:directive.attribute name=\"varEnd\" required=\"true\" rtexprvalue=\"false\" type=\"java.lang.String\" description=\"Name of variable for end date\"/>\n    <jsp:directive.attribute name=\"from\" description=\"Start date, if available\"/>\n    <jsp:directive.attribute name=\"to\" description=\"End date, if available\"/>\n    <jsp:directive.attribute name=\"ignoreSeconds\" description=\"Set to true if  seconds are to be ignored.\"/>\n    <jsp:directive.variable name-from-attribute=\"varStart\" alias=\"start\" scope=\"AT_END\" description=\"Start date available after end of tag\"/>\n    <jsp:directive.variable name-from-attribute=\"varEnd\" alias=\"end\" scope=\"AT_END\" description=\"End date available after end of tag\"/>\n   \n    <!-- Get the current date/time  -->\n    <c:set var=\"ctime\"><dt:currentTime/></c:set>\n\n    //Rest of code\n\nNow in the generated code the following appears :\n\n_jspx_th_c_005fset_005f0.setPageContext(_jspx_page_context);\n    _jspx_th_c_005fset_005f0.setParent(new javax.servlet.jsp.tagext.TagAdapter((javax.servlet.jsp.tagext.SimpleTag) this ));    // /WEB-INF/tld/a-v7.3.tld\"ctime\");\n    int _jspx_eval_c_005fset_005f0 = _jspx_th_c_005fset_005f0.doStartTag();\n\nNow if I add an extra c:set to jspx :\n    <!-- Get the current date/time  -->\n    <c:set var=\"ctime\"><dt:currentTime/></c:set>\n    <c:set var=\"ctime\"><dt:currentTime/></c:set>\n\nThe generated code will have 2 entries. The first stays the same but the second has :\n\n_jspx_th_c_005fset_005f1.setPageContext(_jspx_page_context);\n    _jspx_th_c_005fset_005f1.setParent(new javax.servlet.jsp.tagext.TagAdapter((javax.servlet.jsp.tagext.SimpleTag) this ));    // /WEB-INF/tags/dateChooser.tagx(18,24) name = var type = java.lang.String reqTime = false required = false fragment = false deferredValue = false expectedTypeName = null deferredMethod = false methodSignature = null\n    _jspx_th_c_005fset_005f1.setVar(\"ctime\");\n    int _jspx_eval_c_005fset_005f1 = _jspx_th_c_005fset_005f1.doStartTag();\n\nThat serVar(in this case, other times setId is not generated) is missing from the first, and this is causing all my problems.\n\nI have tried the following :\n\n1. Set servlet spec to 2.4 in webapp tag in web xml.\n2. Using the tomcat 6 libs and not 5.0.28 when building.", "count": 0, "id": 115005, "time": "2008-03-26T23:30:57Z", "creator": "elite.code.ninja@gmail.com", "creation_time": "2008-03-26T23:30:57Z", "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Using the code extract you provided as a basis for a .tagx file, I do not see this error.\n\nI suggest you test using a clean install of Tomcat 6 and make sure no TC5 elements sneak in.\n\nIf you can re-produce this, please provide a minimal war (should be no more than a few hundred K, even with the jars for the tag libs) that demonstrates the issue.", "id": 115050, "time": "2008-03-27T14:47:07Z", "bug_id": 44686, "creation_time": "2008-03-27T14:47:07Z", "is_private": false}]
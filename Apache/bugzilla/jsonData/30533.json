[{"count": 0, "tags": [], "creator": "dietmar.mueller@eurotours.at", "is_private": false, "id": 61695, "attachment_id": null, "bug_id": 30533, "creation_time": "2004-08-09T08:30:41Z", "time": "2004-08-09T08:30:41Z", "text": "I have a web-app where I use some XML files with DTD for setting some\nconfigurations. The XML look like:\n\n<?xml version=\"1.0\" ?>\n<!DOCTYPE Request SYSTEM \"Request.dtd\">\n<Request>\n  <Methodes>\n....\n\nIf I run the app I get:\n\njava.io.FileNotFoundException: \nD:\\jakarta-tomcat\\bin\\Request.dtd (Das System kann die angegebene Datei nicht\nfinden)\n        at java.io.FileInputStream.open(Native Method)\n        at java.io.FileInputStream.<init>(FileInputStream.java:106)\n        at java.io.FileInputStream.<init>(FileInputStream.java:66)\n        at\nsun.net.www.protocol.file.FileURLConnection.connect(FileURLConnection.java:69)\n        at\nsun.net.www.protocol.file.FileURLConnection.getInputStream(FileURLConnection.java:156)\n        at org.apache.xerces.impl.XMLEntityManager.setupCurrentEntity(Unknown\nSource)\n        at org.apache.xerces.impl.XMLEntityManager.startEntity(Unknown Source)\n        at org.apache.xerces.impl.XMLEntityManager.startDTDEntity(Unknown Source)\n        at org.apache.xerces.impl.XMLDTDScannerImpl.setInputSource(Unknown Source)\n        at\norg.apache.xerces.impl.XMLDocumentScannerImpl$DTDDispatcher.dispatch(Unknown Source)\n        at\norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n        at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n        at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n        at javax.xml.parsers.SAXParser.parse(Unknown Source)\n\nI don't belief that the bin path from catalina_home is the right location for\nthis kind of system DTD without any path in it. I expect the same path as the\nxml document.\n\nSystem:\n\nWinNt 6a\nJDK: 1.4.2-b28, mixed mode\nTomcat: 5.0.25\n\nregards Dietmar"}, {"count": 1, "tags": [], "bug_id": 30533, "is_private": false, "text": "Does this still happen with 5.0.28?  Is there more to the stack trace, \nspecifically an org.apache.catalina part?", "id": 62852, "time": "2004-08-31T15:13:25Z", "creator": "yoavs@computer.org", "creation_time": "2004-08-31T15:13:25Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "id": 62987, "time": "2004-09-02T19:46:00Z", "bug_id": 30533, "creation_time": "2004-09-02T19:46:00Z", "is_private": false, "text": "I think it's a parser configuration issue, not a Tomcat issue.  Does the \nbehavior change of you tell the parser to not resolve DTD URIs?  See the \nresolve-dtd-uris option in http://www.saxproject.org/apidoc/org/xml/sax/package-\nsummary.html#package_description."}, {"count": 3, "tags": [], "creator": "dietmar.mueller@eurotours.at", "attachment_id": null, "id": 63010, "time": "2004-09-03T07:42:19Z", "bug_id": 30533, "creation_time": "2004-09-03T07:42:19Z", "is_private": false, "text": "To your first question.\n\nyes, on .28 the error also occure.\nThe base for the dtd is with start on command box the dir where the startup\nscript is locatet and with service it is winnt\\system32 dir.\n\nI use a small testcase. \nOne servlet which is calling a class with a sax parser.\n\nThe stack is follow:\n\njava.io.FileNotFoundException: D:\\jakarta-tomcat-5.0.28\\bin\\WebRequests.dtd (Das\n System kann die angegebene Datei nicht finden)\n        at java.io.FileInputStream.open(Native Method)\n        at java.io.FileInputStream.<init>(FileInputStream.java:106)\n        at java.io.FileInputStream.<init>(FileInputStream.java:66)\n        at sun.net.www.protocol.file.FileURLConnection.connect(FileURLConnection\n.java:69)\n        at sun.net.www.protocol.file.FileURLConnection.getInputStream(FileURLCon\nnection.java:156)\n        at org.apache.xerces.impl.XMLEntityManager.setupCurrentEntity(Unknown So\nurce)\n        at org.apache.xerces.impl.XMLEntityManager.startEntity(Unknown Source)\n        at org.apache.xerces.impl.XMLEntityManager.startDTDEntity(Unknown Source\n)\n        at org.apache.xerces.impl.XMLDTDScannerImpl.setInputSource(Unknown Sourc\ne)\n        at org.apache.xerces.impl.XMLDocumentScannerImpl$DTDDispatcher.dispatch(\nUnknown Source)\n        at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Un\nknown Source)\n        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n        at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n        at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n        at javax.xml.parsers.SAXParser.parse(Unknown Source)\n        at AllXMLParser.parse(AllXMLParser.java:59)\n        at AllXMLParser.parse(AllXMLParser.java:124)\n        at xml.processRequest(xml.java:47)\n        at xml.doGet(xml.java:71)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:689)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Appl\nicationFilterChain.java:237)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationF\nilterChain.java:157)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperV\nalve.java:214)\n        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv\neContext.java:104)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:520)\n        at org.apache.catalina.core.StandardContextValve.invokeInternal(Standard\nContextValve.java:198)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextV\nalve.java:152)\n        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv\neContext.java:104)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:520)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.j\nava:137)\n        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv\neContext.java:104)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.j\nava:118)\n        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv\neContext.java:102)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:520)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineVal\nve.java:109)\n        at org.apache.catalina.core.StandardValveContext.invokeNext(StandardValv\neContext.java:104)\n        at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.jav\na:520)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:929)\n\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:16\n0)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java\n:799)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce\nssConnection(Http11Protocol.java:705)\n        at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java\n:577)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP\nool.java:683)\n        at java.lang.Thread.run(Thread.java:534)\n\nFor the second hint. I'll read your link.\n\nregards Dietmar\n\n"}, {"count": 4, "text": "The Link don't work but I found the information.\nhttp://www.saxproject.org/apidoc/org/xml/sax/package-summary.html#package_description\n\nOk. It could be possible that the setting from sax standard features solve the\nproblem. I think resolve-dtd-uris is a good candidate for this problem. But when\nI set the feature I get follow exception:\n\norg.xml.sax.SAXNotRecognizedException: Feature 'http://xml.org/sax/features/reso\nlve-dtd-uris' is not recognized.\n        at org.apache.xerces.parsers.AbstractSAXParser.setFeature(Unknown Source\n)\n        at org.apache.xerces.jaxp.SAXParserImpl.setFeatures(Unknown Source)\n        at org.apache.xerces.jaxp.SAXParserImpl.<init>(Unknown Source)\n        at org.apache.xerces.jaxp.SAXParserFactoryImpl.newSAXParserImpl(Unknown\nSource)\n        at org.apache.xerces.jaxp.SAXParserFactoryImpl.setFeature(Unknown Source\n)\n        at AllXMLParser.parse(AllXMLParser.java:55)\n        at AllXMLParser.parse(AllXMLParser.java:130)\n        at xml.processRequest(xml.java:47)\n        at xml.doGet(xml.java:71)\n\nThe code is:\n\n....\nSAXParserFactory factory = SAXParserFactory.newInstance();\nfactory.setFeature(\"http://xml.org/sax/features/resolve-dtd-uris\",false);\nfactory.setValidating(true);\nparser = factory.newSAXParser();\n....\n\nSet other features works well.\n\nI don't know the version from the underlying xerces impl. but in the doc they\nspeak from \"SAX2 Standard Feature Flags\".\n\n\nregards Dietmar", "bug_id": 30533, "attachment_id": null, "id": 63011, "time": "2004-09-03T08:18:18Z", "creator": "dietmar.mueller@eurotours.at", "creation_time": "2004-09-03T08:18:18Z", "tags": [], "is_private": false}, {"count": 5, "text": "I've verified that the behavior you're expecting is indeed what happens in a \ncommand-line parsing application.  But that uses Crimson, not Xerces, and I \nwonder if the bug is in the parser itself.", "bug_id": 30533, "attachment_id": null, "id": 63998, "time": "2004-09-21T18:33:32Z", "creator": "yoavs@computer.org", "creation_time": "2004-09-21T18:33:32Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "creator": "yoavs@computer.org", "attachment_id": 12819, "id": 64001, "time": "2004-09-21T18:52:42Z", "bug_id": 30533, "creation_time": "2004-09-21T18:52:42Z", "is_private": false, "text": "Created attachment 12819\nWAR to reproduce the problem"}, {"count": 7, "tags": [], "text": "Additional reference for this exact issue from 2000, where Craig says it's not \na Tomcat issue: http://www.mail-archive.com/tomcat-\nuser@jakarta.apache.org/msg00815.html.", "is_private": false, "id": 64003, "creation_time": "2004-09-21T18:56:27Z", "time": "2004-09-21T18:56:27Z", "creator": "yoavs@computer.org", "bug_id": 30533, "attachment_id": null}, {"count": 8, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "id": 64004, "time": "2004-09-21T19:11:17Z", "bug_id": 30533, "creation_time": "2004-09-21T19:11:17Z", "is_private": false, "text": "One workaround option is to use a full path for the DTD, rather than rely on a \nrelative path.  Another is to use your own EntityResolver and register that \nwhen you're calling the parser to parse the document.  If you don't like either \nof these, I suggest you contact the parser developers (e.g. by reopening this \nissue and assigning it to Xerces, or simply asking on the xerces-user mailing \nlist [the latter is better]) and ask them what you should do.  But the bottom \nline as Craig said is that it's not a Tomcat issue."}]
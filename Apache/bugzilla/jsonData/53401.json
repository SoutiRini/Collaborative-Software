[{"count": 0, "tags": [], "bug_id": 53401, "attachment_id": null, "text": "AsyncContext hold a org.apache.catalina.connector.Request object, \nrequest object hold a InputBuffer object,\nInputBuffer's default size is  8*1024 !\n\nWhen I made a Comet server, I needed to hold the AsyncContext object, but the Request object occupy too much memory, 3000 connections used 250MB memory! But InputBuffer is not necessary!\n\n\nJava test code:\n\npublic static void main(String[] args) throws IOException {\n\n\t\tMap<Serializable, Object> socketStore = new ConcurrentHashMap<Serializable, Object>();\n\n\t\tfor (int i = 0; i < 8000; i++) {\n\t\t\tRequest request = new Request();\n\t\t\tsocketStore.put(\"asdfsdfsadfa\" + i, request);\n\t\t}\n\n\t\tMemoryMXBean memoryMXBean = ManagementFactory.getMemoryMXBean();\n\t\tMemoryUsage memoryUsage = memoryMXBean.getHeapMemoryUsage();\n\t\tlong usedBytes = memoryUsage.getUsed();\n\n\t\tSystem.out.println(\"used :\" + usedBytes / 1024 / 1024 + \" MB\");\n\t\t// used :225 MB\n\n}", "id": 159897, "time": "2012-06-12T02:01:28Z", "creator": "huhang1986@gmail.com", "creation_time": "2012-06-12T02:01:28Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 53401, "attachment_id": null, "text": "The InputBuffer may not be necessary in your use case, but it is required in the general case both for performance and for pipe-lining.\n\nWebSocket can and does use lighter weight objects and should be much more scalable.", "id": 159918, "time": "2012-06-12T11:01:28Z", "creator": "markt@apache.org", "creation_time": "2012-06-12T11:01:28Z", "is_private": false}]
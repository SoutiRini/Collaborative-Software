[{"count": 0, "tags": [], "bug_id": 50027, "text": "If you deploy a WAR with contex.xml in META-INF and the context.xml has <Resource> tag, Tomcat don\u00b4t boot and gives this error:\n\njava.lang.NullPointerException\n\tat org.apache.catalina.core.StandardContext.getObjectKeyPropertiesNameOnly(StandardContext.java:5570)\n\tat org.apache.catalina.core.StandardContext.setNamingResources(StandardContext.java:1757)\n\tat org.apache.catalina.core.StandardContext.getNamingResources(StandardContext.java:1735)\n\tat org.apache.catalina.startup.SetNextNamingRule.end(SetNextNamingRule.java:99)\n\tat org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1058)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:601)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:180)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1343)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2755)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)\n\tat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)\n\tat com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)\n\tat org.apache.tomcat.util.digester.Digester.parse(Digester.java:1544)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:524)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:560)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:260)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414)\n29/09/2010 13:50:37 org.apache.catalina.startup.Catalina load\nAVISO: Catalina.start using conf/server.xml: \njava.lang.NullPointerException\n\tat org.apache.tomcat.util.digester.Digester.createSAXException(Digester.java:2688)\n\tat org.apache.tomcat.util.digester.Digester.createSAXException(Digester.java:2714)\n\tat org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1061)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:601)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:180)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1343)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2755)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)\n\tat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)\n\tat com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)\n\tat org.apache.tomcat.util.digester.Digester.parse(Digester.java:1544)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:524)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:560)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:260)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414)\nCaused by: java.lang.NullPointerException\n\tat org.apache.catalina.core.StandardContext.getObjectKeyPropertiesNameOnly(StandardContext.java:5570)\n\tat org.apache.catalina.core.StandardContext.setNamingResources(StandardContext.java:1757)\n\tat org.apache.catalina.core.StandardContext.getNamingResources(StandardContext.java:1735)\n\tat org.apache.catalina.startup.SetNextNamingRule.end(SetNextNamingRule.java:99)\n\tat org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1058)\n\t... 20 more\n29/09/2010 13:50:37 org.apache.tomcat.util.digester.SetPropertiesRule begin\nAVISO: [SetPropertiesRule]{Server/Service/Engine/Host/Context} Setting property 'source' to 'org.eclipse.jst.jee.server:bestforkprime' did not find a matching property.\n29/09/2010 13:50:37 org.apache.tomcat.util.digester.Digester endElement\nGRAVE: End event threw exception\njava.lang.NullPointerException\n\tat org.apache.catalina.core.StandardContext.getObjectKeyPropertiesNameOnly(StandardContext.java:5570)\n\tat org.apache.catalina.core.StandardContext.setNamingResources(StandardContext.java:1757)\n\tat org.apache.catalina.core.StandardContext.getNamingResources(StandardContext.java:1735)\n\tat org.apache.catalina.startup.SetNextNamingRule.end(SetNextNamingRule.java:99)\n\tat org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1058)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:601)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:180)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1343)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2755)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)\n\tat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)\n\tat com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)\n\tat org.apache.tomcat.util.digester.Digester.parse(Digester.java:1544)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:524)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:573)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:415)\n29/09/2010 13:50:37 org.apache.catalina.startup.Catalina load\nAVISO: Catalina.start using conf/server.xml: \njava.lang.NullPointerException\n\tat org.apache.tomcat.util.digester.Digester.createSAXException(Digester.java:2688)\n\tat org.apache.tomcat.util.digester.Digester.createSAXException(Digester.java:2714)\n\tat org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1061)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.endElement(AbstractSAXParser.java:601)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractXMLDocumentParser.emptyElement(AbstractXMLDocumentParser.java:180)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanStartElement(XMLDocumentFragmentScannerImpl.java:1343)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2755)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)\n\tat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)\n\tat com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)\n\tat com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)\n\tat org.apache.tomcat.util.digester.Digester.parse(Digester.java:1544)\n\tat org.apache.catalina.startup.Catalina.load(Catalina.java:524)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:573)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:415)\nCaused by: java.lang.NullPointerException\n\tat org.apache.catalina.core.StandardContext.getObjectKeyPropertiesNameOnly(StandardContext.java:5570)\n\tat org.apache.catalina.core.StandardContext.setNamingResources(StandardContext.java:1757)\n\tat org.apache.catalina.core.StandardContext.getNamingResources(StandardContext.java:1735)\n\tat org.apache.catalina.startup.SetNextNamingRule.end(SetNextNamingRule.java:99)\n\tat org.apache.tomcat.util.digester.Digester.endElement(Digester.java:1058)\n\t... 20 more\n29/09/2010 13:50:37 org.apache.catalina.startup.Catalina start\nGRAVE: Cannot start server. Server instance is not configured.\n\nHere is my contex.xml OBS: some values were replaced with XXXX \n\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Context privileged=\"true\" reloadable=\"true\">\n\n\t<WatchedResource>WEB-INF/web.xml</WatchedResource>\n\t<WatchedResource>META-INF/context.xml</WatchedResource>\n\t\n\t<Resource name=\"jdbc/bestfork\" auth=\"Container\"\n\t\ttype=\"com.mchange.v2.c3p0.ComboPooledDataSource\" factory=\"org.apache.naming.factory.BeanFactory\"\n\t\tuser=\"xxx\" password=\"xxxx\" driverClass=\"org.postgresql.Driver\"\n\t\tjdbcUrl=\"jdbc:postgresql://localhost:5432/xxxxx\" minPoolSize=\"5\"\n\t\tmaxPoolSize=\"30\" acquireIncrement=\"5\" idleConnectionTestPeriod=\"100\"\n\t\tmaxIdleTime=\"30\"/>\n\n\t<Resource name=\"mail/Session\" auth=\"Container\" type=\"javax.mail.Session\"\n\t\tmail.smtp.host=\"xxxx\" mail.smtp.auth=\"true\"\n\t\tusername=\"xxx\" password=\"xxx\"\n\t\tmail.user=\"xxxx\" mail.password=\"xxxx\"\n\t\tmail.smtp.port=\"587\" mail.transport.protocol=\"smtp\" mail.debug=\"true\" />\n\n\t<Realm className=\"org.apache.catalina.realm.JDBCRealm\"\n\t\tdriverName=\"org.postgresql.Driver\" connectionURL=\"jdbc:postgresql://localhost:5432/xxxx\"\n\t\tconnectionName=\"xxxx\" connectionPassword=\"xxxx\" userTable=\"usuario\"\n\t\tuserNameCol=\"usuario_cpf\" userCredCol=\"usuario_senha\" userRoleTable=\"usuario_papel\"\n\t\troleNameCol=\"papel_nome\" digest=\"MD5\" />\n\t\t\t\t\n\n</Context>", "id": 140302, "time": "2010-09-29T13:02:53Z", "creator": "servlet@ig.com.br", "creation_time": "2010-09-29T13:02:53Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 50027, "text": "I Solved the problem (but I still thing that this is a bug in tomcat), let me explain with more detail, because I was to anxious do report the bug.\n\nThe problem happens when you have context <Resource> tag in SERVER.XML. The problem doesn\u00b4t happens with you have a new <Realm> inside SERVER.XML.\n\nHow I solved the problem:\n\n1 - instead of inserting context information in SERVER.XML, I created myApplication.xml in conf\\Catalina\\localhost\\myApplication.xml.\n\nThe first approach work on tomcat 6, but not in tomcat 7.\nBy the way, I solved the problem, I am afraid that the presence of additional context information in SERVER.XML crashes tomcat 7.\n\nCan anyone confirm if it\u00b4s a bug?", "id": 140398, "time": "2010-10-03T08:42:40Z", "creator": "servlet@ig.com.br", "creation_time": "2010-10-03T08:42:40Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 50027, "text": "Can you attach a server.xml that actually breaks - it's not clear from your report what you're actually having problems with.", "id": 140576, "time": "2010-10-08T04:22:48Z", "creator": "timw@apache.org", "creation_time": "2010-10-08T04:22:48Z", "tags": [], "is_private": false}, {"text": "Created attachment 26143\nserver.xml that crashes tomcat 7.0.2\n\nServer.xml that crash tomcat 7.02. Only added <Context> information inside <Host>.", "tags": [], "creator": "servlet@ig.com.br", "attachment_id": 26143, "count": 3, "id": 140600, "time": "2010-10-08T11:27:39Z", "bug_id": 50027, "creation_time": "2010-10-08T11:27:39Z", "is_private": false}, {"count": 4, "tags": [], "creator": "servlet@ig.com.br", "attachment_id": null, "text": "Here is the server.xml (zipped).\nI only added to the default server.xml <Context> inside <Host>\n\nThanks", "id": 140601, "time": "2010-10-08T11:29:28Z", "bug_id": 50027, "creation_time": "2010-10-08T11:29:28Z", "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 50027, "text": "Thanks for the example. That made it much clearer.\n\nThis has been fixed in trunk and will be included in 7.0.4 onwards.", "id": 140606, "time": "2010-10-08T17:46:33Z", "creator": "markt@apache.org", "creation_time": "2010-10-08T17:46:33Z", "tags": [], "is_private": false}]
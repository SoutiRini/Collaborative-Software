[{"count": 0, "tags": [], "creator": "coad@measurement-factory.com", "attachment_id": null, "is_private": false, "id": 30222, "time": "2003-01-29T00:15:37Z", "bug_id": 16521, "creation_time": "2003-01-29T00:15:37Z", "text": "Looks like a possible RFC 2616 MUST violation.\nVarious malformed Expires header values (including the\n\"0\" value explicitly mentioned by RFC 2616) are not\ntreated as \"in the past\".\n \nSee attached trace(s) for details and ways to reproduce\nthe violation mentioned above.\n\nTest case IDs in the trace link to human-oriented test case\ndescription and RFC quotes, if available."}, {"count": 1, "text": "Created attachment 4610\n\"Expires: 0\" case trace", "creator": "coad@measurement-factory.com", "attachment_id": 4610, "id": 30223, "time": "2003-01-29T00:16:27Z", "bug_id": 16521, "creation_time": "2003-01-29T00:16:27Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 16521, "is_private": false, "text": "Created attachment 4612\n\"Expires: yesterday\" case trace", "id": 30224, "time": "2003-01-29T00:25:16Z", "creator": "coad@measurement-factory.com", "creation_time": "2003-01-29T00:25:16Z", "attachment_id": 4612}, {"count": 3, "tags": [], "bug_id": 16521, "text": "Created attachment 7085\nPatch submitted by Kris Verbeeck <kris.verbeeck@chello.be>. See next comment for more info.", "id": 39933, "time": "2003-07-03T15:14:36Z", "creator": "rederpj@remulak.net", "creation_time": "2003-07-03T15:14:36Z", "is_private": false, "attachment_id": 7085}, {"count": 4, "tags": [], "bug_id": 16521, "attachment_id": null, "id": 39935, "time": "2003-07-03T15:17:17Z", "creator": "rederpj@remulak.net", "creation_time": "2003-07-03T15:17:17Z", "is_private": false, "text": "(Comments by Kris Verbeeck. Easier to find them if they are in the PR.  - Paul\nJ. Reder)\n\n\nPR 16521 states that mod_cache caches and returns responses that have an invalid\nExpires header (value is 0 or yesterday).  The attached patch resolves this issue.\n\nSome explanation:\n- when apr_date_parse_http returns APR_DATE_BAD, the local variable containing\nthe expires header was reset to NULL;\n- the check a bit lower in the code:\n\n    if (exps != NULL && exp == APR_DATE_BAD) {\n\nwould always fail because when exp equals APR_DATE_BAD, exps was always NULL.\n"}, {"count": 5, "tags": [], "bug_id": 16521, "attachment_id": 7125, "text": "Created attachment 7125\ntest case trace (extended RFC850 format)", "id": 40088, "time": "2003-07-07T18:36:36Z", "creator": "coad@measurement-factory.com", "creation_time": "2003-07-07T18:36:36Z", "is_private": false}, {"count": 6, "text": "Getting closer! With the proposed patch, \"0\" and \"yesterday\"\ncases pass as do other 8 cases in this \"bad Expires\" clause.\n\nHowever, one test case still fails. The failed test case deals\nwith dates in RFC 850 format followed by junk. Perhaps Apache\nis forgetting to check that no \"extra\" characters exist after\npartsing RFC 850 dates correctly? The trace for the failed case\nis attached.\n\nThank you.\n", "creator": "coad@measurement-factory.com", "is_private": false, "id": 40089, "time": "2003-07-07T18:41:20Z", "bug_id": 16521, "creation_time": "2003-07-07T18:41:20Z", "tags": [], "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 16521, "attachment_id": 7186, "id": 40243, "time": "2003-07-09T06:33:23Z", "creator": "rsushma@novell.com", "creation_time": "2003-07-09T06:33:23Z", "is_private": false, "text": "Created attachment 7186\nFix for handling the date ending with extra junk characters."}, {"count": 8, "tags": [], "bug_id": 16521, "attachment_id": null, "id": 40244, "time": "2003-07-09T06:36:21Z", "creator": "rsushma@novell.com", "creation_time": "2003-07-09T06:36:21Z", "is_private": false, "text": "This patch (attachement ID 7186)is to fix the \ndate followed by junk, in all RFC 850, RFC 1123 \nand Asctime formats.\n\nDo we need to handle the condition where the \nDate is not represented in GMT or no time \nzone is specified? \n(Example: \"Sun, 06 Nov 1994 08:49:37 \")\n\nRFC 2616, 3.3.1 says: \n\n\tAll HTTP date/time stamps MUST be represented in GMT,  \n\twithout exception. \n\n   \tHTTP-date is case sensitive and MUST NOT include\n   \tadditional LWS beyond that specifically included as SP in the\n   \tgrammar.\n\n   \tNote: Recipients of date values are encouraged to be robust \n      \tin accepting date values that may have been sent by non-HTTP\n      \tapplications, as is sometimes the case when retrieving or \n      \tposting messages via proxies/gateways to SMTP or NNTP."}, {"count": 9, "text": "IMO, yes, you do. Recall that we are talking\nabout cache freshness here. A cache is a performance\noptimization with serious freshness side-effects.\nWe should err on the safe side (generate a miss, not\na hit) whenever there are doubts.\n\nThe above does not mean that implementation should\nreject messages with invalid expiration dates, of \ncourse. Just treat them as stale.\n", "bug_id": 16521, "attachment_id": null, "id": 41099, "time": "2003-07-21T19:09:55Z", "creator": "coad@measurement-factory.com", "creation_time": "2003-07-21T19:09:55Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "bug_id": 16521, "attachment_id": 7430, "id": 41100, "time": "2003-07-21T19:53:07Z", "creator": "coad@measurement-factory.com", "creation_time": "2003-07-21T19:53:07Z", "is_private": false, "text": "Created attachment 7430\na safer version of the patch in attachment 7186?"}, {"count": 11, "tags": [], "bug_id": 16521, "text": "The patch in attachment 7186 (when used with the original patch\nin the attacment 7085) leads to coredumps. I am not an Apache\ndeveloper, but it looks like \"timstr\" may be NULL while it is\nused in the if-statement in the attachment 7186.\n\nAttachment 7430 contains a safer combination of the above mentioned\ntwo patches. It does not lead to coredumps and does let Apache pass\nall test cases in this test clause. I do not know if it does the\nright thing overall though. Please check.\n", "id": 41101, "time": "2003-07-21T19:59:43Z", "creator": "coad@measurement-factory.com", "creation_time": "2003-07-21T19:59:43Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 16521, "is_private": false, "text": "I'm going through the bug db to make sure patches are findable.  Please see \nhttp://httpd.apache.org/dev/patches.html\n", "id": 47808, "time": "2003-11-21T17:20:21Z", "creator": "trawick@apache.org", "creation_time": "2003-11-21T17:20:21Z", "attachment_id": null}, {"count": 13, "tags": [], "creator": "coad@measurement-factory.com", "attachment_id": null, "text": "FYI: this violation seems to be present in httpd-2.0.54", "id": 76099, "time": "2005-06-06T22:02:48Z", "bug_id": 16521, "creation_time": "2005-06-06T22:02:48Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 16521, "attachment_id": null, "id": 144232, "time": "2011-02-12T17:07:50Z", "creator": "minfrin@sharp.fm", "creation_time": "2011-02-12T17:07:50Z", "is_private": false, "text": "The fix to the Expires being treated as missing instead of in the past when a bad date arrives is fixed on trunk in r1070128.\n\nAs to rejecting the junk characters at the end, some browsers such as Netscape have inserted junk at the end in the past, and it's safer to be lenient in what we accept. The APR people, when asked, said no to being more restrictive than strictly necessary, so this bit is wontfix.\n\nhttp://mail-archives.apache.org/mod_mbox/apr-dev/201102.mbox/%3CA39C22BC-D1CF-445F-BAE1-C83C25276DF4@gbiv.com%3E"}]
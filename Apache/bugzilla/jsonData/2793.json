[{"count": 0, "tags": [], "bug_id": 2793, "attachment_id": null, "id": 4013, "time": "2001-07-25T12:50:08Z", "creator": "jjc@hpl.hp.com", "creation_time": "2001-07-25T12:50:08Z", "is_private": false, "text": "The xml spec (Version 2, p 2.12) states that xml:lang should conform \nto RFC1766 or its successor. RFC3066 is the successor to RFC1766.\n\nRFC3066 allows the new language codes of three characters not two,\ndefined by ISO639-2.\n\nRFC3066 also allows digits in second and subsequent tags.\n\nHence each of the following XML elements is legal but rejected by Xerces-J.\n\n<x xml:lang=\"ale\"/>\n<x xml:lang=\"x-33\"/>\n<x xml:lang=\"en-US-f5\"/>\n\n\nMoreover Xerces-J accepts the two following syntactically\nillegal languages:\n<x xml:lang=\"en-s\"/>\n<x xml:lang=\"en-abcdefghij\"/>    \n\nBoth are illegal because after an ISO-639 code, the second subtag may consist \nof:\n+ a two letter country code from ISO3166\nor\n+ between 3 and 8 characters or digits.\n\nOf these defects the most important is the three character language codes.\n\n===\n\n\nI take the defect to be in:\n\norg.apache.xerces.framework.XMLDocumentScanner.checkXMLLangAttributeValue(int)\n\nthat file is unchanged since version 1.4.0 which I have used.\n\n===\n\n\nThe syntactic constraints are:\ncase-insensitive\n\nFirst tag:\neither \"I\" or \"X\" or [A-Z][A-Z] or [A-Z][A-Z][A-Z]\n\nSecond tag:\nwhen first tag is \"I\" or \"X\" then second tag is\n    [0-9A-Z]{1,8}\n\nwhen first tag is [A-Z][A-Z] or [A-Z][A-Z][A-Z] then second tag is\n    [A-Z][A-Z] or [0-9A-Z]{3,8}\n\nsubsequent tags\n    [0-9A-Z]{1,8}\n\nother rules depend on having lookup tables of IANA, ISO639 and ISO3166.\n\n \n===\n\nI have Java code that checks values against the tables, which I can\nforward if you want.\nThe URLs for the tables are:\n\nhttp://lcweb.loc.gov/standards/iso639-2/englangn.html\nhttp://www.din.de/gremien/nas/nabd/iso3166ma/codlstp1/db_en.html\nhttp://www.iana.org/assignments/language-tags\n\n\nThanks."}, {"count": 1, "tags": [], "creator": "jjc@hpl.hp.com", "attachment_id": null, "id": 4014, "time": "2001-07-25T13:13:32Z", "bug_id": 2793, "creation_time": "2001-07-25T13:13:32Z", "is_private": false, "text": "The implementation appears to be a straight implementation\nof the original XML spec (1998).\nThe following erratum:\n\nhttp://www.w3.org/XML/xml-19980210-errata#E73\n\nindicates a change of advice.\n\n\n\n"}, {"count": 2, "tags": [], "bug_id": 2793, "attachment_id": null, "text": "From the XML 1.0 (first edition) specification errata:\n\nE73 Rationale:\n\n\"The XML processor does not deal with the value of xml:lang, it just passes it \non to the application. Checking its correctness at this level has no benefit...\"\n\nThe XMLDocumentScanner checkXMLLangAttributeValue() method must be removed and \nall calls made on that method (all from XMLValidator) must be removed.  The \ncurrent code is in conflict with the XML 1.0 (second edition) specification.\n\nThe code in checkXMLLangAttributeValue() should not be \"updated\" as this would \nbe in conflict with the Rationale of E73 cited above.\n", "id": 4298, "time": "2001-08-06T07:50:31Z", "creator": "gmarcy@us.ibm.com", "creation_time": "2001-08-06T07:50:31Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jjc@hpl.hp.com", "attachment_id": 394, "id": 4367, "time": "2001-08-08T06:41:19Z", "bug_id": 2793, "creation_time": "2001-08-08T06:41:19Z", "is_private": false, "text": "Created attachment 394\nDeleting stuff according to Glenn's comment"}, {"count": 4, "tags": [], "text": "Created attachment 396\nLike previous patch, but also deleting messages to do with xml:lang", "attachment_id": 396, "id": 4369, "creator": "jjc@hpl.hp.com", "time": "2001-08-08T06:42:24Z", "bug_id": 2793, "creation_time": "2001-08-08T06:42:24Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 2793, "attachment_id": null, "id": 4371, "time": "2001-08-08T06:57:32Z", "creator": "jjc@hpl.hp.com", "creation_time": "2001-08-08T06:57:32Z", "is_private": false, "text": "Some explanantion on patches:\nSecond patch fixes bug and updates XMLMessages (both classes) to deleted the \nxml:lang relating messages.\nFirst patch is more conservative and leaves orphaned messages.\n\nXMLValidator\nlines 3050ff\n  whole loop is removed since it's only purpose is xml:lang checking.\nlines 3593 ff\n  comment is removed since it only refers to xml:lang\n\nutils.XMLMessages\nMSG_XML_LANG_INVALID\nrenamed as\nMSG_AVAILABLE0\nleaving it in sequence with the other MSG_AVAILABLEs\n\nConstraint P33_INVALID updated to reflect new text in second edition i.e.\n\"(Productions 33 through 38 have been removed)\" instead of the productions!\nThis should not in practice be used. The constant P33_INVALID is still left in \nplace, an additional comment is given at its definition.\n\n\n\n\n\n\n"}, {"count": 6, "tags": [], "bug_id": 2793, "attachment_id": null, "text": "Thanks Jeremy and Glenn; the patch tested fine and I've applied it.", "id": 4385, "time": "2001-08-08T11:24:34Z", "creator": "neilg@ca.ibm.com", "creation_time": "2001-08-08T11:24:34Z", "is_private": false}]
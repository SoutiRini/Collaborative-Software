[{"count": 0, "tags": [], "bug_id": 5221, "text": "First, background: I use Linux (RHL 6.1, 2.2.12) with JDK 1.3.1_01, with FOP\n0.20.2, bundled Xalan/Xerces, DocBook XSL stylesheets 1.45 with FO support.\n\nFor the most part FOP does a good job of rendering DocBook to PDF, and I use it\nin addition to HTML output. I have a large DocBook document (> 200 pages) with\nmany images (screenshots especially; one PNG and many GIFs). Normally this all\nworks well.\n\nRecently I noticed that the FOP processing hung after saying \"stopping\nrenderer\". I invoke it from Ant like this:\n\n<java classname=\"org.apache.fop.apps.Fop\" fork=\"true\" failonerror=\"true\">\n    <jvmarg value=\"-Xmx200m\"/>\n    <classpath>\n        <pathelement location=\"lib/Fop-0.20.2/build/fop.jar\"/>\n        <fileset dir=\"lib/Fop-0.20.2/lib\">\n            <include name=\"*.jar\"/>\n        </fileset>\n    </classpath>\n    <arg value=\"-d\"/>\n    <arg value=\"-xml\"/>\n    <arg file=\"${xml}\"/>\n    <arg value=\"-xsl\"/>\n    <arg file=\"${xsl}\"/>\n    <arg value=\"-pdf\"/>\n    <arg file=\"${pdf}\"/>\n</java>\n\nwhere ${xsl} is fo/docbook.xsl from the DocBook stylesheets v. 1.45. The process\nseems to go fine (processes all pages [199], [200], [201], etc.) and says\n\"Stopping renderer\"; does a little more work (disk activity); then stops.\nSending SIGQUIT yields the attached thread dump.\n\nIt seems GifImage.loadImage just sleeps forever, and the image producer is never\ntold that the image is ready. I have no idea why. Anyway, I wrote a patch to\nGifImage.java (attached) which works: it prints an error message for one GIF\nfile only, and the rendering finishes normally. In fact in the PDF this GIF\nlooks fine. So I suspect the image producer is actually ready (probably very\nquickly) and the event was simply never received.\n\nI will attach the GIF too. It looks fine to me; a small icon which uses a\ntransparency. Java 1.3.1_01 displays it fine in other contexts (e.g. JTree).\n\nIf you would like a reproducible test case I can try to generate the FO by\nitself and narrow it down to a block showing this GIF which I assume is the\nproblem. Just send me email etc.", "id": 8493, "time": "2001-12-01T05:01:55Z", "creator": "jesse.glick@netbeans.com", "creation_time": "2001-12-01T05:01:55Z", "is_private": false, "attachment_id": null}, {"text": "Created attachment 855\nSuggested patch (works against 0.20.2)", "tags": [], "bug_id": 5221, "is_private": false, "count": 1, "id": 8494, "time": "2001-12-01T05:03:58Z", "creator": "jesse.glick@netbeans.com", "creation_time": "2001-12-01T05:03:58Z", "attachment_id": 855}, {"count": 2, "tags": [], "bug_id": 5221, "text": "Created attachment 856\n[without patch] Output and thread dump taken after hang", "id": 8495, "time": "2001-12-01T05:06:24Z", "creator": "jesse.glick@netbeans.com", "creation_time": "2001-12-01T05:06:24Z", "is_private": false, "attachment_id": 856}, {"text": "Created attachment 857\nProblematic GIF file", "tags": [], "bug_id": 5221, "is_private": false, "count": 3, "id": 8496, "time": "2001-12-01T05:07:11Z", "creator": "jesse.glick@netbeans.com", "creation_time": "2001-12-01T05:07:11Z", "attachment_id": 857}, {"count": 4, "tags": [], "bug_id": 5221, "text": "Some other notes:\n\n- The hangs only began recently, and the apparently bad GIF was added recently,\nso I think it really is just due to this GIF.\n\n- The patch would probably be desirable whether or not the problem is\nreproducible; loading an image should not wait forever, it is not robust.\n\n- The same problem occurs under JDK 1.4 beta 3. And I think under FOP 0.20.1\n(not sure). I could not try the CVS trunk version of FOP, it crashes without\nexplanation.", "id": 8497, "time": "2001-12-01T05:15:12Z", "creator": "jesse.glick@netbeans.com", "creation_time": "2001-12-01T05:15:12Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "jesse.glick@netbeans.com", "text": "I have encountered a similar problem with certain PNG images processed by Jimi,\nas well. I have a patch (attached) which also prevents FOP from hanging on\nthese, but unfortunately it is a messier workaround - it does not leave any\nuseful image data at all, so e.g. a PDF file will be corrupted on that page\n(though other pages will be OK).\n\nOriginal problem still observable in 0.20.3rc. Now using DocBook stylesheets 1.48.", "id": 10850, "time": "2002-02-18T10:45:13Z", "bug_id": 5221, "creation_time": "2002-02-18T10:45:13Z", "tags": [], "is_private": false}, {"count": 6, "attachment_id": 1197, "bug_id": 5221, "text": "Created attachment 1197\nLess desirable patch for Jimi-handled files (PNG, ...)", "id": 10851, "time": "2002-02-18T10:45:54Z", "creator": "jesse.glick@netbeans.com", "creation_time": "2002-02-18T10:45:54Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "keiron@aftexsw.com", "attachment_id": null, "is_private": false, "id": 26342, "time": "2002-11-15T08:07:52Z", "bug_id": 5221, "creation_time": "2002-11-15T08:07:52Z", "text": "The problem appears to be fixed. The attached gif file works."}, {"count": 8, "tags": [], "bug_id": 5221, "attachment_id": null, "is_private": false, "id": 43350, "time": "2003-08-27T01:22:43Z", "creator": "jglick@apache.org", "creation_time": "2003-08-27T01:22:43Z", "text": "[new account, please ignore]"}, {"count": 9, "tags": [], "bug_id": 5221, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed", "id": 155936, "time": "2012-04-01T06:49:39Z", "creator": "gadams@apache.org", "creation_time": "2012-04-01T06:49:39Z", "is_private": false, "attachment_id": null}]
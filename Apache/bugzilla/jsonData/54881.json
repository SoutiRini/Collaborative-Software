[{"count": 0, "tags": [], "creator": "reto.ischi@ergon.ch", "attachment_id": null, "id": 166804, "time": "2013-04-24T08:51:18Z", "bug_id": 54881, "creation_time": "2013-04-24T08:51:18Z", "is_private": false, "text": "Compiled and installed Apache HTTPD 2.4.4 on CentOS 6.4 with\nAPR 1.4.6\nAPR-util 1.5.2\nPCRE 8.32\n\nMy httpd.conf:\n==========================\nLoadModule setenvif_module modules/mod_setenvif.so\nLoadModule unixd_module modules/mod_unixd.so\n\nUser daemon\nListen 8000\nDocumentRoot \"/usr/local/apache2/htdocs\"\nServerName test\n\nSetEnvIfExpr \"true\" envA=1\nSetEnvIf User-Agent \"test\" envB=1\n==========================\n\nI'm getting a segmentation fault if a any SetEnvIf directive follows after a SetEnvIfExpr directive:\n\n# gdb ./httpd\n(gdb) run\nStarting program: /usr/local/apache2/bin/httpd \n[Thread debugging using libthread_db enabled]\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007ffff6c8f799 in __strcasecmp_l_ssse3 () from /lib64/libc.so.6\nMissing separate debuginfos, use: debuginfo-install expat-2.0.1-11.el6_2.x86_64 glibc-2.12-1.107.el6.x86_64 nss-softokn-freebl-3.12.9-11.el6.x86_64\n(gdb) bt\n#0  0x00007ffff6c8f799 in __strcasecmp_l_ssse3 () from /lib64/libc.so.6\n#1  0x00007ffff64ee1a0 in add_setenvif_core (cmd=0x7fffffffe3f0, mconfig=<value optimized out>, fname=0x6cc4c0 \"User-Agent\", \n    args=0x6cb55a \"envB=1\") at mod_setenvif.c:317\n#2  0x00007ffff64ee597 in add_setenvif (cmd=0x7fffffffe3f0, mconfig=0x6c9cb8, args=0x6cb553 \"\\\"test\\\" envB=1\") at mod_setenvif.c:415\n#3  0x0000000000448ace in invoke_cmd (cmd=0x7ffff66ef600, parms=0x7fffffffe3f0, mconfig=0x6c9cb8, args=0x6cb548 \"User-Agent \\\"test\\\" envB=1\")\n    at config.c:876\n#4  0x000000000044a5c3 in ap_walk_config_sub (current=0x6cb500, parms=0x7fffffffe3f0, section_vector=0x6c7858) at config.c:1306\n#5  ap_walk_config (current=0x6cb500, parms=0x7fffffffe3f0, section_vector=0x6c7858) at config.c:1339\n#6  0x000000000044aa49 in ap_process_config_tree (s=<value optimized out>, conftree=<value optimized out>, p=0x695138, ptemp=<value optimized out>)\n    at config.c:2063\n#7  0x0"}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "is_private": false, "id": 166812, "time": "2013-04-24T11:50:53Z", "bug_id": 54881, "creation_time": "2013-04-24T11:50:53Z", "text": "Does the following patch solve your issue:\n\nIndex: modules/metadata/mod_setenvif.c\n===================================================================\n--- modules/metadata/mod_setenvif.c     (revision 1471371)\n+++ modules/metadata/mod_setenvif.c     (working copy)\n@@ -314,7 +314,7 @@\n      */\n     for (i = 0; i < sconf->conditionals->nelts; ++i) {\n         new = &entries[i];\n-        if (!strcasecmp(new->name, fname)) {\n+        if (new->name && !strcasecmp(new->name, fname)) {\n             fname = new->name;\n             break;\n         }"}, {"count": 2, "tags": [], "text": "Yes, this solves the issue, thanks.", "is_private": false, "id": 166817, "creation_time": "2013-04-24T12:36:05Z", "time": "2013-04-24T12:36:05Z", "creator": "reto.ischi@ergon.ch", "bug_id": 54881, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 54881, "attachment_id": null, "id": 166820, "time": "2013-04-24T14:59:11Z", "creator": "rpluem@apache.org", "creation_time": "2013-04-24T14:59:11Z", "is_private": false, "text": "Fixed in trunk as r1471449."}, {"count": 4, "tags": [], "bug_id": 54881, "attachment_id": null, "id": 166871, "time": "2013-04-26T11:42:32Z", "creator": "rpluem@apache.org", "creation_time": "2013-04-26T11:42:32Z", "is_private": false, "text": "Baqckported to 2.4.x as r1476143."}]
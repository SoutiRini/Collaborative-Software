[{"count": 0, "tags": [], "bug_id": 40653, "attachment_id": null, "id": 94371, "time": "2006-10-02T06:38:38Z", "creator": "lstefani@fortresstech.com", "creation_time": "2006-10-02T06:38:38Z", "is_private": false, "text": "With proper environment variables, --host= and --target options, Apache 2.2.3 \ncan be cross-compiled successfully.  However, the bin/apxs PERL script has an \nimplicit dependency on bin/httpd, which causes a problem when building other \nmodules.\n\nFor example, when adding PHP 5.1.6 to Apache 2.2.3, the --with-apxs2= option \nis used on the PHP configure line to point to apxs.  PHP needs to run apxs to \ndetermine the include paths, CFLAGS, etc. used to build Apache.  This fails on \na cross-compiled environment when apxs tries to execute httpd on the host \nsystem.\n\napxs should become truly platform-independent and not rely on binaries that \ncannot be run on the build system."}, {"count": 1, "tags": [], "creator": "lstefani@fortresstech.com", "attachment_id": null, "id": 94374, "time": "2006-10-02T08:30:22Z", "bug_id": 40653, "creation_time": "2006-10-02T08:30:22Z", "is_private": false, "text": "More information.  PHP developers consider this issue a problem with apxs.\n\nFrom http://bugs.php.net/bug.php?id=38997&edit=2\n\n    [2 Oct 3:19pm UTC] tony2001@php.net \n    If you want apxs utility to be enhanced - please report it as a feature\n    request to Apache developers.\n    There is nothing PHP can do about it.\n"}, {"count": 2, "tags": [], "bug_id": 40653, "attachment_id": null, "is_private": false, "id": 94582, "time": "2006-10-06T06:10:45Z", "creator": "nick@webthing.com", "creation_time": "2006-10-06T06:10:45Z", "text": "Feel free to contribute an alternative build tool.  You'll have to deal with \nthe dependencies too, of course.  And bear in mind that apxs is designed to \nwork in packages, where you don't have all the build debris lying around.\n\nAnyway, cross-compiling PHP sounds to me like a *much* bigger job than this."}, {"count": 3, "tags": [], "creator": "lstefani@fortresstech.com", "text": ">>Feel free to contribute an alternative build tool.  You'll have to deal with \n>>the dependencies too, of course.  And bear in mind that apxs is designed to \n>>work in packages, where you don't have all the build debris lying around.\n\nThat may explain the need to run httpd from apxs.  It appeared that since apxs \nis created dynamically, it could at least contain all of the CFLAGS, include \npaths, etc. that would be required by a fairly popular external module (PHP), \nwithout reading other files.\n\n>>Anyway, cross-compiling PHP sounds to me like a *much* bigger job than this.\n\nI'm not so sure.  PHP configure supports the same --host= and --target= \noptions as Apache configure.  I was able to configure and cross-compile PHP \nsuccessfully, that is, until I added the --with-apxs2= option.  I didn't \nrealize that without it, the loadable module that Apache needs isn't built.\n\nNow I'm left with a cross-compiled httpd daemon that loads and runs just fine \non my target platform, but with no PHP support.\n\nI appreciate the feedback.  I'll probably need to revert to installing the GCC \ntoolchain and software packages on my target platform and rerun the \nconfigure/make steps in \"native\" mode.  I was hoping for any workaround that \nwould allow me to avoid that.\n", "id": 94583, "time": "2006-10-06T06:26:14Z", "bug_id": 40653, "creation_time": "2006-10-06T06:26:14Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 40653, "attachment_id": null, "is_private": false, "id": 94806, "time": "2006-10-13T06:55:34Z", "creator": "lstefani@fortresstech.com", "creation_time": "2006-10-13T06:55:34Z", "text": "Just wanted to note a workaround for this problem.  By editing the PHP \nconfigure script to replace appropriate $APXS -q calls with explicit \ndirectories and filenames, I was able to avoid executing apxs during the \nconfigure step.  What was necessary was to perform the apxs -q queries on the \ntarget platform (where the apxs can run httpd properly), then take the result \nand enter it into the PHP configure script, run configure, then cross-compile \nPHP accordingly.\n\nThe alternative would be to edit apxs to *not* invoke httpd on simple -q \nqueries, which can be easily determined when apxs is created.\n"}, {"count": 5, "tags": [], "bug_id": 40653, "attachment_id": 19384, "id": 97850, "time": "2007-01-09T14:42:26Z", "creator": "dmlee@crossroads.com", "creation_time": "2007-01-09T14:42:26Z", "is_private": false, "text": "Created attachment 19384\nFixes apxs for cross-compilation\n\nThe attached patch removes the need for apxs to invoke httpd.  \n\nWith this patch, the value of enable_so is saved into config_vars.mk.  apxs\nthen looks up this value instead of invoking httpd."}, {"attachment_id": null, "tags": [], "bug_id": 40653, "text": "Great patch David, thanks, that code has annoyed me forever.  I tweaked it\nslightly and committed it to the trunk:\n\nhttp://svn.apache.org/viewvc?view=rev&revision=494781", "count": 6, "id": 97873, "time": "2007-01-10T02:52:41Z", "creator": "jorton@redhat.com", "creation_time": "2007-01-10T02:52:41Z", "is_private": false}]
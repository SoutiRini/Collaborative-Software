[{"count": 0, "tags": [], "bug_id": 37054, "attachment_id": null, "text": "Since 5.5.12 using a ServletContextListener leads to a NoClassDefFoundError.\n5.5.11 instead worked as expected with exactly the same code.\n\nThe class ServletListener is part of the web application. The web application of\ncourse has no servlet-api.jar included as this must be provided by the servlet\nengine through the appropriate classloader.\n\no JVM is Sun 1.5.0_05, I got the same error with 1.5.0_04.\n\no My web.xml:\n<web-app>\n   ...\n    <listener>\n        <listener-class>\n        this.is.my.ServletListener\n        </listener-class>\n    </listener>   \n</web-app>\n\no My listener class:\npublic class ServletListener implements ServletContextListener {\n        public void contextInitialized(ServletContextEvent arg0) {...}\n        public void contextDestroyed(ServletContextEvent arg0) {\u2026}\n}\n\no This is the error during startup:\n09:09:12,579 ERROR [/myApp]:3643 - Error configuring application listener of\nclass this.is.my.ServletListener\njava.lang.NoClassDefFoundError: javax/servlet/ServletContextListener\n        at java.lang.ClassLoader.defineClass1(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:620)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124)\n        at java.net.URLClassLoader.defineClass(URLClassLoader.java:260)\n        at java.net.URLClassLoader.access$100(URLClassLoader.java:56)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:195)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n        at\norg.apache.catalina.loader.WebappClassLoader.findClass(WebappClassLoader.java:870)\n        at\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1305)\n        at\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1187)\n        at\norg.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:3640)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4127)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1012)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:718)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1012)\n        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:442)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:450)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:680)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:536)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:585)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:275)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)\n09:09:12,594 ERROR [/myApp]:3650 - Skipped installing application listeners due\nto previous error(s)", "id": 81062, "time": "2005-10-12T18:46:35Z", "creator": "ehcapa.allizgub@elsen.net", "creation_time": "2005-10-12T18:46:35Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 37054, "is_private": false, "id": 81209, "time": "2005-10-16T23:33:28Z", "creator": "yoavs@computer.org", "creation_time": "2005-10-16T23:33:28Z", "tags": [], "text": "Works for me on 5.5.12 right out of the box.  I'm attaching a WAR you can use to\ntest if you'd like, and closing this issue."}, {"count": 2, "tags": [], "bug_id": 37054, "attachment_id": null, "text": "Please attach the war, I'll try it against my installation and check why it\ndoesn't work.", "id": 81473, "time": "2005-10-20T18:18:36Z", "creator": "ehcapa.allizgub@elsen.net", "creation_time": "2005-10-20T18:18:36Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 37054, "attachment_id": null, "text": "I'm re-opening this as I have a project that worked fine in 5.5.9 and doesn't \nwork in 5.5.12 (similar to the original poster).\n\nI tracked the issue down to my server.xml (see below). I was using a <Loader> \nelement under <Host> element. Even with an empty <Loader/> element I get the \nNoClassDefFoundError. When I take out the element completely it works.\n\nMy stack trace is:\n\nSEVERE: Error configuring application listener of class \norg.springframework.web.context.ContextLoaderListener\njava.lang.NoClassDefFoundError: javax/servlet/ServletContextListener\n\nMy server.xml is:\n\n<Server port=\"8005\" shutdown=\"SHUTDOWN\">\n\t<Listener className=\"org.apache.catalina.core.AprLifecycleListener\" />\n\t<Listener \nclassName=\"org.apache.catalina.mbeans.ServerLifecycleListener\" />\n\t<Listener \nclassName=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" />\n\t<Listener \nclassName=\"org.apache.catalina.storeconfig.StoreConfigLifecycleListener\" />\n\n\t<Service name=\"Catalina\">\n\t\t<Connector port=\"8080\" maxHttpHeaderSize=\"8192\" \nmaxThreads=\"150\" minSpareThreads=\"25\"\n\t\t\tmaxSpareThreads=\"75\" enableLookups=\"false\" \nredirectPort=\"8443\" acceptCount=\"100\" connectionTimeout=\"20000\"\n\t\t\tdisableUploadTimeout=\"true\" />\n\n\t\t<Connector port=\"8009\" enableLookups=\"false\" \nredirectPort=\"8443\" protocol=\"AJP/1.3\" />\n\n\t\t<Engine name=\"Catalina\" defaultHost=\"localhost\">\n\t\t\t<Host name=\"localhost\" unpackWARs=\"true\" \nautoDeploy=\"true\" xmlValidation=\"false\"\n\t\t\t\txmlNamespaceAware=\"false\">\n\n\t\t\t\t<Context path=\"\" docBase=\"d:\\jproj-3.1\\iod-\nguide\\src\\main\\webapp\">\n\t\t\t\t\t<Loader/>\n\t\t\t\t</Context>\n\n\t\t\t</Host>\n\t\t</Engine>\n\t</Service>\n</Server>\n\nThis is causing trouble for me as I want to use a custom classloader derived \nfrom WebappClassLoader. Is there any workaround?\n\nThanks, Alfie.", "id": 84217, "time": "2006-01-04T17:44:40Z", "creator": "alfie.kirkpatrick@ioko.com", "creation_time": "2006-01-04T17:44:40Z", "is_private": false}, {"count": 4, "tags": [], "creator": "asf-bugzilla@plet.net", "attachment_id": null, "id": 84585, "time": "2006-01-13T04:21:49Z", "bug_id": 37054, "creation_time": "2006-01-13T04:21:49Z", "is_private": false, "text": "I also have a project that worked under 5.5.9, but under 5.5.15, I get this on\nstartup:\n\n2006-01-12 19:00:02,351 [ERROR] main\norg.apache.catalina.core.ContainerBase.[Catalina].[bolweb].[/] - Error\nconfiguring application listener of class\norg.apache.myfaces.webapp.StartupServletContextListener\njava.lang.NoClassDefFoundError: javax/servlet/ServletContextListener\n\nI am also using a loader tag in server.xml.  If i remove it, it works fine...but\nI need it."}, {"count": 5, "attachment_id": null, "bug_id": 37054, "is_private": false, "id": 84586, "time": "2006-01-13T05:09:33Z", "creator": "william.barker@wilshire.com", "creation_time": "2006-01-13T05:09:33Z", "tags": [], "text": "It is the responability of your custom Loader to correctly resolve the parent \nClassLoader (by calling getParentClassLoader on the Container).  It's possible \nthat the Tomcat developers could make this easier for people extending \nWebappLoader (which is why I'm not actually closing the bug), but in the \nmeantime, something like:\n  public void start() throws LifecycleException {\n     Thread cthrd = Thread.currentThread();\n     ClassLoader oldcl = cthrd.getContextClassLoader();\n     cthrd.setContextClassLoader(getContainer().getParentClassLoader());\n     super.start();\n     cthrd.setContextClassLoader(oldcl);\n  }\n\nshould do as a work-around.\n"}, {"count": 6, "tags": [], "bug_id": 37054, "attachment_id": null, "text": "Thank you.  I also just found that it works if i add delegate=\"true\" to the\nloader tag.", "id": 84587, "time": "2006-01-13T05:22:54Z", "creator": "asf-bugzilla@plet.net", "creation_time": "2006-01-13T05:22:54Z", "is_private": false}, {"count": 7, "attachment_id": null, "bug_id": 37054, "is_private": false, "id": 84617, "time": "2006-01-13T21:16:07Z", "creator": "alfie.kirkpatrick@ioko.com", "creation_time": "2006-01-13T21:16:07Z", "tags": [], "text": "Adding delegate=\"true\" doesn't work for me. Even if I just have:\n\n  <Loader delegate=\"true\"/>\n\nIt doesn't work. NoClassDefFoundError: javax/servlet/ServletContextListener.\n\nAlso, can you confirm the sample code should go in WebappLoader and not \nWebappClassLoader. I'm overriding the latter and don't need to override \nWebappLoader (unless I need to to get this working!).\n\nThanks, Alfie."}, {"count": 8, "tags": [], "creator": "asf-bugzilla@plet.net", "attachment_id": null, "id": 84756, "time": "2006-01-18T21:04:02Z", "bug_id": 37054, "creation_time": "2006-01-18T21:04:02Z", "is_private": false, "text": "(In reply to comment #6)\n> Thank you.  I also just found that it works if i add delegate=\"true\" to the\n> loader tag.\n\nI was mistaken.  This actually did not work.  I also tried william's workaround\n(getParentClassLoader), and it didn't help."}, {"count": 9, "tags": [], "creator": "yoavs@computer.org", "text": "Changing summary text of this issue to indicate the key fact that you're using a\ncustom loader, and updating version to 5.5.15 per comment above.", "id": 88268, "time": "2006-04-19T13:20:19Z", "bug_id": 37054, "creation_time": "2006-04-19T13:20:19Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "remm@apache.org", "text": "*** Bug 37302 has been marked as a duplicate of this bug. ***", "id": 88432, "time": "2006-04-24T13:52:52Z", "bug_id": 37054, "creation_time": "2006-04-24T13:52:52Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "remm@apache.org", "text": "*** Bug 38877 has been marked as a duplicate of this bug. ***", "id": 88434, "time": "2006-04-24T13:53:00Z", "bug_id": 37054, "creation_time": "2006-04-24T13:53:00Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "remm@apache.org", "text": "- Using the setParentCL rule is not nice at all, as it (dumbly) overrides any\npossible configuration which could be done when embedding.\n- From what the related reports wrote, this does not affect context files (only\nwhen the Context element is in server.xml). You should be using that\n-> So overall, this bug should not get fixed (I will not bother closing it, as I\nam sure it would be reopened right away, though).", "id": 88435, "time": "2006-04-24T13:58:05Z", "bug_id": 37054, "creation_time": "2006-04-24T13:58:05Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 92705, "time": "2006-08-30T03:41:00Z", "bug_id": 37054, "creation_time": "2006-08-30T03:41:00Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of 39704 ***"}]
[{"count": 0, "attachment_id": null, "bug_id": 8319, "text": "javax.servlet.jsp.jspl.sql.dataSource is taking precedence over the\nsql:transaction dataSource attribute.\n\n\n<%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jstl/core\" %>\n<%@ taglib prefix=\"sql\" uri=\"http://java.sun.com/jstl/sql\" %>\n<%@ taglib prefix=\"sql_rt\" uri=\"http://java.sun.com/jstl/sql_rt\" %>\n<%@ taglib prefix=\"tck\" uri=\"http://java.sun.com/jstltck/jstltck-util\" %>\n<%@ page import=\"javax.sql.*,java.util.*\" %>\n\n<tck:test testName=\"positiveTxDataSourceConfigDataSourceTest\">\n\n  \n   <!-- EL: Validate sql:transaction, sql:query actions and\njavax.servlet.jsp.jstl.sql.dataSource\n            configuration parameter  specifying a DataSource Object -->\n\n   <h1>Validating sql:transaction, sql:query actions, the\njavax.servlet.jsp.jstl.sql.dataSource \n   configuration parameter  specifying a DataSource Object using EL</h1>\n   <p>\n\n   <%-- Configure javax.servlet.jsp.jstl.sql.dataSource --%>\n   <tck:config configVar=\"datasource\" op=\"set\" \n               value='<%= (DataSource) pageContext.getAttribute(\"jstlDS\",\nPageContext.APPLICATION_SCOPE) %>'/>\n\n   <sql:transaction>\n      <sql:query var=\"resultSet\"  >\n         <c:out value=\"${sqlProps.Simple_Select_Query}\" />\n      </sql:query>\n   </sql:transaction>\n\n   <c:choose>\n      <c:when test=\"${resultSet.rowCount != JSTL_TAB1_ROWS}\">\n         <H2>ERROR:</H2>\n         While using the configuration parameter <strong>\n         javax.servlet.jsp.jstl.sql.dataSource</strong>, and the query: <strong>\n         \"<c:out value=\"${sqlProps.Simple_Select_Query}\" />\" , the expected\n         number of rows <strong>\"<c:out value=\"${JSTL_TAB1_ROWS}\" />\"</strong>\n         was not returned. The actual number of rows returned was\n         <strong>\"<c:out value=\"${resultSet.rowCount}\" />\"<strong>.\n         <p>\n      </c:when>\n      <c:otherwise>\n         While using the configuration parameter <strong>\n         javax.servlet.jsp.jstl.sql.dataSource</strong>, specifying a DataSource\n         Object, the query succeeded.\n         <p>\n      </c:otherwise>\n   </c:choose>\n\n   <%-- Validate that the dataSource attribute overrides the config param --%>\n   <tck:config configVar=\"datasource\" op=\"set\" value='<%= new Integer(1) %>'/>\n\n   <c:catch var=\"e\"  >\n      <sql:transaction dataSource=\"${applicationScope.jstlDS}\" >\n         <sql:query var=\"resultSet1\"  >\n             <c:out value=\"${sqlProps.Select_Jstl_Tab1_By_Id_Query}\" />\n         </sql:query>\n      </sql:transaction>\n   </c:catch>\n\n   <c:choose>\n      <c:when test=\"${!empty e}\">\n         <H2>ERROR:</H2>\n         javax.servlet.jsp.jstl.sql.dataSource <strong>did</strong> take\n         precedence over the <strong>dataSource</strong> attribute!  \n         The Exception that was raised\n         is: <strong><c:out value='${e}' escapeXml='false' /></strong>.\n         <p>\n      </c:when>\n      <c:otherwise>\n         The dataSource attribute <strong>did</strong> take precedence over \n          javax.servlet.jsp.jstl.sql.dataSource. The query executed without\n          an error.\n         <p>\n      </c:otherwise>\n   </c:choose>\n\n \n   <!-- RT: Validate sql:transaction, sql:query actions and\njavax.servlet.jsp.jstl.sql.dataSource\n            configuration parameter  specifying a DataSource Object -->\n\n   <h1>Validating sql:transaction, sql:query actions, the\njavax.servlet.jsp.jstl.sql.dataSource \n   configuration parameter  specifying a DataSource Object using RT</h1>\n   <p>\n\n <%-- Configure javax.servlet.jsp.jstl.sql.dataSource --%>\n   <tck:config configVar=\"datasource\" op=\"set\" \n               value='<%= (DataSource) pageContext.getAttribute(\"jstlDS\",\nPageContext.APPLICATION_SCOPE) %>'/>\n\n       <sql_rt:transaction>\n          <sql_rt:query var=\"resultSet2\"  >           \n            \n<%=((Properties)pageContext.getAttribute(\"sqlProps\",PageContext.APPLICATION_SCOPE)).getProperty(\"Simple_Select_Query\")\n%>\n          </sql_rt:query>\n       </sql_rt:transaction>\n\n   <c:choose>\n      <c:when test=\"${resultSet2.rowCount != JSTL_TAB1_ROWS}\">\n         <H2>ERROR:</H2>\n         While using the configuration parameter <strong>\n         javax.servlet.jsp.jstl.sql.dataSource</strong>, specifying a DataSource\n         Object,  the query: <strong>\n         \"<c:out value=\"${sqlProps.Simple_Select_Query}\" />\" , the expected\n         number of rows <strong>\"<c:out value=\"${JSTL_TAB1_ROWS}\" />\"</strong>\n         was not returned. The actual number of rows returned was\n         <strong>\"<c:out value=\"${resultSet2.rowCount}\" />\"<strong>.\n         <p>\n      </c:when>\n      <c:otherwise>\n         While using the configuration parameter <strong>\n         javax.servlet.jsp.jstl.sql.dataSource</strong>, specifying a DataSource\n         Object, the query succeeded.\n         <p>\n      </c:otherwise>\n   </c:choose>\n\n\n   <%-- Validate that the dataSource attribute overrides the config param --%>\n   <tck:config configVar=\"datasource\" op=\"set\" value='<%= new Integer(1) %>'/>\n\n   <c:catch var=\"e2\"  >\n\n       <sql_rt:transaction \n           dataSource='<%=(DataSource) pageContext.getAttribute(\"jstlDS\",\nPageContext.APPLICATION_SCOPE) %>'  >\n\n          <sql_rt:query var=\"resultSet4\" >\n            \n<%=((Properties)pageContext.getAttribute(\"sqlProps\",PageContext.APPLICATION_SCOPE)).getProperty(\"Simple_Select_Query\")\n%>\n          </sql_rt:query>\n       </sql_rt:transaction>\n \n   </c:catch>\n\n   <c:choose>\n      <c:when test=\"${!empty e2}\">\n         <H2>ERROR:</H2>\n         javax.servlet.jsp.jstl.sql.dataSource <strong>did</strong> take\n         precedence over the <strong>dataSource</strong> attribute!  \n         The Exception that was raised\n         is: <strong><c:out value='${e2}' escapeXml='false' /></strong>.\n         <p>\n      </c:when>\n      <c:otherwise>\n         The dataSource attribute <strong>did</strong> take precedence over \n          javax.servlet.jsp.jstl.sql.dataSource. The query executed without\n          an error.\n         <p>\n      </c:otherwise>\n   </c:choose>\n\n\n  <tck:config configVar=\"datasource\" op=\"remove\" />\n  \n</tck:tes", "id": 14115, "time": "2002-04-19T23:10:07Z", "creator": "Lance.Andersen@Sun.COM", "creation_time": "2002-04-19T23:10:07Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "jan.luehe@sun.com", "text": "Fixed.\n", "id": 14373, "time": "2002-04-22T22:14:12Z", "bug_id": 8319, "creation_time": "2002-04-22T22:14:12Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "Lance.Andersen@Sun.COM", "text": "This now works for sql:transaction but fails for sql_rt:transaction", "id": 14436, "time": "2002-04-23T13:08:23Z", "bug_id": 8319, "creation_time": "2002-04-23T13:08:23Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 8319, "is_private": false, "id": 14581, "time": "2002-04-24T01:13:30Z", "creator": "jan.luehe@sun.com", "creation_time": "2002-04-24T01:13:30Z", "tags": [], "text": "OK, we were passing the test below (named\n\"positiveTxDataSourceConfigDataSourceTest\"), but the test we really should have\npassed in order for this bug to be fixed is named\n\"positiveTxDataSourceConfigPrecedenceTest.jsp\". We now pass this test, too.\n"}]
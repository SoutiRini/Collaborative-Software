[{"count": 0, "tags": [], "bug_id": 52892, "is_private": false, "text": "(May have mislabled the compenent, not sure if it is in authn_core or authz_core)\n\nWhat I'm trying to do:\n|                <RequireAll>\n|                        Require ssl-verify-client\n|                        Require valid-user\n|                        Require expr ( \\\n|                                        (%{SSL_CLIENT_S_DN_O} == \"Company\") && \\\n|                                        (%{SSL_CLIENT_S_DN_OU} == \"Staff\") && \\\n|                                        (%{REMOTE_USER} == %{SSL_CLIENT_S_DN_CN}) \\\n|                                     )\n|                </RequireAll>\n\nNeed valid Client Cert + Login, login needs to be the CN of the certificate.\n\nWhat I expect to happen: this should work\nWhat I see: %{REMOTE_USER} is empty!\n> The expression parser provides a number of variables of the form %{HTTP_HOST}. Note that the value of a variable may depend on the phase of the request processing in which it is evaluated. For example, an expression used in an <If > directive is evaluated before authentication is done. Therefore, %{REMOTE_USER} will not be set in this case.\n\nIt's noted in the docs it can be empty... however:\n| Require user hardcodeduser\n\nWorks fine... the information seems to be available at this stage.\nSo why isn't it exported.\n\nFor Comepleteness:\nI also tried \"Require user %{SSL_CLIENT_S_DN_CN}\" but that didn't work... I wasn't expecting it to work though.\n\nI don't think what I'm trying to do is unreasonable, if there is a way to do it, it would be awesome.\n\nHopefully this is really a bug and not a limitation!", "id": 154848, "time": "2012-03-12T21:03:23Z", "creator": "registration@blackdot.be", "creation_time": "2012-03-12T21:03:23Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "text": "The require statements are actually executed twice, once before auth and once after auth. Auth is only triggered if a Require statement says that its result may change after auth and the change of this statement would actually make a difference in the end result. However, Require expr currently lacks the necessary logic for this.\n\nYou could try (untested):\n\n<RequireAll>\n  Require ssl-verify-client\n  Require valid-user\n  <RequireAny>\n    Require user workaround_for_PR_52892\n    Require expr ...\n  </RequireAny>\n</RequireAll>\n\nThen the Require user would trigger auth. Of course, workaround_for_PR_52892 must not exist as a user or you have a security problem.", "id": 154868, "time": "2012-03-13T07:44:36Z", "bug_id": 52892, "creation_time": "2012-03-13T07:44:36Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 52892, "text": "(In reply to comment #1)\n> The require statements are actually executed twice, once before auth and once\n> after auth. Auth is only triggered if a Require statement says that its result\n> may change after auth and the change of this statement would actually make a\n> difference in the end result. However, Require expr currently lacks the\n> necessary logic for this.\n> \nWill it support it in the future?\n\n> You could try (untested):\n> \n> <RequireAll>\n>   Require ssl-verify-client\n>   Require valid-user\n>   <RequireAny>\n>     Require user workaround_for_PR_52892\n>     Require expr ...\n>   </RequireAny>\n> </RequireAll>\n> \n> Then the Require user would trigger auth. Of course, workaround_for_PR_52892\n> must not exist as a user or you have a security problem.\n\nI've tested it and it works!\ncert for user1 with user2 as login --> fail\ncert for user1 with user1 as login --> success", "count": 2, "id": 154884, "time": "2012-03-13T17:33:47Z", "creator": "registration@blackdot.be", "creation_time": "2012-03-13T17:33:47Z", "is_private": false}, {"count": 3, "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "is_private": false, "id": 154886, "time": "2012-03-13T19:30:37Z", "bug_id": 52892, "creation_time": "2012-03-13T19:30:37Z", "text": "(In reply to comment #2)\n> > However, Require expr currently lacks the\n> > necessary logic for this.\n> > \n> Will it support it in the future?\n\nyes"}, {"attachment_id": null, "tags": [], "creator": "sf@sfritsch.de", "text": "fixed in trunk as r1351072", "count": 4, "id": 160066, "time": "2012-06-17T08:42:06Z", "bug_id": 52892, "creation_time": "2012-06-17T08:42:06Z", "is_private": false}, {"count": 5, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "Fixed for 2.4 in r1364266.\nReleased with 2.4.3.\nDoes not apply to 2.2.x.", "id": 161586, "time": "2012-08-21T16:22:48Z", "bug_id": 52892, "creation_time": "2012-08-21T16:22:48Z", "is_private": false}]
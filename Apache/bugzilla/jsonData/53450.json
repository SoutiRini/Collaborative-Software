[{"count": 0, "tags": [], "creator": "violetagg@apache.org", "attachment_id": null, "is_private": false, "id": 160169, "time": "2012-06-21T18:22:10Z", "bug_id": 53450, "creation_time": "2012-06-21T18:22:10Z", "text": "Hi,\n\nThe scenario is the following:\n- I have running Tomcat 7.0.28\n- I deploy an application with 'ROOT' context\n- The deployment hangs forever. When taking a tread dump, the following is suspicious:\n\n\"localhost-startStop-2\" daemon prio=6 tid=0x0000000006607800 nid=0x2560 waiting on condition [0x0000000009ebf000]\n   java.lang.Thread.State: WAITING (parking)\n        at sun.misc.Unsafe.park(Native Method)\n        - parking to wait for  <0x00000007d80f0108> (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:842)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1178)\n        at java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(ReentrantReadWriteLock.java:807)\n        at org.apache.catalina.core.ContainerBase.removeContainerListener(ContainerBase.java:1071)\n        at org.apache.catalina.core.StandardEngine$AccessLogListener.uninstall(StandardEngine.java:463)\n        at org.apache.catalina.core.StandardEngine$AccessLogListener.containerEvent(StandardEngine.java:505)\n        at org.apache.catalina.core.ContainerBase.fireContainerEvent(ContainerBase.java:1431)\n        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:907)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:875)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:618)\n        at org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:1100)\n        at org.apache.catalina.startup.HostConfig$DeployDirectory.run(HostConfig.java:1618)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:138)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:662)\n\n\n\nAs you can see\n- A read lock is acquired at org.apache.catalina.core.ContainerBase.fireContainerEvent(ContainerBase.java:1425)\n- Then every listener is invoked to process the container event\n- Then AccessLogListener is invoked org.apache.catalina.core.StandardEngine$AccessLogListener.uninstall(StandardEngine.java:463)\n- The latter causes a call for a write lock org.apache.catalina.core.ContainerBase.removeContainerListener(ContainerBase.java:1071)\n- Unfortunately in the ReentrantReadWriteLock it is stated that upgrade from read to write lock is not possible\n\"Reentrancy also allows downgrading from the write lock to a read lock, by acquiring the write lock, then the read lock and then releasing the write lock. However, upgrading from a read lock to the write lock is not possible.\"\n\nRegards\nVioleta Georgieva"}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 160170, "time": "2012-06-21T18:51:00Z", "bug_id": 53450, "creation_time": "2012-06-21T18:51:00Z", "text": "That looks like a deadlock to me. We'll probably need a fairly quick 7.0.29 to address that. I'll take a look."}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "is_private": false, "count": 2, "id": 160174, "time": "2012-06-21T19:58:42Z", "bug_id": 53450, "creation_time": "2012-06-21T19:58:42Z", "text": "Fixed in trunk and 7.0.x and will be included in 7.0.29 onwards."}, {"attachment_id": null, "tags": [], "creator": "violetagg@apache.org", "text": "Thanks", "count": 3, "id": 160240, "time": "2012-06-25T16:41:00Z", "bug_id": 53450, "creation_time": "2012-06-25T16:41:00Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 44752, "attachment_id": null, "text": "Suexec does not check correctly that the executed script is inside the \ndocroot directory. It does \n\n        chdir(AP_DOC_ROOT)\n        getcwd(dwd, AP_MAXPATH)\n\nto get the docroot directory and then does a simple\n\n        strncmp(cwd, dwd, strlen(dwd))\n\nto compare it with the working directory. But getcwd returns the \ndirectory without a trailing slash (at least under linux). This means \nthat, if AP_DOC_ROOT is set to e.g. /var/www, suexec will happily \nexecute scripts under /var/www.bak . The same is true for userdir \nrequests, i.e. /home/joe/public_html.bak will be accepted.\n\n\nAs Joe Orton pointed out, this is\nhttp://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-1742\n\nThe advisory\nhttp://labs.idefense.com/intelligence/vulnerabilities/display.php?id=511\nalso lists a race condition.", "id": 115305, "time": "2008-04-03T14:07:48Z", "creator": "sf@sfritsch.de", "creation_time": "2008-04-03T14:07:48Z", "is_private": false}, {"count": 1, "tags": [], "creator": "sf@sfritsch.de", "attachment_id": 21780, "id": 115307, "time": "2008-04-03T14:53:39Z", "bug_id": 44752, "creation_time": "2008-04-03T14:53:39Z", "is_private": false, "text": "Created attachment 21780\npatch for suexec\n\nThis patch should fix both issues, but I am not sure if the fchdir part is portable."}, {"count": 2, "tags": [], "text": "Created attachment 23383\nmore simple patch\n\nThis is simpler patch.\nIt only tests whether NULL or '/' is exist on the end of cwd string.", "attachment_id": 23383, "id": 125558, "creator": "yuya.presto@gmail.com", "time": "2009-03-14T06:33:14Z", "bug_id": 44752, "creation_time": "2009-03-14T06:33:14Z", "is_private": false}, {"count": 3, "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "id": 125566, "time": "2009-03-15T01:20:58Z", "bug_id": 44752, "creation_time": "2009-03-15T01:20:58Z", "is_private": false, "text": "(In reply to comment #2)\n> Created an attachment (id=23383) [details]\n> more simple patch\n> \n> This is simpler patch.\n> It only tests whether NULL or '/' is exist on the end of cwd string.\n\nHave you tested this in the case that the script is located directly in the document root (and not in a subdir?)"}, {"count": 4, "tags": [], "creator": "yuya.presto@gmail.com", "attachment_id": null, "id": 125567, "time": "2009-03-15T03:00:06Z", "bug_id": 44752, "creation_time": "2009-03-15T03:00:06Z", "is_private": false, "text": "Oops.. I've forgotten to test that case...\n\nI have just tested whether it execs /var/www/test_args.cgi with AP_DOC_ROOT=\"/var/www\".\nI also tested whether it doesn't exec /var/www-test/test_args.cgi.\nAnd it works for me. :)"}]
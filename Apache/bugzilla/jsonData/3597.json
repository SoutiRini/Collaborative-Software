[{"count": 0, "tags": [], "creator": "jeff@socialchange.net.au", "text": "I just timed the shutdown process of an out-the-box Tomcat 4.0 install, with the\npreinstalled 4 webapps. It takes 2 minutes on my pentium 3. 0% CPU usage. Is\nthis usual?\n\nBy \"shutdown process\", I mean the time from the invocation of \"./shutdown.sh\"\ntill the point at which all Tomcat threads actually die (as reported by 'ps').\n\nHere is the log output of what I'd consider a normal shutdown. Nothing untoward,\njust the last few lines take forever.\n\n[jeff@kermit bin]$ date ; ./shutdown.sh\nFri Sep 14 11:19:07 EST 2001\nUsing CLASSPATH:    \n/home/jeff/apache/jakarta/jakarta-tomcat-4.0/dist/bin/bootstrap.jar:/usr/local/jdk/lib/tools.jar\nUsing CATALINA_BASE: /home/jeff/tc\nUsing CATALINA_HOME: /home/jeff/apache/jakarta/jakarta-tomcat-4.0/dist\nUsing JAVA_HOME:     /usr/local/jdk\n[jeff@kermit bin]$ 2001-09-14 12:19:10 HttpProcessor[8080][4] Stopping\nbackground thread\n2001-09-14 12:19:10 HttpProcessor[8080][3] Stopping background thread\n2001-09-14 12:19:10 HttpProcessor[8080][2] Stopping background thread\n2001-09-14 12:19:10 HttpProcessor[8080][1] Stopping background thread\n2001-09-14 12:19:10 HttpProcessor[8080][0] Stopping background thread\n2001-09-14 12:19:10 HttpConnector[8080] Stopping background thread\n\n==> ../logs/catalina.out <==\nStopping service Tomcat-Standalone\n\n==> ../logs/localhost_log.2001-09-14.txt <==\n2001-09-14 12:19:15 StandardHost[localhost]: Removing web application at context\npath /examples\n2001-09-14 12:19:15 SessionListener: contextDestroyed()\n2001-09-14 12:19:15 ContextListener: contextDestroyed()\n2001-09-14 12:20:04 StandardHost[localhost]: Removing web application at context\npath /webdav\n2001-09-14 12:20:07 StandardHost[localhost]: Removing web application at context\npath /tomcat-docs\n2001-09-14 12:20:15 StandardHost[localhost]: Removing web application at context\npath /manager\n2001-09-14 12:21:07 StandardHost[localhost]: Removing web application at context\npath \n\n--Jeff", "id": 5502, "time": "2001-09-13T18:28:53Z", "bug_id": 3597, "creation_time": "2001-09-13T18:28:53Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "craig.mcclanahan@sun.com", "text": "You've got something wierd going on, all right.  The standard install shuts down\n(as measured by checking for ps to go away) in 4 seconds with the standard mix\nof webapps. (Pentium 3, 800mHz, Red Hat 7.1, Sun JDK 1.3.1).\n\nA significant difference in my log is that the \"Removing web application\" lines\nall fire on the same second, while you've got almost a minute gap between the\nmanager (which does nothing in its destroy() method) and ROOT web app.\n\nWhat build of Tomcat did you try this with?  Please try with RC2.\n\nWhat JDK are you running?\n\nWhat version of Linux are you running?\n\nDid this just start happening recently, or has it always been happening?\n\n(I'm suspicious that something is strange in the network layer of the JDK or the\nOS on your box).\n", "id": 5577, "time": "2001-09-15T08:38:12Z", "bug_id": 3597, "creation_time": "2001-09-15T08:38:12Z", "is_private": false, "attachment_id": null}, {"text": "I have the same symptom too; IBM JDK 1.3.0, tomcat 4.0 rc-2.\nWe've found the thing slow to shutdown in the previous versions\nwe've tried - inc. 4.0b3 and 4.0b5.  My machine is a K6-II-450, running\na standard RedHat-7.1\n\n2001-09-15 19:47:31 HostConfig[localhost]: HostConfig: Processing STOP\n2001-09-15 19:47:31 HostConfig[localhost]: Undeploying deployed web\napplications2001-09-15 19:47:31 HostConfig[localhost]: Undeploying web\napplication at context path /examples\n2001-09-15 19:47:31 StandardHost[localhost]: Removing web application at context\npath /examples\n2001-09-15 19:47:37 HostConfig[localhost]: Undeploying web application at\ncontext path /webdav\n2001-09-15 19:47:37 StandardHost[localhost]: Removing web application at context\npath /webdav\n2001-09-15 19:48:07 HostConfig[localhost]: Undeploying web application at\ncontext path /tomcat-docs\n2001-09-15 19:48:07 StandardHost[localhost]: Removing web application at context\npath /tomcat-docs\n2001-09-15 19:48:07 HostConfig[localhost]: Undeploying web application at\ncontext path /manager\n2001-09-15 19:48:07 StandardHost[localhost]: Removing web application at context\npath /manager\n2001-09-15 19:49:05 HostConfig[localhost]: Undeploying web application at\ncontext path \n2001-09-15 19:49:05 StandardHost[localhost]: Removing web application at context\npath \n\n\n", "tags": [], "bug_id": 3597, "is_private": false, "count": 2, "id": 5602, "time": "2001-09-15T13:09:13Z", "creator": "dsl@ts.com", "creation_time": "2001-09-15T13:09:13Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 3597, "attachment_id": null, "is_private": false, "id": 5613, "time": "2001-09-15T15:23:25Z", "creator": "dsl@ts.com", "creation_time": "2001-09-15T15:23:25Z", "text": "with debug turned on in some of the offending StandardManagers, a subset of the\nlogs gives:\n2001-09-15 21:33:44 StandardContext[/webdav]: Sending application stop events\n2001-09-15 21:33:44 StandardContext[/webdav]: Processing standard container\nshutdown\n2001-09-15 21:33:44 ContextConfig[/webdav]: ContextConfig: Processing STOP\n2001-09-15 21:33:44 StandardManager[/webdav]: Stopping\n2001-09-15 21:34:32 StandardManager[/webdav]: Unloading persisted sessions\n\nwhich seems to pinpoint the waiting problem in StandardManager:stop(), either\nduring firing a lifecycle stop event, or the threadStop method."}, {"count": 4, "tags": [], "creator": "craig.mcclanahan@sun.com", "text": "StandardManager.stop() will, among other things, try to persist all your current\nsessions to disk.  Do you have lots of active sessions?  Check in the \"work\"\ndirctory for \"SESSIONS.ser\" files in the directory for each webapp -- are any of\nthem abnormally large?  What happens if you stop Tomcat, delete the\n\"work/localhost\" directory completely, restart, then shut down?\n", "id": 5614, "time": "2001-09-15T16:13:49Z", "bug_id": 3597, "creation_time": "2001-09-15T16:13:49Z", "is_private": false, "attachment_id": null}, {"text": "I think this is a JDK issue. For me, it only happens with a certain version of \nIBM's JDK:\n\n[jeff@kermit bin]$ java -version\njava version \"1.3.0\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.3.0)\nClassic VM (build 1.3.0, J2RE 1.3.0 IBM build cx130-20000815 (JIT enabled: jitc))\n\nThat's on a Mandrake Linux box, kernel 2.4.3-20, glibc 2.2.2\n\nIf I use Sun's 1.2.2 JDK instead (only one I had handy), on the same box and\nsame Tomcat 4.0rc2 install, it works fine, taking about 5 secs to shut down.\n\nOn a Debian box (2.4.4 kernel), the following IBM JDK, it also works fine:\n\njava version \"1.3.0\"\nJava(TM) 2 Runtime Environment, Standard Edition (build Blackdown-1.3.0-FCS)\nJava HotSpot(TM) Client VM (build Blackdown-1.3.0-FCS, mixed mode)\n\n\nTo anyone else experiencing this (eg David Lecomber): could you please do a \n'java -version' and report it? Also, under the offending IBM JDK, the\nstartup.sh script couldn't automatically resolve CATALINA_HOME (see\nhttp://marc.theaimsgroup.com/?l=tomcat-user&m=100043024215213&w=2), and I'd be\ninterested if others have this problem too.\n\nRight now, I'm happy for this bug to be closed, pending further evidence.\n\n--Jeff", "tags": [], "bug_id": 3597, "is_private": false, "count": 5, "id": 5618, "time": "2001-09-15T21:19:12Z", "creator": "jeff@socialchange.net.au", "creation_time": "2001-09-15T21:19:12Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 3597, "is_private": false, "id": 5619, "time": "2001-09-15T21:52:49Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-09-15T21:52:49Z", "tags": [], "text": "Per Jeff's comments, this appears to be VM-specific to IBM's vm on this\nparticular platform.\n"}, {"id": 5623, "tags": [], "bug_id": 3597, "is_private": false, "count": 7, "text": "agreed with resolution...\n\nI've pumped up the checkInterval to 4 min for StandardManager, and found it\ntakes an extra 3 mins to shutdown -- evidently stopThread's thread.interrupt()\nisn't working properly in the IBM JDK and so it waits until the end of the\nsleep..!   This is with no sessions at all, shutdown straight after startup... \nOuch.\n\n\n\n", "time": "2001-09-16T03:02:48Z", "creator": "dsl@ts.com", "creation_time": "2001-09-16T03:02:48Z", "attachment_id": null}]
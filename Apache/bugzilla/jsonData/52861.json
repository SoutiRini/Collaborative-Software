[{"count": 0, "tags": [], "creator": "nrb@plusgrade.com", "attachment_id": null, "id": 154711, "time": "2012-03-08T21:18:01Z", "bug_id": 52861, "creation_time": "2012-03-08T21:18:01Z", "is_private": false, "text": "I have a webapp that fails on shutdown in the following code block from Spring Framework's AbstractApplicationContext (spring-context-3.0.6.jar, AbstractApplicationContext.java line 1013:)\n\n// Stop all Lifecycle beans, to avoid delays during individual destruction.\ntry {\n\tgetLifecycleProcessor().onClose();\n}\ncatch (Throwable ex) {\n\tlogger.warn(\"Exception thrown from LifecycleProcessor on context close\", ex);\n}\n\nWhat is happening is that the catch block is reached for whatever reason, and then the call to \"logger.warn()\" fails with the following exception if the webapp has not loaded these classes prior to being shut down:\n\nSEVERE: Servlet X threw unload() exception\njavax.servlet.ServletException: Servlet.destroy() for servlet offers threw exception\n[snip]\nCaused by: java.lang.NoClassDefFoundError: org/apache/log4j/spi/ThrowableInformation\n\nI see the WebappClassloader implements Lifecycle and provides start()/stop() methods and I assume that it has been stopped prior to invoking the web app's shutdown listeners. If that is the case, it seems like this is the wrong order for those two operations."}, {"count": 1, "tags": [], "bug_id": 52861, "attachment_id": null, "text": "See also http://java.net/jira/browse/GLASSFISH-16712", "id": 154713, "time": "2012-03-08T21:27:57Z", "creator": "nrb@plusgrade.com", "creation_time": "2012-03-08T21:27:57Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 52861, "attachment_id": null, "text": "This looks like a configuration problem with ENABLE_CLEAR_REFERENCES although since you haven't provided the full stack trace it is hard to be sure.\n\nThe users list is the place to seek help with this until that discussion reaches the point where it is determined that there is actually a Tomcat bug here.", "id": 154714, "time": "2012-03-08T21:39:57Z", "creator": "markt@apache.org", "creation_time": "2012-03-08T21:39:57Z", "is_private": false}]
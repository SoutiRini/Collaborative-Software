[{"count": 0, "tags": [], "creator": "gandhi.sagar@live.com", "attachment_id": 33284, "is_private": false, "id": 186457, "time": "2015-11-20T09:08:12Z", "bug_id": 58629, "creation_time": "2015-11-20T09:08:12Z", "text": "Created attachment 33284\nPatch for the solution.\n\nFor earliar versions, following code works. But for tomcat 9 , It is giving null pointer exception while starting the server.\n\n\tTomcat tomcat = new Tomcat();\n\ttomcat.setHostname(\"localhost\");\n\ttomcat.setPort(8080);\n\ttomcat.setBaseDir(\"D:/softwares/servers/STUDY_TOMCAT\");\n\ttomcat.start();\n\n\nException in thread \"main\" org.apache.catalina.LifecycleException: Failed to start component [StandardServer[-1]]\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:159)\n\tat org.apache.catalina.startup.Tomcat.start(Tomcat.java:345)\n\tat com.gandhisagar.test.TomcatStart.main(TomcatStart.java:13)\nCaused by: org.apache.catalina.LifecycleException: Failed to start component [StandardService[Tomcat]]\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:159)\n\tat org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:769)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:155)\n\t... 2 more\nCaused by: org.apache.catalina.LifecycleException: Failed to start component [org.apache.catalina.mapper.MapperListener@685f4c2e]\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:159)\n\tat org.apache.catalina.core.StandardService.startInternal(StandardService.java:451)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:155)\n\t... 4 more\nCaused by: java.lang.NullPointerException\n\tat org.apache.catalina.mapper.MapperListener.findDefaultHost(MapperListener.java:261)\n\tat org.apache.catalina.mapper.MapperListener.startInternal(MapperListener.java:102)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:155)\n\t... 6 more\n\n\nSolution:\n\nWhile debugging the issue we found that , Container is not getting initialized properly. So we need to call corg.apache.catalina.startup.Tomcat.getEngine() while starting the server in embedded mode. So that same code will work with Tomcat 9.0\n\n(Attaching the patch with the bug)"}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 186465, "time": "2015-11-20T20:39:31Z", "bug_id": 58629, "creation_time": "2015-11-20T20:39:31Z", "text": "This issue doesn't appear to be unique to 9.0.x\n\nI've fixed it in 9.0.x for 9.0.0.M2 onwards and in 8.0.x for 8.0.30 onwards.\n\nI took a different approach to fixing the NPE. The MapperListener now skips registration if the engine is null."}]
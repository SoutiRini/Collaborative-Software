[{"count": 0, "tags": [], "bug_id": 49308, "attachment_id": null, "text": "When used together with file content (index.html) or CGI, mod_headers behaves as if its response header treatment runs _before_ content generation, and not afterwards.\n\n\"set\", \"append\" and \"merge\" behave like \"add\", adding another instance of a header, instead of replacing (or appending to) it (... because I suppose, it actually runs before the script, so it \"sets\" the header, and then the script \"adds\" his)\n\n\"edit\", \"unset\" don't do anything at all (because, they run before the script, and thus have nothing to work on).\n\nThis is observed over a wide range of Apache versions, and can be seen on 2.2.8, 2.2.11, 2.2.14 and 2.2.15\n\nHowever, if 2 Header directives are present operating on the same header, then the second does operate correctly on the result left by the first.\n\nTest case:\n\nindex.cgi\n\n#!/bin/sh\n\necho Content-Type: text/plain\necho Test-set: a1\necho Test-append: b1\necho Test-edit: c1\necho Test-merge: d1\necho Test-add: e1\necho Test-unset: f1\necho\necho xyz\n\n\n.htaccess:\n\nOptions +ExecCGI\nAddHandler cgi-script .cgi\n\nHeader set Test-set a2\nHeader append Test-append b2\nHeader edit Test-edit c xx1\nHeader add Test-add e2\nHeader unset Test-unset\nHeader append Test-double-append g1\nHeader append Test-double-append g2\n\nOutput (of curl -D - http://localhost/~alain/header/index.cgi):\n\nHTTP/1.1 200 OK\nDate: Tue, 18 May 2010 17:25:41 GMT\nServer: Apache/2.2.14 (Ubuntu)\nTest-set: a1\nTest-append: b1\nTest-edit: c1\nTest-merge: d1\nTest-add: e1\nTest-unset: f1\nTest-set: a2\nTest-append: b2\nTest-merge: d1\nTest-add: e2\nTest-double-append: g1, g2\nTransfer-Encoding: chunked\nContent-Type: text/plain\n\nxyz\n\n\nExpected:\n\nHTTP/1.1 200 OK\nDate: Tue, 18 May 2010 17:25:41 GMT\nServer: Apache/2.2.14 (Ubuntu)\nTest-set: a2\nTest-append: b1, b2\nTest-edit: xx11\nTest-merge: d1\nTest-add: e1\nTest-add: e2\nTest-double-append: g1, g2\nTransfer-Encoding: chunked\nContent-Type: text/plain\n\nxyz", "id": 136937, "time": "2010-05-18T13:28:53Z", "creator": "apache@misc.lka.org.lu", "creation_time": "2010-05-18T13:28:53Z", "is_private": false}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "text": "IMHO this doesn't sound like a bug but more like a question for the users support mailing list. Have you tried using the header directive outside the .htaccess file in the main configuration?", "id": 136946, "time": "2010-05-19T02:11:13Z", "bug_id": 49308, "creation_time": "2010-05-19T02:11:13Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "Yes, I've also tried it within a <Directory> section in a file in /etc/apache2 : same reaction.", "attachment_id": null, "bug_id": 49308, "id": 136947, "time": "2010-05-19T02:17:40Z", "creator": "apache@misc.lka.org.lu", "creation_time": "2010-05-19T02:17:40Z", "is_private": false}, {"count": 3, "tags": [], "text": "I've run into the same issue,\nI've tried allways with the directives within the config, unsign mod_headers as a module and compiled into httpd, with the same result.\nUsing php on my side.\nIs there any debug option I can enable to provide more information ?\n\nRegards, Pablo", "attachment_id": null, "bug_id": 49308, "id": 136982, "time": "2010-05-20T08:36:10Z", "creator": "malevo@gmail.com", "creation_time": "2010-05-20T08:36:10Z", "is_private": false}, {"count": 4, "tags": [], "creator": "covener@gmail.com", "text": "\"A value of always  may be needed to influence headers set by some internal modules even for successful responses, and is always needed to affect non-2xx  responses such as redirects or client errors.\"\n\nThis is the case for headers set by CGI.", "id": 136984, "time": "2010-05-20T08:59:45Z", "bug_id": 49308, "creation_time": "2010-05-20T08:59:45Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "id": 136986, "time": "2010-05-20T09:14:53Z", "bug_id": 49308, "creation_time": "2010-05-20T09:14:53Z", "is_private": false, "text": "doc updated to emphasize that CGI's are effectively set by one of those internal modules. While technically Apache knows if the CGI returned a 2xx by the time it saves the headers, it always saves them in the \"always\" bucket (err_headers_out)\n\nplease ACK that this resolves the problem"}, {"count": 6, "tags": [], "creator": "apache@misc.lka.org.lu", "text": "Yes, that does indeed solve the problem, thanks.\n\nHeader always edit Cache-control no-cache \"private, max-age=0\"", "id": 136994, "time": "2010-05-20T13:40:42Z", "bug_id": 49308, "creation_time": "2010-05-20T13:40:42Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 49308, "attachment_id": null, "text": "Interestingly enough, when using ProxyPass, the behaviour is just the opposite:\n\nHeader (without always) works, but \"Header always\" doesn't.", "id": 137201, "time": "2010-05-29T08:06:41Z", "creator": "apache@misc.lka.org.lu", "creation_time": "2010-05-29T08:06:41Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 50948, "attachment_id": null, "text": "When a CGI program dies while it is waiting for the client to send its POST data, Apache does not reap the child process and close the connection but instead waits for whatever timeout is configured globally before closing the connection. This seems senseless as there's nothing to be done once the child has exited.\n\nConsider this simple Perl script:\n\n<snip>\n#!/usr/bin/perl\n\n$SIG{ALRM} = sub { die };\nalarm 5;\nsysread STDIN, $data, 4096;\n\nEND {\n  print \"Content-Type: text/plain\\n\\n\";\n  print $data;\n}\n</snip>\n\nand this client request sending all the headers but no body and keeping the connection open:\n\n<snip>\nPOST /test.cgi HTTP/1.1\nHost: localhost\nContent-Length: 10\n\n</snip>\n\nAfter the five seconds timeout the child will hang around as a zombie but the connection is still open.", "id": 145109, "time": "2011-03-19T10:16:12Z", "creator": "zachlutho@mailfish.de", "creation_time": "2011-03-19T10:16:12Z", "is_private": false}, {"count": 1, "tags": [], "creator": "zachlutho@mailfish.de", "attachment_id": null, "is_private": false, "id": 147410, "time": "2011-06-23T17:29:01Z", "bug_id": 50948, "creation_time": "2011-06-23T17:29:01Z", "text": "Ping?"}, {"count": 2, "tags": [], "bug_id": 50948, "text": "mod_cgi does not discover the child has died until it reads or writes from the child's stdout or stdin respectively.  If the client is sending a body, mod_cgi will not write to the stdin until it reads a block from the client.  So, this is expected behaviour, sorry.  (It is a design constraint with httpd filters that it is not possible to wait for I/O across {client connection, pipes to children}.)", "id": 147438, "time": "2011-06-24T08:38:33Z", "creator": "jorton@redhat.com", "creation_time": "2011-06-24T08:38:33Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 50948, "text": "How about allowing apr_bucket_read() to return when interrupted by a signal, i.e. implementing something in between APR_BLOCK_READ and APR_NONBLOCK_READ?", "id": 161284, "time": "2012-08-12T09:15:57Z", "creator": "dabuq@mailfish.de", "creation_time": "2012-08-12T09:15:57Z", "is_private": false, "attachment_id": null}]
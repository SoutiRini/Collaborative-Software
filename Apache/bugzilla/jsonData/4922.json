[{"count": 0, "tags": [], "bug_id": 4922, "text": "When we run Tomcat any version \n(i have tried tomcat 3.2.3, 3.3, 4.0.1)\nwith security turned on\nthe following code yeilds exceptions:\n\n<%=new File(pageContext.getServletContext().getRealPath(\"/\")).exists()%>\n\n<%\njava.io.File tempDir=\n(java.io.File)pageContext.getServletContext(\n).getAttribute(\"javax.servlet.context.tempdir\");\n%>\n<%=tempDir.exists()%>\n\nI beleive this happens because when you grant permissions\nof the form \n\ngrant {\n  permission java.io.FilePermission \"../m/-\", \"read\";\n};\n\nthis does not allow you to check if \n\nnew File(\"../m\").exists()\n\nor do\n\nnew File(\"../m\").list()\n\nto do that you need to explicitly do\n\ngrant {\n  permission java.io.FilePermission \"../m/-\", \"read\";\n  permission java.io.FilePermission \"../m\", \"read\";\n};\n\nThe whole issue causes security exceptions when you deploy\nCocoon2 samples, Velocity samples.\nThey both have code like\n\nFile log = new File(..getRealPath(logFile));\nFile parent = new File( log.getParent() );\nif (!parent.exists()) parent.mkdirs();\n\nno surprise this failes.\n\nI beleive that it would be quite reasonable to allow\nchecking exists() and doing list() on \n..getRealPath(\"/\");\nand the temporary working dir.\n\nI'm duplicating this bug report for 3.3 final and 4.0.1 final", "id": 7991, "time": "2001-11-16T06:00:55Z", "creator": "tagunov@motor.ru", "creation_time": "2001-11-16T06:00:55Z", "is_private": false, "attachment_id": null}, {"text": "This bug has been reported as bug #4923 for Tomcat 3.3 final", "tags": [], "bug_id": 4922, "is_private": false, "count": 1, "id": 7993, "time": "2001-11-16T06:04:35Z", "creator": "tagunov@motor.ru", "creation_time": "2001-11-16T06:04:35Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 4922, "text": "In servlet 2.3 environments, you should also consider using\nServletContext.getResourcePaths() to \"list\" the contents of the WAR directory. \nThis will work even in servlet containers that do not expand your webapp into an\nunpacked directory structure.\n", "id": 8001, "time": "2001-11-16T09:44:30Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-11-16T09:44:30Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 8004, "time": "2001-11-16T10:28:34Z", "bug_id": 4922, "creation_time": "2001-11-16T10:28:34Z", "text": "I'm quite sure I fixed that problem in the HEAD branch (try one of the latest \nnightly builds), by:\n- Canonicalizing all URLs used in permissions or in the class loader\n- Adding back some permissions\n\nThe patches have been ported to the 4.0 branch, but it's a post-4.0.1 fix."}]
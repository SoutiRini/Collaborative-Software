[{"count": 0, "tags": [], "bug_id": 45661, "text": "I have an app which runs an embedded Tomcat with nio connector.\nUsing Sysinternals TcpView to close an socket connection to a localhost port, the process spikes to high CPU usage.\n\nAfter I pause the threads, I find out the NioBlockingSelector.BlockPoller is causing the high CPU. In this code fragment, the selector.select(1000) returns without waiting for 1000ms, but the keyCount is zero.\n\nI don't know why selector.select(1000) returns immediately in this case. Maybe it is bug in Java, but could this function be changed to prevent the looping in this case?\n\n        public void run() {\n            while (run) {\n                try {\n                    events();\n                    int keyCount = 0;\n                    try {\n                        int i = wakeupCounter.get();\n                        if (i>0) \n                            keyCount = selector.selectNow();\n                        else {\n                            wakeupCounter.set(-1);\n                            keyCount = selector.select(1000);\n                        }", "id": 119962, "time": "2008-08-20T13:44:50Z", "creator": "akwyu@rogers.com", "creation_time": "2008-08-20T13:44:50Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 45661, "text": "Yes, there is a known bug in the JDK causing this, and the only workaround is to close the selector, something that makes code inherently complicated, so we don't do it.\n\nhowever, sun said that they fixed it in the last 1.6 release\n\ntry that one, let us know if it is fixed there\n\nbest\nFilip", "id": 120001, "time": "2008-08-21T14:55:54Z", "creator": "fhanik@apache.org", "creation_time": "2008-08-21T14:55:54Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 45661, "text": "I am using the latest JDK 1.6.0_07 already and the problem still exists.", "id": 120042, "time": "2008-08-22T21:01:11Z", "creator": "akwyu@rogers.com", "creation_time": "2008-08-22T21:01:11Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "fhanik@apache.org", "text": "Ok,then I will take a look and see what can be done.\n\nthanks for the info,\nFilip", "count": 3, "id": 120102, "time": "2008-08-26T05:54:41Z", "bug_id": 45661, "creation_time": "2008-08-26T05:54:41Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 45661, "text": "I tried to JDK versions on Win XP 32bit.\n\nsun java version \"1.5.0_10\"\nsun java version \"1.6.0_07\"\n\nAnd I wasn't able to reproduce the problem at all.\n\nI tried both connections that were inside of a request, and connections not sent any data yet(registered for an operation) and in either case I don't get any CPU usage\n\nbest\nFilip", "id": 120223, "time": "2008-08-29T17:45:20Z", "creator": "fhanik@apache.org", "creation_time": "2008-08-29T17:45:20Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 45661, "is_private": false, "text": "Hi,\nI still reproduce this error with these conditions :\n\n- Tomcat 7.0.14\n- Linux 2.6\n- java version \"1.6.0_37\"\n\nI don't think this issue must be closed with the status RESOLVED WORKSFORME\n\n\nGreetings,\nSergio", "id": 166031, "time": "2013-03-20T11:39:39Z", "creator": "sergio.garcia@m-centric.com", "creation_time": "2013-03-20T11:39:39Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 45661, "attachment_id": null, "is_private": false, "id": 166032, "time": "2013-03-20T12:02:48Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2013-03-20T12:02:48Z", "text": "No,\n1. you are reproducing a different error on a different OS.\n2. your report is irrelevant, there have been many fixes since 7.0.14.\nThe current version of Tomcat 7 is 7.0.37."}]
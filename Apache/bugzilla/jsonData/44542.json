[{"count": 0, "tags": [], "creator": "rusoloco@gmail.com", "is_private": false, "id": 114296, "creation_time": "2008-03-05T10:58:45Z", "time": "2008-03-05T10:58:45Z", "bug_id": 44542, "text": "Created attachment 21629\nthis file open ok in excel and openoffice\n\nHi:\n\nI code to generate excel files  using PO API , I've got the file OK and the most rare thing is that file is be able to open with openoffice  but with  Excel microsoft version 2000, 2003 and 2007, it can't.\n\nWhen i tried to open the file excel said that the file is so damaged that it has to be repair, when you see the file repaired the only thing that is not as original file is the second row, that have the titles of the next rows.\n\nThis problem only happen when the sheet have more > 100 rows  or when in one cell, have a lot of characters \n\n\nI attached three examples files.\n\nIs there something wrong in files that produce this error ?\n\nThanks", "attachment_id": 21629}, {"count": 1, "tags": [], "creator": "rusoloco@gmail.com", "text": "Created attachment 21630\nthis file can\u00b4t open correctly in excel it was many rows in sheet 205", "id": 114297, "time": "2008-03-05T11:00:21Z", "bug_id": 44542, "creation_time": "2008-03-05T11:00:21Z", "is_private": false, "attachment_id": 21630}, {"count": 2, "tags": [], "creator": "rusoloco@gmail.com", "is_private": false, "text": "Created attachment 21631\nthis file in sheet 201 in cell B2 have a lot of words than excel can\u00b4t open", "id": 114298, "time": "2008-03-05T11:02:19Z", "bug_id": 44542, "creation_time": "2008-03-05T11:02:19Z", "attachment_id": 21631}, {"count": 3, "tags": [], "creator": "josh@apache.org", "text": "I tried to open in Excel 2007, and both files give this message box:\n\"Excel found unreadable content in 'MuchtextInOneCell.xls'. Do you want to recover the contents of this workbook? If you trust the source of this workbook, click Yes.\"\n\nI guess it's the same as the behaviour from 2003 (so I changed this bug's summary).\n\n\nIt would help greatly in solving this bug if you could send a small example of code that reproduces files with this characteristic.  If you are not sure how to do this, start with the code you have, and keep cutting out bits and pieces while making sure that the bugs still occur.  Hopefully you can get it down below 100 lines of code or so.\n", "id": 114300, "time": "2008-03-05T11:23:46Z", "bug_id": 44542, "creation_time": "2008-03-05T11:23:46Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 44542, "is_private": false, "id": 114301, "attachment_id": 21632, "creator": "rusoloco@gmail.com", "creation_time": "2008-03-05T12:51:26Z", "time": "2008-03-05T12:51:26Z", "text": "Created attachment 21632\nthis is a extract of the code that build the excel file, error are omitted\n\nThis is a part of the code, \nit takes data for maps and put this data in rows or colums depending in number of the dataDTO\n\nI ommited the part in which depending of the type of object it set the type of cell, because is a large switch case \n\n\nhope this can help to figurate out the problem , and the funny thing that openoffice can open this file.\n\ngreetings"}, {"count": 5, "tags": [], "creator": "josh@apache.org", "text": "Sorry, the code you attached is not quite what I meant.  \nIt still has references to other things:\n\nCampoDTO cannot be resolved to a type\nDataDTO cannot be resolved to a type\nFormatoDTO cannot be resolved to a type\nMetadatosService cannot be resolved to a type\nMetadatosUtil cannot be resolved\nResultadoDTO cannot be resolved to a type\nTipoDatoConstants cannot be resolved\n\nBetter than sending all of that stuff, replace them with in the example with whatever simple alternative that makes the code still produce the bad XLS files.\n\nMake a static void main(String[]) method, and make this class depend on nothing but POI.\n\nSorry about the extra trouble, but this is probably a faster path to identifying the bug (unless someone knows an easy way to diagnose exactly how the attached XML files break the BIFF spec).\n", "id": 114309, "time": "2008-03-05T15:09:05Z", "bug_id": 44542, "creation_time": "2008-03-05T15:09:05Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "rusoloco@gmail.com", "text": "Created attachment 21634\nsimple test to write random data to excel file\n\nthis is a fast code from original code, trying to reproduce the corrupt file \nyou have to put two parameters the number of sheets and number of rows, to reproduce the error you have to put a lot of rows", "id": 114317, "time": "2008-03-05T18:55:21Z", "bug_id": 44542, "creation_time": "2008-03-05T18:55:21Z", "is_private": false, "attachment_id": 21634}, {"count": 7, "tags": [], "bug_id": 44542, "is_private": false, "id": 114320, "attachment_id": null, "creator": "josh@apache.org", "creation_time": "2008-03-05T21:00:23Z", "time": "2008-03-05T21:00:23Z", "text": "(In reply to comment #6)\n> Created an attachment (id=21634) [details]\n> simple test to write random data to excel file\n> this is a fast code from original code, trying to reproduce the corrupt file \n> you have to put two parameters the number of sheets and number of rows, to\n> reproduce the error you have to put a lot of rows \n\nOne more thing - in addition to reproducing the error, the code has to also compile and run.\n\nThe code you sent is a long way from running.  There are mismatched brackets (which I can't fix easily because the indenting is all wrong).  Once I got it executing, I got a ClassCastException from this expression: (Map<String, Object>) formato.get(\"data\");\n\nThere are all sorts of apparent errors where the code keeps updating a map with the same key and value (map only gets one entry) or the same map instance is added to a list many times.\n\nAfter attempting to fix all of this I ran the code with (hojas=1000, renglones=256) and  the spreadsheet still opened in Excel OK.  Perhaps my fixes obliterated some important part of the code.\n\n\nI'm sorry if this is tedious, but it really helps to have some example code that allows other people to easily reproduce your error.  Can you please re-attach the example class after making sure that it actually compiles, runs, and reproduces the error."}, {"count": 8, "attachment_id": null, "bug_id": 44542, "text": "1. I can't reproduce it either. I created a test based on the attached code and it produces correct XLS files.\n\nWhat is strange to me is that the generated XLS is just data. There are no rich text, formulas, graphics, any of advanced XLS/POI features, etc. \nI can't see why POI would produce wrong output. \n\n2. If I try to read any of the problem files in POI I get the same exception:\n\nException in thread \"main\" org.apache.poi.hssf.record.RecordFormatException: Unable to construct record instance\n\tat org.apache.poi.hssf.record.RecordFactory.createRecord(RecordFactory.java:204)\n\tat org.apache.poi.hssf.record.RecordFactory.createRecords(RecordFactory.java:122)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:204)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:256)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:237)\n\tat org.apache.poi.hssf.scratchpad.Test44542.main(Test44542.java:47)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat com.intellij.rt.execution.application.AppMain.main(Unknown Source)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:494)\n\tat org.apache.poi.hssf.record.RecordFactory.createRecord(RecordFactory.java:192)\n\t... 10 more\nCaused by: java.lang.NegativeArraySizeException\n\tat java.lang.AbstractStringBuilder.<init>(AbstractStringBuilder.java:44)\n\tat java.lang.StringBuffer.<init>(StringBuffer.java:92)\n\tat org.apache.poi.hssf.record.UnicodeString.fillFields(UnicodeString.java:225)\n\tat org.apache.poi.hssf.record.UnicodeString.<init>(UnicodeString.java:115)\n\tat org.apache.poi.hssf.record.SSTDeserializer.manufactureStrings(SSTDeserializer.java:49)\n\tat org.apache.poi.hssf.record.SSTRecord.fillFields(SSTRecord.java:364)\n\tat org.apache.poi.hssf.record.Record.<init>(Record.java:55)\n\tat org.apache.poi.hssf.record.SSTRecord.<init>(SSTRecord.java:101)\n\t... 15 more\n\n\nSo, if it is a POI bug it might be related to SSTRecord. \n\nYegor", "id": 114338, "time": "2008-03-06T07:15:39Z", "creator": "yegor@dinom.ru", "creation_time": "2008-03-06T07:15:39Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "text": "Created attachment 21645\na working test to create multiple sheets \n\nSorry  about last code, this code is fully operational, with this test the memory is exausted, but i can't reproduce the wrong files i make atest wtih 250 rows and 100 sheets but these are only strings cells \n\nmaybe the problem is when i'm setting multiple cells formats in each sheet \n\n\ngreetings", "is_private": false, "id": 114392, "creator": "rusoloco@gmail.com", "time": "2008-03-06T17:33:21Z", "bug_id": 44542, "creation_time": "2008-03-06T17:33:21Z", "attachment_id": 21645}]
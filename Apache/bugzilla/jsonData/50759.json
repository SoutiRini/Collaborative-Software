[{"count": 0, "tags": [], "bug_id": 50759, "text": "When using a custom validator (48817), after the first validation event occurs, every subsequent query on the connection results in the Validator being run.  I believe this is due to the lastValidated timestamp not being set when the Validator class is run:\n\nhttp://svn.apache.org/viewvc/tomcat/tags/JDBC_POOL_1_0_9_3/java/org/apache/tomcat/jdbc/pool/PooledConnection.java?revision=1061025&view=markup  (lines 419-420)\n\npublic boolean validate(int validateAction,String sql) {\n\n   ...\n   if (poolProperties.getValidator() != null) {\n            return poolProperties.getValidator().validate(connection, validateAction);\n   }\n   ....\n}\n\n\nmaybe should be:\n\npublic boolean validate(int validateAction,String sql) {\n\n   ...\n   if (poolProperties.getValidator() != null) {\n            boolean val = poolProperties.getValidator().validate(connection, validateAction);\n            this.lastValidated = now;\n            return val;\n   }\n   ....\n}\n\n\n/dom", "id": 144165, "time": "2011-02-10T19:12:21Z", "creator": "dominic.tootell@gmail.com", "creation_time": "2011-02-10T19:12:21Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "chuck.caldarale@unisys.com", "attachment_id": null, "id": 144167, "time": "2011-02-10T21:22:34Z", "bug_id": 50759, "creation_time": "2011-02-10T21:22:34Z", "is_private": false, "text": "Might want to set lastValidated only when the validate() method returns true:\n\n    if (val) lastValidated = now;"}, {"count": 2, "tags": [], "creator": "fhanik@apache.org", "text": "Thanks for the report.\nFixed in r1069864", "id": 144201, "time": "2011-02-11T11:32:55Z", "bug_id": 50759, "creation_time": "2011-02-11T11:32:55Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "The function cgi_read_stdout() in mod_cgi allocates unnecessary amounts of memory. For every call of apr_file_read(), APR_BUCKET_BUFF_SIZE (currently 8000) bytes of memory are allocated, even when apr_file_read() delivers only a fraction of the requested amount of data. In practice, this can lead to hugely inflated httpd processes. The attached patch reduces this problem by allocating only as much memory as necessary.", "is_private": false, "id": 136811, "creator": "ak@synflood.at", "time": "2010-05-12T09:24:05Z", "bug_id": 49276, "creation_time": "2010-05-12T09:24:05Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "ak@synflood.at", "text": "Created attachment 25431\npatch to reduce memory usage of mod_cgi.", "id": 136812, "time": "2010-05-12T09:24:59Z", "bug_id": 49276, "creation_time": "2010-05-12T09:24:59Z", "is_private": false, "attachment_id": 25431}, {"count": 2, "tags": [], "bug_id": 49276, "attachment_id": null, "is_private": false, "id": 136834, "time": "2010-05-13T08:10:57Z", "creator": "sf@sfritsch.de", "creation_time": "2010-05-13T08:10:57Z", "text": "Your patch causes all output from the cgi to be copied again, which is not really efficient.\n\nBesides, the memory of the bucket should be freed as soon as the data has been sent over the network. I guess what you are really seeing is one of the memory usage issues fixed in r821471 in trunk.\n\nYou could try if the content_length_filter and chunk_filter parts of r821471 fix your problem. It's\n\nhttp://svn.apache.org/viewvc/httpd/httpd/trunk/modules/http/chunk_filter.c?r1=821471&r2=821470&pathrev=821471\n\nand the first three hunks of\n\nhttp://svn.apache.org/viewvc/httpd/httpd/trunk/server/protocol.c?r1=821471&r2=821470&pathrev=821471\n\n\nI haven't checked if it applies cleanly to 2.2.x, though."}, {"attachment_id": null, "tags": [], "bug_id": 49276, "text": "The memory usage of mod_cgi is constant in trunk, even if the cgi streams large amounts of data.", "count": 3, "id": 147179, "time": "2011-06-15T23:13:03Z", "creator": "sf@sfritsch.de", "creation_time": "2011-06-15T23:13:03Z", "is_private": false}, {"count": 4, "tags": [], "text": "2.4.1 is released, closing.\nIf you find additional issues in 2.4.x, please re-open.", "is_private": false, "id": 154234, "creator": "sf@sfritsch.de", "time": "2012-02-26T17:04:20Z", "bug_id": 49276, "creation_time": "2012-02-26T17:04:20Z", "attachment_id": null}]
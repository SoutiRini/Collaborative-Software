[{"count": 0, "tags": [], "bug_id": 61546, "attachment_id": 35340, "id": 200995, "time": "2017-09-20T11:36:54Z", "creator": "luhliari@redhat.com", "creation_time": "2017-09-20T11:36:54Z", "is_private": false, "text": "Created attachment 35340\nPatch fixing this issue\n\nmod_authz_dbd segfaults when AuthzDBDQuery is missing in httpd configuration. \n\n<Location /moria>\n  AuthName \"The Mines of Moria\"\n  AuthType Basic\n  AuthBasicProvider dbd\n  AuthDBDUserPWQuery \"SELECT password FROM users WHERE username = %s\"\n  Require dbd-group istari\n  #AuthzDBDQuery \"SELECT groupname FROM groups WHERE username = %s\"\n</Location>\n\n\nSince AuthzDBDQuery is not set, authz_dbd_prepare is not called and therefore dbd_handle remains NULL.\n\n\nThis causes segmentation fault, if authz_dbd_login or authz_dbd_group_query functions are triggered, because in the variable initialization is this code:\n\nap_dbd_t *dbd = dbd_handle(r);\n\nI moved it after check, if cfg->query is NULL."}, {"attachment_id": null, "tags": [], "bug_id": 61546, "text": "Thanks for the report and patch.\n\nFixed in trunk in r1809209.\nSome small tweaks added (some extra blank lines and no need to initialize dbd to NULL)", "count": 1, "id": 201057, "time": "2017-09-21T19:32:10Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2017-09-21T19:32:10Z", "is_private": false}]
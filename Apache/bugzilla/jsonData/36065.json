[{"count": 0, "tags": [], "bug_id": 36065, "is_private": false, "text": "Overview Description:\n  Under windows XP a cgi script sends local image data to the server.\n  The server fails to send this to the browser.\n\nSteps to Reproduce:\n1) make a new directory images/ in the cgi-bin directory\n\n2) put an image in the new directory (eg. ..../cgi-bin/images/logo.png)\n\n3) put this lua script in the cgi-bin directory. call it 'image-script'\n\n#!c:\\Program Files\\Lua\\BIN\\lua\n-- note: this script needs a working lua environment\ndo\n  local raw=os.getenv(\"QUERY_STRING\") -- info from GET request. ie url?info\n  local file=io.open('images/'..raw,'r')\n  if file then\n    local data=file:read('*all') file:close()\n    io.write('Content-type: image/jpg\\n\\n')\n    io.write(data)\n  end\nend\n\n4) make a web page that calls the script using this tag:\n<img src=\"http://localhost/cgi-bin/image-script?logo.png\">\n\nActual Results:\n  Under windows xp, the image isn't passed by the server.\n  The access.log contains \"GET /cgi-bin/image-script?logo.png HTTP/1.1\" 200 6\n  so the server isn't passing on the data it recieves. \n  The error.log reports no errors.\n\nExpected Results:\n  I expect it to work the same as under debian-linux with Apache/1.3.33.\n(the data should be passed to the browser, which should then display an image)\n\nBuild Date & Platform:\n  Build 2.0.54 on Windows XP sp2\n\nAdditional Builds and Platforms:\n  - Also Occurs On\n\n  - Doesn't Occur On\n  Apache 1.3.33 on Debian-Linux-ppc 2.4.20", "id": 78199, "time": "2005-08-07T19:30:09Z", "creator": "michael.stirling@gmail.com", "creation_time": "2005-08-07T19:30:09Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "nd@perlig.de", "text": "So I guess the seventh byte is the CP/M EOF character (ascii 26). You're missing\nto set the output stream to binary (it's text by default). I have no idea, how\nthis is done in lua, though.", "id": 78200, "time": "2005-08-07T19:35:57Z", "bug_id": 36065, "creation_time": "2005-08-07T19:35:57Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 36065, "attachment_id": null, "text": "Thanks for your comment Andr\u00e9. I have limited experience with windows and your\nsuggestion was spot on; it works nicely when a binary flag is added. Seems to be\noutside the scope of Apache to influence - I'm sorry I ascribed windows quirks\nto this project.", "id": 78212, "time": "2005-08-08T05:37:52Z", "creator": "michael.stirling@gmail.com", "creation_time": "2005-08-08T05:37:52Z", "is_private": false}]
[{"count": 0, "text": "I have a requirement to add image to header of a word document file (.docx) \nI tried using the available API methods to do so (passed inputstream of image and XWPFDocument for both but none of the two approaches worked):\n\nApproach1:\n------------\nXWPFHeaderFooterPolicy headerFooterPolicy = document\n\t                .getHeaderFooterPolicy();\nXWPFHeader defaultHeader = headerFooterPolicy.getDefaultHeader();\ndefaultHeader.getParagraphs().get(0).getRuns().get(0).addPicture(is, Document.PICTURE_TYPE_JPEG, \"test.jpg\", 100, 100);\n\nApproach 2:\n-----------\nCTP ctp = CTP.Factory.newInstance();\nCTR ctr = ctp.addNewR();\nCTRPr rpr = ctr.addNewRPr();\nXWPFParagraph imagePara = new XWPFParagraph(ctp, document);\nimagePara.createRun().addPicture(is, Document.PICTURE_TYPE_JPEG, \"test.jpg\", 50, 50);\n\t        XWPFParagraph[] imaheparagraphs = new XWPFParagraph[1];\n\t        imaheparagraphs[0]=imagePara;\n\t        headerFooterPolicy.createHeader( STHdrFtr.DEFAULT,imaheparagraphs);\n\nI am able to add an image to body but not able to find a way to do the same to the header even though POI has methods that suggest that it should.\n\nThanks.", "bug_id": 58237, "attachment_id": null, "id": 184493, "time": "2015-08-12T12:17:53Z", "creator": "nishant.noida79@gmail.com", "creation_time": "2015-08-12T12:17:53Z", "tags": [], "is_private": false}, {"count": 1, "text": "Can you define \"didn't work\"? Logged a problem? Got an exception? Added a different picture? Added it, but upsidedown / only greyscale / some other image problem? Made your pet cat sad? Ran without error, but POI couldn't then read it back? POI could read it, but couldn't see the image? POI was fine with it, but Word gave an error? And if so what? POI was happy, but Word crashed? Other?", "creator": "apache@gagravarr.org", "is_private": false, "id": 184496, "time": "2015-08-12T12:29:22Z", "bug_id": 58237, "creation_time": "2015-08-12T12:29:22Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 58237, "attachment_id": null, "is_private": false, "id": 184497, "time": "2015-08-12T12:34:11Z", "creator": "nishant.noida79@gmail.com", "creation_time": "2015-08-12T12:34:11Z", "text": "There was no exception thrown in either of the cases. The modified/saved word document simply didn't have the image in the header."}, {"count": 3, "tags": [], "bug_id": 58237, "attachment_id": null, "is_private": false, "id": 184499, "time": "2015-08-12T12:38:04Z", "creator": "apache@gagravarr.org", "creation_time": "2015-08-12T12:38:04Z", "text": "If you save and re-load the file with POI, can POI see the image in the header?"}, {"count": 4, "tags": [], "creator": "nishant.noida79@gmail.com", "attachment_id": null, "id": 184539, "time": "2015-08-13T08:26:38Z", "bug_id": 58237, "creation_time": "2015-08-13T08:26:38Z", "is_private": false, "text": "Tried reading back the header after saving but dont get any image through .getPicturesTable()"}, {"count": 5, "text": "Looks like there's a bug, and the picture wasn't ending up on the right part when added from a run. I've hopefully fixed this in r1695772.\n\nThe new test TestXWPFPictureData.testCreateHeaderPicture() verifies that a picture can be added to a header, seen on the header, and still be found there after a save and re-load. \n\nAny chance you could do a build from svn / get a new enough nightly build / wait for 3.13 beta 2, then confirm if that has solved it completely?", "creator": "apache@gagravarr.org", "attachment_id": null, "id": 184555, "time": "2015-08-13T20:25:56Z", "bug_id": 58237, "creation_time": "2015-08-13T20:25:56Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 58237, "attachment_id": null, "is_private": false, "id": 185685, "time": "2015-10-07T10:16:07Z", "creator": "onealj@apache.org", "creation_time": "2015-10-07T10:16:07Z", "text": "Related open bugs:\nbug 53309 - similar request for XSSFWorkbooks\nbug 46704 - similar request for HSSFWorkbooks\nbug 58422 - similar request for SXSSFWorkbooks"}, {"count": 7, "tags": [], "text": "Have tried testing with 3.13 but it still doesn't work.\n\nBelow is the code I am using\n\n\t\t     FileInputStream stream=new FileInputStream(new File(\"D:/PNL.docx\"));\n\t\t     XWPFDocument document=new XWPFDocument(stream);\n\t\t     XWPFHeaderFooterPolicy policy = document.getHeaderFooterPolicy();\n\t\t     XWPFHeader defaultHeader = policy.getDefaultHeader();\n\t\t     \t\t     \n\t\t     defaultHeader.addPictureData(new FileInputStream(new File(\"D:/logo/xyz.jpg\")), Document.PICTURE_TYPE_JPEG);\n\nbut it doesnt update the image in the document file. The document remains as such with no modification.\n\nThis is returning size of 1:\n\n\t\t     List<XWPFPictureData> pictures = defaultHeader.getAllPictures();\n\t\t     System.out.println(pictures.size());\n\nPlease help validate the code.", "is_private": false, "bug_id": 58237, "id": 186423, "time": "2015-11-17T14:45:09Z", "creator": "nishant.noida79@gmail.com", "creation_time": "2015-11-17T14:45:09Z", "attachment_id": null}, {"count": 8, "text": "Any updates on the above issue please? Please let me know if there is an alternate to updating/inserting image in header of a word document.", "bug_id": 58237, "is_private": false, "id": 191523, "time": "2016-06-10T09:58:13Z", "creator": "nishant.noida79@gmail.com", "creation_time": "2016-06-10T09:58:13Z", "tags": [], "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 58237, "attachment_id": null, "is_private": false, "id": 191524, "time": "2016-06-10T10:04:07Z", "creator": "apache@gagravarr.org", "creation_time": "2016-06-10T10:04:07Z", "text": "If you can write a junit unit test, which shows the issue, that would be a big help for us in understanding what's wrong + trying to fix it\n\n(Last year I added TestXWPFPictureData.testCreateHeaderPicture() which covers at least some of the use case, so if there's more still wrong then we need another unit test to show the problem!)"}, {"count": 10, "tags": [], "creator": "bilgehanm@gmail.com", "attachment_id": null, "text": "Had the same problem, it was fixed in 3.13 but with 3.15 appear again.", "id": 194927, "time": "2016-11-11T12:17:47Z", "bug_id": 58237, "creation_time": "2016-11-11T12:17:47Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 58237, "is_private": false, "text": "(In reply to Bilgehan from comment #10)\n> Had the same problem, it was fixed in 3.13 but with 3.15 appear again.\n\nPlease attach a minimal document that shows the problem, and if you can a unit test. this will help us work through the issue.", "id": 194933, "time": "2016-11-11T20:50:52Z", "creator": "jmarkmurphy@apache.org", "creation_time": "2016-11-11T20:50:52Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 58237, "attachment_id": null, "is_private": false, "id": 195234, "time": "2016-11-26T19:14:36Z", "creator": "carlo.sciolla@gmail.com", "creation_time": "2016-11-26T19:14:36Z", "text": "Bumped into the same issue here. Not sure how to create a unit test to show the issue, as I'm not familiar with POI codebase. But I believe this guy did a fairly thorough analysis including code pointers that should give you enough details:\n\nhttp://stackoverflow.com/a/35103749/350923"}, {"count": 13, "tags": [], "bug_id": 58237, "attachment_id": null, "is_private": false, "id": 195423, "time": "2016-12-09T12:00:17Z", "creator": "nicola.isotta@gmail.com", "creation_time": "2016-12-09T12:00:17Z", "text": "Hopefuly I'm adding the necessary infos.\n\nHere's the class I used to generate the docx: http://pastebin.com/UT4RS8ah\n\nHere's a link to the generated .docx: https://drive.google.com/file/d/0B2TPcgQDtWuiM0VJZEs5ZVFFdlE/view?usp=sharing\n\nI don't know how to write a Unit Test for this problem but I hope the files I provided together with the infos from the stackoverflow thread can help track down the problem."}, {"count": 14, "tags": [], "creator": "jmarkmurphy@apache.org", "attachment_id": null, "is_private": false, "id": 195425, "time": "2016-12-09T13:04:14Z", "bug_id": 58237, "creation_time": "2016-12-09T13:04:14Z", "text": "I believe the issue is in XWPFRun.addPicture(...)\n\nThis block of code:\n\n            CTBlipFillProperties blipFill = pic.addNewBlipFill();\n            CTBlip blip = blipFill.addNewBlip();\n            blip.setEmbed(parent.getDocument().getRelationId(picData));\n            blipFill.addNewStretch().addNewFillRect();\n\nretrieves the main document rather than the document part containing the image, and attempts to retrieve the relation id from that. This works when the image is in the main document, but not when the image is in another part such as a header or footer. In fact, the missing element in the header and footer is the relation ID. I believe I can write some unit tests to prove this out."}, {"count": 15, "tags": [], "bug_id": 58237, "attachment_id": null, "id": 195448, "time": "2016-12-12T02:46:04Z", "creator": "jmarkmurphy@apache.org", "creation_time": "2016-12-12T02:46:04Z", "is_private": false, "text": "fixed r1773729"}, {"count": 16, "text": "Created attachment 34517\nmylyn/context/zip", "bug_id": 58237, "is_private": false, "id": 195449, "time": "2016-12-12T02:46:06Z", "creator": "jmarkmurphy@apache.org", "creation_time": "2016-12-12T02:46:06Z", "tags": [], "attachment_id": 34517}]
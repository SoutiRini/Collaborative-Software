[{"count": 0, "tags": [], "bug_id": 3499, "attachment_id": null, "text": "Due to the file seperator char on Windows OS, the url-pattern for the servlet-\nmapping in the web.xml file generated by JspC contains '\\' characters instead \nof '/'.  Since the url-pattern does not match the url requested by the browser, \nTomcat is unable to map to the pre-compiled JSP servlet class. \n\n-----------------------------------------------------------------------\nExample web.xml file generated by JspC using the -webxml option\n-----------------------------------------------------------------------\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n\n<!DOCTYPE web-app\n    PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.2//EN\"\n    \"http://java.sun.com/j2ee/dtds/web-app_2_2.dtd\">\n<!--\nAutomatically created by Tomcat JspC.\n-->\n<web-app>\n\n\t<servlet>\n\t\t<servlet-name>HelloWorld</servlet-name>\n\t\t<servlet-class>HelloWorld</servlet-class>\n\t</servlet>\n\n\t<servlet-mapping>\n\t\t<url-pattern>\\HelloWorld.jsp</url-pattern>\n\t\t<servlet-name>HelloWorld</servlet-name>\n\t</servlet-mapping>\n\n</web-app>", "id": 5210, "time": "2001-09-07T10:53:07Z", "creator": "blakest@diebold.com", "creation_time": "2001-09-07T10:53:07Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 3499, "is_private": false, "id": 5212, "time": "2001-09-07T11:02:58Z", "creator": "blakest@diebold.com", "creation_time": "2001-09-07T11:02:58Z", "tags": [], "text": "[PATCH] Fixes servlet-mapping in web.xml file generated by JspC using the -\nwebxml and -webinc options.\n\nThis patch fixes the following bug reports. Testing on Windows 2000 w/ SP2, JDK \n1.3.1, and jakarta-tomcat-4.0-20010906.\n\nweb.xml file generated by JspC is not valid as defined by DTD.\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=3474\n\nInvalid url-pattern for servlet-mapping in web.xml file generated by JspC on \nWindows OS.\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=3499\n\n---------------------------------------------------------------------- \n\ncvs diff -u D:/Tomcat4-cvs/jakarta-tomcat-\n4.0/jasper/src/share/org/apache/jasper/JspC.java \nIndex: D:/Tomcat4-cvs/jakarta-tomcat-\n4.0/jasper/src/share/org/apache/jasper/JspC.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\n4.0/jasper/src/share/org/apache/jasper/JspC.java,v\nretrieving revision 1.8\ndiff -u -r1.8 JspC.java\n--- D:/Tomcat4-cvs/jakarta-tomcat-\n4.0/jasper/src/share/org/apache/jasper/JspC.java\t2001/02/04 01:03:42\n\t1.8\n+++ D:/Tomcat4-cvs/jakarta-tomcat-\n4.0/jasper/src/share/org/apache/jasper/JspC.java\t2001/09/07 16:46:10\n@@ -400,11 +400,11 @@\n                 servletout.write(\"</servlet-class>\\n\\t</servlet>\\n\");\n             }\n             if (mappingout != null) {\n-                mappingout.write(\"\\n\\t<servlet-mapping>\\n\\t\\t<url-pattern>\");\n-                mappingout.write(file);\n-                mappingout.write(\"</url-pattern>\\n\\t\\t<servlet-name>\");\n+                mappingout.write(\"\\n\\t<servlet-mapping>\\n\\t\\t<servlet-name>\");\n                 mappingout.write(thisServletName);\n-                mappingout.write(\"</servlet-name>\\n\\t</servlet-mapping>\\n\");\n+                mappingout.write(\"</servlet-name>\\n\\t\\t<url-pattern>\");\n+                mappingout.write(file.replace('\\\\', '/'));\n+                mappingout.write(\"</url-pattern>\\n\\t</servlet-mapping>\\n\");\n             }\n             return true;\n         } catch (JasperException je) {\n\n*****CVS exited normally with code 1*****"}, {"count": 2, "tags": [], "bug_id": 3499, "attachment_id": null, "text": "Fixed in nightly build 20010908.\n", "id": 5213, "time": "2001-09-07T11:08:40Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-09-07T11:08:40Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 3499, "attachment_id": null, "text": "Forgot to mark it fixed.\n", "id": 5214, "time": "2001-09-07T11:09:12Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-09-07T11:09:12Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 3499, "attachment_id": null, "text": "I don't think the change you made fixes what I described in Bug #3499, which \ndeals with the file separator character on the Windows OS is being used instead \nof the '/' character as used in a URL.  That is why I called \"replace\n('\\\\', '/')\" on the string representing the JSP filename for the url-pattern.\n\nHere is the patch for 3499 to revision 1.9\n\n------------------------------------------------------------------------------\n\ncvs diff -u JspC.java (in directory D:\\Tomcat4-cvs\\jakarta-tomcat-4.0\n\\jasper\\src\\share\\org\\apache\\jasper)\nIndex: JspC.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\n4.0/jasper/src/share/org/apache/jasper/JspC.java,v\nretrieving revision 1.9\ndiff -u -r1.9 JspC.java\n--- JspC.java\t2001/09/07 17:57:46\t1.9\n+++ JspC.java\t2001/09/07 18:32:56\n@@ -403,7 +403,7 @@\n                 mappingout.write(\"\\n\\t<servlet-mapping>\\n\\t\\t<servlet-name>\");\n                 mappingout.write(thisServletName);\n                 mappingout.write(\"</servlet-name>\\n\\t\\t<url-pattern>\");\n-                mappingout.write(file);\n+                mappingout.write(file.replace('\\\\', '/'));\n                 mappingout.write(\"</url-pattern>\\n\\t</servlet-mapping>\\n\");\n \n             }\n\n*****CVS exited normally with code 1*****\n", "id": 5215, "time": "2001-09-07T11:39:08Z", "creator": "blakest@diebold.com", "creation_time": "2001-09-07T11:39:08Z", "is_private": false}, {"count": 5, "tags": [], "text": "You are absolutely right ... sorry about that :-(\n\nSecond time should be good, though.\n", "is_private": false, "bug_id": 3499, "id": 5218, "time": "2001-09-07T11:55:57Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-09-07T11:55:57Z", "attachment_id": null}]
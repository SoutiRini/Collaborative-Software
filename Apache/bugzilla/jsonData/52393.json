[{"count": 0, "tags": [], "creator": "qiuyunzhong@hotmail.com", "text": "I upgrade my tomcat from 7.0.12 to 7.0.22 for my Myfaces web application. Here is all related apps' version.\ntomcat: 7.0.22\nMyfaces: 1.2.9\nSpring: 3.6\nOs: Cent OS 5.4/Ubuntu 11/ Windows\nJRE:1.6.0.30/1.6.0.24\nScenario: My application runs smooth for more than one months on tomcat 7.0.12. Due to security consern, I upgrade tomcat to 7.0.22. At first, it seems everything is ok. However, there is a jsp page using Myfaces' datatable components. Once I submit the datatable to back bean. It throws a ClassCastException, which always says that a MyClass could not be casted to List<MyClass>. After traced the code step by step, I found it's caused by MapElResolver.getType(ELContext context, Object base, Object property). Here is the 7.0.22 version implementation:\n public Class<?> getType(ELContext context, Object base, Object property)\n            throws NullPointerException, PropertyNotFoundException, ELException {\n        if (context == null) {\n            throw new NullPointerException();\n        }\n\n        if (base instanceof Map<?,?>) {\n            context.setPropertyResolved(true);\n            return Object.class;\n        }\n        \n        return null;\n    }\nIn fact, in version 7.0.12 the implementation is:\n\npublic Class<?> getType(ELContext context, Object base, Object property)\n            throws NullPointerException, PropertyNotFoundException, ELException {\n        if (context == null) {\n            throw new NullPointerException();\n        }\n\n        if (base instanceof Map<?,?>) {\n            context.setPropertyResolved(true);\n            Object obj = ((Map<?,?>) base).get(property);\n            return (obj != null) ? obj.getClass() : null;\n        }\n        \n        return null;\n    }\n\nYou see, in the new version, it doesn't return the value of Map's specific type, but only the base Object type. \nThis effects org.apache.myfaces.component.html.ext.updateModelFromPreservedDataModel.updateModelFromPreservedDataModel(FacesContext context) to only get the first element of the list to set to its back bean's attribute and finally leads to ClassCastException.\nNot sure why change the getType method and it definitely not the correct function.\nThanks a lot.", "id": 152440, "attachment_id": null, "bug_id": 52393, "creation_time": "2011-12-28T11:26:13Z", "time": "2011-12-28T11:26:13Z", "is_private": false}, {"count": 1, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "The current implementation adheres to the Specification and is a fix for bug 51177.\n\nSee specification fragment cited in\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=51177#c0", "id": 152441, "attachment_id": null, "bug_id": 52393, "creation_time": "2011-12-28T12:31:12Z", "time": "2011-12-28T12:31:12Z", "is_private": false}]
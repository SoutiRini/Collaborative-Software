[{"count": 0, "tags": [], "creator": "steve.madden@pega.com", "attachment_id": null, "id": 192255, "time": "2016-07-08T20:24:59Z", "bug_id": 59832, "creation_time": "2016-07-08T20:24:59Z", "is_private": false, "text": "In 8.0.32, we have all nodes in multiple clustered environments using the TLSv1.1,TLSv1.2 SSL connectors on NIO2.  Everything works fine in all regions (dev, staging, TestQA & production across the 30+ nodes).  I attempted the upgrade to 8.5.3 (redeploy and copy all settings from xml files to new version) as I've done for years going back to Tomcat v5.  One major change was our <connector> in server.xml had to be changed from:\n<!--\t <Connector port=\"8443\" protocol=\"org.apache.coyote.http11.Http11Nio2Protocol\" SSLEnabled=\"true\" maxThreads=\"10\" minSpareThreads=\"5\" scheme=\"https\" secure=\"true\" acceptCount=\"100\" connectionTimeout=\"60000\" disableUploadTimeout=\"true\" clientAuth=\"false\" sslProtocol=\"TLS\" keystoreFile=\"D:\\certificates\\ourJKS.keystore\" keystorePass=\"******\"  /> -->\n\nto:\n<!-- Verify what the alias is being used for the certificate by using %JAVA_HOME%\\bin\\keytool -list -v -alias tomcat (or other aliasname) -->\n<Connector port=\"8443\" \n\tprotocol=\"org.apache.coyote.http11.Http11NioProtocol\" \n\tmaxThreads=\"150\" disableUploadTimeout=\"true\"  \n\tSSLEnabled=\"true\"\n\tsslDefaultHost=\"ourServer.com\">\n        <SSLHostConfig hostName=\"ourServer.com\">\n\t<Certificate certificateKeystoreFile=\"D:\\certificates\\ourJKS.keystore\" certificateKeystorePassword=\"******\" certificateKeyAlias=\"ourAlias\" type=\"RSA\"/>\n\t </SSLHostConfig>\n</Connector>\n\nWhich is fine, but we were using the http11.Http11Nio2Protocol and that no longer works in 8.5.3.  What we see is that the xml gets encoded and not decoded and then fails because NUL is passed as parameter values.  Since our environments are XML rich and connecting to Oracle 12c, the data should be encoded/decoded as it did in 8.0.32.  If this too changed along with the SSL/TLS arguments, it isn't documented where it can be easily identified.  Can someone please take an existing 8.0.32 TLSv1.1,TLSv1.2 and NIO2 and then port changes to 8.5.3 and tell me what I've missed?  I've had conversations already on the users email and Mark Thomas suggested I create this bug item and a simple use case.  The simplest case is using NIO2 on 8.0.32 and trying to use it again on 8.5.3."}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 192279, "time": "2016-07-10T15:55:13Z", "bug_id": 59832, "creation_time": "2016-07-10T15:55:13Z", "is_private": false, "text": "Not convinced at all, please provide a simple test case."}, {"count": 2, "tags": [], "creator": "steve.madden@pega.com", "attachment_id": null, "id": 192282, "time": "2016-07-11T01:46:30Z", "bug_id": 59832, "creation_time": "2016-07-11T01:46:30Z", "is_private": false, "text": "this isn't about convincing anyone here.  It's a clear cut simple step to do.  Take an existing NIO2 configuration running on 8.0.32 and port the changes to 8.5.3.  What are you asking me to provide you other than what I have?\n\nIf you are saying NIO2 does work and you have tested it, then what changed in 8.5.3 to allow the connector to work?  I've reproduced this inhouse on several systems and our engineering department did the same and the only thing that would allow this to work was changing Http11Nio2Protocol back down to HttpNioProtocol.  There is clearly a bug in the code somewhere or something wasn't documented clearly enough to help customers upgrading from 8.0.32 to 8.5.3."}, {"count": 3, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 192284, "time": "2016-07-11T07:06:31Z", "bug_id": 59832, "creation_time": "2016-07-11T07:06:31Z", "text": "The problem is that nobody understood what you were saying or saw what was wrong in the user list, so it's the same here. Please provide a simple test case (no XML framework please) so we can understand what's going on.\n\nSSL with NIO1 or NIO2 works very well for me."}, {"count": 4, "tags": [], "bug_id": 59832, "is_private": false, "text": "> I've had conversations already on the users email\n\nThread:\nhttp://tomcat.markmail.org/thread/2kkotx5miulpkr2d\n\"SSL/TLS 8.5.3 upgrade from 8.0.32 using NIO2 url encoding issues\"\n\n1. In e-mail thread you said that simply switching from Http11Nio2Protocol to Http11NioProtocol solves the issue.\n\nYour description does not say it clearly. It reads as if first setting and second setting are in different versions of Tomcat.\n\n\n(In reply to Steve Mekkelsen Madden from comment #2)\n> this isn't about convincing anyone here.  It's a clear cut simple step to\n> do.  Take an existing NIO2 configuration running on 8.0.32 and port the\n> changes to 8.5.3.  What are you asking me to provide you other than what I\n> have?\n\n2. You need to provide a simple sample web application (with source code) that reproduces this behaviour.  So that developers (and any interested users) could reproduce the behaviour. It can later convert it into a testcase.\n\nThis is also what Mark asked you on the mailing list.\n\n\nIs this reproducible without a database?\n\nIs this reproducible with a simple web application, without many filters / valves that may be involved? E.g. with default examples application.\n\n\n3. Are you using Tomcat-Native (tcnative-1.dll)? Do you have AprLifecycleListener configured?\n\nFor SSL-enabled connectors Tomcat 8.5 supports tho different implementations of JSSE (Java one vs OpenSSL one) and can switch between them.\n\nhttp://tomcat.apache.org/tomcat-8.5-doc/config/listeners.html#APR_Lifecycle_Listener_-_org.apache.catalina.core.AprLifecycleListener\n\nIs your issue reproducible without SSL/TLS, using a simple HTTP connection?\n\n\n4. Note that the default value of URIEncoding attribute of a Connector is different in Tomcat 8 vs Tomcat 7 and also depends on \"strict servlet compliance\" configuration property,\n\nhttp://tomcat.apache.org/migration-8.html#URIEncoding\n\nI prefer to configure URIEncoding explicitly.\n\n\n5. Is system country and locale the same between two configurations?\n\nWhat are the values of user.language, user.country, user.variant? Are they the same?\n\n\n6. Debugging\nhttps://wiki.apache.org/tomcat/FAQ/Troubleshooting_and_Diagnostics#Common_Troubleshooting_Scenario\n\n\n7. An image from the mail thread shows that request data is XML,\nhttps://ibin.co/2n9zIx3n9qUH.jpg\n\nbut error is from failing to parse JSON,\n> JSON text must start with '{' or '[' at 0 [character 1 line 1]\nhttp://pastebin.com/ShYzr92e\n\nThis does not match. XML starts with '<', not '{' or '['.", "id": 192285, "time": "2016-07-11T08:21:35Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2016-07-11T08:21:35Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Created attachment 34029\nemail response being attached\n\nAttached email response back, should have just posted it in here.  I do apologize, this is my first bug report into apache.  We've spent over 100 man hours in determining that the issue was NIO2.  Asking me to remove xml, change to http and other changes is not the right path.  That would change the scenario completely which is what I had issues with our own engineering department trying to do.  It was only when they did exactly as I stated that they were able to replicate the bug.  Let's not compare apples and oranges as that only eliminates other scenarios and doesn't test the current one being reported.", "attachment_id": 34029, "bug_id": 59832, "id": 192287, "time": "2016-07-11T13:03:37Z", "creator": "steve.madden@pega.com", "creation_time": "2016-07-11T13:03:37Z", "is_private": false}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 192331, "time": "2016-07-12T19:53:45Z", "bug_id": 59832, "creation_time": "2016-07-12T19:53:45Z", "text": "You are the only person reporting this issue.\n\nNo one else in the Tomcat dev community is able to reproduce this. If the issue can't be reproduced, and the problem description is not specific enough to identify the problem via code analysis (and this issue is a long way from being able to do that) then the issue can't be fixed.\n\nNIO2 + TLS is working across a range of platforms. It is covered by the unit tests which are run automatically on serveral flavours of Unix by the CI systems as well as on OSX and Windows by committers at least every release including every 8.5.x release.\n\nThere are significant differences between 8.0.x and 8.5.x since the connectors were refactored and a number of new features added. It is possible that there is a bug in the NIO2 implementation. It is also possible that the changes have exposed a bug in your application. Until you provide the rest of the Tomcat dev community with a means of reproducing this problem this is going to remain in the NEEDINFO state. Typically, such issues are transitioned to RESOLVED / WORKSFORME if no steps to reproduce are provided after several months.\n\nAn additional concern is that you changed the connector configuration between 8.0.x and 8.5.x. That should not have been necessary. Tomcat should have translated the settings for you. This may be a separate issue but it may also be a symptom of this issue.\n\nAsking you questions to narrow down the source of the problem, including asking for a minimal test case, is perfectly reasonable and your refusal is not going to motivate anyone to help you. You have access to a system that demonstrates the problem. The remainder of the Tomcat dev community does not. You are in a position to remove components from the application until you have the minimal set that demonstrates the issue. The remainder of the Tomcat dev community is not.\n\nThe Tomcat dev community wants to help you fix this issue but that isn't going to be possible if you continue to refuse to provide a test case or answer the questions we ask."}, {"count": 7, "tags": [], "creator": "steve.madden@pega.com", "attachment_id": 34034, "id": 192333, "time": "2016-07-12T20:18:18Z", "bug_id": 59832, "creation_time": "2016-07-12T20:18:18Z", "is_private": false, "text": "Created attachment 34034\nexception with NIO2 & protocol tags missing\n\nexception thrown when using NIO2 and not specifying the SSLPROTOCOL OR SSLENABLEDPROTOCOLS in the SSLHOSTCONFIG tag."}, {"count": 8, "attachment_id": null, "bug_id": 59832, "is_private": false, "id": 192334, "time": "2016-07-12T20:20:55Z", "creator": "steve.madden@pega.com", "creation_time": "2016-07-12T20:20:55Z", "tags": [], "text": "Thank for you the response.  I've been testing this all day and trying to figure out a way to reproduce it and was able to reproduce and resolve the problem.  But as you pointed out, yes I was forced to change the connector to what I provided to the more expanded version for it to startup without any errors.  A symptom of a different issue - probably so since it should just work, but what I found today was this: https://tomcat.apache.org/tomcat-8.5-doc/config/http.html#SSL_Support_-_Connector_-_NIO_and_NIO2_(deprecated).  Not sure why I couldn't earlier, but it does show that the arguments have been deprecated (possibly too harshly??).  After changing my connector to:\n<Connector port=\"8443\" protocol=\"org.apache.coyote.http11.Http11Nio2Protocol\" maxThreads=\"150\" disableUploadTimeout=\"true\" SSLEnabled=\"true\" sslDefaultHost=\"vgcspsteste1.rpega.com\">\n<SSLHostConfig hostName=\"vgcspsteste1.rpega.com\" sslProtocol=\"TLS\" sslEnabledProtocols=\"TLSv1.1,TLSv1.2\">\n<Certificate certificateKeystoreFile=\"D:\\certificates\\rpegagdwc.keystore\" certificateKeystorePassword=\"changeit\" certificateKeyAlias=\"rpega\" type=\"RSA\"/>\n</SSLHostConfig>\n</Connector>\nThe application no longer complained about the xml returned.  Note: the only change was adding sslProtocol and sslEnabledProtocols to the SSLHostConfig option.\nWithout those two added, this is what I see which kind of makes sense now that I found where the problem is.  These parameters were in the previous version, but I took it too literally about being deprecated and part of SSLHostConfig thinking I no longer needed it.  I've attached it as saxparseexception.txt.\n\nSo the bug I believe can be qualified now as if the two arguments are not included and you specify NIO2, it breaks the app.  However, with NIO you don't need the two arguments and it still works."}, {"count": 9, "tags": [], "text": "more testing and my last comment about it now working is false.  The prolog content error is prevalent in each transaction I do even with the two additional parameters.  What wasn't working on the OPEN of the instance, is broken when I try to save/update the instance.  So it's confusing that this works perfectly fine in 8.0.32 using the old style connector parameters, but in 8.5.3 the old style doesn't work and the new tags in it while allows tomcat to start our application, doesn't allow us to do anything useful.  But the new format and just changing the protocol to NIO works perfectly.  This is all confusing how this works - please bear with me while I wrap my head around it.\n\nI do understand and appreciate you're trying to help, believe me.  Are you looking for a zipped up copy of Tomcat minus our application or the exact changes I've made in the few xml files so that it could be replicated in-house?  As a software company, I have to be conscious of security and NDA's for our application but will provide what I can.  Do you want access (url) to a system that shows the error including the logfiles?  Just curious how much access would be needed for help?\n\nThanks!", "attachment_id": null, "bug_id": 59832, "id": 192335, "time": "2016-07-12T20:59:55Z", "creator": "steve.madden@pega.com", "creation_time": "2016-07-12T20:59:55Z", "is_private": false}, {"count": 10, "attachment_id": null, "bug_id": 59832, "is_private": false, "id": 192341, "time": "2016-07-13T08:27:01Z", "creator": "remm@apache.org", "creation_time": "2016-07-13T08:27:01Z", "tags": [], "text": "Please relax.\nSSLEnabled=\"true\" is required to enable TLS, without it the connector will be plaintext regardless of the rest of the configuration.\nPlease review the documentation for the SSL configuration options, if needed. If you want to discuss SSL configuration, which is a complex topic, please use the user list rather than this BZ.\n\nIf NIO works for you, use it. You don't seem to be able to provide us items that could allow a fix, so we'll leave the BZ as NEEDINFO for now before closing it eventually. This makes the possible issue more visible, and if someone else experiences the problem, we'll be able to make progress."}, {"count": 11, "tags": [], "text": "I am relaxed. :-)  Just puzzled why this doesn't work for me or engineering team who has also tried.   I'm not sure why you mentioned sslEnabled=\"true\" since it is there and is in each of my posts here.  I'm trying to provide you with the details you're asking, but I've also asked for what the new required parameters are and no one has provided it.  There clearly are changes as I've discovered today.  Perhaps this is enough to investigate?  If you want a specific file/files tell me what you need.  Though short of providing our application war file contents, you need to be able to test with XML as content being opened/saved to a database.  That's the steps I've taken every time to reproduce.  If you want to see screen shots of something, I could do that as well and put it in a pdf file for review.  I am trying to help.\n\nResults of testing yesterday and today.\nUsing the same configuration but with NIO protocol, only one row appears in the logs and no errors in the application.\n12 Jul 2016 13:28:39,541 [ssl-nio-8443-exec-19] (erifyLDAP.Code_Security.Action) INFO  sgcspsdev.rpega.com|10.2.201.246  - \n\nHowever, using NIO2 the below occurs on all rows being opened that return xml content (which is basically everything we do).\n\nOpen ResolveDetailSA Section Rule - queries the database and opens a specific row in one of the database tables.  Returns XML from the database and the application interprets the XML and formats it into dynamic html.\nAs soon as the record is opened, the log file throws this error:\n\n12 Jul 2016 13:24:54,211 [sl-nio2-8443-exec-12] (ngineinterface.service.HttpAPI) ERROR vgcspsteste1.rpega.com|10.2.201.246 madds@pegasystems.com - 10.\n2.201.246: Error adopting XML from post data\ncom.pega.pegarules.pub.clipboard.InvalidStreamError: InvalidStream      com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(String, Storage\nStream) sax parse error: Content is not allowed in prolog.\nFrom: (H5777DFBE5B053264FF27E1E68B04C53E:10.2.201.246)\n        at com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(XMLStream.java:477)\n        at com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(XMLStream.java:432)\n        at com.pega.pegarules.data.internal.clipboard.ClipboardPageImpl.adoptXMLForm(ClipboardPageImpl.java:818)\n        at com.pega.pegarules.session.internal.engineinterface.service.HttpAPI.mapInputData(HttpAPI.java:2481)\n        at com.pega.pegarules.session.external.engineinterface.service.EngineAPI.activityExecutionProlog(EngineAPI.java:554)\n        at com.pega.pegarules.session.external.engineinterface.service.EngineAPI.processRequestInner(EngineAPI.java:388)\n        at sun.reflect.GeneratedMethodAccessor92.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at com.pega.pegarules.session.internal.PRSessionProviderImpl.performTargetActionWithLock(PRSessionProviderImpl.java:1277)\n        at com.pega.pegarules.session.internal.PRSessionProviderImpl.doWithRequestorLocked(PRSessionProviderImpl.java:1015)\n        at com.pega.pegarules.session.internal.PRSessionProviderImpl.doWithRequestorLocked(PRSessionProviderImpl.java:848)\n        at com.pega.pegarules.session.external.engineinterface.service.EngineAPI.processRequest(EngineAPI.java:331)\n        at com.pega.pegarules.session.internal.engineinterface.service.HttpAPI.invoke(HttpAPI.java:817)\n        at com.pega.pegarules.session.internal.engineinterface.etier.impl.EngineImpl._invokeEngine_privact(EngineImpl.java:327)\n        at com.pega.pegarules.session.internal.engineinterface.etier.impl.EngineImpl.invokeEngine(EngineImpl.java:270)\n        at com.pega.pegarules.session.internal.engineinterface.etier.impl.EngineImpl.invokeEngine(EngineImpl.java:247)\n        at com.pega.pegarules.priv.context.JNDIEnvironment.invokeEngineInner(JNDIEnvironment.java:278)\n        at com.pega.pegarules.priv.context.JNDIEnvironment.invokeEngine(JNDIEnvironment.java:223)\n        at com.pega.pegarules.web.impl.WebStandardImpl.makeEtierRequest(WebStandardImpl.java:574)\n        at com.pega.pegarules.web.impl.WebStandardImpl.doPost(WebStandardImpl.java:374)\n        at sun.reflect.GeneratedMethodAccessor88.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at com.pega.pegarules.internal.bootstrap.PRBootstrap.invokeMethod(PRBootstrap.java:338)\n        at com.pega.pegarules.internal.bootstrap.PRBootstrap.invokeMethodPropagatingThrowable(PRBootstrap.java:379)\n        at com.pega.pegarules.boot.internal.extbridge.AppServerBridgeToPega.invokeMethodPropagatingThrowable(AppServerBridgeToPega.java:216)\n        at com.pega.pegarules.boot.internal.extbridge.AppServerBridgeToPega.invokeMethod(AppServerBridgeToPega.java:265)\n        at com.pega.pegarules.internal.web.servlet.WebStandardBoot.doPost(WebStandardBoot.java:118)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:648)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n        at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:522)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:79)\n        at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:620)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:349)\n        at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1110)\n        at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n        at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:785)\n        at org.apache.tomcat.util.net.Nio2Endpoint$SocketProcessor.doRun(Nio2Endpoint.java:1627)\n        at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\n        at org.apache.tomcat.util.net.AbstractEndpoint.processSocket(AbstractEndpoint.java:803)\n        at org.apache.tomcat.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:639)\n        at org.apache.tomcat.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:617)\n        at org.apache.tomcat.util.net.SecureNio2Channel$1.completed(SecureNio2Channel.java:873)\n        at org.apache.tomcat.util.net.SecureNio2Channel$1.completed(SecureNio2Channel.java:806)\n        at sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:126)\n        at sun.nio.ch.Invoker$2.run(Invoker.java:218)\n        at sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:112)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 1; Content is not allowed in prolog.\n        at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:203)\n        at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177)\n        at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:400)\n        at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:327)\n        at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1438)\n        at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:999)\n        at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:606)\n        at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:510)\n        at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:848)\n        at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:777)\n        at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:141)\n        at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1213)\n        at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:643)\n        at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl.parse(SAXParserImpl.java:327)\n        at com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(XMLStream.java:475)\n        ... 60 more\n12 Jul 2016 13:24:55,258 [sl-nio2-8443-exec-10] (ngineinterface.service.HttpAPI) ERROR vgcspsteste1.rpega.com|10.2.201.246 madds@pegasystems.com - 10.\n2.201.246: Error adopting XML from post data\ncom.pega.pegarules.pub.clipboard.InvalidStreamError: InvalidStream      com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(String, Storage\nStream) sax parse error: Content is not allowed in prolog.\nFrom: (H5777DFBE5B053264FF27E1E68B04C53E:10.2.201.246)\n        at com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(XMLStream.java:477)\n        at com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(XMLStream.java:432)\n        at com.pega.pegarules.data.internal.clipboard.ClipboardPageImpl.adoptXMLForm(ClipboardPageImpl.java:818)\n        at com.pega.pegarules.session.internal.engineinterface.service.HttpAPI.mapInputData(HttpAPI.java:2481)\n        at com.pega.pegarules.session.external.engineinterface.service.EngineAPI.activityExecutionProlog(EngineAPI.java:554)\n        at com.pega.pegarules.session.external.engineinterface.service.EngineAPI.processRequestInner(EngineAPI.java:388)\n        at sun.reflect.GeneratedMethodAccessor92.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at com.pega.pegarules.session.internal.PRSessionProviderImpl.performTargetActionWithLock(PRSessionProviderImpl.java:1277)\n        at com.pega.pegarules.session.internal.PRSessionProviderImpl.doWithRequestorLocked(PRSessionProviderImpl.java:1015)\n        at com.pega.pegarules.session.internal.PRSessionProviderImpl.doWithRequestorLocked(PRSessionProviderImpl.java:848)\n        at com.pega.pegarules.session.external.engineinterface.service.EngineAPI.processRequest(EngineAPI.java:331)\n        at com.pega.pegarules.session.internal.engineinterface.service.HttpAPI.invoke(HttpAPI.java:817)\n        at com.pega.pegarules.session.internal.engineinterface.etier.impl.EngineImpl._invokeEngine_privact(EngineImpl.java:327)\n        at com.pega.pegarules.session.internal.engineinterface.etier.impl.EngineImpl.invokeEngine(EngineImpl.java:270)\n        at com.pega.pegarules.session.internal.engineinterface.etier.impl.EngineImpl.invokeEngine(EngineImpl.java:247)\n        at com.pega.pegarules.priv.context.JNDIEnvironment.invokeEngineInner(JNDIEnvironment.java:278)\n        at com.pega.pegarules.priv.context.JNDIEnvironment.invokeEngine(JNDIEnvironment.java:223)\n        at com.pega.pegarules.web.impl.WebStandardImpl.makeEtierRequest(WebStandardImpl.java:574)\n        at com.pega.pegarules.web.impl.WebStandardImpl.doPost(WebStandardImpl.java:374)\n        at sun.reflect.GeneratedMethodAccessor88.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at com.pega.pegarules.internal.bootstrap.PRBootstrap.invokeMethod(PRBootstrap.java:338)\n        at com.pega.pegarules.internal.bootstrap.PRBootstrap.invokeMethodPropagatingThrowable(PRBootstrap.java:379)\n        at com.pega.pegarules.boot.internal.extbridge.AppServerBridgeToPega.invokeMethodPropagatingThrowable(AppServerBridgeToPega.java:216)\n        at com.pega.pegarules.boot.internal.extbridge.AppServerBridgeToPega.invokeMethod(AppServerBridgeToPega.java:265)\n        at com.pega.pegarules.internal.web.servlet.WebStandardBoot.doPost(WebStandardBoot.java:118)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:648)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n        at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:522)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:79)\n        at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:620)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:349)\n        at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1110)\n        at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n        at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:785)\n        at org.apache.tomcat.util.net.Nio2Endpoint$SocketProcessor.doRun(Nio2Endpoint.java:1627)\n        at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\n        at org.apache.tomcat.util.net.AbstractEndpoint.processSocket(AbstractEndpoint.java:803)\n        at org.apache.tomcat.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:639)\n        at org.apache.tomcat.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:617)\n        at org.apache.tomcat.util.net.SecureNio2Channel$1.completed(SecureNio2Channel.java:873)\n        at org.apache.tomcat.util.net.SecureNio2Channel$1.completed(SecureNio2Channel.java:806)\n        at sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:126)\n        at sun.nio.ch.Invoker$2.run(Invoker.java:218)\n        at sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:112)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 1; Content is not allowed in prolog.\n        at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:203)\n        at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177)\n        at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:400)\n        at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:327)\n        at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1438)\n        at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:999)\n        at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:606)\n        at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:510)\n        at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:848)\n        at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:777)\n        at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:141)\n        at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1213)\n        at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:643)\n        at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl.parse(SAXParserImpl.java:327)\n        at com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(XMLStream.java:475)\n        ... 60 more\n\n\t\t\nAfter testing other areas, it seems that it is more prominent in those requests as well even with the changes to adding the protocols.\n12 Jul 2016 16:45:05,331 [ssl-nio2-8443-exec-2] (ngineinterface.service.HttpAPI) ERROR vgcspsteste1.rpega.com|10.2.201.246 madds@pegasystems.com - 10.\n2.201.246: Error adopting XML from post data\ncom.pega.pegarules.pub.clipboard.InvalidStreamError: InvalidStream      com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(String, Storage\nStream) sax parse error: The element type \"pyAllowRowUpdate\" must be terminated by the matching end-tag \"</pyAllowRowUpdate>\".\nFrom: (HCA1026B15C0DE9B42EDB348DA35C8807:10.2.201.246)\n        at com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(XMLStream.java:477)\n        at com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(XMLStream.java:432)\n        at com.pega.pegarules.data.internal.clipboard.ClipboardPageImpl.adoptXMLForm(ClipboardPageImpl.java:818)\n        at com.pega.pegarules.session.internal.engineinterface.service.HttpAPI.mapInputData(HttpAPI.java:2481)\n        at com.pega.pegarules.session.external.engineinterface.service.EngineAPI.activityExecutionProlog(EngineAPI.java:554)\n        at com.pega.pegarules.session.external.engineinterface.service.EngineAPI.processRequestInner(EngineAPI.java:388)\n        at sun.reflect.GeneratedMethodAccessor75.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at com.pega.pegarules.session.internal.PRSessionProviderImpl.performTargetActionWithLock(PRSessionProviderImpl.java:1277)\n        at com.pega.pegarules.session.internal.PRSessionProviderImpl.doWithRequestorLocked(PRSessionProviderImpl.java:1015)\n        at com.pega.pegarules.session.internal.PRSessionProviderImpl.doWithRequestorLocked(PRSessionProviderImpl.java:848)\n        at com.pega.pegarules.session.external.engineinterface.service.EngineAPI.processRequest(EngineAPI.java:331)\n        at com.pega.pegarules.session.internal.engineinterface.service.HttpAPI.invoke(HttpAPI.java:817)\n        at com.pega.pegarules.session.internal.engineinterface.etier.impl.EngineImpl._invokeEngine_privact(EngineImpl.java:327)\n        at com.pega.pegarules.session.internal.engineinterface.etier.impl.EngineImpl.invokeEngine(EngineImpl.java:270)\n        at com.pega.pegarules.session.internal.engineinterface.etier.impl.EngineImpl.invokeEngine(EngineImpl.java:247)\n        at com.pega.pegarules.priv.context.JNDIEnvironment.invokeEngineInner(JNDIEnvironment.java:278)\n        at com.pega.pegarules.priv.context.JNDIEnvironment.invokeEngine(JNDIEnvironment.java:223)\n        at com.pega.pegarules.web.impl.WebStandardImpl.makeEtierRequest(WebStandardImpl.java:574)\n        at com.pega.pegarules.web.impl.WebStandardImpl.doPost(WebStandardImpl.java:374)\n        at sun.reflect.GeneratedMethodAccessor73.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at com.pega.pegarules.internal.bootstrap.PRBootstrap.invokeMethod(PRBootstrap.java:338)\n        at com.pega.pegarules.internal.bootstrap.PRBootstrap.invokeMethodPropagatingThrowable(PRBootstrap.java:379)\n        at com.pega.pegarules.boot.internal.extbridge.AppServerBridgeToPega.invokeMethodPropagatingThrowable(AppServerBridgeToPega.java:216)\n        at com.pega.pegarules.boot.internal.extbridge.AppServerBridgeToPega.invokeMethod(AppServerBridgeToPega.java:265)\n        at com.pega.pegarules.internal.web.servlet.WebStandardBoot.doPost(WebStandardBoot.java:118)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:648)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n        at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)\n        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:522)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:79)\n        at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:620)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:349)\n        at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1110)\n        at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n        at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:785)\n        at org.apache.tomcat.util.net.Nio2Endpoint$SocketProcessor.doRun(Nio2Endpoint.java:1627)\n        at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\n        at org.apache.tomcat.util.net.AbstractEndpoint.processSocket(AbstractEndpoint.java:803)\n        at org.apache.tomcat.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:639)\n        at org.apache.tomcat.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:617)\n        at org.apache.tomcat.util.net.SecureNio2Channel$1.completed(SecureNio2Channel.java:873)\n        at org.apache.tomcat.util.net.SecureNio2Channel$1.completed(SecureNio2Channel.java:806)\n        at sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:126)\n        at sun.nio.ch.Invoker$2.run(Invoker.java:218)\n        at sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:112)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.xml.sax.SAXParseException; lineNumber: 1; columnNumber: 16297; The element type \"pyAllowRowUpdate\" must be terminated by the matching e\nnd-tag \"</pyAllowRowUpdate>\".\n        at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:203)\n        at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:177)\n        at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:400)\n        at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:327)\n        at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1438)\n        at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanEndElement(XMLDocumentFragmentScannerImpl.java:1750)\n        at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:2970)\n\n        at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:606)\n        at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:510)\n        at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:848)\n        at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:777)\n        at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:141)\n        at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1213)\n        at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:643)\n        at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl.parse(SAXParserImpl.java:327)\n        at com.pega.pegarules.data.internal.clipboard.XMLStream.newStream(XMLStream.java:475)\n        ... 60 more\n12-Jul-2016 16:45:05.401 INFO [https-openssl-nio2-8443-exec-11] org.apache.coyote.http11.Http11Processor.service Error parsing HTTP request header\n Note: further occurrences of HTTP header parsing errors will be logged at DEBUG level.\n java.lang.IllegalArgumentException: Invalid character found in method name. HTTP method names must be tokens\n        at org.apache.coyote.http11.Http11InputBuffer.parseRequestLine(Http11InputBuffer.java:462)\n        at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:994)\n        at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n        at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:785)\n        at org.apache.tomcat.util.net.Nio2Endpoint$SocketProcessor.doRun(Nio2Endpoint.java:1627)\n        at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)\n        at org.apache.tomcat.util.net.AbstractEndpoint.processSocket(AbstractEndpoint.java:803)\n        at org.apache.tomcat.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:639)\n        at org.apache.tomcat.util.net.Nio2Endpoint$Nio2SocketWrapper$4.completed(Nio2Endpoint.java:617)\n        at org.apache.tomcat.util.net.SecureNio2Channel$1.completed(SecureNio2Channel.java:873)\n        at org.apache.tomcat.util.net.SecureNio2Channel$1.completed(SecureNio2Channel.java:806)\n        at sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:126)\n        at sun.nio.ch.Invoker$2.run(Invoker.java:218)\n        at sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:112)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n        at java.lang.Thread.run(Thread.java:745)", "is_private": false, "bug_id": 59832, "id": 192350, "time": "2016-07-13T17:57:31Z", "creator": "steve.madden@pega.com", "creation_time": "2016-07-13T17:57:31Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "id": 192359, "time": "2016-07-13T22:33:03Z", "bug_id": 59832, "creation_time": "2016-07-13T22:33:03Z", "is_private": false, "text": "1. Let's go back to the user's list. This is way too much non-bug discussion to be having in Bugzilla.\n\n2. You have an XML document in your database and when you use Tomcat's NIO2 connector, the XML document from the database (JDBC?) gets corrupted? That makes literally no sense, as Tomcat has nothing to do with your conversation with your database."}, {"count": 13, "tags": [], "text": "Comment on attachment 34029\nemail response being attached\n\nThis attachment was a .msg file which is next to impossible for most people to view. The thread referenced can be found here: https://lists.apache.org/thread.html/ee6652a289926e988728f11113abd0866ba7eae032d597e33398eb41@%3Cusers.tomcat.apache.org%3E\n\nI can't seem to figure out how to give a link to the threaded-view in lists.a.o.\n\nThis markmail list will work:\n\nhttp://markmail.org/message/2kkotx5miulpkr2d", "attachment_id": 34029, "bug_id": 59832, "id": 192361, "time": "2016-07-13T22:41:52Z", "creator": "chris@christopherschultz.net", "creation_time": "2016-07-13T22:41:52Z", "is_private": false}, {"count": 14, "attachment_id": null, "bug_id": 59832, "is_private": false, "id": 194768, "time": "2016-11-02T09:33:34Z", "creator": "markt@apache.org", "creation_time": "2016-11-02T09:33:34Z", "tags": [], "text": "The information provided to date points to an application issue. Therefore, resolving this as INVALID.\n\nIf a simple test case is provided that demonstrates the issue is a Tomcat bug then it can always be re-opened."}]
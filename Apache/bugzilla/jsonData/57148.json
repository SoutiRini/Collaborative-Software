[{"attachment_id": null, "tags": [], "creator": "knst.kolinko@gmail.com", "is_private": false, "count": 0, "id": 178759, "time": "2014-10-26T22:10:28Z", "bug_id": 57148, "creation_time": "2014-10-26T22:10:28Z", "text": "(Noted when reviewing org.apache.el.lang.ELSupport.coerceToType())\n\nMy expectations are that ELSupport.coerceToType() method follows the type conversion rules specified in Expression Language specification.\n\nThere is the following phrase in specification 3.0 ch.1.23.7 Coerce A to Any Other Type T:\n\n\"If A is a String and T's PropertyEditor throws an exception:\"\n\"If A is \"\", return null\"\n\"Otherwise, error\"\n\nThe same phrase in present in EL 2.2 and EL 2.1 specifications (ch.1.18.7) as well.\n\nConsider the following case:\n- A is an empty string (\"\")\n- T has a PropertyEditor\n\nExpected behaviour:\n- Call PropertyEditor with value of \"\".\n- If it throws an exception, return null.\n- Otherwise use the converted value.\ntry {\n propertyEditor.setAsText(\"\").getValue();\n} catch (RuntimeException e) {\n return null;\n}\n\nActual implementation:\n- It skips calling the PropertyEditor and immediately returns null.\n\n if (obj instanceof String) {\n   if (\"\".equals(obj))\n        return null;\n   PropertyEditor editor = PropertyEditorManager.findEditor(type);\n ...\n\nThe PropertyEditor.setAsText(String) method is documented to throw IllegalArgumentException on invalid values. I think that EL API expects an ELException, so it is to be wrapped somewhere."}, {"count": 1, "tags": [], "bug_id": 57148, "text": "Created attachment 32147\n2014-10-27_tc8_57148_v1.patch\n\nPatch for current trunk. Not tested.", "id": 178760, "time": "2014-10-26T22:49:27Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-10-26T22:49:27Z", "is_private": false, "attachment_id": 32147}, {"count": 2, "tags": [], "creator": "markt@apache.org", "text": "Added some unit tests that confirm the patch is correct and applied to 8.0.x for 8.0.15 owards.\n\nThis needs to be back-ported so changing version.", "id": 178838, "time": "2014-10-29T23:03:07Z", "bug_id": 57148, "creation_time": "2014-10-29T23:03:07Z", "is_private": false, "attachment_id": null}, {"count": 3, "text": "Fixed in 7.0.x for 7.0.6 onwards.", "bug_id": 57148, "is_private": false, "id": 180864, "time": "2015-02-09T10:53:00Z", "creator": "markt@apache.org", "creation_time": "2015-02-09T10:53:00Z", "tags": [], "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 57148, "text": "Correction. 7.0.60 onwards.", "id": 180865, "time": "2015-02-09T10:53:21Z", "creator": "markt@apache.org", "creation_time": "2015-02-09T10:53:21Z", "is_private": false, "attachment_id": null}]
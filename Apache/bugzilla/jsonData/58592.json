[{"count": 0, "text": "I work at IBM for IBM Integration Bus product. We use Tomcat 7 as servlet container. When we receive request from client, the org.apache.coyote.request object has \"null\" scheme. So when we try to get the scheme as req.scheme(), we end up getting null.\n\nThe service looks like:\n public void service(\n      org.apache.coyote.Request req,\n      org.apache.coyote.Response res) throws Exception\n\nWe print the debug info as:\n\nprivate void debugRequest(org.apache.coyote.Request req) \n    {\n      System.out.println(\"========BEGIN TOMCAT DEBUG INFO===============================\");\n      System.out.println(\"scheme:\" + req.scheme().toString() + \":\");\n      System.out.println(\"method:\" + req.method().toString() + \":\");\n      System.out.println(\"unparsedURI:\" + req.unparsedURI().toString() + \":\");\n      System.out.println(\"requestURI:\" + req.requestURI().toString() + \":\");\n      System.out.println(\"decodedURI:\" + req.decodedURI().toString() + \":\");\n      System.out.println(\"queryString:\" + req.queryString().toString() + \":\");\n      System.out.println(\"protocol:\" + req.protocol().toString() + \":\");\n      System.out.println(\"serverName:\" + req.serverName().toString() + \":\");\n      System.out.println(\"remoteAddr:\" + req.remoteAddr().toString() + \":\");\n      System.out.println(\"remoteHost:\" + req.remoteHost().toString() + \":\");\n      System.out.println(\"localName:\" + req.localName().toString() + \":\");\n      System.out.println(\"localAddr:\" + req.localAddr().toString() + \":\");\n      System.out.println(\"getServerPort:\" + req.getServerPort() + \":\");\n      System.out.println(\"getRemotePort:\" + req.getRemotePort() + \":\");\n      System.out.println(\"getLocalPort:\" + req.getLocalPort() + \":\");\n      System.out.println(\"getCharacterEncoding:\" + req.getCharacterEncoding() + \":\");\n      System.out.println(\"getContentLength:\" + req.getContentLength() + \":\");\n      System.out.println(\"getContentType:\" + req.getContentType() + \":\");\n      System.out.println(\"getCookies:\" + req.getCookies().toString() + \":\");\n      //System.out.println(\"getParameters:\"+req.getParameters().paramsAsString()+\":\");\n      System.out.println(\"========--END TOMCAT DEBUG INFO===============================\");\n    }\n\n\nThe debug output is:\n\n2015-11-06 14:31:27.919     35 ========BEGIN TOMCAT DEBUG INFO===============================\n2015-11-06 14:31:27.919     35 scheme:null:\n2015-11-06 14:31:27.920     35 method:POST:\n2015-11-06 14:31:27.920     35 unparsedURI:/httpservice:\n2015-11-06 14:31:27.920     35 requestURI:/httpservice:\n2015-11-06 14:31:27.921     35 decodedURI:null:\n2015-11-06 14:31:27.921     35 queryString:null:\n2015-11-06 14:31:27.921     35 protocol:HTTP/1.1:\n2015-11-06 14:31:27.922     35 serverName:localhost:\n2015-11-06 14:31:27.922     35 remoteAddr:127.0.0.1:\n2015-11-06 14:31:27.922     35 remoteHost:null:\n2015-11-06 14:31:27.923     35 localName:null:\n2015-11-06 14:31:27.923     35 localAddr:null:\n2015-11-06 14:31:27.923     35 getServerPort:7800:\n2015-11-06 14:31:27.924     35 getRemotePort:54064:\n2015-11-06 14:31:27.924     35 getLocalPort:-1:\n2015-11-06 14:31:27.924     35 getCharacterEncoding:null:\n2015-11-06 14:31:27.925     35 getContentLength:2:\n2015-11-06 14:31:27.925     35 getContentType:null:\n2015-11-06 14:31:27.926     35 getCookies:=== Cookies ===\n:\n2015-11-06 14:31:27.926     35 ========--END TOMCAT DEBUG INFO===============================", "bug_id": 58592, "is_private": false, "id": 186286, "time": "2015-11-06T11:10:39Z", "creator": "rashmikatagall@in.ibm.com", "creation_time": "2015-11-06T11:10:39Z", "tags": [], "attachment_id": null}, {"count": 1, "text": "Users do not usually deal with o.a.coyote Request, Response objects.\n\nYou do not provide enough information on your use case (no reproduction recipe), but from my understanding this is expected behaviour.\n\nScheme is a configurable attribute of a <Connector>.\nSee the first few lines of CoyoteAdapter.postParseRequest()", "bug_id": 58592, "is_private": false, "id": 186291, "time": "2015-11-06T12:11:58Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2015-11-06T12:11:58Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "creator": "rashmikatagall@in.ibm.com", "is_private": false, "text": "Created attachment 33351\nThe code to test the scheme  set in header\n\nWe have attached the code we used to create and start the Http11Protocol handler.\n\nWe see that the Scheme header is set to \"https\" if we run a secure connection. But this will be \"null\" when running in non-secure mode.\n\nCan you please clarify why scheme is \"null\" with non secure connections?", "id": 186956, "time": "2015-12-15T08:03:06Z", "bug_id": 58592, "creation_time": "2015-12-15T08:03:06Z", "attachment_id": 33351}, {"count": 3, "tags": [], "bug_id": 58592, "attachment_id": null, "is_private": false, "id": 186957, "time": "2015-12-15T08:51:21Z", "creator": "markt@apache.org", "creation_time": "2015-12-15T08:51:21Z", "text": "Tomcat internals not working as you would like them to is not a bug.\n\nAs Konstatin pointed out, with a code reference, this is expected behaviour. The code reference makes it clear what you need to do to in your code to get the correct scheme for the request.\n\nThe referenced code could be cleaned up a little but there aren't going to be any functional changes."}, {"count": 4, "attachment_id": null, "bug_id": 58592, "text": "s/Konstatin/Konstantin/\n\nAppologies for the typo.", "id": 186958, "time": "2015-12-15T08:57:51Z", "creator": "markt@apache.org", "creation_time": "2015-12-15T08:57:51Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 58592, "text": "We do understand that the scheme is a configurable attribute of connector object. But we are using Http11protocol handler. Can you please check our code attached in the attachment and help us set the scheme there?", "id": 186970, "time": "2015-12-16T04:37:28Z", "creator": "rashmikatagall@in.ibm.com", "creation_time": "2015-12-16T04:37:28Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 58592, "text": "Please do not reopen the bug report. For support, please use the tomcat-users mailing list.", "id": 186973, "time": "2015-12-16T08:45:12Z", "creator": "remm@apache.org", "creation_time": "2015-12-16T08:45:12Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 58592, "text": "Hi, I am not sure what do you mean by tomcat-user's mailing list.\n\nCan you please address my query in comment 5?\n\"We do understand that the scheme is a configurable attribute of connector object. But we are using Http11protocol handler. Can you please check our code attached in the attachment and help us set the scheme there?\"", "id": 187072, "time": "2015-12-21T04:46:23Z", "creator": "rashmikatagall@in.ibm.com", "creation_time": "2015-12-21T04:46:23Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "ethan@superiordocumentservices.com", "attachment_id": 23228, "text": "Created attachment 23228\nexample code\n\nI can set a print area and read it back just fine, but it does not get saved when the document is written to disk. I have example code and files (both input and output.)", "id": 124660, "time": "2009-02-04T07:26:38Z", "bug_id": 46664, "creation_time": "2009-02-04T07:26:38Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 46664, "attachment_id": 23229, "text": "Created attachment 23229\nexample input", "id": 124662, "time": "2009-02-04T07:27:31Z", "creator": "ethan@superiordocumentservices.com", "creation_time": "2009-02-04T07:27:31Z", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 23230\nexample output", "is_private": false, "bug_id": 46664, "id": 124663, "time": "2009-02-04T07:27:51Z", "creator": "ethan@superiordocumentservices.com", "creation_time": "2009-02-04T07:27:51Z", "attachment_id": 23230}, {"count": 3, "tags": [], "bug_id": 46664, "attachment_id": null, "is_private": false, "id": 137411, "time": "2010-06-07T11:58:35Z", "creator": "yohan_y@yahoo.com", "creation_time": "2010-06-07T11:58:35Z", "text": "I've tried poi-3.2-final, poi-3.5-final, and poi-3.6\n\nThis problem is not happened in poi-3.2\nBut this problem is happened in poi-3.5-final and poi-3.6"}, {"count": 4, "tags": [], "bug_id": 46664, "attachment_id": null, "is_private": false, "id": 137428, "time": "2010-06-08T05:24:50Z", "creator": "apache@gagravarr.org", "creation_time": "2010-06-08T05:24:50Z", "text": "Any chance you could create 4 files:\n* a simple document, but with enough data to make the print area make sense\n* that document, as saved by excel having set the print area\n* that document, as saved by POI 3.2 having set the print area\n* that document, as saved by a recent POI svn checkout, having set the print area\n\nIf you're also able to use org.apache.poi.hssf.dev.BiffViewer to spot the differences between the 4, that'd be handy, as that'll help us narrow in on which bits have gone wrong"}, {"count": 5, "tags": [], "bug_id": 46664, "attachment_id": 25545, "id": 137431, "time": "2010-06-08T06:19:01Z", "creator": "yohan_y@yahoo.com", "creation_time": "2010-06-08T06:19:01Z", "is_private": false, "text": "Created attachment 25545\nTestPoiPrintArea.java"}, {"count": 6, "tags": [], "bug_id": 46664, "attachment_id": 25546, "text": "Created attachment 25546\nGenerated Excel File when TestPoiPrintArea.java is run with poi-3.6.jar", "id": 137432, "time": "2010-06-08T06:25:22Z", "creator": "yohan_y@yahoo.com", "creation_time": "2010-06-08T06:25:22Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 46664, "attachment_id": 25547, "text": "Created attachment 25547\nGenerated Excel File when TestPoiPrintArea.java is run with poi-3.2-FINAL.jar", "id": 137433, "time": "2010-06-08T06:27:00Z", "creator": "yohan_y@yahoo.com", "creation_time": "2010-06-08T06:27:00Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 46664, "attachment_id": null, "text": "Sorry,\n\nI'm not able to use BiffViewer.java.\nI also do not have good enough internet connection to checkout from poi svn.\n\nI've attached 3 files:\n1. TestPoiPrintArea.java\n2. test_poi_36.xls: Generated Excel file when TestPoiPrintArea.java is being run with poi-3.6.jar (set print area failed)\n3. test_poi_32.xls: Generated Excel file when TestPoiPrintArea.java is being run with poi-3.2-FINAL.jar (set print area success)\n\nDo you need another document ?\n\nSet print area is not working at all since poi-3.5-FINAL.jar, this is not intermittent bug or in specific case.\n\nThank you very much..", "id": 137434, "time": "2010-06-08T06:44:33Z", "creator": "yohan_y@yahoo.com", "creation_time": "2010-06-08T06:44:33Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 46664, "attachment_id": null, "id": 137435, "time": "2010-06-08T06:47:11Z", "creator": "apache@gagravarr.org", "creation_time": "2010-06-08T06:47:11Z", "is_private": false, "text": "Could you please generate a file with the same data and print area in excel? That way we can also check that what we do matches what excel does once fixed, and will also be a useful one for a read unit test"}, {"count": 10, "tags": [], "bug_id": 46664, "attachment_id": 25548, "text": "Created attachment 25548\nsame document + set print area written manually in Excel (not using POI)", "id": 137436, "time": "2010-06-08T06:55:35Z", "creator": "yohan_y@yahoo.com", "creation_time": "2010-06-08T06:55:35Z", "is_private": false}, {"count": 11, "tags": [], "text": "Created attachment 25552\nGenerated Excel File when TestPoiPrintArea.java is run with poi-3.7-SNAPSHOT-20100608.jar\n\nThe set print area still not working on poi-3.7-snapshot", "is_private": false, "id": 137461, "creator": "yohan_y@yahoo.com", "time": "2010-06-08T21:51:33Z", "bug_id": 46664, "creation_time": "2010-06-08T21:51:33Z", "attachment_id": 25552}, {"count": 12, "tags": [], "text": "Fixed in r953180. It seems that some versions of excel are pickier than others about the TabIdRecord when processing the print rules, and we'd stopped updating it for new sheets....", "is_private": false, "id": 137515, "creator": "apache@gagravarr.org", "time": "2010-06-09T18:57:42Z", "bug_id": 46664, "creation_time": "2010-06-09T18:57:42Z", "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 46664, "attachment_id": null, "is_private": false, "id": 137519, "time": "2010-06-09T21:58:57Z", "creator": "yohan_y@yahoo.com", "creation_time": "2010-06-09T21:58:57Z", "text": "(In reply to comment #12)\n> Fixed in r953180. It seems that some versions of excel are pickier than others\n> about the TabIdRecord when processing the print rules, and we'd stopped\n> updating it for new sheets....\n\nThanks a lot.. \nI will try when poi-3.7-SNAPSHOT-20100610.jar is available on http://encore.torchbox.com/poi-cvs-build/"}, {"count": 14, "tags": [], "creator": "yohan_y@yahoo.com", "attachment_id": null, "text": "I've running the TestPoiPrintArea.java using poi-3.7-SNAPSHOT-20100610.jar and the print area still not set. (bug still not solved)\n\nDoes this snapshot contain fixed version (r953180) ?", "id": 137530, "time": "2010-06-10T07:33:30Z", "bug_id": 46664, "creation_time": "2010-06-10T07:33:30Z", "is_private": false}, {"count": 15, "tags": [], "creator": "yohan_y@yahoo.com", "attachment_id": 25577, "text": "Created attachment 25577\nGenerated Excel File when TestPoiPrintArea.java is run with poi-3.7-SNAPSHOT-20100610.jar", "id": 137535, "time": "2010-06-10T07:36:42Z", "bug_id": 46664, "creation_time": "2010-06-10T07:36:42Z", "is_private": false}, {"count": 16, "tags": [], "bug_id": 46664, "attachment_id": null, "text": "Hmm, maybe it wasn't just the TabID problem\n\nThe only other difference I can spot is in the print area name record:\n\n     .NameIsMultibyte        = false\n     .Name (Unicode text)    = Print_Area\n     .Formula (nTokens=1):\n-       org.apache.poi.hssf.record.formula.Area3DPtg [sheetIx=0 ! $A$1:$C$1]R\n+       org.apache.poi.hssf.record.formula.Area3DPtg [sheetIx=0 ! $A$1:$C$1]V\n\n(- is for the 3.2 version, + for the 3.7 one)\n\nIt seems to have been switched from a by-reference to by-value definition\n\nI've no idea why, or what this'll do to excel (well, other than confuse yours but not mine). I guess one for Josh (our resident formula guru)", "id": 137536, "time": "2010-06-10T07:47:04Z", "creator": "apache@gagravarr.org", "creation_time": "2010-06-10T07:47:04Z", "is_private": false}, {"count": 17, "tags": [], "bug_id": 46664, "attachment_id": null, "id": 143914, "time": "2011-02-02T10:57:32Z", "creator": "jan_willem.thewes@gad.de", "creation_time": "2011-02-02T10:57:32Z", "is_private": false, "text": "Is this topic dead? I'm noticing the same bug in the POI 3.7 release. If there is any information I can provide tell me and I'll do what I can.\n\nBest Regards"}, {"count": 18, "tags": [], "bug_id": 46664, "attachment_id": null, "id": 143916, "time": "2011-02-02T11:05:17Z", "creator": "apache@gagravarr.org", "creation_time": "2011-02-02T11:05:17Z", "is_private": false, "text": "(In reply to comment #17)\n> Is this topic dead? I'm noticing the same bug in the POI 3.7 release. If there\n> is any information I can provide tell me and I'll do what I can.\n\nI'd suggest you try hacking the Ptg on the definition to be Reference not Value, and see if that fixes it. (It'll probably mean some low level fiddling about in the record layer)\n\nIf it does, we can make the change in POI. If not, more work will be needed to identify the problem."}, {"count": 19, "tags": [], "bug_id": 46664, "attachment_id": null, "id": 144125, "time": "2011-02-10T02:40:16Z", "creator": "ogawa567@oki.com", "creation_time": "2011-02-10T02:40:16Z", "is_private": false, "text": "I found a difference HSSFWorkbook and XSSFWorkbook.\n\nIn XSSFWorkbook#setPrintArea(), FormulaParser#parse() is called as follows.\n\nFormulaParser.parse (formulaText, fpb, FormulaType.NAMEDRANGE, getSheetIndex ());\n\nThe third argument is FormulaType.NAMEDRANGE.\n\nHowever, in HSSFWorkbook#setPrintArea(), third argument is FormulaType.CELL as follows.\n\nHSSFFormulaParser.parse (sb.toString (), this, FormulaType.CELL, sheetIndex)\n\nIn fact, if I create a following class, setPrintArea works fine.\n\n--------------------------------------------------------------------------------\n\nimport java.lang.reflect.Field;\nimport java.util.regex.Pattern;\n\nimport org.apache.poi.hssf.model.HSSFFormulaParser;\nimport org.apache.poi.hssf.model.Workbook;\nimport org.apache.poi.hssf.record.NameRecord;\nimport org.apache.poi.hssf.record.formula.SheetNameFormatter;\nimport org.apache.poi.hssf.usermodel.HSSFWorkbook;\nimport org.apache.poi.ss.formula.FormulaType;\n\npublic class MyHSSFWorkbook extends HSSFWorkbook {\n\n    private static final Pattern COMMA_PATTERN = Pattern.compile(\",\");\n    private Workbook workbook;\n\n    public MyHSSFWorkbook() throws NoSuchFieldException, IllegalAccessException {\n        this.workbook = getLowLevelWorkbook();\n    }\n\n    private Workbook getLowLevelWorkbook() throws NoSuchFieldException, IllegalAccessException {\n        Field field = HSSFWorkbook.class.getDeclaredField(\"workbook\");\n        field.setAccessible(true);\n        return (Workbook) field.get(this);\n    }\n\n    @Override\n    public void setPrintArea(int sheetIndex, String reference) {\n        NameRecord name =\n                workbook.getSpecificBuiltinRecord(NameRecord.BUILTIN_PRINT_AREA, sheetIndex + 1);\n\n        if (name == null) {\n            name = workbook.createBuiltInName(NameRecord.BUILTIN_PRINT_AREA, sheetIndex + 1);\n            // adding one here because 0 indicates a global named region; doesn't make sense for print areas\n        }\n        String[] parts = COMMA_PATTERN.split(reference);\n        StringBuffer sb = new StringBuffer(32);\n        for (int i = 0; i < parts.length; i++) {\n            if (i > 0) {\n                sb.append(\",\");\n            }\n            SheetNameFormatter.appendFormat(sb, getSheetName(sheetIndex));\n            sb.append(\"!\");\n            sb.append(parts[i]);\n        }\n        // FormulaType.CELL -> FormulaType.NAMEDRANGE\n        name.setNameDefinition(HSSFFormulaParser.parse(sb.toString(), this, FormulaType.NAMEDRANGE,\n            sheetIndex));\n    }\n}\n\n--------------------------------------------------------------------------------\n\nIs this a bug?"}, {"count": 20, "tags": [], "text": "Thanks for tracking that down. I've changed HSSFWorkbook to set the correct type, and added a unit test for it. Committed in r1069780.", "is_private": false, "id": 144184, "creator": "apache@gagravarr.org", "time": "2011-02-11T07:37:11Z", "bug_id": 46664, "creation_time": "2011-02-11T07:37:11Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "elvis.ciocoiu@everlight.ro", "attachment_id": 31505, "id": 174436, "time": "2014-04-10T10:10:24Z", "bug_id": 56380, "creation_time": "2014-04-10T10:10:24Z", "is_private": false, "text": "Created attachment 31505\nunit test\n\nIf I insert more than 1023 comments in a sheet and after that save the workbook only the last 1023 comments are persisted. I attached a test to that inserts 1025 comments. After saving the comments for the first row and the row 1023 are not persisted."}, {"count": 1, "tags": [], "bug_id": 56380, "attachment_id": 31538, "text": "Created attachment 31538\nUpdate unit test\n\nI have updated the unit test somewhat, but did not yet manage to find the actual problem. BiffViewer shows the items for the comments, so it seems like HSSF reading discards the comments somehow.\n\nIt works for up to 1024 comments, but breaks with 1025!", "id": 174673, "time": "2014-04-17T12:16:29Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2014-04-17T12:16:29Z", "is_private": false}, {"count": 2, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "is_private": false, "id": 174677, "time": "2014-04-17T13:49:00Z", "bug_id": 56380, "creation_time": "2014-04-17T13:49:00Z", "text": "I found the culprit in HSSFComment.setShapeId(int shapeId):\n\nHowever I am not sure why this is in there in the first place and what will happen if we remove this here, need to discuss on the dev-mailing list first...\n\n        cod.setObjectId((short) (shapeId % 1024));\n        _note.setShapeId(shapeId % 1024);"}, {"count": 3, "tags": [], "bug_id": 56380, "is_private": false, "text": "I can only suggest digging out the relevant bit of [MS-XLS] for those record(s), and seeing if that lists any restrictions", "id": 174678, "time": "2014-04-17T13:59:17Z", "creator": "apache@gagravarr.org", "creation_time": "2014-04-17T13:59:17Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 56380, "attachment_id": null, "text": "*** Bug 56445 has been marked as a duplicate of this bug. ***", "id": 175176, "time": "2014-05-12T19:40:18Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2014-05-12T19:40:18Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 56380, "text": "The same applies to HSSFShape.setShapeId(int shapeId)\n\nThere is a \n\ncod.setObjectId((short) (shapeId%1024));\n\n(that is called from HSSFComment.setShapeId(int shapeId) with super.setShapeId(shapeId);)\n\nIs that related with DrawingManager2 and the size of clusters?", "id": 178505, "time": "2014-10-16T11:32:17Z", "creator": "rubensa@gmail.com", "creation_time": "2014-10-16T11:32:17Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 181684, "time": "2015-03-11T20:12:35Z", "bug_id": 56380, "creation_time": "2015-03-11T20:12:35Z", "is_private": false, "text": "*** Bug 55275 has been marked as a duplicate of this bug. ***"}, {"count": 7, "tags": [], "bug_id": 56380, "attachment_id": null, "is_private": false, "id": 181686, "time": "2015-03-11T20:34:32Z", "creator": "daniele.renda@gmail.com", "creation_time": "2015-03-11T20:34:32Z", "text": "Some news or workaround available? Thanks"}, {"count": 8, "attachment_id": null, "creator": "dominik.stadler@gmx.at", "text": "Workaround is to patch and compile POI yourself with the limitation to 1024 entries removed in HSSFComment and report here if it makes it work fine for you until we figure out if the MS spec mandates this limitation or if it is rather some sort of leftover from some old codebase.", "id": 181688, "time": "2015-03-11T20:41:15Z", "bug_id": 56380, "creation_time": "2015-03-11T20:41:15Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "bug_id": 56380, "attachment_id": null, "text": "Here some notes from the spec: \n\n* The id is stored in NoteRecord [2.4.179], which in this case contains a NoteSh [2.5.186]\n** idObj (2 bytes): An ObjId that specifies the Obj record that specifies the comment text.\n*** id (2 bytes): An unsigned integer that specifies the value of the cmo.id field of an Obj in the same\ndrawing. A value of 0 specifies that this ObjId does not reference an Obj.\n\n* The id is also stored in the CommonObjectDataSubRecord\n** The spec seems to have this at FtCmo [2.5.143]\n*** id (2 bytes): An unsigned integer that specifies the identifier of this object. This object identifier is used by other types to refer to this object. The value of id MUST be unique among all Obj records within the Chart Sheet Substream ABNF, Macro Sheet Substream ABNF and Worksheet Substream ABNF.\n\n* Additionally ODRAW has OfficeArtFDGG [2.2.47]\n** spidMax (4 bytes): An MSOSPID structure, as defined in section 2.1.2, specifying the current maximum shape identifier that is used in any drawing. This value MUST be less than 0x03FFD7FF.\n\nThe only place that I could find that is limited to 1024 is the FileIdCluster(), but there are additional ones added when the last one gets to 1024, so I don't see any limitation of 1024 mandated by the spec and would therefore conclude that we can get rid of this.", "id": 181689, "time": "2015-03-11T21:56:35Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-03-11T21:56:35Z", "is_private": false}, {"count": 10, "attachment_id": null, "creator": "dominik.stadler@gmx.at", "is_private": false, "id": 181737, "time": "2015-03-13T16:30:27Z", "bug_id": 56380, "creation_time": "2015-03-13T16:30:27Z", "tags": [], "text": "With r1666505 I have removed the limitation of 1024 comments, the spec has a limit of 65535 as the counter is an unsigned short, we now check that this limit is not violated.\nUnit tests are adjusted accordingly, please report here if you find any regressions caused by this change."}]
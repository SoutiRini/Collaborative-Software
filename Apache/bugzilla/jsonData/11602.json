[{"count": 0, "tags": [], "bug_id": 11602, "is_private": false, "text": "My httpd.conf contains the following section:\n\n   <Directory \"/usr/local/apache/htdocs/skatersupport\">\n        AuthType Basic\n        AuthName  \"Skater Support File Depository\"\n        AuthUserFile /home/jen/passwords\n         Script PUT /cgi-bin/Put\n        <Limit PUT>\n          require valid-user\n        </Limit>\n   </Directory>\n\nAs a belt-and-suspenders measure, the PUT method handler script\nchecks to make sure that the REMOTE_USER environment variable\nhas been populated by the server.  This is to protect \nagainst the possibility of misconfiguration; if someone managed\nsomehow to invoke the PUT handler script without having authenticated\nthemselves, the script would abort.  This worked with Apache \n1.3.12, 1.3.19, and 1.3.22.\n\nHowever, beginning with at least Apache 2.0.36, the REMOTE_USER\nvariable is not set when the handler script is invoked, regardless\nof whether the request included valid credentials.  The AuthUserFile\nis correctly checked, and the script is only run when the credentials are valid,\nbut the script itself cannot determine the identity of \nthe remote user.  The problem persists in 2.0.39.  \n\nTo test this, I first instrumented the script so that it would dump\nout its environment to the file /tmp/Put.err.  I then used a Perl utility\nto send a PUT request to the server:\n\nPUT -C mjd:badpassword  http://www.plover.com/skatersupport/TESTFILE < /dev/null\n\nThe Put.err file did not appear, and PUT reported that the server's response\nwas a 401 Authorization Required.  Then I tried sending the same request\nwith the correct password:\n\nPUT -C mjd:goodpassword  http://www.plover.com/skatersupport/TESTFILE <\n/dev/null\n\nAgain, PUT reported a 401 error, but this time the 401 was artificially\ngenerated by the PUT handler script.  The Put.err file did appear, and\ncontained a listing of the environment:\n\n\n\tCONTENT_LENGTH: 0\n\tCONTENT_TYPE: text/plain\n\tDOCUMENT_ROOT: /usr/local/apache/htdocs\n\t...\n\tREMOTE_PORT: 4106\n\tREQUEST_METHOD: PUT\n\t...\n\tSERVER_PROTOCOL: HTTP/1.1\n\tSERVER_SIGNATURE: <address>Apache/2.0.39 Server at www.plover.com Port\n80</address>\n\n\tSERVER_SOFTWARE: Apache/2.0.39 (Unix)\n\nAs you can see, the REMOTE_USER variable is missing.  The Put.err file ended\nwith \n\n\tREMOTE_USER missing; generating authorization failure response.\n\nindicating that the 401 response was from the handler script and not\nfrom the httpd.\n\nThis may be the same bug as #10678.", "id": 20861, "time": "2002-08-10T01:41:44Z", "creator": "mjd-apache-bugzilla+@plover.com", "creation_time": "2002-08-10T01:41:44Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "mjd-apache-bugzilla+@plover.com", "is_private": false, "text": "The following patch fixes this problem, but\nI do not know what else it might break.\n\n--- modules/http/http_request.c 2002/08/10 02:10:06     1.1\n+++ modules/http/http_request.c 2002/08/10 02:10:38\n@@ -360,6 +360,7 @@\n     new->no_local_copy   = r->no_local_copy;\n     new->read_length     = r->read_length;     /* We can only read it once */\n     new->vlist_validator = r->vlist_validator;\n+    new->user            = r->user; /* 20020809 mjd-apache-patch+@plover.com */\n \n     new->proto_output_filters  = r->proto_output_filters;\n     new->proto_input_filters   = r->proto_input_filters;\n", "id": 20863, "time": "2002-08-10T02:37:21Z", "bug_id": 11602, "creation_time": "2002-08-10T02:37:21Z", "attachment_id": null}, {"count": 2, "text": "Created attachment 2677\nNaive patch", "bug_id": 11602, "is_private": false, "id": 20864, "time": "2002-08-10T02:39:28Z", "creator": "mjd-apache-bugzilla+@plover.com", "creation_time": "2002-08-10T02:39:28Z", "tags": [], "attachment_id": 2677}, {"count": 3, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "id": 21320, "time": "2002-08-19T18:47:09Z", "bug_id": 11602, "creation_time": "2002-08-19T18:47:09Z", "is_private": false, "text": "See also bug 10678"}, {"count": 4, "text": "\n\n*** This bug has been marked as a duplicate of 10678 ***", "bug_id": 11602, "is_private": false, "id": 40669, "time": "2003-07-14T21:13:21Z", "creator": "nd@perlig.de", "creation_time": "2003-07-14T21:13:21Z", "tags": [], "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 43494, "attachment_id": null, "text": "With mod_cgi scripts that do not produce any output over a certain period of\ntime are killed.\n\nWith mod_cgid they hang forever.", "id": 108657, "time": "2007-09-26T11:29:05Z", "creator": "torsten.foertsch@gmx.net", "creation_time": "2007-09-26T11:29:05Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 43494, "attachment_id": 22316, "text": "Created attachment 22316\nAdding a timeout watch for mod_cgid (first cut)\n\nThis patch adds a timeout thread to the cgid daemon, which checks for processes that have timedout.\nA better solution would have been to set a timeout on the receiving socket from cgi. But unfortunately the unix sockets that are used to link the cgi process and handler do not alow SO_SNDTIMEIO and SO_RCVTIMEO to be set.\n\nI suspect there are better approaches, please do let me know how else this can be done.", "id": 119016, "time": "2008-07-25T05:33:15Z", "creator": "rahul.g.nair@gmail.com", "creation_time": "2008-07-25T05:33:15Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 43494, "attachment_id": null, "text": "It would be best to make use of the existing nonblock+poll timeout implementation in apr, such that when the apr-wrapped AF_UNIX socket is read from, read will return APR_TIMEUP at the right time.  The current apr representation of the AF_UNIX socket may not be the best choice, or we may not be setting it up properly.  (Or this may be a hopeless goal without new apis in apr trunk :( )\n\nIf at all possible, mod_cgid should avoid threads; having a single-threaded process to fork/setup/exec the children is a feature to avoid unexpected inheritance.  One specialized thread to worry about shouldn't be too hard, but even in the current implementation I am hoping the inheritance of the occasional locked state of new mutex would get repaired automatically once the child does exec() and we wouldn't need to use pthread_atfork().\n", "id": 119031, "time": "2008-07-25T11:57:52Z", "creator": "trawick@apache.org", "creation_time": "2008-07-25T11:57:52Z", "is_private": false}, {"count": 3, "tags": [], "text": "Created attachment 22324\nthreadless patch for cgid timeout\n\n> It would be best to make use of the existing nonblock+poll timeout\n> implementation in apr\nCurrently, as far as I can see, APR does not know about UNIX sockets, and\nwould have to mess with the private apr headers and datastructures under arch\nto do it.\n\n> If at all possible, mod_cgid should avoid threads; having a single-threaded\n> process to fork/setup/exec the children is a feature to avoid unexpected\n> inheritance.\n\nThanks, I hadn't thought about it.\nI am adding a new patch which checks it using SIGALRM instead.", "attachment_id": 22324, "id": 119078, "creator": "rahul.g.nair@gmail.com", "time": "2008-07-28T06:53:00Z", "bug_id": 43494, "creation_time": "2008-07-28T06:53:00Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 43494, "text": "Created attachment 30110\npatch for timeout\n\nI have created another patch to fix this bug by adding just one line.\nThe tempsock is wrapped file descriptor, so apr_file_pipe_timeout_set can be used to set timeout.\nThis patch was tested on httpd 2.4.4 and works correctly.", "id": 166193, "time": "2013-03-28T09:07:28Z", "creator": "toshikuni-fukaya@cybozu.co.jp", "creation_time": "2013-03-28T09:07:28Z", "is_private": false, "attachment_id": 30110}, {"count": 5, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "id": 170766, "time": "2013-10-23T13:09:45Z", "bug_id": 43494, "creation_time": "2013-10-23T13:09:45Z", "is_private": false, "text": "I fear that since mod_cgid has never timed anything out in so many years, that in 2.4 and 2.2 this would have to be based on a new configuration directive.  I also see that mod_cgi sets a number of pipe timeouts, and there is also an NPH path where the pipe is created/read."}, {"count": 6, "tags": [], "creator": "covener@gmail.com", "text": "Committed a version with a new directive to trunk in 1535125, thanks Toshikuni for the patch.", "id": 170779, "time": "2013-10-23T19:27:14Z", "bug_id": 43494, "creation_time": "2013-10-23T19:27:14Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 33160, "attachment_id": null, "text": "BRIEF DESCRIPTION:\n-------------------------------------------------\nEntering a simple cell formula string like : \"40000\" gives\nNumberFormatException, Value out of range. Value:\"40000\" Radix:10\nThis is bug because Excel accepts the formulas in this format (ie. if entered as\n=40000) and evaluates it correctly. (Also if formula is entered directly via\nexcel it is retained on closing and reopening the file)\n\n\nCODE DEMONSTRATING THE BUG:\n-------------------------------------------------\nimport org.apache.poi.hssf.usermodel.HSSFCell;\nimport org.apache.poi.hssf.usermodel.HSSFRow;\nimport org.apache.poi.hssf.usermodel.HSSFSheet;\nimport org.apache.poi.hssf.usermodel.HSSFWorkbook;\npublic class TestPOI {\n    public static void main(String[] args) throws Exception {\n        HSSFWorkbook workbook = new HSSFWorkbook();\n        HSSFSheet sheet = workbook.createSheet();\n        HSSFRow row = sheet.createRow(0);\n        HSSFCell cell = row.createCell((short) 0);\n        cell.setCellFormula(\"40000\");\n    }\n}\n\n-------------------------------------------------\n\nThe exception trace is:\njava.lang.NumberFormatException: Value out of range. Value:\"40000\" Radix:10\n\tat java.lang.Short.parseShort(Unknown Source)\n\tat java.lang.Short.parseShort(Unknown Source)\n\tat org.apache.poi.hssf.record.formula.IntPtg.<init>(IntPtg.java:58)\n\tat org.apache.poi.hssf.model.FormulaParser.Factor(FormulaParser.java:486)\n\tat org.apache.poi.hssf.model.FormulaParser.Term(FormulaParser.java:548)\n\tat org.apache.poi.hssf.model.FormulaParser.Expression(FormulaParser.java:596)\n\tat org.apache.poi.hssf.model.FormulaParser.parse(FormulaParser.java:700)\n\tat org.apache.poi.hssf.usermodel.HSSFCell.setCellFormula(HSSFCell.java:678)\n\tat TestPOI.main(TestPOI.java:11)", "id": 69824, "time": "2005-01-18T22:15:52Z", "creator": "amolweb@yahoo.com", "creation_time": "2005-01-18T22:15:52Z", "is_private": false}, {"count": 1, "text": "***** fix suggestion ******\n\nFollowing the stack trace in the source code, the exception is at foll. place in\ncode:\n\n// class: org.apache.poi.hssf.model.FormulaParser, line 486\n\ntokens.add(new IntPtg(number)); //TODO:what if the number is too big to be a\nshort? ..add factory to return Int or Number!\n\n\nPerhaps IntPtg is used instead of NumberPtg for efficiency of storage? But since\nit breaks the functionality for large values (since internal representation for\nIntPtg is short), could a temporary fix be made that uses NumberPtg instead of\nIntPtg till the TODO is actually resolved? I have tried that change on my local\nsource and it works fine.\n\n", "bug_id": 33160, "attachment_id": null, "id": 69926, "time": "2005-01-21T15:51:16Z", "creator": "amolweb@yahoo.com", "creation_time": "2005-01-21T15:51:16Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 33160, "attachment_id": null, "text": "(In reply to comment #1)\n\n> I have tried that change on my local\n> source and it works fine.\n> \nPatch? Pretty please! :)\n\n", "id": 69927, "time": "2005-01-21T16:05:19Z", "creator": "avik@apache.org", "creation_time": "2005-01-21T16:05:19Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 33160, "attachment_id": 14064, "text": "Created attachment 14064\nChanged use of IntPtg to NumberPtg in class org.apache.poi.hssf.model.FormulaParser\n\nOnly one line of code is changed by the proposed patch.\nThe original line also had a comment:\n\nTODO:what if the number is too big to be a short? ..add factory to return Int\nor Number!\n\nIf this original TODO task was implemented, the bug would be fixed. This patch\ndoes NOT implement the TODO task! But it provides a temporary workaround by\nusing NumberPtg instead of IntPtg which avoids the NumberFormat exception\nthrown when parsing strings into numbers larger than Short.MAX_VALUE.\n\nThe original comment is preserved in the patched code, additional comment has\nben added indicating that this is a temporary fix.", "id": 69935, "time": "2005-01-21T20:22:01Z", "creator": "amolweb@yahoo.com", "creation_time": "2005-01-21T20:22:01Z", "is_private": false}, {"count": 4, "tags": [], "creator": "amolweb@yahoo.com", "text": "Ignore patch submitted here: New Patch submitted as attachment to issue #33375", "id": 70426, "time": "2005-02-02T23:10:42Z", "bug_id": 33160, "creation_time": "2005-02-02T23:10:42Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "avik@apache.org", "attachment_id": null, "id": 73898, "time": "2005-04-21T15:02:35Z", "bug_id": 33160, "creation_time": "2005-04-21T15:02:35Z", "is_private": false, "text": "*** Bug 33375 has been marked as a duplicate of this bug. ***"}, {"count": 6, "tags": [], "creator": "avik@apache.org", "attachment_id": null, "id": 73899, "time": "2005-04-21T15:02:51Z", "bug_id": 33160, "creation_time": "2005-04-21T15:02:51Z", "is_private": false, "text": "Fixed. "}]
[{"count": 0, "tags": [], "bug_id": 48637, "attachment_id": null, "is_private": false, "id": 134002, "time": "2010-01-28T14:32:25Z", "creator": "edbrannin@gmail.com", "creation_time": "2010-01-28T14:32:25Z", "text": "This bug exists in 1.7.0 and 1.8.0RC1, and has existed since at least November 2008: http://bit.ly/d8ydaU\n\nUsing only the \"source\" attribute on <sound>'s <success> and <fail> elements, the sound task does nothing.\n\nAs the email thread above says, using the duration task causes the sound to loop forever.\n\nI'm attaching a proof-of-concept, including some sounds and a tiny Java class that proves javax.sound works."}, {"count": 1, "tags": [], "bug_id": 48637, "attachment_id": 24902, "id": 134003, "creation_time": "2010-01-28T14:34:42Z", "time": "2010-01-28T14:34:42Z", "creator": "edbrannin@gmail.com", "text": "Created attachment 24902\nProof-of-problem project.", "is_private": false}, {"count": 2, "tags": [], "bug_id": 48637, "text": "Created attachment 24905\nPatch against 1.8.0RC1 to fix both issues (and fix some comment spelling)\n\nI downloaded the 1.8.0RC1 source distribution and fixed both issues this morning.\n\n===\n\nIn org.apache.tools.ant.taskdefs.optional.sound.AntSoundPlayer.playClip(Clip, int): \nThere was a race condition between clip.loop() and clip.isRunning() where the system could exit before the clip started.\n\nI don't like how this takes one busy-wait and turns it into two busy-waits, and am going to replace them with a do/try/sleep loop in a minute.  I'm uploading this patch now in case you prefer this version.\n\nIn org.apache.tools.ant.taskdefs.optional.sound.AntSoundPlayer.playClip(Clip, long):\nclip.loop(Clip.LOOP_CONTINUOUSLY) and the ensuing Thread.sleep(duration) worked fine, but no one ever called clip.stop() at the end.", "id": 134023, "time": "2010-01-29T07:44:31Z", "creator": "edbrannin@gmail.com", "creation_time": "2010-01-29T07:44:31Z", "is_private": false, "attachment_id": 24905}, {"count": 3, "tags": [], "bug_id": 48637, "text": "Created attachment 24906\nPatch against 1.8.0RC1 to fix both issues (and fix some comment spelling) - PLUS no more busy-waits.\n\nThe original code (and my original fix) would busy-wait for the sound to finish playing.  On my system, the \"empty\" loops (now with \"waits += 1\") ran about 940 million times.\n\nThis patch reduces the wait-count to around 2-20.  Higher wait-counts are from  the lag between clip.getMicrosecondLength() == clip.getMicrosecondPosition() and clip.isRunning() going back to false.", "id": 134026, "time": "2010-01-29T08:02:54Z", "creator": "edbrannin@gmail.com", "creation_time": "2010-01-29T08:02:54Z", "is_private": false, "attachment_id": 24906}, {"count": 4, "tags": [], "bug_id": 48637, "attachment_id": 24907, "id": 134027, "time": "2010-01-29T08:12:16Z", "creator": "edbrannin@gmail.com", "creation_time": "2010-01-29T08:12:16Z", "is_private": false, "text": "Created attachment 24907\nA test class that explains and demonstrates both issues (uses Windows sounds by default).\n\nHere's a test class that reproduces the issue, directly using the AntSoundPlayer class.  It uses c:\\windows\\media\\tada.wav by default, so you'll have to change the path if you're on OS X or Linux.\n\nI'm obsoleting the attachment that reproduced the issues via an ant buildfile.\n\nI didn't write it as a JUnit test because it requires some manual input and verification."}, {"text": "Comment on attachment 24907\nA test class that explains and demonstrates both issues (uses Windows sounds by default).\n\nupdating the MIIME type to text/x-java-source", "tags": [], "bug_id": 48637, "is_private": false, "count": 5, "id": 134028, "time": "2010-01-29T08:16:53Z", "creator": "edbrannin@gmail.com", "creation_time": "2010-01-29T08:16:53Z", "attachment_id": 24907}, {"text": "Actually I started looking into the issue just before you attached your first patch.  I'm about to commit a modified version of your second patch in a few minutes (by sheer luck I ran into a situation where timeLeft turned negative in my very first loop test).\n\nThe race condition never occurred with Java 1.4 for me, but I always heard the results you described when using 1.6.  The patched version works on either Java version.", "tags": [], "bug_id": 48637, "is_private": false, "count": 6, "id": 134029, "time": "2010-01-29T08:23:16Z", "creator": "bodewig@apache.org", "creation_time": "2010-01-29T08:23:16Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 48637, "attachment_id": null, "is_private": false, "id": 134030, "time": "2010-01-29T08:26:43Z", "creator": "bodewig@apache.org", "creation_time": "2010-01-29T08:26:43Z", "text": "svn revision 904546\n\nThanks!"}]
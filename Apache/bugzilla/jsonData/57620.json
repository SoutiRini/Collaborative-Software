[{"count": 0, "attachment_id": null, "bug_id": 57620, "text": "Hi POI,\n\nif we try to call the method org.apache.poi.ss.usermodel.Sheet.shiftRows() processing the attached excel-file, we get a FormulaParseException. The reason for that is that the api generates a prefix at the beginning of the formula that cannot be parsed later by the method org.apache.poi.ss.formula.FormulaParser.parseSheetName(): the generated prefix will be '[1]' for the concrete situation shown in the attached excel-file (POI_BUG.xlsx).\n\nYou can reproduce the problem by loading the attached excel-file (POI_BUG.xlsx) and try to shift any row by calling org.apache.poi.ss.usermodel.Sheet.shiftRows(). You will get a StackTrace like the one shown below.\n\nMind: the source of the problem is, like mentioned above, the method org.apache.poi.ss.formula.FormulaParser.parseSheetName(): The formula-parts are not correctly parsed and that leads to the FormulaParseException. We have developed a fix that we would like to suggest to you. see attached txt-file (FIX_parseSheetname.txt):\n\n\n\nStackTrace:\n\norg.apache.poi.ss.formula.FormulaParseException: Parse error near char 0 '[' in specified formula '[1]!lucanet(\"fin\",\"ist\",\"Rohdaten\",C10,$B10,\"m\",F$4)'. Expected number, string, or defined name\n\tat org.apache.poi.ss.formula.FormulaParser.expected(FormulaParser.java:219)\n\tat org.apache.poi.ss.formula.FormulaParser.parseNonRange(FormulaParser.java:549)\n\tat org.apache.poi.ss.formula.FormulaParser.parseRangeable(FormulaParser.java:429)\n\tat org.apache.poi.ss.formula.FormulaParser.parseRangeExpression(FormulaParser.java:268)\n\tat org.apache.poi.ss.formula.FormulaParser.parseSimpleFactor(FormulaParser.java:1119)\n\tat org.apache.poi.ss.formula.FormulaParser.percentFactor(FormulaParser.java:1079)\n\tat org.apache.poi.ss.formula.FormulaParser.powerFactor(FormulaParser.java:1066)\n\tat org.apache.poi.ss.formula.FormulaParser.Term(FormulaParser.java:1426)\n\tat org.apache.poi.ss.formula.FormulaParser.additiveExpression(FormulaParser.java:1526)\n\tat org.apache.poi.ss.formula.FormulaParser.concatExpression(FormulaParser.java:1510)\n\tat org.apache.poi.ss.formula.FormulaParser.comparisonExpression(FormulaParser.java:1467)\n\tat org.apache.poi.ss.formula.FormulaParser.unionExpression(FormulaParser.java:1447)\n\tat org.apache.poi.ss.formula.FormulaParser.parse(FormulaParser.java:1568)\n\tat org.apache.poi.ss.formula.FormulaParser.parse(FormulaParser.java:176)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFRowShifter.shiftFormula(XSSFRowShifter.java:189)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFRowShifter.updateRowFormulas(XSSFRowShifter.java:153)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFRowShifter.updateSheetFormulas(XSSFRowShifter.java:140)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFRowShifter.updateFormulas(XSSFRowShifter.java:127)\n\tat org.apache.poi.xssf.usermodel.XSSFSheet.shiftRows(XSSFSheet.java:2465)", "id": 181248, "time": "2015-02-23T11:03:19Z", "creator": "g.youansisiewe@lucanet.com", "creation_time": "2015-02-23T11:03:19Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 32508\nExcel-File (POI_BUG.xlsx) to trigger a FormulaParseException. And Fix for org.apache.poi.ss.formula.FormulaParser.parseSheetName()", "attachment_id": 32508, "bug_id": 57620, "id": 181249, "time": "2015-02-23T11:04:26Z", "creator": "g.youansisiewe@lucanet.com", "creation_time": "2015-02-23T11:04:26Z", "is_private": false}, {"count": 2, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 181255, "time": "2015-02-23T14:01:30Z", "bug_id": 57620, "creation_time": "2015-02-23T14:01:30Z", "is_private": false, "text": "3.10 is a little old, and there have been quite a few Formula Parser fixes since then\n\nAny chance you could try with the 3.12 beta 1 release candidate, and see if that's already fixed?"}, {"count": 3, "text": "Hi POI,\n\ni just tried with the version 3.12 beta 2. \nThe problem still occurs.", "bug_id": 57620, "is_private": false, "id": 181319, "time": "2015-02-25T09:58:34Z", "creator": "g.youansisiewe@lucanet.com", "creation_time": "2015-02-25T09:58:34Z", "tags": [], "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 57620, "text": "Any chance you could re-format your proposed fix as a patch? http://poi.apache.org/guidelines.html#SubmittingPatches has some advice on that\n\nAlso, if you could write a small unit test based on your test file, which shows the problem + verifies that your fix corrects it, that'd be most helpful!", "id": 181320, "attachment_id": null, "creator": "apache@gagravarr.org", "creation_time": "2015-02-25T10:09:34Z", "time": "2015-02-25T10:09:34Z", "is_private": false}]
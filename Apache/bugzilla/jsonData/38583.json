[{"count": 0, "tags": [], "bug_id": 38583, "attachment_id": null, "text": "If someone uses a line like '--------------------' in the commit message,\nit confuses the CVSChangelogParser, and it eventually throws an\nIllegalStateException from the processGetPreviousRevision method.\n\nSince this parser is receiving an output of a running CVS process,\nthis exception is propagated up and eventually hit the StreamPumper.run method,\nand caught by its exception block.\n\nThe pump thread eventually exits, but when it does so it leaves the InputStream\nopen. So now no one is draining the pipe.\n\nCVS, since it doesn't know that no one is draining the pipe, continues to fill\nin the pipe with more output. Eventually, the pipe fills up (at the OS level),\nand OS blocks the CVS process until this pipe is drained. But like I mentioned,\nno one is draining this pipe, so it blocks forever.\n\nAnt is blocking on the completion of this CVS process, so as a whole\nthis causes a deadlock.\n\n\nBut I'm not exactly sure how to fix this. I first thought about just closing the\ninput when something goes wrong:\n\n\n        try {\n            while ((length = is.read(buf)) > 0) {\n                os.write(buf, 0, length);\n            }\n        } catch (Exception e) {\n            is.close();\n        } finally {\n\nBut the java.lang.Process doesn't say much about what happens if you close\na stream when the other process is still writing it. Perhaps bits get ignored,\nperhaps it's not.\n\nAlternatively, StreamPumper can also just drain the input even if the write\noperation fails.\n\n        try {\n            while ((length = is.read(buf)) > 0) {\n                os.write(buf, 0, length);\n            }\n        } catch (Exception e) {\n            // drain the pipe anyway\n            while ((length = is.read(buf)) > 0)\n                ;\n        } finally {\n\n\nIn any case I hope this bug gets fixed soon.", "id": 85617, "time": "2006-02-09T02:39:58Z", "creator": "kk@kohsuke.org", "creation_time": "2006-02-09T02:39:58Z", "is_private": false}, {"count": 1, "text": "\n\n*** This bug has been marked as a duplicate of bug 8085 ***", "creator": "bodewig@apache.org", "attachment_id": null, "id": 121612, "time": "2008-10-16T07:08:54Z", "bug_id": 38583, "creation_time": "2008-10-16T07:08:54Z", "tags": [], "is_private": false}]
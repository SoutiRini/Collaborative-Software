[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "Created attachment 26050\nstacktrace\n\nObserving this with the current trunk (at rev. 998656).\nIt does not happen with 7.0.2, so it is some recent regression.\n\nThe problem is that when I stop Tomcat all subdirectories in ${catalina.base}/work/Catalina/localhost are deleted.\n\nSteps to reproduce:\n1. Build Tomcat 7.0\n2. Set JRE_HOME variable. Go to output/build/bin/ and run catalina.bat start\n3. Access http://localhost:8080/examples/jsp/jsp2/el/basic-arithmetic.jsp\n4. Note, that there is compiled class file in\noutput/build/work/Catalina/localhost/examples/org/apache/jsp/jsp/jsp2/el/\n5. Run catalina.bat stop\n6. Actual behaviour: output/build/work/Catalina/localhost/ is now empty.\nExpected behaviour: see step 4.\n\n\nThe catalina.log file has \"INFO: Deploying web application directory\" lines it it, but there are no logs about any webapps being undeployed.\n\nI have run TC7 in debug mode with breakpoints in ExpandWar.delete(..) and the deletion happens in ContextConfig.destroy().\n\n        // Changed to getWorkPath per Bugzilla 35819.\n        String workDir = ((StandardContext) context).getWorkPath();\n        if (workDir != null)\n            ExpandWar.delete(new File(workDir));\n\nI am attaching the full stacktrace.\n\nThe code itself looks old. I suspect that the destroy event was not passed to ContextConfig until recently.", "id": 139958, "attachment_id": 26050, "bug_id": 49957, "creation_time": "2010-09-19T11:39:18Z", "time": "2010-09-19T11:39:18Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 49957, "attachment_id": null, "id": 140525, "time": "2010-10-06T18:54:39Z", "creator": "markt@apache.org", "creation_time": "2010-10-06T18:54:39Z", "is_private": false, "text": "Fixed in trunk and will be in 7.0.4 onwards."}]
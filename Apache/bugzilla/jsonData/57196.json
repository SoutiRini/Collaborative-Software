[{"count": 0, "attachment_id": 32200, "creator": "jzhao@talend.com", "text": "Created attachment 32200\ntest file\n\nPlease see the attache file[toto.xlsx] and code:\nInputStream inp = new FileInputStream(\"E:/test_file/toto.xlsx\");\nWorkbook wb = WorkbookFactory.create(inp);\nSheet sheet = wb.getSheet(\"Feuil1\");\nRow mod=sheet.getRow(1);\nmod.getCell(1).setCellValue(3);\nHSSFFormulaEvaluator.evaluateAllFormulaCells(wb);\nileOutputStream fileOutput = new FileOutputStream(\"E:/test_file/toto.xlsx\");\nwb.write(fileOutput);\nfileOutput.close();\n\n1.toto.xlsx include \"HEX2DEC\" function\n2.We change one cell value of the sheet.\n3.call HSSFFormulaEvaluator.evaluateAllFormulaCells(wb) to Re-calculating the cell value\nWhen run the code we got the exception:\njava.lang.IllegalArgumentException: Unexpected eval class (org.apache.poi.ss.formula.LazyRefEval)\n\tat org.apache.poi.ss.formula.eval.OperandResolver.coerceValueToString(OperandResolver.java:275)\n\tat org.apache.poi.ss.formula.functions.Hex2Dec.evaluate(Hex2Dec.java:46)\n\tat org.apache.poi.ss.formula.functions.Hex2Dec.evaluate(Hex2Dec.java:58)\n\tat org.apache.poi.ss.formula.UserDefinedFunction.evaluate(UserDefinedFunction.java:64)\n\tat org.apache.poi.ss.formula.OperationEvaluatorFactory.evaluate(OperationEvaluatorFactory.java:129)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:525)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:288)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:230)\n\tat org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateFormulaCellValue(XSSFFormulaEvaluator.java:264)\n\tat org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateFormulaCell(XSSFFormulaEvaluator.java:151)\n\tat org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateAllFormulaCells(HSSFFormulaEvaluator.java:324)\n\tat org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateAllFormulaCells(HSSFFormulaEvaluator.java:315)\n\tat org.talend.test.TestPOI.main(TestPOI.java:49)", "id": 179021, "time": "2014-11-10T09:38:58Z", "bug_id": 57196, "creation_time": "2014-11-10T09:38:58Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 57196, "text": "Can you try with POI 3.11 beta 2, or even beta the Release Candidate for POI 3.11 beta 3? (Link for the latter available on the dev@poi.apache.org mailing list archive)", "id": 179022, "time": "2014-11-10T09:50:04Z", "creator": "apache@gagravarr.org", "creation_time": "2014-11-10T09:50:04Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "jzhao@talend.com", "attachment_id": null, "is_private": false, "id": 179023, "time": "2014-11-10T09:57:40Z", "bug_id": 57196, "creation_time": "2014-11-10T09:57:40Z", "text": "I have been test the latest beta version, the problem still exists.\n> Can you try with POI 3.11 beta 2, or even beta the Release Candidate for POI\n> 3.11 beta 3? (Link for the latter available on the dev@poi.apache.org\n> mailing list archive)"}, {"count": 3, "tags": [], "bug_id": 57196, "text": "Hello,\n\nI just encounter the same problem, with the same Appache POI version (3.10).\nMy formulae look like \"DEC2HEX(HEX2DEC(O8)-O2+D2)\"\nwith O8 = \"0005B0A3\", O2 = \"372736\" and D2 = \"376832\".\n\nI've tryed with the simplified (and meaningless for my application) formulae of the kind \"DEC2HEX(O2+D2)\" and the evaluations are successful.\nTherefore it seems to be specific to HEX2DEC (or to a bad use of the function).\n\n\nThanks to every people participating to this valuable project.\n\nGaillac", "id": 179205, "time": "2014-11-20T14:57:43Z", "creator": "o.odent@gmail.com", "creation_time": "2014-11-20T14:57:43Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "Fixed in r1650597, the Hex2Dec function implementation needs to take RefEvals into account to work in these cases.", "is_private": false, "bug_id": 57196, "id": 180245, "time": "2015-01-09T16:52:17Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-01-09T16:52:17Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "BTW, I found and fixed similar problems in Bin2Dec and some unrelated smaller issues in Dec2Bin, see r1650654", "is_private": false, "bug_id": 57196, "id": 180246, "time": "2015-01-09T20:37:31Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-01-09T20:37:31Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "o.odent@gmail.com", "text": "Thank you, it works perfectly now.", "id": 191336, "time": "2016-05-31T17:38:19Z", "bug_id": 57196, "creation_time": "2016-05-31T17:38:19Z", "tags": [], "is_private": false}]
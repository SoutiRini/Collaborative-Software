[{"count": 0, "tags": [], "bug_id": 38695, "is_private": false, "text": "I have such a simple class, which uses a class included in JVM:\n \nimport com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl;\npublic class Test {\n  public static void main (String[] args) {\n    SAXParserFactoryImpl x = new SAXParserFactoryImpl();\n    System.out.println(\" x is \" + x);\n  }  \n}\n \nIn a Windows console: (also reproducible on a Unix system)\n>echo %JAVA_HOME%\nD:\\jdk1.5.0_05\n \n>java -version\njava version \"1.5.0_05\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_05-b05)\nJava HotSpot(TM) Client VM (build 1.5.0_05-b05, mixed mode, sharing)\n \nIt works when executed directly:\n>java Test\n x is com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl@82ba41\n \nBut has problem with ant:\nI have such an xml file:\n<?xml version=\"1.0\"?>\n<project default=\"test\" basedir=\".\">\n  <target name=\"init\">\n    <path id=\"lib.path\">\n      <dirset dir=\".\"/>\n    </path>\n  </target>\n  \n  <target name=\"test\" depends=\"init\">\n   <java classname=\"Test\" classpathref=\"lib.path\" fork=\"false\">\n    </java>\n  </target>   \n</project>\n \nWhen run the test target, I got:\n \nBuildfile: test.xml\n \ninit:\n \ntest:\n     [java] java.lang.NoClassDefFoundError:\ncom/sun/org/apache/xerces/internal/jaxp/SAXParserFactory\nImpl\n     [java]     at\norg.apache.tools.ant.taskdefs.ExecuteJava.execute(ExecuteJava.java:172)\n     [java]     at org.apache.tools.ant.taskdefs.Java.run(Java.java:705)\n     [java]     at org.apache.tools.ant.taskdefs.Java.executeJava(Java.java:177)\n     [java]     at org.apache.tools.ant.taskdefs.Java.execute(Java.java:83)\n     [java]     at\norg.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n     [java]     at org.apache.tools.ant.Task.perform(Task.java:364)\n     [java]     at org.apache.tools.ant.Target.execute(Target.java:341)\n     [java]     at org.apache.tools.ant.Target.performTasks(Target.java:369)\n     [java]     at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n     [java]     at org.apache.tools.ant.Project.executeTargets(Project.java:1062)\n     [java]     at org.apache.tools.ant.Main.runBuild(Main.java:680)\n     [java]     at org.apache.tools.ant.Main.startAnt(Main.java:191)\n     [java]     at org.apache.tools.ant.launch.Launcher.run(Launcher.java:196)\n     [java]     at org.apache.tools.ant.launch.Launcher.main(Launcher.java:55)\n     [java] Caused by: java.lang.NoClassDefFoundError:\ncom/sun/org/apache/xerces/internal/jaxp/SAXPa\nrserFactoryImpl\n     [java]     at Test.main(Test.java:5)\n     [java]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n     [java]     at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n     [java]     at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java\n:25)\n     [java]     at java.lang.reflect.Method.invoke(Method.java:585)\n     [java]     at\norg.apache.tools.ant.taskdefs.ExecuteJava.run(ExecuteJava.java:193)\n     [java]     at\norg.apache.tools.ant.taskdefs.ExecuteJava.execute(ExecuteJava.java:130)\n     [java]     ... 13 more\n     [java] --- Nested Exception ---\n     [java] java.lang.NoClassDefFoundError:\ncom/sun/org/apache/xerces/internal/jaxp/SAXParserFactory\nImpl\n     [java]     at Test.main(Test.java:5)\n     [java]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n     [java]     at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n     [java]     at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java\n:25)\n     [java]     at java.lang.reflect.Method.invoke(Method.java:585)\n     [java]     at\norg.apache.tools.ant.taskdefs.ExecuteJava.run(ExecuteJava.java:193)\n     [java]     at\norg.apache.tools.ant.taskdefs.ExecuteJava.execute(ExecuteJava.java:130)\n     [java]     at org.apache.tools.ant.taskdefs.Java.run(Java.java:705)\n     [java]     at org.apache.tools.ant.taskdefs.Java.executeJava(Java.java:177)\n     [java]     at org.apache.tools.ant.taskdefs.Java.execute(Java.java:83)\n     [java]     at\norg.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n     [java]     at org.apache.tools.ant.Task.perform(Task.java:364)\n     [java]     at org.apache.tools.ant.Target.execute(Target.java:341)\n     [java]     at org.apache.tools.ant.Target.performTasks(Target.java:369)\n     [java]     at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n     [java]     at org.apache.tools.ant.Project.executeTargets(Project.java:1062)\n     [java]     at org.apache.tools.ant.Main.runBuild(Main.java:680)\n     [java]     at org.apache.tools.ant.Main.startAnt(Main.java:191)\n     [java]     at org.apache.tools.ant.launch.Launcher.run(Launcher.java:196)\n     [java]     at org.apache.tools.ant.launch.Launcher.main(Launcher.java:55)\n \nBUILD SUCCESSFUL\nTotal time: 1 second\n \nAnd the actual command issued by ant is\n\"java.exe\" -Xms32m -Xmx512m -Dfile.encoding=UTF-8 -classpath\n\"lib\\ant-launcher.jar\" \"-Dant.home=E:\\niku\\main\\build\\tools\\bin\\\\..\"\norg.apache.tools.ant.launch.Launcher  -f test.xml\n \nby executing which I can get the same exception as above.\n\nBut if I specify fork=\"true\", it works. I.e. the JVM in which ant Launcher is\nrunning the JVM class SAXParserFactoryImpl is screwed up. A new JVM does not\nhave the issue.", "id": 85891, "time": "2006-02-17T18:30:10Z", "creator": "jay_yan@yahoo.com", "creation_time": "2006-02-17T18:30:10Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 38695, "attachment_id": null, "id": 85915, "time": "2006-02-18T22:57:25Z", "creator": "stevel@apache.org", "creation_time": "2006-02-18T22:57:25Z", "is_private": false, "text": "This is fixed in Ant1.7; added an extra passthrough for Java1.5. For now, just\nfork if you can."}]
[{"count": 0, "text": "This patch restores the compatibility variables as advertised in the manual and\nthe stock httpd.conf.\n\nEnjoy,\nAnthony\n\ndiff -Nurd httpd-2.0.40-orig/modules/ssl/ssl_engine_kernel.c\nhttpd-2.0.40/modules/ssl/ssl_engine_kernel.c\n--- httpd-2.0.40-orig/modules/ssl/ssl_engine_kernel.c\tMon Jun 10 21:54:01 2002+++ httpd-2.0.40/modules/ssl/ssl_engine_kernel.c\tFri Sep 13 10:08:33 2002@@ -1099,6 +1099,61 @@\n     NULL\n };\n \n+static const char *ssl_hook_Compat_vars[][2] = {\n+    \"SSL_PROTOCOL_VERSION\", \"SSL_PROTOCOL\",\n+    \"SSLEAY_VERSION\", \"SSL_VERSION_LIBRARY\",\n+    \"HTTPS_SECRETKEYSIZE\", \"SSL_CIPHER_USEKEYSIZE\",\n+    \"HTTPS_KEYSIZE\", \"SSL_CIPHER_ALGKEYSIZE\",\n+    \"HTTPS_CIPHER\", \"SSL_CIPHER\",\n+    \"HTTPS_EXPORT\", \"SSL_CIPHER_EXPORT\",\n+    \"SSL_SERVER_KEY_SIZE\", \"SSL_CIPHER_ALGKEYSIZE\",\n+    \"SSL_SERVER_CERT_START\", \"SSL_SERVER_V_START\",\n+    \"SSL_SERVER_CERT_END\", \"SSL_SERVER_V_END\",\n+    \"SSL_SERVER_CERT_SERIAL\", \"SSL_SERVER_M_SERIAL\",\n+    \"SSL_SERVER_SIGNATURE_ALGORITHM\", \"SSL_SERVER_A_SIG\",\n+    \"SSL_SERVER_DN\", \"SSL_SERVER_S_DN\",\n+    \"SSL_SERVER_CN\", \"SSL_SERVER_S_DN_CN\",\n+    \"SSL_SERVER_EMAIL\", \"SSL_SERVER_S_DN_Email\",\n+    \"SSL_SERVER_O\", \"SSL_SERVER_S_DN_O\",\n+    \"SSL_SERVER_OU\", \"SSL_SERVER_S_DN_OU\",\n+    \"SSL_SERVER_C\", \"SSL_SERVER_S_DN_C\",\n+    \"SSL_SERVER_SP\", \"SSL_SERVER_S_DN_SP\",\n+    \"SSL_SERVER_L\", \"SSL_SERVER_S_DN_L\",\n+    \"SSL_SERVER_IDN\", \"SSL_SERVER_I_DN\",\n+    \"SSL_SERVER_ICN\", \"SSL_SERVER_I_DN_CN\",\n+    \"SSL_SERVER_IEMAIL\", \"SSL_SERVER_I_DN_Email\",\n+    \"SSL_SERVER_IO\", \"SSL_SERVER_I_DN_O\",\n+    \"SSL_SERVER_IOU\", \"SSL_SERVER_I_DN_OU\",\n+    \"SSL_SERVER_IC\", \"SSL_SERVER_I_DN_C\",\n+    \"SSL_SERVER_ISP\", \"SSL_SERVER_I_DN_SP\",\n+    \"SSL_SERVER_IL\", \"SSL_SERVER_I_DN_L\",\n+    \"SSL_CLIENT_CERT_START\", \"SSL_CLIENT_V_START\",\n+    \"SSL_CLIENT_CERT_END\", \"SSL_CLIENT_V_END\",\n+    \"SSL_CLIENT_CERT_SERIAL\", \"SSL_CLIENT_M_SERIAL\",\n+    \"SSL_CLIENT_SIGNATURE_ALGORITHM\", \"SSL_CLIENT_A_SIG\",\n+    \"SSL_CLIENT_DN\", \"SSL_CLIENT_S_DN\",\n+    \"SSL_CLIENT_CN\", \"SSL_CLIENT_S_DN_CN\",\n+    \"SSL_CLIENT_EMAIL\", \"SSL_CLIENT_S_DN_Email\",\n+    \"SSL_CLIENT_O\", \"SSL_CLIENT_S_DN_O\",\n+    \"SSL_CLIENT_OU\", \"SSL_CLIENT_S_DN_OU\",\n+    \"SSL_CLIENT_C\", \"SSL_CLIENT_S_DN_C\",\n+    \"SSL_CLIENT_SP\", \"SSL_CLIENT_S_DN_SP\",\n+    \"SSL_CLIENT_L\", \"SSL_CLIENT_S_DN_L\",\n+    \"SSL_CLIENT_IDN\", \"SSL_CLIENT_I_DN\",\n+    \"SSL_CLIENT_ICN\", \"SSL_CLIENT_I_DN_CN\",\n+    \"SSL_CLIENT_IEMAIL\", \"SSL_CLIENT_I_DN_Email\",\n+    \"SSL_CLIENT_IO\", \"SSL_CLIENT_I_DN_O\",\n+    \"SSL_CLIENT_IOU\", \"SSL_CLIENT_I_DN_OU\",\n+    \"SSL_CLIENT_IC\", \"SSL_CLIENT_I_DN_C\",\n+    \"SSL_CLIENT_ISP\", \"SSL_CLIENT_I_DN_SP\",\n+    \"SSL_CLIENT_IL\", \"SSL_CLIENT_I_DN_L\",\n+    \"SSL_EXPORT\", \"SSL_CIPHER_EXPORT\",\n+    \"SSL_KEYSIZE\", \"SSL_CIPHER_ALGKEYSIZE\",\n+    \"SSL_SECKEYSIZE\", \"SSL_CIPHER_USEKEYSIZE\",\n+    \"SSL_SSLEAY_VERSION\", \"SSL_VERSION_LIBRARY\",\n+    NULL, NULL\n+};\n+\n int ssl_hook_Fixup(request_rec *r)\n {\n     SSLConnRec *sslconn = myConnConfig(r->connection);\n@@ -1143,11 +1198,17 @@\n \n         apr_table_setn(env, \"SSL_SERVER_CERT\", val);\n \n+        if (dc->nOptions & SSL_OPT_COMPATENVVARS)\n+            apr_table_setn(env, \"SSL_SERVER_CERTIFICATE\", val);\n+\n         val = ssl_var_lookup(r->pool, r->server, r->connection,\n                              r, \"SSL_CLIENT_CERT\");\n \n         apr_table_setn(env, \"SSL_CLIENT_CERT\", val);\n \n+        if (dc->nOptions & SSL_OPT_COMPATENVVARS)\n+            apr_table_setn(env, \"SSL_CLIENT_CERTIFICATE\", val);\n+\n         if ((peer_certs = (STACK_OF(X509) *)SSL_get_peer_cert_chain(ssl))) {\n             for (i = 0; i < sk_X509_num(peer_certs); i++) {\n                 var = apr_psprintf(r->pool, \"SSL_CLIENT_CERT_CHAIN_%d\", i);\n@@ -1159,6 +1220,16 @@\n             }\n         }\n     }\n+\n+    if (dc->nOptions & SSL_OPT_COMPATENVVARS) {\n+        for (i = 0; ssl_hook_Compat_vars[i][0]; i++) {\n+            val = ssl_var_lookup(r->pool, r->server, r->connection, r,\n+\n\t\t    (char *)ssl_hook_Compat_vars[i][1]);\n+            if (!strIsEmpty(val)) {\n+                apr_table_setn(env, ssl_hook_Compat_vars[i][0], val);\n+            }\n+        }\n+    }\n \n     return DECLINED;\n }", "bug_id": 12625, "attachment_id": null, "id": 22839, "time": "2002-09-13T17:20:17Z", "creator": "anthonyu@killa.net", "creation_time": "2002-09-13T17:20:17Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "anthonyu@killa.net", "attachment_id": 3050, "text": "Created attachment 3050\nThe patch", "id": 22840, "time": "2002-09-13T17:25:59Z", "bug_id": 12625, "creation_time": "2002-09-13T17:25:59Z", "is_private": false}, {"count": 2, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "text": "I'm going through the bug db to make sure patches are findable.  Please see \nhttp://httpd.apache.org/dev/patches.html\n", "id": 47796, "time": "2003-11-21T17:08:56Z", "bug_id": 12625, "creation_time": "2003-11-21T17:08:56Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "is_private": false, "id": 53835, "time": "2004-03-10T18:34:32Z", "bug_id": 12625, "creation_time": "2004-03-10T18:34:32Z", "text": "I hate to reject such a patch, but, really, 2.0 was the right time to drop\n+CompatEnvVars; 2.0 need only aim to be compatible with mod_ssl 2.x; not the\nhistoric SSL modules.\n\nThe bug is that they are still documented in the manual and that +CompatEnvVars\nis still accepted."}, {"count": 4, "tags": [], "creator": "jorton@redhat.com", "text": "Moving to a docs bug.", "id": 58608, "time": "2004-06-03T09:31:45Z", "bug_id": 12625, "creation_time": "2004-06-03T09:31:45Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 12625, "attachment_id": null, "id": 58611, "time": "2004-06-03T10:19:45Z", "creator": "jorton@redhat.com", "creation_time": "2004-06-03T10:19:45Z", "is_private": false, "text": "Documentation now fixed up on HEAD."}]
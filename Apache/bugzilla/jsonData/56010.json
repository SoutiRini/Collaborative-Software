[{"count": 0, "text": "When a servlet calls JspFactory.getPageContext() with JspWriter.DEFAULT_BUFFER, Tomcat Japser throws IllegalArgumentException.\n\nPageContext pageContext = JspFactory.getDefaultFactory().getPageContext(this, req, resp, null, false, JspWriter.DEFAULT_BUFFER, true);\n\n\njava.lang.IllegalArgumentException: Buffer size <= 0\n\torg.apache.jasper.runtime.JspWriterImpl.<init>(JspWriterImpl.java:81)\n\torg.apache.jasper.runtime.PageContextImpl._initialize(PageContextImpl.java:154)\n\torg.apache.jasper.runtime.PageContextImpl.initialize(PageContextImpl.java:125)\n\torg.apache.jasper.runtime.JspFactoryImpl.internalGetPageContext(JspFactoryImpl.java:112)\n\torg.apache.jasper.runtime.JspFactoryImpl.getPageContext(JspFactoryImpl.java:65)\n\tdvt.jsp.jaspertest.JspFactoryTestServlet.doGet(JspFactoryTestServlet.java:21)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:621)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:728)\n\n\n\nBased on the description of JspFactory.getPageContext(), if buffer size is JspWriter.DEFAULT_BUFFER(-1), PageContext must treat it as implementation default, which in case is org.apache.jasper.Constants#DEFAULT_BUFFER_SIZE(8192).\n\n\nbuffer - size of buffer in bytes, JspWriter.NO_BUFFER if no buffer, JspWriter.DEFAULT_BUFFER if implementation default.\n\nfrom http://docs.oracle.com/javaee/7/api/javax/servlet/jsp/JspFactory.html#getPageContext(javax.servlet.Servlet, javax.servlet.ServletRequest, javax.servlet.ServletResponse, java.lang.String, boolean, int, boolean)\n\n\nNote that -Dorg.apache.jasper.runtime.JspFactoryImpl.USE_POOL=false should be specified.", "creator": "bluewolf.chung@gmail.com", "is_private": false, "id": 172385, "time": "2014-01-15T03:34:23Z", "bug_id": 56010, "creation_time": "2014-01-15T03:34:23Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "creator": "bluewolf.chung@gmail.com", "attachment_id": 31206, "is_private": false, "id": 172386, "time": "2014-01-15T03:36:57Z", "bug_id": 56010, "creation_time": "2014-01-15T03:36:57Z", "text": "Created attachment 31206\nTest Source\n\nI suggest that org.apache.jasper.runtime.PageContextImpl needs to check if buffer size is JspWriter.DEFAULT_BUFFER and adjust it to default.\n\norg.apache.jasper.runtime.PageContextImpl#initialize(..)\n\n\n        if (bufferSize == JspWriter.DEFAULT_BUFFER) {\n            bufferSize = Constants.DEFAULT_BUFFER_SIZE;\n        }\n        if (this.baseOut == null) {\n            this.baseOut = new JspWriterImpl(response, bufferSize, autoFlush);\n        } else {\n            this.baseOut.init(response, bufferSize, autoFlush);\n        }"}, {"count": 2, "tags": [], "bug_id": 56010, "text": "Thanks for the report and the suggested fix.\n\nI have committed the fix to 8.0.x along with a test case and it will be included in 8.0.0 onwards.\n\nThe same change has been applied to 7.0.x and it will be included in 7.0.51 onwards.", "id": 172420, "time": "2014-01-16T14:24:38Z", "creator": "markt@apache.org", "creation_time": "2014-01-16T14:24:38Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 56010, "attachment_id": null, "id": 173616, "time": "2014-03-04T10:20:19Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-03-04T10:20:19Z", "is_private": false, "text": "As far as I am reading, such value can only be used when calling the JspFactory.getPageContext() API directly. The buffer size that can be used in JSP configurations (in a page directive or in jsp-property-group) is either \"none\" (0) or is measured in kilobytes. (ch. JSP.1.10.1, JSP.3.3.10)\n\nBut I agree that this feature is a part of the API.\n\nProposed for 6.0."}, {"count": 4, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Fixed in 6.0.x for 6.0.40 onwards.", "id": 173944, "time": "2014-03-19T15:21:21Z", "bug_id": 56010, "creation_time": "2014-03-19T15:21:21Z", "is_private": false}]
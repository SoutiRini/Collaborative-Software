[{"count": 0, "tags": [], "bug_id": 56910, "text": "use apr connector\nset maxConnections=\"-1\" in server.xml\n\nwhen start tomcat, exceptions occur:\n\njava.lang.NegativeArraySizeException\n\tat org.apache.tomcat.util.net.AprEndpoint$SocketTimeouts.<init>(AprEndpoint.java:1145)\n\tat org.apache.tomcat.util.net.AprEndpoint$Poller.init(AprEndpoint.java:1382)\n\tat org.apache.tomcat.util.net.AprEndpoint.startInternal(AprEndpoint.java:602)\n\tat org.apache.tomcat.util.net.AbstractEndpoint.start(AbstractEndpoint.java:650)\n\tat org.apache.coyote.AbstractProtocol.start(AbstractProtocol.java:449)\n\tat org.apache.catalina.connector.Connector.startInternal(Connector.java:1007)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\tat org.apache.catalina.core.StandardService.startInternal(StandardService.java:459)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\tat org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:731)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:689)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:321)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:455)\n\nIn AprEndpoint.init() method\uff1a\n\n        protected void init() {\n\n            pool = Pool.create(serverSockPool);\n\n            // Single poller by default\n            int defaultPollerSize = getMaxConnections();\n\n            if ((OS.IS_WIN32 || OS.IS_WIN64) && (defaultPollerSize > 1024)) {\n                // The maximum per poller to get reasonable performance is 1024\n                // Adjust poller size so that it won't reach the limit. This is\n                // a limitation of XP / Server 2003 that has been fixed in\n                // Vista / Server 2008 onwards.\n                actualPollerSize = 1024;\n            } else {\n                actualPollerSize = defaultPollerSize;\n            }\n\n            timeouts = new SocketTimeouts(defaultPollerSize); //here !!!\n\ndid not check getMaxConnections() maybe return -1.", "id": 177525, "time": "2014-09-04T04:18:16Z", "creator": "w.hongjiang@gmail.com", "creation_time": "2014-09-04T04:18:16Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 56910, "attachment_id": null, "id": 177532, "time": "2014-09-04T09:31:08Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-09-04T09:31:08Z", "is_private": false, "text": "*** Bug 56909 has been marked as a duplicate of this bug. ***"}, {"count": 2, "tags": [], "bug_id": 56910, "attachment_id": null, "id": 177539, "time": "2014-09-04T13:59:29Z", "creator": "markt@apache.org", "creation_time": "2014-09-04T13:59:29Z", "is_private": false, "text": "The way the APR Poller works, an unlimited number of connections isn't possible. I see two options if maxConnections is specified as -1.\na) Log an error and don't let the connector start\nb) Use a high number (e.g. 64k), log a warning and start the connector.\n\nI'm leaning towards b)."}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "In the end I decided to ignore values of -1, log a warning and continue using the current value.\n\nFixed in 8.0.x for 8.0.13 onwards and in 7.0.x for 7.0.56 onwards.", "id": 177557, "time": "2014-09-05T14:54:27Z", "bug_id": 56910, "creation_time": "2014-09-05T14:54:27Z", "is_private": false}]
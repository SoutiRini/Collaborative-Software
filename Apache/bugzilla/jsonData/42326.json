[{"count": 0, "tags": [], "creator": "jens@voss-ahrensburg.de", "attachment_id": null, "text": "When you open a saved test plan with JMeter and immediately save it again \n(under a new name), often many test elements change their positions in the .jmx \nfile (see attached screenshot of diff tool). This makes putting test plans \nunder version control a farce.", "id": 102809, "time": "2007-05-03T05:23:17Z", "bug_id": 42326, "creation_time": "2007-05-03T05:23:17Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 42326, "attachment_id": 20116, "text": "Created attachment 20116\nScreenshot of diff tool\n\nIn total, there are 168 such pseudo-differences in one .jmx file (7193 lines)", "id": 102810, "time": "2007-05-03T05:25:46Z", "creator": "jens@voss-ahrensburg.de", "creation_time": "2007-05-03T05:25:46Z", "is_private": false}, {"count": 2, "tags": [], "creator": "jens@voss-ahrensburg.de", "attachment_id": null, "id": 102811, "time": "2007-05-03T05:28:01Z", "bug_id": 42326, "creation_time": "2007-05-03T05:28:01Z", "is_private": false, "text": "I tried hacking around the source code a bit, replacing HashMaps by \nLinkedHashMaps in places that looked promising, but it didn't seem to fix the \nproblem, and unfortunately I currently don't have time for thorough debugging \nand fixing"}, {"count": 3, "tags": [], "bug_id": 42326, "attachment_id": null, "text": "As you found, the problem is that the test plan is saved in a hash tree, and \nit is non-trivial to fix (if it is possible).\n\nThis is not a JMeter bug, so changing to enhancement.\n\nThe re-ordering might disappear once the equals() and hashcode() methods are \nregularised. But when I attempted that some while back, various problems \nappeared.\n\nAs a work-round, you could write an XSLT sheet to order the JMX before saving \nit.", "id": 102812, "time": "2007-05-03T05:34:14Z", "creator": "sebb@apache.org", "creation_time": "2007-05-03T05:34:14Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 42326, "attachment_id": 20287, "text": "Created attachment 20287\nPatch to core\\org\\apache\\jmeter\\testelement\\AbstractTestElement.java\n\nOkay, the supplied patch should do the job.\n\nNote that if you open a file (e.g. \"foo.jmx\") that has previously been saved\nwith an unpatched version and save it with the patched version (as \"bar.jmx\"),\nthere will (most likely) still be plenty of XML elements interchanged. However,\nif you then open \"bar.jmx\" again and save it as \"baz.jmx\", the files \"bar.jmx\"\nand \"baz.jmx\" should be identical.", "id": 103806, "time": "2007-05-30T03:48:14Z", "creator": "jens@voss-ahrensburg.de", "creation_time": "2007-05-30T03:48:14Z", "is_private": false}, {"count": 5, "tags": [], "text": "Thanks very much - I've applied the patch to SVN in r542902.\n\nI'll create a nightly build later - perhaps you could check it out and report \nback?", "attachment_id": null, "bug_id": 42326, "id": 103824, "time": "2007-05-30T11:37:03Z", "creator": "sebb@apache.org", "creation_time": "2007-05-30T11:37:03Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "jens@voss-ahrensburg.de", "text": "Hmm, I installed nightly build r542903 and tried to open saved test plans (both \nsaved with old versions and with the current nightly), and I reproducably get a \nConcurrentModificationException:\n\n2007/05/31 12:34:41 ERROR - jmeter.JMeter: Failure loading test file \njava.util.ConcurrentModificationException\n\tat java.util.LinkedHashMap$LinkedHashIterator.nextEntry\n(LinkedHashMap.java:365)\n\tat java.util.LinkedHashMap$ValueIterator.next(LinkedHashMap.java:380)\n\tat org.apache.jmeter.testelement.property.PropertyIteratorImpl.next\n(PropertyIteratorImpl.java:50)\n\tat org.apache.jmeter.testelement.AbstractTestElement.mergeIn\n(AbstractTestElement.java:276)\n\tat org.apache.jmeter.testelement.AbstractTestElement.addTestElement\n(AbstractTestElement.java:115)\n\tat org.apache.jmeter.testelement.TestPlan.addTestElement\n(TestPlan.java:222)\n\tat org.apache.jmeter.gui.tree.JMeterTreeModel.addSubTree\n(JMeterTreeModel.java:83)\n\tat org.apache.jmeter.gui.GuiPackage.addSubTree(GuiPackage.java:457)\n\tat org.apache.jmeter.gui.action.Load.insertLoadedTree(Load.java:141)\n\tat org.apache.jmeter.gui.action.Load.insertLoadedTree(Load.java:168)\n\tat org.apache.jmeter.JMeter.startGui(JMeter.java:226)\n\tat org.apache.jmeter.JMeter.start(JMeter.java:314)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:585)\n\tat org.apache.jmeter.NewDriver.main(NewDriver.java:183)\n\nWhy this does not happen at my \"privately patched\" version here I don't really \nknow, but it may have to do with the fact that the rest of my sources are more \nor less in 2.2 state. I'll install the source files from the current nightly \nand give it another try. For now, you may probably want to rollback the \nAbstractTestElement because the above error is a definite showstopper for the \nnightly (unless you want to take the effort and find a fix to the \nConcurrentModificationException without rolling back the changes introduced \nwith the patch).", "count": 6, "id": 103867, "time": "2007-05-31T03:41:05Z", "bug_id": 42326, "creation_time": "2007-05-31T03:41:05Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 42326, "attachment_id": 20296, "text": "Created attachment 20296\nPatch to the previously supplied patch\n\nOkay, I guess my previous patch simply went a bit too far.\nIn order to correct it, apply the new patch to revision 542902 of the\nAbstractTestElement class.", "id": 103869, "time": "2007-05-31T04:04:12Z", "creator": "jens@voss-ahrensburg.de", "creation_time": "2007-05-31T04:04:12Z", "is_private": false}, {"count": 8, "tags": [], "creator": "sebb@apache.org", "text": "OK, applied in r543291.\n\nUnfortunately the test suite did not detect this error. It seems to affect \nonly GUI tests, and the test cases don't (can't) use the GUI.", "id": 103910, "attachment_id": null, "bug_id": 42326, "creation_time": "2007-05-31T15:40:48Z", "time": "2007-05-31T15:40:48Z", "is_private": false}]
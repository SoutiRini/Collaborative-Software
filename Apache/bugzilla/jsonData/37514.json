[{"count": 0, "tags": [], "creator": "inders@integral.com", "text": "I have a server that sends data using Transfer-Encoding: Chunked, but mod_proxy \nis buffering up the data until it hits the internal limit of 8K.  Our client \napplication expects to receive data from the server over a period of time, and \ndoesnot know the length of the data in advance.\n\nI have looked at bugs 19954 and 34876, which claim to have fixed this in the \nlatest version of apache, but apparently it is not so. I have tried it on the \nfollowing apache servers:\n1.) Server version: Apache/2.0.46\nServer built:   Nov  5 2004 10:58:21\n\n2.) Server version: Apache/2.0.55\nServer built:   Nov 15 2005 00:06:22\n\n3.) The 2.1 beta available from apache.org.\n\nI am running RH linux AS3 U4:\nLinux .... 2.4.21-27.EL #1 Wed Dec 1 22:08:15 EST 2004 i686 i686 i386 GNU/Linux\n\nIs there a patch available somewhere that I could use or a configuration item \nthat I may be missing out?", "id": 82528, "attachment_id": null, "bug_id": 37514, "creation_time": "2005-11-15T21:50:31Z", "time": "2005-11-15T21:50:31Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 37514, "text": "I made the following changes to make mod_proxy work:\n1006,1007d1005\n<             int chunked = 0;\n<             char* c1=0;\n1009,1014d1006\n<             c1 = apr_table_get(r->headers_out, \"Transfer-Encoding\");\n<             if (c1) {\n<                 ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, r->server, \"->>\nencoding is: %s\", c1);\n<                 if (!strcmp(c1, \"chunked\"))\n<                    chunked=1;\n<             }\n1046,1047c1038,1039\n<                     if ( APR_STATUS_IS_EAGAIN(rv)\n<                         || (rv == APR_SUCCESS && APR_BRIGADE_EMPTY(bb)) ) {\n---\n>                     if (APR_STATUS_IS_EAGAIN(rv)\n>                         || (rv == APR_SUCCESS && APR_BRIGADE_EMPTY(bb))) {\n1051,1052c1043\n<                         if (ap_pass_brigade(r->output_filters, bb)\n<                             || c->aborted) {\n---\n>                         if (ap_pass_brigade(r->output_filters, bb)) {\n1065,1077d1055\n If chunked response, then flush right away.\n< \n<                     if (!APR_BUCKET_IS_EOS(APR_BRIGADE_LAST(bb)) && chunked) {\n<                         e = apr_bucket_flush_create(c->bucket_alloc);\n<                         APR_BRIGADE_INSERT_TAIL(bb, e);\n<                         if (ap_pass_brigade(r->output_filters, bb)\n<                             || c->aborted) {\n<                             backend->close = 1;\n<                             break;\n<                         }\n<                         apr_brigade_cleanup(bb);\n<                         continue;\n<                   }\n< \n\nStreaming data works just fine, but apache LEAKS MEMORY - I believe apache is \nholding onto the stream unless either the browser is closed  or the server\ncloses the connection.\n\nIs there something obviously wrong that I am doing here, or is this an apache issue?\n\n-Thanks.\n-Inder.", "id": 82543, "time": "2005-11-16T02:06:51Z", "creator": "inders@integral.com", "creation_time": "2005-11-16T02:06:51Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 37514, "text": "Your patch is currently a little hard to review. I guess it is against 2.1.x.\nCan you please\n\n1. Provide the exact version of 2.1 where you faced the problem .\n2. Provide the exact version where this patch is against.\n3. Provide the patch as unified diff (see\nhttp://httpd.apache.org/dev/patches.html) as an attachment.", "id": 82598, "time": "2005-11-16T22:07:29Z", "creator": "rpluem@apache.org", "creation_time": "2005-11-16T22:07:29Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "Created attachment 20401\nProposed patch for Apache 2.0.59\n\nThis patch inserts a flush bucket after each block of chunk data received from\nthe web server. It will force a chunk block to be generated to the client\nconnection.\nFeedback welcome.", "attachment_id": 20401, "id": 104762, "creator": "lilas@evidian.com", "time": "2007-06-27T05:40:05Z", "bug_id": 37514, "creation_time": "2007-06-27T05:40:05Z", "is_private": false}]
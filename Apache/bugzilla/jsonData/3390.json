[{"count": 0, "tags": [], "bug_id": 3390, "text": "(this is for the latest 1.4 beta)\n\nI'm trying to do some dynamic generation of ant build.xml with xslt.\nI'm stuck on dynamic depends lists : the simplest way is to generate a\ndepends=\"foo1, foo2, foo3, \" list, but then ant will search for a \" \" target.\nSo I have to define a dummy empty target and change my lists in\ndepends=\"foo1, foo2, foo3, dummy\" just for this.\n\nCouldn't ant just ignore whitespace targets and/or the trailing \",\" ?\n[alternatively specifying dependencies with multiple nested <depend> elements\nwould be great]", "id": 5071, "attachment_id": null, "creator": "nicolas.mailhot@one2team.com", "creation_time": "2001-09-03T12:59:34Z", "time": "2001-09-03T12:59:34Z", "is_private": false}, {"count": 1, "tags": [], "creator": "sbailliez@apache.org", "text": "Why don't you just change your XSL to generate the \"correct\" list ?\nI don't think that leaving a trailing \",\" can be seen as correct... If it is \na 'separator' it is supposed to separate, right ? :)\n\n<dependencies>\n  <dependency>target1</dependency>\n  <dependency>target2</dependency>\n</dependencies>\n\n<xsl:for-each select=\"dependencies/dependency\">\n  <xsl:value-of select=\".\"/><xsl:if test=\"position() != last()\">,</xsl:if>\n</xsl:for-each>\n\nOutput:\ntarget1,target2\n\n", "id": 5072, "time": "2001-09-03T13:20:28Z", "bug_id": 3390, "creation_time": "2001-09-03T13:20:28Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 3390, "text": "I'm afraid I've got a far more complex mapping, and there's no easy test to\ndetermine if a dependency is the last one or not (maybe my xsl is just\nbutt-ugly, and I'm stretching the tools capabilities, but that's how it is for now)\n\nAnd anyway, I'm not sure that tomcat considering that some whitespace\nconstitutes a target name is very clean too.(lists ending with a trailing \",\"\nare accepted in C at least I think)\n<depend> nested elements would be the best solution for my setup:(", "id": 5073, "time": "2001-09-03T13:41:21Z", "creator": "nicolas.mailhot@one2team.com", "creation_time": "2001-09-03T13:41:21Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "umagesh@rediffmail.com", "text": "[PATCH] Improved validation of depends list (fix for bug# 3390)\nhttp://marc.theaimsgroup.com/?l=ant-dev&m=100121272121911&w=2\n\nProvided by Phil Hanna <phanna@ipass.net>", "id": 5918, "attachment_id": null, "bug_id": 3390, "creation_time": "2001-09-22T20:16:00Z", "time": "2001-09-22T20:16:00Z", "is_private": false}, {"count": 4, "tags": [], "creator": "phanna@ipass.net", "attachment_id": null, "id": 5920, "time": "2001-09-22T20:20:55Z", "bug_id": 3390, "creation_time": "2001-09-22T20:20:55Z", "is_private": false, "text": "This is a fix for bug# 3390 (depends list, trailing \",\").  It involves two\nclasses:\n\norg.apache.tools.ant.Target\norg.apache.tools.and.ProjectHelper\n\nThe fix itself is just a verification that tokens added to the dependency\nlist are not empty strings.  However, this logic exists in two places\n(Target and ProjectHelper).  The patch refactors this and makes\nTarget.addDependency() private, so that modifications to the list all go\nthrough Target.setDepends().\n\nHere are the two diff files:\n\n--- Target.java.save Mon Sep 03 21:48:24 2001\n+++ Target.java Sat Sep 22 22:08:59 2001\n@@ -85,7 +85,10 @@\n             StringTokenizer tok =\n                 new StringTokenizer(depS, \",\", false);\n             while (tok.hasMoreTokens()) {\n-                addDependency(tok.nextToken().trim());\n+                String token = tok.nextToken().trim();\n+                if (!token.equals(\"\")) {\n+                    addDependency(token);\n+                }\n             }\n         }\n     }\n@@ -126,7 +129,7 @@\n         return retval;\n     }\n\n-    public void addDependency(String dependency) {\n+    private void addDependency(String dependency) {\n         dependencies.addElement(dependency);\n     }\n\n\n--- ProjectHelper.java.save Mon Sep 03 21:48:24 2001\n+++ ProjectHelper.java Sat Sep 22 22:07:29 2001\n@@ -421,11 +421,7 @@\n             // take care of dependencies\n\n             if (depends.length() > 0) {\n-                StringTokenizer tok =\n-                    new StringTokenizer(depends, \",\", false);\n-                while (tok.hasMoreTokens()) {\n-                    target.addDependency(tok.nextToken().trim());\n-                }\n+                target.setDepends(depends);\n             }\n         }\n\n"}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 6097, "time": "2001-09-27T04:28:35Z", "bug_id": 3390, "creation_time": "2001-09-27T04:28:35Z", "is_private": false, "text": "Fixed for Ant 1.4.1.\n\nI applied Phil's patch but left addDependency public, not because I think it\nshould be (I don't), but to keep the API backwards compatible."}, {"attachment_id": null, "tags": [], "bug_id": 3390, "is_private": false, "count": 6, "id": 6099, "time": "2001-09-27T04:58:18Z", "creator": "nicolas.mailhot@one2team.com", "creation_time": "2001-09-27T04:58:18Z", "text": "Thanks a lot everyone"}]
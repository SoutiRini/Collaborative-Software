[{"count": 0, "tags": [], "text": "See e-mail on dev@:\n\"[7.0.x] Document is invalid: no grammar found. for MergedWebXml in Jasper\"\nhttp://markmail.org/message/jbnbmezbdegoufm5\n\nThis issue affects the current TC7 code (7.0.51-dev), since the following commit: http://svn.apache.org/r1552826\n\nIt does not affect 7.0.50.\n(The error is generated internally, but the list of error is not checked, so it is effectively ignored).\n\nSteps to reproduce:\n1. Enable validation, by adding the following line to conf/catalina.properties\n\norg.apache.catalina.STRICT_SERVLET_COMPLIANCE=true\n\n2. Set JAVA_HOME variable to point a Java 6 JDK. I am using 6u45.\n3. Start Tomcat\n4. Go to http://localhost:8080/\n\nExpected: index.jsp of the ROOT web application\nActual: Error 500, with the following message in localhost.DATE.log file:\n\n08.01.2014 1:20:11 org.apache.catalina.core.StandardWrapperValve invoke\nSEVERE: Servlet.service() for servlet [jsp] in context with path [] threw exception [org.apache.jasper.JasperException: XML parsing error on file org.apache.tomcat.util.scan.MergedWebXml: (line 2, col 9)] with root cause\norg.xml.sax.SAXParseException: Document is invalid: no grammar found.\n\tat com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:195)\n\tat com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.error(ErrorHandlerWrapper.java:131)\n\tat com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:384)\n\tat com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:318)\n\tat com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.scanStartElement(XMLNSDocumentScannerImpl.java:250)\n\tat com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl$NSContentDriver.scanRootElementHook(XMLNSDocumentScannerImpl.java:626)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl$FragmentContentDriver.next(XMLDocumentFragmentScannerImpl.java:3104)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:921)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:647)\n\tat com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(XMLNSDocumentScannerImpl.java:140)\n\tat com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)\n\tat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)\n\tat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)\n\tat com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(DOMParser.java:232)\n\tat com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(DocumentBuilderImpl.java:284)\n\tat org.apache.jasper.xmlparser.ParserUtils.parseXMLDocument(ParserUtils.java:105)\n\tat org.apache.jasper.compiler.JspConfig.processWebDotXml(JspConfig.java:95)\n\tat org.apache.jasper.compiler.JspConfig.init(JspConfig.java:243)\n\tat org.apache.jasper.compiler.JspConfig.findJspProperty(JspConfig.java:302)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:114)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:373)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:353)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:340)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:657)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:357)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:390)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:334)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:728)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:222)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:953)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:409)\n\tat org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1044)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:607)\n\tat org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:313)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)\n\tat java.lang.Thread.run(Thread.java:662)", "is_private": false, "id": 172156, "creator": "knst.kolinko@gmail.com", "time": "2014-01-07T21:26:07Z", "bug_id": 55973, "creation_time": "2014-01-07T21:26:07Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 55973, "attachment_id": null, "text": "The cause of this issue is that Jasper uses DOM parser, while the rest of Tomcat code uses Apache Commons Digester.\n\nWhen DOM parser is used directly, calling \"factory.setValidating(validating);\" on DocumentBuilderFactory enables DOM validation only, but not the schema one. (in ParserUtils.java in jasper)\n\nWhen Digester is used, calling digester.setValidating(true) enables not only DOM validation, but schema one as well.\n\nSee Digester#getFactory() for a fragment of code that enables schema validation.\n\n\nBy the way, XmlErrorHandler used by Japser here stores the errors and warnings in a HashSet. In this case, there are 2 errors, and which one is reported is random, as the HashSet has no order. From debugger:\n\n[org.xml.sax.SAXParseException: Document root element \"web-app\", must match DOCTYPE root \"null\"., org.xml.sax.SAXParseException: Document is invalid: no grammar found.]", "id": 172158, "time": "2014-01-07T21:49:07Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-01-07T21:49:07Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 55973, "is_private": false, "count": 2, "id": 172160, "time": "2014-01-07T23:15:05Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-01-07T23:15:05Z", "text": "Fixed in 7.0 by r1556377 and will be in 7.0.51.\n\nThe ordering issue has been filed separately as\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=55974\n\nProposed for Tomcat 6.\nTomcat 8 is not affected."}, {"count": 3, "attachment_id": null, "bug_id": 55973, "is_private": false, "id": 172328, "time": "2014-01-13T13:59:25Z", "creator": "markt@apache.org", "creation_time": "2014-01-13T13:59:25Z", "tags": [], "text": "The fix has been applied to 6.0.x for 6.0.38 onwards."}]
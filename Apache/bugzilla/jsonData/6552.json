[{"count": 0, "tags": [], "bug_id": 6552, "attachment_id": null, "text": "Inside <%! %> tags if you have // comments and inside has <%= %> tags which \noften happens when debugging codes or commenting old lines out, the jsp parser \nSTILL parses that but incorrectly and would render the page into errors.\n\nFor example, I have the following test.jsp page.\n\nNote the lines after\nif (localSection != null) {\n\nhow it actually parsed the comments too and left out the rest of the important \ncodes!\n\n\n----------------------------------beginning of file---------------------------\n\n<%\n/**\n* index.jsp\n*  Author: Harlow\n*\n*  Description:\n*     This is the kids template page.\n*\n*  Updates:\n*    12/7/2000 - Moon - Code Review\n*    4/10/2001 - Harlow - Added keyword to quick search\n*/\n%>\n\n\n<%@page import=\"java.text.*\"%>\n<%@page import=\"java.util.Vector\"%>\n<%@page import=\"java.util.Enumeration\"%>\n<%@page import=\"com.ixl.booksense.stores.*\"%>\n<%@page import=\"com.ixl.geography.*\"%>\n<%@page import=\"com.ixl.booksense.context.*\"%>\n<%@page import=\"com.ixl.booksense.books.*\"%>\n<%@page import=\"com.ixl.booksense.nationalData.*\"%>\n<%@page import=\"com.ixl.booksense.siteModel.specialized.*\"%>\n<%@page import=\"com.ixl.booksense.siteModel.generic.*\"%>\n<%!\n\n   /**\n   getLeftNavSectionString\n   returns proper formatting for left nav sections\n   TODO:\n   Optimize construction of the returnString... this function is called seven\n   times for each page.\n\n   */\n   private String getLeftNavSectionString(String sectionName, \nStandardColorScheme scheme, Site site, String storeIndexPath, boolean isSecure) \n{\n      String returnString = \"\";\n      try {\n\t\t  NoBodyLocalSection localSection = (NoBodyLocalSection)\nsite.getSection(sectionName);\n\t\t  if (localSection != null) {\n\t\t  //    returnString = \"<a href=\\\"http://<%= storeIndexPath %>?\ns=\" + sectionName + \"\\\"><font color=\\\"\" + scheme.getLEFTNAV_LINK() + \"\\\">\";\n\t\t  //    returnString = returnString + localSection.getTitle() \n+ \"</font></a><br>\";\n\t\t  //    returnString = returnString + \"<img src=\\\"\" + \nscheme.getFULL_IMAGE_URL(isSecure) + \"clear.gif\\\" width=\\\"1\\\" height=\\\"12\n\\\"><br>\";\n\n \t\t\t    returnString = \"<tr>\";\n\t\t  }\n      } catch (Exception e) {\n         returnString = \"\";\n      }\n\n      return returnString;\n   }\n\n%>\n\n<jsp:useBean id=\"storeBean\" scope=\"request\" \nclass=\"com.ixl.booksense.beans.stores.StoreBean\" />\n\n<html>\n<head>\n   <title><%= storeTitle %></title>\n</head>\n<body bgcolor=\"#FFFFFF\" link=\"#000000\" vlink=\"#000000\" alink=\"#000000\" \nbackground=\"<%= scheme.getFULL_IMAGE_URL(isSecure) %>04_background.gif\">\n\n</body>\n</html>\n\n-----------------------------------end of file---------------------------\n\nand it gets parsed into\n\n---------------------------------beginning of file---------------------------\npackage org.apache.jsp;\n\nimport java.text.*;\nimport java.util.Vector;\nimport java.util.Enumeration;\nimport com.ixl.booksense.stores.*;\nimport com.ixl.geography.*;\nimport com.ixl.booksense.context.*;\nimport com.ixl.booksense.books.*;\nimport com.ixl.booksense.nationalData.*;\nimport com.ixl.booksense.siteModel.specialized.*;\nimport com.ixl.booksense.siteModel.generic.*;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\nimport javax.servlet.jsp.*;\nimport org.apache.jasper.runtime.*;\n\n\npublic class test$jsp extends HttpJspBase {\n\n    // begin [file=\"/test.jsp\";from=(25,3);to=(40,62)]\n        \n        \n           /**\n           getLeftNavSectionString\n           returns proper formatting for left nav sections\n           TODO:\n           Optimize construction of the returnString... this function is called \nseven\n           times for each page.\n        \n           */\n           private String getLeftNavSectionString(String sectionName, \nStandardColorScheme scheme, Site site, String storeIndexPath, boolean isSecure) \n{\n              String returnString = \"\";\n              try {\n        \t\t  NoBodyLocalSection localSection = (NoBodyLocalSection)\nsite.getSection(sectionName);\n        \t\t  if (localSection != null) {\n        \t\t  //    returnString = \"<a href=\\\"http://<%= \nstoreIndexPath \n    // end\n    // begin [file=\"/test.jsp\";from=(55,0);to=(55,95)]\n    // end\n\n    static {\n    }\n    public test$jsp( ) {\n    }\n\n    private static boolean _jspx_inited = false;\n\n    public final void _jspx_init() throws \norg.apache.jasper.runtime.JspException {\n    }\n\n    public void _jspService(HttpServletRequest request, HttpServletResponse  \nresponse)\n        throws java.io.IOException, ServletException {\n\n        JspFactory _jspxFactory = null;\n        PageContext pageContext = null;\n        HttpSession session = null;\n        ServletContext application = null;\n        ServletConfig config = null;\n        JspWriter out = null;\n        Object page = this;\n        String  _value = null;\n        try {\n\n            if (_jspx_inited == false) {\n                synchronized (this) {\n                    if (_jspx_inited == false) {\n                        _jspx_init();\n                        _jspx_inited = true;\n                    }\n                }\n            }\n            _jspxFactory = JspFactory.getDefaultFactory();\n            response.setContentType(\"text/html;charset=ISO-8859-1\");\n            pageContext = _jspxFactory.getPageContext(this, request, response,\n            \t\t\t\"\", true, 8192, true);\n\n            application = pageContext.getServletContext();\n            config = pageContext.getServletConfig();\n            session = pageContext.getSession();\n            out = pageContext.getOut();\n\n            // begin [file=\"/test.jsp\";from=(0,2);to=(12,0)]\n                \n                /**\n                * index.jsp\n                *  Author: Harlow\n                *\n                *  Description:\n                *     This is the kids template page.\n                *\n                *  Updates:\n                *    12/7/2000 - Moon - Code Review\n                *    4/10/2001 - Harlow - Added keyword to quick search\n                */\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(12,2);to=(15,0)]\n                out.write(\"\\r\\n\\r\\n\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(15,30);to=(16,0)]\n                out.write(\"\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(16,35);to=(17,0)]\n                out.write(\"\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(17,40);to=(18,0)]\n                out.write(\"\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(18,45);to=(19,0)]\n                out.write(\"\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(19,38);to=(20,0)]\n                out.write(\"\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(20,46);to=(21,0)]\n                out.write(\"\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(21,44);to=(22,0)]\n                out.write(\"\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(22,51);to=(23,0)]\n                out.write(\"\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(23,60);to=(24,0)]\n                out.write(\"\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(24,56);to=(25,0)]\n                out.write(\"\\r\\n\");\n\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(40,64);to=(55,0)]\n                out.write(\"?s=\\\" + sectionName + \\\"\\\\\\\"><font color=\\\\\\\"\\\" + \nscheme.getLEFTNAV_LINK() + \\\"\\\\\\\">\\\";\\r\\n\\t\\t  //    returnString = \nreturnString + localSection.getTitle() + \\\"</font></a><br>\\\";\\r\\n\\t\\t  //    \nreturnString = returnString + \\\"<img src=\\\\\\\"\\\" + scheme.getFULL_IMAGE_URL\n(isSecure) + \\\"clear.gif\\\\\\\" width=\\\\\\\"1\\\\\\\" height=\\\\\\\"12\\\\\\\"><br>\\\";\\r\\n\\r\\n \n\\t\\t\\t    returnString = \\\"<tr>\\\";\\r\\n\\t\\t  }\\r\\n      } catch (Exception e) \n{\\r\\n         returnString = \\\"\\\";\\r\\n      }\\r\\n\\r\\n      return \nreturnString;\\r\\n   }\\r\\n\\r\\n%>\\r\\n\\r\\n\");\n\n            // end\n            // begin [file=\"/test.jsp\";from=(55,0);to=(55,95)]\n                com.ixl.booksense.beans.stores.StoreBean storeBean = null;\n                boolean _jspx_specialstoreBean  = false;\n                 synchronized (request) {\n                    storeBean= (com.ixl.booksense.beans.stores.StoreBean)\n                    pageContext.getAttribute\n(\"storeBean\",PageContext.REQUEST_SCOPE);\n                    if ( storeBean == null ) {\n                        _jspx_specialstoreBean = true;\n                        try {\n                            storeBean = \n(com.ixl.booksense.beans.stores.StoreBean) java.beans.Beans.instantiate\n(this.getClass().getClassLoader(), \"com.ixl.booksense.beans.stores.StoreBean\");\n                        } catch (ClassNotFoundException exc) {\n                             throw new InstantiationException(exc.getMessage());\n                        } catch (Exception exc) {\n                             throw new ServletException (\" Cannot create bean \nof class \"+\"com.ixl.booksense.beans.stores.StoreBean\", exc);\n                        }\n                        pageContext.setAttribute(\"storeBean\", storeBean, \nPageContext.REQUEST_SCOPE);\n                    }\n                 } \n                if(_jspx_specialstoreBean == true) {\n            // end\n            // begin [file=\"/test.jsp\";from=(55,0);to=(55,95)]\n                }\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(55,95);to=(59,10)]\n                out.write(\"\\r\\n\\r\\n<html>\\r\\n<head>\\r\\n   <title>\");\n\n            // end\n            // begin [file=\"/test.jsp\";from=(59,13);to=(59,25)]\n                out.print( storeTitle );\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(59,27);to=(61,83)]\n                out.write(\"</title>\\r\\n</head>\\r\\n<body bgcolor=\\\"#FFFFFF\\\" \nlink=\\\"#000000\\\" vlink=\\\"#000000\\\" alink=\\\"#000000\\\" background=\\\"\");\n\n            // end\n            // begin [file=\"/test.jsp\";from=(61,86);to=(61,122)]\n                out.print( scheme.getFULL_IMAGE_URL(isSecure) );\n            // end\n            // HTML // begin [file=\"/test.jsp\";from=(61,124);to=(65,0)]\n                out.write(\"04_background.gif\\\">\\r\\n\\r\\n</body>\\r\\n</html>\\r\\n\");\n\n            // end\n\n        } catch (Throwable t) {\n            if (out != null && out.getBufferSize() != 0)\n                out.clearBuffer();\n            if (pageContext != null) pageContext.handlePageException(t);\n        } finally {\n            if (_jspxFactory != null) _jspxFactory.releasePageContext\n(pageContext);\n        }\n    }\n}\n-----------------------------------end of file---------------------------", "id": 10906, "time": "2002-02-19T17:01:33Z", "creator": "kleung11@yahoo.com", "creation_time": "2002-02-19T17:01:33Z", "is_private": false}, {"count": 1, "tags": [], "text": "JSP.2.6 specifies that \"%>\" that appears in a scripting element has to be\nescaped as \"%\\>\".  The general philosophy for JSP syntax is to make it\nunnecessary for the parser to parse the body of the scripting elements.  Without\nescaping %>, the parser would terminate <%! when it encounters the first %>. \nThe parser does not know about java comments.\n", "is_private": false, "id": 11124, "creator": "kin-man.chung@sun.com", "time": "2002-02-25T18:31:28Z", "bug_id": 6552, "creation_time": "2002-02-25T18:31:28Z", "attachment_id": null}]
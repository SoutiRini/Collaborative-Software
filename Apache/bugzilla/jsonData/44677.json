[{"count": 0, "tags": [], "bug_id": 44677, "text": "When I insert a COUNTA formula in a cell, the result is incorrect.\nIt seems it only returns the number of parameters.\nWhen I open the excel file with excel (2003), if I edit the formula and just press enter (force recompute, do not modify the formula), the result becomes correct.\nOn the other hand, COUNT works fine.\n\nLaurent\n\n\nExample:\n\nHSSFWorkbook wb=new HSSFWorkbook();\nHSSFSheet sheet = wb.createSheet();\nsheet.createRow(0).createCell((short)0).setCellValue(10);\nsheet.createRow(1).createCell((short)0).setCellValue(20);\nsheet.createRow(2).createCell((short)0).setCellValue(true);\n\t\t\n// the result is 2, which is ok (only numbers are taken into account)\nsheet.createRow(3).createCell((short)0).setCellFormula(\"count(A1:A3)\");\n\n// the result is 1, it should be 3\nsheet.createRow(4).createCell((short)0).setCellFormula(\"counta(A1:A3)\");", "id": 114983, "time": "2008-03-26T06:01:08Z", "creator": "lpoublan@triloggroup.com", "creation_time": "2008-03-26T06:01:08Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 44677, "attachment_id": null, "id": 114992, "creation_time": "2008-03-26T11:43:43Z", "time": "2008-03-26T11:43:43Z", "creator": "josh@apache.org", "text": "POI currently saves these formulas with tokens of tAreaV(0x45) instead of tAreaR (0x25).  In my excel (2007) I observe *both* formulas to be wrong at first (A4=0, A5=1, until re-entered).\n\nIt looks like the problem is in FormulaParser.setParameterRVA(Node, int)\nCommenting out the call to that method seems to fix this bug, but that is not a proper solution.  Without that call, the token classes of all parsed formulas will stay at 'reference', which is probably wrong for other formulas.\n\nThis functionality is related to the 'Token Class Transformation' section (3.2.4) of excelfileformat.pdf.  This logic seems to be partially implemented in POI but since there are no junits, it's probably not very stable yet.\n", "is_private": false}, {"count": 2, "tags": [], "creator": "josh@apache.org", "attachment_id": null, "id": 116271, "time": "2008-05-05T15:11:26Z", "bug_id": 44677, "creation_time": "2008-05-05T15:11:26Z", "is_private": false, "text": "Re-tested in 3.1-beta1.\n\nThis was probably fixed in bug 44675 (the parameter operand\nclass should be 'reference' instead of 'value')"}]
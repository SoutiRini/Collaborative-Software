[{"count": 0, "tags": [], "creator": "opusbtvs@netscape.net", "attachment_id": null, "is_private": false, "id": 51270, "time": "2004-01-27T23:24:57Z", "bug_id": 26475, "creation_time": "2004-01-27T23:24:57Z", "text": "I have a JAAS Realm that is built on top of Jetspeed.  Because jetspeed needs \nto run within a servlet container and all JAASRealms must run at the server \nlevel my JAAS Realm no longer works.  To replicate define a realm in the \nserver.xml directory.\n\n<Realm className=\"org.apache.catalina.realm.JAASRealm\"\n       debug=\"99\" \n       appName=\"MyServletContainer\"\n       roleClassNames=\"org.apache.jetspeed.om.security.RoleNamePrincipal\"\n       userClassNames=\"org.apache.jetspeed.om.security.UserNamePrincipal\"/>\n\nAdd the security objects to the web application's web.xml file\n\n<security-constraint>\n  <web-resource-collection>\n    <web-resource-name>Protected link</web-resource-name>\n    <url-pattern>/MYLINK</url-pattern>\n    <http-method>GET</http-method>\n    <http-method>POST</http-method>\n  </web-resource-collection>\n  <auth-constraint>\n  \t<role-name>admin</role-name>\n  </auth-constraint>\n </security-constraint>\n\nNext create your jaas.config file\nMyServletContainer\n{\n\tcom.myapp.security.ServletContainerLoginModule required;\n};\n\nCreate the class and have it implement the jetspeed security object\n\n...\ncallbackHandler.handle(callbacks);\nusername = ((NameCallback) callbacks[0]).getName();\n\t\t\t\nString pword = new String(((PasswordCallback) callbacks[1]).getPassword());\n\t\t\t((PasswordCallback) callbacks[1]).clearPassword();\n\t\t\tSystem.out.println (\"trying to login:\" + username \n+ \"/\" + pword);\n\nSystem.out.println(\"Attempting to authenticate against the Jetspeed security \nservices\");\n\t\t\t\nJetspeedSecurity.login(username, pword);\n\t\t\tsucceeded = true;\n...\n\nIn order to get the class to run I had to add the jars and the class file to \nthe common.loader of the catalina.properties.  Without this the class nor the \nassociated JAR files could be found (this was not the case in Tomcat 4.x)\n\nNow when you start the server and try to access the associated realm object \nyou will get an error in the log that says\njavax.security.auth.login.LoginException: \norg.apache.turbine.services.InstantiationException: ServiceBroker: unknown \nservice LoggingService requested\n\nThe problem is that Jetspeed is looking for the properties to be within a \nservlet container and the realm must run within the server.  Even if I just \ndefine the realm within the web application that does not solve the problem.\n\nThis is a regression as 4.1 did not have this behavior."}, {"count": 1, "tags": [], "text": "Obviously, the realm is a server component. As a result, all its dependent\nclasses must reside in the server classloader. I do not see anything wrong with\nthis.", "attachment_id": null, "id": 51271, "creator": "remm@apache.org", "time": "2004-01-27T23:31:23Z", "bug_id": 26475, "creation_time": "2004-01-27T23:31:23Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 26475, "attachment_id": null, "text": "This is a regession.  \n\nAll the classes are in the classpath.  The problem is that it is not picking \nup information as needed from the servlet container.  Even if you put the conf \nfiles in the root web application under web-inf it still does not find them.", "id": 51272, "time": "2004-01-27T23:54:27Z", "creator": "opusbtvs@netscape.net", "creation_time": "2004-01-27T23:54:27Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 26475, "text": "/WEB-INF is the application classloader, not the server classloader. This does\nnot convince me at all. If somehow the realm can look up stuff, the conext CL is\nthe webapp CL during the realm initialization. If nobody looks at this report\nwithin a week, I'll close it again.", "id": 51286, "time": "2004-01-28T09:07:41Z", "creator": "remm@apache.org", "creation_time": "2004-01-28T09:07:41Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 26475, "attachment_id": null, "id": 51618, "time": "2004-02-02T20:08:12Z", "creator": "remm@apache.org", "creation_time": "2004-02-02T20:08:12Z", "is_private": false, "text": "As there has been no activity, and I think the classloading behavior is the\nright one, I am closing this bug. Please use tomcat-user if you are still\nexperiencing problems."}]
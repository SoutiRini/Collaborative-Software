[{"count": 0, "tags": [], "bug_id": 43334, "attachment_id": null, "text": "Since upgrading apache to 2.2.6, I now see 'garbage' displayed in the Server\nheader of the HTTP response, which I believe is caused by mod_ssl:\n  Server: Apache/2.2.6 (Unix) mod_ssl/2.2.6 (8$ DAV/2\n\nThe error log contains nothing other than this notice, also showing the garbage\ncharacters:\n  [notice] Apache/2.2.6 (Unix) mod_ssl/2.2.6 (8$\\b DAV/2 configured -- resuming\nnormal operations\n\nThe garbage characters do not change during successive HTTP requests.  The\nstring *sometimes* varies when httpd is restarted via 'apachectl restart'.  A\nspace (0x20) always appears at either side of the garbage characters.  Sometimes\nafter restarting, no garbage characters appear but there are still two spaces\nbetween mod_ssl/2.2.6 and DAV/2 (presumably the garbage output began with 0x00\non those occasions).\n\nThe error is present when no shared modules are being loaded.  I had compiled\nhttpd from source and configured as follows:\n  ./configure --prefix= --localstatedir=/var --sysconfdir=/etc/apache2\n--enable-layout=Debian --enable-so --with-program-name=apache2\n--with-suexec-caller=www-data --with-suexec-bin=/usr/lib/apache2/suexec2\n--with-suexec-docroot=/var/www --with-suexec-userdir=public_html\n--with-suexec-logfile=/var/log/apache2/suexec.log --with-ldap=yes\n--with-ldap-include=/usr/include --with-ldap-lib=/usr/lib --with-z\n--enable-deflate --enable-headers --with-mpm=worker --enable-expires\n--enable-ssl --enable-dav --with-apr=/usr\n\nAfter compiling without --enable-ssl, the version string appeared normal:\n  [notice] Apache/2.2.6 (Unix) DAV/2 configured -- resuming normal operations\n\nTo double-check, I recompiled with --enable-ssl and restarted, and the problem\nreappeared:\n  [notice] Apache/2.2.6 (Unix) mod_ssl/2.2.6 \\xde\\x10\\x10\\b\\xc6\\x10\\x10\\b DAV/2\nconfigured -- resuming normal operations\n\nAn interesting side-effect is that the garbage characters can trigger this error\nin Visual Studio or .NET HTTP clients:\n  \"The server committed a protocol violation. Section=ResponseHeader Detail=CR\nmust be followed by LF\"\nThe error message partly erroneous, since indeed all CR's were followed by LF's,\nand the garbage characters at the time did not include either the CR or LF\ncontrol characters.  However, some of the garbage characters were probably\ninvalid for an HTTP response header, hence the 'protocol violation').\n\nPossibly related to #40146 ?  Though I'm not sure what the \"Current\nconfiguration:\" message is that the author referred to.\n\nps. the Version field in the bug tracker does not include 2.2.6, so I had to\nselect 2.2-HEAD.\n\nThanks!", "id": 107903, "time": "2007-09-09T09:43:12Z", "creator": "steven@pyro.eu.org", "creation_time": "2007-09-09T09:43:12Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 43334, "is_private": false, "text": "I now realise that the the string 'OpenSSL/x.x.x' should be appearing in place\nof the garbage characters.  I am using the latest available precompiled package\nfrom Debian 'etch' (stable), named libssl0.9.8.\n\n  # ldd `which apache2`\n        ...\n        libssl.so.0.9.8 => /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb7f48000)\n        ...\n  # dpkg -S /usr/lib/i686/cmov/libssl.so.0.9.8\n  libssl0.9.8: /usr/lib/i686/cmov/libssl.so.0.9.8\n  # dpkg -s libssl0.9.8\n  Package: libssl0.9.8\n  ...\n  Version: 0.9.8c-4\n\n  # openssl version\n  OpenSSL 0.9.8c 05 Sep 2006\n", "id": 107904, "time": "2007-09-09T09:52:15Z", "creator": "steven@pyro.eu.org", "creation_time": "2007-09-09T09:52:15Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 43334, "attachment_id": null, "text": "Could you please try if the following makes the error go away?:\n\nIndex: ssl_engine_vars.c\n===================================================================\n--- ssl_engine_vars.c   (Revision 573732)\n+++ ssl_engine_vars.c   (Arbeitskopie)\n@@ -640,7 +640,7 @@\n     static char *library = NULL;\n     char *result;\n\n-    if (!library) {\n+    {\n         char *cp, *cp2;\n         library = apr_pstrdup(p, SSL_LIBRARY_DYNTEXT);\n         if ((cp = strchr(library, ' ')) != NULL) {\n\nThis patch is no solution, but should help finding the root cause. I for myself\ncannot reproduce this currently.", "id": 107909, "time": "2007-09-09T12:11:14Z", "creator": "rpluem@apache.org", "creation_time": "2007-09-09T12:11:14Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43334, "attachment_id": null, "is_private": false, "id": 107910, "time": "2007-09-09T12:30:35Z", "creator": "steven@pyro.eu.org", "creation_time": "2007-09-09T12:30:35Z", "text": "Thanks!  That actually did work:\n  [notice] Apache/2.2.6 (Unix) mod_ssl/2.2.6 OpenSSL/0.9.8c DAV/2 configured --\nresuming normal operations\n\nI can see that the patch is just a workaround and that something bad is\nhappening... let me know if there's anything else I can do to find the cause of\nthis.\n"}, {"count": 4, "tags": [], "bug_id": 43334, "attachment_id": null, "is_private": false, "id": 107912, "time": "2007-09-09T13:06:07Z", "creator": "rpluem@apache.org", "creation_time": "2007-09-09T13:06:07Z", "text": "(In reply to comment #2)\n\n> Index: ssl_engine_vars.c\n> ===================================================================\n> --- ssl_engine_vars.c   (Revision 573732)\n> +++ ssl_engine_vars.c   (Arbeitskopie)\n> @@ -640,7 +640,7 @@\n>      static char *library = NULL;\n>      char *result;\n> \n> -    if (!library) {\n> +    {\n>          char *cp, *cp2;\n>          library = apr_pstrdup(p, SSL_LIBRARY_DYNTEXT);\n\nI assume that somehow we use the wrong pool when we call\nssl_var_lookup_ssl_version for the first time. But this needs to be examined\nfurther. Thanks for your quick feedback.\n\n"}, {"count": 5, "tags": [], "bug_id": 43334, "attachment_id": null, "is_private": false, "id": 108007, "time": "2007-09-10T23:41:15Z", "creator": "kerem@keremerkan.net", "creation_time": "2007-09-10T23:41:15Z", "text": "Hi,\n\nWe are using both Debian 3.1 and Debian 4.0 servers, and this problem only\nhappens on Debian 4.0 servers with OpenSSL 0.9.8 installed.\n\nThis is what httpd 2.2.6 on Debian 3.1 reports when starting:\n\nApache/2.2.6 (Unix) mod_ssl/2.2.6 OpenSSL/0.9.7e configured -- resuming normal\noperations\n\nAnd this is what httpd 2.2.6 on Debian 4.0 reports:\n\nApache/2.2.6 (Unix) mod_ssl/2.2.6 \\x14\\xf1\\x0f\\b configured -- resuming normal\noperations\n\nBoth binaries are configured with the same options and mod_sll is included\nstatically."}, {"count": 6, "tags": [], "creator": "wrowe@apache.org", "attachment_id": null, "id": 108060, "creation_time": "2007-09-12T03:49:16Z", "time": "2007-09-12T03:49:16Z", "bug_id": 43334, "text": "Try the committed patch (see URL) against 2.2.6 - this already looks\ngood against trunk.", "is_private": false}, {"count": 7, "tags": [], "creator": "rl@math.technion.ac.il", "text": "tested patch against 2.2.6 in RHEL 4 and Solaris 8/9. Works fine. ", "id": 108062, "attachment_id": null, "bug_id": 43334, "creation_time": "2007-09-12T04:18:58Z", "time": "2007-09-12T04:18:58Z", "is_private": false}, {"count": 8, "tags": [], "creator": "steven@pyro.eu.org", "text": "Patch applies OK against 2.2.6, and fixes the bug on Debian 4.0 (etch).  Thanks!\n", "id": 108064, "time": "2007-09-12T05:49:27Z", "bug_id": 43334, "creation_time": "2007-09-12T05:49:27Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "wrowe@apache.org", "is_private": false, "text": "Things don't go so well applying the patch from trunk onto 2.0 - an adjusted patch\ncan be grabbed from\n\nhttp://people.apache.org/~wrowe/ssl_version_pool_fix-2.0.patch\n\nI'll mark fixed when applied to the bugged branches 2.0 and 2.2", "id": 108075, "time": "2007-09-12T06:54:52Z", "bug_id": 43334, "creation_time": "2007-09-12T06:54:52Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 43334, "is_private": false, "id": 108141, "creation_time": "2007-09-13T06:56:57Z", "time": "2007-09-13T06:56:57Z", "creator": "wrowe@apache.org", "text": "This has been applied to 2.0 and 2.2 working branches.  Fix upcoming in the next\nreleases.", "attachment_id": null}, {"count": 11, "tags": [], "creator": "marcus.neukert@webde.de", "text": "This Bug is critical, because the garbage in the Server-Header can contain\nline-feeds or other stuff. In this case, the server-response is broken. For\nexample, if the garbage contains line-feeds, all following headers are part of\nthe response-body.", "id": 108642, "attachment_id": null, "bug_id": 43334, "creation_time": "2007-09-26T09:18:41Z", "time": "2007-09-26T09:18:41Z", "is_private": false}, {"count": 12, "attachment_id": null, "bug_id": 43334, "is_private": false, "id": 109009, "time": "2007-10-04T22:27:43Z", "creator": "wrowe@apache.org", "creation_time": "2007-10-04T22:27:43Z", "tags": [], "text": "Patch applied to both branches."}, {"count": 13, "tags": [], "bug_id": 43334, "is_private": false, "text": "*** Bug 43695 has been marked as a duplicate of this bug. ***", "id": 109722, "time": "2007-10-24T16:02:46Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-10-24T16:02:46Z", "attachment_id": null}, {"count": 14, "tags": [], "bug_id": 43334, "is_private": false, "text": "*** Bug 43708 has been marked as a duplicate of this bug. ***", "id": 109808, "time": "2007-10-26T09:23:37Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-10-26T09:23:37Z", "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 43334, "is_private": false, "text": "*** Bug 43865 has been marked as a duplicate of this bug. ***", "id": 110627, "time": "2007-11-16T02:40:05Z", "creator": "jorton@redhat.com", "creation_time": "2007-11-16T02:40:05Z", "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 43334, "is_private": false, "id": 110886, "creation_time": "2007-11-20T12:19:42Z", "time": "2007-11-20T12:19:42Z", "creator": "rpluem@apache.org", "text": "*** Bug 43918 has been marked as a duplicate of this bug. ***", "attachment_id": null}, {"count": 17, "tags": [], "creator": "rpluem@apache.org", "text": "*** Bug 44161 has been marked as a duplicate of this bug. ***", "id": 112439, "attachment_id": null, "bug_id": 43334, "creation_time": "2008-01-02T05:46:16Z", "time": "2008-01-02T05:46:16Z", "is_private": false}, {"count": 18, "tags": [], "bug_id": 43334, "attachment_id": null, "id": 112948, "creation_time": "2008-01-17T05:13:37Z", "time": "2008-01-17T05:13:37Z", "creator": "takashi.asfbugzilla@tks.st", "text": "*** Bug 44258 has been marked as a duplicate of this bug. ***", "is_private": false}, {"count": 19, "tags": [], "bug_id": 43334, "is_private": false, "id": 112950, "creation_time": "2008-01-17T06:27:50Z", "time": "2008-01-17T06:27:50Z", "creator": "Craig@haquarter.de", "text": "As this is a critial bug (can break the correct functionality of apache; also\nmay disclose paths, rewrite rules and other things from the memory), there\nshould be a new release of apache, 2.0.62!\nI'm a bit disappointed to see 2.0.61 happily announced as \"stable\" version! :(", "attachment_id": null}, {"count": 20, "tags": [], "bug_id": 43334, "is_private": false, "text": "*** Bug 44260 has been marked as a duplicate of this bug. ***", "id": 112958, "time": "2008-01-17T08:47:18Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-01-17T08:47:18Z", "attachment_id": null}]
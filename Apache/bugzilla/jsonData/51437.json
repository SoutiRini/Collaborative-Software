[{"count": 0, "tags": [], "bug_id": 51437, "attachment_id": 27210, "is_private": false, "id": 147520, "time": "2011-06-27T11:48:42Z", "creator": "osegarra@gencat.net", "creation_time": "2011-06-27T11:48:42Z", "text": "Created attachment 27210\njvm stack trace\n\nHi, \n\nI'm trying to enable SSL on a tomcat 6.0.32 on a windows 2003 server machine with tcnative version 1.20.\n\nWhen I add the following lines to the server.xml \n\n    <Connector port=\"8443\" \n               protocol=\"HTTP/1.1\" \n               SSLEnabled=\"true\"\n               maxThreads=\"150\" \n               scheme=\"https\" \n               secure=\"true\"\n               SSLCertificateFile=\"${catalina.base}/conf/ssl/presidencia.crt\" \n               SSLCertificateKeyFile=\"${catalina.base}/conf/ssl/presidencia.key\"\n               SSLCACertificateFile=\"${catalina.base}/conf/ssl/CA/catcert.pem\"/>\n\nIt crashes as:\n\nC:\\Tomcat 6.0\\bin>tomcat6.exe\n27-jun-2011 13:45:19 org.apache.catalina.core.AprLifecycleListener init\nINFO: Cargada la biblioteca nativa APR de Apache Tomcat 1.1.20\n27-jun-2011 13:45:19 org.apache.catalina.core.AprLifecycleListener init\nINFO: Capacidades APR: IPv6 [true], enviar fichero [true], aceptar filtros [false], aleatorio [true].\n27-jun-2011 13:45:19 org.apache.coyote.http11.Http11AprProtocol init\nINFO: Inicializando Coyote HTTP/1.1 en puerto http-8181\n#\n# A fatal error has been detected by the Java Runtime Environment:\n#\n#  EXCEPTION_ACCESS_VIOLATION (0xc0000005) at pc=0x10009890, pid=5300, tid=2620\n#\n# JRE version: 6.0_26-b03\n# Java VM: Java HotSpot(TM) Client VM (20.1-b02 mixed mode, sharing windows-x86 )\n# Problematic frame:\n# C  [tcnative-1.dll+0x9890]\n#\n# An error report file with more information is saved as:\n# C:\\Tomcat 6.0\\hs_err_pid5300.log\n#\n# If you would like to submit a bug report, please visit:\n#   http://java.sun.com/webapps/bugreport/crash.jsp\n# The crash happened outside the Java Virtual Machine in native code.\n# See problematic frame for where to report the bug.\n#\n\nC:\\Tomcat 6.0\\bin>\n\nIt looks an error related to tcnative and SSL.\n\nI attach the complete log.\n\nThanks a lot."}, {"count": 1, "tags": [], "text": "Hi,\n\nIs there any new about this bug? a big project is stopped due to this error.\n\nThanks a lot.", "is_private": false, "bug_id": 51437, "id": 147567, "time": "2011-06-28T17:19:35Z", "creator": "osegarra@gencat.net", "creation_time": "2011-06-28T17:19:35Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 51437, "attachment_id": null, "id": 147571, "time": "2011-06-28T17:30:54Z", "creator": "mturk@apache.org", "creation_time": "2011-06-28T17:30:54Z", "is_private": false, "text": "> SSLCACertificateFile=\"${catalina.base}/conf/ssl/CA/catcert.pem\"\n\nAre you sure this is a correct path?\nUsually the file is named cacert.pem not catcert.pem\n\nIf you can confirm the typo has caused the crash, it would be a\ngood starting point in making sure it doesn't happen again."}, {"count": 3, "tags": [], "bug_id": 51437, "text": "Yes, I'm sure.\n\nIt cames from Catcert (www.catcert.cat) which is our CA entity.\n\nThe complete path:\n\n  C:\\Tomcat 6.0\\conf\\ssl\\CA\\catcert.pem\n\nThanks a lot for your update.", "id": 147572, "time": "2011-06-28T17:33:35Z", "creator": "osegarra@gencat.net", "creation_time": "2011-06-28T17:33:35Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 51437, "text": "Have you tried without setting the SSLCACertificateFile\nAlso does your presidencia.key requires a password?", "id": 147573, "time": "2011-06-28T17:44:20Z", "creator": "mturk@apache.org", "creation_time": "2011-06-28T17:44:20Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 51437, "text": "Hi Mark, \n\nI have tried without the SSLCACertificateFile key but system raises the same error at startup.\n\npresidencia.key does not require password.\n\nNote that the certificate I'm using (crt + key + pem) is correctly working on another apache we have in our infraestructure.\n\nThanks a lot.", "id": 147590, "time": "2011-06-29T07:31:42Z", "creator": "osegarra@gencat.net", "creation_time": "2011-06-29T07:31:42Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 51437, "text": "By \"another Apache\" are you thinking of Apache Tomcat or Apache Http?\nAnd yes, the crash happens before CA file.\nIf not sensitive can you send me privately those certs, since I newer saw this kind of error.", "id": 147591, "time": "2011-06-29T07:51:14Z", "creator": "mturk@apache.org", "creation_time": "2011-06-29T07:51:14Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 51437, "is_private": false, "text": "Hi,\n\nI meant another apache web server (httpd).\n\nWhere can I send to you the certs ?\n\nThanks a lot.", "id": 147592, "time": "2011-06-29T08:00:54Z", "creator": "osegarra@gencat.net", "creation_time": "2011-06-29T08:00:54Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 51437, "attachment_id": null, "id": 147593, "time": "2011-06-29T08:03:16Z", "creator": "osegarra@gencat.net", "creation_time": "2011-06-29T08:03:16Z", "is_private": false, "text": "I have found your email and I have sent to you the certificates."}, {"count": 9, "tags": [], "bug_id": 51437, "is_private": false, "text": "You have a wrong certificate format.\nIt should be PEM not DER like in your case\n\nConvert it to .pem\nC:\\> openssl x509 -trustout -inform DER -in presidencia.crt -outform PEM -out presidencia.pem\n\n\nThen use\n SSLCertificateFile=\"${catalina.base}/conf/ssl/presidencia.pem\" \nIn your server.xml\n\nHowever I'll leave this issue open, cause we have some problem in reporting that error.\nEg. it should throw something something like openssl.exe prints out:\nc:\\>openssl.exe s_server -cert presidencia.crt -key presidencia.key\nunable to load certificate\n1448:error:0906D06C:PEM routines:PEM_read_bio:no start line:.\\crypto\\pem\\pem_lib.c:650:Expecting: TRUSTED CERTIFICATE\n\nInstead crashing the JVM", "id": 147609, "time": "2011-06-29T14:09:12Z", "creator": "mturk@apache.org", "creation_time": "2011-06-29T14:09:12Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 51437, "attachment_id": null, "id": 147612, "time": "2011-06-29T15:12:18Z", "creator": "osegarra@gencat.net", "creation_time": "2011-06-29T15:12:18Z", "is_private": false, "text": "Hi, \n\nTransforming certificate into .PEM format makes system work perfectly.\n\nThanks a lot for your quick response."}, {"count": 11, "tags": [], "text": "Fix in the SVN.\nLike Apache Httpd's mod_ssl, the certificate will be loaded in DER format if PEM format indicates PEM_R_NO_START_LINE", "attachment_id": null, "id": 147627, "creator": "mturk@apache.org", "time": "2011-06-30T04:29:09Z", "bug_id": 51437, "creation_time": "2011-06-30T04:29:09Z", "is_private": false}]
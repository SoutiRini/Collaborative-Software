[{"count": 0, "tags": [], "bug_id": 42870, "attachment_id": null, "text": "DBAppender.append(..) calls prepareStatement(..) without specifying the\nStatement.RETURN_GENERATED_KEYS flag, even when the connection is known to\nsupport the method getGeneratedKeys().\n\nOn DB2 v9 with JDBC type 4 driver (com.ibm.db2.jcc.DB2Driver) at least, this\ncauses a NullPointerException later on when DBAppender tries to read the\ngenerated key.  When the flag is not specified, the ResultSet returned from\ngetGeneratedKeys() is null.  NPE at DBAppender.java line 267.\n\nExisting bug: 37349 \"DBAppender not working with jTDS driver\" seems to have the\nsame root cause.\n\nHere's a code snippet that fixes the problem for me:\n\n  protected void append(LoggingEvent event) {\n      Connection connection = null;\n      try {\n          connection = connectionSource.getConnection();\n          connection.setAutoCommit(false);\n          \n          PreparedStatement insertStatement;\n          if (cnxSupportsGetGeneratedKeys) {\n              insertStatement = connection.prepareStatement(\n                  insertSQL, Statement.RETURN_GENERATED_KEYS);\n          } else {\n              insertStatement = connection.prepareStatement(insertSQL);\n          }", "id": 105322, "time": "2007-07-12T07:03:28Z", "creator": "richard.landers@ct.gov", "creation_time": "2007-07-12T07:03:28Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 42870, "attachment_id": null, "id": 106576, "time": "2007-08-09T23:17:29Z", "creator": "sdeboy@iname.com", "creation_time": "2007-08-09T23:17:29Z", "is_private": false, "text": "Implemented in revision 564479\n\nhttp://svn.apache.org/viewvc?view=rev&revision=564479\n\nThanks"}]
[{"attachment_id": 29570, "tags": [], "bug_id": 54118, "text": "Created attachment 29570\napache conf file\n\nWith apache 2.4.3 Win32 (Apache Lounge Distribution, Apache 2.4.3 win32, IPv6 and Crypto enabled, apr-1.4.6 apr-util-1.4.1 apr-iconv-1.2.1 openssl-1.0.1c zlib-1.2.7 pcre-8.30 libxml2-2.7.8 lua-5.1.5 expat 2.1.0).\n\nThe leak on the parent process appear when the child httpd process is recycled, so configure mpm_winnt_module with MaxConnectionsPerChild = 100:\n<IfModule mpm_winnt_module>\n    ThreadsPerChild         150\n    MaxConnectionsPerChild  100\n</IfModule>\n\nIn httpd.conf, configure ErrorLog and CustomLog to use rotatelogs program:\nErrorLog \"| bin/rotatelogs.exe logs/error.%Y-%m-%d.log 86400\"\nCustomLog \"| bin/rotatelogs.exe logs/access.%Y-%m-%d.log 86400\" common\n\nStart apache\nUsing \"handle\" program from sysinternal, execute \"handle -s -p <httpd parent pid>\"\nIn apache/bin directory, execute \"ab.exe -n 100 http://localhost/\"\nRexecute \"handle -s -p <httpd parent pid>\"\nCompare the 2 results:\n  - in the first I have: \"22C: Process       rotatelogs.exe(7956)\"\n  - in the second I have: \"22C: Process       <Non-existant Process>(7956)\"\n\nAnd to confirm it's due to rotatelogs used with CustomLog, comment the \"CustomLog\" line in httpd.conf and retry => no handle leak on the parent httpd process.", "count": 0, "id": 163283, "time": "2012-11-08T09:37:35Z", "creator": "carpentier@ipanematech.com", "creation_time": "2012-11-08T09:37:35Z", "is_private": false}]
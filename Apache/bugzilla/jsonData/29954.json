[{"count": 0, "tags": [], "bug_id": 29954, "attachment_id": null, "id": 60250, "time": "2004-07-07T16:01:31Z", "creator": "jeakins@us.ibm.com", "creation_time": "2004-07-07T16:01:31Z", "is_private": false, "text": "This issue first becomes visible to end users when using Ant 1.6.1 to process \nSQL scripts against DB2 8.1 FixPak 6 due to changes in the DB2 FixPak to \ntighten error reporting code.  If Ant is used to process SQL statements that \ndo not generate a result set, such as Create Table or Drop Table, a CLI0125E \nfunction sequence error is returned by DB2 following the call to:\n\n     ret = statement.getMoreResults();\n\nThis error message from the DB2 perspective is expected behavior with the \ncurrent Ant code, as the CLI function sequence reveals the error actually \noccurs when attempting to return the number of columns in the resultset when \nstatement.getMoreResults() returns SQL_NO_DATA_FOUND, indicating that there is \nno resultset to process:\n\n     SQLExecDirectW(\"drop table test\") <- successful           \n     SQLNumResultCols()   <- successful                        \n     SQLRowCount()    <- successful                            \n     SQLNumResultCols()   <- successful                        \n     SQLMoreResults()   <- SQL_NO_DATA_FOUND                   \n     SQLNumResultCols()   <- CLI0125E function sequence error  \n\nThough this error is first visible to customers after upgrading to DB2 8.1 \nFixPak 6, the error was in fact always present in earlier releases.  With \nFixPak 5 it was only visible through a trace, which would reveal \nan \"Unretrieved error message CLI0125E\" at the same location.  DB2 FixPak 6 \nhas been updated to ensure that such errors are reported back to the user as \nthey should have been originally.\n\nThe solution to this error would be to update the Ant code to process a check \nfollowing the call to statement.getMoreResults() to check for the \nSQL_NO_DATA_FOUND condition.  For example, the current code:\n\n            resultSet = statement.getResultSet();                     \n            do {                                                      \n                if (!ret) {                                           \n                    if (updateCount != -1) {                          \n                        updateCountTotal += updateCount;              \n                    }                                                 \n                } else {                                              \n                    if (print) {                                      \n                        printResults(out);                            \n                    }                                                 \n                }                                                     \n                ret = statement.getMoreResults();                     \n                updateCount = statement.getUpdateCount();             \n                resultSet = statement.getResultSet();                 \n            } while (ret);                                            \n\n\n...\n\nCould be changed to something similar to the following:\n\n            resultSet = statement.getResultSet();                     \n            do {                                                      \n                if (!ret) {                                           \n                    if (updateCount != -1) {                          \n                        updateCountTotal += updateCount;              \n                    }                                                 \n                } else {                                              \n                    if (print) {                                      \n                        printResults(out);                            \n                    }                                                 \n                }\n                ret = statement.getMoreResults();                       \n                if (ret != 0 and ret == 100) // SQL_NO_DATA_FOUND        \n                {                       \n  // No data was found on getMoreResults(), no further action should be \ntaken... possibly break out of loop at this stage\n                }\n                else {\n                updateCount = statement.getUpdateCount();               \n                resultSet = statement.getResultSet();  }                 \n            } while (ret);"}, {"count": 1, "tags": [], "bug_id": 29954, "attachment_id": null, "id": 60252, "time": "2004-07-07T16:20:27Z", "creator": "jeakins@us.ibm.com", "creation_time": "2004-07-07T16:20:27Z", "is_private": false, "text": "Steps to reproduce:\n\n1.  Create an SQL script C:/CreateTables.sql with the following statements:\n\n\ndrop table test;                  \ncreate table test(col1 char(1));  \n\n\n2.  Create the following build.xml file.  Be sure to adjust the database name \nin the url as well as userid and password:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>             \n<project name=\"DatabaseLoad\" default=\"main\">       \n  <target name=\"main\">                             \n    <echo message=\"Building Database...\"/>         \n    <sql                                           \n        driver=\"COM.ibm.db2.jdbc.app.DB2Driver\"    \n        url=\"jdbc:db2:MyDataBase\"                  \n        userid=\"username\"                          \n        password=\"password\"                        \n        onerror=\"continue\">                        \n        <transaction src=\"C:/CreateTables.sql\"/>   \n     </sql>                                        \n  </target>                                        \n</project>                 \n\n3.  Install DB2 8.1 FixPak 6 and Ant 1.6.1.  Run with the command:\n\nant -v -f build.xml \n\n4.  To test with earlier DB2 8.1 FixPak releases, you will need to enable CLI \ntracing in DB2 and manually review the trace file to verify that the CLI0125E \nis indeed occurring, though it is never reported to the end user in FixPak 5 \nand under.  to enable tracing in DB2 CLI, issue the commands:\n\n    db2 update cli cfg for section common using TRACE 1\n    db2 update cli cfg for section common using TRACEFLUSH 1\n    db2 update cli cfg for section common using TRACEPATHNAME C:\\temp\n    db2 terminate\n\nA .cli trace file will be written to the specified TRACEPATHNAME directory.  \nThis directory must already exist as DB2 will not create it.\n\nTracing may be disabled using:\n\n    db2 update cli cfg for section common using TRACE 0\n                        \n"}, {"count": 2, "tags": [], "bug_id": 29954, "attachment_id": null, "is_private": false, "id": 62797, "time": "2004-08-30T19:09:25Z", "creator": "rmulvaney@curamsoftware.com", "creation_time": "2004-08-30T19:09:25Z", "text": "Any chance that this could be looked at. It blocks the take-on of any DB2 \nupdates/fix-packs which is a bit of a nuisance.\n\nCheers."}, {"count": 3, "attachment_id": null, "bug_id": 29954, "is_private": false, "id": 65202, "time": "2004-10-15T18:07:17Z", "creator": "jeakins@us.ibm.com", "creation_time": "2004-10-15T18:07:17Z", "tags": [], "text": "IBM is addressing this issue under APAR IY61764.  "}, {"count": 4, "tags": [], "bug_id": 29954, "is_private": false, "text": "The problem still occurs in DB2 8.1.8 and also with the the Ant 1.6.3beta1", "id": 73456, "time": "2005-04-08T20:04:32Z", "creator": "trajano@yahoo.com", "creation_time": "2005-04-08T20:04:32Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 29954, "is_private": false, "text": "I have downloaded the latest CVS repository copy as of right now and the good \nnews is that it works now.", "id": 73459, "time": "2005-04-08T21:10:08Z", "creator": "trajano@yahoo.com", "creation_time": "2005-04-08T21:10:08Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 73515, "time": "2005-04-11T11:31:17Z", "bug_id": 29954, "creation_time": "2005-04-11T11:31:17Z", "is_private": false, "text": "I've merged the fix into the 1.6 branch, should work with 1.6.3 final."}, {"count": 7, "tags": [], "bug_id": 29954, "attachment_id": null, "is_private": false, "id": 73517, "time": "2005-04-11T11:36:13Z", "creator": "bodewig@apache.org", "creation_time": "2005-04-11T11:36:13Z", "text": "for reference (until we start to use subversion, this must work as changeset):\n\nChecking in WHATSNEW;\n/home/cvs/ant/WHATSNEW,v  <--  WHATSNEW\nnew revision: 1.503.2.214; previous revision: 1.503.2.213\ndone\nMore commits to come...\nChecking in src/main/org/apache/tools/ant/taskdefs/SQLExec.java;\n/home/cvs/ant/src/main/org/apache/tools/ant/taskdefs/SQLExec.java,v  <-- \nSQLExec.java\nnew revision: 1.62.2.5; previous revision: 1.62.2.4\ndone\n"}]
[{"count": 0, "tags": [], "text": "Using Batik in Cocoon, activating the key_execute_onload transcoding hint of\nbatik rasterizer and using ecmascript on the onload attribute of the SVG root\nelement produces the following error:\n\njava.lang.IllegalArgumentException: securityDomain should be null if\nsetSecurityController() was never called\n        at org.mozilla.javascript.Context.compileImpl(Context.java:2324)\n        at org.mozilla.javascript.Context.compileReader(Context.java:1334)\n        at org.mozilla.javascript.Context.compileReader(Context.java:1306)\n        at org.mozilla.javascript.Context.evaluateReader(Context.java:1248)\n        at org.apache.batik.script.rhino.RhinoInterpreter.evaluate(Unknown Source)\n\nThis happens because Cocoon loads Rhino for its own FlowScript before Batik is\nrequested to read an SVG image with scripting.  In this case, the context is\nalready initialized, but without security controller.  The patch attached sets\nthe security controller in all cases, whether or not the context has been\ninitialized by Batik.", "is_private": false, "id": 76054, "creator": "jbq@anyware-tech.com", "time": "2005-06-06T10:40:09Z", "bug_id": 35233, "creation_time": "2005-06-06T10:40:09Z", "attachment_id": null}, {"attachment_id": 15308, "tags": [], "creator": "jbq@anyware-tech.com", "is_private": false, "count": 1, "id": 76055, "time": "2005-06-06T10:42:05Z", "bug_id": 35233, "creation_time": "2005-06-06T10:42:05Z", "text": "Created attachment 15308\npatch against revision 1.41 of RhinoInterpreter"}, {"count": 2, "tags": [], "bug_id": 35233, "text": "Apparently setSecurityController() cannot be invoked more than once, and there\nis no getter.  So we have to have to surround the piece of code with a \"try\ncatch\" statement, see patch attached.", "id": 76073, "time": "2005-06-06T15:57:15Z", "creator": "jbq@anyware-tech.com", "creation_time": "2005-06-06T15:57:15Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 35233, "text": "Created attachment 15315\npatch against revision 1.41 of RhinoInterpreter.java", "id": 76074, "time": "2005-06-06T15:58:21Z", "creator": "jbq@anyware-tech.com", "creation_time": "2005-06-06T15:58:21Z", "is_private": false, "attachment_id": 15315}, {"attachment_id": null, "tags": [], "creator": "jbq@anyware-tech.com", "text": "This patch is not acceptable because Cocoon ends up invoking functions through\nthe batik security controller.  I don't know exactly what is the best fix. \nBuild a new context every time?  Remove all references to rhinoClassloader?", "count": 4, "id": 76080, "time": "2005-06-06T17:55:13Z", "bug_id": 35233, "creation_time": "2005-06-06T17:55:13Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "deweese@apache.org", "text": "Just so it's clear, I'm willing to work with you on this but\nI don't really understand the problem, can you propose \nsolutions that meet Cocoons needs?\n\nObviously, Batik needs a security controller in the normal\ncase.  If you want a way to turn this off we might be\nwilling to make the change...", "count": 5, "id": 80084, "time": "2005-09-18T01:55:14Z", "bug_id": 35233, "creation_time": "2005-09-18T01:55:14Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "jbq@anyware-tech.com", "is_private": false, "count": 6, "id": 80090, "time": "2005-09-18T18:22:57Z", "bug_id": 35233, "creation_time": "2005-09-18T18:22:57Z", "text": "Thank you for your help.  Yes I think the best solution if you want to keep the\nsecurity feature is to provide two implementations of RhinoInterpreter, one with\nthe security stuff, and one without.  The best actually would be to provide two\nJARs so that Cocoon release engineering team can pickup the one without security\nstuff.\n\nSo Cocoon users could use the latter when wishing to execute JavaScript on SVG.\n Currently Cocoon also uses Rhino for the FlowScript and AFAICT Rhino is a\nsingleton so all Java components the make use of it must agree whether to use\nsecurity features or not."}, {"count": 7, "attachment_id": null, "creator": "deweese@apache.org", "is_private": false, "id": 80099, "time": "2005-09-19T11:55:04Z", "bug_id": 35233, "creation_time": "2005-09-19T11:55:04Z", "tags": [], "text": "To be clear we wouldn't provide two implementations, most likely we would\nmake the security settings for Rhino controllable from the UserAgent\nclass of Batik.  So Cocoon could 'turn off' security in Rhino."}, {"count": 8, "tags": [], "bug_id": 35233, "is_private": false, "text": "I believe Thomas may have fixed this as part of a modification primarily made for applets (see revision 677245). This is available as part of the current trunk code (version 1.8-pre, that is).\n\nCould this be confirmed?", "id": 140491, "time": "2010-10-05T12:08:35Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-10-05T12:08:35Z", "attachment_id": null}]
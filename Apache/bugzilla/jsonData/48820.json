[{"count": 0, "attachment_id": null, "bug_id": 48820, "is_private": false, "id": 134913, "time": "2010-02-26T04:12:57Z", "creator": "naozo.yoshioka@fujixerox.co.jp", "creation_time": "2010-02-26T04:12:57Z", "tags": [], "text": "event.getThreadName();\n    event.getNDC();\n    event.getMDCCopy();\nmust be invoked to import thread dependent values into event.\n\nSee org.apache.log4j.net.SMTPAppender.append(LoggingEvent event).\nIt invokes above methods because SMTPAppender uses a buffer like JDBCAppender.\n\nI think\n  public void append(LoggingEvent event) {\n    buffer.add(event);\n\n    if (buffer.size() >= bufferSize)\n      flushBuffer();\n  }\nshould be like\n  public void append(LoggingEvent event) {\n    event.getThreadName();\n    event.getNDC();\n    event.getMDCCopy();\n    buffer.add(event);\n\n    if (buffer.size() >= bufferSize)\n      flushBuffer();\n  }\nor\n  public void append(LoggingEvent event) {\n\n    buffer.add(event);\n\n    if (buffer.size() >= bufferSize)\n      flushBuffer();\n    int size = buffer.size();\n    if (size > 0 && buffer.get(size - 1) == event) {\n      event.getThreadName();\n      event.getNDC();\n      event.getMDCCopy();\n    }\n  }"}]
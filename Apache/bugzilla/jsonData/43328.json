[{"count": 0, "attachment_id": null, "bug_id": 43328, "text": "[Applies to both 2.2.4 and 2.2.6, but for the latter, there is no Version in\nbugzilla at the time of writing]\n\nMy script to configure:\n\n#!/bin/sh\nmake distclean\nexport CFLAGS=\"-I/usr/local/openldap-2.3.27/include\n-I/usr/local/src/httpd-2.2.4/srclib/apr-util/include\"\nexport LDFLAGS=\"-L/usr/local/openldap-2.3.27/lib\n-L/usr/local/src/httpd-2.2.4/srclib/apr-util/lib\"\n./configure --enable-threads=posix \\\n  --prefix=/usr/local/httpd-2.2.6 \\\n  --enable-dav \\\n  --enable-dav-fs \\\n  --enable-dav-lock \\\n  --enable-so \\\n  --enable-dbd \\\n  --enable-mods-shared=all \\\n  --enable-ssl \\\n  --with-ssl=/usr/local/openssl-0.9.8e \\\n  --with-ldap \\\n  --with-authnz-ldap\n\nBuild fails with:\n\n/bin/sh /usr/local/src/httpd-2.2.6/srclib/apr/libtool --silent --mode=compile\ngcc -pthread  -I/usr/local/openldap-2.3.27/include\n-I/usr/local/src/httpd-2.2.4/srclib/apr-util/include -DHAVE_CONFIG_H -DLINUX=2\n-D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE  \n-I/usr/local/src/httpd-2.2.6/srclib/apr-util/include\n-I/usr/local/src/httpd-2.2.6/srclib/apr-util/include/private \n-I/usr/local/src/httpd-2.2.6/srclib/apr/include    -o ldap/apr_ldap_init.lo -c\nldap/apr_ldap_init.c && touch ldap/apr_ldap_init.lo\nIn file included from ldap/apr_ldap_init.c:27:\n/usr/local/src/httpd-2.2.6/srclib/apr-util/include/apr_ldap.h:103:2: error:\n#error Support for LDAP v2.0 toolkits has been removed from apr-util. Please use\nan LDAP v3.0 toolkit.\n\nTo me, this is the same error as in\nhttp://mail-archives.apache.org/mod_mbox/httpd-users/200704.mbox/%3C52796.137.111.15.199.1176711467.squirrel@babylon.alphacomplex.org%3E\n2.0.61 compiles fine", "id": 107826, "time": "2007-09-07T12:09:42Z", "creator": "r.sokoll@intershop.de", "creation_time": "2007-09-07T12:09:42Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "r.sokoll@intershop.de", "text": "(In reply to comment #0)\n\n> #!/bin/sh\n> make distclean\n> export CFLAGS=\"-I/usr/local/openldap-2.3.27/include\n-I/usr/local/src/httpd-2.2.4/srclib/apr-util/include\"\n> export LDFLAGS=\"-L/usr/local/openldap-2.3.27/lib\n-L/usr/local/src/httpd-2.2.4/srclib/apr-util/lib\"\n\nChanged both CFLAGS and LDFLAGS to 2.2.6 instead of 2.2.4, but this did not\nchange anything.", "id": 107828, "time": "2007-09-07T12:20:00Z", "bug_id": 43328, "creation_time": "2007-09-07T12:20:00Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "bnicholes@apache.org", "text": "Apparently the ldap.h header that your environment is pointing to, #defines \nLDAP_VERSION_MAX < 3.  LDAP support in apr_util must be v3.", "id": 107835, "time": "2007-09-07T13:35:11Z", "bug_id": 43328, "creation_time": "2007-09-07T13:35:11Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "r.sokoll@intershop.de", "is_private": false, "id": 107843, "time": "2007-09-07T23:07:56Z", "bug_id": 43328, "creation_time": "2007-09-07T23:07:56Z", "tags": [], "text": "(In reply to comment #2)\n\n> Apparently the ldap.h header that your environment is pointing to, #defines \n> LDAP_VERSION_MAX < 3.  LDAP support in apr_util must be v3.\n\nNo, it has\n#define LDAP_VERSION_MAX        LDAP_VERSION3\n\ncf. also\nhttp://www.openldap.org/devel/cvsweb.cgi/~checkout~/include/ldap.h?rev=1.312.2.8&hideattic=1&sortbydate=0\n\n"}, {"attachment_id": null, "tags": [], "bug_id": 43328, "is_private": false, "count": 4, "id": 107844, "time": "2007-09-07T23:11:54Z", "creator": "r.sokoll@intershop.de", "creation_time": "2007-09-07T23:11:54Z", "text": "(In reply to comment #3)\n\n> No, it has\n> #define LDAP_VERSION_MAX        LDAP_VERSION3\n\nMore precise:\n\n#define LDAP_VERSION1   1\n#define LDAP_VERSION2   2\n#define LDAP_VERSION3   3\n\n#define LDAP_VERSION_MIN        LDAP_VERSION2\n#define LDAP_VERSION            LDAP_VERSION2\n#define LDAP_VERSION_MAX        LDAP_VERSION3\n\nSo I'd say that LDAP_VERSION_MAX is 3"}, {"count": 5, "tags": [], "bug_id": 43328, "attachment_id": null, "text": "Finally, I got it compiled.\nWhat I did:\n\n- open srclib/apr-util/include/apr_ldap.h.in in your editor\n- around line 102, right before \"#if LDAP_VERSION_MAX <= 2\", add a line \"#define\nLDAP_VERSION_MAX 3\"\n- ./configure with your options\n- open srclib/apr-util/include/apr_ldap.h in your editor\n- around line 126, right before \"#include \"apr_ldap_url.h\"\", add a line\n\"#include <ldap.h>\"\n- make && make install\n\nI still consider this as a bug", "id": 107847, "time": "2007-09-08T04:29:35Z", "creator": "r.sokoll@intershop.de", "creation_time": "2007-09-08T04:29:35Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 43328, "attachment_id": null, "id": 107970, "time": "2007-09-10T08:27:08Z", "creator": "bnicholes@apache.org", "creation_time": "2007-09-10T08:27:08Z", "is_private": false, "text": "I'm not sure why this would be considered a bug.  It works fine everywhere \nelse.  The hack into apr_ldap.h is just working around the real problem which \nis that the version of the ldap SDK that is being reported by the environment \nis incorrect."}, {"count": 7, "tags": [], "bug_id": 43328, "attachment_id": null, "id": 107972, "time": "2007-09-10T08:36:44Z", "creator": "r.sokoll@intershop.de", "creation_time": "2007-09-10T08:36:44Z", "is_private": false, "text": "(In reply to comment #6)\n\n> I'm not sure why this would be considered a bug.  It works fine everywhere \n> else.  The hack into apr_ldap.h is just working around the real problem which \n> is that the version of the ldap SDK that is being reported by the environment \n> is incorrect.\n\nI don't want to be annoying - so please take my apologies. Also, I am by no\nmeans a programmer.\nBut from where apr_ldap.h should know about LDAP_VERSION_MAX? As far as I can\nsee, ldap.h is included nowhere.\n\n"}, {"count": 8, "tags": [], "bug_id": 43328, "attachment_id": null, "is_private": false, "id": 107993, "time": "2007-09-10T14:44:51Z", "creator": "bnicholes@apache.org", "creation_time": "2007-09-10T14:44:51Z", "text": "apr_ldap.h is rewritten by configure from apr_ldap.h.in.  If you take a look \nat the configure generated apr_ldap.h, you will see where the #include \n<ldap.h> has been added.  If you don't see it there, then check the output \nfrom configure. It probably could not find a suitable LDAP SDK and therefore \n@ldap_h@ was never defined."}, {"count": 9, "tags": [], "bug_id": 43328, "text": "Brad,\n\nI really appreciate your patience.\n\nin srclib/apr-util/config.log I see:\n\nconfigure:15672: gcc -c -I/usr/local/openldap-2.3.33/include -pthread  -DLINUX=2\n-D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE conftest.c >&5\nconfigure:15678: $? = 0\nconfigure:15685: test -z \"$ac_c_werror_flag\" || test ! -s conftest.err\nconfigure:15688: $? = 0\nconfigure:15695: test -s conftest.o\nconfigure:15698: $? = 0\nconfigure:15709: result: yes\nconfigure:15713: checking lber.h presence\nconfigure:15728: gcc -E  -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE\n-D_LARGEFILE64_SOURCE conftest.c\nconftest.c:19:18: error: lber.h: No such file or directory\nconfigure:15734: $? = 1\nconfigure: failed program was:\n| /* confdefs.h.  */\n| #define PACKAGE_NAME \"\"\n| #define PACKAGE_TARNAME \"\"\n| #define PACKAGE_VERSION \"\"\n| #define PACKAGE_STRING \"\"\n| #define PACKAGE_BUGREPORT \"\"\n| #define STDC_HEADERS 1\n| #define HAVE_SYS_TYPES_H 1\n| #define HAVE_SYS_STAT_H 1\n| #define HAVE_STDLIB_H 1\n| #define HAVE_STRING_H 1\n| #define HAVE_MEMORY_H 1 \n| #define HAVE_STRINGS_H 1\n| #define HAVE_INTTYPES_H 1\n| #define HAVE_STDINT_H 1\n| #define HAVE_UNISTD_H 1\n| #define HAVE_LIBLBER 1\n| /* end confdefs.h.  */\n| #include <lber.h>\n\nI think the problem is here:\ngcc -E  -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE -D_LARGEFILE64_SOURCE conftest.c\n\nFrom my poor knowledge, it should be\ngcc -E -I/usr/local/openldap-2.3.33/include -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE\n-D_LARGEFILE64_SOURCE conftest.c\n\n(CFLAGS are set and exported)\n\nAgain, I appreciate your patience.\n", "id": 108014, "time": "2007-09-11T04:32:05Z", "creator": "r.sokoll@intershop.de", "creation_time": "2007-09-11T04:32:05Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 43328, "is_private": false, "text": "Try using --with-ldap-include, --with-ldap-lib, --with-ldap rather than \nsetting the CFLAGS and LDFLAGS", "id": 108021, "time": "2007-09-11T07:15:32Z", "creator": "bnicholes@apache.org", "creation_time": "2007-09-11T07:15:32Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 43328, "attachment_id": null, "is_private": false, "id": 108023, "time": "2007-09-11T07:37:28Z", "creator": "r.sokoll@intershop.de", "creation_time": "2007-09-11T07:37:28Z", "text": "(In reply to comment #10)\n\n> Try using --with-ldap-include, --with-ldap-lib, --with-ldap rather than \n> setting the CFLAGS and LDFLAGS\n\nThat worked, thank you.\nWhat confused me:\nIn the top level directory, I did a \"./configure --help\" to see what options are\nneeded/supported.\nThere are only 2 ldap related options:\n  --enable-authnz-ldap    LDAP based authentication\n  --enable-ldap           LDAP caching and connection pooling services\n\nThat is why I set CFLAGS and LDAP to tell the compiler/linker where to find the\nheaders/libs.\n\nYou are correct: There is no bug in the source - but someone should really\nupdate the main configure script.\nBTW: \"srclib/apr-util/configure --help\" prints the options you mentioned.\n\nThis could confuse other users too, I think.\nAnyway: Thank you for your time. If you wish, you may close this ticket (or\nbetter: reassign it to the person who is responsible for configure)"}]
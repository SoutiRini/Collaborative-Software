[{"count": 0, "tags": [], "creator": "raizdepi@gmail.com", "text": "When using the CATALINA_PID variable the catalina.sh stop action verify if the PID file is empty (-s $CATALINA_PID) and after that verify if the file is a file (-f $CATALINA_PID). But if the file doesn't exist the \"test -s\" return 1 consequently the message \"\\$CATALINA_PID was set but the specified file does not exist. Is Tomcat running? Stop aborted.\" is never printed.\n\nI made a patch to fix this, but what you need to do is just invert \"-s\" and \"-f\".\n\n\nPATCH:\n--- catalina.sh.bkp\t2011-06-01 12:02:07.541350449 -0300\n+++ catalina.sh\t2011-06-01 12:02:37.916302955 -0300\n@@ -403,19 +403,19 @@\n   fi\n \n   if [ ! -z \"$CATALINA_PID\" ]; then\n-    if [ -s \"$CATALINA_PID\" ]; then\n-      if [ -f \"$CATALINA_PID\" ]; then\n+    if [ -f \"$CATALINA_PID\" ]; then\n+      if [ -s \"$CATALINA_PID\" ]; then\n         kill -0 `cat \"$CATALINA_PID\"` >/dev/null 2>&1\n         if [ $? -gt 0 ]; then\n           echo \"PID file found but no matching process was found. Stop aborted.\"\n           exit 1\n         fi\n       else\n-        echo \"\\$CATALINA_PID was set but the specified file does not exist. Is Tomcat running? Stop aborted.\"\n-        exit 1\n+        echo \"PID file is empty and has been ignored.\"\n       fi\n     else\n-      echo \"PID file is empty and has been ignored.\"\n+      echo \"\\$CATALINA_PID was set but the specified file does not exist. Is Tomcat running? Stop aborted.\"\n+      exit 1\n     fi\n   fi", "id": 146797, "time": "2011-06-01T15:33:13Z", "bug_id": 51309, "creation_time": "2011-06-01T15:33:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 51309, "attachment_id": null, "is_private": false, "id": 146826, "time": "2011-06-02T20:11:43Z", "creator": "markt@apache.org", "creation_time": "2011-06-02T20:11:43Z", "text": "Thanks for the patch.\n\nFor future reference patches work best as attachments the lines are likely to get wrapped if you paste them in the comments box.\n\nThe patch has been applied to 7.0.x and will be included in 7.0.15 onwards.\n\nI have proposed the patch for 6.0.x."}, {"count": 2, "tags": [], "creator": "raizdepi@gmail.com", "text": "(In reply to comment #1)\n> Thanks for the patch.\n> \n> For future reference patches work best as attachments the lines are likely to\n> get wrapped if you paste them in the comments box.\n> \n> The patch has been applied to 7.0.x and will be included in 7.0.15 onwards.\n> \n> I have proposed the patch for 6.0.x.\n\nThanks Mark", "id": 146834, "time": "2011-06-03T10:55:10Z", "bug_id": 51309, "creation_time": "2011-06-03T10:55:10Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "is_private": false, "id": 147101, "creation_time": "2011-06-14T11:48:54Z", "time": "2011-06-14T11:48:54Z", "bug_id": 51309, "text": "This has been fixed in 6.0.x and will be included in 6.0.33 onwards.", "attachment_id": null}]
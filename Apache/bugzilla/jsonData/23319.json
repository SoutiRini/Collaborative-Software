[{"count": 0, "tags": [], "bug_id": 23319, "attachment_id": null, "is_private": false, "id": 44429, "time": "2003-09-22T08:39:24Z", "creator": "apache.org@schildbach.de", "creation_time": "2003-09-22T08:39:24Z", "text": "Please have a look at the following JSP/JSTL snippet:\n\n<a href=\"<c:url value=\"action.jsp\">\n     <c:param name=\"param1\" value=\"value1\"/>\n     <c:param name=\"param2\" value=\"value2\"/>\n</c:url>\">action</a>\n\nWhen requested by an HTTP client, the following response is returned:\n\n<a href=\"action.jsp?param1=value1&param2=value2\">action</a>\n\nBUG: The ampersand between the two parameters should be escaped, for example by\nusing &amp;\n\nFor testing, I created a demo under http://schildbach.de/test-jstl-c-out.jsp\n\nPlease use the W3C validator (http://validator.w3.org/) and enter my test URL,\nand you will get the 6 errors I attached below.\n\nI am using Tomcat 4.1.27, JDK 1.4.2 and JSTL 1.03\n\n---\n\n> # Line 13, column 81:  cannot generate system identifier for general \n> entity \"param2\"\n> \n>    ...E16EDEC5EAFDA47DCBBB44?param1=value1&param2=value2\">action</a>\n>                                            ^\n> \n> # Line 13, column 81: general entity \"param2\" not defined and \n> no default \n> entity (explain...).\n> \n>    ...E16EDEC5EAFDA47DCBBB44?param1=value1&param2=value2\">action</a>\n>                                            ^\n> \n> # Line 13, column 87: reference not terminated by REFC delimiter\n> \n>    ...C5EAFDA47DCBBB44?param1=value1&param2=value2\">action</a>\n>                                            ^\n> \n> # Line 13, column 87: reference to external entity in attribute value\n> \n>    ...C5EAFDA47DCBBB44?param1=value1&param2=value2\">action</a>\n>                                            ^\n> \n> # Line 13, column 87: reference to entity \"param2\" for which \n> no system \n> identifier could be generated\n> \n>    ...C5EAFDA47DCBBB44?param1=value1&param2=value2\">action</a>\n>                                            ^\n> \n> # Line 13, column 80: entity was defined here\n> \n>    ...2E16EDEC5EAFDA47DCBBB44?param1=value1&param2=value2\">action</a>"}, {"count": 1, "tags": [], "bug_id": 23319, "attachment_id": null, "is_private": false, "id": 44476, "time": "2003-09-23T00:40:24Z", "creator": "pierre.delisle@sun.com", "creation_time": "2003-09-23T00:40:24Z", "text": "Thanks for the report.\nA fix is ready but unfortunately it breaks in Tomcat's RequestDispatcher\nwhen \"&amp;\" is used instead of \"&\" (with <c:import>).\n(all actions that make use of <c:param> share the same param generation code).\nI have pinged the Tomcat team on that issue.\nIt is possible to do a fix for only <c:url>, but I'll wait to hear from them \nbefore going ahead."}, {"count": 2, "tags": [], "bug_id": 23319, "attachment_id": null, "text": "OK. Cleared up the situation with tomcat and this is indeed a \nproblem that has to be fixed at the level of <c:url>.\n\nThis will however require a change to the spec.\nUnfortunately, the JSTL 1.1 Maintenance Release spec is now frozen\nand the fix will have to wait for the next release.\n\nThe change that the expert group has agreed on so far is to add\none new attribute to <c:url>, 'escapeAmp', to escape the ampersand character.\nDefault value for that attribute will be false, for backwards compatibility.", "id": 45222, "time": "2003-10-07T20:18:18Z", "creator": "pierre.delisle@sun.com", "creation_time": "2003-10-07T20:18:18Z", "is_private": false}, {"count": 3, "tags": [], "creator": "apache.org@schildbach.de", "text": "I don't understand the rationale behind defaulting to generating invalid HTML\n(according to W3C).\n\nIn the case of <c:url>, I don't understand the need for that escapeAmp attribute\nat all, because why would I ever _not_ escape an ampersand if I get invalid HTML\notherwise?\n\nIf the reason for that behaviour is that the same routines are being shared\nbetween <c:url> and other related code, maybe this is a hint that the code\nshould not be shared any longer or should be refactored to accommodate the two\ndifferent cases.\n\nAnyway, perhaps it would be possible to apply or at least describe a workaround\nfor JSTL 1.0.", "id": 46749, "time": "2003-11-04T13:31:12Z", "bug_id": 23319, "creation_time": "2003-11-04T13:31:12Z", "is_private": false, "attachment_id": null}, {"count": 4, "text": "Andreas,\n\nI understand your point, and it makes a lot of sense.\nThe problem though is that we have to deal with what's currently\nin the spec and its impact on backwards compatibility.\n\nIf it had been clearly spelled out in the spec that the output of \n<c:url> were to be used strictly for URIs used in HTML element attribute \nvalues, then I'd agree with you.\n\nThe problem though is that the output of <c:url> may also be used \nin other contexts. For example (not the best example, but just\nto make the point), one could have used <c:url> as follows:\n\n  <c:url value=\"foo\" var=\"myUrl\">\n    <c:param name=\"param1\" value=\"value1\"/>\n    <c:param name=\"param2\" value=\"value2\"/>\n  </c:url>\n\n  <c:redirect url=\"${myUrl}\"/>\n\nIn that context, we don't want the ampersands to be escaped.\nIt would break <c:redirect> which expects parameters to be separated\nby '&' and not '&amp;'. \n\nSince the escaping of '&' to '&amp;' has not been clearly \nspelled out in the spec, we would not be backwards compatible.", "bug_id": 23319, "is_private": false, "id": 50217, "time": "2004-01-08T02:08:03Z", "creator": "pierre.delisle@sun.com", "creation_time": "2004-01-08T02:08:03Z", "tags": [], "attachment_id": null}, {"count": 5, "tags": [], "creator": "pierre.delisle@sun.com", "text": "*** Bug 28652 has been marked as a duplicate of this bug. ***", "id": 56577, "time": "2004-04-28T21:20:39Z", "bug_id": 23319, "creation_time": "2004-04-28T21:20:39Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 23319, "attachment_id": null, "text": "This is not yet resolved. Will be in the next JSTL Maintenance Release.", "id": 56578, "time": "2004-04-28T21:22:29Z", "creator": "pierre.delisle@sun.com", "creation_time": "2004-04-28T21:22:29Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 23319, "attachment_id": null, "is_private": false, "id": 57251, "time": "2004-05-12T00:26:56Z", "creator": "nagoya@felipeal.net", "creation_time": "2004-05-12T00:26:56Z", "text": "CC'ing the taglibs-dev address to all Standard bugs. "}, {"attachment_id": null, "tags": [], "bug_id": 23319, "text": "Changing Severity to Enhancement since this issue cannot be resolved in the implementation until the \nspecification is clarified. Will be addressed by next JSTL specification maintenance release.", "count": 8, "id": 59201, "time": "2004-06-14T17:38:41Z", "creator": "justyna.horwat@sun.com", "creation_time": "2004-06-14T17:38:41Z", "is_private": false}, {"count": 9, "tags": [], "text": "As far as I can tell, there were no changes to the spec related to this. The\nJSTL 1.2 spec for c:param and c:url is identical to the 1.1 and 1.0 specs.\n\nSo this remains an issue for the EG team and not this particular codebase.\nReading the spec, it does state for c:url that:\n\n\"If the URL contains characters that should be encoded (e.g. space), it is the\nuser's responsibility to encode them. \"\n\nc:param on the other hand says:\n\n\"Moreover, it has been designed such that the attributes name and value are\nautomatically URL encoded. \"\n\nThe two sections seem to contradict each other.", "attachment_id": null, "id": 96888, "creator": "bayard@apache.org", "time": "2006-12-13T14:17:43Z", "bug_id": 23319, "creation_time": "2006-12-13T14:17:43Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 23319, "is_private": false, "count": 10, "id": 96889, "time": "2006-12-13T14:21:06Z", "creator": "bayard@apache.org", "creation_time": "2006-12-13T14:21:06Z", "text": "I've reported this to the 1.2 RI:\n\nhttps://glassfish.dev.java.net/issues/show_bug.cgi?id=1743\n\nWe won't be fixing it unless the spec changes."}, {"attachment_id": null, "tags": [], "bug_id": 23319, "text": "I'm getting my url encoding and xml escaping muddled. Ignore my quotes from the\nspec.\n", "count": 11, "id": 96890, "time": "2006-12-13T14:26:02Z", "creator": "bayard@apache.org", "creation_time": "2006-12-13T14:26:02Z", "is_private": false}]
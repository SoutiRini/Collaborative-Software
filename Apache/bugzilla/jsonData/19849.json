[{"count": 0, "tags": [], "creator": "glenn@apache.org", "text": "System, Sun Netra T1, Solaris 7, Apache 2.0.45 with worker MPM.\n\nWhen stress testing a binary cgi the mod_cgid daemon would die.\nAfter it had died Apache would detect and log that it had died with\nthis message in the error_log,\n\"No such process: cgid daemon is gone; is Apache terminating?\".\n\nIt does not attempt to restart the cgi daemon process again so all\nsubsequent CGI requests fail.\n\nApache 2 with the worker MPM for CGI would be more robust if mod_cgid\ncould restart its child daemon process if it dies.", "id": 37059, "time": "2003-05-12T13:33:14Z", "bug_id": 19849, "creation_time": "2003-05-12T13:33:14Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "glenn@apache.org", "text": "I have done some more research.\n\nWhen the cgid_daemon dies I see the following error message, the pid is for\nthe cgid_daemon:\n\n[Wed May 28 11:05:59 2003] [notice] child pid 24470 exit signal Broken pipe (13)\n\nI added some debug logging to the cgid_maint function in mod_cgid.c.\n\nWhen the cgid_daemon dies with a broken pipe cgid_maint logged the following:\n\n[Wed May 28 11:05:59 2003] [error] cgid_maint\n[Wed May 28 11:05:59 2003] [error] cgid_maint APR_OC_REASON_DEATH\n[Wed May 28 11:05:59 2003] [error] cgid_maint\n[Wed May 28 11:05:59 2003] [error] cgid_maint APR_OC_REASON_UNREGISTER\n[Wed May 28 11:05:59 2003] [error] cgid_maint DONE\n[Wed May 28 11:05:59 2003] [error] cgid_maint DONE\n\nThe code for doing a graceful restart is triggered when APR_OC_REASON_LOST is\nthe reason, but this is never received by cgid_maint.\n\nHere are all the log entries when I reproduced this:\n[Wed May 28 11:05:12 2003] [notice] Apache/2.0.45 (Unix) mod_ssl/2.0.45\nOpenSSL/0.9.7a mod_jk/1.2.3 configured -- resuming normal operations\n[Wed May 28 11:05:12 2003] [info] Server built: May 15 2003 21:22:19\n[Wed May 28 11:05:57 2003] [error] [client 207.160.133.9] Premature end of\nscript headers: counterdate.cgi\n[Wed May 28 11:05:57 2003] [error] [client 207.160.133.9] unable to include\n\"/cgi/counterdate.cgi\" in parsed file /export/home/moxp/www/www/index.html\n[Wed May 28 11:05:57 2003] [info] (32)Broken pipe: core_output_filter: writing\ndata to the network\n[Wed May 28 11:05:58 2003] [info] (32)Broken pipe: core_output_filter: writing\ndata to the network\n[Wed May 28 11:05:58 2003] [info] (32)Broken pipe: core_output_filter: writing\ndata to the network\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] Premature end of\nscript headers: counter.cgi\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] unable to include\n\"/cgi/counter.cgi\" in parsed file /export/home/moxp/www/www/index.html\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] Premature end of\nscript headers: counterdate.cgi\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] unable to include\n\"/cgi/counterdate.cgi\" in parsed file /export/home/moxp/www/www/index.html\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] Premature end of\nscript headers: counterdate.cgi\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] unable to include\n\"/cgi/counterdate.cgi\" in parsed file /export/home/moxp/www/www/index.html\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] Premature end of\nscript headers: counterdate.cgi\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] unable to include\n\"/cgi/counterdate.cgi\" in parsed file /export/home/moxp/www/www/index.html\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] Premature end of\nscript headers: counterdate.cgi\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] unable to include\n\"/cgi/counterdate.cgi\" in parsed file /export/home/moxp/www/www/index.html\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] Premature end of\nscript headers: counter.cgi\n[Wed May 28 11:05:58 2003] [error] [client 207.160.133.9] unable to include\n\"/cgi/counter.cgi\" in parsed file /export/home/moxp/www/www/index.html\n[Wed May 28 11:05:59 2003] [notice] child pid 24470 exit signal Broken pipe (13)\n[Wed May 28 11:05:59 2003] [error] cgid_maint\n[Wed May 28 11:05:59 2003] [error] cgid_maint APR_OC_REASON_DEATH\n[Wed May 28 11:05:59 2003] [error] cgid_maint\n[Wed May 28 11:05:59 2003] [error] cgid_maint APR_OC_REASON_UNREGISTER\n[Wed May 28 11:05:59 2003] [error] cgid_maint DONE\n[Wed May 28 11:05:59 2003] [error] cgid_maint DONE\n[Wed May 28 11:05:59 2003] [error] [client 207.160.133.9] (3)No such process:\ncgid daemon is gone; is Apache terminating?: /export/home/moxp/www/cgi/counter.cgi\n", "id": 37927, "time": "2003-05-28T16:21:56Z", "bug_id": 19849, "creation_time": "2003-05-28T16:21:56Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "glenn@apache.org", "text": "Attached is a patch which will restart the cgid daemon if it dies.\nAt first I tried doing a server restart like the cgid_maint code had\noriginally been setup to do, ( kill(getpid(), AP_SIG_GRACEFUL); ) but after \nan apache restart from cgid_maint I saw a number of the following warning\nmessages. cgid worked fine though.\n\n[Wed May 28 10:49:42 2003] [warn] long lost child came home! (pid 21018)\n[Wed May 28 10:49:42 2003] [warn] long lost child came home! (pid 21019)\n\nSo I wrote a patch that would just restart the cgid daemon rather than\nrestart apache itself.  This patch seems to work fine.", "id": 37966, "time": "2003-05-29T02:09:50Z", "bug_id": 19849, "creation_time": "2003-05-29T02:09:50Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "Created attachment 6553\npatch to restart cgid daemon if it dies", "attachment_id": 6553, "bug_id": 19849, "id": 37967, "time": "2003-05-29T02:11:26Z", "creator": "glenn@apache.org", "creation_time": "2003-05-29T02:11:26Z", "is_private": false}, {"count": 4, "tags": [], "creator": "glenn@apache.org", "text": "A final note.  We started upgrading some of our production Sun Solaris servers\nto Apache 2 seven weeks ago  Two of those servers have had the cgid daemon\ndie at once during the seven week period.  This resulted in cgi's failing until\nour customers notified us of the problem.  We then had to restart or stop/start\napache.  The patch I sumbitted will automatically restart the cgid daemon so\nthat only a few cgi requests fail rather coninuous failure until restart or\nstop/start of apache.", "id": 37968, "time": "2003-05-29T02:15:50Z", "bug_id": 19849, "creation_time": "2003-05-29T02:15:50Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 19849, "is_private": false, "text": "Thanks for your patch, and hopefully it will get reviewed/committed soon.\n\nI wanted to mention that if you're running into any problems with cgid, you need\nto apply this patch:\n\nhttp://cvs.apache.org/viewcvs.cgi/httpd-2.0/modules/generators/mod_cgid.c.diff?r1=1.150&r2=1.151\n\nThat fixes a simple bug with horrendous consequences, including the murder of\nthe cgid daemon process (with the sigpipe in the library).\n", "id": 39257, "time": "2003-06-23T02:41:36Z", "creator": "trawick@apache.org", "creation_time": "2003-06-23T02:41:36Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 19849, "attachment_id": null, "text": "patch committed, thanks!!!!!\n\nI'll propose it for merging into the stable branch (2.0.47-dev).\n", "id": 39300, "time": "2003-06-23T20:20:52Z", "creator": "trawick@apache.org", "creation_time": "2003-06-23T20:20:52Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 19849, "attachment_id": null, "text": "*** Bug 22483 has been marked as a duplicate of this bug. ***", "id": 43157, "time": "2003-08-22T11:47:27Z", "creator": "trawick@apache.org", "creation_time": "2003-08-22T11:47:27Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 19849, "attachment_id": null, "text": "*** Bug 23533 has been marked as a duplicate of this bug. ***", "id": 49072, "time": "2003-12-13T22:28:06Z", "creator": "trawick@apache.org", "creation_time": "2003-12-13T22:28:06Z", "is_private": false}]
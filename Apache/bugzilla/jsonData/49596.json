[{"count": 0, "tags": [], "bug_id": 49596, "attachment_id": null, "text": "Hello,\n\nthis is the xml file:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<project name=\"bug-fileset\">\n\n\t<property name=\"input_place\" value=\"d:/kits/test\" />\n\n\t<patternset id=\"firstFiles\">\n\t\t<include name=\"/beta/**/*.txt\" />\n\t\t<exclude name=\"/beta/**/*_*.txt\" />\n\t</patternset>\n\n\t<fileset id=\"input_fileSet\" dir=\"${input_place}\">\n\t\t<patternset refid=\"firstFiles\" />\n\t</fileset>\n\n\t<target name=\"echo\">\n\t\t<echo>Content of input_fileSet: ${toString:input_fileSet}</echo>\n\t</target>\n\n</project>\n\nSteps to reproduce\n\n1. on the file system in \"d:kits/test/\", create some files like \"beta/beta.txt\", \"beta/gamma/gamma.txt\", \"beta/gamma/gamma_2.txt\"\n\nResults with the preceding \"/\" in \"include\":\n\n [echo] Content of input_fileSet: beta\\beta.txt\n\nConclusion: the filset above (<include name=\"/beta/**/*.txt\" />\n) will LIMIT the search to the \"beta\" folder's direct child files, even if there is a \"**/\" after it indicating to search the subdirs. If you remove the starting slash, than it goes in beta's subdirectories, like it should:\n\n [echo] Content of input_fileSet: beta\\beta.txt;beta\\gamma\\gamma.txt\n\nThis does not appear to happen for the \"exclude\". With or without the starting \"/\" in exclude, it searches the subdirs too. I can see this because \"beta/gamma/gamma_2.txt\" never shoes when the \"include\" searches the subdirs (not starting with \"/\")\n\nThis is a bug because the starting \"/\" cannot have an effect on a subsequent \"/**\".", "id": 138439, "time": "2010-07-15T08:48:05Z", "creator": "vlad.balan@gmail.com", "creation_time": "2010-07-15T08:48:05Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 25861\nmore complete testcase\n\nThe attachment is your originial build file plus a mkdir and three touch-tasks to set up the environment.\n\nThings are different on Windows than Unix and this is to be expected.\n\nOn Unix the leading slash turns the patterns into absolute paths and so they are mo longer resolved relative to ${input_place}.  You don't expect to match anything with slashes and expect beta.txt and gamma.txt to be matched without the leading slashes and this is just what happens.\n\nOn Windows I've replaced /tmp with C:/temp and I get the same result - beta.txt and gamma.txt with and without leading slashes.  I cannot reproduce what you describe.", "is_private": false, "id": 138970, "creator": "bodewig@apache.org", "time": "2010-08-07T15:28:33Z", "bug_id": 49596, "creation_time": "2010-08-07T15:28:33Z", "attachment_id": 25861}, {"count": 2, "tags": [], "bug_id": 49596, "is_private": false, "text": "(In reply to comment #1)\n> Created an attachment (id=25861) [details]\n> more complete testcase\n> The attachment is your originial build file plus a mkdir and three touch-tasks\n> to set up the environment.\n> Things are different on Windows than Unix and this is to be expected.\n> On Unix the leading slash turns the patterns into absolute paths and so they\n> are mo longer resolved relative to ${input_place}.  You don't expect to match\n> anything with slashes and expect beta.txt and gamma.txt to be matched without\n> the leading slashes and this is just what happens.\n> On Windows I've replaced /tmp with C:/temp and I get the same result - beta.txt\n> and gamma.txt with and without leading slashes.  I cannot reproduce what you\n> describe.\n\nYou are right, it works on 1.8, it only happened on Ant 1.7.1 20090120. The other bug i had tested it on 1.8 and 1.7.1 and failed on both.\n\n\nthe point is to have a preceding \"/\", like this: <include name=\"/beta/**/*.txt\" /> \n\nIf it is of any interest you can test on this version.\nPls. excuse me for your time.", "id": 138972, "time": "2010-08-07T16:18:22Z", "creator": "vlad.balan@gmail.com", "creation_time": "2010-08-07T16:18:22Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "vlad.balan@gmail.com", "is_private": false, "count": 3, "id": 138974, "time": "2010-08-07T16:45:16Z", "bug_id": 49596, "creation_time": "2010-08-07T16:45:16Z", "text": "Sorry to post this here hoping you will be reading this.\nI think there is a error in the 3rd example from the bottom on this manual page\n\nhttp://ant.apache.org/manual/index.html\n\nregarding: from=\"src${file.separator}*.file\"\n\nLook at this one and at the last who says \n\n<!-- redirect STDIN; fileset collects relative to its dir, but we need -->\n        <!-- relative to basedir -->\n        <inputmapper type=\"glob\" from=\"*\" to=\"src/*\"/>\n\nSo in the 3rd example there should be: from=\"{file.separator}*.file\"\n\n\n\nApparenlty a mapper receives a file in the form of its segments of the file name after the fileset's dir.\n\nEx: for a file \"D:a/b/c.txt\" obtained from <fileset dir=\"D:/a\" includes=\"**/*.txt\"/>\n\nthe mapper will receive \"b/c.txt\"\n\nIn contrast, the nesting task of a fileset, like the \"apply\" task for example, knows to obtain the complete file name: \"D:a/b/c.txt\".\n\nIs this conclusion right?"}, {"count": 4, "attachment_id": null, "bug_id": 49596, "text": "(In reply to comment #3)\n\n> Sorry to post this here hoping you will be reading this.\n> I think there is a error in the 3rd example from the bottom on this manual page\n> \n> http://ant.apache.org/manual/index.html\n\nwhich one?\n\n> Apparenlty a mapper receives a file in the form of its segments of the file\n> name after the fileset's dir.\n>\n> Ex: for a file \"D:a/b/c.txt\" obtained from <fileset dir=\"D:/a\"\n> includes=\"**/*.txt\"/>\n> \n> the mapper will receive \"b/c.txt\"\n\nIn case of a fileset, yes.  For other resource collections it may receive the absolute path.\n\n> In contrast, the nesting task of a fileset, like the \"apply\" task for example,\n> knows to obtain the complete file name: \"D:a/b/c.txt\".\n\nYes, the task resolves it (with the help of fileset.getDir())", "id": 138975, "time": "2010-08-07T16:50:32Z", "creator": "bodewig@apache.org", "creation_time": "2010-08-07T16:50:32Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "text": "Here's my message again:\n\n\nSorry to post this here hoping you will be reading this.\nI think there is a error in the 3rd example from the bottom on this manual page\n\nhttp://ant.apache.org/manual/index.html\n\nregarding: from=\"src${file.separator}*.file\"\n\nLook at this one and at the last who says \n\n... redirect STDIN; fileset collects relative to its dir, but we need ...\n        ... relative to basedir ...\n        <inputmapper type=\"glob\" from=\"*\" to=\"src/*\"/>\n\nSo in the 3rd example there should be: from=\"{file.separator}*.file\"\n\n\n\nApparenlty a mapper receives a file in the form of its segments of the file\nname after the fileset's dir.\n\nEx: for a file \"D:a/b/c.txt\" obtained from <fileset dir=\"D:/a\"\nincludes=\"**/*.txt\"/>\n\nthe mapper will receive \"b/c.txt\"\n\nIn contrast, the nesting task of a fileset, like the \"apply\" task for example,\nknows to obtain the complete file name: \"D:a/b/c.txt\".\n\nIs this conclusion right?", "attachment_id": null, "bug_id": 49596, "id": 138979, "time": "2010-08-08T03:53:09Z", "creator": "vlad.balan@gmail.com", "creation_time": "2010-08-08T03:53:09Z", "is_private": false}, {"count": 6, "tags": [], "creator": "vlad.balan@gmail.com", "text": "There's a question (about an error) and a request for confirmation (what a mapper receives and gives).\n\nThank you very much for the confirmation. Now it remains the question.", "id": 138980, "time": "2010-08-08T03:58:21Z", "bug_id": 49596, "creation_time": "2010-08-08T03:58:21Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "vlad.balan@gmail.com", "is_private": false, "id": 138981, "creation_time": "2010-08-08T04:05:21Z", "time": "2010-08-08T04:05:21Z", "bug_id": 49596, "text": "Comming a little back to your reply about the request for confirmation:\n\n> Yes, the task resolves it (with the help of fileset.getDir())\n\n\n\n1. In the case of \"apply\"'s nested mapper (for computing the so called dependency  le), it's with the help of the \"dest\" attribute or, in the absence of dest, the base directory, right? Rather than the dir of the fileset.\n\n2. And in the case of a mapper nested in a redirector, like outputmapper, it's with the help of the base directory only, like the last example in that manual page says.", "attachment_id": null}, {"count": 8, "tags": [], "creator": "bodewig@apache.org", "text": "Vlad, please use the user mailing list for questions, the issue tracker is the wrong place for this.\n\nI don't know which question about an error you need to get answered.  You point out an error in the manual but don't tell us which page of the manual contains the error (the URL you've given is the URL of a frameset that doesn't identify the individual page).\n\nWRT comment 7:\n\nIf the nested mapper returns an absolute path, then dest is ignored.  And like the manual says, if you don't provide a dest attribute, the mapper must return absolute paths.\n\nThe case of outputmapper is different since the outputmapper doesn't know the dest attribute at all - to work reliably the outputmapper should always return absolute paths.", "id": 138982, "time": "2010-08-08T04:19:09Z", "bug_id": 49596, "creation_time": "2010-08-08T04:19:09Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "vlad.balan@gmail.com", "text": "(In reply to comment #8)\n> Vlad, please use the user mailing list for questions, the issue tracker is the\n> wrong place for this.\n\nOK, i know your are right.\n\n> I don't know which question about an error you need to get answered.  You point\n> out an error in the manual but don't tell us which page of the manual contains\n> the error (the URL you've given is the URL of a frameset that doesn't identify\n> the individual page).\n\nI'm sorry, i didn't see in copies the url of the framset. The page is this: List of types/ File Mappers. The error in the 3rd example from the bottom that i suspect is this:\n\n... from=\"src${file.separator}*.file\" ... should be ... from=\"{file.separator}*.file\" ...\n\n\nLook at this one and at the last who says \n\n... redirect STDIN; fileset collects relative to its dir, but we need ...\n        ... relative to basedir ...\n        <inputmapper type=\"glob\" from=\"*\" to=\"src/*\"/>\n\n\n> WRT comment 7:\n> If the nested mapper returns an absolute path, then dest is ignored.  And like\n> the manual says, if you don't provide a dest attribute, the mapper must return\n> absolute paths.\n> The case of outputmapper is different since the outputmapper doesn't know the\n> dest attribute at all - to work reliably the outputmapper should always return\n> absolute paths.\n\nThank you.", "count": 9, "id": 138983, "time": "2010-08-08T04:29:08Z", "bug_id": 49596, "creation_time": "2010-08-08T04:29:08Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 49596, "text": "Again i missled you, the page is that of the exec task, not of the file mappers.", "id": 138984, "time": "2010-08-08T04:41:11Z", "creator": "vlad.balan@gmail.com", "creation_time": "2010-08-08T04:41:11Z", "is_private": false, "attachment_id": null}]
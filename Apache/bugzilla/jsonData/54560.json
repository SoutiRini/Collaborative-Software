[{"count": 0, "tags": [], "creator": "mike.rumph@oracle.com", "attachment_id": null, "id": 165243, "time": "2013-02-13T21:11:45Z", "bug_id": 54560, "creation_time": "2013-02-13T21:11:45Z", "is_private": false, "text": "The ap_process_fnmatch_configs function in server/config.c has the following code:\n\n    if ((ap_server_pre_read_config->nelts\n        || ap_server_post_read_config->nelts)\n        && !(strcmp(fname, ap_server_root_relative(ptemp, SERVER_CONFIG_FILE)))) {\n        apr_finfo_t finfo;\n\n        if (apr_stat(&finfo, fname, APR_FINFO_LINK | APR_FINFO_TYPE, ptemp) != APR_SUCCESS)\n            return NULL;\n    }\n\nThe ap_server_root_relative function could potentially return NULL which would result in a segmentation fault within strcmp.\n\nThis bug is related to the following bugs:\n- https://issues.apache.org/bugzilla/show_bug.cgi?id=52816 \n- https://issues.apache.org/bugzilla/show_bug.cgi?id=39722 \n\nThis code is first seen in 2.4.1 and still exists in 2.5-HEAD."}, {"count": 1, "tags": [], "text": "There are at least hundreds of calls to ap_server_root_relative if you include third-party code.  All of these calls are subject to the ap_server_root-misconfiguration problem.  ap_server_root is only set in main().  ap_server_root should be verified near the point set so that the ap_server_root_relative() calls aren't subject to a bad \"-d Z:/\" or compiled-in value.  One check in main() for the return code of 'ap_server_root_relative(some_pool, \"foo\")' will (IIUC) solve the reported problems in httpd with checking the ap_server_root_relative() return code.\n\nPerhaps there is a way to force a failure of ap_filepath_merge() using a module's configuration which ends up in the second parameter of ap_server_root_relative().  That can't be solved without (potentially) a large number of error paths added to httpd and other modules.", "is_private": false, "id": 165309, "creator": "trawick@apache.org", "time": "2013-02-18T17:55:58Z", "bug_id": 54560, "creation_time": "2013-02-18T17:55:58Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 54560, "attachment_id": null, "text": ">Perhaps there is a way to force a failure of \n>ap_filepath_merge() using a module's configuration...\nI guess \"DocumentRoot z:/\" is a previously-fixed way to do this... Silly me...", "id": 165310, "time": "2013-02-18T18:00:31Z", "creator": "trawick@apache.org", "creation_time": "2013-02-18T18:00:31Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 54560, "attachment_id": null, "text": "Is this a real issue ?\n\nAccording to my testing\n   - incorrect -d directory or HTTPD_ROOT\n==> httpd: Could not open configuration file /xxx/conf/httpd.conf: No such file or directory\n\n   - incorrect DocumentRoot directive\n==> AH00526: Syntax error on line 217 of /usr/local/apache2/conf/httpd.conf:\nDocumentRoot must be a directory\n\n\n\nIn all 3 cases, httpd exits at start-up with a message clearly showing the erroneous path. We don't know the root reason (-d, default or DocumentRoot) but isn't it enough ?", "id": 165500, "time": "2013-02-27T07:18:22Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2013-02-27T07:18:22Z", "is_private": false}]
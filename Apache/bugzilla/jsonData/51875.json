[{"count": 0, "tags": [], "creator": "marcel.may.de@gmail.com", "attachment_id": 27570, "id": 149653, "time": "2011-09-22T20:24:16Z", "bug_id": 51875, "creation_time": "2011-09-22T20:24:16Z", "is_private": false, "text": "Created attachment 27570\nUpdated test-data/spreadsheet/NewlineInFormulas.xlsx containing shared formula with newline to trigger exception\n\nWhen a shared formular in a XLSM sheet contains a newline ('\\r\\n') character POI throws an exception:\n\norg.apache.poi.ss.formula.FormulaParseException: Unused input [\n+B2] after attempting to parse the formula [B1\n+B2]\n    at org.apache.poi.ss.formula.FormulaParser.parse(FormulaParser.java:1571)\n    at org.apache.poi.ss.formula.FormulaParser.parse(FormulaParser.java:174)\n    at org.apache.poi.xssf.usermodel.XSSFCell.convertSharedFormula(XSSFCell.java:396)\n    at org.apache.poi.xssf.usermodel.XSSFCell.getCellFormula(XSSFCell.java:368)\n    at org.apache.poi.xssf.usermodel.XSSFEvaluationWorkbook.getFormulaTokens(XSSFEvaluationWorkbook.java:150)\n    at org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:281)\n    at org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:225)\n    at org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateFormulaCellValue(XSSFFormulaEvaluator.java:264)\n    at org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateFormulaCell(XSSFFormulaEvaluator.java:151)\n    at org.apache.poi.xssf.usermodel.TestXSSFBugs.test50440(TestXSSFBugs.java:637)\n   ...\n\nMy proposed fix modifies the formula parser to treat newlines like whitespaces\n(which get skipped and therefore will prevent the parser to 'throw up' when encountering newlines).\n\nThis makes a previous workaround obsolete (see https://issues.apache.org/bugzilla/show_bug.cgi?id=50440).\n\nPatch will follow.\n\nCheers,\nMarcel"}, {"count": 1, "tags": [], "bug_id": 51875, "attachment_id": 27571, "is_private": false, "id": 149655, "time": "2011-09-22T20:32:51Z", "creator": "marcel.may.de@gmail.com", "creation_time": "2011-09-22T20:32:51Z", "text": "Created attachment 27571\nFixes FormularParser, extends the TestXSSFBugs test case, and reverts the previous and obsolete workaround from #50440"}, {"count": 2, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 151969, "time": "2011-12-05T00:52:48Z", "bug_id": 51875, "creation_time": "2011-12-05T00:52:48Z", "is_private": false, "text": "Thanks for this, patch applied in r1210299."}]
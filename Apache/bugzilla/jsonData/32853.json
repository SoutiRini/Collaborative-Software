[{"count": 0, "tags": [], "bug_id": 32853, "text": "Overview:\n- In Ant 1.6.2 and a recent nightly build, the <java> task, with fork=\"true\",\nfailOnError=\"false\" and timeout=\"4000\" (for instance), when the timeout expires,\ncorrectly terminates the class specified, shows \"Timeout: killed the\nsub-process\", but then also shows an exception stack trace.\n- In Ant 1.6.1, no exception stack trace was shown, which seems appropriate in\nthis situation.\n\n\nSteps:\n   1)create file Applet1c.java:\n      public class Applet1c {\n         public static void main(String[] args) {\n           try {\n            Thread.sleep(10000);\n           } catch (InterruptedException e) {\n           \n           }\n         }\n      }\n\n   2)create build.xml:\n      <project name=\"MyProject\" default=\"Applet1c\" basedir=\".\">\n        <target name=\"Applet1c\">\n          <java\n           classname=\"Applet1c\"\n           classpath=\"${basedir};${basedir}/..\"\n           dir=\".\"\n           error=\"tmp.txt\"\n           failonerror=\"false\"\n           fork=\"true\"\n           timeout=\"4000\"/>\n        </target>\n      </project>\n\n   3)run ant:\n      ant\n\n\nActual output:\nBuildfile: build.xml\nApplet1c:\n     [java] Timeout: killed the sub-process\n     [java]     at org.apache.tools.ant.taskdefs.Java.fork(Java.java:749)\n     [java]     at org.apache.tools.ant.taskdefs.Java.executeJava(Java.java:170)\n     [java]     at org.apache.tools.ant.taskdefs.Java.execute(Java.java:83)\n     [java]     at\norg.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n     [java]     at org.apache.tools.ant.Task.perform(Task.java:364)\n     [java]     at org.apache.tools.ant.Target.execute(Target.java:341)\n     [java]     at org.apache.tools.ant.Target.performTasks(Target.java:369)\n     [java]     at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n     [java]     at org.apache.tools.ant.Project.executeTargets(Project.java:1062)\n     [java]     at org.apache.tools.ant.Main.runBuild(Main.java:673)\n     [java]     at org.apache.tools.ant.Main.startAnt(Main.java:188)\n     [java]     at org.apache.tools.ant.launch.Launcher.run(Launcher.java:196)\n     [java]     at org.apache.tools.ant.launch.Launcher.main(Launcher.java:55)\nBUILD SUCCESSFUL\nTotal time: 13 seconds\n\n\nExpected output:\nBuildfile: build.xml\nApplet1c:\n     [java] Timeout: killed the sub-process\nBUILD SUCCESSFUL\nTotal time: 13 seconds\n\n\nSuggested solution:\n- This change in behavior from Ant 1.6.1 to 1.6.2 seems to be related to the bug\nfix described in the release notes of Ant 1.6.2: \"<java> swallowed the stack\ntrace of exceptions thrown by the executed program if run in the same VM.\".\n- A possible solution would be to change the file\norg\\apache\\tools\\ant\\taskdefs\\Java.java (Ant 1.6.2), line 183 and following, as\nfollows:\n} catch (BuildException e) {\n            if (failOnError) {\n                throw e;\n            } else {\n                if (fork && (!spawn)) {\n                    log(e.getMessage(), Project.MSG_ERR);\n                } else {\n                    log(e);\n                }\n                return 0;\n            }\n        } catch (Throwable t) {", "id": 69019, "time": "2004-12-27T21:27:32Z", "creator": "bart_wauters@yahoo.com", "creation_time": "2004-12-27T21:27:32Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "stacktrace should now be swallowed again starting with svn revision 677571", "id": 118752, "time": "2008-07-17T05:53:01Z", "bug_id": 32853, "creation_time": "2008-07-17T05:53:01Z", "is_private": false}]
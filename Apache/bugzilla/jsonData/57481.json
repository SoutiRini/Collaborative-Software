[{"count": 0, "tags": [], "bug_id": 57481, "text": "Steps to reproduce:\n1. Configure Tomcat 8.0.17 to use BIO implementation of HTTP connector,\n    <Connector port=\"8081\" address=\"127.0.0.1\"\n               protocol=\"org.apache.coyote.http11.Http11Protocol\"\n               connectionTimeout=\"20000\"\n               redirectPort=\"8443\" />\n\n2. Start Tomcat\n\n3. Access\nhttp://localhost:8081/examples/servlets/nonblocking/numberwriter\n\n4. Result:\nThe page is displayed successfully (as expected),\nbut at the same time an IllegalStateException is logged to the console and into catalina.2015-01-22.log file (an unexpected):\n\n[[[\n22-Jan-2015 11:02:03.089 SEVERE [http-bio-127.0.0.1-8081-exec-10] org.apache.catalina.connector.CoyoteAdapter.asyncDispatch Exception while processing an asynchronous request\n java.lang.IllegalStateException: Calling [asyncComplete()] is not valid for a request with Async state [DISPATCHED]\n\tat org.apache.coyote.AsyncStateMachine.asyncComplete(AsyncStateMachine.java:270)\n\tat org.apache.coyote.http11.AbstractHttp11Processor.action(AbstractHttp11Processor.java:848)\n\tat org.apache.coyote.Request.action(Request.java:377)\n\tat org.apache.catalina.core.AsyncContextImpl.complete(AsyncContextImpl.java:86)\n\tat nonblocking.NumberWriter$NumberWriterListener.onError(NumberWriter.java:145)\n\tat org.apache.catalina.connector.CoyoteAdapter.asyncDispatch(CoyoteAdapter.java:304)\n\tat org.apache.coyote.http11.AbstractHttp11Processor.asyncDispatch(AbstractHttp11Processor.java:1696)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:650)\n\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:147)\n\tat org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:279)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n\tat java.lang.Thread.run(Thread.java:745)\n]]]\n\nThe NIO and APR connectors are working OK.", "id": 180464, "time": "2015-01-22T08:12:35Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2015-01-22T08:12:35Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 57481, "text": "Fixed in 8.0.x for 8.0.18 onwards. Confirmed this only affects BIO on 8.0.x.", "id": 180480, "time": "2015-01-22T14:46:58Z", "creator": "markt@apache.org", "creation_time": "2015-01-22T14:46:58Z", "is_private": false, "attachment_id": null}]
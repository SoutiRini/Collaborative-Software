[{"count": 0, "tags": [], "bug_id": 61201, "text": "I run the following bash script as CGI (test2.sh):\n\n-----\n#!/bin/bash\n\necho \"Content-Type: text/plain\"\necho\n\nset\n-----\n\nIf I call it as\n\nhttp://127.0.0.1:8086/nextcloud/test2.sh\n\nit outputs\n\n[...]\nSCRIPT_NAME=/nextcloud/test2.sh\n[...]\n\nIf I call it as\n\nhttp://127.0.0.1:8086/nextcloud/test2.sh/login\n\nit outputs\n\n[...]\nSCRIPT_NAME=/nextcloud/test2.sh/login/test2.sh\n[...]\n\n\nBut the value of $SCRIPT_NAME should stay the same.\n\nExcerpt from my web.xml:\n\n   <servlet>\n      <servlet-name>test-cgi</servlet-name>\n      <servlet-class>org.apache.catalina.servlets.CGIServlet</servlet-class>\n      <init-param>\n        <param-name>executable</param-name>\n        <param-value>/bin/bash</param-value>\n      </init-param>\n      <init-param>\n        <param-name>passShellEnvironment</param-name>\n        <param-value>true</param-value>\n      </init-param>\n   </servlet>\n\n   <servlet-mapping>\n      <servlet-name>test-cgi</servlet-name>\n      <url-pattern>*.sh</url-pattern>\n    </servlet-mapping>\n\n   <servlet-mapping>\n      <servlet-name>test-cgi</servlet-name>\n      <url-pattern>/test2.sh/login</url-pattern>\n    </servlet-mapping>", "id": 199285, "time": "2017-06-19T21:53:51Z", "creator": "jan0michael@yahoo.com", "creation_time": "2017-06-19T21:53:51Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "markt@apache.org", "text": "Hmm. The CGI servlet isn't designed to be mapped that way. I'm a little surprised it even worked.\n\nThe docs aren't clear on what is expected to work and what isn't.\n\nThe script finding logic appears depend on what sort of mapping is used. The new getHttpServletMapping() in Servlet 4.0 may enable a wider range of mappings to be supported.\n\nI need to dig into this some more. At the moment, the minimum I anticipate doing is:\n- documented which mapping styles are supported and which are not\n- updating the checks in 9.0.x (and 8.5.x since the Servlet 4.0 functionality is back-ported) to reject requests using unsupported mapping types.\n\nAt best, I'll add support for all mapping types and document each.", "id": 199301, "attachment_id": null, "bug_id": 61201, "creation_time": "2017-06-20T19:07:29Z", "time": "2017-06-20T19:07:29Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 61201, "is_private": false, "count": 2, "id": 199304, "time": "2017-06-20T21:13:08Z", "creator": "markt@apache.org", "creation_time": "2017-06-20T21:13:08Z", "text": "That turned out much better than I expected. The fix was simple and did not need to depend on the new Servlet 4.0 features. Best of all, it used LESS code.\n\nFixed in:\n- trunk for 9.0.0.M22 onwards\n- 8.5.x for 8.5.16 onwards\n- 8.0.x for 8.0.45 onwards\n- 7.0.x for 7.0.79 onwards"}, {"count": 3, "tags": [], "creator": "jan0michael@yahoo.com", "attachment_id": null, "is_private": false, "id": 200669, "time": "2017-09-05T13:44:26Z", "bug_id": 61201, "creation_time": "2017-09-05T13:44:26Z", "text": "It seems, that the fix disables calling\n\nhttp://127.0.0.1:8086/nextcloud/test2.sh/login\n\n\nIt gives:\n\nHTTP Status [404] \u2013 [Not Found]\n\nType Status Report\n\nDescription The origin server did not find a current representation for the target resource or is not willing to disclose that one exists."}, {"count": 4, "tags": [], "bug_id": 61201, "is_private": false, "text": "Sorry, it works.\nI had changed my web.xml.", "id": 200690, "time": "2017-09-06T08:46:09Z", "creator": "jan0michael@yahoo.com", "creation_time": "2017-09-06T08:46:09Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 61201, "is_private": false, "count": 5, "id": 200691, "time": "2017-09-06T09:22:14Z", "creator": "jan0michael@yahoo.com", "creation_time": "2017-09-06T09:22:14Z", "text": "What does not work is\n\n   <servlet-mapping>\n      <servlet-name>test-cgi</servlet-name>\n      <url-pattern>/test2.sh/*</url-pattern>\n    </servlet-mapping>\n\nThis would be usefull for nextcloud.\nFor demo see demo.nextcloud.com\n\nIt uses virtual paths like\n\n/login\n/apps/files\n/apps/activity\n/apps/gallery\n\n(At least I think they are virtual, because there is no index.php in the /apps/files, /apps/activity and /apps/gallery subdirectories. And there is no /login subdirectory.)\n\n\nIn lib/base.php in function handleRequest() there are checks like\n\nif ($requestPath === '/heartbeat') {\n\nif ($requestPath === '/disableapp'\n                        && $request->getMethod() === 'POST'\n                        && ((array)$request->getParam('appid')) !== ''\n                ) {\n\nI'll see if I can get it to work otherwise.\n\n\nThe sqwebmail-servlet even puts some arbitrary long numbers in the path part of the URL."}]
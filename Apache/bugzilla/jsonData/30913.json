[{"count": 0, "tags": [], "bug_id": 30913, "attachment_id": null, "is_private": false, "id": 62624, "time": "2004-08-28T09:44:50Z", "creator": "y@haya.se", "creation_time": "2004-08-28T09:44:50Z", "text": "apr_proc_create() on unix OS calls apr_pool_cleanup_for_exec() and\nexit() in forked child process.  These functions call registered\nfunctions.  This causes unexpected behaviour if registered functions\nhave side effect to the outside of process.\n\nFor example, I use svn_io_open_unique_file() in library of subversion.\nThis function can create temporary file which will be deleted when the\npool is cleaned up.  I wrote program that create temporary file and\npass the temporary file to external command using apr_proc_create().\nThis program doesn't performs what I intended to because pool cleanup\nin child process deletes temporary file before executing external\ncommand.\n\nSimilarly, exit() executes functions registered by atexit().\n\nThus apr_proc_create() should use _exit() instead of exit().  Although\nI am not detailed about apr_pool_cleanup_for_exec(), it seems\noverkill."}, {"count": 1, "tags": [], "creator": "inoue@ariel-networks.com", "is_private": false, "text": "This causes a problem described in the following GTK+ FAQ, if we use libapr in\nan X client program.\n\nhttp://www.gtk.org/faq/#AEN506\n\nI agree that apr_proc_create() should use _exit().\n", "id": 68625, "time": "2004-12-16T17:55:59Z", "bug_id": 30913, "creation_time": "2004-12-16T17:55:59Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 30913, "is_private": false, "id": 78920, "creation_time": "2005-08-24T14:56:44Z", "time": "2005-08-24T14:56:44Z", "creator": "jorton@redhat.com", "text": "The argument for using _exit seems reasonable.\n\nWhy is the file being deleted on exit when the child_cleanup runs?  Is the SVN\ntemp file created with the DELONCLOSE flag set?  Possibly APR should not delete\nthe file in the child cleanup for DELONCLOSE.", "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 30913, "is_private": false, "id": 78928, "time": "2005-08-24T17:20:05Z", "creator": "jorton@redhat.com", "creation_time": "2005-08-24T17:20:05Z", "tags": [], "text": "Done that on the trunk.  http://svn.apache.org/viewcvs?rev=239687&view=rev\n\nFixing the file child cleanup is a separate issue and needs to be done\ncarefully.  It's questionable to even do the flush() call in the child cleanup."}]
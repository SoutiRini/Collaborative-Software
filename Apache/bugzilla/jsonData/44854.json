[{"count": 0, "tags": [], "bug_id": 44854, "text": "Here is my module.\n\n|cat mod_logtst.c \n#include \"httpd.h\"\n#include \"http_config.h\"\n#include \"http_protocol.h\"\n\nmodule AP_MODULE_DECLARE_DATA logtst_module;\n\nint apache_log_request(request_rec *r)\n{\n    const char *redirectLocation = NULL;\n    if (r->headers_out)\n        redirectLocation = apr_table_get(r->headers_out, \"Location\");\n\n    return DECLINED;\n}\n\nvoid logtst_register_hooks(apr_pool_t *p)\n{\n    ap_hook_log_transaction(apache_log_request,NULL,NULL,APR_HOOK_MIDDLE);\n}\n\nmodule AP_MODULE_DECLARE_DATA logtst_module =\n{\n    STANDARD20_MODULE_STUFF,\n    NULL,\n    NULL,\n    NULL,\n    NULL,\n    NULL,\n    logtst_register_hooks\n};\n\ncompile and installed the module,\n|sh -x makelg\n+ cc -I/usr/apache2/2.2/include -c -o mod_logtst.o mod_logtst.c\n+ cc -G -o mod_logtst.so mod_logtst.o\n+ sudo cp mod_logtst.so /usr/apache2/2.2/libexec\n\n\nmake sure that module is loaded\n|cat /space/httpd-framework/t/conf/httpd.conf | grep logtst\n<IfModule !mod_logtst.c>\n    LoadModule logtst_module \"/usr/apache2/2.2/libexec/mod_logtst.so\"\n\nrun post tests in the perl test framework.\n|t/TEST -httpd /usr/apache2/2.2/bin/httpd -httpd_conf /space/httpd-framework/t/conf/httpd.conf -verbose http11/post.t\n....\n[  error] oh gosh, server dumped core \n[  error] for stacktrace, run: gdb /usr/apache2/2.2/bin/httpd -core /space/httpd-framework/t/core\n\n(I got the core trace only once, on other times, the stack was corrupted)\n|pstack t/core\ncore 't/core' of 18021: /usr/apache2/2.2/bin/httpd -d /space/httpd-framework/t -f /space/httpd\n cea4e885 apr_table_get (394a, cc001280) + 39\n cc000ccb apache_log_request (857a1f8) + 33\n 080744e1 ap_run_log_transaction (857a1f8) + 25\n 08087a9f ap_process_request (857a1f8) + 97\n 0808583a ap_process_http_connection (856a450) + 52\n 08082835 ap_run_process_connection (856a450) + 25\n 08082ad6 ap_process_connection (856a450, 856a1b8) + 3a\n 0808bc82 child_main (2) + 2f6\n 0808bdd4 make_child (80c2a78, 2) + 84\n 0808bfae perform_idle_server_maintenance (80c0b88) + e2\n 0808c2d0 ap_mpm_run (80c0b88, 80eec40, 80c2a78) + 234\n 0806dba0 main     (7, 8047b5c, 8047b7c) + 6d8\n 0806cde6 _start   (7, 8047c48, 8047c63, 8047c66, 8047c87, 8047c8a) + 7a", "id": 115768, "time": "2008-04-22T04:34:50Z", "creator": "rahul.g.nair@gmail.com", "creation_time": "2008-04-22T04:34:50Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 44854, "attachment_id": null, "id": 115769, "time": "2008-04-22T06:16:35Z", "creator": "rpluem@apache.org", "creation_time": "2008-04-22T06:16:35Z", "is_private": false, "text": "Please provide a gdb stacktrace of your core dump. Take care to compile your module with -g (on gcc, may be different for other compilers) so that the debug symbols are available for gdb."}, {"count": 2, "tags": [], "text": "could not get a stack trace due to corrupt stack.\n|sh -x makegcc \n+ gcc -I/usr/apache2/2.2/include -g -c -o mod_logtst.o mod_logtst.c \n+ gcc -g -G -o mod_logtst.so mod_logtst.o \n+ sudo cp mod_logtst.so /usr/local/apache2/modules \nt/TEST -httpd /usr/local/apache2/bin/httpd -httpd_conf /space/httpd-framework/t/conf/httpd.conf -verbose http11/post.t\n....\n[  error] for stacktrace, run: gdb /usr/local/apache2/bin/httpd -core /space/httpd-framework/t/core\n|gdb /usr/local/apache2/bin/httpd -core /space/httpd-framework/t/core\nThis GDB was configured as \"sparc-sun-solaris2.11\"...\nCore was generated by `/usr/local/apache2/bin/httpd -d /space/httpd-framework/t -f /space/httpd-framew'.\nProgram terminated with signal 11, Segmentation fault.\nCannot access memory at address 0xff3f6004\n#0  0xff1ee7ec in ?? ()\n(gdb) where\n#0  0xff1ee7ec in ?? ()\n#1  0x0000000c in ?? ()\nPrevious frame identical to this frame (corrupt stack?)\n(gdb) \n\nThe apache was compiled by enabling maintainer mode using gcc.\n", "attachment_id": null, "bug_id": 44854, "id": 115784, "time": "2008-04-22T21:28:45Z", "creator": "rahul.g.nair@gmail.com", "creation_time": "2008-04-22T21:28:45Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "Please try building your module with \"apxs -c\" instead to make sure you have a set of CFLAGS which is consistent with the httpd/apr build.", "id": 115789, "time": "2008-04-23T00:36:06Z", "bug_id": 44854, "creation_time": "2008-04-23T00:36:06Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 44854, "attachment_id": null, "id": 115790, "time": "2008-04-23T00:51:37Z", "creator": "rahul.g.nair@gmail.com", "creation_time": "2008-04-23T00:51:37Z", "is_private": false, "text": "Didn't help.\n|/usr/local/apache2/bin/apxs -c mod_logtst.c                             \n/usr/local/apache2/build/libtool --silent --mode=compile gcc -prefer-pic   -DSOLARIS2=11 -D_POSIX_PTHREAD_SEMANTICS -D_REENTRANT -D_LARGEFILE64_SOURCE -DAP_DEBUG -g -O2 -Wall -Wmissing-prototypes -Wstrict-prototypes -Wmissing-declarations -I/usr/local/apache2/include  -I/usr/local/apache2/include   -I/usr/local/apache2/include   -c -o mod_logtst.lo mod_logtst.c && touch mod_logtst.slo\nmod_logtst.c:8: warning: no previous prototype for 'apache_log_request'\nmod_logtst.c:17: warning: no previous prototype for 'logtst_register_hooks'\n/usr/local/apache2/build/libtool --silent --mode=link gcc -o mod_logtst.la  -rpath /usr/local/apache2/modules -module -avoid-version    mod_logtst.lo\n|sudo cp .libs/mod_logtst.so /usr/local/apache2/modules/mod_logtst.so  \n\nt/TEST -httpd /usr/local/apache2/bin/httpd -httpd_conf /space/httpd-framework/t/conf/httpd.conf -verbose http11/post.t\n[  error] oh jeez, server dumped core \n[  error] for stacktrace, run: gdb /usr/local/apache2/bin/httpd -core /space/httpd-framework/t/core\n|gdb /usr/local/apache2/bin/httpd -core /space/httpd-framework/t/core\nCore was generated by `/usr/local/apache2/bin/httpd -d /space/httpd-framework/t -f /space/httpd-framew'.\nProgram terminated with signal 11, Segmentation fault.\nCannot access memory at address 0xff3f6004\n#0  0xff1ee7ec in ?? ()\n(gdb) where\n#0  0xff1ee7ec in ?? ()\n#1  0x0000000c in ?? ()\nPrevious frame identical to this frame (corrupt stack?)\n(gdb) q\n            "}, {"count": 5, "tags": [], "bug_id": 44854, "attachment_id": null, "id": 115795, "time": "2008-04-23T02:26:48Z", "creator": "jorton@redhat.com", "creation_time": "2008-04-23T02:26:48Z", "is_private": false, "text": "It works fine for me.  Unless can track this down to an identifiable bug in httpd, please try asking for help on the modules-dev list:\n\nhttp://httpd.apache.org/lists.html#modules-dev\n"}, {"count": 6, "tags": [], "bug_id": 44854, "attachment_id": null, "text": "Could you please let me know if it was tried on solaris?\nThe machine configuration that I have tried it on is:\n\nSunOS - 5.11 snv_84 sun4u sparc SUNW,Sun-Blade-1000\n\nI the issue is always reproducable.\n\n(why is it invalid? I would think Worksforme is closer in status.)\n", "id": 115797, "time": "2008-04-23T04:34:54Z", "creator": "rahul.g.nair@gmail.com", "creation_time": "2008-04-23T04:34:54Z", "is_private": false}, {"count": 7, "tags": [], "text": "Here is the stack trace again , (I renamed apache_log_request to lgtst_log_request)\n\n]stop in lgtst_log_request\n(2) stop in lgtst_log_request\n]c                       \nt@1 (l@1) stopped in lgtst_log_request at line 19 in file \"mod_logtst.c\"\n   19       const char *redirectLocation = NULL;\n]where                   \ncurrent thread: t@1\n=>[1] lgtst_log_request(r = 0x1d7130), line 19 in \"mod_logtst.c\"\n  [2] ap_run_log_transaction(r = 0x1d7130), line 1744 in \"protocol.c\"\n  [3] ap_process_request(r = 0x1d7130), line 284 in \"http_request.c\"\n  [4] ap_process_http_connection(c = 0x1d33b8), line 190 in \"http_core.c\"\n  [5] ap_run_process_connection(c = 0x1d33b8), line 43 in \"connection.c\"\n  [6] child_main(child_num_arg = 0), line 640 in \"prefork.c\"\n  [7] make_child(s = 0x6d000, slot = 1), line 736 in \"prefork.c\"\n  [8] ap_mpm_run(_pconf = 0x9d800, plog = 0x9fc00, s = 0x9fc00), line 871 in \"prefork.c\"\n  [9] main(argc = 7, argv = 0xffbff11c), line 730 in \"main.c\"\n]p r.headers_out\nr->headers_out = 0x400\n]p r.headers_in\nr->headers_in = (nil)\n\n]p *r\n*r = {\n    pool                 = 0x1d70f8\n    connection           = 0x1d33b8\n    server               = 0xaf758\n    next                 = (nil)\n    prev                 = (nil)\n    main                 = (nil)\n    the_request          = 0x1d7f50 \"POST /eat_post HTTP/1.1\"\n    assbackwards         = 0\n    proxyreq             = 0\n    header_only          = 0\n    protocol             = 0x1d7fd8 \"HTTP/1.1\"\n    proto_num            = 1001\n    hostname             = 0x1d8248 \"localhost\"\n    request_time         = 1209107790930910LL\n    status_line          = 0x81bf0 \"200 OK\"\n    status               = 200\n    method               = 0x1d7fa0 \"POST\"\n    method_number        = 2\n    allowed              = 0\n    allowed_xmethods     = (nil)\n    allowed_methods      = 0x1d72d8\n    sent_bodyct          = 0\n    bytes_sent           = 1\n    mtime                = 5LL\n    chunked              = 0\n    range                = (nil)\n    clength              = 0\n    remaining            = 0\n    read_length          = 0\n    read_body            = 5\n    read_chunked         = 0\n    expecting_100        = 0\n    headers_in           = (nil)\n    headers_out          = 0x400\n    err_headers_out      = 0x1\n    subprocess_env       = (nil)\n    notes                = (nil)\n    content_type         = 0x1d7308 \"\"\n    handler              = 0x1d7798 \"\"\n    content_encoding     = 0x1d7940 \"\"\n    content_languages    = 0x1d8b58\n    vlist_validator      = 0x1d7a98 \"\"\n    user                 = (nil)\n    ap_auth_type         = 0x184d48 \"eat_post\"\n    no_cache             = 0\n    no_local_copy        = 0\n    unparsed_uri         = (nil)\n    uri                  = (nil)\n    filename             = (nil)\n    canonical_filename   = (nil)\n    path_info            = (nil)\n    args                 = 0x1d7fb8 \"/eat_post\"\n    finfo                = {\n        pool       = 0x1d7fc8\n        valid      = 1934848\n        protection = 1934848\n        filetype   = 1934704\n        user       = 0\n        group      = 0\n        inode      = 1929464U\n        device     = 7598960U\n        nlink      = 1877\n        size       = 0\n        csize      = 152090\n        atime      = 890192132571151LL\n        mtime      = 30244686384LL\n        ctime      = 512LL\n        fname      = (nil)\n        name       = 0x400 \"<bad address 0x400>\"\n        filehand   = 0x44bad\n    }\n    parsed_uri           = {\n        scheme         = 0x44b6f \"\\xf8\\xc2#\\xa0\\\\x90^V#\\xe8\\x9a^Sb\\xb0^P\\x80\"\n        hostinfo       = 0xb944f61d \"<bad address 0xb944f61d>\"\n        user           = 0x44b6f \"\\xf8\\xc2#\\xa0\\\\x90^V#\\xe8\\x9a^Sb\\xb0^P\\x80\"\n        password       = 0xb944f61d \"<bad address 0xb944f61d>\"\n        hostname       = 0x1d8600 \"/space/httpd-framework/t/htdocs/eat_post\"\n        port_str       = 0x7fbf9438 \"\"\n        path           = 0x1cf \"<bad address 0x1cf>\"\n        query          = 0x7860dd1 \"<bad address 0x7860dd1>\"\n        fragment       = (nil)\n        hostent        = (nil)\n        port           = 0\n        is_initialized = 0\n        dns_looked_up  = 0\n        dns_resolved   = 0\n    }\n    used_path_info       = 0\n    per_dir_config       = (nil)\n    request_config       = 0x1d8261\n    htaccess             = 0x1d7fc8\n    output_filters       = (nil)\n    input_filters        = (nil)\n    proto_output_filters = (nil)\n    proto_input_filters  = 0x21518000\n    eos_sent             = 2\n}\n\n\nAs can be seen, the memmory of request_rec seems to be corrupted.\n\nSome information on reproducing it:\n1) It is seen only when running t/http11/post.t and is seen on every second request.\n2) Unable to reproduce it by simple submission of same POST data through telnet or the other clients (possibly because I do not know exactly what the Apache perl-framework does.)\n3) It is not a one-machine bug, I am able to reproduce it in any 'Solaris' machine with any apache from 2.2.6 to 2.2.8 (both sparc and x86)\n", "attachment_id": null, "bug_id": 44854, "id": 115862, "time": "2008-04-25T00:34:25Z", "creator": "rahul.g.nair@gmail.com", "creation_time": "2008-04-25T00:34:25Z", "is_private": false}, {"count": 8, "tags": [], "creator": "rahul.g.nair@gmail.com", "attachment_id": null, "text": "it seems to have been related to wrong version include files. It went away on changing the include files to correct ones.", "id": 115863, "time": "2008-04-25T02:49:51Z", "bug_id": 44854, "creation_time": "2008-04-25T02:49:51Z", "is_private": false}]
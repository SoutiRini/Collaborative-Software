[{"count": 0, "tags": [], "text": "I'm having trouble using the script task under the XmlLogger listener. \nLet say I have the following build.xml:\n\n<project name=\"tmp\" default=\"script\" basedir=\".\">\n\t<target name=\"script\">\n\t\t<script language=\"javascript\"> \n\t\t\t<![CDATA[\n      \t\tfor (i=1; i<=10; i++) {\n        \t\techo = tmp.createTask(\"echo\");\n        \t\tscript.addTask(echo);\n        \t\techo.setMessage(i*i);\n      \t\t}\n\t\t\t]]> \n\t\t</script>\n\t</target>\n</project>\n\nif I run this with the default listener, everything goes fine.\nHowever, if I go \"ant -listener org.apache.tools.ant.XmlLogger\", I will get the \nfollowing error. \n\n$ ant -listener org.apache.tools.ant.XmlLogger\nBuildfile: build.xml\n\nscript:\n     [echo] 1\n\nBUILD FAILED\n\njava.lang.RuntimeException: Mismatch - popped element = <task name=\"echo\" locati\non=\"\" time=\"0 seconds\"><message priority=\"warn\"><![CDATA[1]]></message></task> f\ninished task element = <target name=\"script\" time=\"0 seconds\"><task name=\"script\n\" location=\"c:\\build.xml:4: \" time=\"0 seconds\"><message priority=\"debug\"><![CDAT\nA[   +Task: echo]]></message><message priority=\"debug\"><![CDATA[   +Task: echo]]\n></message><message priority=\"debug\"><![CDATA[   +Task: echo]]></message><messag\ne priority=\"debug\"><![CDATA[   +Task: echo]]></message><message priority=\"debug\"\n><![CDATA[   +Task: echo]]></message><message priority=\"debug\"><![CDATA[   +Task\n: echo]]></message><message priority=\"debug\"><![CDATA[   +Task: echo]]></message\n><message priority=\"debug\"><![CDATA[   +Task: echo]]></message><message priority\n=\"debug\"><![CDATA[   +Task: echo]]></message><message priority=\"debug\"><![CDATA[\n   +Task: echo]]></message></task></target>\n        at org.apache.tools.ant.XmlLogger.targetFinished(XmlLogger.java:182)\n        at org.apache.tools.ant.Project.fireTargetFinished(Project.java:952)\n        at org.apache.tools.ant.Target.performTasks(Target.java:206)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:601)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:560)\n        at org.apache.tools.ant.Main.runBuild(Main.java:454)\n        at org.apache.tools.ant.Main.start(Main.java:153)\n        at org.apache.tools.ant.Main.main(Main.java:176)\n\nTotal time: 1 second", "attachment_id": null, "bug_id": 6309, "id": 10449, "time": "2002-02-07T14:49:57Z", "creator": "rtang@algorithmics.com", "creation_time": "2002-02-07T14:49:57Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 6309, "text": "You are not completely configuring the tasks. Your script should look like this\n<project name=\"tmp\" default=\"script\" basedir=\".\">\n  <target name=\"script\">\n    <script language=\"javascript\"> <![CDATA[\n          for (i=1; i<=10; i++) {\n            echo = tmp.createTask(\"echo\");\n            script.addTask(echo);\n            echo.setOwningTarget(script);\n            echo.setMessage(i*i);\n          }\n      ]]> </script>\n    </target>\n</project>\n\nSince you were not setting the owning target, the XmlLogger, which needs to\nrelate the task to its surrounding target was getting confused. I have patched\nXMLLogger to handle ill-configured tasks.\n\nLet me also note that adding tasks to the current target is a rather dangerous\npractice. Underneath you are adding objects to a collection which is being\niterated over. About all I can say is \"It works at present.\"", "id": 10697, "time": "2002-02-14T13:31:45Z", "creator": "conor@apache.org", "creation_time": "2002-02-14T13:31:45Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "corporate_gadfly@hotmail.com", "text": "Exactly similar to bug 34654, I have an identical ZipException when using the\ntag attribute while deploying remotely using the ant <deploy> task. In bug\n34654, comment 2, Yoav had mentioned something to the effect that he couldn't\nreproduce it and neither could the OP. I don't think the OP in bug 34654 ever\nmentioned that he couldn't reproduce it. I don't know why the OP never disputed\nthat assumption.\n\nI can easily reproduce it by having a <deploy> ant task with a tag attribute\nsuch as:\n\n<deploy url=\"http://${host}:8080/manager\"\n        username=\"${tomcat.username}\"\n        password=\"${tomcat.password}\"\n        path=\"/${app.name}\"\n        update=\"true\"\n        tag=\"${tag.war}\"\n        war=\"file:${gen.dir}/war/${webapp.war}\"/>\n\nIf I take out the tag attribute, the remote deploy works fine.\n\nThis is with tomcat 5.5.9, sun-jdk-1.5.0.03 on a Gentoo Linux machine.\n\nWhat the OP of bug 34654 was referring to in bug 34654, comment 1 was the fact\nthat if you look inside the remote hosts' work/Catalina/localhost/manager\ndirectory, you will find a fully intact war file with the properly named\ndirectory (as per the tag). And indeed, the war file in that directory is\ncomplete and does not have any defects and/or corruptions.", "id": 80566, "time": "2005-09-28T22:02:30Z", "bug_id": 36847, "creation_time": "2005-09-28T22:02:30Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 36847, "attachment_id": null, "text": "(In reply to comment #0)\n> \n> If I take out the tag attribute, the remote deploy works fine.\n> \n> This is with tomcat 5.5.9, sun-jdk-1.5.0.03 on a Gentoo Linux machine.\n> \n\nTo add some points of reference, this used to work fine in 5.0.28. In addition,\nI upgraded to 5.5.12 and it is broken in there as well.", "id": 80571, "time": "2005-09-28T22:29:12Z", "creator": "corporate_gadfly@hotmail.com", "creation_time": "2005-09-28T22:29:12Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 36847, "text": "My colleague and I have tracked down the problem.\n\nThe bug was introduced in revision 1.22 in\njakarta-tomcat-catalina/webapps/manager/WEB-INF/classes/org/apache/catalina/manager/ManagerServlet.java\n\nStarting from line 627 (in the 5.5.9 sources):\n\n                    // Copy WAR and XML to the host app base if needed\n                    if (tag != null) {\n                        deployedPath = deployed;\n                        File localWarCopy = new File(deployedPath, basename + \".\nwar\");\n                        copy(localWar, localWarCopy);\n----------------------> localWar = localWarCopy;\n----------------------> copy(localWar, new File(getAppBase(), basename + \".war\")\n);\n                    }\n\nTaking out the above 2 marked lines fixes the problem.", "id": 80652, "time": "2005-09-30T19:49:17Z", "creator": "corporate_gadfly@hotmail.com", "creation_time": "2005-09-30T19:49:17Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 36847, "text": "Created attachment 16565\nFix for tomcat 5.5.9 remote deploy while using tag via ant task", "id": 80653, "time": "2005-09-30T19:52:03Z", "creator": "corporate_gadfly@hotmail.com", "creation_time": "2005-09-30T19:52:03Z", "is_private": false, "attachment_id": 16565}, {"count": 4, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "id": 87107, "time": "2006-03-22T17:16:45Z", "bug_id": 36847, "creation_time": "2006-03-22T17:16:45Z", "is_private": false, "text": "See ongoing discussion on dev@tomcat.apache.org mailing list titled \"yet another\ntomcat goes stable and I still have to make a custom package\" at Nabble:\nhttp://www.nabble.com/yet-another-tomcat-goes-stable-and-I-still-have-to-make-a-custom-package-t1318004.html"}, {"count": 5, "tags": [], "bug_id": 36847, "attachment_id": 17943, "is_private": false, "id": 87110, "time": "2006-03-22T18:31:03Z", "creator": "corporate_gadfly@hotmail.com", "creation_time": "2006-03-22T18:31:03Z", "text": "Created attachment 17943\nFix for tomcat 5.5.16 for remote deploy while using tag via ant task"}, {"count": 6, "tags": [], "text": "Created attachment 17944\nFix for tomcat 5.5.16 for remote deploy while using tag via ant task", "is_private": false, "id": 87119, "creator": "corporate_gadfly@hotmail.com", "time": "2006-03-22T19:45:24Z", "bug_id": 36847, "creation_time": "2006-03-22T19:45:24Z", "attachment_id": 17944}, {"count": 7, "tags": [], "bug_id": 36847, "text": "Fixed and patched, will be available in 5.5.17\nThe copy method makes a check make sure it doesn't overwrite file A with file B,\nif file A==file B\n", "id": 87877, "time": "2006-04-12T22:31:52Z", "creator": "fhanik@apache.org", "creation_time": "2006-04-12T22:31:52Z", "is_private": false, "attachment_id": null}]
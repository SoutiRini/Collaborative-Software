[{"attachment_id": null, "tags": [], "creator": "dohrayme@yahoo.com", "text": "My Config:\n\nLoadModule authz_user_module modules/mod_authz_user.so\nLoadModule ldap_module modules/mod_ldap.so\nLoadModule authnz_ldap_module modules/mod_authnz_ldap.so\n\n<Location /ldap2>\nAuthBasicProvider ldap\nAuthType Basic\nAuthName \"LDAP secure2\"\nAuthLDAPBindDN \"testdomain2\\\\Administrator\"\nAuthLDAPBindPassword password\nAuthLDAPUrl \"ldap://server:389/OU=Test Users,DC=testdomain2,DC=local?sAMAccountName\"\nAuthzLDAPAuthoritative  off\nrequire valid-user \n</Location>\n\nI'm authenticating against an Active Directory. I observe that if I enter a\ncorrect user name but incorrect password I am not asked to reauthenticate, I\njust get an internal server error.\n\nThis is due to this piece of code:\n\nmod_authnz_ldap.c\n\nstatic authn_status authn_ldap_check_password(request_rec *r, const char *user,\n                                              const char *password)\n{\n...\n        return (LDAP_NO_SUCH_OBJECT == result) ? AUTH_USER_NOT_FOUND\n#ifdef LDAP_SECURITY_ERROR\n                 : (LDAP_SECURITY_ERROR(result)) ? AUTH_DENIED\n#endif\n                 : AUTH_GENERAL_ERROR;\n...\n}\n\nLDAP_SECURITY_ERROR is not defined in the winldap SDK (nor the Sun ONE sdk) - I\npresume it is an OpenLDAP addition. This results in any error other than an\ninvalid object being treated as an internal server error.\n\nThis can be corrected by modifying to:\n\n#ifdef LDAP_SECURITY_ERROR\n                 : (LDAP_SECURITY_ERROR(result)) ? AUTH_DENIED\n#else\n\t\t\t\t : LDAP_INAPPROPRIATE_AUTH == result ? AUTH_DENIED\n\t\t\t\t : LDAP_INVALID_CREDENTIALS == result ? AUTH_DENIED\n\t\t\t\t : LDAP_INSUFFICIENT_RIGHTS == result ? AUTH_DENIED\n#endif", "count": 0, "id": 88952, "time": "2006-05-09T10:50:22Z", "bug_id": 39529, "creation_time": "2006-05-09T10:50:22Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bnicholes@apache.org", "attachment_id": null, "is_private": false, "id": 89717, "time": "2006-06-02T22:18:07Z", "bug_id": 39529, "creation_time": "2006-06-02T22:18:07Z", "text": "Fixed in trunk and proposed for backport"}, {"count": 2, "tags": [], "bug_id": 39529, "is_private": false, "text": "Bug observed as well on Sun Solaris 5.8.\nApparently, LDAP_INSUFFICIENT_RIGHTS isn't defined neither in Sun sdk.\nLDAP_INSUFFICIENT_ACCESS may be used instead.", "id": 90242, "time": "2006-06-15T11:44:46Z", "creator": "damien.lachuer@oosphere.com", "creation_time": "2006-06-15T11:44:46Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "minfrin@sharp.fm", "attachment_id": null, "is_private": false, "id": 90432, "time": "2006-06-21T11:35:48Z", "bug_id": 39529, "creation_time": "2006-06-21T11:35:48Z", "text": "The abstraction of this error message in APR-util in apr_ldap_init.h \n needs to be fixed, mod_authnz_ldap shouldn't be including toolkit specific\n#defines anywhere."}, {"count": 4, "tags": [], "bug_id": 39529, "text": "The abstraction has been added to apr-util.  It is called \nAPU_LDAP_INSUFFICIENT_ACCESS.  But we can't use it in mod_authnz_ldap.c until \na suitable libaprutil has been released.  So for now, mod_authnz_ldap.c has to \ninclude #defines.", "id": 90560, "time": "2006-06-23T19:56:42Z", "creator": "bnicholes@apache.org", "creation_time": "2006-06-23T19:56:42Z", "is_private": false, "attachment_id": null}, {"count": 5, "text": "Backported to 2.2.x as r425731 (http://svn.apache.org/viewvc?rev=425731&view=rev).", "bug_id": 39529, "is_private": false, "id": 91613, "time": "2006-07-26T14:24:43Z", "creator": "rpluem@apache.org", "creation_time": "2006-07-26T14:24:43Z", "tags": [], "attachment_id": null}]
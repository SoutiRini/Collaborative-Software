[{"count": 0, "tags": [], "bug_id": 40750, "text": "Problem:\n-------\nWhen the socket connection used by TCPSampler is closed by the host, the socket\nwill time out, but leave the connection in a \"viable\" state. Jmeter does not\nattempt to check for this.\n\nIf the Thread Group is looped, the same connection will be reused. But it is\nclosed from the host end so all the threads will just time out!\n\nAs a quick fix for myself, I modified TCPSampler.java. I changed getSocket() to\nalways attempt to close any Sockets already in the cp map, and then create a new\none.\n\nSuggestions:\n-----------\nAs suggested by sebb, if there is no way of automatically detecting and\nresetting the connection, an option might be used to determine the behaviour if\na timeout occurs. This is probably the way to go since we cannot predict the\nbehaviour of every protocol???\n\nTHe Jmeter.log is below with TCPSampler debugging on. The actualy data sent and\nrecieved has been removed (just in case).\n\nRelevant jmeter.log:\n-------------------\n2006/10/13 10:17:34 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler: Created\norg.apache.jmeter.protocol.tcp.sampler.TCPSampler@1741064\n2006/10/13 10:17:34 INFO  - jmeter.protocol.tcp.sampler.TCPClientImpl: Using\neolByte=0\n2006/10/13 10:17:34 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler:\norg.apache.jmeter.protocol.tcp.sampler.TCPSampler@1741064Created:\nTCPClientImpl@e05280\n2006/10/13 10:17:34 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler: Using\nProtocol Handler: org.apache.jmeter.protocol.tcp.sampler.TCPClientImpl\n2006/10/13 10:17:34 INFO  - jmeter.engine.StandardJMeterEngine: Running the test!\n2006/10/13 10:17:34 INFO  - jmeter.gui.util.JMeterMenuBar: setRunning(true,local)\n2006/10/13 10:17:35 INFO  - jmeter.engine.StandardJMeterEngine: Starting 1\nthreads for group Thread Group. Ramp up = 1.\n2006/10/13 10:17:35 INFO  - jmeter.engine.StandardJMeterEngine: Continue on error\n2006/10/13 10:17:35 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler: Created\norg.apache.jmeter.protocol.tcp.sampler.TCPSampler@36f7e6\n2006/10/13 10:17:35 INFO  - jmeter.protocol.tcp.sampler.TCPClientImpl: Using\neolByte=0\n2006/10/13 10:17:35 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler:\norg.apache.jmeter.protocol.tcp.sampler.TCPSampler@36f7e6Created:\nTCPClientImpl@cd3bec\n2006/10/13 10:17:35 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler: Using\nProtocol Handler: org.apache.jmeter.protocol.tcp.sampler.TCPClientImpl\n2006/10/13 10:17:35 INFO  - jmeter.threads.JMeterThread: Thread Thread Group 1-1\nstarted\n2006/10/13 10:17:35 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler: Thread Started\n2006/10/13 10:17:35 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler:\ntcp://10.1.1.198:8081\n2006/10/13 10:17:35 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler:\norg.apache.jmeter.protocol.tcp.sampler.TCPSampler@36f7e6  Timeout 0 NoDelay false\n2006/10/13 10:17:35 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler: Created new\nconnection Socket[addr=addr/10.1.1.198,port=8081,localport=36474]\n2006/10/13 10:17:35 DEBUG - jmeter.protocol.tcp.sampler.TCPClientImpl: Wrote:\n<my_data>\n\n2006/10/13 10:17:36 DEBUG - jmeter.protocol.tcp.sampler.TCPClientImpl: Read: 169\n<my_recieved_message>\n\n2006/10/13 10:17:36 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler:\ntcp://10.1.1.198:8081\n2006/10/13 10:17:36 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler:\norg.apache.jmeter.protocol.tcp.sampler.TCPSampler@36f7e6 Reusing connection\nSocket[addr=addr/10.1.1.198,port=8081,localport=36474]\n2006/10/13 10:17:36 DEBUG - jmeter.protocol.tcp.sampler.TCPClientImpl: Wrote:\n<my_data>\n\n2006/10/13 10:17:36 DEBUG - jmeter.protocol.tcp.sampler.TCPClientImpl: Read: 0\n\n2006/10/13 10:17:36 INFO  - jmeter.threads.JMeterThread: Thread Thread Group 1-1\nis done\n2006/10/13 10:17:36 INFO  - jmeter.engine.StandardJMeterEngine: Ending thread 0\n2006/10/13 10:17:36 INFO  - jmeter.engine.StandardJMeterEngine: Stopping test\n2006/10/13 10:17:36 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler: Thread Finished\n2006/10/13 10:17:36 DEBUG - jmeter.protocol.tcp.sampler.TCPSampler:\norg.apache.jmeter.protocol.tcp.sampler.TCPSampler@36f7e6 Closing connection\nSocket[addr=addr/10.1.1.198,port=8081,localport=36474]\n2006/10/13 10:17:36 INFO  - jmeter.engine.StandardJMeterEngine: Notifying test\nlisteners of end of test\n2006/10/13 10:17:36 INFO  - jmeter.gui.util.JMeterMenuBar: setRunning(false,local)\n2006/10/13 10:17:36 INFO  - jmeter.engine.StandardJMeterEngine: Test has ended", "id": 94790, "time": "2006-10-12T17:27:09Z", "creator": "marc.winoto@netregistry.com.au", "creation_time": "2006-10-12T17:27:09Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 40750, "text": "This can be worked around by not reusing TCP connections (this option is available in JMeter 2.3.4 or later)", "id": 129031, "time": "2009-07-21T23:22:16Z", "creator": "trent.bartlem@flightcentre.com.au", "creation_time": "2009-07-21T23:22:16Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "p.mouawad@ubik-ingenierie.com", "text": "With fix of 52104 behaviour is better if timeout is set, connection will be\nreestablished after:\n- 1 timeout \n- 1 broken pipe\n\nCan we do better ?", "id": 150981, "time": "2011-10-27T20:51:39Z", "bug_id": 40750, "creation_time": "2011-10-27T20:51:39Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "text": "Changes made in trunk > 2.5.1\nDecide wether it's enough", "is_private": false, "bug_id": 40750, "id": 151469, "time": "2011-11-14T12:15:40Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-11-14T12:15:40Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 40750, "attachment_id": null, "text": "I think that's probably OK for now.\n\nPlease re-open if there are additional cases that are not covered by the updated code.", "id": 151755, "time": "2011-11-23T22:27:12Z", "creator": "sebb@apache.org", "creation_time": "2011-11-23T22:27:12Z", "is_private": false}]
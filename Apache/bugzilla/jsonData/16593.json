[{"count": 0, "tags": [], "bug_id": 16593, "text": "The following scenario seems to consistently fail with a 412:\n\n1) GET existing resource, obtain etag\n2) (modify content)\n3) PUT with If-match: etag header\n\n-- windows scripting host example script -- \nvar req = new ActiveXObject (\"MSXML2.ServerXMLHTTP\");\n\nvar uri = WScript.Arguments(0);\nvar user = null;\nvar pwd = null;\n\nif (WScript.Arguments.length > 1) {\n  user = WScript.Arguments(1);\n}\n\nif (WScript.Arguments.length > 2) {\n  pwd = WScript.Arguments(2);\n}\n\n\nreq.open(\"GET\", uri, false, user, pwd);\nreq.send();\n\nif (req.status < 200 || req.status >= 300) {\n  WScript.Echo(\"unexpected status upon GET: \" + req.status);\n  WScript.Quit(2);\n}\n\nvar etag = req.getResponseHeader(\"etag\");\nWScript.Echo(\"etag: \" + etag);\n\nvar txt = req.responseText + \"\\nappended line\";\nWScript.Echo(\"new content: \" + txt);\n\n\nreq.open(\"PUT\", uri, false, user, pwd);\nreq.setRequestHeader(\"if-match\", etag);\nreq.send(txt);\n\nif (req.status < 200 || req.status >= 300) {\n  WScript.Echo(\"unexpected status upon PUT: \" + req.status + \" \" + \nreq.responseText);\n  WScript.Quit(2);\n}", "id": 30339, "time": "2003-01-30T13:04:32Z", "creator": "julian.reschke@gmx.de", "creation_time": "2003-01-30T13:04:32Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 16593, "attachment_id": null, "id": 30465, "time": "2003-02-01T09:12:47Z", "creator": "jerenkrantz@apache.org", "creation_time": "2003-02-01T09:12:47Z", "is_private": false, "text": "Yup.\n\nWe need to either call set_headers or getetag before calling ap_meets_conditions in dav_validate_resource.\n\nNot sure yet what the course of action will be.  Message sent to dev@httpd for assistance."}, {"count": 2, "tags": [], "creator": "fielding@apache.org", "attachment_id": null, "is_private": false, "id": 96585, "time": "2006-12-06T16:32:04Z", "bug_id": 16593, "creation_time": "2006-12-06T16:32:04Z", "text": "Is this still broken?\n"}, {"count": 3, "tags": [], "creator": "julian.reschke@gmx.de", "attachment_id": null, "text": "Yes, just checked with the latest Windows build of 2.2.\n\nEtag was: \"762d-c9-b4876f50\"\n\nResponse was:\n\n412\nDate: Thu, 07 Dec 2006 08:50:24 GMT\nServer: Apache/2.2.3 (Win32) DAV/2\nContent-Length: 249\nKeep-Alive: timeout=5, max=99\nConnection: Keep-Alive\nContent-Type: text/html; charset=iso-8859-1\n\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>412 Precondition Failed</title>\n</head><body>\n<h1>Precondition Failed</h1>\n<p>The precondition on the request for the URL /uploads/foo.txt evaluated to\nfalse.</p>\n</body></html>\n\n\n", "id": 96594, "time": "2006-12-07T00:52:30Z", "bug_id": 16593, "creation_time": "2006-12-07T00:52:30Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 16593, "text": "See http://wiki.foxmarks.com/wiki/Foxmarks:_Error:_Precondition_Failed as an\nexample of a situation where this bug is a real problem.", "id": 111994, "time": "2007-12-21T09:47:20Z", "creator": "bugzilla@events.soundwave.net", "creation_time": "2007-12-21T09:47:20Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 16593, "attachment_id": null, "id": 114505, "time": "2008-03-11T13:41:31Z", "creator": "chrisd@apache.org", "creation_time": "2008-03-11T13:41:31Z", "is_private": false, "text": "Fixed in trunk (607466, r607472, r607838) and backported to 2.2.8 (r609113) by changes to fix PR 38034.  Sample successful session below:\n\nGET /uploads/foo.txt HTTP/1.0\n\nHTTP/1.1 200 OK\nDate: Tue, 11 Mar 2008 20:10:29 GMT\nServer: Apache/2.3.0-dev (Unix) DAV/2\nLast-Modified: Tue, 11 Mar 2008 20:09:46 GMT\nETag: \"bec78d-1f-4482ee6ea848b\"\nAccept-Ranges: bytes\nContent-Length: 31\nConnection: close\nContent-Type: text/plain\n\nThis is the original content.\n\nPUT /uploads/foo.txt HTTP/1.0\nContent-Length: 30\nIf-Match: \"bec78d-1f-4482ee6ea848b\"\n\nThis is the revised content.\nHTTP/1.1 204 No Content\nDate: Tue, 11 Mar 2008 20:10:45 GMT\nServer: Apache/2.3.0-dev (Unix) DAV/2\nContent-Length: 0\nConnection: close\nContent-Type: text/plain\n\nGET /uploads/foo.txt HTTP/1.0\n\nHTTP/1.1 200 OK\nDate: Tue, 11 Mar 2008 20:11:05 GMT\nServer: Apache/2.3.0-dev (Unix) DAV/2\nLast-Modified: Tue, 11 Mar 2008 20:11:01 GMT\nETag: \"bec78d-1e-4482eeb5f5946\"\nAccept-Ranges: bytes\nContent-Length: 30\nConnection: close\nContent-Type: text/plain\n\nThis is the revised content.\n"}]
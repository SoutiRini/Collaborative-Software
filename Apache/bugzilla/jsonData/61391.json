[{"count": 0, "tags": [], "text": "In SlowQueryReport.reportFailedQuery() a change has been made to check if QueryStats is null before calling QueryStats.failure(). However, the logging is also included in this if block.\n\nThe logging should happen regardless of whether QueryStats is null or not, so that the SQL is logged.\n\nCurrent code:\nQueryStats qs = this.getQueryStats(sql);\nif (qs != null) {\n   qs.failure(delta, now);\n   if (isLogFailed() && log.isWarnEnabled()) {\n      log.warn(\"Failed Query Report SQL=\"+sql+\"; time=\"+delta+\" ms;\");\n   }\n}\n\nSuggested fix:\nQueryStats qs = this.getQueryStats(sql);\nif (qs != null) {\n   qs.failure(delta, now);\n}\nif (isLogFailed() && log.isWarnEnabled()) {\n   log.warn(\"Failed Query Report SQL=\"+sql+\"; time=\"+delta+\" ms;\");\n}", "is_private": false, "id": 200234, "creator": "c.webb@crossflight.com", "time": "2017-08-08T13:50:49Z", "bug_id": 61391, "creation_time": "2017-08-08T13:50:49Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 61391, "is_private": false, "count": 1, "id": 200522, "time": "2017-08-30T21:15:54Z", "creator": "markt@apache.org", "creation_time": "2017-08-30T21:15:54Z", "text": "Thanks for the report and the suggested fix.\n\nFixed in:\n- trunk for 9.0.0.M27 onwards\n- 8.5.x for 8.5.21 onwards\n- 8.0.x for 8.0.47 onwards\n- 7.0.x for 7.0.82 onwards"}]
[{"count": 0, "tags": [], "bug_id": 32239, "is_private": false, "id": 66902, "creation_time": "2004-11-15T08:08:27Z", "time": "2004-11-15T08:08:27Z", "creator": "chamaras@singnet.com.sg", "text": "Hi,\n\ni am running;\nApache/2.0.48 (Unix) mod_ssl/2.0.48 OpenSSL/0.9.7c DAV/2 mod_jk/1.2.2 configured.\non FreeBSD 5.2.1-RELEASE.\n\nAfter running for 4-5 days, I get the error \"server reached MaxClients setting\"\nand the server stops serving the requests. Could increase the MaxClients\nsetting. But will eventually reach the limit anyway.\n\nAlso noticed that the child processes are not being termintated upon copleting\nthe requests. \n\nif i do;\n>ps ax -o pid,ppid,start,state,command | grep http (sample output only...)\nPID   PPID   STARTED STAT COMMAND\n85998 85990  3:18AM  I    /usr/local/sbin/httpd -k start -DSSL >(start time)\n85999 85990  3:18AM  I    /usr/local/sbin/httpd -k start -DSSL >(start time)\n86088 85990  3:43AM  I    /usr/local/sbin/httpd -k start -DSSL >(spawned later)\n86089 85990  3:43AM  I    /usr/local/sbin/httpd -k start -DSSL >(spawned later)\n86090 85990  3:43AM  I    /usr/local/sbin/httpd -k start -DSSL >(spawned later)\n\ni get a list of 150+ (current MaxClients is set to 150) processes with all the\nsame ppid. Need to restart the server to get rid of the child processes which\nare not dying.\n\nalso, noticed that this have been reported before in 2.0.16.\nhttp://archive.apache.org/gnats/7844\n\nthnks n rgds,\nKC.", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 32239, "attachment_id": null, "text": "Use gdb to get backtraces of as many of these processes as possible to see\nwhat they are blocked on.  Hopefully there is one common blocker.", "id": 66922, "time": "2004-11-15T13:37:00Z", "creator": "trawick@apache.org", "creation_time": "2004-11-15T13:37:00Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 32239, "is_private": false, "id": 66942, "creation_time": "2004-11-15T19:57:18Z", "time": "2004-11-15T19:57:18Z", "creator": "chamaras@singnet.com.sg", "text": "I am not very familiar with using gdb, tried my best to collect some backtraces\nby looking at the man pages and the user manual for gdb. this is what i got, not\nquite sure howto interpret these hex codes though!\n-------------------------------------------------------------------------------\n7vvs11s:/#gdb --pid=86088\nGNU gdb 5.2.1 (FreeBSD)\nCopyright 2002 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-unknown-freebsd\".\nAttaching to process 86088\n0x2835d74f in ?? ()\n(gdb) bt\n#0  0x2835d74f in ?? ()\n#1  0x282da462 in ?? ()\n#2  0x080d3d93 in ?? ()\n#3  0x080d47e8 in ?? ()\n#4  0x080d4afd in ?? ()\n#5  0x080d4d58 in ?? ()\n#6  0x080d51cd in ?? ()\n#7  0x080dbc73 in ?? ()\n#8  0x08064742 in ?? ()\n(gdb) frame\n#0  0x2835d74f in ?? ()\n(gdb) info frame\nStack level 0, frame at 0xbfbfe8a8:\n eip = 0x2835d74f; saved eip 0x282da462\n called by frame at 0xbfbfe8b8\n Arglist at 0xbfbfe8a8, args:\n Locals at 0xbfbfe8a8, Previous frame's sp is 0x0\n Saved registers:\n  ebp at 0xbfbfe8a8, eip at 0xbfbfe8ac\n-------------------------------------------------------------------------------\nmost of the processes i looked at seem to have identical backtraces.\n\nthanks again & best regards,\n-kc", "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "chip@force-elite.com", "is_private": false, "id": 66943, "time": "2004-11-15T20:05:20Z", "bug_id": 32239, "creation_time": "2004-11-15T20:05:20Z", "tags": [], "text": "You need to copmile apache without striping the symbols.\n\n"}, {"count": 4, "attachment_id": null, "creator": "chip@force-elite.com", "is_private": false, "id": 66944, "time": "2004-11-15T20:09:40Z", "bug_id": 32239, "creation_time": "2004-11-15T20:09:40Z", "tags": [], "text": "oh. You didn't provide the path to the binary.\n\ntry gdb /usr/local/bin/apache2 [pid number]"}, {"count": 5, "attachment_id": null, "creator": "chamaras@singnet.com.sg", "text": "paul's suggestion seem to help... thnx.\nhere are the new backtraces; and they are all identical for all the child\nprocesses that are not dying.\n==================================================================================\n7vvs11s:/#gdb --pid=86088 /usr/local/sbin/httpd\nGNU gdb 5.2.1 (FreeBSD)\nCopyright 2002 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-unknown-freebsd\"...(no debugging symbols found)...\nAttaching to program: /usr2/local/sbin/httpd, process 86088\nReading symbols from /lib/libz.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/libz.so.2\nReading symbols from /usr/local/lib/libssl.so.3...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/local/lib/libssl.so.3\nReading symbols from /usr/local/lib/libcrypto.so.3...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/local/lib/libcrypto.so.3\nReading symbols from /usr/local/lib/apache2/libaprutil-0.so.9...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/local/lib/apache2/libaprutil-0.so.9\nReading symbols from /usr/local/lib/libexpat.so.4...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/local/lib/libexpat.so.4\nReading symbols from /usr/local/lib/apache2/libapr-0.so.9...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/local/lib/apache2/libapr-0.so.9\nReading symbols from /lib/libm.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/libm.so.2\nReading symbols from /lib/libcrypt.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/libcrypt.so.2\nReading symbols from /lib/libc.so.5...(no debugging symbols found)...done.\nLoaded symbols for /lib/libc.so.5\nReading symbols from /usr/local/libexec/apache2/mod_jk.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/local/libexec/apache2/mod_jk.so\nReading symbols from /libexec/ld-elf.so.1...(no debugging symbols found)...done.\nLoaded symbols for /libexec/ld-elf.so.1\n0x2835d74f in flock () from /lib/libc.so.5\n(gdb) bt\n#0  0x2835d74f in flock () from /lib/libc.so.5\n#1  0x282da0f6 in proc_mutex_flock_acquire () from\n/usr/local/lib/apache2/libapr-0.so.9\n#2  0x282da462 in apr_proc_mutex_lock () from /usr/local/lib/apache2/libapr-0.so.9\n#3  0x080d3d93 in accept_mutex_on ()\n#4  0x080d47e8 in child_main ()\n#5  0x080d4afd in make_child ()\n#6  0x080d4d58 in perform_idle_server_maintenance ()\n#7  0x080d51cd in ap_mpm_run ()\n#8  0x080dbc73 in main ()\n#9  0x08064742 in _start ()\n==================================================================================\nhope this is what you are looking for...\n\nthnks n rgds,\n-kc", "id": 66949, "time": "2004-11-15T20:52:02Z", "bug_id": 32239, "creation_time": "2004-11-15T20:52:02Z", "tags": [], "is_private": false}, {"count": 6, "attachment_id": null, "creator": "trawick@apache.org", "text": "This backtrace:\n\n#0  0x2835d74f in flock () from /lib/libc.so.5\n#1  0x282da0f6 in proc_mutex_flock_acquire () from\n/usr/local/lib/apache2/libapr-0.so.9\n#2  0x282da462 in apr_proc_mutex_lock () from /usr/local/lib/apache2/libapr-0.so.9\n#3  0x080d3d93 in accept_mutex_on ()\n#4  0x080d47e8 in child_main ()\n#5  0x080d4afd in make_child ()\n#6  0x080d4d58 in perform_idle_server_maintenance ()\n#7  0x080d51cd in ap_mpm_run ()\n#8  0x080dbc73 in main ()\n\nis normal backtrace for an idle child process, and Apache is not at the\nMaxClients level when the backtrace looks like this.\n\nAt the point where Apache stops serving requests, gather the same backtrace data\nagain and post here.", "id": 66952, "time": "2004-11-15T21:02:43Z", "bug_id": 32239, "creation_time": "2004-11-15T21:02:43Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 32239, "is_private": false, "id": 66956, "creation_time": "2004-11-15T21:46:48Z", "time": "2004-11-15T21:46:48Z", "creator": "chamaras@singnet.com.sg", "text": "yes, i had to restart as this is a live server. will collect the backtraces\nagain when the server reaches the MaxClients. i am running server with a lowered\nMaxClients to reach this status faster (hopefully).\n\nin the meantime, these processes that i collected the backtraces are not started\noriginally, rather they are started later when new requests arrived. but, these\nprocesses keep running even thought the MaxSpareServers is reached.\n\n-kc.", "attachment_id": null}, {"count": 8, "attachment_id": null, "creator": "chamaras@singnet.com.sg", "text": "here's what the backtrace looks like when the server has reached the MaxClient\nsetting.\n\n#0  0x2835decf in recvfrom () from /lib/libc.so.5\n#1  0x283480b4 in recv () from /lib/libc.so.5\n#2  0x283f6d84 in jk_tcp_socket_recvfull () from\n/usr/local/libexec/apache2/mod_jk.so\n#3  0x284011c5 in ajp_connection_tcp_get_message () from\n/usr/local/libexec/apache2/mod_jk.so\n#4  0x28401ba6 in ajp_get_reply () from /usr/local/libexec/apache2/mod_jk.so\n#5  0x28401e76 in ajp_service () from /usr/local/libexec/apache2/mod_jk.so\n#6  0x283f45eb in jk_handler () from /usr/local/libexec/apache2/mod_jk.so\n#7  0x080d62f9 in ap_run_handler ()\n#8  0x080d6974 in ap_invoke_handler ()\n#9  0x080a4129 in ap_process_request ()\n#10 0x0809f147 in ap_process_http_connection ()\n#11 0x080e1bc9 in ap_run_process_connection ()\n#12 0x080e1efe in ap_process_connection ()\n#13 0x080d4943 in child_main ()\n#14 0x080d4afd in make_child ()\n#15 0x080d4d58 in perform_idle_server_maintenance ()\n#16 0x080d51cd in ap_mpm_run ()\n#17 0x080dbc73 in main ()\n#18 0x08064742 in _start ()\n\n-kc.", "id": 66967, "time": "2004-11-15T22:33:23Z", "bug_id": 32239, "creation_time": "2004-11-15T22:33:23Z", "tags": [], "is_private": false}, {"count": 9, "attachment_id": null, "creator": "chamaras@singnet.com.sg", "is_private": false, "id": 67069, "time": "2004-11-17T20:14:53Z", "bug_id": 32239, "creation_time": "2004-11-17T20:14:53Z", "tags": [], "text": "i have confirmed that the backtrace for the server when it has reached the\nMaxClients and have stopped serving requests does indeed look as above.\n\nBut the question is why the parent process does not kill off the excess\nprocesses, despite exceeding the MaxSpareServers setting.\n\nrgds,\n-kc.\n\n"}, {"count": 10, "attachment_id": null, "creator": "chip@force-elite.com", "text": "http://httpd.apache.org/docs-2.0/mod/mpm_common.html#acceptmutex\n\nTry setting 'AccteMutex fcntl' or 'AcceptMutex pthread'", "id": 67073, "time": "2004-11-17T21:14:19Z", "bug_id": 32239, "creation_time": "2004-11-17T21:14:19Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 32239, "is_private": false, "id": 67077, "creation_time": "2004-11-17T21:51:20Z", "time": "2004-11-17T21:51:20Z", "creator": "trawick@apache.org", "text": "Trying different acceptmutex flavors is a good plan.  With processes blocked\nwaiting for the accept mutex, either something is hosed with the mutex or the\none child process holding that mutex got stuck in the narrow window where it is\nheld.  (It needs to call select or poll followed by accept.)\n\nDid you encounter any child process crashes?  (check web server error log)  That\ncan sometimes result in mutex ownership being lost.\n\nNote that \"server reached maxclients\" is a one-time only message; no later\nmessage if problem resolved itself.  A child process blocked waiting for the\naccept mutex definitely means you aren't currently at maxclients, since that\nonly counts processes which are handling an active connection.\n\nAre there any FreeBSD kernel limits/tuning related to flock?  You would be\ngrowing in number of busy child processes up until you reach maxclients, then\nwhen load subsides you'll suddenly have more processes blocked in that accept\nmutex than you ever had before.  This could result in kernel being unable to\nallocate enough of some sort of resource to handle the many simultaneous lock\nrequests.  Maybe \"AcceptMutex something-besides-flock\" will work around that.", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 32239, "text": "Not sure if wires are getting crossed here.  If the children are all getting\nblocked like:\n\n#0  0x2835decf in recvfrom () from /lib/libc.so.5\n#1  0x283480b4 in recv () from /lib/libc.so.5\n#2  0x283f6d84 in jk_tcp_socket_recvfull () from\n/usr/local/libexec/apache2/mod_jk.so\n\nas you say, then that implies they are all waiting for Tomcat and/or this is\nsome mod_jk issue.  The easiest way to determine what the children are stuck\ndoing is to enable /server-status/ - but to load the page of course you'd have\nto kill off one blocked child manually!", "id": 67080, "time": "2004-11-17T22:00:03Z", "creator": "jorton@redhat.com", "creation_time": "2004-11-17T22:00:03Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 32239, "attachment_id": null, "is_private": false, "id": 67124, "time": "2004-11-18T12:51:42Z", "creator": "trawick@apache.org", "creation_time": "2004-11-18T12:51:42Z", "text": "Joe says:\n>Not sure if wires are getting crossed here.  If the children are all getting\n>blocked like:\n\nYou're correct, wires are getting crossed :(  I missed the update with the\nconnector backtrace and thought he was referring to the mutex backtrace again :(\n\n>The easiest way to determine what the children are stuck\n>doing is to enable /server-status/ - but to load the page of \n>course you'd have to kill off one blocked child manually!\n\nand perhaps keep doing it until socket accept queue in kernel empties, if ever\n\nsee also\n\nhttp://www.apache.org/~trawick/mod_backdoor.txt\nhttp://www.apache.org/~trawick/mod_backdoor.c\n"}, {"count": 14, "attachment_id": null, "creator": "chamaras@singnet.com.sg", "is_private": false, "id": 67163, "time": "2004-11-18T19:38:37Z", "bug_id": 32239, "creation_time": "2004-11-18T19:38:37Z", "tags": [], "text": "i've tried what Paul suggested.. i.e. using the AcceptMutex (currently testing\nwith the fcntl). \n\nseem to help the situation. there don't seem to be as many processes hanging\naround as there was before. might yet be too early to jump to conclusions though. \n\ni am a bit reluctant to enable the /server-status/ as this might have some\nperformance penalty as well as it would mean, i'd have to recompile the server\nif i'm going the build the server with mod_status (is that the correct module).\nrecompiling and re-installing needs down-time as this is a production server.\n\ncan i load this module dynamically?\n\nthnks n rgds,\n-kc."}, {"count": 15, "tags": [], "bug_id": 32239, "attachment_id": null, "is_private": false, "id": 67217, "time": "2004-11-19T15:06:39Z", "creator": "trawick@apache.org", "creation_time": "2004-11-19T15:06:39Z", "text": "mod_status can be compiled without rebuilding the server\n\ncd modules/generators\napxs -ci mod_status.c\n\nif you enabled mod_so when you built the server, you can load mod_status into\nthe server via LoadModule directive\n"}, {"count": 16, "tags": [], "bug_id": 32239, "attachment_id": 13539, "text": "Created attachment 13539\nAttachment#1 - server-status output", "id": 67439, "time": "2004-11-25T02:08:11Z", "creator": "chamaras@singnet.com.sg", "creation_time": "2004-11-25T02:08:11Z", "is_private": false}, {"count": 17, "tags": [], "bug_id": 32239, "is_private": false, "text": "Actually mod_status was already pre-compiled when i built the server. I had to\njust add the module spoecific and the location configurations.\n\nThe server status output is given in the Attachment#1. Appreciate any comments\nyou may have on this.\n\nServers, 6-0, 9-0, 12-0 and 14-0 have been in wait state for almost a day now.\nNot quite sure what they are waiting for... How can I find out what they are\nwaiting for?\n\nthnks\n-kc", "id": 67440, "time": "2004-11-25T02:18:28Z", "creator": "chamaras@singnet.com.sg", "creation_time": "2004-11-25T02:18:28Z", "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 32239, "text": "the Attachment#1 (zip file) is the incorrect attachment. Not quite sure how that\ngot into this bug, as it is from a bug#75 which is already closed.\n\nthe correct attachement is attachment (id=13539).\nthnks\n-kc\n\n", "id": 67441, "time": "2004-11-25T03:08:31Z", "creator": "chamaras@singnet.com.sg", "creation_time": "2004-11-25T03:08:31Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "bug_id": 32239, "text": ">Servers, 6-0, 9-0, 12-0 and 14-0 have been in wait state \n>for almost a day now.  Not quite sure what they are \n>waiting for... How can I find out what they are\n>waiting for?\n\nTake server 6-0 as an example:\n\n6-0 35327 3/429/429 W  0.62 151339 0 0.0 2.29 2.29  \\\n192.19.166.240 7vvs11s.csminc.com \\\nGET /compliance/DailyEqpGrpComplianceChart.jsp?eqGrpname=PCMPO_ \n\nState W means that Apache has parsed the request and\n(probably in this case) handed it to a plug-in module to generate the\nresponse.\npid is 35327, request is for DailyEqpGrpComplianceChart.jsp\n\nTo find out at a low level what the apache process 35327 is waiting for before\nresponding, attach to that process with gdb and get a backtrace.  I anticipate\nthat this is just going to show that it is in mod_jk waiting for response from\nyour java application server.  Perhaps the Tomcat folks can suggest something\nlike mod_status for Tomcat which can retrieve that information without getting a\njavacore of Tomcat jvm.", "id": 67649, "time": "2004-11-30T20:09:24Z", "creator": "trawick@apache.org", "creation_time": "2004-11-30T20:09:24Z", "is_private": false, "attachment_id": null}, {"count": 20, "attachment_id": null, "creator": "chamaras@singnet.com.sg", "text": "thank you very much for your support in trying to find out the root cause for\nthis problem. think i have a much better picture of what's going on now. also\ntrying out the 'AccteMutex fcntl' seem to have helped to some extent.\n\nwill work with the tomcat guys to see if they have a module that will let me see\nwhat the tomcat is doing...\n\nbest rgds,\n-kc.", "id": 68019, "time": "2004-12-07T03:51:44Z", "bug_id": 32239, "creation_time": "2004-12-07T03:51:44Z", "tags": [], "is_private": false}, {"count": 21, "tags": [], "bug_id": 32239, "attachment_id": 13691, "text": "Created attachment 13691\nbacktrace for child process", "id": 68149, "time": "2004-12-09T03:37:23Z", "creator": "chamaras@singnet.com.sg", "creation_time": "2004-12-09T03:37:23Z", "is_private": false}, {"count": 22, "attachment_id": null, "creator": "chamaras@singnet.com.sg", "text": "hi,\n\nattached is the backtrace for child process (id=13691).\n\nthnks n rgds,\n-kc.\n", "id": 68150, "time": "2004-12-09T03:38:52Z", "bug_id": 32239, "creation_time": "2004-12-09T03:38:52Z", "tags": [], "is_private": false}, {"count": 23, "attachment_id": null, "creator": "dejan@gmizo.com", "text": "Hi,\n\ni am running Apache 2.0.52, mod_php4-4.3.4_5 on FreeBSD 4.10-RELEASE-p5. I get\nthe same error as KC - \"server reached MaxClients setting, consider raising...\".\nAfter that server stops serving the requests. Because I have a realy busy server\nit stops responding after max. four hours. I have already rising MaxClients to\nit's limit - 1600.\n\nI don't use Tomcat on my server, just Apache with mod_php.\n\nThanks!\n\nRegards,\n\nDejan\n", "id": 68712, "time": "2004-12-19T23:01:40Z", "bug_id": 32239, "creation_time": "2004-12-19T23:01:40Z", "tags": [], "is_private": false}, {"count": 24, "tags": [], "bug_id": 32239, "attachment_id": null, "text": "Hi,\n\nIs there anything i can do to speed up the process for resolving the issue?\n\nThanks!\n\nRegards,\n\nDejan", "id": 68815, "time": "2004-12-22T18:53:23Z", "creator": "dejan@gmizo.com", "creation_time": "2004-12-22T18:53:23Z", "is_private": false}, {"count": 25, "tags": [], "bug_id": 32239, "is_private": false, "id": 68816, "creation_time": "2004-12-22T19:20:14Z", "time": "2004-12-22T19:20:14Z", "creator": "trawick@apache.org", "text": ">Is there anything i can do to speed up the process for resolving the issue?\n\nUse gdb to get backtraces of child processes and see where the request\nprocessing is stuck.  In MaxClients scenarios which are not due to temporary\npeak load, the problem is almost always that some dynamic page generation\n(servlet, PHP script, whatever) is hung.\n", "attachment_id": null}, {"count": 26, "tags": [], "bug_id": 32239, "attachment_id": null, "is_private": false, "id": 69038, "time": "2004-12-28T18:24:57Z", "creator": "dejan@gmizo.com", "creation_time": "2004-12-28T18:24:57Z", "text": "Here are the backtraces:\n\nGNU gdb 4.18 (FreeBSD)\nCopyright 1998 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-unknown-freebsd\"...\n(no debugging symbols found)...\n\n/home/dejan/46017: No such file or directory.\nAttaching to program: /usr/local/sbin/httpd, process 46017\n\nall of them are same, only the first one on the \"ps ax\":\n\nGNU gdb 4.18 (FreeBSD)\nCopyright 1998 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-unknown-freebsd\"...\n(no debugging symbols found)...\n\n/home/dejan/164: No such file or directory.\nAttaching to program: /usr/local/sbin/httpd, process 164\nReading symbols from /usr/lib/libz.so.2...(no debugging symbols found)...done.\nReading symbols from /usr/lib/libssl.so.3...(no debugging symbols found)...\ndone.\nReading symbols from /usr/lib/libcrypto.so.3...(no debugging symbols found)...\ndone.\nReading symbols from /usr/local/lib/apache2/libaprutil-0.so.9...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libexpat.so.4...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libiconv.so.3...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/apache2/libapr-0.so.9...\n(no debugging symbols found)...done.\nReading symbols from /usr/lib/libm.so.2...(no debugging symbols found)...done.\nReading symbols from /usr/lib/libcrypt.so.2...(no debugging symbols found)...\ndone.\nReading symbols from /usr/lib/libc.so.4...(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_access.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_auth.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_auth_anon.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_auth_dbm.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_charset_lite.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_include.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_deflate.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_log_config.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_logio.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_env.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_mime_magic.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_cern_meta.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_expires.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_headers.so...\n---Type <return> to continue, or q <return> to quit---\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_usertrack.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_unique_id.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_setenvif.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_mime.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_status.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_autoindex.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_asis.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_info.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_cgi.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_vhost_alias.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_negotiation.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_dir.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_imap.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_actions.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_speling.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_userdir.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_alias.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_rewrite.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/libphp4.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/mysql/libmysqlclient.so.12...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libmcrypt.so.8...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libltdl.so.4...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libintl.so.5...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libfreetype.so.9...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libpng.so.5...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libjpeg.so.9...\n---Type <return> to continue, or q <return> to quit---\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libcurl.so.2...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_ttsites.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/lib/libstdc++.so.3...(no debugging symbols found)...\ndone.\nReading symbols from /usr/local/Zend/lib/ZendExtensionManager.so...\n(no debugging symbols found)...done.\nReading symbols from\n/usr/local/Zend/lib/Optimizer-2.5.5/php-4.3.x/ZendOptimizer.so...(no debugging\nsymbols found)...done.\nReading symbols from\n/usr/local/Zend/lib/DownloadServer-1.0.1/php-4.3.x/ZendDownloadServer.so...(no\ndebugging symbols found)...done.\nReading symbols from\n/usr/local/Zend/lib/ZPS-4.0.2/php-4.3.x/ZendPerformanceSuite.so...(no debugging\nsymbols found)...done.\nReading symbols from /usr/libexec/ld-elf.so.1...(no debugging symbols found)...\ndone.\n0x483a2b18 in select () from /usr/lib/libc.so.4\n\nAfter submitting \"/usr/local/etc/rc.d/apache2 stop\" this process stopped but all\nthe other processes still hung there. The only solution was to reset machine.\n\nI downgraded apache to version 1.3.33, the problem still exists.\n\nRegards,\nD."}, {"count": 27, "tags": [], "bug_id": 32239, "text": "Hi there...   to get the backtrace, attach with gdb like you did, but run the\n\"where\" command before exiting.", "id": 69040, "time": "2004-12-28T18:43:39Z", "creator": "trawick@apache.org", "creation_time": "2004-12-28T18:43:39Z", "is_private": false, "attachment_id": null}, {"count": 28, "attachment_id": null, "creator": "dejan@gmizo.com", "text": "(In reply to comment #27)\n> Hi there...   to get the backtrace, attach with gdb like you did, but run the\n> \"where\" command before exiting.\n\nGNU gdb 4.18 (FreeBSD)\nCopyright 1998 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-unknown-freebsd\"...\n(no debugging symbols found)...\n\n/etc/19727: No such file or directory.\nAttaching to program: /usr/local/sbin/httpd, process 19727\nReading symbols from /usr/lib/libz.so.2...(no debugging symbols found)...done.\nReading symbols from /usr/lib/libssl.so.3...(no debugging symbols found)...\ndone.\nReading symbols from /usr/lib/libcrypto.so.3...(no debugging symbols found)...\ndone.\nReading symbols from /usr/local/lib/apache2/libaprutil-0.so.9...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libexpat.so.5...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libiconv.so.3...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/apache2/libapr-0.so.9...\n(no debugging symbols found)...done.\nReading symbols from /usr/lib/libm.so.2...(no debugging symbols found)...done.\nReading symbols from /usr/lib/libcrypt.so.2...(no debugging symbols found)...\ndone.\nReading symbols from /usr/lib/libc.so.4...(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_access.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_auth.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_auth_anon.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_auth_dbm.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_charset_lite.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_include.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_deflate.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_log_config.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_logio.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_env.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_mime_magic.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_cern_meta.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_expires.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_headers.so...\n---Type <return> to continue, or q <return> to quit---\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_usertrack.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_unique_id.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_setenvif.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_mime.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_status.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_autoindex.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_asis.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_info.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_cgi.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_vhost_alias.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_negotiation.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_dir.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_imap.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_actions.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_speling.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_userdir.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_alias.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_rewrite.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/libphp4.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/libexec/apache2/mod_ttsites.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/lib/libstdc++.so.3...(no debugging symbols found)...\ndone.\nReading symbols from /usr/local/Zend/lib/ZendExtensionManager.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/php/20020429/session.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/php/20020429/pcre.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/php/20020429/mysql.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/mysql/libmysqlclient.so.12...\n---Type <return> to continue, or q <return> to quit---\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/php/20020429/gd.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libt1.so.5...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libfreetype.so.9...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libpng.so.5...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/libjpeg.so.9...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/php/20020429/zlib.so...\n(no debugging symbols found)...done.\nReading symbols from /usr/local/lib/php/20020429/exif.so...\n(no debugging symbols found)...done.\nReading symbols from\n/usr/local/Zend/lib/Optimizer-2.5.5/php-4.3.x/ZendOptimizer.so...(no debugging\nsymbols found)...done.\nReading symbols from\n/usr/local/Zend/lib/ZPS-4.0.2/php-4.3.x/ZendPerformanceSuite.so...(no debugging\nsymbols found)...done.\nReading symbols from /usr/libexec/ld-elf.so.1...(no debugging symbols found)...\ndone.\n0x483a6b18 in select () from /usr/lib/libc.so.4\n(gdb) where\n#0  0x483a6b18 in select () from /usr/lib/libc.so.4\n#1  0x48328d03 in apr_sleep () from /usr/local/lib/apache2/libapr-0.so.9\n#2  0x806e22c in ap_wait_or_timeout ()\n#3  0x806374b in ap_mpm_run ()\n#4  0x80691b0 in main ()\n#5  0x805ce31 in _start ()\n\nBut this is only from the first process. All others just hung there.", "id": 69163, "time": "2005-01-03T17:24:42Z", "bug_id": 32239, "creation_time": "2005-01-03T17:24:42Z", "tags": [], "is_private": false}, {"count": 29, "attachment_id": null, "creator": "trawick@apache.org", "text": "Hi, Dejan,\n\nYour last PR update says \"All others just hung there.\" when referring to getting\nbacktraces of httpd child processes with gdb.  So I presume that gdb never\nattached successfully but instead the last message it issued was something like\nthis?\n\"Attaching to program `/mnt/solaris9root/scratch/inst/21/bin/httpd', process 15015\"\nand never anything else.\n\nIf gdb is unable to get a backtrace since it can't attach to the process, try\nkilling a particular child process to generate a core file then use gdb to get\nthe backtrace from the core file.\n\nDoes your Apache dump core when a child process crashes?  Hopefully yes, so\nforce a core file like this:\n\na) during the hang condition, pick an httpd child process at random (call it pid\n12345 in this example)\nb) kill -SEGV 12345\nc) gdb /path/to/httpd /path/to/corefile\nNow run the gdb \"where\" command to get the backtrace.  It should show where the\ncode was stuck, preventing request processing from completing.\n\nIf your Apache doesn't dump core when a child process crashes, you need some\nreconfiguring.\n\na) set CoredumpDirectory directive to a directory with free space which httpd\nchild processes can write to (e.g., \"CoredumpDirectory /tmp)\nb) make sure you have \"ulimit -c unlimited\" in the shell used to start Apache\nc) try to force core again by sending a child process SIGSEGV\n\n--/--\n\nA totally different approach to finding out what code is hanging is to see what\nrequests are hanging using mod_status.\n\nmod_backdoor (see http://www.apache.org/~trawick/mod_backdoor.txt) can allow you\nto get mod_status reports even if the web server is hung on the normal ports.\n\nOtherwise, you have to monitor mod_status reports over time to see what requests\nare getting stuck.  You'll likely see more and more requests getting stuck\nleading up to the time when no new connections can be processed.\n\n--/--\n\nIt is very unlikely that anything in Apache is causing the problem.  You've\ntried Apache 1.3 and Apache 2.0 and both eventually hit the MaxClients\ncondition.  A permanent MaxClients condition like this almost always means that\nsome dynamic content generator is hung.  Your PHP scripts are the common\ndenominator between the two failing configurations.  The above debugging\n(getting backtrace at time of hang or finding out if specific requests are\nhanging) can help point the way to which script(s) may be having a problem.", "id": 69272, "time": "2005-01-06T15:40:48Z", "bug_id": 32239, "creation_time": "2005-01-06T15:40:48Z", "tags": [], "is_private": false}, {"count": 30, "attachment_id": null, "creator": "hawk_air@hotmail.com", "text": "I think it is not the apache bug,but the tomcat or jetty or jboss u using \nmod_jk connected bug.\nI also have thus this system using apache1.3.x + mod_php + mod_jk + tomcat,the \nsystem under heavy load,it's about 15,000,000 hits perday, after run for \nseveral days,maybe a week, apache child then reach maxclients(it's equal \n1024!),then total system stop response, after restart apache,it works again.\nfirst i think maybe apache bug,upgrade to latest apache1.3.33,then php \napplication bug, upgrade to php4.3.10,but the problem happens again.\nthen i think maybe the mod_jk bug,but after enable debug on mod_jk,nothing \nhappens,but ajp13 log on tomcat show something,that make me got the answer,IT \nIS Tomcat that HANGs total system,some bug in tomcat4.1.29 make the connection \nbetween httpd and tomcat,NEVER been releaseed,the httpd process only stop and \nwait,thus after sometime,apache reach the maxclients.\nAfter update tomcat from 4.1.29 to 4.1.31,the problem never happended again.\nThough i found some bug in the java code imp the ajp13 protocol,maybe i'll make \npatch on it when i am free.", "id": 69666, "time": "2005-01-14T09:47:49Z", "bug_id": 32239, "creation_time": "2005-01-14T09:47:49Z", "tags": [], "is_private": false}, {"count": 31, "tags": [], "bug_id": 32239, "is_private": false, "text": "Looks like the reporter resolved the problem to be in mod_jk.", "id": 73359, "time": "2005-04-06T22:57:26Z", "creator": "chip@force-elite.com", "creation_time": "2005-04-06T22:57:26Z", "attachment_id": null}]
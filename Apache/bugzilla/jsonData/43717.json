[{"count": 0, "tags": [], "bug_id": 43717, "is_private": false, "text": "Apache starts to segfault with 2000+ includes (everything is okay with ~600-1000\nincludes):\n\n(gdb) b ap_process_request\nNote: breakpoints 1 and 3 also set at pc 0x809f9e9.\nBreakpoint 4 at 0x809f9e9: file http_request.c, line 252.\n(gdb) run -X -d /etc/httpd\nStarting program: /usr/sbin/httpd -X -d /etc/httpd\n[Thread debugging using libthread_db enabled]\n[New Thread -1208407840 (LWP 30464)]\n\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread -1208407840 (LWP 30464)]\n0x00e21d63 in RAND_SSLeay () from /lib/libcrypto.so.4\n(gdb) n\nSingle stepping until exit from function RAND_SSLeay,\nwhich has no line number information.\n\nProgram terminated with signal SIGSEGV, Segmentation fault.\nThe program no longer exists.", "id": 109850, "time": "2007-10-29T00:29:33Z", "creator": "agne@hard.lt", "creation_time": "2007-10-29T00:29:33Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "jorton@redhat.com", "text": "This is an OpenSSL bug, fixed in 0.9.8c and later.  (it uses select() rather\nthan poll() and doesn't check for the FD_SETSIZE overflow)", "id": 109859, "time": "2007-10-29T04:12:21Z", "bug_id": 43717, "creation_time": "2007-10-29T04:12:21Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "agne@hard.lt", "attachment_id": null, "text": "What do you think about this patch?\n\ndiff -Nur httpd-2.2.6.orig/modules/ssl/ssl_engine_rand.c\nhttpd-2.2.6/modules/ssl/ssl_engine_rand.c\n--- httpd-2.2.6.orig/modules/ssl/ssl_engine_rand.c      2006-07-11\n22:38:44.000000000 -0500\n+++ httpd-2.2.6/modules/ssl/ssl_engine_rand.c   2007-10-01 17:28:24.000000000 -0500\n@@ -127,9 +127,23 @@\n     ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,\n                  \"%sSeeding PRNG with %d bytes of entropy\", prefix, nDone);\n\n+/*\n+ * RAND_status() will generate segfaults when more than 1024 filedescriptors are\n+ * open on OpenSSL versions before 0.9.8c and 0.9.7k\n+ */\n+#if SSL_LIBRARY_VERSION < 0x00908000\n+#if SSL_LIBRARY_VERSION >= 0x009070b0\n     if (RAND_status() == 0)\n         ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,\n                      \"%sPRNG still contains insufficient entropy!\", prefix);\n+#endif\n+#else\n+#if SSL_LIBRARY_VERSION >= 0x00908030\n+    if (RAND_status() == 0)\n+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,\n+                     \"%sPRNG still contains insufficient entropy!\", prefix);\n+#endif\n+#endif\n\n     return nDone;\n }", "id": 111602, "time": "2007-12-10T07:04:31Z", "bug_id": 43717, "creation_time": "2007-12-10T07:04:31Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43717, "text": "I see no need to add complexity to mod_ssl to attempt to work around this bug,\nit's a bug in OpenSSL and has been fixed there.", "id": 111612, "time": "2007-12-10T11:55:18Z", "creator": "jorton@redhat.com", "creation_time": "2007-12-10T11:55:18Z", "is_private": false, "attachment_id": null}]
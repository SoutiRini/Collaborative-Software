[{"count": 0, "tags": [], "bug_id": 59727, "attachment_id": null, "id": 191802, "time": "2016-06-19T22:45:57Z", "creator": "onealj@apache.org", "creation_time": "2016-06-19T22:45:57Z", "is_private": false, "text": "There have been several performance-related bugs* opened for adding a merged regions or array formula.\nThis may be slow because array formulas and merged regions cannot intersect, so adding either requires checking all existing array formulas and merged regions.\n\nXSSFSheet#validateArrayFormulas loops over each of the cells in a merged region, gets the array formula region that the cell belongs to and determines if it intersects.\n\nIf there are few array formulas in a sheet or if the merged region or array formula is large, it may be faster to loop over the array formulas in the sheet than looping over the cells where the intersection would occur. Right now we're looping over cells and looping over the merged regions list, so there's probably room for improvement here.\n\nIf the intersection code was slow relative to CellRangeAddress.hashCode+equals, then it would be cheaper to add each checked address to a set--fortunately the intersection code is about the same cost as equals, so this set approach would actually be slower.\n\n* related:\nbug 55280: Poor (Blocking) Performance of Merged Regions\nbug 59212: Do not check for overlapping regions when adding merged regions to a sheet\nbug 58885: Performance regression on addition of merged regions"}]
[{"count": 0, "attachment_id": null, "creator": "nbmlaw@gmail.com", "is_private": false, "id": 197614, "time": "2017-03-13T12:59:35Z", "bug_id": 60850, "creation_time": "2017-03-13T12:59:35Z", "tags": [], "text": "linux: centos-release-7-3.1611.el7.centos.x86_64\nhttpd: httpd-2.4.6-45.el7.centos.x86_64\n\nProxyPass ! directive seems to have no effect.  I am trying not to pass the .well-known directory (used by letsencrypt) so it can be served directly by httpd.  everything else needs to be passed to a Tomcat server.  The second line works perfectly but the first line does not. \n\nProxyPass /.well-known !\nProxyPass / ajp://localhost:8010/\n\nI have also tried adding ProxyRequests Off but it has no effect.  This configuration worked perfectly on CentOS 6 before I upgraded.\n\n[root@ns1 ~]# httpd -M | grep proxy\n proxy_module (shared)\n proxy_ajp_module (shared)\n proxy_balancer_module (shared)\n proxy_connect_module (shared)\n proxy_express_module (shared)\n proxy_fcgi_module (shared)\n proxy_fdpass_module (shared)\n proxy_ftp_module (shared)\n proxy_http_module (shared)\n proxy_scgi_module (shared)\n proxy_wstunnel_module (shared)"}, {"count": 1, "attachment_id": null, "creator": "covener@gmail.com", "text": "can you show a full/flat configuration that demonstrates the problem? With that we can at least try it on a contemporary source release.", "id": 197616, "time": "2017-03-13T13:20:57Z", "bug_id": 60850, "creation_time": "2017-03-13T13:20:57Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "nbmlaw@gmail.com", "attachment_id": null, "text": "i have tried it with a blank CentOS installation on VirtualBox.  just by adding the file /etc/httpd/conf.d/vhosts.conf with\n<VirtualHost *:80>\n   ServerName www.example.com\n   ServerAlias example.com\n   DocumentRoot /var/www/html/example.com/public_html\n #  ErrorLog /var/www/example.com/error_log\n   ProxyPass /.well-known !\n   ProxyPass / http://example2.com/\n</VirtualHost>\n<VirtualHost *:80>\n   ServerName www.example2.com\n   ServerAlias example2.com\n   DocumentRoot /var/www/html/example2.com/public_html\n</VirtualHost>\n(and adding example.com and example2.com to /etc/hosts)\ni can see that it works fine.  example.com passes to example2.com and i can see a test file in .well-known.\n\nthere must be a problem on my production server somehwere.  the versions of centos-release and httpd are identical\n\ndo you know of any particular configuration that would specifically disable the ! directive?", "id": 197621, "time": "2017-03-13T14:50:44Z", "bug_id": 60850, "creation_time": "2017-03-13T14:50:44Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 60850, "is_private": false, "text": "(In reply to nbmlaw from comment #2)\n> i have tried it with a blank CentOS installation on VirtualBox.  just by\n> adding the file /etc/httpd/conf.d/vhosts.conf with\n> <VirtualHost *:80>\n>    ServerName www.example.com\n>    ServerAlias example.com\n>    DocumentRoot /var/www/html/example.com/public_html\n>  #  ErrorLog /var/www/example.com/error_log\n>    ProxyPass /.well-known !\n>    ProxyPass / http://example2.com/\n> </VirtualHost>\n> <VirtualHost *:80>\n>    ServerName www.example2.com\n>    ServerAlias example2.com\n>    DocumentRoot /var/www/html/example2.com/public_html\n> </VirtualHost>\n> (and adding example.com and example2.com to /etc/hosts)\n> i can see that it works fine.  example.com passes to example2.com and i can\n> see a test file in .well-known.\n> \n> there must be a problem on my production server somehwere.  the versions of\n> centos-release and httpd are identical\n> \n> do you know of any particular configuration that would specifically disable\n> the ! directive?\n\nThanks for verifying.  IMO Nothing like that is really plausible, the most plausible is that there are other proxying rules hidden somewhere (including e.g. RewriteRule ... ...  [P])\n\nif it hadn't persisted so long, I'd say another candidate is browser caching.", "id": 197622, "time": "2017-03-13T15:02:57Z", "creator": "covener@gmail.com", "creation_time": "2017-03-13T15:02:57Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "nbmlaw@gmail.com", "text": "the hosting panel (sentora) handles redirects port override 80 to 443 and uses mod_rewrite.  i used sentora on CentOS 6 so this should not have changed anything?\n\n# DOMAIN: nbmlaw.co.uk\n# PORT FORWARD FROM 80 TO: 443\n<virtualhost *:80>\nServerName nbmlaw.co.uk\nServerAlias www.nbmlaw.co.uk\nServerAdmin matthew.broadhead@nbmlaw.co.uk\nRewriteEngine on\nReWriteCond %{SERVER_PORT} !^443$\nRewriteRule ^/(.*) https://%{HTTP_HOST}/$1 [NC,R,L]\n</virtualhost>\n# END DOMAIN: nbmlaw.co.uk\n# DOMAIN: nbmlaw.co.uk\n<virtualhost *:443>\nServerName nbmlaw.co.uk\nServerAlias  www.nbmlaw.co.uk\nServerAdmin matthew.broadhead@nbmlaw.co.uk\nDocumentRoot \"/mnt/storage/var/sentora/hostdata/nbm/public_html/nbmlaw_co_uk\"\nphp_admin_value open_basedir \"/mnt/storage/var/sentora/hostdata/nbm/public_html/nbmlaw_co_uk:/mnt/storage/var/sentora/temp/\"\nphp_admin_value suhosin.executor.func.blacklist \"passthru, show_source, shell_exec, system, pcntl_exec, popen, pclose, proc_open, proc_nice, proc_terminate, proc_get_status,$\nErrorLog \"/mnt/storage/var/sentora/logs/domains/nbm/nbmlaw.co.uk-error.log\"\nCustomLog \"/mnt/storage/var/sentora/logs/domains/nbm/nbmlaw.co.uk-access.log\" combined\nCustomLog \"/mnt/storage/var/sentora/logs/domains/nbm/nbmlaw.co.uk-bandwidth.log\" common\n<Directory \"/mnt/storage/var/sentora/hostdata/nbm/public_html/nbmlaw_co_uk\">\n  Options +FollowSymLinks -Indexes\n  AllowOverride All\n  Require all granted\n</Directory>\nAddType application/x-httpd-php .php3 .php\nErrorDocument 404 /_errorpages/404.html\nErrorDocument 510 /_errorpages/510.html\nErrorDocument 500 /_errorpages/500.html\nErrorDocument 403 /_errorpages/403.html\nDirectoryIndex index.html index.htm index.php index.asp index.aspx index.jsp index.jspa index.shtml index.shtm\n# Custom Global Settings (if any exist)\n\n# Custom VH settings (if any exist)\n#ProxyPass ^/images !\n#ProxyPass ^/errors/ !\n#ProxyPass ^/dl !\n#LogLevel info proxy:debug\nProxyRequests Off\nProxyPass /.well-known !\nProxyPass / ajp://www.nbmlaw.co.uk:8010/\n#ErrorDocument 503 /errors/503.htm\nSSLEngine on\nSSLCertificateFile\n...keys removed\n</virtualhost>\n# END DOMAIN: nbmlaw.co.uk", "id": 197623, "time": "2017-03-13T15:11:27Z", "bug_id": 60850, "creation_time": "2017-03-13T15:11:27Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": null, "creator": "nbmlaw@gmail.com", "text": "was a configuration problem of sentora control panel https://github.com/sentora/sentora-core/issues/293 using wrong method to redirect to https", "id": 202667, "time": "2017-12-09T10:23:30Z", "bug_id": 60850, "creation_time": "2017-12-09T10:23:30Z", "tags": [], "is_private": false}]
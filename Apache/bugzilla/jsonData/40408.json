[{"count": 0, "attachment_id": null, "bug_id": 40408, "text": "We downloaded the source tar (httpd-2.2.3.tar.gz) and ran configure, make and\nmake install.\n\nWhile trying to start apache by \"apachectl -k start\", Apache 2.2.3 does not give\nany error messages while starting but it is not actually starting. We could not\nfind any clues in error_log as well (It is just 0 bytes).\n\nWe tried starting \"httpd\" with debugger (ladebug). In server/main.c, line 686,\nit just comes out after \n\nif (ap_run_pre_config(pconf, plog, ptemp) != OK) {\n    ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR,\n                  0, NULL, \"Pre-configuration failed\");\n              destroy_and_exit_process(process, 1);\n         }\n\nIt doesn't go inside the if condition (ap_log_error part). By stepping inside\nthe function ap_run_pre_config, it goes inside\n./srclib/apr/threadproc/unix/procsup.c and comes out of the exit 0 line of\n  if (daemonize) {\n            if ((x = fork()) > 0) {\n                exit(0);\n        }\n\nShould we try any more options?\n\nThanks\nLaxmi", "id": 92976, "time": "2006-09-04T10:53:57Z", "creator": "laxmiharikumar@yahoo.com", "creation_time": "2006-09-04T10:53:57Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 40408, "text": "Can you try starting up in single-process mode by passing the -X argument?  If\nthis fails silently can you run it under some ktrace-like tool to get a system\ncall trace?", "id": 92977, "time": "2006-09-04T11:07:16Z", "creator": "jorton@redhat.com", "creation_time": "2006-09-04T11:07:16Z", "tags": [], "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 40408, "text": "Hi Joe,\n\nI tried starting with \"httpd -X -k start\". Apache 2 is configured to run on port\n81. This is the error in error_log file now:\n\n(48)Address already in use: make_sock: could not bind to address 0.0.0.0:81\nno listening sockets available, shutting down\nUnable to open logs\n\nI tried changing the port to 83. Still the same error:\n(48)Address already in use: make_sock: could not bind to address 0.0.0.0:83\nno listening sockets available, shutting down\nUnable to open logs\n\nThanks,\nLaxmi", "id": 92979, "time": "2006-09-04T11:35:08Z", "creator": "laxmiharikumar@yahoo.com", "creation_time": "2006-09-04T11:35:08Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 40408, "text": "This problem is Tru64 specific. Here the make_sock function is being called\ntwice with IP address 0.0.0.0 and the second bind obviously fails.\n\nIn alloc_listener function of listen.c, the comparison:\n\n264 if (port == oldport &&\n265 ((!addr && !sa->hostname) ||\n266                   ((addr && sa->hostname) && !strcmp(sa->hostname, addr))\n\nis failing (when the function gets called the second time) because of which\nfound_listener is not set to 1 \n\nThis is failing because sa->hostname is being set to \"0.0.0.0\" in\napr_sockaddr_info_get (which in turn calls call_resolver() in sockaddr.c. This\nfunction has a #ifdef OSF1 where hostname is being set as 0.0.0.0 or ::\ndepending on IPv4 or IPv6).\n\nWe have tried a fix on the same issue for alloc_listener(). Posting it here.\n\nFile listen.c\n------------\n\n34,38c34\n< #if APR_HAVE_IPV6\n< static int default_family = APR_UNSPEC;\n< #else\n< static int default_family = APR_INET;\n< #endif\n---\n>\n248,272d243\n< static void find_default_family(apr_pool_t *p)\n< {\n< #if APR_HAVE_IPV6\n<     if (default_family == APR_UNSPEC) {\n<         apr_status_t sock_rv;\n<         apr_socket_t *tmp_sock;\n<         apr_sockaddr_t *sa;\n<\n<         if ((sock_rv = apr_socket_create(&tmp_sock, APR_INET6, SOCK_STREAM, 0,\n p))\n<             == APR_SUCCESS &&\n< apr_sockaddr_info_get(&sa, NULL, APR_INET6, 0, 0, p) == APR_SUCCESS\n< &&\n<             apr_socket_bind(tmp_sock, sa) == APR_SUCCESS) {\n<             default_family = APR_INET6;\n<         }\n<         else {\n<             default_family = APR_INET;\n<         }\n<         if (sock_rv == APR_SUCCESS) {\n<             apr_socket_close(tmp_sock);\n<         }\n<     }\n< #endif\n< }\n<\n280,299d250\n<\n< #ifdef OSF1\n<     if (!addr) { /* don't bind to specific interface */\n<         find_default_family(process->pool);\n<         switch(default_family) {\n<         case APR_INET:\n<             addr = \"0.0.0.0\";\n<             break;\n<\n< #if APR_HAVE_IPV6\n<         case APR_INET6:\n<             addr = \"::\";\n<             break;\n< #endif\n<\n<         default:\n<             ap_assert(1 != 1); /* should not occur */\n<         }\n<     }\n< #endif", "id": 93193, "time": "2006-09-08T09:04:57Z", "creator": "laxmiharikumar@yahoo.com", "creation_time": "2006-09-08T09:04:57Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 40408, "text": "[Fixing assignment - please don't change the bug assignment, all bugs need to\nremain assigned to the mailing list address.]\n\n", "id": 93195, "time": "2006-09-08T09:20:22Z", "creator": "jorton@redhat.com", "creation_time": "2006-09-08T09:20:22Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "creator": "jorton@redhat.com", "text": "The fix for this might be in APR.  Can you revert your changes and try a few\nthings from the vanilla 2.2.3 code?\n\n1) If you change the configuration to \"Listen 0.0.0.0:80\" does the server start\nup OK?\n\n2) With the default configuration of just \"Listen 80\", can you try the patch\nI'll attach against APR?", "id": 93197, "time": "2006-09-08T09:27:46Z", "bug_id": 40408, "creation_time": "2006-09-08T09:27:46Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "Created attachment 18841\npatch APR resolver bug on Tru64", "is_private": false, "id": 93198, "creator": "jorton@redhat.com", "time": "2006-09-08T09:28:21Z", "bug_id": 40408, "creation_time": "2006-09-08T09:28:21Z", "attachment_id": 18841}, {"count": 7, "tags": [], "bug_id": 40408, "text": "1. With the configuration changed to \"Listen 0.0.0.0:80\" the server starts.\n2. But with the patch and the default configuration of \"Listen 80\" it doesnt.", "id": 93212, "time": "2006-09-08T11:00:17Z", "creator": "laxmiharikumar@yahoo.com", "creation_time": "2006-09-08T11:00:17Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 61874, "text": "OperandResolver::parseDouble does not take into account the locale and instead always uses a decimal dot.\n\nIn Excel for example, this formula =TEXT(\"1234,68\"; \"#.##0,00\") shows the value \"1.234,68\" while POI returns \"#VALUE!\" because it cannot evaluate it.\nInternally, the (POI) TEXT function uses OperandResolver::parseDouble which can only convert numeric String using a dot as the decimal separator.\nExcel itself takes into account the locale, so it knows that my numbers use a decimal comma instead.\n\nThis inconsistent behaviour between Excel and POI is confusing and difficult.\nCan POI also take into account the locale when parsing numeric String values to Double values?\n\nhttps://stackoverflow.com/questions/47712773/how-to-get-poi-to-evaluate-and-format-a-cell-exactly-as-excel-does", "id": 202638, "time": "2017-12-08T14:56:38Z", "creator": "carl.salaets@gmail.com", "creation_time": "2017-12-08T14:56:38Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "What happens if you save a file with a formula like that, then open it on a machine in a dot-non-comma locale like EN-GB (UK) or EN-US? Does Excel still manage to process it properly? Or does the formula start failing?\n\n(I'm wondering if Excel is really using a Locale from the file, or is just fixing things based on the Locale at runtime. Knowing that helps us decide on the \"least surprising\" way to fix this in POI)", "attachment_id": null, "id": 202724, "creator": "apache@gagravarr.org", "time": "2017-12-11T19:17:35Z", "bug_id": 61874, "creation_time": "2017-12-11T19:17:35Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 61874, "attachment_id": null, "text": "After changing the locale, reopening the xlsx, recalculating the formula, the result changes. Excel always tries to give a result, which may be unexpected. Here is an overview:\n\n------------------------------------------------------------------\n\nLocale with (1,234.68)\n- Thousand Separator = ,\n- Decimal Separator  = .\n\n\t Value  \t Format \t =TEXT(Value;Format)\n\t\t\t\t\t Excel\t\t POI\n\t1234,68 \t#.##0,00 \t1234,68 \t#VALUE!\n\t1234,68 \t#,##0.00 \t1234,68 \t#VALUE!\n\t1234.68 \t#.##0,00 \t1234.68000 \t1234.68\n\t1234.68 \t#,##0.00 \t1,234.68 \t1,234.68\n\n------------------------------------------------------------------\n\nLocale with (1.234,68)\n- Thousand Separator = .\n- Decimal Separator  = ,\n\n\t Value  \t Format \t =TEXT(Value;Format)\n\t\t\t\t\t Excel\t\t POI\n\t1234,68 \t#.##0,00 \t1.234,68 \t#VALUE!\n\t1234,68 \t#,##0.00 \t1234,68000 \t#VALUE!\n\t1234.68 \t#.##0,00 \t1234.68 \t1234.68\n\t1234.68 \t#,##0.00 \t1234.68 \t1,234.68\n\n------------------------------------------------------------------", "id": 202751, "time": "2017-12-13T10:17:30Z", "creator": "carl.salaets@gmail.com", "creation_time": "2017-12-13T10:17:30Z", "is_private": false}]
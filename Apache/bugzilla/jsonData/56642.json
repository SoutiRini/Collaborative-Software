[{"count": 0, "tags": [], "creator": "takashi.asfbugzilla@tks.st", "text": "ap_mpm_register_socket_callback_timeout takes two callback funtions.\n\n * @param cbfn The callback function\n * @param tofn The callback function if the timeout expires\n\nCurrent event MPM calls tofn in the timeout even if cbfn have been called.\nUsing mod_proxy_wstunnel Async mode and timeout is set, this can cause SEGV because proxy_wstunnel_finish is called more than once for the same backend connetion.\n\nmod_proxy_wstunnel call ap_mpm_register_socket_callback_timeout with proxy_wstunnel_finish as tofn when ProxyWebsocketAsync is On and ProxyWebsocketIdleTimeout is set some number > 0.", "id": 175885, "time": "2014-06-19T04:47:19Z", "bug_id": 56642, "creation_time": "2014-06-19T04:47:19Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 56642, "attachment_id": 31729, "text": "Created attachment 31729\nerror log", "id": 175886, "time": "2014-06-19T04:49:33Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2014-06-19T04:49:33Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 56642, "attachment_id": null, "id": 175887, "time": "2014-06-19T04:53:19Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2014-06-19T04:53:19Z", "is_private": false, "text": "The attached error log says proxy_wstunnel_cancel_callback is called three times though only one connetion is established to my websocket backend.\n\n[Thu Jun 19 03:19:41.483461 2014] [proxy_wstunnel:trace1] [pid 16551:tid 3045055344] mod_proxy_wstunnel.c(157): [remote 172.104.38.219:58759] proxy_wstunnel_cancel_callback, IO timed out\n[Thu Jun 19 03:19:41.483537 2014] [proxy_wstunnel:trace1] [pid 16551:tid 3034565488] mod_proxy_wstunnel.c(157): [remote 172.104.38.219:58759] proxy_wstunnel_cancel_callback, IO timed out\n[cut]\n[Thu Jun 19 03:19:41.483737 2014] [proxy_wstunnel:trace1] [pid 16551:tid 3055545200] mod_proxy_wstunnel.c(157): [remote 172.104.38.219:58759] proxy_wstunnel_cancel_callback, IO timed out"}, {"count": 3, "tags": [], "bug_id": 56642, "attachment_id": 31732, "text": "Created attachment 31732\npatch to fix\n\nI think this patch fixes this issue.\nIf the timeout callback is cancelled, the listener thread shouldn't push it to worker.", "id": 175895, "time": "2014-06-19T11:02:59Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2014-06-19T11:02:59Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 56642, "attachment_id": null, "text": "(In reply to Takashi Sato from comment #3)\n> Created attachment 31732 [details]\n> patch to fix\n> \n> I think this patch fixes this issue.\n> If the timeout callback is cancelled, the listener thread shouldn't push it\n> to worker.\n\nlooks good here", "id": 175896, "time": "2014-06-19T11:13:08Z", "creator": "covener@gmail.com", "creation_time": "2014-06-19T11:13:08Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 56642, "text": "Fixed as r1604347", "id": 175957, "time": "2014-06-21T12:59:11Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2014-06-21T12:59:11Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "ylavic.dev@gmail.com", "text": "Follow up in r1604451 to avoid a timer event leak.", "id": 175964, "time": "2014-06-21T20:09:16Z", "bug_id": 56642, "creation_time": "2014-06-21T20:09:16Z", "tags": [], "is_private": false}]
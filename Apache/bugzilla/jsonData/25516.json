[{"count": 0, "tags": [], "creator": "pitrou@free.fr", "text": "mod_cache doesn't cache local URIs that specify no content length. This is\nannoying for dynamically generated content, where you hardly know in advance how\nmuch bytes you are going to output. This is evidenced by a simple PHP script :\n\n$ cat cache_arton.php\n<?php\n \nheader(\"Last-Modified: Tue, 25 Nov 2003 16:58:44 GMT\");\n//header(\"Content-Length: 15084\");\nheader(\"Content-Type: image/jpeg\");\n \nreadfile(\"spip-current/IMG/arton1754.jpg\");\n \n?>\n\n\nWithout Content-Length, it isn't cached and doesn't appear in /var/cache/http :\n$ curl -I http://127.0.0.1/cache_arton.php\nHTTP/1.1 200 OK\nDate: Sun, 14 Dec 2003 23:13:47 GMT\nServer: Apache-AdvancedExtranetServer/2.0.48 (Mandrake Linux/2mdk) PHP/4.3.4\nX-Powered-By: PHP/4.3.4\nLast-Modified: Tue, 25 Nov 2003 16:58:44 GMT\nContent-Type: image/jpeg\n \n\nIf I uncomment the Content-Length header, it gets cached (and appears in\n/var/cache/http):\n$ curl -I http://127.0.0.1/cache_arton.php\nHTTP/1.1 200 OK\nDate: Sun, 14 Dec 2003 23:11:32 GMT\nServer: Apache-AdvancedExtranetServer/2.0.48 (Mandrake Linux/2mdk) PHP/4.3.4\nX-Powered-By: PHP/4.3.4\nLast-Modified: Tue, 25 Nov 2003 16:58:44 GMT\nContent-Length: 15084\nContent-Type: text/plain\nAge: 10\n\n\nThe question is : how to do when I simply can't know in advance how many bytes\nmy PHP script will return ? I do set both Expires and Last-Modified headers, but\nit's not enough. Browsers do cache the content on the client side, but on the\nserver side mod_cache doesn't ;(", "id": 49110, "time": "2003-12-14T23:29:07Z", "bug_id": 25516, "creation_time": "2003-12-14T23:29:07Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "This should be fixed with the latest round of mod_cache fixes included in 2.0.52.\n\nMarking as FIXED.  If it works, please change to RESOLVED.\n\nThanks!", "attachment_id": null, "bug_id": 25516, "id": 66888, "time": "2004-11-15T00:28:40Z", "creator": "jerenkrantz@apache.org", "creation_time": "2004-11-15T00:28:40Z", "is_private": false}, {"count": 2, "tags": [], "text": "The problem is not fixed.\n\nwith Apache/2.2.0 (Unix) PHP/4.4.2, the mod_disk_cache does not cache the dynamic\ncontent generated from the .php file. I say this because .php generated content is\nnot in cacheroot, while static content is there.\n\nI assume the problem is there with mod_mem_cache but I can see the files in\nmemory to be sure.\n\nTherefore I reopen the bug.", "attachment_id": null, "id": 88330, "creator": "mwang@unixlabplus.com", "time": "2006-04-20T19:54:49Z", "bug_id": 25516, "creation_time": "2006-04-20T19:54:49Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 25516, "attachment_id": null, "id": 88337, "time": "2006-04-20T22:04:53Z", "creator": "rpluem@apache.org", "creation_time": "2006-04-20T22:04:53Z", "is_private": false, "text": "Actually httpd caches content which does not have content-length set. Please\npost your cache configuration and the headers of a request to your uncached php\nfile."}, {"count": 4, "tags": [], "creator": "mwang@unixlabplus.com", "text": "(In reply to comment #3)\n> Actually httpd caches content which does not have content-length set. Please\n> post your cache configuration and the headers of a request to your uncached php\n> file.\n\nSorry for replying late. I did not receive email to alert me the update \non this report. Here is the information you needed:\n\n(1) cache configuration:\n\n<IfModule mod_cache.c>\n  <IfModule mod_disk_cache.c>\n    CacheRoot /tmp/cacheroot\n    CacheEnable disk /\n    CacheDirLevels 5\n    CacheDirLength 3\n    CacheMinFileSize 0\n  </IfModule>\n</IfModule>\n\n(2) headers:\n\n# curl -I http://web.unixlabplus.com:1221/a.php\nHTTP/1.1 200 OK\nDate: Mon, 01 May 2006 20:47:09 GMT\nServer: Apache/2.2.0 (Unix) PHP/4.4.2\nX-Powered-By: PHP/4.4.2\nContent-Type: text/html\n\n(3) a.php:\n\n# cat /usr/local/apache/htdocs/a.php           \n<?php\n\nphpinfo();\n\n?>\n\nI could not find entry in /tmp/cacheroot for \"a.php\" while I found entries\nfor static files.", "id": 88706, "time": "2006-05-01T20:57:09Z", "bug_id": 25516, "creation_time": "2006-05-01T20:57:09Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "Your response does not contain a Last Modified Date. These responses are not\ncached by default. In order to cache them, you need to add\n\nCacheIgnoreNoLastMod On\n\nto your configuration. See\nhttp://httpd.apache.org/docs/2.2/mod/mod_cache.html#cacheignorenolastmod", "attachment_id": null, "bug_id": 25516, "id": 88731, "time": "2006-05-02T19:59:07Z", "creator": "rpluem@apache.org", "creation_time": "2006-05-02T19:59:07Z", "is_private": false}]
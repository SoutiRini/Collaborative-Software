[{"count": 0, "tags": [], "bug_id": 55075, "attachment_id": 30405, "is_private": false, "id": 167717, "time": "2013-06-07T15:13:05Z", "creator": "fploessel@beyond-data.de", "creation_time": "2013-06-07T15:13:05Z", "text": "Created attachment 30405\npatch fixing the problem (see description and comments in the code in the files)\n\npicture.resize() skews pictures in SXSSF if the picture is in a row having non-default height. As we set the row height so that the picture fits into one row in our code, this results in pictures scaled sometimes by a factor 2 or 3 in height, but having their correct width, looking very ugly.\n\nThe reason is that the XSSF code to which the SXSSF code delegates the size calculation checks the rows in the XSSF sheet for their height, and - as all rows are in the SXSSF sheet - does not find any rows and assumes the default row height.\n\nI have attached a fix for the problem that works fine with POI 3.9. This contains two new SXSSF classes which in the current 3.9 code do not exist, as their role is taken by the XSSF classes, and a one line change of SXSSFSheet:\nmethod createDrawingPatriarch() in line 1195 should return the new SXSSFDrawing instead of an XSSFDrawing.\n\nI would assume that in addition to Picture, Comment and Chart may have similar issues, but as we do not need them, I did not check that.\n\nOf course, as always with SXSSF, if the row is already flushed out, there will be problems."}, {"count": 1, "tags": [], "text": "Are you able to write a junit test that shows the problem, and confirms it's fixed with the patch? Perhaps something that uses SXSSF to write a file, then loads it via XSSF and checks to see if the picture is the right size or not?", "attachment_id": null, "id": 167718, "creator": "apache@gagravarr.org", "time": "2013-06-07T15:20:35Z", "bug_id": 55075, "creation_time": "2013-06-07T15:20:35Z", "is_private": false}, {"count": 2, "tags": [], "text": "Would the test cases in issue 51233 be ok as test case, or would you need a more detailed one? I just discovered this seems to be a duplicate.", "attachment_id": null, "id": 167721, "creator": "fploessel@beyond-data.de", "time": "2013-06-07T15:50:13Z", "bug_id": 55075, "creation_time": "2013-06-07T15:50:13Z", "is_private": false}, {"count": 3, "tags": [], "text": "I tried to review and apply this patch, but unfortunately it is provided as full changed files instead of a diff which makes it hard to apply after other chnages were done to the source. Also there are some new methods in class Picture which break the changes. \n\nCan you redo your changes on top of a more recent version, at least 3.12-beta1 or even better trunk and provide a real patch that can be applied?", "attachment_id": null, "id": 182024, "creator": "dominik.stadler@gmx.at", "time": "2015-03-23T21:16:15Z", "bug_id": 55075, "creation_time": "2015-03-23T21:16:15Z", "is_private": false}, {"count": 4, "tags": [], "creator": "dominik.stadler@gmx.at", "is_private": false, "text": "And yes, I also think this is the same as 51233 and thus the unit test from there should suffice for now.", "id": 182025, "time": "2015-03-23T21:17:17Z", "bug_id": 55075, "creation_time": "2015-03-23T21:17:17Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Created attachment 34345\nSXSSF pictures and drawings\n\nattachment 30405 was based on r1384784, with only 1 line changed:\n\n--- src/ooxml/java/org/apache/poi/xssf/streaming/SXSSFSheet.java\t(revision 1763945)\n+++ src/ooxml/java/org/apache/poi/xssf/streaming/SXSSFSheet.java\t(working copy)\n@@ -1704,7 +1704,7 @@\n     @Override\n     public Drawing createDrawingPatriarch()\n     {\n-        return _sh.createDrawingPatriarch();\n+        return new SXSSFDrawing((SXSSFWorkbook)getWorkbook(), _sh.createDrawingPatriarch());\n     }\n\nI have rebased the patch to the trunk.", "attachment_id": 34345, "id": 194262, "creator": "onealj@apache.org", "time": "2016-10-09T07:16:06Z", "bug_id": 55075, "creation_time": "2016-10-09T07:16:06Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 55075, "attachment_id": null, "id": 194266, "time": "2016-10-09T08:52:59Z", "creator": "onealj@apache.org", "creation_time": "2016-10-09T08:52:59Z", "is_private": false, "text": "*** Bug 51233 has been marked as a duplicate of this bug. ***"}, {"count": 7, "tags": [], "text": "Thanks to Frank Pl\u00f6\u00dfel for writing the SXSSFPicture and SXSSFDrawing classes that wrap the XSSF version. These changes, along with unit tests, have been committed in 1763950 and r1763951.", "attachment_id": null, "id": 194267, "creator": "onealj@apache.org", "time": "2016-10-09T10:14:20Z", "bug_id": 55075, "creation_time": "2016-10-09T10:14:20Z", "is_private": false}]
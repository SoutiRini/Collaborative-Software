[{"count": 0, "tags": [], "creator": "sca@arubanetworks.com", "attachment_id": null, "text": "mod_jk-1.2.15, httpd-2.0.52 with RH ES4 patches applied running on RH ES4 \nupdate 3.\n\nI haven't figured out what the root cause of this is:\n  jk_log_lock doesn't appear to get initialized, so both the lock and the\n  unlock fail with EINVAL (presumably coming from pthread_mutex_{lock,unlock}\n()).\n  The unlock error case calls ap_log_rerror() with a NULL request pointer, but\n  this routine dereferences the pointer immediately to pick up the server\n  information, causing a core dump.  I changed it to ap_log_error() and that\n  fixes the crash.\n\n  I still don't know why the mutex is not initialized; I can only assume that\n  the post config hook is not being called or is failing for some reason.\n\nLet me know if any further information is needed.", "id": 90666, "time": "2006-06-27T18:25:19Z", "bug_id": 39914, "creation_time": "2006-06-27T18:25:19Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 39914, "attachment_id": null, "id": 90674, "time": "2006-06-27T19:58:40Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-06-27T19:58:40Z", "is_private": false, "text": "Generally this works.\n\nI assume you are using the worker MPM and a 32Bit Linux?\n\nIf the lock could not be initialized correctly, we would expect at least one of\nthe following messages with levels:\n\nmod_jk: could not init JK log lock in child (ERROR)\nmod_jk: could not create jk_log_lock (CRITICAL)\nmod_jk: Could not set permissions on jk_log_lock; check User and Group\ndirectives (CRITICAL)\n\nAny of these in you mod_jk-Log?\n\nJust to make sure, could you also give the exact messages from the failed\nlock/unlock.\n\nConcerning ap_log_rerror: you are right, I will correct to ap_log_error for the\nupcoming 1.2.16.\n\nAs always: any chance to test with 2.0.58 and Subversion HEAD of mod_jk?\n\nFinally: Could you provide the following things form inside your Apache home:\n\nbin/httpd -V\ninclude/apr.h\ninclude/apr.h\n"}, {"count": 2, "tags": [], "creator": "sca@arubanetworks.com", "attachment_id": 18541, "text": "Created attachment 18541\napr.h", "id": 90675, "time": "2006-06-27T20:31:10Z", "bug_id": 39914, "creation_time": "2006-06-27T20:31:10Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 39914, "attachment_id": null, "id": 90677, "time": "2006-06-27T20:48:15Z", "creator": "sca@arubanetworks.com", "creation_time": "2006-06-27T20:48:15Z", "is_private": false, "text": "What I have realized now is that these messages are only coming out in between\n   \"graceful restart requested, doing restart\" \nand\n   \"Apache configured -- resuming normal operations\"\nand only if a request is in progress during the graceful restart.  A normal\n'apachectl graceful' does not produce this.\n\nMy ignorance of APR is vast since I only got sucked into this yesterday,\nbut since jk_log_lock is a global mutex, perhaps it is being cleaned up\nduring the restart by global_mutex_cleanup()?\n\nI do not see any of the errors you list in the log.\n[Tue Jun 27 13:19:41 2006] [notice] Graceful restart requested, doing restart\n[Tue Jun 27 13:19:41 2006] [error] (22)Invalid argument:\napr_global_mutex_lock(jk_log_lock) failed\n[Tue Jun 27 13:19:41 2006] [error] (22)Invalid argument:\napr_global_mutex_lock(jk_log_lock) failed\n[Tue Jun 27 13:19:41 2006] [error] (22)Invalid argument:\napr_global_mutex_lock(jk_log_lock) failed\n[Tue Jun 27 13:19:41 2006] [error] (22)Invalid argument:\napr_global_mutex_lock(jk_log_lock) failed\n[Tue Jun 27 13:19:41 2006] [error] (22)Invalid argument:\napr_global_mutex_lock(jk_log_lock) failed\n...\n...\n[Tue Jun 27 13:19:42 2006] [notice] Apache configured -- resuming normal operations\n\n############ httpd -V ############\n[root@zm9 logs]# /usr/sbin/httpd -V\nServer version: Apache/2.0.52\nServer built:   Dec 15 2005 04:09:14\nServer's Module Magic Number: 20020903:9\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/prefork\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/etc/httpd\"\n -D SUEXEC_BIN=\"/usr/sbin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_LOCKFILE=\"logs/accept.lock\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\n\napr.h added as an attachment."}, {"count": 4, "tags": [], "bug_id": 39914, "attachment_id": null, "id": 90678, "time": "2006-06-27T20:56:03Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-06-27T20:56:03Z", "is_private": false, "text": "If the problem is only occuring during graceful restart it's most likely BZ\n39834. I noticed a mutex error when reproducing 39834 to. Should be fixed by\nMladen in Subversion HEAD and in the soon to come 1.2.16. \n\n*** This bug has been marked as a duplicate of 39834 ***"}, {"count": 5, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "Move a couple of fixed JK issues from resolved to closed.", "id": 112415, "time": "2008-01-01T17:03:43Z", "bug_id": 39914, "creation_time": "2008-01-01T17:03:43Z", "is_private": false}]
[{"count": 0, "attachment_id": null, "bug_id": 51498, "is_private": false, "id": 147873, "time": "2011-07-11T19:04:42Z", "creator": "captainwucher@gmx.de", "creation_time": "2011-07-11T19:04:42Z", "tags": [], "text": "In org.apache.poi.ss.formula.functions.Countif, method \npublic boolean evaluate(int cmpResult) (LINE 127)\n\nThe retunvalue for GE is wrong, it is the same like LE.\n\nswitch (_code) {\t\t\t\n  ...\n  case LE: return cmpResult <= 0;\n  ...\n  case GE: return cmpResult <= 0; (LINE 136)\n}\n\nwrong:  case GE: return cmpResult <= 0\nright:  case GE: return cmpResult >= 0"}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "text": "Could you suggest a couple of simple formulas we could use for a unit test for this? Ideally say 4 formulas, some of which pass currently and at least one that fails until the patch is applied", "id": 147884, "time": "2011-07-12T11:17:23Z", "bug_id": 51498, "creation_time": "2011-07-12T11:17:23Z", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 28288\nJUnit test case", "is_private": false, "id": 153595, "creator": "maciej.szatkowski@gmail.com", "time": "2012-02-08T15:16:27Z", "bug_id": 51498, "creation_time": "2012-02-08T15:16:27Z", "attachment_id": 28288}, {"count": 3, "tags": [], "bug_id": 51498, "is_private": false, "text": "Created attachment 28289\nTest workbook for JUnit test case", "id": 153596, "time": "2012-02-08T15:17:31Z", "creator": "maciej.szatkowski@gmail.com", "creation_time": "2012-02-08T15:17:31Z", "attachment_id": 28289}, {"count": 4, "tags": [], "bug_id": 51498, "is_private": false, "text": "Nick,\njust stacked up on same bug.\n\nPlease find attached requested test case and test work book.\nIt reveals another bug with \"<>\" NE operator - Excel counts blank values in range as not equal to any value, so formula \"<>5\" applied to values [\"\", \"\", \"5\"] should return 2, not 0 as current implementation does.\n\nRegards,\nMaciej.", "id": 153597, "time": "2012-02-08T15:22:18Z", "creator": "maciej.szatkowski@gmail.com", "creation_time": "2012-02-08T15:22:18Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 51498, "is_private": false, "text": "Nick,\njust stacked up on same bug. It is reported to be solved with https://issues.apache.org/bugzilla/show_bug.cgi?id=51809\n\nPlease find attached requested test case and test work book.\nIt reveals another bug with \"<>\" NE operator - Excel counts blank values in range as not equal to any value, so formula \"<>5\" applied to values [\"\", \"\", \"5\"] should return 2, not 0 as current implementation does.\n\nRegards,\nMaciej.", "id": 153599, "time": "2012-02-08T15:23:21Z", "creator": "maciej.szatkowski@gmail.com", "creation_time": "2012-02-08T15:23:21Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "apache@gagravarr.org", "text": "Are you sure that's the correct workbook? Only it doesn't seem to have any countif formulas in it...", "id": 153601, "time": "2012-02-08T15:47:55Z", "bug_id": 51498, "creation_time": "2012-02-08T15:47:55Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 51498, "text": "Created attachment 28290\nCorrect test workbook for JUnit test cases\n\nI put wrong file by mistake. Thanks for checking this.", "id": 153604, "time": "2012-02-08T17:06:41Z", "creator": "maciej.szatkowski@gmail.com", "creation_time": "2012-02-08T17:06:41Z", "is_private": false, "attachment_id": 28290}, {"id": 153605, "tags": [], "bug_id": 51498, "is_private": false, "count": 8, "text": "OpenOffice seems to be coming up with different answers to excel on countif for empty cells - it agrees with POI on the lower value (eg 29 rather than 34 for D4 in your example spreadsheet)", "time": "2012-02-08T17:21:59Z", "creator": "apache@gagravarr.org", "creation_time": "2012-02-08T17:21:59Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 51498, "text": "Unit test added in r1241993, though skipping the one row that Excel, POI and OpenOffice disagree on. Need to figure out exactly why and what the correct answer is, then fix/report bugs as appropriate", "id": 153606, "time": "2012-02-08T17:23:37Z", "creator": "apache@gagravarr.org", "creation_time": "2012-02-08T17:23:37Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 51498, "is_private": false, "text": "Created attachment 28294\nproposed patch\n\nI fugured out how to fix it. The condition \"<>5\" instantiates Countif.NumberMatcher and it didn't handle blank values. See the proposed patch. \n\nMy fix works only for conditions with numbers. Maciej, would you like to check how Countif works for booleans and strings: the conditions \"<>TRUE\" and \"<>'ABC'\" should agree with Excel too.\n  \nYegor", "id": 153632, "time": "2012-02-09T18:59:31Z", "creator": "yegor@dinom.ru", "creation_time": "2012-02-09T18:59:31Z", "attachment_id": 28294}, {"count": 11, "tags": [], "bug_id": 51498, "text": "Should be fixed in r1243054\n\nThe fix applies to number, boolean and string predicates - they all had troubles with evaluating blank cells: \"<>5\", \"<>\"ABC\"\", \"<>FALSE\" returned wrong result if the range contained blank cells. \n\nAnother problem cropped up with evaluating string predicates: it appears that string criteria in COUNTIF are case insensitive; for example, the string \"apples\" and the string \"APPLES\" will match the same cells. This is also true for pattern matching: \"ABC*\" and \"abc*\" match the same cells. Before r1243054 POI did everything in the case-sensitive mode which didn't agree with Excel. \n\nYegor", "id": 153682, "time": "2012-02-11T13:23:44Z", "creator": "yegor@dinom.ru", "creation_time": "2012-02-11T13:23:44Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "attachment_id": null, "bug_id": 51880, "text": "Hi,\n\nIf I try to stop a running test using \"Shutdown\", it never stops (even if\nthread count is reduced till 0) and the windows stays open. I have to close\nit and call stop to have the top left green box back to gray. Can someone\nconfirm this?\nJMeter 2.5.1 r1174406, win xp sp3 32bits, jdk 1.6.\n\nRegards,\n\nStef\n\nOne update:\nThe shutdown command is not working if I invoke it before all the thread are\nstarted.\neg. If I start 20 thread and call it before the 20 are started, it fails. If\nI call it once the 20 thread are started, it works.\nThe 'Stop' command works in both cases.\n\nRegards,\n\nStef", "id": 149683, "time": "2011-09-23T10:14:13Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-09-23T10:14:13Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 27575\nFix to the issue\n\nHello,\nI reproduce your issue (not sure it's a new one).\nIn fact shutdown will succeed but only after initial rampup will have occured.\n\nIn current implementation, only stop was called without interruption of thread, so sleeping threads would be still blocked in sleep:\n\"Thread Group 1-23\" prio=6 tid=101de3000 nid=0x125416000 waiting on condition [125415000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat org.apache.jmeter.threads.JMeterThread.rampUpDelay(JMeterThread.java:750)\n\tat org.apache.jmeter.threads.JMeterThread.initRun(JMeterThread.java:491)\n\tat org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:245)\n\tat java.lang.Thread.run(Thread.java:680)\n\n\nSo my fix calls interrupt on Thread to give a chance to sleep to exit.\nRegards\nPhilippe Mouawad", "attachment_id": 27575, "bug_id": 51880, "id": 149684, "time": "2011-09-23T10:18:06Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-09-23T10:18:06Z", "is_private": false}, {"count": 2, "tags": [], "creator": "sebb@apache.org", "text": "Thanks.\n\nThe patch may well work, but the point of Shutdown is to do so gracefully; i.e. allow threads to complete what they are doing. Generating an interrupt will cause problems for threads that have started.\n\nI'll look into this further.", "id": 149685, "time": "2011-09-23T10:34:18Z", "bug_id": 51880, "creation_time": "2011-09-23T10:34:18Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "sebb@apache.org", "text": "This was a side-effect of the fix for Bug 51839.\n\nURL: http://svn.apache.org/viewvc?rev=1174675&view=rev\nLog:\nBug 51880 - The shutdown command is not working if I invoke it before all the thread are started.\n\nModified:\n   jakarta/jmeter/trunk/bin/jmeter.properties\n   jakarta/jmeter/trunk/src/core/org/apache/jmeter/threads/JMeterThread.java\n   jakarta/jmeter/trunk/xdocs/changes.xml", "id": 149686, "time": "2011-09-23T11:52:15Z", "bug_id": 51880, "creation_time": "2011-09-23T11:52:15Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "stephane.hoblingre@gmail.com", "text": "Created attachment 27601\nsample of shutdown problem with DummySample from jp@gc\n\nNeed to add JMeterPlugins.jar from http://code.google.com/p/jmeter-plugins/downloads/detail?name=JMeterPlugins-0.4.2.zip to lib/ext to open and run jmx.", "id": 149790, "time": "2011-09-27T04:36:53Z", "bug_id": 51880, "creation_time": "2011-09-27T04:36:53Z", "is_private": false, "attachment_id": 27601}, {"count": 5, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 149795, "time": "2011-09-27T07:14:28Z", "bug_id": 51880, "creation_time": "2011-09-27T07:14:28Z", "is_private": false, "text": "Hello,\nI added JMeterPlugins.jar to lib/ext and tried to load your plan I got:\n2011/09/27 09:12:32 ERROR - jmeter.save.SaveService: Conversion error com.thoughtworks.xstream.converters.ConversionException: kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup\n---- Debugging information ----\nmessage             : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup\ncause-exception     : com.thoughtworks.xstream.mapper.CannotResolveClassException\ncause-message       : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup\nclass               : org.apache.jorphan.collections.ListedHashTree\nrequired-type       : org.apache.jorphan.collections.ListedHashTree\npath                : /jmeterTestPlan/hashTree/hashTree/kg.apc.jmeter.threads.SteppingThreadGroup\nline number         : 14\n------------------------------- : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup\n---- Debugging information ----\nmessage             : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup\ncause-exception     : com.thoughtworks.xstream.mapper.CannotResolveClassException\ncause-message       : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup\nclass               : org.apache.jorphan.collections.ListedHashTree\nrequired-type       : org.apache.jorphan.collections.ListedHashTree\npath                : /jmeterTestPlan/hashTree/hashTree/kg.apc.jmeter.threads.SteppingThreadGroup\nline number         : 14\n-------------------------------\nmessage             : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup\n---- Debugging information ----\nmessage             : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup\ncause-exception     : com.thoughtworks.xstream.mapper.CannotResolveClassException\ncause-message       : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup\nclass               : org.apache.jorphan.collections.ListedHashTree\nrequired-type       : org.apache.jorphan.collections.ListedHashTree\npath                : /jmeterTestPlan/hashTree/hashTree/kg.apc.jmeter.threads.SteppingThreadGroup\nline number         : 14\n-------------------------------\ncause-exception     : com.thoughtworks.xstream.converters.ConversionException\ncause-message       : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup : kg.apc.jmeter.threads.SteppingThreadGroup\nfirst-jmeter-class  : org.apache.jmeter.save.converters.HashTreeConverter.unmarshal(HashTreeConverter.java:69)\nclass               : org.apache.jmeter.save.ScriptWrapper\nrequired-type       : org.apache.jorphan.collections.ListedHashTree\npath                : /jmeterTestPlan/hashTree/hashTree/kg.apc.jmeter.threads.SteppingThreadGroup\nline number         : 14\n------------------------------- \n2011/09/27 09:12:32 WARN  - jmeter.gui.action.Load: Unexpected error java.lang.Exception: Error in TestPlan - see log file\n\tat org.apache.jmeter.gui.action.Load.insertLoadedTree(Load.java:155)\n\tat org.apache.jmeter.gui.action.Load.loadProjectFile(Load.java:110)\n\tat org.apache.jmeter.gui.action.Load.doAction(Load.java:89)\n\tat org.apache.jmeter.gui.action.ActionRouter.performAction(ActionRouter.java:82)\n\tat org.apache.jmeter.gui.action.ActionRouter.access$0(ActionRouter.java:67)\n\tat org.apache.jmeter.gui.action.ActionRouter$1.run(ActionRouter.java:61)\n\tat java.awt.event.InvocationEvent.dispatch(InvocationEvent.java:209)\n\tat java.awt.EventQueue.dispatchEventImpl(EventQueue.java:677)\n\tat java.awt.EventQueue.access$000(EventQueue.java:85)\n\tat java.awt.EventQueue$1.run(EventQueue.java:638)\n\tat java.awt.EventQueue$1.run(EventQueue.java:636)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.security.AccessControlContext$1.doIntersectionPrivilege(AccessControlContext.java:87)\n\tat java.awt.EventQueue.dispatchEvent(EventQueue.java:647)\n\tat java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:296)\n\tat java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:211)\n\tat java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:201)\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:196)\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:188)\n\tat java.awt.EventDispatchThread.run(EventDispatchThread.java:122)\n\n\nRegards\nPhilippe Mouawad"}, {"count": 6, "tags": [], "text": "(In reply to comment #5)\n> Hello,\n> I added JMeterPlugins.jar to lib/ext and tried to load your plan I got:\n> 2011/09/27 09:12:32 ERROR - jmeter.save.SaveService: Conversion error\n> com.thoughtworks.xstream.converters.ConversionException:\n> kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup\n> ---- Debugging information ----\n> message             : kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup\n> cause-exception     :\n> com.thoughtworks.xstream.mapper.CannotResolveClassException\n> cause-message       : kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup\n> class               : org.apache.jorphan.collections.ListedHashTree\n> required-type       : org.apache.jorphan.collections.ListedHashTree\n> path                :\n> /jmeterTestPlan/hashTree/hashTree/kg.apc.jmeter.threads.SteppingThreadGroup\n> line number         : 14\n> ------------------------------- : kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup\n> ---- Debugging information ----\n> message             : kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup\n> cause-exception     :\n> com.thoughtworks.xstream.mapper.CannotResolveClassException\n> cause-message       : kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup\n> class               : org.apache.jorphan.collections.ListedHashTree\n> required-type       : org.apache.jorphan.collections.ListedHashTree\n> path                :\n> /jmeterTestPlan/hashTree/hashTree/kg.apc.jmeter.threads.SteppingThreadGroup\n> line number         : 14\n> -------------------------------\n> message             : kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup\n> ---- Debugging information ----\n> message             : kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup\n> cause-exception     :\n> com.thoughtworks.xstream.mapper.CannotResolveClassException\n> cause-message       : kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup\n> class               : org.apache.jorphan.collections.ListedHashTree\n> required-type       : org.apache.jorphan.collections.ListedHashTree\n> path                :\n> /jmeterTestPlan/hashTree/hashTree/kg.apc.jmeter.threads.SteppingThreadGroup\n> line number         : 14\n> -------------------------------\n> cause-exception     : com.thoughtworks.xstream.converters.ConversionException\n> cause-message       : kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup :\n> kg.apc.jmeter.threads.SteppingThreadGroup\n> first-jmeter-class  :\n> org.apache.jmeter.save.converters.HashTreeConverter.unmarshal(HashTreeConverter.java:69)\n> class               : org.apache.jmeter.save.ScriptWrapper\n> required-type       : org.apache.jorphan.collections.ListedHashTree\n> path                :\n> /jmeterTestPlan/hashTree/hashTree/kg.apc.jmeter.threads.SteppingThreadGroup\n> line number         : 14\n> ------------------------------- \n> 2011/09/27 09:12:32 WARN  - jmeter.gui.action.Load: Unexpected error\n> java.lang.Exception: Error in TestPlan - see log file\n>     at org.apache.jmeter.gui.action.Load.insertLoadedTree(Load.java:155)\n>     at org.apache.jmeter.gui.action.Load.loadProjectFile(Load.java:110)\n>     at org.apache.jmeter.gui.action.Load.doAction(Load.java:89)\n>     at\n> org.apache.jmeter.gui.action.ActionRouter.performAction(ActionRouter.java:82)\n>     at org.apache.jmeter.gui.action.ActionRouter.access$0(ActionRouter.java:67)\n>     at org.apache.jmeter.gui.action.ActionRouter$1.run(ActionRouter.java:61)\n>     at java.awt.event.InvocationEvent.dispatch(InvocationEvent.java:209)\n>     at java.awt.EventQueue.dispatchEventImpl(EventQueue.java:677)\n>     at java.awt.EventQueue.access$000(EventQueue.java:85)\n>     at java.awt.EventQueue$1.run(EventQueue.java:638)\n>     at java.awt.EventQueue$1.run(EventQueue.java:636)\n>     at java.security.AccessController.doPrivileged(Native Method)\n>     at\n> java.security.AccessControlContext$1.doIntersectionPrivilege(AccessControlContext.java:87)\n>     at java.awt.EventQueue.dispatchEvent(EventQueue.java:647)\n>     at\n> java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:296)\n>     at\n> java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:211)\n>     at\n> java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:201)\n>     at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:196)\n>     at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:188)\n>     at java.awt.EventDispatchThread.run(EventDispatchThread.java:122)\n> \n> \n> Regards\n> Philippe Mouawad\n\nForget about this, will take a cup of coffee to wakeup :-)", "attachment_id": null, "bug_id": 51880, "id": 149796, "time": "2011-09-27T07:15:56Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-09-27T07:15:56Z", "is_private": false}, {"count": 7, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": 27603, "id": 149797, "time": "2011-09-27T07:32:52Z", "bug_id": 51880, "creation_time": "2011-09-27T07:32:52Z", "is_private": false, "text": "Created attachment 27603\nFix to startScheduler\n\nI reproduced bug.\nApplied same fix method as Sebb did on rampUpDelay.\n\nThank you for your report.\nIf you have time to test patch would be nice.\nRegards\nPhilippe Mouawad"}, {"count": 8, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "id": 149804, "time": "2011-09-27T09:00:20Z", "bug_id": 51880, "creation_time": "2011-09-27T09:00:20Z", "is_private": false, "text": "(In reply to comment #7)\n> Created attachment 27603 [details]\n> Fix to startScheduler\n> \n> I reproduced bug.\n\nWith which build of JMeter?\n\n> Applied same fix method as Sebb did on rampUpDelay.\n\nThat fix has already been applied, and is in builds from r1174675 - see comment 3\n\n> Thank you for your report.\n> If you have time to test patch would be nice.\n\nPlease test against latest JMeter code - r1176077 is latest at present."}, {"count": 9, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "(In reply to comment #8)\n> (In reply to comment #7)\n> > Created attachment 27603 [details]\n> > Fix to startScheduler\n> > \n> > I reproduced bug.\n> \n> With which build of JMeter?\n> \n> > Applied same fix method as Sebb did on rampUpDelay.\n> \n> That fix has already been applied, and is in builds from r1174675 - see comment\n> 3\n> \n> > Thank you for your report.\n> > If you have time to test patch would be nice.\n> \n> Please test against latest JMeter code - r1176077 is latest at present.\n\nHello Sebb,\nI tested issue on last trunk revision.\nNo the fix has not been applied, you applied it on rampUpDelay method, here issue occurs on startScheduler, the patch I provided follows the fix you applied on rampUpDelay().\n\nRegards\nPhilippe", "id": 149808, "time": "2011-09-27T09:08:11Z", "bug_id": 51880, "creation_time": "2011-09-27T09:08:11Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Created attachment 27607\nFix to startScheduler issue with last rev\n\nHello Sebb,\nOk I understood why you were saying I didn't test on last rev.\n\nI retested before applying attached patch, Shutdown doesn't end until startime does, I get this thread dump :\n2011-09-27 11:36:18\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (20.1-b02-384 mixed mode):\n\n\"jp@gc - Stepping Thread Group 1-2\" prio=6 tid=101919800 nid=0x121701000 waiting on condition [121700000]\n   java.lang.Thread.State: TIMED_WAITING (sleeping)\n\tat java.lang.Thread.sleep(Native Method)\n\tat org.apache.jmeter.threads.JMeterThread.startScheduler(JMeterThread.java:213)\n\tat org.apache.jmeter.threads.JMeterThread.initRun(JMeterThread.java:499)\n\tat org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:252)\n\tat java.lang.Thread.run(Thread.java:680)\n\n\"StandardJMeterEngine\" prio=6 tid=103121000 nid=0x12011e000 in Object.wait() [12011d000]\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\n\tat java.lang.Object.wait(Native Method)\n\t- waiting on <7a18089d8> (a java.lang.Thread)\n\tat java.lang.Thread.join(Thread.java:1218)\n\t- locked <7a18089d8> (a java.lang.Thread)\n\tat org.apache.jmeter.engine.StandardJMeterEngine.waitThreadsStopped(StandardJMeterEngine.java:531)\n\tat org.apache.jmeter.engine.StandardJMeterEngine.run(StandardJMeterEngine.java:434)\n\tat java.lang.Thread.run(Thread.java:680)\n\n\n\nAfter patch it is OK.\nRegards\nPhilippe", "id": 149812, "time": "2011-09-27T09:41:46Z", "bug_id": 51880, "creation_time": "2011-09-27T09:41:46Z", "is_private": false, "attachment_id": 27607}, {"count": 11, "attachment_id": null, "bug_id": 51880, "text": "Sorry, I see now.\n\nURL: http://svn.apache.org/viewvc?rev=1176299&view=rev\nLog:\nBug 51880 - The shutdown command is not working if I invoke it before all the thread are started\nPart2 - fix to startUp delay (previous fix was to rampUp delay)\n\nModified:\n   jakarta/jmeter/trunk/src/core/org/apache/jmeter/threads/JMeterThread.java\n\nDoes that look OK now to you?", "id": 149813, "time": "2011-09-27T09:48:27Z", "creator": "sebb@apache.org", "creation_time": "2011-09-27T09:48:27Z", "tags": [], "is_private": false}, {"count": 12, "tags": [], "bug_id": 51880, "attachment_id": null, "id": 149814, "creation_time": "2011-09-27T09:51:33Z", "time": "2011-09-27T09:51:33Z", "creator": "p.mouawad@ubik-ingenierie.com", "text": "Ok for me,\nStef is it Ok for you, you must get last hudson build on nightly build page (link at bottom)\n\nRegards\nPhilippe", "is_private": false}, {"count": 13, "tags": [], "bug_id": 51880, "attachment_id": null, "text": "(In reply to comment #12)\n> Ok for me,\n> Stef is it Ok for you, you must get last hudson build on nightly build page\n> (link at bottom)\n> \n> Regards\n> Philippe\n\nHi Philippe,\n\nI tested it on r1176299, it works fine now. Thanks!\n\nStef", "id": 149824, "time": "2011-09-27T11:47:29Z", "creator": "stephane.hoblingre@gmail.com", "creation_time": "2011-09-27T11:47:29Z", "is_private": false}, {"count": 14, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 149826, "time": "2011-09-27T11:52:37Z", "bug_id": 51880, "creation_time": "2011-09-27T11:52:37Z", "is_private": false, "text": "Sebb, I close issue since stef said it was also OK for him."}]
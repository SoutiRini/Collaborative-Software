[{"count": 0, "tags": [], "creator": "alan@coldsmoke.com", "attachment_id": null, "id": 9472, "time": "2002-01-08T16:15:06Z", "bug_id": 5756, "creation_time": "2002-01-08T16:15:06Z", "is_private": false, "text": "I'm using jspc.bat from Tomcat 3.2.3 under Windows 2000.  I'm invoking it from \nant and I'm always getting back a failure from the exec task.  The problem is \nactually with tomcat.bat when invoked as \n\ntomcat jspc ...\n\ntomcat.bat is resetting the environment vars in the \"cleanup\" section.  Under \ncmd.exe, succesfully setting or unsetting a environmental var sets the \nERRORLEVEL.  In my case, I didn't have a CP var, so I was always failing; when \nI changed it, then I was always suceeding, even when I had errors compiling my \njsp pages.\n\nMy workaround is add a variable called \"tomcatexit\" (yes, this will pollute the \nenvironment, but whatever).  I first set it to 0 at about line 34:\n\nset _CP=%CP%\nset _TOMCAT_HOME=%TOMCAT_HOME%\nset _CLASSPATH=%CLASSPATH%\nset tomcatexit=0\n\nThen I used it to trap the ERRORLEVEL at the cleanup tag (at about line 181):\n\n:cleanup\nset tomcatexit=%ERRORLEVEL%\n\nand finally I exit with it:\n\n:finish\nif \"%OS%\"==\"Windows_NT\" exit /b %tomcatexit%\n\nI do the OS check since I'm not sure that command.com supports the exit /b \nsyntax.  This lets tomcat.bat, and hence jspc.bat, exit with whatever value the \njava code returns."}, {"count": 1, "tags": [], "creator": "sriramnrn@gmail.com", "text": "This suggestion works nicely for those who need it, and who don't mind polluting\nthe environment. For Tomcat 3.3.2, the line numbers are different (:cleanup is\nat line number 248). And you could unset the tomcatexit environment from within\njspc.bat.\n\nTomcat 5.5, at least, has an Ant task for JSPC.\n\nSince there are no plans for releasing a version of the TC 3.3 code, this fix\nwon't make it.\n\nThanks for the research and the inputs.", "id": 93695, "time": "2006-09-17T16:13:02Z", "bug_id": 5756, "creation_time": "2006-09-17T16:13:02Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 28636, "is_private": false, "text": "I have successfully used both JDBC and JNDI (backed by Active Directory) on\ntomcat 4.1.27, 4.1.29, and can toggle between them easily.  I upgraded to\n4.1.30, and the authentication portion works, but the authorization breaks.  It\nretreives the roles successfully from the AD server.  FWIW, JDBC realms work as\nexpected.\n\nHere is the logfile from the 4.1.30 instance:\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   Searching for USER\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   base: OU=Users, OU=CITY,OU=USA,\nDC=ad,DC=COMPANY,DC=com  filter: (sAMAccountName=USER)\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   entry found for USER with dn\nCN=USER,OU=Users,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   retrieving values for attribute\nmemberOf\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   validating credentials by binding\nas the user\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   binding as\nCN=USER,OU=Users,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:20:58 JNDIRealm[Standalone]: Username USER successfully authenticated\n2004-04-27 14:20:58 JNDIRealm[Standalone]:  \ngetRoles(CN=USER,OU=Users,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com)\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   Searching role base 'OU=Groups,\nOU=CITY, OU=USA, DC=ad,DC=COMPANY,DC=com' for attribute 'cn'\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   With filter expression\n'\\28member=CN=USER,OU=Users,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\\29'\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   Returning 68 roles\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   Found role\nCN=MatlibUser,OU=Groups,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   Found role\nCN=MatlibSysAdmin,OU=Groups,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   Found role\nCN=MatlibDataAdmin,OU=Groups,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:20:58 JNDIRealm[Standalone]:   Found role CN=STP RND DEV\nHippo,OU=Groups,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:20:58 JNDIRealm[Standalone]: Username USER does NOT have role\nMatlibUser\n2004-04-27 14:20:58 JNDIRealm[Standalone]: Username USER does NOT have role STP\nRND AARDVARK\n2004-04-27 14:20:58 JNDIRealm[Standalone]: Username USER does NOT have role STP\nRND DEV AEG\n2004-04-27 14:20:58 JNDIRealm[Standalone]: Username USER does NOT have role all\n\n\nNote that it successfully retreives the roles, but for some reason claims the\nUSER is not in the role (ie STP RND AARDVARK, STP RND DEV AEG, and MatlibUser\nspecifically).\n\nIf I use the same webapp war file, the same JNDI realm, same (cp/paste) realm\nconfig in a 4.1.29 instance, it works well.\n\nHere is the log from that:\n2004-04-27 14:10:37 JNDIRealm[Standalone]: Connecting to URL\nldap://LDAPSERVER.COMPANY.com\n2004-04-27 14:14:10 JNDIRealm[Standalone]:   Searching for USER\n2004-04-27 14:14:10 JNDIRealm[Standalone]:   base: OU=Users, OU=CITY, OU=USA,\nDC=ad,DC=COMPANY,DC=com  filter: (sAMAccountName=USER)\n2004-04-27 14:14:10 JNDIRealm[Standalone]:   entry found for USER with dn\nCN=USER,OU=Users,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:14:10 JNDIRealm[Standalone]:   retrieving values for attribute\nmemberOf\n2004-04-27 14:14:10 JNDIRealm[Standalone]:   validating credentials by binding\nas the user\n2004-04-27 14:14:10 JNDIRealm[Standalone]:   binding as\nCN=USER,OU=Users,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:14:10 JNDIRealm[Standalone]: Username USER successfully authenticated\n2004-04-27 14:14:11 JNDIRealm[Standalone]:  \ngetRoles(CN=USER,OU=Users,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com)\n2004-04-27 14:14:11 JNDIRealm[Standalone]:   Searching role base 'OU=Groups,\nOU=CITY, OU=USA, DC=ad,DC=COMPANY,DC=com' for attribute 'cn'\n2004-04-27 14:14:11 JNDIRealm[Standalone]:   With filter expression\n'(member=CN=USER,OU=Users,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com)'\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Returning 90 roles\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Found role\nCN=MatlibUser,OU=Groups,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Found role\nCN=MatlibSysAdmin,OU=Groups,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Found role\nCN=MatlibDataAdmin,OU=Groups,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Found role CN=STP RND\nAARDVARK,OU=Groups,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Found role CN=STP RND DEV\nAEG,OU=Groups,OU=CITY,OU=USA,DC=ad,DC=COMPANY,DC=com\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Found role MatlibDataAdmin\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Found role MatlibSysAdmin\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Found role MatlibUser\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Found role STP RND AARDVARK\n2004-04-27 14:14:14 JNDIRealm[Standalone]:   Found role STP RND DEV AEG\n2004-04-27 14:14:14 JNDIRealm[Standalone]: Username USER has role MatlibUser\n2004-04-27 14:14:14 JNDIRealm[Standalone]: Username USER has role MatlibUser\n2004-04-27 14:14:14 JNDIRealm[Standalone]: Username USER has role MatlibUser\n2004-04-27 14:14:19 JNDIRealm[Standalone]: Username USER has role STP RND AARDVARK\n2004-04-27 14:14:19 JNDIRealm[Standalone]: Username USER has role STP RND DEV AEG\n2004-04-27 14:14:19 JNDIRealm[Standalone]: Username USER does NOT have role all\n2004-04-27 14:14:19 JNDIRealm[Standalone]: Username USER does NOT have role min", "id": 56504, "time": "2004-04-27T19:45:39Z", "creator": "randy.watson@guidant.com", "creation_time": "2004-04-27T19:45:39Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "randy.watson@guidant.com", "attachment_id": null, "is_private": false, "id": 56505, "time": "2004-04-27T19:51:43Z", "bug_id": 28636, "creation_time": "2004-04-27T19:51:43Z", "text": "Ok, I changed my search on the mailing list and found out that this is a known\nissue, \n\nhttp://www.mail-archive.com/tomcat-user@jakarta.apache.org/msg122940.html\n\nI'm leaving this open for now, and will let someone smarter than I close this if\nappropriate."}, {"count": 2, "tags": [], "bug_id": 28636, "text": "This is a duplicate, already been found and fixed in CVS.  Unfortunately there \nhas not been a release of the Tomcat 4.1.x series in which to receive the fix.  \nOnce I find the other defect # I'll mark this one as duplicate, and I'll also \npost a msg to the dev list suggesting a release. (though IANAC)\nActually, it looks like there never was a bug submitted on the last issue, so I \nwill close this as fixed.", "id": 56507, "time": "2004-04-27T19:58:25Z", "creator": "jtulley@novell.com", "creation_time": "2004-04-27T19:58:25Z", "is_private": false, "attachment_id": null}]
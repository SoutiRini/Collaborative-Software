[{"count": 0, "tags": [], "creator": "divisor@ad69.com", "text": "(I have apache 2.0.51 but can't select it from the version list)\n\nI have the following problem:\n\nThere's some virtualhost with suexec enabled and vh directory with includes enabled.\n\nI've created test.shtml page and trying to execute cgi command from it:\n\n<!--#exec cmd=\"sample.cgi\" -->\nthis one works ok\n\nsuexec log output:\nuid: (1000/divisor) gid: (45000/45000) cmd: sample.cgi\n\nthen I move sample.cgi to the some dir i.e. called '5' and change test.shtml\ncontent to\n\n<!--#exec cmd=\"./5/sample.cgi\" -->\nthis one stops working\n\nsuexec log output:\nuid: (1000/divisor) gid: (45000/45000) cmd: sample.cgi\n[2004-09-20 00:18:00]: cannot stat program: (sample.cgi)\n\nbut works fine if disable suexec in the virtualhost config.\n\nvirtualhost config example:\n\n<VirtualHost 172.16.1.1:80>\nServerAdmin  webmaster@domain.com\nDocumentRoot /home/divisor/domain.com\nServerName   domain.com\nSuexecUserGroup divisor divisor\n<DIRECTORY //home/divisor/domain.com>\nOPTIONS  Indexes FollowSymLinks Includes\nAllowOverride All\n</DIRECTORY>\nIndexOptions FancyIndexing\n</VirtualHost>", "id": 63835, "time": "2004-09-19T21:36:11Z", "bug_id": 31302, "creation_time": "2004-09-19T21:36:11Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 31302, "text": "In 1.3.x suexec executes programs in subdirs well if there's a correct relative\npath in the ssi command.\n\nI noticed that apache 2.0.51 gives to suexec just a program name, without a\npath, i.e. example.cgi instead of ./somedir/example.cgi when 1.3.x gives to\nsuexec a program name together with a path.\n\nMaybe this is a feature of 2.0.x :) but many sites have such includes and can't\nbe transferred to 2.0.x if the system is configured to work with suexec.\n\nIf the problem executing programs in subdirs via ssi+suexec isn't going to be\nsolved in 2.0.x could you plz advice how to configure or manually patch apache\n2.0.x to transfer such sites? I would be greatly appreciated. Thanks you.", "id": 63839, "time": "2004-09-20T00:23:18Z", "creator": "divisor@ad69.com", "creation_time": "2004-09-20T00:23:18Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "text": "I've figured this out writting such patch:\n\n-- FILE START --\n--- os/unix/unixd.c.orig        Mon Sep 20 04:09:08 2004\n+++ os/unix/unixd.c     Mon Sep 20 04:09:27 2004\n@@ -308,15 +308,7 @@\n         return apr_proc_create(newproc, progname, args, env, attr, p);\n     }\n \n-    argv0 = ap_strrchr_c(progname, '/');\n-    /* Allow suexec's \"/\" check to succeed */\n-    if (argv0 != NULL) {\n-        argv0++;\n-    }\n-    else {\n-        argv0 = progname;\n-    }\n-\n+    argv0 = progname;\n \n     if (ugid->userdir) {\n         execuser = apr_psprintf(p, \"~%ld\", (long) ugid->uid);\n\n-- FILE END --\n\nwhat was that check for? security feature to avoid running external programs? If\nso they can be executed anyway under the same permissions directly from the\nprogram executed from the current dir. I guess it was unusual. Please comment.\nThanks.", "is_private": false, "bug_id": 31302, "id": 63840, "time": "2004-09-20T01:20:17Z", "creator": "divisor@ad69.com", "creation_time": "2004-09-20T01:20:17Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "WORKSFORME is used to indicate that the problem can't be replicated with the\ncurrent source code.  I don't think that is what you intended.", "is_private": false, "bug_id": 31302, "id": 63841, "time": "2004-09-20T02:04:29Z", "creator": "slive@apache.org", "creation_time": "2004-09-20T02:04:29Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "asfbugz@velox.ch", "is_private": false, "text": "Same problem here, still present in 2.0.53. Michael's suggested fix \neffectively reverses the changes to os/unix/unixd.c added by Ryan Bloom on \n2002-06-26 (for 2.0.40), see\n\nhttp://mail-archives.apache.org/eyebrowse/ReadMsg?\nlistName=cvs@httpd.apache.org&msgNo=21396\n\n\"Fix a long-standing bug in 2.0, CGI scripts were being called with relative \npaths instead of absolute paths.  Apache 1.3 used absolute paths for \neverything except for SuExec, this brings back that standard.\"\n\nI'm not completely sure about possible side effects of reversing the changes \nto unixd.c, so would appreciate if a current Apache HTTP server project member \ncould have a look at this issue (Ryan is now listed as an emeritus member).\n\nBTW, #29534 seems to be a duplicate of this bug (or the other way round, since \n29534 was actually filed earlier).\n\nThanks,\nKaspar\n", "id": 72300, "time": "2005-03-13T11:42:59Z", "bug_id": 31302, "creation_time": "2005-03-13T11:42:59Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "rbb@apache.org", "attachment_id": null, "is_private": false, "id": 72301, "time": "2005-03-13T13:25:10Z", "bug_id": 31302, "creation_time": "2005-03-13T13:25:10Z", "text": "My personal opinion, without any carful study is that this is the wrong fix. \nThe original patch was put in for valid reasons and should stay.  However,\nmod_include needs a patch that turns CGI script paths into absolute paths.  That\nwill keep everything working."}, {"count": 6, "attachment_id": 14563, "bug_id": 31302, "text": "Created attachment 14563\nproposed fix", "id": 72855, "time": "2005-03-25T17:22:33Z", "creator": "asfbugz@velox.ch", "creation_time": "2005-03-25T17:22:33Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "asfbugz@velox.ch", "attachment_id": null, "text": "Well, nobody seems to have picked up so far, so here's my try.\n\n> mod_include needs a patch that turns CGI script paths into absolute paths.\n\nThat's what my proposed fix tries to do. The code handling the SSI exec tag \nhas actually been moved to mod_cgi (before 2.0.10 already), so that's where \nthe patch goes.\n\nIn handle_exec(), I have added a check to make sure an absolute pathname is \nused when calling include_cmd()/run_cgi_child(). For suexec, the important \npoint is that in run_cgi_child() the directory for the new child is set to the \nparent of \"command\", not the one of r->filename (they differ if the \"exec\" \ntarget is not in the same directory as the shtml file).\n\nI've tested this both with relative and absolute file names for the \"cmd\" \nparameter, and running with and without suexec. It works for me (as predicted \nby Ryan), but further testing is welcome, of course. And finally, I'd \nappreciate to see this fix (or a similar one) in 2.0.54... thanks!\n", "id": 72856, "time": "2005-03-25T17:23:36Z", "bug_id": 31302, "creation_time": "2005-03-25T17:23:36Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 31302, "text": "*** Bug 29534 has been marked as a duplicate of this bug. ***", "id": 72858, "time": "2005-03-25T17:26:13Z", "creator": "asfbugz@velox.ch", "creation_time": "2005-03-25T17:26:13Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 31302, "text": "PatchAvailable keyword added", "id": 73214, "time": "2005-04-03T09:01:09Z", "creator": "asfbugz@velox.ch", "creation_time": "2005-04-03T09:01:09Z", "is_private": false, "attachment_id": null}, {"count": 10, "attachment_id": null, "bug_id": 31302, "is_private": false, "id": 85068, "time": "2006-01-26T21:28:36Z", "creator": "mamrein+asfbug@ee.ethz.ch", "creation_time": "2006-01-26T21:28:36Z", "tags": [], "text": "I can still confirm this issue for 2.0.55. I think it's getting time to bring\nthis fix to HEAD."}, {"count": 11, "tags": [], "creator": "igor@webhostingbuzz.com", "text": "The version 2.0.63  of apache server was released but this bug was not fixed. Will this problem be resolved in the nearest future?", "id": 117425, "time": "2008-06-06T02:15:47Z", "bug_id": 31302, "creation_time": "2008-06-06T02:15:47Z", "is_private": false, "attachment_id": null}]
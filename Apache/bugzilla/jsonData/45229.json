[{"count": 0, "tags": [], "bug_id": 45229, "attachment_id": null, "id": 117795, "time": "2008-06-18T14:09:07Z", "creator": "gsexton@mhsoftware.com", "creation_time": "2008-06-18T14:09:07Z", "is_private": false, "text": "When running Tomcat 5.5.26 under the Java Security manager using JDK 1.5.0_15 running under SuSE Open Linux, kernel version 2.6.18.8-0.9-default, an IllegalStateException is thrown. Since I'm seeing this error by examining logs, I can't really give more information about how it was triggered.\n\nStack Trace:\n\n java.lang.IllegalStateException: setAttribute: Session already invalidated\n        at org.apache.catalina.session.StandardSession.setAttribute(StandardSession.java:1261)\n        at org.apache.catalina.session.StandardSession.setAttribute(StandardSession.java:1243)\n        at org.apache.catalina.session.StandardSessionFacade.setAttribute(StandardSessionFacade.java:130)\n        at org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:272)\n        at org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:162)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:262)\n        at org.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:52)\n        at org.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:171)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:167)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:174)\n        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:548)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:117)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:108)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:174)\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:874)\n        at org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:665)\n        at org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:528)\n        at org.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:81)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:689)\n        at java.lang.Thread.run(Thread.java:595)\n\n\nThe offending code appears to be:\n\norg.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:272)\n\nAdditional debug information from the error:\n*********************************************\nRequest Information\n*********************************************\nRequest Protocol: HTTP/1.1\nRequest Scheme: http\nRequest URI: /ErrorServlet.html\nRemote Host: 167.7.140.254\nRequest Encoding: null\nRequest Method: GET\n\n*********************************************\nParameters\n*********************************************\n\n*********************************************\nRequest Headers\n*********************************************\n        host=[midlandstech.mhsoftware.com]\n        user-agent=[Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.14) Gecko/20080404 Firefox/2.0.0.14]\n        accept=[text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5]\n        accept-language=[en-us,en;q=0.5]\n        accept-encoding=[gzip,deflate]\n        accept-charset=[ISO-8859-1,utf-8;q=0.7,*;q=0.7]\n        keep-alive=[300]\n        connection=[keep-alive]\n        x-moz=[livebookmarks]\n        cookie=[JSESSIONID=43D053C25ED0F0114ECCE1E88340EE17]\n        cache-control=[max-age=0]\n\n*********************************************\nCookies\n*********************************************\n        JSESSIONID=[43D053C25ED0F0114ECCE1E88340EE17]\n\n\n\nThe command line used to start tomcat is:\n\njsvc.exec -jvmserver -cp /usr/local/apache-tomcat-5.5.26/bin/bootstrap.jar:\n/usr/local/apache-tomcat-5.5.26/bin/commons-logging-api.jar \n-home /etc/alternatives/java_sdk \n-user tomcat \n-outfile /srv/tomcat/logs/catalina.out \n-errfile /srv/tomcat/logs/catalina.err\n-pidfile /var/run/jsvc.pid\n-Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager\n-Djava.util.logging.config.file=/srv/tomcat/conf/logging.properties\n-Djava.endorsed.dirs=/usr/local/apache-tomcat-5.5.26/common/endorsed\n-Dcatalina.base=/srv/tomcat\n-Dcatalina.home=/usr/local/apache-tomcat-5.5.26\n-Djava.io.tmpdir=/srv/tomcat/temp\n-Djava.awt.headless=true\n-Dcatalina.port=80\n-Dmail.smtp.localhost=host.mhsoftware.com\n-Xms512m\n-Xmx1024m\n-XX:PermSize=128m\n-XX:MaxPermSize=256m\n-Djava.security.manager\n-Djava.security.policy==/srv/tomcat/conf/catalina.policy\norg.apache.catalina.startup.Bootstrap start"}, {"count": 1, "tags": [], "bug_id": 45229, "is_private": false, "text": "Looks like the session is invalidated whilst a request is still being processed. Try running with\n-Dorg.apache.catalina.session.StandardSession.ACTIVITY_CHECK=true\n\nThis will keep the session valid whilst a thread is accessing it.", "id": 117827, "time": "2008-06-19T10:36:10Z", "creator": "markt@apache.org", "creation_time": "2008-06-19T10:36:10Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 45229, "attachment_id": null, "id": 119154, "time": "2008-07-30T14:03:03Z", "creator": "markt@apache.org", "creation_time": "2008-07-30T14:03:03Z", "is_private": false, "text": "No response in over a month. Assume using -Dorg.apache.catalina.session.StandardSession.ACTIVITY_CHECK=true fixes this issue. Please re-open if this is not the case."}]
[{"count": 0, "tags": [], "bug_id": 37850, "attachment_id": null, "text": "Hi! We've been trying to set up Apache + Tomcat + mod_jk on both Solaris 8 and\n9, but we keep comming across the following notice in Apache's error_log:\n\n[Wed Dec 07 10:57:20 2005] [notice] child pid 2198 exit signal Segmentation\nfault (11), possible coredump in [/apache's/server/root/directory]\n\nHere's the setup:\n\nUltraSPARC hardware (Sun ES 450 on 4GB RAM and 4 440MHz processors)\nSolaris 9 (tried on another machine with Solaris 8 too)\nJDK1.4.2\nApache 2.0.54 mpm=worker\nTomcat 5.0.28\nmod_jk1.2.15 (we've tried compiling every version from 1.2.10 to 1.2.15 and\nwe've tried the binary versions available on the official download site. Same\nresults on ALL of them).\n\nWe've tried other scenarios, such as Apache on one machine and Tomcat on\nanother, or one Apache and several Tomcats on other machines in a load balancing\nsetup, and in every case we get the same problem. The server works just fine\nunder light load, but...\n\nWe are performing some load tests on the server. We get a core dump notice,\ntogether with the actual core dump every few seconds or so, whenever the server\ngoes through heavy (or even fairly mild) loads. At first, we felt that we might\nbe pushing the limit on performance, and that the core dump was a result of\nthat. However, our tests show that the core dump starts appearing under very\nlight load for a server of this kind. Apparently, 10 or 20 concurrent users\nthrowing page requests is our thresshold. Below that load, there are no errors.\nAbove it, they reappear consistently. The server seems to be able to work very\nwell on user loads much bigger than 20 concurrent users,(ie: 100-200) and the\ncore dumping hardly seems to affect performance, because the requests keep being\nserved anyway. We hardly noticed during the initial tests that something was\ngoing so wrong - until we checked the logs.\n\nWe are blaming the problem on mod_jk because we've tried both Apache and Tomcat\nstandalone with no errors under the same load scenario. However, but the mod_jk\nlog doesn't seem to show anything relevant - even in debug mode. Only the notice\non Apache's log shows up.\n\nMy knowledge of core dump analysis is next to none. Can anyone help me with that\nso that we can work out how to fix it?", "id": 83473, "time": "2005-12-09T12:51:49Z", "creator": "jorge.degraciasantos@telefonica.es", "creation_time": "2005-12-09T12:51:49Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 37850, "attachment_id": null, "text": "Here's the output of\ngdb httpd -c core\nwhere\n\n#0  0xfee85f8c in __lwp_park () from /usr/lib/libthread.so.1\n#1  0xfee81d08 in mutex_lock_queue () from /usr/lib/libthread.so.1\n#2  0xfee82708 in slow_lock () from /usr/lib/libthread.so.1\n#3  0xfef43c64 in free () from /usr/lib/libc.so.1\n#4  0xfef54660 in tzcpy () from /usr/lib/libc.so.1\n#5  0xfef54318 in _ltzset_u () from /usr/lib/libc.so.1\n#6  0xfef533a4 in localtime_u () from /usr/lib/libc.so.1\n#7  0xfedee5d0 in set_time_str (str=0xf93f8a2c \"C\\231\\177&#9559;worker1 from 10 \",\nlen=-17029004) at jk_util.c:134\n#8  0xfedee9d0 in jk_log (l=0xd12e8, file=0xfee067e8 \"mod_jk.c\", line=1917,\nfuncname=0xfee07410 \"jk_handler\", level=4,\n    fmt=0xfee074d8 \"Could not get endpoint for worker=%s\") at jk_util.c:309\n#9  0xfede9a7c in jk_handler (r=0x39f5b8) at mod_jk.c:1917\n#10 0x48fbc in ap_run_handler (r=0x39f5b8) at config.c:152\n#11 0x49560 in ap_invoke_handler (r=0x39f5b8) at config.c:364\n#12 0x34148 in ap_process_request (r=0x39f5b8) at http_request.c:249\n#13 0x2f604 in ap_process_http_connection (c=0x395680) at http_core.c:251\n#14 0x54634 in ap_run_process_connection (c=0x395680) at connection.c:43\n#15 0x45c34 in process_socket (p=0x395558, sock=0x395590, my_child_num=0,\nmy_thread_num=87, bucket_alloc=0x39b570)\n    at worker.c:521\n#16 0x46304 in worker_thread (thd=0x114de0, dummy=0x395558) at worker.c:835\n#17 0xff1d4aa8 in dummy_worker (opaque=0x114de0) at thread.c:105", "id": 83475, "time": "2005-12-09T14:15:25Z", "creator": "jorge.degraciasantos@telefonica.es", "creation_time": "2005-12-09T14:15:25Z", "is_private": false}, {"count": 2, "tags": [], "creator": "mturk@apache.org", "is_private": false, "id": 86955, "creation_time": "2006-03-17T09:41:46Z", "time": "2006-03-17T09:41:46Z", "bug_id": 37850, "text": "I have never observed such behavior.\nThere was bug with Solaris dealing with the shared memory that\nwas causing core dump, but never something like that.\n\nThe interesting is that it fails in strformat, so try adjusting the\nJkLogStampFormat.", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 37850, "is_private": false, "id": 86977, "creation_time": "2006-03-17T20:21:01Z", "time": "2006-03-17T20:21:01Z", "creator": "rainer.jung@kippdata.de", "text": "Hi Jorge, Hi Mladen,\n\nare you sure, that the stack is from the right thread?\n\nIf so, man page of Solaris 9 says localtime is not MT safe:\n\n     The return values for  ctime(),  localtime(),  and  gmtime()\n     point  to  static  data whose content is overwritten by each\n     call.\n...\n     The asctime(), ctime(), gmtime(), and localtime()  functions\n     are unsafe in multithread applications.  The asctime_r() and\n     gmtime_r()   functions   are   MT-Safe.    The    ctime_r(),\n     localtime_r(),  and  tzset()  functions  are MT-Safe in mul-\n     tithread applications, as long as no  user-defined  function\n     directly  modifies one of the following variables: timezone,\n     altzone, daylight, and tzname.  These four variables are not\n     MT-Safe to access. They are modified by the tzset() function\n     in an MT-Safe manner.   The   mktime(),  localtime_r(),  and\n     ctime_r() functions call tzset().", "attachment_id": null}, {"count": 4, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "We switch to a thread safe variant of localtime() in version 1.2.27.\nI still doubt, that this was the cause.", "id": 112455, "time": "2008-01-03T05:32:00Z", "bug_id": 37850, "creation_time": "2008-01-03T05:32:00Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "attachment_id": null, "bug_id": 59120, "text": "In the class [1], its createSSLEngine() method uses the protocol name \"TLS\" to get an SSL context. However, different JREs have different interpretation for this protocol name. For example, Oracle/OpenJDK interprets it as \"Supports some version of TLS; may support other versions\" [2], while IBM JDK interprets it as \"TLS v1.0 protocol\" [3]. As TLS v1.0 is quickly getting deprecated, a more general protocol name should be used, like \"SSL\". Based on my test, when \"SSL\" is used to get the SSL context, both the Oracle/OpenJDK and IBM JDK use TLSv1.2 to make the connection.\n\nThis issue also applies to other Tomcat versions.\n\n[1] http://svn.apache.org/repos/asf/tomcat/trunk/java/org/apache/tomcat/websocket/WsWebSocketContainer.java\n[2] http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#SSLContext\n[3] http://www-01.ibm.com/support/knowledgecenter/SSYKE2_8.0.0/com.ibm.java.security.component.80.doc/security-component/jsse2Docs/protocols.html?lang=en", "id": 189113, "time": "2016-03-04T19:48:45Z", "creator": "caijunj@apache.org", "creation_time": "2016-03-04T19:48:45Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 59120, "text": "The documentation you quote is not consistent with the claims you make regarding SSL being more general.\n\nPart of the problem is that this code has to work across multiple Java versions and multiple vendors and the respective behaviours are not always identical.\n\nThere is always the option to provide your own, pre-configured SSLContext.\n\nTypically, I'd expect this value to not matter and the value obtained from org.apache.tomcat.websocket.SSL_PROTOCOLS to be much more important.\n\nOne of the reasons for allowing a custom SSLContext was to avoid the mushrooming of TLS ocnfiguration options.\n\nI'm going to change this code to use SSLContext.getDefault() as that should return a good, secure choice on any OS / Vendor / Java version combination.", "id": 189201, "time": "2016-03-07T13:04:54Z", "creator": "markt@apache.org", "creation_time": "2016-03-07T13:04:54Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 189203, "time": "2016-03-07T14:05:32Z", "bug_id": 59120, "creation_time": "2016-03-07T14:05:32Z", "is_private": false, "text": "OK, that isn't going to work.\n\nI've done some testing with Oracle's JVM and the protocol used only determines the protocols enabled by default. All protocols remain supported and may be selected via org.apache.tomcat.websocket.SSL_PROTOCOLS.\n\nI tried to test a current IBM JVM but downloads require a registration and the registration is broken. I then tried to downlaod without registration and the IBM download director hangs.\n\nI managed to dig out an oldish IBM Java 8 install for Linux and a quick test shows that it behaves the same way as Oracle.\n\nThere is no Tomcat issue here. Defaults will vary with platforms. You need to use org.apache.tomcat.websocket.SSL_PROTOCOL to configure the protocols you actually want to use."}, {"count": 3, "tags": [], "creator": "caijunj@apache.org", "attachment_id": null, "id": 189205, "time": "2016-03-07T15:12:25Z", "bug_id": 59120, "creation_time": "2016-03-07T15:12:25Z", "is_private": false, "text": "When you say \"it behaves the same way as Oracle\", did you mean the communication used the same TLS version? From my test (by setting -Djavax.net.debug=ssl) Oracle uses TLS v1.2, and IBM uses TLS v1.0.\n\nI think it's probably better to use SSLContext.getDefault() as you suggested in Comment #1 as THE DEFAULT, and then allow people to use org.apache.tomcat.websocket.SSL_PROTOCOLS to override. That way people can also use common JDK options like -Djdk.tls.client.protocols [1] to override.\n\n\n[1] https://docs.oracle.com/javase/8/docs/technotes/guides/security/enhancements-8.html"}, {"count": 4, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 189273, "time": "2016-03-08T19:52:27Z", "bug_id": 59120, "creation_time": "2016-03-08T19:52:27Z", "is_private": false, "text": "Further questions should be directed to the users@ mailing list."}]
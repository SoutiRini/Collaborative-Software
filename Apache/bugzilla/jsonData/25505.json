[{"count": 0, "tags": [], "bug_id": 25505, "attachment_id": null, "text": "On (at least) JDK 1.4.0 and 1.4.2_02, both on current CVS and 1.9.1, the first\nHTTPS sample run after starting JMeter always fails. Subsequent samples work\nproperly.\n\n[Workaround: create a stupid sample at the very beginning of your test]\n\nErrors thrown:\n\nERROR - jmeter.util: Couldn't load keystore java.lang.Exception: No key found\n        at\norg.apache.jmeter.util.keystore.DefaultKeyStore.load(DefaultKeyStore.java:109)\n        at org.apache.jmeter.util.SSLManager.getKeyStore(SSLManager.java:210)\n        at org.apache.jmeter.util.JsseSSLManager.getContext(JsseSSLManager.java:208)\n        at org.apache.jmeter.util.JsseSSLManager.<init>(JsseSSLManager.java:136)\n       at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n       at\nsun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:274)\n        at org.apache.jmeter.util.SSLManager.getInstance(SSLManager.java:318)\n        at\norg.apache.jmeter.protocol.http.sampler.HTTPSampler.setupConnection(HTTPSampler.java:584)\n        at\norg.apache.jmeter.protocol.http.sampler.HTTPSampler.sample(HTTPSampler.java:953)\n        at\norg.apache.jmeter.protocol.http.sampler.HTTPSampler.sample(HTTPSampler.java:445)\n        at org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:277)\n        at java.lang.Thread.run(Thread.java:534)\n                                                                                \nand later:\n\nWARN  - jmeter.protocol.http.sampler.HTTPSampler: HTTPS hostname wrong:  should\nbe <localhost> java.io.IOException: HTTPS hostname wrong:  should be <localhost>\n        at sun.net.www.protocol.https.HttpsClient.b(DashoA6275)\n        at sun.net.www.protocol.https.HttpsClient.afterConnect(DashoA6275)\n        at\nsun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(DashoA6275)\n        at\ncom.sun.net.ssl.internal.www.protocol.https.HttpsURLConnectionOldImpl.connect(DashoA6275)\n        at\norg.apache.jmeter.protocol.http.sampler.HTTPSampler.connect(HTTPSampler.java:889)\n        at\norg.apache.jmeter.protocol.http.sampler.HTTPSampler.sample(HTTPSampler.java:961)\n        at\norg.apache.jmeter.protocol.http.sampler.HTTPSampler.sample(HTTPSampler.java:445)\n        at org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:277)\n        at java.lang.Thread.run(Thread.java:534)", "id": 49075, "time": "2003-12-14T00:27:47Z", "creator": "jsalvata@atg.com", "creation_time": "2003-12-14T00:27:47Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 25505, "attachment_id": null, "is_private": false, "id": 49294, "time": "2003-12-17T23:46:10Z", "creator": "sonam.chauhan@ce.com.au", "creation_time": "2003-12-17T23:46:10Z", "text": "I confirm this bug occurs in JMeter 1.9.1 and JMeter CVS (Version \n1.9.20031210.) I am using this Java version:\n---\njava version \"1.4.2_02\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_02-b03)\nJava HotSpot(TM) Client VM (build 1.4.2_02-b03, mixed mode)\n---\n\n\nWhen this bug occurs, I see the following in the 'View Results Tree':\n\nRequest Data:\n----------------\nnull\nhttps://b2buat.ce.com.au:9999/invoke/CEShoppingSession.handler.au.OCI/entry\n----------------\nResponse Data:\n----------------\njava.io.IOException: HTTPS hostname wrong:  should be <b2buat.ce.com.au>\n----------------\n\nThis bug is only for the first HTTPS connection. \nIn the very next HTTPS connection, the request is fine:\n----------------\nGET blah...\n----------------\nThe response is normal too. \n\n\nI don't know how to obtain the stacktraces below... will ask on JMeter-users."}, {"count": 2, "tags": [], "bug_id": 25505, "attachment_id": null, "is_private": false, "id": 54641, "time": "2004-03-25T07:25:35Z", "creator": "sonam.chauhan@ce.com.au", "creation_time": "2004-03-25T07:25:35Z", "text": "This problem seem to occur due to expired digital certificates. i.e. A \"proper\" \ndigital X.509 server certificate seems to fix the problem.\n\nWe normally use expired certs on our test servers (which are the only servers \nwe use JMeter on). Today, we installed a \"proper\" digital certificate (the one \nwe installed today is from Thawte) on one of our servers. Earlier, JMeter \nconsistently got the first HTTPS connection malformed  against this server -- \nnow this error suddenly went away. \n\nI then tested JMeter against two test servers with expired digital \ncertificates -- the first HTTPS request stayed malformed. Next, I tested with \ntwo servers with valid certificates -- the first HTTPS request worked off.\n\n\nNote, to replicate this problem, you need to restart JMeter between two HTTPS \nrequests. \n\nI did not test with self-issued certificates. "}, {"count": 3, "tags": [], "bug_id": 25505, "attachment_id": null, "is_private": false, "id": 87659, "time": "2006-04-07T10:37:00Z", "creator": "sonam.chauhan@ce.com.au", "creation_time": "2006-04-07T10:37:00Z", "text": "JMeter 1.9.1 showed different (and anomalous) behavior dealing with the same \nexpired certificates -- it gave out the misleading error \"HTTPS hostname \nwrong: should be <localhost>\" error, and only the first SSL connection would \nfail. \n\nThe error message in JMeter 2.2.1 is now accurate, and all HTTPS connections \n(not just the first) fail consistently with the following exception below:\n\nEXCEPTION MESSAGE \n==================\njavax.net.ssl.SSLHandshakeException:\njava.security.cert.CertificateExpiredException: NotAfter: Sat Nov 12\n10:22:14 EST 2005\n\tat com.sun.net.ssl.internal.ssl.BaseSSLSocketImpl.a(DashoA6275)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.a(DashoA6275)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.a(DashoA6275)\n\tat com.sun.net.ssl.internal.ssl.SunJSSE_az.a(DashoA6275)\n\tat com.sun.net.ssl.internal.ssl.SunJSSE_az.a(DashoA6275)\n\tat com.sun.net.ssl.internal.ssl.SunJSSE_ax.a(DashoA6275)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.a(DashoA6275)\n\tat com.sun.net.ssl.internal.ssl.SSLSocketImpl.j(DashoA6275)\n\tat\ncom.sun.net.ssl.internal.ssl.SSLSocketImpl.startHandshake(DashoA6275)\n\tat\nsun.net.www.protocol.https.HttpsClient.afterConnect(DashoA6275)\n\tat\nsun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(Da\nshoA6275)\n\tat\ncom.sun.net.ssl.internal.www.protocol.https.HttpsURLConnectionOldImpl.co\nnnect(DashoA6275)\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSampler.sample(HTTPSampler.j\nava:424)\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSampl\nerBase.java:514)\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSampl\nerBase.java:503)\n\tat\norg.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:247)\n\tat java.lang.Thread.run(Thread.java:534)\nCaused by: java.security.cert.CertificateExpiredException: NotAfter: Sat\nNov 12 10:22:14 EST 2005\n\tat\nsun.security.x509.CertificateValidity.valid(CertificateValidity.java:268\n)\n\tat\nsun.security.x509.X509CertImpl.checkValidity(X509CertImpl.java:564)\n\tat\nsun.security.validator.SimpleValidator.engineValidate(SimpleValidator.ja\nva:123)\n\tat sun.security.validator.Validator.validate(Validator.java:202)\n\tat\ncom.sun.net.ssl.internal.ssl.X509TrustManagerImpl.checkServerTrusted(Das\nhoA6275)\n\tat\ncom.sun.net.ssl.internal.ssl.JsseX509TrustManager.checkServerTrusted(Das\nhoA6275)\n\t... 14 more\n"}, {"count": 4, "tags": [], "creator": "sebb@apache.org", "text": "(In reply to comment #3)\n\n> The error message in JMeter 2.2.1 is now accurate, and all HTTPS connections \n\nI presume this means 2.1.1 ? 2.2.1 does not exist (yet)\n\n", "id": 87667, "time": "2006-04-07T13:53:18Z", "bug_id": 25505, "creation_time": "2006-04-07T13:53:18Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "sebb@apache.org", "text": "Fixed in JMeter 2.1.1; won't fix in 1.9.1", "id": 87695, "time": "2006-04-08T01:42:05Z", "bug_id": 25505, "creation_time": "2006-04-08T01:42:05Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "sonam.chauhan@ce.com.au", "is_private": false, "text": "Seb: yes, it was 2.1.1 -- not 2.2.1 -- sorry. ", "id": 87716, "time": "2006-04-10T02:19:22Z", "bug_id": 25505, "creation_time": "2006-04-10T02:19:22Z", "attachment_id": null}, {"count": 7, "attachment_id": null, "bug_id": 25505, "is_private": false, "id": 88175, "time": "2006-04-17T21:20:28Z", "creator": "sebb@apache.org", "creation_time": "2006-04-17T21:20:28Z", "tags": [], "text": "Discovered that the problem was not fully solved in 2.1.1 - the message would\nstill appear for certain valid certificates. The problem was that the SSLManager\nwas being initialised after creating the first connection. This has now been\nfixed in the 2.1 branch."}, {"count": 8, "tags": [], "creator": "dan@dankeeley.co.uk", "text": "I can confirm that an example we saw of this problem in 2.1.1 is indeed fixed in\n2.2.", "id": 101554, "time": "2007-04-10T06:05:35Z", "bug_id": 25505, "creation_time": "2007-04-10T06:05:35Z", "is_private": false, "attachment_id": null}]
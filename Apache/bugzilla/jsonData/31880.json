[{"count": 0, "tags": [], "bug_id": 31880, "attachment_id": null, "text": "Hi,\n\nI have a rewrite rule working in V1 apache that does not work in V2.  When I \nnarrowed it down, I found out that the 'last' directive was letting my rewrite \nfall down through the rewrite commands all over again.\n\nHere is the code:\n\nAddHandler cgi-script .cgi\nOptions +ExecCGI\n\nRewriteEngine on\nSetEnv PS_SITE_CODE svg \nSetEnv PS_TOUR_CODE t1\nSetEnv PS_PROC_ID PAYCOM \nSetEnv PS_CASCADE PAYCOM|CCBILL|PAYCOM|ELECTRA\n\nRewriteBase /\n\n# Take care of urls without trailing slashes\nRewriteRule ^([^/]+/)*[^=]*=[^/]*$ /t1/$0/ [R,L]\n\n# Take care of urls with a program listed but no affiliate\nRewriteRule ^(([^/]+/)*[^=]*)=((/.*)?)$ /t1/$1=NoAdvert$3 [R,L]\n\n# Take care of REVS program with affiliate id passed\nRewriteRule ^(([^/]+/)*)REVS=([^/]+)(/(.*))?$ /t1/$1$5 \n[L,NC,E=PSID:$3,E=PRGID:REVS,E=POPUP:NO,E=TBACK:NO]\n\n# Take care of old, disabled, or improper program links\n#  with affiliate id passed.  Rewrite to default program\nRewriteRule ^(([^/]+/)*)[^=]*=([^/]+(/.*)?)$ /t1/$1revs=$3 [R,L]\n\n# Take care of links without program or affiliate id passed.  \n#  Rewrite to default program and NoAdvert\nRewriteRule ^(([^/=]+/)*)([^/=]*)$ /t1/$1revs=NoAdvert/$3 [R,L]\n\nThe third line RewriteRule line is the culprit where the 'last' L directive \ndoes not work.\n\nTo test it, place it in a directory called 't1' under htdocs, and create an \nindex.html file in that direcdtory.  Under apache V1 the following URL works:\n\nhttp://www.sitename.com/t1/revs=sooper/index.html\n\nbut under V2, it falls through to the last RewriteRule and enters an infinite \nloop.  I thought the last command would stop the Rewrite processing.\n\nPlease advise if this is a logic error.  Otherwise, please fix this...it is an \nimportant piece of our software and Apache.\n\n\nJohn Suprock\nCastleComm\njohn@oceanebi.com\n410 296 5970 (Ext 14)", "id": 65650, "time": "2004-10-25T14:05:53Z", "creator": "john@oceanebi.com", "creation_time": "2004-10-25T14:05:53Z", "is_private": false}, {"count": 1, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "id": 65652, "time": "2004-10-25T14:34:48Z", "bug_id": 31880, "creation_time": "2004-10-25T14:34:48Z", "is_private": false, "text": "It looks like it happens because your third rule is an internal redirect (it has\nno \"R\" listed in the flags), and the internal redirect is itself subjected to\nrewriting; adding an R should fix it.  Not sure if this is desired behaviour."}, {"count": 2, "tags": [], "creator": "john@oceanebi.com", "attachment_id": null, "id": 65653, "time": "2004-10-25T14:54:07Z", "bug_id": 31880, "creation_time": "2004-10-25T14:54:07Z", "is_private": false, "text": "Hi,\n \n    Thanks.  I'm trying to get the third rule to pull up the right location \nwithout rewriting the url in the browser, so that the information in the links \nsuch as affiliate id and program, can be stored by search egnines.\n \n    Is there a way to force apache to stop processing (rewriting) if that 3rd \nrewrite works?  Isn't that what the 'L' command is supposed to do?\n \n    Please help clear my head from the aches on this one :)\n \nThanks,\n \nJohn\nCastleComm\njohn@oceanebi.com\n410 296 5970 (Ext 14)"}, {"count": 3, "tags": [], "bug_id": 31880, "attachment_id": null, "text": "You can try adding the NS flag to the later RewriteRules to exclude them from\nprocessing sub-requests.\n\nYou can also explictly exclude certain requests from certain RewriteRules by\npreceding them with an appropriate RewriteCond:\nRewriteCond %{REQUEST_URI} !^(([^/]+/)*)REVS=([^/]+)(/(.*))?$\n\nI'm going to close this, because it appears to be a config problem rather than a\nbug.  If you really think it is a bug, it would be helpful to reproduce it with\na simpler set of rules before reopening.", "id": 65761, "time": "2004-10-26T17:01:42Z", "creator": "slive@apache.org", "creation_time": "2004-10-26T17:01:42Z", "is_private": false}]
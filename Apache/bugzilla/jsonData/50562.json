[{"count": 0, "tags": [], "creator": "yelu27@gmail.com", "is_private": false, "text": "I setup apache on xp. With the following URI:\nhttp://127.0.0.1/moin.cgi/aaa\u4f60\u597dbb\nApache set the PATH_INFO to /???\uffe5?\nI have checked the log that apache got right utf8 urlencoded uri. here is the log:\n\"GET /moin.cgi/aaa%E5%8C%97%E4%BA%AC%E9%82%AE%E7%94%B5bb HTTP/1.1\" 404 4982 \"-\" \"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.224 Safari/534.10\"\n\nIt seems that apache donnot translate non-ascii character right? Why it will do some conversion here?", "id": 143222, "time": "2011-01-09T21:50:01Z", "bug_id": 50562, "creation_time": "2011-01-09T21:50:01Z", "attachment_id": null}, {"text": "sorry, the PATH_INFO is /aaa???\uffe5?bb\n(In reply to comment #0)\n> I setup apache on xp. With the following URI:\n> http://127.0.0.1/moin.cgi/aaa\u4f60\u597dbb\n> Apache set the PATH_INFO to /???\uffe5?\n> I have checked the log that apache got right utf8 urlencoded uri. here is the\n> log:\n> \"GET /moin.cgi/aaa%E5%8C%97%E4%BA%AC%E9%82%AE%E7%94%B5bb HTTP/1.1\" 404 4982 \"-\"\n> \"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.10 (KHTML,\n> like Gecko) Chrome/8.0.552.224 Safari/534.10\"\n> \n> It seems that apache donnot translate non-ascii character right? Why it will do\n> some conversion here?", "tags": [], "creator": "yelu27@gmail.com", "is_private": false, "count": 1, "id": 143223, "time": "2011-01-09T21:52:52Z", "bug_id": 50562, "creation_time": "2011-01-09T21:52:52Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "wrowe@apache.org", "is_private": false, "text": "Wrong; Path info was the unicode value from your URI path.\n\nApache httpd didn't get this wrong, your CGI got it wrong and doesn't correctly handle non-ASCII input from the environment.  If your CGI environment's codepage is compatible with the characters transmitted, windows should be translating this itself into the appropriate MBCS.", "id": 143224, "time": "2011-01-09T23:20:41Z", "bug_id": 50562, "creation_time": "2011-01-09T23:20:41Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 50562, "attachment_id": null, "id": 143225, "time": "2011-01-10T02:27:50Z", "creator": "yelu27@gmail.com", "creation_time": "2011-01-10T02:27:50Z", "is_private": false, "text": "I have replaced that CGI with a C++ .exe to test the the environment vars set by apache, with URI \"/aaa\u4f60\u597dbbb\"\uff0c the exe surely get a PATH_INFO with \"/aaa\\x3f\\x3f\\x3f\\xa3\\xa4\\x3f\". ascii character is 1 byte so the environ vars are not ucs-2. \nps: I used both getenv and windows api GetEnvironmentVariable and the result are the same. The .exe is compiled without unicode support with VS.   \n(In reply to comment #2)\n> Wrong; Path info was the unicode value from your URI path.\n> \n> Apache httpd didn't get this wrong, your CGI got it wrong and doesn't correctly\n> handle non-ASCII input from the environment.  If your CGI environment's\n> codepage is compatible with the characters transmitted, windows should be\n> translating this itself into the appropriate MBCS."}, {"text": "I have replaced that CGI with a C++ .exe to test the the environment vars set by apache, with URI \"/aaa\u4f60\u597dbbb\"\uff0c the exe surely get a PATH_INFO with \"/aaa\\x3f\\x3f\\x3f\\xa3\\xa4\\x3f\". ascii character is 1 byte so the environ vars are not ucs-2. \nps: I used both getenv and windows api GetEnvironmentVariable and the result are the same. The .exe is compiled without unicode support with VS.   \n(In reply to comment #2)\n> Wrong; Path info was the unicode value from your URI path.\n> \n> Apache httpd didn't get this wrong, your CGI got it wrong and doesn't correctly\n> handle non-ASCII input from the environment.  If your CGI environment's\n> codepage is compatible with the characters transmitted, windows should be\n> translating this itself into the appropriate MBCS.", "tags": [], "creator": "yelu27@gmail.com", "is_private": false, "count": 4, "id": 143226, "time": "2011-01-10T02:37:13Z", "bug_id": 50562, "creation_time": "2011-01-10T02:37:13Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "wrowe@apache.org", "is_private": false, "text": "What does CHCP return at the command line?", "id": 143236, "time": "2011-01-10T12:26:45Z", "bug_id": 50562, "creation_time": "2011-01-10T12:26:45Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "yelu27@gmail.com", "is_private": false, "text": "If and only if I use Unicode win api-GetEnvironmentVariableW that I can get the right answer. C lib getenv and GetEnvironmentVariableA all returns wrong answer. Use chcp to change codepage makes the result no difference.\nI am puzzled. Which coding scheme is used by apache to set environ vars? What happened when passing them to CGI and getting them in CGI?  \n(In reply to comment #5)\n> What does CHCP return at the command line?", "id": 143263, "time": "2011-01-11T06:25:16Z", "bug_id": 50562, "creation_time": "2011-01-11T06:25:16Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 50562, "attachment_id": null, "id": 143324, "time": "2011-01-13T08:25:22Z", "creator": "yelu27@gmail.com", "creation_time": "2011-01-13T08:25:22Z", "is_private": false, "text": "After test, it is quite sure that apache has done wrong utf8 to unicode conversion with non-ascii charcater. It simply extend the bytes of utf-8 with \\x00 to get the unicode encoding. Here is the test:\n1. request a url http://127.0.0.1/\u4f60\u597d\n2. get \"PATH_INFO\" with windows api GetEnvironmentVariableW, it returns \"\\x00\\x2f \\x00\\xe4 \\x00\\xbd \\x00\\xa0 \\x00\\xe5 \\x00\\xa5 \\x00\\xbd\" which should be \"\\x00\\x2f \\x60\\x4f \\x7d\\x59\"\n3. my cmd codepage is cp936(GBK), so any programming language which depends on C lib to get this environment will get wrong result as long as a non-ascii uri is requeted.\nhope to check.\n(In reply to comment #5)\n> What does CHCP return at the command line?"}, {"count": 8, "tags": [], "bug_id": 50562, "attachment_id": null, "is_private": false, "id": 184552, "time": "2015-08-13T16:15:14Z", "creator": "JBlond@gmail.com", "creation_time": "2015-08-13T16:15:14Z", "text": "Works for me with PHP 5.6 and Apache 2.4.16 on Win 7\nMaybe this ticket can be closed"}]
[{"count": 0, "tags": [], "text": "In mod_dav.c, the function dav_send_one_response (around line 445) calls the \nfunction dav_xml_escape_uri, which in turn will call ap_escape_uri. \nThe ap_escape_uri function will translate all non-alphanumeric characters \nto a %xx encoding. \n \nBecause mod_dav claims both in the HTTP header as well as in the XML header \nthat all data is in utf-8, this gives wrong results if the XML parser on the \nreceiver side is strict. \n \nThis is an excerpt from a tcpdump session between cadaver and Apache: \n<D:response xmlns:i0=\"DAV:\" xmlns:lp0=\"DAV:\" \nxmlns:lp1=\"http://apache.org/dav/props/\" \nxmlns:i1=\"http://apache.org/dav/props/\"> \n<D:href>/Gel%f6schte%20Dateien/</D:href> \n<D:propstat> \n<D:prop> \n<lp0:getlastmodified xmlns:b=\"urn:uuid:c2f41010-65b3-11d1-a29f-00aa00c14882/\" \nb:dt=\"dateTime.rfc1123\">Sun, 04 Jul 2004 04:00:00 GMT</lp0:getlastmodified> \n<D:resourcetype><D:collection/></D:resourcetype> \n</D:prop> \n<D:status>HTTP/1.1 200 OK</D:status> \n</D:propstat> \n<D:propstat> \n<D:prop> \n<i0:getcontentlength/> \n<i1:executable/> \n<i0:checked-in/> \n<i0:checked-out/> \n</D:prop> \n<D:status>HTTP/1.1 404 Not Found</D:status> \n</D:propstat> \n</D:response> \n \nThe /Gel%f6schte%20Dateien/ href is \"Gel\u00f6schte Dateien\" in the filesystem. \nThe encoding /Gel%f6schte%20Dateien/  is is fine if the content transfer  \ntype and the XML encoding would be ISO-Latin1 or ISO-Latin15, but it is \ncompletly wrong with UTF-8. \n \nThere are two ways to fix the problem: \n1) blindly believe that the underlying OS is working with Latin1 file \n   names, and simply change the utf-8 coding to a latin1 coding in \n   the HTTP/XML headers \n2) write a correct dav_xml_escape_uri function, that doesn't use \n   ap_escape_uri, see  \n   http://sera.desuyo.net/WebDAV/mod_dav-1.0.2-1.3.6.patch  \n   for an example \n \nThe Windows WebDrive WebDAV client works with this wrong encoding, \nbut in KDE Konqueror 3.3 won't show the file name correctly. \n \nBye, \n \nJ\u00fcrgen", "attachment_id": null, "id": 69059, "creator": "zeller@rupert.franken.de", "time": "2004-12-29T17:07:34Z", "bug_id": 32877, "creation_time": "2004-12-29T17:07:34Z", "is_private": false}, {"count": 1, "tags": [], "creator": "zeller@rupert.franken.de", "is_private": false, "text": "I think Bug #22138 is related to this bug. ", "id": 69060, "time": "2004-12-29T17:13:09Z", "bug_id": 32877, "creation_time": "2004-12-29T17:13:09Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 32877, "attachment_id": null, "is_private": false, "id": 84338, "time": "2006-01-08T12:25:32Z", "creator": "julian.reschke@gmx.de", "creation_time": "2006-01-08T12:25:32Z", "text": "This is known, by design, and technically correct. Please don't confuse encoding\nof XML bodies with encoding of non-ASCII characters in URLs. These two things\nare unrelated.\n\nFor more information, please read\n<http://greenbytes.de/tech/webdav/draft-reschke-webdav-url-constraints-latest.html>\n(feedback appreciated).\n"}]
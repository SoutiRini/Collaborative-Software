[{"count": 0, "tags": [], "text": "Created attachment 30971\nTest file\n\nWhen a picture is inserted into sheet that has a chart, resulting file is corrupted and causes Excel crash in my case.\n\nCode used:\n\nWorkbook wb = WorkbookFactory.create(new File(\"Test_chart.xls\"));\nInputStream is = new FileInputStream(\"project-logo.jpg\");\nbyte[] bytes = IOUtils.toByteArray(is);\nint pictureIdx = wb.addPicture(bytes, Workbook.PICTURE_TYPE_JPEG);\nis.close();\n\nCreationHelper helper = wb.getCreationHelper();\nSheet sheet = wb.getSheetAt(0);\nDrawing drawing = sheet.createDrawingPatriarch();\nClientAnchor anchor = helper.createClientAnchor();\nanchor.setCol1(10);\nanchor.setRow1(2);\nanchor.setCol2(13);\nanchor.setRow2(8);\ndrawing.createPicture(anchor, pictureIdx);\nString file = \"Chart_and_picture.xls\";\nFileOutputStream fileOut = new FileOutputStream(file);\nwb.write(fileOut);\nfileOut.close();", "attachment_id": 30971, "bug_id": 55705, "id": 170842, "time": "2013-10-25T15:21:52Z", "creator": "davnroid@gmail.com", "creation_time": "2013-10-25T15:21:52Z", "is_private": false}, {"count": 1, "tags": [], "text": "From http://poi.apache.org/apidocs/org/apache/poi/ss/usermodel/Sheet.html#createDrawingPatriarch%28%29\n\n> Note that this will normally have the effect of removing any existing drawings on this sheet.\n\nSo, as documented, if you call createDrawingPatriarch on a sheet with existing drawings/charts, things will break\n\nYou'll either need to ensure you only add drawings to sheets without any, or volunteer to help enhance HSSF to support fetching the existing Drawing to modify. The latter would be great for everyone, but sadly in many years no-one has thus far volunteered to help write it / pay someone else to write it :/", "attachment_id": null, "bug_id": 55705, "id": 170843, "time": "2013-10-25T15:27:35Z", "creator": "apache@gagravarr.org", "creation_time": "2013-10-25T15:27:35Z", "is_private": false}]
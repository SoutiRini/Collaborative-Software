[{"count": 0, "tags": [], "bug_id": 28067, "attachment_id": null, "id": 54908, "time": "2004-03-30T22:45:20Z", "creator": "irusman@bea.com", "creation_time": "2004-03-30T22:45:20Z", "is_private": false, "text": "I found a bug in the Ant 1.5 on Windows 2003 expressing itself in ntvdm.exe \nexception:\n************************************************************************\nC:\\WINDOWS\\system32\\ntvdm.exe\nError while setting up environment for the application. Choose \"Close\" to \nterminate the application.\n************************************************************************\nIt happens when we source the current environment variables from the \nenvironment, rather than properties file, starting with \n<property environment=\"env\"/>\n\nDoing my research of the Ant 1.5 source code I established that while ant 1.5 \ncorrectly reports Windows 2003 as an operating system being run in a verbose \nmode, when it's coming to choosing the executable for the command line, it \nwrongly picks command.com instead of cmd.exe.\n\nI changed the logic of getProcEnvCommand() method in Execute.java to overcome \nthis problem so that it will work with all systems it worked before, plus \nwindows 2003.\n\nI'll describe the change to the source code in getProcEnvCommand() method in \nExecute.java of Ant 1.5:\n***************************************************************************\noriginal code snippet with its author's comments (bug: the execution thread \nwas testing \"if\" clause negatively and executing the code in \"else\" clause) \n***************************************************************************\n...\nelse if (Os.isFamily(\"windows\")) {\n            // Determine if we're running under XP/2000/NT or 98/95\n            if (!Os.isFamily(\"win9x\")) {\n                // Windows XP/2000/NT\n                String[] cmd = {\"cmd\", \"/c\", \"set\" };\n                return cmd;\n            } else {\n                // Windows 98/95\n                String[] cmd = {\"command.com\", \"/c\", \"set\" };\n                return cmd;\n            }\n...\n******************************************************************************\nnew code snippet substituting the original one; the execution thread tests \nnegatively the \"if\" clause and executes the \"else\" clause\n******************************************************************************\n\n //IR debuggged code\n        }else if (Os.isFamily(\"windows\")) {\n           // Determine if we're running under XP/2000/NT/2003 or 98/95\n            if (Os.isFamily(\"win9x\")) {\n                // Windows 98/95\n                String[] cmd = {\"command.com\", \"/c\", \"set\" };\n                return cmd;\n            } else {\n                // Windows XP/2000/NT/2003\n                String[] cmd = {\"cmd\", \"/c\", \"set\" };\n                return cmd;\n            }\n**************************************************************************\nI didn't check the source code of other Ant versions. If they have the same \nsnippet causing ntvdm.exe exception you may want to use my fix for them too. \n\nRegards,\nIrene.\n\nIrene Rusman.\nSr. Software Engineer,\nBEA Systems.\nirusman@bea.com\noffice: 408.570.8529"}, {"count": 1, "tags": [], "creator": "mbenson@apache.org", "is_private": false, "id": 54909, "attachment_id": null, "bug_id": 28067, "creation_time": "2004-03-30T23:23:15Z", "time": "2004-03-30T23:23:15Z", "text": "Fixed in CVS; thanks!"}, {"count": 2, "tags": [], "creator": "irusman@bea.com", "text": "I just looked at the source code of Ant 1.6.1. It has the same \nsnippet that will cause ntvdm.exe exception on Windows 2003. Please apply my \nfix for the versions Ant 1.5-1.6.1 and all the rest as needed.\n\nIrene.\n\nIrene Rusman\nSr. Software Engineer,\nBEA Systems,\nirusman@bea.com\n\n", "id": 54913, "attachment_id": null, "bug_id": 28067, "creation_time": "2004-03-31T00:13:15Z", "time": "2004-03-31T00:13:15Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 28067, "attachment_id": null, "text": "Re:  \"Please apply my fix for the versions Ant 1.5-1.6.1 and all the rest as \nneeded.\"\n\nFYI Generally these only get fixed in CVS for the next release...\n\nThanks,\nMatt", "id": 55113, "time": "2004-04-01T21:45:25Z", "creator": "mbenson@apache.org", "creation_time": "2004-04-01T21:45:25Z", "is_private": false}, {"count": 4, "tags": [], "text": "I am new to Apache but support an application that is using Ant 1.5 on Win2003. \nWe are encountering this error. Where can I get this fix?", "is_private": false, "id": 95347, "creator": "dschuda@us.ibm.com", "time": "2006-11-02T07:50:38Z", "bug_id": 28067, "creation_time": "2006-11-02T07:50:38Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "stevel@apache.org", "is_private": false, "id": 95350, "attachment_id": null, "bug_id": 28067, "creation_time": "2006-11-02T07:55:32Z", "time": "2006-11-02T07:55:32Z", "text": "Diane,\n\nYou need to get a later version of Ant, be it 1.6.5 or 1.7beta"}, {"count": 6, "tags": [], "bug_id": 28067, "text": "(In reply to Matt Benson from comment #1)\n> Fixed in CVS; thanks!\n\n(In reply to Matt Benson from comment #3)\n> Re:  \"Please apply my fix for the versions Ant 1.5-1.6.1 and all the rest as \n> needed.\"\n> \n> FYI Generally these only get fixed in CVS for the next release...\n> \n> Thanks,\n> Matt\n\n\ntest bugzilla", "id": 197420, "time": "2017-03-03T12:04:02Z", "creator": "2536822156@qq.com", "creation_time": "2017-03-03T12:04:02Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 28067, "text": "(In reply to Steve Loughran from comment #5)\n> Diane,\n> \n> You need to get a later version of Ant, be it 1.6.5 or 1.7beta\n\n\nhello test!", "id": 197421, "time": "2017-03-03T12:05:43Z", "creator": "2536822156@qq.com", "creation_time": "2017-03-03T12:05:43Z", "is_private": false, "attachment_id": null}]
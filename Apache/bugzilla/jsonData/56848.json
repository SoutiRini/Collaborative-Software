[{"count": 0, "tags": [], "bug_id": 56848, "attachment_id": null, "is_private": false, "id": 177137, "time": "2014-08-13T14:45:23Z", "creator": "dopey@moonteeth.com", "creation_time": "2014-08-13T14:45:23Z", "text": "Microsoft started using IETF BCP 47 language tags in Windows 8, so for languages such as Chinese Traditional (formerly zh-CN) and Chinese Simplified (formerly zh-TW) the default language tags are now zh-hant-CN and zh-hans-TW respectively.\n\nThe tomcat accept-language parsing method Request.parseLocalHeaders doesn't handle these tags properly.\n\nHere's the bcp 47 spec:\nhttp://tools.ietf.org/html/bcp47\n\nAnd here's a description of some of the changes in Java 7 for this:\nhttp://docs.oracle.com/javase/tutorial/i18n/locale/create.html\n\nWhere Java 7 is involved, the Locale.forLanguageTag method\nhttp://docs.oracle.com/javase/7/docs/api/java/util/Locale.html#forLanguageTag(java.lang.String)\n\nworks well assuming a fully compliant language tag.  Perhaps Tomcat should try to make use of this via reflection instead of parsing the entry?  The grammar for bcp47 tags doesn't make for easy parsing as various subsections of the tag are only valid if they match to particular ISO codes.\nsee:\nhttp://tools.ietf.org/html/bcp47#section-2.1"}, {"count": 1, "tags": [], "bug_id": 56848, "attachment_id": null, "is_private": false, "id": 177183, "time": "2014-08-15T12:47:58Z", "creator": "markt@apache.org", "creation_time": "2014-08-15T12:47:58Z", "text": "This has been fixed in 8.0.x for 8.0.11 onwards."}, {"count": 2, "tags": [], "bug_id": 56848, "is_private": false, "text": "This has also been fixed in 7.0.x for 7.0.56 onwards.", "id": 177517, "time": "2014-09-03T17:48:49Z", "creator": "markt@apache.org", "creation_time": "2014-09-03T17:48:49Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 56848, "attachment_id": null, "text": "The fix is Java 7 specific. Tomcat 7 has to run on Java 6 and there simply isn't the support for BCP47 in the Java 7 API.\n\nI'm leaning towards resolving this as WONTFIX.", "id": 177518, "time": "2014-09-03T18:54:40Z", "creator": "markt@apache.org", "creation_time": "2014-09-03T18:54:40Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 56848, "attachment_id": null, "text": "Would it make sense to try to use reflection and only support BCP47 if Java 7+ is used?", "id": 177523, "time": "2014-09-04T03:18:03Z", "creator": "dopey@moonteeth.com", "creation_time": "2014-09-04T03:18:03Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 56848, "attachment_id": null, "text": "I was in two minds whether or nor it was worth doing this. In the end, we had another requirement for something similar so this got included in the general solution. It will be in 7.0.60 onwards.", "id": 181400, "time": "2015-02-28T19:48:14Z", "creator": "markt@apache.org", "creation_time": "2015-02-28T19:48:14Z", "is_private": false}]
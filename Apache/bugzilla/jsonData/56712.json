[{"count": 0, "tags": [], "text": "The fix for bug 56698 (r1608443, r1608448) implemented an automated test for PersistenceManager. Reviewing the manager code to investigate the test failures, I see two issues:\n\nChecks that evaluate idle time of a session in PersistenceManagerBase typically do the following:\n\n> int timeIdle = (int) (session.getIdleTime() / 1000L);\n> if (timeIdle > maxIdleBackup) { ... }\n\nI see two errors in those two lines:\n\nError 1.\n----\nThe integer division performs truncation. Comparing the code with documentation, the condition there shall be\n\n> if (timeIdle >= maxIdleBackup) { ... }\n\nIt does no matter much for a real-world configuration where the times are expected to be tens of seconds, but it matters for the test case that wants to run fast.\n\nError 2.\n----\nStandardSession.getIdleTime() performs a validity check and can throw an ISE which is unexpected here. It shall be replaced with a call to session.getIdleTimeInternal().", "attachment_id": null, "bug_id": 56712, "id": 176358, "time": "2014-07-12T12:22:23Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-07-12T12:22:23Z", "is_private": false}, {"count": 1, "text": "Also,\ns/ getLastAccessedTime() / getLastAccessedTimeInternal() /", "bug_id": 56712, "is_private": false, "id": 176359, "time": "2014-07-12T12:27:53Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-07-12T12:27:53Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 56712, "attachment_id": null, "text": "Fixed in trunk by r1609920. It will be in 8.0.11 onwards.", "id": 176366, "time": "2014-07-12T13:59:08Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-07-12T13:59:08Z", "is_private": false}, {"count": 3, "tags": [], "text": "Fixed in Tomcat 7 by r1609924 and will be in 7.0.55 onwards.", "is_private": false, "bug_id": 56712, "id": 176367, "time": "2014-07-12T14:24:23Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-07-12T14:24:23Z", "attachment_id": null}]
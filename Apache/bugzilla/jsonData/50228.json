[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": 26266, "text": "Created attachment 26266\nwriterleak.war - Reproduces the leak\n\nWe have a web application that contains a SimpleTag that calls JspFragment.invoke(writer) with a custom java.io.Writer (actually, a NullWriter from commons-io).\n\nWhen this application is undeployed, it still remains in memory, as reported by the \"Find leaks\" tool in the manager webapp.\n\nI am attaching a simple sample application that reproduces the issue.\n\nTo reproduce:\n1. Deploy the app.\n2. Open index.jsp\n3. Undeploy the app.\n4. \"Find leaks\" reports that the app is still in memory\n\n\nUsing the Eclipse MAT tool I can see that the leak is caused by o.a.jasper.runtime.BodyContentImpl keeping a reference to the Writer,\nwhile the BodyContentImpl instance is cached in some pool referenced by a ThreadLocal.", "id": 141523, "time": "2010-11-07T03:27:43Z", "bug_id": 50228, "creation_time": "2010-11-07T03:27:43Z", "is_private": false}, {"count": 1, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": 26267, "text": "Created attachment 26267\nScreenshot from Eclipse MAT", "id": 141525, "time": "2010-11-07T03:30:06Z", "bug_id": 50228, "creation_time": "2010-11-07T03:30:06Z", "is_private": false}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "Fixed in trunk with r1032232 (will be in 7.0.5), proposed for 6.0.x.", "id": 141526, "time": "2010-11-07T10:21:27Z", "bug_id": 50228, "creation_time": "2010-11-07T10:21:27Z", "is_private": false}, {"count": 3, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "I will have to revert r1032232 \n\nIt breaks evaluation of tag bodies when there is no writer, e.g.\n<c:set var=\"myvar\">value<c:set>\nMyVar: [${myvar}]\n\nresults in \"MyVar: []\" being printed.\n\n\nA working fix would be to nullify the writer only if it has been set previously. Maybe there is some better way, though.", "id": 141778, "time": "2010-11-17T16:01:33Z", "bug_id": 50228, "creation_time": "2010-11-17T16:01:33Z", "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 50228, "text": "Fixed in trunk with r1037794 (will be in 7.0.5), proposed for 6.0.x.", "id": 141932, "time": "2010-11-22T12:45:17Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-11-22T12:45:17Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 50228, "text": "Fixed in 6.0 with r1041247 (will be in 6.0.30).", "id": 142272, "time": "2010-12-01T20:36:53Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-12-01T20:36:53Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "text": "When the option MultiViews sets it has priority on rewrite rule.\nWhen MultiViews option sets at the root Directory and AllowOverride is On, the RewriteRule ^ whatever.php not works if the URI contains a part of an existing filename. By example:\n/something go to whatever.php but /existing-filename go to the existing-filename.php instead of going to whatever.php\n\nIf MultiViews is not set, then RewriteRule !(^static) whatever.php works but it impede the negotiation content on static directory even if MultiViews sets on + at the <Directory /something/static>", "attachment_id": null, "bug_id": 56883, "id": 177331, "time": "2014-08-23T00:12:55Z", "creator": "eugenia@linux.com", "creation_time": "2014-08-23T00:12:55Z", "is_private": false}, {"count": 1, "tags": [], "creator": "eugenia@linux.com", "attachment_id": null, "is_private": false, "id": 177339, "time": "2014-08-24T16:51:03Z", "bug_id": 56883, "creation_time": "2014-08-24T16:51:03Z", "text": "Sorry, when I said \"but /existing-filename go to the existing-filename.php\" I should say \"but /existing-filename.php go to the existing-filename.php but /existing-filename causes an error 404 Not Found\""}, {"count": 2, "tags": [], "bug_id": 56883, "attachment_id": null, "id": 177340, "time": "2014-08-24T16:59:07Z", "creator": "covener@gmail.com", "creation_time": "2014-08-24T16:59:07Z", "is_private": false, "text": "This bug is marked as a regression. Where is it a regression from?"}, {"count": 3, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 177341, "time": "2014-08-24T17:25:26Z", "bug_id": 56883, "creation_time": "2014-08-24T17:25:26Z", "text": "It's difficult to follow what your expectation or even observations are for the interaction between the two modules when both are enabled.  A more self-contained example would help.\n\nDo things work better more as you expect if your rewriterules are not in htaccess/directory context?"}, {"count": 4, "tags": [], "text": "(In reply to Eric Covener from comment #3)\n> It's difficult to follow what your expectation or even observations are for\n> the interaction between the two modules when both are enabled.  A more\n> self-contained example would help.\n> \n> Do things work better more as you expect if your rewriterules are not in\n> htaccess/directory context?\n\nI'm sorry. My english is not good. I'm not sure if understand your answer but I will try to explain the problem again with an example.\n\nUntil Apache 2.4, if you put at your VirtualHost the following instructions:\n<Directory /path/to/application/root>\n    Options -Indexes FollowSymLinks MultiViews\n    RewriteEngine On\n</Directory>\nAnd then, in the .htaccess of /path/to/application/root writing this rule:\n\nRewriteEngine On\nRewriteRule ^ controller.php\n\nAll, absolutely all petitions go to controller.php without exceptions.\n\nSince Apache 2.4 the same instructions and the same rewrite rules at the same places causes that all petitions go to controller.php but with some exceptions. By example:\n\nUntil Apache 2.4, /something-like-that go to controller.php always.\n\nSince Apache 2.4, /something-like-that go to controller.php if not exists a file called something-like-that (.something like .php or .html, etc).\n\nIf exists a file called something-like-that, Apache 2.4.x generates an error 404 not found. But if you entering /something-like-that.extension in the URL, go to something-like-that.extension instead of controller.php", "attachment_id": null, "bug_id": 56883, "id": 177342, "time": "2014-08-24T18:28:57Z", "creator": "eugenia@linux.com", "creation_time": "2014-08-24T18:28:57Z", "is_private": false}, {"count": 5, "tags": [], "creator": "eugenia@linux.com", "attachment_id": null, "is_private": false, "id": 177343, "time": "2014-08-24T18:49:05Z", "bug_id": 56883, "creation_time": "2014-08-24T18:49:05Z", "text": "Sorry again. I get confused a lot when I write in other language.\n<Directory /path/to/application/root>\n    ....\n    RewriteEngine On <-- NO! AllowOverride All\n</Directory>"}, {"count": 6, "text": "I cannot really see any misbehavior, any idea where the recreate is wrong?\n\nAlias /PR56883 /tmp/PR56883\n<Directory /tmp/PR56883>\nAllowOverride none\nOptions +MultiViews\nrequire all granted\nRewriteEngine on\nRewriteCond %{REQUEST_URI} !=/PR56883/other.html\nRewriteRule ^ /PR56883/other.html\n</directory>\n\n$ wget -q http://localhost/PR56883/index -O-\n<html><body><h1>other.html<h1></body></html>\n$ wget -q http://localhost/PR56883/other -O-\n<html><body><h1>other.html<h1></body></html>\n$ wget -q http://localhost/PR56883/XXX -O-\n<html><body><h1>other.html<h1></body></html>\n$ ls -1 /tmp/PR56883/\nindex.html\nother.html\n\nWhen I disable mod_rewrite, negotiation works for the first two URL's as expected.", "bug_id": 56883, "attachment_id": null, "id": 177357, "time": "2014-08-25T16:31:30Z", "creator": "covener@gmail.com", "creation_time": "2014-08-25T16:31:30Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "eugenia@linux.com", "attachment_id": null, "id": 177360, "time": "2014-08-25T17:43:48Z", "bug_id": 56883, "creation_time": "2014-08-25T17:43:48Z", "is_private": false, "text": "(In reply to Eric Covener from comment #6)\n> I cannot really see any misbehavior, any idea where the recreate is wrong?\n> \n> Alias /PR56883 /tmp/PR56883\n> <Directory /tmp/PR56883>\n> AllowOverride none\n> Options +MultiViews\n> require all granted\n> RewriteEngine on\n> RewriteCond %{REQUEST_URI} !=/PR56883/other.html\n> RewriteRule ^ /PR56883/other.html\n> </directory>\n> \n> $ wget -q http://localhost/PR56883/index -O-\n> <html><body><h1>other.html<h1></body></html>\n> $ wget -q http://localhost/PR56883/other -O-\n> <html><body><h1>other.html<h1></body></html>\n> $ wget -q http://localhost/PR56883/XXX -O-\n> <html><body><h1>other.html<h1></body></html>\n> $ ls -1 /tmp/PR56883/\n> index.html\n> other.html\n> \n> When I disable mod_rewrite, negotiation works for the first two URL's as\n> expected.\n\nEric, I think that your recreation could be out of the context that I exposed. I'm not sure. But if you want to recreate the problem, please, try this:\n\n1) create the virtual host file (or edit it) with the following code:\n<VirtualHost *:80>\n    ServerName localhost\n    DocumentRoot /var/www/myapp/public\n    \n    <Directory /var/www/myapp/public>\n        Options -Indexes +MultiViews\n        AllowOverride All\n    </Directory>\n    \n    ErrorLog /var/www/myapp/error.log\n    CustomLog /var/www/myapp/access.log combined\n\n</VirtualHost>\n\n\n2) create only 3 files: foo.php, bar.php and .htaccess and redirect all petitions to foo.php:\n\n\nmkdir -p /var/www/myapp/public\necho \"Foo\" > /var/www/myapp/public/foo.php\necho \"Bar\" > /var/www/myapp/public/bar.php\necho \"RewriteEngine On\" > /var/www/myapp/public/.htaccess\necho \"RewriteRule ^ foo.php\" >> /var/www/myapp/public/.htaccess\n\n3) Now, try to get http://localhost, http://localhost/whatever and http://localhost/bar. The last URI get an error 404.\n\n4) But now, create a file called bar.html and try to get http://localhost/bar again. Now works but this is not logic.\n\n5) Remove bar.html and try to supress MultiViews from Virtual Host. Restart Apache and try again. Now works.\n\nAt the following link, I copied stdout from some tests made:\nhttp://cursos.eugeniabahit.com/pastebin/codigofuente/ver/24\n\nI hope this, can help to understand the problem."}, {"count": 8, "text": "Were you getting this error-level message the entre time? It would have been helpful to include it if so:\n\n[Mon Aug 25 21:33:47.276658 2014] [negotiation:error] [pid 3997:tid 140044101080832] [client 127.0.0.1:47304] AH00687: Negotiation: discovered file(s) matching request: /var/www/myapp/public/bar (None could be negotiated).\n\n---\n    /* We found some file names that matched.  None could be served.\n     * Rather than fall out to autoindex or some other mapper, this\n     * request must die.\n     */\n    if (anymatch && !neg->avail_vars->nelts) {\n        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,\n                      \"Negotiation: discovered file(s) matching request: %s\"\n                      \" (None could be negotiated).\",\n                      r->filename);\n        return HTTP_NOT_FOUND;\n    }\n---\n\nYour scenario worked for me when I told httpd that .php had some mime type so mod_negotiation would temporarily negotiate it.  That's why my HTML test worked.\n\nFor me, 2.2 behaved no differently.  Maybe your 2.2 config just has a different set of types configured.", "bug_id": 56883, "attachment_id": null, "id": 177361, "time": "2014-08-26T01:37:48Z", "creator": "covener@gmail.com", "creation_time": "2014-08-26T01:37:48Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "creator": "eugenia@linux.com", "attachment_id": null, "id": 177364, "time": "2014-08-26T02:43:39Z", "bug_id": 56883, "creation_time": "2014-08-26T02:43:39Z", "is_private": false, "text": "Yes, the error.log shows an error like that. It's very true.\nI had not tried changing (or copy) the apache configuration file from 2.2 to 2.4. Neither I had tried with different distros. That is my fault :(\nSo, it's not an Apache bug, then. The problem is that the Apache package from Ubuntu repository not come with the default Apache configuration file. It comes with an \"Ubuntu\" configuration. I hurried to getting a conclusion. Sorry to have wasted your time and thank you so much for your dedication.\nI will changing the Apache configuration file :)"}, {"count": 10, "attachment_id": null, "bug_id": 56883, "is_private": false, "id": 177374, "time": "2014-08-26T13:40:46Z", "creator": "eugenia@linux.com", "creation_time": "2014-08-26T13:40:46Z", "tags": [], "text": "Eric, I try again by copying the Apache configuration file from my own configuration in 2.2 to a clean installation in 2.4 and the problem persists.\nThe problem is real and is independent of the Linux distro.We talking about of an identical configuration in both versions on clean installations.\nIt's not resolved to me. I'm seeing the problem when (insist) MultiViews is present at the Directory tag and AllowOverride is on (set it like \"All\").\n\nHow do you explain that mod_negotiation in Apache 2.2 not trying to resolve the URI if mod_rewrite is active and it (mod_rewrite) can resolve it and then, in Apache 2.4 is mod_negotiation who try to resolve the same URI and if it can't ending all without intervention of mod_rewrite? I understand the 404 error but it is only a simple consequence of previous description.\n\nLike you said yesterday, I thought I was wrong. But today, after new several tests, the problem persist. So, I insist in that it is a bug."}, {"count": 11, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 177375, "time": "2014-08-26T13:48:36Z", "bug_id": 56883, "creation_time": "2014-08-26T13:48:36Z", "text": "AFAICT 2.2 behaves the same if you enable multiviews, the prefix exists, but the file on-disk does not have a known mimetype (see e.g. MultiViewsMatch).   \n\nI don't know what compiled-in defaults or behaviors might differ, but there were no obvious ones to me.\n\nIf you have the requirement to use negotiation, rewrite, and extensions that don't have mimetypes you'll need to arrange for negotiation not to fail (multiviewsmatch any, addtype, etc).\n\nI'd suggest consulting the users mailing list or serverfault.com for further discussion, bugzilla is strictly to record bugs against httpd."}, {"count": 12, "tags": [], "creator": "eugenia@linux.com", "attachment_id": null, "text": "(In reply to Eric Covener from comment #11)\n> AFAICT 2.2 behaves the same if you enable multiviews, the prefix exists, but\n> the file on-disk does not have a known mimetype (see e.g. MultiViewsMatch). \n\nSorry Eric but this is not a problem, because yes that it have a known mimetype.\nThe MIME type is not the problem. Therefore I said before that I tested with the same configuration (including the declarations of MIME types).", "id": 177376, "time": "2014-08-26T13:58:19Z", "bug_id": 56883, "creation_time": "2014-08-26T13:58:19Z", "is_private": false}]
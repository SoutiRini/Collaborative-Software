[{"count": 0, "tags": [], "bug_id": 34619, "attachment_id": null, "text": "Please consider the build file below. The basedir attribute of the jar task is\nset to \".\". With this attribute the result is chaos (see below); without the\nattribute the result is correct.\n\n<project name=\"test\" basedir=\".\" default=\"jar\">\n\t<property name=\"name\" value=\"antbug\"/>\n\t<property name=\"sandbox\" value=\"sandbox\"/>\n\t<property name=\"container\" value=\"../${name}.jar\"/>\n\t<target name=\"jar\">\n\t\t<delete file=\"${container}\"/>\n\t\t<jar destfile=\"${container}\" basedir=\".\">\n\t\t\t<fileset dir=\".\">\n\t\t\t\t<include name=\"*.txt\"/>\n\t\t\t</fileset>\n\t\t\t<fileset dir=\"${sandbox}\">\n\t\t\t\t<include name=\"*.txt\"/>\n\t\t\t\t<exclude name=\"*.ini\"/>\n\t\t\t</fileset>\n\t\t</jar>\n\t</target>\n</project>\n\nGiven these files:\n\t[C:\\ant-bug\\build.xml]\n\t[C:\\ant-bug\\readme.txt]\n\t[C:\\ant-bug\\sandbox\\exclude_me.ini]\n\t[C:\\ant-bug\\sandbox\\include_me.txt]\nthe result (using 'jar tf antbug.jar') with the jar-basedir is:\n\t[META-INF]\n\t[META-INF/MANIFEST.MF]\n\t[readme.txt]\n\t[include_me.txt]\nwhilst the result without the jar-basedir is:\n\t[META-INF/]\n\t[META-INF/MANIFEST.MF]\n\t[build.xml]\n\t[readme.txt]\n\t[sandbox/]\n\t[sandbox/exclude_me.ini]\n\t[sandbox/include_me.txt]\n\t[readme.txt]\n\t[include_me.txt]\nThe excludes are ignored, and everything (except the manifest) is added twice:\nonce with path-information and once without path-information.\n\nMy diagnostics:\n------- Ant diagnostics report -------\nApache Ant version 1.6.2 compiled on July 16 2004\n\n-------------------------------------------\n Implementation Version (JDK1.2+ only)\n-------------------------------------------\ncore tasks     : 1.6.2\noptional tasks : 1.6.2\n\n-------------------------------------------\n ANT_HOME/lib jar listing\n-------------------------------------------\nant.home: C:\\Tools\\apache-ant-1.6.2\\bin\\..\nant-antlr.jar (5659 bytes)\nant-apache-bcel.jar (8609 bytes)\nant-apache-bsf.jar (12589 bytes)\nant-apache-log4j.jar (3014 bytes)\nant-apache-oro.jar (48015 bytes)\nant-apache-regexp.jar (3706 bytes)\nant-apache-resolver.jar (4073 bytes)\nant-commons-logging.jar (3856 bytes)\nant-commons-net.jar (35242 bytes)\nant-icontract.jar (9713 bytes)\nant-jai.jar (21351 bytes)\nant-javamail.jar (6753 bytes)\nant-jdepend.jar (8152 bytes)\nant-jmf.jar (6596 bytes)\nant-jsch.jar (22604 bytes)\nant-junit.jar (73665 bytes)\nant-launcher.jar (8673 bytes)\nant-netrexx.jar (9990 bytes)\nant-nodeps.jar (407573 bytes)\nant-starteam.jar (35463 bytes)\nant-stylebook.jar (2320 bytes)\nant-swing.jar (6755 bytes)\nant-trax.jar (68833 bytes)\nant-vaj.jar (48623 bytes)\nant-weblogic.jar (14355 bytes)\nant-xalan1.jar (4457 bytes)\nant-xslp.jar (2236 bytes)\nant.jar (999966 bytes)\nxercesImpl.jar (1010675 bytes)\nxml-apis.jar (124724 bytes)\n\n-------------------------------------------\n Tasks availability\n-------------------------------------------\nimage : Missing dependency com.sun.media.jai.codec.FileSeekableStream\nsshexec : Missing dependency com.jcraft.jsch.UserInfo\nscp : Missing dependency com.jcraft.jsch.UserInfo\ncvsversion : Not Available\njdepend : Missing dependency jdepend.xmlui.JDepend\njunit : Missing dependency junit.framework.Test\n\n-------------------------------------------\n org.apache.env.Which diagnostics\n-------------------------------------------\nNot available.\nDownload it at http://xml.apache.org/commons/\n\n-------------------------------------------\n XML Parser information\n-------------------------------------------\nXML Parser : org.apache.xerces.jaxp.SAXParserImpl\nXML Parser Location: C:\\Tools\\apache-ant-1.6.2\\lib\\xercesImpl.jar\n\n-------------------------------------------\n System properties\n-------------------------------------------\njava.runtime.name : Java(TM) 2 Runtime Environment, Standard Edition\nsun.boot.library.path : C:\\j2sdk1.4.2_07\\jre\\bin\njava.vm.version : 1.4.2_07-b05\nant.library.dir : C:\\Tools\\apache-ant-1.6.2\\lib\njava.vm.vendor : Sun Microsystems Inc.\njava.vendor.url : http://java.sun.com/\npath.separator : ;\njava.vm.name : Java HotSpot(TM) Client VM\nfile.encoding.pkg : sun.io\nuser.country : NL\nsun.os.patch.level : Service Pack 2\njava.vm.specification.name : Java Virtual Machine Specification\nuser.dir : C:\\ant-bug\njava.runtime.version : 1.4.2_07-b05\njava.awt.graphicsenv : sun.awt.Win32GraphicsEnvironment\njava.endorsed.dirs : C:\\j2sdk1.4.2_07\\jre\\lib\\endorsed\nos.arch : x86\njava.io.tmpdir : C:\\TEMP\\\nline.separator : \n\njava.vm.specification.vendor : Sun Microsystems Inc.\nuser.variant : \nos.name : Windows XP\nant.home : C:\\Tools\\apache-ant-1.6.2\\bin\\..\nsun.java2d.fontpath : \njava.library.path :\nC:\\j2sdk1.4.2_07\\bin;.;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\basa\\bin;C:\\oracle\\ora92\\bin;C:\\j2sdk1.4.2_07\\bin;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem\njava.specification.name : Java Platform API Specification\njava.class.version : 48.0\njava.util.prefs.PreferencesFactory : java.util.prefs.WindowsPreferencesFactory\nos.version : 5.1\nuser.home : C:\\Documents and Settings\\Alberts\nuser.timezone : Europe/Berlin\njava.awt.printerjob : sun.awt.windows.WPrinterJob\nfile.encoding : Cp1252\njava.specification.version : 1.4\njava.class.path :\nC:\\Tools\\apache-ant-1.6.2\\bin\\..\\lib\\ant-launcher.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-antlr.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-apache-bcel.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-apache-bsf.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-apache-log4j.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-apache-oro.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-apache-regexp.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-apache-resolver.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-commons-logging.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-commons-net.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-icontract.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-jai.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-javamail.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-jdepend.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-jmf.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-jsch.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-junit.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-launcher.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-netrexx.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-nodeps.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-starteam.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-stylebook.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-swing.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-trax.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-vaj.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-weblogic.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-xalan1.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant-xslp.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\ant.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\xercesImpl.jar;C:\\Tools\\apache-ant-1.6.2\\lib\\xml-apis.jar;C:\\j2sdk1.4.2_07\\lib\\tools.jar\nuser.name : Alberts\njava.vm.specification.version : 1.0\njava.home : C:\\j2sdk1.4.2_07\\jre\nsun.arch.data.model : 32\nuser.language : nl\njava.specification.vendor : Sun Microsystems Inc.\nawt.toolkit : sun.awt.windows.WToolkit\njava.vm.info : mixed mode\njava.version : 1.4.2_07\njava.ext.dirs : C:\\j2sdk1.4.2_07\\jre\\lib\\ext\nsun.boot.class.path :\nC:\\j2sdk1.4.2_07\\jre\\lib\\rt.jar;C:\\j2sdk1.4.2_07\\jre\\lib\\i18n.jar;C:\\j2sdk1.4.2_07\\jre\\lib\\sunrsasign.jar;C:\\j2sdk1.4.2_07\\jre\\lib\\jsse.jar;C:\\j2sdk1.4.2_07\\jre\\lib\\jce.jar;C:\\j2sdk1.4.2_07\\jre\\lib\\charsets.jar;C:\\j2sdk1.4.2_07\\jre\\classes\njava.vendor : Sun Microsystems Inc.\nfile.separator : \\\njava.vendor.url.bug : http://java.sun.com/cgi-bin/bugreport.cgi\nsun.io.unicode.encoding : UnicodeLittle\nsun.cpu.endian : little\nsun.cpu.isalist : pentium i486 i386", "id": 74121, "time": "2005-04-26T12:03:31Z", "creator": "bas@traserv.com", "creation_time": "2005-04-26T12:03:31Z", "is_private": false}, {"count": 1, "attachment_id": null, "creator": "jan@materne.de", "is_private": false, "id": 74122, "time": "2005-04-26T12:08:57Z", "bug_id": 34619, "creation_time": "2005-04-26T12:08:57Z", "tags": [], "text": "The manual sais \"This task forms an implicit FileSet and supports all \nattributes of <fileset> (dir becomes basedir) as well as the nested <include>, \n<exclude> and <patternset> elements.\"\n\nThat means, specifying the basedir attribute results in a fileset - in your \ncase the third fileset. Rewriting your jar command without that would be\n\n<jar destfile=\"${container}\" basedir=\".\">\n\n    <!-- the implicitly set one -->\n    <fileset dir=\".\"/>\n\n    <fileset dir=\".\">\n        <include name=\"*.txt\"/>\n    </fileset>\n    <fileset dir=\"${sandbox}\">\n        <include name=\"*.txt\"/>\n        <exclude name=\"*.ini\"/>\n    </fileset>\n</jar>\n\n\nUsing that - is your result ok then?"}, {"count": 2, "attachment_id": null, "bug_id": 34619, "text": "This is how it is supposed to be.\n\nThe basedir attribute is a shorthand for an additional\n<fileset dir=\".\"/> in your case.\n\nIf you don't want that behavior, don't use the attribute.", "id": 74123, "time": "2005-04-26T12:13:40Z", "creator": "bodewig@apache.org", "creation_time": "2005-04-26T12:13:40Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 34619, "attachment_id": null, "is_private": false, "id": 74129, "time": "2005-04-26T13:01:56Z", "creator": "bas@traserv.com", "creation_time": "2005-04-26T13:01:56Z", "text": "Mea culpa"}]
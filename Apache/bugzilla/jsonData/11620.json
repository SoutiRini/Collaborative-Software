[{"count": 0, "tags": [], "bug_id": 11620, "attachment_id": null, "text": "When I use telnet task to read a string from a big output, like: tail -f XXX.log,\n\nThe read sub task \ncould not found the string I am looking for, although it's in the output.\n\nOn the other hand. Ant only \nlog the out put after it found the string pattern, usually, people like to see the telnet output in \nthe process, the performance here is not critical.\n\nHere I attached the code I made the change for \nsolving these 2 problems:\n        public void waitForString(String s, Integer timeout) {\n            InputStream \nis = this.getInputStream();\n            try {\n                StringBuffer sb = new StringBuffer(1024);\n                if (timeout == null \n|| timeout.intValue() == 0) {\n                    while (sb.toString().indexOf(s) == -1){\n\t\t\t    char cc = (char) \nis.read();\n\t\t\t    if(cc=='\\n'||cc=='\\r'){\n\t\t\t\tif(!sb.toString().trim().equals(\"\"))\n\t        \t\t        \nlog(sb.toString(), Project.MSG_INFO);\n\t\t\t\tsb.delete(0,sb.length());\n\t\t\t    }\n\t\t\t    else\n\t\t\t\tsb.append(cc);\n                    }\n                } \nelse {\n                    Calendar endTime = Calendar.getInstance();\n                    endTime.add(Calendar.SECOND, \ntimeout.intValue());\n                    while (sb.toString().indexOf(s) == -1) {\n                        while \n(Calendar.getInstance().before(endTime) &&\n                        is.available() == 0) {\n                            Thread.sleep(250);\n                        }\n                        if \n(is.available() == 0) {\n                            throw new BuildException(\n                                \"Response timed-out waiting for \\\"\"+s+'\\\"',\n                                \ngetLocation());\n                        }\n\t\t\t    char cc = (char) is.read();\n\t\t\t    if(cc=='\\n'||cc=='\\r' && \nsb.length()>0){\n\t\t\t\tif(!sb.toString().trim().equals(\"\"))\n\t        \t\t        log(sb.toString(), \nProject.MSG_INFO);\n\t\t\t\tsb.delete(0,sb.length());\n\t\t\t    }\n\t\t\t    else\n\t\t\t\tsb.append(cc);\n                    }\n                }\n                log(sb.toString(), \nProject.MSG_INFO);\n            } catch (BuildException be) {\n                throw be;\n            } catch (Exception e) {\n                throw new \nBuildException(e, getLocation());\n            }\n        }", "id": 20886, "time": "2002-08-11T20:12:51Z", "creator": "orientphoebus@yahoo.com", "creation_time": "2002-08-11T20:12:51Z", "is_private": false}, {"count": 1, "tags": [], "creator": "sbailliez@apache.org", "attachment_id": null, "id": 21013, "time": "2002-08-14T09:34:50Z", "bug_id": 11620, "creation_time": "2002-08-14T09:34:50Z", "is_private": false, "text": "Please submit your patch using a 'cvs diff -u' to make it easier to read the \nchanges."}, {"count": 2, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "is_private": false, "id": 34051, "time": "2003-03-28T13:55:34Z", "bug_id": 11620, "creation_time": "2003-03-28T13:55:34Z", "text": "I can see how your changed code makes the output go to the logging system, but\nI don't see how it addresses the problem of not finding what you were looking for.\n\nFurtermore, if I applied your changes, reads waiting for strings that contained\ncariage returns or line feeds will become impossible."}, {"count": 3, "tags": [], "bug_id": 11620, "attachment_id": null, "text": "As your first problem isn't addressed in the patch at all (even though you claim\nit fixes it), I'm moving this to an enhancement request for the second \"problem\".", "id": 44684, "time": "2003-09-25T14:26:38Z", "creator": "bodewig@apache.org", "creation_time": "2003-09-25T14:26:38Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 11620, "attachment_id": null, "text": "Closing, as revision 1.21 of the Telnet task introduced output of timed out \ntelnet sessions to debug output.\n\nFeel free to reopen if you want it to also output for non-timed out sessions.", "id": 46253, "time": "2003-10-24T17:03:19Z", "creator": "larry.shatzer@mirotechnologies.com", "creation_time": "2003-10-24T17:03:19Z", "is_private": false}]
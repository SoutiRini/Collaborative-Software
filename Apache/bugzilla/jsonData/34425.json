[{"count": 0, "attachment_id": null, "bug_id": 34425, "is_private": false, "id": 73598, "time": "2005-04-13T04:54:33Z", "creator": "lt@basecity.com", "creation_time": "2005-04-13T04:54:33Z", "tags": [], "text": "Manifest task try to trancate multi-byte attributes by substring it to find out\nwhich position of the 72nd byte is, but when a line has more than 72 bytes, but\nhas less than 72 characters, a runtime exception will be raised. Besides, the\nsource code just call String.getBytes() method, that method depends on the\ndefault charset of the platform, it should be change to getBytes(\"UTF-8\"),\nbecause a menifest is supposed to be written in UTF-8.\n\nand below is my patch:\nIndex: src/main/org/apache/tools/ant/taskdefs/Manifest.java\n===================================================================\nRCS file: /home/cvspublic/ant/src/main/org/apache/tools/ant/taskdefs/Manifest.java,v\nretrieving revision 1.48.2.5\ndiff -u -r1.48.2.5 Manifest.java\n--- src/main/org/apache/tools/ant/taskdefs/Manifest.java\t9 Mar 2004 17:01:33\n-0000\t1.48.2.5\n+++ src/main/org/apache/tools/ant/taskdefs/Manifest.java\t11 Apr 2005 03:56:32 -0000\n@@ -300,11 +300,11 @@\n         private void writeValue(PrintWriter writer, String value)\n              throws IOException {\n             String line = name + \": \" + value;\n-            while (line.getBytes().length > MAX_LINE_LENGTH) {\n+            while (line.getBytes(\"UTF-8\").length > MAX_LINE_LENGTH) {\n                 // try to find a MAX_LINE_LENGTH byte section\n-                int breakIndex = MAX_SECTION_LENGTH;\n+                int breakIndex = line.length() > MAX_SECTION_LENGTH ?\nMAX_SECTION_LENGTH : line.length();\n                 String section = line.substring(0, breakIndex);\n-                while (section.getBytes().length > MAX_SECTION_LENGTH\n+                while (section.getBytes(\"UTF-8\").length > MAX_SECTION_LENGTH\n                      && breakIndex > 0) {\n                     breakIndex--;\n                     section = line.substring(0, breakIndex);"}, {"count": 1, "tags": [], "creator": "lt@basecity.com", "text": "Created attachment 14697\npatch for manifest", "id": 73599, "time": "2005-04-13T04:55:43Z", "bug_id": 34425, "creation_time": "2005-04-13T04:55:43Z", "is_private": false, "attachment_id": 14697}, {"count": 2, "tags": [], "creator": "jkf@apache.org", "text": "This issue should have been solved along with the issue 37548\nplease verify against HEAD", "id": 91074, "time": "2006-07-10T21:59:01Z", "bug_id": 34425, "creation_time": "2006-07-10T21:59:01Z", "is_private": false, "attachment_id": null}]
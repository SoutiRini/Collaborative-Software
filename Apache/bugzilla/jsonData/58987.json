[{"count": 0, "tags": [], "creator": "sebb@apache.org", "text": "I have two very similar-looking CSV files.\nOne is processed OK, the other generates lots of stack traces.\n\nThe difference is that one is missing a column, however this is extremely hard to determine this from the log file.\n\nThere are several issues here:\n\nThe error message should explain what the code was trying to do in terms of the field name(s) it is having problems with. The stack trace is not really helpful and should be dropped. It would probably help to print the error message(s) to standard out as well as the log file.\n\nThe sample number is shown as #0. It's not clear if that is supposed to be zero-based or if the count is not being incremented at all.\n\nSince the reporter relies on being able to parse the CSV, and the CSV file format is not fixed, it seems to me that the solution is to insist on having the field names in the file. There's no way of knowing whether the CSV file corresponds with the current property settings - the most that one can hope to check is whether the number of columns in the CSV agrees with the settings.\nThe code does not even do that.", "id": 188313, "time": "2016-02-09T19:47:20Z", "bug_id": 58987, "creation_time": "2016-02-09T19:47:20Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Did you run your test on last nightly build ?\nCan you provide a sample and the config of user.properties used in your test ?\n\nThanks", "id": 188314, "time": "2016-02-09T19:50:00Z", "bug_id": 58987, "creation_time": "2016-02-09T19:50:00Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "sebb@apache.org", "is_private": false, "id": 188316, "attachment_id": 33540, "bug_id": 58987, "creation_time": "2016-02-09T20:01:33Z", "time": "2016-02-09T20:01:33Z", "text": "Created attachment 33540\nThis parses OK"}, {"count": 3, "tags": [], "bug_id": 58987, "text": "Created attachment 33541\nThis does not", "id": 188317, "time": "2016-02-09T20:01:58Z", "creator": "sebb@apache.org", "creation_time": "2016-02-09T20:01:58Z", "is_private": false, "attachment_id": 33541}, {"count": 4, "attachment_id": 33542, "creator": "sebb@apache.org", "is_private": false, "id": 188318, "time": "2016-02-09T20:03:29Z", "bug_id": 58987, "creation_time": "2016-02-09T20:03:29Z", "tags": [], "text": "Created attachment 33542\nSample log output"}, {"count": 5, "attachment_id": null, "creator": "sebb@apache.org", "is_private": false, "id": 188319, "time": "2016-02-09T20:04:25Z", "bug_id": 58987, "creation_time": "2016-02-09T20:04:25Z", "tags": [], "text": "I used current trunk freshly built. No changes to jmeter.properties"}, {"count": 6, "tags": [], "bug_id": 58987, "text": "Did you face the issue with a CSV generated with current default settings ?\nThanks", "id": 188320, "time": "2016-02-09T20:07:43Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-09T20:07:43Z", "is_private": false, "attachment_id": null}, {"count": 7, "text": "(In reply to Philippe Mouawad from comment #6)\n> Did you face the issue with a CSV generated with current default settings ?\n> Thanks\n\nNo, but that's not the issue.\n\nThe problem is that generating a report for an existing CSV relies on it having been created with the same properties. That is not guaranteed, especially if the defaults are changed. And users can change the values. And if the CSV was created by a GUI listener, it may not have the same settings.", "bug_id": 58987, "is_private": false, "id": 188322, "time": "2016-02-09T20:13:08Z", "creator": "sebb@apache.org", "creation_time": "2016-02-09T20:13:08Z", "tags": [], "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 58987, "attachment_id": null, "text": "(In reply to Sebb from comment #7)\n> (In reply to Philippe Mouawad from comment #6)\n> > Did you face the issue with a CSV generated with current default settings ?\n> > Thanks\n> \n> No, but that's not the issue.\n> \n> The problem is that generating a report for an existing CSV relies on it\n> having been created with the same properties. That is not guaranteed,\n> especially if the defaults are changed. And users can change the values. And\n> if the CSV was created by a GUI listener, it may not have the same settings.\n\nThis would be nice to fix indeed but be aware that it is for example a limitation for example of JMeter-Plugins and I wonder if all current listeners in JMeter do not have this issue.", "id": 188323, "time": "2016-02-09T20:22:30Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-09T20:22:30Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 58987, "text": "(In reply to Philippe Mouawad from comment #8)\n> (In reply to Sebb from comment #7)\n> > (In reply to Philippe Mouawad from comment #6)\n> > > Did you face the issue with a CSV generated with current default settings ?\n> > > Thanks\n> > \n> > No, but that's not the issue.\n> > \n> > The problem is that generating a report for an existing CSV relies on it\n> > having been created with the same properties. That is not guaranteed,\n> > especially if the defaults are changed. And users can change the values. And\n> > if the CSV was created by a GUI listener, it may not have the same settings.\n> \n> This would be nice to fix indeed but be aware that it is for example a\n> limitation for example of JMeter-Plugins and I wonder if all current\n> listeners in JMeter do not have this issue.\n\nNo idea what you mean. What limitation are you referring to?", "id": 188324, "time": "2016-02-09T20:27:05Z", "creator": "sebb@apache.org", "creation_time": "2016-02-09T20:27:05Z", "is_private": false, "attachment_id": null}, {"count": 10, "text": "With jmeter-plugins, if you try to generate graphs from a CSV file generated with different jmeter properties, it will also fail.\nYou need to have the same properties that led to the CSV file.", "bug_id": 58987, "is_private": false, "id": 188325, "time": "2016-02-09T20:31:59Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-09T20:31:59Z", "tags": [], "attachment_id": null}, {"count": 11, "tags": [], "text": "(In reply to Philippe Mouawad from comment #10)\n> With jmeter-plugins, if you try to generate graphs from a CSV file generated\n> with different jmeter properties, it will also fail.\n> You need to have the same properties that led to the CSV file.\n\nI see. This is the same with JMeter's Listeners.\n\nBut that does not mean that nothing can or should be done to improve the behaviour of report dashboard. It's particularly important for this listener as it is new, and so users will want to apply it to existing CSV files.\n\nSo we should:\n- log/print a warning if there are no field names\n- if no field names, then check that the number fields agrees with the properties, and quit if there is a mismatch\n- if there is a parsing error, report the record, field number, and expected field name to enable the problem to be debugged.\n\n\nSome of these improvements can also be applied to the other JMeter listeners.", "attachment_id": null, "bug_id": 58987, "id": 188328, "time": "2016-02-09T22:44:54Z", "creator": "sebb@apache.org", "creation_time": "2016-02-09T22:44:54Z", "is_private": false}, {"count": 12, "attachment_id": null, "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "id": 188349, "time": "2016-02-10T22:04:53Z", "bug_id": 58987, "creation_time": "2016-02-10T22:04:53Z", "tags": [], "text": "Author: pmouawad\nDate: Wed Feb 10 22:04:30 2016\nNew Revision: 1729747\n\nURL: http://svn.apache.org/viewvc?rev=1729747&view=rev\nLog:\nBug 58987 - Report/Dashboard: Improve error reporting\nBugzilla Id: 58987\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/report/core/CsvSampleReader.java\n    jmeter/trunk/src/core/org/apache/jmeter/report/core/Sample.java\n    jmeter/trunk/src/core/org/apache/jmeter/report/processor/FieldSampleComparator.java\n    jmeter/trunk/xdocs/changes.xml"}, {"count": 13, "tags": [], "bug_id": 58987, "text": "@sebb, is it OK for you ?", "id": 188350, "time": "2016-02-10T22:05:08Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-10T22:05:08Z", "is_private": false, "attachment_id": null}, {"count": 14, "attachment_id": null, "creator": "sebb@apache.org", "is_private": false, "id": 188351, "time": "2016-02-11T00:05:16Z", "bug_id": 58987, "creation_time": "2016-02-11T00:05:16Z", "tags": [], "text": "The line number and field name are now reported. \nHowever the column number is not reported, and there are two sets of stack traces about the same error.\n\nI would expect to see something like:\n\n2016/02/10 23:53:55 ERROR - jmeter.report.dashboard.ReportGenerator: Error in sample at line: 1 converting field <n>: Latency to:long, fieldValue: ''\n\n*without* the other 100 or so lines of stack trace.\n\nAlso, the code should check whether the column count is correct.\nThere's no point trying to parse the data if the count is wrong."}, {"count": 15, "tags": [], "bug_id": 58987, "text": "(In reply to Sebb from comment #14)\n> The line number and field name are now reported. \n> However the column number is not reported,\nDone\n and there are two sets of stack\n> traces about the same error.\nFixed\n> \n> I would expect to see something like:\n> \n> 2016/02/10 23:53:55 ERROR - jmeter.report.dashboard.ReportGenerator: Error\n> in sample at line: 1 converting field <n>: Latency to:long, fieldValue: ''\n> \n> *without* the other 100 or so lines of stack trace.\nI think stacktrace is important for bug reporting.\n> \n> Also, the code should check whether the column count is correct.\n> There's no point trying to parse the data if the count is wrong.\nFixed", "id": 188398, "time": "2016-02-13T13:54:23Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-13T13:54:23Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 58987, "text": "Author: pmouawad\nDate: Sat Feb 13 13:43:44 2016\nNew Revision: 1730205\n\nURL: http://svn.apache.org/viewvc?rev=1730205&view=rev\nLog:\nBug 58987 - Report/Dashboard: Improve error reporting\nAvoid Log+Rethrow, only rethrow\nAdd column index in message\nBugzilla Id: 58987\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/JMeter.java\n    jmeter/trunk/src/core/org/apache/jmeter/report/core/Sample.java\n    jmeter/trunk/src/core/org/apache/jmeter/report/dashboard/ReportGenerator.java\n    jmeter/trunk/src/core/org/apache/jmeter/report/processor/AbstractSampleConsumer.java\n    jmeter/trunk/src/core/org/apache/jmeter/report/processor/CsvFileSampleSource.java\n    \nAuthor: pmouawad\nDate: Sat Feb 13 13:53:46 2016\nNew Revision: 1730206\n\nURL: http://svn.apache.org/viewvc?rev=1730206&view=rev\nLog:\nBug 58987 - Report/Dashboard: Improve error reporting\nThrow exception if mismatch between expected number of columns and columns in csv file\nBugzilla Id: 58987\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/report/core/CsvSampleReader.java", "id": 188399, "time": "2016-02-13T13:54:33Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-13T13:54:33Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "text": "The file bad.jtl is handled fine.\n\nHowever, If I run the following test:\n\n./jmeter -n -g ok.jtl -J jmeter.save.saveservice.assertion_results_failure_message=false\n\nI get the following console message:\n\nAn error occurred: Error while processing samples:Consumer failed with message :Consumer failed with message :Consumer failed with message :Error in sample at line:1 converting field:bytes at column:8 to:int, fieldValue:''\n\nThis is confusing.\nAlso I would expect to see a column mismatch error, not a parsing error.\n\nAlso the jmeter.log file is filled with unnecessary stack traces.\n\nThere is no point in providing stack traces here; it's likely to confuse users.\nWe just need to ensure that the error message is clear.", "attachment_id": null, "bug_id": 58987, "id": 188401, "time": "2016-02-13T14:20:55Z", "creator": "sebb@apache.org", "creation_time": "2016-02-13T14:20:55Z", "is_private": false}, {"count": 18, "tags": [], "bug_id": 58987, "attachment_id": 33550, "id": 188402, "time": "2016-02-13T14:23:50Z", "creator": "sebb@apache.org", "creation_time": "2016-02-13T14:23:50Z", "is_private": false, "text": "Created attachment 33550\nCopy of ok.jtl with last column not a number\n\nThis should generate a parse error. \nIt does, but the message is tricky to read because of all the unnecessary text:\n\nAn error occurred: Error while processing samples:Consumer failed with message :Consumer failed with message :Consumer failed with message :Consumer failed with message :Error in sample at line:1 converting field:Latency at column:12 to:long, fieldValue:'O'\n\nAlso there is no need for a stack trace."}, {"count": 19, "tags": [], "bug_id": 58987, "text": "URL: http://svn.apache.org/viewvc?rev=1730253&view=rev\nLog:\nReport/Dashboard: Improve error reporting\nThrow exception if mismatch between expected number of columns and columns in csv file (don't allow missing columns)\nBugzilla Id: 58987\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/report/core/CsvSampleReader.java\n\nURL: http://svn.apache.org/viewvc?rev=1730255&view=rev\nLog:\nRevert r1730205 as it results in duplicate information in the log file\nBugzilla Id: 58987\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/JMeter.java", "id": 188404, "time": "2016-02-13T17:22:45Z", "creator": "sebb@apache.org", "creation_time": "2016-02-13T17:22:45Z", "is_private": false, "attachment_id": null}, {"count": 20, "tags": [], "bug_id": 58987, "text": "Improved also with commits:\nhttp://svn.apache.org/viewvc?rev=1731954&view=rev\nhttp://svn.apache.org/viewvc?rev=1731945&view=rev\nhttp://svn.apache.org/viewvc?rev=1731944&view=rev\n\nClosing. \nFeel free to reopen if not enough", "id": 188887, "time": "2016-02-27T09:20:08Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-27T09:20:08Z", "is_private": false, "attachment_id": null}]
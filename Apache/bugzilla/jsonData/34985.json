[{"count": 0, "tags": [], "bug_id": 34985, "attachment_id": null, "text": "[Thu May 19 13:38:00 2005] [error] [client 10.1.5.91] (22)Invalid argument: \ncouldn't spawn child process: C:/php/php.exe, referer: \nhttp://digei06/Seige/InformacionRelevante/Cuadros.phtml?Dependencia=Direccion%\n20del%20SEIGE&url=http://seplader2.qroo.gob.mx/seige\n(22)Invalid argument: utf8 to ucs2 conversion failed on this string: \nREDIRECT_QUERY_STRING=Sector=Seguridad%20y%20Orden%20P\\xfablico", "id": 75132, "time": "2005-05-20T15:12:07Z", "creator": "ernestoname@hotmail.com", "creation_time": "2005-05-20T15:12:07Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 34985, "text": "\n  Dude - if you are running mod_cgid on Win32 then all bets are off :)\n  Reclassifying.\n\n  And I'm totally clueless, but I guess my first question is why use php.exe\n  as a CGI when you can plug it in as a module, and actually serve pages without\n  warming up your cpu?  CGI is a very disk/cpu/kernel intensive way to serve\n  any content whatsoever.\n", "id": 79141, "time": "2005-08-29T22:16:57Z", "creator": "wrowe@apache.org", "creation_time": "2005-08-29T22:16:57Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "rd9@donkin.org", "text": "This looks like a variant of Bug 32730 which had the same issues on Windows with\nsome different environment variables.  The problem is that Apache tries to\ntranslate every environment variable from Unicode's UTF-8 encoding into UCS-2,\neven though the environment variable may be in another character encoding (e.g.\nISO-8859-1 aka Latin-1).\n\nAn extension of the fix for Bug 32730 should work, although the real solution\n\nThis is not specific to mod_cgi and PHP, as it happens with non-PHP CGI\nprograms. CGI is still a reasonable option in some cases, e.g. for development\nof CGI scripts on Windows for installation on Linux+CGI (or a production\nmod_perl server on any OS).\n", "id": 95418, "time": "2006-11-04T02:15:56Z", "bug_id": 34985, "creation_time": "2006-11-04T02:15:56Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 34985, "attachment_id": null, "text": "Got interrupted when writing last comment, sorry...  \n\nTo finish the incomplete sentence in that comment: the real solution in my view\nis to go through all environment variables that could be non-UTF8 (virtually\nanything that is a string) and avoid converting those - or, better, only convert\nthose guaranteed not to be strings, or guaranteed to be ASCII only.  Another\nenvironment variable with this problem is REDIRECT_URL, logged in comment to Bug\n32730 after fix was committed.  This is a fairly simple extension of the patch I\nsubmitted for that bug.\n\nA configuration directive to turn off this conversion might also be useful.", "id": 95419, "time": "2006-11-04T02:22:23Z", "creator": "rd9@donkin.org", "creation_time": "2006-11-04T02:22:23Z", "is_private": false}, {"count": 4, "tags": [], "creator": "rd9@donkin.org", "text": "Some more variants of this bug...\n\nBug 13029 is another variant for the environment variable SSL_SERVER_S_DN_L.  I\nthink the fundamental issue is that there's no way to turn off this UTF-8 to\nUCS-2 conversion, and it only happens on Windows, well before any CGI script or\nother code has a chance to do its own non-UTF-8 based conversion.  \n\nThe REDIRECT_QUERY_STRING variant was also reported at\nhttp://mail-archives.apache.org/mod_mbox/httpd-users/200504.mbox/%3c006901c536e0$3dd72010$5d01250a@vdm%3e\n\n\n", "id": 95421, "time": "2006-11-04T02:58:21Z", "bug_id": 34985, "creation_time": "2006-11-04T02:58:21Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "wrowe@apache.org", "attachment_id": null, "text": "Yes - it looks like this needs to be more tollerant, overall, of non-utf8\ndata, and I'll look at rolling in a solution that doesn't impact security.\n\nThanks for your observations, they appear spot-on.", "id": 95426, "time": "2006-11-04T09:46:25Z", "bug_id": 34985, "creation_time": "2006-11-04T09:46:25Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "rd9@donkin.org", "text": "Not sure what you mean by security implications, but I don't think that falling\nback to another encoding such as ISO-8859-1 is necessary.\n\nTaking TWiki as an example, which uses paths like /bin/view/Main/WebHome, where\nview is the CGI script, and /Main/WebHome is the PATH_INFO (see\nhttp://twiki.org/cgi-bin/viewfile/Support/ApacheErrorsDuringEdit?rev=1.1;filename=testenv.htm\nfor example of CGI environment variables), it would be useful to specify the\nfollowing to handle non-UTF-8 encodings such as ISO-8859-1 (which are used by\nPOST from Firefox currently):\n\nAUTH_TYPE\tRaw\nDOCUMENT_ROOT\tConvert \nGATEWAY_INTERFACE\tRaw \nHTTP_ACCEPT\tRaw\nHTTP_ACCEPT_CHARSET\tRaw\nHTTP_ACCEPT_ENCODING\tRaw\nHTTP_ACCEPT_LANGUAGE\tRaw\nHTTP_CONNECTION\tRaw\nHTTP_HOST\tRaw\nHTTP_KEEP_ALIVE\tRaw\nHTTP_USER_AGENT\tRaw\nPATH\tConvert (since it has pathnames)\nQUERY_STRING\tRaw (not a filename, should be interpreted by application)\nREMOTE_ADDR\tRaw\nREMOTE_PORT\tRaw\nREMOTE_USER\tRaw\nREQUEST_METHOD\tRaw\nREQUEST_URI\tConvert if valid UTF-8 (and not overlong encoding)\nSCRIPT_FILENAME\tConvert if valid UTF-8 (and not overlong encoding)\nSCRIPT_NAME\tConvert if valid UTF-8 (and not overlong encoding)\nSERVER_ADDR\tRaw\nSERVER_ADMIN    Raw\n....\n(rest are all raw)\n\nBasically, only those variables that correspond to filenames should be\nconverted, and then only if they are valid UTF-8 without overlong encoding.\n\nAny variables not used by Apache should not be converted, but left to the\napplication, or a suitable add-on Apache module for conversion.\n\nTWiki has done its own interpretation of UTF-8 URLs, independent of the OS it is\nrunning on, which is based on a technique used by IBM's web server for mainframe\n(z/OS) - basically it tries to recognise the URL as UTF-8 and then falls back to\nthe native encoding (i.e. no conversion done at all).  In fact we do this on the\nPATH_INFO ourselves.\n\nIf Apache is going to carry on doing its own UTF-8 to UCS-2 conversion, which I\nsuppose it must do in some cases that map onto a Windows filesystem (and others\nsuch as MacOS X HFS+ etc), it would be good if it recognises when data is really\nUTF-8 in this way.  Also, it would be very helpful to have a configuration\noption that lets you say \"don't convert variable X if it matches regex Y\", e.g.\ndon't convert PATH_INFO if it matches \"/twiki/bin/.*\"\n\nSome TWiki pages that might be of interest here are:\n\nhttp://twiki.org/cgi-bin/view/Codev/EncodeURLsWithUTF8 - how TWiki does\nauto-detection and conversion of UTF-8 encoding for PATH_INFO in URLs\n\nhttp://twiki.org/cgi-bin/view/Codev/InternationalisationUTF8 - includes material\non character set auto-detection including excerpt on IBM web server approach -\nfortunately UTF-8 detection is much easier than the general case.\n\nhttp://twiki.org/cgi-bin/view/Codev/MacOSXFilesystemEncodingWithI18N - talks\nabout a filesystem-related issue with Unicode normalisation forms on Mac OS X \n\nhttp://twiki.org/cgi-bin/view/Codev/ProposedUTF8SupportForI18N - general page\nsummarising research on UTF-8 for TWiki, including some useful links\n\n\n\n\n\n", "count": 6, "id": 95427, "time": "2006-11-04T12:14:04Z", "bug_id": 34985, "creation_time": "2006-11-04T12:14:04Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "pnn@bec.dk", "text": "Hi all,\n\nWe are implementing an application, that uses SSL client certificates. And it \nseems like we are running into the same problem that it descriped here:\n\n[Mon Mar 05 09:48:34 2007] [error] [client 195.7.31.10] File does not exist: \nC:/bec_was/servletpif/apache2/docroots/errordocs\n(22)Invalid argument: utf8 to ucs2 conversion failed on this string: \nSSL_CLIENT_S_DN_CN=Anette Birgitte Franzp\\xf8tter\n\nIs there a way, that I can work around this problem ?\nBest regards\nPreben Nilsson", "count": 7, "id": 100044, "time": "2007-03-05T02:21:09Z", "bug_id": 34985, "creation_time": "2007-03-05T02:21:09Z", "is_private": false}, {"count": 8, "tags": [], "creator": "wrowe@apache.org", "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of 13029 ***", "id": 112109, "time": "2007-12-22T13:06:29Z", "bug_id": 34985, "creation_time": "2007-12-22T13:06:29Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": 30783, "is_private": false, "id": 169808, "time": "2013-08-29T16:59:09Z", "bug_id": 55503, "creation_time": "2013-08-29T16:59:09Z", "text": "Created attachment 30783\nImplementation plus docs\n\nJMeter currently has three configurations to tune class loading:\n\n- property search_paths: should be used for plugins but not for their dependency libs. All jars must be listed explicitely. Separator is \";\". JMeter uses the items given to search for implementations of specific interfaces.\n\n- property user.classpath: should be used for utilities and plugin dependencies. All jars must be listed explicitely. Separator is platform path separator (e.g. \":\", \";\", ...). The items listed are added to the system class path and also to the class path of the JMeter class loader.\n\n- user defined class path in JMeter test plan: should be used for utilities and plugin dependencies. All jars must be listed explicitely. The items listed are only added to the class path of the JMeter class loader.\n\nIf a JMeter plugin has lots of dependencies (in my case about 100 Jar files with a total size of about 100 MB), then one can only add them either to user.classpath and they end up in the system class path as well - unneeded. Or one adds them to the test plan. In both cases there is no way to let JMeter simply use all jars sitting in a configured directory.\n\nThe attached patch adds a property \"plugin_dependency_paths\" which allows to set a user defined class path with the same semantics as the test plan one outside as a property. Items are only added to the class path of the JMeter loader, not the system class path. Separator is \";\".\n\nThe patch also adds the functionality to all three properties, \"search_paths\", \"user.classpath\" and \"plugin_dependency_paths\", that if one of the items is a directory, all jar files contained in that directory are also added to the list.\n\nI also adjusted the documentation for the existing and the new property.\n\nRegards,\n\nRainer"}, {"attachment_id": null, "tags": [], "creator": "sebb@apache.org", "text": "Thanks very much; looks very useful.\n\nIn the case of a directory, the code only includes jar files in the directory, and does not descend the directory tree. This could perhaps be made clearer in the documentation.\n\nSome minor nits:\n\nThe code:\nif (furl.exists() && furl.isDirectory()) could surely be replaced with this?\nif (furl.isDirectory())\n\nchanges.xml says:\n\"now automatically add all jars form configured directories\"\ns/form/from/\n\nAlso the directory scanning code is repeated; it could be extracted as a method.\nAnd perhaps it should check if the jar file is readable?", "count": 1, "id": 169810, "time": "2013-08-29T17:19:53Z", "bug_id": 55503, "creation_time": "2013-08-29T17:19:53Z", "is_private": false}, {"count": 2, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": 30784, "text": "Created attachment 30784\nUpdated patch\n\n(In reply to Sebb from comment #1)\n> In the case of a directory, the code only includes jar files in the\n> directory, and does not descend the directory tree. This could perhaps be\n> made clearer in the documentation.\n\nTried to rephrase more clearly.\n\n> Some minor nits:\n> \n> The code:\n> if (furl.exists() && furl.isDirectory()) could surely be replaced with this?\n> if (furl.isDirectory())\n\nDone\n\n> changes.xml says:\n> \"now automatically add all jars form configured directories\"\n> s/form/from/\n\nCorrected\n\n> Also the directory scanning code is repeated; it could be extracted as a\n> method.\n\nDone.\n\n> And perhaps it should check if the jar file is readable?\n\nDone.", "id": 169814, "time": "2013-08-29T18:49:42Z", "bug_id": 55503, "creation_time": "2013-08-29T18:49:42Z", "is_private": false}, {"count": 3, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "is_private": false, "id": 169815, "time": "2013-08-29T18:55:48Z", "bug_id": 55503, "creation_time": "2013-08-29T18:55:48Z", "text": "OK, looks good to me"}, {"count": 4, "tags": [], "bug_id": 55503, "is_private": false, "text": "URL: http://svn.apache.org/r1518769\nLog:\nImprove class loading:\n- New property \"plugin_dependency_paths\" for\n  plugin dependency jars. Paths get added to JMeter\n  loader but not the system class path.\n- Jar files contained in a directory configured\n  in one of the properties \"search_paths\", \"user.classpath\"\n  or \"plugin_dependency_paths\" are automatically added\n  to the same property as well. This is not true for jar\n  files contained in sub directories.\nBugzilla Id: 55503\n\nModified:\n    jmeter/trunk/bin/jmeter.properties\n    jmeter/trunk/bin/user.properties\n    jmeter/trunk/src/core/org/apache/jmeter/JMeter.java\n    jmeter/trunk/src/core/org/apache/jmeter/NewDriver.java\n    jmeter/trunk/xdocs/changes.xml\n    jmeter/trunk/xdocs/usermanual/component_reference.xml\n    jmeter/trunk/xdocs/usermanual/get-started.xml", "id": 169816, "time": "2013-08-29T19:15:53Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2013-08-29T19:15:53Z", "attachment_id": null}]
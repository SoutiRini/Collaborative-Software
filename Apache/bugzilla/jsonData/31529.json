[{"count": 0, "tags": [], "creator": "ronald@innovation.ch", "attachment_id": null, "text": "It is often useful to be able pass the output of some other tag as an argument\nto the message-formatter. An example is a tag that generates an appropriate url\nfor a link. In order to do this, I've modified the MessageArg tag to accept\neither a 'value' attribute (current behaviour) _or_ a body. Here is the patch:\n\n------------------------------------------------------------------------\n--- MessageArgumentTag.java.orig        2004-10-04 10:19:11.995213714 -0700\n+++ MessageArgumentTag.java     2004-10-04 10:41:08.033316344 -0700\n@@ -16,23 +16,25 @@\n \n package org.apache.taglibs.i18n;\n \n-import java.text.MessageFormat;\n-\n import javax.servlet.jsp.JspException;\n import javax.servlet.jsp.JspTagException;\n-import javax.servlet.jsp.tagext.Tag;\n+import javax.servlet.jsp.tagext.BodyContent;\n+import javax.servlet.jsp.tagext.BodyTag;\n import javax.servlet.jsp.tagext.TagSupport;\n \n /**\n  *  This class implements is used inside a MessageTag to create an ordered\n- *  list of arguments to use with java.text.MessageFormat.\n+ *  list of arguments to use with java.text.MessageFormat. It must contain\n+ *  either a 'value' attribute or a non-empty body.\n  *  <P>\n  *  <H2>Examples</H2>\n  *  <PRE>\n- *  &lt;i18n:getMessage key=\"test\"/&gt;\n- *  &lt;i18n:msgArg value=\"&lt;%= test %&gt;\"/&gt;\n- *  &lt;i18n:msgArg value=\"&lt;%= test %&gt;\"/&gt;\n- *  &lt;/i18n:getMessage&gt;\n+ *  &lt;i18n:message key=\"test\"&gt;\n+ *    &lt;i18n:messagegArg value=\"&lt;%= test %&gt;\"/&gt;\n+ *    &lt;i18n:messagegArg&gt;\n+ *      &lt;my:someTag/&gt;\n+ *    &lt;/i18n:messagegArg&gt;\n+ *  &lt;/i18n:message&gt;\n  *  etc...\n  *  </PRE>\n  *  <P>\n@@ -42,13 +44,34 @@\n  *  @author <a href=\"mailto:tdawson@wamnet.com\">Tim Dawson</a>\n  *\n  */\n-public class MessageArgumentTag extends TagSupport\n+public class MessageArgumentTag extends TagSupport implements BodyTag\n {\n-  \n+    private Object      attr;\n+    private BodyContent cont;\n+\n+    public void setValue(Object argumentValue)\n+    {\n+        attr = argumentValue;\n+    }\n+\n+    public int doStartTag()\n+    {\n+        return EVAL_BODY_BUFFERED;\n+    }\n+\n+    public void setBodyContent(BodyContent b)\n+    {\n+        cont = b;\n+    }\n+\n+    public void doInitBody()\n+    {\n+    }\n+\n     /**\n      *  locate the parent tag and add the argument to the Message's arg list\n      */\n-    public void setValue(Object argumentValue) throws JspException\n+    public int doEndTag() throws JspException\n     {\n         // Get the parent MessageTag\n         MessageTag messageTag = null;\n@@ -63,8 +86,21 @@\n                 \"i18n:msgArg tag must be nested inside a message tag.\");\n         }\n \n+       // Check the value attribute and body\n+        if (attr == null && cont == null)\n+            throw new JspTagException(\n+                   \"i18n:msgArg tag must have either a 'value' attribute or a\nbody.\");\n+        if (attr != null && cont != null)\n+            throw new JspTagException(\n+                   \"i18n:msgArg tag may not have both a 'value' attribute and a\nbody.\");\n+\n         // now we know we're safe to add the argument\n-        messageTag.addArg(argumentValue);\n+        messageTag.addArg((attr != null) ? attr : cont.getString());\n+\n+        attr = null;\n+        cont = null;\n+\n+        return EVAL_PAGE;\n     }\n \n }\n--- taglibs-i18n.tld.orig       2004-10-04 10:18:10.977434463 -0700\n+++ taglibs-i18n.tld    2004-10-04 10:18:38.868419367 -0700\n@@ -106,10 +106,10 @@\n   <tag>\n     <name>messageArg</name>\n     <tagclass>org.apache.taglibs.i18n.MessageArgumentTag</tagclass>\n-    <bodycontent>empty</bodycontent>\n+    <bodycontent>JSP</bodycontent>\n     <attribute>\n       <name>value</name>\n-      <required>true</required>\n+      <required>false</required>\n       <rtexprvalue>true</rtexprvalue>\n     </attribute>\n   </tag>\n------------------------------------------------------------------------", "id": 64572, "time": "2004-10-04T17:54:49Z", "bug_id": 31529, "creation_time": "2004-10-04T17:54:49Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 31529, "text": "Created attachment 12933\nProposed patch, as an attachment", "id": 64574, "attachment_id": 12933, "creator": "ronald@innovation.ch", "creation_time": "2004-10-04T17:58:29Z", "time": "2004-10-04T17:58:29Z", "is_private": false}, {"count": 2, "tags": [], "creator": "bayard@apache.org", "is_private": false, "text": "JSTL replaced the i18n taglib, so this won't be worked on.", "id": 128697, "time": "2009-07-10T00:36:21Z", "bug_id": 31529, "creation_time": "2009-07-10T00:36:21Z", "attachment_id": null}]
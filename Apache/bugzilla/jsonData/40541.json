[{"text": "I'm using a couple of scripts to do pre-processing of files with\ncertain file extensions and then wrapping the output in a\nSetOutputFilter chosen according to the URL. Example:\n\n## ReStructuredText handler\nScriptAlias /test-cgi-bin/ /cedar/testlocal/cgi-bin/\nAction rst-handler /test-cgi-bin/rst-filter\nAddHandler rst-handler .rst\n\n## /foo contains .rst files\n<Location /foo>\n  SetOutputFilter blah\n</Location>\n\nThis seems not to work: the RST handler processes the RST into HTML\nnicely but then the location isn't matched, because the handler changes\nthe URI (I'm not sure which variable gets read to do this). I can fix\nit for this example by adding this:\n\n<Location /test-cgi-bin>\n  SetOutputFilter blah\n</Location>\n\nbut this is pretty ugly and probably not flexible enough for me in\ngeneral. Is this really intentional, and if so is there a work-around?", "tags": [], "bug_id": 40541, "is_private": false, "count": 0, "id": 93773, "time": "2006-09-19T12:55:21Z", "creator": "andy@insectnation.org", "creation_time": "2006-09-19T12:55:21Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "slive@apache.org", "is_private": false, "id": 93803, "time": "2006-09-19T19:06:07Z", "bug_id": 40541, "creation_time": "2006-09-19T19:06:07Z", "tags": [], "text": "1. Quite an old version.\n\n2. You should be using <Directory /full/path/to/foo> in place of <Location /foo>\nsince you are dealing with the filesystem.\n\n3. Action often has weird effects.  I usually prefer something more like\nScriptAliasMatch (.*\\.rst)$ /cedar/testlocal/cgi-bin/rst-filter/$1\n\nBut there still could be a bug here; I'm not sure."}, {"count": 2, "tags": [], "creator": "andy@insectnation.org", "attachment_id": null, "is_private": false, "id": 93955, "time": "2006-09-21T10:40:36Z", "bug_id": 40541, "creation_time": "2006-09-21T10:40:36Z", "text": "1. Yes - a consequence of having to use packaged versions of Apache 2 from Linux\ndistributions. I'd rather be on 2.2, but it doesn't seem to be a priority for\npackagers :(\n\n2. This is arguably true, although I think the distinction is a bit blurred. I'm\ntrying to make a filetype be handled the same way for various bits of URL-space,\nwhich may in fact be distributed across areas on the physical filesystem, so\ndoing it by Directory would be less robust against changes of the filesystem\norganisation and would involve a lot of duplication. I think Location is a\nneater solution in this case --- and in a lot of cases other than when\nspecifying file access criteria.\n\n3. This would involve re-writing the script, and since this is meant to handle\ne.g. RST files the same way across several virtual hosts, I'm not sure that can\nbe done in a generic way: i.e. without having to hard-code some mapping from\nhost names to filesystem path prefix. Yuck. Using an Action has the benefit of\n(at least in principle) handling a file the same way regardless of its location.\nOr that's my understanding of it, anyway :)\n\nI'm not sure if there's a bug, either, but re-writing the string that Location\ndoes its path matching against was very surprising to me: I would expect a\nLocation to match the URL by which the file was accessed rather than the path\ncorresponding to its internal handler.\n"}, {"count": 3, "tags": [], "bug_id": 40541, "attachment_id": null, "is_private": false, "id": 96950, "time": "2006-12-15T08:58:57Z", "creator": "andy@insectnation.org", "creation_time": "2006-12-15T08:58:57Z", "text": "Making an Action which prints out the current environment gives these\nenvironment variables (among others, of course) for a test URL of\nhttp://test.insectnation.org/test.ex :\n\nHTTP_HOST=test.insectnation.org\nSCRIPT_FILENAME=/www/test/cgi/testhandler\nREQUEST_URI=/handler/test.ex\nSCRIPT_NAME=/test-cgi-bin/testhandler\nPATH_INFO=/handler/test.ex\nPATH_TRANSLATED=/www/test/handler/test.ex\nSERVER_NAME=test.insectnation.org\nREDIRECT_URL=/handler/test.ex\n\nAs above, I can successfully apply output filters to this script by a <Location>\napplying to /test-cgi-bin, but not one which applies to /handler (which seems\nmore useful to me). If the environment is being used to determine the\napplication of <Location>, then the only variable which gets rewritten to point\nat /test-cgi-bin is SCRIPT_NAME. I'd expect something like REQUEST_URI (or maybe\nREDIRECT_URI) to be used instead (i.e. applying <Location> by request rather\nthan by whatever internal script handles it) ... any comments on this?\n"}]
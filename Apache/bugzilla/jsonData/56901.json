[{"count": 0, "tags": [], "creator": "nyanhost@gmail.com", "text": "Hello!\n\nFork bomb's not working in the shell.\nLimits in `/etc/security/limits.conf` are working.\n\n@users       soft    nproc           50\n@users       hard    nproc           60\n@apache      soft    nproc           500\n@apache      hard    nrpoc           600\n*            soft    nproc           1900\n*            hard    nproc           2000\n\nIf I run Perl or Python or PHP or Bash scripts in the shell, then I get message:\nUnable to fork: Resource temporarily unavailable\n\nIs ok!\nBut If I run these scripts in the apache then fork bomb's are working!\n\nExample Python script:\ntest.py:\n#!/usr/bin/python\nimport os\n \nwhile True:\n      os.fork()\n\nEnd script.\n\nShell output:\nFile \"./test.py\", line 5, in <module>\n    os.fork()\nOSError: [Errno 11] Resource temporarily unavailable\n\n\nApache output... create 25000+ processes\n\nBut I have line in the limits.conf:\n*            hard    nproc           2000\n\nWell then processes forking from root?\n\nhttpd.conf:\nUser apache\nGroup apache", "id": 177461, "time": "2014-08-31T03:20:15Z", "bug_id": 56901, "creation_time": "2014-08-31T03:20:15Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 56901, "attachment_id": null, "id": 177462, "time": "2014-08-31T07:33:55Z", "creator": "nyanhost@gmail.com", "creation_time": "2014-08-31T07:33:55Z", "is_private": false, "text": "Apache makes the fork on UID user.\n\nNormal process:\ntestuser   21296  0.0  0.0 443680 23488 ?        S    11:24   0:00 /usr/php/bin/php-cgi php\n\nFork process:\n\n524   19788  0.1  0.0 538228 27928 ?        S    11:23   0:00 /usr/php/bin/php-cgi php\n\n\nFork process don't limiting in the limits.conf :(\nHow to prevent fork attack?"}, {"count": 2, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "id": 177468, "time": "2014-08-31T11:56:22Z", "bug_id": 56901, "creation_time": "2014-08-31T11:56:22Z", "is_private": false, "text": "mod_fcgid doesn't appear to allow setting rlimits from within httpd. \n\nI recall from some other issues that the usage of /etc/limits.conf on Linux with PAM is not very intuitive and is not simply ever-present because you have a *:\n\n\"\"\"\nIMHO this explains it as limits.conf is a configuration file for PAM. If you don't use any PAM methods (haven't worked out which would be needed) in the code the limits will not be applied after setuid. Of course pam_limits.so need to be configured for session for your app as well.\n\"\"\""}, {"count": 3, "tags": [], "creator": "nyanhost@gmail.com", "attachment_id": null, "id": 177471, "time": "2014-08-31T18:17:03Z", "bug_id": 56901, "creation_time": "2014-08-31T18:17:03Z", "is_private": false, "text": "Eric, Thank you for answer!\n\nSo what methods exists for solution it?"}, {"count": 4, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "text": "How do you start httpd? Via init.d script or from a root shell?\nWhat does ulimit -u / ulimit -u -H tell you in this shell? \nHow do you login to this shell? Via console or via ssh?\nWhat does /proc/<pid>/limits tell you for all httpd processes?", "id": 177474, "time": "2014-08-31T19:07:51Z", "bug_id": 56901, "creation_time": "2014-08-31T19:07:51Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 56901, "text": "(In reply to Ruediger Pluem from comment #4)\n> How do you start httpd? Via init.d script or from a root shell?\nhttpd autostarting via init.d, but I can sometimes restart it from root shell.\n\n> How do you login to this shell? Via console or via ssh?\nVia console, example PHP scripts (shell_exec):\n<?php\nshell_exec('ulimit -a');\n?>\n\n> What does ulimit -u / ulimit -u -H tell you in this shell?\nOutput previous script:\nmax user processes (-u) 256971\n\n> What does /proc/<pid>/limits tell you for all httpd processes?\napache    611  0.0  0.0 180488  4524 ?        S    15:02   0:00 /usr/sbin/httpd\n\n[root@s1 /]# cat /proc/611/limits\nLimit                     Soft Limit           Hard Limit           Units\nMax cpu time              unlimited            unlimited            seconds\nMax file size             unlimited            unlimited            bytes\nMax data size             unlimited            unlimited            bytes\nMax stack size            10485760             unlimited            bytes\nMax core file size        unlimited            unlimited            bytes\nMax resident set          unlimited            unlimited            bytes\nMax processes             256971               256971               processes\nMax open files            1024                 4096                 files\nMax locked memory         65536                65536                bytes\nMax address space         unlimited            unlimited            bytes\nMax file locks            unlimited            unlimited            locks\nMax pending signals       256971               256971               signals\nMax msgqueue size         819200               819200               bytes\nMax nice priority         0                    0\nMax realtime priority     0                    0\nMax realtime timeout      unlimited            unlimited            us\n\nProcesses not limited...", "id": 177475, "time": "2014-08-31T19:54:18Z", "creator": "nyanhost@gmail.com", "creation_time": "2014-08-31T19:54:18Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "nyanhost@gmail.com", "attachment_id": null, "text": "I added ulimit -u 256 in init.d script and restart it.\nThis limit method is working.\n\nSorry for my panic and my english.\nThank you!", "id": 177481, "time": "2014-08-31T23:51:25Z", "bug_id": 56901, "creation_time": "2014-08-31T23:51:25Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "rpluem@apache.org", "text": "(In reply to Demidov Andrei from comment #5)\n> (In reply to Ruediger Pluem from comment #4)\n> > How do you start httpd? Via init.d script or from a root shell?\n> httpd autostarting via init.d, but I can sometimes restart it from root\n\nIf you start from init.d limits.conf settings will not apply.\n\n> shell.\n> \n> > How do you login to this shell? Via console or via ssh?\n> Via console, example PHP scripts (shell_exec):\n> <?php\n> shell_exec('ulimit -a');\n> ?>\n\nI meant the shell that you use to start httpd, not the one executing the script.\n\n> \n> > What does ulimit -u / ulimit -u -H tell you in this shell?\n> Output previous script:\n> max user processes (-u) 256971\n> \n> > What does /proc/<pid>/limits tell you for all httpd processes?\n> apache    611  0.0  0.0 180488  4524 ?        S    15:02   0:00\n> /usr/sbin/httpd\n> \n> [root@s1 /]# cat /proc/611/limits\n> Limit                     Soft Limit           Hard Limit           Units\n> Max cpu time              unlimited            unlimited            seconds\n> Max file size             unlimited            unlimited            bytes\n> Max data size             unlimited            unlimited            bytes\n> Max stack size            10485760             unlimited            bytes\n> Max core file size        unlimited            unlimited            bytes\n> Max resident set          unlimited            unlimited            bytes\n> Max processes             256971               256971               processes\n> Max open files            1024                 4096                 files\n> Max locked memory         65536                65536                bytes\n> Max address space         unlimited            unlimited            bytes\n> Max file locks            unlimited            unlimited            locks\n> Max pending signals       256971               256971               signals\n> Max msgqueue size         819200               819200               bytes\n> Max nice priority         0                    0\n> Max realtime priority     0                    0\n> Max realtime timeout      unlimited            unlimited            us\n> \n> Processes not limited...\n\nI assume this one was started via init.d", "count": 7, "id": 177483, "time": "2014-09-01T07:44:51Z", "bug_id": 56901, "creation_time": "2014-09-01T07:44:51Z", "is_private": false}]
[{"count": 0, "attachment_id": null, "creator": "patrick.mi@touchpoint.co.nz", "is_private": false, "id": 89567, "time": "2006-05-30T05:17:27Z", "bug_id": 39678, "creation_time": "2006-05-30T05:17:27Z", "tags": [], "text": "Frontend Apache server configured as below\n====\nProxyPreserveHost On\n\nProxyPass /foo/ http://backendAapacheOne/to/foo\n\nRewriteEngine On\nRewriteRule ^/(.*)$ http://backendAapacheTwo/dosomething/$1 [proxy]\nProxyPassReverse / http://backendAapacheTwo/dosomething/\n====\n\nEverything works fine with ProxyPreserveHost Off when backendAapacheTwo does a \nredirect. However when ProxyPreserveHost is On the redirect stops working. \n\nWhat actually happens is that when the backend server issues a redirect to \nhttp://backendAapacheTwo/dosomething/redirecturl it gets rewritten to frontend \nas \nhttp://frontendServer/dosomething/redirecturl ( as supposed to be \nhttp://frontendServer/redirecturl )  and ends up in backendServer as \nhttp://backendAapacheTwo/dosomething/dosomething/redirecturl which would break\n\nIt appears in both 2.0.48 and 2.2.2 release\n\nThanks"}, {"count": 1, "tags": [], "text": "Due to the fact that you have turned on ProxyPreserveHost the backend server\ndoes not issue a redirect to http://backendAapacheTwo/dosomething/redirecturl\nbut is likely to issue a redirect to\nhttp://frontendServer/dosomething/redirecturl, provided that it uses the\ncontents of the Host header supplied for constructing its redirect URLs (see\nhttp://httpd.apache.org/docs/2.2/en/mod/core.html#usecanonicalname how to\nconfigure this behaviour if the backend server is also an Apache).\nWith ProxyPreserveHost on the Host header sent to the backend is now\nfrontendServer and not backendAapacheTwo.\n\nThis causes the RedirectPassReverse rule to mismatch. Please replace \n\nProxyPassReverse / http://backendAapacheTwo/dosomething/\n\nwith\n\nProxyPassReverse / http://frontendServer/dosomething/", "is_private": false, "id": 89582, "creator": "rpluem@apache.org", "time": "2006-05-30T14:59:50Z", "bug_id": 39678, "creation_time": "2006-05-30T14:59:50Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 49411, "attachment_id": null, "is_private": false, "id": 137467, "time": "2010-06-09T04:02:13Z", "creator": "arjen@pinguins.dyndns.org", "creation_time": "2010-06-09T04:02:13Z", "text": "The following code:\n\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<fo:root xmlns:fo=\"http://www.w3.org/1999/XSL/Format\">\n  <fo:layout-master-set>\n    <fo:simple-page-master master-name=\"my-page\">\n      <fo:region-body margin=\"1in\"/>\n    </fo:simple-page-master>\n  </fo:layout-master-set>\n\n  <fo:page-sequence hyphenate=\"true\" language=\"en\" master-reference=\"my-page\">\n    <fo:flow flow-name=\"xsl-region-body\">\n        <fo:block linefeed-treatment=\"preserve\">First line\nSecond line</fo:block>\n    </fo:flow>\n  </fo:page-sequence>\n</fo:root>\n\nresults in an output of: \nFirstlineSecondline\nFirstlineSecondline\n\nWithout the language=\"en\"  attribute the output is (as expected)\nFirst line\nSecond line\n\nThis seems to be independent of the chosen output format."}, {"count": 1, "tags": [], "creator": "adelmelle@apache.org", "attachment_id": null, "id": 137686, "time": "2010-06-16T14:20:08Z", "bug_id": 49411, "creation_time": "2010-06-16T14:20:08Z", "is_private": false, "text": "(In reply to comment #0)\n> \n> Without the language=\"en\"  attribute the output is (as expected)\n> First line\n> Second line\n> \n> This seems to be independent of the chosen output format.\n\nApologies for the late reply...\n\nThe real issue seems to be the combination of hyphenation with preserved linefeeds, which is a registered, as yet unsolved bug. See Bug #38264. \nI last had a look at that one over two years ago, but I think the basic story as sketched in that report still holds: three paragraphs are generated by the line-breaking algorithm (two genuine and an empty one), which are post-processed to apply hyphenation, and this post-processing implicitly assumes that a TextLM will always generate one and only one paragraph.\n\nWhen you remove the language attribute, hyphenation is not triggered, so the issue does not occur. If you really get hyphenation points and have more preserved linefeeds, the effects are reinforced. In extreme cases, you hardly recognize the original text.\n\nSo, I got that itch again, and dove into the code... \nI already solved this particular manifestation in my local sandbox, simply by doing something I initially expected would already help: invert the principal loop in LineLM.createLineBreaks(). \nUnless I am missing something, there really seems to be no benefit in that loop going backward, unless of course one considers confusing people trying to follow the flow to be beneficial... Errm... :->\nThis solves the issue, but only in this very confined testcase. The hyphenation 'updates' are still applied twice, but there really is no difference (= none of the calculated hyphenation points are actually used, since both pieces of text fit well within one line)\n\nI am marking this one as duplicate. Please post any follow-up at #38264\n\n*** This bug has been marked as a duplicate of bug 38264 ***"}, {"count": 2, "tags": [], "bug_id": 49411, "attachment_id": null, "text": "(In reply to comment #1)\n> I already solved this particular manifestation in my local sandbox, simply by\n> doing something I initially expected would already help: invert the principal\n> loop in LineLM.createLineBreaks().\n\nJust adding this here for the sake of completeness: turns out that inverting that loop had nothing to do with it. Current FOP Trunk does not exhibit the described behavior, even with the loop inverted. \nThe 'fix' is actually due to a change made last year to cater for changing IPD between pages. There was a 'hyphenationPerformed' member added to LineLayoutManager which effectively masks the problem in this case. This makes sure that findHyphenationPoints is called only once per LineLM. In case of preserved linefeeds, this results in only the first paragraph being hyphenated.", "id": 137757, "time": "2010-06-19T14:08:27Z", "creator": "adelmelle@apache.org", "creation_time": "2010-06-19T14:08:27Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 49411, "attachment_id": null, "is_private": false, "id": 156912, "time": "2012-04-01T13:54:51Z", "creator": "gadams@apache.org", "creation_time": "2012-04-01T13:54:51Z", "text": "batch transition to closed remaining pre-FOP1.0 resolved bugs"}]
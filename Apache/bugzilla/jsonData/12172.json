[{"count": 0, "tags": [], "creator": "apachebugs@robcromwell.com", "attachment_id": null, "text": "Currently, when setting a cookie using the cookie|CO RewriteRule flag there is \nno ability to specify the path of the cookie.\n\n'cookie|CO=NAME:VAL:domain[:lifetime]' (set cocookie)\n\nI suggest adding a second optional parameter to specify the path of the \ncookie.  By adding it as an optional parameter, there won't be any conflicts \nwith existing cookie RewriteRules.\n\n'cookie|CO=NAME:VAL:domain[:lifetime][:path]' (set cocookie)\n\nI've modified the add_cookie function below to work with the new path field.\n=======================================================================\nstatic void add_cookie(request_rec *r, char *s)\n{\n    char *var;\n    char *val;\n    char *domain;\n    char *expires;\n    char *path;\n\n    char *tok_cntx;\n    char *cookie;\n\n    if (s) {\n        var = apr_strtok(s, \":\", &tok_cntx);\n        val = apr_strtok(NULL, \":\", &tok_cntx);\n        domain = apr_strtok(NULL, \":\", &tok_cntx);\n        expires = apr_strtok(NULL, \":\", &tok_cntx);\n        path = apr_strtok(NULL, \":\", &tok_cntx);\n\n        if (var && val && domain) {\n            /* FIX: use cached time similar to how logging does it */\n            cookie = apr_pstrcat( r->pool,\n                                  var,\n                                  \"=\",\n                                  val,\n                                  \"; path=\",\n                                  (path)? path : \"/\",\n                                  \"; domain=\",\n                                  domain,\n                                  (expires)? \"; expires=\" : NULL,\n                                  (expires)? ap_ht_time(r->pool,\n                                                        r->request_time +\n                                                        apr_time_from_sec(60 * \natol(expires)),\n                                                         \"%a, %d-%b-%Y %T GMT\", \n1)\n                                           : NULL,\n                                  NULL);\n\n\n            /*\n             * XXX: should we add it to err_headers_out as well ?\n             * if we do we need to be careful that only ONE gets sent out\n             */\n            apr_table_add(r->headers_out, \"Set-Cookie\", cookie);\n            rewritelog(r, 5, \"setting cookie '%s' to '%s'\", var, val);\n        }\n    }\n}", "id": 21989, "time": "2002-08-29T17:54:26Z", "bug_id": 12172, "creation_time": "2002-08-29T17:54:26Z", "is_private": false}, {"count": 1, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "text": "Not sure why I'm cc'ed here.  Remove it and note that a fix is proposed in the\nbug.", "id": 21996, "time": "2002-08-29T20:43:29Z", "bug_id": 12172, "creation_time": "2002-08-29T20:43:29Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "ianh@apache.org", "text": "Thanks once again Rob.\nfor my sanity, can you mention the other bugs you have open on the same piece of\nfunctionality ;-) \nsave me 3 seperate commits", "count": 2, "id": 22006, "time": "2002-08-29T23:16:48Z", "bug_id": 12172, "creation_time": "2002-08-29T23:16:48Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 12172, "is_private": false, "text": "Works great! Sorry for the trouble :\\", "id": 22009, "time": "2002-08-30T01:11:55Z", "creator": "apachebugs@robcromwell.com", "creation_time": "2002-08-30T01:11:55Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "just me bitching.. take no heed", "attachment_id": null, "bug_id": 12172, "id": 22012, "time": "2002-08-30T03:04:00Z", "creator": "ianh@apache.org", "creation_time": "2002-08-30T03:04:00Z", "is_private": false}]
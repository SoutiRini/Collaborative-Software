[{"count": 0, "tags": [], "creator": "eric_marcoux-qc@dmr.ca", "attachment_id": null, "is_private": false, "id": 36290, "time": "2003-04-29T13:50:20Z", "bug_id": 19427, "creation_time": "2003-04-29T13:50:20Z", "text": "Hi,\n\nWhen a form, module, class or sheet in a VBA Project of a Excel file has a \nname length of 12, the file corrupts when saved with the POIFS API. Here is \nthe sample code :\n\nFileInputStream fis = new FileInputStream(\"classeur1.xls\");\nFileOutputStream fos = new FileOutputStream(\"classeur2.xls\");\nPOIFSFileSystem p = new POIFSFileSystem(fis);\np.writeFilesystem(fos);\nfos.close();\n\nThe problem occurs when a form, module, class or sheet has a name with the \nsame length of the \"_VBA_PROJECT\" internal file (12 characters wide). When \nthis occurs, the API place the \"_VBA_PROJECT\" internal file before the file \nhaving the same name length in the hierarchy and this seems to cause the \nproblem. If I modify the method \"compare(Object o1, Object o2)\" of the inner \nclass \"PropertyComparator\" of the public class \"DirectoryProperty\" to return a \npositive (or negative - depending on which parameter \"_VBA_PROJECT\" is \npassed : o1 or o2) value, the API places the \"_VBA_PROJECT\" internal file \nafter the file resulting in an Excel file readable by MS Excel.\n\nMy fix works but I don't think it is a good one (because I am using the \nconstant \"_VBA_PROJECT\" with the \"equals\" method). Before I submit it, I would \nlike to know if there is a better approach because maybe I don't understand \nhow the POIFS API is working.\n\nI will attach the following files :\n the \"DirectoryProperty.java\" fixed class file ;\n the original Excel file (classeur1.xls) containing objects with name length \nof 12 ;\n a corrupt Excel file saved with the original POIFS API (classeur_bad.xls) ;\n a correct Excel file saved with the fix I suggest (classeur2.xls) ;\n and the test class file I use (TestBUG.java) to reproduce the problem.\n\nI use the POI version \"1.10.0-dev\" (I have tested the case with the 1.8.0 and \n1.5.1 final versions ; they have the same problem too), JDK 1.4.1 on Eclipse \nIDE and Windows Excel XP on a Windows XP machine.\n\nThanks for your time.\n\nRegards,\nEric Marcoux..."}, {"count": 1, "tags": [], "creator": "eric_marcoux-qc@dmr.ca", "attachment_id": 6078, "id": 36292, "time": "2003-04-29T13:54:34Z", "bug_id": 19427, "creation_time": "2003-04-29T13:54:34Z", "is_private": false, "text": "Created attachment 6078\nFiles to reproduce the bug 19427."}, {"count": 2, "tags": [], "bug_id": 19427, "attachment_id": null, "text": "This is weird.  I wonder why I don't see this a lot more.  Don't want it to hold\nup 2.0 but it should be looked at.", "id": 41389, "time": "2003-07-24T16:26:04Z", "creator": "poi-support@buni.org", "creation_time": "2003-07-24T16:26:04Z", "is_private": false}, {"count": 3, "tags": [], "creator": "josh@apache.org", "attachment_id": null, "is_private": false, "id": 122976, "time": "2008-12-01T22:59:05Z", "bug_id": 19427, "creation_time": "2008-12-01T22:59:05Z", "text": "Bug 39234 fix was applied in svn r486265.\n\n*** This bug has been marked as a duplicate of bug 39234 ***"}]
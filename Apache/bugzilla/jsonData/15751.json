[{"count": 0, "tags": [], "creator": "adam@os.inf.tu-dresden.de", "attachment_id": null, "id": 28795, "time": "2003-01-01T14:29:19Z", "bug_id": 15751, "creation_time": "2003-01-01T14:29:19Z", "is_private": false, "text": "If a have a directory \"a\" with two files: \"index.html.en\" and \"index.html.de\",\nand query /a/index.html, rewriting rules will be applied to /a/index.html rather\nthan to the file sent out (i.e. /a/index.html.en (in most cases)).\n/a/index.html doesn't exist on the filesystem.\nThe same applies if one queries /a/ only, the DirectoryIndex file is found (i.e.\nindex.html in this case) and the rewriting rules are applied to index.html\ninstead of the actual file.\nThis used to work with apache 1.3.x.\n\nI used a fresh copy of httpd-2.0.43.tar.gz and configured it with \n--prefix=/var/tmp/apache2 --enable-so --enable-rewrite --enable-modules=all \n--enable-mods-shared=all,\n\nto the standard configuration I added at the end of the file:\nRewriteEngine On\nRewriteLogLevel 9\nRewriteLog /var/tmp/apache2/logs/rwlog\nRewriteRule ^(.*)       - [L]\n\nand the option MultiViews to the DocumentRoot directory\n\nto see the following in the logs:\n\n==> access_log <==\n... - - [01/Jan/2003:15:01:53 +0100] \"GET /a/ HTTP/1.0\" 304 0\n\n==> rwlog <==\n... - - [01/Jan/2003:15:01:53 +0100]\n[.../sid#6000000000051368][rid#60000000000c14f0/initial] (2) init rewrite engine\nwith requested uri /a/\n - - [01/Jan/2003:15:01:53 +0100]\n[.../sid#6000000000051368][rid#60000000000c14f0/initial] (3) applying pattern\n'^(.*)' to uri '/a/'\n... - - [01/Jan/2003:15:01:53 +0100]\n[.../sid#6000000000051368][rid#60000000000c14f0/initial] (1) pass through /a/\n... - - [01/Jan/2003:15:01:53 +0100]\n[.../sid#6000000000051368][rid#60000000000c7520/subreq] (2) init rewrite engine\nwith requested uri /a/index.html\n - - [01/Jan/2003:15:01:53 +0100]\n[.../sid#6000000000051368][rid#60000000000c7520/subreq] (3) applying pattern\n'^(.*)' to uri '/a/index.html'\n... - - [01/Jan/2003:15:01:53 +0100]\n[.../sid#6000000000051368][rid#60000000000c7520/subreq] (1) pass through\n/a/index.html\n\n$ ls -la a\ntotal 16\ndrwxr-xr-x    2 adam     users        4096 Jan  1 15:05 .\ndrwxr-xr-x    3 adam     users        4096 Jan  1 14:30 ..\n-rw-r--r--    1 adam     users           8 Jan  1 14:31 index.html.de\n-rw-r--r--    1 adam     users           8 Jan  1 14:34 index.html.en"}, {"count": 1, "tags": [], "bug_id": 15751, "attachment_id": null, "id": 28796, "creation_time": "2003-01-01T15:40:13Z", "time": "2003-01-01T15:40:13Z", "creator": "nd@perlig.de", "text": "(I have currently no 1.3 running).\n\nBut AFAICS the described behaviour is exactly what I would expect (at least in 2.x)\nI hope, I understand you correctly; you have:\n\nDirectoryIndex index.html\n..\nRewriteRule ^ - [L]\n\nThe latter means simply passing through every incoming request. At first a\nrequest \"/a/\" comes in -> passing through.\nThen DirectoryIndex starts its work and trys to resolve the directory request to\n/a/index.html by doing a subrequest lookup.\nThat URI is put into the rewrite engine again and simply passed through.\n\nWhat was _exactly_ different in 1.3 (e.g. in the rewritelog)?", "is_private": false}, {"count": 2, "tags": [], "creator": "adam@os.inf.tu-dresden.de", "attachment_id": null, "id": 28797, "time": "2003-01-01T16:26:24Z", "bug_id": 15751, "creation_time": "2003-01-01T16:26:24Z", "is_private": false, "text": "Things seem to be a bit more complicated. My current production system (using\n1.3) has a .htaccess with the rewriting rules:\n\nd#6000000000047030/initial] (2) init rewrite engine with requested uri /a/ \nd#6000000000047030/initial] (3) applying pattern '^(.*)' to uri '/a/'\nd#6000000000047030/initial] (1) pass through /a/\nd#6000000000047030/initial] (3) [per-dir /var/www/a/] add path-info postfix:\n/var/www/a -> /var/www/a/\nd#6000000000047030/initial] (3) [per-dir /var/www/a/] strip per-dir prefix:\n/var/www/a/ -> \nd#6000000000047030/initial] (3) [per-dir /var/www/a/] applying pattern '^' to uri ''\nd#6000000000047030/initial] (1) [per-dir /var/www/a/] pass through /var/www/a\nd#600000000004e4a0/subreq] (2) init rewrite engine with requested uri /a/index.html\nd#600000000004e4a0/subreq] (3) applying pattern '^(.*)' to uri '/a/index.html' \nd#600000000004e4a0/subreq] (1) pass through /a/index.html\nd#600000000004c788/initial/redir#1] (2) init rewrite engine with requested uri\n/a/index.html\nd#600000000004c788/initial/redir#1] (3) applying pattern '^(.*)' to uri\n'/a/index.html' \nd#600000000004c788/initial/redir#1] (1) pass through /a/index.html\nd#600000000004c788/initial/redir#1] (3) [per-dir /var/www/a/] strip per-dir\nprefix: /var/www/a/index.html.en -> index.html.en\nd#600000000004c788/initial/redir#1] (3) [per-dir /var/www/a/] applying pattern\n'^' to uri 'index.html.en' \nd#600000000004c788/initial/redir#1] (1) [per-dir /var/www/a/] pass through\n/var/www/a/index.html.en\n\n\nThe fine thing is that in the \"per-dir\" rules, index.html.en instead of just\nindex.html is taken (in the second group). I need the actual existing file name\nlater to do the processing. The information \"index.html\" is useless for me in\nthis case as such a file doesn't exist on the filesystem and I need the\nlanguage negotiated file instead.\nI just tried to reproduce this with the rewriting rules in httpd.conf and it\ndoesn't work there (it only uses the index.html file). Hmm.\n\nIn 2.0 it looks like this:\n000000c14f0/initial] (2) init rewrite engine with requested uri /a/\n000000c14f0/initial] (3) applying pattern '^(.*)' to uri '/a/'\n000000c14f0/initial] (1) pass through /a/\n000000c14f0/initial] (3) [per-dir /var/tmp/apache2/htdocs/a/] strip per-dir\nprefix: /var/tmp/apache2/htdocs/a/ ->\n000000c14f0/initial] (3) [per-dir /var/tmp/apache2/htdocs/a/] applying pattern\n'^' to uri ''\n000000c14f0/initial] (1) [per-dir /var/tmp/apache2/htdocs/a/] pass through\n/var/tmp/apache2/htdocs/a/\n000000c9530/subreq] (2) init rewrite engine with requested uri /a/index.html\n000000c9530/subreq] (3) applying pattern '^(.*)' to uri '/a/index.html'\n000000c9530/subreq] (1) pass through /a/index.html\n\n\nSo the second group of \"per-dir\" is missing?!\nProbably I'm doing something wrong in the configuration?\n\nIs there a way to get the real filename if the rules are in httpd.conf, avoiding\nto use .htaccess? That would be great!\n\n\nHoping to be clear this time :), thanks, Adam."}, {"count": 3, "attachment_id": null, "bug_id": 15751, "text": "ah, I think it's a subtle different behaviour of mod_negotiation when doing\ninternal redirects.\n\nI'm not sure, in what form you need the resulting filename, but I think, the\nfollowing does the trick for you (in serverconfig):\n\nRewriteRule ^ %{LA-U:REQUEST_URI} [L,NS,PT]\n\nIt does an URI-lookahead and replaces the current URI with the result. It works\nfor me (returns /a/index.html.en for example). The NS flag is included to avoid\nnasty loops. The PT flag passes through to the next hook (mod_alias or\nsomething). It's your decision, whether you have to use it or not. Try it out if\nunsure ;-)\n\nI'll mark this bug as invalid, because there's no real bug - IMHO. Feel free to\nreopen it, if there are any further issues.\n\nThanks for using Apache!", "id": 28806, "time": "2003-01-02T00:38:24Z", "creator": "nd@perlig.de", "creation_time": "2003-01-02T00:38:24Z", "tags": [], "is_private": false}]
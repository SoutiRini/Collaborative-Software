[{"count": 0, "tags": [], "bug_id": 40828, "attachment_id": null, "text": "My problem is as follows:\nOn Oracle Applicaton Server Rel.1  (windowsNT) I had a page using SVG and it \nworked fine. Because we choose for an open platform, we copied the pages to \nTomcat 5.5.20 on Windows2003. Now we have the problem that the page is \ninitially ok when it is requested but using the back button (windowsxp pro sp2 \nin IE6 6.0.2900.2180 (sp2)) the picture is broken. Even if I refresh the page \nit is still broken. I made a favorite and using this one after the \"broken\" \npage it works eventhough it is the same URL. On firefox (2.0) it works just \nfine.\nSo, I went searching through the jsp-examples if there was the same error and \nit did.\nI used the New JSP XML Syntax (.jspx)/ SVG (Scalable Vector Graphics) example \nand on it showed the same error.", "id": 95143, "time": "2006-10-27T04:52:45Z", "creator": "d.kennedy@lvnl.nl", "creation_time": "2006-10-27T04:52:45Z", "is_private": false}, {"count": 1, "tags": [], "text": "I have tested this and can confirm it is not a Tomcat bug.\n\nLooks like an IE bug or more likely a bug with whichever SVG plugin you are\nusing to support SVG in IE. For the record the dobe plugin for IE7 fails when\nyou use the back button.", "is_private": false, "bug_id": 40828, "id": 95172, "time": "2006-10-27T18:37:41Z", "creator": "markt@apache.org", "creation_time": "2006-10-27T18:37:41Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "d.kennedy@lvnl.nl", "attachment_id": null, "id": 97192, "time": "2006-12-22T08:53:46Z", "bug_id": 40828, "creation_time": "2006-12-22T08:53:46Z", "is_private": false, "text": "Hi,\nI have some additional info after a long time of searching for a solution.\nI place a call@microsoft to solve the problem, they had only some suggestions \nbut it didn't solve it. \nI installed Tomcat 6.0.2beta and tried to run some simple code trying to solve \nthe problem using wireshark etc.\nThe fun is that the code I was using works on 6.0.2 beta but not on 5.5.20\n(I can't refresh (with a good result) in 5.5.20 but I do in 6.0.2).\nCan you tell me what the difference is between 6.0.2 so I can alter some \nsettings etc to 5.5.20.\nI can't use 6.0.2 because the system runs production and I will not run beta \nsoftware for production.\nThe code I used:\n************************************************************\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<?xml-stylesheet href=\"../CSS/graph.css\" type=\"text/css\"?>\n\n<%@ page contentType=\"image/svg-xml\" %>\n<%@ page import = \"java.util.*\" %>\n\n\n<svg width=\"860\" height=\"600\">\n\n\n<circle id=\"kreis\" cx=\"100\" cy=\"100\" r=\"40\" style=\"fill: #ffccaa\"/>\n\n<a xlink:href=\"http://www.google.nl\" \n     target=\"_top\">\n    <text x=\"30\" y=\"200\"><% out.print(\"(from out.print) = link to google.nl\");%>\n     </text>\n</a>\n\n</svg>\n************************************************************\nRegards,\nDuncan"}, {"count": 3, "tags": [], "text": "Again, SVG works for me in 5.5.20. I have tested with your provided example and\nwith a few changes so it is actually displayed it works fine with refresh.\n\nThis is clearly a browser/svg plugin issue, not a Tomcat issue.\n\n\nFor the record the amended test case was:\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<%@ page contentType=\"image/svg-xml\" %>\n<%@ page import = \"java.util.*\" %>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\"\n     xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n     version=\"1.1\"\n     baseProfile=\"full\"\n     width=\"860\" height=\"600\">\n\n<circle id=\"kreis\" cx=\"100\" cy=\"100\" r=\"40\" style=\"fill: #ffccaa\"/>\n\n<a xlink:href=\"http://www.google.nl\" \n     target=\"_top\">\n    <text x=\"30\" y=\"200\"><% out.print(\"(from out.print) = link to google.nl\");%>\n     </text>\n</a>\n\n</svg>", "attachment_id": null, "bug_id": 40828, "id": 97202, "time": "2006-12-22T17:01:00Z", "creator": "markt@apache.org", "creation_time": "2006-12-22T17:01:00Z", "is_private": false}, {"count": 4, "tags": [], "text": "Hi Mark,\n\nSorry to bother you again but I really want this to work.\nDid you test the jsp in IE? because it works in Firefox.\nI'm using the adobe v3 (EN) svg plugin.\nI tested with 2 tomcat 5.5.20 instances on 2 different win2k3 servers but on \nrefresh it doesn't work.\nI tested the 6.0.2 beta and it works on refresh with IE. (I tried 5 pc's and \nthey all react the same way).\nPlease tell me what to do or what the differences are so I can alter/patch the \n5.5.20 instances.\nIf you need any more info than I will provide you those offcourse.\nRegards,\nDuncan\n", "attachment_id": null, "id": 97366, "creator": "d.kennedy@lvnl.nl", "time": "2006-12-27T02:36:43Z", "bug_id": 40828, "creation_time": "2006-12-27T02:36:43Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 40828, "attachment_id": null, "text": "This still looks to be a browser/plug-in issue. I do see this issue with IE but\nnot with Firefox.\n\nThere are no obvious changes between 5.5.x and 6.0.x that spring to mind.\n\nYour best bet is to use ieHttpHeaders to look at exactly what is being sent to\nthe browser.\n\nIf there is a difference between 5.5.x and 6.0.x and the 5.5.x version is not\ncompliance with a relevant specification (Servlet, JSP, HTTP, SVG, etc) then\nthis bug can be re-opened.", "id": 97473, "time": "2006-12-29T21:22:41Z", "creator": "markt@apache.org", "creation_time": "2006-12-29T21:22:41Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 40828, "is_private": false, "text": "Hi Mark,\n\nLike you said I got het http headers and they are different between 5.5.20 en \n6.0.2.\nIn the response of 5.5.20 I see:\n***************\nHTTP/1.1 200 OK\nServer: Apache-Coyote/1.1\nSet-Cookie: JSESSIONID=53204A6840B839F56041E8810AE20EF9; Path=/duncan\nContent-Type: image/svg-xml;charset=ISO-8859-1\nContent-Length: 442\nDate: Thu, 08 Feb 2007 14:57:23 GMT\n***************\nIn the response of 6.0.2 I see:\nHTTP/1.1 200 OK\nServer: Apache-Coyote/1.1\nSet-Cookie: JSESSIONID=2C395C611F300A0C31AB255EBCE48555; Path=/duncan\nContent-Type: image/svg-xml\nContent-Length: 442\nDate: Thu, 08 Feb 2007 14:58:31 GMT\n****************\nThe only difference on first contact is the Content-Type.\nThere isn't a difference between the windows regional settings from the 2 \nservers. So I looked at the internet to see some hits on this issue.\nI couldn't find any accept links to the Coyote connector.\nAfter downloading the source I found the difference in the response.java\nThis had been changed in the case of setting the character encoding:\nreponse.java in Tomcat 5.5:\npublic PrintWriter getWriter() \n        throws IOException {\n \n        if (usingOutputStream)\n            throw new IllegalStateException\n                (sm.getString(\"coyoteResponse.getWriter.ise\"));\n \n        /*\n         * If the response's character encoding has not been specified as\n         * described in <code>getCharacterEncoding</code> (i.e., the method\n         * just returns the default value <code>ISO-8859-1</code>),\n         * <code>getWriter</code> updates it to <code>ISO-8859-1</code>\n         * (with the effect that a subsequent call to getContentType() will\n         * include a charset=ISO-8859-1 component which will also be\n         * reflected in the Content-Type response header, thereby satisfying\n         * the Servlet spec requirement that containers must communicate the\n         * character encoding used for the servlet response's writer to the\n         * client).\n         */\n        setCharacterEncoding(getCharacterEncoding());\n \n        usingWriter = true;\n        outputBuffer.checkConverter();\n        if (writer == null) {\n            writer = new CoyoteWriter(outputBuffer);\n        }\n        return writer;\n \n    }\n \nresponse.java in Tomcat 6.0 rc2\npublic PrintWriter getWriter() \n        throws IOException {\n \n        if (usingOutputStream)\n            throw new IllegalStateException\n                (sm.getString(\"coyoteResponse.getWriter.ise\"));\n \n        if (Globals.STRICT_SERVLET_COMPLIANCE) {\n            /*\n             * If the response's character encoding has not been specified as\n             * described in <code>getCharacterEncoding</code> (i.e., the method\n             * just returns the default value <code>ISO-8859-1</code>),\n             * <code>getWriter</code> updates it to <code>ISO-8859-1</code>\n             * (with the effect that a subsequent call to getContentType() will\n             * include a charset=ISO-8859-1 component which will also be\n             * reflected in the Content-Type response header, thereby satisfying\n             * the Servlet spec requirement that containers must communicate the\n             * character encoding used for the servlet response's writer to the\n             * client).\n             */\n            setCharacterEncoding(getCharacterEncoding());\n        }\n \n        usingWriter = true;\n        outputBuffer.checkConverter();\n        if (writer == null) {\n            writer = new CoyoteWriter(outputBuffer);\n        }\n        return writer;\n \n    }\nIn 6.0.2 is an extra if and my idea is that this can cause the problem.\nI really like to hear from you.\nRegards,\n\nDuncan Kennedy", "id": 99321, "time": "2007-02-13T02:40:29Z", "creator": "d.kennedy@lvnl.nl", "creation_time": "2007-02-13T02:40:29Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "This behaviour is required by the spec so this is not a bug. That the client\ndoesn't handle it is an issue for the client.\n\nIf you want more control over the headers to work around this client issue then\nyou can use getOutputStream() rather than getWriter().", "attachment_id": null, "bug_id": 40828, "id": 99454, "time": "2007-02-15T16:01:35Z", "creator": "markt@apache.org", "creation_time": "2007-02-15T16:01:35Z", "is_private": false}]
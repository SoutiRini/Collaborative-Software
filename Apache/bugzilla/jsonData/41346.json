[{"count": 0, "tags": [], "creator": "mail4cheery@gmail.com", "attachment_id": null, "id": 97917, "time": "2007-01-10T20:01:19Z", "bug_id": 41346, "creation_time": "2007-01-10T20:01:19Z", "is_private": false, "text": "sorry for version 2.2.3 selected - the problem related to the new 2.2.4 \nversion.\nI've compiled it and also tried .msi package from the website. The results are \nthe same:\nErrorLog \"|/webserver/bin/rotatelogs.exe /webserver/logs/error_log.%Y-%m-%d \n86400\" in config allows httpd.exe to start from the command line, but it \ncreates an error while trying to start apache as service..\n\"The Apache service named  reported the following error:\n>>> Unable to open logs     .\"\nand \n\"The Apache service named  reported the following error:\n>>> (22)Invalid argument: Couldn't start ErrorLog process     .\"\nKeeping an initial record \"ErrorLog /webserver/logs/error_log\" doesn't create \nthis error.\nI didn't try it with access logs - they are rotating with mod_log_rotate"}, {"count": 1, "tags": [], "creator": "wrowe@apache.org", "attachment_id": null, "id": 97921, "time": "2007-01-10T22:08:04Z", "bug_id": 41346, "creation_time": "2007-01-10T22:08:04Z", "is_private": false, "text": "There appears to be something specific to WinXP with respect to this bug,\n2003 servers reportedly don't suffer the same ill effect, and the code\nwas last validated on 2000.\n\nI see the same won't-load-pipe-commands-as-a-service bug as you do.\n\nInvestigating"}, {"count": 2, "attachment_id": null, "creator": "trash_bin@nurfuerspam.de", "is_private": false, "id": 98173, "time": "2007-01-17T05:09:45Z", "bug_id": 41346, "creation_time": "2007-01-17T05:09:45Z", "tags": [], "text": "(In reply to comment #1)\n> There appears to be something specific to WinXP with respect to this bug,\n\nYou probably have been running into a problem already file under #16761 or\n#23616 for example.\n\nUse a tool like ProcessExplorer from www.sysinternals.com and make sure there\nare no zombie rotatelogs processes remaining from previous Apache sessions.\nKill these processes (on my 2.2.4 test server there are 4 - four!! - zombies\nremaining for each piped CustomLog directive defined).\n\nIf the service will start now we apparently have no windows version specific\nissue.\n\nThey claimed to have fixed this but OBVIOUSLY HAVEN'T!\n\nI'm using a special build from apachelounge.com, with OpenSSL included and\ncompiled against latest VC++ 2005 SP1 runtime libraries (vcredist_x86).\n"}, {"count": 3, "tags": [], "bug_id": 41346, "attachment_id": null, "id": 98183, "time": "2007-01-17T08:41:11Z", "creator": "mail4cheery@gmail.com", "creation_time": "2007-01-17T08:41:11Z", "is_private": false, "text": "There are no \"zombies\". It just doesn't start even at the first time after \ninstall."}, {"count": 4, "attachment_id": null, "bug_id": 41346, "text": "(In reply to comment #3)\n> There are no \"zombies\".\n\nHow did you manage that? I just grabbed myself an Windows XP notebook and\ninstalled the apachelounge.com distro, putting a pipe to rotatelogs into\nErrorLog and/or CustomLog directive.\n\nAnd there are zombies.\n\nCould you please use Process Explorer from sysinternals.com to verify if you\nhave any dead rotatelogs.exe processes? If you switch on command line viewing\n(view/select columns...) you'll probably investigate that funny mess more easy.\n\nI have two rotatelogs processes per logfile (showing the command line from\nhttpd.conf) under the httpd.exe process tree and another process seemingly\nhaving no parameters and running solely, i. e. this one isn't killed when the\napache process tree is killed. If I kill the top httpd.exe process only (not the\nwhole tree), no one of the pipe processes will disappear.\n\nAnd I couldn't start the Service with same \"Couldn't start ErrorLog\" too.\n", "id": 98217, "time": "2007-01-18T07:06:04Z", "creator": "trash_bin@nurfuerspam.de", "creation_time": "2007-01-18T07:06:04Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "text": "(In reply to comment #4)\n> How did you manage that? I just grabbed myself an Windows XP notebook and\n> installed the apachelounge.com distro, putting a pipe to rotatelogs into\n> ErrorLog and/or CustomLog directive.\n> \n> And there are zombies.\n\nI used Process Explorer to check it. And still - no zombies. And I didn't use \nbinaries from the site you mentioned. I've compiled it by myself and \ntried .msi package from Apache's website.\nAfter:\nC:\\Documents and Settings\\Vladimir>net start apache2\nThe Apache2 service is starting.\nThe Apache2 service could not be started.\n\nA service specific error occurred: 1.\n\nMore help is available by typing NET HELPMSG 3547.\n\nAnd you can see the list of processes\nhttp://img101.imageshack.us/img101/3199/clipboard01pc6.gif\n\nIf I start httpd.exe from command line then, of course, there will be \nrotatelogs processes which will disappear as soon as I stop apache with ctrl+c\n", "is_private": false, "id": 98224, "creator": "mail4cheery@gmail.com", "time": "2007-01-18T10:40:37Z", "bug_id": 41346, "creation_time": "2007-01-18T10:40:37Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "(In reply to comment #5)\n> I used Process Explorer to check it. And still - no zombies. And I didn't use \n> binaries from the site you mentioned.\n\nI haven't any zombies only after killing the httpd.exe process tree using\nProcess Explorer. But they will be there if the service or user process is\nterminated gracefully.\n\nIndeed both the ASF vs. the apachelounge.com (AL) binary distros deny to run as\nservice when an 'ErrorLog' directive in the main server goes through a piped\nprocess.\n\nA piped 'ErrorLog' within 'VirtualHost' does not obstruct it from starting, as\nwell as a piped 'CustomLog' directive within main server. Nevertheless I used to\nmove that to the same 'VirtualHost':\n\nListen 127.0.0.1:81\nServerName 127.0.0.1:81\nErrorLog \"logs/error.log\"\n#CustomLog \"logs/access.log\" common\n<VirtualHost 127.0.0.1:81>\n  ServerName localhost:81\n  ErrorLog \"|C:/Apache2/bin/rotatelogs.exe -l \\\n    C:/Apache2/logs/error.%Y-%m-%d_%H-%M-%S.log 60\"\n  CustomLog \"|C:/Apache2/bin/rotatelogs.exe -l \\\n    C:/Apache2/logs/access.%Y-%m-%d_%H-%M-%S.log 60\" common\n</VirtualHost>\n\nThe behaviour of the AL distro is slightly different from that of the ASF. AL\nproduces more zombies at runtime, two of them are already present outside the\nhttpd.exe process tree immediately after starting. ASF does not reveal them\nimmediately, but two zombies (instead of four with AL) stay around after\nterminating the server.\n\nOccasionally one of the zombies seems not to have any commandline parameter as\nshown by Process Explorer. Otherwise all two or four zombies are shown as\n'CustomLog' processes, writing to the access.*.log file.\n\nOn my experiments I didn't experience any locked files i. e. I could delete the\nlog files before killing the rotatelogs zombies. Locked files have been reported\nan even more serious problem in the past. Probably locking occurs after a\ngreater number of service start/stops?\n\n\n", "attachment_id": null, "id": 98251, "creator": "trash_bin@nurfuerspam.de", "time": "2007-01-19T02:44:12Z", "bug_id": 41346, "creation_time": "2007-01-19T02:44:12Z", "is_private": false}, {"count": 7, "tags": [], "creator": "trash_bin@nurfuerspam.de", "attachment_id": null, "is_private": false, "id": 98252, "time": "2007-01-19T02:46:18Z", "bug_id": 41346, "creation_time": "2007-01-19T02:46:18Z", "text": "(In reply to comment #6)\n> I haven't any zombies only after killing\n\nshould read: I haven't had any zombies after killing...\n"}, {"count": 8, "tags": [], "bug_id": 41346, "attachment_id": null, "text": "Version 2.2.4 is now available; it was added after the 2.2.4 release. \n\nI am seeing this problem on Windows Server 2003. My server has two pipes: one\nfor access and one for error log. The syntax is as follows:\n\nErrorLog \"| d:/httpd-2.2.4-ssl/bin/rotatelogs.exe\nd:/servername/logs/error-%Y-%m-%d.log 300 -420\"\nLogLevel warn\n\nCustomLog \"| d:/httpd-2.2.4/bin/rotatelogs.exe\nd:/servername/logs/access-%Y-%m-%d.log 300 -420\" common\n\nI can start the ApacheLounge distro from command line and it generates two empty\ncmd.exe windows, a total of four shells with rotatelogs.exe (two under the\nparent, two under the child) visible in Process Explorer, as well as two zombies. \n\nTrying to start the service (installed with d:\\httpd-2.2.4-ssl\\bin\\httpd -d\nd:/servername -n Apache224 -k install) gives me an error dialog that tells me to\nlook in the Event Log, which has three entries: \n\nOne about the Win32DisableAcceptEx directive (not relevant to this issue)\n\nOne that says The Apache service named  reported the following error: \n>>> (22)Invalid argument: Couldn't start the ErrorLog process\n\nOne that says The Apache service named  reported the following error:\n>>> Unable to open logs  .\n\nThis gives me TWO zombies. \n\nThen I turned off the ErrorLog pipe, and used instead a normal file path with\nLogLevel debug. \n\nThe server starts and serves pages. I initially saw two cmd.exe + rotatelogs.exe\n hang off the parent and child respectively. These eventually went away, and I\nnow have two zombies (haven't reconciled their PIDs). \n\nThe Error log contains no red flags. The access-2007-01-28.log is created, but\ncontains nothing but a large number of lines reading:\n\npiped log program ' d:/httpd-2.2.4/bin/rotatelogs.exe\nd:/servername/logs/access-%Y-%m-%d.log 300 -420' failed unexpectedly\n\nInterestingly, my test box behaves very similarly with 2.2.3, which I have been\nrunning in Production with rotatelogs. I have to go in and manually reap the\ndead rotatelogs.exe processes from time to time, but at least it works. ", "id": 98659, "time": "2007-01-28T13:11:25Z", "creator": "sander@temme.net", "creation_time": "2007-01-28T13:11:25Z", "is_private": false}, {"count": 9, "attachment_id": null, "creator": "nttnguyen@tma.com.vn", "is_private": false, "id": 104190, "time": "2007-06-08T04:25:09Z", "bug_id": 41346, "creation_time": "2007-06-08T04:25:09Z", "tags": [], "text": "I'm running into the same problem on Windows Server 2000 SP4 plaform. I'm using \nthe syntax as :\n\nErrorLog \"|C:/PROGRA~1/VSCommon/apache/bin/rotatelogs.exe \nC:/PROGRA~1/VSCommon/apache/logs/error.%Y%m%d 86400\"\n\nThe Apache v2.2.4 couldn't start at the first time I installed it after \nbuilding, with the same error dialogs invoked as Sander Temme got.\n\nAnybody have suggestion on how to have rotatelogs worked? It's been a while and \nthis bug's status is still \"NEW\", so I wonder if I missed any solution given \nsomewhere on earth?\n\n"}, {"count": 10, "tags": [], "bug_id": 41346, "attachment_id": null, "text": "I have the same problem: Apache 2.2.4 on Win2003 SP1.\nI want to upgrade because of recent proxy server fixes.\n\nI use cronolog for rotation, but both rotatelogs.exe and chronolog.exe prevent \nstartup of the NT service.\n\n- CustomLog: rotatelogs.exe and chronolog.exe are both no problem\n- ErrorLog: rotatelogs.exe and chronolog.exe are both impossible\n- Same server has Apache 2.0.59 running, also with chronolog\n- Apache 2.2.3: No problem (running on WinXP SP2)\n", "id": 104640, "time": "2007-06-22T10:18:25Z", "creator": "henk.koelewijn@capgemini.com", "creation_time": "2007-06-22T10:18:25Z", "is_private": false}, {"count": 11, "tags": [], "text": "I reproduced the issue on several 2003srv systems (SP1 and SP2), where Apache\n2.2.3 were working correctly with rotatelogs.\nI've tried using a rotatelogs from 2.2.3 distribution on Apache 2.2.4 -> same issue.\nI finally achieved to make it work by defining the rotatelogs in a VirtualHost\nsection:\nErrorLog logs/error.log\n\n<VirtualHost *>\n\tErrorLog \"|bin/rotatelogs -l logs/error.%Y-%m-%d-%H_%M_%S.txt 86400\"\n</VirtualHost>\n\nI would suggest looking at this issue as a possible side effect of\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=40651\n", "is_private": false, "id": 105847, "creator": "jfallot@infovista.com", "time": "2007-07-23T08:35:16Z", "bug_id": 41346, "creation_time": "2007-07-23T08:35:16Z", "attachment_id": null}, {"count": 12, "tags": [], "text": "Known bug, solved in 2.2.6 (solution introduced some peculiar behaviors w.r.t.\nmodperl, the third party mod_fcgid, etc, which will be addressed in 2.2.7).", "is_private": false, "id": 108692, "creator": "wrowe@apache.org", "time": "2007-09-26T21:59:23Z", "bug_id": 41346, "creation_time": "2007-09-26T21:59:23Z", "attachment_id": null}]
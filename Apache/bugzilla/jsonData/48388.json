[{"count": 0, "tags": [], "bug_id": 48388, "attachment_id": 24706, "id": 132808, "time": "2009-12-14T12:28:26Z", "creator": "cvaldivia@gmail.com", "creation_time": "2009-12-14T12:28:26Z", "is_private": false, "text": "Created attachment 24706\nError log filtered\n\nWe are experiencing intermittent \"connect timeout\" errors. The remote\nservice is really \"ok\", but it still results in the worker being\ndisabled.\n\nError Log:(more in attach)\n\n[error] ap_proxy_connect_backend disabling worker for (192.168.5.17)\n\n\nWe have 1 balancer + 10 apache's workers\n\nMy config:\n\n<VirtualHost *>\n SetEnv force-proxy-request-1.0 1\n SetEnv proxy-nokeepalive 1\n\n ProxyRequests Off\n <Proxy *>\n   Order deny,allow\n   Allow from all\n </Proxy>\n\nProxyPass /balancer-manager !\nProxyPass / balancer://mycluster/\n\n ProxyPassReverse / http://192.168.5.11/\n ProxyPassReverse / http://192.168.5.12/\n ProxyPassReverse / http://192.168.5.14/\n ProxyPassReverse / http://192.168.5.15/\n ProxyPassReverse / http://192.168.5.16/\n ProxyPassReverse / http://192.168.5.17/\n ProxyPassReverse / http://192.168.5.18/\n ProxyPassReverse / http://192.168.5.19/\n ProxyPassReverse / http://192.168.5.110/\n ProxyPassReverse / http://192.168.5.111/\n\n<Proxy balancer://mycluster>\n\n   BalancerMember http://192.168.5.11 route=w1 loadfactor=39\n   BalancerMember http://192.168.5.12 route=w2 loadfactor=39\n   BalancerMember http://192.168.5.14 route=w4 loadfactor=39\n   BalancerMember http://192.168.5.15 route=w5 loadfactor=55\n   BalancerMember http://192.168.5.16 route=w6 loadfactor=55\n   BalancerMember http://192.168.5.17 route=w7 loadfactor=55\n   BalancerMember http://192.168.5.18 route=w8 loadfactor=55\n   BalancerMember http://192.168.5.19 route=w9 loadfactor=75\n   BalancerMember http://192.168.5.110 route=w10 loadfactor=50\n   BalancerMember http://192.168.5.111 route=w11 loadfactor=80\n\n </Proxy>\n\n</VirtualHost>\n\nAll servers are in datacenter with 1gb cisco switch and 10/100 internet bandwidth."}, {"count": 1, "tags": [], "bug_id": 48388, "attachment_id": null, "text": "Cristian;\n   Have you had the opportunity to set LogLevel to debug for additional information and confirmed that all logging is making it to the error_log in question? Given your configuration, I think the error is happening as a request is being processed. Do you have any way to duplicate this problem or perhaps confirm that the backend is not having any sort of problems?\n\nThe relevant code in question is in modules/proxy/proxy_util.c\n    /*\n     * Put the entire worker to error state if\n     * the PROXY_WORKER_IGNORE_ERRORS flag is not set.\n     * Altrough some connections may be alive\n     * no further connections to the worker could be made\n     */\n    if (!connected && PROXY_WORKER_IS_USABLE(worker) &&\n        !(worker->s->status & PROXY_WORKER_IGNORE_ERRORS)) {\n        worker->s->status |= PROXY_WORKER_IN_ERROR;\n        worker->s->error_time = apr_time_now();\n        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,\n            \"ap_proxy_connect_backend disabling worker for (%s)\",\n            worker->hostname);\n    }\n\nThis is after a loop that will iterate through each backend address returned by DNS and attempt connection. I ask if this is all of the log because there should be at least one more error message that accompanies this one.", "id": 135768, "time": "2010-03-29T18:35:45Z", "creator": "DRuggeri@primary.net", "creation_time": "2010-03-29T18:35:45Z", "is_private": false}, {"count": 2, "tags": [], "creator": "saso.tavcar@ais42.net", "attachment_id": null, "text": "After a few years since early apache httpd 2.2.x releases I give it another try to migrate our apache httpd proxy server from 2.0.x versions to 2.2.x. Still there is an issue with unresponsive backend servers with 503 error on apache httpd proxy. Both versions have practically the same configuration, but with 2.0.x version we do not experience any user experience errors, while with 2.2.x versions users get 503 errors and timeouts for simple webpages.\n\n\nOld apache httpd 2.0.63 proxy error_log: \n\n[Fri Aug 20 10:11:42 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 20 11:47:14 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 20 17:25:16 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 20 18:07:02 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 20 19:04:31 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Sat Aug 21 06:49:18 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Sat Aug 21 17:06:21 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Sat Aug 21 18:34:41 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Sun Aug 22 11:02:49 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Mon Aug 23 08:39:00 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Tue Aug 24 16:34:32 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 07:36:21 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n\n\nWhen we switch to apache httpd 2.2.16 proxy we get immediate bad user experience hit with http 503 errors and timeouts on proxy server, while 2.2.x backend servers have same load:\n\n[Wed Aug 25 07:36:21 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 08:28:22 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 08:28:22 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 09:05:19 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 09:05:19 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 09:10:03 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 09:10:03 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 09:18:32 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 09:18:32 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 09:51:51 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 09:51:51 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 09:53:38 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 09:53:38 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 10:00:12 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 10:00:12 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 10:04:21 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 10:04:21 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 10:06:06 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 10:06:06 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n.....\n[Fri Aug 27 09:21:53 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:22:39 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:35:38 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:35:38 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:36:22 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:36:22 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:36:36 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:37:33 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:37:33 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:41:46 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:41:46 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:42:05 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:42:05 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:42:08 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:42:08 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:42:32 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:42:32 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n\nSwitch back to apache httpd 2.0.63 proxy and we immediate get normal user experience, due to\nerror in error_log:\n\n[Fri Aug 27 09:43:07 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:51:34 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:59:50 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:00:35 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:00:35 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:20:59 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:21:00 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:34:03 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:37:59 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:38:15 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed", "id": 139565, "time": "2010-08-30T18:00:38Z", "bug_id": 48388, "creation_time": "2010-08-30T18:00:38Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 48388, "attachment_id": null, "id": 139566, "time": "2010-08-30T18:01:56Z", "creator": "saso.tavcar@ais42.net", "creation_time": "2010-08-30T18:01:56Z", "is_private": false, "text": "After a few years since early apache httpd 2.2.x releases I give it another try to migrate our apache httpd proxy server from 2.0.x versions to 2.2.x. Still there is an issue with unresponsive backend servers with 503 error on apache httpd proxy. Both versions have practically the same configuration, but with 2.0.x version we do not experience any user experience errors, while with 2.2.x versions users get 503 errors and timeouts for simple webpages.\n\n\nOld apache httpd 2.0.63 proxy error_log: \n\n[Fri Aug 20 10:11:42 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 20 11:47:14 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 20 17:25:16 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 20 18:07:02 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 20 19:04:31 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Sat Aug 21 06:49:18 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Sat Aug 21 17:06:21 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Sat Aug 21 18:34:41 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Sun Aug 22 11:02:49 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Mon Aug 23 08:39:00 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Tue Aug 24 16:34:32 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 07:36:21 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n\n\nWhen we switch to apache httpd 2.2.16 proxy we get immediate bad user experience hit with http 503 errors and timeouts on proxy server, while 2.2.x backend servers have same load:\n\n[Wed Aug 25 07:36:21 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 08:28:22 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 08:28:22 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 09:05:19 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 09:05:19 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 09:10:03 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 09:10:03 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 09:18:32 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 09:18:32 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 09:51:51 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 09:51:51 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 09:53:38 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 09:53:38 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 10:00:12 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 10:00:12 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 10:04:21 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 10:04:21 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Wed Aug 25 10:06:06 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Wed Aug 25 10:06:06 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n.....\n[Fri Aug 27 09:21:53 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:22:39 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:35:38 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:35:38 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:36:22 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:36:22 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:36:36 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:37:33 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:37:33 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:41:46 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:41:46 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:42:05 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:42:05 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:42:08 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:42:08 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n[Fri Aug 27 09:42:32 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:42:32 2010] [error] ap_proxy_connect_backend disabling worker for (www.domain.com)\n\nSwitch back to apache httpd 2.0.63 proxy and we immediate get normal user experience, due to\nerror in error_log:\n\n[Fri Aug 27 09:43:07 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:51:34 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 09:59:50 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:00:35 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:00:35 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:20:59 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:21:00 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:34:03 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:37:59 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed\n[Fri Aug 27 10:38:15 2010] [error] (110)Connection timed out: proxy: HTTP: attempt to connect to 192.168.102.2:80 (www.domain.com) failed"}, {"text": "Dear Friends,\nDid any one of you get solution for this problem as I am geting the same errors in my log file .\n errors are \n[client 2.] proxy: Error reading from remote server returned by /servlet/traveler/Microsoft-Server-ActiveSync\n[Fri Jul 15 09:08:54 2011] [error] [client 10.10.10.10] (70007)The timeout specified has expired: proxy: error reading status line from remote server 10.20.20.20\n[Fri Jul 15 09:08:54 2011] [error] [client 10.10.10.10] proxy: Error reading from remote server returned by /servlet/traveler/Microsoft-Server-ActiveSync\n[Fri Jul 15 09:09:02 2011] [error] (110)Connection timed out: proxy: HTTPS: attempt to connect to 10.20.20.20:443 (10.10.10.10) failed\n[Fri Jul 15 09:09:02 2011] [error] ap_proxy_connect_backend disabling worker for (10.20.20.20)\n\nSiddhesh Samant\nlinux879@gmail.com", "tags": [], "creator": "linux879@gmail.com", "attachment_id": null, "count": 4, "id": 148562, "time": "2011-08-11T11:50:03Z", "bug_id": 48388, "creation_time": "2011-08-11T11:50:03Z", "is_private": false}, {"count": 5, "tags": [], "creator": "yin.man@atos.net", "is_private": false, "id": 148679, "attachment_id": null, "bug_id": 48388, "creation_time": "2011-08-18T11:58:17Z", "time": "2011-08-18T11:58:17Z", "text": "Hi,\n\nAt my place we encountered similar issues with 503. \n\nI had httpd 2.2.3-43 (Red Hat compile) on RHEL 5.5 running as reverse proxy behind a CISCO ACE loadbalancer.\n\nThe same proxy was proxying traffic to Apache httpd and MS IIS (version 6 I think).  The 503 appears to cause by tcp_timestamp NOT being set from the  CISCO ACE loadbalancer.  \n\nSo we applied the change as recommended in https://access.redhat.com/kb/docs/DOC-51227 and the 503 messages stop appearing in our staging network.\n\nWill update this if the problem is resolved in the production network.\n\nYin"}, {"count": 6, "tags": [], "bug_id": 48388, "attachment_id": null, "text": "Sorry folks,\n\nIt looks like the problem was not resolved by the previous post by me.  The problem went away when the Ace was taken out of the network setup.  The network technicians are now looking why the Ace is not working as it should.\n\nYin", "id": 149717, "time": "2011-09-24T13:41:56Z", "creator": "yin.man@atos.net", "creation_time": "2011-09-24T13:41:56Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 48388, "is_private": false, "id": 150512, "attachment_id": null, "creator": "linux879@gmail.com", "creation_time": "2011-10-13T09:37:09Z", "time": "2011-10-13T09:37:09Z", "text": "(In reply to comment #5)\n> Hi,\n> At my place we encountered similar issues with 503. \n> I had httpd 2.2.3-43 (Red Hat compile) on RHEL 5.5 running as reverse proxy\n> behind a CISCO ACE loadbalancer.\n> The same proxy was proxying traffic to Apache httpd and MS IIS (version 6 I\n> think).  The 503 appears to cause by tcp_timestamp NOT being set from the \n> CISCO ACE loadbalancer.  \n> So we applied the change as recommended in\n> https://access.redhat.com/kb/docs/DOC-51227 and the 503 messages stop appearing\n> in our staging network.\n> Will update this if the problem is resolved in the production network.\n> Yin\n\nMr Yin Can you please share the webpage https://access.redhat.com/kb/docs/DOC-51227  with us as we have not registered to this page .\n\nThankyou\nSiddhesh"}, {"count": 8, "tags": [], "bug_id": 48388, "text": "Hi,\n\nWe started encountering the same error after migrating from Solaris 10 to Solaris 11.1, when the Apache server tries to contact a backend on another machine.  \n\n[Mon Jan 05 10:54:31.905841 2015] [proxy:error] [pid 10503:tid 4] (146)Connection refused: AH00957: HTTP: attempt to connect to 1.1.1.1:8000 (mymachine.mycompany.com) failed\n[Mon Jan 05 10:54:31.905889 2015] [proxy:error] [pid 10503:tid 4] AH00959: ap_proxy_connect_backend disabling worker for (mymachine.mycompany.com) for 60s\n[Mon Jan 05 10:54:31.905909 2015] [proxy_http:error] [pid 10503:tid 4] [client 1.1.1.2:43413] AH01114: HTTP: failed to make connection to backend: mymachine.mycompany.com\n\nThis happens when there is a sudden burst of HTTP connection, typically in peak hours.  The burst can be very short, for instance 10-20 requests during a few seconds.\n\nIn a TCP dump, we see that the local (outgoing) TCP port for the connections gets reused too quickly, sometimes after a few seconds.  \n\nWhen the Apache server and the back-end are on the same machine, this error never occurs, probably because a TCP port used by a connection in \"TIME_WAIT\" is never assigned by the TCP/IP stack as local port.\n\nThis is most probably a Solaris bug, but for those searching Google for this error will hit this bug description.\n\nA potential workaround is to use mod_cluster.\n\nRegards.", "id": 180158, "time": "2015-01-05T12:59:42Z", "creator": "metatechbe@gmail.com", "creation_time": "2015-01-05T12:59:42Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "text": "Alternatively you could use the parameter status=+I either with ProxyPass or ProxySet, so to switch off \"disable on error\" for the defined worker.\n\nI agree that this should be the default for non-balancer-member workers, though.", "is_private": false, "id": 180161, "creator": "ylavic.dev@gmail.com", "time": "2015-01-05T14:29:37Z", "bug_id": 48388, "creation_time": "2015-01-05T14:29:37Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 48388, "is_private": false, "id": 180162, "attachment_id": 32341, "creator": "ylavic.dev@gmail.com", "creation_time": "2015-01-05T15:30:47Z", "time": "2015-01-05T15:30:47Z", "text": "Created attachment 32341\nDon't put normal (non balancer-member) workers in error (trunk/2.4.x)\n\nThis patch should prevent httpd from putting workers which are *not* load-balancer members in error state, since we don't want the retry timeout to be applied when there is no alternative to connect to."}, {"count": 11, "tags": [], "bug_id": 48388, "attachment_id": 32342, "text": "Created attachment 32342\nDon't put normal (non balancer-member) workers in error (2.2.x)\n\nSame for 2.2.x.\n\nCan you test it with your configuration?", "id": 180163, "time": "2015-01-05T15:33:11Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2015-01-05T15:33:11Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 48388, "text": "Created attachment 32343\nDon't put normal (non balancer-member) workers in error (2.2.x)\n\nFixed patch for 2.2.x (which does not use mod_proxy's child_init() run before mod_proxy_balancer's...).", "id": 180164, "time": "2015-01-05T15:44:22Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2015-01-05T15:44:22Z", "is_private": false, "attachment_id": 32343}, {"count": 13, "tags": [], "bug_id": 48388, "attachment_id": null, "text": "(In reply to Yann Ylavic from comment #10)\n> Created attachment 32341 [details]\n> Don't put normal (non balancer-member) workers in error (trunk/2.4.x)\n> \n> This patch should prevent httpd from putting workers which are *not*\n> load-balancer members in error state, since we don't want the retry timeout\n> to be applied when there is no alternative to connect to.\n\n-1 as this being hardcoded. This can be already done with retry=0. We may discuss to set retry=0 as a default value in this case if not set explicitly. It may make sense to put even a single backend in error state for some time to give the backend some time to recover without new requests sent to it and have them blocked at the reverse proxy layer.", "id": 180173, "time": "2015-01-06T08:40:05Z", "creator": "rpluem@apache.org", "creation_time": "2015-01-06T08:40:05Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 48388, "attachment_id": null, "id": 180175, "time": "2015-01-06T11:37:40Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2015-01-06T11:37:40Z", "is_private": false, "text": "(In reply to Ruediger Pluem from comment #13)\n> (In reply to Yann Ylavic from comment #10)\n> > Created attachment 32341 [details]\n> > Don't put normal (non balancer-member) workers in error (trunk/2.4.x)\n> > \n> > This patch should prevent httpd from putting workers which are *not*\n> > load-balancer members in error state, since we don't want the retry timeout\n> > to be applied when there is no alternative to connect to.\n> \n> -1 as this being hardcoded. This can be already done with retry=0. We may\n> discuss to set retry=0 as a default value in this case if not set\n> explicitly. It may make sense to put even a single backend in error state\n> for some time to give the backend some time to recover without new requests\n> sent to it and have them blocked at the reverse proxy layer.\n\nNothing is hardcoded here, the default being still status=-I for balancer-members, but changed to status=+I for the standalone workers (but it can still be opt-out).\nThis is indeed debatable, the backend's time-to-recover argument is right/real, but there is no status=+I vs retry=0 here, both would change the default behaviour (is that acceptable?).\n\nThe only difference (I see) between status=+I and retry=0 is the logging of the worker's error/recovery states (in addition to the protocol/socket error).\nI think this logging should be done only for status=-I workers (hence +I should ignore any error, not only those from connect()/handshake, eg. failon{status,timeout} or 500/503...).\nThis is at least what I did (try to) implement in this patch, so that users with simple workers don't bother (including logs) with recovery period if they configured so (or by default, if acceptable)."}, {"count": 15, "tags": [], "bug_id": 48388, "attachment_id": null, "text": "(In reply to Yann Ylavic from comment #14)\n> (In reply to Ruediger Pluem from comment #13)\n> > (In reply to Yann Ylavic from comment #10)\n> > > Created attachment 32341 [details]\n> > > Don't put normal (non balancer-member) workers in error (trunk/2.4.x)\n> > > \n> > > This patch should prevent httpd from putting workers which are *not*\n> > > load-balancer members in error state, since we don't want the retry timeout\n> > > to be applied when there is no alternative to connect to.\n> > \n> > -1 as this being hardcoded. This can be already done with retry=0. We may\n> > discuss to set retry=0 as a default value in this case if not set\n> > explicitly. It may make sense to put even a single backend in error state\n> > for some time to give the backend some time to recover without new requests\n> > sent to it and have them blocked at the reverse proxy layer.\n> \n> Nothing is hardcoded here, the default being still status=-I for\n> balancer-members, but changed to status=+I for the standalone workers (but\n> it can still be opt-out).\n\nSorry I misread the patch here. So no worries. As said changing the default makes sense for trunk. As this setup can already be reached by explicit configuration I would not backport it.", "id": 180192, "time": "2015-01-06T18:47:52Z", "creator": "rpluem@apache.org", "creation_time": "2015-01-06T18:47:52Z", "is_private": false}, {"count": 16, "tags": [], "creator": "ylavic.dev@gmail.com", "attachment_id": null, "text": "Thanks R\u00fcdiger for the (new) review, commited in r1650028 (trunk).\n\nRegarding this PR, for 2.4.x or 2.2.x, the default remains the error state (quarantine) during \"retry\" seconds (for connect(), 500/503 or failon{status,timeout} errors).\n\nIt can be changed with :\n ProxyPass/ProxySet ... status=+i retry=0", "id": 180203, "time": "2015-01-07T10:46:34Z", "bug_id": 48388, "creation_time": "2015-01-07T10:46:34Z", "is_private": false}, {"count": 17, "tags": [], "bug_id": 48388, "attachment_id": null, "id": 180897, "time": "2015-02-10T13:45:42Z", "creator": "metatechbe@gmail.com", "creation_time": "2015-02-10T13:45:42Z", "is_private": false, "text": "Here is more information regarding our problem.  It is not a Solaris 11 bug but a Solaris 11 security hardening.\n\nIn Solaris 10, the ougoing TCP ports were chosen sequentially.\nIn Solaris 11, probably to implement RFC 6056 \"Recommendations for Transport-Protocol Port Randomization\", TCP ports are randomly chosen.\nBut the randomization does not guarantee that the port is not reused within 4 minutes (2 x the TCP Maximum Segment Lifetime, specified in RFC 1122)\n\nThe problem is occurring when the server-side of the TCP connection is closing the connection first, for instance when the HTTP Keep-Alive is disabled with the HTTP header \"Connection: closed\".  In this case, the TCP connection stays in the TIME_WAIT state for a short period on the server-side, but the TCP connection is immediately CLOSED on the client side.  The Solaris server accepts a new connection anyway, but the Cisco PIX and ACE firewall in between rejects them.\n\nA more detailed explanation is available here :\t\t\t\t \nhttp://blog.davidvassallo.me/2010/07/13/time_wait-and-port-reuse/\n\nThe RFC6191 specifies that TCP timestamps defined in RFC 1323 can be used to shorten the TIME_WAIT period for a socket.\n\nTo activate it under Solaris, run the following command on the machine initiating the TCP connections : \nsudo ndd -set /dev/tcp tcp_tstamp_always 1\n \nThe firewall must use this TCP field in its heuristics to make it work however.\n\nOtherwise, it is possible to disable port randomization on Solaris 11 by adding the following line in /etc/system and rebooting the system :\n\nset ip:tcp_random_anon_port=0"}]
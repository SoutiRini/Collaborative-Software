[{"count": 0, "tags": [], "bug_id": 46884, "attachment_id": null, "id": 125664, "time": "2009-03-20T12:46:18Z", "creator": "Patrick.Heckenlively.ctr@dla.mil", "creation_time": "2009-03-20T12:46:18Z", "is_private": false, "text": "We noticed the following in the error log on one of our Apache 2.2.11 instances:\n\nsasl.c:74: failed assertion `ld != NULL'\n[Mon Mar 02 09:25:17 2009] [notice] child pid 25633 exit signal Abort (6)\n\nWe quickly determined that the file sasl.c referenced above is part of the OpenLDAP code base.\n\nAfter exhaustive research that included running Apache inside gdb, I believe that I have tracked down the cause in what appears to be a minor bug in apr_ldap_stub.c.  Observe the following code snippet starting in line 48 of apr_ldap_stub.c:\n\n#if defined(NETWARE)\n    modname = \"aprldap.nlm\";\n#elif defined(WIN32)\n    modname = \"apr_ldap-\" APU_STRINGIFY(APU_MAJOR_VERSION) \".dll\";\n#else\n    modname = \"apr_ldap-\" APU_STRINGIFY(APU_MAJOR_VERSION) \".so\";\n#endif\n    rv = apu_dso_load(&symbol, modname, \"apr__ldap_fns\", pool);\n    if (rv == APR_SUCCESS) {\n        lfn = symbol;\n    }\n\nBecause we are on a UNIX platform, the variable modname acquires the value \"apr_ldap-1.so\".  However, because we are on PA-Risc based HP-UX 11.11, the Apache build process creates this file with the name \"apr_ldap-1.sl\".  This causes the call to apu_dso_load to fail.  This in turn causes Apache to call OpenLDAP libraries with improperly initialized parameter(s), which is why we get the failed assertion in sasl.c in the OpenLDAP code base.\n\nThankfully, the workaround is trivial.  In SERVERROOT/lib/apr-util-1, I\nsymlinked apr_ldap-1.so to apr_ldap-1.sl, and LDAP authentication works\nwithout the error described above.\n\nA back trace of how execution gets to this point follows:\n\n(gdb) bt\n#0  load_ldap (pool=0x40164020) at ldap/apr_ldap_stub.c:53\n#1  0x7ade9d30 in apr_ldap_init (pool=0x40164020, ldap=0x40086cc0, \n    hostname=0x40086d68 \"REDACTEDHOSTNAME\", portno=636, secure=0, \n    result_err=0x7ab47854) at ldap/apr_ldap_stub.c:82\n#2  0xc90b4 in uldap_connection_init (r=0x40164060, ldc=0x40086cc0)\n    at util_ldap.c:228\n#3  0xc93e8 in uldap_connection_open (r=0x40164060, ldc=0x40086cc0)\n    at util_ldap.c:353\n#4  0xcaa6c in uldap_cache_checkuserid (r=0x40164060, ldc=0x40086cc0, \n    url=0x400ccfd8 \"REDACTEDURL\", basedn=0x400cd040 \"REDACTEDBASEDN\", scope=2, \n    attrs=0x400cd058, \n    filter=0x7ab455d0 \"REDACTEDFILTER\", \n    bindpw=0x40165560 \"REDACTEDBINDPW\", binddn=0x7ab475e0, \n    retvals=0x7ab455cc) at util_ldap.c:954\n#5  0xb85d8 in authn_ldap_check_password (r=0x40164060, \n    user=0x40165578 \"REDACTEDUSER\", password=0x40165560 \"REDACTEDPASSWORD\")\n    at mod_authnz_ldap.c:399\n#6  0xbbe40 in authenticate_basic_user (r=0x40164060) at mod_auth_basic.c:230\n#7  0xa7a50 in ap_run_check_user_id (r=0x40164060) at request.c:71\n#8  0xa8c1c in ap_process_request_internal (r=0x40164060) at request.c:190\n#9  0x2064e8 in ap_process_request (r=0x40164060) at http_request.c:280\n#10 0x20185c in ap_process_http_connection (c=0x40142538) at http_core.c:190\n#11 0x9c768 in ap_run_process_connection (c=0x40142538) at connection.c:43\n#12 0x9ce24 in ap_process_connection (c=0x40142538, csd=0x40142448)\n    at connection.c:178\n#13 0x236dbc in process_socket (p=0x40142408, sock=0x40142448, my_child_num=0, \n    my_thread_num=0, bucket_alloc=0x40162010) at worker.c:544\n#14 0x237aa4 in worker_thread (thd=0x400d2c50, dummy=0x40141ff8)\n    at worker.c:894\n#15 0x7ae81f20 in dummy_worker (opaque=0x400d2c50)\n    at threadproc/unix/thread.c:142\n#16 0x7aecd290 in __pthread_body () from /usr/lib/libpthread.1\n(gdb)"}]
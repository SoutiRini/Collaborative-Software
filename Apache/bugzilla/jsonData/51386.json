[{"count": 0, "tags": [], "bug_id": 51386, "attachment_id": null, "text": "The following code in org.apache.catalina.startup.ContextConfig.checkHandlesTypes(JavaClass) looks very buggy :\n\n  boolean match = false;\n          \n  for (Map.Entry<Class<?>, Set<ServletContainerInitializer>> entry :\n          typeInitializerMap.entrySet()) {\n      if (entry.getKey().isAnnotation()) {\n          AnnotationEntry[] annotationEntries = javaClass.getAnnotationEntries();\n          for (AnnotationEntry annotationEntry : annotationEntries) {\n              if (entry.getKey().getName().equals(\n                  getClassName(annotationEntry.getAnnotationType()))) {\n                  match = true;\n                  break;\n              }\n          }\n      } else if (entry.getKey().isAssignableFrom(clazz)) {\n          match = true;\n      }\n      if (match) {\n          for (ServletContainerInitializer sci : entry.getValue()) {\n              initializerClassMap.get(sci).add(clazz);\n          }\n      }\n  }\n\nShouldn't \"match\" variable be reset to false at each iteration ?\n\nAs it is for now, my SpringServletContainerInitializer (3.1M2), handling only WebApplicationInitializers, will finally receive a huge set of various applicative classes, starting from the first class parsed matching any type handled by any previously parsed ServletContainerInitializer !!!\n\nhttp://svn.apache.org/repos/asf/tomcat/trunk/java/org/apache/catalina/startup/ContextConfig.java", "id": 147194, "time": "2011-06-16T14:12:27Z", "creator": "etienne.massip@gmail.com", "creation_time": "2011-06-16T14:12:27Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 51386, "text": "Finally leading to a cast exception preventing server startup.", "id": 147196, "time": "2011-06-16T14:55:12Z", "creator": "etienne.massip@gmail.com", "creation_time": "2011-06-16T14:55:12Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "markt@apache.org", "text": "Yep, that looks like a problem. I'll put together a test case and fix.", "id": 147198, "time": "2011-06-16T15:54:26Z", "bug_id": 51386, "creation_time": "2011-06-16T15:54:26Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "Thanks for the report. This has been fixed in 7.0.x and will be included in 7.0.17 onwards.", "id": 147205, "time": "2011-06-16T17:24:30Z", "bug_id": 51386, "creation_time": "2011-06-16T17:24:30Z", "is_private": false, "attachment_id": null}]
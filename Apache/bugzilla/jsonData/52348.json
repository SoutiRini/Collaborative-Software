[{"count": 0, "tags": [], "creator": "nestor.urquiza@gmail.com", "attachment_id": 28079, "is_private": false, "id": 152232, "time": "2011-12-16T20:42:05Z", "bug_id": 52348, "creation_time": "2011-12-16T20:42:05Z", "text": "Created attachment 28079\n5 files showing the issue\n\nThis is a bug resulting from a discussion on the mailing list http://apache-poi.1045710.n5.nabble.com/XSSFWorkbook-createCellStyle-fails-with-ArrayIndexOutOfBoundsException-td5033683.html\n\nI am attaching 5 files (two input xlsx files with the output xlsx you can obtain yourself if you run the JUnit class that uses the Util class). One is a util class that should allow me to merge two XLSX books and the other a JUnit test that cannot run and creates an output file where the style for the second sheet is missing.\n\nLook for the below lines and uncomment the code in the Util class then run the test again. The Exception will be thrown:\n\n//BUG: The below produces:\n                    /*\n                    java.lang.ArrayIndexOutOfBoundsException: -1\n                    at java.util.ArrayList.get(ArrayList.java:324)\n                    at org.apache.poi.xssf.model.StylesTable.getCellStyleXfAt(StylesTable.java:305)\n                    at org.apache.poi.xssf.usermodel.XSSFCellStyle.<init>(XSSFCellStyle.java:79)\n                    at org.apache.poi.xssf.model.StylesTable.createCellStyle(StylesTable.java:521)\n                    at org.apache.poi.xssf.usermodel.XSSFWorkbook.createCellStyle(XSSFWorkbook.java:443)\n                    */\n                    //newCellStyle = newCell.getSheet().getWorkbook().createCellStyle();\n                    //newCellStyle.cloneStyleFrom(oldCell.getCellStyle());\n                    //styleMap.put(stHashCode, newCellStyle);\n\nThanks!\n-Nestor"}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 152242, "time": "2011-12-17T10:45:44Z", "bug_id": 52348, "creation_time": "2011-12-17T10:45:44Z", "is_private": false, "text": "Are you able to unpack one of the problematic files (.xlsx files are a zip of xml files), and see if there's anything obviously different in the styles file between one that works and one that doesn't?\n\nFor a problem file, does adding or removing styles in excel fix things?"}, {"count": 2, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "id": 152282, "time": "2011-12-19T08:47:42Z", "bug_id": 52348, "creation_time": "2011-12-19T08:47:42Z", "is_private": false, "text": "I confirmed the problem in trunk. \n\nThe simplest failing test case is:\n\nXSSFWorkbook targetWorkbook = new XSSFWorkbook(new FileInputStream(\"balance.xlsx\"));\nXSSFCellStyle style = targetWorkbook.createCellStyle();\n\nSomehow appending a new cell style to balance.xlsx results in exception. \n\nYegor"}, {"count": 3, "tags": [], "text": "Fixed in r1220659, junit added\n\nYegor", "is_private": false, "bug_id": 52348, "id": 152283, "time": "2011-12-19T09:06:38Z", "creator": "yegor@dinom.ru", "creation_time": "2011-12-19T09:06:38Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 52348, "attachment_id": 28118, "text": "Created attachment 28118\ntwo screenshots showing how the second style of the merged sheet gets messed up\n\nHi Yegor,\n\nFirst, Happy and healthy 2012! \n\nThanks for looking at this issue. I can confirm the exception is not longer generated however the style for the second document is not respected after the merge. If you run my JUnit test you can confirm so but in any case I am attaching the screenshots for you to have a quick look at what is currently happening.\n\nThanks!\n-Nestor", "id": 152557, "time": "2012-01-03T18:44:16Z", "creator": "nestor.urquiza@gmail.com", "creation_time": "2012-01-03T18:44:16Z", "is_private": false}]
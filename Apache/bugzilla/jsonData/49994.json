[{"attachment_id": null, "tags": [], "bug_id": 49994, "is_private": false, "count": 0, "id": 140137, "time": "2010-09-24T07:59:24Z", "creator": "gurkanerdogdu@yahoo.com", "creation_time": "2010-09-24T07:59:24Z", "text": "In NamingContext implementation, if \"lookup()\" is a Reference, current\nimplementation caches the result of the NamingManager # getObjectInstance via\nfollowing statements and changes the type of the entry. In the following\nlookups, same object is returned. I would like to write ObjectFactory that\nreturns new instance for each time lookup is called on its reference. But with\nthe current implementation, it is not possible to write such an object factory\nbecause of aferomentioned sitaution. I think that entry must be stay as\nReference instead of changing entry type.\n\nNamingContext class:\n\nprotected Object lookup(Name name, boolean resolveLinks)\n        throws NamingException {\n.....\n            } else if (entry.type == NamingEntry.REFERENCE) {\n                try {\n                    Object obj = NamingManager.getObjectInstance\n                        (entry.value, name, this, env);\n                    if (obj != null) {\n                        entry.value = obj;                           \n                        entry.type = NamingEntry.ENTRY;  ---> CHANGES type of\nthe naming entry\n                    }\n                    return obj;\n                } catch (NamingException e) {\n                    throw e;\n                } catch (Exception e) {\n                    log.warn(sm.getString\n                            (\"namingContext.failResolvingReference\"), e);\n                    throw new NamingException(e.getMessage());\n                }\n            }\n\n...........\n}"}, {"count": 1, "tags": [], "text": "Comments from David Jencks:\n\nFor reference, the EE 6 platform spec explains that usually a new instance should be returned on each lookup in section 5.2.4 page 67 \"Sharing of Environment Entries\".  The servlet 3.0 spec section 15.2.2 page 174 indicates that this applies to servlet containers that are part of an EE technology-compliant implementation.  I guess this means that unless tomcat implements web profile they don't have to support this?  It still seems like a good idea to me.\n\nthanks\ndavid jencks", "attachment_id": null, "id": 140138, "creator": "gurkanerdogdu@yahoo.com", "time": "2010-09-24T08:00:08Z", "bug_id": 49994, "creation_time": "2010-09-24T08:00:08Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 49994, "is_private": false, "count": 2, "id": 140584, "time": "2010-10-08T07:59:54Z", "creator": "markt@apache.org", "creation_time": "2010-10-08T07:59:54Z", "text": "This has been fixed in trunk and will be included in 7.0.4 onwards. I also added a test case for this and a related issue (bug 23950)."}, {"count": 3, "tags": [], "text": "Note this behaviour will be configurable from 7.0.5 onwards and will default to the previous behaviour of returning the same object for each lookup.", "is_private": false, "bug_id": 49994, "id": 141423, "time": "2010-11-04T14:03:17Z", "creator": "markt@apache.org", "creation_time": "2010-11-04T14:03:17Z", "attachment_id": null}]
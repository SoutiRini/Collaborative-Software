[{"count": 0, "tags": [], "text": "On z/OS, <property environment=\"...\" /> fails when specifying a non-EBCDIC encoding in -Dfile.encoding.\n\nGiven the following test.xml:\n<project basedir=\".\" default=\"\" name=\"common\">\n        <property environment=\"env\" />\n</project>\n\nOutput for 'export ANT_OPTS=\"-Dfile.encoding=UTF-8 -Dconsole.encoding=IBM-1047 -Xnoargsconversion\" && ant -v -f test.xml':\n...\n [property] Loading Environment env.\n [property] Ignoring:\n [property] <...garbage characters here...>\n... \n\nThis occurs on Java 1.4.2, 5.0 and 6.0 and is present in Ant 1.7.1 and trunk.\n\nA solution is to remove the special casing in org/apache/tools/ant/taskdefs/Execute.java in Execute.toString(ByteArrayOutputStream bos) and just return bos.toString() (see below).\n\nThe issue may be related to the change made under bug 13047. Perhaps -Dfile.encoding was not respected for env vars on earlier JDKs?\n\n\n--- C:\\code\\ant\\apache-ant-1.7.1-orig\\src\\main\\org\\apache\\tools\\ant\\taskdefs\\Execute.java\t2008-06-27 05:05:22.000000000 +-0100\n+++ C:\\code\\ant\\apache-ant-1.7.1-patched\\src\\main\\org\\apache\\tools\\ant\\taskdefs\\Execute.java\t2009-04-09 13:39:24.000000000 +-0100\n@@ -259,25 +259,12 @@\n      * @return the output stream as a string, read with\n      * special encodings in the case of z/os and os/400.\n      *\n      * @since Ant 1.5\n      */\n     public static String toString(ByteArrayOutputStream bos) {\n-        if (Os.isFamily(\"z/os\")) {\n-            try {\n-                return bos.toString(\"Cp1047\");\n-            } catch (java.io.UnsupportedEncodingException e) {\n-                //noop default encoding used\n-            }\n-        } else if (Os.isFamily(\"os/400\")) {\n-            try {\n-                return bos.toString(\"Cp500\");\n-            } catch (java.io.UnsupportedEncodingException e) {\n-                //noop default encoding used\n-            }\n-        }\n         return bos.toString();\n     }\n \n     /**\n      * Creates a new execute object using <code>PumpStreamHandler</code> for\n      * stream handling.\n\n\n\nThis issue has been raised on the user mailing list: http://www.nabble.com/Ant-on-z-OS-tt5429644.html#a22832757", "attachment_id": null, "bug_id": 47007, "id": 126149, "time": "2009-04-09T05:45:26Z", "creator": "robin@soal.org", "creation_time": "2009-04-09T05:45:26Z", "is_private": false}]
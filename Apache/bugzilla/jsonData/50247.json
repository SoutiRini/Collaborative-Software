[{"count": 0, "tags": [], "bug_id": 50247, "attachment_id": null, "is_private": false, "id": 141606, "time": "2010-11-10T12:54:58Z", "creator": "alex-escalona@northwestern.edu", "creation_time": "2010-11-10T12:54:58Z", "text": "We are seeing sporadic instances of what appears to be a bug in httpd. The symptoms are that httpd hangs on polling and reading. Here's some pertinent lines from an strace log (I've separated the \"hanging\" sections with a space at both ends):\n\n  51988 31737 write(8, \"some.ip.address - - [09/Nov/2010:17:47:10 -0600] \\\"GET /learn/ HTTP/1.1\\\" 200 8719 \"..., 222) = 222\n  51989 31737 shutdown(11, 1 /* send */)        = 0\n  51990 31737 poll([{fd=11, events=POLLIN, revents=POLLIN|POLLHUP}], 1, 2000) = 1  51991 31737 read(11, \"\", 512)                 = 0  51992 31737 close(11)                         = 0\n  51993 31737 read(5, 0xbfedeccf, 1)            = -1 EAGAIN (Resource temporarily unavailable)  51994 31737 semop(1605639, 0x12fb44, 1 <unfinished ...>\n\n  51995 3551  <... select resumed> )            = 0 (Timeout)\n  51996 3551  waitpid(-1, 0xbfeded50, WNOHANG|WSTOPPED) = 0  51997 3551  select(0, NULL, NULL, NULL, {1, 0}) = 0 (Timeout)  51998 3551  waitpid(-1, 0xbfeded50, WNOHANG|WSTOPPED) = 0\n  51999 3551  select(0, NULL, NULL, NULL, {1, 0}) = 0 (Timeout)\n  52000 3551  waitpid(-1, 0xbfeded50, WNOHANG|WSTOPPED) = 0\n  52001 3551  select(0, NULL, NULL, NULL, {1, 0}) = 0 (Timeout)\n  52002 3551  waitpid(-1, 0xbfeded50, WNOHANG|WSTOPPED) = 0  52003 3551  select(0, NULL, NULL, NULL, {1, 0}) = 0 (Timeout)  52004 3551  waitpid(-1, 0xbfeded50, WNOHANG|WSTOPPED) = 0  52005 3551  select(0, NULL, NULL, NULL, {1, 0}) = 0 (Timeout)  52006 3551  waitpid(-1, 0xbfeded50, WNOHANG|WSTOPPED) = 0\n  52007 3551  select(0, NULL, NULL, NULL, {1, 0}) = 0 (Timeout)\n  52008 3551  waitpid(-1, 0xbfeded50, WNOHANG|WSTOPPED) = 0\n  52009 3551  select(0, NULL, NULL, NULL, {1, 0} <unfinished ...>\n\n  52010 4710  <... poll resumed> [{fd=4, events=POLLIN, revents=POLLIN}, {fd=3, events=POLLIN}], 2, -1) = 1\n  52011 4710  accept(4, {sa_family=AF_INET6, sin6_port=htons(63556), inet_pton(AF_INET6, \"::ffff:some.ip.address\", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28]) = 1        1\n  52012 4710  semop(1605639, 0x12fb4a, 1 <unfinished ...>\n  52013 14265 <... semop resumed> )             = 0\n  52014 4710  <... semop resumed> )             = 0\n\n  // ...\n\n  58900 31732 write(13, \"\\371\\0\\0\\0\\3SELECT * from trefPageModule\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t LEFT JOIN tPage ON tPage.pageID=tr\"..., 253) = 253\n  58901 31732 read(13,  <unfinished ...>\n\n  58902 3551  <... select resumed> )            = 0 (Timeout)\n  58903 3551  waitpid(-1, 0xbfeded50, WNOHANG|WSTOPPED) = 0\n  58904 3551  select(0, NULL, NULL, NULL, {1, 0} <unfinished ...>\n\n  58905 31732 <... read resumed> \"\\1\\0\\0\\1\\34<\\0\\0\\2\\3def\\6MySite\\16trefPageModule\\16trefPageModule\\2ID\\2ID\\f?\\0\\v\\0\\0\\0\\3\\3B\\0\\0\\0D\\0\\0\\3\\3def\\6Ut\"..., 16384) = 1871\n  58906 31732 poll([{fd=13, events=POLLIN|POLLPRI}], 1, 0) = 0\n\n  // ...\n\n  60626 31732 close(15)                         = 0\n  60627 31732 rt_sigaction(SIGPIPE, {SIG_IGN}, {SIG_IGN}, 8) = 0  60628 31732 brk(0x9392000)                    = 0x9392000\n  60629 31732 brk(0x9390000)                    = 0x9390000\n  60630 31732 brk(0x938e000)                    = 0x938e000\n  60631 31732 setitimer(ITIMER_PROF, {it_interval={0, 0}, it_value={0, 0}}, NULL) = 0\n  60632 31732 writev(11, [{\"\\27\\3\\1\\f\\360\\355\\214<(\\213r\\to\\10\\261J\\254\\327-!A\\242\\17\\6U\\336I3\\370\\335\\265\\323\\214\\236{H\\20\\344\\323\\324\\221\\330~\\345\\314\\246\\237\\245\\341\\25        0\\334\\335\\2\\201\\201\\274\\300\\360\\235\\277\\350\\n\\335\\373\\230\\236\\225b\\360<\\224\\200\\272\\252=p\\32\\360\\0361\"..., 3391}], 1) = 3391  60633 31732 write(8, \"some.ip.address - - [09/Nov/2010:17:49:10 -0600] \\\"GET /mysite/managePages/ HTTP/1\"..., 240) = 240\n  60634 31732 writev(11, [{\"\\25\\3\\1\\0 \\226\\304\\335\\336\\312\\224\\257\\300\\352#G|\\5Xjq3.#\\301\\236\\331\\352\\350&\\313\\330&5\\26\\210\\324\", 37}], 1) = 37\n  60635 31732 shutdown(11, 1 /* send */)        = 0\n  60636 31732 poll( <unfinished ...>\n\n  60637 3551  <... select resumed> )            = 0 (Timeout)\n  60638 3551  waitpid(-1, 0xbfeded50, WNOHANG|WSTOPPED) = 0\n  60639 3551  select(0, NULL, NULL, NULL, {1, 0} <unfinished ...>\n\n  60640 31732 <... poll resumed> [{fd=11, events=POLLIN, revents=POLLIN|POLLHUP}], 1, 2000) = 1\n  60641 31732 read(11, \"\\25\\3\\1\\0 i-B\\27\\367\\v\\252\\364\\372\\r\\30\\214\\1\\213\\233t\\25\\227O\\234ei[\\334\\272\\371@\\2127\\211\\241}\", 512) = 37\n  60642 31732 poll([{fd=11, events=POLLIN, revents=POLLIN|POLLHUP}], 1, 2000) = 1\n  60643 31732 read(11, \"\", 512)                 = 0"}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 141610, "creation_time": "2010-11-10T14:52:26Z", "time": "2010-11-10T14:52:26Z", "bug_id": 50247, "text": "Please try to get a stacktrace of the hanging thread (http://httpd.apache.org/dev/debugging.html). From the strace it looks like you are using some 3rd party \"app\" module like php in your httpd. What are you using?", "is_private": false}, {"count": 2, "tags": [], "bug_id": 50247, "attachment_id": null, "id": 141633, "time": "2010-11-11T11:12:00Z", "creator": "alex-escalona@northwestern.edu", "creation_time": "2010-11-11T11:12:00Z", "is_private": false, "text": "(In reply to comment #1)\n> Please try to get a stacktrace of the hanging thread\n> (http://httpd.apache.org/dev/debugging.html). From the strace it looks like you\n> are using some 3rd party \"app\" module like php in your httpd. What are you\n> using?\n\nWe are using php. I will have to wait until the next time this occurs--it appears to be sporadic, with a frequency of about once a week, roughly. Haven't been able to tie to any specific event or action conclusively."}, {"count": 3, "tags": [], "text": "Hi there,\n\nAlthough I don't know anything about Alex's bug, we experience something that looks like a bug that might be very similar so I thought to add more info here rather than opening a new one.\n\nThe httpd in question is 2.2.16 running on EC2.\n\nWe see that after a while (10 minutes) of a significant load, some of the worker processes get hang on poll().\n\nThis is the stacktrace from one of the processes that are in this state:\n\n#0  0x00007f76fa70c748 in poll () from /lib64/libc.so.6\n#1  0x00007f76fabe2822 in apr_wait_for_io_or_timeout () from /usr/lib64/libapr-1.so.0\n#2  0x00007f76fabdd2da in apr_socket_recv () from /usr/lib64/libapr-1.so.0\n#3  0x00007f76fc0dfddd in ap_lingering_close ()\n#4  0x00007f76fc0eaa7e in ?? ()\n#5  0x00007f76fc0ead1a in ?? ()\n#6  0x00007f76fc0eadd0 in ?? ()\n#7  0x00007f76fc0eb908 in ap_mpm_run ()\n#8  0x00007f76fc0c54fb in main ()\n\nPlease let me know if there's any more information I can provide - this problem is obviously a major concern to us.\n\nThanks,\nTal", "is_private": false, "id": 144866, "creator": "tal.yalon@gmail.com", "time": "2011-03-09T08:27:06Z", "bug_id": 50247, "creation_time": "2011-03-09T08:27:06Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 50247, "is_private": false, "id": 144871, "time": "2011-03-09T09:28:14Z", "creator": "covener@gmail.com", "creation_time": "2011-03-09T09:28:14Z", "tags": [], "text": "> Although I don't know anything about Alex's bug, we experience something that\n> looks like a bug that might be very similar so I thought to add more info here\n> rather than opening a new one.\n\nIf a thread stays in that backtraces for more than a few seconds, open a separate bug."}, {"count": 5, "tags": [], "creator": "covener@gmail.com", "is_private": false, "id": 149422, "creation_time": "2011-09-17T19:50:46Z", "time": "2011-09-17T19:50:46Z", "bug_id": 50247, "text": "Having threads spend time in poll() and read() is expected, reopen if you can illustrate something more nefarious", "attachment_id": null}]
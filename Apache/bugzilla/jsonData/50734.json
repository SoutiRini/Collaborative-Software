[{"count": 0, "attachment_id": null, "creator": "violetagg@apache.org", "is_private": false, "id": 144055, "time": "2011-02-08T11:14:59Z", "bug_id": 50734, "creation_time": "2011-02-08T11:14:59Z", "tags": [], "text": "Hi,\n\nI have the following use case:\nI have no web applications deployed on Tomcat. \nNevertheless when I request a web application: http://localhost:8080/testapp\nInstead of the expected 404 Not Found I'm receiving 400 Bad Request.\n\nThis scenario is tested on 6.0.32 and 7.0.8, it is working as expected on 7.0.8.\n\nWhile searching the code for both versions, I can see that in 7.0.8 you have the following:\n\norg.apache.catalina.connector.CoyoteAdapter.postParseRequest(Request, Request, Response, Response)\n...\n            // If there is no context at this point, it is likely no ROOT context\n            // has been deployed\n            if (request.getContext() == null) {\n                res.setStatus(404);\n                res.setMessage(\"Not found\");\n                // No context, so use host\n                request.getHost().logAccess(request, response, 0, true);\n                return false;\n            }\n...\n\nIn the 6.0.32 version of the same class there is no such statement. When entering org.apache.catalina.core.StandardEngineValve.invoke(Request, Response)\n...\n        if (host == null) {\n            response.sendError\n                (HttpServletResponse.SC_BAD_REQUEST,\n                 sm.getString(\"standardEngine.noHost\", \n                              request.getServerName()));\n            return;\n        }\n\n...\n\nthe host is null because the context is null. So 400 Bad Request is returned.\n\nCould you please introduce the check from Tomcat 7.0.8 in Tomcat 6.0.x. I think that 404 Not Found is more appropriate for this use case and not 400 Bad Request. The 400 status code typically is returned in case the request cannot be fulfilled due to bad syntax.\n\nThanks in advance\nBest Regards\nVioleta Georgieva"}, {"count": 1, "tags": [], "bug_id": 50734, "attachment_id": null, "id": 144063, "creation_time": "2011-02-08T15:47:58Z", "time": "2011-02-08T15:47:58Z", "creator": "chris@christopherschultz.net", "text": "For more context:\n\nhttp://markmail.org/message/3tpkhfqrsblzyiwd\n\nIn that thread, Pid offhandedly mentions a suggestion from Tim (maybe?) that a default ROOT context with no content be created if none is already deployed: this would allow standard \"not found\" pages to be returned, etc.\n\nVioleta, could you be specific about which patch for 7.0.8 you mean?", "is_private": false}, {"count": 2, "tags": [], "creator": "violetagg@apache.org", "attachment_id": 26626, "text": "Created attachment 26626\n400 Bad Request issue - patch proposal\n\nHi,\nPatch is made based on Tomcat 6.0.32 sources.\nRegards\nVioleta", "id": 144087, "time": "2011-02-09T04:42:50Z", "bug_id": 50734, "creation_time": "2011-02-09T04:42:50Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 50734, "text": "Thanks for the patch. I have proposed it for 6.0.x", "id": 144199, "time": "2011-02-11T11:15:18Z", "creator": "markt@apache.org", "creation_time": "2011-02-11T11:15:18Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 144325, "time": "2011-02-15T12:57:48Z", "bug_id": 50734, "creation_time": "2011-02-15T12:57:48Z", "text": "The patch has been applied to 6.0.x and will be included in 6.0.33 onwards.\n\nThanks again."}, {"count": 5, "tags": [], "bug_id": 50734, "attachment_id": null, "is_private": false, "id": 145997, "time": "2011-04-26T04:18:43Z", "creator": "jfclere@gmail.com", "creation_time": "2011-04-26T04:18:43Z", "text": "*** Bug 51116 has been marked as a duplicate of this bug. ***"}, {"count": 6, "tags": [], "bug_id": 50734, "text": "This patch has a side effect in my configuration that uses some technical valves that will no longer be called if a context does not exist for the requested URL (for example, my valve was able to report how many requests failed due to invalid context mapping indicating some kind of hacking or misconfiguration going on).\n\nAs a workaround, i had to declare a dummy ROOT context (pointing to an empty directory) so that the v\n\nI can understand we want to report a 404 but i consider patch should be plugged where 400 is reported (not so early) to report 404 only if no host is matching.", "id": 149120, "time": "2011-09-09T14:06:05Z", "creator": "christian.boitel@gmail.com", "creation_time": "2011-09-09T14:06:05Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 50734, "attachment_id": null, "is_private": false, "id": 149131, "time": "2011-09-09T18:45:42Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-09-09T18:45:42Z", "text": "(In reply to comment #6)\n> This patch has a side effect in my configuration that uses some technical\n> valves that will no longer be called if a context does not exist for the\n> requested URL (for example, my valve was able to report how many requests\n> failed due to invalid context mapping indicating some kind of hacking or\n> misconfiguration going on).\n\n1. There is a number of other ways how a request can fail. AccessLogValve support was improved in 6.0.30. You may find all places in the code where access logging is triggered.\n\nAnyway, you do not provide much details, and I do not see why this use case may be of any importance.\n\nIf you want to provide more details, open a new issue. This one is fixed.\n\n> \n> As a workaround, i had to declare a dummy ROOT context (pointing to an empty\n> directory) so that the v\n> \n\n2. This is a valid workaround. I do not see any problem with it. In essence, any sane Tomcat installation must have a ROOT webapp.\n\n> I can understand we want to report a 404 but i consider patch should be plugged\n\nI do not quite understand your proposal. I'd be better if you could provide a patch to illustrate it.\n\n> where 400 is reported (not so early) to report 404 only if no host is matching.\n\nRe-closing as FIXED."}]
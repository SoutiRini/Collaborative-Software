[{"count": 0, "tags": [], "text": "When a binary file is hosted by Apache 2.0.36 or 1.3.24 compiled by CYGWIN, \nthe downloaded file is always corrupted. The precompiled version does not have \nthe same problem but it does not respond when a client tries to download a big \nfile after (say) half an hour.", "attachment_id": null, "id": 16274, "creator": "tsfu@hkucs.org", "time": "2002-05-17T00:13:25Z", "bug_id": 9185, "creation_time": "2002-05-17T00:13:25Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 9185, "attachment_id": null, "id": 16282, "time": "2002-05-17T00:50:29Z", "creator": "wrowe@apache.org", "creation_time": "2002-05-17T00:50:29Z", "is_private": false, "text": "Which version of Windows are you running under cygwin?  If XP ... \nplease follow through on the recommendations noted under \"XP Users \nRead Me First\" ...\n\nhttp://www.apache.org/dist/httpd/binaries/win32/"}, {"count": 2, "tags": [], "creator": "jwoolley@apache.org", "attachment_id": null, "text": "If the WinXP thing isn't the problem, how about the following changes?\n\nIndex: http_core.c\n===================================================================\nRCS file: /home/cvs/apache-1.3/src/main/http_core.c,v\nretrieving revision 1.311\ndiff -u -d -r1.311 http_core.c\n--- http_core.c 21 Mar 2002 14:52:55 -0000      1.311\n+++ http_core.c 17 May 2002 01:12:25 -0000\n@@ -3834,7 +3834,7 @@\n         return METHOD_NOT_ALLOWED;\n     }\n \n-#if defined(OS2) || defined(WIN32) || defined(NETWARE)\n+#if defined(OS2) || defined(WIN32) || defined(NETWARE) || defined(CYGWIN)\n     /* Need binary mode for OS/2 */\n     f = ap_pfopen(r->pool, r->filename, \"rb\");\n #else\nIndex: open.c\n===================================================================\nRCS file: /home/cvs/apr/file_io/unix/open.c,v\nretrieving revision 1.94\ndiff -u -d -r1.94 open.c\n--- open.c      20 Mar 2002 08:54:42 -0000      1.94\n+++ open.c      17 May 2002 01:13:13 -0000\n@@ -152,6 +152,11 @@\n     if (flag & APR_TRUNCATE) {\n         oflags |= O_TRUNC;\n     }\n+#ifdef O_BINARY\n+    if (flag & APR_BINARY) {\n+        oflags |= O_BINARY;\n+    }\n+#endif\n     \n     if (perm == APR_OS_DEFAULT) {\n         (*new)->filedes = open(fname, oflags, 0666);", "id": 16287, "time": "2002-05-17T01:15:38Z", "bug_id": 9185, "creation_time": "2002-05-17T01:15:38Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "wrowe@apache.org", "text": "\n  That hack is looking pretty gross.\n\n  Isn't there a means to pretest this situation with autoconf?  Create\n  a 'text' file of XXX\\n and then test if the file remains 4 bytes?\n  Then set APR_FILE_HAS_LF_TRANSLATION ?", "count": 3, "id": 16291, "time": "2002-05-17T02:20:17Z", "bug_id": 9185, "creation_time": "2002-05-17T02:20:17Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 9185, "attachment_id": null, "id": 16296, "time": "2002-05-17T02:49:38Z", "creator": "jwoolley@apache.org", "creation_time": "2002-05-17T02:49:38Z", "is_private": false, "text": "We *could* do that, but how would you implement it?  Well, okay, better \nquestion.  Which part are you saying is ugly?  The 1.3 part?  Okay, I'll agree \nwith that.  But that's not autoconf.  For the 2.0 part, why is that ugly?  All \nwe're saying is that apr_file_open should respect the APR_BINARY flag if the \nplatform cares about it (in which case O_BINARY would be defined in fcntl.h).  \nThe APR change seems totally right to me."}, {"count": 5, "tags": [], "bug_id": 9185, "attachment_id": null, "id": 16318, "time": "2002-05-17T09:05:00Z", "creator": "tsfu@hkucs.org", "creation_time": "2002-05-17T09:05:00Z", "is_private": false, "text": "I've checked 2.0.36 and 1.3.24 compiled by CYGWIN on WinXP, Win2K and Win .Net \nEnterprise Beta 3615. They all have the same problem - corrupted file download. \nAnd there's no such a problem on 2.0.36 (Win32) version on WinXP at all. I'm \nusing the latest CYGWIN available from www.cygwin.com. I think I'm going to let \nCYGWIN know about it too."}, {"count": 6, "tags": [], "text": "\n  N'er mind... those patches look just fine!  [I read the 1.3 patch for 2.0].\n", "attachment_id": null, "id": 16324, "creator": "wrowe@apache.org", "time": "2002-05-17T12:25:34Z", "bug_id": 9185, "creation_time": "2002-05-17T12:25:34Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 9185, "attachment_id": null, "id": 16334, "time": "2002-05-17T18:10:33Z", "creator": "jwoolley@apache.org", "creation_time": "2002-05-17T18:10:33Z", "is_private": false, "text": "I committed the patches I posted earlier in this PR, so this is fixed in CVS for both \n1.3.25 and 2.0.37.  Thanks for the report! "}]
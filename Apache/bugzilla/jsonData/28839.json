[{"attachment_id": null, "tags": [], "creator": "ksitze@yahoo.com", "text": "Incoming requests to tomcat appear to loose all URI information when using the\ncoyote connector.  When making a request, I receive log entries along these lines:\n\n2004-05-07 12:39:04 StandardHost[localhost]: Mapping request URI ''\n2004-05-07 12:39:04 StandardHost[localhost]:  Mapped to context ''\n2004-05-07 12:39:04 StandardContext[]: Mapping contextPath='' with requestURI=''\nand relativeURI=''\n2004-05-07 12:39:04 StandardContext[]:  Mapped to servlet 'default' with servlet\npath '' and path info 'null' and update=true\n\nThe default servlet then promptly redirects me to the root of the web server.\n\nIt appears that catalina is properly configuring my web services.  Simply\nnothing is getting routed through to them.\n\nIf I remove the className attribute from the Connector element (HttpConnector is\n the default), then everything works as expected.\n\nThis bug is especially frustrating as the same configuration worked fine under\ntomcat-4.1.24 (the last version we were deploying our services under).", "count": 0, "id": 57007, "time": "2004-05-08T01:58:15Z", "bug_id": 28839, "creation_time": "2004-05-08T01:58:15Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 28839, "is_private": false, "text": "Created attachment 11460\nCatalina server configuration file.", "id": 57008, "time": "2004-05-08T01:59:08Z", "creator": "ksitze@yahoo.com", "creation_time": "2004-05-08T01:59:08Z", "attachment_id": 11460}, {"count": 2, "tags": [], "creator": "ksitze@yahoo.com", "is_private": false, "id": 57009, "attachment_id": 11461, "bug_id": 28839, "creation_time": "2004-05-08T01:59:37Z", "time": "2004-05-08T01:59:37Z", "text": "Created attachment 11461\nServer default configuration..."}, {"count": 3, "tags": [], "bug_id": 28839, "text": "Created attachment 11462\nLog file from Host logger demonstrating problems", "id": 57010, "time": "2004-05-08T02:04:13Z", "creator": "ksitze@yahoo.com", "creation_time": "2004-05-08T02:04:13Z", "is_private": false, "attachment_id": 11462}, {"count": 4, "tags": [], "bug_id": 28839, "text": "Created attachment 11463\nAccess log generated through AccessLogValve", "id": 57011, "time": "2004-05-08T02:04:57Z", "creator": "ksitze@yahoo.com", "creation_time": "2004-05-08T02:04:57Z", "is_private": false, "attachment_id": 11463}, {"count": 5, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "Actually, the default className is exactly what you're using.\nWhen filing a bug, you should be careful of avoiding items which make it look bogus.\n\nAnd the request causing the issue would be what then ?", "id": 57014, "time": "2004-05-08T08:48:32Z", "bug_id": 28839, "creation_time": "2004-05-08T08:48:32Z", "attachment_id": null}, {"count": 6, "text": "The problem (as I see it) is that the request I'm making (see the attached\naccess log: id=11463) should NOT be routed to the default servlet (as it is).  I\nexpect (and tomcat does for the deprecated HTTP connector) that the request be\nrouted to the library servlet (initialization of which you can see in the Host\nlog: id=11462).  For unknown reasons, coyote seems to publish the URI as empty\n(info gleamed from the host file) while I expect '/library/services/library'\n(what I actually hit, and whose information is visible in the access log).  I\nextrapolate this last part per the details listed in the aforementioned Host log\nfile.\n\nI'm initially hoped that this was simply a configuration issue, but the same\nserver.xml (attachment id=11460) file works when the HttpConnector is specified\nin place of the CoyoteConnector and does NOT work when the CoyoteConnector is\nused.  Hence, if it is a configuration issue, then this bug becomes one of\nneeding better documentation as to what the configuration file(s) need to\ncontain in order for the CoyoteConnector to operate properly.\n\nSo the problem, initially, was that, after upgrading to tomcat-4.1.30, when I\nhit a web page generated by the library servlet, I was redirected to the \"/\"\nURI.  This took place no matter what URI I was hitting.  Backtracking to\ntomcat-4.1.24 via setting CATALINA_HOME to the older base, leaving CATALINA_BASE\nas it was, resulted in a perfectly operating system.\n\nLeaving tomcat-4.1.30 configured but using the deprecated HttpConnector resulted\nin a well behaved web application (as I have already mentioned).\n\nSo, changing one line in server.xml resulted in the system either working or not\nworking depending on whether that line indicated the http or coyote connector.\n\nWorkaround: use the older HttpConnector.\n\nSo, my question is, why?  Why does using the coyote connector cause the system\nto not route requests to the appropriate web application/servlet?  Why do all\nrequests route to the default servlet?  The only answer I was able to come up\nwith (via investigating the log files) is the clue that the standard host class\nis routing requests based on an empty URI, when I knew that those URIs were not\nempty strings.  As URI interpretation is done by the coyote connector, my best\nguess is that the coyote connector is broken WRT the URIs it publishes to the\nengine.", "bug_id": 28839, "is_private": false, "id": 57137, "time": "2004-05-11T00:35:52Z", "creator": "ksitze@yahoo.com", "creation_time": "2004-05-11T00:35:52Z", "tags": [], "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 28839, "text": "Can you also attach the web.xml from your library web application.\n\nThanks.", "id": 57298, "time": "2004-05-12T19:34:32Z", "creator": "markt@apache.org", "creation_time": "2004-05-12T19:34:32Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 28839, "attachment_id": 11600, "is_private": false, "id": 57680, "time": "2004-05-20T00:43:59Z", "creator": "ksitze@yahoo.com", "creation_time": "2004-05-20T00:43:59Z", "text": "Created attachment 11600\nThe web.xml file used by tomcat"}, {"count": 9, "tags": [], "bug_id": 28839, "attachment_id": null, "is_private": false, "id": 57681, "time": "2004-05-20T00:57:55Z", "creator": "jim@netyourwork.com", "creation_time": "2004-05-20T00:57:55Z", "text": "I had a similar problem after upgrading to 4.1.30 from 4.1.29 that I raised on\nthe tomcat-user list in late March.  The solution was to add\n'useURIValidationHack=\"false\"' to the each of the Connector statements. \nApparently setting this attribute was optional under 4.1.29, but required under\n4.1.30. "}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "text": "This bug report has been transferred to Tomcat 5 because TC4 and TC5 share the \nconnectors and TC5 is now the focus of development effort", "count": 10, "id": 59574, "time": "2004-06-19T12:24:11Z", "bug_id": 28839, "creation_time": "2004-06-19T12:24:11Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "text": "Closing this based on the comment from Jim Hopp and the fact that servlets are \nthat I don't see this issue. If this doesn't work for you, please re-open. If \nyou do re-open, please attach the web.xml from your web application (not the \none in the conf directory) as this is where I would expect to find the URL-\nservlet mappings.", "count": 11, "id": 59595, "time": "2004-06-19T15:57:31Z", "bug_id": 28839, "creation_time": "2004-06-19T15:57:31Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 28839, "attachment_id": null, "is_private": false, "id": 59896, "time": "2004-06-25T19:26:47Z", "creator": "ksitze@yahoo.com", "creation_time": "2004-06-25T19:26:47Z", "text": "Thanks, disabling useURIValidationHack works, I wish I knew why...\n\nWhat does this option do?  I don't see it documented anywhere, does this mean\nthat a documentation bugzilla should be opened?"}, {"attachment_id": null, "tags": [], "bug_id": 28839, "text": "So it appears that this option has security ramifications.  I'm posting my\nweb.xml file (from an arbitrary service, they all fail so one is as good as\nanother) and reopening this bugz.  I want to avoid tramping on security fixes if\npossible.", "count": 13, "id": 59899, "time": "2004-06-25T19:33:52Z", "creator": "ksitze@yahoo.com", "creation_time": "2004-06-25T19:33:52Z", "is_private": false}, {"count": 14, "tags": [], "creator": "ksitze@yahoo.com", "is_private": false, "id": 59900, "attachment_id": 11952, "bug_id": 28839, "creation_time": "2004-06-25T19:35:59Z", "time": "2004-06-25T19:35:59Z", "text": "Created attachment 11952\nServlet web.xml file"}]
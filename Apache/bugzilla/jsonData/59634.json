[{"count": 0, "tags": [], "bug_id": 59634, "text": "Created attachment 33890\nTestCase demonstrating the issue\n\nAccording to Workbook#close() it should not have any effect on newly created workbooks.\n\nThis is true for HSSFWorkbooks.\n\nFor XSSFWorkbooks it's not possible to write the document to an OutputStream after calling #close().\n\nSince I'm mostly creating Workbooks from scratch, I thought I can call #close() just after creation of Worbook, instead of somewhere later when the document was written to outside world.\n\nPlease see the attached test case that should demonstrate the issue.\n\n\n(Side note: The documentation states #close() will close the underlying input resource the Workbook was created from (e.g. calls to constructor HSSFWorkbook(InputStream)?). Shouldn't be the creator of that InputStream responsible for closing that Stream?)\n\nRegards,\nMichael", "id": 191258, "time": "2016-05-25T14:46:53Z", "creator": "michael.holtermann@dfb-medien.de", "creation_time": "2016-05-25T14:46:53Z", "is_private": false, "attachment_id": 33890}, {"attachment_id": null, "tags": [], "creator": "michael.holtermann@dfb-medien.de", "text": "In addition it's not possible to read from the workbook after it has been closed. A NPE will be thrown.", "count": 1, "id": 191265, "time": "2016-05-26T06:40:57Z", "bug_id": 59634, "creation_time": "2016-05-26T06:40:57Z", "is_private": false}, {"count": 2, "tags": [], "creator": "dominik.stadler@gmx.at", "text": "For dicussion, the current javadoc for Workbook.close() is\n\n     * Close the underlying input resource (File or Stream),\n     *  from which the Workbook was read. After closing, the\n     *  Workbook should no longer be used.\n     * <p>This will have no effect newly created Workbooks.\n\nHSSFWorkbook.close()\n\n     * Closes the underlying {@link NPOIFSFileSystem} from which\n     *  the Workbook was read, if any. Has no effect on Workbooks\n     *  opened from an InputStream, or newly created ones.\n\nXSSFWorkbook.close()\n\n     * Closes the underlying {@link OPCPackage} from which this\n     *  document was read, if there is one\n\nWe should probably rephrase those to state more in the order of \"do not use at all after closing\" and \"it will close resources that have been passed in the constructor\". This makes it as simple as possible and does not lead to very hard to find bugs if passed in resources are closed at some point.\n\nThis way would also be consistent with what many other Java-Closeable-instances will do when they receive some resource themselves, e.g. see FileInputStreamReader, FileOutputStreamWriter, ...", "id": 191303, "time": "2016-05-29T10:25:57Z", "bug_id": 59634, "creation_time": "2016-05-29T10:25:57Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "michael.holtermann@dfb-medien.de", "attachment_id": null, "id": 191463, "time": "2016-06-08T08:08:51Z", "bug_id": 59634, "creation_time": "2016-06-08T08:08:51Z", "is_private": false, "text": "Sounds legit. I'd support that solution."}, {"count": 4, "text": "*** Bug 59678 has been marked as a duplicate of this bug. ***", "bug_id": 59634, "is_private": false, "id": 191480, "time": "2016-06-09T09:40:07Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-06-09T09:40:07Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 59634, "is_private": false, "count": 5, "id": 192610, "time": "2016-07-24T18:57:46Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-07-24T18:57:46Z", "text": "The JavaDoc was partly updated in r1749213 and further refined in r1753912 to state that the close() call may also invalidate other things and should only be called before work with the object is done.\n\nI have also removed the \"has no effect on newly created... \", as I don't think we should limit ourselves this way here, we should be able to do optimizations in the future which make use of this. All other Java Closables do it this way and thus let's do the same here."}, {"count": 6, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 192639, "time": "2016-07-26T05:54:21Z", "bug_id": 59634, "creation_time": "2016-07-26T05:54:21Z", "is_private": false, "text": "*** Bug 59356 has been marked as a duplicate of this bug. ***"}, {"attachment_id": null, "tags": [], "bug_id": 59634, "is_private": false, "count": 7, "id": 192662, "time": "2016-07-26T19:38:10Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-07-26T19:38:10Z", "text": "*** Bug 53613 has been marked as a duplicate of this bug. ***"}, {"count": 8, "tags": [], "bug_id": 59634, "is_private": false, "text": "*** Bug 60754 has been marked as a duplicate of this bug. ***", "id": 197186, "time": "2017-02-21T13:56:08Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2017-02-21T13:56:08Z", "attachment_id": null}]
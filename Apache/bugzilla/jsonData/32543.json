[{"count": 0, "tags": [], "creator": "gregor@apache.org", "is_private": false, "text": "On 6.12.2004 10:06 Uhr, Michael Wechner wrote:\n\n> Gregor J. Rothfuss wrote:\n>\n>> michi, do you recall if we still need\n>>\n>> <?xml version=\"1.0\" encoding=\"UTF-8\"?><html\nxmlns:lenya=\"http://apache.org/cocoon/lenya/page-envelope/1.0\"\nxmlns:dcterms=\"http://purl.org/dc/terms/\"\nxmlns:unizh=\"http://unizh.ch/doctypes/elements/1.0\"\nxmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns=\"http://www.w3.org/1999/xhtml\"\ndc:dummy=\"FIXME:keepNamespace\" dcterms:dummy=\"FIXME:keepNamespace\"\nlenya:dummy=\"FIXME:keepNamespace\" unizh:columns=\"2\">\n>>\n>> the dummy namespace declarations?\n>\n> yes, the \"multiple\" forms editor gets a problem otherwise (see FIXME)\n>\n> src/java/org/apache/lenya/cms/cocoon/acting/HTMLFormSaveAction.java\n>\n> because IIRC org.apache.xpath.compiler.XPathParser will have a problem.\n>\n> Some time ago I had an idea how to fix this, but didn't get around to try it out.\n\n\nIn libxml2 (the XML/XSLT/XPath library I use), the XPath engine is only aware of\nprefix-to-namespaceURI mappings defined in the root node (or the context note,\nfor that matter). In JS it's basically the same, and it looks like in your\nengine, also. According to the spec, this doesn't have to happen, but usually\nengines do that for easier use.\n\nTherefore, looks like you need your own PrefixResolver for making XPath\ncorrectly work ( found this\nhttp://www.stylusstudio.com/api/xalan-j_2_6_0/org/apache/xml/utils/PrefixResolver.htm\n). We had to do this in BXE as well. And in PHP there's a method\n$xpathquery->registerNamespace($prefix,$uri) for the same problem.\n\nThe same goes for default namespaces (another fixme in that file). There are no\ndefault namespaces in XPath ;) You have to use some prefixes for them (and of\ncourse register, resp. do an PrefixResolver)\n\nHTH\n\nchregu\n\n>> iirc they are in there because one of the form editors would strip them out\notherwise.", "id": 67984, "time": "2004-12-06T16:33:25Z", "bug_id": 32543, "creation_time": "2004-12-06T16:33:25Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 32543, "text": "A bit more information.  If a document has the following namespaces and dummy\nattributes defined:\n\n  <html\n    xmlns=\"http://www.w3.org/1999/xhtml\"\n    xmlns:xhtml=\"http://www.w3.org/1999/xhtml\"\n    xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n    xmlns:lenya=\"http://apache.org/cocoon/lenya/page-envelope/1.0\"\n    xhtml:dummy=\"FIXME:keepNamespace\"\n    dc:dummy=\"FIXME:keepNamespace\"\n    lenya:dummy=\"FIXME:keepNamespace\"\n    >\n\nThe forms editor writes this out in the work area:\n\n  <html\n    xmlns=\"http://www.w3.org/1999/xhtml\"\n    xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n    xmlns:lenya=\"http://apache.org/cocoon/lenya/page-envelope/1.0\"\n    dc:dummy=\"FIXME:keepNamespace\"\n    lenya:dummy=\"FIXME:keepNamespace\"\n    tagID=\"tag.1\"\n    :dummy=\"FIXME:keepNamespace\"\n    >\n\nThe problem seems to be with the default namespace being stripped by\nthe forms editor.\n\nMichi points out that XSLT is being used during saving:\n\n  src/java/org/apache/lenya/cms/cocoon/acting/HTMLFormSaveAction.java\n\nSo switching the XSLT processor library might cause a problem.", "id": 68626, "time": "2004-12-16T18:07:30Z", "creator": "jplejacq@quoininc.com", "creation_time": "2004-12-16T18:07:30Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "gregor@apache.org", "is_private": false, "text": "i believe this has been addressed with the port of the multiple forms editor to\nuc fw", "id": 73747, "time": "2005-04-18T00:03:09Z", "bug_id": 32543, "creation_time": "2005-04-18T00:03:09Z", "attachment_id": null}]
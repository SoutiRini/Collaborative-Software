[{"count": 0, "tags": [], "bug_id": 34541, "text": "This may be a problem in Tomcat 5.X too. We are seeing hangs during shutdown of \nTomcat. The localhost_log shows a last line of \"2005-04-20 06:03:06 \nStandardWrapper[/TomcatHang:hangServlet]: Waiting for 2 instance(s) to be \ndeallocated\". A thread dump shows the main thread waiting at \"at \norg.apache.catalina.core.StandardWrapper.unload(StandardWrapper.java:1074)\". \nThere are no HTTP processor threads running - they have all shutdown. \nInspecting the code shows unload waiting for the variable countAllocated to go \nto zero. However, the code that increments and decrements countAllocated for \nnon-single-threaded servlets is not synchronized, so the value will not be \ncorrect in some cases. To test this I added synchronized blocks to the \nincrement/decrement code and no longer get hangs.", "id": 73859, "time": "2005-04-20T15:29:09Z", "creator": "jcortopassi@amberpoint.com", "creation_time": "2005-04-20T15:29:09Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 34541, "text": "Created attachment 14769\nThread dump of hung Tomcat", "id": 73860, "time": "2005-04-20T15:30:39Z", "creator": "jcortopassi@amberpoint.com", "creation_time": "2005-04-20T15:30:39Z", "is_private": false, "attachment_id": 14769}, {"count": 2, "tags": [], "bug_id": 34541, "text": "Created attachment 14770\nlocalhost_log", "id": 73861, "time": "2005-04-20T15:31:49Z", "creator": "jcortopassi@amberpoint.com", "creation_time": "2005-04-20T15:31:49Z", "is_private": false, "attachment_id": 14770}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 74192, "time": "2005-04-27T23:23:19Z", "bug_id": 34541, "creation_time": "2005-04-27T23:23:19Z", "text": "This was fixed almost 3 years ago in 4.1.5 or later."}]
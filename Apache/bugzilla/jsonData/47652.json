[{"count": 0, "attachment_id": null, "creator": "max.valjanski@gmail.com", "text": "Patch add support for RC4-encrypted workbooks (no CryptoAPI support and XOR-obfuscation). Also this add support for reading write-protected workbooks (that is encrypted with Excel built-in password)", "id": 129515, "time": "2009-08-06T02:56:38Z", "bug_id": 47652, "creation_time": "2009-08-06T02:56:38Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "max.valjanski@gmail.com", "text": "Created attachment 24105\npatch", "id": 129516, "attachment_id": 24105, "bug_id": 47652, "creation_time": "2009-08-06T02:57:53Z", "time": "2009-08-06T02:57:53Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 47652, "attachment_id": 24106, "id": 129517, "time": "2009-08-06T02:58:22Z", "creator": "max.valjanski@gmail.com", "creation_time": "2009-08-06T02:58:22Z", "is_private": false, "text": "Created attachment 24106\nsrc/java/org/apache/poi/hssf/record/RC4Header.java"}, {"count": 3, "attachment_id": 24107, "creator": "max.valjanski@gmail.com", "text": "Created attachment 24107\nsrc/java/org/apache/poi/util/RC4InputStream.java", "id": 129518, "time": "2009-08-06T02:58:41Z", "bug_id": 47652, "creation_time": "2009-08-06T02:58:41Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 47652, "attachment_id": 24108, "text": "Created attachment 24108\nsrc/testcases/org/apache/poi/hssf/data/password.xls", "id": 129519, "time": "2009-08-06T02:59:37Z", "creator": "max.valjanski@gmail.com", "creation_time": "2009-08-06T02:59:37Z", "is_private": false}, {"count": 5, "attachment_id": null, "creator": "apache@gagravarr.org", "text": "Thanks for this patch. I've only had a quick glance, and it mostly seems ok, though I'm slightly concerned about the password being a global static, as that means that two different threads working on two different files will hit issues :( Hopefully someone else can suggest something for this though\n\nAs this uses the java crypto libraries, which'd be our first use of them, I'll file the appropriate notice as per http://www.apache.org/dev/crypto.html so we're cleared to commit this once any tweaks are done.", "id": 129522, "time": "2009-08-06T03:45:32Z", "bug_id": 47652, "creation_time": "2009-08-06T03:45:32Z", "tags": [], "is_private": false}, {"count": 6, "attachment_id": null, "creator": "josh@apache.org", "text": "Fixed in svn r801890\n\nI had independently worked a solution a few months back but hadn't got round to submitting it.  The changes I have submitted are mostly based on my own work, but I  also added some things from your patch that I had missed out:\n  - a high level test case\n  - better handling of first three ushort fields FILEPASS (BTW - where did you get that info?)\n\nSome stuff that I had already done:\n  - low level unit tests for password/key verification, and key block changes (the tested code is very hard to understand/maintain solely in the context of high level use cases). \n  - handle the user password with a ThreadLocal instead of a plain static field.  This should enable separate threads to decrypt independently.\n  - management of which BIFF records get encrypted is managed down in Biff8RC4 (instead of RecordInputStream).  This will allow encrypting code (not done yet) to use the same logic easily.\n\nPlease take a look a the combined changes which are already in svn trunk, and let me know if it still meets your needs.", "id": 129556, "time": "2009-08-06T23:30:22Z", "bug_id": 47652, "creation_time": "2009-08-06T23:30:22Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "max.valjanski@gmail.com", "text": "Yes, your implementation works for me\n\nI used \"Office Document Cryptography Structure Specification, v20090708\" and \"Excel Binary File Format (.xls) Structure Specification, v20090708\", http://msdn.microsoft.com/en-us/library/cc313071.aspx ([MS-OFFCRYPTO].pdf and [MS-XLS].pdf from complete zip file)", "id": 129560, "attachment_id": null, "bug_id": 47652, "creation_time": "2009-08-07T01:09:21Z", "time": "2009-08-07T01:09:21Z", "is_private": false}, {"count": 8, "tags": [], "creator": "max.valjanski@gmail.com", "text": "Created attachment 24136\nException handling\n\nThis patch simplifies diagnostics when valid password was not supplied", "id": 129675, "attachment_id": 24136, "bug_id": 47652, "creation_time": "2009-08-13T03:56:16Z", "time": "2009-08-13T03:56:16Z", "is_private": false}, {"count": 9, "tags": [], "creator": "josh@apache.org", "attachment_id": null, "text": "(In reply to comment #8)\n> Created an attachment (id=24136) [details]\n> Exception handling\n> \n> This patch simplifies diagnostics when valid password was not supplied\n\nApplied in svn r804381\n\nI also improved the error message a little bit to help distinguish between use of the default password versus supplying user password.\n\njunits added", "id": 129697, "time": "2009-08-14T14:38:57Z", "bug_id": 47652, "creation_time": "2009-08-14T14:38:57Z", "is_private": false}]
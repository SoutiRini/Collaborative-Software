[{"count": 0, "attachment_id": null, "bug_id": 34716, "is_private": false, "id": 74342, "time": "2005-05-02T23:52:32Z", "creator": "edwin.meester@qme.nl", "creation_time": "2005-05-02T23:52:32Z", "tags": [], "text": "After Upgrading from 1.3.31 to 2.0.54 I can't get ProxyPass to work.\nIt's seems the proxy sends a Request to internal server with some bad headers.\n\nA ProxyPass to the same server, results in a 400 error.\n\nBad Request\n\nYour browser sent a request that this server could not understand.\nRequest header field is missing ':' separator.\n\nGET / HTTP/1.1\n\nApache/2.0.54 (Win32) PHP/5.0.4 Server"}, {"count": 1, "tags": [], "creator": "nick@webthing.com", "is_private": false, "id": 74962, "creation_time": "2005-05-17T15:58:53Z", "time": "2005-05-17T15:58:53Z", "bug_id": 34716, "text": "GET / HTTP/1.1  (on its own) *is* a bad request.\n\nThere's insufficient information in this report to find a potential bug.\nPlease ask in a user support forum (with details of the problem),\nor provide details of apache doing something wrong.", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 34716, "text": "(In reply to comment #1)\n> GET / HTTP/1.1  (on its own) *is* a bad request.\n> \n> There's insufficient information in this report to find a potential bug.\n> Please ask in a user support forum (with details of the problem),\n> or provide details of apache doing something wrong.\n\nthe complete header sent by the ProxyPass directive:\n\nGET / HTTP/1.1\nHost: www.mydomain.com:80\nAccept: */*\nAccept-Language: en-us\nUA-CPU: x86\nAccept-Encoding: gzip, deflate\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; SV1; .NET CLR\n1.1.4322)\nMax-Forwards: 10\nX-Forwarded-For: 80.69.81.37\nX-Forwarded-Host: www.proxydomain.com\nX-Forwarded-Server: www.proxydomain.com\n\nBut for some reason the Apache server doesn't like this Header.\n", "id": 74973, "time": "2005-05-17T21:45:37Z", "creator": "edwin.meester@qme.nl", "creation_time": "2005-05-17T21:45:37Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "nick@webthing.com", "is_private": false, "id": 74989, "creation_time": "2005-05-18T10:34:55Z", "time": "2005-05-18T10:34:55Z", "bug_id": 34716, "text": "> Your browser sent a request that this server could not understand.\n> Request header field is missing ':' separator.\n> \n> GET / HTTP/1.1\n\nWhat that's actually saying is that it thinks the above is being sent as a\nrequest header - where it is invalid (just as the message says).  Is that\nhappening on the proxy or the backend?  What is generating the original request\nto the proxy?", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 34716, "text": "It happens on the server behind the apache proxy.\n\nexample:\n\nInternet Explorer -> Apache 2.0.54 As Proxy -> another server.\n\nTried 2 servers as backend: (Wanadoo.nl and the same apache server on another\nvirtual host.", "count": 4, "id": 75030, "time": "2005-05-18T18:55:14Z", "creator": "edwin.meester@qme.nl", "creation_time": "2005-05-18T18:55:14Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 34716, "text": "After some more investication it seems Apache puts the header twice:\n\nGET / HTTP/1.1\\r\\n\nHost: www.mydomain.com:80\\r\\n\nAccept: */*\\r\\n\nAccept-Language: en-us\\r\\n\nUA-CPU: x86\\r\\n\nAccept-Encoding: gzip, deflate\\r\\n\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; SV1; .NET CLR\n1.1.4322)\\r\\n\nMax-Forwards: 10\\r\\n\nX-Forwarded-For: 80.69.81.37\\r\\n\nX-Forwarded-Host: www.proxydomain.com\\r\\n\nX-Forwarded-Server: www.proxydomain.com\\r\\n\nGET / HTTP/1.1\\r\\n\nHost: www.mydomain.com:80\\r\\n\nAccept: */*\\r\\n\nAccept-Language: en-us\\r\\n\nUA-CPU: x86\\r\\n\nAccept-Encoding: gzip, deflate\\r\\n\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; SV1; .NET CLR\n1.1.4322)\\r\\n\nMax-Forwards: 10\\r\\n\nX-Forwarded-For: 80.69.81.37\\r\\n\nX-Forwarded-Host: www.proxydomain.com\\r\\n\nX-Forwarded-Server: www.proxydomain.com\\r\\n\\r\\n\n\nWhich ofcourse results in:\n\nA ProxyPass to the same server, results in a 400 error.\n\nBad Request\n\nYour browser sent a request that this server could not understand.\nRequest header field is missing ':' separator.\n\nGET / HTTP/1.1\n\nApache/2.0.54 (Win32) PHP/5.0.4 Server", "count": 5, "id": 83334, "time": "2005-12-06T22:56:04Z", "creator": "edwin.meester@qme.nl", "creation_time": "2005-12-06T22:56:04Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 34716, "is_private": false, "id": 83339, "time": "2005-12-06T23:55:59Z", "creator": "rpluem@apache.org", "creation_time": "2005-12-06T23:55:59Z", "tags": [], "text": "Several changes have been made to the proxy code from 2.0.54 to 2.0.55. Please\ncheck if the error still exists with 2.0.55."}, {"count": 7, "tags": [], "text": "The same bug is in Apache 2.0.55 and Apache 2.2.0 ", "is_private": false, "id": 83341, "creator": "edwin.meester@qme.nl", "time": "2005-12-07T00:01:20Z", "bug_id": 34716, "creation_time": "2005-12-07T00:01:20Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "rpluem@apache.org", "text": "*** Bug 37092 has been marked as a duplicate of this bug. ***", "id": 83343, "time": "2005-12-07T00:04:44Z", "bug_id": 34716, "creation_time": "2005-12-07T00:04:44Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 83344, "time": "2005-12-07T00:07:36Z", "bug_id": 34716, "creation_time": "2005-12-07T00:07:36Z", "is_private": false, "text": "Have you tried removing php from the httpd server running the proxy?\nI am not quite sure if I remember myself correctly, but I think there had been\nsome nasty sideeffects between mod_proxy and php."}, {"count": 10, "tags": [], "text": "> Have you tried removing php from the httpd server running the proxy?\n> I am not quite sure if I remember myself correctly, but I think there had been\n> some nasty sideeffects between mod_proxy and php.\n\nJust tried disabling PHP under Apache 2.2.0, without luck.\nStill the header is send to the backend server Twice.\n\n", "is_private": false, "id": 83345, "creator": "edwin.meester@qme.nl", "time": "2005-12-07T00:14:23Z", "bug_id": 34716, "creation_time": "2005-12-07T00:14:23Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "(In reply to comment #9)\n> Have you tried removing php from the httpd server running the proxy?\n> I am not quite sure if I remember myself correctly, but I think there had been\n> some nasty sideeffects between mod_proxy and php.\n\nI am also not using PHP and the problem still appears. As I noted under bug\n37092 the problem didn't appear on Windows Server 2003 (just on Windows XP). I\nhad a working installation on Windows Server 2003 which I copied exactly to WXP\nand it stopped working (it started to sending the header twice).", "is_private": false, "id": 83346, "creator": "dan@dotnetfirebird.org", "time": "2005-12-07T00:24:12Z", "bug_id": 34716, "creation_time": "2005-12-07T00:24:12Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 34716, "attachment_id": null, "id": 83348, "time": "2005-12-07T00:32:32Z", "creator": "rpluem@apache.org", "creation_time": "2005-12-07T00:32:32Z", "is_private": false, "text": "Strange. Just checked on my Linux box and it works perfectly. Next ideas I have is\n\n1. A configuration issue.\n2. A platform issue.\n\nTo address 1. please attach your configuration to this report.\nFor 2.: Can any developer reproduce this on windows? I cannot help as I am Unix guy."}, {"count": 13, "attachment_id": null, "bug_id": 34716, "is_private": false, "id": 83349, "time": "2005-12-07T00:36:08Z", "creator": "rpluem@apache.org", "creation_time": "2005-12-07T00:36:08Z", "tags": [], "text": "(In reply to comment #11)\n\n[..cut..]\n\n> I am also not using PHP and the problem still appears. As I noted under bug\n> 37092 the problem didn't appear on Windows Server 2003 (just on Windows XP). I\n> had a working installation on Windows Server 2003 which I copied exactly to WXP\n> and it stopped working (it started to sending the header twice).\n\nAhh, many thanks for that hint. I just lost sight of it. So it seems to be a\nplatform issue with windows XP. Time to call the windows guys in and for me to\nbail out.\n\n"}, {"attachment_id": 17162, "tags": [], "bug_id": 34716, "is_private": false, "count": 14, "id": 83350, "time": "2005-12-07T00:46:32Z", "creator": "edwin.meester@qme.nl", "creation_time": "2005-12-07T00:46:32Z", "text": "Created attachment 17162\nhttpd-conf of non working proxypass setup\n\nThis a copy of my httpd-conf \nApache 2.0.55 on Windows 2003 Server"}, {"count": 15, "attachment_id": null, "bug_id": 34716, "is_private": false, "id": 83351, "time": "2005-12-07T00:48:52Z", "creator": "edwin.meester@qme.nl", "creation_time": "2005-12-07T00:48:52Z", "tags": [], "text": ">> I am also not using PHP and the problem still appears. As I noted under bug\n>> 37092 the problem didn't appear on Windows Server 2003 (just on Windows XP). \nI\n>> had a working installation on Windows Server 2003 which I copied exactly to \nWXP\n>> and it stopped working (it started to sending the header twice).\n\n>Ahh, many thanks for that hint. I just lost sight of it. So it seems to be a\n>platform issue with windows XP. Time to call the windows guys in and for me to\n>bail out.\n\nI've the problem on Windows 2003 Server. So it could still be an config problem.\nThe working windows 2003 version of Apache was which version ?? \n"}, {"count": 16, "tags": [], "bug_id": 34716, "attachment_id": null, "text": "1)  Are you runnning on WinXP SP1, or vanilla/original XP?\n\n2)  Are you testing/encountering this issue on the loopback (localhost, 127.0.0.1)\n    device, on external connections, or both?  [Loopback by MS is a regularly\n    buggy beast.]\n\n", "id": 83352, "time": "2005-12-07T01:00:24Z", "creator": "wrowe@apache.org", "creation_time": "2005-12-07T01:00:24Z", "is_private": false}, {"count": 17, "tags": [], "creator": "edwin.meester@qme.nl", "is_private": false, "text": "1) Windows 2003 Server WEB SP1\n\n2) Internal and External", "id": 83353, "time": "2005-12-07T01:05:07Z", "bug_id": 34716, "creation_time": "2005-12-07T01:05:07Z", "attachment_id": null}, {"count": 18, "attachment_id": null, "bug_id": 34716, "is_private": false, "id": 83354, "time": "2005-12-07T01:26:08Z", "creator": "nick@webthing.com", "creation_time": "2005-12-07T01:26:08Z", "tags": [], "text": "Sounds like it might be interacting with something on your network.  Since \nwindows is awash with security and associated products that tamper with the \nnetworking, perhaps those of you who suffer this behaviour can list what \nyou've got installed, and maybe some common factor will appear. "}, {"count": 19, "tags": [], "creator": "edwin.meester@qme.nl", "attachment_id": null, "text": "I found an old Apache 2.0.52 package.\nWhich seems to work.\nSo maybe samewhere betweeon 2.0.52 and 2.0.54 there is something changed which\ncauses this behaviour.", "id": 83374, "time": "2005-12-07T19:10:14Z", "bug_id": 34716, "creation_time": "2005-12-07T19:10:14Z", "is_private": false}, {"count": 20, "tags": [], "text": "(In reply to comment #16)\n> 1)  Are you runnning on WinXP SP1, or vanilla/original XP?\n> \n> 2)  Are you testing/encountering this issue on the loopback (localhost, 127.0.0.1)\n>     device, on external connections, or both?  [Loopback by MS is a regularly\n>     buggy beast.]\n> \n> \n\nMy configuration is \n1) working on:\nWindows Server 2003\nno SP1\nfirewall turned off\nrunning on VMWare\n\n2) not working on:\nWindows XP\nSP2\nfirewall turned on\nrunning on a PC\n", "is_private": false, "id": 83375, "creator": "dan@dotnetfirebird.org", "time": "2005-12-07T19:28:32Z", "bug_id": 34716, "creation_time": "2005-12-07T19:28:32Z", "attachment_id": null}, {"count": 21, "attachment_id": null, "bug_id": 34716, "text": "(In reply to comment #19)\n> I found an old Apache 2.0.52 package.\n> Which seems to work.\n> So maybe samewhere betweeon 2.0.52 and 2.0.54 there is something changed which\n> causes this behaviour.\n\n2.0.53 Also seems to work\n\n", "id": 83376, "time": "2005-12-07T19:48:05Z", "creator": "edwin.meester@qme.nl", "creation_time": "2005-12-07T19:48:05Z", "tags": [], "is_private": false}, {"count": 22, "attachment_id": null, "bug_id": 34716, "is_private": false, "id": 83380, "time": "2005-12-07T20:17:07Z", "creator": "edwin.meester@qme.nl", "creation_time": "2005-12-07T20:17:07Z", "tags": [], "text": "(In reply to comment #20)\n> \n> My configuration is \n> 1) working on:\n> Windows Server 2003\n> no SP1\n> firewall turned off\n> running on VMWare\n> \n> 2) not working on:\n> Windows XP\n> SP2\n> firewall turned on\n> running on a PC\n> \nSo concluding:\n\nThe problem appears on\n\n1. Apache versions higher than 2.0.53\n2. Windows 2003 SP1 / Windows XP SP2  (same security/network fixes)\n\n"}, {"count": 23, "tags": [], "text": "You are all clear in the understanding that the various 'firewall' software\nproducts, anti-virus 'internet protection', and other add ins all insert \nthemselves into the network socket stack?\n\nSome of the vendors of this software haven't implemented (correctly) the\nentire WinSock2 advanced API.  You can test this by completely disabling\nthe product and rebooting the machine, and if that fails, uninstalling the\nproduct, rebooting and retesting.\n\nAlso there are several options which cripple Apache to use older API's that\nare less likely to demonstrate these bugs in 3rd party socket stack drivers,\nyou can try adding these directives globally to your server, one at a time,\nand report back which directive did resolve this double-headers bug;\n\n  Win32DisableAcceptEx\n  EnableSendfile off\n  EnableMMap off\n\nI'm not excluding the possibility of a bug, but trying to narrow down under\nwhat conditions the bug might exhibit itself, and at least getting your\nservers up and operating.\n\nThose others who see this flaw, what extra software (MS Firewall, AV products,\netc) are you running on the sockets?\n\n\n", "attachment_id": null, "id": 83389, "creator": "wrowe@apache.org", "time": "2005-12-07T22:21:34Z", "bug_id": 34716, "creation_time": "2005-12-07T22:21:34Z", "is_private": false}, {"count": 24, "tags": [], "creator": "edwin.meester@qme.nl", "text": "(In reply to comment #23)\n> You are all clear in the understanding that the various 'firewall' software\n> products, anti-virus 'internet protection', and other add ins all insert \n> themselves into the network socket stack?\n> \n> Some of the vendors of this software haven't implemented (correctly) the\n> entire WinSock2 advanced API.  You can test this by completely disabling\n> the product and rebooting the machine, and if that fails, uninstalling the\n> product, rebooting and retesting.\n> \n> Also there are several options which cripple Apache to use older API's that\n> are less likely to demonstrate these bugs in 3rd party socket stack drivers,\n> you can try adding these directives globally to your server, one at a time,\n> and report back which directive did resolve this double-headers bug;\n> \n>   Win32DisableAcceptEx\n>   EnableSendfile off\n>   EnableMMap off\n> \n> I'm not excluding the possibility of a bug, but trying to narrow down under\n> what conditions the bug might exhibit itself, and at least getting your\n> servers up and operating.\n> \n> Those others who see this flaw, what extra software (MS Firewall, AV products,\n> etc) are you running on the sockets?\n> \n> \nOk thanks for the hints.\nFound the problem, my virusscanner (NOD32 2.50.25 mod: IMON) was messing up the\nheaders. Apache (mod_proxy) is working perfect now.\n\nThanks Again.\n\n\n\n", "id": 83392, "time": "2005-12-07T23:08:09Z", "bug_id": 34716, "creation_time": "2005-12-07T23:08:09Z", "is_private": false, "attachment_id": null}, {"count": 25, "attachment_id": null, "bug_id": 34716, "is_private": false, "id": 83394, "time": "2005-12-07T23:20:48Z", "creator": "dan@dotnetfirebird.org", "creation_time": "2005-12-07T23:20:48Z", "tags": [], "text": "(In reply to comment #23)\n> You are all clear in the understanding that the various 'firewall' software\n> products, anti-virus 'internet protection', and other add ins all insert \n> themselves into the network socket stack?\n\nHmm. I am also using Nod32/IMON. I guess you can close the bug now. Although I\nhaven't tried turning it off yet I'm sure Nod32 is causing this problem. I\nalready had problems with Nod32 causing very hard-to-find network errors on\nsoftware communicating via .NET Remoting.\n\nThanks!"}, {"count": 26, "tags": [], "bug_id": 34716, "attachment_id": null, "is_private": false, "id": 83395, "time": "2005-12-07T23:33:28Z", "creator": "rpluem@apache.org", "creation_time": "2005-12-07T23:33:28Z", "text": "As the error seems to be caused by a virus scanner product installed on the\nboxes I mark this report as invalid."}]
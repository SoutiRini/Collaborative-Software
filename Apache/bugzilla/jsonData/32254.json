[{"count": 0, "tags": [], "creator": "e_val@inbox.ru", "attachment_id": null, "id": 66948, "time": "2004-11-15T20:51:45Z", "bug_id": 32254, "creation_time": "2004-11-15T20:51:45Z", "is_private": false, "text": "Symptoms:\nWhen trying to use apache-2.0.52 as http-proxy (with mod_proxy, mod_cache and\nmod_disk_cache loaded) one may experience unwanted 404 Not Found errors (or\nprobably blank pages/garbage data, see Known Issues below) while\nreloading/reopening visited pages. Usually, when doing reload, your browser will\nattach If-Modified-Since header to the request. In case this error occurs,\nserver error log will contain lines like these:\n\n[info] [client xx.xx.xx.xx] Module bug? Request filename is missing for URI\nhttp://www.somesite.com/page.html, referer: http://www.someothersite/otherpage.html\n[error] [client xx.xx.xx.xx] File does not exist: (null), referer:\nhttp://www.someothersite/otherpage.html\n\nExplanation:\nThe roots of this error are in open_entity() function from\nmodules/experimantal/mod_disk_cache.c. This subroutine does not fill\nh->cache_obj->info.filename field which is later used to set r->filename value\nin modules/experimantal/cache_storage.c:cache_select_url(). This cause\nr->filename to fail sanity checks found in\nmodules/proxy/mod_proxy.c:proxy_map_location() and thus be passed to\nserver/request.c:ap_directory_walk() which shouldn't happen for the proxy\nrequest. Obviously, ap_directory_walk() also fails and outputs error message.\nHowever, leaving h->cache_obj->info.filename blank seems to be ok for\nnon-proxied requests.\n\nSolution:\nStraightforward. open_entity() should check whether the request is being proxied\nand supply h->cache_obj->info.filename for it. The appropriate patch is attached\nto the next comment.\n\nKnown issues:\nThe proposed solution (or mod_disk_cache itself) has issues for cached data when\ndealing with Content-Encoding: gzip. These two bugs can be related or unrelated\nto each other: this requires further investigation."}, {"count": 1, "text": "Created attachment 13471\nA proposed patch for bug 32254", "bug_id": 32254, "attachment_id": 13471, "id": 66950, "time": "2004-11-15T20:57:45Z", "creator": "e_val@inbox.ru", "creation_time": "2004-11-15T20:57:45Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "e_val@inbox.ru", "attachment_id": null, "id": 66998, "time": "2004-11-17T09:35:49Z", "bug_id": 32254, "creation_time": "2004-11-17T09:35:49Z", "is_private": false, "text": "Okay, seems that a bug with compressed content was caused by \"broken conditional\nfilter\" and thus got fixed in the latest CVS version of mod_*_cache. The same\napply to the bug 32254 (this one): mod_disk_cache.c from APACHE_2_0_BRANCH\ndoesn't have it, at least not on the pages I used as a testcases. So if someone\nelse can prove this information I'd rather close this bug and recommend everyone\nsuffering from it to upgrade to the latest CVS version (or wait until 2.0.53 if\nstability is a highest priority). "}]
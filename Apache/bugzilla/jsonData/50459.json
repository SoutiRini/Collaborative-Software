[{"count": 0, "tags": [], "bug_id": 50459, "attachment_id": null, "id": 142596, "time": "2010-12-11T19:06:16Z", "creator": "slaurent@apache.org", "creation_time": "2010-12-11T19:06:16Z", "is_private": false, "text": "As a side effect of my commit, I think I found a bug in StandardContext.bindThread() and unbindThread() methods in both tomcat 6 and 7 :\n\n- the methods should be symmetrical : unbindThread should restore the Thread CCL after calling DirContextURLStreamHandler.unbind() and ContextBindings.unbindThread()\n- StandardContext.bindThread() should call DirContextURLStreamHandler.bindThread() instead of DirContextURLStreamHandler.bind()\n- StandardContext.unbindThread() should call DirContextURLStreamHandler.unbindThread() instead of DirContextURLStreamHandler.unbind()"}, {"count": 1, "tags": [], "bug_id": 50459, "attachment_id": null, "id": 142597, "time": "2010-12-11T19:09:33Z", "creator": "slaurent@apache.org", "creation_time": "2010-12-11T19:09:33Z", "is_private": false, "text": "oops, forgot the link to my initial commit that revealed the bug : http://svn.apache.org/viewvc?rev=1044145&view=rev"}, {"count": 2, "tags": [], "creator": "slaurent@apache.org", "is_private": false, "text": "fix committed on trunk : http://svn.apache.org/viewvc?rev=1044746&view=rev", "id": 142598, "time": "2010-12-11T19:12:12Z", "bug_id": 50459, "creation_time": "2010-12-11T19:12:12Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Moving to 6 now it is fixed in 7.", "attachment_id": null, "id": 142603, "creator": "markt@apache.org", "time": "2010-12-12T16:22:28Z", "bug_id": 50459, "creation_time": "2010-12-12T16:22:28Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 50459, "text": "patch proposed for tomcat 6", "id": 142609, "time": "2010-12-12T17:56:31Z", "creator": "slaurent@apache.org", "creation_time": "2010-12-12T17:56:31Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "Looking at r1044746 and the patch proposed for TC6,\nI think that that replacement of\n s/DirContextURLStreamHandler.bind(/DirContextURLStreamHandler.bindThread(/\n s/DirContextURLStreamHandler.unbind(/DirContextURLStreamHandler.unbindThread(/\nis wrong.\n\nSee DirContextURLStreamHandler#get().\n\nThe difference is when a web application starts a child thread. That thread inherits TCCL from its parent and thus DirContextURLStreamHandler will recognize it when using CL-binding, but will not if thread-binding is used.", "id": 142612, "time": "2010-12-12T18:43:04Z", "bug_id": 50459, "creation_time": "2010-12-12T18:43:04Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 50459, "attachment_id": null, "id": 142664, "time": "2010-12-13T17:42:40Z", "creator": "slaurent@apache.org", "creation_time": "2010-12-13T17:42:40Z", "is_private": false, "text": "Actually the TCCL is properly bound in DirContextURLStreamHandler#clBindings when the application is started : DirContextURLStreamHandler.bind(ClassLoader, DirContext) is called from WebappLoader.startInternal() which itself is called during StandardContext.startInternal() (StandardContext.java rev 1044747 line 4863)\n\nBefore my fix, it was \"pure luck\" that the TCCL was still bound after StandardContext.startInternal() : it only worked because the TCCL was reverted _after_ calling DirContextURLStreamHandler.unbind() so that the latter tried to remove a classloader that had not been bound previously, thus leaving the webapp classloader properly bound."}, {"count": 7, "tags": [], "bug_id": 50459, "text": "(In reply to comment #6)\nOK, I understand it now. WebappLoader indeed manages that binding.", "id": 142853, "time": "2010-12-19T19:48:15Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-12-19T19:48:15Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "text": "Fixed in 6.0.x and will be included in 6.0.30 onwards.", "attachment_id": null, "id": 143086, "creator": "markt@apache.org", "time": "2011-01-05T09:18:11Z", "bug_id": 50459, "creation_time": "2011-01-05T09:18:11Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 43562, "attachment_id": null, "id": 109026, "time": "2007-10-05T09:00:08Z", "creator": "jose@w3.org", "creation_time": "2007-10-05T09:00:08Z", "is_private": false, "text": "Please remove PR 21059 from mod_speling as it has downgraded the\nbehavior of Apache 2.2 and also because bug 21059 was solved by\nchanges elsewhere in the code. The patch I'm submitting effectively\ndeletes PR 21059.\n\nDetailed report:\n\nWay back in 2003, the following dependency was added to\nmod_speling:check_speling(), as an attempt to fix bug report # 21059\n[1] for Apache 2.0.45. This patch was apparently applied only to the\n2.2 tree:\n\n[[\n    /* we default to reject path info (same as core handler) */\n    if ((r->used_path_info != AP_REQ_ACCEPT_PATH_INFO) &&\n        r->path_info && *r->path_info) {\n        return DECLINED;\n    }\n]]\n\nThis patch has had a bad side effect on Apache 2.2: use of mod_speling\nis now conditioned to the use of AcceptPathInfo; it's not possible\nanymore to use mod_speling without having AcceptPathInfo turned on.\n\nWith all due respect, I believe that the correct approach would have\nrather been to add a directive similar to mod_mime's\nModMimeUsePathInfo [2], which is \"is used to combine the filename with\nthe path_info URL component to apply mod_mime's directives to the\nrequest.\" This requires a deeper code change than what the patch\nproposed.\n\nThis patch has also downgraded the behavior of Apache 2.2; if you were\nusing mod_speling, URIs that returned status 404 under Apache 1.3 are\nnow returning status 200, because you need to enable AcceptPathInfo to\nbe able to use mod_speling.\n\nIf we look at bug report 21059, I see that it is describing a standard\nbehavior in Apache 1.3:\n\n  1. the client passed a path_info in its request\n      http://www.abcdatos.com/programas/traductores/\n  2. mod_negotiation (and not mod_speling), converted the URI to:\n      http://www.abcdatos.com/programas/traductores/\"\n\nThe real bug here, according to the report, is that the server returns\n404, regardless of the user's enabling of AcceptPathInfo. Up to this\nmoment, mod_speling has not been concerned: there has been no spelling\ncorrection.\n\nLet's jump  back to the future and to Apache 2.2. I made the following\ntests (detailed results here below):\n\n1. Apache 1.3 with mod_speling\n2. Apache 2.2.4; mod_speling with PR 21059 and AcceptPathInfo enabled\n3. Apache 2.2.4; mod_speling without PR 21059 removed and AcceptPathInfo \ndisabled\n4. Apache 2.2.4; mod_sepling witout PR 21059 and AcceptPathInfo enabled\n\nTo summarize the results, removing the patch to mod_speling and\ndisabling AcceptPathInfo gives us the same behavior as with Apache\n1.3. Moreover, removing the patch and enabling AcceptPathInfo does\npass the path info to the resource, thus showing that the behavior\ndescribed in bug report 21059 was fixed elsewhere in the code and that\nPR 21059 is not needed.\n\nThere have been other bug reports about the side-effects and nuisance\nof binding mod_speling with a global AcceptPathInfo (e.g, # 38635 [3]\nand mailing list posts)).\n\nI would strongly advise to remove this dependency and, when resources\nare available, add a better integration of AcceptPathInfo processing\ninto mod_speling, such as the one done in mod_mime via\nModMimeUsePathInfo.\n\nCheers,\n\n-jose\n\n[1] http://issues.apache.org/bugzilla/show_bug.cgi?id=21059\n[2] http://httpd.apache.org/docs/2.2/mod/mod_mime.html#modmimeusepathinfo\n[3] http://issues.apache.org/bugzilla/show_bug.cgi?id=38635\n\n---------------\ndetailed tests\n\nWe're requesting http://www.w3.org/INSTALL.html, using different versions\nof the Apache server and different variations on the URI.\n\n--------------\n\n1. Apache 1.3.37 (gives us our \"standard\" behavior)\n\n*** Without '/' after the URI:\n\nhttp://www.w3.org/INSTALL.html  --> 200  OK\n\nhttp://www.w3.org/INSTALL  --> 200 OK \n  Content-Location: INSTALL.html\n\nhttp://www.w3.org/Install --> 300 Multiple Choices (INSTALL.html)\nhttp://www.w3.org/Install.html --> 301 Moved Permanently (INSTALL.html)\nhttp://www.w3.org/Install.HTML --> 301 Moved Permanently (INSTALL.html)\n\n** With '/' after the URI: \n  --> Content-Location header is not sent anymore\n\nhttp://www.w3.org/INSTALL/ --> 404 Not Found\nhttp://www.w3.org/INSTALL.html/ --> 404 Not Found\nhttp://www.w3.org/Install/ --> 300 Multiple Choices (/INSTALL.html/)\nhttp://www.w3.org/Install.html/ --> 301 Moved Permanently (INSTALL.html/)\n\n  --> Conclusion: They will all end returning  404\n\n** With '/foo' after the URI:\n\nhttp://www.w3.org/INSTALL.html/foo --> 404 Not Found\nhttp://www.w3.org/INSTALL/foo --> 404 Not Found\n   --> No redirection\nhttp://www.w3.org/Install.html/foo --> 301 Moved Permanently (INSTALL.html/foo)\nhttp://www.w3.org/Install/foo --> 300 Multiple Choices (INSTALL.html/foo)\n\n   --> Conclusion: They will all end returning  404\n\nSummary: \n\nOnly INSTALL returns valid content in the end; all the other\nvariations, INSTALL/ or INSTALL/foo, return 404.\n\n==============\n\n2. Apache 2.2.4 with AcceptPathInfo enabled; mod_speling contains PR 21059\n\n*** Without '/' after the URI:\n\nhttp://www.w3.org/INSTALL.html  --> 200  OK\n\nhttp://www.w3.org/INSTALL  --> 200 OK \n  Content-Location: INSTALL.html\n\nhttp://www.w3.org/Install --> 300 Multiple Choices (INSTALL.html)\nhttp://www.w3.org/Install.html --> 301 Moved Permanently (INSTALL.html)\nhttp://www.w3.org/Install.HTML --> 301 Moved Permanently (INSTALL.html)\n\n** With '/' after the URI: \n\nhttp://www.w3.org/INSTALL/ --> 200 OK\nhttp://www.w3.org/INSTALL.html/ --> 200 OK\nhttp://www.w3.org/Install/ --> 300 Multiple Choices (/INSTALL.html/)\nhttp://www.w3.org/Install.html/ --> 301 Moved Permanently (INSTALL.html/)\n\n** With '/foo' after the URI:\n\nhttp://www.w3.org/INSTALL/foo --> 200 OK\nhttp://www.w3.org/INSTALL.html/foo --> 200 OK\nhttp://www.w3.org/Install/foo --> 300 Multiple Choices (/INSTALL.html/foo)\nhttp://www.w3.org/Install.html/foo --> 301 Moved Permanently (INSTALL.html/foo)\n\nSummary: \n\nThe server always return status code 200 if we want to use mod_speling,\nbecause of the biding with AcceptPathInfo on.\n\nThere's no way to have the same behavior as under Apache 1.3.\n\n=======\n\n3. Apache 2.2.4 with AcceptPathInfo disabled; mod_speling without PR 21059\n\n*** Without '/' after the URI:\n\nhttp://www.w3.org/INSTALL.html  --> 200  OK\n\nhttp://www.w3.org/INSTALL  --> 200 OK \n  Content-Location: INSTALL.html\n\nhttp://www.w3.org/Install --> 300 Multiple Choices (INSTALL.html)\nhttp://www.w3.org/Install.html --> 301 Moved Permanently (INSTALL.html)\nhttp://www.w3.org/Install.HTML --> 301 Moved Permanently (INSTALL.html)\n\n** With '/' after the URI: \n\nhttp://www.w3.org/INSTALL/ --> 404 Not Found\nhttp://www.w3.org/INSTALL.html/ --> 404 Not Found\nhttp://www.w3.org/Install/ --> 300 Multiple Choices (/INSTALL.html/)\nhttp://www.w3.org/Install.html/ --> 301 Moved Permanently (INSTALL.html/)\n\n** With '/foo' after the URI:\n\nhttp://www.w3.org/INSTALL.html/foo --> 404 Not Found\nhttp://www.w3.org/INSTALL/foo --> 404 Not Found\nhttp://www.w3.org/Install.html/foo --> 301 Moved Permanently (INSTALL.html/foo)\nhttp://www.w3.org/Install/foo --> 300 Multiple Choices (INSTALL.html/foo)\n\nConclusion:\n\nRemoving PR 21059 and disabling AcceptPathInfo gives us the same\nbehavior as under Apache 1.3. mod_speling is not conditioned anymore\nto the AcceptPathInfo directive.\n\n==========\n\n4. Apache 2.2.4 with AcceptPathInfo enabled; mod_speling without PR 21059\n\n*** Without '/' after the URI:\n\nhttp://www.w3.org/INSTALL.html  --> 200  OK\n\nhttp://www.w3.org/INSTALL  --> 200 OK \n  Content-Location: INSTALL.html\n\nhttp://www.w3.org/Install --> 300 Multiple Choices (INSTALL.html)\nhttp://www.w3.org/Install.html --> 301 Moved Permanently (INSTALL.html)\nhttp://www.w3.org/Install.HTML --> 301 Moved Permanently (INSTALL.html)\n\n** With '/' after the URI: \n\nhttp://www.w3.org/INSTALL/ --> 404 Not Found\nhttp://www.w3.org/INSTALL.html/ --> 404 Not Found\nhttp://www.w3.org/Install/ --> 300 Multiple Choices (/INSTALL.html/)\nhttp://www.w3.org/Install.html/ --> 301 Moved Permanently (INSTALL.html/)\n\n** With '/foo' after the URI:\n\nhttp://www.w3.org/INSTALL.html/foo --> 200 OK\nhttp://www.w3.org/INSTALL/foo --> 200 OK\nhttp://www.w3.org/Install.html/foo --> 301 Moved Permanently (INSTALL.html/foo)\nhttp://www.w3.org/Install/foo --> 300 Multiple Choices (INSTALL.html/foo)\n\nConclusion:\n\nRemoving PR 21059 and enabling AcceptPathInfo gives us the same\nbehavior as under Apache 1.3, with the addition of being able to pass\non the path info to the resource. This shows effectively that bug\n#21059 was solved elsewhere in the code and that PR 21059 in\nmod_speling is not related at all."}, {"count": 1, "attachment_id": 20923, "creator": "jose@w3.org", "text": "Created attachment 20923\nremoves PR 21059 from mod_speling. Patch against 2.2.6", "id": 109027, "time": "2007-10-05T09:01:28Z", "bug_id": 43562, "creation_time": "2007-10-05T09:01:28Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 43562, "attachment_id": 20924, "text": "Created attachment 20924\nremoves PR 21059 from mod_speling. Patch against trunk", "id": 109028, "time": "2007-10-05T09:01:54Z", "creator": "jose@w3.org", "creation_time": "2007-10-05T09:01:54Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43562, "attachment_id": null, "id": 109030, "time": "2007-10-05T09:48:57Z", "creator": "ted@w3.org", "creation_time": "2007-10-05T09:48:57Z", "is_private": false, "text": "One thing to add to this report is a rather serious side effect this\nmod_speling/pathinfo bug inadvertently introduces, infinitely recursive uris. \nClueless crawlers, which are many, do not notice from the ETAG that they are\ngetting is identical to a resource they already indexed.  When parsing a\nresource for links they accessed with a trailing / and coming across a relative\nuri they naturally append the relative path to the uri they already have as a\nresource to crawl.\n\nFor example:\n\nhttp://www.w3.org/INSTALL.html/Library/src/Library/src/ --> 200 OK\n\nhttp://www.w3.org/INSTALL.html/Library/src/Library/src/Library/src/ --> 200 OK\n\nad nauseam\n\nExcept as perhaps a teergrube exercise to trap and hold hostage unsuspecting\ncrawlers indefinitely this is generally undesirable.\n\nRegards,"}, {"count": 4, "tags": [], "creator": "jim@apache.org", "text": "fixed in trunk r635953. Will propose for 2.2 backport", "id": 114485, "time": "2008-03-11T07:38:27Z", "bug_id": 43562, "creation_time": "2008-03-11T07:38:27Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "backported to 2.2 as r649120\nhttp://svn.apache.org/viewvc?view=rev&revision=649120", "is_private": false, "id": 115673, "creator": "takashi.asfbugzilla@tks.st", "time": "2008-04-17T07:58:12Z", "bug_id": 43562, "creation_time": "2008-04-17T07:58:12Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "id": 117913, "time": "2008-06-23T07:42:56Z", "bug_id": 43562, "creation_time": "2008-06-23T07:42:56Z", "is_private": false, "text": "*** Bug 38635 has been marked as a duplicate of this bug. ***"}, {"attachment_id": null, "tags": [], "creator": "takashi.asfbugzilla@tks.st", "is_private": false, "count": 7, "id": 121701, "time": "2008-10-20T08:22:10Z", "bug_id": 43562, "creation_time": "2008-10-20T08:22:10Z", "text": "*** Bug 46042 has been marked as a duplicate of this bug. ***"}]
[{"count": 0, "tags": [], "text": "Created attachment 27840\nPPT with a slide with shapes grouped\n\nSlide.draw throws java.lang.OutOfMemoryError in some slides with grouped shapes. \n\nHow to reproduce:\n\n- Download the attached PPT (TesteAgrupado.ppt)\n- Run org.apache.poi.hslf.examples.PPT2PNG TesteAgrupado.ppt\n\nIf you open the PPT, ungroup the shapes within the first slide and run the PPT2PNG again, no error will occur!\n\nI\u00b4ve already tried to increase the heap memory size but got the same error.\n\nThe output and stack trace:\n\nRendering slide 1\nException in thread \"main\" java.lang.OutOfMemoryError: Java heap space\n        at java.awt.image.DataBufferInt.<init>(Unknown Source)\n        at java.awt.image.Raster.createPackedRaster(Unknown Source)\n        at java.awt.image.DirectColorModel.createCompatibleWritableRaster(Unknow\nn Source)\n        at sun.awt.image.ImageRepresentation.createBufferedImage(Unknown Source)\n\n        at sun.awt.image.ImageRepresentation.setPixels(Unknown Source)\n        at java.awt.image.AreaAveragingScaleFilter.accumPixels(Unknown Source)\n        at java.awt.image.AreaAveragingScaleFilter.setPixels(Unknown Source)\n        at sun.awt.image.OffScreenImageSource.sendPixels(Unknown Source)\n        at sun.awt.image.OffScreenImageSource.produce(Unknown Source)\n        at sun.awt.image.OffScreenImageSource.addConsumer(Unknown Source)\n        at sun.awt.image.OffScreenImageSource.startProduction(Unknown Source)\n        at java.awt.image.FilteredImageSource.startProduction(Unknown Source)\n        at sun.awt.image.ImageRepresentation.startProduction(Unknown Source)\n        at sun.awt.image.ImageRepresentation.drawToBufImage(Unknown Source)\n        at sun.java2d.pipe.DrawImage.copyImage(Unknown Source)\n        at sun.java2d.SunGraphics2D.drawImage(Unknown Source)\n        at sun.java2d.SunGraphics2D.drawImage(Unknown Source)\n        at org.apache.poi.hslf.blip.BitmapPainter.paint(BitmapPainter.java:65)\n        at org.apache.poi.hslf.usermodel.PictureData.draw(PictureData.java:230)\n        at org.apache.poi.hslf.model.Picture.draw(Picture.java:268)\n        at org.apache.poi.hslf.model.ShapeGroup.draw(ShapeGroup.java:289)\n        at org.apache.poi.hslf.model.Slide.draw(Slide.java:433)\n        at org.apache.poi.hslf.examples.PPT2PNG.main(PPT2PNG.java:95)", "attachment_id": 27840, "id": 150880, "creator": "saulobrito@gmail.com", "time": "2011-10-24T20:50:50Z", "bug_id": 52078, "creation_time": "2011-10-24T20:50:50Z", "is_private": false}, {"count": 1, "tags": [], "text": "Should be fixed in r1293561\n\nYegor", "is_private": false, "id": 154135, "creator": "yegor@dinom.ru", "time": "2012-02-25T09:40:38Z", "bug_id": 52078, "creation_time": "2012-02-25T09:40:38Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 52078, "attachment_id": null, "id": 163315, "time": "2012-11-09T15:47:20Z", "creator": "nicolas_metal04@hotmail.com", "creation_time": "2012-11-09T15:47:20Z", "is_private": false, "text": "Why Status is RESOLVED? I didn't find the solution!\nPlease, can show me?\n\nThanks"}, {"count": 3, "attachment_id": null, "creator": "yegor@dinom.ru", "text": "Did you try the latest build from trunk? Does it still throw OutOfMemory for the attached file?\n\n(In reply to comment #2)\n> Why Status is RESOLVED? I didn't find the solution!\n> Please, can show me?\n> \n> Thanks", "id": 163317, "time": "2012-11-09T16:44:39Z", "bug_id": 52078, "creation_time": "2012-11-09T16:44:39Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "text": "OK, i saw it, but i don't understand how can I get the Picture object(parent) in BitmapPainter.paint(Graphics2D graphics, PictureData pict, Picture parent) method?\nI put my method that returns a list of strings(the BufferedImage converted in base64) --> one string for one slide\n\n/***************************************************/\nprivate List<String> obtainSlidesFromPPT(InputStream is) {\n\tSlideShow ppt = null;\n\tList<String> returnList = new LinkedList<String>();\n\ttry {\n\t\tppt = new SlideShow(is);\n\t\tis.close();\n\t\tDimension pgsize = ppt.getPageSize();\n\t\tPictureData [] pd = ppt.getPictureData();\n\t\tint nSlides = pd.length;\n\t\tfor (int i = 0; i < nSlides; i++) {\n\t\t\tPictureData pict = pd[i];\n\t\t\tBufferedImage img = ImageIO.read(new ByteArrayInputStream(pict.getData()));\n\t\t\tGraphics2D graphics = img.createGraphics();\n\t\t\t//Rectangle anchor = parent.getLogicalAnchor2D().getBounds();\n\t\t\t graphics.drawImage(img, anchor.x, anchor.y, anchor.width, anchor.height, null);\n\t\t\tgraphics.dispose();\t\t\t\treturnList.add(covertBufferedImageInBase64String(img));\t\t\n\t\t\t}\n\t\t} catch (IOException ioe) {\n\t\t\tSystem.err.println(ioe.getMessage());\n\t\t}\n\t\treturn returnList;\n\t}\n/***************************************************/\n\n\n(In reply to comment #3)\n> Did you try the latest build from trunk? Does it still throw OutOfMemory for\n> the attached file?\n> \n> (In reply to comment #2)\n> > Why Status is RESOLVED? I didn't find the solution!\n> > Please, can show me?\n> > \n> > Thanks", "is_private": false, "id": 163425, "creator": "nicolas_metal04@hotmail.com", "time": "2012-11-13T13:42:47Z", "bug_id": 52078, "creation_time": "2012-11-13T13:42:47Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "To get Picture objects from a slide you need to iterate over the shapes and check if a shape is an instance of Picture, see example at http://poi.apache.org/slideshow/how-to-shapes.html#Pictures\n\n\n(In reply to comment #4)\n> OK, i saw it, but i don't understand how can I get the Picture\n> object(parent) in BitmapPainter.paint(Graphics2D graphics, PictureData pict,\n> Picture parent) method?\n> I put my method that returns a list of strings(the BufferedImage converted\n> in base64) --> one string for one slide\n> \n> /***************************************************/\n> private List<String> obtainSlidesFromPPT(InputStream is) {\n> \tSlideShow ppt = null;\n> \tList<String> returnList = new LinkedList<String>();\n> \ttry {\n> \t\tppt = new SlideShow(is);\n> \t\tis.close();\n> \t\tDimension pgsize = ppt.getPageSize();\n> \t\tPictureData [] pd = ppt.getPictureData();\n> \t\tint nSlides = pd.length;\n> \t\tfor (int i = 0; i < nSlides; i++) {\n> \t\t\tPictureData pict = pd[i];\n> \t\t\tBufferedImage img = ImageIO.read(new\n> ByteArrayInputStream(pict.getData()));\n> \t\t\tGraphics2D graphics = img.createGraphics();\n> \t\t\t//Rectangle anchor = parent.getLogicalAnchor2D().getBounds();\n> \t\t\t graphics.drawImage(img, anchor.x, anchor.y, anchor.width, anchor.height,\n> null);\n> \t\t\tgraphics.dispose();\t\t\t\n> returnList.add(covertBufferedImageInBase64String(img));\t\t\n> \t\t\t}\n> \t\t} catch (IOException ioe) {\n> \t\t\tSystem.err.println(ioe.getMessage());\n> \t\t}\n> \t\treturn returnList;\n> \t}\n> /***************************************************/\n> \n> \n> (In reply to comment #3)\n> > Did you try the latest build from trunk? Does it still throw OutOfMemory for\n> > the attached file?\n> > \n> > (In reply to comment #2)\n> > > Why Status is RESOLVED? I didn't find the solution!\n> > > Please, can show me?\n> > > \n> > > Thanks", "is_private": false, "bug_id": 52078, "id": 163478, "time": "2012-11-16T12:08:49Z", "creator": "yegor@dinom.ru", "creation_time": "2012-11-16T12:08:49Z", "attachment_id": null}]
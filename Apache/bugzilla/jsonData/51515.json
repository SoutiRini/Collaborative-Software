[{"count": 0, "tags": [], "text": "Created attachment 27291\nSource in TomcatCometHttps.tar.gz and conf in server-conf.tar.gz packaged in the uploaded tar.gz\n\nI am  using Tomcat 6.0.20 on Ubuntu 10.04 and have written a simple TomcatWeatherServlet as presented in http://www.ibm.com/developerworks/web/library/wa-cometjava/ I modified the servlet to stream weather feed to multiple curl clients. I am using curl 7.21.6 as my client.\n\nWhen I run curl -i -k -v -trace https://<IP_Addr>:8443/Weather from the command-line I get the following response for the first few times:\n\n<code>\n$ curl -i -k -v -trace https://<IP_Addr>:8443/Weather\n* About to connect() to <IP_Addr> port 8443 (#0)\n*   Trying <IP_Addr>... connected\n* Connected to <IP_Addr> (<IP_Addr>) port 8443 (#0)\n* successfully set certificate verify locations:\n*   CAfile: none\n  CApath: /etc/ssl/certs\n* SSLv3, TLS handshake, Client hello (1):\n* SSLv3, TLS handshake, Server hello (2):\n* SSLv3, TLS handshake, CERT (11):\n* SSLv3, TLS handshake, Server key exchange (12):\n* SSLv3, TLS handshake, Server finished (14):\n* SSLv3, TLS handshake, Client key exchange (16):\n* SSLv3, TLS change cipher, Client hello (1):\n* SSLv3, TLS handshake, Finished (20):\n* SSLv3, TLS change cipher, Client hello (1):\n* SSLv3, TLS handshake, Finished (20):\n* SSL connection using DHE-RSA-AES256-SHA\n* Server certificate:\n*              subject: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n*              start date: 2009-02-23 23:07:18 GMT\n*              expire date: 2019-02-21 23:07:18 GMT\n*              common name: XXXXXXXXXX (does not match '<IP_Addr>')\n*              issuer: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n*              SSL certificate verify result: self signed certificate (18), continuing anyway.\n> GET /Weather HTTP/1.1\n> User-Agent: curl/7.21.6 (x86_64-pc-linux-gnu) libcurl/7.19.7 OpenSSL/0.9.8k zlib/1.2.3.3 libidn/1.15\n> Host: <IP_Addr>:8443\n> Accept: */*\n> \n< HTTP/1.1 200 OK\nHTTP/1.1 200 OK\n< Server: Apache-Coyote/1.1\nServer: Apache-Coyote/1.1\n< Content-Length: 0\nContent-Length: 0\n< Date: Wed, 29 Jun 2011 23:40:17 GMT\nDate: Wed, 29 Jun 2011 23:40:17 GMT\n\n< \n* Connection #0 to host <IP_Addr> left intact\n* Closing connection #0\n* SSLv3, TLS alert, Client hello (1):\n</code>\n\nObserve that Content-Length is 0 in the response. Also when I do get the expected response which is,\n\n<code>\n> GET /Weather HTTP/1.1\n> User-Agent: curl/7.21.6 (x86_64-pc-linux-gnu) libcurl/7.19.7 OpenSSL/0.9.8k zlib/1.2.3.3 libidn/1.15\n> Host: <IP_Addr>:8443\n> Accept: */*\n> \n< HTTP/1.1 200 OK\nHTTP/1.1 200 OK\n< Server: Apache-Coyote/1.1\nServer: Apache-Coyote/1.1\n< Transfer-Encoding: chunked\nTransfer-Encoding: chunked\n< Date: Wed, 29 Jun 2011 23:46:18 GMT\nDate: Wed, 29 Jun 2011 23:46:18 GMT\n\n< \n<h2>Conditions for San Jose, CA at 3:52 pm PDT</h2>\n<img src=\"http://l.yimg.com/a/i/us/we/52/30.gif\"/><br />\n<b>Current Conditions:</b><br />\nPartly Cloudy, 68 F<BR />\n<BR /><b>Forecast:</b><BR />\nWed - Mostly Clear. High: 70 Low: 55<br />\nThu - Partly Cloudy. High: 77 Low: 57<br />\n<br />\n<a href=\"http://us.rd.yahoo.com/dailynews/rss/weather/San_Jose__CA/*http://weather.yahoo.com/forecast/USCA0993_f.html\">Full Forecast at Yahoo! Weather</a><BR/><BR/>\n(provided by <a href=\"http://www.weather.com\" >The Weather Channel</a>)<br/>\n<br>\n\n</code>\nI get Transfer-Encoding as chunked and no Content-Length.\n\nOn Server logs I get for the error are:\n16:40:16.916  INFO http-8443-exec-3 TomcatWeatherServlet:41 - Begin for session: BDD6B1808161F1DA99D5D3207F1A719B\n16:40:16.959  INFO http-8443-exec-4 TomcatWeatherServlet:48 - End for session: BDD6B1808161F1DA99D5D3207F1A719B\n16:40:17.033  INFO http-8443-exec-4 TomcatWeatherServlet:48 - End for session: BDD6B1808161F1DA99D5D3207F1A719B\n\nThis was working when I was on HTTP. I have tried to debug this for a lot of time w/o success. Also I get two END events instead of one as seen in the Logs. \n\nFind the attached source and configuration", "is_private": false, "bug_id": 51515, "id": 147944, "time": "2011-07-15T21:59:52Z", "creator": "pradhans@vmware.com", "creation_time": "2011-07-15T21:59:52Z", "attachment_id": 27291}, {"count": 1, "tags": [], "text": "I have tested this with the latest Tomcat 7.0.x code and it works as expected.\n\nA couple of notes for folks trying to use this test case.\n1. It assumes it is running from within VMware's internal network so (unless you fancy changing employers) you'll need to remove the proxy info from Weatherman.java\n2. It has a couple of dependencies you can just remove rather than spend time tracking down.\n\nIf testing on Tomcat 7, remember that the Comet classes moved packages.\n\nOn to testing with the latest 6.0.x", "attachment_id": null, "id": 148084, "creator": "markt@apache.org", "time": "2011-07-22T12:59:26Z", "bug_id": 51515, "creation_time": "2011-07-22T12:59:26Z", "is_private": false}, {"text": "OK, I do see errors on first access (although not quite the same) on 6.0.x. I'm investigating now. In the meantime, an upgrade to 7.0.19 should fix this for you.", "tags": [], "bug_id": 51515, "is_private": false, "count": 2, "id": 148085, "time": "2011-07-22T13:34:27Z", "creator": "markt@apache.org", "creation_time": "2011-07-22T13:34:27Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 51515, "attachment_id": null, "id": 148089, "time": "2011-07-22T17:33:26Z", "creator": "markt@apache.org", "creation_time": "2011-07-22T17:33:26Z", "is_private": false, "text": "I have a patch that fixes this for 6.0.x. I have proposed this patch for the next 6.0.x release."}, {"count": 4, "tags": [], "bug_id": 51515, "attachment_id": null, "is_private": false, "id": 148367, "time": "2011-08-04T00:28:00Z", "creator": "pradhans@vmware.com", "creation_time": "2011-08-04T00:28:00Z", "text": "Mark,\n\nCan I have the patch so that I can test it?\n\nThanks,\nSudeep"}, {"count": 5, "tags": [], "bug_id": 51515, "attachment_id": null, "is_private": false, "id": 148372, "time": "2011-08-04T04:06:50Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-08-04T04:06:50Z", "text": "(In reply to comment #4)\n> Can I have the patch so that I can test it?\n\nSee STATUS.txt in the root of tc6.0.x source tree. A patch was \"proposed\" means that it has been added to the status file."}, {"count": 6, "tags": [], "creator": "pradhans@vmware.com", "attachment_id": null, "id": 148389, "time": "2011-08-04T18:23:28Z", "bug_id": 51515, "creation_time": "2011-08-04T18:23:28Z", "is_private": false, "text": "The patch fixes the problem mentioned in the bug.\n\nThere is another problem, END event is not raised when the client closes the connection abruptly. e.g. Ctrl-C on terminal running curl http client.\n\nIs this another bug?"}, {"text": "Fixed in 6.0.x and will be included in 6.0.33 onwards.", "tags": [], "bug_id": 51515, "is_private": false, "count": 7, "id": 148632, "time": "2011-08-16T10:18:01Z", "creator": "markt@apache.org", "creation_time": "2011-08-16T10:18:01Z", "attachment_id": null}]
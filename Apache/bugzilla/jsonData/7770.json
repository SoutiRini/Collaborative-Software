[{"count": 0, "tags": [], "bug_id": 7770, "text": "First odf all my setup:\n\nTomcat 3.3.1 final with mod_jk 1.1 ajp13 behind 2 Apaches 1.3.19 on Solaris 8 \n(SPARC)\n\nI can find the following NPE once in a while shortly after we startup Tomcat:\n\n\njava.lang.NullPointerException\n        at org.apache.tomcat.modules.session.SessionId.processSession\n(SessionId.java:237)\n        at org.apache.tomcat.modules.session.SessionId.requestMap\n(SessionId.java:217)\n        at org.apache.tomcat.core.ContextManager.processRequest\n(ContextManager.java:968)\n        at org.apache.tomcat.facade.RequestDispatcherImpl.doForward\n(RequestDispatcherImpl.java:259)\n        at org.apache.tomcat.facade.RequestDispatcherImpl.forward\n(RequestDispatcherImpl.java:174)\n        at org.apache.struts.action.ActionServlet.processActionForward\n(ActionServlet.java:1758)\n        at org.apache.struts.action.ActionServlet.process\n(ActionServlet.java:1595)\n        at de.einsurance.gui.framework.ExtendedActionServlet.process\n(ExtendedActionServlet.java:65)\n        at org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:491)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java)\n        at org.apache.tomcat.facade.ServletHandler.doService\n(ServletHandler.java:574)\n        at org.apache.tomcat.core.Handler.invoke(Handler.java:322)\n        at org.apache.tomcat.core.Handler.service(Handler.java:235)\n        at org.apache.tomcat.facade.ServletHandler.service\n(ServletHandler.java:485)\n        at org.apache.tomcat.facade.RequestDispatcherImpl.doForward\n(RequestDispatcherImpl.java:272)\n        at org.apache.tomcat.facade.RequestDispatcherImpl.forward\n(RequestDispatcherImpl.java:174)\n        at org.apache.struts.action.ActionServlet.processActionForward\n(ActionServlet.java:1758)\n        at org.apache.struts.action.ActionServlet.process\n(ActionServlet.java:1595)\n        at de.einsurance.gui.framework.ExtendedActionServlet.process\n(ExtendedActionServlet.java:65)\n        at org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:491)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java)\n        at org.apache.tomcat.facade.ServletHandler.doService\n(ServletHandler.java:574)\n        at org.apache.tomcat.core.Handler.invoke(Handler.java:322)\n        at org.apache.tomcat.core.Handler.service(Handler.java:235)\n        at org.apache.tomcat.facade.ServletHandler.service\n(ServletHandler.java:485)\n        at org.apache.tomcat.core.ContextManager.internalService\n(ContextManager.java:917)\n        at org.apache.tomcat.core.ContextManager.service\n(ContextManager.java:833)\n        at org.apache.tomcat.modules.server.Ajp13Interceptor.processConnection\n(Ajp13Interceptor.java:341)\n        at org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:494)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:516)\n        at java.lang.Thread.run(Thread.java:479)\n\n\nHas anybody an Idea what happens here?\n\nWe have the following (quite special) setup in this case, which I try to \nexplain here:\n\n2 HW-loadbalanced Apache server connect via mod_jk 1.1 to several tomcats.\nMore or less one tomcat per Webapp.\n\nThe error above occurs in a special webapp which is setup a little bit \ndifferent:\n\nFor this (our critical webapp) we use a single Tomcat connected via a\nloadbalanced worker using two ajp13 workers (lbfactor 1 and 0.00001)\nThis second worker normaly points to a not running Tomcat and is therefore \nignored.\n\nWhen we update some classes or otherwise have to restart our main tomcat,\nwe start the second Tomcat, exchange the worker.property files with one that\nhave lbfactors 0.00001 and 1 (the other way around as before) and graceful \nrestart our two apaches.\n\nThat way, (almost) all new sessions go to the newly started Tomcat, while still \nexisting sessions stick with the old Tomcat. After 30 min, we shut down the \noriginal Tomcat and our switch over is finished.\n\nSo we are missusing the loadbalancing feature to slowly migrate our running \nsessions to the new Tomcat instance.\n\nThe above Error sometimes occured at exactly the point, where we start up this \nsecond Tomcat. It seems to me that sometimes the first session arrives the new \ntomcat before it finished its startup procedure (load on startup servlets ...)\n\n\nThanks for any hints,\nHans", "id": 12870, "time": "2002-04-05T16:06:26Z", "creator": "hans.schmid@einsurance.de", "creation_time": "2002-04-05T16:06:26Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "william.barker@wilshire.com", "is_private": false, "id": 14962, "creation_time": "2002-04-29T02:18:10Z", "time": "2002-04-29T02:18:10Z", "bug_id": 7770, "text": "Are you certain that this is the starting-up Tomcat?  On the shutting down one, \nI could understand it (it has issues :).  From the stack trace, it has already \nsuccessfully gotten past here on the primary request at least once....", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 7770, "attachment_id": null, "is_private": false, "id": 14979, "time": "2002-04-29T07:56:07Z", "creator": "hans.schmid@einsurance.de", "creation_time": "2002-04-29T07:56:07Z", "text": "It is definately at startup time. \nThe failing Thread was the third to access(create) a new session (according to \nour logs). When the NPE occurs, two more sessions were created in between:\nthe order seem sto be (in this case):\n\n[Thread-21] new session\n[Thread-18] new session\n[Thread-22] new session <-- this is our thread with the NPE\n[Thread-20] new session\n[Thread-19] new session\n[Thread-22] ERROR (gui.framework.ExceptionHandler)  - Stacktrace:\njava.lang.NullPointerException\n        at org.apache.tomcat.modules.session.SessionId.processSession\n(SessionId.java:237)\n        at org.apache.tomcat.modules.session.SessionId.requestMap\n(SessionId.java:188)\n        at org.apache.tomcat.core.ContextManager.processRequest\n(ContextManager.java:968)\n        at org.apache.tomcat.facade.RequestDispatcherImpl.doForward\n(RequestDispatcherImpl.java:259)\n        at org.apache.tomcat.facade.RequestDispatcherImpl.forward\n(RequestDispatcherImpl.java:174)\n        at org.apache.struts.action.ActionServlet.processActionForward\n(ActionServlet.java:1758)\n        at org.apache.struts.action.ActionServlet.process\n(ActionServlet.java:1595)\n        at de.einsurance.gui.framework.ExtendedActionServlet.process\n(ExtendedActionServlet.java:65)\n"}, {"count": 3, "attachment_id": null, "bug_id": 7770, "text": "This is now fixed in the CVS HEAD, and will be in the nightly once they start \nbeing built again.\n\n", "id": 15092, "time": "2002-04-30T04:40:26Z", "creator": "william.barker@wilshire.com", "creation_time": "2002-04-30T04:40:26Z", "tags": [], "is_private": false}]
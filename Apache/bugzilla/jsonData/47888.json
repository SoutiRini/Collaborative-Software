[{"count": 0, "tags": [], "bug_id": 47888, "text": "The JUnit sampler currently re-uses the same test object for each sample.\n\nThis is not how JUnit tests work, as the test runner creates a new instance of the test class for each test.\n\nRe-using the instance means that tests such as the following contrived example will fail if a sampler is run more than once in a loop:\n\n    private int i = 123;\n    public void testRerun(){\n        assertEquals(123,i);\n        i++;\n    }\n\nThe sampler needs to recreate the test instance for each sample.", "id": 130590, "time": "2009-09-22T17:59:06Z", "creator": "sebb@apache.org", "creation_time": "2009-09-22T17:59:06Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 47888, "text": "A couple of notes on the difference between jmeter's sampler and the standard junit runner. For a stress test, we don't want to create a new instance of the test class. When I originally wrote the junit sampler, it was for stress and load testing. You can use it for unit testing, but it would require changing how your unit test is written.\n\nCedric B of TestNG used to mention this design choice of JUnit as one of the flaws. I got around the issue for stress testing by writing our own test runner.\n\npeter", "id": 130592, "time": "2009-09-22T18:05:39Z", "creator": "woolfel@yahoo.com", "creation_time": "2009-09-22T18:05:39Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "sebb@apache.org", "is_private": false, "text": "I see - good point.\n\nIt does mean that there are restrictions on the tests that can be run using JMeter, but that's probably worth it - so it will be documented rather than changed.", "id": 130593, "time": "2009-09-22T18:46:05Z", "bug_id": 47888, "creation_time": "2009-09-22T18:46:05Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "A bit more information on how we used the junit sampler.\n\nOur test cases were mainly for IBM Ascential's MetaData Server. The goal was to load the database with x records using a predefined object graph and ETL data in XML format.\n\nThe setup would load that data using our persistence API and then start to run the stress test. One of the stress tests measured performance degradation as the database size increases, so we needed to keep state.\n\nIf the sampler creates a new instance of the class, we loose state. To get around that, the custom runner was needed. A compromise would be to add a checkbox to create a new instance with each call. This way, the user has the option of using the same instance or creating a new instance.\n\nhope that info is useful.\n\npeter", "is_private": false, "id": 130595, "creator": "woolfel@yahoo.com", "time": "2009-09-22T18:55:37Z", "bug_id": 47888, "creation_time": "2009-09-22T18:55:37Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 47888, "attachment_id": 27536, "is_private": false, "id": 149502, "time": "2011-09-19T19:58:16Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-09-19T19:58:16Z", "text": "Created attachment 27536\nFix to the issue\n\nHello,\nI implemented the solution described by Peter Lin:\n- A checkbox\n- Recreate new instance at start of each loop\n\nI will attach the JAR that contains a JUnit 3 and JUnit test cases.\n\nRegards\nPhilippe Mouawad"}, {"count": 5, "attachment_id": 27537, "bug_id": 47888, "is_private": false, "id": 149503, "time": "2011-09-19T19:58:54Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-09-19T19:58:54Z", "tags": [], "text": "Created attachment 27537\nTest Plan\n\nThe Test plan"}, {"count": 6, "tags": [], "text": "Created attachment 27538\nTest JAR\n\nClass filter:\ncom.ubikingenierie.jmeter.bug47888", "attachment_id": 27538, "id": 149504, "creator": "p.mouawad@ubik-ingenierie.com", "time": "2011-09-19T20:00:04Z", "bug_id": 47888, "creation_time": "2011-09-19T20:00:04Z", "is_private": false}, {"count": 7, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "text": "Created attachment 27540\nFix to the issue\n\nHello,\nI had missed in my previous fix the initialization of :\n- testCase in JUnit 3\n- protectable in both\n\n\nRegards\nPhilippe", "id": 149513, "time": "2011-09-20T07:04:02Z", "bug_id": 47888, "creation_time": "2011-09-20T07:04:02Z", "attachment_id": 27540}, {"count": 8, "attachment_id": null, "bug_id": 47888, "is_private": false, "id": 149561, "time": "2011-09-21T01:59:52Z", "creator": "sebb@apache.org", "creation_time": "2011-09-21T01:59:52Z", "tags": [], "text": "Thanks for the patch; looks OK, except the setProperty/getProperty method calls should provide the default value false.\n\nAnd ideally there should be a patch for component_reference as well.\n\nHowever I'm not sure you have implemented quite what was intended, which was to optionally recreate the test object for each sample, not each iteration.\n\nI'm not sure if there is a use case for resetting every iteration.\n\nHowever, if the option is taken to mean \"create new test object for this sample\", one could apply that to the first sample (only) in a loop and achieve the same result."}, {"count": 9, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "text": "Created attachment 27551\nFix to the issue\n\nHello Sebb,\nThanks for your review.\nYou are right I didn't implement exactly what was described.\nSo I changed to match the issue description and took into account your 2 others notes.\n\nRegards\nPhilippe Mouawad", "id": 149575, "time": "2011-09-21T11:20:05Z", "bug_id": 47888, "creation_time": "2011-09-21T11:20:05Z", "attachment_id": 27551}, {"count": 10, "tags": [], "text": "Thanks, much better.\n\nI made some minor changes, and updated the screenshot:\n\nURL: http://svn.apache.org/viewvc?rev=1173581&view=rev\nLog:\nBug 47888 - JUnit Sampler re-uses test object\n\nModified:\n   jakarta/jmeter/trunk/docs/images/screenshots/junit_sampler.png\n   jakarta/jmeter/trunk/src/core/org/apache/jmeter/resources/messages.properties\n   jakarta/jmeter/trunk/src/core/org/apache/jmeter/resources/messages_fr.properties\n   jakarta/jmeter/trunk/src/junit/org/apache/jmeter/protocol/java/control/gui/JUnitTestSamplerGui.java\n   jakarta/jmeter/trunk/src/junit/org/apache/jmeter/protocol/java/sampler/JUnitSampler.java\n   jakarta/jmeter/trunk/xdocs/changes.xml\n   jakarta/jmeter/trunk/xdocs/images/screenshots/junit_sampler.png\n   jakarta/jmeter/trunk/xdocs/usermanual/component_reference.xml\n\nI'm not sure if the word \"sample\" is a suitable French translation of the English \"sample\"; elsewhere the property file seems to use \u00e9chantillon - would that be better here?", "attachment_id": null, "id": 149581, "creator": "sebb@apache.org", "time": "2011-09-21T12:09:27Z", "bug_id": 47888, "creation_time": "2011-09-21T12:09:27Z", "is_private": false}, {"count": 11, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "Hi,\nShame on me, I am french and I use english words :-)\nEchantillon is the right word.\n\nRegards\nPhilippe", "id": 149585, "time": "2011-09-21T12:22:13Z", "bug_id": 47888, "creation_time": "2011-09-21T12:22:13Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 37184, "text": "Multiple calls of a macro causes performance loss in subsequent processing.\n\nFor example:\n\n<project name=\"macrodeftestcase\" basedir=\".\" default=\"testcase\">\n\n   <taskdef resource=\"net/sf/antcontrib/antcontrib.properties\"/>\n\n   <property name=\"zipfile\" value=\"testcase_iskv_200510191307_b.zip\"/>\n\n   <macrodef name=\"echotest\">\n      <text name=\"text\"/>\n      <sequential>\n         <echo>@{text}</echo>\n      </sequential>\n   </macrodef>\n\n   <target name=\"testcase\" >\n\n      <stopwatch name=\"timer0\" action=\"start\"/>\n      <antcall target=\"zip_ant_home\"/>\n      <stopwatch name=\"timer0\" action=\"stop\"/>\n\n      <echotest>Hello world 0</echotest>\n      <echotest>Hello world 1</echotest>\n      <echotest>Hello world 2</echotest>\n      <echotest>Hello world 3</echotest>\n      <echotest>Hello world 4</echotest>\n\n      .......\n\n      <echotest>Hello world 2999</echotest>\n      <echotest>Hello world 3000</echotest>\n\n      <stopwatch name=\"timer1\" action=\"start\"/>\n      <antcall target=\"zip_ant_home\"/>\n      <stopwatch name=\"timer1\" action=\"stop\"/>\n\n      <stopwatch name=\"timer0\" action=\"total\"/>\n      <stopwatch name=\"timer1\" action=\"total\"/>   \n\n   </target>\n\n   <target name=\"zip_ant_home\">\n\n      <delete file=\"${zipfile}\"/>\n      <zip destfile=\"${zipfile}\" basedir=\"${ant.home}\"/>\n\n   </target>\n\n</project>\n\nResult of target \"testcase\" could be:\n\nD:\\macrodeftestcase>ant -cp ant-contrib.jar\nBuildfile: build.xml\n\ntestcase:\n\nzip_ant_home:\n   [delete] Deleting: D:\\macrodeftestcase\\testcase_iskv_200510191307_b.zip\n      [zip] Building zip: D:\\macrodeftestcase\\testcase_iskv_200510191307_b.zip\n     [echo] Hello world 0\n     [echo] Hello world 1\n     [echo] Hello world 2\n     [echo] Hello world 3\n     [echo] Hello world 4\n     [echo] Hello world 5\n     [echo] Hello world 6\n     [echo] Hello world 7\n\n     ...........\n\n     [echo] Hello world 2998\n     [echo] Hello world 2999\n     [echo] Hello world 3000\n\nzip_ant_home:\n   [delete] Deleting: D:\\macrodeftestcase\\testcase_iskv_200510191307_b.zip\n      [zip] Building zip: D:\\macrodeftestcase\\testcase_iskv_200510191307_b.zip\n[stopwatch] [timer0: 6.312 sec]\n[stopwatch] [timer1: 10.609 sec]\n\nBUILD SUCCESSFUL\n\nFor more complex macros (e.g. with an for-task, which uses macrodef internally)\nsignificant performance loss can occur after a very much smaller number of \nmacro calls.", "id": 81471, "attachment_id": null, "creator": "frank.harnack@bitmarck.de", "creation_time": "2005-10-20T17:36:28Z", "time": "2005-10-20T17:36:28Z", "is_private": false}, {"count": 1, "tags": [], "creator": "frank.harnack@bitmarck.de", "attachment_id": 16769, "text": "Created attachment 16769\nbuild.xml with the example project \"macrodeftestcase\"", "id": 81496, "time": "2005-10-21T08:37:50Z", "bug_id": 37184, "creation_time": "2005-10-21T08:37:50Z", "is_private": false}, {"text": "First results of debugging:\nThe performance loss seems to occur in method fireMessageLoggedEvent of \norg.apache.tools.ant.Project. There is a suspicious accumulation of \nIntrospectionHelper-BuildListeners in the member variable listeners.\nBecause of this the while loop in fireMessageLoggedEvent have a lot of work to \ndo.\n", "tags": [], "bug_id": 37184, "is_private": false, "count": 2, "id": 81594, "time": "2005-10-24T08:20:56Z", "creator": "frank.harnack@bitmarck.de", "creation_time": "2005-10-24T08:20:56Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 37184, "is_private": false, "text": "Created attachment 16781\nPatch for Project.java (ant-1.6.5)\n\nThis patch for Project.java (ant-1.6.5) seems to solve the problem.", "id": 81600, "time": "2005-10-24T12:05:20Z", "creator": "frank.harnack@bitmarck.de", "creation_time": "2005-10-24T12:05:20Z", "attachment_id": 16781}, {"text": "fixed in CVS (twice!).  Thanks!", "tags": [], "bug_id": 37184, "is_private": false, "count": 4, "id": 81640, "time": "2005-10-24T17:31:37Z", "creator": "mbenson@apache.org", "creation_time": "2005-10-24T17:31:37Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 37184, "is_private": false, "id": 81645, "attachment_id": null, "creator": "peterreilly@apache.org", "creation_time": "2005-10-24T17:42:21Z", "time": "2005-10-24T17:42:21Z", "text": "Or svn ;)"}, {"count": 6, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "text": "I forgot to say thanks to Frank for finding this.\nI think that this issue could be the cause for some\nof grief and slowdown that people have reported\nwhen moving to 1.6.", "id": 81654, "time": "2005-10-24T18:57:03Z", "bug_id": 37184, "creation_time": "2005-10-24T18:57:03Z", "is_private": false}, {"count": 7, "tags": [], "creator": "mbenson@apache.org", "text": "yeah, svn. oops.  :)", "id": 81655, "attachment_id": null, "bug_id": 37184, "creation_time": "2005-10-24T19:02:57Z", "time": "2005-10-24T19:02:57Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 37184, "text": "Thanks for reviewing and optimising my patch. ", "id": 81768, "attachment_id": null, "creator": "frank.harnack@bitmarck.de", "creation_time": "2005-10-26T14:03:34Z", "time": "2005-10-26T14:03:34Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 37184, "text": "*** Bug 39119 has been marked as a duplicate of this bug. ***", "id": 87337, "attachment_id": null, "creator": "jkf@apache.org", "creation_time": "2006-03-27T22:14:44Z", "time": "2006-03-27T22:14:44Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 59648, "text": "We noticed this at first on a Windows 10 system running Ant 1.9.6 that is included with Eclipse Mars.2. \n\nWe have since broken this down to a very simple upload running the \"zip\" version of Ant 1.9.x on Windows 7, 8.1 and 10.\n\nIf we run our test script on using Ant 1.9.4 the scp upload works. If we run it with Ant 1.9.5 the scp upload actually suceeds but Ant says it BUILD FAILED.\n\nWe are using the latest jsch jar we can find at http://www.jcraft.com/jsch/:\n    jsch-0.1.53.jar\n\nI'm including a zip of the simple Project (2 files), the script I use to run the test with and the output for both 1.9.4 and 1.9.5", "id": 191340, "attachment_id": null, "creator": "rnmixon@custco.biz", "creation_time": "2016-06-01T04:18:03Z", "time": "2016-06-01T04:18:03Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59648, "attachment_id": 33907, "is_private": false, "id": 191366, "time": "2016-06-01T23:59:39Z", "creator": "rnmixon@custco.biz", "creation_time": "2016-06-01T23:59:39Z", "text": "Created attachment 33907\nExample project, script to run, output for 1.9.4 and 1.9.5\n\nThought I had uploaded this when I created the report, but I don't see it now. Also don't remember it asking me for the file type.\nI also had to remove the 1.9MB jar file from the project folder I was using as a test file to upload because of the bugzilla upload limit. But I have tried this with several different files - exe, jar, etc - the problem still occurs."}, {"count": 2, "attachment_id": null, "creator": "jaikiran@apache.org", "text": "Starting 1.9.5 of Ant the SCP task tries to set the permissions on the files/directories that get transferred to remote. See the documentation of fileMode and dirMode here[1].\n\nFrom looking at your log files that you attached, after the transfer is complete, Ant is trying to set permission on that file and failing with Permission Denied errors. I don't see a way to skip setting the permissions since if the user currently doesn't specify the fileMode/dirMode, default values are used by the task.\n\n\n[1] https://ant.apache.org/manual-1.9.x/Tasks/scp.html", "id": 198988, "time": "2017-05-31T11:14:46Z", "bug_id": 59648, "creation_time": "2017-05-31T11:14:46Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 59648, "is_private": false, "text": "I had a few spare minutes, so decided to take a look at this and this indeed appears to be a bug in this task. What's happening here, IMO, is the SCP task through this method[1] sends the \"localFile\" to \"remotePath\". The \"remotePath\" can be either a directory or a file and if it isn't explicitly specified, this code initializing it to a file matching the local file's name.\n\nOnce the transfer is complete, it then attempts to change the permissions on the remotePath[2]. The problem with this is that it assumes the remotePath is the single file it transferred. But that won't always be the case and in your case the remotePath is an explicitly specified directory on the remote server which already exists. As a result it incorrectly tries to change permissions on this remote directory and runs into permissions errors. \n\nThis, IMO, is a genuine bug in this part of the code.\n\n[1] https://github.com/apache/ant/blob/master/src/main/org/apache/tools/ant/taskdefs/optional/ssh/ScpToMessageBySftp.java#L224\n[2] https://github.com/apache/ant/blob/master/src/main/org/apache/tools/ant/taskdefs/optional/ssh/ScpToMessageBySftp.java#L250", "id": 199916, "time": "2017-07-21T08:31:48Z", "creator": "jaikiran@apache.org", "creation_time": "2017-07-21T08:31:48Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Thanks a lot Jaikiran, sounds like you've located the bug :-)\n\nDo you want to take a stab at fixing it yourself?", "attachment_id": null, "id": 199933, "creator": "bodewig@apache.org", "time": "2017-07-21T15:08:51Z", "bug_id": 59648, "creation_time": "2017-07-21T15:08:51Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 59648, "text": "I did in fact start looking at fixing this today :) Will update this bugzilla once I have something to show.", "id": 199935, "time": "2017-07-21T16:23:10Z", "creator": "jaikiran@apache.org", "creation_time": "2017-07-21T16:23:10Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "sounds great, thank you", "attachment_id": null, "id": 199937, "creator": "bodewig@apache.org", "time": "2017-07-21T17:44:28Z", "bug_id": 59648, "creation_time": "2017-07-21T17:44:28Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 59648, "is_private": false, "text": "I just submitted a pull request with a potential fix for review, here https://github.com/apache/ant/pull/35", "id": 199943, "time": "2017-07-22T09:13:07Z", "creator": "jaikiran@apache.org", "creation_time": "2017-07-22T09:13:07Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "jaikiran@apache.org", "text": "This has now been fixed[1] in the 1.9.x and master branches upstream.\n\n[1] https://github.com/apache/ant/commit/b9125733c49256ea7349bba968d9eabd468a9223\n\nP.S: I would have marked this issue resolved myself, but I am not too familiar with Bugzilla workflow and I don't see 1.9.10 in the \"Target milestone\" list to resolve it against that version.", "id": 199953, "time": "2017-07-23T05:06:33Z", "bug_id": 59648, "creation_time": "2017-07-23T05:06:33Z", "is_private": false, "attachment_id": null}, {"count": 9, "attachment_id": null, "creator": "jaikiran@apache.org", "text": ">> I don't see 1.9.10 in the \"Target milestone\"\n\nNever mind, I didn't look correctly and got fooled by the ordering. It's present in that drop down.\n\nMarking this issue resolved.", "id": 199954, "time": "2017-07-23T05:11:15Z", "bug_id": 59648, "creation_time": "2017-07-23T05:11:15Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 47498, "text": "Created attachment 23942\ndiff -r -u poi-3.5-beta6 poi-edit\n\nHi,\n\nWhile testing POI's hyperlink functionality, I noticed that URL Hyperlinks are parsed incorrectly at the Record level. They are truncated by 11 characters from the right (12 characters if we count the null termination).\nReproducibility: 100%\n\n\nFIX:\nA quick look at HyperlinkRecord reveals the problem:\n\nin \npublic HyperlinkRecord(RecordInputStream)\n[...]\nif ((_linkOpts & HLINK_TARGET_FRAME) != 0) { \n  int nChars = fieldSize/2;\n  _address = in.readUnicodeLEString(nChars);\n} else {\n  int nChars = (fieldSize - TAIL_SIZE)/2;\n  _address = in.readUnicodeLEString(nChars);\n  _uninterpretedTail = readTail(URL_TAIL, in);\n}\n[...]\n\n\nShould be (as far as my understanding goes):\n\nif ((_linkOpts & HLINK_TARGET_FRAME) == 0) {\n  int nChars = fieldSize/2;\n  _address = in.readUnicodeLEString(nChars);\n} else {\n  int nChars = (fieldSize - TAIL_SIZE)/2;\n  _address = in.readUnicodeLEString(nChars);\n  _uninterpretedTail = readTail(URL_TAIL, in);\n}\n\n\nI've attached a patch against 3.5-beta6.", "id": 128640, "time": "2009-07-08T07:33:11Z", "creator": "ibrahim.damlaj@mail.mcgill.ca", "creation_time": "2009-07-08T07:33:11Z", "is_private": false, "attachment_id": 23942}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "is_private": false, "id": 128641, "attachment_id": null, "bug_id": 47498, "creation_time": "2009-07-08T07:35:46Z", "time": "2009-07-08T07:35:46Z", "text": "Any chance you could upload a file that has a truncated hyperlink, so we've got something to use for a unit test?"}, {"count": 2, "tags": [], "bug_id": 47498, "is_private": false, "id": 128642, "creation_time": "2009-07-08T07:56:28Z", "time": "2009-07-08T07:56:28Z", "creator": "ibrahim.damlaj@mail.mcgill.ca", "text": "Created attachment 23943\nTest file", "attachment_id": 23943}, {"count": 3, "tags": [], "bug_id": 47498, "is_private": false, "id": 128643, "attachment_id": null, "creator": "ibrahim.damlaj@mail.mcgill.ca", "creation_time": "2009-07-08T08:05:44Z", "time": "2009-07-08T08:05:44Z", "text": "Hey Nick,\n\nThanks for the quick reply.\nI've attached the test file you requested.\n\n\nBest Regards,\nIbrahim"}, {"count": 4, "tags": [], "bug_id": 47498, "text": "Fixed in r793281. The problem was indeed in HyperlinkRecord although the fix is a bit more complicated than you suggested. HyperlinkRecord didn't properly handle all kinds of link options depending on which a 24-byte record tail may appear or not. This unexpected 24-byte tail resulted in truncation by 11 characters.\n\nRegards,\nYegor", "id": 128760, "time": "2009-07-12T00:29:20Z", "creator": "yegor@dinom.ru", "creation_time": "2009-07-12T00:29:20Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 40245, "text": "XML security version 1.4 Beta0 and Beta1 don't sign the XML document correctly.\n\nTwo tests failed:\n\nTEST 1: The XML document is already signed (with XML security version 1.2) and \nit is verified with the version 1.4 (beta0 and beta1).This test failed using \nversion 1.4 but was ok with precedent versions.\n\nTEST 2: The XML document is signed with XML security V1.4Beta1 and is verified \nwith IBM XSS4J toolkit.This test failed using version 1.4Beta1 but was ok with \nprecedent versions.\n\nDoing some investigations, it seems that the problem is due to a bug into \nxpath2 filter that has been rewritten in the version 1.4. \n\nAs you can see I am signing (see bellow) one part of the XML document and two \nexternal binary documents. The problem seems to come from the first Reference \n(<ds:Reference URI=\"\">). The digest value doesn't match after signature \nverification. The digest values of the two external references matches.\n\n<edoc:SignatureBlock id=\"Revision-1-Signature-1\">\n   <edoc:SignatureDate>2006-08-07T12:24:18</edoc:SignatureDate>\n   <edoc:Signer>Hess Yvan (first signature)</edoc:Signer>\n   <ds:Signature xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n      <ds:SignedInfo>\n         <ds:CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-\nxml-c14n-20010315\"/>\n         <ds:SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-\nsha1\"/>\n         <ds:Reference URI=\"\">\n            <ds:Transforms>\n               <ds:Transform Algorithm=\"http://www.w3.org/2002/06/xmldsig-\nfilter2\">\n                  <dsig-xpath:XPath xmlns:dsig-\nxpath=\"http://www.w3.org/2002/06/xmldsig-filter2\" \nFilter=\"intersect\">/edoc:EDOC/edoc:Object</dsig-xpath:XPath>\n               </ds:Transform>\n            </ds:Transforms>\n            <ds:DigestMethod \nAlgorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/>\n            <ds:DigestValue>2jmj7l5rSw0yVb/vlWAYkK/YBwk=</ds:DigestValue>\n         </ds:Reference>\n         <ds:Reference URI=\"urn:hypersuite:8F1F8E64-C0A8024E0160C4B0-A0033464\">\n            <ds:DigestMethod \nAlgorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/>\n            <ds:DigestValue>7typFfsZFzJVtEsGinu58N8RtqE=</ds:DigestValue>\n         </ds:Reference>\n         <ds:Reference URI=\"urn:hypersuite:8F1F8E64-C0A8024E0160C4B0-A0033465\">\n            <ds:DigestMethod \nAlgorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/>\n            <ds:DigestValue>oxwjv1Go+8Y0m97hiJLTKcYx4t8=</ds:DigestValue>\n         </ds:Reference>\n      </ds:SignedInfo>\n      <ds:SignatureValue>\n          \nRYaOiVt2gDIFmFDFotJrxGWHFYFe3dAoI1L2vubdlbBZt3pk4aaolBz6NA9IswW9ZOwPGYizLB4PvMa\n8f4sHx8onoVt+5BGQwLuTYRDgGrJqmwpbwJxUAPvFh1xgED\n          \nGodfZ4P7kmjsvMa8f4sHx8onoVt+govMa8f4sHx8onoVt+4fvMa8f4sHx8onoVt+jDvMa8f4sHx8ono\nVt+ULvMa8f4sHx8onoVt+dk9ZhwvIN/+eBfirtyCcbTb1w=\n      </ds:SignatureValue>\n      <ds:KeyInfo>\n        <ds:X509Data>\n           \n<ds:X509Certificate>MIIDADCCAmmgAwIBAgIGAQpEtx7tMA0GCSqGSIb3DQEBBQUAMIGXMRQwEgY\nDVQQG.....</ds:X509Certificate>\n           \n<ds:X509Certificate>MIICpDCCAg0CBgEKRLVqKDANBgkqhkiG9w0BAQUFADCBlzEUMBIGA1UEBhM\nLU3dpdHplcmxhbmQx....</ds:X509Certificate>\n        </ds:X509Data>\n      </ds:KeyInfo>\n   </ds:Signature>\n</edoc:SignatureBlock>", "id": 92183, "time": "2006-08-14T08:03:11Z", "creator": "yvan.hess@imtf.ch", "creation_time": "2006-08-14T08:03:11Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "yvan.hess@imtf.ch", "attachment_id": 18714, "text": "Created attachment 18714\nXML document failing with 1.4, but not with V1.3 and IBM XSS4J toolkit\n\nXML document failing with XML security V1.4 Beta0 and Beta1, but not with V1.3\nand IBM XSS4J toolkit. The verification of this signature with V1.4 must be ok.", "id": 92185, "time": "2006-08-14T08:08:44Z", "bug_id": 40245, "creation_time": "2006-08-14T08:08:44Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 40245, "text": "Fixed in SVN head.\nThe problem is that one of the optimization that tells the c14n to prune all the\nsubnodes does not take into account if there is intersect nodes the prune is not Ok.\n\nTODO: Right now just don't prune if there is any intersect node. Much better\nprune if we are inside a substract node and no union nodes is present.\n\nThanks for the report", "id": 92193, "time": "2006-08-14T12:00:03Z", "creator": "raul-info@r-bg.com", "creation_time": "2006-08-14T12:00:03Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "sean.mullan@oracle.com", "attachment_id": null, "id": 108390, "time": "2007-09-19T12:13:19Z", "bug_id": 40245, "creation_time": "2007-09-19T12:13:19Z", "is_private": false, "text": "Closing old bugs. This one was fixed in 1.4.1."}]
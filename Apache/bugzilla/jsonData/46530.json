[{"count": 0, "tags": [], "bug_id": 46530, "attachment_id": null, "text": "We are having an issue with Apache HTTPD version 2.2.10 (including latest v11), and a third party cgi-bin binary for uploading files.  The binary is precompiled for Solaris OS and we do not have a way to change it. Prior versions of HTTPD (such as 2.2.9) worked just fine with this binary.  The binary is called \u201ccp_upload.exe\u201d.\n\nWe execute the binary using a POST submit using multipart form.  With version 2.2.10+ the following error occurs:\n\nERROR:\nUsage: cp_upload  \u2013a  configure\n\nUsing Fiddler, we captured the response of the form POST and it\u2019s below.   Nothing seems out of the ordinary. Based on this output from Fiddler data, we suspect the problem is somewhere between HTTPD and the cgi binary, but we don't know how to debug this. We may be missing something here.  Any help is greatly appreciated.\n\nPOST /cgi-bin/cp_upload.exe HTTP/1.1\nAccept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/x-ms-application, application/vnd.ms-xpsdocument, application/xaml+xml, application/x-ms-xbap, application/x-shockwave-flash, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, application/x-silverlight, application/x-silverlight-2-b2, */*\nReferer: http://idbvap09.tais.net/cgi-bin/lukhondev2/channel/rmaEntry.jsp\nAccept-Language: en-us\nContent-Type: multipart/form-data; boundary=---------------------------7d820d16f0b1e\nUA-CPU: x86\nAccept-Encoding: gzip, deflate\nUser-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506; Tablet PC 2.0; InfoPath.2; .NET CLR 1.1.4322)\nProxy-Connection: Keep-Alive\nContent-Length: 18246\nHost: idbvap09.tais.net\nPragma: no-cache\nCookie: __utma=65947179.326698554.1207608324.1220484260.1220484305.21; __utmz=65947179.1216366188.12.4.utmccn=(referral)|utmcsr=idbvap09.tais.net|utmcct=/cgi-bin/dev2/b2c/home.to|utmcmd=referral; __utma=123205331.338557692.1217432675.1227726498.1228255254.41; __utmz=123205331.1217432675.1.1.utmccn=(direct)|utmcsr=(direct)|utmcmd=(none)\n \n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"event\"\n \nfileupload\n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"sortby\"\n \n \n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"partToRemove\"\n \n \n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"rma\"\n \n \n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"nextPage\"\n \nhttp://idbvap09.tais.net/cgi-bin/lukhondev2/channel/rmaEntry.jsp\n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"app_name\"\n \nlukhondev2\n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"relative_dir\"\n \npr/rmafileupload\n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"upload_option\"\n \nrename_file\n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"ProcessChoice\"\n \nFileUpload\n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"ThisPage\"\n \nchannel/rmaEntry.jsp\n-----------------------------7d820d16f0b1e\nContent-Disposition: form-data; name=\"FileName\"; filename=\"C:\\Users\\Lu-Khon\\Desktop\\lktest.xls\"\nContent-Type: application/vnd.ms-excel", "id": 124038, "time": "2009-01-14T10:01:38Z", "creator": "rudy.amid@tais.toshiba.com", "creation_time": "2009-01-14T10:01:38Z", "is_private": false}, {"count": 1, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "text": "Please use a user support forum such as the users mailinglist for help questions.\n\nWhen you do, be sure to tell us what changed when you updated apache.  Did you run exactly the same build (e.g. using the old config.nice) and overlay it on the old one, or did you install it somewhere new?  And what happens when you run your program under a simulator such as cg-eye offline?", "id": 124064, "time": "2009-01-14T17:41:29Z", "bug_id": 46530, "creation_time": "2009-01-14T17:41:29Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 46530, "attachment_id": null, "text": "Since you get the usage message of your cgi I'm wildly guessing it could be BZ 46380. Are you using the worker MPM? 46380 does not occur with prefork.\n\nYou can apply the patch\n\nhttp://svn.apache.org/viewvc?view=rev&revision=726636\n\nand report back, whether it helps, so that we add it to the backport list.", "id": 124079, "time": "2009-01-15T01:03:24Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2009-01-15T01:03:24Z", "is_private": false}, {"count": 3, "text": "(In reply to comment #2)\n> Since you get the usage message of your cgi I'm wildly guessing it could be BZ\n> 46380. Are you using the worker MPM? 46380 does not occur with prefork.\n> \n> You can apply the patch\n> \n> http://svn.apache.org/viewvc?view=rev&revision=726636\n> \n> and report back, whether it helps, so that we add it to the backport list.\n> \n\nWe are using MPM.  I will try it with prefork and report what happens.\n\nWe did suspect it might be mod_cgid when we saw this 2.2.10 revision notes:\n\n  *) mod_cgid: Pass along empty command line arguments from an ISINDEX\n     query that has consecutive '+' characters in the QUERY_STRING,\n     matching the behavior of mod_cgi.\n     [Eric Covener]\n\nI got the patch, as you suggested, from: http://svn.apache.org/viewvc/httpd/httpd/trunk/modules/generators/mod_cgid.c?view=markup&pathrev=726636\n\nBut compiling it with 2.2.11 I get the following error below.\n\nmod_cgid.c: In function `get_req':\nmod_cgid.c:350: error: `core_request_config' undeclared (first use in this function)\nmod_cgid.c:350: error: (Each undeclared identifier is reported only once\nmod_cgid.c:350: error: for each function it appears in.)\nmod_cgid.c:350: error: `temp_core' undeclared (first use in this function)\nmod_cgid.c:368: error: `DYNAMIC_MODULE_LIMIT' undeclared (first use in this function)\nmod_cgid.c:370: error: parse error before ')' token\nmod_cgid.c: In function `send_req':\nmod_cgid.c:462: error: `core_module' undeclared (first use in this function)\nmod_cgid.c: In function `cgid_server':\nmod_cgid.c:625: error: `ap_unixd_config' undeclared (first use in this function)\nmod_cgid.c: In function `cgid_init':\nmod_cgid.c:877: error: `ap_preloaded_modules' undeclared (first use in this function)\nmake[3]: *** [mod_cgid.lo] Error 1\nmake[3]: Leaving directory `/apps/home/ramid/src/httpd-2.2.11/modules/generators'\nmake[2]: *** [all-recursive] Error 1\nmake[2]: Leaving directory `/apps/home/ramid/src/httpd-2.2.11/modules/generators'\nmake[1]: *** [all-recursive] Error 1\nmake[1]: Leaving directory `/apps/home/ramid/src/httpd-2.2.11/modules'\nmake: *** [all-recursive] Error 1\n", "bug_id": 46530, "is_private": false, "id": 124098, "time": "2009-01-15T10:01:44Z", "creator": "rudy.amid@tais.toshiba.com", "creation_time": "2009-01-15T10:01:44Z", "tags": [], "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 46530, "attachment_id": null, "id": 124099, "time": "2009-01-15T10:56:42Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2009-01-15T10:56:42Z", "is_private": false, "text": "(In reply to comment #3)\n> (In reply to comment #2)\n> We are using MPM.  I will try it with prefork and report what happens.\n\nYou meant \"We are using the worker MPM\" ?\n\n> I got the patch, as you suggested, from:\n> http://svn.apache.org/viewvc/httpd/httpd/trunk/modules/generators/mod_cgid.c?view=markup&pathrev=726636\n> \n> But compiling it with 2.2.11 I get the following error below.\n> ...\n\nSorry, you misunderstood my link\n\nhttp://svn.apache.org/viewvc?view=rev&revision=726636\n\nYou can not simply copy the f8ull mod_cgid from trunk to version 2.2. What you can do is using the link to the changes (link below \"text changed\"), which is\n\nhttp://svn.apache.org/viewvc/httpd/httpd/trunk/modules/generators/mod_cgid.c?r1=726636&r2=726635&pathrev=726636\n\nThere you can see, that the fix is a simple one line change:\n\n--- httpd/httpd/trunk/modules/generators/mod_cgid.c\t2008/12/15 07:40:57\t726635\n+++ httpd/httpd/trunk/modules/generators/mod_cgid.c\t2008/12/15 07:47:30\t726636\n@@ -201,7 +201,7 @@\n     char *w;\n     int idx = 0;\n \n-    if (ap_strchr_c(args, '=')) {\n+    if (!(*args) || ap_strchr_c(args, '=')) {\n         numwords = 0;\n     }\n     else {\n\n\nyou can apply to your version of 2.2.11. I checked 2.2.11, the same line that was changed in trunk is there in 2.2.11 as well. In 2.2.11 it is line number 206 instead of line number 204.\n\nRegards,\n\nRainer\n"}, {"count": 5, "tags": [], "bug_id": 46530, "attachment_id": null, "text": "Thank you, Rainer.  The mod_cgid.c fix works for us and we've confirmed it in several regression tests.", "id": 124298, "time": "2009-01-22T10:04:24Z", "creator": "rudy.amid@tais.toshiba.com", "creation_time": "2009-01-22T10:04:24Z", "is_private": false}, {"count": 6, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of bug 46380 ***", "id": 124300, "time": "2009-01-22T13:10:30Z", "bug_id": 46530, "creation_time": "2009-01-22T13:10:30Z", "is_private": false}]
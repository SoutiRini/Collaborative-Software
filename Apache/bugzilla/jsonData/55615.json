[{"count": 0, "tags": [], "bug_id": 55615, "text": "When a large number of concurrent requests are made to a FastCGI process which exceeds the number defined in FcgidMaxProcessesPerClass, connections become starved.\n\nFrom reviewing the source code, In fcgid_spawn_ctl.c when this condition happens, the following piece of code is executed.\n\n/*\n * Process count of this class higher than up limit?\n */\nif (current_node->process_counter >= current_node->max_class_process_count) {\n    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, main_server,\n                 \"mod_fcgid: too many %s processes (current:%d, max:%d), skip the spawn request\",\n                  command->cgipath, current_node->process_counter,\n                  current_node->max_class_process_count);\n     return 0;\n}\n\nFor example, if I have a FastCGI application which returns a 1MB buffer called buffer.exe.  I have configured FcgidMaxProcessesPerClass to 4, and now I launch 64 concurrent requests to buffer.exe which are looping.  The result is that some threads obtain the the buffer while others are simply staved.\n\nThe expected result is that I would want these 64 concurrent requests to equally be slow at obtaining the result rather then a few connections getting the result while others are staved.", "id": 170365, "time": "2013-09-30T23:09:23Z", "creator": "scottpakula@gmail.com", "creation_time": "2013-09-30T23:09:23Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 55615, "text": "To produce the buffer.exe application, I'm compiling using libfcgi located here:\nhttp://www.fastcgi.com/dist/fcgi-2.4.1-SNAP-0910052249.tar.gz\n\nHere's an example of what buffer.exe would look like.\n\n#include \"fcgi_stdio.h\"\n#include <stdlib.h>\n\nvoid main(void)\n{\n  FCGI_init();\n\n/* Response loop. */\n  while (FCGI_Accept() >= 0)   {\n    char         *buf = NULL;\n    unsigned int  bufsz = 1024*1024;\n\n    printf(\"Content-type: text/html\\r\\n\\r\\n\"\n    buf = malloc(bufsz);\n    FCGI_fwrite(buf, bufsz, 1, stdout);   \n    free(buf);\n  }\n}", "id": 170366, "time": "2013-09-30T23:28:12Z", "creator": "scottpakula@gmail.com", "creation_time": "2013-09-30T23:28:12Z", "tags": [], "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 55615, "is_private": false, "id": 170371, "time": "2013-10-01T13:48:40Z", "creator": "scottpakula@gmail.com", "creation_time": "2013-10-01T13:48:40Z", "tags": [], "text": "In addition, I am running Apache on the Windows platform.  The build is Windows 32-bit compiled under Visual Studio 2010.  Apache 2.4.6."}]
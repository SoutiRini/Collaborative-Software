[{"count": 0, "text": "When using a host header together with basic authentication in HC4, the authorization context gets set based on the url in jmeter, while HC4 seems to expect the authorization context to be set based on the host header.\n\nAs a result we can't use basic authentication with a custom host header in HC4 at the moment.\n\nJava implementation works.", "creator": "felix.schumacher@internetallee.de", "is_private": false, "id": 189435, "time": "2016-03-13T13:43:01Z", "bug_id": 59174, "creation_time": "2016-03-13T13:43:01Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "text": "Hello Felix,\nAfter fixing Bug 57242, I looked at this one and I am not sure to understand.\nCould you provide a test case showing the problem and how it should work ?\n\nThanks", "id": 196532, "time": "2017-01-28T20:23:24Z", "bug_id": 59174, "creation_time": "2017-01-28T20:23:24Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "felix.schumacher@internetallee.de", "attachment_id": 34691, "is_private": false, "id": 196535, "time": "2017-01-28T21:32:47Z", "bug_id": 59174, "creation_time": "2017-01-28T21:32:47Z", "text": "Created attachment 34691\nTest case demonstrating the behaviour with 3.1\n\nTest against the tomcat manager app which runs on localhost. But as this is a test case to demonstrate the usage of a host header, it is thought of running on example.com.\n\nWhat I think is the expected behaviour:\n Authorization manager should be asked for credentials of \"example.com\"\nIt is asking for \"localhost\"\n\nJava client is working with 3.1 (it is asking for localhost, though)\nHttpClient 4.x is not working (neither asking for localhost nor example.com)\n\n(This whole business of specifying a host header by hand to simulate virtual hosts seems wrong. We should be looking at giving a dns resolver, that resolves \"example.com\" to localhost (don't know how to change the port))"}, {"count": 3, "tags": [], "bug_id": 59174, "attachment_id": null, "id": 196536, "time": "2017-01-28T22:03:02Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-01-28T22:03:02Z", "is_private": false, "text": "(In reply to Felix Schumacher from comment #2)\n> Created attachment 34691 [details]\n> Test case demonstrating the behaviour with 3.1\n\nThanks\n> \n> Test against the tomcat manager app which runs on localhost. But as this is\n> a test case to demonstrate the usage of a host header, it is thought of\n> running on example.com.\n> \n> What I think is the expected behaviour:\n>  Authorization manager should be asked for credentials of \"example.com\"\n> It is asking for \"localhost\"\n> \n> Java client is working with 3.1 (it is asking for localhost, though)\n> HttpClient 4.x is not working (neither asking for localhost nor example.com)\n> \n> (This whole business of specifying a host header by hand to simulate virtual\n> hosts seems wrong. We should be looking at giving a dns resolver, that\n> resolves \"example.com\" to localhost (don't know how to change the port))\n\nSo is this a real problem or is it due to the host hack ?\nDid you try with current build on jenkins ?\nThanks"}, {"count": 4, "tags": [], "bug_id": 59174, "attachment_id": null, "id": 196537, "time": "2017-01-28T22:20:58Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-01-28T22:20:58Z", "is_private": false, "text": "I downloaded Tomcat 8 and ran your test.\nFor me Java and Http4 fail.\nBut the difference is that Java headers are:\nConnection: keep-alive\nHost: example.com:80\n\nWhile  HC4:\nConnection: keep-alive\nHost: example.com:8080\nUser-Agent: Apache-HttpClient/4.5.3 (Java/1.8.0_112)\n\nIf I comment element Simulate virtual host, it works for HC4.\n \nWhat exactly is the bug for you in this case ? Is it that HC4  has port 8080 ?"}, {"count": 5, "tags": [], "text": "Current tree didn't work anymore (I had tested it, of course :). Problem for java client was a missing \"Basic \" on the authorization header, that got dropped while conversion to Base64 implementation.\n\nNow to the problem originally discussed here.\n\nThis problem was discussed on the mailing list, so it seems that at least for someone it was a real problem. The usual workaround is to set a host header manually. That works for java client, only.\n\nBut this setup has a few drawbacks.\n * It doesn't work for hc4.x (you seem to have found a way to partially support it)\n * One has to use a strange setup for authorization\n * It probably will not work with kereberos (because of the strange setup)\n * The header setup is complicated\n\nTherefore I think the way to go is to add a way to setup a fake dns resolver, so that one can use the desired hostname while speaking to the real server name.", "is_private": false, "id": 196541, "creator": "felix.schumacher@internetallee.de", "time": "2017-01-29T10:26:28Z", "bug_id": 59174, "creation_time": "2017-01-29T10:26:28Z", "attachment_id": null}, {"count": 6, "text": "(In reply to Felix Schumacher from comment #5)\n> Current tree didn't work anymore (I had tested it, of course :). Problem for\n> java client was a missing \"Basic \" on the authorization header, that got\n> dropped while conversion to Base64 implementation.\n> \nThanks for fixing it.\nMy bad\n> Now to the problem originally discussed here.\n> \n> This problem was discussed on the mailing list, so it seems that at least\n> for someone it was a real problem. The usual workaround is to set a host\n> header manually. That works for java client, only.\n> \n> But this setup has a few drawbacks.\n>  * It doesn't work for hc4.x (you seem to have found a way to partially\n> support it)\n>  * One has to use a strange setup for authorization\n>  * It probably will not work with kereberos (because of the strange setup)\n>  * The header setup is complicated\n> \n> Therefore I think the way to go is to add a way to setup a fake dns\n> resolver, so that one can use the desired hostname while speaking to the\n> real server name.\n\nI still don't get the use case.\nIs it when you're not on the target infrastructure and you need to simulate it ?\nLocalhost or another host mimicing example.org ?\n\nAnyway ok for your idea which will be useful in other areas.\n\nthanks", "bug_id": 59174, "attachment_id": null, "id": 196542, "time": "2017-01-29T10:39:08Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-01-29T10:39:08Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "felix.schumacher@internetallee.de", "is_private": false, "text": "(In reply to Philippe Mouawad from comment #6)\n> (In reply to Felix Schumacher from comment #5)\n\n> > Now to the problem originally discussed here.\n> > \n> > This problem was discussed on the mailing list, so it seems that at least\n> > for someone it was a real problem. The usual workaround is to set a host\n> > header manually. That works for java client, only.\n> > \n> > But this setup has a few drawbacks.\n> >  * It doesn't work for hc4.x (you seem to have found a way to partially\n> > support it)\n> >  * One has to use a strange setup for authorization\n> >  * It probably will not work with kereberos (because of the strange setup)\n> >  * The header setup is complicated\n> > \n> > Therefore I think the way to go is to add a way to setup a fake dns\n> > resolver, so that one can use the desired hostname while speaking to the\n> > real server name.\n> \n> I still don't get the use case.\n> Is it when you're not on the target infrastructure and you need to simulate\n> it ?\n> Localhost or another host mimicing example.org ?\n\nRight, that was the use case. Say, for example, you wanted to test, if your newly setup server works as expected, without exposing it to the public.\n\n> \n> Anyway ok for your idea which will be useful in other areas.\n> \n> thanks", "id": 196543, "time": "2017-01-29T10:43:16Z", "bug_id": 59174, "creation_time": "2017-01-29T10:43:16Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 59174, "attachment_id": 34693, "text": "Created attachment 34693\nAdd a table with static hosts to DNSCacheManager\n\nWith this patch it is possible to specify host to ip (address) translations, that will get resolved by a custom DNS Cache Manager.\n\nThis patch needs documentation, test cases and review.", "id": 196545, "time": "2017-01-29T14:36:29Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2017-01-29T14:36:29Z", "is_private": false}, {"count": 9, "attachment_id": null, "bug_id": 59174, "is_private": false, "id": 196548, "time": "2017-01-29T20:42:23Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-01-29T20:42:23Z", "tags": [], "text": "Hello,\n\nMaybe there should be in GUI a mode to enable one of the 2 modes no ?\nThis would avoid having to test if host is in static hosts list every time a host is resolved no ?\n\nI committed some changes to avoid NPE if init of resolver fails and added a new test methods to check as much cases as possible for current implementation.\n\nRegards"}, {"count": 10, "tags": [], "creator": "felix.schumacher@internetallee.de", "attachment_id": null, "is_private": false, "id": 196552, "time": "2017-01-30T07:13:29Z", "bug_id": 59174, "creation_time": "2017-01-30T07:13:29Z", "text": "(In reply to Philippe Mouawad from comment #9)\n> Hello,\n> \n> Maybe there should be in GUI a mode to enable one of the 2 modes no ?\n> This would avoid having to test if host is in static hosts list every time a\n> host is resolved no ?\n\nI think that both modes are balls at the same time. You might have a custom resolver, but still want to change one or two hosts to other addresses.\n\nAt the moment the lookup for static hosts is awkward, but we could include results in the global cache, if we clear it on every edit.\n\nThat way it should have no performance impact on the usual use case.\n\n> \n> I committed some changes to avoid NPE if init of resolver fails and added a\n> new test methods to check as much cases as possible for current\n> implementation.\n> \n> Regards"}, {"count": 11, "tags": [], "bug_id": 59174, "attachment_id": null, "is_private": false, "id": 196553, "time": "2017-01-30T07:33:28Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-01-30T07:33:28Z", "text": "(In reply to Felix Schumacher from comment #10)\n> (In reply to Philippe Mouawad from comment #9)\n> > Hello,\n> > \n> > Maybe there should be in GUI a mode to enable one of the 2 modes no ?\n> > This would avoid having to test if host is in static hosts list every time a\n> > host is resolved no ?\n> \n> I think that both modes are balls at the same time. You might have a custom\n> resolver, but still want to change one or two hosts to other addresses.\n> \n> At the moment the lookup for static hosts is awkward, but we could include\n> results in the global cache, if we clear it on every edit.\n> \n> That way it should have no performance impact on the usual use case.\n> \n\nSounds good to me.\n> > \n> > I committed some changes to avoid NPE if init of resolver fails and added a\n> > new test methods to check as much cases as possible for current\n> > implementation.\n> > \n> > Regards"}, {"count": 12, "tags": [], "creator": "felix.schumacher@internetallee.de", "attachment_id": null, "is_private": false, "id": 196935, "time": "2017-02-11T17:20:33Z", "bug_id": 59174, "creation_time": "2017-02-11T17:20:33Z", "text": "Date: Sat Feb 11 17:04:06 2017\nNew Revision: 1782622\n\nURL: http://svn.apache.org/viewvc?rev=1782622&view=rev\nLog:\nAdd a table of static hosts to the DNS Cache Manger. This resolves the problem,\nthat host header gets ignored when doing basic authentication in HC4.\n\nBugzilla Id: 59174\n\nAdded:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/StaticHost.java\nModified:\n    jmeter/trunk/bin/saveservice.properties\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages.properties\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages_fr.properties\n    jmeter/trunk/src/core/org/apache/jmeter/save/SaveService.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/DNSCacheManager.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/gui/DNSCachePanel.java\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/control/TestDNSCacheManager.java\n    jmeter/trunk/xdocs/changes.xml\n    jmeter/trunk/xdocs/images/screenshots/dns-cache-manager.png\n    jmeter/trunk/xdocs/usermanual/component_reference.xml"}, {"count": 13, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "text": "Hi Felix,\nMaybe in documentation you could add an example of configuration of Static Host table.\nIt is not that clear for me reading text:\nMapping of hostnames to a static host entry which will be resolved using the custom DNS resolver\n\nI understand ,that in first column you could have many hostnames and in second column 1 static host entry. \nWhile from test case, I suppose it's the countrary.\nMaybe an example could make it more clear and some explanation on what happens :\n- First look in static hosts\n- Then use DNS Servers", "id": 197128, "time": "2017-02-17T21:42:08Z", "bug_id": 59174, "creation_time": "2017-02-17T21:42:08Z", "attachment_id": null}, {"count": 14, "tags": [], "text": "Author: pmouawad\nDate: Fri Feb 17 21:41:16 2017\nNew Revision: 1783471\n\nURL: http://svn.apache.org/viewvc?rev=1783471&view=rev\nLog:\nBug 59174 - Host header gets ignored when doing basic authentication in HC4\nTranslate host\nBugzilla Id: 59174\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages.properties\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages_fr.properties\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/gui/DNSCachePanel.java", "attachment_id": null, "id": 197129, "creation_time": "2017-02-17T21:42:21Z", "time": "2017-02-17T21:42:21Z", "creator": "p.mouawad@ubik-ingenierie.com", "bug_id": 59174, "is_private": false}, {"count": 15, "tags": [], "text": "Date: Sat Feb 18 15:23:48 2017\nNew Revision: 1783565\n\nURL: http://svn.apache.org/viewvc?rev=1783565&view=rev\nLog:\nAdd more documentation on the usage of Static Host Table.\n\nBugzilla Id: 59174\n\nModified:\n    jmeter/trunk/xdocs/usermanual/component_reference.xml", "is_private": false, "id": 197139, "creator": "felix.schumacher@internetallee.de", "time": "2017-02-18T15:24:20Z", "bug_id": 59174, "creation_time": "2017-02-18T15:24:20Z", "attachment_id": null}]
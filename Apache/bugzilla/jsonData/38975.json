[{"count": 0, "text": "Until 5.5.9 it was possible to update a webapp via manager undeploy/deploy\nwithout interrupting user sessions.\nIt made a very smooth user experience possible with quick updates and high\navailability.\nThis is no more possible now with WAR-deployment.\n\nNow, a undeploy _always_ removes the work-directory for that context\nand SESSIONS.ser with it. A deploy/update does the same.\nI know that this behavior was introduced because outdated files in the\nwork-directory can cause problems with a changed application. And I know\nthat this kind of problems is not what we want.\n\nBut the bad thing is:\nIt cannot be turned off or otherwise be circumvented. \n\nConsider a nearly-productive web-application which is quite stable and only\nminor bugfixes have to be done. But the application is in use and a\nnumber of users are continously logged on and working.\nThese minor bug fixes are happening quite often and they _always_ compatible\nwith the serialized session state.\n\nI would like to request an enhancement the manager or the container itself to\ncontrol this behavior. What I suggest, is some kind of 'soft' re-deploy without\nremoving the session state.\n\nI discussed this on the users-list recently and \nthe problem seems to be not exactly trival. I know that the deletion of the work\ndirectory is not done in the manager but in the container. As a result, it's not\nso easy to manipulate the behavior.\n\nA good solution could be:\nManager has a new attribute 'update' to the deploy-task. Maybe we can \nuse this one, the initiate a soft re-deploy. \nStill better maybe an attribute 'keepSessions' to the undeploy-task. This one\nwould be clearly say what it does. And it could be 'false' by default to be sure.\n\nDevelopers who are more familiar with tomcat's interna may have much better\nsuggestions. Please let me know! I would appreciate to help implementing this.\n\nAll other please vote for this enhancement because we have lost a very nice \nfeature here.", "creator": "rm@moosauer.de", "attachment_id": null, "id": 86832, "time": "2006-03-15T08:44:15Z", "bug_id": 38975, "creation_time": "2006-03-15T08:44:15Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 86836, "time": "2006-03-15T09:17:07Z", "bug_id": 38975, "creation_time": "2006-03-15T09:17:07Z", "is_private": false, "text": "I prefer the current behavior in case of a full update of the web application,\nas it is much cleaner. If you want otherwise, you should try to take advantage\nof reload."}, {"count": 2, "tags": [], "bug_id": 38975, "is_private": false, "text": "Currently we have no reload strategy for remote ant war upload with save the sessions!\n\nThis is not very cool for minor changes that not effect the classes/sessions :-(", "id": 86837, "time": "2006-03-15T09:27:01Z", "creator": "pr@objektpark.de", "creation_time": "2006-03-15T09:27:01Z", "attachment_id": null}, {"count": 3, "text": "(In reply to comment #2)\n> Currently we have no reload strategy for remote ant war upload with save the\nsessions!\n> \n> This is not very cool for minor changes that not effect the classes/sessions :-(\n\nAnd then we'll have problems with the work directory artifacts not being\ncleared, etc.", "creator": "remm@apache.org", "is_private": false, "id": 86838, "time": "2006-03-15T09:34:47Z", "bug_id": 38975, "creation_time": "2006-03-15T09:34:47Z", "tags": [], "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "rm@moosauer.de", "is_private": false, "id": 86839, "time": "2006-03-15T09:37:10Z", "bug_id": 38975, "creation_time": "2006-03-15T09:37:10Z", "tags": [], "text": " \nI am perfecty on your side to let the current behavior be the default. I only \nrequest a feature which is equivalent to \"reload\" for war-deployment! \n \nPlease Remy, let this one stay for a few days, so we can discuss it.  \nI found the issue, which led to this modification: \nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=35819 \n \nYou know that reload ist not possible for WAR-deployment. \nPlease consider that this modification in 5.5.10 makes war-deployment \nnearly unusable for production systems. Is this desirable? \n \nAnd can you say how many users are taking advantage of this feature that was \navailable until 5.5.9? This feature was available for many years and now its \ngone. Please lets take this decision not by one person alone. \n \n "}, {"count": 5, "tags": [], "text": "And: Session state is not exaclty an artifact! ", "attachment_id": null, "bug_id": 38975, "id": 86840, "time": "2006-03-15T09:38:41Z", "creator": "rm@moosauer.de", "creation_time": "2006-03-15T09:38:41Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 38975, "attachment_id": null, "is_private": false, "id": 86841, "time": "2006-03-15T09:52:43Z", "creator": "pr@objektpark.de", "creation_time": "2006-03-15T09:52:43Z", "text": "Check this:\n\nUse a absolute filename for your session state:\n\n<Context>\n<Manager pathname=\"${catalina.base}/sessions/myapps/SESSIONS.ser\" />\n</Context>\n\nsee StandardManager.file().\n"}, {"count": 7, "tags": [], "text": "Peter: \nsounds great, but did not work at the first try. But will try again. \n \nIf it works I would suggest to add it to manager-documentation! \nDoes anyone have experience with this? \n ", "is_private": false, "bug_id": 38975, "id": 86842, "time": "2006-03-15T10:15:45Z", "creator": "rm@moosauer.de", "creation_time": "2006-03-15T10:15:45Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 38975, "attachment_id": null, "id": 86843, "time": "2006-03-15T10:43:09Z", "creator": "rm@moosauer.de", "creation_time": "2006-03-15T10:43:09Z", "is_private": false, "text": "Adding this to \"WEB-INF/context.xml\" in the WAR  \n  \n<Context>  \n<Manager pathname=\"${catalina.base}/sessions/myapps/SESSIONS.ser\" />  \n</Context>  \n  \nseems to have no effect. I set deployXML=\"true\" in the host-definition, but  \nthis should be the default anyway.  \n  \nIs this another bug or am I doing it wrong? "}, {"count": 9, "tags": [], "bug_id": 38975, "attachment_id": null, "id": 86844, "time": "2006-03-15T10:54:25Z", "creator": "rm@moosauer.de", "creation_time": "2006-03-15T10:54:25Z", "is_private": false, "text": "OK: it was META-INF/context.xml  \n \nI will try to contribute an addition to the manager-docs. My first time, hope \nI get it. "}, {"count": 10, "tags": [], "bug_id": 38975, "attachment_id": null, "is_private": false, "id": 86858, "time": "2006-03-15T14:48:46Z", "creator": "remm@apache.org", "creation_time": "2006-03-15T14:48:46Z", "text": "(In reply to comment #9)\n> OK: it was META-INF/context.xml  \n>  \n> I will try to contribute an addition to the manager-docs. My first time, hope \n> I get it. \n\nThere is some documentation here about pathname:\nhttp://tomcat.apache.org/tomcat-5.5-doc/config/manager.html\n\nNote that ${catalina.base} is not always absolute.\n"}, {"count": 11, "tags": [], "bug_id": 38975, "is_private": false, "id": 86860, "attachment_id": null, "creator": "rm@moosauer.de", "creation_time": "2006-03-15T15:07:01Z", "time": "2006-03-15T15:07:01Z", "text": "(In reply to comment #10) \n> There is some documentation here about pathname: \n> http://tomcat.apache.org/tomcat-5.5-doc/config/manager.html \n> \n \nYes, I read it. I am thinking of a cross-reference from Manager(deployment) to \nManager(Session). Besides the name it is not clear that one could affect the \nother. \n  \n> Note that ${catalina.base} is not always absolute. \n>  \n \nHuh, how can I learn? \n \n "}]
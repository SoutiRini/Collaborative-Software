[{"count": 0, "tags": [], "creator": "ksmster@gmail.com", "attachment_id": null, "text": "Between Tomcat 7.0.50 and Tomcat 7.0.52 changed logic of class loading which may prevent to protect against CVE-2014-0050\n\nMy usecase:\n1. I have \njcl-over-slf4j-1.7.5.jar\njul-to-slf4j.jar\nlog4j-over-slf4j-1.7.5.jar\nlogback-classic.jar\nlogback-core.jar\nslf4j-api.jar\nin Tomcat lib folder.\n\n2. With help of setenv.sh I've add this jars to classpath\n  export CLASSPATH=\"${CATALINA_HOME}/conf/:${CATALINA_HOME}/lib/jul-to-slf4j.jar:${CATALINA_HOME}/lib/slf4j-api.jar:${CATALINA_HOME}/lib/logback-classic.jar:${CATALINA_HOME}/lib/logback-core.jar:${CATALINA_HOME}/lib/mail.jar:${JAVA_HOME}/lib/tools.jar\"\n\n3. After update to tomcat 7.0.52 I've got \n\nCaused by: java.lang.LinkageError: loader constraint violation: when resolving method \"org.slf4j.impl.StaticLoggerBinder.getLoggerFactory()Lorg/slf4j/ILoggerFactory;\" the class loader (instance of org/apache/catalina/loader/WebappClassLoader) of the current class, org/slf4j/LoggerFactory, and the class loader (instance of sun/misc/Launcher$AppClassLoader) for resolved class, org/slf4j/impl/StaticLoggerBinder, have different Class objects for the type LoggerFactory; used in the signature\n\tat org.slf4j.LoggerFactory.getILoggerFactory(LoggerFactory.java:299) ~[slf4j-api.jar:1.7.5]\n\tat org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:269) ~[slf4j-api.jar:1.7.5]\n\tat org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:281) ~[slf4j-api.jar:1.7.5]\n\tat com.codenvy.inject.ModuleScanner.<clinit>(ModuleScanner.java:36) ~[na:na]\n\tat java.lang.Class.forName0(Native Method) ~[na:1.7.0_51]\n\tat java.lang.Class.forName(Class.java:270) ~[na:1.7.0_51]\n\tat org.apache.catalina.startup.WebappServiceLoader.loadServices(WebappServiceLoader.java:187) ~[catalina.jar:7.0.52]\n\tat org.apache.catalina.startup.WebappServiceLoader.load(WebappServiceLoader.java:152) ~[catalina.jar:7.0.52]\n\tat org.apache.catalina.startup.ContextConfig.processServletContainerInitializers(ContextConfig.java:1543) ~[ca\n\nNote. See comment in issue. I assume he have the same problem\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=55943#c8", "id": 173437, "time": "2014-02-23T16:12:21Z", "bug_id": 56180, "creation_time": "2014-02-23T16:12:21Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 56180, "attachment_id": null, "id": 173440, "time": "2014-02-23T19:15:17Z", "creator": "markt@apache.org", "creation_time": "2014-02-23T19:15:17Z", "is_private": false, "text": "See this thread for a full discussion of this topic:\nhttp://markmail.org/thread/mid36pgk7nckp2rr\n\nIt looks like you should be adding those JARs to the endorsed dir rather than to the class path."}, {"count": 2, "tags": [], "bug_id": 56180, "attachment_id": null, "id": 173442, "time": "2014-02-23T23:30:26Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-02-23T23:30:26Z", "is_private": false, "text": "(In reply to Sergey Kabashnyuk from comment #0)\n> 2. With help of setenv.sh I've add this jars to classpath\n>   export\n> CLASSPATH=\"${CATALINA_HOME}/conf/:${CATALINA_HOME}/lib/jul-to-slf4j.jar:\n> ${CATALINA_HOME}/lib/slf4j-api.jar:${CATALINA_HOME}/lib/logback-classic.jar:\n> ${CATALINA_HOME}/lib/logback-core.jar:${CATALINA_HOME}/lib/mail.jar:\n> ${JAVA_HOME}/lib/tools.jar\"\n> \n\nFor starters, move the mentioned libraries from ${CATALINA_HOME}/lib to somewhere else (so that they are not present twice in System and Common classloaders)\nand make sure that your web application does not have another (third) copy of them.\n\nFrom security risks point of view, you would better avoid having the whole \"conf\" on the classpath either.\n\nhttp://tomcat.apache.org/tomcat-7.0-doc/class-loader-howto.html"}]
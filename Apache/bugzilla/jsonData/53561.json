[{"count": 0, "tags": [], "bug_id": 53561, "is_private": false, "text": "Created attachment 29073\nUnit test, input and output workbooks\n\nWhen I try to add an auto filter to a workbook with POI the workbook contains the new drawings.\n\nTo reproduce this bug see an attachment.\n\nNote that the attached workbook contains some list data validations. Without them the bug would not be reproduced.\n\nAlso I started investigating of this issue after I had got the following exception (i can't have reproduced this exception with unit testing yet but it is the real issue):\njava.lang.IndexOutOfBoundsException: Index: 2, Size: 1\n\tat java.util.ArrayList.RangeCheck(ArrayList.java:547)\n\tat java.util.ArrayList.get(ArrayList.java:322)\n\tat org.apache.poi.hssf.model.DrawingManager2.getDrawingGroup(DrawingManager2.java:125)\n\tat org.apache.poi.hssf.model.DrawingManager2.allocateShapeId(DrawingManager2.java:71)\n\tat org.apache.poi.hssf.record.EscherAggregate.convertPatriarch(EscherAggregate.java:988)\n\tat org.apache.poi.hssf.record.EscherAggregate.convertUserModelToRecords(EscherAggregate.java:821)\n\tat org.apache.poi.hssf.record.EscherAggregate.getRecordSize(EscherAggregate.java:508)\n\tat org.apache.poi.hssf.model.InternalSheet.preSerialize(InternalSheet.java:1567)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.getBytes(HSSFWorkbook.java:1285)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.write(HSSFWorkbook.java:1205)", "id": 160703, "time": "2012-07-18T07:37:43Z", "creator": "anton.k.ekb@gmail.com", "creation_time": "2012-07-18T07:37:43Z", "attachment_id": 29073}, {"count": 1, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "text": "The described behavior is a limitation of HSSF: it can create new drawings from scratch but cannot modify existing ones. Auto-filters in the binary .xls format are graphic elements (comboboxes in the filter header are shapes) and when you add a filter to a sheet that already has drawing objects then the output can be corrupted or invalid.\n \nThere is an ongoing work to improve drawing support in HSSF, we plan to finish it by late August 2012 and then merge with trunk. Please wait till September, your problem should be fixed by then.\n\nRegards,\nYegor", "id": 160706, "time": "2012-07-18T08:21:46Z", "bug_id": 53561, "creation_time": "2012-07-18T08:21:46Z", "is_private": false}, {"count": 2, "attachment_id": null, "creator": "superrubiroyd@gmail.com", "is_private": false, "id": 161295, "time": "2012-08-12T11:47:08Z", "bug_id": 53561, "creation_time": "2012-08-12T11:47:08Z", "tags": [], "text": "This problem should be fixed in trunk.\n\nPlease try with a nightly build - see download links on http://poi.apache.org/\nor build yourself from SVN trunk, see http://poi.apache.org/subversion.html"}]
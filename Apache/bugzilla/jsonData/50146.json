[{"count": 0, "attachment_id": null, "creator": "smartart@tiscali.it", "text": "apr-1.4.2\ntarget architecture is powerpc from a x86_64 machine\nI had to add --tag=CC to libtool options, but ended being blocked by this error.\n\n\nmake -j1 \nmake[1]: Entering directory `/usr/powerpc-unknown-linux-gnu/tmp/portage/dev-libs/apr-1.4.2/work/apr-1.4.2\n'\n/bin/bash /usr/bin/libtool --silent --tag=CC --mode=compile powerpc-unknown-linux-gnu-gcc   -Os -pipe -mcpu=603e -fno-strict-aliasing -fsigned-char -I/usr/powerpc-unknown-linux-gnu/usr/include/ -I/usr/powerpc-unknown-linux-gnu/include/ -DHAVE_CONFIG_H -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE   -I./include -I/usr/powerpc-unknown-linux-gnu/tmp/portage/dev-libs/apr-1.4.2/work/apr-1.4.2/include/arch/unix -I./include/arch/unix -I/usr/powerpc-unknown-linux-gnu/tmp/portage/dev-libs/apr-1.4.2/work/apr-1.4.2/include/arch/unix -I/usr/powerpc-unknown-linux-gnu/tmp/portage/dev-libs/apr-1.4.2/work/apr-1.4.2/include  -o passwd/apr_getpass.lo -c passwd/apr_getpass.c && touch passwd/apr_getpass.lo\nIn file included from ./include/apr_strings.h:52,\n                 from passwd/apr_getpass.c:23:\n./include/apr_want.h:93: error: redefinition of 'struct iovec'\nmake[1]: *** [passwd/apr_getpass.lo] Error 1\nmake[1]: Leaving directory `/usr/powerpc-unknown-linux-gnu/tmp/portage/dev-libs/apr-1.4.2/work/apr-1.4.2'\n\ntell me if you need further infos\nmake: *** [all-recursive] Error 1", "id": 140954, "time": "2010-10-23T10:05:40Z", "bug_id": 50146, "creation_time": "2010-10-23T10:05:40Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "It seems that the struct iovec is perhaps in another header for powerpc than in sys/uio.h, and configure needs to check for it; from apr_want.h it looks as if APR_HAVE_IOVEC is set to 0, and therefore the definition at line 93 plugs in ...\ncan you please check the configure log why APR_HAVE_IOVEC was not detected properly, and check your headers for struct iovec where it is defined?", "is_private": false, "id": 144269, "creator": "eflash@gmx.net", "time": "2011-02-14T14:37:46Z", "bug_id": 50146, "creation_time": "2011-02-14T14:37:46Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "eflash@gmx.net", "text": "(In reply to comment #1)\n> can you please check the configure log why APR_HAVE_IOVEC was not detected\n> properly, and check your headers for struct iovec where it is defined?\nunless you provide more infos we are not able to fix this for your platform ...\nI've just commited a change to apr to better protect our own struct iovec definition, but I doubt that this will fix your issue:\nhttp://svn.apache.org/viewvc?rev=1086125&view=rev\nthis change will be available with next snapshots:\nhttp://svn.apache.org/snapshots/apr-1.4.x/", "id": 145329, "time": "2011-03-28T01:43:11Z", "bug_id": 50146, "creation_time": "2011-03-28T01:43:11Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 50146, "text": "I am using following script to configure APR.\n\n\n#!/bin/sh\nexport PATH=/opt/eldk/usr/bin:/opt/eldk/bin:$PATH\nexport CROSS_COMPILE=ppc_82xx-\nexport  CC=ppc_82xx-gcc\nexport  LD=ppc_82xx-ld\nexport  CXX=ppc_82xx-g++\nexport  AR=ppc_82xx-ar\nexport  CPP=ppc_82xx-cpp\nexport  STRIP=ppc_82xx-strip\n./configure  \\\n\t--host=ppc-linux \\\n\t--target=ppc-linux \\\n\t--prefix=/opt/eldk/ppc_82xx/usr \\\n\t--build=i686-cross-linux-gnu \\\n\tac_cv_file__dev_zero=no \\\n\tac_cv_func_setpgrp_void=no \\\n\tapr_cv_tcp_nodelay_with_cork=no \\\n\tcross_compiling=yes \\\n\tapr_cv_process_shared_works=no\n\n\n\nThe additional variables set to no are necessary because I get all times a configure error becuase of cross compiling like\n\nchecking for /dev/zero... configure: error: cannot check for file existence when cross compiling \n\n\nWhen I start make I get the following lines:\n\njddev@m101n11ech:~/Downloads/apr-1.4.6$ make\nmake[1]: Entering directory `/home/jddev/Downloads/apr-1.4.6'\n/bin/bash /home/jddev/Downloads/apr-1.4.6/libtool --silent --mode=compile ppc_82xx-gcc -g -O2   -DHAVE_CONFIG_H -DLINUX=2 -D_REENTRANT -D_GNU_SOURCE   -I./include -I/home/jddev/Downloads/apr-1.4.6/include/arch/unix -I./include/arch/unix -I/home/jddev/Downloads/apr-1.4.6/include/arch/unix -I/home/jddev/Downloads/apr-1.4.6/include  -o passwd/apr_getpass.lo -c passwd/apr_getpass.c && touch passwd/apr_getpass.lo\nIn file included from include/apr_strings.h:52,\n                 from passwd/apr_getpass.c:23:\ninclude/apr_want.h:95: redefinition of `struct iovec'\nmake[1]: *** [passwd/apr_getpass.lo] Fehler 1\nmake[1]: Leaving directory `/home/jddev/Downloads/apr-1.4.6'\nmake: *** [all-recursive] Fehler 1\njddev@m101n11ech:~/Downloads/apr-1.4.6$", "id": 160120, "time": "2012-06-20T08:07:42Z", "creator": "kirsche40@gmx.de", "creation_time": "2012-06-20T08:07:42Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "kirsche40@gmx.de", "is_private": false, "id": 160121, "time": "2012-06-20T08:12:48Z", "bug_id": 50146, "creation_time": "2012-06-20T08:12:48Z", "tags": [], "text": "Sorry, I forgot some information. I am using Denx ELDK 3.0 (www.denx.de) for cross compiling. This toolchain is rather old but can not be changed for product maintenance reasons."}, {"count": 5, "tags": [], "bug_id": 50146, "attachment_id": null, "text": "New information. I am through apr and aprutils compilation. I used following files for build:\n\n=============\n APR\n=============\n#!/bin/sh\nexport PATH=/opt/eldk/usr/bin:/opt/eldk/bin:$PATH\nexport ARCH=powerpc\nexport CROSS_COMPILE=ppc_82xx-\nexport CC=ppc_82xx-gcc\nexport LD=ppc_82xx-ld\nexport CXX=ppc_82xx-g++\nexport AR=ppc_82xx-ar\nexport CPP=ppc_82xx-cpp\nexport STRIP=ppc_82xx-strip\n./configure  \\\n\t--host=ppc-linux \\\n\t--target=ppc-linux \\\n\t--prefix=/opt/eldk/ppc_82xx/usr \\\n\t--build=i686-cross-linux-gnu \\\n\t--disable-libtool-lock \\\n\t--disable-lfs \\\n\t--disable-dso \\\n\t--disable-ipv6 \\\n\t--with-gnu-ld \\\n\tac_cv_file__dev_zero=no \\\n\tac_cv_func_setpgrp_void=no \\\n\tapr_cv_tcp_nodelay_with_cork=no \\\n\tcross_compiling=yes \\\n\tapr_cv_process_shared_works=no \\\n\tac_cv_sizeof_struct_iovec=1\n\n\n=============\n APR Utils\n=============\n#!/bin/sh\nexport PATH=/opt/eldk/usr/bin:/opt/eldk/bin:$PATH\nexport ARCH=powerpc\nexport CROSS_COMPILE=ppc_82xx-\nexport CC=ppc_82xx-gcc\nexport LD=ppc_82xx-ld\nexport CXX=ppc_82xx-g++\nexport AR=ppc_82xx-ar\nexport CPP=ppc_82xx-cpp\nexport STRIP=ppc_82xx-strip\n./configure  \\\n\t--host=ppc-linux \\\n\t--target=ppc-linux \\\n\t--prefix=/opt/eldk/ppc_82xx/usr \\\n\t--build=i686-cross-linux-gnu \\\n\t--disable-util-dso \\\n\t--with-apr=/opt/eldk/ppc_82xx/usr", "id": 160125, "time": "2012-06-20T10:44:42Z", "creator": "kirsche40@gmx.de", "creation_time": "2012-06-20T10:44:42Z", "is_private": false}, {"count": 6, "tags": [], "text": "Now I tried to compile the lib with a new cross-compiler (denx ELDK 5.1) and this mess breaks again:\n\nIn file included from ./include/apr_strings.h:52:0,\n                 from passwd/apr_getpass.c:23:\n./include/apr_want.h:94:8: error: redefinition of 'struct iovec'\n/opt/eldk-5.1/powerpc/sysroots/powerpc-linux/opt/eldk-5.1/powerpc/sysroots/powerpc-linux/usr/include/bits/uio.h:44:8: note: originally defined here\nmake[1]: *** [passwd/apr_getpass.lo] Error 1\n\nI do not want to search workarounds for this crappy piece of SW anymore.\n\nBecause this bug is rather old and the library is still unusable I set the bug importance to P1 and to blocker.", "is_private": false, "bug_id": 50146, "id": 164196, "time": "2012-12-21T10:01:47Z", "creator": "kirsche40@gmx.de", "creation_time": "2012-12-21T10:01:47Z", "attachment_id": null}, {"count": 7, "attachment_id": null, "creator": "kontakt+asf@veloxis.de", "is_private": false, "id": 197672, "time": "2017-03-15T10:18:52Z", "bug_id": 50146, "creation_time": "2017-03-15T10:18:52Z", "tags": [], "text": "I have encountered this problem recently in my attempt to cross-compile APR 1.5.2 for an x86 platform, with no option to \"just compile it natively\". The essential workaround I used, after tracing the configure script and include files, was defining APR_IOVEC_DEFINED in the CPPFLAGS passed in the environment of my ./configure call. See the excerpt of the apr_want.h include file below.\n\nsha256sum of source tarball:\n7d03ed29c22a7152be45b8e50431063736df9e1daa1ddf93f6a547ba7a28f67a\n\nFile apr-1.5.2/include/apr_want.h:80 in apr-1.5.2.tar.bz2:\n/* --------------------------------------------------------------------- */\n\n#ifdef APR_WANT_IOVEC\n\n#if APR_HAVE_IOVEC\n\n#if APR_HAVE_SYS_UIO_H\n#include <sys/uio.h>\n#endif\n\n#else\n\n#ifndef APR_IOVEC_DEFINED\n#define APR_IOVEC_DEFINED\nstruct iovec\n{\n    void *iov_base;\n    size_t iov_len;\n};\n#endif /* !APR_IOVEC_DEFINED */\n\n#endif /* APR_HAVE_IOVEC */\n\n#undef APR_WANT_IOVEC\n#endif\n\n/* --------------------------------------------------------------------- */\n\nNaturally, I also needed a bunch of ac_cv_ and apr_cv_ variables to give hints to the configure script. These may be different for your target. To sum it up, my ./configure call essentially looked like this:\n\nac_cv_file__dev_zero=yes \\\nac_cv_sizeof_size_t=4 \\\nac_cv_sizeof_ssize_t=4 \\\nac_cv_struct_rlimit=yes \\\napr_cv_mutex_robust_shared=no \\\napr_cv_process_shared_works=yes \\\napr_cv_pthreads_lib=\"-lpthread\" \\\napr_cv_tcp_nodelay_with_cork=yes \\\nCPPFLAGS=\"-DAPR_IOVEC_DEFINED\" ./configure <irrelevant options>\n\nGood luck. May these problems in the Apache *PORTABLE* Runtime library be fixed one glorious day."}]
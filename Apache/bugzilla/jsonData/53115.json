[{"count": 0, "tags": [], "text": "Under clean Windows XP, under Administrator account. \nDefault temp dir is like c:\\Documents and Settings\\Admin\\Local Settings\\TEMP\n\nIn catalina.bat there is a temp dir check:\nif \"\"%TEMP%\"\" == \"\"\"\" goto mainEntry\n\nActually, this command does not work if TEMP contains spaces. \nThe right line is:\nif \"\"%TEMP%\"\" == \"\"\"\" goto mainEntry\n\ni.e. to avoid double quoting", "attachment_id": null, "id": 158230, "creator": "eugene.petrenko@jetbrains.com", "time": "2012-04-20T18:25:41Z", "bug_id": 53115, "creation_time": "2012-04-20T18:25:41Z", "is_private": false}, {"count": 1, "attachment_id": null, "creator": "knst.kolinko@gmail.com", "text": "It is funny. I have WinXP. The \"TEMP\" variable is configured as\n\n%USERPROFILE%\\Local Settings\\Temp\n\nby default for the current user in the setting dialog (Win+Pause), but cmd shows\n\n> echo %TEMP%\nC:\\DOCUME~1\\username\\LOCALS~1\\Temp\n\nSo the current catalina.bat already works for majority of Windows XP users, including me.", "id": 158231, "time": "2012-04-20T18:50:40Z", "bug_id": 53115, "creation_time": "2012-04-20T18:50:40Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 53115, "attachment_id": null, "text": "There is a known issue under XP\nhttp://social.technet.microsoft.com/Forums/zh/itproxpsp/thread/a4f428ba-1826-46a0-999a-972ae4279fbe", "id": 158272, "time": "2012-04-22T15:00:41Z", "creator": "eugene.petrenko@jetbrains.com", "creation_time": "2012-04-22T15:00:41Z", "is_private": false}, {"count": 3, "attachment_id": null, "creator": "markt@apache.org", "text": "Given that %TEMP% may or may not contain spaces ad may or may not be quoted I simply do not see a way of getting this to work for all possible input. I'd be happy to be proved wrong though.", "id": 159472, "time": "2012-05-29T20:14:35Z", "bug_id": 53115, "creation_time": "2012-05-29T20:14:35Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "creator": "sebb@apache.org", "is_private": false, "id": 159477, "time": "2012-05-29T22:47:30Z", "bug_id": 53115, "creation_time": "2012-05-29T22:47:30Z", "tags": [], "text": "AFAICT it's not possible using IF because one cannot get past the syntax error that occurs when the quotes are mismatched.\n\nHowever, I think I've found a solution.\n\nTry the following:\n\nREM The output of ECHO will be :: if TEMP is not defined\nREM It's not possible for :: to be found within a valid TEMP variable\necho :%TEMP%: | find \"::\"\nREM check for level 0, i.e. pattern found\nif NOT ERRORLEVEL 1 goto mainEntry"}, {"count": 5, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 159522, "time": "2012-05-30T11:37:50Z", "bug_id": 53115, "creation_time": "2012-05-30T11:37:50Z", "is_private": false, "text": "Neat trick. While that fixes the first problem, a similar approach can't be used for the following lines that use IF and %TEMP%."}, {"count": 6, "tags": [], "bug_id": 53115, "attachment_id": null, "text": "We could detect the spaces in %TEMP% and issue an error message, stopping the startup script rather than ending up giving the user a bizarre error and letting them try to figure it out.", "id": 159527, "time": "2012-05-30T14:16:52Z", "creator": "chris@christopherschultz.net", "creation_time": "2012-05-30T14:16:52Z", "is_private": false}, {"count": 7, "attachment_id": null, "creator": "eugene.petrenko@jetbrains.com", "is_private": false, "id": 159530, "time": "2012-05-30T14:21:53Z", "bug_id": 53115, "creation_time": "2012-05-30T14:21:53Z", "tags": [], "text": "Please remember the possible issue with Windows XP:\nhttp://social.technet.microsoft.com/Forums/zh/itproxpsp/thread/a4f428ba-1826-46a0-999a-972ae4279fbe\n\nFor some reason/bug path to %TEMP% may be not 8.3 style formatted. This simply makes catallina.bat fail and not start Tomcat. \n\nI faced exactly the same issue on my test Windows XP VM."}, {"count": 8, "tags": [], "bug_id": 53115, "text": "There is no way I am aware of to fix this. See comment #3. Please do not re-open this issue unless you have a patch that actually fixes the issue.", "id": 159544, "time": "2012-05-31T07:42:54Z", "creator": "markt@apache.org", "creation_time": "2012-05-31T07:42:54Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 53115, "attachment_id": null, "is_private": false, "id": 159554, "time": "2012-05-31T10:34:01Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-05-31T10:34:01Z", "text": "(In reply to comment #3)\n\nI think %TEMP% do not use quotes, like ones are not used in %PATH%.\nThe OS cares that %TEMP% do not contain spaces, and thus it would not be quoted.\n\nYou naturally do not use quotes when you configure values through GUI.\nThe syntax for SET command is less intuitive. For reference:\n\nSET \"TEMP=value\"\n\n\n[Offtopic] Regarding that thread on social.technet.microsoft.com I would say that\n- The value of NtfsDisable8dot3NameCreation affects the time when a directory is created (in that case: when a profile is created), not when it is used. That is whether mkdir generates two names or just one.\n- Setting TEMP to C:\\Temp is a valid workaround for the issue."}, {"count": 10, "attachment_id": null, "creator": "knst.kolinko@gmail.com", "is_private": false, "id": 159562, "time": "2012-05-31T14:11:37Z", "bug_id": 53115, "creation_time": "2012-05-31T14:11:37Z", "tags": [], "text": "Fixed in trunk and 7.0 by r1344725 and r1344732 and will be in 7.0.28.\n\nNote that\n- The issue only affects the \"run\" command. All other command skip that code.\n- The issue affects 7.0.x only. Earlier versions do not have that code in catalina.bat."}, {"count": 11, "tags": [], "bug_id": 53115, "text": "(In reply to comment #9)\n> (In reply to comment #3)\n\n...\n \n> You naturally do not use quotes when you configure values through GUI.\n> The syntax for SET command is less intuitive. For reference:\n> \n> SET \"TEMP=value\"\n>\n\nOn WinXP, the command:\nSET TEMP1=a b c\nis the same as\nSET \"TEMP2=a b c\"\n\nNeither adds quotes to the value of X.\nHowever, the following command does add quotes:\n\nSET TEMP3=\"a b c\"\n\nThe result of the above is:\n\nTEMP1=a b c\nTEMP2=a b c\nTEMP3=\"a b c\"", "id": 159565, "time": "2012-05-31T14:49:28Z", "creator": "sebb@apache.org", "creation_time": "2012-05-31T14:49:28Z", "is_private": false, "attachment_id": null}, {"count": 12, "attachment_id": null, "creator": "sebb@apache.org", "text": "AFAICT, the TEMP directory is being used for two purposes:\n\n1) for a file containing \"Y\"\n2) as a marker to stop a recursive call of catalina.bat\n\nThe first use is trivial to eliminate; just ship Tomcat with a suitable file\n\nThe second use can also be eliminated.\n\nIf you can assume that Command Extensions are enabled, the following will work:\n\nrem Suppress Terminate batch job on CTRL+C\nif not \"\"%1\"\" == \"\"run\"\" goto mainEntry\nif \"\"%TEMP%\"\" == \"\"\"\" goto mainEntry\nrem Assumes Y.DAT exists\ncall :mainEntry %* <Y.DAT\nrem Use provided errorlevel\nset RETVAL=%ERRORLEVEL%\nexit /B %RETVAL%\n:mainEntry\n\nIf not, then rather than using a marker file in TEMP, you can use a SET variable:\n\nrem Suppress Terminate batch job on CTRL+C\nif not \"\"%1\"\" == \"\"run\"\" goto mainEntry\nif \"\"%TEMP%\"\" == \"\"\"\" goto mainEntry\nif \"\"%_RECURSE_%\"\" == \"\"TrUe\"\" goto mainEntry\nset _RECURSE_=TrUe\ncall \"%~f0\" %* <Y.DAT\nrem Use provided errorlevel\nset RETVAL=%ERRORLEVEL%\nset _RECURSE_=\nexit /B %RETVAL%\n:mainEntry\n\nYet another possibility is to split catalina.bat into two so the mainEntry code is in a separate file. This solves the recursive call issue.", "id": 159568, "time": "2012-05-31T16:19:00Z", "bug_id": 53115, "creation_time": "2012-05-31T16:19:00Z", "tags": [], "is_private": false}]
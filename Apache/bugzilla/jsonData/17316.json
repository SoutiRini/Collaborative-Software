[{"count": 0, "tags": [], "text": "/*\nthe codes work well under tomcat 4.0, but in 4.1.18 (I use now), the function \npageContext.setAttribute in the doStartTag always return null to the jsp page. \nbut the pageContext.setAttribute in the doAfterBody works, so I get the first \nrecord null, and the others well.\n*/\n\n\n// file: Region.java\npackage ttt;\n\nimport javax.servlet.jsp.*;\nimport javax.servlet.jsp.tagext.*;\n\npublic class Region extends BodyTagSupport {\n\n private java.sql.ResultSet rs = null;\n\n public int doStartTag() throws JspException  {\n  int retVal = SKIP_BODY;\n  try {\n   DBO db = (DBO) pageContext.findAttribute(\"db\"); //my connection pool\n   String sql = \"select * from region\";\n   this.rs = db.select(sql);\n   if (this.rs.next()) {\n    pageContext.setAttribute(\"id\", this.rs.getString(\"id\")); //***\n    pageContext.setAttribute(\"name\", this.rs.getString(\"name\")); //***\n\n/*\ni'd checked the return from the database with:\n pageContext.getOut().print(\"Hello.\"+this.rs.getString(\"name\"));\nit works properly.\n*/\n\n    retVal = EVAL_BODY_INCLUDE;\n   }\n  } catch (java.sql.SQLException ignored) {}\n\n  return retVal;\n }\n\n public int doAfterBody() throws JspException  {\n  int retVal = SKIP_BODY;\n  try {\n   if (this.rs.next()) {\n    pageContext.setAttribute(\"id\", this.rs.getString(\"id\"));\n    pageContext.setAttribute(\"name\", this.rs.getString(\"name\"));\n    retVal = EVAL_BODY_AGAIN;\n   }\n  } catch (java.sql.SQLException ignored) {}\n  return retVal;\n }\n}\n\n\n// file RegionEx.java\n\n/*\nanothe problem in extrainfo:\nCannot return the type exclude the \"String\", the following codes can be \ncomplied, but will cause a \"can not complie the jsp exception\" when i run the \njsp file:\n String type = data.getAttributeString(\"type\");\n if (type == null) type = \"java.lang.Object\";\n  return new VariableInfo[] {\n   new VariableInfo(data.getAttributeString(\"id\"), type, true, \nVariableInfo.NESTED),\n   new VariableInfo(data.getAttributeString(\"name\"), type, true, \nVariableInfo.NESTED)\n  };\n\nso, have to return \"String\" for all the data type?\n\n*/\n\npackage ttt;\n\nimport javax.servlet.jsp.tagext.*;\n\npublic class RegionEx extends TagExtraInfo {\n    public VariableInfo[] getVariableInfo(TagData data) {\n        return new VariableInfo[] {\n            new VariableInfo(\"id\", \"String\", true, VariableInfo.NESTED),\n            new VariableInfo(\"name\", \"String\", true, VariableInfo.NESTED),\n        };\n    }\n}\n\n//the jsp page.\n\n<table>\n<ttt:region>\n<tr><td><%= name %></td><td><%= id %></td></tr>\n</ttt:region>\n</table>\n\n// the tld file\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE taglib\n\tPUBLIC \"-//Sun Microsystems, Inc.//DTD JSP Tag Library 1.2//EN\"\n\t\"http://java.sun.com/dtd/web-jsptaglibrary_1_2.dtd\">\n\n<taglib>\n\n\t<tlib-version>1.2</tlib-version>\n\t<jsp-version>1.2</jsp-version>\n\t<short-name>ttt</short-name>\n\n\t<tag>\n\t\t<name>region</name>\n\t\t<tag-class>ttt.Region</tag-class>\n\t\t<tei-class>ttt.RegionEx</tei-class>\n\t\t<body-content>JSP</body-content>\n\t</tag>\n\n</taglib>", "attachment_id": null, "id": 31809, "creation_time": "2003-02-23T13:36:37Z", "time": "2003-02-23T13:36:37Z", "creator": "chenhong@iro.umontreal.ca", "bug_id": 17316, "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "text": "Your test case is in complete but with the necessary additions (such as a laglib\ndefinition in your JSP) it works exactly as expected.", "id": 76301, "time": "2005-06-11T13:37:04Z", "bug_id": 17316, "creation_time": "2005-06-11T13:37:04Z", "is_private": false, "attachment_id": null}]
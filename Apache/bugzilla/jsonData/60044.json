[{"count": 0, "attachment_id": 34173, "creator": "tallison@mitre.org", "is_private": false, "id": 193324, "time": "2016-08-25T11:58:55Z", "bug_id": 60044, "creation_time": "2016-08-25T11:58:55Z", "tags": [], "text": "Created attachment 34173\nexample file\n\nOn https://issues.apache.org/jira/browse/TIKA-2013, I noticed a regression in currency formatting in at least some xls files when comparing 3.15-beta1 with 3.15-beta3-rc1.\n\nI confirmed that this is a poi-level issue, not something that we're botching in Tika.\n\nXLS2CSVmra results with trunk:\n\n,\"Apple Day\",$963.01,$7,61,$12,96,$8,99,$6,71,$8,09,$4,27,$3,98,$2,80,\n,\"Bingo\",$1,184.00,$8,67,$18,69,,,,,,,"}, {"count": 1, "tags": [], "text": "Could you provide a diff of the beta1 and beta3-rc1 output or a unit test to make it easier to find the breaking change?\n\nThere were some changes to DataFormatter between these releases that improved POI's locale-specific number formatting (comma is used as decimal separator rather than a period).\n\nMy guess is that this commit [1] caused the regression. Can't quote the numbers as that would give a string. Either change Xls2Csv to set the locale to format with a period separator when the document's locale or the machine's locale use comma decimal separator, or escape the commas and hope the CSV consumer knows how to unescape it.\n\n[1] https://svn.apache.org/viewvc?view=revision&revision=1747139", "attachment_id": null, "bug_id": 60044, "id": 193328, "time": "2016-08-25T15:22:37Z", "creator": "onealj@apache.org", "creation_time": "2016-08-25T15:22:37Z", "is_private": false}, {"count": 2, "tags": [], "text": "> $1,184.00\n\nLooks like thousands separator commas need to be striped as well.\n\nQuestion for folks who are used to seeing numbers with comma decimal separators: how are CSV files usually read and written? Are numbers represented with period decimal separators?", "attachment_id": null, "bug_id": 60044, "id": 193329, "time": "2016-08-25T15:26:04Z", "creator": "onealj@apache.org", "creation_time": "2016-08-25T15:26:04Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 60044, "attachment_id": null, "is_private": false, "id": 193391, "time": "2016-08-29T16:23:40Z", "creator": "fanningpj@yahoo.com", "creation_time": "2016-08-29T16:23:40Z", "text": "For CSV output, wouldn't it be better not to use thousands separators at all? That is, $1,184.00 could be written as $1184.00.\nOtherwise, to keep the comma separator for the thousands would require the value to appear in double quotes (\"$1,184.00\")."}, {"count": 4, "tags": [], "text": "Looks like this is caused by a typo in \n\nhttp://svn.apache.org/viewvc/poi/trunk/src/java/org/apache/poi/ss/usermodel/BuiltinFormats.java?r1=1721901&r2=1747325\n\n-putFormat(m, 7, \"\\\"$\\\"#,##0.00_);(\\\"$\\\"#,##0.00)\");\n+\"\\\"$\\\"#,##,00_);(\\\"$\\\"#,##0.00)\",", "is_private": false, "bug_id": 60044, "id": 193577, "time": "2016-09-09T18:16:08Z", "creator": "tallison@mitre.org", "creation_time": "2016-09-09T18:16:08Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 60044, "attachment_id": null, "id": 193580, "time": "2016-09-09T18:42:28Z", "creator": "tallison@mitre.org", "creation_time": "2016-09-09T18:42:28Z", "is_private": false, "text": "r1760102  \n\nI didn't bother adding a unit test because this seems like such a small issue.  Please reopen if we need a test."}]
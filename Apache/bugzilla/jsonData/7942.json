[{"count": 0, "attachment_id": null, "creator": "jian.cai@sun.com", "text": "The folowing Filter should add some discription (a html table) as part of the \nresponse. But the response lost that part.\n\npublic class FilterWEG extends GenericFilter\n{\n\n    public FilterWEG () {\n        log(\"FilterWEG initialized\");\n    }\n\n    public void doFilter(final ServletRequest request, final ServletResponse \nresponse, FilterChain chain) throws java.io.IOException,\n    javax.servlet.ServletException\n    {\n        String message = \"Filtered !\";\n        GenericResponseWrapper wrapper = new GenericResponseWrapper\n((HttpServletResponse)response);\n        chain.doFilter(request, wrapper);\n        ServletOutputStream out = response.getOutputStream();\n        //message = getFilterConfig().getInitParameter(\"message\");\n\n        ByteArrayOutputStream respStream = manipulateResp(wrapper.output());\n        response.setContentLength(respStream.size());\n        response.setContentType(\"text/html\");\n        out.write(respStream.toByteArray());\n        // the following should appear in the response\n        out.println(\"<p><p>\");\n        out.println(\"<p>This table is generated from the FilterWEGS<p>\");\n        out.println(\"<table BORDER COLS=2 WIDTH=\\\"100%\\\" NOSAVE >\");\n        out.println(\"<tr>\");\n        out.println(\"<td>Test Name:</td>\");\n        out.println(\"<td>FilterERES</td>\");\n        out.println(\"</tr>\");\n        out.println(\"<tr>\");\n        out.println(\"<td>CharacterEncoding:</td>\");\n        out.println(\"<td>\"+response.getCharacterEncoding()+\"</td>\");\n        out.println(\"</tr>\");\n        out.println(\"<tr>\");\n        out.println(\"<td>Result:</td>\");\n        out.println(\"<td>The content before this table should be all \ncapital</td>\");\n        out.println(\"</tr>\");\n        out.println(\"<tr>\");\n        out.println(\"<td>Author:</td>\");\n        out.println(\"<td>James</td>\");\n        out.println(\"</tr>\");\n        out.println(\"</table>\");\n        out.println(\"</body>\");\n        out.println(\"</html>\");\n\n        out.flush();\n        out.close();\n    }\n    \n    public ByteArrayOutputStream manipulateResp(byte[] respData) throws \nServletException\n    {\n        //change every character in the response to higher case\n\n        int i;\n        int o;\n        char a='a';\n        char A='A';\n        int diff = A-a;\n        ByteArrayInputStream readStream;\n        ByteArrayOutputStream respStream;\n        respStream = new ByteArrayOutputStream();\n        \n        try{\n        readStream = new ByteArrayInputStream(respData);\n        \n        do {\n            i = readStream.read();\n           \n            //log(\"get char:\"+((char) i));\n            //log(\"FilterWEG 125: read readStream\");\n            if (i != -1) \n                {\n                    if ( (((char) i)>='a')&&(((char) i)<='z') )\n                        {\n                            o= i+diff;\n                            respStream.write(o);\n                        }\n                    else\n                        {\n                            respStream.write(i);\n                        }\n                }\n        } while (i != -1);\n        \n        readStream.close();\n        \n        }\n        catch (IOException e)\n            {\n                System.out.println(\"IOExcption:\" + e);\n            }\n\n        return respStream;\n    }\n}\n\n\nThis filter is mapped to a servlet named FilterWEGServlet (which is just a \nsingle line printout). But the output does not contain the \"table\" add in the \nfilter.", "id": 13213, "time": "2002-04-11T00:33:48Z", "bug_id": 7942, "creation_time": "2002-04-11T00:33:48Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 13224, "time": "2002-04-11T07:59:01Z", "bug_id": 7942, "creation_time": "2002-04-11T07:59:01Z", "text": "No, I don't agree. It depends on what the wrapper is doing. It may be that it \nis incorrectly written in some way which makes it fail (since the new connector \nis stricter when it comes to HTTP support).\nPlease make sure of that or attach the whole test case.\n\nI believe the tester has many wrapping examples, so in the meantime I'll mark \nthe bug as worksforme."}]
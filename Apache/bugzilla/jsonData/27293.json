[{"count": 0, "tags": [], "creator": "jsled-apachebugs@asynchronous.org", "text": "The If-Unmodified-Since header fails operation with the DefaultServlet on\nfile-system-backed files.\n\nSpecifically, the resourceInfo date has OS/filesystem-backed resolution to\nmilliseconds, but the relevant HTTP headers only have resolution down to whole\nseconds.  When a client HEAD-requests a file, then turns the provided timestamp\naround to the server, the comparison fails due to the discrepency.\n\nE.g.:\n* file modified at 1001 milliseconds.\n* HEAD request returns timestamp corresponding to \"1000\" milliseconds.\n* client If-Unmodified-Since conditionally-requests the file.\n* checkIfUnmodifiedSince() fails, since:\n  lastModified=1001 > headerValue=1000\n  [DefaultServlet.java:1728 on 4.1.30 sources.]\n\nIn particular, this prevents a windows client from using the BITS [background\nintelligent transfer service] to ranged-conditionally-GET a file, since 412\n[precondition failed] is always returned.", "id": 53134, "time": "2004-02-27T14:44:14Z", "bug_id": 27293, "creation_time": "2004-02-27T14:44:14Z", "is_private": false, "attachment_id": null}, {"count": 1, "text": "Created attachment 10590\nSpecifically change DefaultServlet.java:checkIfUnmodifiedSince()", "bug_id": 27293, "is_private": false, "id": 53136, "time": "2004-02-27T14:56:43Z", "creator": "jsled-apachebugs@asynchronous.org", "creation_time": "2004-02-27T14:56:43Z", "tags": [], "attachment_id": 10590}, {"count": 2, "text": "Created attachment 10591\nGenerally remove sub-second resolution on ResourceInfo objects.", "bug_id": 27293, "attachment_id": 10591, "id": 53137, "time": "2004-02-27T14:57:28Z", "creator": "jsled-apachebugs@asynchronous.org", "creation_time": "2004-02-27T14:57:28Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "jsled-apachebugs@asynchronous.org", "text": "Attached are two versions of a fix...\n\nspecific-check.patch is a patch in checkIfUnmodifiedSince to reduce the\nresolution of 'lastModified' just before the check.  We've been using a version\nof this in a DefaultServlet replacement internall to get around the bug.\n\nreduce-resolution.patch fixes this in ResourceInfo.set(...), which seems better,\nbut is entirely untested.\n\nIn fact, I didn't even see if either of these work or even compile.  But bug +\npatch is better than nothing. :/\n\nReassigning bug to default component owner for action.\n\nFWIW, this has been true since at least 4.1.24, where we noticed it.  I believe\nit's been true since before then.  I have not checked the 5.x code to see if the\nanalagous problem exists.", "id": 53139, "time": "2004-02-27T14:58:40Z", "bug_id": 27293, "creation_time": "2004-02-27T14:58:40Z", "is_private": false, "attachment_id": null}, {"count": 4, "text": "This does make sense to me, and this is now fixed in Tomcat 5.\nThe other comparisons simply add 1000 to headerValue, so I'll do the same to the\ncheck. Your way is more accurate, but IMO we don't need to care.", "bug_id": 27293, "attachment_id": null, "id": 53140, "time": "2004-02-27T15:09:10Z", "creator": "remm@apache.org", "creation_time": "2004-02-27T15:09:10Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "And now fixed the same way in TC4.", "id": 60409, "time": "2004-07-10T20:03:10Z", "bug_id": 27293, "creation_time": "2004-07-10T20:03:10Z", "attachment_id": null}]
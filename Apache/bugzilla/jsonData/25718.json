[{"count": 0, "tags": [], "bug_id": 25718, "attachment_id": null, "id": 49588, "time": "2003-12-23T07:53:41Z", "creator": "silby@silby.com", "creation_time": "2003-12-23T07:53:41Z", "is_private": false, "text": "Apache (really apr, I guess) attempts to be clever and detect the version\nof FreeBSD at runtime; this information is then used to determine whether\nor not the length of headers needs to be added to the length passed to\nsendfile.  This is to work around a bug present before 4.6-stable which\nrequired the length to be passed.\n\nAnyway, this entire check is unneeded.  As part of the fix, alfred perlstein\ncreated a new sendfile syscall; any program compiled with < 4.6 header files\nwill use the old syscall which requires the header length to be added in, and\nany program compiled with > 4.6 will call the new syscall.  Hence, only a\ncompile time check should be done.  The current runtime test is basically\none huge no-op.  Patch will be attached in a second."}, {"count": 1, "tags": [], "bug_id": 25718, "attachment_id": null, "id": 49589, "time": "2003-12-23T07:55:54Z", "creator": "silby@silby.com", "creation_time": "2003-12-23T07:55:54Z", "is_private": false, "text": "Patch is available from:\nhttp://www.silby.com/patches/raw/patch-sendfile_fix\n\nThis should apply to any 2.x version of apache, I believe."}, {"count": 2, "tags": [], "bug_id": 25718, "attachment_id": null, "is_private": false, "id": 51683, "time": "2004-02-04T01:47:19Z", "creator": "chip@force-elite.com", "creation_time": "2004-02-04T01:47:19Z", "text": "+1\n\nTested on FreeBSD 5.2\n\nAlso Moving this to the APR Project. (Not an Apache Bug)"}, {"attachment_id": null, "tags": [], "bug_id": 25718, "is_private": false, "count": 3, "id": 51687, "time": "2004-02-04T07:10:54Z", "creator": "jorton@redhat.com", "creation_time": "2004-02-04T07:10:54Z", "text": "Has a binary built on >4.6 been tested on <4.6?"}, {"count": 4, "tags": [], "text": "Yes, a > 4.6 binary dies when run on pre-4.6, as it uses a syscall unknown to\nthe pre-4.6 kernel.  It would be possible to rig apache so that it actually knew\nwhich sendfile (new or old) to use so that post-4.6 binaries would work on older\nkernels, but there's really no reason to bother.", "attachment_id": null, "id": 51688, "creator": "silby@silby.com", "time": "2004-02-04T07:25:59Z", "bug_id": 25718, "creation_time": "2004-02-04T07:25:59Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 25718, "attachment_id": null, "id": 51701, "time": "2004-02-04T14:23:06Z", "creator": "trawick@apache.org", "creation_time": "2004-02-04T14:23:06Z", "is_private": false, "text": "Yes, we shouldn't care if a binary built on OS level x fails when run on lower\nlevel of the OS.\n\nHas anybody tested this on older FreeBSD?\n\n(I remember the pain when www.apache.org got screwed by picking up a FreeBSD\nupdate that changed the sendfile() semantics.  There was no compatibility\nsendfile() interface at the time to make the old Apache code work.  Maybe it is\nonly some intermediate maintenance levels of 4.5(?) that will break without the\ncode in cvs today???)\n"}, {"count": 6, "tags": [], "bug_id": 25718, "is_private": false, "text": "Yeah, sorry, I meant the other way round: has a binary built with this change on\nold FreeBSD been tested to DTRT on new FreeBSD too.", "id": 51702, "time": "2004-02-04T14:28:12Z", "creator": "jorton@redhat.com", "creation_time": "2004-02-04T14:28:12Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 25718, "is_private": false, "text": "I have not tested a pre-4.6 binary, as I do not have any pre-4.6 machines\nsitting around.  I assume that this was well tested when the osendfile\ncomaptibility shim was added.", "id": 51856, "time": "2004-02-07T07:41:30Z", "creator": "silby@silby.com", "creation_time": "2004-02-07T07:41:30Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "Do we need to test for a Binary Built on <4.6 working on >=4.6?\n\nIf not, is there any reason that we cannot commit this patch?\n\nIf this patch is applied, we would also fix the sendfile detection on DragonFly\nBSD (Bug #29858)\n\n-Paul Querna", "attachment_id": null, "bug_id": 25718, "id": 60345, "time": "2004-07-09T08:50:26Z", "creator": "chip@force-elite.com", "creation_time": "2004-07-09T08:50:26Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 25718, "attachment_id": null, "is_private": false, "id": 60385, "time": "2004-07-09T20:22:55Z", "creator": "chip@force-elite.com", "creation_time": "2004-07-09T20:22:55Z", "text": "Using APR Built On FreeBSD 4.5(thanks VMWare) and the supplied patch, All Tests\npass. (including ./sendilfe server &; ./sendfile client\ntimeout,nonblocking,blocking)\n\nTaking the APR built on FreeBSD 4.5, to a 5.2-CURRENT box, the same tests all\npass, including the sendfile tests.\n\nThere is no reason to not include the patch now."}, {"count": 10, "tags": [], "bug_id": 25718, "attachment_id": null, "id": 67109, "time": "2004-11-18T05:27:42Z", "creator": "rooneg@electricjellyfish.net", "creation_time": "2004-11-18T05:27:42Z", "is_private": false, "text": "is there anything keeping this patch from being committed?\n\nthe last comment is from four months ago and indicates that testing on the\nvarious versions of freebsd worked out fine, but as far as I can tell the\nversion in trunk is still using sysctl to figure this stuff out at runtime."}, {"count": 11, "tags": [], "creator": "chip@force-elite.com", "is_private": false, "text": "I will commit it this weekend to TRUNK.\n\n-Paul Querna", "id": 67110, "time": "2004-11-18T05:30:08Z", "bug_id": 25718, "creation_time": "2004-11-18T05:30:08Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 25718, "attachment_id": null, "id": 67521, "time": "2004-11-28T22:55:12Z", "creator": "chip@force-elite.com", "creation_time": "2004-11-28T22:55:12Z", "is_private": false, "text": "Committed to trunk as svn revision 106850.\n"}, {"count": 13, "tags": [], "bug_id": 25718, "attachment_id": null, "is_private": false, "id": 68781, "time": "2004-12-22T02:55:58Z", "creator": "qhwt+apache@les.ath.cx", "creation_time": "2004-12-22T02:55:58Z", "text": "(In reply to comment #12)\n> Committed to trunk as svn revision 106850.\n\nThanks! Is there an expected date when this fix also gets\nbackported to release branches? The fix also (partially)\nresolves Bug 29858."}, {"count": 14, "tags": [], "bug_id": 25718, "attachment_id": null, "id": 68786, "time": "2004-12-22T05:38:52Z", "creator": "chip@force-elite.com", "creation_time": "2004-12-22T05:38:52Z", "is_private": false, "text": "I wasn't planning to backport this to apr-0.9.x or the 1.0.x branch.  I would prefer to relese this as \n1.1.0. (hopefully, that will happen sooner, rather than later).\n\nOpinion from others?"}, {"count": 15, "tags": [], "creator": "chip@force-elite.com", "is_private": false, "text": "This fix was released in 1.1.0", "id": 72320, "time": "2005-03-14T06:35:39Z", "bug_id": 25718, "creation_time": "2005-03-14T06:35:39Z", "attachment_id": null}]
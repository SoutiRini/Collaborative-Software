[{"count": 0, "tags": [], "text": "Created attachment 34603\nhs error file\n\nWe upgraded our application from the tomcat 6 to tomcat 8.5.4 32 bit for windows. For both these version we are using JDK 1.8. Our application runs with following JVM memory arguments.\nXms1024m\nXmx1280m\nMaxMetaspaceSize=256m\n\nBut post upgrade to 8.5.4, it would not start with these parameters. Indicating short of native memory. If we reduce the Xmx to 1180m, it would start without issues and even endure high load later on. Only startup was failing. We tracked some native memory for tomcat but did not show any significant change compared to tomcat 6.\nBelow is the status of the native memory failed process.\n\nNative Memory Tracking:\n\nTotal: reserved=1367758KB, committed=1188822KB\n-                 Java Heap (reserved=1208320KB, committed=1048704KB)\n                            (mmap: reserved=1208320KB, committed=1048704KB) \n \n-                     Class (reserved=74160KB, committed=74160KB)\n                            (classes #16635)\n                            (malloc=1072KB #12468) \n                            (mmap: reserved=73088KB, committed=73088KB) \n \n-                    Thread (reserved=22374KB, committed=22374KB)\n                            (thread #70)\n                            (stack: reserved=22080KB, committed=22080KB)\n                            (malloc=115KB #361) \n                            (arena=179KB #138)\n \n-                      Code (reserved=34714KB, committed=15898KB)\n                            (malloc=1434KB #3275) \n                            (mmap: reserved=33280KB, committed=14464KB) \n \n-                        GC (reserved=3995KB, committed=3491KB)\n                            (malloc=27KB #432) \n                            (mmap: reserved=3968KB, committed=3464KB) \n \n-                  Compiler (reserved=75KB, committed=75KB)\n                            (malloc=9KB #276) \n                            (arena=66KB #2)\n \n-                  Internal (reserved=2357KB, committed=2357KB)\n                            (malloc=2293KB #25250) \n                            (mmap: reserved=64KB, committed=64KB) \n \n-                    Symbol (reserved=19452KB, committed=19452KB)\n                            (malloc=15510KB #220835) \n                            (arena=3942KB #1)\n \n-    Native Memory Tracking (reserved=2114KB, committed=2114KB)\n                            (malloc=47KB #1427) \n                            (tracking overhead=2067KB)\n \n-               Arena Chunk (reserved=196KB, committed=196KB)\n                            (malloc=196KB) \n\nWithout any clue after several attempts to tune JVM, we switched to tomcat 8.5.9 and issue went away.Native memory did not show any change is usage. Not sure what it is that is fixing issue with this tomcat version. Any versions in between 8.5.4 to 8.5.8 it does not work. So something in 8.5.9 has helped us resolve issue with native memory. Not sure what it is. Can anyone help us here.", "attachment_id": 34603, "id": 195957, "creator": "maheshhendre@gmail.com", "time": "2017-01-10T14:22:42Z", "bug_id": 60568, "creation_time": "2017-01-10T14:22:42Z", "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 195968, "time": "2017-01-10T20:26:10Z", "bug_id": 60568, "creation_time": "2017-01-10T20:26:10Z", "is_private": false, "text": "If it works in 8.5.9 there is nothing to fix here. And even if it didn't, that one version needs more native memory to start than another is not sufficient proof of a bug."}, {"count": 2, "tags": [], "text": "Is there any possibility we get some hint regarding what components got modified from Tomcat 8.5.8 to 8.5.9, which might have affected the native memory footprint? This would give us some hint regarding tuning our tomcat upgrades.", "is_private": false, "id": 195972, "creator": "maheshhendre@gmail.com", "time": "2017-01-11T04:42:29Z", "bug_id": 60568, "creation_time": "2017-01-11T04:42:29Z", "attachment_id": null}]
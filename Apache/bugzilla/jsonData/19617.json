[{"count": 0, "tags": [], "creator": "mg@fork.pl", "attachment_id": null, "id": 36616, "time": "2003-05-02T22:48:53Z", "bug_id": 19617, "creation_time": "2003-05-02T22:48:53Z", "is_private": false, "text": "When I use @page directive in file that is included in other .jsp, all\nthe attributes of main page (encoding etc.) are lost. It's not possible\nto set those atributes in included page again\n(jsp.error.page.multiple.pageencoding is thrown from Validator.java), but\nit's possible to specify additional imports there. \n\nI included 2 files as an example - they both contain the same short text with\ntwo characters encoded in iso-8859-2. Compiled .java file contains two versions\nof the letters (right - from the main file, and wrong - from the included file -\nit's wrong because PageEncoding attribute is lost and reset to iso-8859-1)"}, {"count": 1, "tags": [], "bug_id": 19617, "attachment_id": 6177, "text": "Created attachment 6177\ntest-case - main file", "id": 36617, "time": "2003-05-02T22:50:07Z", "creator": "mg@fork.pl", "creation_time": "2003-05-02T22:50:07Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 19617, "attachment_id": 6178, "is_private": false, "id": 36618, "time": "2003-05-02T22:50:27Z", "creator": "mg@fork.pl", "creation_time": "2003-05-02T22:50:27Z", "text": "Created attachment 6178\ntest-case - included file"}, {"count": 3, "text": "Ok, I found the responsible piece of code:\nIt's ParserController.java (lines 252-270)\n\npageEncoding is set to ISO-8859-1 if:\n@page is found AND \npageEncoding is not specified AND \ncontentType is not specified \n\n(for included page they cannot be specified, so using @page \nwill always reset pageEncoding to ISO-8859-1)\n\nI don't know jasper's code so well to provide patch...", "creator": "mg@fork.pl", "attachment_id": null, "id": 36619, "time": "2003-05-02T23:09:19Z", "bug_id": 19617, "creation_time": "2003-05-02T23:09:19Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 19617, "text": "I think it would be a right solution (sorry for pasting it here, not as\nattachment - but I'm not sure about naming rules):\n\n--- ParserController.java       2003-03-19 09:20:58.000000000 +0100\n+++ ParserController_.java      2003-05-10 00:07:02.000000000 +0200\n@@ -264,7 +264,7 @@\n                            }\n                        }\n                        if (newEncoding == null)\n-                           newEncoding = \"ISO-8859-1\";\n+                           newEncoding = topFileEncoding;\n                    } else {\n                        return;\n                    }", "count": 4, "id": 37009, "time": "2003-05-09T22:11:24Z", "creator": "mg@fork.pl", "creation_time": "2003-05-09T22:11:24Z", "is_private": false}, {"count": 5, "tags": [], "creator": "kin-man.chung@sun.com", "text": "The spec never says the char encoding of the including page is the default\nencoding in the included page.  Applying the patch would make it\nnon-spec-conformant.\n\nIt would also mean that the interpretation of the included file can change, even\nif the bytes remain the same.  This can't be a good thing.\n\nHaving said that, I also admit that the spec is broken, since it does not\nprovide a way for the included file to speicify an encoding that is not the\ndefault (ISO-8859-1).  This is fixed in JSP 2.0, which allows encodings\n(possibly different) be specified for both the including and included files.\n\nSo I don't have objections to the patch, since it represents a good compromise\nto a broken spec; though it must be understood that is not compatible with\nTomcat 5.\n\n", "id": 37015, "time": "2003-05-10T01:14:43Z", "bug_id": 19617, "creation_time": "2003-05-10T01:14:43Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 19617, "is_private": false, "count": 6, "id": 37027, "time": "2003-05-10T19:55:50Z", "creator": "mg@fork.pl", "creation_time": "2003-05-10T19:55:50Z", "text": "I read jsp 1.2 specs again, it says (*highlites* added by me):\n\n<<\nA translation unit (JSP source file and any files included via the include\ndirective) can contain more than one instance of the page directive, all the\n*attributes will apply to the complete translation unit* (i.e. page directives\nare position independent). However, there shall be only one occurrence of any\nattribute/value defined by this directive in a given translation unit with the\nexception of the \u201cimport\u201d attribute; multiple uses of this attribute are\ncumulative (with ordered set union semantics). Other such multiple\nattribute/value (re)definitions result in a fatal translation error.\n>>\n\nSyntax Reference says more-less the same:\n\n<<\nThe page directive applies to an entire JSP page and any of its static include\nfiles, which together are called a translation unit. A static include file is a\nfile whose content becomes part of the calling JSP page. [...]\nYou can use the page directive more than once in a translation unit, but you can\nonly use each attribute, except import, once. \n>>\n\nSo - I can't see why the patch is not specs compatible. Please explain.\n"}, {"count": 7, "tags": [], "creator": "ysjj@unixuser.org", "is_private": false, "text": "Regardless of JSP spec, but, at least, the following comment is written in\nParserControll#parse method.\n\n[...]\n// Set the \"top level\" file encoding that will be used\n// for all included files where encoding is not defined.\n[...]\n\nSo, I think that the intention of the figureOutJspDocument is the following:\n\n--- ParserController.java\n+++ ParserController_.java\n@@ -263,7 +263,7 @@\n                            }\n                        }\n-                        if (newEncoding == null)\n+                        if (isTopFile && newEncoding == null)\n                            newEncoding = \"ISO-8859-1\";\n                    } else {\n                        return;\n                    }\n\nIt seems redundant and misleading that the topFileEncoding initialization is in\ndeclaration.", "id": 38651, "time": "2003-06-10T09:36:58Z", "bug_id": 19617, "creation_time": "2003-06-10T09:36:58Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "It seems to be fine solution. Will it be checked-in? ", "is_private": false, "id": 38688, "creator": "mg@fork.pl", "time": "2003-06-10T18:52:50Z", "bug_id": 19617, "creation_time": "2003-06-10T18:52:50Z", "attachment_id": null}, {"count": 9, "tags": [], "creator": "HeartBit@runeconsulting.com", "text": "please check bug id, http://nagoya.apache.org/bugzilla/show_bug.cgi?id=22645\ni have reported that bug and post a patch.\ni think the patch posted to bug 22645 could also solve this bug.\nit seems like more reasonable to set the top(including) page's encoding as \nsystem default encoding. (as my posted patch does)\n", "id": 43667, "time": "2003-09-03T14:00:25Z", "bug_id": 19617, "creation_time": "2003-09-03T14:00:25Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "medthomas@ntlworld.com", "attachment_id": null, "id": 44008, "time": "2003-09-10T23:05:43Z", "bug_id": 19617, "creation_time": "2003-09-10T23:05:43Z", "is_private": false, "text": "It has been previously decided (see duplicate bug) that this spec bug will not \nbe fixed.\n\n*** This bug has been marked as a duplicate of 19245 ***"}]
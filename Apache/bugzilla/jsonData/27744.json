[{"count": 0, "tags": [], "creator": "M.Kostrzewa@pentacomp.com.pl", "is_private": false, "text": "The minimal test is: \n \ntest plan \n +-Thread group (5 threads, 5 loops) \n   +-Http request (parameter aa=${clock}) \n   +-Counter (refname = clock) \n   +-View Results Tree \n \nThe problem: \nWhen running 1 thread, everything is fine, parameter aa sent with each request \nis incremented. \nWhen running multiple threads, the following error occures: \n \n \njava.lang.NullPointerException \n\tat \norg.apache.jmeter.modifiers.CounterConfig.iterationStart(CounterConfig.java:68) \n\tat \norg.apache.jmeter.control.GenericController.fireIterationStart(GenericController.java:273) \n\tat \norg.apache.jmeter.control.GenericController.fireIterEvents(GenericController.java:261) \n\tat \norg.apache.jmeter.control.GenericController.next(GenericController.java:89) \n\tat \norg.apache.jmeter.control.LoopController.nextIsNull(LoopController.java:134) \n\tat \norg.apache.jmeter.control.GenericController.next(GenericController.java:101) \n\tat org.apache.jmeter.threads.ThreadGroup.next(ThreadGroup.java:102) \n\tat org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:239) \n\tat java.lang.Thread.run(Thread.java:536) \n \nand the request isn't performed. \nSometimes (??) the request is sent, but with the parameter aa=${counter} (the \nvariable is not expanded) \n \nThis test works in last stable version.", "id": 54145, "time": "2004-03-17T15:09:02Z", "bug_id": 27744, "creation_time": "2004-03-17T15:09:02Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "M.Kostrzewa@pentacomp.com.pl", "is_private": false, "text": "Created attachment 10830\nThe testplan", "id": 54146, "time": "2004-03-17T15:14:27Z", "bug_id": 27744, "creation_time": "2004-03-17T15:14:27Z", "attachment_id": 10830}, {"count": 2, "tags": [], "creator": "M.Kostrzewa@pentacomp.com.pl", "attachment_id": null, "is_private": false, "id": 54149, "time": "2004-03-17T15:23:30Z", "bug_id": 27744, "creation_time": "2004-03-17T15:23:30Z", "text": "Some thoughts:\n\nThe CounterConfig class implements NoThreadClone. Without that everyting is OK\napart from that you can't share counter between threads (pretty obvious)\n\nThe UserParameters works OK, but I think it's just because it doesn't implement\nNoThreadClone\n\nThe problem with CounterConfig is it tries to do\ngetThreadContext().getVariables() which returns null. I found, that in some\ncases ThreadContext it's not initialized properly (the variables field is not\nset). See AbstractTestElement.getThreadContext() - the control goes to the\nfragment where the ThreadContext is created (without setting the variables)\n\n"}, {"count": 3, "tags": [], "creator": "M.Kostrzewa@pentacomp.com.pl", "attachment_id": null, "is_private": false, "id": 54172, "time": "2004-03-17T18:17:55Z", "bug_id": 27744, "creation_time": "2004-03-17T18:17:55Z", "text": "I think I've solved this.\n\nThe problem is that CounterConfig has field threadContext. When cloning test\ntrees on the beginning of the test, CounterConfig is not cloned (because it\nimplements NoThreadClone) and has one threadContext. Now it's run from different\nthreads, but uses only one threadContext. It results with not expanding of\nvariables. When the thread connected with treadContext is finished it calls\nthreadContext.clear() (which wips the variables out), and remaining threads\nthrows NullPointerException.\nI'm preparing the patch now... :)"}, {"count": 4, "tags": [], "bug_id": 27744, "text": "Created attachment 10833\nPatch against HEAD 2004/03/17", "id": 54175, "time": "2004-03-17T18:47:09Z", "creator": "M.Kostrzewa@pentacomp.com.pl", "creation_time": "2004-03-17T18:47:09Z", "is_private": false, "attachment_id": 10833}, {"count": 5, "tags": [], "creator": "M.Kostrzewa@pentacomp.com.pl", "attachment_id": null, "text": "I've sent patch. I'd like to ask you to test it. I have committer rights but I'd\nlike to know I didn't broke anything... :)\n\nTo apply invoke the command\npatch -p0 < path_to_patch\nfrom jmeter main dir", "id": 54176, "time": "2004-03-17T18:49:09Z", "bug_id": 27744, "creation_time": "2004-03-17T18:49:09Z", "is_private": false}, {"count": 6, "tags": [], "text": "Sebastian Bazley fixed this in CVS ", "attachment_id": null, "id": 54516, "creator": "M.Kostrzewa@pentacomp.com.pl", "time": "2004-03-23T23:12:46Z", "bug_id": 27744, "creation_time": "2004-03-23T23:12:46Z", "is_private": false}]
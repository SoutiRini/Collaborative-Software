[{"count": 0, "attachment_id": null, "creator": "massimo.sala.71@gmail.com", "text": "Environment: Windows XP home, SP3.\nI create a Windows user account \"joomla\", with restricted access.\nApache httpd.exe service runs under this account.\nIn httpd.conf I set\nErrorLog \"D:\\CMS\\apache.log\"\nI start the httpd service: it fails.\n\nI check the \"D:\\CMS\\apache.log\" file, it exists and this is its content:\n--------------------------------------------------------\n[Thu Nov 13 19:37:36 2008] [error] (OS 5)Accesso negato.  : could not open transfer log file C:/Programmi/Apache Software Foundation/Apache2.2/logs/access.log.\nUnable to open logs\n--------------------------------------------------------\n(\"Accesso negato\" is \"access denied\")\n\nWhy does Apache look at the installation path ?\n\nI open the Windows Event Viewer, Applications, source:=\"Apache Server\"\nand there is only this error, not pertinent:\n\"Could not reliably determine the server's fully qualified domain name, using 192.168.1.10 for ServerName\"\n\nI check the access permissions on the file, the user \"joomla\" is present:\n--------------------------------------------------------\nAccessChk v4.02 - Check access of files, keys, objects, processes or services\nCopyright (C) 2006-2007 Mark Russinovich\nSysinternals - www.sysinternals.com\nD:\\CMS\\apache.log\n  RW BUILTIN\\Administrators\n  RW NT AUTHORITY\\SYSTEM\n  RW MYPC\\joomla\n  R  BUILTIN\\Users\n--------------------------------------------------------\n\nIf I set the user account \"joomla\" in the \"Administrators\", httpd starts fine\nand the \"D:\\CMS\\apache.log\" file content is:\n--------------------------------------------------------\nhttpd.exe: Could not reliably determine the server's fully qualified domain name, using 192.168.1.10 for ServerName\n[Thu Nov 13 19:53:41 2008] [notice] Apache/2.2.10 (Win32) PHP/5.2.6 configured -- resuming normal operations\n[Thu Nov 13 19:53:41 2008] [notice] Server built: Oct 10 2008 12:39:04\n[Thu Nov 13 19:53:41 2008] [notice] Parent: Created child process 192\nhttpd.exe: Could not reliably determine the server's fully qualified domain name, using 192.168.1.10 for ServerName\n...\n--------------------------------------------------------\n\nDoes httpd need administrator rights to start ?\nIf yes, I think it will be useful to check the user account and warn the user.\nPossible places to warn the user:\n- ErrorLog file\n- Windows Events Logs\n- Apache Service Monitor\n\nMassimo", "id": 122440, "time": "2008-11-13T11:05:36Z", "bug_id": 46204, "creation_time": "2008-11-13T11:05:36Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 46204, "attachment_id": null, "text": "Access log is another kind of logs.\nTry the users list: http://httpd.apache.org/userslist.html", "id": 122456, "time": "2008-11-13T21:20:06Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-11-13T21:20:06Z", "is_private": false}, {"count": 2, "attachment_id": null, "creator": "massimo.sala.71@gmail.com", "is_private": false, "id": 122682, "time": "2008-11-20T10:48:59Z", "bug_id": 46204, "creation_time": "2008-11-20T10:48:59Z", "tags": [], "text": "Sorry for the confusion about the two log files, however the problem is open.\nIn httpd.conf\nErrorLog \"D:\\CMS\\apache-error.log\"\nCustomLog \"D:\\CMS\\apache-access.log\" common\n\nApache service is started by the user joomla, not administrator.\nApache service monitor : [START] : opens a messagebox \"the requested operation as failed!\"\n\nFile \"D:\\CMS\\apache-error.log\" :\n[Thu Nov 20 19:39:22 2008] [error] (OS 5)Accesso negato.  : could not create C:/Programmi/Apache Software Foundation/Apache2.2/logs/httpd.pid\n[Thu Nov 20 19:39:22 2008] [error] httpd.exe: could not log pid to file C:/Programmi/Apache Software Foundation/Apache2.2/logs/httpd.pid\n\nI put the user \"joomla\" in the Administrators of my pc.\nApache service monitor : [START] : ok, the service starts.\n\nWhy ?\nIt seems for certain operations linked to the logging process, httpd requires administrator privileges.\n\nMassimo\n\n"}, {"count": 3, "tags": [], "text": "In the source file \"httpd-2.2.10\\server\\log.c\"\nat line 793 I suggest to change the first parameter of apr_file_open\nfrom\n    if ((rv = apr_file_open(&pid_file, fname,\n                            APR_WRITE | APR_CREATE | APR_TRUNCATE,\n                            APR_UREAD | APR_UWRITE | APR_GREAD | APR_WREAD, p))\n\nto                            \n    if ((rv = apr_file_open(&pid_file, fname,\n                            APR_WRITE | APR_CREATE | APR_TRUNCATE,\n                            APR_OS_DEFAULT, p))\n\nas all the other apr_file_open() calls.\n\nMassimo", "is_private": false, "bug_id": 46204, "id": 122683, "time": "2008-11-20T11:05:05Z", "creator": "massimo.sala.71@gmail.com", "creation_time": "2008-11-20T11:05:05Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "This is not a user support forum, but this is;\nhttp://httpd.apache.org/userslist.html\n\nSee http://httpd.apache.org/docs/2.2/platform/windows.html#winsvc\nas you missed step 5. I believe, reread it.  If root-owned log files exist,\nremove them first.\n\nAbout your patch, did it fix things?  That simply grants the user permissions\nto access the log files.  They should not be default - they need to be more\nstrictly controlled.  In fact your suggested change may open a serious security\nhole.\n", "is_private": false, "bug_id": 46204, "id": 122686, "time": "2008-11-20T11:26:23Z", "creator": "wrowe@apache.org", "creation_time": "2008-11-20T11:26:23Z", "attachment_id": null}]
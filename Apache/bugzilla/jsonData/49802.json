[{"count": 0, "tags": [], "creator": "dometec@gmail.com", "is_private": false, "text": "Created attachment 25927\nCatalina log\n\nHi, \n  when Tomcat is under load from an Apache httpd server (through mod_jk and ajp13) and I shutdown it, I get NullPointerException:\n\n^C\n23-ago-2010 11.06.47 org.apache.coyote.http11.AbstractHttp11Protocol pause\nINFO: Pausing Coyote HTTP/1.1 on http-9080\n23-ago-2010 11.06.47 org.apache.coyote.ajp.AjpProtocol pause\nINFO: Pausing Coyote AJP/1.3 on ajp-9009\n23-ago-2010 11.06.48 org.apache.catalina.core.StandardService stopInternal\nINFO: Stopping service Catalina\n23-ago-2010 11.06.48 org.apache.catalina.connector.CoyoteAdapter service\nGRAVE: An exception or error occurred in the container during the request processing\njava.lang.NullPointerException\n        at org.apache.catalina.connector.CoyoteAdapter.postParseRequest(CoyoteAdapter.java:638)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:397)\n        at org.apache.coyote.ajp.AjpProcessor.process(AjpProcessor.java:450)\n        at org.apache.coyote.ajp.AjpProtocol$AjpConnectionHandler.process(AjpProtocol.java:385)\n...\n\nI think the stopping of the Coyote AJP Connector doesn't work. In fact, if you go with jconsole on MBean Catalina->Connector->8009 and do \"Stop\" on \"operation tab\", nothing happens.\n\nTo reproduce this bug:\n * Download Tomcat 7.0.2 \n * Confingure an Apache httpd with a JkMount /examples/*\n * Use ab to generate request (ex:  ab -c 3 -n 1000000 \"http://localhost/examples/jsp/jsp2/el/basic-arithmetic.jsp\")\n\nThank you,\n Domenico Briganti", "id": 139359, "time": "2010-08-23T05:59:48Z", "bug_id": 49802, "creation_time": "2010-08-23T05:59:48Z", "attachment_id": 25927}, {"count": 1, "tags": [], "bug_id": 49802, "attachment_id": null, "id": 139568, "time": "2010-08-30T19:14:43Z", "creator": "markt@apache.org", "creation_time": "2010-08-30T19:14:43Z", "is_private": false, "text": "The NPE you are seeing is a side-effect. The root cause is bug 49497.\n\nJMX not having any obvious affect is a separate bug. The connector is stopped (the state changes) but nothing is logged and it will continue to work since there is a mis-match in the state transitions between the Connector and the underlying ProtocolHandler.\n\nI have a patch for the start/stop issue but I want to take a closer look at the Connector & ProtocolHandler life-cycles to see if I can align them."}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 139704, "time": "2010-09-05T16:37:41Z", "bug_id": 49802, "creation_time": "2010-09-05T16:37:41Z", "text": "This bug has been fixed in 7.0.x and will be included in 7.0.3 onwards.\n\nNote: There is scope for further re-factoring to align the protocols and the endpoints with the new life-cycle code in 7.0.x."}]
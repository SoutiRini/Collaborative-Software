[{"count": 0, "tags": [], "creator": "cheng.fang@sun.com", "attachment_id": null, "id": 46552, "time": "2003-10-30T23:19:25Z", "bug_id": 24270, "creation_time": "2003-10-30T23:19:25Z", "is_private": false, "text": "I ran standalone tomcat nightly (10/29/2003) build with -security option, and\ndefault catlina.policy. When executing a jsp that uses reflection, internal\nerror occurred:  It happened on both Windows 200 pro and Solaris 9 Sparc, with\nj2se 1.4.2_01/_02\n\njavax.servlet.ServletException: java.lang.NoClassDefFoundError:\norg/apache/tomcat/util/http/FastHttpDateFormat\n\tat com.sun.ts.tests.jsp.common.util.JspTestUtil.invokeTest(JspTestUtil.java:78)\n\tat org.apache.jsp.JspWriterTest_jsp._jspService(JspWriterTest_jsp.java:510)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:311)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAsPrivileged(Subject.java:500)\n\tat org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)\n\tat org.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:200)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:278)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:97)\n\tat\norg.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:187)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:183)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n\tat\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:209)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:781)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:549)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:589)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:666)\n\tat java.lang.Thread.run(Thread.java:534)\n\nThe offending lines are just simple use of reflection, and the page does not\ndirectly reference any server internal classes:\n74:        try {\n75:            Method method = testObject.getClass().getMethod(test, TEST_ARGS);\n76:            method.invoke(testObject, new Object[]{req, res, out});\n77:        } catch (InvocationTargetException ite) {\n78:            throw new ServletException(ite.getTargetException().toString());"}, {"count": 1, "tags": [], "creator": "cheng.fang@sun.com", "attachment_id": 8840, "id": 46554, "time": "2003-10-30T23:34:24Z", "bug_id": 24270, "creation_time": "2003-10-30T23:34:24Z", "is_private": false, "text": "Created attachment 8840\nwar file to reproduce"}, {"attachment_id": null, "tags": [], "bug_id": 24270, "is_private": false, "count": 2, "id": 46555, "time": "2003-10-30T23:36:11Z", "creator": "cheng.fang@sun.com", "creation_time": "2003-10-30T23:36:11Z", "text": "http://localhost:8080/jsp_jspwriter_web/JspWriterTest.jsp?testname=jspWriterClearIOExceptionTest\nis the url that triggered the error with attached war.\n\nThe following is from catalina.out on Solaris:\nSecurity Violation, attempt to use Restricted Class:\norg.apache.jasper.compiler.Localizer\njava.security.AccessControlException: access denied (java.lang.RuntimePermission\naccessClassInPackage.org.apache.jasper.compiler)\n        at\njava.security.AccessControlContext.checkPermission(AccessControlContext.java:269)\n        at java.security.AccessController.checkPermission(AccessController.java:401)\n        at java.lang.SecurityManager.checkPermission(SecurityManager.java:524)\n        at java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1491)\n        at\norg.apache.catalina.loader.StandardClassLoader.loadClass(StandardClassLoader.java:820)\n        at\norg.apache.catalina.loader.StandardClassLoader.loadClass(StandardClassLoader.java:756)\n        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:302)\n        at org.apache.jasper.runtime.JspWriterImpl.clear(JspWriterImpl.java:178)\n        at\norg.apache.jsp.JspWriterTest_jsp.jspWriterClearIOExceptionTest(JspWriterTest_jsp.java:231)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at\ncom.sun.ts.tests.jsp.common.util.JspTestUtil.invokeTest(JspTestUtil.java:76)\n        at org.apache.jsp.JspWriterTest_jsp._jspService(JspWriterTest_jsp.java:510)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n        at\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:311)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:284)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at javax.security.auth.Subject.doAsPrivileged(Subject.java:500)\n        at org.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:306)\n        at\norg.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:200)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:278)\n        at\norg.apache.catalina.core.ApplicationFilterChain.access$000(ApplicationFilterChain.java:97)\n        at\norg.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:187)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:183)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n        at\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\n"}, {"count": 3, "tags": [], "creator": "jfarcand@apache.org", "attachment_id": null, "id": 46559, "time": "2003-10-31T01:35:34Z", "bug_id": 24270, "creation_time": "2003-10-31T01:35:34Z", "is_private": false, "text": "Fixed.\n\nThanks\n\n-- Jeanfrancois"}]
[{"count": 0, "tags": [], "bug_id": 56420, "is_private": false, "text": "When I use SUMIF function in xls file.\nIf predicate value is cell and cell value is null, org.apache.poi.ss.formula.functions.Sumif.accumulate method throws NullPointerException.\n\nThis is stack trace:\n\njava.lang.NullPointerException\n        at org.apache.poi.ss.formula.functions.Sumif.accumulate(Sumif.java:92)\n        at org.apache.poi.ss.formula.functions.Sumif.sumMatchingCells(Sumif.java:83)\n        at org.apache.poi.ss.formula.functions.Sumif.eval(Sumif.java:72)\n        at org.apache.poi.ss.formula.functions.Sumif.evaluate(Sumif.java:65)\n        at org.apache.poi.ss.formula.functions.Var2or3ArgFunction.evaluate(Var2or3ArgFunction.java:36)\n        at org.apache.poi.ss.formula.OperationEvaluatorFactory.evaluate(OperationEvaluatorFactory.java:132)\n        at org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:525)\n        at org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:288)\n        at org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:230)\n        at org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateFormulaCellValue(HSSFFormulaEvaluator.java:351)\n        at org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateFormulaCell(HSSFFormulaEvaluator.java:213)\n        at org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateAllFormulaCells(HSSFFormulaEvaluator.java:324)\n        at org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateAll(HSSFFormulaEvaluator.java:343)\n\nAnd this is the code that throws NullPointerException:\n\n(Sumif.java)\n 89   private static double accumulate(AreaEval aeRange, I_MatchPredicate mp, AreaEval aeSum, int relRowIndex,\n 90       int relColIndex) {\n 91\n 92     if (!mp.matches(aeRange.getRelativeValue(relRowIndex, relColIndex))) { // <------ This line\n 93       return 0.0;\n 94     }\n 95     ValueEval addend = aeSum.getRelativeValue(relRowIndex, relColIndex);\n 96     if (addend instanceof NumberEval) {\n 97       return ((NumberEval)addend).getNumberValue();\n 98     }\n 99     // everything else (including string and boolean values) counts as zero\n100     return 0.0;\n101   }\n\n\nI guess that mp is null when predicate value is null. But I have not verified it.\nAnyone can fix this bug?\n\n\n----\nYoshihiro Kameda", "id": 174662, "time": "2014-04-17T02:58:33Z", "creator": "kameda.sbng@gmail.com", "creation_time": "2014-04-17T02:58:33Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "apache@gagravarr.org", "is_private": false, "id": 174667, "time": "2014-04-17T10:50:14Z", "bug_id": 56420, "creation_time": "2014-04-17T10:50:14Z", "tags": [], "text": "Can you please share either a file that triggers the problem, or the steps (ideally as a junit test case) to create one that does?"}, {"count": 2, "attachment_id": null, "creator": "marc.simoneau@cf.gouv.qc.ca", "is_private": false, "id": 176191, "time": "2014-07-03T13:05:07Z", "bug_id": 56420, "creation_time": "2014-07-03T13:05:07Z", "tags": [], "text": "I've got the same issu. \n\nI add the attachment \"test.xlsx\", where you can find :\n\n__|__A__|__B__|__C__|__D__|__...__|\n_1|a    |    1|     |     |       |\n_2|b    |    2|     |     |       |\n_3|     |     |    0|     |       |\n_4|d    |    3|     |     |       |\n_5|     |     |     |     |       |\n\nThe formula is in C3 : =SUMIF($A$1:$A$4;A3;$B$1:$B$4)\n\nHe here is the code to get the NullPointerException :\n\nprivate static void POI_sumif() throws IOException {\n        Workbook wb = new XSSFWorkbook(new FileInputStream(new File(\"C:/Temp/test.xlsx\")));\n        FormulaEvaluator evaluator = wb.getCreationHelper()\n                        .createFormulaEvaluator();\n        try {\n            Cell c = wb.getSheetAt(0).getRow(2).getCell(2);\n            System.out.println(c.getCellFormula());\n            evaluator.evaluateInCell(c);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }"}, {"count": 3, "tags": [], "bug_id": 56420, "attachment_id": 31783, "text": "Created attachment 31783\nfor bug 56420", "id": 176192, "time": "2014-07-03T13:06:23Z", "creator": "marc.simoneau@cf.gouv.qc.ca", "creation_time": "2014-07-03T13:06:23Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 56420, "is_private": false, "text": "Thanks for the file. In r1607661 I've added a unit test for this problem\n\nThe test is currently disabled though, as the bug exists...\n\nWould be great if someone could now use the unit test to dig into the formula code, and see why the problem is happening...", "id": 176194, "time": "2014-07-03T14:32:02Z", "creator": "apache@gagravarr.org", "creation_time": "2014-07-03T14:32:02Z", "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "dominik.stadler@gmx.at", "is_private": false, "id": 183657, "time": "2015-06-20T11:30:56Z", "bug_id": 56420, "creation_time": "2015-06-20T11:30:56Z", "tags": [], "text": "Fixed via r1686564, the formula contains a reference to an empty cell and Sumif did not take this possible null-result into account."}]
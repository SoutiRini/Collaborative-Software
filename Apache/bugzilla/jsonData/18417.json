[{"count": 0, "tags": [], "text": "Set Header AFTER filling up the Content buffer, the content is flushed to client\nonce it is filled up, correctly, except header is set:\n\npublic void service(HttpServletRequest request, HttpServletResponse response)\n                               throws ServletException, IOException\n    {\n        int size = 40;\n        response.setContentLength(size);\n\n        PrintWriter pw = response.getWriter();\n        pw.println(\"Test PASSED\");\n        StringBuffer tmp= new StringBuffer(2*size);\n        int i = 0;\n\n        while ( i < 8) {\n             tmp = tmp.append(\"111111111x\");\n             i = i+1;\n        }\n        pw.println(tmp);\n        response.addIntHeader(\"header1\", 12345);\n    }", "is_private": false, "bug_id": 18417, "id": 33944, "time": "2003-03-27T16:34:50Z", "creator": "dianne.jiao@sun.com", "creation_time": "2003-03-27T16:34:50Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "dianne.jiao@sun.com", "text": "Created attachment 5538\nAdded a test case war file for reproduce the problem", "id": 33946, "time": "2003-03-27T16:36:39Z", "bug_id": 18417, "creation_time": "2003-03-27T16:36:39Z", "is_private": false, "attachment_id": 5538}, {"count": 2, "tags": [], "text": "I do not agree with the bug report. If the response print writer is actually\ncommitted (I don't think it is here), then the header will be swallowed.", "is_private": false, "id": 33947, "creator": "remm@apache.org", "time": "2003-03-27T16:50:43Z", "bug_id": 18417, "creation_time": "2003-03-27T16:50:43Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "dianne.jiao@sun.com", "is_private": false, "text": "Here is the statement from Servlet Spec 2.4 public final draft 2:\n\nFrom SRV.5.5 Closure of Response Object:\n\"When a response is closed, the container must immediately flush all remaining\ncontent in the response buffer to the client. The following events indicate that\nthe servlet has satisfied the request and that the response object is to be\nclosed:\n*The termination of the service method of the servlet.\n*The amount of content specified in the setContentLength method of the response\nhas been written to the response.\n*The sendError method is called.\n*The sendRedirect method is called.\n\"\n\nAnd from SRV.5.2 Headers(the second last paragraph):\n\"To be successfully transmitted back to the client, headers must be set before\nthe response is committed. Headers set after the response is committed will be\nignored by the servlet container.\n\"", "id": 33962, "time": "2003-03-27T18:07:09Z", "bug_id": 18417, "creation_time": "2003-03-27T18:07:09Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 18417, "text": "Oooh, I'm extremely sorry, it is only another very lame requirement of the\nservlet spec.", "id": 33965, "time": "2003-03-27T18:12:38Z", "creator": "remm@apache.org", "creation_time": "2003-03-27T18:12:38Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 33971, "time": "2003-03-27T18:35:27Z", "bug_id": 18417, "creation_time": "2003-03-27T18:35:27Z", "text": "I don't think I was able to run your test case.\nI really do not see what buisness the specification has with that kind of stupid\nrequirements (in 99% percent of today use cases, the content length will not be\nknown or set; the biggest exception are static files, but that's an internal\nfeature of the container, so who cares; lame, lame)."}, {"count": 6, "tags": [], "bug_id": 18417, "attachment_id": null, "is_private": false, "id": 33974, "time": "2003-03-27T18:40:52Z", "creator": "remm@apache.org", "creation_time": "2003-03-27T18:40:52Z", "text": "I got:\n\njava.lang.NullPointerException\n\tat\ncom.sun.ts.tests.servlet.common.servlets.HttpTCKServlet.invokeTest(HttpTCKServlet.java:75)\n\tat\ncom.sun.ts.tests.servlet.common.servlets.HttpTCKServlet.doGet(HttpTCKServlet.java:102)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:740)\n\n/RedirectTest did work.\n\nAlso, there's no source in the ZIP, so I cannot check things up. You should\ninclude the source if you can."}, {"count": 7, "tags": [], "creator": "dianne.jiao@sun.com", "attachment_id": null, "text": "I hate to do it,  but you can use this URL to reproduce the problem if you can\naccess my machine:\nhttp://slappy.east.sun.com/servlet_spec_httpservletresponse_web/HttpTestServlet?testname=flushBufferTest", "id": 33975, "time": "2003-03-27T18:47:03Z", "bug_id": 18417, "creation_time": "2003-03-27T18:47:03Z", "is_private": false}, {"count": 8, "tags": [], "creator": "dianne.jiao@sun.com", "is_private": false, "text": "Rem, You did find a packaging problem with the war file, that caused NPE. \nThanks.  \nHere is the war file that properly packaged.\n\nThe servlet source is described in original description.\n\n", "id": 33980, "time": "2003-03-27T19:12:21Z", "bug_id": 18417, "creation_time": "2003-03-27T19:12:21Z", "attachment_id": null}, {"count": 9, "attachment_id": 5546, "bug_id": 18417, "is_private": false, "id": 33982, "time": "2003-03-27T19:13:38Z", "creator": "dianne.jiao@sun.com", "creation_time": "2003-03-27T19:13:38Z", "tags": [], "text": "Created attachment 5546\nupdated test case"}, {"count": 10, "tags": [], "creator": "dianne.jiao@sun.com", "attachment_id": null, "text": "Verified in today's cvs build. Thanks.", "id": 34201, "time": "2003-03-31T22:19:17Z", "bug_id": 18417, "creation_time": "2003-03-31T22:19:17Z", "is_private": false}]
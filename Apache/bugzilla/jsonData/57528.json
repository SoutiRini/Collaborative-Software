[{"count": 0, "tags": [], "bug_id": 57528, "attachment_id": null, "id": 180725, "time": "2015-02-03T13:20:47Z", "creator": "gdogaru@gmail.com", "creation_time": "2015-02-03T13:20:47Z", "is_private": false, "text": "From time to time I get a NPE when calling a rest api with content-type=multipart/form-data\nThe request does not get to spring framework filters, it fails inside tomcat.\nI am not using web sockets in my app\nThe same bug is reproducible both on linux and windows, with the zip version and tomcat 8.0.18  (I think also with tomcat 7 and older versions of 8)\n\njava.lang.NullPointerException\n\torg.apache.catalina.webresources.AbstractArchiveResource.getContent(AbstractArchiveResource.java:177)\n\torg.apache.catalina.loader.WebappClassLoaderBase.findResourceInternal(WebappClassLoaderBase.java:2579)\n\torg.apache.catalina.loader.WebappClassLoaderBase.findClassInternal(WebappClassLoaderBase.java:2405)\n\torg.apache.catalina.loader.WebappClassLoaderBase.findClass(WebappClassLoaderBase.java:854)\n\torg.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1274)\n\torg.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1157)\n\torg.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:998)\n\torg.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:955)\n\torg.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:877)\n\torg.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:966)\n\torg.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:868)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:644)\n\torg.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:842)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:725)\n\torg.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)\n\tcom.knod.core.logging.RequestLoggingFilter.doFilterInternal(RequestLoggingFilter.java:51)\n\torg.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)\n\tcom.codahale.metrics.servlet.AbstractInstrumentedFilter.doFilter(AbstractInstrumentedFilter.java:97)\n\tcom.knod.core.cors.CorsKnodFilter.doFilterInternal(CorsKnodFilter.java:27)\n\torg.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)"}, {"count": 1, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "\n\n> ...\n> org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1157)\n> org.springframework.web.servlet.DispatcherServlet.processDispatchResult(DispatcherServlet.java:998)\n> ...\n\nI wonder why DispatcherServlet loads a class here. I wonder what class it tries to load.\n\nGenerally DispatcherServlet is a frequently executed piece of code. Maybe you are hitting a rare path that does not have the necessary classes loaded.\n\nLooking into Spring 4.1.4 (I do not know your Spring version, line numbers do not match), there are no explicit loadClass() calls in DispatcherServlet. Thus this class loading is implicit one.\n\n\nLook into Tomcat log files for the information on when your web application started and whether it was stopped or reloaded recently.\n\nIf a web application has been stopped, class loading should fail, though I would expect it to fail in a different way.\n\n\nCan you provide a simple web application reproducing the issue?\n\n\n> I think also with tomcat 7\n\nResources implementation with Tomcat 7 is rather different. There is no \"org.apache.catalina.webresources.AbstractArchiveResource\" in Tomcat 7.", "id": 180729, "time": "2015-02-03T13:50:36Z", "bug_id": 57528, "creation_time": "2015-02-03T13:50:36Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 57528, "text": "I get these failures when running my integration tests. \ntomcat is started using the cargo maven plugin\nthat is a freshly downloaded tomcat 8, added jdbc libs in common/lib and cargo app\n\nspring version is 4.1.4 and usually all the rest are at the last version\n\nI can not provide the project, but I will look to see if I can create one, just no ETA\nI don't get this when I run from the ide, it's just weird that it happens from time to time on command line", "id": 180733, "time": "2015-02-03T14:30:49Z", "creator": "gdogaru@gmail.com", "creation_time": "2015-02-03T14:30:49Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "Enable debug logging for org.apache.catalina.webresources.JarResource  and org.apache.catalina.webresources.JarWarResource\n\nThat will tell you if there is an IOException causing the null.", "attachment_id": null, "id": 180754, "creator": "markt@apache.org", "time": "2015-02-04T19:26:22Z", "bug_id": 57528, "creation_time": "2015-02-04T19:26:22Z", "is_private": false}, {"count": 4, "tags": [], "text": "It has been a month and no debug logging has been provided. Closing as invalid on the assumption that the OP enabled debug logging and identified the root cause as something other than a Tomcat bug.\n\nIf this is not correct and you still see this error then please re-open this issue and attach the requested debug log information that will provide details as to why a null is returned in this case.", "is_private": false, "id": 181458, "creator": "markt@apache.org", "time": "2015-03-03T09:39:50Z", "bug_id": 57528, "creation_time": "2015-03-03T09:39:50Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "I was having this same problem sporadically.  Was hoping to find an answer here; however, I have been able to diagnose and fix my problem.  Thought it might be good to post here in hopes of helping future people.\n\nMy issue turned out to be that the operating system was running out of file handles.  So, it was failing to load a class not because of a Tomcat bug but because it could not open up the class file.\n\nIncreasing the file handle limits on my OS fixed my problem.  i.e. http://tuxgen.blogspot.com/2014/01/centosrhel-ulimit-and-maximum-number-of.html", "attachment_id": null, "id": 187877, "creator": "griffin.brent@gmail.com", "time": "2016-01-21T17:16:23Z", "bug_id": 57528, "creation_time": "2016-01-21T17:16:23Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 57528, "is_private": false, "id": 187917, "time": "2016-01-22T20:44:17Z", "creator": "chris@christopherschultz.net", "creation_time": "2016-01-22T20:44:17Z", "tags": [], "text": "(In reply to Brent Griffin from comment #5)\n> My issue turned out to be that the operating system was running out of file\n> handles.  So, it was failing to load a class not because of a Tomcat bug but\n> because it could not open up the class file.\n\n... and the \"out of file handles was causing an NPE with the originally-reported stack trace? That's ... very weird. I would have expected an OOME with a reason string."}]
[{"count": 0, "tags": [], "text": "We use Apache 2.2.8 with mod_JK 1.2.26 with a Tomcat 5.5 cluster.\nWe use Custom HTTP-Error codes like 450 for authentication-purposes. Those codes get remapped to 500.\nThe Error-Code 450 is in the RFC2616 described as valid return code so this is a bug.\n\nThe custom error-codes worked fine in Apache 1.3.41 with MOD_JK/1.2.25.\n\n\nYou can easily reproduce this bug by writing a jsp-page with the following line:\n<%response.setStatus(450);%>", "attachment_id": null, "id": 116596, "creator": "jan.schulte@hp.com", "time": "2008-05-14T00:37:27Z", "bug_id": 44995, "creation_time": "2008-05-14T00:37:27Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 44995, "attachment_id": null, "text": "Whatever this is, it's not a bug in the Apache core, since other generators (e.g. CGI, asis) can send a 450 response just fine, and mod_proxy will happily relay it from a backend.\n\nThat leaves mod_proxy_ajp or mod_jk as possible culprits, but I'd suspect it's more likely your backend.  Please reopen if and when you can identify an Apache component being at fault here.", "id": 116597, "time": "2008-05-14T01:46:39Z", "creator": "nick@webthing.com", "creation_time": "2008-05-14T01:46:39Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 44995, "attachment_id": null, "text": "It's quite clear that this is not an environmental issue as we have seen this behaviour in different installations. So it seems that mod_JK is the faulty component.\n\n", "id": 116599, "time": "2008-05-14T02:14:12Z", "creator": "jan.schulte@hp.com", "creation_time": "2008-05-14T02:14:12Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 44995, "attachment_id": null, "id": 116662, "time": "2008-05-15T10:06:30Z", "creator": "nick@webthing.com", "creation_time": "2008-05-15T10:06:30Z", "is_private": false, "text": "mod_jk is a tomcat component.  We (httpd) don't maintain it, so if there is a bug, it won't get noticed or fixed here."}, {"count": 4, "tags": [], "bug_id": 44995, "text": "\nCouldn't the below listed function from http_protocol.c the probem?\nWith defines \n#define LEVEL_400   19  \n#define LEVEL_500   44\n#define  RESPONSE_CODES  55   \n\nI can't see how an valid index for 450 could be returned with this function\n\n\n\n/* The index is found by its offset from the x00 code of each level.\n * Although this is fast, it will need to be replaced if some nutcase\n * decides to define a high-numbered code before the lower numbers.\n * If that sad event occurs, replace the code below with a linear search\n * from status_lines[shortcut[i]] to status_lines[shortcut[i+1]-1];\n */\nAP_DECLARE(int) ap_index_of_response(int status)\n{\n    static int shortcut[6] = {0, LEVEL_200, LEVEL_300, LEVEL_400,\n    LEVEL_500, RESPONSE_CODES};\n    int i, pos;\n\n    if (status < 100) {               /* Below 100 is illegal for HTTP\nstatus */\n        return LEVEL_500;\n    }\n\n    for (i = 0; i < 5; i++) {\n        status -= 100;\n        if (status < 100) {\n            pos = (status + shortcut[i]);\n            if (pos < shortcut[i + 1]) {\n                return pos;\n            }\n            else {\n                return LEVEL_500;            /* status unknown (falls in\ngap) */\n            }\n        }\n    }\n    return LEVEL_500;                         /* 600 or above is also\nillegal */\n}\n\n", "id": 116796, "time": "2008-05-19T02:54:17Z", "creator": "jan.schulte@hp.com", "creation_time": "2008-05-19T02:54:17Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 44995, "attachment_id": null, "id": 116948, "time": "2008-05-24T09:10:33Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-05-24T09:10:33Z", "is_private": false, "text": "There is a discussion on httpd-dev about this problem. See\n\nhttp://marc.info/?t=121128830700002&r=1&w=2\n\nand the related entry BZ 45026\n\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=45026\n\nThe analysis is done. The custom status code leads to an empty reason phrase (e.g. the status line is of the form \"NNN \" and no textual message behind the trailing space. This is legal per RFC 2616, but leads to a replacement with status code 500 inside httpd.\n\nThere are three places, where we could fix the problematic status line:\n\n1) Tomcat sending \"NNN NNN\" instead of \"NNN \" (likely to happen)\n2) mod_jk fixing \"NNN \" to \"NNN NNN\" (likely to happen)\n3) httpd either allowing \"NNN \" or alternatively also rewriting it to \"NNN NNN\".\n\nThis is under discussion, so I'm reopening the bug as a reminder.\n\nAll three options above make sense together, in order to fix the problem whenever at least one of the three components is recent enough.\n"}, {"count": 6, "attachment_id": 22018, "bug_id": 44995, "text": "Created attachment 22018\nMake httpd tolerate empty reason phrases in status line\n\nThis patch changes the validity check for the httpd status line in the following ways:\n\n- Allow empty reason phrase\n- Allow status line of the form \"NNN\" but add mandatory trailing space\n- replace comparison for ' ' with apr_isspace for better consistency with second part of the patch", "id": 117039, "time": "2008-05-27T12:12:21Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-05-27T12:12:21Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "text": "Created attachment 22019\nMake httpd tolerate more status lines in combination with error pages\n\nThis patch changes the rules whether to include the status line in the error page response in the following ways:\n\n- Allow empty reason phrase, but add \"Unknown Reason\" in this case\n- Allow status line of the form \"NNN\" but add mandatory trailing space and \"Unknown Reason\"\n- replace previous check if first 3 chars in status line are numeric with the test for the correct status int used in http_filters.c\n\nBoth patches are not yet thoroughly tested. If the point into the right direction, I'll test.", "attachment_id": 22019, "id": 117040, "creator": "rainer.jung@kippdata.de", "time": "2008-05-27T12:17:35Z", "bug_id": 44995, "creation_time": "2008-05-27T12:17:35Z", "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 44995, "text": "Patches committed to trunk, r693108", "id": 120457, "time": "2008-09-08T07:21:16Z", "creator": "nick@webthing.com", "creation_time": "2008-09-08T07:21:16Z", "tags": [], "is_private": false}, {"count": 9, "attachment_id": null, "bug_id": 44995, "text": "Fixed in trunk long ago, but I don't feel motivated to propose for backport just in case anything breaks.  Will come for free in 2.3/2.4, so I guess that counts as LATER.\n\nAlso it's only an enhancement, since it's just error-tolerance.", "id": 133122, "time": "2009-12-26T12:05:00Z", "creator": "nick@webthing.com", "creation_time": "2009-12-26T12:05:00Z", "tags": [], "is_private": false}]
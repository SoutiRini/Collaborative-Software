[{"count": 0, "text": "I think the following Tomcat 6 bug is reoccuring in Tomcat 7.0.26:\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=43683", "bug_id": 53024, "attachment_id": null, "id": 157059, "time": "2012-04-02T14:28:13Z", "creator": "yoursoft@freemail.hu", "creation_time": "2012-04-02T14:28:13Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 53024, "text": "Do you have any evidence to support a regression claim? Test case?", "id": 157110, "time": "2012-04-03T20:24:28Z", "creator": "chris@christopherschultz.net", "creation_time": "2012-04-03T20:24:28Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 53024, "text": "Created attachment 28542\nTest application\n\nTest application", "id": 157143, "time": "2012-04-04T11:30:55Z", "creator": "yoursoft@freemail.hu", "creation_time": "2012-04-04T11:30:55Z", "is_private": false, "attachment_id": 28542}, {"count": 3, "tags": [], "bug_id": 53024, "attachment_id": null, "text": "Test case:\n\n- Unzip the downloaded Tomcat 7.0.26 from tomcat.apache.org site\n- Edit the unzipped dir/conf/tomcat-users.xml. Add the following line:\n  <user password=\"ide\" roles=\"standard,manager-gui,admin\" username=\"ide\"/>\n- Unzip the attached \"Test application\" into the unzipped dir/webapps\n- start tomcat\n- open http://localhost:8080/ServletRestartTest/ServletRestartTest\n- open the manager application (http://localhost:8080/manager/html) with ide/ide\n- reload the ServletRestartTest application from manager application\n- while it reloading try to reload the http://localhost:8080/ServletRestartTest/ServletRestartTest url.\n- You will get a 404 error page", "id": 157145, "time": "2012-04-04T11:40:27Z", "creator": "yoursoft@freemail.hu", "creation_time": "2012-04-04T11:40:27Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 53024, "attachment_id": null, "text": "The problem seems to be that the wrappers (servlets) are unregistered from the context as part of the stop process. If a request comes in before the context is started again, then no wrapper gets mapped to the request and StandardContextValve returns SC_NOT_FOUND.", "id": 157248, "time": "2012-04-07T00:59:09Z", "creator": "karlpenney@eastlink.ca", "creation_time": "2012-04-07T00:59:09Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 53024, "attachment_id": null, "id": 157740, "time": "2012-04-09T16:28:16Z", "creator": "chris@christopherschultz.net", "creation_time": "2012-04-09T16:28:16Z", "is_private": false, "text": "(In reply to comment #4)\n> The problem seems to be that the wrappers (servlets) are unregistered from the\n> context as part of the stop process. If a request comes in before the context\n> is started again, then no wrapper gets mapped to the request and\n> StandardContextValve returns SC_NOT_FOUND.\n\nThis isn't a bug: it's how Tomcat works. Why would your undeployed context still be able to successfully serve requests?"}, {"count": 6, "tags": [], "bug_id": 53024, "attachment_id": null, "text": "It shouldn't reject requests while the context is being reloaded. The StandardContextValve waits for the reload to complete, but by that point it can be too late since the request wrapper might not have gotten set. Maybe Tomcat should not unregister the wrappers when a context is reloaded?", "id": 157744, "time": "2012-04-09T18:07:46Z", "creator": "karlpenney@eastlink.ca", "creation_time": "2012-04-09T18:07:46Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 53024, "attachment_id": null, "id": 157793, "time": "2012-04-10T18:12:03Z", "creator": "yoursoft@freemail.hu", "creation_time": "2012-04-10T18:12:03Z", "is_private": false, "text": "> This isn't a bug: it's how Tomcat works. Why would your undeployed context\n> still be able to successfully serve requests?\n\nTomcat 6 doesn't send 404 when context is reloading."}, {"count": 8, "tags": [], "bug_id": 53024, "attachment_id": null, "text": "I can recreate this with the provided test case. The 404 response is not the expected behaviour. Tomcat should pause the request until the application finishes reloading and then server.", "id": 158882, "time": "2012-05-07T14:15:21Z", "creator": "markt@apache.org", "creation_time": "2012-05-07T14:15:21Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 53024, "text": "Thanks for the test case. This has been fixed in trunk and 7.0.x and will be included in 7.0.28 onwards.\n\nI also took the opportunity to improve the handling when a watched resource (such as web.xml) changes. This is now handled with a reload (so no 404s) rather than stop followed by a start.", "id": 158909, "time": "2012-05-08T19:08:09Z", "creator": "markt@apache.org", "creation_time": "2012-05-08T19:08:09Z", "is_private": false, "attachment_id": null}]
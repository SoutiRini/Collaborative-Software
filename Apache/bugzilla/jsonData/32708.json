[{"count": 0, "tags": [], "text": "When doing a request.getParameter, or a request.getParameterNames, the Tomcat\nServer comes up with this message:\nDec 14, 2004 11:53:28 PM org.apache.catalina.core.StandardWrapperValve invoke\nSEVERE: Servlet.service() for servlet controller threw exception\njava.lang.NullPointerException\n\tat org.apache.tomcat.util.buf.StringCache$ByteEntry.hashCode(StringCache.java:633)\n\tat java.util.HashMap.hash(Unknown Source)\n\tat java.util.HashMap.get(Unknown Source)\n\tat org.apache.tomcat.util.buf.StringCache.toString(StringCache.java:284)\n\tat org.apache.tomcat.util.buf.ByteChunk.toString(ByteChunk.java:461)\n\tat org.apache.tomcat.util.http.Parameters.urlDecode(Parameters.java:411)\n\tat org.apache.tomcat.util.http.Parameters.processParameters(Parameters.java:391)\n\tat org.apache.tomcat.util.http.Parameters.processParameters(Parameters.java:504)\n\tat\norg.apache.tomcat.util.http.Parameters.handleQueryParameters(Parameters.java:265)\n\tat org.apache.catalina.connector.Request.parseParameters(Request.java:2299)\n\tat org.apache.catalina.connector.Request.getParameter(Request.java:991)\n\tat org.apache.catalina.connector.RequestFacade.getParameter(RequestFacade.java:262)\n\tat nl.printfill.controller.Controller.process(Controller.java:86)\n\tat nl.printfill.controller.Controller.doGet(Controller.java:62)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:689)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:237)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:157)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:214)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:825)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:731)\n\tat\norg.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:526)\n\tat\norg.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)\n\tat java.lang.Thread.run(Unknown Source)\n\n\nThis is (part of) the code which procudures the error:\n\n\n    HttpSession session = request.getSession();\n\n    String actionName = request.getParameter(Action.ACTION);  // line 86\n\n    if(actionName != null)\n    {\n      Action action = (Action) ActionFactory.getAction(actionName);\n\n\nErik", "attachment_id": null, "id": 68532, "creator": "epragt@zonnet.nl", "time": "2004-12-15T00:06:16Z", "bug_id": 32708, "creation_time": "2004-12-15T00:06:16Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 32708, "attachment_id": null, "is_private": false, "id": 68535, "time": "2004-12-15T00:15:35Z", "creator": "remm@apache.org", "creation_time": "2004-12-15T00:15:35Z", "text": "Do you see this in conf/catalina.properties:\ntomcat.util.buf.StringCache.byte.enabled=true ?\nSo you can easily work around the problem."}, {"count": 2, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "I don't understand what causes the bug. Can you submit a better test case\n(similar code runs fine for me) ?\n\nIt's really odd that you're getting an exception there, because it can only\nhappen if the String value is null, and this should be filtered out before going\ninto the StringCache because it's obviously useless. I could make the code a\nlittle bit more defensive, but this should not be needed.", "id": 68539, "time": "2004-12-15T00:26:55Z", "bug_id": 32708, "creation_time": "2004-12-15T00:26:55Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 32708, "text": "(In reply to comment #2)\n> I don't understand what causes the bug. Can you submit a better test case\n> (similar code runs fine for me) ?\n\nYou could also get it from an unsupported encoding in toStringInternal.\n", "id": 68547, "time": "2004-12-15T02:57:55Z", "creator": "william.barker@wilshire.com", "creation_time": "2004-12-15T02:57:55Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "epragt@zonnet.nl", "is_private": false, "id": 68555, "attachment_id": null, "bug_id": 32708, "creation_time": "2004-12-15T10:18:55Z", "time": "2004-12-15T10:18:55Z", "text": "(In reply to comment #1)\n> Do you see this in conf/catalina.properties:\n> tomcat.util.buf.StringCache.byte.enabled=true ?\n> So you can easily work around the problem.\n\nDone, which works, but causes other problems like getting 'white pages' on some\nGET requests.\n\nI found out how the problem arrised. When looking in server.xml, was a connector\nentry:\n\n<Connector URIEncoding=\"null\" enableLookups=\"true\" port=\"9000\" redirectPort=\"-1\"\nbacklog=\"10\" disableUploadTimeout=\"false\">\n</Connector>\n\nAs you can see, the URIUncoding is null. I don't know what it means excactly,\nbut I didn't put it there. I used the admin tool to add the connector. I'd like\nto try to reproduce the problem, but my Admin tool doesn't work anymore. I\ncannot collapse items (I don't know if I should file this as another bug report,\nbut I cannot say more than: my menuitems don't collapse anymore after adding a\nnew service...)\n\nAfter removing the URIencoding, everything is working fine again, even after\nre-enabling the StringCache."}, {"count": 5, "tags": [], "bug_id": 32708, "text": "(In reply to comment #2)\n> I don't understand what causes the bug. Can you submit a better test case\n> (similar code runs fine for me) ?\n> \n> It's really odd that you're getting an exception there, because it can only\n> happen if the String value is null, and this should be filtered out before going\n> into the StringCache because it's obviously useless. I could make the code a\n> little bit more defensive, but this should not be needed.\n\nps, please leave the code unchanged. I like the webserver to not when something\nis not right, instead of eg. continue-ing the webserver and maybe causing some\nservere errors elsewhere, while not knowing what caused the problem.\n", "id": 68556, "attachment_id": null, "creator": "epragt@zonnet.nl", "creation_time": "2004-12-15T10:21:22Z", "time": "2004-12-15T10:21:22Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 32708, "text": "(In reply to comment #5)\n\n> ps, please leave the code unchanged. I like the webserver to not when something\n> is not right, instead of eg. continue-ing the webserver and maybe causing some\n> servere errors elsewhere, while not knowing what caused the problem.\n> \n[type]\n\nI like the webserver to not when... = I like the webserver to 'crash' when...\n", "id": 68557, "time": "2004-12-15T10:37:31Z", "creator": "epragt@zonnet.nl", "creation_time": "2004-12-15T10:37:31Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 32708, "text": "Then the cause of the problem is what Bill said: an invalid encoding is used for\nthe String. I think I should be able to reproduce the issue now, and I'll try to\nsee if I can improve the situation.\n\nThe admin works again in 5.5.6, BTW. I don't know if it handles connectors\ncorrectly or not, as I didn't use it at all in the 5.5 branch.", "id": 68559, "time": "2004-12-15T12:02:45Z", "creator": "remm@apache.org", "creation_time": "2004-12-15T12:02:45Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "text": "I tried the admin webapp, and while it's probably not perfect for connector\nhandling, it didn't save bad information (such as URIEncoding=\"null\"), and\nTomcat operated fine after a restart.", "attachment_id": null, "id": 68561, "creator": "remm@apache.org", "time": "2004-12-15T12:57:13Z", "bug_id": 32708, "creation_time": "2004-12-15T12:57:13Z", "is_private": false}]
[{"attachment_id": null, "tags": [], "bug_id": 49557, "text": "line 232:s_env[i+1] = tcn_get_string(e, str);\n\nthis will crash the java vm for a violate access error.", "count": 0, "id": 138197, "time": "2010-07-05T22:03:58Z", "creator": "lanyuflying@gmail.com", "creation_time": "2010-07-05T22:03:58Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 49557, "text": "What are you trying to do?", "id": 143126, "time": "2011-01-06T11:49:54Z", "creator": "jfclere@gmail.com", "creation_time": "2011-01-06T11:49:54Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "is_private": false, "id": 143149, "time": "2011-01-06T18:15:41Z", "bug_id": 49557, "creation_time": "2011-01-06T18:15:41Z", "text": "He tries to launch an external program with a Proc.create() call, I think.\n\nI see two problems in the current implementation of Proc::create in proc.c of native 1.1:\n\n1)\n    if (env)\n        es = (*e)->GetArrayLength(e, args);\ncalculates the length of the \"args\" array, where \"env\" array is expected. I think it is the actual cause of access violation error.\n\n2)\n            s_env[i+1] = tcn_get_string(e, str);\nas OP noted, should be\n            s_env[i] = tcn_get_string(e, str);\n\nNote, that if the \"[i+1]\" in the code were correct, there is\n        s_env[i++] = apr_psprintf(p, TCN_PARENT_IDE \"=%d\", getpid());\nassignment later, that will overwrite the last env. variable value in that case.\n\n\nThis is probably not an error:\nI see a cycle of free() calls to clear calls for s_env values. I do not see a free() call for the value assigned with\n  s_env[i++] = apr_psprintf(p, TCN_PARENT_IDE \"=%d\", getpid());\nProbably that is not needed, because it was allocated from a pool?"}, {"count": 3, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": 26464, "is_private": false, "id": 143150, "time": "2011-01-06T18:17:54Z", "bug_id": 49557, "creation_time": "2011-01-06T18:17:54Z", "text": "Created attachment 26464\nPatch for proc.c of native/1.1.x. (not tested)"}, {"count": 4, "text": "*** Bug 49556 has been marked as a duplicate of this bug. ***", "bug_id": 49557, "is_private": false, "id": 143156, "time": "2011-01-06T21:22:50Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-01-06T21:22:50Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 49557, "is_private": false, "count": 5, "id": 143163, "time": "2011-01-07T03:22:10Z", "creator": "jfclere@gmail.com", "creation_time": "2011-01-07T03:22:10Z", "text": "the free() are needed as the tcn_get_string makes malloc()."}, {"count": 6, "tags": [], "creator": "jfclere@gmail.com", "attachment_id": null, "text": "Fixed by r1056218", "id": 143164, "time": "2011-01-07T03:28:39Z", "bug_id": 49557, "creation_time": "2011-01-07T03:28:39Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "paucoma@gmail.com", "attachment_id": 31587, "text": "Created attachment 31587\nMulti-Conditional-Formatting Rules saved as Old Excel Format\n\nIt is possible to **create a file in Excel 2007, Excel 2010, LibreOffice Calc, etc... with more than 3 conditional formatting rules per cell** and then **Save it in the Excel 2003 format** , preserving those defined rules.\n\nWhen POI detects the pre 2007 Excel format, it opens it with HSSFWorkbook and all the rest... and when it bumps into more than 3 rules defined it throws an exception.\n\nIf this same file is opened in LibreOffice for example and saved in 2007/2010 format and then opened again with the workbookFactory it creates an XSSFWorkbook and everything works ok.\n\n  ---\n\n** Example Files **\n\n[Multi-Conditional-Formatting Rules saved as Old Excel Format XLS](http://www.filedropper.com/mcfrsaxls)\n[Multi-Conditional-Formatting Rules saved as New Excel Format XLSX](http://www.filedropper.com/mcfrsaxlsx)\n\n  ---\n\nIn [this blog post from excel support group](http://office.microsoft.com/en-us/excel-help/create-flexible-effective-conditional-formats-in-excel-2007-HA010217629.aspx) It states: \n\n  > In previous versions of Excel, you could have a maximum of three conditional formats. There's no such limit in Office Excel 2007; you may have as many conditional formats as you like.\n\n  - Because **pre-2007/2010** Excel files were limited to 3 rules, the library object is also limited to 3. The [CFRecordsAggregate class](http://poi.apache.org/apidocs/org/apache/poi/hssf/record/aggregates/CFRecordsAggregate.html) states in its description:\n\n  > CFRecordsAggregate - aggregates Conditional Formatting records CFHeaderRecord and number of **up to three CFRuleRecord records** together to simplify access to them.\n\n  ---\n\nException output:\n\njava.lang.IllegalArgumentException: No more than 3 rules may be specified\n\tat org.apache.poi.hssf.record.aggregates.CFRecordsAggregate.<init>(CFRecordsAggregate.java:58)\n\tat org.apache.poi.hssf.record.aggregates.CFRecordsAggregate.createCFAggregate(CFRecordsAggregate.java:95)\n\tat org.apache.poi.hssf.record.aggregates.ConditionalFormattingTable.<init>(ConditionalFormattingTable.java:49)\n\tat org.apache.poi.hssf.model.InternalSheet.<init>(InternalSheet.java:143)\n\tat org.apache.poi.hssf.model.InternalSheet.createSheet(InternalSheet.java:121)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:311)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:264)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:199)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:342)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:323)\n\tat org.apache.poi.ss.usermodel.WorkbookFactory.create(WorkbookFactory.java:76)", "id": 174981, "time": "2014-05-02T12:34:04Z", "bug_id": 56482, "creation_time": "2014-05-02T12:34:04Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 56482, "attachment_id": null, "id": 174987, "time": "2014-05-02T15:49:43Z", "creator": "apache@gagravarr.org", "creation_time": "2014-05-02T15:49:43Z", "is_private": false, "text": "Thanks for the test file and investigations. Changed from an error to a logged compatibility warning in r1591959."}]
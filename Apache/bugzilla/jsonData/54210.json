[{"count": 0, "tags": [], "bug_id": 54210, "text": "Created attachment 29643\nThis zip contains the PPT file and the PNG image resulting from the code above\n\nWhen converting the attached PPT file with HSLF, and the code below, some of the text (but not all of it) is rendered as if seen in a mirror (see the PNG file attached).\n\nCode snippet: \n\nInputStream is = getInputStream(); //A FileInputStream on the ppt file\nSlideShow ppt = new SlideShow(is);\n\nDimension pgsize = ppt.getPageSize();\ndouble scaleW = (double)TARGET_WIDTH / (double)pgsize.width;\ndouble scaleH = (double)TARGET_HEIGHT / (double)pgsize.height;\ndouble scale = Math.min(scaleW, scaleH);\nint width = (int) (pgsize.width * scale);\nint height = (int) (pgsize.height * scale);\n\nSlide[] slide = ppt.getSlides();\nfor (int i = 0; i < slide.length; i++) \n{\n\tBufferedImage img = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);\n\tGraphics2D graphics = img.createGraphics();\n\tgraphics.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);\n\tgraphics.setRenderingHint(RenderingHints.KEY_RENDERING, RenderingHints.VALUE_RENDER_QUALITY);\n\tgraphics.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BICUBIC);\n\tgraphics.setRenderingHint(RenderingHints.KEY_FRACTIONALMETRICS, RenderingHints.VALUE_FRACTIONALMETRICS_ON);\n\n\tgraphics.setPaint(Color.white);\n\tgraphics.clearRect(0, 0, width, height);\n\n\tgraphics.scale((double)width/pgsize.width, (double)height/pgsize.height);\n\n\tslide[i].draw(graphics);\n\n\t// save the result\n\tFile image = new File(root, \"slide\"+Integer.toString(i)+\".png\");\n\tImageIO.write(img, \"png\", image);\n}", "id": 163674, "time": "2012-11-27T09:30:47Z", "creator": "vincent.kirsch@iriscorporate.com", "creation_time": "2012-11-27T09:30:47Z", "is_private": false, "attachment_id": 29643}, {"count": 1, "tags": [], "bug_id": 54210, "attachment_id": null, "id": 163680, "time": "2012-11-27T14:26:12Z", "creator": "yegor@dinom.ru", "creation_time": "2012-11-27T14:26:12Z", "is_private": false, "text": "The trouble is with rendering text in flipped shapes. It appears that text in shapes follows the rotation transform, but does not follow the flip transform. That is, if a shape is rotated then any text inside this shape is rotated too, but if a shape is flipped then the text follows the original (not flipped) transform. In current implementation it is not so and the text in flipped shapes is painted upside down. \nPPTX2PNG has the same problem."}, {"count": 2, "tags": [], "creator": "vincent.kirsch@iriscorporate.com", "attachment_id": null, "text": "Here's a proposed patch that takes horizontal and vertic", "id": 163724, "time": "2012-11-29T10:02:28Z", "bug_id": 54210, "creation_time": "2012-11-29T10:02:28Z", "is_private": false}, {"count": 3, "tags": [], "creator": "vincent.kirsch@iriscorporate.com", "is_private": false, "text": "Created attachment 29654\nProposed patch generated with patch.xml\n\nHere's a proposed patch that takes horizontal and vertical flips, as well as rotation for TextPainter", "id": 163726, "time": "2012-11-29T10:05:45Z", "bug_id": 54210, "creation_time": "2012-11-29T10:05:45Z", "attachment_id": 29654}, {"count": 4, "tags": [], "text": "The patch is empty. Please try again.\n\n(In reply to comment #3)\n> Created attachment 29654 [details]\n> Proposed patch generated with patch.xml\n> \n> Here's a proposed patch that takes horizontal and vertical flips, as well as\n> rotation for TextPainter", "attachment_id": null, "id": 163728, "creator": "yegor@dinom.ru", "time": "2012-11-29T10:59:25Z", "bug_id": 54210, "creation_time": "2012-11-29T10:59:25Z", "is_private": false}, {"count": 5, "tags": [], "creator": "vincent.kirsch@iriscorporate.com", "attachment_id": 29656, "text": "Created attachment 29656\nText patch\n\nThe gerenated gz patch does not seem to contain the patch; however, a patch.txt file is generated with the changes in it, so I attached that one instead, hope it'll be ok.", "id": 163730, "time": "2012-11-29T12:22:25Z", "bug_id": 54210, "creation_time": "2012-11-29T12:22:25Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 54210, "attachment_id": null, "id": 163764, "time": "2012-12-02T12:27:01Z", "creator": "yegor@dinom.ru", "creation_time": "2012-12-02T12:27:01Z", "is_private": false, "text": "Thanks for the patch, applied in r1416165 with some tweaks.\n\nYegor"}, {"count": 7, "attachment_id": null, "bug_id": 54210, "is_private": false, "id": 163770, "time": "2012-12-03T06:51:57Z", "creator": "vincent.kirsch@iriscorporate.com", "creation_time": "2012-12-03T06:51:57Z", "tags": [], "text": "You're welcome! Any idea ni what release it would be included and when that would be released?\n\n(In reply to comment #6)\n> Thanks for the patch, applied in r1416165 with some tweaks.\n> \n> Yegor"}, {"count": 8, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "text": "The fix will be included in POI-4.0 which is expected in 2013. I recommend to use the latest build from trunk which can be downloaded from https://builds.apache.org/job/POI/lastSuccessfulBuild/artifact/build/dist/\n\nYegor\n\n(In reply to comment #7)\n> You're welcome! Any idea ni what release it would be included and when that\n> would be released?\n> \n> (In reply to comment #6)\n> > Thanks for the patch, applied in r1416165 with some tweaks.\n> > \n> > Yegor", "id": 163771, "time": "2012-12-03T08:06:10Z", "bug_id": 54210, "creation_time": "2012-12-03T08:06:10Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 54210, "text": "The fix will be included in POI-4.0 which is expected in 2013. I recommend to use the latest build from trunk which can be downloaded from https://builds.apache.org/job/POI/lastSuccessfulBuild/artifact/build/dist/\n\nYegor\n\n(In reply to comment #7)\n> You're welcome! Any idea ni what release it would be included and when that\n> would be released?\n> \n> (In reply to comment #6)\n> > Thanks for the patch, applied in r1416165 with some tweaks.\n> > \n> > Yegor", "id": 163772, "time": "2012-12-03T08:20:22Z", "creator": "yegor@dinom.ru", "creation_time": "2012-12-03T08:20:22Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "vincent.kirsch@iriscorporate.com", "is_private": false, "text": "Hello, do you have any idea of when version 4.0 will be released?\n\nAlternatively, would it be possible to include the fix for this bug in in 3.9.X release?\n\nThanks.", "id": 166691, "time": "2013-04-18T14:42:45Z", "bug_id": 54210, "creation_time": "2013-04-18T14:42:45Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "It's unlikely to be very soon, as most of the committers to Apache POI are very busy, and there are a lot of contributed patches that need to be applied first\n\nfor now, you can either use a nightly build, or checkout from svn and build yourself", "attachment_id": null, "id": 166692, "creator": "apache@gagravarr.org", "time": "2013-04-18T15:06:39Z", "bug_id": 54210, "creation_time": "2013-04-18T15:06:39Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 54210, "attachment_id": null, "id": 172994, "time": "2014-02-11T15:10:43Z", "creator": "vincent.kirsch@iriscorporate.com", "creation_time": "2014-02-11T15:10:43Z", "is_private": false, "text": "Hello,\n\nI just did a test with POI 3.10-FINAL which according to http://poi.apache.org/changes.html should contain the fix (it's included since the beta-1), but I still have the image mirrored from the ppt in the attachemnt I sent when I opened the issue.\n\nNote that to be able to test, the ppt must first be edited and the title's font changed from Calibri to anything else, because there seems to be a JDK bug that gives an ArrayOutOfBoundException when using the Calibri font. I changed to Arial and after that I still get the mirrored version. Would it be possible to have another look? \n\nThanks,\nVincent."}, {"count": 13, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "text": "It'd be helpful if you could create a test file with various flipped / rotated / flipped and rotated bits of text in it. Ideally with a few different fonts and sizes for each one. Maybe a few directional shapes too, while we're at it.\n\nWith that done, please attach the file, try rendering it with POI, and report back which ones work and which ones don't.\n\nWith that info, it'll be much easier to hone in on what's still a problem, and which bits we've already fixed", "id": 173022, "time": "2014-02-13T12:05:14Z", "bug_id": 54210, "creation_time": "2014-02-13T12:05:14Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 54210, "text": "Well I attached a ZIP file when I created the issue; it contains a .ppt file which shows the issue when used with the code I mentioned in my first comment. \n\nTo be honest I have no idea how the PPT was created as it came from a customer of mine (I just changed the text). But that file definitely causes the issue.\n\nI re-attached it with the font changed as I previously explained that the JJVM can't seem to handle Calibri anymore, and put the result PNG I get after calling the aforementioned code.\n\nIs that sufficient for you?", "id": 173038, "time": "2014-02-14T08:05:02Z", "creator": "vincent.kirsch@iriscorporate.com", "creation_time": "2014-02-14T08:05:02Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 54210, "attachment_id": 31312, "is_private": false, "id": 173039, "time": "2014-02-14T08:06:03Z", "creator": "vincent.kirsch@iriscorporate.com", "creation_time": "2014-02-14T08:06:03Z", "text": "Created attachment 31312\nA PPT test case and the result of the conversion"}, {"count": 16, "attachment_id": null, "bug_id": 54210, "text": "The backward.ppt fails in JDK 1.6.0_45, but works in JDK 1.7.0_45 (Windows) with the current POI trunk and the text is also displayed the same way as the MS PPT Viewer would do.\nThere's a quite recent bug report on IBM JDK [1], which is probably the same for Oracle/Sun JDK 1.6.\n\nIs it really necessary to workaround the linebreak measurer stuff in POI?\n(... maybe skip JDK 1.6 support and continue with 1.7 directly :) ...)\n\n[1] http://www-01.ibm.com/support/docview.wss?uid=swg1IV47787", "id": 173048, "time": "2014-02-14T21:47:24Z", "creator": "kiwiwings@apache.org", "creation_time": "2014-02-14T21:47:24Z", "tags": [], "is_private": false}, {"count": 17, "tags": [], "bug_id": 54210, "attachment_id": null, "text": "Hello, do you have any news about this?\n\nCheers\nVincent", "id": 177806, "time": "2014-09-12T12:00:08Z", "creator": "vincent.kirsch@iriscorporate.com", "creation_time": "2014-09-12T12:00:08Z", "is_private": false}, {"count": 18, "tags": [], "creator": "kiwiwings@apache.org", "is_private": false, "text": "Is this related to #55644, i.e. is this affected by the following JDK bug?\n\nhttps://bugs.openjdk.java.net/browse/JDK-8013716", "id": 177891, "time": "2014-09-15T16:52:08Z", "bug_id": 54210, "creation_time": "2014-09-15T16:52:08Z", "attachment_id": null}, {"count": 19, "tags": [], "creator": "vincent.kirsch@iriscorporate.com", "attachment_id": null, "id": 177903, "time": "2014-09-16T06:57:59Z", "bug_id": 54210, "creation_time": "2014-09-16T06:57:59Z", "is_private": false, "text": "Hi,\n\nthanks for your reply.\n\nI only discovered what is described in the linked issue by trying to prepare a test case for the original issue, which is that some text was mirrored (inverted). \n\nI submitted a patch that was adapted and integrated a relatively long time ago (a few months); then I downloaded a version of POI that integrated that patch, but I still had the issue, and I created a test case, where I noticed the font issue.\n\nSo in short, no, it's not linked, and the original issue was still there last time I tried. That being said, I haven't tried since February, maybe it's been fixed in the meantime, but then I would have expected this issue to be updated :)\n\nCheers\nVincent"}, {"count": 20, "tags": [], "creator": "kiwiwings@apache.org", "attachment_id": null, "id": 177910, "time": "2014-09-16T19:32:02Z", "bug_id": 54210, "creation_time": "2014-09-16T19:32:02Z", "is_private": false, "text": "I've just validated the rendering.\n\nThe expected output is non-mirrored texts, right!?\n\nOn my Win7/64 machine with the 32-bit version of 1.6.45 but with the old fontmanager.dll of 1.6.43 it works. with the 1.6.45-fontmanager.dll I get the AIOOBE. with 1.7.45 it works."}, {"count": 21, "tags": [], "bug_id": 54210, "text": "I wonder if it's worth putting something on the site to list \"known broken\" JVMs for Apache POI? IIRC Apache Lucene do something similar for ones they have found to not work", "id": 177917, "time": "2014-09-17T06:48:54Z", "creator": "apache@gagravarr.org", "creation_time": "2014-09-17T06:48:54Z", "is_private": false, "attachment_id": null}, {"count": 22, "attachment_id": null, "bug_id": 54210, "text": "Hi,\n\nWhat is the status of this issue? \n\nI see it's marked as 'NEEDINFO', however I don't see what more I can provide.\n\nThe last comments brought some confusion to me;\n\nThe goal is indeed to not have flipped text, no matter the font used in the document.\n\nThanks!\nVincent", "id": 184880, "time": "2015-08-31T15:37:56Z", "creator": "vincent.kirsch@iriscorporate.com", "creation_time": "2015-08-31T15:37:56Z", "tags": [], "is_private": false}, {"count": 23, "tags": [], "creator": "kiwiwings@apache.org", "is_private": false, "text": "I've changed two issues as part of r1714290\n- the default alignment of text is now top\n- the old flipping code contained an unnecessary rotation, instead of it the \ncode now traverses the parent group for flipping and supports text rotation, \ni.e. an additional rotation to the shape rotation", "id": 186380, "time": "2015-11-14T02:48:47Z", "bug_id": 54210, "creation_time": "2015-11-14T02:48:47Z", "attachment_id": null}, {"count": 24, "tags": [], "bug_id": 54210, "text": "Hi,\n\nThanks very much.\n\nDo you know in what version this will be available, and when it will be released?\n\nThanks,\nVincent.", "id": 186661, "time": "2015-11-30T13:01:29Z", "creator": "vincent.kirsch@iriscorporate.com", "creation_time": "2015-11-30T13:01:29Z", "is_private": false, "attachment_id": null}, {"count": 25, "tags": [], "text": "We are working towards 3.14-Beta1 now - which will be available in 1-2 weeks.\nI think most of the changes were already in 3.13 with the common-sl upgrade,\nbut the next beta contains the fixes mentioned in comment 23", "attachment_id": null, "id": 186663, "creator": "kiwiwings@apache.org", "time": "2015-11-30T14:25:35Z", "bug_id": 54210, "creation_time": "2015-11-30T14:25:35Z", "is_private": false}, {"count": 26, "attachment_id": null, "bug_id": 54210, "is_private": false, "id": 186664, "time": "2015-11-30T14:31:47Z", "creator": "vincent.kirsch@iriscorporate.com", "creation_time": "2015-11-30T14:31:47Z", "tags": [], "text": "OK thanks for the info. I'll try to find some time to test the 3.14 beta when it's out."}]
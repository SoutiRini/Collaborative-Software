[{"count": 0, "tags": [], "creator": "weejim@ecquaria.com", "text": "suspect that the release() is not executed after the taghandler instance's \nlifecycle has ended.\n\nto produce bug, \n1. copy the tld file to webapp root. \n2. compile the tag handler to <webapp>/WEB-INF/classes. \n3. copy test.jsp to server and access it.\n4. refresh the page(test.jsp), java.lang.ArrayIndexOutOfBoundsException will be \nencountered on alternate browser refresh.\n\n\ntld file\n------------------\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\" ?>\n<!DOCTYPE taglib\n PUBLIC \"-//Sun Microsystems, Inc.//DTD JSP Tag Library 1.1//EN\"\n \"http://java.sun.com/j2ee/dtds/web-jsptaglibrary_1_1.dtd\">\n<taglib>\n  <tlibversion>1.0</tlibversion>\n  <jspversion>1.1</jspversion>\n  <shortname>test</shortname>\n  <info>\n    A tag library for the pagination, product of Ecquaria Technologies Pte Ltd.\n    http://www.ecquaria.com/.\n  </info>\n\n\t<tag>\n\t\t<name>loop</name>\n\t\t<tagclass>test.ArrayTag</tagclass>\n\t</tag>\n\n</taglib>\n\n\n\nTaghandler\n-----------------------\npackage test;\nimport java.io.*;\nimport java.util.*;\nimport javax.servlet.http.*;\nimport javax.servlet.jsp.*;\nimport javax.servlet.jsp.tagext.*;\n\npublic class ArrayTag extends BodyTagSupport{\n\tprivate BodyContent bodyContent;\n\tprivate int index = -1;\n\tprivate final int[] data = new int[] {0, 1, 2};\n\n////////////////// tag support interface methods //////////////////////////\n\tpublic void setBodyContent(BodyContent b) {\n\t\tthis.bodyContent = b;\n\t}\n\n  /**\n   * Method called at start of Tag\n   * @return either a EVAL_BODY_TAG or a SKIP_BODY\n   */\n\tpublic int doStartTag() throws javax.servlet.jsp.JspException {\n\t\treturn EVAL_BODY_TAG;\n\t}//doStartTag\n\n\t//only only be called at most once\n\tpublic void doInitBody() throws JspException {}\n\n\t//@return EVAL_BODY_TAG, SKIP_BODY\n\tpublic int doAfterBody() throws JspException{\n\t\t++index;\n\t\tSystem.out.print(\"[ArrayTag] index: \" + index );\n\t\tSystem.out.println(\", current data: \" + data[index]);\n\t\treturn (index<data.length-1) ? EVAL_BODY_TAG : SKIP_BODY;\n\t}\n\n\n\t/**\n\t * Method called at end of Tag\n\t * @return either EVAL_PAGE or SKIP_PAGE\n\t */\n\tpublic int doEndTag() throws javax.servlet.jsp.JspException {\n\t\tSystem.out.println(\"in doEndTag.\");\n\t\treturn EVAL_PAGE;\t//to continue evaluating the rest of \nthe JSP.\n\t}//doEndTag\n\n\n\t/** Reset the state of the tag, to enable reuse of tag handler \ninstances. */\n\tpublic void release() {\n\t\tthis.bodyContent = null;\n\t\tthis.index = -1;\n\t\tsuper.release();\n\t}//release\n\n}//class ArrayTag\n\n\n\ntest.jsp\n-----------------\n<%@ taglib uri=\"/test.tld\" prefix=\"test\"%>\n<%\n  int iii = 0;\n  System.out.println(\"\\n\\n-------------\");\n%>\n\n<html>\n<body>\nhi there!\n<test:loop>\n\t<%\n\t\tSystem.out.println(\"iii: \" + (iii++));\n\t%>\n</test:loop>\n\n</body>\n</html>", "id": 23742, "time": "2002-10-02T09:05:42Z", "bug_id": 13194, "creation_time": "2002-10-02T09:05:42Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 13194, "attachment_id": null, "id": 24446, "time": "2002-10-14T08:03:44Z", "creator": "jshiell@infernal.net.nz", "creation_time": "2002-10-14T08:03:44Z", "is_private": false, "text": "Agree, appears to not be calling release() method.\n\nAttempted with a custom iteration tag of mine; tag only runs once. If I forcably\nreset the iterator to the beginning of the list in doStartTag then it works;\notherwise it appears the iterator is not reset and we remain at the end of the\nlist when running the tag again."}, {"count": 2, "tags": [], "bug_id": 13194, "is_private": false, "text": "This other bug contains a detailed explanation.\n\n*** This bug has been marked as a duplicate of 13392 ***", "id": 24452, "time": "2002-10-14T08:14:21Z", "creator": "remm@apache.org", "creation_time": "2002-10-14T08:14:21Z", "attachment_id": null}]
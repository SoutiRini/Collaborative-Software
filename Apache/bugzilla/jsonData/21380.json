[{"count": 0, "tags": [], "creator": "seanlist@msgilligan.com", "attachment_id": null, "id": 40105, "time": "2003-07-07T20:41:34Z", "bug_id": 21380, "creation_time": "2003-07-07T20:41:34Z", "is_private": false, "text": "The FOP Ant task currently always renders the output.  The attached patch will\nrender only when the source file (.fo) is newer then the target (.pdf, etc.). \nThere is also a \"force\" flag that can be used to always render.\n\ncvs diff -u src/documentation/content/xdocs/anttask.xml\nsrc/org/apache/fop/tools/anttasks/Fop.java \nIndex: src/documentation/content/xdocs/anttask.xml\n===================================================================\nRCS file: /home/cvspublic/xml-fop/src/documentation/content/xdocs/anttask.xml,v\nretrieving revision 1.3.2.1\ndiff -u -u -r1.3.2.1 anttask.xml\n--- src/documentation/content/xdocs/anttask.xml 19 May 2003 11:20:27 -0000     \n1.3.2.1\n+++ src/documentation/content/xdocs/anttask.xml 7 Jul 2003 20:38:12 -0000\n@@ -90,7 +90,12 @@\n                        (<code>true</code>) or not (<code>false</code>)</td> \n        <td>No, default is <code>true</code></td> \n       </tr> \n-     </table>\n+      <tr> \n+       <td>force</td> \n+       <td>Recreate target files, even if they are newer than their\ncorresponding source files.</td> \n+       <td>No, default is <code>true</code></td> \n+      </tr> \n+    </table>\n         <p/>\n         <table><caption>Parameters specified as nested elements</caption>\n       <tr> \n@@ -104,7 +109,7 @@\n                        are used to specify multiple XSL-FO files to be\nrendered.</td> \n        <td>Yes, if no fofile attribute is supplied</td> \n       </tr> \n-         </table>\n+        </table>\n     </section>\n     <section>\n     <title>Examples</title>\nIndex: src/org/apache/fop/tools/anttasks/Fop.java\n===================================================================\nRCS file: /home/cvspublic/xml-fop/src/org/apache/fop/tools/anttasks/Attic/Fop.java,v\nretrieving revision 1.14.2.8\ndiff -u -u -r1.14.2.8 Fop.java\n--- src/org/apache/fop/tools/anttasks/Fop.java  25 Feb 2003 15:19:58 -0000     \n1.14.2.8\n+++ src/org/apache/fop/tools/anttasks/Fop.java  7 Jul 2003 20:38:12 -0000\n@@ -92,6 +92,7 @@\n  * <li>userconfig -> file with user configuration (same as the \"-c\" command\nline option)</li>\n  * <li>messagelevel -> (error | warn | info | verbose | debug) level to output\nnon-error messages</li>\n  * <li>logFiles -> Controls whether the names of the files that are processed\nare logged or not</li>\n+ * <li>force -> Recreate target files, even if they are newer than their\ncorresponding source files</li>\n  * </ul>\n  */\n public class Fop extends Task {\n@@ -105,6 +106,7 @@\n     File userConfig;\n     int messageType = Project.MSG_VERBOSE;\n     boolean logFiles = true;\n+    boolean force = true;         // Ignore modification dates if true\n \n     /**\n      * Sets the input file\n@@ -238,6 +240,20 @@\n     }\n \n     /**\n+     * Sets force (ignore mod dates) flag \n+     */\n+    public void setForce(boolean aBoolean) {\n+        this.force = aBoolean;\n+    }\n+\n+    /**\n+     * Gets force (ignore mod dates) flag\n+     */\n+    public boolean getForce() {\n+        return this.force;\n+    }\n+\n+    /**\n      * Starts execution of this task\n      */\n     public void execute() throws BuildException {\n@@ -369,8 +385,13 @@\n                 if (task.getOutdir() != null) {\n                     outf = new File(task.getOutdir(), outf.getName());\n                 }\n-                render(task.getFofile(), outf, rint);\n-                actioncount++;\n+                // Only render if \"force\" flag is set OR output file doesn't\nexist OR\n+                // output file is older than input file\n+                if ( task.force || !outf.exists() ||\n+                    (task.getFofile().lastModified() > outf.lastModified() ) ) {\n+                    render(task.getFofile(), outf, rint);\n+                    actioncount++;\n+                }\n             }\n         }\n \n@@ -413,15 +434,17 @@\n                     task.log(\"Error setting base directory: \" + e,\nProject.MSG_ERR);\n                 }\n \n-                render(f, outf, rint);\n-                actioncount++;\n+                // Only render if \"force\" flag is set OR output file doesn't\nexist OR\n+                // output file is older than input file\n+                if ( task.force || !outf.exists() || (f.lastModified() >\noutf.lastModified() ) ) {\n+                    render(f, outf, rint);\n+                    actioncount++;\n+                }\n             }\n         }\n \n         if (actioncount == 0) {\n-            task.log(\n-              \"No files processed. No files were selected by the filesets and\nno fofile was set.\" ,\n-              Project.MSG_WARN);\n+            task.log(\"Nothing to do.\" , Project.MSG_WARN);\n         }\n     }"}, {"count": 1, "tags": [], "creator": "glenmazza@yahoo.com", "attachment_id": null, "is_private": false, "id": 45867, "time": "2003-10-17T22:26:35Z", "bug_id": 21380, "creation_time": "2003-10-17T22:26:35Z", "text": "Added to both maintenance and development branches.  Thanks for the submission!"}, {"count": 2, "tags": [], "creator": "gadams@apache.org", "attachment_id": null, "is_private": false, "id": 155788, "time": "2012-04-01T06:40:43Z", "bug_id": 21380, "creation_time": "2012-04-01T06:40:43Z", "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed"}]
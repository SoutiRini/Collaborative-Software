[{"count": 0, "tags": [], "bug_id": 60818, "attachment_id": null, "text": "The printing to CSV is not threadsafe and may lead to garbled CSV files, which cannot be read in again.", "id": 197452, "time": "2017-03-04T10:37:19Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2017-03-04T10:37:19Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 60818, "attachment_id": null, "text": "Date: Sat Mar  4 10:55:15 2017\nNew Revision: 1785464\n\nURL: http://svn.apache.org/viewvc?rev=1785464&view=rev\nLog:\nSynchronize file access while writing CSV data.\n\nBugzilla Id: 60818\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/reporters/ResultCollector.java\n    jmeter/trunk/xdocs/changes.xml", "id": 197453, "time": "2017-03-04T10:57:52Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2017-03-04T10:57:52Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 60818, "attachment_id": null, "text": "I don't think this is the solution.\n\nAFAICT println() is thread-safe, as it uses its own internal lock, at least in the JVM that I am using. So synchronising this won't help.\n\nI would want to see more evidence what the problem is.\n\nNote that the same Writer may be used by SaveService.saveSampleResult and SaveService.saveTestElement (this is called by ResultCollector.recordStats which is probably redundant now that MonitorHealthVisualizer has been dropped)\n\nThese are both synchronised, however that won't help if other methods use a different lock.\n\nMethods that write to a Writer from different threads need to use a shared lock.\nSince the Writer and subclasses internally use Writer.lock (protected), apps need to do the same to ensure multiple writes are not interleaved.", "id": 197454, "time": "2017-03-04T12:46:02Z", "creator": "sebb@apache.org", "creation_time": "2017-03-04T12:46:02Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 60818, "attachment_id": null, "text": "Date: Sat Mar  4 14:15:10 2017\nNew Revision: 1785488\n\nURL: http://svn.apache.org/viewvc?rev=1785488&view=rev\nLog:\nRevert r1785464 based on sebb's comment.\n\nJMeterThread does not honor contract of JMeterStopTestNowException\n\nBugzilla Id: 60812\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/reporters/ResultCollector.java\n    jmeter/trunk/xdocs/changes.xml", "id": 197455, "time": "2017-03-04T14:18:33Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2017-03-04T14:18:33Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 60818, "attachment_id": null, "id": 197459, "time": "2017-03-04T21:39:33Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-03-04T21:39:33Z", "is_private": false, "text": "As per:\nhttp://stackoverflow.com/questions/11072253/is-printwriter-thread-safe\n\nAnd reading code and javadocs of PrintWriter and Writer, I think Felix code won't hurt as there is indeed no promise in PrintWriter that it will be always thread safe.\n\nStill, I am not sure the issue faced by user is due to that.\n@Felix, did you reproduce some corruption yourself ?\n\nThanks\nRegards"}, {"count": 5, "tags": [], "bug_id": 60818, "attachment_id": null, "text": "(In reply to Philippe Mouawad from comment #4)\n> As per:\n> http://stackoverflow.com/questions/11072253/is-printwriter-thread-safe\n> \n> And reading code and javadocs of PrintWriter and Writer, I think Felix code\n> won't hurt as there is indeed no promise in PrintWriter that it will be\n> always thread safe.\n\nSuperfluos synchronisation may hurt, so it was correct to remove my patch.\n\n> \n> Still, I am not sure the issue faced by user is due to that.\n> @Felix, did you reproduce some corruption yourself ?\n\nI had seen such a corruption, but I have no way of reproducing it.\n\n> \n> Thanks\n> Regards", "id": 197462, "time": "2017-03-05T13:06:56Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2017-03-05T13:06:56Z", "is_private": false}, {"count": 6, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "(In reply to Felix Schumacher from comment #5)\n> (In reply to Philippe Mouawad from comment #4)\n> > As per:\n> > http://stackoverflow.com/questions/11072253/is-printwriter-thread-safe\n> > \n> > And reading code and javadocs of PrintWriter and Writer, I think Felix code\n> > won't hurt as there is indeed no promise in PrintWriter that it will be\n> > always thread safe.\n> \n> Superfluos synchronisation may hurt, so it was correct to remove my patch.\n\nThat's why I was initially not ok with the patch.\nBut reading Javadocs, we may be taking a risk by not doing it.\nAnd I don't know how it behaves in other JVMs than Oracle/OpenJDK\n\n> \n> > \n> > Still, I am not sure the issue faced by user is due to that.\n> > @Felix, did you reproduce some corruption yourself ?\n> \n> I had seen such a corruption, but I have no way of reproducing it.\n> \n> > \n> > Thanks\n> > Regards", "id": 197463, "time": "2017-03-05T13:10:41Z", "bug_id": 60818, "creation_time": "2017-03-05T13:10:41Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "\n\n*** This bug has been marked as a duplicate of bug 60830 ***", "id": 197548, "time": "2017-03-08T20:40:18Z", "bug_id": 60818, "creation_time": "2017-03-08T20:40:18Z", "is_private": false, "attachment_id": null}]
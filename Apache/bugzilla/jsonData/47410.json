[{"count": 0, "tags": [], "text": "When client send xml message with Content-Type: application/x-www-form-urlencoded. if you do \"request.getParameter(\"message\")\" first. then subsequent call request.getInportStream()return an empty inputStream (not null, just not data).\n\nNote: \n1. If client set Content-Type: text/xml in request HTTP header, no problem.\n2. If you do not do \"request.getParameter(\"message\")\"; request.getInportStream() works. (can read the body data).\n3. I understand the Content Type and client should not set \"x-www-form-urlencoded\" if they just send XML message in HTTP body. \n\nBut, I still think it is bug.  request.getInportStream() should be able to read\nthe data in HTTP body regardless what Content Type is. \n\nEd Xu\n\n\n===============================================\nPOST /ecpr/a2a/MessageDispatcher HTTP/1.1\nContent-Type: application/x-www-form-urlencoded\nHost: ecprsit.wellsfargo.com:9001\nContent-Length: 738\nExpect: 100-continue\nConnection: Close\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<KODL009>\n  <Header version=\"1.0\">\n    <RequestorId>seth.a.miller</RequestorId>\n    <AuthorizationId>seth.a.miller</AuthorizationId>\n    <ApplicationCode>5C</ApplicationCode>\n    <ChannelCode>INET</ChannelCode>\n    <DeviceId>DTC1D0090B7B0BD</DeviceId>\n    <AccountingUnit>74501</AccountingUnit>\n    <CorrelationId>bbf84e4a-e5ff-4fbc-be94-846b538a3dde</CorrelationId>\n    <CreationTimestamp>633810128982475233</CreationTimestamp>\n    <MessageType>RQST</MessageType>\n    <Timeout>30</Timeout>\n  </Header>\n  <Body>\n    <IndividualSearch>\n      <IndividualFirstName>w</IndividualFirstName>\n      <IndividualLastName>w</IndividualLastName>\n    </IndividualSearch>\n  </Body>\n\n=====================================\npublic void doPost(\n\t\tHttpServletRequest request,\n\t\tHttpServletResponse response)\n\t\tthrows ServletException, IOException {\t\n\t\tString message = request.getParameter(\"message\"); // Cause input stream empty\n\tif (message == null) {\n\t\t\t// In case the client posted the data raw...\n\t\tint BUFSIZE = 4096;\n\t\tInputStream in = null;\n\t\tByteArrayOutputStream byteStream = null;\n\t\ttry {\n\t\t\tin = request.getInputStream();\n\t\t\tbyteStream = new ByteArrayOutputStream(BUFSIZE);\n\t\t\tbyte[] buf = new byte[BUFSIZE];\n\t\t\tint len;\n\t\t\tlong READ_TIME_LIMIT = 2000;\t\t\n\t\t\twhile ((len = in.read(buf, 0, BUFSIZE)) != -1) {\n                         ..................\n            // Problem:\n            // InputStream has nothing althoung the HTTP request contains body)\n              \n            }\n      }", "attachment_id": null, "id": 128180, "creator": "neng1998@yahoo.com", "time": "2009-06-23T06:28:08Z", "bug_id": 47410, "creation_time": "2009-06-23T06:28:08Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 47410, "attachment_id": null, "is_private": false, "id": 128182, "time": "2009-06-23T06:45:15Z", "creator": "markt@apache.org", "creation_time": "2009-06-23T06:45:15Z", "text": "As per section SRV.3.1.1 of the Servlet spec."}]
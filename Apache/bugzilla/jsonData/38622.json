[{"attachment_id": null, "tags": [], "bug_id": 38622, "is_private": false, "count": 0, "id": 85722, "time": "2006-02-12T04:23:28Z", "creator": "eross@m-qube.com", "creation_time": "2006-02-12T04:23:28Z", "text": "ImportTask raises NPE unless static configureProject is called\n\ne.g.\n\n    [junit] java.lang.NullPointerException\n    [junit]     at\norg.apache.tools.ant.taskdefs.ImportTask.execute(ImportTask.java:96)\n    [junit]     at\norg.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n    [junit]     at org.apache.tools.ant.Task.perform(Task.java:364)\n    [junit]     at org.apache.tools.ant.Target.execute(Target.java:341)\n    [junit]     at\norg.apache.tools.ant.helper.ProjectHelper2.parse(ProjectHelper2.java:142)\n    [junit]     at AntUtil.createProject(AntUtil.java:67)\n\nExample client class:\n\n  public static Project createProject(File buildFile, Properties prop) throws\nBuildException {\n    sLog.debug(\"createProject file=\" + buildFile + \" prop=\" + prop);\n    Project project = new Project();\n    ClassLoader cl = Thread.currentThread().getContextClassLoader();\n    project.setCoreLoader(cl);\n    project.fireBuildStarted();\n    project.init();\n    ProjectHelper ph = ProjectHelper.getProjectHelper();\n    // ProjectHelper.configureProject is deprecated but if <import/>\n    // is used generates NullPointerException ... d'oh\n    ph.configureProject(project, buildFile);\n    ph.parse(project, buildFile);\n    for (Iterator i = prop.entrySet().iterator(); i.hasNext(); ) {\n      Map.Entry me = (Map.Entry)i.next();\n      project.setUserProperty((String)me.getKey(), (String)me.getValue());\n    }\n    return project;\n  }\n\nProblem code:\n\nsrc/main/org/apache/tools/ant/taskdefs/ImportTask.java\n\n    public void execute() {\n        if (file == null) {\n            throw new BuildException(\"import requires file attribute\");\n        }\n        if (getOwningTarget() == null\n            || !\"\".equals(getOwningTarget().getName())) {\n            throw new BuildException(\"import only allowed as a top-level task\");\n        }\n\n        ProjectHelper helper =\n                (ProjectHelper) getProject().getReference(\"ant.projectHelper\");\n\n^^^^^^^^^^ helper is null unless ProjectHelper.configureProject is called"}, {"count": 1, "tags": [], "bug_id": 38622, "attachment_id": null, "is_private": false, "id": 85726, "time": "2006-02-12T13:35:23Z", "creator": "jkf@apache.org", "creation_time": "2006-02-12T13:35:23Z", "text": "ProjectHelper.configureProject is not deprecated anymore in the ANT 1.7 line.\n\nAdded a check"}, {"count": 2, "tags": [], "creator": "eross@m-qube.com", "attachment_id": null, "text": "\nIt would be nice not to have to do both calls:\n\n    ph.configureProject(project, buildFile);\n    ph.parse(project, buildFile);\n\nAre you saying that the ImportTask no longer depends on the \"configureProject\"\ncall?  Or, just that the deprecated flag is gone?", "id": 85731, "time": "2006-02-12T22:05:03Z", "bug_id": 38622, "creation_time": "2006-02-12T22:05:03Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jkf@apache.org", "text": "Just that the deprecated flag is gone.\n\nThe described problem will not occur anymore, and would not have occured when\nusing ant without providing your own entry point / project.\n\nIf you want to report another issue / improvement, you are of course welcome to\ndo so, but in that case please use a new bug report / enhancement request.\n\nBy the way, \n\nProjectHelper ph = ProjectHelper.getProjectHelper();\n    // ProjectHelper.configureProject is deprecated but if <import/>\n    // is used generates NullPointerException ... d'oh\n    ph.configureProject(project, buildFile);\n    ph.parse(project, buildFile);\n\ncan be replaced by \n\nProjectHelper.configureProject(project, buildFile);\n\nIt implies as far as I rememer the ProjectHelper.getProjectHelper() and\nph.parse(project, buildFile) call.\n\nBefore using that projecthelper one can retrieve that same projectHelper from\nthe project by doing\nProjectHelper helper =\n                (ProjectHelper) getProject().\n                    getReference(ProjectHelper.PROJECTHELPER_REFERENCE);\n\n\n", "id": 85743, "time": "2006-02-13T20:33:24Z", "bug_id": 38622, "creation_time": "2006-02-13T20:33:24Z", "is_private": false, "attachment_id": null}]
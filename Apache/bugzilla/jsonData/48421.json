[{"count": 0, "tags": [], "bug_id": 48421, "attachment_id": null, "id": 132983, "time": "2009-12-20T14:45:51Z", "creator": "charly41434@yahoo.de", "creation_time": "2009-12-20T14:45:51Z", "is_private": false, "text": "In Tomcat 6  the JULI logging files which are (can be) declared in webapp/WEB-INF/classes/logging.properties will not closed, when the\nwebapp is reloaded, stopped or even undeployed. The files will at last be closed, when tomcat is shut down or restarted.\n\nThis is also true for the normally used Handler org.apache.juli.FileHandler, which opens a new File every day and closes the old.\n\nOn windows this has following effects:\nA) If  the webapp is undeployed the files which are open at this moment are locked and cannot be deleted until tomcat is (someday) stopped or restarted.\nB) If the webapp is reloaded the file is opened a second time. So the file has two open handles.\nThe next day the FileHandler closes one handle but the file is kept locked through the other handle and cannot be deleted.\n\nEvery time a webapp is reloaded the associated logfile is opened again (but not closed).\nThis has the consequence that after reloading webapps a few times tomcat must be restarted from time to time.\n\nWhen tomcat is shutdown the unnecessary (and other) open files are closed and will get the shutdown time as modification time.\nThat means any old log files will receive a current modification time, which is irritating.\n\nSteps to verify on windows: (for example: undeploy)\n1. create in the examples webapp: of tomcat 6.0.20:\nexamples/WEB-INF/classes/logging.properties:\n\nhandlers = org.apache.juli.FileHandler\norg.apache.juli.FileHandler.level = FINE\norg.apache.juli.FileHandler.directory = ${catalina.base}/logs\norg.apache.juli.FileHandler.prefix = servlet-examples.\n\n2. start tomcat\n3. undeploy examples using manager\nActual Results:\nfile ${catalina.base}/logs/servlet-examples.<date>.log cannot be deleted (nor at the next day)\nExpected:\nfile ${catalina.base}/logs/servlet-examples.<date>.log can be deleted\n\nvery cumbersome Workaround (working for reload):\nThe getHead method of a custom Formatter is extended to track the handlers along with the classloader and webapp.\nIf for a webapp a different (i.e. new) classloader is detected the close method of the handlers assigned to the old classloader is called. So the assigned file is proper closed (and the Formatter.getTail result is appended)\n\nI have set severity at minor because tomcat can be used (without webapp logging). But it is a bug because with this logging the same logfile can be useless multiple open (as described above), which should be considered as buggy."}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 133551, "creation_time": "2010-01-12T11:08:39Z", "time": "2010-01-12T11:08:39Z", "bug_id": 48421, "text": "This has been fixed in trunk and proposed for 6.0.x", "is_private": false}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 133553, "time": "2010-01-12T13:06:05Z", "bug_id": 48421, "creation_time": "2010-01-12T13:06:05Z", "text": "*** Bug 48510 has been marked as a duplicate of this bug. ***"}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 133593, "time": "2010-01-14T02:12:31Z", "bug_id": 48421, "creation_time": "2010-01-14T02:12:31Z", "is_private": false, "text": "This has been fixed in 6.0.x and will be include din 6.0.23 onwards."}]
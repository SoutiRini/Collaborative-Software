[{"count": 0, "tags": [], "creator": "kyiv@hotmail.com", "text": "The problem is that the new version of Tomcat (v4.1.18 or v4.1.24) \nassigns \"text/plain\" content type to the response that is coming from a servlet \nunless it was explicitly assigned within the servlet.  \n\nI think the change happened when Tomcat switched from HTTP/1.1 connector to \nCoyote.  \nTomcat 4.0.2 (and prior) doesn't supply any content type if none was explicitly \nspecified, and Tomcat 4.1.18 (and later, I didn't test versions in between) \nsets it to \"text/plain\".\n\nBecause a browser is not supposed to guess for content type if it's specified \nexplicitly in the header (according to HTTP/1.1 spec), Netscape displays the \npage that was generated by a servlet (by including a JSP) as a text if the \ncontent type wasn't set to \"text/html\" in the servlet.\n\nAnd again, the older version of Tomcat (v4.0.x) did not assigned content type, \nif none was set in the servlet, and any browser was able to recognize it based \non the HTML tags.", "id": 34869, "time": "2003-04-10T15:26:42Z", "bug_id": 18902, "creation_time": "2003-04-10T15:26:42Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 18902, "text": "Symptoms\nServlets which do not set a content type header inherit \"text/plain\" even \nthough the web server \nitself is set to DefaultType text/html - no amount of web server configuration \naffects it. The bug \ncomes from the Coyote connector for Tomcat, since Tomcat version 4.1 (and still \npresent by \nsome versions of 5.0, according to info on the web).\n\nTomcat Coyote is setting text/plain when it probably should have left it null, \nor at least set text/html.\nYou can patch coyote to send html instead of plain, as follows:\n\n\n\nPatch (This is probably not the best solution, but rather a workaround.)\n\nDownload the source for the connectors, and try to have available the \ndependencies it needs.\n(Watch the list of jar properties that shows when you run ant, and make sure \nmost/all get set.)\n\nThen edit:\njakarta-tomcat-connectors-4.1.24-\nsrc/coyote/src/java/org/apache/coyote/Constants.java:\n\npublic static final String DEFAULT_CONTENT_TYPE = \"text/plain\";\n\nModify to say text/html instead.  Then run ant in the top level dir and compile \nit all.  Make sure \nyour compilation doesn't have errors.  \n\nMake a backup copy of /usr/local/tomcat/server/lib/tomcat-coyote.jar in case \nyour new one doesn't work.\nThen copy coyote/build/lib/tomcat-coyote.jar into the system-wide tomcat \nserver/lib/ directory.\nRestart tomcat and test it out.\n", "id": 41246, "time": "2003-07-23T16:42:02Z", "creator": "jenny@bigbrother.net", "creation_time": "2003-07-23T16:42:02Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "puckman@taglab.com", "text": "Are you sure this is Tomcat's problem?\n\nApache 1.3 has an annoying tendency to add it's default type to all responses \nthat doesn't have any type (the default type is normally text/plain). If an \nexplicit type is set by Tomcat, then apache doesn't do anything.\n\nMore on this here:\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=13846\n\nMartin\n", "id": 41249, "time": "2003-07-23T17:07:48Z", "bug_id": 18902, "creation_time": "2003-07-23T17:07:48Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "jenny@bigbrother.net", "text": "In this case, apache's default type is completely ignored, because Tomcat has \nalready set one, and it's text/plain.  I set up my apache config with a system-\nwide default type of text/html to try to fix it, but it's never used.  Tomcat \nhas already given it text/plain thus Apache doesn't get a chance.\n\nIt would have been nice if Tomcat left it empty and allowed the Apache config \nto affect it - in that case, I could have configured the default type per \nvirtual host (which is how I already had it set up from Tomcat 3).  This broke \nwhen I moved to Tomcat 4.  It was no longer left unset.\n\nAdditionally Tomcat doesn't seem to have a config option to let you change its \ndefault from a config file.  Too bad there too.\n", "id": 41253, "time": "2003-07-23T18:00:43Z", "bug_id": 18902, "creation_time": "2003-07-23T18:00:43Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 18902, "text": "I don't have time at this moment to confirm or fix but if the description is\ncorrect, this is a spec compliance bug.\n\nSRV.5.2 Headers\n\"Servlet programmers are responsible for ensuring that the Content-Type\nheader is appropriately set in the response object for the content the servlet is\ngenerating. The HTTP 1.1 specification does not require that this header be set in\nan HTTP response. Servlet containers must not set a default content type when the\nservlet programmer does not set the type.\"\n\n", "id": 44364, "time": "2003-09-19T19:19:22Z", "creator": "funkman@joedog.org", "creation_time": "2003-09-19T19:19:22Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 18902, "attachment_id": null, "is_private": false, "id": 44380, "time": "2003-09-20T13:56:03Z", "creator": "funkman@joedog.org", "creation_time": "2003-09-20T13:56:03Z", "text": "This was fixed in 5 according to\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=18202 but does seem to still\nexist in the coyote_10 branch according to source."}, {"count": 6, "tags": [], "bug_id": 18902, "attachment_id": null, "is_private": false, "id": 44400, "time": "2003-09-21T15:29:19Z", "creator": "funkman@joedog.org", "creation_time": "2003-09-21T15:29:19Z", "text": "Patches submitted. Will be in next release."}]
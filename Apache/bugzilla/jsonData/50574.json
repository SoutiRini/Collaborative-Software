[{"attachment_id": 26480, "tags": [], "bug_id": 50574, "text": "Created attachment 26480\nXSL-FO demonstrating the odd page content overflow\n\nI have a scenario where I print mailing labels on the back of each piece of paper (even pages).  When content is too much on page 1, it should overflow onto page 3 (while mailing labels print on both page 2 and page 4).\n\nISSUE:\nIn FOP 1.0 when the content overflows page 1 to flow onto the next ODD page, a java.lang.NullPointerException is thrown.  This functionality did work in FOP 0.95.\n\nAttached a simple XSL-FO to demonstrate this.\n\nThanks.\n\nlance\n\nHere's the exception:\njava.lang.NullPointerException\n\tat org.apache.fop.layoutmgr.PageBreakingAlgorithm.filterActiveNodes(PageBreakingAlgorithm.java:1028)\n\tat org.apache.fop.layoutmgr.BreakingAlgorithm.findBreakingPoints(BreakingAlgorithm.java:527)\n\tat org.apache.fop.layoutmgr.BreakingAlgorithm.findBreakingPoints(BreakingAlgorithm.java:439)\n\tat org.apache.fop.layoutmgr.AbstractBreaker.doLayout(AbstractBreaker.java:369)\n\tat org.apache.fop.layoutmgr.PageBreaker.doLayout(PageBreaker.java:85)\n\tat org.apache.fop.layoutmgr.PageSequenceLayoutManager.activateLayout(PageSequenceLayoutManager.java:107)\n\tat org.apache.fop.area.AreaTreeHandler.endPageSequence(AreaTreeHandler.java:238)\n\tat org.apache.fop.fo.pagination.PageSequence.endOfNode(PageSequence.java:120)\n\tat org.apache.fop.fo.FOTreeBuilder$MainFOHandler.endElement(FOTreeBuilder.java:349)\n\tat org.apache.fop.fo.FOTreeBuilder.endElement(FOTreeBuilder.java:177)\n\tat org.apache.xalan.transformer.TransformerIdentityImpl.endElement(TransformerIdentityImpl.java:1050)\n\tat org.apache.xerces.parsers.AbstractSAXParser.endElement(Unknown Source)\n\tat org.apache.xerces.impl.XMLNSDocumentScannerImpl.scanEndElement(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source)\n\tat org.apache.xalan.transformer.TransformerIdentityImpl.transform(TransformerIdentityImpl.java:452)", "count": 0, "id": 143278, "time": "2011-01-11T17:21:50Z", "creator": "lanceknorr@hotmail.com", "creation_time": "2011-01-11T17:21:50Z", "is_private": false}, {"count": 1, "tags": [], "creator": "adelmelle@apache.org", "is_private": false, "id": 144202, "creation_time": "2011-02-11T11:37:24Z", "time": "2011-02-11T11:37:24Z", "bug_id": 50574, "text": "\nThe difference is that 0.95 did not yet support alternating page-ipd. In this scenario it did not show, since the narrower pages were empty.\n \nFor future reference, from a technical perspective the issue is the double restart that is triggered without content in between (actually: restart - overflow - restart). The first restart works like a charm, and kicks off from a SpaceHandlingBreakPosition as expected, but the overflow triggered by the second (empty) page, leaves us with no active node. Hence, NPE in PageBreakingAlgorithm.filterActiveNodes().\n\nAdding the proposed fix for bug 49835, the NPE is avoided, but in that case, it becomes apparent that the SpaceHandlingBreakPosition is consumed, and the new blockList after the second restart, starts with a TableContentPosition, from which no restart is possible...\n\nIn addition to the fix for bug 49835, my first idea would be to:\n- store the last restart point in AbstractBreaker as a member\n- in case a restart is not triggered from a SpaceHandlingBreakPosition, and that position immediately follows the previous restart point, restart from the stored one, as that is an indication there was not enough room to fit any content on the next page(s).\n\nStill left to verify whether this approach could resolve the issue. Stay tuned...", "attachment_id": null}, {"count": 2, "tags": [], "creator": "adelmelle@apache.org", "is_private": false, "text": "Created attachment 26643\npossible fix?\n\n\nThis patch to fop.layoutmgr.AbstractBreaker, in conjunction with the patch attached to Bugzilla 49835 seems to resolve the issue, and passes the unit tests. Not entirely sure if this is airtight, though, hence the question-marks in the code comment...", "id": 144205, "time": "2011-02-11T12:56:22Z", "bug_id": 50574, "creation_time": "2011-02-11T12:56:22Z", "attachment_id": 26643}, {"count": 3, "tags": [], "bug_id": 50574, "text": "Created attachment 26644\nminor change\n\n\nActually, that second condition was not necessary I believe... might even have caused mayhem at some point (?)", "id": 144207, "time": "2011-02-11T13:09:12Z", "creator": "adelmelle@apache.org", "creation_time": "2011-02-11T13:09:12Z", "is_private": false, "attachment_id": 26644}, {"count": 4, "tags": [], "bug_id": 50574, "text": "*** Bug 50985 has been marked as a duplicate of this bug. ***", "id": 145394, "time": "2011-03-29T20:37:53Z", "creator": "adelmelle@apache.org", "creation_time": "2011-03-29T20:37:53Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "bug_id": 50574, "is_private": false, "id": 157268, "time": "2012-04-07T01:37:10Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:37:10Z", "tags": [], "text": "resetting severity from major to normal pending further review"}, {"count": 6, "tags": [], "bug_id": 50574, "text": "resetting P2 open bugs to P3 pending further review", "id": 157467, "time": "2012-04-07T01:43:16Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:43:16Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 50574, "attachment_id": null, "text": "(In reply to comment #3)\n> Created attachment 26644 [details]\n> minor change\n> \n> Actually, that second condition was not necessary I believe... might even have\n> caused mayhem at some point (?)\n\nandreas, should this patch be applied?", "id": 157677, "time": "2012-04-08T08:57:26Z", "creator": "gadams@apache.org", "creation_time": "2012-04-08T08:57:26Z", "is_private": false}]
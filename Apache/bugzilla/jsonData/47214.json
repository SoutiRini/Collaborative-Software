[{"count": 0, "tags": [], "bug_id": 47214, "is_private": false, "text": "Classes\n o.a.catalina.security.SecurityClassLoad\n o.a.catalina.jasper.SecurityClassLoad\nperform preloading of certain classes of Tomcat.\n\nMy concern is that some of those preloaded classes are anonymous ones, e.g.\n\n        loader.loadClass\n            (basePackage + \"session.StandardSession\");\n        loader.loadClass\n            (basePackage + \"session.StandardSession$1\");\n\nReferencing anonymous classes by their numbers is too fragile. It can be broken by any code modification that will cause their renumbering. Also, it is hard to review patches to SecurityClassLoad when they contain such references. See e.g. r721704\n\nI suggest that all such classes were explicitly named. See classes referenced in o.a.catalina.security.SecurityClassLoad for an example (e.g.: o.a.c.core.ApplicationDispatcher with inner classes PrivilegedForward, PrivilegedInclude).", "id": 127087, "time": "2009-05-17T18:32:20Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2009-05-17T18:32:20Z", "attachment_id": null}, {"count": 1, "text": "What do you suggest that classes be named?", "creator": "lavloz@hotmail.fr", "is_private": false, "id": 190600, "time": "2016-04-27T14:18:18Z", "bug_id": 47214, "creation_time": "2016-04-27T14:18:18Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "id": 190613, "time": "2016-04-28T02:56:41Z", "bug_id": 47214, "creation_time": "2016-04-28T02:56:41Z", "is_private": false, "text": "I think any reasonably descriptive name will do.\n\nIf you're considering preparing a patch, please grab the latest trunk (currently Tomcat 9.0.x) and write your initial patch for that version. Once it's been accepted, that patch can be back-ported to older versions of Tomcat.\n\nTry to make your patches as small as possible: don't fix 3 bugs at once and change all the whitespace around. If you need to re-factor some things, submit two patches: the refactoring in the first patch with no functional changes, and then the actual change in a second patch."}, {"count": 3, "tags": [], "creator": "lavloz@hotmail.fr", "text": "Thank you for your advices and your time :), the problem is i'm not native english speaker and english is my fourth language, so i didn't find good names, but i will try my best, thank you again for your time :)", "id": 190617, "time": "2016-04-28T09:05:20Z", "bug_id": 47214, "creation_time": "2016-04-28T09:05:20Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "chris@christopherschultz.net", "is_private": false, "text": "Your English is great. If there is confusion, we will ask for clarification.\n\nDon't feel bad if we ask you to re-do your patch(es) several times. The goal is to get the best patch possible, and make you into a successful patch-writer ;)", "id": 190623, "time": "2016-04-28T14:58:46Z", "bug_id": 47214, "creation_time": "2016-04-28T14:58:46Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 47214, "attachment_id": null, "id": 198200, "time": "2017-04-06T22:06:34Z", "creator": "markt@apache.org", "creation_time": "2017-04-06T22:06:34Z", "is_private": false, "text": "Fixed in 9.0.x for 9.0.0.M20 onwards. I do not propose to back-port it."}, {"count": 6, "tags": [], "bug_id": 47214, "attachment_id": null, "is_private": false, "id": 202727, "time": "2017-12-12T10:32:29Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2017-12-12T10:32:29Z", "text": "See \"Re:r1817800\" thread for Tomcat 7 (fix for bug 61886)\nhttp://tomcat.markmail.org/thread/y5yyhse2rsrgg35b\n\nJava 6 generates helper anonymous classes when the code uses switch(enum).\n\nE.g. in Tomcat 7\norg.apache.coyote.http11.AbstractHttp11Processor$1 is\n\nstatic class AbstractHttp11Processor$1 {\n    static final int $SwitchMap$org$apache$coyote$ActionCode[];\n    static final int $SwitchMap$org$apache$tomcat$util$log$UserDataHelper$Mode[];\n\n    static \n    {\n    // the int arrays are initialized with Enum.ordinal() -> some integer value mapping\n    }\n}\n\nEssentially, it is a holder class that wraps a static field that is initialized lazily.\nhttps://en.wikipedia.org/wiki/Initialization-on-demand_holder_idiom\n\nThere is no way to assign a name to such class. As such, I went with an alternative implementation that uses a for(int++) loop to load all available classes starting with $1 - r1817901.\n\nThis will be in 7.0.84 onwards."}, {"count": 7, "text": "Reassigning to Tomcat 8 to track forward-porting of r1817901.", "creator": "knst.kolinko@gmail.com", "is_private": false, "id": 202728, "time": "2017-12-12T10:33:30Z", "bug_id": 47214, "creation_time": "2017-12-12T10:33:30Z", "tags": [], "attachment_id": null}, {"count": 8, "text": "Nice fix. Since Tomcat 8 doesn't support the old JDKs, then it probably doesn't need the clever hack (IMO). The improvement should still be to stop using anonymous inner classes when they need preload.", "creator": "remm@apache.org", "is_private": false, "id": 202730, "time": "2017-12-12T11:11:49Z", "bug_id": 47214, "creation_time": "2017-12-12T11:11:49Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 47214, "is_private": false, "count": 9, "id": 202732, "time": "2017-12-12T13:46:48Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2017-12-12T13:46:48Z", "text": "(In reply to Remy Maucherat from comment #8)\n> Nice fix. Since Tomcat 8 doesn't support the old JDKs, then it probably\n> doesn't need the clever hack (IMO). The improvement should still be to stop\n> using anonymous inner classes when they need preload.\n\nHttp11Processor$1.class is present in Tomcat 8.5.24/tomcat-coyote.jar\n\nDecompiling it, it is the same $SwitchMap$ support class."}, {"count": 10, "tags": [], "bug_id": 47214, "attachment_id": null, "text": "(In reply to Konstantin Kolinko from comment #7)\n> Reassigning to Tomcat 8 to track forward-porting of r1817901.\n+ r1820543\n\nApplied to Tomcat 8.5 in r1820546\nApplied to Tomcat 8.0 in r1820550\n\nSecurityClassLoad classes in Tomcat 9.0 do not load any anonymous inner classes. Thus there is no need for this fix in Tomcat 9.", "id": 203150, "time": "2018-01-08T11:07:35Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2018-01-08T11:07:35Z", "is_private": false}]
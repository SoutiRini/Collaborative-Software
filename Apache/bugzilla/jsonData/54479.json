[{"count": 0, "tags": [], "text": "Created attachment 29891\nResult files\n\nHello, I'm trying to create a DB Data extractor,who creates .xlsx files using SXSSF but quite an unexpected things happened. I tried 2 ways to do this,but I end with different problems.\n\n1. Applying CellStyle to each cell,which needs it:\n    \n   Here's an example program I changed to demonstrate the problem:\n  \n           public static void main(String[] args) throws Throwable {\n            \n            SXSSFWorkbook wb = new SXSSFWorkbook(-1); \n            Sheet sh = wb.createSheet();\n            \n            for(int rownum = 0; rownum < 5000; rownum++){\n                Row row = sh.createRow(rownum);\n                for(int cellnum = 0; cellnum < 10; cellnum++){\n                    \n                    Cell cell = row.createCell(cellnum);\n                    cell.setCellType(Cell.CELL_TYPE_NUMERIC);\n                    \n                    CellStyle style = wb.createCellStyle();\n                    CreationHelper cHelper =wb.getCreationHelper();\n                                                    style.setDataFormat(cHelper.createDataFormat().getFormat(\"#.##\"));\n                    cell.setCellValue(1);\n                    cell.setCellStyle(style);\n                }\n\n               \n               if(rownum % 100 == 0) {\n                    ((SXSSFSheet)sh).flushRows(100); \n\n               }\n\n            }\n\n            FileOutputStream out = new FileOutputStream(\"F:/sxssf.xlsx\");\n            wb.write(out);\n            out.close();\n\n            wb.dispose();\n\n    }\n}\n\nResult: The styles are applied for some of the cell:\n        The reason is flooding the Style.xml with rows of kind:\n\n\t\t<xf numFmtId=\"165\" fontId=\"0\" fillId=\"0\" borderId=\"0\" xfId=\"0\" applyNumberFormat=\"true\"/> ...... as many times as I set CellStyle.\n \n       Which leads to overflow of style variable 's' causing it to go to negative number:\n\nSheet.xml:\n      <c r=\"A3677\" s=\"-28775\" t=\"n\">\n\t<v>1.0</v>\n\nSo I did the same .xlsx manually and the results are:\n\nStyles.xml:\n\n<cellStyleXfs count=\"1\">\n\t\t<xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\"/>\n\t</cellStyleXfs>\n\t<cellXfs count=\"2\">\n\t\t<xf numFmtId=\"0\" fontId=\"0\" fillId=\"0\" borderId=\"0\" xfId=\"0\"/>\n\t\t<xf numFmtId=\"164\" fontId=\"0\" fillId=\"0\" borderId=\"0\" xfId=\"0\" applyNumberFormat=\"1\"/>\n\t</cellXfs>\n\t<cellStyles count=\"1\">\n\t\t<cellStyle name=\"Normal\" xfId=\"0\" builtinId=\"0\"/>\n\t</cellStyles>\n\t<dxfs count=\"0\"/>\n\t<tableStyles count=\"0\" defaultTableStyle=\"TableStyleMedium2\" defaultPivotStyle=\"PivotStyleMedium9\"/>\n\t<extLst>\n\t\t<ext uri=\"{EB79DEF2-80B8-43e5-95BD-54CBDDF9020C}\" xmlns:x14=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/main\">\n\t\t\t<x14:slicerStyles defaultSlicerStyle=\"SlicerStyleLight1\"/>\n\t\t</ext>\n\t</extLst>\n\nAnd Sheet.xml:\n\n     <c r=\"B1\" s=\"1\">\n       <v>1</v>\n\n\nIs this a problem with the SXSSF or I'm trying something that's not meant to work this way.\n\n\n2. Setting Default CellStyle to a column to skip all the CellStyle setting:\n    \n   The above program changed to show the problem in this approach:\n   \n   public class testing2 {\n\n\n        public static void main(String[] args) throws Throwable {\n            \n            SXSSFWorkbook wb = new SXSSFWorkbook(-1);\n            Sheet sh = wb.createSheet();\n            for(int col=0;col<10;col++){\n                    CellStyle style = wb.createCellStyle();\n                    CreationHelper cHelper =wb.getCreationHelper();\n                    \n                    style.setDataFormat(cHelper.createDataFormat().getFormat(\"#.##\"));\n                    sh.setDefaultColumnStyle(col, style);\n            }\n            \n            for(int rownum = 0; rownum < 5000; rownum++){\n                Row row = sh.createRow(rownum);\n                for(int cellnum = 0; cellnum < 10; cellnum++){\n                    \n                    Cell cell = row.createCell(cellnum);\n                    cell.setCellType(Cell.CELL_TYPE_NUMERIC);\n                    \n                    cell.setCellValue(1);\n\n                }\n\n               if(rownum % 100 == 0) {\n                    ((SXSSFSheet)sh).flushRows(100); \n               }\n\n            }\n\n            FileOutputStream out = new FileOutputStream(\"F:/sxssf2.xlsx\");\n            wb.write(out);\n            out.close();\n\n\n            wb.dispose();\n    }\n}\n \nResult: I end up with hidden columns and not applied formatting.\n\n\nThis is my second attempt to do the task,but may be I'm doing something wrong.\nCould you give me some advice how to do this, or hopefully fix the problems if this is the case.\nThank you a lot.\n\nP.S. :I'm Attaching the results of the attempts.", "attachment_id": 29891, "bug_id": 54479, "id": 164869, "time": "2013-01-24T18:44:05Z", "creator": "jvs9322@gmail.com", "creation_time": "2013-01-24T18:44:05Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 54479, "attachment_id": null, "id": 164883, "time": "2013-01-25T10:05:08Z", "creator": "yegor@dinom.ru", "creation_time": "2013-01-25T10:05:08Z", "is_private": false, "text": "Cell styles should be created outside of the loop, see http://poi.apache.org/faq.html#faq-N100EF"}]
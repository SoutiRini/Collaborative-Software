[{"count": 0, "tags": [], "bug_id": 54685, "attachment_id": null, "id": 165792, "time": "2013-03-13T09:33:10Z", "creator": "dlade@web.de", "creation_time": "2013-03-13T09:33:10Z", "is_private": false, "text": "I set the jmeter property \"sample_variable\" to a variable name I wan't to send optionally. But if the variable is not available during the load test, the following exception occurs:\n\n2013/03/13 02:39:13 ERROR - jmeter.samplers.BatchSampleSender: testEnded(host) java.rmi.ServerError: Error occurred in s\nerver thread; nested exception is:\n        org.apache.jorphan.util.JMeterError: Check the sample_variable settings!\n        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:333)\n        at sun.rmi.transport.Transport$1.run(Transport.java:159)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at sun.rmi.transport.Transport.serviceCall(Transport.java:155)\n        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:535)\n        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:790)\n        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:649)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:662)\n        at sun.rmi.transport.StreamRemoteCall.exceptionReceivedFromServer(StreamRemoteCall.java:255)\n        at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:233)\n        at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:142)\n        at org.apache.jmeter.samplers.RemoteSampleListenerImpl_Stub.processBatch(Unknown Source)\n        at org.apache.jmeter.samplers.BatchSampleSender.testEnded(BatchSampleSender.java:125)\n        at org.apache.jmeter.samplers.DataStrippingSampleSender.testEnded(DataStrippingSampleSender.java:70)\n        at org.apache.jmeter.samplers.RemoteListenerWrapper.testEnded(RemoteListenerWrapper.java:99)\n        at org.apache.jmeter.engine.StandardJMeterEngine.notifyTestListenersOfEnd(StandardJMeterEngine.java:223)\n        at org.apache.jmeter.engine.StandardJMeterEngine.run(StandardJMeterEngine.java:437)\n        at java.lang.Thread.run(Thread.java:662)\nCaused by: org.apache.jorphan.util.JMeterError: Check the sample_variable settings!\n        at org.apache.jmeter.samplers.SampleEvent.getVarValue(SampleEvent.java:159)\n        at org.apache.jmeter.save.converters.SampleResultConverter.setAttributes(SampleResultConverter.java:286)\n        at org.apache.jmeter.save.converters.SampleResultConverter.marshal(SampleResultConverter.java:117)\n        at com.thoughtworks.xstream.core.TreeMarshaller.convert(TreeMarshaller.java:70)\n        at com.thoughtworks.xstream.core.TreeMarshaller.convertAnother(TreeMarshaller.java:58)\n        at com.thoughtworks.xstream.core.TreeMarshaller.convertAnother(TreeMarshaller.java:43)\n        at com.thoughtworks.xstream.core.TreeMarshaller.start(TreeMarshaller.java:82)\n        at com.thoughtworks.xstream.core.AbstractTreeMarshallingStrategy.marshal(AbstractTreeMarshallingStrategy.java:37)\n        at com.thoughtworks.xstream.XStream.marshal(XStream.java:894)\n        at org.apache.jmeter.save.SaveService.saveSampleResult(SaveService.java:359)\n        at org.apache.jmeter.reporters.ResultCollector.sampleOccurred(ResultCollector.java:507)\n        at org.apache.jmeter.samplers.RemoteSampleListenerImpl.processBatch(RemoteSampleListenerImpl.java:96)\n        at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:305)\n        at sun.rmi.transport.Transport$1.run(Transport.java:159)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at sun.rmi.transport.Transport.serviceCall(Transport.java:155)\n        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:535)\n        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:790)\n        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:649)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        ... 1 more\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 0\n        at org.apache.jmeter.samplers.SampleEvent.getVarValue(SampleEvent.java:157)\n        ... 24 more"}, {"count": 1, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "AFAICT this error is caused by a mismatch between the variable names used by client/server instances; not by a missing variable value.\n\nHowever I don't see how this can happen normally, as the client sends the list to all the servers.\n\nHave you got the logs for all the client and server instances?\nIf so, please search for instances of the string\n\nsample_variables\n\nin all the logs for a failed run and report the matches here.", "id": 165883, "time": "2013-03-17T00:11:23Z", "bug_id": 54685, "creation_time": "2013-03-17T00:11:23Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 54685, "is_private": false, "text": "Ok, you're right. \n\nIf I don't set the property \"sample_variable\" in either remote or client settings the problem occurs. \n\nBut then IMHO the bug is, that this value can not be configured by client only, as the most other properties allow.\n\nAnd on the other hand no Exception should be thrown but an error message to the log would be more helpful.", "id": 166148, "time": "2013-03-26T08:52:23Z", "creator": "dlade@web.de", "creation_time": "2013-03-26T08:52:23Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 54685, "attachment_id": null, "id": 166152, "creation_time": "2013-03-26T11:09:54Z", "time": "2013-03-26T11:09:54Z", "creator": "sebb@apache.org", "text": "(In reply to comment #2)\n> Ok, you're right. \n> \n> If I don't set the property \"sample_variable\" in either remote or client\n> settings the problem occurs. \n\nI have not been able to reproduce that.\n\n> But then IMHO the bug is, that this value can not be configured by client\n> only, as the most other properties allow.\n\nThe variable needs to be the same on all the systems, which is why the client sends the same list to all the remote servers.\n\n> And on the other hand no Exception should be thrown but an error message to\n> the log would be more helpful.\n\nJMeter already does log the problem with full stacktrace.\nUntil we find a cause, it's not clear whether the test can be allowed to carry on.", "is_private": false}, {"count": 4, "tags": [], "bug_id": 54685, "attachment_id": 30103, "text": "Created attachment 30103\na log full of exceptions ...\n\nI currently reproduced it simply:\n\n1. I set \"sample_variables=foobar\" at jmeter-client/bin/jmeter.properties\n2. I set \"#sample_variables\" at jmeter-server/bin/jmeter.properties\n3. started remote jmeter by jmeter-server/bin/jmeter-server.bat\n4. started a test with UI using jmeter-client for it\n\nI got a log full of exceptions ...", "id": 166155, "time": "2013-03-26T14:05:57Z", "creator": "dlade@web.de", "creation_time": "2013-03-26T14:05:57Z", "is_private": false}, {"count": 5, "tags": [], "creator": "dlade@web.de", "is_private": false, "id": 166156, "creation_time": "2013-03-26T14:08:10Z", "time": "2013-03-26T14:08:10Z", "bug_id": 54685, "text": "It could be quiet easy to fix if because these variables are just optional ones.\n\nIMO there is no need for this exception.", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 54685, "attachment_id": null, "id": 166159, "time": "2013-03-26T14:33:01Z", "creator": "sebb@apache.org", "creation_time": "2013-03-26T14:33:01Z", "is_private": false, "text": "We need the client log as well.\n\nFor some reason the sample_variables property does not seem to being propagated.\n\nAlso, the first part of the server log is missing."}, {"count": 7, "tags": [], "bug_id": 54685, "is_private": false, "text": "I have now managed to reproduce the problem.\n\nInvestigating.", "id": 166163, "time": "2013-03-26T17:01:10Z", "creator": "sebb@apache.org", "creation_time": "2013-03-26T17:01:10Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 54685, "attachment_id": null, "id": 166173, "creation_time": "2013-03-27T00:33:28Z", "time": "2013-03-27T00:33:28Z", "creator": "sebb@apache.org", "text": "Looks like the problem is partly one of timing: the properties are passed across, but the class that uses them has already been loaded and has already fetched the value of the property.\n\nHowever, that is not the only problem: it should be possible to change the variable names between test runs.\n\nThe work-round is to ensure eaxctly the same set of variables is defined in every JMeter instance. [This is obviously error-prone, which is why the client tries to tell the servers what variables to save at test startup].", "is_private": false}, {"count": 9, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "id": 166189, "time": "2013-03-28T01:13:08Z", "bug_id": 54685, "creation_time": "2013-03-28T01:13:08Z", "is_private": false, "text": "URL: http://svn.apache.org/r1461911\nLog:\nArrayIndexOutOfBoundsException if \"sample_variable\" is set in client but not server\nBugzilla Id: 54685\n\nAdded:\n    jmeter/trunk/bin/testfiles/Bug54685.csv\n    jmeter/trunk/bin/testfiles/Bug54685.jmx   (with props)\n    jmeter/trunk/bin/testfiles/Bug54685.xml   (with props)\nModified:\n    jmeter/trunk/build.xml\n    jmeter/trunk/src/core/org/apache/jmeter/engine/StandardJMeterEngine.java\n    jmeter/trunk/src/core/org/apache/jmeter/samplers/SampleEvent.java\n    jmeter/trunk/xdocs/changes.xml"}]
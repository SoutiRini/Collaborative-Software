[{"count": 0, "tags": [], "bug_id": 43403, "is_private": false, "text": "PatternLayout needs new format modifier: prefix to be used when parameters evaluates to the non-\nempty string.\n\nSo pattern could be written as:\n\n[%c%{x;prefix=\"-\"}] %m\n\nthat outputs\n\n[app.Something-7777] message\n\nif NDC is 7777, and\n\n[app.Something] message\n\nif NDC is empty (no chars before square bracket).\n\nThis is must have thing for MDC: when several should be printed, and some of them could be unset:\n\n[%c${X;key=clientId;prefix=\" clientId=\"}%{X;key=city;prefix=\" city=\"}] %m\n\nshould be evaluated to\n\n[app.something clientId=777 city=Moscow] message\n[app.something clientId=888] message\n[app.something city=Moscow] message\n[app.something] message\n\ndepending on what values are set in MDC.", "id": 108238, "time": "2007-09-16T04:00:52Z", "creator": "yozh@mx1.ru", "creation_time": "2007-09-16T04:00:52Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 43403, "attachment_id": null, "text": "I think the use case is reasonable, but I don't think the proposed solution is desirable.  First, the \nproposed solution isn't general enough. if there is a \"prefix\" why shouldn't there be a \"suffix\" too.  If it \nis desirable for NDC and MDC, why not for other fields as well. Second, implementing the solution \nwould require hacking the pattern parser to support a new language feature.\n\nExtendedPatternLayout (the log4j 1.3 pattern layout backported for use with log4j 1.2 and provided in \nthe extras companion) does support just %X which will print out all MDC values as key=value.\n\nXSLTLayout (also in the extras) companion should also be capable of achieving your desired layout \ngoals.  I haven't benchmarked XSLTLayout, but I would assume that it would have to be substantially \nslower than PatternLayout for equivalent tasks.  But it is hugely flexible and the performance different \nmay not be an issue in your application.\n\nIf that isn't desirable, then possibly adding a new \"replace\" pattern to ExtendedPatternLayout in apache-\nlog4j-extras would be a reasonable approach that would not require hacking the pattern parser, just \nadding a new pattern specifier.  replace could look like:\n\n%replace{layout pattern}{regex}{replacement}\n\nSo your NDC prefix would look like:\n\n%c%replace{%x}{(.+)}{-$1}\n\n", "id": 108242, "time": "2007-09-16T11:34:03Z", "creator": "carnold@apache.org", "creation_time": "2007-09-16T11:34:03Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 43403, "is_private": false, "id": 118250, "creation_time": "2008-07-03T13:12:06Z", "time": "2008-07-03T13:12:06Z", "creator": "thorbjoern@gmail.com", "text": "If the functionality is available with other layouts, and the original poster has not pursued this further, perhaps it would be reasonable to close this issue?", "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 43403, "text": "No response in a month.  Setting status to NEEDINFO.", "id": 119275, "time": "2008-08-02T13:48:45Z", "creator": "thorbjoern@gmail.com", "creation_time": "2008-08-02T13:48:45Z", "tags": [], "is_private": false}]
[{"attachment_id": 27568, "tags": [], "creator": "vlsergey@gmail.com", "text": "Created attachment 27568\nProblematic file. Not intended to be distributed under ASL.\n\nThere is IndexOutOfBoundsException in PrimaryGridUnit.\n\nSorry, i can' provide file to include in test case, but \"short\" problematic file (with single table) in attach.\n\njava.lang.IndexOutOfBoundsException: Index: 2, Size: 2\n\tat java.util.ArrayList.RangeCheck(ArrayList.java:547)\n\tat java.util.ArrayList.get(ArrayList.java:322)\n\tat org.apache.fop.fo.flow.table.PrimaryGridUnit.getAfterBorderWidth(PrimaryGridUnit.java:220)\n\tat org.apache.fop.layoutmgr.table.TableCellLayoutManager.addAreas(TableCellLayoutManager.java:289)\n\tat org.apache.fop.layoutmgr.table.RowPainter.addAreasForCell(RowPainter.java:429)\n\tat org.apache.fop.layoutmgr.table.RowPainter.addAreasAndFlushRow(RowPainter.java:307)\n\tat org.apache.fop.layoutmgr.table.RowPainter.handleTableContentPosition(RowPainter.java:160)\n\tat org.apache.fop.layoutmgr.table.TableContentLayoutManager.addTablePartAreas(TableContentLayoutManager.java:494)\n\tat org.apache.fop.layoutmgr.table.TableContentLayoutManager.addBodyAreas(TableContentLayoutManager.java:481)\n\tat org.apache.fop.layoutmgr.table.TableContentLayoutManager.addAreas(TableContentLayoutManager.java:417)\n\tat org.apache.fop.layoutmgr.table.TableLayoutManager.addAreas(TableLayoutManager.java:363)\n\tat org.apache.fop.layoutmgr.AreaAdditionUtil.addAreas(AreaAdditionUtil.java:113)\n\tat org.apache.fop.layoutmgr.FlowLayoutManager.addAreas(FlowLayoutManager.java:364)\n\tat org.apache.fop.layoutmgr.PageBreaker.addAreas(PageBreaker.java:286)\n\tat org.apache.fop.layoutmgr.AbstractBreaker.addAreas(AbstractBreaker.java:607)\n\tat org.apache.fop.layoutmgr.AbstractBreaker.addAreas(AbstractBreaker.java:481)\n\tat org.apache.fop.layoutmgr.PageBreaker.doPhase3(PageBreaker.java:314)\n\tat org.apache.fop.layoutmgr.AbstractBreaker.doLayout(AbstractBreaker.java:436)\n\tat org.apache.fop.layoutmgr.PageBreaker.doLayout(PageBreaker.java:90)\n\tat org.apache.fop.layoutmgr.PageSequenceLayoutManager.activateLayout(PageSequenceLayoutManager.java:107)\n\tat org.apache.fop.area.AreaTreeHandler.endPageSequence(AreaTreeHandler.java:244)\n\tat org.apache.fop.fo.pagination.PageSequence.endOfNode(PageSequence.java:120)\n\tat org.apache.fop.fo.FOTreeBuilder$MainFOHandler.endElement(FOTreeBuilder.java:349)\n\tat org.apache.fop.fo.FOTreeBuilder.endElement(FOTreeBuilder.java:177)\n\tat org.apache.xalan.transformer.TransformerIdentityImpl.endElement(TransformerIdentityImpl.java:1102)\n\tat org.apache.xerces.parsers.AbstractSAXParser.endElement(Unknown Source)\n\tat org.apache.xerces.impl.XMLNSDocumentScannerImpl.scanEndElement(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n\tat org.apache.xalan.transformer.TransformerIdentityImpl.transform(TransformerIdentityImpl.java:485)\n...", "count": 0, "id": 149650, "time": "2011-09-22T19:46:25Z", "bug_id": 51874, "creation_time": "2011-09-22T19:46:25Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 27569\nProblematic file. Not intended to be distributed under ASL\n\na bit shorter file", "attachment_id": 27569, "bug_id": 51874, "id": 149652, "time": "2011-09-22T19:54:57Z", "creator": "vlsergey@gmail.com", "creation_time": "2011-09-22T19:54:57Z", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 27765\nSimplified FO file showing the issue\n\nThanks for your bug report. After some investigation I managed to reduce the size of the problematic table to just 3 rows and 2 columns.\n\nWhat happens is that a table-cell spanning two columns overlaps with a cell from the previous row that spans two rows.\n\nThere is a bug in the table code (package o.a.f.fo.flow.table) that doesn't check for this kind of situation. It's not entirely clear what should be done: either throw an error about the overlap, or move the cell to a later column such that two consecutive slots are available; this would lead to a hole in the table (a missing fo:table-cell element).\n\nThe bug shows up in o.a.f.layoutmgr.table.RowPainter.addAreasAndFlushRow. The grid unit at row index 1 and col index 1 (corresponding to cell 1.2) is later overridden by cell 2.1's grid unit. So cell 1.2 never gets a chance to properly 'shut down' and reset firstCellParts[1]. Which leads to the AssertionFailedError when cell 3.2 tries to register its first cell part in this variable.\n\nAs mentioned above the algorithm that places cells on the table grid must be made more robust. However, this problem occurs with rather rare and complicated tables, so fixing it would be considered low priority.\n\nThe best thing to do probably is to avoid the error by filling the holes in the table with empty fo:table-cell elements (i.e., that contain an empty <fo:block/>). This way, the cell placement algorithm cannot be confused. Or maybe the table-cell is not actually meant to span two columns.\n\nHTH,\nVincent", "attachment_id": 27765, "id": 150496, "creation_time": "2011-10-12T16:34:13Z", "time": "2011-10-12T16:34:13Z", "creator": "vhennebert@gmail.com", "bug_id": 51874, "is_private": false}, {"count": 3, "tags": [], "text": "resetting severity from major to normal pending further review", "is_private": false, "bug_id": 51874, "id": 157273, "time": "2012-04-07T01:37:17Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:37:17Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "resetting P2 open bugs to P3 pending further review", "is_private": false, "id": 157557, "creation_time": "2012-04-07T01:44:37Z", "time": "2012-04-07T01:44:37Z", "creator": "gadams@apache.org", "bug_id": 51874, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "etienne.massip@gmail.com", "attachment_id": null, "text": "With 7.0.18 packaged as a candidate for release and finally unreleased, when I stop the Tomcat service (only 1 war deployed), the service takes a lot of time to stop and finally was killed by system.\n\nHaving a look into the stderr log, I see it paused right after the folowing line :\n\nINFO: Stopping ProtocolHandler [http-apr-0]\n\nThen went into a slow loop and fill the log with these lines :\n\n13 juil. 2011 14:30:30 org.apache.tomcat.util.net.AprEndpoint stopInternal\nATTENTION: Acceptor thread [http-apr-0-Acceptor-0] failed to unlock. Forcing hard socket shutdown.\n13 juil. 2011 14:30:31 org.apache.tomcat.util.net.AprEndpoint stopInternal\nATTENTION: Acceptor thread [http-apr-0-Acceptor-0] failed to unlock. Forcing hard socket shutdown.\n13 juil. 2011 14:30:32 org.apache.tomcat.util.net.AprEndpoint stopInternal\nATTENTION: Acceptor thread [http-apr-0-Acceptor-0] failed to unlock. Forcing hard socket shutdown.\netc. (about 30 times before it was killed)\n\nI think there was no such issue with 7.0.16.", "id": 147894, "time": "2011-07-13T12:40:11Z", "bug_id": 51503, "creation_time": "2011-07-13T12:40:11Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 51503, "text": "This has already been fixed in trunk and will be included in 7.0.19 onwards.", "id": 147895, "time": "2011-07-13T12:43:23Z", "creator": "markt@apache.org", "creation_time": "2011-07-13T12:43:23Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "I got the same issue with 7.0.19; please also note that my HTTP connector is disabled in server.xml.", "is_private": false, "bug_id": 51503, "id": 147969, "time": "2011-07-18T08:50:27Z", "creator": "etienne.massip@gmail.com", "creation_time": "2011-07-18T08:50:27Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "This report makes no sense. If the http connector is disabled then there won't be any http acceptor threads.", "id": 147972, "time": "2011-07-18T09:26:12Z", "bug_id": 51503, "creation_time": "2011-07-18T09:26:12Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 51503, "text": "Got it : It happens when I remove the 8080 HTTP port value at installation time.\n\nI thought that the installer then would comment the HTTP connector part in the server.xml, but actually, it just wrote port=\"\".\n\nI guess you should consider adding a check that the port number value should not be empty to prevent the user to be misled as I was.", "id": 147974, "time": "2011-07-18T09:33:06Z", "creator": "etienne.massip@gmail.com", "creation_time": "2011-07-18T09:33:06Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "etienne.massip@gmail.com", "attachment_id": null, "text": "BTW, there is no error logged at server startup, is the port=\"\" syntax legal ?", "id": 147975, "time": "2011-07-18T09:36:00Z", "bug_id": 51503, "creation_time": "2011-07-18T09:36:00Z", "is_private": false}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "OK, that makes a lot more sense. Looks like some", "id": 147977, "time": "2011-07-18T15:15:32Z", "bug_id": 51503, "creation_time": "2011-07-18T15:15:32Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 51503, "attachment_id": null, "id": 147978, "time": "2011-07-18T15:15:53Z", "creator": "markt@apache.org", "creation_time": "2011-07-18T15:15:53Z", "is_private": false, "text": "... additional checks are required."}, {"count": 8, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 147979, "time": "2011-07-18T16:19:23Z", "bug_id": 51503, "creation_time": "2011-07-18T16:19:23Z", "is_private": false, "text": "The additional validation has been added to 7.0.x and will be included in 7.0.20 onwards."}, {"count": 9, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "Created attachment 33416\ncatalina.2016-01-07.log\n\nI reviewed the fix (r1147949) with the question of backporting it to current Tomcat 6, while working on bug 52028.\n\nThe current behaviour of Tomcat 6:\n\n1). The installer part of the fix r1147949 (tomcat.nsi) has already been backported to Tomcat 6.\n\nI tested installer for 6.0.44. It has this feature and works well.\n\n2). The message \"Acceptor thread .. failed to unlock.\" from Comment 0 is observed when running with APR connector.\n\nI tested the current 6.0.x/trunk (6.0.45-dev)\n\nWith APR connectors there is a delay of 10 seconds for each connector\nduring Tomcat shutdown.\nThe message is printed only once, not 30 times.\n\n> 07.01.2016 8:04:54 org.apache.tomcat.util.net.AprEndpoint stop\n> WARNING: Acceptor thread [http-0-Acceptor-0] failed to unlock. Forcing hard socket shutdown.\n\nThere is no message when running with BIO connectors,\nand there are no delays during shutdown.\n\nThus only APR connectors are affected.\n\nI will attach the logs, for a reference.\n\n\nMy conclusion:\n\n1). It is worth fixing AprEndpoint so that it does not try connecting to a wrong port number and does not print that message.\n\nI think the AprEndpoint issue will be addressed under bug 52028 / r1208115.\n\n2). It is worth protecting from missing port number, but it is not worth rejecting the port number of 0 like r1147949 does.\n\nThe value of 0 may be a valid use case now, and it will be a valid use case once bug 52028 is implemented.\n\nTomcat 7 (since r1207695) uses the default of -1.", "id": 187455, "time": "2016-01-07T05:44:48Z", "bug_id": 51503, "creation_time": "2016-01-07T05:44:48Z", "is_private": false, "attachment_id": 33416}, {"count": 10, "tags": [], "bug_id": 51503, "text": "Implemented in Tomcat 6 by r1723466 and will be in 6.0.45 onwards.", "id": 187456, "time": "2016-01-07T06:14:12Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2016-01-07T06:14:12Z", "is_private": false, "attachment_id": null}, {"count": 11, "attachment_id": 33417, "bug_id": 51503, "is_private": false, "id": 187457, "time": "2016-01-07T06:17:33Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2016-01-07T06:17:33Z", "tags": [], "text": "Created attachment 33417\ncatalina.2016-01-07.log (2)\n\nThe log from testing the implemented feature. For a reference.\n\nTomcat 6 @r1723466"}]
[{"count": 0, "tags": [], "bug_id": 50744, "attachment_id": null, "text": "_1_)\nIn response to CVE-2011-0013 ( and also to resolve other security issues) we decided to update Tomcat from Verion 5.5.27  to 5.5.32\n\n_2_)\nThe process to enable SSL for Tomcat documented at URL http://tomcat.apache.org/tomcat-5.5-doc/ssl-howto.html was followed for setting up the SSL at Version 5.5.27.\n\n_2_a_)\n\nThe following command was used to generate the Certificate Keystore\n\n$JAVA_HOME/bin/keytool -genkey -alias tomcat -keyalg RSA \\\n  -keystore /home/tomcat/.keystore\n\n(However we used our customized password rather than  the deafult one changeit)\n\n_2_b_)\n \nThe following entry was added to server.xml :\n\n    <!-- Define a SSL HTTP/1.1 Connector on port 8443 -->\n    <Connector port=\"8443\" maxHttpHeaderSize=\"8192\"\n               maxThreads=\"150\" minSpareThreads=\"25\" maxSpareThreads=\"75\"\n               enableLookups=\"false\" disableUploadTimeout=\"true\"\n               acceptCount=\"100\" scheme=\"https\" secure=\"true\" SSLEnabled=\"true\"\n               clientAuth=\"false\" sslProtocol=\"SSL\"\n               keystoreFile=\"/home/tomcat/.keystore\"\n               keystorePass=\"<Known Password>\" algorithm=\"IbmX509\" />\n\n_2_c_)\nThis process has worked correctly for serving Tomcat without SSL on port 8080 and  with SSL  on port 8443\n\n_3_)\nSimilar process was used to setup SSL for Tomcat 5.5.32. However Tomcat starts with some errors serving Tomcat on non-SSL  port 8080 correctly and the SSL port on 8443 does not work. (Catalina logs have some errors and I have attached the log to this BUG report).\n\n_4_)\nWhat changed between version 5.5.27 and 5.5.32  that resulted in this failure?\n\nThank you for your help and support in this matter.", "id": 144093, "time": "2011-02-09T09:56:37Z", "creator": "murthys@us.ibm.com", "creation_time": "2011-02-09T09:56:37Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 50744, "attachment_id": null, "is_private": false, "id": 144094, "time": "2011-02-09T10:23:33Z", "creator": "murthys@us.ibm.com", "creation_time": "2011-02-09T10:23:33Z", "text": "The download source for Tomcat 5.5.32 is:\n\nhttp://archive.apache.org/dist/tomcat/tomcat-5/v5.5.32/bin/\n\nThe files that were downloaded are:\n\n_1_)\napache-tomcat-5.5.32-compat.tar.gz       2011-01-23 20:52  1.6M  \n\n_2_)\napache-tomcat-5.5.32.tar.gz              2011-01-23 20:54  7.8M  \n\nThe chsums matched and there is no corruption of any of the binaries/files."}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "(In reply to comment #0)\n> Catalina logs have some errors and I have attached the log to this BUG report).\n\nThere is no attachment. Without seeing the actual error it is hard to help.", "id": 144100, "time": "2011-02-09T13:26:54Z", "bug_id": 50744, "creation_time": "2011-02-09T13:26:54Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "chris@christopherschultz.net", "text": "You are going to provide some more information.\n\nThis isn't a bug report: it's a request for help. Please post to the user list before filing a bug. If this is determined to be a bug, please re-open.", "id": 144101, "time": "2011-02-09T13:43:52Z", "bug_id": 50744, "creation_time": "2011-02-09T13:43:52Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 50744, "attachment_id": 26628, "text": "Created attachment 26628\nCatalina Log", "id": 144102, "time": "2011-02-09T14:02:44Z", "creator": "murthys@us.ibm.com", "creation_time": "2011-02-09T14:02:44Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 50744, "attachment_id": null, "text": "I personally think that it is not a help request. \n\nWe had a server.xml file working for both SSL port and Non-SSL port for Tomcat Version 5.5.27\n\nWe updated  the Tomcat to Version 5.5.32 and used the same server.xml file. With that the  SSL port of Tomcat stopped working.\n\nThe O/S and all the other things have remained the same on the server on which  Tomcat update was performed and that leads me to believe that something changed in Tomcat that caused the failure.\n\nI have upload the catalina log for your  perusal. Kindly review the log and let me know if in fact it is a configuartion issue and I need to pursue it with user group.\n\nThank you for your help and support in this matter.", "id": 144103, "time": "2011-02-09T14:14:21Z", "creator": "murthys@us.ibm.com", "creation_time": "2011-02-09T14:14:21Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 50744, "text": "From the log:\n\nFeb 8, 2011 8:40:32 PM org.apache.coyote.http11.Http11BaseProtocol init\nINFO: Initializing Coyote HTTP/1.1 on http-8080\nFeb 8, 2011 8:40:34 PM org.apache.coyote.http11.Http11BaseProtocol init\nSEVERE: Error initializing endpoint\njava.net.SocketException: Unbound server sockets not implemented\n\tat javax.net.ServerSocketFactory.createServerSocket(Unknown Source)\n\tat org.apache.tomcat.util.compat.Jdk14Compat.getUnboundSocket(Jdk14Compat.java:130)\n\tat org.apache.tomcat.util.net.jsse.JSSESocketFactory.checkConfig(JSSESocketFactory.java:393)\n\tat org.apache.tomcat.util.net.jsse.JSSE14SocketFactory.init(JSSE14SocketFactory.java:127)\n\tat org.apache.tomcat.util.net.jsse.JSSESocketFactory.createSocket(JSSESocketFactory.java:96)\n\tat org.apache.tomcat.util.net.PoolTcpEndpoint.initEndpoint(PoolTcpEndpoint.java:293)\n\tat org.apache.coyote.http11.Http11BaseProtocol.init(Http11BaseProtocol.java:139)\n\tat org.apache.catalina.connector.Connector.initialize(Connector.java:1002)\n(...)", "id": 144105, "time": "2011-02-09T14:23:42Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-02-09T14:23:42Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 50744, "text": "Created attachment 26629\nThis server.xml works correctly for both SSL and non-SSL port for Tomcat 5.5.27 and fails to serve Tomcat on SSL port for Tomcat 5.5.32\n\nSumitting the server.xml  file that works correctly for both SSL and non-SSL port for Tomcat 5.5.27 and fails to serve Tomcat on SSL port for Tomcat 5.5.32.\n\nIf Tomcat 5.5.32 is working correctly then should the server.xml that I have attached work corrctly (which worked as per the design on Tomcat 5.5.27) ?", "id": 144106, "time": "2011-02-09T14:26:44Z", "creator": "murthys@us.ibm.com", "creation_time": "2011-02-09T14:26:44Z", "is_private": false, "attachment_id": 26629}, {"count": 8, "tags": [], "text": "Hi Konstantin:\n\nIf all the configuartions  required for the Tomcat to start services on both SSL port ( 8443) and non-SSL port (8080) are put in place in server.xml  and when Tomcat server is started the services on port 8443 are not started with Tomcat  5.5.32\n\nHere is the deal:\n\nroot@svmciqa002 $ netstat -an | grep 8443\nroot@svmciqa002 $ netstat -an | grep 8080\ntcp        0      0  *.8080                 *.*                    LISTEN\nroot@svmciqa002 $ \n\nI configure Tomcat 5.5.27 and use the same server.xml that was used for 5.5.32. Guess what - both  ports (8443 and 8080) are listening as per the design:\n\nroot@svmciqa002 $ netstat -an | grep 8443\ntcp        0      0  *.8443                 *.*                    LISTEN\nroot@svmciqa002 $ netstat -an | grep 8080\ntcp        0      0  *.8080                 *.*                    LISTEN\nroot@svmciqa002 $ \n\nI disagree with your argument that  I have incorrect syntax with my server.xml file.\n\nIf what you suspect is true, then I would not see the services  on port 8443  for both Tomcat Versions (5.5.27 as well as 5.5.32)\n\nKindly get back to me with your thoughts on this.\n\nThank you for your help and support in this matter.\n\nSri", "attachment_id": null, "id": 144120, "creator": "murthys@us.ibm.com", "time": "2011-02-09T20:54:40Z", "bug_id": 50744, "creation_time": "2011-02-09T20:54:40Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 50744, "is_private": false, "text": "Created attachment 26630\n2011-02-11_tc55_50744_JSSESocketFactory.patch\n\n(In reply to comment #8)\n> I disagree with your argument that  I have incorrect syntax with my server.xml\n> file.\n\nWhom do you disagree with? I never said the above.\n\nThe issue here is that the 1.4 JVM that you are using does not implement a feature of \"unbound server sockets\" that the current code uses.\n\nLooking at Jdk14Compat.java that probably stems from\nhttp://svn.apache.org/viewvc?view=revision&revision=778258\nthat apparently is a fix for\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=45528\n\nwhich is about 1,5 years ago.\n\n\nI am attaching a patch (for the current tc5.5.x, as of 5.5.33) that will probably fix this issue.", "id": 144121, "time": "2011-02-09T21:30:57Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-02-09T21:30:57Z", "attachment_id": 26630}, {"attachment_id": null, "tags": [], "bug_id": 50744, "is_private": false, "count": 10, "id": 144135, "time": "2011-02-10T10:23:00Z", "creator": "murthys@us.ibm.com", "creation_time": "2011-02-10T10:23:00Z", "text": "Hi Konstantin:\n\nThank you very much for working on this issue, identifying the problem and also providing a patch.\n\nI will download the patch and test it out before COB today. \n\nI missed the fact that Christopher Schultz made an update and inadvertantly I assumed that you indicated that \"This isn't a bug report\". I apologize for my mistake.\n\n\nRegards,\n\nSridhar"}, {"attachment_id": 26651, "tags": [], "bug_id": 50744, "text": "Created attachment 26651\n2011-02-14_tc55_50744_JSSESocketFactory.patch\n\nA better patch. Now it includes debug logging.", "count": 11, "id": 144256, "time": "2011-02-14T10:04:07Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-02-14T10:04:07Z", "is_private": false}, {"attachment_id": 26652, "tags": [], "bug_id": 50744, "text": "Created attachment 26652\n2011-02-14 Binary version of the patch for 5.5.33 (unofficial)\n\nCompiled classes that match the 2011-02-14_tc55_50744_JSSESocketFactory.patch patch, for Tomcat 5.5.33.\n\nTo install:\n1) Install Tomcat 5.5.33\n2) Unzip the archive into $CATALINA_HOME/server/classes\n\nTo enable debug logging in JSSESocketFactory, if you are using the default (JULI) logging, add the following line into $CATALINA_BASE/conf/logging.properties:\n\norg.apache.tomcat.util.net.jsse.JSSESocketFactory.level=FINE\n\nNote, that this is an unofficial patch and it is not released by ASF. Use it on your own risk.", "count": 12, "id": 144257, "time": "2011-02-14T10:22:04Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-02-14T10:22:04Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 50744, "is_private": false, "text": "I will test this out next week and let you know if the issue reported is resolved. Thank you very much Konstantin for helping me with the patch.\n\nRegards,\nSri", "id": 144350, "time": "2011-02-16T09:50:33Z", "creator": "murthys@us.ibm.com", "creation_time": "2011-02-16T09:50:33Z", "attachment_id": null}, {"count": 14, "tags": [], "text": "This has been fixed in 5.5.x and will be included in 5.5.34 onwards.", "is_private": false, "id": 148689, "creator": "markt@apache.org", "time": "2011-08-18T16:44:51Z", "bug_id": 50744, "creation_time": "2011-08-18T16:44:51Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 47427, "text": "non-detailed description:\n\n1. you setuped the SSL host. Everything is *OK* if you have user's cert.\n\n<VirtualHost 10.0.0.86:8443>  \n    ServerAdmin kuku@parks.lv\n    ServerName mihailp1.parks.lv\n    DocumentRoot \"/mihailp1/www-secure\"\n\n    SSLEngine on\n    SSLCertificateKeyFile \"/root/mihailp1-ca/mihailp1.key\"\n    SSLCertificateFile  \"/root/mihailp1-ca/mihailp1.crt\"\n    SSLCACertificateFile \"/root/mihailp1-ca/mihailp1-ca.crt\"\n\n    SSLVerifyClient require\n    SSLVerifyDepth 3\n    SSLOptions +OptRenegotiate\n\n    ErrorLog  \"logs/secure-error_log\"\n    CustomLog \"logs/secure-access_log\" common\n</VirtualHost>\n\n2. open the browser and *don't* install user's cert\n3. try to open the site by any major browsers, you will get error\n4. as you can see in the log (and the code) ssl module returns error 403, but browser *doesn't* get it at all\n5. if you try repeat the same scenarion in nginx, you would get simple error  page, because nginx can handle (and finalize) requests without user's cert.", "id": 128276, "time": "2009-06-25T08:27:21Z", "creator": "mike.pechkin@gmail.com", "creation_time": "2009-06-25T08:27:21Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "mike.pechkin@gmail.com", "attachment_id": null, "is_private": false, "id": 128277, "time": "2009-06-25T08:38:32Z", "bug_id": 47427, "creation_time": "2009-06-25T08:38:32Z", "text": "1. you see error 403 in the log\n2. browser doesn't get 403 error and ErrorDocument 403 ... doesn't work at all!"}, {"count": 2, "tags": [], "bug_id": 47427, "attachment_id": null, "id": 128278, "time": "2009-06-25T08:46:14Z", "creator": "mike.pechkin@gmail.com", "creation_time": "2009-06-25T08:46:14Z", "is_private": false, "text": "1. setup apache, try openssl s_client\n\n# openssl s_client -host 10.0.0.86 -port 8443\nCONNECTED(00000003)\ndepth=1 /C=LV/ST=Riga/L=Riga/O=Parks AS CA/OU=IT/CN=Parks AS CA/emailAddress=kuku@parks.lv\nverify error:num=19:self signed certificate in certificate chain\nverify return:0\n12358:error:14094410:SSL routines:SSL3_READ_BYTES:sslv3 alert handshake failure:s3_pkt.c:1053:SSL alert number 40\n12358:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake failure:s23_lib.c:188:\n\nyou will see the same error in Opera too.\n\n2. if you use s_client under nginx, you would see prompt which fails later because you didn't provide required key files."}, {"count": 3, "tags": [], "bug_id": 47427, "text": "IMHO this is not a bug but a feature. httpd immediately cancels the SSL connection if not provided with a client cert. If you don't like that please try the following configuration: \n\n<VirtualHost 10.0.0.86:8443>  \n    ServerAdmin kuku@parks.lv\n    ServerName mihailp1.parks.lv\n    DocumentRoot \"/mihailp1/www-secure\"\n\n    SSLEngine on\n    SSLCertificateKeyFile \"/root/mihailp1-ca/mihailp1.key\"\n    SSLCertificateFile  \"/root/mihailp1-ca/mihailp1.crt\"\n    SSLCACertificateFile \"/root/mihailp1-ca/mihailp1-ca.crt\"\n\n    <Directory /mihailp1/www-secure\n    SSLVerifyClient require\n    SSLVerifyDepth 3\n    SSLOptions +OptRenegotiate\n    </Directory>\n\n    ErrorLog  \"logs/secure-error_log\"\n    CustomLog \"logs/secure-access_log\" common\n</VirtualHost>", "id": 128288, "time": "2009-06-25T10:24:36Z", "creator": "rpluem@apache.org", "creation_time": "2009-06-25T10:24:36Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "mike.pechkin@gmail.com", "attachment_id": null, "is_private": false, "id": 128292, "time": "2009-06-25T11:40:59Z", "bug_id": 47427, "creation_time": "2009-06-25T11:40:59Z", "text": "Yes, using <Directory> tag helps much, but I *want* use beatiful error page here, this is public site."}, {"count": 5, "tags": [], "bug_id": 47427, "text": "What about\n\n<VirtualHost 10.0.0.86:8443>  \n    ServerAdmin kuku@parks.lv\n    ServerName mihailp1.parks.lv\n    DocumentRoot \"/mihailp1/www-secure\"\n\n    SSLEngine on\n    SSLCertificateKeyFile \"/root/mihailp1-ca/mihailp1.key\"\n    SSLCertificateFile  \"/root/mihailp1-ca/mihailp1.crt\"\n    SSLCACertificateFile \"/root/mihailp1-ca/mihailp1-ca.crt\"\n\n    <Directory /mihailp1/www-secure\n    SSLVerifyClient optional\n    SSLVerifyDepth 3\n    SSLOptions +OptRenegotiate\n    SSLRequire %{SSL_CLIENT_VERIFY} eq \"SUCCESS\"\n    </Directory>\n\n    ErrorLog  \"logs/secure-error_log\"\n    CustomLog \"logs/secure-access_log\" common\n</VirtualHost>\n\nand an error page located in an directory outside the document root mapped in with an alias?", "id": 128293, "time": "2009-06-25T11:52:17Z", "creator": "rpluem@apache.org", "creation_time": "2009-06-25T11:52:17Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "mike.pechkin@gmail.com", "attachment_id": null, "text": "Thank you for your workaround, it nice.\nBut at the same time I always see \"Select certificate\" window in FF.\nSee bug 47055, even with patch the window popups.\nI will do more research, because I *need* error 403 handler *and* silent FF.", "id": 128303, "time": "2009-06-26T02:29:53Z", "bug_id": 47427, "creation_time": "2009-06-26T02:29:53Z", "is_private": false}]
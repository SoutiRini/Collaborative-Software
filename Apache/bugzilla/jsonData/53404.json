[{"count": 0, "attachment_id": 28922, "bug_id": 53404, "text": "Created attachment 28922\nexample test program\n\nWhen writing to a file using HSSFWorkbook.write() the write fails with the below stack trace, and wipes out any data existing in the file.\n\nThis functionality was introduced in version 3.7b1, and has been confirmed to exist in the most recent production version as well (v3.8).\n\nI've attached a test program that reliably reproduces this.  To use it unzip the attachment and review the README file.\n\n-----------------------\n\nException in thread \"main\" java.lang.IllegalArgumentException: calculated end index (29228) is out of allowable range (29224..29226)\n\tat org.apache.poi.util.LittleEndianByteArrayOutputStream.<init>(LittleEndianByteArrayOutputStream.java:41)\n\tat org.apache.poi.hssf.record.StandardRecord.serialize(StandardRecord.java:38)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook$SheetRecordCollector.serialize(HSSFWorkbook.java:1215)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.getBytes(HSSFWorkbook.java:1261)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.write(HSSFWorkbook.java:1160)\n\tat poifseditor.PoifsEditor.addSomeRows(PoifsEditor.java:45)\n\tat poifseditor.PoifsEditor.main(PoifsEditor.java:62)", "id": 159931, "time": "2012-06-12T20:56:45Z", "creator": "asf-bugzilla@eqbridges.com", "creation_time": "2012-06-12T20:56:45Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 53404, "attachment_id": null, "is_private": false, "id": 159959, "time": "2012-06-13T15:43:01Z", "creator": "apache@gagravarr.org", "creation_time": "2012-06-13T15:43:01Z", "text": "Can you narrow down which record is triggering the problem? Does the file pass the Microsoft Binary File Format Validator before being loaded in POI?"}, {"count": 2, "tags": [], "bug_id": 53404, "text": "I don't have access to a Windows machine currently to run the Microsoft Binary File Format Validator.  I've attached a copy of the excel file that is generated, so perhaps someone who is capable of running the validator can do so.\n\nI did not try to narrow down to which record is causing it because all of the records are identical -- they are all inserted by the \"poifs-writer\" module in the attached test harness.", "id": 159968, "time": "2012-06-13T16:16:12Z", "creator": "asf-bugzilla@eqbridges.com", "creation_time": "2012-06-13T16:16:12Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": 28933, "creator": "asf-bugzilla@eqbridges.com", "text": "Created attachment 28933\nsample source xls file.\n\nthis sample file was generated by the poifs-writer module of the attached test program.", "id": 159969, "time": "2012-06-13T16:17:08Z", "bug_id": 53404, "creation_time": "2012-06-13T16:17:08Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "creator": "yegor@dinom.ru", "text": "Just to make it clear:\n\n POI-3.6 (write) + POI-3.6 (edit) is success.\n\n POI-3.6 (write) + POI-3.7-beta1 (edit) fails. \n\nwhat is the result of using POI-3.8 (write) + POI-3.8 (edit) ?  \n\nPOI-3.6 (write) + POI-3.8 (edit) ?\n\nYegor", "count": 4, "id": 159977, "time": "2012-06-13T18:03:03Z", "bug_id": 53404, "creation_time": "2012-06-13T18:03:03Z", "is_private": false}, {"count": 5, "tags": [], "creator": "asf-bugzilla@eqbridges.com", "is_private": false, "text": "POI-3.6 (write) + POI-3.6 (edit) is success.\n\n--> confirmed success\n\nPOI-3.6 (write) + POI-3.7-beta1 (edit) fails. \n\n--> confirmed fails\n\nPOI-3.8 (write) + POI-3.8 (edit)\n\n--> confirmed successful\n\nPOI-3.6 (write) + POI-3.8 (edit)\n\n--> confirmed fails", "id": 159978, "time": "2012-06-13T18:19:20Z", "bug_id": 53404, "creation_time": "2012-06-13T18:19:20Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 53404, "text": "FYI, using the attached test harness it's easy to swap versions by changing the version numbers in poifs-writer/pom.xml and poifs-editor/pom.xml and then running 'mvn -U clean package'  before running 'runTest.sh'", "id": 159979, "time": "2012-06-13T18:20:55Z", "creator": "asf-bugzilla@eqbridges.com", "creation_time": "2012-06-13T18:20:55Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 53404, "is_private": false, "text": "I don't see a bug here. POI-3.6 is more than 2 years old and many bugs have been fixed since then. \n\ncan you try a simple workaround: if poifs-writer fails with IllegalArgumentException which indicates that the file was created by a old version of POI then write it to a byte array and read back. Something like this:\n\n wb = new HSSFWorkbook(\"created by POI-3.6.xls\");\n try {\n   // do stuff\n } catch (IllegalArgumentException e){\n  \n   ByteArrayOutputStream out = new ByteArrayOutputStream();\n   wb.write(out);\n   wb = new HSSFWorkbook(new ByteArrayOutputStream(out.toByteArray()));\n\n   // do stuff\n }\n\nLet us know if it worked for you.\n\nCheers,\nYegor", "id": 159994, "time": "2012-06-14T07:01:26Z", "creator": "yegor@dinom.ru", "creation_time": "2012-06-14T07:01:26Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 53404, "text": "i've been able to address the issue with what you describe (n.b.: with a fix for the typo to use ByteArrayInputStream as an argument to the HSSFWorksheet ctor).\n\nis there a more reliable way to determine the version other than by exception handling?  e.g. is there a metadata property somewhere that would reflect this?\n\ni've toyed with the idea of using getImplementationVersion() (as the test program uses for printing)...\n\nall this said, i'm surprised by the reluctance to try to address this issue.  as it happens we have several thousand legacy spreadsheets in pre-3.6 format.  can you be more specific why it won't be fixed?", "id": 160009, "time": "2012-06-14T17:30:32Z", "creator": "asf-bugzilla@eqbridges.com", "creation_time": "2012-06-14T17:30:32Z", "is_private": false, "attachment_id": null}, {"count": 9, "attachment_id": null, "creator": "yegor@dinom.ru", "is_private": false, "id": 160024, "time": "2012-06-15T07:36:44Z", "bug_id": 53404, "creation_time": "2012-06-15T07:36:44Z", "tags": [], "text": "(In reply to comment #8)\n> i've been able to address the issue with what you describe (n.b.: with a fix\n> for the typo to use ByteArrayInputStream as an argument to the HSSFWorksheet\n> ctor).\n> \n> is there a more reliable way to determine the version other than by\n> exception handling?  e.g. is there a metadata property somewhere that would\n> reflect this?\n> \n\nNo, HSSF does not write version info in the output.\n\n> i've toyed with the idea of using getImplementationVersion() (as the test\n> program uses for printing)...\n> \n> all this said, i'm surprised by the reluctance to try to address this issue.\n> as it happens we have several thousand legacy spreadsheets in pre-3.6\n> format.  can you be more specific why it won't be fixed?\n\nIt wasn't clear that you have several thousand legacy spreadsheets in pre-3.6 format. I thought tha tall you need is to upgrade both writer and editor parts to the latest and greatest POI-3.8. \n\nI re-opened the bug. Hope to have it fixed by POI-3.9 (late 2012). \n\nYegor"}, {"count": 10, "tags": [], "bug_id": 53404, "attachment_id": null, "is_private": false, "id": 162588, "time": "2012-10-05T14:49:32Z", "creator": "asf-bugzilla@eqbridges.com", "creation_time": "2012-10-05T14:49:32Z", "text": "Is this still expected to be released in late 2012?  If so, what's the target milestone for it?  Thanks"}, {"count": 11, "attachment_id": null, "bug_id": 53404, "is_private": false, "id": 162620, "time": "2012-10-08T12:46:01Z", "creator": "yegor@dinom.ru", "creation_time": "2012-10-08T12:46:01Z", "tags": [], "text": "This bug is open which means we plan to address it in the future. \n\nPOI is a volunteer project. If this bug is important for you, please do work on it and submit a patch. Otherwise please wait. \n\nWe plan to release POI-3.9 in late 2012, hope this problem will be fixed by then.\n\nYegor\n\n(In reply to comment #10)\n> Is this still expected to be released in late 2012?  If so, what's the\n> target milestone for it?  Thanks"}, {"count": 12, "tags": [], "bug_id": 53404, "attachment_id": null, "is_private": false, "id": 162932, "time": "2012-10-25T15:15:07Z", "creator": "yegor@dinom.ru", "creation_time": "2012-10-25T15:15:07Z", "text": "Should be fixed in r1402186. Please try with the latest build from trunk.\n\nYegor"}, {"count": 13, "attachment_id": null, "creator": "asf-bugzilla@eqbridges.com", "is_private": false, "id": 162933, "time": "2012-10-25T15:28:31Z", "bug_id": 53404, "creation_time": "2012-10-25T15:28:31Z", "tags": [], "text": "Thanks much.  Will this be going out with the next release?  Or will it need to be scheduled?"}, {"count": 14, "tags": [], "creator": "yegor@dinom.ru", "is_private": false, "id": 162934, "creation_time": "2012-10-25T15:32:48Z", "time": "2012-10-25T15:32:48Z", "bug_id": 53404, "text": "Yes, the fix will be included in POI-3.9. I plan to roll it some time Dec 2012.\n\n(In reply to comment #13)\n> Thanks much.  Will this be going out with the next release?  Or will it need\n> to be scheduled?", "attachment_id": null}]
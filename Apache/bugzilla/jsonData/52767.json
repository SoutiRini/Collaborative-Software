[{"count": 0, "tags": [], "bug_id": 52767, "text": "This is Ken Cheung, a Computer Science M.Phil. student. I observed some\ncode clones in Tomcat and found inconsistent code:\n\n/tomcat/trunk/java/org/apache/catalina/realm/JDBCRealm.java\n\n676\t        if (driver == null) {\n677\t            try {\n678\t                Class<?> clazz = Class.forName(driverName);\n679\t                driver = (Driver) clazz.newInstance();\n680\t            } catch (Throwable e) {\n681\t                ExceptionUtils.handleThrowable(e);\n682\t                throw new SQLException(e.getMessage(), e);\n683\t            }\n684\t        }\n685\t\n686\t        // Open a new connection\n687\t        Properties props = new Properties();\n688\t        if (connectionName != null)\n689\t            props.put(\"user\", connectionName);\n690\t        if (connectionPassword != null)\n691\t            props.put(\"password\", connectionPassword);\n692\t        dbConnection = driver.connect(connectionURL, props);\n\n/tomcat/trunk/java/org/apache/catalina/valves/JDBCAccessLogValve.java\n\n566\t        if (driver == null) {\n567\t            try {\n568\t                Class<?> clazz = Class.forName(driverName);\n569\t                driver = (Driver) clazz.newInstance();\n570\t            } catch (Throwable e) {\n571\t                ExceptionUtils.handleThrowable(e);\n572\t                throw new SQLException(e.getMessage(), e);\n573\t            }\n574\t        }\n575\t\n576\t        // Open a new connection\n577\t        Properties props = new Properties();\n578\t        props.put(\"autoReconnect\", \"true\");\n579\t        if (connectionName != null) {\n580\t            props.put(\"user\", connectionName);\n581\t        }\n582\t        if (connectionPassword != null) {\n583\t            props.put(\"password\", connectionPassword);\n584\t        }\n585\t        conn = driver.connect(connectionURL, props);\n\nQuick description of the inconsistency\nTwo code snippets are very similar code, but as you see, in JDBCRealm.java does not use \"props.put(\"autoReconnect\", \"true\")\" while JDBCAccessLogValve.java has.\n\nWe thought it could be a potential bug or inconsistency. Hope this helps.", "id": 154140, "time": "2012-02-25T14:32:33Z", "creator": "msrbugzilla@gmail.com", "creation_time": "2012-02-25T14:32:33Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 154158, "time": "2012-02-25T23:59:51Z", "bug_id": 52767, "creation_time": "2012-02-25T23:59:51Z", "text": "Yep, there are different and the difference is documented.\n\nI don't like a mysql specific setting being in the code - especially that one - but removing it for 7.0.x is not an option since there is a small chance it could break something.\n\nRemoving it for 8.0.x (trunk seems reasonable). Users that want it can always add it back in via the URL."}, {"count": 2, "tags": [], "bug_id": 52767, "is_private": false, "text": "Could I know where the difference is documented? Thank you.", "id": 154286, "time": "2012-02-27T15:31:37Z", "creator": "msrbugzilla@gmail.com", "creation_time": "2012-02-27T15:31:37Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 52767, "is_private": false, "text": "(In reply to comment #2)\n> Could I know where the difference is documented? Thank you.\n\nIn the Javadoc.\n\n\nThis has been fixed in trunk (it will not be back-ported to 7.0.x) and will be included in 8.0.0 onwards.", "id": 154625, "time": "2012-03-07T13:23:58Z", "creator": "markt@apache.org", "creation_time": "2012-03-07T13:23:58Z", "attachment_id": null}]
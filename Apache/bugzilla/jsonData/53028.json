[{"count": 0, "tags": [], "creator": "dmitry@pirs.omsknet.ru", "attachment_id": null, "id": 157090, "time": "2012-04-03T03:02:41Z", "bug_id": 53028, "creation_time": "2012-04-03T03:02:41Z", "is_private": false, "text": "After resolve bug (ID 45472) a commit (Revision 1,243,240) broke the usual behavior of xls files created through the POI.\n\nPreviously, if the row had not been set height then it was a flag RowRecord.setBadFontHeight(false) and cell with word wrap text,\nwhich gave the auto fit of the row height when opening the file in Excel.\n\n  Now in HSSFSheet.createRow is calling HSSFRow. setHeight which resets flag RowRecord.setBadFontHeight(true). What does Excel and then fit the row height of the text in cells with word wrapping. \n  Yet please note that HSSFRow.setHeight c height == -1 does not reset the flag of in RowRecord.setBadFontHeight(false), and don't access to private variable row type RowRecord.\n\nI suggest the following options:\nFor the method **** HSSFSheet.createRow ****\n1. Make a check on the set getDefaultRowHeight other than 255\n if (getDefaultRowHeight ()! = 255)\n   row.setHeight (getDefaultRowHeight ());\n   \n2. Make another version of the createRow with a different name, or add an parameter to will create a row with no fixed working height and auto height fit.\n\nFor the method **** HSSFRow.setHeight ****\n1. In the case of height == -1, reset the flag RowRecord.setBadFontHeight(false).\n  if (height == -1) {\n    RowRecord.setBadFontHeight (false);\n    row.setHeight ((short) (0xFF | 0x8000));\n  } else {\n\n2. For the class HSSFRow add a method to access BadFontHeight ie getter and setter"}, {"count": 1, "tags": [], "bug_id": 53028, "is_private": false, "text": "Can you post sample code that demonstrates the issue? I would like to see a sample code that used to work before r1243240 and produces bad output now. \n\nAlso, does the problem show itself in all versions of Excel? Which version of MS Office are you using?\n\nYegor", "id": 157094, "time": "2012-04-03T06:45:06Z", "creator": "yegor@dinom.ru", "creation_time": "2012-04-03T06:45:06Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "dmitry@pirs.omsknet.ru", "attachment_id": 28536, "is_private": false, "id": 157096, "time": "2012-04-03T07:31:48Z", "bug_id": 53028, "creation_time": "2012-04-03T07:31:48Z", "text": "Created attachment 28536\nJava code produce ugly xls file"}, {"text": "Created attachment 28537\nxls file with autosize height ok", "tags": [], "bug_id": 53028, "is_private": false, "count": 3, "id": 157097, "time": "2012-04-03T07:32:47Z", "creator": "dmitry@pirs.omsknet.ru", "creation_time": "2012-04-03T07:32:47Z", "attachment_id": 28537}, {"count": 4, "tags": [], "bug_id": 53028, "attachment_id": 28538, "text": "Created attachment 28538\nxls file with autosize height ugly", "id": 157098, "time": "2012-04-03T07:33:28Z", "creator": "dmitry@pirs.omsknet.ru", "creation_time": "2012-04-03T07:33:28Z", "is_private": false}, {"count": 5, "tags": [], "creator": "dmitry@pirs.omsknet.ru", "is_private": false, "text": "I added an example with code and output files.\n\nI think it does not depend on the version of MS Office. Checked in Office 2007, 2003.", "id": 157099, "time": "2012-04-03T07:42:20Z", "bug_id": 53028, "creation_time": "2012-04-03T07:42:20Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 53028, "text": "OK, thanks.\n\nSomething to work for me in the POI-3.9 dev cycle. \n\nRegards,\nYegor", "id": 157100, "time": "2012-04-03T07:45:13Z", "creator": "yegor@dinom.ru", "creation_time": "2012-04-03T07:45:13Z", "tags": [], "is_private": false}, {"text": "Hi, is this issue because of this bug ? http://stackoverflow.com/questions/10978307/apache-poi-excel-hssf-wrap-text-issue", "tags": [], "bug_id": 53028, "is_private": false, "count": 7, "id": 159917, "time": "2012-06-12T10:20:11Z", "creator": "sanchay.h@gmail.com", "creation_time": "2012-06-12T10:20:11Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 53028, "is_private": false, "text": "Created attachment 29053\nPatch in two variants\n\nSeems like auto fit with HSSFSheet.setDefaultRowHeight is mission impossible due to option bit #1 in DefaultRowHeightRecord, at least in OpenOffice 3.2.1. Auto fit\nshould work at least when setDefaultRowHeight isn't used.", "id": 160606, "time": "2012-07-12T13:40:53Z", "creator": "swatkats@abv.bg", "creation_time": "2012-07-12T13:40:53Z", "attachment_id": 29053}, {"count": 9, "tags": [], "creator": "superrubiroyd@gmail.com", "attachment_id": null, "is_private": false, "id": 161387, "time": "2012-08-14T18:24:17Z", "bug_id": 53028, "creation_time": "2012-08-14T18:24:17Z", "text": "This problem should be fixed in trunk.\n\nPlease try with a nightly build - see download links on http://poi.apache.org/\nor build yourself from SVN trunk, see http://poi.apache.org/subversion.html"}, {"count": 10, "tags": [], "bug_id": 53028, "attachment_id": null, "id": 162415, "time": "2012-09-26T13:58:53Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-09-26T13:58:53Z", "is_private": false, "text": "Thank you for fixing this issue.\n\nFirst, this issue is just \"Broken auto fit row height\".\n\nI agree that the issue is more apparent for cells that have word wrap, but it is also observable in different circumstances. E.g. if I have a cell with a font which is bigger than the default height of the row.\n\nConfirming, that this issue is observable with \"3.8\" release,\nI do not see it with \"3.8-beta5\",\nand it is fixed in the current nightly (20120924). I am using Excel 2003.\n\nJust FYI: I also tried to verify this with LibreOffice 3.6.1 on Windows and the auto fit of row height is broken there (the row is displayed using its default height). It is their fault, not yours. A report in their bugzilla:\nhttps://www.libreoffice.org/bugzilla/show_bug.cgi?id=34717\n\n\nSecond, reviewing the fix in r1373005 I see an inconsistency:\nThere are 2 methods in org.apache.poi.hssf.usermodel.HSSFRow:\n\n - HSSFRow.setHeight(short)\n - HSSFRow.setHeightInPoints(float)\n\nBoth methods have special processing for the value of (-1). In r1373005 the fix was applied to the setHeight() method only.\n\nI am REOPENING this issue, so that setHeightInPoints() be fixed as well."}, {"count": 11, "tags": [], "bug_id": 53028, "is_private": false, "text": "Created attachment 29420\n2012-09-26_poi_53028_c10.patch - Patch for Comment 10\n\nHere is proposed fix and test for Comment 10 - HSSFRow.setHeightInPoints().\n\nI do not have dev environment for POI, so this is untested.", "id": 162416, "time": "2012-09-26T14:03:36Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-09-26T14:03:36Z", "attachment_id": 29420}, {"count": 12, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 194162, "time": "2016-10-05T20:03:33Z", "bug_id": 53028, "creation_time": "2016-10-05T20:03:33Z", "is_private": false, "text": "Applied via r1763484, will be included in 3.16-beta1, thanks for the Patch and Test."}]
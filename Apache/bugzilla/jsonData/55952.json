[{"count": 0, "tags": [], "bug_id": 55952, "attachment_id": 31169, "text": "Created attachment 31169\nExample Node.js server which can be used to demonstrate the issue\n\nRunning ab (from SVN r1555436) against a node.js HTTPS server running on localhost using keep-alive results in the following behavior:\n\n$ ./ab -k -n 1 https://127.0.0.1:3443/test.txt\nThis is ApacheBench, Version 2.3 <$Revision: 1543020 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)...apr_pollset_poll: The timeout specified has expired (70007)\n\nAfter some investigation, I believe the issue is that for large responses openssl may buffer some data and in the case that the server does not close the connection after sending the data (due to keep-alive) apr_pollset_poll has nothing to read and times out.  To test this hypothesis, I printed the value returned by SSL_pending before apr_pollset_poll which resulted in the following output:\n\n$ ./ab -k -n 1 https://127.0.0.1:3443/test.txt\nThis is ApacheBench, Version 2.3 <$Revision: 1543020 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)...SSL_pending: 0\napr_pollset_poll complete\nSSL_pending: 0\napr_pollset_poll complete\nSSL_pending: 0\napr_pollset_poll complete\nSSL_pending: 0\napr_pollset_poll complete\nSSL_pending: 128\napr_pollset_poll: The timeout specified has expired (70007)\n\nWhich seems to support that hypothesis.  For completeness, I'll attach the node.js server that I used for testing as well as the patch with the additional debug information.\n\nThis issue may be related to Bug 22686, although that bug does not appear to be specific to SSL connections with keep-alive.\n\nCheers,\nKevin", "id": 172076, "time": "2014-01-05T02:03:07Z", "creator": "kevin@kevinlocke.name", "creation_time": "2014-01-05T02:03:07Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 31170\nPatch to print SSL_pending before apr_pollset_poll for debugging", "is_private": false, "id": 172077, "creation_time": "2014-01-05T02:04:27Z", "time": "2014-01-05T02:04:27Z", "creator": "kevin@kevinlocke.name", "bug_id": 55952, "attachment_id": 31170}]
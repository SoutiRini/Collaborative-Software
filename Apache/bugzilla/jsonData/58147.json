[{"count": 0, "tags": [], "creator": "shailender.khugshal@gmail.com", "text": "When apache sends back the response to the server from where it got request, it always gives 502 bad Gateway. I checked the packets which apache receives and it's a 200OK. below is the data ascii data from erroneous packet\n\n<closeConnection />HTTP/1.1 502 Bad Gateway\n\nDate: Thu, 16 Jul 2015 14:46:54 GMT\n\nServer: Apache\n\nX-XSS-Protection: 1; mode=block\n\nX-Frame-Options: SAMEORIGIN\n\nX-XSS-Protection: 1; mode=block\n\nX-Frame-Options: SAMEORIGIN\n\nTransfer-Encoding: chunked\n\nContent-Type: text/html; charset=iso-8859-1\n\nExpires: Thu, 16 Jul 2015 14:46:54 GMT\n\n\n\ne8\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>502 Bad Gateway</title>\n</head><body>\n<h1>Bad Gateway</h1>\n<p>The proxy server received an invalid\n\nresponse from an upstream server.<br />\n\n</p>\n</body></html>\n\n\n0 \n\n\n\nI also checked the normal response which i get when not using apache, i see difference as below\n\n<getAllData />HTTP/1.1 202 Accepted\n\nDate: Thu, 16 Jul 2015 20:17:01 GMT\n\nServer: example/1.2\n\nX-XSS-Protection: 1; mode=block\n\nX-Frame-Options: SAMEORIGIN\n\nContent-Type: application/octet-stream\n\nVary: Accept-Encoding\n\nTransfer-Encoding: chunked\n\n\n\n24\n\n....................................\n\n0\nthe above response is when apache is used.\n\n\n<getAllData />HTTP/1.1 202 Accepted\n\nDate: Thu Jul 16 20:17:01 2015\n\nServer: example/1.2\n\nTransfer-Encoding: chunked\n\nContent-Type: application/octet-stream\n\n\n\n24;status_update=Yes\n\n....................................\n\n0\n\nthe above is when apache is not used.\n\n\nBelow is the configuration\n\n\n\nSetEnv keepalive on\nSetEnv proxy-sendchunked 0\nInclude conf/extra/httpd-default.conf\nProxyRequests off\nSetEnv proxy-sendextracrlf 1\nSetEnv proxy-sendcl\nProxyPreserveHost On\nProxyPass / http://10.10.10.10:80/xyz connectiontimeout=60 timeout=60\nProxyPassReverse / http://10.10.10.10:80/xyz\n\n\n\nCould anybody provide any help on this.", "id": 184055, "attachment_id": null, "bug_id": 58147, "creation_time": "2015-07-17T13:57:56Z", "time": "2015-07-17T13:57:56Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "covener@gmail.com", "text": "traces would help (LogLevel trace8)", "count": 1, "id": 184056, "time": "2015-07-17T14:08:40Z", "bug_id": 58147, "creation_time": "2015-07-17T14:08:40Z", "is_private": false}, {"count": 2, "tags": [], "creator": "shailender.khugshal@gmail.com", "attachment_id": null, "id": 184058, "time": "2015-07-17T14:19:11Z", "bug_id": 58147, "creation_time": "2015-07-17T14:19:11Z", "is_private": false, "text": "Sorry, Please find the logs after turning LogLevel to debug\n\n[Fri Jul 17 19:46:16.886545 2015] [authz_core:debug] [pid 31680:tid 139666699319040] mod_authz_core.c(835): [client example-1:36577] AH01628: authorization result: granted (no directives)\n[Fri Jul 17 19:46:16.886834 2015] [proxy:debug] [pid 31680:tid 139666699319040] mod_proxy.c(1163): [client example-1:36577] AH01143: Running scheme http handler (attempt 0)\n[Fri Jul 17 19:46:16.886873 2015] [proxy:debug] [pid 31680:tid 139666699319040] proxy_util.c(2140): AH00942: HTTP: has acquired connection for (example)\n[Fri Jul 17 19:46:16.886888 2015] [proxy:debug] [pid 31680:tid 139666699319040] proxy_util.c(2193): [client example-1:36577] AH00944: connecting http://example/xyz to example:80\n[Fri Jul 17 19:46:16.886991 2015] [proxy:debug] [pid 31680:tid 139666699319040] proxy_util.c(2394): [client example-1:36577] AH00947: connected /xyz to example:80\n[Fri Jul 17 19:46:16.887599 2015] [proxy:debug] [pid 31680:tid 139666699319040] proxy_util.c(2771): AH02824: HTTP: connection established with example:80 (example)\n[Fri Jul 17 19:46:16.887731 2015] [proxy:debug] [pid 31680:tid 139666699319040] proxy_util.c(2923): AH00962: HTTP: connection complete to example:80 (example)\n[Fri Jul 17 19:46:16.893857 2015] [proxy:debug] [pid 31680:tid 139666699319040] proxy_util.c(2155): AH00943: http: has released connection for (example)\n[Fri Jul 17 19:46:16.901750 2015] [authz_core:debug] [pid 31680:tid 139666688829184] mod_authz_core.c(835): [client example-1:36577] AH01628: authorization result: granted (no directives)\n[Fri Jul 17 19:46:16.901862 2015] [proxy:debug] [pid 31680:tid 139666688829184] mod_proxy.c(1163): [client example-1:36577] AH01143: Running scheme http handler (attempt 0)\n[Fri Jul 17 19:46:16.901881 2015] [proxy:debug] [pid 31680:tid 139666688829184] proxy_util.c(2140): AH00942: HTTP: has acquired connection for (example)\n[Fri Jul 17 19:46:16.901891 2015] [proxy:debug] [pid 31680:tid 139666688829184] proxy_util.c(2193): [client example-1:36577] AH00944: connecting http://example/xyz to example:80\n[Fri Jul 17 19:46:16.901902 2015] [proxy:debug] [pid 31680:tid 139666688829184] proxy_util.c(2394): [client example-1:36577] AH00947: connected /xyz to example:80\n[Fri Jul 17 19:46:16.977873 2015] [proxy:debug] [pid 31680:tid 139666688829184] proxy_util.c(2155): AH00943: http: has released connection for (example)\n[Fri Jul 17 19:46:16.979650 2015] [authz_core:debug] [pid 31680:tid 139666678339328] mod_authz_core.c(835): [client example-1:36577] AH01628: authorization result: granted (no directives)\n[Fri Jul 17 19:46:16.979785 2015] [proxy:debug] [pid 31680:tid 139666678339328] mod_proxy.c(1163): [client example-1:36577] AH01143: Running scheme http handler (attempt 0)\n[Fri Jul 17 19:46:16.979805 2015] [proxy:debug] [pid 31680:tid 139666678339328] proxy_util.c(2140): AH00942: HTTP: has acquired connection for (example)\n[Fri Jul 17 19:46:16.979816 2015] [proxy:debug] [pid 31680:tid 139666678339328] proxy_util.c(2193): [client example-1:36577] AH00944: connecting http://example/xyz to example:80\n[Fri Jul 17 19:46:16.979828 2015] [proxy:debug] [pid 31680:tid 139666678339328] proxy_util.c(2394): [client example-1:36577] AH00947: connected /xyz to example:80\n[Fri Jul 17 19:46:17.021632 2015] [proxy:debug] [pid 31680:tid 139666678339328] proxy_util.c(2155): AH00943: http: has released connection for (example)\n[Fri Jul 17 19:46:17.024506 2015] [authz_core:debug] [pid 31680:tid 139666667849472] mod_authz_core.c(835): [client example-1:36577] AH01628: authorization result: granted (no directives)\n[Fri Jul 17 19:46:17.024588 2015] [proxy:debug] [pid 31680:tid 139666667849472] mod_proxy.c(1163): [client example-1:36577] AH01143: Running scheme http handler (attempt 0)\n[Fri Jul 17 19:46:17.024603 2015] [proxy:debug] [pid 31680:tid 139666667849472] proxy_util.c(2140): AH00942: HTTP: has acquired connection for (example)\n[Fri Jul 17 19:46:17.024613 2015] [proxy:debug] [pid 31680:tid 139666667849472] proxy_util.c(2193): [client example-1:36577] AH00944: connecting http://example/xyz to example:80\n[Fri Jul 17 19:46:17.024624 2015] [proxy:debug] [pid 31680:tid 139666667849472] proxy_util.c(2394): [client example-1:36577] AH00947: connected /xyz to example:80\n[Fri Jul 17 19:46:17.067892 2015] [proxy:debug] [pid 31680:tid 139666667849472] proxy_util.c(2155): AH00943: http: has released connection for (example)\n[Fri Jul 17 19:46:17.120894 2015] [authz_core:debug] [pid 31680:tid 139666657359616] mod_authz_core.c(835): [client example-1:36577] AH01628: authorization result: granted (no directives)\n[Fri Jul 17 19:46:17.121008 2015] [proxy:debug] [pid 31680:tid 139666657359616] mod_proxy.c(1163): [client example-1:36577] AH01143: Running scheme http handler (attempt 0)\n[Fri Jul 17 19:46:17.121025 2015] [proxy:debug] [pid 31680:tid 139666657359616] proxy_util.c(2140): AH00942: HTTP: has acquired connection for (example)\n[Fri Jul 17 19:46:17.121055 2015] [proxy:debug] [pid 31680:tid 139666657359616] proxy_util.c(2193): [client example-1:36577] AH00944: connecting http://example/xyz to example:80\n[Fri Jul 17 19:46:17.121067 2015] [proxy:debug] [pid 31680:tid 139666657359616] proxy_util.c(2394): [client example-1:36577] AH00947: connected /xyz to example:80\n[Fri Jul 17 19:46:17.123172 2015] [proxy_http:error] [pid 31680:tid 139666657359616] (104)Connection reset by peer: [client example-1:36577] AH01110: error reading response\n[Fri Jul 17 19:46:17.123414 2015] [headers:debug] [pid 31680:tid 139666657359616] mod_headers.c(899): AH01503: headers: ap_headers_error_filter()\n[Fri Jul 17 19:46:17.123496 2015] [proxy:debug] [pid 31680:tid 139666657359616] proxy_util.c(2155): AH00943: HTTP: has released connection for (example)\n[Fri Jul 17 19:46:17.123537 2015] [proxy:debug] [pid 31680:tid 139666657359616] proxy_util.c(2864): [remote example:80] AH02642: proxy: connection shutdown"}, {"count": 3, "tags": [], "text": "(In reply to Eric Covener from comment #1)\n> traces would help (LogLevel trace8)\n\n\ntrace8 is more useful than debug.", "is_private": false, "id": 184059, "creation_time": "2015-07-17T14:19:55Z", "time": "2015-07-17T14:19:55Z", "creator": "covener@gmail.com", "bug_id": 58147, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 58147, "text": "Created attachment 32908\nLogs trace8", "id": 184060, "time": "2015-07-17T14:32:31Z", "creator": "shailender.khugshal@gmail.com", "creation_time": "2015-07-17T14:32:31Z", "is_private": false, "attachment_id": 32908}, {"count": 5, "tags": [], "bug_id": 58147, "text": "Attached trace8", "id": 184061, "time": "2015-07-17T14:32:48Z", "creator": "shailender.khugshal@gmail.com", "creation_time": "2015-07-17T14:32:48Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "covener@gmail.com", "text": "Comment on attachment 32908\nLogs trace8\n\nDoes a packet capture confirm the backend host sent a TCP RST before the 78 byte body, or immediately after?", "id": 184062, "time": "2015-07-17T14:35:08Z", "bug_id": 58147, "creation_time": "2015-07-17T14:35:08Z", "is_private": false, "attachment_id": 32908}, {"count": 7, "tags": [], "creator": "shailender.khugshal@gmail.com", "text": "Created attachment 32909\nSequence of packet for the tranaction with backend\n\nAttached is the sequence of packet flow with backend. I shows host send TCP RST immediately after.", "id": 184063, "time": "2015-07-17T14:50:56Z", "bug_id": 58147, "creation_time": "2015-07-17T14:50:56Z", "is_private": false, "attachment_id": 32909}, {"count": 8, "tags": [], "text": "The server needs to avoid that.\n\nhttp://blog.netherlabs.nl/articles/2009/01/18/the-ultimate-so_linger-page-or-why-is-my-tcp-not-reliable", "is_private": false, "id": 184064, "creation_time": "2015-07-17T14:54:06Z", "time": "2015-07-17T14:54:06Z", "creator": "covener@gmail.com", "bug_id": 58147, "attachment_id": null}, {"count": 9, "tags": [], "text": "Which server? Backend server which sends data to apache or client server which receives data from apache.", "is_private": false, "id": 184065, "creation_time": "2015-07-17T16:07:27Z", "time": "2015-07-17T16:07:27Z", "creator": "shailender.khugshal@gmail.com", "bug_id": 58147, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 58147, "text": "(In reply to shailender.khugshal from comment #9)\n> Which server? Backend server which sends data to apache or client server\n> which receives data from apache.\n\nThe backend/origin server [whose host sent the RST] not the client.  HTTPD bugzilla is for for reporting bugs in httpd, not for support. Please don't reopen this bug until there is some indication of an httpd bug.", "id": 184066, "time": "2015-07-17T16:10:48Z", "creator": "covener@gmail.com", "creation_time": "2015-07-17T16:10:48Z", "is_private": false, "attachment_id": null}]
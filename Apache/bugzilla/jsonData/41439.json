[{"count": 0, "tags": [], "bug_id": 41439, "is_private": false, "id": 98384, "attachment_id": null, "creator": "bjoern@syltonline.de", "creation_time": "2007-01-23T01:06:21Z", "time": "2007-01-23T01:06:21Z", "text": "We run jk 1.2.20 on IIS6 on win2k3. Tomcat 5.0.28 on different machines. Some \nof our applications produce image-links containing the JK-Session information. \nExample:\n<li><a \nhref=\"/shoppingcc/common/boundary/login.do;jsessionid=D5E2FE08F02400159DFD62311\n1F98FEE.p-ng-ptom2\"><img \nsrc=\"/shoppingcc/img/btn_nav_main_login.gif;jsessionid=D5E2FE08F02400159DFD6231\n11F98FEE.p-ng-ptom2\" height=\"25\" width=\"145\" alt=\"Login\"></a></li>\n\nWe are not exactly sure why, but not all applications do. We konw that on the \nfirst call jk adds the information to all links in case the browser does not \nsupport cookies to store the info. But why in image tags?\n\nAnyway, on jk2.0.4, these pictures were displayed ok, so JK2 must have removed \nthe \";jksession=...\" part from the URL of the images. Even though images are \nnot mapped and served from the iis directly.\n\nNow, in the new 1.2.20 (maybe earlier versions too), the JK recognizes the \ntoken \";jksessionid\" ans states in the log that it removed that part of the \nURL (tracelog):\n--------------------------\n[Mon Jan 22 18:20:18 2007] [4992:4356] [debug] jk_isapi_plugin.c (801): Filter \nstarted\n[Mon Jan 22 18:20:18 2007] [4992:4356] [debug] jk_isapi_plugin.c (868): \nVirtual Host redirection \nof /callcenter.premiereshop.de:3126/shoppingcc/img/logo_premiereshop.gif;jsessi\nonid=23EE66145F266B442E5444F475F12C84.p-hh-ptom\n[Mon Jan 22 18:20:18 2007] [4992:4356] [trace] jk_uri_worker_map.c (542): enter\n[Mon Jan 22 18:20:18 2007] [4992:4356] [debug] jk_uri_worker_map.c (569): \nRemoving Session path ';jsessionid=23EE66145F266B442E5444F475F12C84.p-hh-ptom' \nURI '/callcenter.premiereshop.de:3126/shoppingcc/img/logo_premiereshop.gif'\n[Mon Jan 22 18:20:18 2007] [4992:4356] [debug] jk_uri_worker_map.c (575): \nAttempting to map \nURI '/callcenter.premiereshop.de:3126/shoppingcc/img/logo_premiereshop.gif;jses\nsionid=23EE66145F266B442E5444F475F12C84.p-hh-ptom' from 246 maps\n[Mon Jan 22 18:20:18 2007] [4992:4356] [debug] jk_uri_worker_map.c (587): \nAttempting to map context \nURI '/n1.tc.haendler.premierefernsehen.de*/abcc/vertraege/*.pdf=p-ng-ptom1' \nsource 'uriworkermap'\n---------------------\n\n...but the pictures are not displayed. in the IIS-Log you can see why:\n\n---------------------\n#Software: Microsoft Internet Information Services 6.0\n#Version: 1.0\n#Date: 2007-01-22 17:20:13\n#Fields: date time cs-method cs-uri-stem cs-uri-query cs-username c-ip cs-\nversion cs(User-Agent) cs(Referer) sc-status sc-bytes time-taken \n2007-01-22 17:20:13 \nGET /shoppingcc/img/logo_premiereshop.gif;jsessionid=23EE66145F266B442E5444F475\nF12C84.p-hh-ptom - - 172.17.67.35 HTTP/1.1 Mozilla/4.0+\n(compatible;+MSIE+6.0;+Windows+NT+5.1;+SV1;+.NET+CLR+1.1.4322;+InfoPath.1;+.NET\n+CLR+2.0.50727) - 401 1860 109\n2007-01-22 17:20:18 \nGET /shoppingcc/img/logo_premiereshop.gif;jsessionid=23EE66145F266B442E5444F475\nF12C84.p-hh-ptom - adpw\\admande40 172.17.67.35 HTTP/1.1 Mozilla/4.0+\n(compatible;+MSIE+6.0;+Windows+NT+5.1;+SV1;+.NET+CLR+1.1.4322;+InfoPath.1;+.NET\n+CLR+2.0.50727) - 404 1795 15\n2007-01-22 17:20:20 \nGET /shoppingcc/img/logo_premiereshop.gif;jsessionid=23EE66145F266B442E5444F475\nF12C84.p-hh-ptom - adpw\\admande40 172.17.67.35 HTTP/1.1 Mozilla/4.0+\n(compatible;+MSIE+6.0;+Windows+NT+5.1;+SV1;+.NET+CLR+1.1.4322;+InfoPath.1;+.NET\n+CLR+2.0.50727) - 404 1795 15\n---------------------\n\nThere is still the \";jksession=...\" in the requested URL.\n\nAll this resulting in the pictures of some applications are not beeing \ndisplayed on the first call of the webpage. After that, normaly the session \ndata kicks in and the sessions tags are not added any more to the images."}, {"count": 1, "tags": [], "bug_id": 41439, "is_private": false, "id": 98404, "attachment_id": null, "creator": "bjoern@syltonline.de", "creation_time": "2007-01-23T09:19:08Z", "time": "2007-01-23T09:19:08Z", "text": "Additional info:\nI checked with our developers. The URL suffix is generated in tomcats struts \nframework as soon as a session is initiated. Normally, this problem is covered \nby the cookies ability of most browsers. The first call to a page is normally \na forward page, frameset, sessionless or has no pictures (like machine \ninterfaces).\nThat explains why picture sources have a jsessionid and why that rarely leads \nto noticable flaws. But it doesn't cure the JK1-problem.\nPlease fix this soon. Thanks."}, {"count": 2, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "Although one doesn't have to use the struts tags, if one needs static content\nURLs, I still like the idea of being able to strip the suffixes. That way one\nwill be able to seperate static from dynamic content during deployment time and\ndevelopers can still stay on the safe side by encoding all URLs.\n\nI added a new property strip_session, which can be set in the registry or the\nproerties file (see docs) to a boolean value (see docs). Default is \"false\",\ni.e. suffixes of the form \";jsessionid=...\" will *not* be stripped. By turing\nstrip_session to true, they will be stripped, if the request doesn't get\nforwarded to tomcat.\n\nWe still need to port this to Apache und Sun Web Server though ...\n\nThis will be part of version 1.2.21.\n", "id": 98654, "time": "2007-01-28T12:07:10Z", "bug_id": 41439, "creation_time": "2007-01-28T12:07:10Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "bruno.haleblian@free.fr", "text": "(In reply to comment #2)\n> Although one doesn't have to use the struts tags, if one needs static content\n> URLs, I still like the idea of being able to strip the suffixes. That way one\n> will be able to seperate static from dynamic content during deployment time and\n> developers can still stay on the safe side by encoding all URLs.\n> \n> I added a new property strip_session, which can be set in the registry or the\n> proerties file (see docs) to a boolean value (see docs). Default is \"false\",\n> i.e. suffixes of the form \";jsessionid=...\" will *not* be stripped. By turing\n> strip_session to true, they will be stripped, if the request doesn't get\n> forwarded to tomcat.\n> \n> We still need to port this to Apache und Sun Web Server though ...\n> \n> This will be part of version 1.2.21.\n> \n\nWill this apply to jkunmount hrefs as well as outer hrefs?", "id": 101209, "time": "2007-03-30T02:56:06Z", "bug_id": 41439, "creation_time": "2007-03-30T02:56:06Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "Move a couple of fixed JK issues from resolved to closed.", "attachment_id": null, "bug_id": 41439, "id": 112394, "time": "2008-01-01T16:32:32Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-01-01T16:32:32Z", "is_private": false}]
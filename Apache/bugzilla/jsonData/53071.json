[{"count": 0, "tags": [], "bug_id": 53071, "attachment_id": null, "is_private": false, "id": 158013, "time": "2012-04-13T09:34:03Z", "creator": "1983-01-06@gmx.net", "creation_time": "2012-04-13T09:34:03Z", "text": "When setting\n\n> request.setAttribute(Globals.EXCEPTION_ATTR, e);\n> response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n\nin a server-side component the throwable#getMessage is completely ignored and only the stacktrace is shown. Message is not retrieved. Line 161 has to be simply replaced with\n\n> if (throwable != null)\n>   message = RequestUtil.filter(throwable.getMessage());\n> else\n>   message = RequestUtil.filter(response.getMessage());\n\nThe throwable message is nicely displayed."}, {"count": 1, "tags": [], "creator": "1983-01-06@gmx.net", "text": "This change could also be applied to Tomcat 7.", "id": 158014, "time": "2012-04-13T09:34:41Z", "bug_id": 53071, "creation_time": "2012-04-13T09:34:41Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "markt@apache.org", "text": "Fixed in trunk and 7.0.x and will be included in 7.0.28 onwards.\n\nProposed for 6.0.x\n\nNotes:\n1. The message from the Throwable was displayed in the stack trace.\n2. I modified the patch. The message from the Throwable is only used if no message\n   is specified via sendError()", "id": 159852, "time": "2012-06-11T09:32:59Z", "bug_id": 53071, "creation_time": "2012-06-11T09:32:59Z", "is_private": false, "attachment_id": null}, {"count": 3, "text": "(In reply to comment #2)\n> Fixed in trunk and 7.0.x and will be included in 7.0.28 onwards.\n> \n> Proposed for 6.0.x\n> \n> Notes:\n> 1. The message from the Throwable was displayed in the stack trace.\n\nI am aware of that but I don't want to burden my users with the stack traces, the message is just fine.\n\n> 2. I modified the patch. The message from the Throwable is only used if no\n> message\n>    is specified via sendError()\n\nThis is perfectly fine and does the job.\n\nThanks for the fix. Looking forward to 6.0.36.", "bug_id": 53071, "is_private": false, "id": 159859, "time": "2012-06-11T12:03:33Z", "creator": "1983-01-06@gmx.net", "creation_time": "2012-06-11T12:03:33Z", "tags": [], "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 53071, "attachment_id": null, "text": "Putting this caveat in the bug and not just on the dev list:\n\nThis might end up being a security problem, depending on what information is in the exception message. Can we make this a non-default option? Many sites (ours included) attempt to avoid any part of a stack trace (even the message) leaking-out to users.", "id": 159876, "time": "2012-06-11T17:04:17Z", "creator": "chris@christopherschultz.net", "creation_time": "2012-06-11T17:04:17Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 53071, "attachment_id": null, "text": "Then you have already replaced / modified the error report valve and you won't see this change.", "id": 159877, "time": "2012-06-11T17:24:24Z", "creator": "markt@apache.org", "creation_time": "2012-06-11T17:24:24Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 53071, "is_private": false, "text": "Created attachment 28920\nScreen shot from Tomcat 7.0.27\n\nJust a screen shot, for comparison. It is before implementing this feature.\nIt is CookieExample page, when pressing submit button without entering any values.", "id": 159926, "time": "2012-06-12T19:45:22Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-06-12T19:45:22Z", "attachment_id": 28920}, {"count": 7, "tags": [], "bug_id": 53071, "text": "Created attachment 28921\nScreen shot from Tomcat trunk\n\nThe same with Tomcat trunk after implementing the feature.", "id": 159927, "time": "2012-06-12T19:47:00Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-06-12T19:47:00Z", "is_private": false, "attachment_id": 28921}, {"count": 8, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 159928, "time": "2012-06-12T20:01:21Z", "bug_id": 53071, "creation_time": "2012-06-12T20:01:21Z", "is_private": false, "text": "(In reply to comment #4)\n> Putting this caveat in the bug and not just on the dev list:\n\nI agree with Mark here.\nThe change in r1348762 is in the place where ErrorReportValve prepares HTML text of the page. It does not affect other components. It does not affect components that display their own error pages.  The old implementation already displays the exception, so nothing new is revealed.\n\n\nI personally do not like use of \"{0}\" in the messages for the \"description\" field. Especially the ones for 404 and 403. It looks like some unrelated text is inserted into the middle of a sentence. With this change it is printed 4 times on the same page."}, {"count": 9, "tags": [], "creator": "1983-01-06@gmx.net", "attachment_id": null, "id": 159930, "time": "2012-06-12T20:13:30Z", "bug_id": 53071, "creation_time": "2012-06-12T20:13:30Z", "is_private": false, "text": "(In reply to comment #8)\n> (In reply to comment #4)\n> > Putting this caveat in the bug and not just on the dev list:\n> \n> I agree with Mark here.\n> The change in r1348762 is in the place where ErrorReportValve prepares HTML\n> text of the page. It does not affect other components. It does not affect\n> components that display their own error pages.  The old implementation\n> already displays the exception, so nothing new is revealed.\n\nExactly, the same information but more prominent.\n\n> I personally do not like use of \"{0}\" in the messages for the \"description\"\n> field. Especially the ones for 404 and 403. It looks like some unrelated\n> text is inserted into the middle of a sentence. With this change it is\n> printed 4 times on the same page.\n\nI personally dislike that one too in this valve.\n\nIn my opinion, the following should happen:\n\nIf message is not given: Message should be from https://tools.ietf.org/html/rfc2616#section-6.1.1 as per status code short name and description should be a copy of the first sentence of the RFC description. Maybe just as HTTPd does.\nIf message is given: Display message and show RFC description too.\n\nStack trace should be left as is.\n\nIt might make sense to limit the message length in the first line to n chars and show the entire message in the message line. But if and only if the message is to0 long. Otherwise the message line should be omitted."}, {"count": 10, "tags": [], "bug_id": 53071, "attachment_id": null, "text": "Fixed in 6.0.x and will be included in 6.0.36 onwards.", "id": 160454, "time": "2012-07-04T20:47:48Z", "creator": "markt@apache.org", "creation_time": "2012-07-04T20:47:48Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 53071, "is_private": false, "text": "(In reply to comment #8)\n> I personally do not like use of \"{0}\" in the messages for the \"description\"\n> field. Especially the ones for 404 and 403. It looks like some unrelated\n> text is inserted into the middle of a sentence. With this change it is\n> printed 4 times on the same page.\n\nI removed the {0} from the \"report\" in r1361991 (trunk) and r1362000 (tc7).\n\nMotivation:\n\nAs far as I can see, those properties are only used in ErrorReportValve. There they are only put into the \"report\", which is only output in an HTML document directly below the \"message\" that would have been put into {0}.\n\nIn addition the same \"message\" is again being output as an h1 heading shortly before.\n\nSo I see no reason at all to keep the \"message\" inside the \"report\".", "id": 160670, "time": "2012-07-16T12:36:09Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-07-16T12:36:09Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 53071, "attachment_id": null, "is_private": false, "id": 160765, "time": "2012-07-20T18:52:21Z", "creator": "1983-01-06@gmx.net", "creation_time": "2012-07-20T18:52:21Z", "text": "(In reply to comment #11)\n> (In reply to comment #8)\n> > I personally do not like use of \"{0}\" in the messages for the \"description\"\n> > field. Especially the ones for 404 and 403. It looks like some unrelated\n> > text is inserted into the middle of a sentence. With this change it is\n> > printed 4 times on the same page.\n> \n> I removed the {0} from the \"report\" in r1361991 (trunk) and r1362000 (tc7).\n\nRainer,\n\ncan you backport to Tomcat 6 too?"}, {"count": 13, "tags": [], "bug_id": 53071, "text": "Reopening this. This needs further improvement.\n\nWhen there is a java compilation error in JSP page, the error page becomes especially ugly. Reproducible in 7.0.29.\n\nTo reproduce:\n1. Change ROOT/index.jsp introducing a typo in Java code scriptlet, e.g.\ns/SimpleDateFormat/SimpleDate Format/\n\n2. Access the page.\n\nActual result: The whole text of the compilation exception, including a source code fragment, is included in the <h1> header, as well as in the \"message\" field. That is a lot of text without any formatting, occupying the whole screen. It is ugly.\n\nExpected result: Maybe include just some part of the text, and replace the rest with ellipsis \" (...)\"? Maybe use just the first line, as line breaks are lost when rendering HTML?\n\n\nAlso,\nthe changes mentioned in Comment 11 still have to be proposed/fixed in 6.0.", "id": 161279, "time": "2012-08-11T22:46:34Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-08-11T22:46:34Z", "is_private": false, "attachment_id": null}, {"count": 14, "text": "Jasper issue fixed in trunk and 7.0.x.\n\nJasper fix and {0} fix proposed for 6.0.c", "bug_id": 53071, "is_private": false, "id": 161307, "time": "2012-08-12T15:45:39Z", "creator": "markt@apache.org", "creation_time": "2012-08-12T15:45:39Z", "tags": [], "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 53071, "attachment_id": null, "text": "Fixed in 6.0.x and will be included in 6.0.36 onwards.", "id": 161748, "time": "2012-08-27T21:29:04Z", "creator": "markt@apache.org", "creation_time": "2012-08-27T21:29:04Z", "is_private": false}]
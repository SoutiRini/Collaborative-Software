[{"count": 0, "tags": [], "creator": "gregk@qld.gov.au", "is_private": false, "text": "Setup:\nClient-->----https://internal.domA.com---->--ApacheRevProxy\nApacheRevProxy-->----http via squid cache---->--external https web site\n\nApacheRevProxy doing URL rewrite to https://external.domB.com\nApacheRevProxy fetching URL via SquidCache\n\n\nUnder Bug: 19188 there was a patch posted to get around this issue.\nhttp://issues.apache.org/bugzilla/attachment.cgi?id=11552\n\nThis patch works well; under 2.0.48, but is not applicable to the current 2.2\nstream.\n\nIs it possible to get the patch changed to apply to 2.2 or current issue address\nplease? \n\nBelow are the current configs and debug from output.\nApache sends back to the client:\n     Service Temporarily Unavailable\n\n\n\nRev Proxy Virtual Host Config:\n------------------------------\n    ProxyRequests Off\n    ServerName internal.domA.com:443\n    SSLProxyEngine on\n    RewriteEngine on\n    SetOutputFilter  proxy-html\n    ProxyHTMLExtended On\n    RequestHeader unset accept-encoding\n    RequestHeader set Referer https://external.domB.com/\n    ProxyPass /  https://external.domB.com/\n    ProxyPassReverseCookieDomain internal.domA.com external.domB.com\n    ProxyHTMLURLMap https://external.domB.com          https://internal.domA.com/\n    <Location />\n        ProxyPassReverse  https://external.domB.com/\n        SetOutputFilter  proxy-html\n        ProxyHTMLExtended On\n        ProxyHTMLURLMap /  /\n        RequestHeader unset accept-encoding\n    </Location>\n    ProxyRemote * http://squid.cache.server:8080\n------------------------------\n\nDebug Logs:\n-----------\n[Thu Mar 22 13:15:48 2007] [info] Initial (No.1) HTTPS request received for\nchild 0 (server internal.domA.com:443)\n[Thu Mar 22 13:15:48 2007] [debug] mod_proxy_http.c(54): proxy: HTTP:\ncanonicalising URL //external.domB.com/\n[Thu Mar 22 13:15:48 2007] [debug] proxy_util.c(1378): [client 192.168.100.219]\nproxy: https: found worker https://external.domB.com/ for\nhttps://external.domB.com/, referer: https://external.domB.com/\n[Thu Mar 22 13:15:48 2007] [debug] mod_proxy.c(754): Trying to run\nscheme_handler against proxy\n[Thu Mar 22 13:15:48 2007] [debug] mod_proxy_http.c(1662): proxy: HTTP: serving\nURL https://external.domB.com/\n[Thu Mar 22 13:15:48 2007] [debug] proxy_util.c(1739): proxy: HTTPS: retrying\nthe worker for (external.domB.com)\n[Thu Mar 22 13:15:48 2007] [debug] proxy_util.c(1745): proxy: HTTPS: worker for\n(external.domB.com) has been marked for retry\n[Thu Mar 22 13:15:48 2007] [debug] proxy_util.c(1798): proxy: HTTPS: has\nacquired connection for (external.domB.com)\n[Thu Mar 22 13:15:48 2007] [debug] proxy_util.c(1859): proxy: connecting\nhttps://external.domB.com/ to external.domB.com:443\n[Thu Mar 22 13:15:48 2007] [debug] proxy_util.c(1955): proxy: connected\nhttps://external.domB.com/ to squid.cache.server:8080\n[Thu Mar 22 13:15:48 2007] [debug] proxy_util.c(2050): proxy: HTTPS: fam 2\nsocket created to connect to external.domB.com\n[Thu Mar 22 13:15:48 2007] [debug] proxy_util.c(2146): proxy: HTTPS: connection\ncomplete to squid.cache.server:8080 (squid.cache.server)\n[Thu Mar 22 13:15:48 2007] [info] [client squid.cache.server] Connection to\nchild 0 established (server internal.domA.com:443)\n[Thu Mar 22 13:15:48 2007] [info] Seeding PRNG with 0 bytes of entropy\n[Thu Mar 22 13:15:48 2007] [debug] ssl_engine_kernel.c(1752): OpenSSL:\nHandshake: start\n[Thu Mar 22 13:15:48 2007] [debug] ssl_engine_kernel.c(1760): OpenSSL: Loop:\nbefore/connect initialization\n[Thu Mar 22 13:15:48 2007] [debug] ssl_engine_kernel.c(1760): OpenSSL: Loop:\nSSLv2/v3 write client hello A\n[Thu Mar 22 13:20:48 2007] [debug] ssl_engine_io.c(1786): OpenSSL: I/O error, 7\nbytes expected to read on BIO#805b98 [mem: 911d60]\n[Thu Mar 22 13:20:48 2007] [debug] ssl_engine_kernel.c(1789): OpenSSL: Exit:\nerror in SSLv2/v3 read server hello A\n[Thu Mar 22 13:20:48 2007] [info] [client squid.cache.server] SSL Proxy connect\nfailed\n[Thu Mar 22 13:20:48 2007] [info] [client squid.cache.server] Connection closed\nto child 0 with abortive shutdown (server internal.domA.com:443)\n[Thu Mar 22 13:20:48 2007] [error] (502)Unknown error: proxy: pass request body\nfailed to squid.cache.server:8080 (squid.cache.server)\n[Thu Mar 22 13:20:48 2007] [error] (502)Unknown error: proxy: pass request body\nfailed to squid.cache.server:8080 (squid.cache.server) from 192.168.100.219 ()\n[Thu Mar 22 13:20:48 2007] [debug] proxy_util.c(1816): proxy: HTTPS: has\nreleased connection for (external.domB.com)\n[Thu Mar 22 13:20:48 2007] [debug] mod_proxy.c(777): Running scheme https\nhandler (attempt 0)\n[Thu Mar 22 13:20:48 2007] [debug] mod_proxy_http.c(1662): proxy: HTTP: serving\nURL https://external.domB.com/\n[Thu Mar 22 13:20:48 2007] [debug] proxy_util.c(1798): proxy: HTTPS: has\nacquired connection for (external.domB.com)\n[Thu Mar 22 13:20:48 2007] [debug] proxy_util.c(1859): proxy: connecting\nhttps://external.domB.com/ to external.domB.com:443\n[Thu Mar 22 13:20:48 2007] [debug] proxy_util.c(1955): proxy: connected / to\nexternal.domB.com:443\n[Thu Mar 22 13:20:48 2007] [debug] proxy_util.c(2050): proxy: HTTPS: fam 2\nsocket created to connect to external.domB.com\n[Thu Mar 22 13:24:32 2007] [error] (145)Connection timed out: proxy: HTTPS:\nattempt to connect to 203.203.100.15:443 (external.domB.com) failed\n[Thu Mar 22 13:24:32 2007] [error] ap_proxy_connect_backend disabling worker for\n(external.domB.com)\n[Thu Mar 22 13:24:32 2007] [debug] proxy_util.c(1816): proxy: HTTPS: has\nreleased connection for (external.domB.com)", "id": 100773, "time": "2007-03-21T20:49:35Z", "bug_id": 41926, "creation_time": "2007-03-21T20:49:35Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 41926, "attachment_id": null, "is_private": false, "id": 104800, "time": "2007-06-28T00:19:21Z", "creator": "jfclere@gmail.com", "creation_time": "2007-06-28T00:19:21Z", "text": "\n\n*** This bug has been marked as a duplicate of 19188 ***"}]
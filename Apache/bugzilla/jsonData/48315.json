[{"count": 0, "tags": [], "bug_id": 48315, "attachment_id": null, "id": 132537, "time": "2009-12-01T01:52:08Z", "creator": "silicium@natural-geek.org", "creation_time": "2009-12-01T01:52:08Z", "is_private": false, "text": "mod_proxy connectionproblems like [37770]\n\nEnvironment:\n\n- Connections comes from a properitary Loadbalancer.\n- No SSL on the Machines\n- Apache 2.2.9-10 (Debian Lenny)\n- Apache2 with mod_proxy and proxy_http enabled vhost\n...\n       ProxyPass / http://localhost:8080/\n       ProxyPassReverse / http://localhost:8080/\n...\n\non 8080 runs a tomcat-6.0.18\n\n\nShort Description:\n\n\nAround 2-4 times a day, mod_proxy will close the connection and return a HTTP/Bad_Gateway.\n\nalso i benched our Stagingsystem with ApacheBench 1'000'000 Connections, 1000 Parallel was no Problem for the System and the Problem could not be reproduced.\n\nOf course, Tomcat works fine and there are no errors or connection problems.\n\n\n[Mon Nov 30 12:50:38 2009] [error] [client x.x.x.x] (70014)End of file found: proxy: error reading status line from remote server localhost, referer: http://foo.bar\n\n[Mon Nov 30 12:50:38 2009] [error] [client x.x.x.x] proxy: Error reading from remote server returned by /LandingsGoogle.action, referer: http://foo.bar\n\n----------\n\n\n\n\nDebug Log Output:\n\n\n\n\n[Mon Nov 30 12:50:37 2009] [debug] mod_proxy_http.c(1710): proxy: start body send\n[Mon Nov 30 12:50:37 2009] [debug] mod_headers.c(740): headers: ap_headers_output_filter()\n[Mon Nov 30 12:50:37 2009] [debug] mod_deflate.c(632): [client x.x.x.x] Zlib: Compressed 19277 to 5278 : URL /foo/bar\n[Mon Nov 30 12:50:37 2009] [debug] mod_proxy_http.c(1803): proxy: end body send\n[Mon Nov 30 12:50:37 2009] [debug] proxy_util.c(2008): proxy: HTTP: has released connection for (localhost)\n[Mon Nov 30 12:50:38 2009] [debug] mod_proxy_http.c(60): proxy: HTTP: canonicalising URL //localhost:8080/Index.action\n[Mon Nov 30 12:50:38 2009] [debug] proxy_util.c(1488): [client x.x.x.x] proxy: http: found worker http://localhost:8080/ for http://localhost:8080/Index.action?foo_bar\n[Mon Nov 30 12:50:38 2009] [debug] mod_proxy.c(966): Running scheme http handler (attempt 0)\n[Mon Nov 30 12:50:38 2009] [debug] mod_proxy_ajp.c(575): proxy: AJP: declining URL http://localhost:8080/Index.action?foo_bar\n[Mon Nov 30 12:50:38 2009] [debug] mod_proxy_http.c(1937): proxy: HTTP: serving URL http://localhost:8080/Index.action?foo_bar\n[Mon Nov 30 12:50:38 2009] [debug] proxy_util.c(1990): proxy: HTTP: has acquired connection for (localhost)\n[Mon Nov 30 12:50:38 2009] [debug] proxy_util.c(2046): proxy: connecting http://localhost:8080/Index.action?foo_bar to localhost:8080\n[Mon Nov 30 12:50:38 2009] [debug] proxy_util.c(2139): proxy: connected /Index.action?foo_bar to localhost:8080\n[Mon Nov 30 12:50:38 2009] [debug] mod_proxy_http.c(1710): proxy: start body send\n[Mon Nov 30 12:50:38 2009] [debug] mod_headers.c(740): headers: ap_headers_output_filter()\n[Mon Nov 30 12:50:38 2009] [debug] mod_proxy_http.c(1803): proxy: end body send\n[Mon Nov 30 12:50:38 2009] [debug] proxy_util.c(2008): proxy: HTTP: has released connection for (localhost)\n[Mon Nov 30 12:50:38 2009] [error] [client x.x.x.x] (70014)End of file found: proxy: error reading status line from remote server localhost, referer: http://www.foo.bar/fnord?some_variables_and_awesome_stuff\n[Mon Nov 30 12:50:38 2009] [debug] mod_proxy_http.c(1439): [client 92.116.109.83] proxy: NOT Closing connection to client although reading from backend server localhost failed., referer: http://www.foo.bar/fnord?some_variables_and_awesome_stuff\n[Mon Nov 30 12:50:38 2009] [error] [client x.x.x.x] proxy: Error reading from remote server returned by /foobar.action, referer: http://www.foo.bar/fnord?some_variables_and_awesome_stuff\n[Mon Nov 30 12:50:38 2009] [debug] proxy_util.c(2008): proxy: HTTP: has released connection for (localhost)\n[Mon Nov 30 12:50:38 2009] [debug] mod_headers.c(740): headers: ap_headers_output_filter()\n[Mon Nov 30 12:50:38 2009] [debug] mod_headers.c(740): headers: ap_headers_output_filter()\n[Mon Nov 30 12:50:38 2009] [debug] mod_headers.c(740): headers: ap_headers_output_filter()\n[Mon Nov 30 12:50:38 2009] [debug] mod_deflate.c(632): [client x.x.x.x] Zlib: Compressed 3075 to 1198 : URL /error/HTTP_BAD_GATEWAY.html.var, referer: http://www.foo.bar/fnord"}, {"count": 1, "tags": [], "bug_id": 48315, "attachment_id": null, "id": 132543, "time": "2009-12-01T03:24:39Z", "creator": "rpluem@apache.org", "creation_time": "2009-12-01T03:24:39Z", "is_private": false, "text": "The remote (in this case Tomcat) has closed the connection before sending a response. There is nothing httpd can do about that."}, {"count": 2, "tags": [], "creator": "silicium@natural-geek.org", "attachment_id": null, "id": 132544, "time": "2009-12-01T03:58:08Z", "bug_id": 48315, "creation_time": "2009-12-01T03:58:08Z", "is_private": false, "text": "(In reply to comment #1)\n> The remote (in this case Tomcat) has closed the connection before sending a\n> response. There is nothing httpd can do about that.\n\nbut that should be written in the tomcat log\n\nthe tomcat doesnt show any connection errors.\n\nI Allso captured with TCPDump, Tomcat sends the right answer"}, {"count": 3, "tags": [], "text": "(In reply to comment #2)\n> (In reply to comment #1)\n> > The remote (in this case Tomcat) has closed the connection before sending a\n> > response. There is nothing httpd can do about that.\n> \n> but that should be written in the tomcat log\n> \n> the tomcat doesnt show any connection errors.\n> \n> I Allso captured with TCPDump, Tomcat sends the right answer\n\nI will doe this again and provide more informations", "is_private": false, "bug_id": 48315, "id": 132545, "time": "2009-12-01T04:01:43Z", "creator": "silicium@natural-geek.org", "creation_time": "2009-12-01T04:01:43Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Hi all,\n\nI have the same problem with an another application server (Glassfish). Because it happens on a critical application I cannot wait long time for a patch. Are there workarounds in order to avoid that error ?\n\nRegards\nMustafa", "is_private": false, "id": 132693, "creator": "mustafa.topaloglu@bmw.de", "time": "2009-12-09T08:20:34Z", "bug_id": 48315, "creation_time": "2009-12-09T08:20:34Z", "attachment_id": null}, {"count": 5, "attachment_id": null, "bug_id": 48315, "is_private": false, "id": 132695, "time": "2009-12-09T09:37:43Z", "creator": "silicium@natural-geek.org", "creation_time": "2009-12-09T09:37:43Z", "tags": [], "text": "hi there\n\nshort update:\n\nit seems to be a Tomcat problem/bug.\n\nthe EOF occource because of an TCP/RST.\nso, apache thinks about an not accessable proxy target.\n\nThere are maybe two ways to \"fix\"\n\nBest way is to find out why Tomcat close the connection (it does for just one SYN! so there is not really a network issue)\nso, the failure comes around 2 times per Day, this is realliy difficult to diagnost.\nAlso the Debug Logs would not say anything about that.\n\nI Will look forward to fix it like a dirty way.\nmaybe it is possible to define a max_retry value for mod_proxy to retry the connection if a SYN/RST.\n\n\nMarco"}, {"count": 6, "tags": [], "bug_id": 48315, "attachment_id": null, "id": 139230, "time": "2010-08-18T22:31:38Z", "creator": "dhseong@poscoict.com", "creation_time": "2010-08-18T22:31:38Z", "is_private": false, "text": "First, thanks for writing this!  It's solved a number of problems for \nme. \n\nI've run into a problem with one application.  The application allows \nthe user to upload a file via a form, does some parsing/processing of \nthe data, then redirects back to the index page.  Processing the data \ncan take a few seconds and I've been randomly getting an apache proxy \nerror during this operation.  The apache logs showed: \n\n\n(70014)End of file found: proxy: error reading status line from remote \nserver localhost, referer: ... \n\n\nIt appears that the following line from receive_data \n\n\n      # If data's still coming in but no HTTP header has been found \nwithin 5 seconds, close the connection \n      raise if (@request.start_time < (Time.now.to_i - 5)) \n\n\nis causing the connection to the back end to close before it's \nactually finished.  Increasing this to 15 seconds seems to have fixed \nmy problem. \n\norgin link : http://groups.google.com/group/switchpipe/browse_thread/thread/26328ed9af4da6a9"}, {"count": 7, "tags": [], "text": "We had a similar issue occurring with Apache 2.2.16 proxying to Apache 2.2.11\n\n\"This error occurs if the bytes recieved are less than 8192.\"\nSee bug #48656\n\nAdding output buffering to the source server resolved the issue for us.", "attachment_id": null, "bug_id": 48315, "id": 142553, "time": "2010-12-10T03:37:12Z", "creator": "ian@helastel.com", "creation_time": "2010-12-10T03:37:12Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 48315, "attachment_id": null, "id": 142554, "time": "2010-12-10T04:43:05Z", "creator": "ian@helastel.com", "creation_time": "2010-12-10T04:43:05Z", "is_private": false, "text": "(In reply to comment #7)\n> We had a similar issue occurring with Apache 2.2.16 proxying to Apache 2.2.11\n> \n> \"This error occurs if the bytes received are less than 8192.\"\n> See bug #48656\n> \n> Adding output buffering to the source server resolved the issue for us.\n\nThis seemed to make the issue much better, however we are still having some trouble so have changed set up to avoid proxy.\n\nOf interest:\n - Upgraded both servers so running 2.2.16\n - Timeout 30, KeepAlive On, MaxKeepAliveRequests 100, KeepAliveTimeout 2"}, {"attachment_id": null, "tags": [], "bug_id": 48315, "text": "Hello, Gentlemen,\n\n\nI've faced the same issue and, in my case, the problem seems to occur when the reverse proxy (RP) sends a request to the back-end server (using a previously establiseh connection) and, in the mean time (exactly), the back-end server closes the connection due to connection timeout (in my case, it is a Tomcat server with the default 20 seconds ConnectionTimeout).\n\nTo fix this, I've added \"smax=0 ttl=7\" (or any value less than the back-end connection timeout) to the ProxyPass directive.\n\nI hope it helps.\n\nRegards,\n\n\nOlivier", "count": 9, "id": 143319, "time": "2011-01-13T04:06:41Z", "creator": "olivier.boel@europarl.europa.eu", "creation_time": "2011-01-13T04:06:41Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 48315, "attachment_id": null, "id": 143940, "time": "2011-02-02T19:42:33Z", "creator": "pauledavis@gmail.com", "creation_time": "2011-02-02T19:42:33Z", "is_private": false, "text": "I'm still seeing this issue with version: 2.2.3-43\n\nHitting the backend server directly always works fine. On a production system, I'm seeing one of these errors every 2-3 seconds.\n\nNone of the SetEnv hacks appear to have any affect nor the setting used by Olivier."}, {"count": 11, "tags": [], "text": "nevermind, just realized I'm running a 5 year version. doh!!", "is_private": false, "id": 143941, "creator": "pauledavis@gmail.com", "time": "2011-02-02T20:03:22Z", "bug_id": 48315, "creation_time": "2011-02-02T20:03:22Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 48315, "attachment_id": null, "id": 143943, "time": "2011-02-02T20:46:37Z", "creator": "wrowe@apache.org", "creation_time": "2011-02-02T20:46:37Z", "is_private": false, "text": "Marking \"nevermind\""}]
[{"count": 0, "tags": [], "creator": "martin.harm@web.de", "text": "If you got a DynamicProxy inside the session, catalina fails to load this \nobject.\n\n\n\n\nSuggested fix: (tested just a little bit, not realy)\n\n\nin: org.apache.catalina.util.CustomObjectInputStream \n\n\noverwrite the method \n\n\nprotected Class resolveProxyClass(String[] interfaces)\n\n\nwith the implementation of java.io.ObjectInputStream except\n\n\nthe first line \n\n\nClassLoader latestLoader = classLoader; \n\n\n  // instead of ClassLoader latestLoader = latestUserDefinedLoader();\n\n\n\n\nthis seams to work..", "id": 41932, "time": "2003-08-01T07:46:48Z", "bug_id": 22041, "creation_time": "2003-08-01T07:46:48Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "markt@apache.org", "text": "I'd prefer something along the lines of the patch below. Could you test this \n(or attach a simple test case to this bug report). If it works, I'll commit it.\n\nIndex: catalina/src/share/org/apache/catalina/util/CustomObjectInputStream.java\n===================================================================\nRCS file:\n/home/cvs/jakarta-tomcat-\ncatalina/catalina/src/share/org/apache/catalina/util/Cu\nstomObjectInputStream.java,v\nretrieving revision 1.3\ndiff -u -r1.3 CustomObjectInputStream.java\n--- catalina/src/share/org/apache/catalina/util/CustomObjectInputStream.java\n27 Feb 2004 14:58:50 -0000      1.3\n+++ catalina/src/share/org/apache/catalina/util/CustomObjectInputStream.java\n16 May 2004 13:35:18 -0000\n@@ -72,5 +72,27 @@\n         return Class.forName(classDesc.getName(), false, classLoader);\n     }\n\n+    /**\n+     * Return a proxy class that implements the interfaces named in a proxy\n+     * class descriptor. Do this using the class loader assigned to this\n+     * Context.\n+     */\n+    protected Class resolveProxyClass(String[] interfaces)\n+        throws IOException, ClassNotFoundException {\n+\n+        ClassLoader originalClassLoader =\n+            Thread.currentThread().getContextClassLoader();\n+\n+        // Set thread to use context class loader\n+        Thread.currentThread().setContextClassLoader(classLoader);\n+\n+        // Use super class to do all the real work\n+        Class clazz = super.resolveProxyClass(interfaces);\n+\n+        // Swap back to original class loader\n+        Thread.currentThread().setContextClassLoader(originalClassLoader);\n+\n+        return clazz;\n+    }\n\n } \n", "id": 59358, "time": "2004-06-16T19:50:45Z", "bug_id": 22041, "creation_time": "2004-06-16T19:50:45Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 22041, "attachment_id": null, "text": "My sugested patch above doesn't work. However, I have committed an alternative\npatch that does.\n\nThe patch was also ported to TC5.5.x", "id": 72157, "time": "2005-03-11T00:56:28Z", "creator": "markt@apache.org", "creation_time": "2005-03-11T00:56:28Z", "is_private": false}]
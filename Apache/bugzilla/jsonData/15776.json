[{"count": 0, "tags": [], "creator": "lacostej@frisurf.no", "text": "I was trying to use a non-default channel port (8019) in my\ntomcat 4.1.18 - apache 2.0.43 with jk2 configuration, following a working\nworklog of someone that had been happily using tomcat 4.1.12.\n\nI couldn't manage to set it up (see errors below). Using default port works\nperfecly. I believe there is a problem with non default port number.\nI would like somebody to test using a non default port with tomcat 4.1.18 and\napache 2.0.43 \n\nProblem described in my emails titled:\n\"tomcat/apache connector startup failure: NCDFE fpr\norg/apache/commons/logging/LogFactory\"\n\nsent both to the tomcat-user and tomcat-dev list between the 30th of December\nand 3rd of Januray 2003.\n\n> Tomcat fails connecting initializing with the following error:\n> \n> SEVERE: Can't create apr\n> java.lang.NoClassDefFoundError: org/apache/commons/logging/LogFactory\n> \n> As a consequence of this problem (I think it is related), I cannot\n> access the dynamic pages from apache. Tomcat works great\n> (http://localhost:8080/examples/) while http://localhost/examples/\n> returns a 500 Error (Connection refused on port 8019 - errno 111).\n> \n> (nb: I modified the default port to be 8019 instead of 8009).\n> \n> I've tried several variations of the jk2.properties and\n> workers2.properties without success. Spent a lot of time on the mailing\n> lists archives without success neither.\n> \n> I moved the commons-logging.jar from $TOMCAT/server/lib/ to\n> $TOMCAT/common/lib as advised in some mails. This didn't work.\n> Even if if had worked, it seems it would have been  inapropriate:\n> see http://issues.apache.org/bugzilla/show_bug.cgi?id=13689\n> \n> I also used the attached jsp deployed in $TOMCAT/webapps/ROOT to see the\n> CLASSPATH which is outputed as \n>   /usr/local/java/lib/tools.jar:/opt/tomcat/bin/bootstrap.jar\n> which seems normal to me.\n> \n> I didn't try to modify the CLASSPATH in catalina.sh as it doesn't seem\n> like the correct thing to do neither. \n> \n> It seems like this is a ClassLoader problem. If there is a way to enable\n> debugging for the class loader, I am also interested. I found this: \n> http://jakarta.apache.org/tomcat/tomcat-4.1-doc/config/loader.html\n> But didn't find yet how to use it.\n> \n> It seems that I am not the only one to have had this problem. I spent\n> already too much time on it so I will accept any idea/hints on how to\n> make this work. \n> \n> I am using \n> - linux OS (Mandrake 9.0)\n> - JDK 1.4.1_01-b01\n> - tomcat-4.1.18-LE-jdk14.jar\n> - jakarta-tomcat-connectors-4.1.18-src.tar.gz\n> - Apache 2.0.43 \n> \n> Error details:\n> \n> INFO: Starting Coyote HTTP/1.1 on port 8080\n> Dec 30, 2002 8:58:03 PM org.apache.jk.server.JkMain newHandler\n> SEVERE: Can't create apr\n> java.lang.NoClassDefFoundError: org/apache/commons/logging/LogFactory\n>       at org.apache.jk.apr.AprImpl.<clinit>(AprImpl.java:340)\n>       at java.lang.Class.forName0(Native Method)\n>       at java.lang.Class.forName(Class.java:140)\n>       at org.apache.jk.server.JkMain.newHandler(JkMain.java:556)\n>       at org.apache.jk.server.JkMain.start(JkMain.java:341)\n>       at org.apache.jk.server.JkCoyoteHandler.start(JkCoyoteHandler.java:169)\n>       at\n> org.apache.coyote.tomcat4.CoyoteConnector.start(CoyoteConnector.java:1056)\n>       at\n> org.apache.catalina.core.StandardService.start(StandardService.java:506)\n>       at\n> org.apache.catalina.core.StandardServer.start(StandardServer.java:2189)\n>       at org.apache.catalina.startup.Catalina.start(Catalina.java:512)\n>       at org.apache.catalina.startup.Catalina.execute(Catalina.java:400)\n>       at org.apache.catalina.startup.Catalina.process(Catalina.java:180)\n>       at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n>       at\n> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n>       at\n>\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n>       at java.lang.reflect.Method.invoke(Method.java:324)\n>       at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)\n> Dec 30, 2002 8:58:03 PM org.apache.jk.common.ChannelSocket init\n> INFO: JK2: ajp13 listening on /0.0.0.0:8009\n> Dec 30, 2002 8:58:03 PM org.apache.jk.server.JkMain start\n> INFO: Jk running ID=0 time=2/239  config=/opt/tomcat/conf/jk2.properties", "id": 28847, "time": "2003-01-03T10:59:24Z", "bug_id": 15776, "creation_time": "2003-01-03T10:59:24Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "dpeterson@unicast.com", "attachment_id": null, "text": "I commented out these lines in jk2.properties and the class loader problem \nwent away.  However, I still get the listener 0.0.0.0 problem.\n# Set the desired handler list\n# handler.list=apr,request,channelJni\n#handler.list=apr,channelSocket,request --- NOTE NO APR NOW.\nhandler.list=channelSocket,request\n\n#\n# Override the default port for the socketChannel\n# channelSocket.port=8019\nchannelSocket.port=8009\n\n# Default:\n# channelUnix.file=${jkHome}/work/jk2.socket\n# Just to check if the the config  is working\n# shm.file=${jkHome}/work/jk2.shm    # NOTE NOT SHM NOW\n\n# In order to enable jni use any channelJni directive\n#channelJni.disabled = 0\n# And one of the following directives:\n\n#apr.jniModeSo=/apache/apache2/modules/mod_jk2.dll   # NOTE NO APR.", "id": 29206, "time": "2003-01-12T15:01:12Z", "bug_id": 15776, "creation_time": "2003-01-12T15:01:12Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 15776, "attachment_id": null, "id": 33323, "time": "2003-03-18T08:35:44Z", "creator": "noel@devtech.com", "creation_time": "2003-03-18T08:35:44Z", "is_private": false, "text": "Deleting $CATALINA_HOME/bin/tomcat-jni.jar resolved this for me.  The classes \nin tomcat-jni conflict with the classes in $CATALINA_HOME/server/lib/tomcat-\njk2.jar."}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "*** Bug 16988 has been marked as a duplicate of this bug. ***", "id": 53977, "time": "2004-03-14T22:15:19Z", "bug_id": 15776, "creation_time": "2004-03-14T22:15:19Z", "is_private": false, "attachment_id": null}]
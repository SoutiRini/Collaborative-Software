[{"count": 0, "tags": [], "bug_id": 14657, "text": "The AWT Renderer and its subclass Print renderer (lives in the PrintStarter)\nsizes text \nincorrectly at certain zoom scalings.  It is especially with\nbold text.  The problem shows up \ndifferently with jre 1.3.x and 1.4.x\n\nThe solution requires two actions:\n    1) to enable the \nRendering Hint - FractionalMetrics\n    2) to use getStringBounds to obtain the size of a \ncharacter\n       rather than charWidth.\n\n3 files in package ...fop.render.awt are affected, \nAWTRenderer, \nAWTFontMetrics, and FontSetup.\n\nDiff file follows below\n\n    'best\n    -\nRalph LaChance\n\nIndex: xml-\nfop/src/org/apache/fop/render/awt/AWTFontMetrics.java\n===================================================================\nRCS \nfile: /home/cvspublic/xml-\nfop/src/org/apache/fop/render/awt/AWTFontMetrics.java,v\nretrieving revision \n1.3.2.3\ndiff -u -r1.3.2.3 AWTFontMetrics.java\n--- xml-\nfop/src/org/apache/fop/render/awt/AWTFontMetrics.java\t8 Nov 2002 10:25:27 -\n0000\t1.3.2.3\n+++ xml-fop/src/org/apache/fop/render/awt/AWTFontMetrics.java\t18 Nov \n2002 22:41:37 -0000\n@@ -177,14 +177,26 @@\n     public int width(int i, String family, int style, \nint size) {\n         int w;\n         setFont(family, style, size);\n+        \n+        // Nov 18, 2002,  aml/rlc  \n+        // \nmeasure character width using getStringBounds for better results\n+        \n+        char [] ac = new char \n[1] ;\n+        ac [0] = (char) i ;\n+        \n+        double dWidth = fmt.getStringBounds (ac, 0, 1, \ngraphics).getWidth() * FONT_FACTOR ;\n+        \n+        // The following was left in based on this comment \nfrom the past (may be vestigial)\n+        \n         // the output seems to look a little better if the\n         // space \nis rendered larger than given by\n         // the FontMetrics object\n-        if (i <= 32)\n-            w = (int)(1.4 * \nfmt.charWidth(i) * FONT_FACTOR);\n-        else\n-            w = (int)(fmt.charWidth(i) * FONT_FACTOR);\n-        \nreturn w;\n+        \n+        if (i <=32)\n+          dWidth = dWidth * 1.4 ;\n+        \n+        return (int) dWidth ;\n+\n     }\n \n     \n/**\nIndex: xml-\nfop/src/org/apache/fop/render/awt/AWTRenderer.java\n===================================================================\nRCS \nfile: /home/cvspublic/xml-\nfop/src/org/apache/fop/render/awt/AWTRenderer.java,v\nretrieving revision \n1.38.2.9\ndiff -u -r1.38.2.9 AWTRenderer.java\n--- xml-\nfop/src/org/apache/fop/render/awt/AWTRenderer.java\t8 Nov 2002 10:25:27 -\n0000\t1.38.2.9\n+++ xml-fop/src/org/apache/fop/render/awt/AWTRenderer.java\t18 Nov 2002 \n22:41:38 -0000\n@@ -15,6 +15,7 @@\n import org.apache.fop.render.AbstractRenderer;\n \nimport org.apache.fop.render.pdf.*;\n import org.apache.fop.svg.*;\n+import \norg.apache.fop.render.pdf.*;\n import org.apache.fop.viewer.*;\n \n import \norg.w3c.dom.svg.*;\n@@ -373,6 +374,11 @@\n \n         graphics = pageImage.createGraphics();\n \n+        \n// Nov 18, 2002 - [aml/rlc] eliminates layout problems at various scaling\n+        \n+        \ngraphics.setRenderingHint (RenderingHints.KEY_FRACTIONALMETRICS,\n+                                   \nRenderingHints.VALUE_FRACTIONALMETRICS_ON);\n+\n         transform(graphics, scaleFactor, \n0);\n         drawFrame();\n \n@@ -859,7 +865,13 @@\n         int oldPageNumber = pageNumber;\n \n         graphics = \n(Graphics2D)g;\n-        Page aPage = (Page)pageList.get(pageIndex);\n+        \n+        // Nov 18, 2002 - \n[aml/rlc] eliminates layout problems at various scaling\n+        \n+        graphics.setRenderingHint \n(RenderingHints.KEY_FRACTIONALMETRICS,\n+                                   \nRenderingHints.VALUE_FRACTIONALMETRICS_ON);\n+\n+        Page aPage = \n(Page)pageList.elementAt(pageIndex);\n         renderPage(aPage);\n         graphics = oldGraphics;\n \n\nIndex: xml-\nfop/src/org/apache/fop/render/awt/FontSetup.java\n===================================================================\nRCS \nfile: /home/cvspublic/xml-\nfop/src/org/apache/fop/render/awt/FontSetup.java,v\nretrieving revision \n1.3.2.4\ndiff -u -r1.3.2.4 FontSetup.java\n--- xml-\nfop/src/org/apache/fop/render/awt/FontSetup.java\t8 Nov 2002 10:25:27 -\n0000\t1.3.2.4\n+++ xml-fop/src/org/apache/fop/render/awt/FontSetup.java\t18 Nov 2002 \n22:41:38 -0000\n@@ -19,8 +19,8 @@\n // Java\n import java.awt.Font;\n import \njava.awt.Graphics2D;\n-import java.util.List;\n-import java.net.URL;\n+import \njava.awt.RenderingHints ;\n+import java.util.Vector;\n \n /**\n  * sets up the AWT fonts. It \nis similar to\n@@ -46,8 +46,8 @@\n      * triplets for lookup\n      *\n      * @param fontInfo the font info \nobject to set up\n-     * @param graphics Graphics2D to work on\n-     * @throws FOPException in case of an \nerror during font setup\n+     * @param parent needed, since a live AWT component is needed\n+     * to \nget a valid java.awt.FontMetrics object\n      */\n     public static void setup(FontInfo fontInfo, \nGraphics2D graphics)\n         throws FOPException {\n@@ -55,6 +55,12 @@\n         FontMetricsMapper \nmetric;\n \n         MessageHandler.logln(\"setting up fonts\");\n+\n+        // Nov 18, 2002 - [aml/rlc] \neliminates layout problems at various scaling\n+        \n+        graphics.setRenderingHint \n(RenderingHints.KEY_FRACTIONALMETRICS,\n+                                   \nRenderingHints.VALUE_FRACTIONALMETRICS_ON);\n+\n \n         /*\n          * available java fonts \nare:", "id": 26518, "time": "2002-11-18T23:01:35Z", "creator": "Ralph_LaChance@compuserve.com", "creation_time": "2002-11-18T23:01:35Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "Ralph, could you please add the patch as attachment.", "is_private": false, "id": 26582, "creation_time": "2002-11-19T16:22:01Z", "time": "2002-11-19T16:22:01Z", "creator": "christian.geisert@isu-gmbh.de", "bug_id": 14657, "attachment_id": null}, {"count": 2, "tags": [], "creator": "Ralph_LaChance@compuserve.com", "is_private": false, "id": 26591, "creation_time": "2002-11-19T17:15:44Z", "time": "2002-11-19T17:15:44Z", "bug_id": 14657, "text": "Created attachment 3893\npatch as requested", "attachment_id": 3893}, {"count": 3, "tags": [], "text": "Committed to maintenance branch.\nIt did not compile after applying the patch (missing import statements)\nPlease check if it's ok and then close the bug.\n\nThanks for your contribution.", "attachment_id": null, "id": 26954, "creator": "christian.geisert@isu-gmbh.de", "time": "2002-11-25T17:14:42Z", "bug_id": 14657, "creation_time": "2002-11-25T17:14:42Z", "is_private": false}, {"count": 4, "tags": [], "text": "Verified the changes are committed correctly.", "is_private": false, "id": 27263, "creation_time": "2002-12-02T17:22:03Z", "time": "2002-12-02T17:22:03Z", "creator": "Ralph_LaChance@compuserve.com", "bug_id": 14657, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 14657, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed", "count": 5, "id": 155680, "time": "2012-04-01T06:35:27Z", "creator": "gadams@apache.org", "creation_time": "2012-04-01T06:35:27Z", "is_private": false}]
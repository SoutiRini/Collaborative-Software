[{"count": 0, "tags": [], "creator": "bernard.l.dubreuil@erdc.usace.army.mil", "attachment_id": null, "id": 12007, "time": "2002-03-19T18:03:04Z", "bug_id": 7252, "creation_time": "2002-03-19T18:03:04Z", "is_private": false, "text": "Maybe this is obvious to the experienced Apache programmer but in this example \nwhy is fopen() used to open the file and ap_pfclose() used to close it?\n\nint default_handler (request_rec *r)\n{\n    int errstatus;\n    FILE *f;\n\n    if (r->method_number != M_GET) return DECLINED;\n    if (r->finfo.st_mode == 0) return NOT_FOUND;\n\n    if ((errstatus = ap_set_content_length (r, r->finfo.st_size))\n    || (errstatus = ap_set_last_modified (r, r->finfo.st_mtime)))\n        return errstatus;\n\n    f = fopen (r->filename, \"r\");\n\n    if (f == NULL) {\n        log_reason(\"file permissions deny server access\",\n                   r->filename, r);\n        return FORBIDDEN;\n    }\n\n    register_timeout (\"send\", r);\n    ap_send_http_header (r);\n\n    if (!r->header_only) send_fd (f, r);\n    ap_pfclose (r->pool, f);\n    return OK;\n}"}, {"attachment_id": null, "tags": [], "creator": "jerenkrantz@apache.org", "is_private": false, "count": 1, "id": 12009, "time": "2002-03-19T18:56:32Z", "bug_id": 7252, "creation_time": "2002-03-19T18:56:32Z", "text": "Yeah, it should be.  That fragment is sorely out-of-date.\n\nRevision 1.20 of httpd-docs-1.3/htdocs/manual/misc/API.html has a\nquick pass at trying to make it reflect 1.3's reality.  The website\nnow has the latest version.\n\nThanks."}]
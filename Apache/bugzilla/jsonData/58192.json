[{"text": "We have received several reports recently that GeoServer fails to deploy in Tomcat 8, and with some discussion, we poinpointed 8.0.24 as the version where this start happening, we have reports of deploys working without problems on 8.0.21 and 8.0.23 instead.\n\nThe issue happens as we try to initialize the ImageIO subsystem, here is the stack trace:\n\njava.util.ServiceConfigurationError: javax.imageio.spi.ImageReaderSpi: Provider com.sun.media.imageioimpl.plugins.jpeg.CLibJPEGImageReaderSpi could not be instantiated\n\tat java.util.ServiceLoader.fail(ServiceLoader.java:232)\n\tat java.util.ServiceLoader.access$100(ServiceLoader.java:185)\n\tat java.util.ServiceLoader$LazyIterator.nextService(ServiceLoader.java:384)\n\tat java.util.ServiceLoader$LazyIterator.next(ServiceLoader.java:404)\n\tat java.util.ServiceLoader$1.next(ServiceLoader.java:480)\n\tat javax.imageio.spi.IIORegistry.registerApplicationClasspathSpis(IIORegistry.java:210)\n\tat javax.imageio.spi.IIORegistry.<init>(IIORegistry.java:138)\n\tat javax.imageio.spi.IIORegistry.getDefaultInstance(IIORegistry.java:159)\n\tat org.geoserver.GeoserverInitStartupListener.contextDestroyed(GeoserverInitStartupListener.java:295)\n\tat org.apache.catalina.core.StandardContext.listenerStop(StandardContext.java:4776)\n\tat org.apache.catalina.core.StandardContext.stopInternal(StandardContext.java:5390)\n\tat org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:232)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:160)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:725)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:701)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:717)\n\tat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:945)\n\tat org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1768)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.IllegalArgumentException: vendorName == null!\n\tat javax.imageio.spi.IIOServiceProvider.<init>(IIOServiceProvider.java:76)\n\tat javax.imageio.spi.ImageReaderWriterSpi.<init>(ImageReaderWriterSpi.java:231)\n\tat javax.imageio.spi.ImageReaderSpi.<init>(ImageReaderSpi.java:212)\n\tat com.sun.media.imageioimpl.plugins.jpeg.CLibJPEGImageReaderSpi.<init>(CLibJPEGImageReaderSpi.java:80)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:422)\n\tat java.lang.Class.newInstance(Class.java:442)\n\tat java.util\n\nHere is the associated GeoServer ticket: https://osgeo-org.atlassian.net/browse/GEOS-7122", "tags": [], "bug_id": 58192, "attachment_id": null, "count": 0, "id": 184229, "time": "2015-07-30T08:39:39Z", "creator": "andrea.aime@gmail.com", "creation_time": "2015-07-30T08:39:39Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 58192, "attachment_id": null, "is_private": false, "id": 184240, "time": "2015-07-30T20:09:00Z", "creator": "chris@christopherschultz.net", "creation_time": "2015-07-30T20:09:00Z", "text": "Is this possibly environmental?\n\nhttp://stackoverflow.com/questions/7051603/jai-vendorname-null/18495658#18495658"}, {"count": 2, "attachment_id": null, "creator": "andrea.aime@gmail.com", "text": "I've read that stackoverflow article, it seems to be related to a fatjar usage, which we don't use. The stack trace we're getting it about a class that's in the stock imageio jar file, which we did not modify.\n\nThe GeoServer version used is also an official release, if you want to try, you can pick this one for example:\nhttp://sourceforge.net/projects/geoserver/files/GeoServer/2.7.1.1/geoserver-2.7.1.1-war.zip/download\n\nI've just tried it, it works in Tomcat 8.0.23... while this cannot exclude an enviroment dependnecy, it at least provies that there is a Tomcat version dependency (the same war breaks deploying in 8.0.24).\n\nI've tried both cases with Java 1.7.0_72 and 1.8.0_25, same results, does not appear to be JDK dependent.\n\nOh, also the Tomcat versions tried were stock, just downloaded from the official web site as tar.gz distros.\nNative JAI and native JAI Image I/O are not installed in either case.", "id": 184241, "time": "2015-07-30T21:50:27Z", "bug_id": 58192, "creation_time": "2015-07-30T21:50:27Z", "tags": [], "is_private": false}, {"text": "I wonder if Tomcat's resource-locating implementation is failing, here. I seem to recall something changing recently with how getPackage() works, or something like that.\n\nCan you produce a simple, self-contained test case? A binary WAR including source would be best. I suspect you only need to bundle the imageio JAR file and try to use it in, say, a simple JSP.", "tags": [], "bug_id": 58192, "is_private": false, "count": 3, "id": 184242, "time": "2015-07-30T22:38:43Z", "creator": "chris@christopherschultz.net", "creation_time": "2015-07-30T22:38:43Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 58192, "attachment_id": null, "is_private": false, "id": 184311, "time": "2015-08-04T20:31:50Z", "creator": "markt@apache.org", "creation_time": "2015-08-04T20:31:50Z", "text": "*** Bug 58208 has been marked as a duplicate of this bug. ***"}, {"count": 5, "tags": [], "bug_id": 58192, "is_private": false, "text": "This is a regression in the fix for bug 58023. I'm looking at a fix now.", "id": 184312, "time": "2015-08-04T20:33:05Z", "creator": "markt@apache.org", "creation_time": "2015-08-04T20:33:05Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "Btw, we did try to generate a simple self contained example, but failed so far.", "is_private": false, "bug_id": 58192, "id": 184313, "time": "2015-08-04T20:36:09Z", "creator": "andrea.aime@gmail.com", "creation_time": "2015-08-04T20:36:09Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Fixed in trunk and 8.0.x (for 8.0.25 onwards). The back-port to 7.0.x is a little more complicated.", "is_private": false, "bug_id": 58192, "id": 184315, "time": "2015-08-04T21:57:47Z", "creator": "markt@apache.org", "creation_time": "2015-08-04T21:57:47Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 58192, "is_private": false, "text": "Further investigation has shown this issue is far less likely to affect 7.0.x because of the separate caching in the resource implementation and in the class loader.\n\nThe issue is still possible and a fix has been back-ported for 7.0.64 onwards.", "id": 184316, "time": "2015-08-04T22:16:52Z", "creator": "markt@apache.org", "creation_time": "2015-08-04T22:16:52Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 58192, "attachment_id": null, "id": 184318, "time": "2015-08-05T05:47:26Z", "creator": "andrea.aime@gmail.com", "creation_time": "2015-08-05T05:47:26Z", "is_private": false, "text": "That's great, are there nightly builds that we can test?"}, {"count": 10, "tags": [], "bug_id": 58192, "attachment_id": null, "text": "No nightly builds but Tomcat 8 is very easy to build from source. Alternatively, I can make a development build available for you to download. Let me know if you need that.", "id": 184327, "time": "2015-08-05T08:59:39Z", "creator": "markt@apache.org", "creation_time": "2015-08-05T08:59:39Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 58192, "attachment_id": null, "text": "I checked out http://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk and run the Ant task 'release':\n\nBUILD FAILED\nC:\\Users\\XXX\\workspace\\Tomcat 8\\build.xml:1587: Error while expanding C:\\Users\\XXX\\workspace\\Tomcat 8\\output\\extras\\logging\\commons-logging-src.tar\njava.io.IOException: Error detected parsing the header", "id": 184432, "time": "2015-08-10T08:14:50Z", "creator": "martin.wegner@ebp.de", "creation_time": "2015-08-10T08:14:50Z", "is_private": false}, {"count": 12, "tags": [], "text": "(In reply to Martin Wegner from comment #11)\n\nHi,\n\n> I checked out http://svn.apache.org/repos/asf/tomcat/tc8.0.x/trunk and run\n> the Ant task 'release':\n> \n> BUILD FAILED\n> C:\\Users\\XXX\\workspace\\Tomcat 8\\build.xml:1587: Error while expanding\n> C:\\Users\\XXX\\workspace\\Tomcat 8\\output\\extras\\logging\\commons-logging-src.tar\n> java.io.IOException: Error detected parsing the header\n\nThis is a known issue with ANT 1.9.4 [1].\n\nRegards,\nVioleta\n\n[1] https://bz.apache.org/bugzilla/show_bug.cgi?id=56641", "attachment_id": null, "bug_id": 58192, "id": 184433, "time": "2015-08-10T08:33:08Z", "creator": "violetagg@apache.org", "creation_time": "2015-08-10T08:33:08Z", "is_private": false}, {"count": 13, "attachment_id": null, "creator": "martin.wegner@ebp.de", "is_private": false, "id": 184434, "time": "2015-08-10T08:38:10Z", "bug_id": 58192, "creation_time": "2015-08-10T08:38:10Z", "tags": [], "text": "And what can I do about it?"}, {"count": 14, "attachment_id": null, "creator": "violetagg@apache.org", "is_private": false, "id": 184435, "time": "2015-08-10T08:39:40Z", "bug_id": 58192, "creation_time": "2015-08-10T08:39:40Z", "tags": [], "text": "(In reply to Martin Wegner from comment #13)\n> And what can I do about it?\n\nWhat do you think about using ANT 1.9.6?"}, {"count": 15, "tags": [], "creator": "martin.wegner@ebp.de", "attachment_id": null, "is_private": false, "id": 184436, "time": "2015-08-10T08:42:34Z", "bug_id": 58192, "creation_time": "2015-08-10T08:42:34Z", "text": "I use Eclipse Mars (the newest of the newest) but it comes with Ant 1.9.4...what a pity :("}, {"count": 16, "tags": [], "creator": "martin.wegner@ebp.de", "attachment_id": null, "id": 184437, "time": "2015-08-10T08:52:14Z", "bug_id": 58192, "creation_time": "2015-08-10T08:52:14Z", "is_private": false, "text": "OK with Ant 1.9.6 I get this error:\n\n-installer-create-uninstaller:\n\nBUILD FAILED\nC:\\Users\\XXX\\workspace\\Tomcat 8\\build.xml:2175: Execute failed: java.io.IOException: Cannot run program \"C:\\Users\\XXX\\workspace\\Tomcat 8\\output\\dist\\tempinstaller.exe\" (in directory \"C:\\Users\\XXX\\workspace\\Tomcat 8\\output\\dist\"): CreateProcess error=2, The system cannot find the file specified\n        at java.lang.ProcessBuilder.start(ProcessBuilder.java:1048)\n        at java.lang.Runtime.exec(Runtime.java:620)\n        at org.apache.tools.ant.taskdefs.launcher.Java13CommandLauncher.exec(Java13CommandLauncher.java:58)\n        at org.apache.tools.ant.taskdefs.Execute.launch(Execute.java:428)\n        at org.apache.tools.ant.taskdefs.Execute.execute(Execute.java:442)\n        at org.apache.tools.ant.taskdefs.ExecTask.runExecute(ExecTask.java:629)\n        at org.apache.tools.ant.taskdefs.ExecTask.runExec(ExecTask.java:670)\n        at org.apache.tools.ant.taskdefs.ExecTask.execute(ExecTask.java:496)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:293)\n        at sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:497)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:435)\n        at org.apache.tools.ant.Target.performTasks(Target.java:456)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1405)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1376)\n        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1260)\n        at org.apache.tools.ant.Main.runBuild(Main.java:853)\n        at org.apache.tools.ant.Main.startAnt(Main.java:235)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:285)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:112)\nCaused by: java.io.IOException: CreateProcess error=2, The system cannot find the file specified\n        at java.lang.ProcessImpl.create(Native Method)\n        at java.lang.ProcessImpl.<init>(ProcessImpl.java:386)\n        at java.lang.ProcessImpl.start(ProcessImpl.java:137)\n        at java.lang.ProcessBuilder.start(ProcessBuilder.java:1029)\n        ... 23 more"}, {"count": 17, "tags": [], "text": "Hi,\n\nPlease use tomcat users mailing list as this does not belong to this issue.\n\nThanks a lot,\nVioleta", "is_private": false, "bug_id": 58192, "id": 184438, "time": "2015-08-10T08:56:09Z", "creator": "violetagg@apache.org", "creation_time": "2015-08-10T08:56:09Z", "attachment_id": null}, {"count": 18, "attachment_id": null, "creator": "martin.wegner@ebp.de", "is_private": false, "id": 184439, "time": "2015-08-10T09:04:52Z", "bug_id": 58192, "creation_time": "2015-08-10T09:04:52Z", "tags": [], "text": "\"No nightly builds but Tomcat 8 is very easy to build from source.\"\n\nSo it is not easy.\n\n\n\"Alternatively, I can make a development build available for you to download. Let me know if you need that.\"\n\nYes we need that.\n\nThanks!"}, {"count": 19, "tags": [], "text": "Just use 'ant' rather than 'ant release'. You don't need a full release build. You'll find CATALINA_HOME at output/build", "is_private": false, "bug_id": 58192, "id": 184456, "time": "2015-08-10T15:47:21Z", "creator": "markt@apache.org", "creation_time": "2015-08-10T15:47:21Z", "attachment_id": null}, {"count": 20, "tags": [], "bug_id": 58192, "attachment_id": null, "is_private": false, "id": 184465, "time": "2015-08-11T08:31:35Z", "creator": "martin.wegner@ebp.de", "creation_time": "2015-08-11T08:31:35Z", "text": "OK running Ant with default task worked and replacing the 8.0.24 catalina.jar with the new build catalina.jar fixed the problem...the GeoServer is up and running :)"}]
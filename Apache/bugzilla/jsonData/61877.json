[{"count": 0, "tags": [], "creator": "yahoonomas@gmail.com", "attachment_id": null, "text": "When using separate CATALINA_HOME and CATALINA_BASE directories, some config files default to the copy from HOME/conf if there is none in BASE/conf. Apparently web.xml is not one of these. Documentation doesn't say that it needs copying, but without copying it to BASE the following appears in the catalina log file :\n\nINFO ... org.apache.catalina.startup.ContextConfig.getDefaultWebXmlFragment No global web.xml found\n\n\nStartup continues without further errors, but accessing any webapp (including manager) yields a 404. \n\nPlease allow catalina to default to HOME/conf/web.xml if BASE/conf/web.xml is not present.", "id": 202644, "time": "2017-12-08T19:13:16Z", "bug_id": 61877, "creation_time": "2017-12-08T19:13:16Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 61877, "attachment_id": null, "text": "I'm leaning towards WONTFIX for this.\n\nAs far as I recall, no configuration files are read from CATALINA_HOME. They are always read, and only read, from CATALINA_BASE. I don't think making the default web.xml an exception is a good idea.", "id": 202648, "time": "2017-12-08T20:59:46Z", "creator": "markt@apache.org", "creation_time": "2017-12-08T20:59:46Z", "is_private": false}, {"count": 2, "tags": [], "text": "Fair enough, then I request the documentation be made a little clearer. The section \"Advanced Configuration - Multiple Tomcat Instances\" in RUNNING.txt, states \n\n* conf - Server configuration files (including server.xml)\n\n\nwhich is a little open to interpretation, especially after the bin section specifies a subset of files. I can see how it can be interpreted either way though. Perhaps remove \"(including server files)\" and add a sentence or two below stating everything is required to be copied and pointing out which files definitely need editing (server.xml at a minimum), and which probably don't.\n\nFurther, if these files are required in CATALINA_BASE (when different to CATALINA_HOME), then an INFO message saying it isn't present is misleading also. Shouldn't it be a WARN at a minimum, indicating that certain functionality will not be available?", "attachment_id": null, "id": 202653, "creation_time": "2017-12-08T21:47:24Z", "time": "2017-12-08T21:47:24Z", "creator": "yahoonomas@gmail.com", "bug_id": 61877, "is_private": false}, {"count": 3, "tags": [], "text": "The documentation is open-sourced.  You can make the changes exactly as you see fit and propose them as a patch.\n\nSee https://github.com/apache/tomcat/tree/trunk/webapps/docs", "attachment_id": null, "id": 202657, "creation_time": "2017-12-08T22:08:12Z", "time": "2017-12-08T22:08:12Z", "creator": "dev@21solutions.net", "bug_id": 61877, "is_private": false}, {"count": 4, "tags": [], "text": "I'm +1 on this request. We often tell people \"don't modify conf/web.xml\" or \"don't modify conf/context.xml\", but we are encouraging people to make \"local\" copies of those files like CATALINA_BASE/conf/web.xml.\n\n(In reply to Mark Thomas from comment #1)\n> As far as I recall, no configuration files are read from CATALINA_HOME. They\n> are always read, and only read, from CATALINA_BASE. I don't think making the\n> default web.xml an exception is a good idea.\n\nCounterexamples: if CATALINA_BASE/conf/context.xml is not present, CATALINA_HOME/conf/context.xml will be read instead. Also, CATALINA_HOME/bin/setenv.sh is executed if CATALINA_BASE/bin/setenv.sh does not exist (this may be considered something other than a \"configuration file\", but I think it helps illustrate the point).\n\nThere are at least *some* files that Tomcat will fall-back to in CATALINA_HOME if they are not present in CATALINA_BASE. It's \"surprising\"[1] to find out that a \"stock\" configuration file -- one users are actively discouraged from editing -- does not enjoy this kind of fall-back semantics.\n\n[1] https://en.wikipedia.org/wiki/Principle_of_least_astonishment", "is_private": false, "bug_id": 61877, "id": 202673, "time": "2017-12-09T19:53:33Z", "creator": "chris@christopherschultz.net", "creation_time": "2017-12-09T19:53:33Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "text": "Removing an unmodified CATALINA_BASE/conf/web.xml also allows upgrades/downgrades to be more seamless because CATALINA_BASE's web.xml does not have to match the version of Tomcat being used.", "id": 202674, "time": "2017-12-09T19:54:47Z", "bug_id": 61877, "creation_time": "2017-12-09T19:54:47Z", "is_private": false}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "(In reply to Christopher Schultz from comment #4)\n\n<snip/>\n\n> (In reply to Mark Thomas from comment #1)\n> > As far as I recall, no configuration files are read from CATALINA_HOME. They\n> > are always read, and only read, from CATALINA_BASE. I don't think making the\n> > default web.xml an exception is a good idea.\n> \n> Counterexamples: if CATALINA_BASE/conf/context.xml is not present,\n> CATALINA_HOME/conf/context.xml will be read instead.\n\nCode reference please. The only code I can find always reads from CATALINA_BASE.\n\n> Also,\n> CATALINA_HOME/bin/setenv.sh is executed if CATALINA_BASE/bin/setenv.sh does\n> not exist (this may be considered something other than a \"configuration\n> file\", but I think it helps illustrate the point).\n\nThat is historical. Originally, it was read only from CATALINA_HOME. The point was made (bug 43594) that it made more sense to be read from CATALINA_BASE. The fall-back to CATALINA_HOME is there for backwards compatibility.\n \n> There are at least *some* files that Tomcat will fall-back to in\n> CATALINA_HOME if they are not present in CATALINA_BASE. It's \"surprising\"[1]\n> to find out that a \"stock\" configuration file -- one users are actively\n> discouraged from editing -- does not enjoy this kind of fall-back semantics.\n> \n> [1] https://en.wikipedia.org/wiki/Principle_of_least_astonishment\n\nAs far as I can tell there is a single file and it behaves this way for backwards compatibility reasons. In all other cases configuration is read only from CATALINA_BASE. I would argue that it is more surprising to change that.\n\nAdditionally, web.xml has merging rules applied to it. Is the proposal that CATALINA_BASE/conf/web.xml is merged on top of CATALINA_HOME/conf/web.xml or only CATALINA_BASE/conf/web.xml is used?\n\nWith the former option, a complex process will get more complex and user applications might break - in theory a security issue be introduced. That means the behaviour needs to be made optional which creates more complexity.\n\nWith the latter option, the same issues exists except the merging complexity.\n\nOverall, this seems like an awful lot of effort to address a documentation issue that looks like it could be fixed with a couple of sentences.", "id": 202693, "time": "2017-12-11T10:12:26Z", "bug_id": 61877, "creation_time": "2017-12-11T10:12:26Z", "is_private": false}, {"count": 7, "tags": [], "text": "(In reply to Mark Thomas from comment #6)\n> (In reply to Christopher Schultz from comment #4)\n> > (In reply to Mark Thomas from comment #1)\n> > > As far as I recall, no configuration files are read from CATALINA_HOME. They\n> > > are always read, and only read, from CATALINA_BASE. I don't think making the\n> > > default web.xml an exception is a good idea.\n> > \n> > Counterexamples: if CATALINA_BASE/conf/context.xml is not present,\n> > CATALINA_HOME/conf/context.xml will be read instead.\n> \n> Code reference please. The only code I can find always reads from\n> CATALINA_BASE.\n\nI don't have a code reference, but I have a long history of applications that have no CATALINA_BASE/conf/context.xml and they seem to be working fine. Maybe a missing CATALINA_BASE/conf/context.xml doesn't represent a problem because the default has very little configured inside it. If I \"touch webapps/[app]/WEB-INF/web.xml\" Tomcat will reload the web application. Perhaps that's a default buried deeply within the code somewhere, or perhaps it's configured somewhere I'm not looking.\n\nI had always assumed that CATALINA_HOME/conf/context.xml was being used. Perhaps it is not.\n\n> > Also,\n> > CATALINA_HOME/bin/setenv.sh is executed if CATALINA_BASE/bin/setenv.sh does\n> > not exist (this may be considered something other than a \"configuration\n> > file\", but I think it helps illustrate the point).\n> \n> That is historical. Originally, it was read only from CATALINA_HOME. The\n> point was made (bug 43594) that it made more sense to be read from\n> CATALINA_BASE. The fall-back to CATALINA_HOME is there for backwards\n> compatibility.\n>  \n> > There are at least *some* files that Tomcat will fall-back to in\n> > CATALINA_HOME if they are not present in CATALINA_BASE. It's \"surprising\"[1]\n> > to find out that a \"stock\" configuration file -- one users are actively\n> > discouraged from editing -- does not enjoy this kind of fall-back semantics.\n> > \n> > [1] https://en.wikipedia.org/wiki/Principle_of_least_astonishment\n> \n> As far as I can tell there is a single file and it behaves this way for\n> backwards compatibility reasons. In all other cases configuration is read\n> only from CATALINA_BASE. I would argue that it is more surprising to change\n> that.\n> \n> Additionally, web.xml has merging rules applied to it. Is the proposal that\n> CATALINA_BASE/conf/web.xml is merged on top of CATALINA_HOME/conf/web.xml or\n> only CATALINA_BASE/conf/web.xml is used?\n\nMy proposal would be that they all be merged together using the same rules, with the application's web.xml overriding the items in CATALINA_BASE/conf/web.xml, those overriding the items in CATALINA_HOME/conf/web.xml as necessary.\n\nThat would allow a CATALINA_BASE/conf/web.xml to add e.g. a JNDI mapping for all local applications, but wouldn't have to specify all the details for e.g. the JSP servlet and the default servlet.\n\n> With the former option, a complex process will get more complex and user\n> applications might break - in theory a security issue be introduced. That\n> means the behaviour needs to be made optional which creates more complexity.\n\nHmm.\n\nIs this any more of a problem that merging WEB-INF/web.xml with CATALINA_BASE/conf/web.xml?\n\n> With the latter option, the same issues exists except the merging complexity.\n> \n> Overall, this seems like an awful lot of effort to address a documentation\n> issue that looks like it could be fixed with a couple of sentences.\n\nThis is definitely true. The question is whether or not there is a good reason to support this kind of thing at all. I think it would be nice to be able to make a small change to web.xml for a single Tomcat instance without having to configure everything that CATALINA_HOME/conf/web.xml configures. This provides a reduction in maintenance costs for the user, and makes CATALINA_BASE more compatible across versions of Tomcat.", "is_private": false, "bug_id": 61877, "id": 202741, "time": "2017-12-12T16:17:20Z", "creator": "chris@christopherschultz.net", "creation_time": "2017-12-12T16:17:20Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "This is an enhancement rather than a bug so changing the classification.", "id": 203090, "time": "2018-01-04T21:22:50Z", "bug_id": 61877, "creation_time": "2018-01-04T21:22:50Z", "is_private": false}]
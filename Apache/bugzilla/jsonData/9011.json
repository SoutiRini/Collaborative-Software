[{"count": 0, "tags": [], "creator": "erich.prchal@siemens.at", "attachment_id": null, "id": 15959, "time": "2002-05-12T14:32:45Z", "bug_id": 9011, "creation_time": "2002-05-12T14:32:45Z", "is_private": false, "text": "With Worker-MPM on Solaris (both 2.6 and 8) I get error messages\n\"[crit] the listener thread didn't exit\" every few minutes.\n\nThe system was under heavy load (10-18 child processes)\nwith (intentionally) non-keepalive requests.\n\nBy adding traces I found that the dummy_signal_handler in worker.c \ndoes get called 10 times for the correct thread, \nbut the function apr_proc_mutex_lock never returns.\n\nI think this behaviour does not deserve a LOG_CRIT \nwhich might unneccessarily alert the administrator\nas it can occur quite normally:\n\nAccording to the man page for pthread_mutex_lock:\n\n\"If a signal is delivered to a thread waiting  for  a  mutex,\n upon return from the signal handler the thread resumes wait-\n ing for the mutex as if it was not interrupted.\"\n\nAnd for other lock types which do not behave the same way\nproc_mutex.c simulates this behaviour by making a loop over EINTR.\n\nBy the way, should proc_mutex.c set PTHREAD_MUTEX_RECURSIVE\nif such is defined on the system?\nThe man page says the behaviour is undefined for default."}, {"count": 1, "tags": [], "creator": "jwoolley@apache.org", "is_private": false, "text": "Note: this PR is very similar though not identical to PR9169.  ", "id": 16433, "time": "2002-05-20T19:24:56Z", "bug_id": 9011, "creation_time": "2002-05-20T19:24:56Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 9011, "is_private": false, "text": "[This is a mass bug update.]\nThis bug reports a problem in an older version of Apache 2.\nCould you please update to the most recent version and see\nif you can reproduce this problem.  If the bug still exists,\nplease update the bug with the latest version number.  If \nthe bug no longer exists, please close the bug report.\n\nSorry for this impersonal response, but we get many more bug\nreports than our volunteers can keep up with.\nThanks for using Apache!", "id": 24745, "time": "2002-10-17T02:35:26Z", "creator": "slive@apache.org", "creation_time": "2002-10-17T02:35:26Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "erich.prchal@siemens.at", "attachment_id": null, "is_private": false, "id": 24760, "time": "2002-10-17T07:05:28Z", "bug_id": 9011, "creation_time": "2002-10-17T07:05:28Z", "text": "The problem did no longer occur since 2.0.39"}, {"count": 4, "tags": [], "text": "This bug still occurs to me with version 2.0.44 at this configuration:\n\nStartServers        64\nServerLimit         96\nMinSpareThreads 256\nMaxSpareThreads 512\nThreadsPerChild 24\nMaxRequestsPerChild  0\n\nI don't have to get any load into the system. Just after start apache with this \nconfiguration this message starts do fill the log file.\n", "is_private": false, "bug_id": 9011, "id": 33029, "time": "2003-03-12T13:39:34Z", "creator": "eider@bol.com.br", "creation_time": "2003-03-12T13:39:34Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 9011, "is_private": false, "text": "Also having this problem on 2xP3-1.4GHz + Linux 2.4.20 + httpd 2.0.45 + openssl 0.9.7b + PHP 4.3.1, using \nMPM worker (threadpool).   Definitely vote for dropping this from ``crit''; system still seems to \noperate fine, except for filling up my error log. \n  \nConfiguration:  \n  \nServerLimit         200  \nStartServers        1  \nMaxClients          250  \nMinSpareThreads     5  \nMaxSpareThreads     10  \nThreadsPerChild     5  \nMaxRequestsPerChild 0  \n  \n  \n  ", "id": 35837, "time": "2003-04-23T00:03:53Z", "creator": "jpr5+apache@darkridge.com", "creation_time": "2003-04-23T00:03:53Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 9011, "attachment_id": null, "id": 35838, "time": "2003-04-23T00:07:45Z", "creator": "jpr5+apache@darkridge.com", "creation_time": "2003-04-23T00:07:45Z", "is_private": false, "text": "Sorry if this is bothersome, but looking at the code, I'm not sure I understand this properly, maybe \nthis is a bug?  I'm probably misunderstanding this..  pthread_kill() and kill() both return 0 on \nsuccess; shouldn't this loop be in a success condition if it successfully kills the thread?  Isn't \nthat the point of the loop?  If I interpreted it correctly, then this loop will always trigger the \nerror unless pthread_kill() or kill() fails, no?   \n  \n         iter = 0;  \n        while (iter < 10 &&  \n#ifdef HAVE_PTHREAD_KILL  \n               pthread_kill(*listener_os_thread, 0)  \n#else  \n               kill(ap_my_pid, 0)  \n#endif  \n               == 0) {  \n            /* listener not dead yet */  \n            apr_sleep(apr_time_make(0, 500000));  \n            wakeup_listener();  \n            ++iter;  \n        }     \n\t if (iter >= 10) { \n            ap_log_error(APLOG_MARK, APLOG_CRIT, 0, ap_server_conf, \n                         \"the listener thread didn't exit\"); \n        } \n \n \n  "}, {"count": 7, "attachment_id": null, "bug_id": 9011, "is_private": false, "id": 35841, "time": "2003-04-23T01:06:10Z", "creator": "trawick@apache.org", "creation_time": "2003-04-23T01:06:10Z", "tags": [], "text": "passing 0 as the signal to kill() or pthread_kill() is just a check to see if\nthe process or thread is still alive\n\nthe purpose of that loop is to keep telling the listener thread to go away\nuntil either it goes away or we give up trying"}, {"count": 8, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "id": 43768, "time": "2003-09-05T19:40:56Z", "bug_id": 9011, "creation_time": "2003-09-05T19:40:56Z", "is_private": false, "text": "Severity of the message has been changed to debug in 2.1-dev, and change will\nbe proposed for merge into 2.0.48-dev.\n\nThe message is of interest to developers only, and while it does represent\na glitch (listener thread not terminating in the cleanest possible way), there \nis no known impact of the glitch.\n"}, {"count": 9, "tags": [], "bug_id": 9011, "attachment_id": null, "text": "Sounds great, thanks!", "id": 51344, "time": "2004-01-28T23:13:24Z", "creator": "jpr5+apache@darkridge.com", "creation_time": "2004-01-28T23:13:24Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 21188, "attachment_id": null, "id": 39652, "time": "2003-06-30T12:49:02Z", "creator": "cdemoustier@objetdirect.com", "creation_time": "2003-06-30T12:49:02Z", "is_private": false, "text": "Happens with standard 1.0.3 taglib.\n\nThe bug arises for example on \"Disconnected\" pages if you want to display the\nmessage in the user's locale. If you want to use \"fmt\" tags with an invalidated\nsession, when Config.find() tries to lookup for the formatting locale in the\nsession you'll get the servlet container throws an\njava.lang.IllegalStateException about \"getAttribute\" being used on invalidated\nsession.\n\nHere is a sample JSP showing the issue:\n\n<%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jstl/core\" %>\n<%@ taglib prefix=\"fmt\" uri=\"http://java.sun.com/jstl/fmt\" %>\n\n<!-- Invalidate the session. -->\n<% session.invalidate(); %>\n\n<html>\n<head>\n  <title>Test case for invalidated sessions</title>\n</head>\n\n<body>\n\n<!-- Lookup occurs here to find the formatting locale.\n  -- Currently lookup is also done through the session\n  -- even if it has been invalidated,\n  -- causing an exception to be thrown -->\n<jsp:useBean id=\"now\" class=\"java.util.Date\" />\n<fmt:formatDate value=\"${now}\" type=\"both\"/>\n\n</body>\n</html>\n\nHere are the last lines of stack trace on Tomcat 4.1.24:\n\njava.lang.IllegalStateException: \"getAttribute\": Session already invalidated\n\tat\norg.apache.catalina.session.StandardSession.getAttribute(StandardSession.java:954)\n\tat\norg.apache.catalina.session.StandardSessionFacade.getAttribute(StandardSessionFacade.java:171)\n\tat\norg.apache.catalina.session.StandardSessionFacade.getAttribute(StandardSessionFacade.java:171)\n\tat org.apache.jasper.runtime.PageContextImpl.getAttribute(PageContextImpl.java:222)\n\tat javax.servlet.jsp.jstl.core.Config.get(Config.java:145)\n\tat javax.servlet.jsp.jstl.core.Config.find(Config.java:393)\n\tat\norg.apache.taglibs.standard.tag.common.fmt.BundleSupport.getLocalizationContext(BundleSupport.java:161)\n\tat\norg.apache.taglibs.standard.tag.common.fmt.SetLocaleSupport.getFormattingLocale(SetLocaleSupport.java:283)\n\tat\norg.apache.taglibs.standard.tag.common.fmt.FormatDateSupport.doEndTag(FormatDateSupport.java:148)\n\nAs there is no method to see if a session is invalidated (at least with servlets\n2.3), a possible solution could be to catch IllegalStateException in this case. \n\nAlthough this case is not described in the specs (I only saw things about pages\nwithout session in section 2.2.1), it would seem better compliant with general\nerror handling behaviour in JSTL (section 2.7)."}, {"count": 1, "tags": [], "text": "Agree. Fixed.", "attachment_id": null, "id": 41987, "creator": "pierre.delisle@sun.com", "time": "2003-08-02T01:24:42Z", "bug_id": 21188, "creation_time": "2003-08-02T01:24:42Z", "is_private": false}]
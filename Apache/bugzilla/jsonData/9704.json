[{"count": 0, "tags": [], "bug_id": 9704, "attachment_id": null, "is_private": false, "id": 17423, "time": "2002-06-07T20:28:00Z", "creator": "gjfdh@yahoo.com", "creation_time": "2002-06-07T20:28:00Z", "text": "Thank for adding a <checksum> task.  I hope you will change it so it buffers \nits input file.\n\nThe plain <checksum> task worked for 40+ minutes on a 210MB file.  With the \naddition of a 1MB buffer, the speed went to 27 seconds.  This is a major \nimprovement and makes the checksum task competitive with other existing MD5 \nutilities.\n\nChecksum.java currently iterates over dis.read() in its generateChecksums() \nmethod.  The read method reads one byte at a time.  To add a buffer, you could \nmodify the code:\n\nFrom:\n>  while (dis.read() != -1) {\n>    ;\n>  }\n\nTo:\n>  byte[] buffer = new byte[bufferSize];\n>  while (dis.read(buffer, 0, buffer.length) != -1) {\n>     ;\n>  }\n\nand add a setter method for the integer bufferSize.\n\n>    /**\n>     * Size of read buffer.\n>     * Defaults to 10K.\n>     */\n>    public void setBufferSize(int bufferSize) {\n>        this.bufferSize = bufferSize;\n>    }\n\nThen we can specify the buffer size through build.xml:\n\n\t<target name=\"checksum\">\n\t\t<checksum buffersize=\"1024000\">\n\t\t\t<fileset dir=\"${fileset.dir}\">\n\t\t\t\t<exclude name=\"**/*.MD5\"/>\n\t\t\t</fileset>\n\t\t</checksum>\n\t</target>\n\nand have a speedy md5 checksum calculator.  Please rename \"bufferSize\" as you \nsee fit.  If there's a way to say \"1MB\" instead of \"1024000\" that would be nice \nto have as well."}, {"count": 1, "text": "Applied to the 1.5 branch, i.e. Ant 1.5 will have a buffer (default is 8192 bytes\nthe attribute is readbuffersize).\n\nThanks", "creator": "bodewig@apache.org", "attachment_id": null, "id": 17589, "time": "2002-06-11T14:16:03Z", "bug_id": 9704, "creation_time": "2002-06-11T14:16:03Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 8075, "attachment_id": null, "text": "The \"public static void parseParameters(Map map, byte[] data, String encoding)\" \nmethod in org/apache/catalina/util/RequestUtil.java does not properly parse \nstrings like \"foo=ab&bar=cd&foobar=ef=gh^ij=kl\".  The parameter=value pairs \nshould be \"foo=ab\", \"bar=cd\" and \"foobar=ef=gh^ij=kl\".  The fix is to change \nthe method so that it doesn't get tripped up on other '=' characters AFTER it \nhas found the key.\n\nThe following patch fixes this.\n\nIndex: RequestUtil.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\n4.0/catalina/src/share/org/apache/catalina/util/RequestUtil.java,v\nretrieving revision 1.19\ndiff -u -r1.19 RequestUtil.java\n--- RequestUtil.java\t21 Feb 2002 22:51:55 -0000\t1.19\n+++ RequestUtil.java\t14 Apr 2002 18:59:42 -0000\n@@ -494,6 +494,7 @@\n             int    ox = 0;\n             String key = null;\n             String value = null;\n+            boolean keyFound = false;\n             while (ix < data.length) {\n                 byte c = data[ix++];\n                 switch ((char) c) {\n@@ -502,13 +503,10 @@\n                     if (key != null) {\n                         putMapEntry(map, key, value);\n                         key = null;\n+                        keyFound = false;\n                     }\n                     ox = 0;\n                     break;\n-                case '=':\n-                    key = new String(data, 0, ox, encoding);\n-                    ox = 0;\n-                    break;\n                 case '+':\n                     data[ox++] = (byte)' ';\n                     break;\n@@ -516,6 +514,16 @@\n                     data[ox++] = (byte)((convertHexDigit(data[ix++]) << 4)\n                                     + convertHexDigit(data[ix++]));\n                     break;\n+                case '=':\n+                    if (keyFound == false) {\n+                       key = new String(data, 0, ox, encoding);\n+                       ox = 0;\n+                       keyFound = true;\n+                       break;\n+                    }\n+                    else {\n+                       // fall through and let the default statement handle it\n+                    }\n                 default:\n                     data[ox++] = c;\n                 }", "id": 13525, "time": "2002-04-14T21:59:15Z", "creator": "wbeckwith@directlink.net", "creation_time": "2002-04-14T21:59:15Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 8075, "attachment_id": null, "id": 13526, "time": "2002-04-14T22:11:50Z", "creator": "remm@apache.org", "creation_time": "2002-04-14T22:11:50Z", "is_private": false, "text": "While this particular case could be fixed, it will not be, as '=' is a reserved \ncharacter in a URI which must be escaped (using %xx)."}]
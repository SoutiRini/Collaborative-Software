[{"count": 0, "tags": [], "bug_id": 53533, "attachment_id": null, "text": "My project cannot call apr_dbd_get_row() without clearing up the pool when export a plenty of data from MySQL because the APR memory pool is not a GC and the data size is larger than physical memory.\n\nAs a work around, I call apr_dbd_select() with the request_rec->pool, and then call apr_dbd_get_row() with a subpool of request_rec->pool in a for loop. I always clear the subpool after every thousand rows fetched. Unfortunately, the last call apr_dbd_get_row() ways makes the httpd segment fault. Because when there is no data left, the mysql driver will call apr_pool_cleanup_run() on the subpool. Obviously, that is incorrect.\n\n--- dbd/apr_dbd_mysql.c\t2012-07-11 15:42:49.193079005 +0800\n+++ dbd/apr_dbd_mysql_new.c\t2012-07-11 15:50:52.593079004 +0800\n@@ -325,7 +325,7 @@\n         (*row)->len = mysql_fetch_lengths(res->res);\n     }\n     else {\n-        apr_pool_cleanup_run(pool, res->res, free_result);\n+        apr_pool_cleanup_run(res->pool, res->res, free_result);\n     }\n     return ret;\n }", "id": 160581, "time": "2012-07-11T08:12:38Z", "creator": "arthur.echo@gmail.com", "creation_time": "2012-07-11T08:12:38Z", "is_private": false}, {"count": 1, "tags": [], "creator": "sf@sfritsch.de", "text": "Thanks for your patch. It will be included in the next release of apr-util (likely 1.5.0)\n\ncommits:\ntrunk: r1369681\n1.5: r1369682\n1.4: r1369684", "id": 161101, "time": "2012-08-05T21:16:01Z", "bug_id": 53533, "creation_time": "2012-08-05T21:16:01Z", "is_private": false, "attachment_id": null}]
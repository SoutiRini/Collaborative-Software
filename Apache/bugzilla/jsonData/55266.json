[{"count": 0, "tags": [], "creator": "fsommer0815@googlemail.com", "attachment_id": 30594, "text": "Created attachment 30594\ncontains a maven project including tomcat6-plugin to package the webapp and run tomcat using maven. This archive also includes a deployable war beneath /dist.\n\nI'm using URL rewriting and recently upgraded my tomcat version from 6.0.32 to 6.0.33. I figured out that since 6.0.33 the jsessionid attribute is omitted in the Location header when Tomcat forces a trailing slash redirect e.g. from /mypath to /mypath/. The effect is that the session information is lost after the redirect.\n\nThis pretty looks like the same as an old bug 'Bug 34749' (https://issues.apache.org/bugzilla/show_bug.cgi?id=34749) in Tomcat 5.\n\n\nSteps to reproduce:\n\n1. Deploy the attached war to a Tomcat >= 6.0.33 or use 'mvn package tomcat6:run' if you whish to use maven tomcat6 plugin.\n\n2. Create a session by requesting a page 'createsession.jsp'. The response shows a sessionid that is required for step three and four.\ncurl -v \"http://localhost:8080/jsessionid-issue/createsession.jsp\"\n\n\n3. Append the jsessionid attribute to the uri \"http://localhost:8080/jsessionid-issue/\". Please note the slash at the end of the path.\ncurl -Lv \"http://localhost:8080/jsessionid-issue/;jsessionid=_id_\"\n\nThe jsessionid is taken into account. The response shows that the session of the requested sessionid has been used.\n\n4. Now, request the same uri without the trailing slash: 'http://localhost:8080/jsessionid-issue;jsessionid=_id_'\ncurl -Lv \"http://localhost:8080/jsessionid-issue;jsessionid=_id_\"\n\nFirst, the output shows a 302 redirect that is forced by tomcat. The location header shows the uri 'http://localhost:8080/jsessionid-issue/' with a trailing slash now but the jsessionid attribute is missing.\nAccordingly, the response of the second request shows that no session has been used.\n\n\n\nSample:\n\n1. 'mvn package tomcat6:run'\n15.07.2013 07:46:46 org.apache.catalina.startup.Embedded start\nINFO: Starting tomcat server\n15.07.2013 07:46:46 org.apache.catalina.core.StandardEngine start\nINFO: Starting Servlet Engine: Apache Tomcat/6.0.37\n15.07.2013 07:46:47 org.apache.coyote.http11.Http11Protocol init\nINFO: Initializing Coyote HTTP/1.1 on http-8080\n15.07.2013 07:46:47 org.apache.coyote.http11.Http11Protocol start\nINFO: Starting Coyote HTTP/1.1 on http-8080\n\n\n2. curl -v \"http://localhost:8080/jsessionid-issue/createsession.jsp\"\n* About to connect() to localhost port 8080 (#0)\n*   Trying ::1...\n* connected\n* Connected to localhost (::1) port 8080 (#0)\n> GET /jsessionid-issue/createsession.jsp HTTP/1.1\n> User-Agent: curl/7.28.0\n> Host: localhost:8080\n> Accept: */*\n> \n< HTTP/1.1 200 OK\n< Server: Apache-Coyote/1.1\n< Content-Type: text/html;charset=utf-8\n< Content-Length: 92\n< Date: Mon, 15 Jul 2013 06:22:11 GMT\n< \n\n########################################\ncreated session: 968F6BEC133C69A20EAFF0D2093F7A56\n########################################\n\n\n3. curl -Lv \"http://localhost:8080/jsessionid-issue/;jsessionid=968F6BEC133C69A20EAFF0D2093F7A56\"\n* About to connect() to localhost port 8080 (#0)\n*   Trying ::1...\n* connected\n* Connected to localhost (::1) port 8080 (#0)\n> GET /jsessionid-issue/;jsessionid=968F6BEC133C69A20EAFF0D2093F7A56 HTTP/1.1\n> User-Agent: curl/7.28.0\n> Host: localhost:8080\n> Accept: */*\n> \n< HTTP/1.1 200 OK\n< Server: Apache-Coyote/1.1\n< Content-Type: text/html;charset=utf-8\n< Content-Length: 285\n< Date: Mon, 15 Jul 2013 06:22:49 GMT\n< \n\n########################################\nhttp session: 968F6BEC133C69A20EAFF0D2093F7A56\ngetRequestURI: /jsessionid-issue/;jsessionid=968F6BEC133C69A20EAFF0D2093F7A56\ngetRequestedSessionId: 968F6BEC133C69A20EAFF0D2093F7A56\nisRequestedSessionIdFromURL: true\nisRequestedSessionIdValid: true\n########################################\n\n\n4. curl -Lv \"http://localhost:8080/jsessionid-issue;jsessionid=968F6BEC133C69A20EAFF0D2093F7A56\"\n* About to connect() to localhost port 8080 (#0)\n*   Trying ::1...\n* connected\n* Connected to localhost (::1) port 8080 (#0)\n> GET /jsessionid-issue;jsessionid=968F6BEC133C69A20EAFF0D2093F7A56 HTTP/1.1\n> User-Agent: curl/7.28.0\n> Host: localhost:8080\n> Accept: */*\n> \n< HTTP/1.1 302 Found\n< Server: Apache-Coyote/1.1\n< Location: http://localhost:8080/jsessionid-issue/\n< Transfer-Encoding: chunked\n< Date: Mon, 15 Jul 2013 06:24:12 GMT\n< \n* Ignoring the response-body\n* Connection #0 to host localhost left intact\n* Issue another request to this URL: 'http://localhost:8080/jsessionid-issue/'\n* Re-using existing connection! (#0) with host localhost\n* Connected to localhost (::1) port 8080 (#0)\n> GET /jsessionid-issue/ HTTP/1.1\n> User-Agent: curl/7.28.0\n> Host: localhost:8080\n> Accept: */*\n> \n< HTTP/1.1 200 OK\n< Server: Apache-Coyote/1.1\n< Content-Type: text/html;charset=utf-8\n< Content-Length: 189\n< Date: Mon, 15 Jul 2013 06:24:12 GMT\n< \n\n########################################\nhttp session is null\ngetRequestURI: /jsessionid-issue/\ngetRequestedSessionId: null\nisRequestedSessionIdFromURL: false\nisRequestedSessionIdValid: false\n########################################", "id": 168598, "time": "2013-07-15T07:30:05Z", "bug_id": 55266, "creation_time": "2013-07-15T07:30:05Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 55266, "text": "Confirmed. This happens with 6.0.x but not 7.0.x or trunk.", "id": 168692, "time": "2013-07-21T17:33:30Z", "creator": "markt@apache.org", "creation_time": "2013-07-21T17:33:30Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": 30608, "text": "Created attachment 30608\nProposed patch for this issue\n\nThis patch fixes this issue for me in local testing. I'll propose it for 6.0.x.", "id": 168693, "time": "2013-07-21T17:47:41Z", "bug_id": 55266, "creation_time": "2013-07-21T17:47:41Z", "is_private": false}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "This has been fixed in 6.0.x and will be included in 6.0.38 onwards.", "id": 171853, "time": "2013-12-20T09:42:14Z", "bug_id": 55266, "creation_time": "2013-12-20T09:42:14Z", "is_private": false}]
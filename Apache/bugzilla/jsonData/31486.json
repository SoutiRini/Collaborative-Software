[{"count": 0, "tags": [], "creator": "michael.alzheimer@macomm.dnsalias.org", "is_private": false, "text": "Hello,\n\nI use apache 2.0.52 on some Sun Solaris 9 (sparc) and Linux (gentoo 2-6.x) Boxes\nas a proxy-server. In case of reducing network traffic i'd like to use the disk\ncache functionality.\n\nThe Problem is ( i saw it on every 2.0.x (>30) release i tested ), if\nmod_disk_cache is used, the first time i show up a web page it is displayed\ncorrectly.\nThe second / third time i display the same page, some pictures / style sheet's\nand sometimes even the whole page is missing.\n\nIf httpd is run in a truss, is see, if it likes to open the disk cache it\ncouldn't find the files, it thinks it has cached before...\n\n259:    open(\"/var/httpd-proxy/proxycache/NEf/Fin/YMI/kW1/7zJ/KcGRYcg.data\",\nO_RDONLY) Err#2 ENOENT\n\nIn the apache-error logfile i see following message:\n[Thu Sep 30 13:14:36 2004] [debug] mod_disk_cache.c(400): disk_cache: Recalled\ncached URL info header www.macomm.dehttp://www.macomm.de/gfx/bottom.gif?\n[Thu Sep 30 13:14:36 2004] [debug] mod_disk_cache.c(464): disk_cache: Recalled\nheaders for URL www.macomm.dehttp://www.macomm.de/gfx/bottom.gif?\n[Thu Sep 30 13:14:36 2004] [info] [client 10.104.8.226] Module bug?  Request\nfilename is missing for URI http://www.macomm.de/gfx/bottom.gif, referer:\nhttp://www.macomm.de/racing-1.html\n[Thu Sep 30 13:14:36 2004] [error] [client 10.104.8.226] File does not exist:\n(null), referer: http://www.macomm.de/racing-1.html\n\n\nI don't know what can be wrong there. What is saw is, cached pages are stored on\ndisk very late. What i mean is, i request a page, see it completely downloaded\nin my browser, but it isn't stored on the disk cache. Some times later (maybe 10\nseconds, 30 seconds) it is sotred on the disk cache...\n\nI have no idea what can be wrong there. But this prevents me implementing proxy\ndisk cache in my servers.\n\nmaybe someone can have a look for it.", "id": 64415, "time": "2004-09-30T13:40:43Z", "bug_id": 31486, "creation_time": "2004-09-30T13:40:43Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "e_val@inbox.ru", "text": "See http://nagoya.apache.org/bugzilla/show_bug.cgi?id=30278, yours bug is just a\nduplicate I think", "id": 66874, "time": "2004-11-14T11:29:47Z", "bug_id": 31486, "creation_time": "2004-11-14T11:29:47Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 31486, "is_private": false, "id": 66934, "time": "2004-11-15T14:53:36Z", "creator": "michael.alzheimer@macomm.dnsalias.org", "creation_time": "2004-11-15T14:53:36Z", "tags": [], "text": "(In reply to comment #1)\n> See http://nagoya.apache.org/bugzilla/show_bug.cgi?id=30278, yours bug is just a\n> duplicate I think\n\nunfortunatly no.\n\nBug No. 30278  has the problem, that a page, that was cached is transferred with\nwrong content header (e. g. \"text/plain; charset=UTF-8\" instead of \"text/css\").\n\nThe Bug i describe is, that a page can't be transferred, because the cached file\n( or the file mod_disk_cache \"thinks\" ) is not found on the local filesystem.\n(Err#2 ENOENT)"}, {"count": 3, "tags": [], "creator": "jerenkrantz@apache.org", "is_private": false, "text": "Looking at the code, I see no way for this set of conditions to happen within\nmod_disk_cache by itself.\n\nIf you look at modules/experimental/mod_disk_cache.c:343 in the httpd-2.0.52\ntarball, you will see that if an open call fails, it will generate a DECLINED\nresponse.  This will cause mod_disk_cache to try to save the response, but not\nserve from the cache page.\n\nAre you sure that the hash file that is ENOENT on open() corresponds to that\nURL?  (http://www.macomm.de/gfx/bottom.gif should correspond to something like\n'Y9/1v/kx/IeVeco@1i0tZ6YQg.data')\n\nWhat is the exact configuration syntax for mod_disk_cache you are using?  Your\ntruss/strace output has three-character directory hashes which isn't standard,\nso what else are you specifying.\n\nAre you using mod_proxy?  What is the configuration you are using there?\n\nWhat client are you using to request the data?  Can you capture the specific\nHTTP request?  (including the first page that works, then all subsequent errors.)\n\nDo note that mod_cache was completely rewritten and included in 2.0.52 as we\nknow the caching did not work in any prior release.  So, any analysis or traces\nbefore 2.0.52 would be useless now.  (And, 2.1.3 has the best available caching\nmodules, but most of the functionality and fixes in 2.1.3 should be present in\n2.0.52.)", "id": 70245, "time": "2005-01-30T19:12:33Z", "bug_id": 31486, "creation_time": "2005-01-30T19:12:33Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 31486, "is_private": false, "id": 72311, "attachment_id": null, "creator": "michael.alzheimer@macomm.dnsalias.org", "creation_time": "2005-03-13T23:06:46Z", "time": "2005-03-13T23:06:46Z", "text": "Hi,\n\nactual i upgraded to 2.0.53 a view weeks ago, and now i'm testing the proxy disk\ncaching for this time period.\nI can say, since the upgrade i can't reproduce this problem, and caching seems\nto work very well - thats good!\nEvery problem i saw before has gone...\n\nSo an upgrade to 2.0.53 seems to fix this problem.\n\nMichael."}, {"count": 5, "tags": [], "bug_id": 31486, "text": "Resolving as fixed since the reporter said 2.0.53 works.", "id": 72314, "time": "2005-03-14T00:06:12Z", "creator": "chip@force-elite.com", "creation_time": "2005-03-14T00:06:12Z", "is_private": false, "attachment_id": null}]
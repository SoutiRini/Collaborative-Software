[{"count": 0, "tags": [], "bug_id": 53040, "attachment_id": null, "text": "Either try to compile ssl module as shared or static all have the problem, and openssl version used to compile is 1.0.0g\n\nWhen try to reach the ssl virtual hosts after idle for a while, get the following from browser:\n\"\nThe connection was reset    \n          The connection to the server was reset while the page was loading.        \n\n  The site could be temporarily unavailable or too busy. Try again in a few\n    moments.\n  If you are unable to load any pages, check your computer's network\n    connection.\n  If your computer or network is protected by a firewall or proxy, make sure\n    that Firefox is permitted to access the Web.\n\nTry again.\n\n\"\nAfter click try again to refresh the page , the page get back.\nIn error_log we got:\n\n[Thu Apr 05 11:11:20.272279 2012] [core:notice] [pid 25398:tid 1] AH00094: Command line: '/usr/local/apache2.4.1/bin/httpd'\n[Thu Apr 05 11:21:00.983966 2012] [core:notice] [pid 25398:tid 1] AH00052: child pid 25400 exit signal Bus error (10)\n[Thu Apr 05 11:21:08.054928 2012] [core:notice] [pid 25398:tid 1] AH00052: child pid 25401 exit signal Bus error (10)", "id": 157220, "time": "2012-04-05T16:44:16Z", "creator": "wenyan.peng@aarcorp.com", "creation_time": "2012-04-05T16:44:16Z", "is_private": false}, {"count": 1, "tags": [], "creator": "sf@sfritsch.de", "text": "A backtrace of a crashing process would be very useful. See http://httpd.apache.org/dev/debugging.html and especially the part about solaris, there.", "id": 157244, "time": "2012-04-06T21:14:04Z", "bug_id": 53040, "creation_time": "2012-04-06T21:14:04Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 53040, "text": "(In reply to comment #1)\n> A backtrace of a crashing process would be very useful. See\n> http://httpd.apache.org/dev/debugging.html and especially the part about\n> solaris, there.\n\nAfter I commented out SSLSessionCache and SSLSessionCache timeout, it gets stable.\nI will do the backtrace when I get chance. Thanks.", "id": 157733, "time": "2012-04-09T13:54:34Z", "creator": "wenyan.peng@aarcorp.com", "creation_time": "2012-04-09T13:54:34Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "hadfieldj@gmail.com", "attachment_id": null, "text": "I'm able to reproduce with httpd 2.4.1, mpm worker, OpenSSL 0.9.7d on Solaris (sparc T5220).\nIntermittent connection resets messages returned to browser after a restart with the following in error_log.\n\n[Tue Apr 17 16:38:41.033550 2012] [core:notice] [pid 15959:tid 1] AH00051: child pid 16109 exit signal Bus error (10), possible coredump in /usr/local/apache-2.4.1\n\nssl module compiled as static and error occurs with shmcb but not dbm storage type for SSLSessionCache. Still able to produce error with different ssl-cache mutex mechanisms.", "id": 158143, "time": "2012-04-17T15:42:43Z", "bug_id": 53040, "creation_time": "2012-04-17T15:42:43Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 53040, "attachment_id": null, "text": "Wild guess: Bus error for shmcb on Solaris Sparc rings a bell: there were alignment problems in shm a few years ago. Those were fixed at that time, but maybe some type of this error is back.\n\nStill a core dump which is inspectable by gdb would be helpful.", "id": 158152, "time": "2012-04-17T22:03:36Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-04-17T22:03:36Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 53040, "attachment_id": 29187, "text": "Created attachment 29187\nExperimental patch of mod_socache_shmcb.c\n\nThat guess hits the nail on the head! This is indeed a memory alignment issue on SPARC systems!\nSee http://blog.jgc.org/2007/04/debugging-solaris-bus-error-caused-by.html for a good description of the basic problem.\nWe compiled httpd 2.4.2 (32bit) on SPARC Solaris 10 using gcc, and experienced the \"Bus error\" issue as described above.\n\nIt turns out to be an issue with the shmcb implementation (modules/cache/mod_socache_shmcb.c).\nThe problem is the SHMCBIndex structure having a member \"expires\" of type apr_time_t (long long). This needs to be 8 byte aligned, otherwise it will cause a Bus error on access!\n\nHowever, the SHMCBIndex objects are nested within subcaches, which are prepended by an SHMCBHeader structure.\nThe memory allocation inside the SHM segment looks more or less like this:\n\n                              [ expires, ...] [ expires, ...]\n              [ SHMCBSubcache | SHMCBIndex   ,  SHMCBIndex   , ... | Data ]\n[ SHMCBHeader | subcache 0                                                 ,\n---------------------------------------------------------------------------->\nAlignment:                      ^8 byte         ^8 byte\n\n                 [ expires, ...]\n [ SHMCBSubcache | SHMCBIndex   , ... ]\n   subcache 1                          , ... ]\n>----------------------------------------------\nAlignment:         ^8 byte\n\n\nHaving got so far, I found a fix that is not pretty, but quite simple and unintrusive. On the downside it depends heavily on the details of the current implementation.\nThe obvious way to ensure correct alignment of the SHMCBIndex structures seems to be to make sure all the building blocks' sizes are a multiple of 8 bytes.\nThis is already the case for SHMCBSubcache (size=16), and SHMCBIndex (24), but not for SHMCBHeader (52).\nThe size of the subcache's \"Data\" segment (subcache_data_size) is calculated at startup and depends on the configured SSLSessionCache size. (For the default it is 14180 ( % 8 = 4), which means that every other subcache will fail!)\n\nThe attached patch works on our system.\nMaybe you can find a more elegant / robust fix for this issue!", "id": 161169, "time": "2012-08-08T15:10:35Z", "creator": "gschaudy@gmail.com", "creation_time": "2012-08-08T15:10:35Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 53040, "attachment_id": 29220, "text": "Created attachment 29220\nPatch using inter struct padding instead of padding struct members.\n\nPlease check the following alternative patch. It does not need to add padding to the structures and instead aligns their positioning in shm correctly.", "id": 161351, "time": "2012-08-13T20:25:13Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-08-13T20:25:13Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 53040, "attachment_id": null, "is_private": false, "id": 161416, "time": "2012-08-15T09:21:30Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-08-15T09:21:30Z", "text": "Fixed in trunk in r1373270.\nProposed for backport to 2.4.x."}, {"count": 8, "tags": [], "text": "\n\n(In reply to comment #7)\nFinally had the opportunity to test your latest patch. It works on our system!", "is_private": false, "id": 161533, "creator": "gschaudy@gmail.com", "time": "2012-08-20T10:22:40Z", "bug_id": 53040, "creation_time": "2012-08-20T10:22:40Z", "attachment_id": null}, {"count": 9, "attachment_id": null, "bug_id": 53040, "is_private": false, "id": 161571, "time": "2012-08-21T15:51:10Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-08-21T15:51:10Z", "tags": [], "text": "Fixed in 2.4 with r1373439.\nReleased with version 2.4.3.\nDoes not apply to 2.2 versions."}]
[{"count": 0, "tags": [], "bug_id": 2412, "attachment_id": null, "text": "I wrote a task of my own. It is compiled before taskdef is used to make this\ntask available in the build file. When I use taskdef when task has just been\ncompiled it fails raising a \"class not found exception\".\n\nIf I then rerun the build (my task has been compiled in the previous) every\nworks fine. This very annoying because I must invoke the build twice.", "id": 3354, "time": "2001-07-02T00:59:38Z", "creator": "boris@i3.informatik.rwth-aachen.de", "creation_time": "2001-07-02T00:59:38Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 2412, "attachment_id": null, "is_private": false, "id": 3392, "time": "2001-07-04T04:50:55Z", "creator": "bodewig@apache.org", "creation_time": "2001-07-04T04:50:55Z", "text": "Since version 1.2 you can place the taskdef task itself after the javac task,\nthis way it is possible to build and use a task in the same run.\n"}, {"count": 2, "tags": [], "bug_id": 2412, "text": "The following code snippet is a part of my build.xml file.\n\n  <target name=\"prepare\" depends=\"check_for_optional_packages, compile-tasks\" >\n    <tstamp/>\n    <taskdef name=\"xml2pdf\" classname=\"i3.tools.ant.tasks.Xml2Pdf\" />\n  </target>\n\n  <target name=\"compile-tasks\" >\n    <mkdir dir=\"${build.classes.dir}\"/>\n\n    <javac srcdir=\"${src.share.dir}\"\n           destdir=\"${build.classes.dir}\"\n           debug=\"${debug}\" \n           deprecation=\"${deprecation}\" >\n      <classpath refid=\"classpath\" />\n      <include name=\"i3/tools/ant/**\" />\n    </javac>\n  </target>\nThe `compile-tasks' target compiles my Ant tasks before a taskdef defines them.\nA `build.sh' script, which invokes Ant, ensures that the directory\n${build.classes.dir} is in the CLASSPATH! If my task has not been compiled \nbefore I get the following error message:\n\n\ncompile-tasks:\n    [mkdir] Created dir: /home/boehlen/work/Projekte/UPGRADE/develop/upgrade/build\n    [mkdir] Created dir:\n/home/boehlen/work/Projekte/UPGRADE/develop/upgrade/build/classes\n    [javac] Compiling 1 source file to\n/home/boehlen/work/Projekte/UPGRADE/develop/upgrade/build/classes\n \nprepare:\n \nBUILD FAILED\n \n/home/boehlen/work/Projekte/UPGRADE/develop/upgrade/build.xml:88: taskdef class\ni3.tools.ant.tasks.Xml2Pdf cannot be found\n--- Nested Exception ---\njava.lang.ClassNotFoundException: i3.tools.ant.tasks.Xml2Pdf\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:200)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:297)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:286)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:253)\n        at org.apache.tools.ant.taskdefs.Taskdef.execute(Taskdef.java:111)\n        at org.apache.tools.ant.Target.execute(Target.java:153)\n        at org.apache.tools.ant.Project.runTarget(Project.java:898)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:536)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:510)\n        at org.apache.tools.ant.Main.runBuild(Main.java:421)\n        at org.apache.tools.ant.Main.main(Main.java:149)\n\nBTW, putting the taskdef in the same target doesn't help. If I invoke the build\na second time, then my tasks can be defined.", "id": 3395, "time": "2001-07-04T05:48:32Z", "creator": "boris@i3.informatik.rwth-aachen.de", "creation_time": "2001-07-04T05:48:32Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "bodewig@apache.org", "text": "OK, I can reproduce that.  If I include ${build.classes.dir} in the CLASSPATH\nenvironment variable it doesn't work, just as you describe it.\n\nAs a workaround (until I get this sorted out)\n\n <taskdef name=\"xml2pdf\" classname=\"i3.tools.ant.tasks.Xml2Pdf\">\n   <classpath>\n     <path location=\"${build.src.classes}\" />\n   </classpath>\n </taskdef>\n\nshould work (you may have to add additional stuff to that classpath).\n\n", "id": 3396, "time": "2001-07-04T06:43:23Z", "bug_id": 2412, "creation_time": "2001-07-04T06:43:23Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 2412, "is_private": false, "id": 3397, "time": "2001-07-04T07:04:16Z", "creator": "bodewig@apache.org", "creation_time": "2001-07-04T07:04:16Z", "tags": [], "text": "The problem seems to be that your build.classes.dir doesn't exist when you start\nAnt - if I create the directory my task gets compiled into before I start Ant\n(and add this directory to CLASSPATH), everything works fine.\n\nIt looks as if the system classloader would automatically drop all CLASSPATH\nentries that point to nowhere - could you please verify that this is true in your\ncase as well (i.e. create build.classed.dir in your shell script before you\ninvoke Ant).\n\nAll we could do is to always use a classloader of our own ..."}, {"count": 5, "tags": [], "bug_id": 2412, "attachment_id": null, "is_private": false, "id": 3405, "time": "2001-07-04T08:50:58Z", "creator": "boris@i3.informatik.rwth-aachen.de", "creation_time": "2001-07-04T08:50:58Z", "text": "You are right. When I create the directory before doing a build everything works\nfine."}, {"count": 6, "tags": [], "bug_id": 2412, "attachment_id": null, "text": "Don't trust the system classloader 8-)\n\nFixed in nightly 2001-07-06.", "id": 3420, "time": "2001-07-05T05:32:40Z", "creator": "bodewig@apache.org", "creation_time": "2001-07-05T05:32:40Z", "is_private": false}]
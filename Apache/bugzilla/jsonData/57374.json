[{"count": 0, "tags": [], "bug_id": 57374, "attachment_id": null, "is_private": false, "id": 179876, "time": "2014-12-19T15:42:31Z", "creator": "apache-bugzilla@michael-kaufmann.ch", "creation_time": "2014-12-19T15:42:31Z", "text": "The KeepAliveTimeout is calculated incorrectly after the system clock has been put back. This is probably a bug in the event MPM, because it does not happen with the worker MPM.\n\nHow to reproduce this bug:\n* build Apache httpd 2.4.10 with ./configure --with-mpm=event --enable-mpms-shared=\"event worker\" [....]\n* start httpd and send this request (e.g. with telnet):\nGET / HTTP/1.1\nHOST: test\n\n* Apache closes the connection after 5 seconds (as expected)\n* Change the system time:\nsudo date -s \"-1hour\"\n* Send a new request. Now Apache does NOT close the connection after 5 seconds. I assume that the keep-alive timeout is 5 seconds + 1 hour."}, {"count": 1, "tags": [], "bug_id": 57374, "is_private": false, "text": "The bug is probably in event.c / listener_thread():\n\n===\nnow = apr_time_now();\n/* we only do this once per 0.1s (TIMEOUT_FUDGE_FACTOR) */\nif (now > timeout_time) {\n    struct process_score *ps;\n    timeout_time = now + TIMEOUT_FUDGE_FACTOR;\n    ....\n===\n\ntimeout_time contains a wrong value after the system time has changed (the value is relative to the old system time).\n\nMeasuring time intervals with apr_time_now() or gettimeofday() is a bad idea, see here: http://blog.habets.pp.se/2010/09/gettimeofday-should-never-be-used-to-measure-time\n\nUnfortunately, there is no function in APR that corresponds to clock_gettime(CLOCK_MONOTONIC, ...).", "id": 180319, "time": "2015-01-16T15:19:10Z", "creator": "apache-bugzilla@michael-kaufmann.ch", "creation_time": "2015-01-16T15:19:10Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 57374, "attachment_id": null, "id": 181405, "time": "2015-03-01T02:04:10Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2015-03-01T02:04:10Z", "is_private": false, "text": "Can you please try patch attachment 32532 from Bug 56226?\nIt should handle this issue (too)."}, {"count": 3, "tags": [], "text": "Please use attachment 32534 (trunk) or attachment 32535 (2.4.x) instead.", "attachment_id": null, "id": 181409, "creator": "ylavic.dev@gmail.com", "time": "2015-03-01T02:40:06Z", "bug_id": 57374, "creation_time": "2015-03-01T02:40:06Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 57374, "attachment_id": null, "id": 181447, "time": "2015-03-02T18:31:14Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2015-03-02T18:31:14Z", "is_private": false, "text": "Please use latest (non absolete) attachments from Bug 56226."}, {"count": 5, "tags": [], "bug_id": 57374, "attachment_id": null, "is_private": false, "id": 181507, "time": "2015-03-04T17:37:21Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2015-03-04T17:37:21Z", "text": "Committed in r1664071.\n\nSince the timeout logic has changed from Bug 56226, I'm marking this one as duplicate, the fix belongs in there.\n\n*** This bug has been marked as a duplicate of bug 56226 ***"}, {"count": 6, "tags": [], "text": "I have tested the patch: It works. Thank you very much Yann!", "attachment_id": null, "id": 181511, "creator": "apache-bugzilla@michael-kaufmann.ch", "time": "2015-03-04T20:59:59Z", "bug_id": 57374, "creation_time": "2015-03-04T20:59:59Z", "is_private": false}]
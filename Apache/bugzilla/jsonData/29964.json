[{"count": 0, "tags": [], "text": "I'm seeing a non-terminating loop in ssl_io_input_getline().\n\nWe used a 3rd party tool to send a request to our Apache server. The tool tried \nto present an expired certificate to a SSL enabled vhost and Apache correctly \nrefused the correction. But, it set Apache to spin out of control.\n\nI'm a complete outsider of the Apache/mod_ssl code. But this is what I found. \nAs mentioned, Apache did shutdown the filter's SSL connection. However, it \ncontinued to read in GETLINE/blocking mode the rest of the request. Here comes \nthe problem. ssl_io_input_getline() calls ssl_io_input_read() to read to a LF \nor the max. of the buffer can handle, whichever comes first. But, \nssl_io_input_read() realizes the filter's SSL connection has been shutdown, it \nreturns with the last known status of the BIO which was created to read from \nthis SSL connection. It also set the returned length to 0. Unfortunately, the \ncaller get APR_SUCCESS return code and because the returned length is 0, the \nremaining buffer length does not get changed at all. \n\nBecause the return code is always APR_SUCCESS and because the returned length \nis always 0 and the buffer is not full, ssl_io_input_getline() keeps calling \nssl_io_input_read(). It goes on forever!", "is_private": false, "id": 60272, "creator": "fwai@rsasecurity.com", "time": "2004-07-07T23:50:51Z", "bug_id": 29964, "creation_time": "2004-07-07T23:50:51Z", "attachment_id": null}, {"attachment_id": 12060, "tags": [], "bug_id": 29964, "text": "Created attachment 12060\nssl_io_input_read fix", "count": 1, "id": 60291, "time": "2004-07-08T11:04:23Z", "creator": "jorton@redhat.com", "creation_time": "2004-07-08T11:04:23Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 29964, "text": "Thanks for the report and analysis.  Can you try the patch attached above?", "id": 60292, "attachment_id": null, "creator": "jorton@redhat.com", "creation_time": "2004-07-08T11:04:56Z", "time": "2004-07-08T11:04:56Z", "is_private": false}, {"count": 3, "tags": [], "text": "\nThanks for the quick response.\n\nWe thought about this before I submitted the bug report. We thought APR_EOF or \nAPR_EGENERAL or in fact any return code other than APR_SUCCESS would have been \nsufficient to prevent Apache from spinning out of control.\n\nWe could not decide on either, however. We are not super familiar with the \nApache/mod_ssl code and, more important, this is the most exercised part of \nthe server as far as we're concerned. It is important that the return code \ndoes what it is supposed to do _and_ does not cause any un-expected side-\neffect.\n", "attachment_id": null, "id": 60318, "creator": "fwai@rsasecurity.com", "time": "2004-07-08T19:30:44Z", "bug_id": 29964, "creation_time": "2004-07-08T19:30:44Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 29964, "text": "APR_ECONNRESET, APR_EGENERAL or APR_EOF would all be reasonable choices.  Doing\nany of these would clearly be better than the status quo; opt for APR_EGENERAL\nto be conservative.\n\nI couldn't reproduce the issue here from in brief attempt, so if you could\nconfirm that the patch does fix the issue that would be helpful.", "id": 60566, "time": "2004-07-13T19:40:21Z", "creator": "jorton@redhat.com", "creation_time": "2004-07-13T19:40:21Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "fwai@rsasecurity.com", "text": "\nWe patched Apache as suggested and it does fix the problem. We're in the \nprocess of conducting more thorough tests and if anything unexpected crops up, \nI'll report here.\n\nThanks for the response.\n", "id": 60568, "time": "2004-07-13T19:45:18Z", "bug_id": 29964, "creation_time": "2004-07-13T19:45:18Z", "is_private": false, "attachment_id": null}, {"count": 6, "text": "The fix checked in is slightly different:\n\nhttp://cvs.apache.org/viewcvs.cgi/httpd-2.0/modules/ssl/ssl_engine_io.c?r1=1.124&r2=1.125\n\nthis will be proposed for backport for the next 2.0 release.  This issue has\nbeen assigned CVE CAN-2004-0748.", "bug_id": 29964, "attachment_id": null, "id": 61819, "time": "2004-08-11T13:25:55Z", "creator": "jorton@redhat.com", "creation_time": "2004-08-11T13:25:55Z", "tags": [], "is_private": false}]
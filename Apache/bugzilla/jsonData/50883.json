[{"count": 0, "tags": [], "creator": "dashashishkumar@gmail.com", "attachment_id": null, "id": 144794, "time": "2011-03-07T06:07:23Z", "bug_id": 50883, "creation_time": "2011-03-07T06:07:23Z", "is_private": false, "text": "Hi ! \n    Eventually I am getting the following StackOverflowError in Tomcat 6.0.29, and after walking through this StackTrace, and source code of Tomcat 6.0.29, I found ApplicationHttpRequest.setAttribute(ApplicationHttpRequest.java:278) as a recursive method call from javax.servlet.ServletRequestWrapper.setAttribute(ServletRequestWrapper.java:284).\n\nThe piece of code from ServletRequestWrapper.java looks like : \n\n public void setAttribute(String name, Object o) {\n\tthis.request.setAttribute(name, o);\n }\n\nSo in this piece of code is it necessary to do a equality check for the request object just to make sure this will never went into a recursion even though the user calls a setAttribute(name, o) on a WrappedRequest object(ServletRequestWrapper). \n\nFollowing is the Error Stack Trace : \n\njava.lang.StackOverflowError\n\tat org.apache.catalina.core.ApplicationHttpRequest.setAttribute(ApplicationHttpRequest.java:278)\n\tat org.apache.catalina.core.ApplicationHttpRequest.setAttribute(ApplicationHttpRequest.java:279)\n\tat org.apache.catalina.core.ApplicationHttpRequest.setAttribute(ApplicationHttpRequest.java:279)\n        .\n        ...repeated many times..\n        .\n        at org.apache.catalina.core.ApplicationHttpRequest.setAttribute(ApplicationHttpRequest.java:279)\n\tat org.apache.catalina.core.ApplicationHttpRequest.setAttribute(ApplicationHttpRequest.java:279)\n\tat javax.servlet.ServletRequestWrapper.setAttribute(ServletRequestWrapper.java:284)\n\tat com.kony.web.controller.KonyBaseServlet.logUserDetails(Unknown Source)\n\tat com.kony.web.controller.KonyBaseServlet.navigateToNextForm(Unknown Source)\n\tat com.kony.web.controller.KonyWebWAPController.processRequest(Unknown Source)\n\tat com.kony.web.controller.KonyWebWAPController.doPost(Unknown Source)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:637)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n        at org.apache.catalina.core.ApplicationHttpRequest.setAttribute(ApplicationHttpRequest.java:279)\n\tat javax.servlet.ServletRequestWrapper.setAttribute(ServletRequestWrapper.java:284)\n\tat com.kony.web.controller.KonyBaseServlet.logUserDetails(Unknown Source)\n\tat com.kony.web.controller.KonyBaseServlet.navigateToNextForm(Unknown Source)\n\tat com.kony.web.controller.KonyWebWAPController.processRequest(Unknown Source)\n\tat com.kony.web.controller.KonyWebWAPController.doPost(Unknown Source)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:637)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\t.\n        .Repeated many times....\n        .\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:646)\n\tat org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:436)\n\tat org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:374)\n\tat org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:302)\n\tat com.kony.web.controller.KonyBaseServlet.navigateToNextForm(Unknown Source)\n\tat com.kony.web.controller.KonyWebWAPController.processRequest(Unknown Source)\n\tat com.kony.web.controller.KonyWebWAPController.doPost(Unknown Source)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:637)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\n\nSo is this a bug , if yes is there any fix release n this and if not am I misinterpreting anything, please guide me where I am doing so."}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 144797, "time": "2011-03-07T06:30:03Z", "bug_id": 50883, "creation_time": "2011-03-07T06:30:03Z", "is_private": false, "text": "Looks like something in your app is calling setRequest() on a wrapper and passing in the wrapper rather than the request to be wrapped. The Servlet specification does not provide for throwing an exception in this case. I'll add that to my list of things to raise for the next version of the spec."}, {"count": 2, "tags": [], "bug_id": 50883, "attachment_id": null, "text": "Mark thanks for your response. \n\nI have used following kinda methods at many places in my app.\n\nprotected void logUserDetails(HttpServletRequest request){\n         request.setAttribute(\"APP_ID\", \"myappid\");\n}\n\nBut surprisingly this StackOverflowError is coming randomly around 3 times in a month and   these methods are serving fine to rest all request with out any StackOverFlowError. SO here am looking for your help to understand in which scenario this request object becoming an instance of ServletRequestWrapper and undergoing that recursion.\n\nAlso one more doubt I have, are we not suppose to call the setAttribute() and getAttribute() methods of  ServletRequestWrapper.\n\n\n(In reply to comment #1)\n> Looks like something in your app is calling setRequest() on a wrapper and\n> passing in the wrapper rather than the request to be wrapped. The Servlet\n> specification does not provide for throwing an exception in this case. I'll add\n> that to my list of things to raise for the next version of the spec.", "id": 144846, "time": "2011-03-08T22:56:33Z", "creator": "dashashishkumar@gmail.com", "creation_time": "2011-03-08T22:56:33Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 50883, "attachment_id": null, "is_private": false, "id": 144852, "time": "2011-03-09T06:04:14Z", "creator": "dashashishkumar@gmail.com", "creation_time": "2011-03-09T06:04:14Z", "text": "Also one more observation is : We never got such error before we upgraded our application from Tomcat 6.0.18 to Tomcat 6.0.29"}, {"count": 4, "tags": [], "creator": "dashashishkumar@gmail.com", "text": "Hi Mark sorry for sharing the information in multiple chunk.\n\nFrom the org.apache.catalina.core.ApplicationDispatcher.java from the invoke method is there any chance that the following lines of code may not execute and we may be getting an ServletRequestWrapper object leading to the recursion.\n\nApplicationDispatcher.java(Line No : 722 to 725)\n        // Unwrap request/response if needed\n        // See Bugzilla 30949\n        unwrapRequest(state);\n        unwrapResponse(state);\n\nThanks \nAshish", "id": 144869, "time": "2011-03-09T08:39:38Z", "bug_id": 50883, "creation_time": "2011-03-09T08:39:38Z", "is_private": false, "attachment_id": null}, {"text": "The users list is the place to seek help.", "tags": [], "bug_id": 50883, "attachment_id": null, "count": 5, "id": 144905, "time": "2011-03-10T06:06:22Z", "creator": "markt@apache.org", "creation_time": "2011-03-10T06:06:22Z", "is_private": false}]
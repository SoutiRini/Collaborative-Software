[{"count": 0, "tags": [], "creator": "kanekotky@gmail.com", "attachment_id": null, "text": "Hi,\n\nI noticed that org.apache.catalina.session.StandardSession.ACTIVITY_CHECK does\nnot work correctly because the StandardSession#accessCount will be set as -1\nwhen Tomcat is restarted and session is loaded from the SESSION.ser file.\n\nStandardManager#doLoad() calls session.endAccess() and this method execute 2 things.\n * set isNew = false\n * decrement accessCount\n\nI think isNew attribute is already set by session.readObjectData(ois) in\nStandardManager#doLoad(),\nand accessCount is already set as 0.\n\nIMHO, it is not necessary calling session.endAccess() in the doLoad().\n\nHere is a patch.\n\nIndex: /tc6.0.x/trunk/java/org/apache/catalina/session/StandardManager.java\n===================================================================\n--- /tc6.0.x/trunk/java/org/apache/catalina/session/StandardManager.java\n(revision 569774)\n+++ /tc6.0.x/trunk/java/org/apache/catalina/session/StandardManager.java\n(working copy)\n@@ -395,7 +395,6 @@\n                     session.setManager(this);\n                     sessions.put(session.getIdInternal(), session);\n                     session.activate();\n-                    session.endAccess();\n                 }\n             } catch (ClassNotFoundException e) {\n               log.error(sm.getString(\"standardManager.loading.cnfe\", e), e);", "id": 107267, "time": "2007-08-26T09:28:12Z", "bug_id": 43216, "creation_time": "2007-08-26T09:28:12Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 43216, "attachment_id": null, "id": 107343, "time": "2007-08-28T06:34:06Z", "creator": "pr@objektpark.de", "creation_time": "2007-08-28T06:34:06Z", "is_private": false, "text": "Please, check trunk I have checkin your fix. \nThanks\nPeter\n"}]
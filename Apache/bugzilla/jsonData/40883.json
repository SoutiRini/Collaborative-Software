[{"count": 0, "tags": [], "text": "I have a java client that sends file via HTTP (or /S) to apache which reverse \nproxies to a backend Tomcat Servlet.\n\nI am able to send files that are in the 5-10 gig range directly to Tomcat \nw/out issues.  Sending file just under 2 GIGs through Apache also work fine. \n\nFiles that are greater than 2 GIGs cause Apache to spike CPU up to 100%, \ntypically the error occurs just around 2GIG less 4K or 8K.\n\nThis is failing in both SSL and non SSL connections", "is_private": false, "bug_id": 40883, "id": 95380, "time": "2006-11-02T22:18:52Z", "creator": "toadie643@gmail.com", "creation_time": "2006-11-02T22:18:52Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 40883, "is_private": false, "text": "A followup question, does the 2 GIG support only run on non-Windows platform? ", "id": 95400, "time": "2006-11-03T07:19:13Z", "creator": "toadie643@gmail.com", "creation_time": "2006-11-03T07:19:13Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 40883, "is_private": false, "text": "Looks like it fails on Ubuntu as well with identical behavior", "id": 95402, "time": "2006-11-03T11:00:08Z", "creator": "toadie643@gmail.com", "creation_time": "2006-11-03T11:00:08Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "How do you sent the file? Via POST or via PUT?", "is_private": false, "bug_id": 40883, "id": 95430, "time": "2006-11-04T13:16:38Z", "creator": "rpluem@apache.org", "creation_time": "2006-11-04T13:16:38Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 40883, "text": "(In reply to comment #3)\n> How do you sent the file? Via POST or via PUT?\n\nI am using PUT but i suspect that the bug exists with POST also.  One of our\nQA guy narrowed down the bug in method stream_reqbody_cl()\n\nlooks like function atol is the offending line.  It returns 0 for values\ngreater than 2GIG.  Changing to atoll () 0seems to work\n\n    if (old_cl_val) {\n        add_cl(p, bucket_alloc, header_brigade, old_cl_val);\n        cl_val = atol(old_cl_val);   \n    }\n\n    while (!APR_BUCKET_IS_EOS(APR_BRIGADE_FIRST(input_brigade)))\n    {\n\n// more code here\n// along with function atol setting cl_val to 0, this statement keeps looping \n// in the  WHILE loop\n        if (bytes_streamed > cl_val)\n             continue;\n\n\n", "id": 95434, "time": "2006-11-04T16:27:30Z", "creator": "toadie643@gmail.com", "creation_time": "2006-11-04T16:27:30Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "toadie643@gmail.com", "is_private": false, "id": 95690, "attachment_id": null, "bug_id": 40883, "creation_time": "2006-11-11T11:41:37Z", "time": "2006-11-11T11:41:37Z", "text": "on Win32 platform, you need to change atol to _atoi64\nfor Unix based, change atol to atoll.\n\nwe have tested on both platforms and both seems to behave properly. The fix\nworks but is not portable b/c _atoi64 does not exist (?) in *nix and atoll does \nnot exist in Win32.\n\n"}, {"count": 6, "tags": [], "bug_id": 40883, "text": "Created attachment 19114\nPatch against trunk\n\nCould you please give the attached patch a try? This should be platform\nindependent.", "id": 95714, "time": "2006-11-12T03:29:07Z", "creator": "rpluem@apache.org", "creation_time": "2006-11-12T03:29:07Z", "is_private": false, "attachment_id": 19114}, {"count": 7, "tags": [], "bug_id": 40883, "is_private": false, "id": 96780, "attachment_id": null, "creator": "toadie643@gmail.com", "creation_time": "2006-12-11T17:26:43Z", "time": "2006-12-11T17:26:43Z", "text": "> Could you please give the attached patch a try? This should be platform  \n>independent.\n\nThat worked for us.  Thanks.\n\n"}, {"count": 8, "tags": [], "text": "Committed as r486320 (http://svn.apache.org/viewvc?view=rev&rev=486320).", "is_private": false, "id": 96841, "creator": "rpluem@apache.org", "time": "2006-12-12T13:23:43Z", "bug_id": 40883, "creation_time": "2006-12-12T13:23:43Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 40883, "text": "Will the patch be backported to the 2.2.x branch?\n", "id": 98380, "time": "2007-01-22T16:13:02Z", "creator": "harada@sysrdc.ns-sol.co.jp", "creation_time": "2007-01-22T16:13:02Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "trawick@apache.org", "is_private": false, "id": 98391, "attachment_id": null, "bug_id": 40883, "creation_time": "2007-01-23T05:03:40Z", "time": "2007-01-23T05:03:40Z", "text": ">Will the patch be backported to the 2.2.x branch?\nI just proposed it for backport.  Presumably it will be in a future 2.2.x\nrelease.\n"}, {"count": 11, "tags": [], "creator": "nick@webthing.com", "is_private": false, "text": "Fixed in 2.2.6.", "id": 107901, "time": "2007-09-09T08:58:59Z", "bug_id": 40883, "creation_time": "2007-09-09T08:58:59Z", "attachment_id": null}]
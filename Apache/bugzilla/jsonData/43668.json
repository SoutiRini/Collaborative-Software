[{"count": 0, "text": "This applies to both 6.x and 5.5x version !!\n\nTomcat6.x\nhttp://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk/java/org/apache/catalina/core/ApplicationDispatcher.java\n\nTomcat5.5.x\nhttp://svn.apache.org/repos/asf/tomcat/container/tc5.5.x/catalina/src/share/org/apache/catalina/core/ApplicationDispatcher.java\n\nThere is a severe always-NULL case in both T6.x and T5.5x sources if request is\nnon-HTTP forward. processRequest(req, res, state) method should use the original\n\"request\" and \"response\" objects, but it gives \"hrequest\" and \"hresponse\" objects.\n\nprivate void doForward(ServletRequest request, ServletResponse response) {\n   ...continue...\n  // Identify the HTTP-specific request and response objects (if any)\n  HttpServletRequest hrequest = null;\n  if (request instanceof HttpServletRequest)\n     hrequest = (HttpServletRequest) request;\n  HttpServletResponse hresponse = null;\n  if (response instanceof HttpServletResponse)\n     hresponse = (HttpServletResponse) response;\n\n   // Handle a non-HTTP forward by passing the existing request/response\n   if ((hrequest == null) || (hresponse == null)) {\n      processRequest(hrequest,hresponse,state);\n   }\n   ...continue...\n}\n\nCalling program gets a NPE exception when forwarding a request.\njava.lang.NullPointerException at \norg.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:459)", "bug_id": 43668, "is_private": false, "id": 109522, "time": "2007-10-21T13:16:07Z", "creator": "mailmur@yahoo.com", "creation_time": "2007-10-21T13:16:07Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 43668, "attachment_id": 21017, "id": 109528, "time": "2007-10-21T19:30:53Z", "creator": "william.barker@wilshire.com", "creation_time": "2007-10-21T19:30:53Z", "is_private": false, "text": "Created attachment 21017\nPatch against 6.0 trunk to fix this\n\nThis handles the case where the outer most wrapper is a ServletRequestWrapper,\nbut not a HttpServletRequestWrapper.  This further breaks 39417, but that one\nis invalid anyway (according to the spec)."}, {"count": 2, "tags": [], "text": "39417: ApplicationDispatcher.unwrapRequest() should not assume servletRequestWrapper\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=39417\n\nWhat do you mean, is it that a bug 39417 is even further away to be fixed?\nI made a quick test and posted a solution I used, a simple is-instanceof check\nand bail out. Fix is posted at the end of 39417 report.\n\n", "is_private": false, "id": 109551, "creation_time": "2007-10-22T06:36:09Z", "time": "2007-10-22T06:36:09Z", "creator": "mailmur@yahoo.com", "bug_id": 43668, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 43668, "text": "Fixed in the next 6.0 release with the attached patch.", "id": 109765, "time": "2007-10-25T20:10:11Z", "creator": "william.barker@wilshire.com", "creation_time": "2007-10-25T20:10:11Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 40303, "attachment_id": null, "id": 92449, "time": "2006-08-23T08:00:49Z", "creator": "thomas.reitz@wincor-nixdorf.com", "creation_time": "2006-08-23T08:00:49Z", "is_private": false, "text": "Entries in the log file do not appear in correct date and time order in \nmultithreaded environment.\n\n- configuration file log4j.properties\nlog4j.rootLogger=DEBUG, T\nlog4j.appender.T=org.apache.log4j.RollingFileAppender\nlog4j.appender.T.File=/home/proview/gateway/data/trace/PVGATEWAY.TRC\nlog4j.appender.T.MaxFileSize=10000KB\nlog4j.appender.T.MaxBackupIndex=3\nlog4j.appender.T.layout=org.apache.log4j.PatternLayout\nlog4j.appender.T.layout.ConversionPattern=%d %-5p [%-20t] %-80m          [%l]%n\n\n- parts of the log file PVGATEWAY.TRC\nEven for one thread the entries do not appear in correct date and time order.\n2006-08-23 09:41:35,715 DEBUG [ComMessageDispatcher] session: [Session-199, S   \n2006-08-23 09:41:33,597 DEBUG [ComMessageDispatcher] SerialNumber: \n1155890229                        \n2006-08-23 09:41:33,599 DEBUG [ComMessageDispatcher] SubjectDN: \nCN=XXXXXXXXXXXXXXXXX, OU=psd8, O=wn, \n2006-08-23 09:41:33,600 DEBUG [ComMessageDispatcher] TBSCertificate: \n[B@e22f2b                       \n2006-08-23 09:41:33,601 DEBUG [ComMessageDispatcher] PublicKey: SunJSSE RSA \npublic key:\n2006-08-23 09:41:35,733 DEBUG [SsopServerSocket    ] run: accepted new socket: \nSocket[addr=/AAA.18.177.DDD,port=2665,localport=18988]\n2006-08-23 09:41:35,733 DEBUG [SsopServerSocket    ] accept: accept socketSocket\n[addr=/AAA.18.177.DDD,port=2665,localport=18988]\n2006-08-23 09:41:35,734 DEBUG [SsopServerSocket    ] constructor: Socket =  \nSocket[addr=/AAA.18.177.DDD,port=2665,localport=18988]\n2006-08-23 09:41:35,734 DEBUG [SsopServerSocket    ] constructor: \ncom.YYYYYYYYYYYYY.proview.conmgr.ssop.PVAgentSsopSocket\n2006-08-23 09:41:35,735 DEBUG [SsopServerSocket    ] createSsopCient: enter\n2006-08-23 09:41:35,746 DEBUG [SsopServerSocket    ] open entered \nsocket:/AAA.18.177.DDD:2665\n2006-08-23 09:41:35,747 DEBUG [ComMessageDispatcher] host name: XXXXX239\n2006-08-23 09:41:35,748 DEBUG [ComMessageDispatcher] host ip address: \nAAA.18.62.DD\n2006-08-23 09:41:33,624 DEBUG [SsopServerSocket    ] createSsopServer: enter\n2006-08-23 09:41:33,625 DEBUG [SsopServerSocket    ] constructor: \nPVAgentSsopServer:AGMGR01EVT\n2006-08-23 09:41:33,625 DEBUG [SsopServerSocket    ] \nconstructor                    \n2006-08-23 09:41:33,626 DEBUG [SsopServerSocket    ] messageController= \ncom.YYYYYYYYYYYYY.proview.gateway.GatewaymessageConsumer\n2006-08-23 09:41:33,626 DEBUG [SsopServerSocket    ] addServiceProvider, maybe \ninvalid number: 304                              \n2006-08-23 09:41:33,627 DEBUG [SsopServerSocket    ] addServiceProvider, maybe \ninvalid number: 310                              \n2006-08-23 09:41:33,627 DEBUG [SsopServerSocket    ] addServiceProvider, maybe \ninvalid number: 301                              \n2006-08-23 09:41:33,628 DEBUG [SsopServerSocket    ] addServiceProvider, maybe \ninvalid number: 356                              \n2006-08-23 09:41:35,749 DEBUG [ComMessageDispatcher] session: [Session-200, \nSSL_RSA_WITH_RC4_128_MD5]                           \n2006-08-23 09:41:33,624 DEBUG [SocketReader        ] run \nentered                                                                \n2006-08-23 09:41:33,629 DEBUG [SsopServerSocket    ] addServiceProvider, maybe \ninvalid number: 357                              \n2006-08-23 09:41:35,757 DEBUG [ComMessageDispatcher] response to \nhttps://XXXXX239:8443/ProviewEventService/EventServlet= OK     \n2006-08-23 09:41:35,760 DEBUG [ComMessageDispatcher] addDevice: terminalId = \nATMa_00198, hostname = AAA.18.177.DDD, port = 18988\n2006-08-23 09:41:35,761 DEBUG [ComMessageDispatcher] accept: ATMa_00198      \njava.util.GregorianCalendar[time=?,areFieldsSet=fal\n2006-08-23 09:41:35,757 DEBUG [SocketReader        ] run: 107 bytes expected \nfrom :/AAA.18.177.DDD:2665                         \n2006-08-23 09:41:35,762 DEBUG [ComMessageDispatcher] write \nentered:/AAA.18.177.DDD:2659                                         \n2006-08-23 09:41:35,765 DEBUG [ComMessageDispatcher] IssuerDN: \nCN=XXXXXXXXXXXXXXXXX, OU=psd8, O=wn, L=frankfurt, ST=hessen, C=he\n2006-08-23 09:41:33,641 INFO  [ComMessageDispatcher] >>> ATMa_00198      \nUR002010701AGMGR01                             00002003\n2006-08-23 09:41:35,770 DEBUG [ComMessageDispatcher] TBSCertificate: \n[B@17cf6b6                                                 \n2006-08-23 09:41:33,647 DEBUG [ComMessageDispatcher] messageReceived: \ncom.YYYYYYYYYYYYY.proview.ssop.PvSsopMsgEnvelop@1295fe8"}, {"count": 1, "tags": [], "creator": "carnold@apache.org", "is_private": false, "text": "This is a known cosmetic defect in log4j, though I could not find a previously logged bug in a search.  \nPreviously discussed in a thread on log4j-user in late August, early Sept 2005, see http://\nmarc.theaimsgroup.com/?l=log4j-user&m=112567762307503&w=2.\n\nBasically, getting timestamp occurs in one synchronization block and output to the appender in \nanother.  There is no guarantee that the thread that got the first timestamp will be the first to be \nreleased if the thread blocks in the later block.  If the issue is significant for you, then I would \nrecommend using the \"new\" AsyncAppender (in the SVN but not in 1.2.13 or 1.3 alpha 9) with \nblocking=false.  This should minimize the potential for threads to block in a manner that would \nmisorder the timestamps.\n\nAfter much research and discussion, I'm convinced that there is no simple solution to the problem that \nwould not potentially add significant compatibility issues.  Maybe in log4j 2.0, this could be addressed.  \nBut not in log4j 1.2 or 1.3. ", "id": 92692, "time": "2006-08-29T23:31:21Z", "bug_id": 40303, "creation_time": "2006-08-29T23:31:21Z", "attachment_id": null}]
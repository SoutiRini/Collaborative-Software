[{"count": 0, "tags": [], "bug_id": 58299, "attachment_id": null, "is_private": false, "id": 184826, "time": "2015-08-28T14:09:20Z", "creator": "sebb@apache.org", "creation_time": "2015-08-28T14:09:20Z", "text": "Samplers such as HTTP can take a long time to return all the date.\n\nThere are timeout settings, but these apply to each network message, not the overall sample.\n\nOnce the sampler has completed, the duration assertion can be used to flag overlong samples, but this could take a very long time.\n\nRather than update every sampler and its GUI to support an extra timeout option, it is possible to use the Interruptible.interrupt() method in a Timer.\n\nTimers run before the sampler to which they apply, so they can schedule a future task to invoke the interrupt() method on the sampler.\nThe following is a very basic BeanShell Timer implementation:\n\n==== cut here =====\nimport java.util.concurrent.Executors;\nsampler=ctx.getCurrentSampler();\nrun=new Runnable() {\n    public void run() {\n          sampler.interrupt();\n    }\n};\ntpool = Executors.newScheduledThreadPool(1);\n// schedule the interrupt to occur in 5 seconds from now\ntpool.schedule(run, 5L, java.util.concurrent.TimeUnit.SECONDS);\nreturn 0; // don't actually wait\n===== cut here =====\n\nIt would be useful to have a built-in Timer to perform the same function."}, {"count": 1, "tags": [], "text": "URL: http://svn.apache.org/r1698393\nLog:\nAdd interrupt Timer\nBugzilla Id: 58299\n\nAdded:\n    jmeter/trunk/src/components/org/apache/jmeter/timers/InterruptTimer.java   (with props)\n    jmeter/trunk/src/components/org/apache/jmeter/timers/gui/InterruptTimerGui.java   (with props)\n    jmeter/trunk/xdocs/images/screenshots/timers/interrupt_timer.png   (with props)\nModified:\n    jmeter/trunk/bin/saveservice.properties\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages.properties\n    jmeter/trunk/xdocs/changes.xml\n    jmeter/trunk/xdocs/usermanual/component_reference.xml", "is_private": false, "bug_id": 58299, "id": 184836, "time": "2015-08-28T19:09:39Z", "creator": "sebb@apache.org", "creation_time": "2015-08-28T19:09:39Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 58299, "is_private": false, "id": 184838, "time": "2015-08-28T20:03:51Z", "creator": "milamber@apache.org", "creation_time": "2015-08-28T20:03:51Z", "tags": [], "text": "URL: http://svn.apache.org/r1698403\nLog:\nAdd French localization for the new Interrupt timer\n(and littel alphabetical ordering in the keys)\nBugzilla Id: 58299\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages_fr.properties"}, {"count": 3, "tags": [], "bug_id": 58299, "is_private": false, "text": "When I test the new Interrupt timer, I have the message on stdout:\n\nMEvent. CASE!\n\nand this on the sampler response:\n\njava.net.SocketException: Socket closed\n\tat java.net.SocketInputStream.socketRead0(Native Method)\n\tat java.net.SocketInputStream.read(SocketInputStream.java:152)\n\tat java.net.SocketInputStream.read(SocketInputStream.java:122)\n\tat sun.security.ssl.InputRecord.readFully(InputRecord.java:442)\n\tat sun.security.ssl.InputRecord.read(InputRecord.java:480)\n\tat sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:927)\n\tat sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312)\n\tat sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1339)\n\tat sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1323)\n\tat org.apache.http.conn.ssl.SSLSocketFactory.connectSocket(SSLSocketFactory.java:436)\n\tat org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:180)\n\tat org.apache.http.impl.conn.ManagedClientConnectionImpl.open(ManagedClientConnectionImpl.java:294)\n\tat org.apache.jmeter.protocol.http.sampler.MeasuringConnectionManager$MeasuredConnection.open(MeasuringConnectionManager.java:107)\n\tat org.apache.http.impl.client.DefaultRequestDirector.tryConnect(DefaultRequestDirector.java:643)\n\tat org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:479)\n\tat org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:906)\n\tat org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:805)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPHC4Impl.executeRequest(HTTPHC4Impl.java:521)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPHC4Impl.sample(HTTPHC4Impl.java:329)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:74)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.followRedirects(HTTPSamplerBase.java:1518)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.resultProcessing(HTTPSamplerBase.java:1599)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPAbstractImpl.resultProcessing(HTTPAbstractImpl.java:463)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPHC4Impl.sample(HTTPHC4Impl.java:408)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:74)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1147)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1136)\n\tat org.apache.jmeter.threads.JMeterThread.process_sampler(JMeterThread.java:434)\n\tat org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:261)\n\tat java.lang.Thread.run(Thread.java:745)\n\n\nNone to think that is the Interrupt timer in action? Normal?", "id": 184839, "time": "2015-08-28T20:06:45Z", "creator": "milamber@apache.org", "creation_time": "2015-08-28T20:06:45Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 58299, "attachment_id": null, "is_private": false, "id": 184842, "time": "2015-08-29T11:49:03Z", "creator": "sebb@apache.org", "creation_time": "2015-08-29T11:49:03Z", "text": "I do not see the same problem.\nHowever running as non-GUI did show that the executor threads need to be daemon\n\nURL: http://svn.apache.org/r1698462\nLog:\nAdd interrupt Timer\nEnsure threads are created as daemons\nAdd some extra debug info\nBugzilla Id: 58299\n\nModified:\n    jmeter/trunk/src/components/org/apache/jmeter/timers/InterruptTimer.java\n\nCan you provide a sample JMX that shows the issue?"}, {"count": 5, "tags": [], "bug_id": 58299, "attachment_id": 33053, "is_private": false, "id": 184844, "time": "2015-08-29T12:59:34Z", "creator": "milamber@apache.org", "creation_time": "2015-08-29T12:59:34Z", "text": "Created attachment 33053\nSample Test case\n\nHere the sample test"}, {"count": 6, "attachment_id": null, "bug_id": 58299, "is_private": false, "id": 184845, "time": "2015-08-29T13:50:32Z", "creator": "sebb@apache.org", "creation_time": "2015-08-29T13:50:32Z", "tags": [], "text": "I see what you mean now; the response does contain the stack trace.\nYes, that is expected when the request is aborted.\n\nThe same would happen when stopping the test.\n\nBTW OpenJDK reports \"MEvent. CASE!\" sometimes:\nhttps://bugs.debian.org/cgi-bin/bugreport.cgi?bug=679036\n\nThere is a minor problem with the implementation: if the timeout is set too short, it may fail to cancel the first HTTP sample. That is because the sampler can take a while to initialise itself. The timer can expire before the sample itself is started, so interrupt() does nothing.\n\nA work-round is to add a dummy HTTP request (without timeout) in a setUp group to do the init.\n\nHandling one-off init is probably best addressed in a separate issue, as it would be better if the first sample time were more accurate."}, {"count": 7, "tags": [], "bug_id": 58299, "text": "Work on this was moved to a separate branch.\nThe code was reworked to use a Pre-Processor instead.\nSee Bug 58736", "id": 186948, "time": "2015-12-14T20:41:54Z", "creator": "sebb@apache.org", "creation_time": "2015-12-14T20:41:54Z", "is_private": false, "attachment_id": null}]
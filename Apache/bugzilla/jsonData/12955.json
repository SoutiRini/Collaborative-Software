[{"count": 0, "attachment_id": null, "bug_id": 12955, "text": "Hi,\nwith a selfmade patch to jmeter's DefaultKeyStore I finally have \nsuccess to use jmeter on a SSL Site with ClientCert-Authentication. Wow !!\n\nI used JDK1.4.0\n\nhere's the bugfix in org/apache/jmeter/util/keystore/DefaultKeyStore.java\n\npublic void load(InputStream is, String pword)\n    throws Exception {\n        store.load(is, pword.toCharArray());\n        PrivateKey key = null;\n        X509Certificate[] certChain = null;\n        \n        Enumeration aliases = store.aliases(); \n        while (aliases.hasMoreElements()) \n        {\n            //I have added this line\n            this.alias = (String) aliases.nextElement(); // <---- this is new \n            if (store.isKeyEntry(alias)) \n            {\n                key = (PrivateKey) store.getKey(alias, pword.toCharArray());\n                Certificate[] chain = store.getCertificateChain(alias);\n                certChain = new X509Certificate[chain.length];\n\n// I have removed this line\n//                this.alias = (String) aliases.nextElement();\n\n                for (int i = 0; i < chain.length; i++) {\n                    certChain[i] = (X509Certificate) chain[i];\n                }\n                break;\n            }\n        }\n\n\nIt was quite hard to find that bug, it was a nullpointer exception,\nbecause in org/apache/jmeter/util/SSLManager at getKeyStore()\nit catches all exceptions made by the DefaultKeyStore \nbut does not log it. I would suggest log that exceptions.\n\n            try {\n                File initStore = new File(fileName);\n\n                if (initStore.exists()) {\n                    try {\n                        this.keyStore.load(new FileInputStream(initStore), \npassword);\n                    } catch (Exception e) {\n                        throw new RuntimeException(\"Can't load KeyStore!!!  \" + \ne.getMessage());\n                    }\n                } else {\n                    this.keyStore.load(null, password);\n                }\n            } catch (Exception e) {\n\n//<<--- !! this two lines are new !!!\n               System.out.println(\"error while loading:\"+e);\n               e.printStackTrace();\n            }\n\nthe same thing where it loads the trustedcerts at getTrustStore().\n\nThank you very much for your great work, I love this piece of software.\n\nDan", "id": 23303, "time": "2002-09-24T12:42:41Z", "creator": "daniel.giebener@helaba.de", "creation_time": "2002-09-24T12:42:41Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 12955, "text": "I've applied this patch into CVS, only throwing a RuntimeException instead of\nlogging to System.out. Maybe regular error logging would be better, but since\nit's most likely a critical error...", "id": 28297, "time": "2002-12-27T13:48:11Z", "creator": "jsalvata@atg.com", "creation_time": "2002-12-27T13:48:11Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 12955, "attachment_id": null, "text": "Why didn't I RESOLVE this when I did the changes?", "id": 29171, "time": "2003-01-11T00:57:25Z", "creator": "jsalvata@atg.com", "creation_time": "2003-01-11T00:57:25Z", "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 12955, "text": "Bulk-editing to close all bugs reported fixed by 1.8.1.", "id": 32833, "time": "2003-03-10T09:40:50Z", "creator": "jsalvata@atg.com", "creation_time": "2003-03-10T09:40:50Z", "tags": [], "is_private": false}]
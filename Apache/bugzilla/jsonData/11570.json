[{"text": "Overview Description:\n\nWhen calling log.error(null), a NullPointerException is thrown.  See the stack\ntrace below.\n\nOf course, I wasn't calling log.error(null) in my code.  Rather, I was logging\nan exception message as such:  \n   log.error(e.getMessage())  <-- triggered exception\nBut the exception message was null so log4j threw an NullPointerException.\n\nSteps to Reproduce:\n1. Setup the following XML Appender section in your log4j.properties file.\n######## XML SECTION ##################\n# XML is a RollingFileAppender \n#######################################\nlog4j.appender.XML=org.apache.log4j.RollingFileAppender\nlog4j.appender.XML.file=${base-path}logs/mgr_log.xml\nlog4j.appender.XML.MaxFileSize=20MB\nlog4j.appender.XML.MaxBackupIndex=5\nlog4j.appender.XML.layout=org.apache.log4j.xml.XMLLayout\nlog4j.appender.XML.append=true\n\n2. Create a class with the following line:\n   log.error(null)\n\n3. Or use the following try/catch block\n   try {\n       throw new Exception();\n   }\n   catch (Exception e) {\n       log.error(e, e);              // works as expected\n       log.error(\"bug found\", e);    // works as expected\n       log.error(e.getMessage());    // throws NullPointerException\n       log.error(e.getMessage(), e); // throws NullPointerException\n   }\n\n\nActual Results:\nA NullPointerException is thrown as represented in the following stack trace:\n\n######### Stack Trace ###############\njava.lang.NullPointerException\n at org.apache.log4j.helpers.Transform.appendEscapingCDATA(Transform.java:74)\n at org.apache.log4j.xml.XMLLayout.format(Unknown Source)\n at org.apache.log4j.WriterAppender.subAppend(WriterAppender.java:292)\n at org.apache.log4j.RollingFileAppender.subAppend(RollingFileAppender.java:225)\n at org.apache.log4j.WriterAppender.append(WriterAppender.java:150)\n at org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:221)\nat\norg.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:57)\n at org.apache.log4j.Category.callAppenders(Category.java:187)\n at org.apache.log4j.Category.forcedLog(Category.java:372)\n at org.apache.log4j.Category.error(Category.java:286)\n at com.bluearc.mgr.screens.Index.doThroughput(Index.java:253)\n\n\nExpected Results:\nAn XML formatted message should have been logged to mgr_log.xml with an empty\nCDATA section.  Similar to:\n<log4j:message>![CDATA[]]</log4j:message>\nor\n<log4j:message></log4j:message>\n\n\nBuild & Platform:\nbuild: Log4j version 1.2.5 (release ver)\nplatform: RedHat 7.2 & Windows 2000 with JDK 1.3.1_02\n\n\nAdditional Builds and Platforms:\n - Occurs On\n        Log4j version 1.2.6\n\n\nAdditional Information:\n - xerces1_4_4.jar and xalan-j_2_4_D1.jar in classpath.", "tags": [], "bug_id": 11570, "attachment_id": null, "count": 0, "id": 20816, "time": "2002-08-08T20:24:30Z", "creator": "dvandegrift@bluearc.com", "creation_time": "2002-08-08T20:24:30Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 11570, "attachment_id": 2991, "text": "Created attachment 2991\nHere is a simple patch to log the string \"null\" instead of throwing a java.lang.NullPointerException", "id": 22597, "time": "2002-09-10T14:21:34Z", "creator": "nhb_web@nexgo.de", "creation_time": "2002-09-10T14:21:34Z", "is_private": false}, {"count": 2, "tags": [], "creator": "ceki@apache.org", "attachment_id": null, "id": 31531, "time": "2003-02-18T16:45:19Z", "bug_id": 11570, "creation_time": "2003-02-18T16:45:19Z", "is_private": false, "text": "\nFixed in 1.2.8. A null string will be returned as \"\", (the empty string)."}, {"count": 3, "tags": [], "creator": "ceki@apache.org", "text": "*** Bug 16170 has been marked as a duplicate of this bug. ***", "id": 31533, "time": "2003-02-18T16:46:06Z", "bug_id": 11570, "creation_time": "2003-02-18T16:46:06Z", "is_private": false, "attachment_id": null}]
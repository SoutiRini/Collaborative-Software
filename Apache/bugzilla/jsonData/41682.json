[{"count": 0, "tags": [], "creator": "gjohnson@alpineaccess.com", "text": "(Still happening in 6.0.9, though that isn't an option in Bugzilla)\n\nIf I use the BackupManager for session replication AND turn on debug logging, I\nget this exception when I try to invalidate the session:\n\njava.lang.ClassCastException: org.apache.catalina.ha.session.BackupManager\ncannot be cast to org.apache.catalina.ha.session.DeltaManager\n\tat org.apache.catalina.ha.session.DeltaSession.expire(DeltaSession.java:361)\n\tat org.apache.catalina.ha.session.DeltaSession.expire(DeltaSession.java:352)\n\tat org.apache.catalina.session.StandardSession.expire(StandardSession.java:660)\n\tat\norg.apache.catalina.session.StandardSession.invalidate(StandardSession.java:1112)\n\tat\norg.apache.catalina.session.StandardSessionFacade.invalidate(StandardSessionFacade.java:150)\n\nThe bug is easy to find in the source.  If debug logging is enabled, it tries to\ncast manager to DeltaManager without an instanceof, even though it is doing an\ninstanceof immediately after:\n\n    public void expire(boolean notify, boolean notifyCluster) {\n        String expiredId = getIdInternal();\n        super.expire(notify);\n\n        if (notifyCluster) {\n            if (log.isDebugEnabled())\n                log.debug(sm.getString(\"deltaSession.notifying\",\n                                       ((DeltaManager)manager).getName(),\n                                       new Boolean(isPrimarySession()),\n                                       expiredId));\n            if ( manager instanceof DeltaManager ) {\n                ( (DeltaManager) manager).sessionExpired(expiredId);\n            }\n        }\n    }", "id": 99698, "time": "2007-02-22T13:05:50Z", "bug_id": 41682, "creation_time": "2007-02-22T13:05:50Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 41682, "text": "Thanks for the report", "id": 101007, "time": "2007-03-26T23:52:24Z", "creator": "fhanik@apache.org", "creation_time": "2007-03-26T23:52:24Z", "is_private": false, "attachment_id": null}]
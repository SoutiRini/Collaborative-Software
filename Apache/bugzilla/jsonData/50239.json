[{"attachment_id": null, "tags": [], "bug_id": 50239, "is_private": false, "count": 0, "id": 141561, "time": "2010-11-09T06:41:17Z", "creator": "jordan@ffm-one.com", "creation_time": "2010-11-09T06:41:17Z", "text": "Hi,\n\nI got an excel file which I want to open:\n\nFileInputStream inxls = new FileInputStream(\"file.xls\");\nHSSFWorkbook wb = new HSSFWorkbook(inxls);\n\nThis throws an exception\n\nWarning, incorrectly terminated empty data blocks in POIFS block listing (should end at -2, ended at 0)\nWarning, incorrectly terminated empty data blocks in POIFS block listing (should end at -2, ended at 0)\norg.apache.poi.hssf.OldExcelFormatException: The supplied spreadsheet seems to be Excel 5.0/7.0 (BIFF5) format. POI only supports BIFF8 format (from Excel versions 97/2000/XP/2003)\n\nWhen I take the XLVersionFromFile program from MS http://support.microsoft.com/kb/178605 I get:\n\nThe Excel Version is 8\n\nI checked with 3.7 and 3.6.\n\nWhat is wrong ?\n\nRegards\nVolker Jordan"}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 141562, "time": "2010-11-09T07:02:55Z", "bug_id": 50239, "creation_time": "2010-11-09T07:02:55Z", "is_private": false, "text": "Short term, try loading the file in excel and doing save-as - that'll hopefully fix the file up so whatever's confusing about it goes away\n\nLonger term, could you please upload the file to this bugzilla entry so we can take a look and see what's unusual about it?"}, {"count": 2, "attachment_id": null, "creator": "jordan@ffm-one.com", "is_private": false, "id": 141563, "time": "2010-11-09T07:16:49Z", "bug_id": 50239, "creation_time": "2010-11-09T07:16:49Z", "tags": [], "text": "Hi Nick,\n\nI already opened and saved the file in excel and the error goes away.\n\nAs I work on an automated process without any manual intervention this is not an option for a long term fix.\n\nI cannot upload the file because it contains sensible data. Would it help to provide you with some file headers in hex ?\n\nRegards\nVolker"}, {"count": 3, "tags": [], "bug_id": 50239, "attachment_id": null, "text": "Hmm, without the file it may be tough\n\nCould you please send the output of running org.apache.poi.poifs.dev.POIFSLister against the file?\n\nAlso, where did the file come from? Was it produced by Excel (if so which version), or has it come from some third party system (eg a scientific instrument, a report package etc)", "id": 141564, "time": "2010-11-09T07:26:19Z", "creator": "apache@gagravarr.org", "creation_time": "2010-11-09T07:26:19Z", "is_private": false}, {"count": 4, "attachment_id": null, "creator": "jordan@ffm-one.com", "text": "(In reply to comment #3)\n> Could you please send the output of running\n> org.apache.poi.poifs.dev.POIFSLister against the file?\n\nHi Nick,\n\nI ran the original and the resaved excel file against POIFSLister:\n\nold file:\nRoot Entry -\nWarning, incorrectly terminated empty data blocks in POIFS block listing (should end at -2, ended at 0)\n  Book [7914 / 0x1eea]\n\nnew file:\nRoot Entry -\n  CompObj <(0x01)CompObj> [114 / 0x72]\nWarning, incorrectly terminated empty data blocks in POIFS block listing (should end at -2, ended at 0)\n  DocumentSummaryInformation <(0x05)DocumentSummaryInformation> [224 / 0xe0]\n  SummaryInformation <(0x05)SummaryInformation> [200 / 0xc8]\n  Workbook [18365 / 0x47bd]\n\nConcerning the producer of the excel file, I will come back to you later.\n\nRegards\nVolker", "id": 141565, "time": "2010-11-09T08:08:38Z", "bug_id": 50239, "creation_time": "2010-11-09T08:08:38Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": 26518, "creator": "stormbringer@mail.com", "is_private": false, "id": 143477, "time": "2011-01-19T11:53:38Z", "bug_id": 50239, "creation_time": "2011-01-19T11:53:38Z", "tags": [], "text": "Created attachment 26518\nGenerated file that's mistaken for biff5\n\nHere's file I generated with POI 3.6. I cannot read it with the same version of poi (says it's BIFF5 format, although it's not).\nCheers"}, {"count": 6, "tags": [], "bug_id": 50239, "is_private": false, "text": "(In reply to comment #5)\n> Here's file I generated with POI 3.6. I cannot read it with the same version of\n> poi (says it's BIFF5 format, although it's not).\n\nThe uploaded file doesn't have a \"Workbook\" entry, instead it only has a \"Book\" entry\n\nWhat's more, I'm fairly sure that the file isn't an Excel 97+ file. When I rename the POIFS directory entry from Book to Workbook, HSSF complains because many of the records don't have enough data. This all makes me think that the file really is an older one as POI claims.", "id": 143497, "time": "2011-01-20T10:16:11Z", "creator": "apache@gagravarr.org", "creation_time": "2011-01-20T10:16:11Z", "attachment_id": null}, {"count": 7, "attachment_id": null, "creator": "stormbringer@mail.com", "text": "This is not a file I created with excel but using poi to export the data from my app. Can POI create a biff5 file at all? What am I doing wrong to make it go out as a biff5?\n\nHere's a piece of the code I'm using\n\nHSSFWorkbook wb = new HSSFWorkbook();\nfileOut = new FileOutputStream(tempFile);\nHSSFSheet sheet = wb.createSheet(\"Sheet1\");\n...\nwrite data, formats and palettes to the sheet\n...\nwb.write(fileOut);\nfileOut.close();\n\nThanks,\nBane", "id": 143499, "time": "2011-01-20T10:47:49Z", "bug_id": 50239, "creation_time": "2011-01-20T10:47:49Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 143502, "time": "2011-01-20T10:58:28Z", "bug_id": 50239, "creation_time": "2011-01-20T10:58:28Z", "is_private": false, "text": "(In reply to comment #7)\n> This is not a file I created with excel but using poi to export the data from\n> my app. Can POI create a biff5 file at all? What am I doing wrong to make it go\n> out as a biff5?\n\nPOI can't generate a biff5 file. I've no idea what you're doing, as I'm fairly sure that POI won't generate a file like the one you uploaded...\n\nNick"}, {"count": 9, "tags": [], "bug_id": 50239, "text": "When I open up the attached file in Mac Excel 2011, the file is reported as an \"Excel 5.0 / 95 Workbook\".\n\nPerhaps the OP copied the file out of an app using POIFS?\n\nRegards,\nDave", "id": 143503, "time": "2011-01-20T11:16:52Z", "creator": "dfisher@jmlafferty.com", "creation_time": "2011-01-20T11:16:52Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "text": "(In reply to comment #9)\n> When I open up the attached file in Mac Excel 2011, the file is reported as an\n> \"Excel 5.0 / 95 Workbook\".\n> \n> Perhaps the OP copied the file out of an app using POIFS?\n> \n> Regards,\n> Dave\n\nI used POI to generate that file, without even having the excel running. The\nproblem is in writing, not necessarily reading. I'll try extract the smallest\npiece code that produces biff5 and attach it.", "is_private": false, "id": 143504, "creator": "stormbringer@mail.com", "time": "2011-01-20T11:20:49Z", "bug_id": 50239, "creation_time": "2011-01-20T11:20:49Z", "attachment_id": null}]
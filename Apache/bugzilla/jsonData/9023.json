[{"count": 0, "text": "The Tomcat Servlet Container does not convert the roles, which where specified \nin the Element <security-role-ref>.\nThe following test szenario could be used to detect the error.\n\n1.) insert the JSP test.jsp in an web-archive\n2.) modify the deployment descriptor as shown\n3.) start the tomcat server\n4.) request the JSP and login as tomcat/tomcat or both/tomcat. The output is \nalways false for the method isUserInrole.\n\n\n----------------------------------------------------------------------------\nJSP Testfile: 'test.jsp'\n----------------------------------------------------------------------------\n<html>\n  <head>\n    <title>test</title>\n  </head>\n  <body>\n    <p>\n      User is in referenced roleAlias1? \n      <%= request.isUserInRole(\"roleAlias1\") %>\n    </p>\n    <p>\n      User is in referenced roleAlias2? \n      <%= request.isUserInRole(\"roleAlias2\") %>\n    </p>\n  </body>\n</html>\n\n\n-----------------------------------------------------------------------------\nWEB.XML:\n-----------------------------------------------------------------------------\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE web-app PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application \n2.3//EN\" \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n<web-app>\n  <servlet>\n    <servlet-name>RoleReference</servlet-name>\n    <jsp-file>/test.jsp</jsp-file>\n    <security-role-ref>\n      <role-name>roleAlias1</role-name>\n      <role-link>role1</role-link>\n    </security-role-ref>\n    <security-role-ref>\n      <role-name>roleAlias2</role-name>\n      <role-link>tomcat</role-link>\n    </security-role-ref>\n  </servlet>\n  <security-constraint>\n    <display-name>test</display-name>\n    <web-resource-collection>\n      <web-resource-name>Collection1</web-resource-name>\n      <url-pattern>/test.jsp</url-pattern>\n    </web-resource-collection>\n    <auth-constraint>\n      <role-name>tomcat</role-name>\n    </auth-constraint>\n    <user-data-constraint>\n      <transport-guarantee>NONE</transport-guarantee>\n    </user-data-constraint>\n  </security-constraint>\n  <login-config>\n    <auth-method>BASIC</auth-method>\n    <realm-name>default</realm-name>\n  </login-config>\n  <security-role>\n    <role-name>role1</role-name>\n  </security-role>\n  <security-role>\n    <role-name>tomcat</role-name>\n  </security-role>\n</web-app>", "bug_id": 9023, "is_private": false, "id": 15993, "time": "2002-05-13T09:29:14Z", "creator": "markus.ide@ejbguru.de", "creation_time": "2002-05-13T09:29:14Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 9023, "attachment_id": null, "id": 16046, "time": "2002-05-14T01:03:55Z", "creator": "remm@apache.org", "creation_time": "2002-05-14T01:03:55Z", "is_private": false, "text": "There is no servlet-mapping in your web.xml for the JSP page, so the request\nactually goes to the default Jasper wrapper, which doesn't have the role links\ndefined.\n\nBug 9027 likely has the same root cause (web.xml has the same problem).\n\nUsing this for the web.xml works:\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n\n<!DOCTYPE web-app\n    PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n    \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n\n<web-app>\n<servlet>\n<servlet-name>RoleReference</servlet-name>\n<jsp-file>/test.jsp</jsp-file>\n<security-role-ref>\n<role-name>roleAlias1</role-name>\n<role-link>role1</role-link>\n</security-role-ref>\n<security-role-ref>\n<role-name>roleAlias2</role-name>\n<role-link>tomcat</role-link>\n</security-role-ref>\n</servlet>\n<servlet-mapping>\n<servlet-name>\nRoleReference\n</servlet-name>\n<url-pattern>\n/test\n</url-pattern>\n</servlet-mapping>\n<security-constraint>\n<display-name>test</display-name>\n<web-resource-collection>\n<web-resource-name>Collection1</web-resource-name>\n<url-pattern>/test</url-pattern>\n</web-resource-collection>\n<auth-constraint>\n<role-name>tomcat</role-name>\n</auth-constraint>\n<user-data-constraint>\n<transport-guarantee>NONE</transport-guarantee>\n</user-data-constraint>\n</security-constraint>\n<login-config>\n<auth-method>BASIC</auth-method>\n<realm-name>default</realm-name>\n</login-config>\n<security-role>\n<role-name>role1</role-name>\n</security-role>\n<security-role>\n<role-name>tomcat</role-name>\n</security-role>\n</web-app>\n"}, {"attachment_id": null, "tags": [], "creator": "remm@apache.org", "text": "*** Bug 9027 has been marked as a duplicate of this bug. ***", "count": 2, "id": 16048, "time": "2002-05-14T01:04:09Z", "bug_id": 9023, "creation_time": "2002-05-14T01:04:09Z", "is_private": false}]
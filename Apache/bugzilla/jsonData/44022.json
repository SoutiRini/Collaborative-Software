[{"count": 0, "attachment_id": null, "creator": "Jaroslav.Bachorik@sun.com", "text": "Steps to reproduce:\n1. Open the forEachTestPlan.jmx demo plan\n2. Run it few times\n3. Close the test plan\n\nResult:\nIf you take a heap dump and analyze it in a tool (jhat eg.) you can see there\nare HttpSampleResult objects dangling. \n\nI've analyzed the situation and there are at least 2 causes:\n1. nodesToGui map in the GuiPackage class - this needs to be properly cleaned up\nonce the test plan is closed\n2. also a ViewResultsFullVisualizer instance containing HttpSampleResults\nobjects is kept alive by the reference from the ResultCollector.listener field\n\nI tried to come up with an easy fix but especially the cause nr.2 is tightly\nconnected to the jmeter architecture so it'd be better if someone with deeper\nunderstanding of it would take a look at this issue", "id": 111435, "time": "2007-12-04T16:35:55Z", "bug_id": 44022, "creation_time": "2007-12-04T16:35:55Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 44022, "text": "Created attachment 21231\nShould fix memory leak when closing test plans\n\nPlz, review the patch whether it doesn't affect other functionality", "id": 111440, "attachment_id": 21231, "creator": "Jaroslav.Bachorik@sun.com", "creation_time": "2007-12-05T02:12:13Z", "time": "2007-12-05T02:12:13Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 44022, "attachment_id": null, "id": 111446, "time": "2007-12-05T03:53:18Z", "creator": "sebb@apache.org", "creation_time": "2007-12-05T03:53:18Z", "is_private": false, "text": "Thanks very much - the patch looks good.\n{I like the way you moved the clearTestPlan() call into GuiPackage. Neat.)"}, {"count": 3, "tags": [], "creator": "sebb@apache.org", "text": "Unit testing shows a problem with the AbstractListener patch - clone() causes \nan NPE. \nHowever, that is easy to fix, just use:\n   clone.listener=this.listener;\ninstead of:\n   clone.setListener(getVisualizer());\n\n[clone() should probably have been coded that way originally.]\nI'll try some more tests and apply the patch if all goes well.", "id": 111447, "time": "2007-12-05T04:09:17Z", "bug_id": 44022, "creation_time": "2007-12-05T04:09:17Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 44022, "attachment_id": null, "text": "Seems to work OK, so added to SVN in r601473.\n\nHad to make one more change, as the listener may not be present:\n\n    protected final Visualizer getVisualizer() {\n        if (listener == null){ // e.g. in non-GUI mode\n                return null;\n        }\n        return (Visualizer)listener.get();\n", "id": 111455, "time": "2007-12-05T11:22:51Z", "creator": "sebb@apache.org", "creation_time": "2007-12-05T11:22:51Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "sherod@pillardata.com", "text": "Hello, \n \nThis is really a libc bug, but since it gets called often in the worker  \nmodule,  I thought I would pass it on.  \n  \nI am seeing a 192 byte memory leak when running agaist libc-2.2.5 on Linux  \n(RedHat 7.3 to be exact) whenever initgroups() is called.  This happens in  \nmod_worker whenever a connection is made.  I'll also send off a note to the  \nlibc maintainers.  As a side note, the comment in support/suexec.c starting at  \nline 97 is no longer true with QNX 6.2.   initgroups() is supported and in  \nfact does not leak.  \n  \nThe path to the leak is below and I've also checked it with a tight loop \nrunning while(true).  \n  \n==29174== 192 bytes in 2 blocks are definitely lost in loss record 60 of 70  \n==29174==    at 0x40044851: calloc (vg_clientfuncs.c:239)  \n==29174==    by 0x41598A5A: __yp_bind (in /lib/libnsl-2.2.5.so)  \n==29174==    by 0x415996A0: yp_all (in /lib/libnsl-2.2.5.so)  \n==29174==    by 0x41FFC8CD: _nss_nis_initgroups_dyn (in  \n/lib/libnss_nis-2.2.5.so)  \n==29174==    by 0x420B24EE: (within /lib/i686/libc-2.2.5.so)  \n==29174==    by 0x420B26C8: (within /lib/i686/libc-2.2.5.so)  \n==29174==    by 0x806FF17: set_group_privs (unixd.c:142)  \n==29174==    by 0x806FF66: unixd_setup_child (unixd.c:156)  \n==29174==    by 0x8058D6D: child_main (worker.c:1210)  \n==29174==    by 0x8059057: make_child (worker.c:1393)  \n==29174==    by 0x80593FA: perform_idle_server_maintenance (worker.c:1551)  \n==29174==    by 0x80595D5: server_main_loop (worker.c:1646)  \n==29174==    by 0x8059824: ap_mpm_run (worker.c:1745)  \n==29174==    by 0x805F1C7: main (main.c:651)  \n \nScott", "id": 32100, "time": "2003-02-27T16:35:15Z", "bug_id": 17500, "creation_time": "2003-02-27T16:35:15Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 17500, "is_private": false, "id": 32101, "time": "2003-02-27T16:42:58Z", "creator": "trawick@apache.org", "creation_time": "2003-02-27T16:42:58Z", "tags": [], "text": "the callback you show is run once ever per Apache child process, so I don't see\nhow Apache is negatively affected by the 176 bytes lost by calling initgroups()\n\nare there other calls to initgroups()?\n\nby the way, is this only a problem in nis/yp environment?\n"}, {"count": 2, "attachment_id": null, "bug_id": 17500, "text": " I'm not making a lot of hits against httpd with my tests, for example last \ntime I saw valgrind report the leak 17 times with basically that number of \nconnections.  My httpd.conf file contains: \n \n<IfModule worker.c> \nStartServers         1 \nMaxClients         150 \nMinSpareThreads     25 \nMaxSpareThreads     75 \nThreadsPerChild     25 \nMaxRequestsPerChild  0 \n</IfModule> \n \nLooks like perchild might also call initgroups, but I'm not using that.  My \nonly call is along the path mentioned. \n \nI've not tested anything but with nis/yp on Linux.  I don't have anything like \nvalgrind on QNX; there I merely checked initgroups() in a tight loop. \n ", "id": 32102, "time": "2003-02-27T17:05:11Z", "creator": "sherod@pillardata.com", "creation_time": "2003-02-27T17:05:11Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "creator": "slive@apache.org", "text": "I don't really see an apache bug here, but thanks for the report.", "id": 37754, "time": "2003-05-24T18:11:15Z", "bug_id": 17500, "creation_time": "2003-05-24T18:11:15Z", "tags": [], "is_private": false}]
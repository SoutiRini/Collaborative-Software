[{"count": 0, "tags": [], "bug_id": 60806, "text": "Environment:\n  Apache Tomcat 8.5.11\n  OpenJDK Runtime Environment (build 1.8.0_121-b13)\n  Centos 7.3 (64 bit)\n\nI have a two node Tomcat cluster (server1 & server2) with an Apache load balancer.\n\nContext replication is enabled with:\n    <Context className=\"org.apache.catalina.ha.context.ReplicatedContext\"/>\nin META-INF/context.xml, and\n    <distributable/>\nin WEB-INF/web.xml.\n\nWhen I place an object in the server1 ServletContext I see the following error on server2:\n\n02-Mar-2017 11:31:28.088 SEVERE\n[Tribes-Task-Receiver[Catalina-Channel]-3]\norg.apache.catalina.tribes.tipis.AbstractReplicatedMap.messageReceived\nUnable to deserialize MapMessage.\n java.lang.ClassNotFoundException: com.pharmhos.merlin.jaas.AdUser\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:381)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Class.java:348)\n        at java.io.ObjectInputStream.resolveClass(ObjectInputStream.java:677)\n        at org.apache.catalina.tribes.io.ReplicationStream.resolveClass(ReplicationStream.java:79)\n        at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1819)\n        at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1713)\n        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1986)\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1535)\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:422)\n        at org.apache.catalina.tribes.io.XByteBuffer.deserialize(XByteBuffer.java:558)\n        at org.apache.catalina.tribes.tipis.AbstractReplicatedMap$MapMessage.value(AbstractReplicatedMap.java:1504)\n        at org.apache.catalina.tribes.tipis.AbstractReplicatedMap$MapMessage.deserialize(AbstractReplicatedMap.java:1462)\n        at org.apache.catalina.tribes.tipis.AbstractReplicatedMap.messageReceived(AbstractReplicatedMap.java:649)\n        at org.apache.catalina.tribes.group.GroupChannel.messageReceived(GroupChannel.java:300)\n        at org.apache.catalina.tribes.group.ChannelInterceptorBase.messageReceived(ChannelInterceptorBase.java:83)\n        at org.apache.catalina.tribes.group.ChannelInterceptorBase.messageReceived(ChannelInterceptorBase.java:83)\n        at org.apache.catalina.tribes.group.interceptors.TcpFailureDetector.messageReceived(TcpFailureDetector.java:116)\n        at org.apache.catalina.tribes.group.ChannelInterceptorBase.messageReceived(ChannelInterceptorBase.java:83)\n        at org.apache.catalina.tribes.group.ChannelCoordinator.messageReceived(ChannelCoordinator.java:276)\n        at org.apache.catalina.tribes.transport.ReceiverBase.messageDataReceived(ReceiverBase.java:244)\n        at org.apache.catalina.tribes.transport.nio.NioReplicationTask.drainChannel(NioReplicationTask.java:213)\n        at org.apache.catalina.tribes.transport.nio.NioReplicationTask.run(NioReplicationTask.java:101)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n\nIt appears that my AdUser object is being serialized on server1 but is not being deserialized on server2.\n\nThe \"AdUser\" class exists within the web application under WEB-INF/classes but it looks like the org.apache.catalina.tribes.io.ReplicationStream is not finding the right class loader for the web app.\n\nAccording to <kfujino@apache.org>:\n> This seems to ReplicatedContext's bug.\n> In the current code, the class loader is passed to ReplicationMap as Null.\n> It is necessary to call super.startInternal() before initializing the ReplicationMap.", "id": 197401, "time": "2017-03-02T20:13:30Z", "creator": "asgillett@gmail.com", "creation_time": "2017-03-02T20:13:30Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "The fix will be in :\n- 9.0.x for 9.0.0.M18 onwards\n- 8.5.x for 8.5.12 onwards\n- 8.0.x for 8.0.42 onwards\n- 7.0.x for 7.0.76 onwards", "attachment_id": null, "bug_id": 60806, "id": 197469, "time": "2017-03-06T08:52:58Z", "creator": "kfujino@apache.org", "creation_time": "2017-03-06T08:52:58Z", "is_private": false}]
[{"count": 0, "text": "Greetings,\n\nI use a \"multipart\" form to upload files.\nBut if I upload files bigger than ~64Ko, the uploaded file seems to be \ntruncated.\n\nBelow are my code source :\n\n1. JSP sending the files:\n\n<html>\n\n<head>\n\n<script>\nfunction onUploadFile()\n{\n\tvar nodeForm = document.getElementById(\"UploadForm\");\n\n\tnodeForm.submit();\n}\n\n</script>\n\n</head>\n\n<body>\n\n<form id=UploadForm value=\"\" name=UploadForm method=POST \nenctype=\"multipart/form-data\" action=\"receive.jsp\" target=\"temp\" \nonsubmit=\"return false;\">\n\t<table>\n\t\t<tr>\n\t\t<td><input type=file id='SourceFile' maxlength=2097152 \nname='ImportFile' style=\"width:500px\"></td>\n\t\t<td><button id='UploadButton' type=button onclick=\"onUploadFile\n();\">Send</button></td>\n\t\t</tr>\t\n\t</table>\n\t<input type=hidden name=Preview value=false>\n\t</form>\n\n\t<iframe name=\"temp\" style=\"width:500px;height:300px\">\n\t</iframe>\n\t\n\n</body>\n</html>\n\n\n2. JSP receving the files:\n\n<%@page import=\"java.io.*\"%>\n<%@page import=\"java.util.*\"%>\n\n\n<%\n\nInputStream inputStream = request.getInputStream();\n\nByteArrayOutputStream bos = new ByteArrayOutputStream(8164);\nbyte[] byteBuf = new byte[8164];\n\nint len = 0;\nint totalLength = 0;\n\ntry\n{\n\twhile ((len = inputStream.read(byteBuf,0,8164)) != -1)\n\t{\n\t\tbos.write(byteBuf,0,len);      \n\t\ttotalLength += len;\n\t}\n\t\n\tinputStream.close();                 \n}\ncatch(IOException e) \n{\n\n}\n\nString strContent  = bos.toString();\n\n\n%>\n\n<html>\n<body>\n\n<b>File Content (size=<%=strContent.length()%>)</b>\n\n<%=strContent%>\n\n\n</body>\n\n</html>\n\nMy web server is Microsoft IIS and I use the JK2 connector.\n\nOddly, this bugs does NOT appear when :\n1. the upload is done from a local web brower\n2. when I use the JK1 connector\n\nThanks, any help would be welcome", "bug_id": 20406, "is_private": false, "id": 38153, "time": "2003-06-02T08:21:07Z", "creator": "jrsue@cartesis.com", "creation_time": "2003-06-02T08:21:07Z", "tags": [], "attachment_id": null}, {"count": 1, "text": "I'm having the same problem. Can't upload files larger than about 64 k to a\nTomcat 4.1 server (which is using JK2 to connect to IIS on a Win 2k box). I get\nthe \"unexpected end of part\" message form the oreilly PartInputStream. This\nseems similar to bug 3534, except that it applies to all files, not just binary\nfiles. Could someone please take a look at this? Thanks a lot.", "bug_id": 20406, "is_private": false, "id": 40755, "time": "2003-07-15T18:05:39Z", "creator": "robertmacgrogan@yahoo.com", "creation_time": "2003-07-15T18:05:39Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "creator": "mturk@apache.org", "attachment_id": null, "text": "Fixed in the CVS.\nThis was the duplicate of the #15278.\nIt work with large files, tested with multi MB files.", "id": 53209, "time": "2004-02-29T07:05:54Z", "bug_id": 20406, "creation_time": "2004-02-29T07:05:54Z", "is_private": false}]
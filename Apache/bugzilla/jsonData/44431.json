[{"count": 0, "tags": [], "bug_id": 44431, "attachment_id": null, "is_private": false, "id": 113785, "time": "2008-02-15T04:11:42Z", "creator": "domenico.napoletano@exprivia.it", "creation_time": "2008-02-15T04:11:42Z", "text": "Trying to open and resave a Word document with\n\nInputStream is = new FileInputStream(\"/home/esempio.doc\");\nHWPFDocument docInput = new HWPFDocument(is);\nOutputStream os = new FileOutputStream(\"/home/TEST_POI.doc\");\ndocInput.write(os);\n\nall fields in document (TOC items, STYLEREF and so on) are destroyed and\nconverted to plain text; for example, a FILENAME field becomes \"STYLEREF\nTitoloDocumento \\* MERGEFORMAT esempio.doc\".\n\nThe problem may perhaps reside in control characters handling: in fact, fields\nin MS Word are represented within normal text, as a sequence like\n\n0x13 <field info> 0x14 <field value> 0x15\n\nand text in POI saved document becomes\n\n<field info> <field value>\n\nThe same problem affects also text extraction: a text portion like\n\nFile name is [esempio.doc]\n\nin which \"[esempio.doc]\" represents a filename field, becomes\n\nFile name is STYLEREF TitoloDocumento \\* MERGEFORMAT esempio.doc\n\nin extracted text.\nI've partially solved this latter issue using the Java method (s is the text\nportion to clean)\n\nprivate static String rimuoviCampi(String s) {\n\ts = s.replaceAll(\"\\\\x13[^\\\\x13\\\\x14]*\\\\x14\", \"\");\n\ts = s.replaceAll(\"\\\\x15\", \"\");\n\ts = s.trim();\n\treturn s;\n}\n\nbut it remains unsolved in document saving.\n\nThanks in advance\n\nDomenico"}, {"count": 1, "tags": [], "bug_id": 44431, "is_private": false, "id": 122408, "attachment_id": null, "creator": "apache@gagravarr.org", "creation_time": "2008-11-12T06:46:15Z", "time": "2008-11-12T06:46:15Z", "text": "There has been some hwpf work on fields that is in 3.2. Any chance you could re-test and see if it's now fixed?"}, {"count": 2, "tags": [], "text": "Created attachment 22872\nSample document for testing writing", "attachment_id": 22872, "id": 122486, "creator": "domenico.napoletano@exprivia.it", "time": "2008-11-14T08:02:37Z", "bug_id": 44431, "creation_time": "2008-11-14T08:02:37Z", "is_private": false}, {"count": 3, "tags": [], "text": "Created attachment 22873\nTest doc after reading and rewriting", "attachment_id": 22873, "id": 122487, "creator": "domenico.napoletano@exprivia.it", "time": "2008-11-14T08:03:11Z", "bug_id": 44431, "creation_time": "2008-11-14T08:03:11Z", "is_private": false}, {"count": 4, "tags": [], "text": "Sorry, but it's still detroying fields...\n\nI've tested last POI version source code (TRUNK revision) with attached document, trying to read and write the document as is, with the two lines\n\nHWPFDocument doc = new HWPFDocument (new FileInputStream (\"/home/jars/Desktop/FieldsTest.doc\"));\n      doc.write(new FileOutputStream (\"/home/jars/Desktop/FieldsTest after.doc\"));\n\nwhere the document (contained in the FIRST attachment; the SECOND attachment contains the resaved document) contains:\n\n1) a \"num page\" field, rendered *correctly*\n\n2) a \"num pages\" field, rendered *correctly*\n\n3) a \"style ref\" field, RENDERED AS TEXT: the original text \n\n   STYLEREF test\n\n   with style \"TitoloDocumento\", becomes\n\n   \"TitoloDocumento\"STYLEREF test\n\n4) a \"file name\" field, RENDERED AS TEXT: the original text (the bare file name with extension) becomes\n\nFILENAME FieldsTest.doc\n\n5) a \"TOC\" field, RENDERED AS TEXT: the original TOC content\n\nHeading paragraph in next page\t2\nAnother heading paragraph in further page\t3\n\nbecomes\n\nTOC \\f \\o \"1-9\" \\t \"Intestazione 1;1\" Heading paragraph in next page\t2\nAnother heading paragraph in further page\t3\u00a7", "is_private": false, "bug_id": 44431, "id": 122489, "time": "2008-11-14T08:07:05Z", "creator": "domenico.napoletano@exprivia.it", "creation_time": "2008-11-14T08:07:05Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "The problem is still reproducible in trunk ( as of r1138799)\n\nYegor", "attachment_id": null, "bug_id": 44431, "id": 147426, "time": "2011-06-24T08:17:41Z", "creator": "yegor@dinom.ru", "creation_time": "2011-06-24T08:17:41Z", "is_private": false}, {"count": 6, "tags": [], "text": "Seems to be fixed in trunk. Some formatting is missing thought, but fields are in place, including headers and footers.", "is_private": false, "id": 148112, "creator": "vlsergey@gmail.com", "time": "2011-07-24T18:41:59Z", "bug_id": 44431, "creation_time": "2011-07-24T18:41:59Z", "attachment_id": null}]
[{"attachment_id": null, "tags": [], "bug_id": 60455, "text": "we do experience strange BufferOverflowException even there is 1.5 GB free memory. The server works fine for several days (6 days last time) and then every request ends in BufferOverflowException error.\nhere is stack trace of response which sends toolbar several bytes response to client. We do include memory status with every logged message. As yoyu can see 1734 MB is still free.\nAny help appropriated.\n------------------------------\n[http-nio-80-exec-8] com.corena.lifeweb.servlets.Message 2016-12-07 08:54:41,973 -- ERROR --  Mem(MB)[free=1734,total=4293,max=7635] Error flushing message: null java.nio.BufferOverflowException\n              at java.nio.HeapByteBuffer.put(Unknown Source)\n              at org.apache.coyote.http11.Http11OutputBuffer.write(Http11OutputBuffer.java:432)\n              at org.apache.coyote.http11.Http11OutputBuffer.write(Http11OutputBuffer.java:417)\n              at org.apache.coyote.http11.Http11OutputBuffer.sendHeader(Http11OutputBuffer.java:377)\n              at org.apache.coyote.http11.Http11Processor.prepareResponse(Http11Processor.java:1278)\n              at org.apache.coyote.AbstractProcessor.action(AbstractProcessor.java:261)\n              at org.apache.coyote.Response.action(Response.java:169)\n              at org.apache.coyote.Response.sendHeaders(Response.java:351)\n              at org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:303)\n              at org.apache.catalina.connector.OutputBuffer.flush(OutputBuffer.java:284)\n              at org.apache.catalina.connector.CoyoteWriter.flush(CoyoteWriter.java:94)\n              at net.sf.saxon.serialize.XMLEmitter.close(XMLEmitter.java:294)\n              at net.sf.saxon.event.ProxyReceiver.close(ProxyReceiver.java:101)\n              at net.sf.saxon.event.ProxyReceiver.close(ProxyReceiver.java:101)\n              at net.sf.saxon.event.ProxyReceiver.close(ProxyReceiver.java:101)\n              at net.sf.saxon.event.ProxyReceiver.close(ProxyReceiver.java:101)\n              at net.sf.saxon.event.ComplexContentOutputter.close(ComplexContentOutputter.java:534)\n              at net.sf.saxon.Controller.closeResult(Controller.java:2265)\n              at net.sf.saxon.Controller.transformDocument(Controller.java:2113)\n              at net.sf.saxon.Controller.transform(Controller.java:1911)\n              at com.corena.lifeweb.appl.XML_Result.flush(XML_Result.java:385)\n              at com.corena.lifeweb.appl.XML_Result.flush(XML_Result.java:337)\n              at com.corena.lifeweb.appl.XML_Result.flush(XML_Result.java:155)\n              at com.corena.lifeweb.appl.XML_Result.flush(XML_Result.java:172)\n              at com.corena.lifeweb.servlets.Message.handleMessage(Message.java:167)\n              at com.corena.lifeweb.servlets.Message.doGet(Message.java:59)\n              at javax.servlet.http.HttpServlet.service(HttpServlet.java:636)\n              at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n              at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)\n              at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n             at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n              at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)\n              at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n              at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:715)\n              at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:460)\n              at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:385)\n              at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:311)\n              at com.corena.lifeweb.servlets.Functions.doGet(Functions.java:182)\n              at javax.servlet.http.HttpServlet.service(HttpServlet.java:636)\n              at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n              at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)\n              at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n             at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n              at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)\n              at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n              at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n              at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)\n              at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:589)\n              at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\n              at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:79)\n              at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:620)\n              at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n              at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:349)\n              at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:784)\n              at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n              at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:802)\n              at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1455)\n              at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n              at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n             at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n              at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n              at java.lang.Thread.run(Unknown Source) [http-nio-80-exec-8] com.corena.lifeweb.servlets.Message 2016-12-07 08:54:41,989 -- ERROR --  Mem(MB)[free=1733,total=4293,max=7635] Exception: null [http-nio-80-exec-2] com.corena.lifeweb.servlets.Functions 2016-12-07 08:55:20,147 -- ERROR --  Mem(MB)[free=1774,total=4293,max=7635]\n[http-nio-80-exec-2] com.corena.lifeweb.servlets.Functions 2016-12-07 08:55:20,147 -- ERROR -- com.corena.lifeweb.servlets.Functions@545cab89\njava.lang.NullPointerException\n              at org.apache.catalina.connector.Request.getRequestURL(Request.java:2321)\n              at org.apache.catalina.connector.RequestFacade.getRequestURL(RequestFacade.java:880)\n              at com.corena.lifeweb.servlets.LifeWEB_Servlet.getFullUrl(LifeWEB_Servlet.java:806)\n              at com.corena.lifeweb.servlets.Functions.doGet(Functions.java:129)\n              at javax.servlet.http.HttpServlet.service(HttpServlet.java:636)\n              at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n              at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)\n              at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n             at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n              at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)\n              at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n              at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n              at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)\n              at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:589)\n              at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\n              at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:79)\n              at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:620)\n              at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n              at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:349)\n              at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:784)\n              at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n              at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:802)\n              at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1455)\n              at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n              at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n             at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n              at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n              at java.lang.Thread.run(Unknown Source) [http-nio-80-exec-9] com.corena.lifeweb.servlets.Functions 2016-12-07 08:55:20,178 -- ERROR --  Mem(MB)[free=1744,total=4293,max=7635]\n[http-nio-80-exec-9] com.corena.lifeweb.servlets.Functions 2016-12-07 08:55:20,178 -- ERROR -- com.corena.lifeweb.servlets.Functions@545cab89\njava.lang.NullPointerException\n              at org.apache.catalina.connector.OutputBuffer.realWriteChars(OutputBuffer.java:450)\n              at org.apache.catalina.connector.OutputBuffer.flushCharBuffer(OutputBuffer.java:813)\n              at org.apache.catalina.connector.OutputBuffer.append(OutputBuffer.java:746)\n              at org.apache.catalina.connector.OutputBuffer.write(OutputBuffer.java:498)\n              at org.apache.catalina.connector.CoyoteWriter.write(CoyoteWriter.java:148)\n              at net.sf.saxon.tree.tiny.CharSlice.write(CharSlice.java:224)\n              at net.sf.saxon.serialize.XMLEmitter.writeCharSequence(XMLEmitter.java:652)\n              at net.sf.saxon.serialize.HTMLEmitter.writeEscape(HTMLEmitter.java:305)\n              at net.sf.saxon.serialize.XMLEmitter.characters(XMLEmitter.java:588)\n              at net.sf.saxon.serialize.HTMLEmitter.characters(HTMLEmitter.java:421)\n              at net.sf.saxon.serialize.HTMLIndenter.indent(HTMLIndenter.java:282)\n              at net.sf.saxon.serialize.HTMLIndenter.startElement(HTMLIndenter.java:194)\n              at net.sf.saxon.serialize.HTMLURIEscaper.startElement(HTMLURIEscaper.java:124)\n              at net.sf.saxon.serialize.MetaTagAdjuster.startElement(MetaTagAdjuster.java:120)\n              at net.sf.saxon.event.NamespaceReducer.startElement(NamespaceReducer.java:73)\n              at net.sf.saxon.event.ComplexContentOutputter.startContent(ComplexContentOutputter.java:558)\n              at net.sf.saxon.event.ComplexContentOutputter.startElement(ComplexContentOutputter.java:183)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:424)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:373)\n              at net.sf.saxon.expr.instruct.Block.processLeavingTail(Block.java:660)\n              at net.sf.saxon.expr.instruct.Instruction.process(Instruction.java:138)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:431)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:373)\n              at net.sf.saxon.expr.instruct.Block.processLeavingTail(Block.java:660)\n              at net.sf.saxon.expr.instruct.Instruction.process(Instruction.java:138)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:431)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:373)\n              at net.sf.saxon.expr.instruct.Block.processLeavingTail(Block.java:660)\n              at net.sf.saxon.expr.instruct.Instruction.process(Instruction.java:138)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:431)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:373)\n              at net.sf.saxon.expr.instruct.Block.processLeavingTail(Block.java:660)\n              at net.sf.saxon.expr.instruct.Instruction.process(Instruction.java:138)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:431)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:373)\n              at net.sf.saxon.expr.instruct.Instruction.process(Instruction.java:138)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:431)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:373)\n              at net.sf.saxon.expr.instruct.Block.processLeavingTail(Block.java:660)\n              at net.sf.saxon.expr.instruct.Instruction.process(Instruction.java:138)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:431)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:373)\n              at net.sf.saxon.expr.instruct.Template.applyLeavingTail(Template.java:239)\n              at net.sf.saxon.trans.Mode.applyTemplates(Mode.java:1057)\n              at net.sf.saxon.expr.instruct.ApplyTemplates$ApplyTemplatesPackage.processLeavingTail(ApplyTemplates.java:519)\n              at net.sf.saxon.expr.instruct.ApplyTemplates.apply(ApplyTemplates.java:283)\n              at net.sf.saxon.expr.instruct.ApplyTemplates.processLeavingTail(ApplyTemplates.java:241)\n              at net.sf.saxon.expr.instruct.Block.processLeavingTail(Block.java:660)\n              at net.sf.saxon.expr.instruct.Instruction.process(Instruction.java:138)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:431)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:373)\n              at net.sf.saxon.expr.instruct.Block.processLeavingTail(Block.java:660)\n              at net.sf.saxon.expr.instruct.Instruction.process(Instruction.java:138)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:431)\n              at net.sf.saxon.expr.instruct.ElementCreator.processLeavingTail(ElementCreator.java:373)\n              at net.sf.saxon.expr.instruct.Template.applyLeavingTail(Template.java:239)\n              at net.sf.saxon.trans.Mode.applyTemplates(Mode.java:1057)\n              at net.sf.saxon.Controller.transformDocument(Controller.java:2088)\n              at net.sf.saxon.Controller.transform(Controller.java:1911)\n              at com.corena.lifeweb.appl.XML_Result.flush(XML_Result.java:385)\n              at com.corena.lifeweb.appl.XML_Result.flush(XML_Result.java:337)\n              at com.corena.lifeweb.appl.XML_Result.flush(XML_Result.java:155)\n              at com.corena.lifeweb.appl.XML_Result.flush(XML_Result.java:172)\n              at com.corena.lifeweb.servlets.Functions.doGet(Functions.java:158)\n              at javax.servlet.http.HttpServlet.service(HttpServlet.java:636)\n              at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n              at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)\n              at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n              at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)\n              at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:108)\n              at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:589)\n              at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\n              at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:79)\n              at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:620)\n              at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n              at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:349)\n              at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:784)\n              at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n              at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:802)\n              at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1455)\n              at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n              at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n             at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n              at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n              at java.lang.Thread.run(Unknown Source) Best regards, Lee", "count": 0, "id": 195404, "time": "2016-12-08T15:20:42Z", "creator": "jan.kostelansky@aerosoftsys.com", "creation_time": "2016-12-08T15:20:42Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 60455, "text": "\n\n*** This bug has been marked as a duplicate of bug 60372 ***", "count": 1, "id": 195405, "time": "2016-12-08T15:30:59Z", "creator": "violetagg@apache.org", "creation_time": "2016-12-08T15:30:59Z", "is_private": false}]
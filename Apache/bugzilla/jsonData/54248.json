[{"count": 0, "tags": [], "bug_id": 54248, "attachment_id": null, "text": "If a request contains Content that includes the BOM - in my case Content-Type: application/xml; charset-utf-16 - and the content has a BOM (FF FE), when fetched utilizing the BufferedReader from getReader() - the first request serviced on the AJP thread works correctly (encoded correctly, only characters fetched), however, any subsequent request on the thread which includes the BOM has the BOM being delivered to the application. It appears via review of the Tomcat code, that the recycle() method in B2CConverter simply ensures the socket's data has been completely flushed and the underlying InputStream doesn't get reset (don't really know if there is a way to do this without re-instantiating it) to ensure subsequent requests BOM is consumed. I proved this as a test by adding a call to reset() within the recycle() method which re-instantiates the underlying InputStreams and the problem resolved itself. \n\nI've temporarily resolved the issue in my application code by using request.getInputStream() and using request.getCharacterEncoding() and encoding the content inside my application.", "id": 163883, "time": "2012-12-05T11:56:08Z", "creator": "davids@bigkahuna.org", "creation_time": "2012-12-05T11:56:08Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 54248, "attachment_id": null, "id": 164460, "time": "2013-01-07T23:09:22Z", "creator": "markt@apache.org", "creation_time": "2013-01-07T23:09:22Z", "is_private": false, "text": "Thanks for the report.\n\nThe fix is to ensure that the decoder is reset between requests when the converter is recycled.\n\nThe fix has been applied to trunk and 7.0.x and will be included in 7.0.35 onwards.\n\nThe fix has been proposed for 6.0.x."}, {"count": 2, "tags": [], "bug_id": 54248, "attachment_id": null, "id": 165138, "time": "2013-02-09T00:05:49Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2013-02-09T00:05:49Z", "is_private": false, "text": "Fixed in 6.0 with r1444292 and will be in 6.0.37 onwards"}]
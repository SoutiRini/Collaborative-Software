[{"count": 0, "tags": [], "creator": "david@carr.name", "attachment_id": null, "id": 52816, "time": "2004-02-23T18:21:52Z", "bug_id": 27171, "creation_time": "2004-02-23T18:21:52Z", "is_private": false, "text": "My first indication of the problem was getting unusual entries in my log files, \neven though the tests were still functioning fine.\n\n2004/02/17 14:20:27 INFO  - jmeter.engine.StandardJMeterEngine: Running the \ntest! \n2004/02/17 14:20:28 ERROR - jmeter.protocol.jdbc.util.DBConnectionManager: \nError registering database driver '' java.lang.ClassNotFoundException: \n at java.lang.Class.forName0(Native Method)\n at java.lang.Class.forName(Class.java:140)\n at org.apache.jmeter.protocol.jdbc.util.DBConnectionManager.registerDriver\n(DBConnectionManager.java:222)\n at org.apache.jmeter.protocol.jdbc.util.DBConnectionManager.getKey\n(DBConnectionManager.java:101)\n at org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.getKey\n(JDBCSampler.java:173)\n at org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.testStarted\n(JDBCSampler.java:282)\n at org.apache.jmeter.engine.StandardJMeterEngine.notifyTestListenersOfStart\n(StandardJMeterEngine.java:149)\n at org.apache.jmeter.engine.StandardJMeterEngine.run\n(StandardJMeterEngine.java:268)\n at java.lang.Thread.run(Thread.java:536)\n\nI had a JDBC Config element which specified the driver as ${DBDriver}, a \nvariable specified in the TestPlan.  The problem seems to be with the changes \nintroduced to JDBCSampler.testStarted in Revision 1.23, which calls getKey.  I \nbelieve that Test Listeners get their testStarted method called prior to \nvariable resolution, and thus, the database driver property is incorrectly set \nat that point, generating the error in the log.  When the sampler actually \nneeds to execute, it has the proper information and the calls to getKey succeed."}, {"count": 1, "tags": [], "bug_id": 27171, "attachment_id": null, "text": "Also, in non-GUI mode only, I get the following crash:\njava.util.ConcurrentModificationException\n        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:762)\n        at java.util.HashMap$KeyIterator.next(HashMap.java:798)\n        at org.apache.jmeter.protocol.jdbc.util.DBConnectionManager.shutdown\n(DBConnectionManager.java:155)\n        at org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.testEnded\n(JDBCSampler.java:297)\n        at \norg.apache.jmeter.engine.StandardJMeterEngine.notifyTestListenersOfEnd\n(StandardJMeterEngine.java:165)\n        at org.apache.jmeter.engine.StandardJMeterEngine$StopTest.run\n(StandardJMeterEngine.java:220)\n        at java.lang.Thread.run(Thread.java:536)\n\nRemoving the body of JDBCSampler.testStarted() seems to fix both problems.", "id": 52937, "time": "2004-02-25T15:28:36Z", "creator": "david@carr.name", "creation_time": "2004-02-25T15:28:36Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 27171, "text": "Which version of JMeter is this happening in?\n\nThere was a problem with concurrent modification of a hashmap; this has been \nfixed in CVS, but if I recall correctly, it was after 1.9.1.", "id": 52941, "time": "2004-02-25T16:04:19Z", "creator": "sebb@apache.org", "creation_time": "2004-02-25T16:04:19Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "david@carr.name", "text": "In CVS, as of today; 2-25-2004", "id": 52944, "time": "2004-02-25T16:11:57Z", "bug_id": 27171, "creation_time": "2004-02-25T16:11:57Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "sebb@apache.org", "text": "OK, it must be another such error then.\n\nI think we'll need a few more details, such as:\n- number of threads\n- JVM details\n- JDBC details\n- does it fail immediately, or after a while?\n\nThe jmeter.log would be useful - could you post this as an attachment?\nDo you have a test script you can attach here?", "id": 52952, "time": "2004-02-25T17:20:45Z", "bug_id": 27171, "creation_time": "2004-02-25T17:20:45Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 27171, "attachment_id": 10547, "id": 52955, "time": "2004-02-25T17:43:02Z", "creator": "david@carr.name", "creation_time": "2004-02-25T17:43:02Z", "is_private": false, "text": "Created attachment 10547\nJMX file to demonstrate the problem"}, {"count": 6, "tags": [], "text": "Created attachment 10548\nJMeter log file (censored)", "attachment_id": 10548, "bug_id": 27171, "id": 52956, "time": "2004-02-25T17:45:53Z", "creator": "david@carr.name", "creation_time": "2004-02-25T17:45:53Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 27171, "attachment_id": 10549, "text": "Created attachment 10549\nResulting output log file", "id": 52957, "time": "2004-02-25T17:46:26Z", "creator": "david@carr.name", "creation_time": "2004-02-25T17:46:26Z", "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 27171, "text": "jmeter -n -JDBName=CENSORED -JDBUser=CENSORED -JDBServer=CENSORED -\nJDBPass=CENSORED -t d:\\dmcjmx\\dbtest.jmx -l dbtest.jtl -Ljmeter=DEBUG\nCreated the tree successfully\nStarting the test\n[Full GC 16309K->824K(249088K), 0.2680547 secs]\njava.util.ConcurrentModificationException\n        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:762)\n        at java.util.HashMap$KeyIterator.next(HashMap.java:798)\n        at org.apache.jmeter.protocol.jdbc.util.DBConnectionManager.shutdown(DBC\nonnectionManager.java:155)\n        at org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler.testEnded(JDBCSam\npler.java:297)\n        at org.apache.jmeter.engine.StandardJMeterEngine.notifyTestListenersOfEn\nd(StandardJMeterEngine.java:165)\n        at org.apache.jmeter.engine.StandardJMeterEngine$StopTest.run(StandardJM\neterEngine.java:220)\n        at java.lang.Thread.run(Thread.java:536)\n\njava -version\njava version \"1.4.1_03\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.1_03-b02)\nJava HotSpot(TM) Client VM (build 1.4.1_03-b02, mixed mode)\n\nrunning on Windows NT Version 4.0\n\nNumber of threads: 1", "id": 52958, "time": "2004-02-25T17:50:37Z", "creator": "david@carr.name", "creation_time": "2004-02-25T17:50:37Z", "tags": [], "is_private": false}, {"count": 9, "attachment_id": null, "bug_id": 27171, "text": "Thanks, I'll try and look at this in more detail soon.", "id": 52961, "time": "2004-02-25T18:18:40Z", "creator": "sebb@apache.org", "creation_time": "2004-02-25T18:18:40Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "id": 52976, "time": "2004-02-26T00:11:05Z", "bug_id": 27171, "creation_time": "2004-02-26T00:11:05Z", "is_private": false, "text": "[The HashMap concurrent modification is not the same problem that was seen \nbefore.]\n\nThis concurrent modification is a bit odd, since all the accesses to the Map \nseem to be fully synchronized ... I'll add some debugging messages to help \ntrack this down.\n\ntestStarted() is indeed called early on in the test cycle, before any of the \nthreads have been set up properly, so it's not surprising that errors are \noccurring. This ought to be fixed, but is not critical, as far as I can see.\n\n==\n\nWas there another problem apart from the startup problem and the batch \nclosedown error? The first sentence of the bug indicates that there might be \nsomething else, but I can't now find any messages about it - can you please \npost details in Bugzilla so it's all in one place? Thanks."}, {"count": 11, "tags": [], "creator": "david@carr.name", "text": "No, those are the only problems I've noticed.", "id": 52978, "time": "2004-02-26T01:47:27Z", "bug_id": 27171, "creation_time": "2004-02-26T01:47:27Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 27171, "text": "It's not (yet?) clear to me why the shutdown() method should ever suffer from \nconcurrent modification, but as the OP has pointed out, removing the DB init \nfrom testStarted() solves this problem, and also solves the problem of \npossible startup errors where JDBC parameters are passed in via functions etc \nwhich have not yet been intialised.\n\n", "id": 53073, "time": "2004-02-26T23:31:27Z", "creator": "sebb@apache.org", "creation_time": "2004-02-26T23:31:27Z", "is_private": false, "attachment_id": null}]
[{"attachment_id": null, "tags": [], "bug_id": 57085, "is_private": false, "count": 0, "id": 178428, "time": "2014-10-14T00:30:46Z", "creator": "etienne_grignon@intuit.com", "creation_time": "2014-10-14T00:30:46Z", "text": "Hello,\n\nI would be interested to have Proxy Protocol implemented in httpd.\n\nNginx 1.5.2 and haproxy 1.5 already have support for it.\n\nThe read feature would be a good start. This would allow apache to get the client IP when being used behind an AWS ELB with apache httpd terminating SSL.\n\nhttp://www.haproxy.org/download/1.5/doc/proxy-protocol.txt\nhttps://wiki.bedis.eu/nginx/nginx_proxy_protocol_patch\nhttp://trac.nginx.org/nginx/changeset/3a72b1805c52c84a5567dcfa4562f44722bede40/nginx\n\nThank you,\n\nEtienne Grignon"}, {"attachment_id": null, "tags": [], "bug_id": 57085, "is_private": false, "count": 1, "id": 179675, "time": "2014-12-09T22:24:12Z", "creator": "guillermo.grandes@gmail.com", "creation_time": "2014-12-09T22:24:12Z", "text": "There is my implementation (for Apache 2.2 and 2.4):\n\nThe source code (beta) is Hosted in Github and licensed under Apache 2.0 License.\n\nModule for Apache 2.4: http://goo.gl/ThoZXN\nModule for Apache 2.2: http://goo.gl/pxsCVm\n\nOriginal Article:\nhttp://wp.me/p19O7G-na"}, {"count": 2, "tags": [], "text": "I have implemented a similar module under testing for appache 2.4, following ngix's patch. I am curious why your code didn't put source ip from proxy protocol line into c->client_ip and c->client_addr (your code use c->notes to store client_ip)?  You threw away destination_ip from protocol line now. Do you have plan to use it, which my current effort to integrate it with apache mod_proxy?", "is_private": false, "bug_id": 57085, "id": 179677, "time": "2014-12-09T23:38:31Z", "creator": "ywu@bitglass.com", "creation_time": "2014-12-09T23:38:31Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Someone posted a basic implementation for this in apache today, which is roughly the same as I have done. So thr solution is correct so far. Posted one supported only IPV4 for logging ip address. But it put in lot of security check of source ip addresses.", "attachment_id": null, "bug_id": 57085, "id": 179678, "time": "2014-12-09T23:41:46Z", "creator": "ywu@bitglass.com", "creation_time": "2014-12-09T23:41:46Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 57085, "attachment_id": null, "id": 179679, "time": "2014-12-09T23:45:30Z", "creator": "ywu@bitglass.com", "creation_time": "2014-12-09T23:45:30Z", "is_private": false, "text": "please ignore or delete this comment."}, {"count": 5, "attachment_id": null, "creator": "guillermo.grandes@gmail.com", "is_private": false, "id": 179680, "time": "2014-12-10T00:26:12Z", "bug_id": 57085, "creation_time": "2014-12-10T00:26:12Z", "tags": [], "text": "(In reply to ywu from comment #2)\n> I have implemented a similar module under testing for appache 2.4, following\n> ngix's patch. I am curious why your code didn't put source ip from proxy\n> protocol line into c->client_ip and c->client_addr (your code use c->notes\n> to store client_ip)?  You threw away destination_ip from protocol line now.\n> Do you have plan to use it, which my current effort to integrate it with\n> apache mod_proxy?\n\nYes, I dont touch c->client_ip in 2.4 module, I use r->useragent_ip (that is not available in connection_filter, until post_read) because... I read the change in API (http://httpd.apache.org/docs/2.4/developer/new_api_2_4.html), that say (about c->remote_ip):\n\n>> 1) When you require the IP address of the user agent, which might be connected directly to the server, or might optionally be separated from the server by a transparent load balancer or proxy, use request_rec->useragent_ip and request_rec->useragent_addr.\n>> 2) When you require the IP address of the client that is connected directly to the server, which might be the useragent or might be the load balancer or proxy itself, use conn_rec->client_ip and conn_rec->client_addr.\n\nThis seems that usage of c->client_ip is not the good way for PROXY protocol."}]
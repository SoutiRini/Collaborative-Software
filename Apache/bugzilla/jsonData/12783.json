[{"count": 0, "tags": [], "creator": "cizquierdo@timeindustrial.com", "is_private": false, "id": 23052, "attachment_id": null, "bug_id": 12783, "creation_time": "2002-09-18T17:22:41Z", "time": "2002-09-18T17:22:41Z", "text": "User Agent: IE (version 4.0+)\nType of Request: POST\nProtocol: HTTP/1.0\nThe servlet is properly setting the content-length.\n\nIf these conditions are met, IE will block for the period of time specified in \nthe connectionTimeout parameter. This is due to the following lines in \nHttp11Processor.prepareResponse method:\n\n(Aprox lines: 857 - 862)\n        int contentLength = response.getContentLength();\n        if (contentLength != -1) {\n            outputBuffer.addActiveFilter\n                (outputFilters[Constants.IDENTITY_FILTER]);\n            contentDelimitation = true;\n        }\n       \nAnd a little further down:\n\n(Aprox lines: 880 - 884)\n        if ((entityBody) && (!contentDelimitation)) {\n            // Mark as close the connection after the request, and add the \n            // connection: close header\n            keepAlive = false;\n        }\n\nBy setting countDelimitation to true the keepAlive variable remains true and \nthe Coyote Connector will try to reuse the connection. Unfortunately IE doesn't \ndisplay the response but rather waits for the connection to be closed (Even \nthough IE sent Keep-Alives:True in the headers).\n\nThe current workaround involves not setting the content length for HTTP/1.0 \nconnections. \n\nA quick fix inside the coyote code would be to detect the User-Agent and if is \nIE and the protocol is HTTP/1.0 close the connection.\n\nNote that it works fine if instead of POST a GET is sent."}, {"count": 1, "text": "HTTP/1.0 keep alive does not work correctly with the Coyote version included in\nTomcat 4.0.4.\n\nHowever, if IE sends the Connection: keep-alive header and the servlet properly\ndoes content delimitation, then the connection will be persisted. If IE doesn't\nlike that, then it's IE's problem (use it in HTTP/1.1 mode).", "bug_id": 12783, "attachment_id": null, "id": 23059, "time": "2002-09-18T17:50:48Z", "creator": "remm@apache.org", "creation_time": "2002-09-18T17:50:48Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "ctwomey@yahoo.com", "attachment_id": null, "id": 23741, "time": "2002-10-02T09:00:41Z", "bug_id": 12783, "creation_time": "2002-10-02T09:00:41Z", "is_private": false, "text": "This is happening me with the coyote connector in Tomcat 4.1.12\n\nUsing a HTTP/1.0 client to POST a request using Keep-Alive, tomcat fails to \nsend the Connection: Keep-Alive header back to the client, although it does \nindeed keep the connection open. While it is correct behavior for HTTP/1.1 to \nomit the keep-alive response header, it is incorrect under HTTP/1.0\n\nChanging the following in coyote's Http11Processor.java fixes it:\n\nold:\n        if (!keepAlive) {\n            response.addHeader(\"Connection\", \"close\");\n        }\nnew:\n\n        if (!keepAlive) {\n            response.addHeader(\"Connection\", \"close\");\n        } else if (!http11) {\n            response.addHeader(\"Connection\", \"Keep-Alive\");\n        }\n\n--ctwomey\n"}, {"count": 3, "tags": [], "creator": "william.barker@wilshire.com", "text": "The patch has been applied, and will appear in 4.1.13.\n\nThanks much!", "id": 23812, "time": "2002-10-03T05:25:38Z", "bug_id": 12783, "creation_time": "2002-10-03T05:25:38Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "When will be avaliable 4.1.13? I need it to monday :-) \n ", "is_private": false, "bug_id": 12783, "id": 23983, "time": "2002-10-05T00:50:41Z", "creator": "agallardo@agsoftware.dnsalias.com", "creation_time": "2002-10-05T00:50:41Z", "attachment_id": null}]
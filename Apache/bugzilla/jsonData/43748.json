[{"count": 0, "tags": [], "creator": "A.Kuckartz@ping.de", "attachment_id": null, "id": 110026, "time": "2007-10-31T05:43:04Z", "bug_id": 43748, "creation_time": "2007-10-31T05:43:04Z", "is_private": false, "text": "The start page http://lenya.apache.org contains a link to a \"Demo\" \n(http://lenya.zones.apache.org:8888/) but the link or the demo (or both) is \nbroken."}, {"count": 1, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "id": 110030, "time": "2007-10-31T06:50:04Z", "bug_id": 43748, "creation_time": "2007-10-31T06:50:04Z", "is_private": false, "text": "I restarted the server some hours ago (it was offline this morning because of\ndeployment changes, see bug 33147), it's up again."}, {"attachment_id": null, "tags": [], "bug_id": 43748, "text": "It is down again...", "count": 2, "id": 110034, "time": "2007-10-31T07:12:37Z", "creator": "A.Kuckartz@ping.de", "creation_time": "2007-10-31T07:12:37Z", "is_private": false}, {"count": 3, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "id": 110035, "time": "2007-10-31T07:18:28Z", "bug_id": 43748, "creation_time": "2007-10-31T07:18:28Z", "is_private": false, "text": "Sorry, I restarted only the trunk demo. I'll restart the branch demo now."}, {"count": 4, "tags": [], "text": "The branch demo can't start:\n\n/export/home/lenya/htdocs/build/site/log/lenya.branch.update.log\n\n./lenya.sh: using /export/home/lenya/build/lenya/webapp as the webapp directory\nINFO: No such war file lenya.war or build directory!", "is_private": false, "bug_id": 43748, "id": 110107, "time": "2007-11-01T05:04:37Z", "creator": "andreas@apache.org", "creation_time": "2007-11-01T05:04:37Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "id": 110110, "time": "2007-11-01T06:00:03Z", "bug_id": 43748, "creation_time": "2007-11-01T06:00:03Z", "is_private": false, "text": "The lenya.sh script can't resolve LENYA_HOME. It works with the code from\n2.0-dev. Here's the diff:\n\n-# Set Lenya home to directory containing this script\n-ENDSLASH=`expr match \"$0\" '.*/'`\n-LENYA_HOME=`expr substr \"$0\" 1 $ENDSLASH`\n-cd $LENYA_HOME\n-LENYA_HOME=`pwd -P`\n+if [ \"$LENYA_HOME\" = \"\" ] ; then\n+  LENYA_HOME='.'\n+  # TODO: Make it startable from any directory\n+  #LENYA_HOME=`dirname $0`\n+  #echo \"LENYA_HOME: $LENYA_HOME\"\n+fi\n\nShould we commit this?"}, {"count": 6, "tags": [], "bug_id": 43748, "text": "I committed the change in Comment #5.  Using an environmental variable does not\nallow multiple versions of Lenya on one server.  The code sets LENYA_HOME to the\ndirectory containing this instance of lenya.sh.  \n\nThe code uses \"expr match\", \"expr substr\", \"cd\" and \"pwd\".  Which of these\ncommands are not available in all versions of *nix?  Better (more generic) code\nfor discovering the current directory would be good.", "id": 111108, "time": "2007-11-26T11:24:21Z", "creator": "solprovider@gmail.com", "creation_time": "2007-11-26T11:24:21Z", "is_private": false, "attachment_id": null}, {"count": 7, "attachment_id": null, "bug_id": 43748, "is_private": false, "id": 111188, "time": "2007-11-27T17:19:33Z", "creator": "solprovider@gmail.com", "creation_time": "2007-11-27T17:19:33Z", "tags": [], "text": "According to http://issues.apache.org/bugzilla/show_bug.cgi?id=43959, MacOS\nerrors on the two \"expr\" lines (and so incorrectly sets LENYA_HOME so other\nfiles are not found.)  Here is the same function without using \"expr\":\n\nLENYA_HOME=${0%/*}\ncd $LENYA_HOME\nLENYA_HOME=`pwd -P`\n\nI will commit this tomorrow if nobody finds a problem.  Both versions were\ntested with Bash 2.05.  What operating systems/bash versions do not like \"expr\"?"}, {"attachment_id": null, "tags": [], "bug_id": 43748, "text": "The zones server runs solaris:\n\nSun Microsystems Inc.   SunOS 5.10      Generic January 2005", "count": 8, "id": 111189, "time": "2007-11-27T17:21:51Z", "creator": "andreas@apache.org", "creation_time": "2007-11-27T17:21:51Z", "is_private": false}, {"count": 9, "text": "lenya.sh specifies:\n#!/bin/sh\nsh calls the Bourne shell for POSIX compatibility.  In Linux, \"sh\" is Bash which\nadded the \"expr\" extensions.  Using those extensions broke compatibility. \nTested using people.apache.org (FreeBSD 6.2): the current code errors and the\nnew code works.  I will commit the change later today.", "creator": "solprovider@gmail.com", "is_private": false, "id": 111198, "time": "2007-11-28T03:49:08Z", "bug_id": 43748, "creation_time": "2007-11-28T03:49:08Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 43748, "text": "*** Bug 43959 has been marked as a duplicate of this bug. ***", "count": 10, "id": 111255, "time": "2007-11-29T04:13:11Z", "creator": "solprovider@gmail.com", "creation_time": "2007-11-29T04:13:11Z", "is_private": false}, {"count": 11, "tags": [], "creator": "solprovider@gmail.com", "attachment_id": null, "id": 111256, "time": "2007-11-29T04:14:07Z", "bug_id": 43748, "creation_time": "2007-11-29T04:14:07Z", "is_private": false, "text": "Broken in 589735 (2007-10-29).  Fixed in 599401 (2007-11-29) as specified in\nComment #7."}, {"count": 12, "tags": [], "bug_id": 43748, "text": "It doesn't seem to work at the zones server:\n\n./lenya.sh: bad substitution", "id": 111336, "time": "2007-12-03T01:04:50Z", "creator": "andreas@apache.org", "creation_time": "2007-12-03T01:04:50Z", "is_private": false, "attachment_id": null}, {"count": 13, "attachment_id": null, "bug_id": 43748, "is_private": false, "id": 111670, "time": "2007-12-11T14:40:07Z", "creator": "thorsten@apache.org", "creation_time": "2007-12-11T14:40:07Z", "tags": [], "text": " +LENYA_HOME=${0%/*}\n\nCan you explain this change?\n\nIf I open a shell and type \necho ${0%/*}\n\nI get\nbash\n\nIf I do this on the zone server I get:\n-bash\n\nhttp://svn.apache.org/viewvc/lenya/branches/BRANCH_1_2_X/lenya.sh?r1=473841&r2=589735&pathrev=599401&diff_format=h\nFor now I removed the lines 93 - 97 and replaced them with the ones from\nr473841. Which seems to work fine.\n\nThis is pointed as well earlier out, what seems to be wrong with it?"}, {"count": 14, "tags": [], "text": "Hmm, I am starting understand.\n\nIf I do \n#!/bin/sh\necho ${0%/*}\n\nI get \".\" on my Ubuntu.\n\nif I do this on zones I get\n./test: bad substitution", "attachment_id": null, "id": 111671, "creator": "thorsten@apache.org", "time": "2007-12-11T14:44:33Z", "bug_id": 43748, "creation_time": "2007-12-11T14:44:33Z", "is_private": false}, {"count": 15, "tags": [], "creator": "thorsten@apache.org", "attachment_id": null, "is_private": false, "id": 111677, "time": "2007-12-11T15:11:17Z", "bug_id": 43748, "creation_time": "2007-12-11T15:11:17Z", "text": "http://moka.ccr.jussieu.fr/doc_link/en_US/a_doc_lib/aixuser/usrosdev/parameter_subst.htm"}, {"attachment_id": null, "tags": [], "bug_id": 43748, "is_private": false, "count": 16, "id": 111678, "time": "2007-12-11T15:35:06Z", "creator": "thorsten@apache.org", "creation_time": "2007-12-11T15:35:06Z", "text": "hmm, I found a interesting post:\nhttp://kerneltrap.org/mailarchive/git/2007/8/3/253869\n\nUsing \n#!/usr/xpg4/bin/sh\necho ${0%/*}\n\nWorks nice."}, {"count": 17, "attachment_id": null, "bug_id": 43748, "is_private": false, "id": 111679, "time": "2007-12-11T15:55:21Z", "creator": "thorsten@apache.org", "creation_time": "2007-12-11T15:55:21Z", "tags": [], "text": "Using \n/bin/ksh\n\nis as well working fine."}, {"count": 18, "tags": [], "creator": "solprovider@gmail.com", "attachment_id": null, "is_private": false, "id": 111680, "time": "2007-12-11T16:38:41Z", "bug_id": 43748, "creation_time": "2007-12-11T16:38:41Z", "text": "The goal of my revision to lenya.sh is to make LENYA_HOME independent\nof an environment variable.  Before this change, running any of these\nfiles:\n  /lenya-1.2.2/lenya.sh\n  /lenya-1.2.5/lenya.sh\n  /lenya-1.2.x/lenya.sh\nwill start the same instance of Lenya because the environment variable\noverrides the path of the command.  This is not intuitive.  Running\n/lenya-1.2.5/lenya.sh should launch Lenya 1.2.5, not Lenya\n1.2.2.  More critical, running multiple instances of Lenya is not\npossible when the launch command always reverts to a single instance.\nEditing lenya.sh in each instance to hardcode the directory\nviolates every rule of computing.\n\nIn ash, bash, csh, ksh, and every shell except the original 1977 sh,\n${0%/*}\nwill remove the last slash and anything after the last slash from the command.\n\necho $0\nreturns\n-bash\nbecause echo is integral to bash so the \"command\" is bash.  Test using\nthe following script.\n\nFILE: test.sh\n#!/bin/sh\necho \"PWD= `pwd`\"\nLENYA_HOME=${0%/*}\necho \"LH1=$LENYA_HOME\"\ncd $LENYA_HOME\nLENYA_HOME=`pwd -P`\necho \"LH2=$LENYA_HOME\"\n\nUsing people.apache.org:\n/x1$ home/solprovider/test.sh\nPWD= /x1\nLH1=home/solprovider\nLH2=/x1/home/solprovider\n\nIn English,\n1. Get the path used to reach the current executable (LH1).\n2. Change directory using the result of #1.  This is relative to the\ncurrent directory.  The current directory (PWD) is the directory from\nwhich the command is called.\n3. Get the absolute current path (LH2).  This removes dots and symbolic links.\n\nThis code works on every *nix except SunOS.  By default, SunOS uses the original\n1977 shell, which did not have good string manipulation.  sh and awk\nwere the two required programs for Unix.    In 1977, string manipulation\nrequired using awk.\n\nI am ready to rewrite this to use awk to work on SunOS.  I am waiting\nfor access to zones so I can test the code.  I dislike guessing what\nmight work and submitting code hoping not to break anything."}, {"count": 19, "attachment_id": null, "bug_id": 43748, "is_private": false, "id": 111681, "time": "2007-12-11T17:03:55Z", "creator": "solprovider@gmail.com", "creation_time": "2007-12-11T17:03:55Z", "tags": [], "text": "The most desired solution is to use a 1977-compatible shell script.\n\nCould we just specify that the default SunOS shell does not work?  SunOS\nadminstrators know SunOS requires extra configuration for most programs.  For\nLenya, just run \"chsh\" as the Lenya user to change the shell.\nsudo -u lenyauser chsh\n\n"}, {"attachment_id": null, "tags": [], "bug_id": 43748, "text": "(In reply to comment #18)\n> The goal of my revision to lenya.sh is to make LENYA_HOME independent\n> of an environment variable.  Before this change, running any of these\n> files:\n>   /lenya-1.2.2/lenya.sh\n>   /lenya-1.2.5/lenya.sh\n>   /lenya-1.2.x/lenya.sh\n> will start the same instance of Lenya because the environment variable\n> overrides the path of the command. \n\ni don't know if it's posix or a GNUism, but\n\"LENYA_HOME=. ./lenya.sh\" should do the trick...\ni agree that using environment variables is weird - we should chuck them out and\nadd proper parameters for all this...\n", "count": 20, "id": 111914, "time": "2007-12-19T09:26:34Z", "creator": "nettings@apache.org", "creation_time": "2007-12-19T09:26:34Z", "is_private": false}, {"count": 21, "attachment_id": null, "bug_id": 43748, "is_private": false, "id": 111956, "time": "2007-12-20T11:37:00Z", "creator": "solprovider@gmail.com", "creation_time": "2007-12-20T11:37:00Z", "tags": [], "text": "LENYA_HOME='.'\n\nThis code works for exactly one case -- lenya.sh must be called from\nthe Lenya directory.  Startup scripts must change to the Lenya\ndirectory before calling the launch command, and may still have\nunexpected results if LENYA_HOME is set as an environment variable.\nTo test, try to run Lenya from a different directory without setting\nLENYA_HOME:\n  cd /x1/home/solprovider\n  /lenya-1.2.5/lenya.sh servlet\nResults:\n  INFO: No such war file lenya.war or build directory!\nbecause the build directory and lenya.war file are not found in the\n/x1/home/solprovider directory.\n\n> Meaning when you do not set \"$LENYA_HOME\" it is the same as you intend\n> with your commit.\n\nNot setting LENYA_HOME still requires changing the directory before\ncalling lenya.sh.  I am unaware of another program that requires\nchanging the directory before calling the launch command.\n\nI am not the only person aware of and working on this issue.  Trunk's\nlenya.sh includes:\n  if [ \"$LENYA_HOME\" = \"\" ] ; then\n    LENYA_HOME='.'\n    # TODO: Make it startable from any directory\n    #LENYA_HOME=`dirname $0`\n    #echo \"LENYA_HOME: $LENYA_HOME\"\n  fi\n\nWho tried using \"dirname\"?  That code cannot fix the issue because\nLENYA_HOME is not set to the absolute path.  Can we use this code?\n\n  cd `dirname $0`\n  LENYA_HOME=`pwd -P`\n\nIs the dirname program more generically available than the percent\nsign syntax for string manipulation?\n\nFor the record, the rest of my original commit added a \"stop\" command\nline option and automatically shut down the Lenya instance from this\ndirectory before launching a new instance.  Lenya 2.0 should benefit\nfrom that code."}, {"count": 22, "tags": [], "creator": "solprovider@gmail.com", "attachment_id": null, "id": 111957, "time": "2007-12-20T11:45:08Z", "bug_id": 43748, "creation_time": "2007-12-20T11:45:08Z", "is_private": false, "text": "RESOLVED WITH:\n\ncd `dirname $0`\nLENYA_HOME=`pwd -P`\n\nThis code works on zones.lenya.apache.org (Solaris 2.10), people.apache.org\n(FreeBSD 6.2), and a Linux server.\n\n--\nHere are the results on zones:\n\nFILE: /export/home/lenya/test\n#!/bin/sh\necho \"PWD= `pwd`\"\necho \"CMD=$0\"\nLENYA_HOME=`dirname $0`\necho \"DIR=$LENYA_HOME\"\ncd `dirname $0`\nLENYA_HOME=`pwd -P`\necho \"LH3=$LENYA_HOME\"\n\n$ cd /export/home/lenya\n$ ./test\nPWD= /export/home/lenya\nCMD=./test\nDIR=.\nLH3=/export/home/lenya\n$ cd /opt/local\n$ /export/home/lenya/test\nPWD= /opt/local\nCMD=/export/home/lenya/test\nDIR=/export/home/lenya\nLH3=/export/home/lenya"}, {"count": 23, "tags": [], "creator": "solprovider@gmail.com", "attachment_id": null, "is_private": false, "id": 111959, "time": "2007-12-20T11:53:59Z", "bug_id": 43748, "creation_time": "2007-12-20T11:53:59Z", "text": "Committed to 1.2 and 1.3 on 20071213.\nOpened a new bugzilla for 2.0/Trunk:\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=44115"}]
[{"count": 0, "tags": [], "bug_id": 56491, "text": "When referencing attributes either set by the container or by the application I am finding that references within jsps are not resolving to the attribute values.\n\nI have attached a very simple example.\n\nI am experiencing this problem on tomcat 7.0.52 and 7.0.53. (not 7.0.47 and not 8.0.5).\n\nI realize this is a major claim and am unable to find a bug having been opened for this specific problem. Time and time again I am seeing this happening.\nI have tested this on tomcat 7.0.52 and 7.0.53 windows and redhat linux.\n\n\nBelow is the copied and pasted output of calling my example test servlet. (/test)\n\n\n<html>\n<head>\n\t<script type=\"text/javascript\" src=\"${pageContext.request.contextPath}/assets/test.js\"></script>\n\t<script type=\"text/javascript\">\n\t\twindow.onload=someFunc();\n\t</script>\n</head>\n<body>\n<h1>pageContext.request.contextPath: ${pageContext.request.contextPath}</h1>\n<img src=\"${pageContext.request.contextPath}/assets/test.gif\" />\n<div>customAttr: ${customAttr}</div>\n</body>\n</html>\n\nThanks for any time invested in confirming this bug and or solving this issue. Sorry if I missed something simple, but I have been writing java ee code for 10 years and using tomcat for 7 years so I'm sure I haven't missed anything.", "id": 175033, "time": "2014-05-05T20:53:02Z", "creator": "cubbyrulz@gmail.com", "creation_time": "2014-05-05T20:53:02Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 56491, "text": "Created attachment 31591\nexample of the problem -", "id": 175034, "time": "2014-05-05T20:53:43Z", "creator": "cubbyrulz@gmail.com", "creation_time": "2014-05-05T20:53:43Z", "is_private": false, "attachment_id": 31591}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "is_private": false, "id": 175038, "time": "2014-05-05T21:43:56Z", "bug_id": 56491, "creation_time": "2014-05-05T21:43:56Z", "text": "Where should I look at?\n\nWhat are \"Expected Results\" and \"Actual Results\" for your example?\n( https://issues.apache.org/bugzilla/page.cgi?id=bug-writing.html )\n\n> Time and time again I am seeing this happening.\n\nDoes the issue reproduce reliably?"}, {"count": 3, "tags": [], "bug_id": 56491, "attachment_id": null, "text": "This issue is happening 100 percent.\n\nIn the outpu the attributes referenced using expression language should resolve to the value of the attribute.\n\nie: ${pageContext.request.contextPath} should resolve to the \"/\" + the directory name of the webapp context (or an empty string if ROOT context)\nAlso ${customAttr} should resolve to \"Set by servlet\" if you look at the 3 lines of code.", "id": 175040, "time": "2014-05-05T21:57:39Z", "creator": "cubbyrulz@gmail.com", "creation_time": "2014-05-05T21:57:39Z", "is_private": false}, {"count": 4, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "is_private": false, "id": 175041, "time": "2014-05-05T22:16:58Z", "bug_id": 56491, "creation_time": "2014-05-05T22:16:58Z", "text": "The \"<!DOCTYPE\" and \"web-app_2_3.dtd\" should not be in your web.xml.\n\nIf I remove that Doctype declaration, it starts working.\n\nThis is expected, as Servlet 2.3 applications have no support for Expression Language. Note also that in Servlet 2.3 there is no support for \"version\" attribute on \"web-app\" element.\n\n\nMy advice for you is to enable validation for your deployment descriptors, e.g. by turning on the \"STRICT_SERVLET_COMPLIANCE\" mode.\nhttp://tomcat.apache.org/tomcat-7.0-doc/config/systemprops.html#Specification"}, {"count": 5, "text": "Understood - can you explain why this problem would not occur on 7.0.50 and below and 8.0.5? If I deploy this app as is to 7.0.52/53 the problem occurs - no other versions seem to have this problem occur.", "bug_id": 56491, "is_private": false, "id": 175042, "time": "2014-05-05T22:18:59Z", "creator": "cubbyrulz@gmail.com", "creation_time": "2014-05-05T22:18:59Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 56491, "is_private": false, "text": "Ack. I tested that current 8.0.x allows EL in your sample web application.\n\nI think Tomcat 8 shall be fixed to behave in the same way as Tomcat 7 here and disable the EL.\n\n(This is on a slippery ground though,  because the web.xml in that web application is actually invalid.)\n\n\nEL processing in JSPs is controlled by Jasper, and passing the version information from Catalina to Jasper is different in Tomcat 7 and 8.\n\nThe Tomcat 7 implementation of it was changed in 7.0.52 with r1567148 and followups. There are test cases in TestWebXml class.", "id": 175043, "time": "2014-05-05T22:40:44Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-05-05T22:40:44Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 56491, "text": "(In reply to Konstantin Kolinko from comment #4)\n> The \"<!DOCTYPE\" and \"web-app_2_3.dtd\" should not be in your web.xml.\n> \n> If I remove that Doctype declaration, it starts working.\n> \n> This is expected, as Servlet 2.3 applications have no support for Expression\n> Language. Note also that in Servlet 2.3 there is no support for \"version\"\n> attribute on \"web-app\" element.\n\nThis may fall under the category of \"things that really ought to happen (i.e. 2.3 -> no EL), but the Servlet EG likes to make chaos in the world and therefore EL should be available in a 2.3-spec webapp\".", "id": 175056, "time": "2014-05-06T17:33:18Z", "creator": "chris@christopherschultz.net", "creation_time": "2014-05-06T17:33:18Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 56491, "text": "(In reply to Christopher Schultz from comment #7)\n\nReading jsp-2_2-mrel-spec.pdf\n\n1) Chapter JSP.1.10.1 - page #51 (89 of 594)\n(in description of \"isELIgnored\" attribute of @page directive):\n\n[quote]\nThe\ndefault value varies depending on the web.xml version\n[/quote]\n\n2) Chapter JSP.3.3.2 - page #79 (117 of 594)\n[quote]\nThe default mode for JSP pages in a Web Application delivered using a\nweb.xml using the Servlet 2.3 or earlier format is to ignore EL expressions; this\nprovides for backward compatibility.\n\nThe default mode for JSP pages in a Web Application delivered using a\nweb.xml using the Servlet 2.4 format is to evaluate EL expressions with the ${}\nsyntax. Expressions using the #{} are evaluated starting with JSP 2.1. See\nSection , \u201cBackwards Compatibility with JSP 2.0\u201d for more details on the\nevaluation of #{} expressions.\n[/quote]\n\nThus it is correct to disable EL evaluation here.", "id": 175064, "time": "2014-05-06T19:47:47Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-05-06T19:47:47Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "text": "(In reply to Konstantin Kolinko from comment #8)\n\n> Thus it is correct to disable EL evaluation here.\n\nGreat! Thanks for tracking down the spec on this. It's nice to see that some parts of the spec make practical sense :)", "id": 175081, "time": "2014-05-07T15:57:45Z", "bug_id": 56491, "creation_time": "2014-05-07T15:57:45Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 56491, "text": "If validation is enabled for web.xml, this application will fail to start.\n\nIf the correct syntax is used then 8.0.x correctly disables EL for Servlet 2.3 apps and enables EL for Servlet 3.0 apps.\n\nThe use case of invalid XML and validation disabled is not one that we should be spending time on trying to make the behaviour consistent across Tomcat versions.", "id": 175321, "time": "2014-05-19T14:07:17Z", "creator": "markt@apache.org", "creation_time": "2014-05-19T14:07:17Z", "is_private": false, "attachment_id": null}]
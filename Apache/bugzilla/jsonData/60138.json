[{"count": 0, "text": "This problem seems to only occur on IBM z/OS with Tomcat 8.5.5. All other things equal, the problem does not exist with Tomcat 7.\n\nFirst, with Tomcat 7, the connector is defined thusly:\n\n    <Connector protocol=\"HTTP/1.1\"\n        clientAuth=\"false\"\n        connectionTimeout=\"20000\"\n        keystoreFile=\"conf/keystore.p12\" keystorePass=\"password\" keystoreType=\"pkcs12\"\n        maxThreads=\"150\"\n        maxPostSize=\"-1\"\n        port=\"55663\"\n        scheme=\"https\" secure=\"true\" SSLEnabled=\"true\" sslEnabledProtocols=\"TLSv1.2\" sslProtocol=\"TLS\"\n        URIEncoding=\"UTF-8\" />\n\nThis works, and connections can be established using (and only using) TLSv1.2 protocol.\n\nNow, all other things being equal, with Tomcat 8.5.5, the connector is defined thusly: \n\n    <Connector protocol=\"HTTP/1.1\"\n        connectionTimeout=\"20000\"\n        maxThreads=\"150\"\n        maxPostSize=\"-1\"\n        port=\"58789\"\n        scheme=\"https\" secure=\"true\" SSLEnabled=\"true\"\n        URIEncoding=\"UTF-8\" >\n        <SSLHostConfig certificateVerification=\"none\" protocols=\"TLSv1.2\" sslProtocol=\"TLS\">\n            <Certificate\n                certificateKeystoreFile=\"conf/keystore.p12\"\n                certificateKeystorePassword=\"password\"\n                certificateKeystoreType=\"pkcs12\"\n            />\n        </SSLHostConfig>\n    </Connector>\n\nThis causes the following exception trace (and connections are not possible):\n\n SEVERE: Failed to initialize end point associated with ProtocolHandler [\"https-jsse-nio-58789\"]\n java.lang.IllegalArgumentException: sslUtilBase.noneSupported\n  at org.apache.tomcat.util.net.SSLUtilBase.getEnabled(SSLUtilBase.java:87)\n  at org.apache.tomcat.util.net.SSLUtilBase.<init>(SSLUtilBase.java:54)\n  at org.apache.tomcat.util.net.jsse.JSSEUtil.<init>(JSSEUtil.java:151)\n  at org.apache.tomcat.util.net.jsse.JSSEImplementation.getSSLUtil(JSSEImplementation.java:49)\n  at org.apache.tomcat.util.net.AbstractJsseEndpoint.createSSLContext(AbstractJsseEndpoint.java:91)\n  at org.apache.tomcat.util.net.AbstractJsseEndpoint.initialiseSsl(AbstractJsseEndpoint.java:81)\n  at org.apache.tomcat.util.net.NioEndpoint.bind(NioEndpoint.java:244)\n  at org.apache.tomcat.util.net.AbstractEndpoint.init(AbstractEndpoint.java:866)\n  at org.apache.tomcat.util.net.AbstractJsseEndpoint.init(AbstractJsseEndpoint.java:213)\n  at org.apache.coyote.AbstractProtocol.init(AbstractProtocol.java:575)\n  at org.apache.coyote.http11.AbstractHttp11Protocol.init(AbstractHttp11Protocol.java:65)\n  at org.apache.catalina.connector.Connector.initInternal(Connector.java:944)\n  at org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:107)\n  at org.apache.catalina.core.StandardService.initInternal(StandardService.java:549)\n  at org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:107)\n  at org.apache.catalina.core.StandardServer.initInternal(StandardServer.java:873)\n  at org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:107)\n  at org.apache.catalina.startup.Catalina.load(Catalina.java:606)\n  at org.apache.catalina.startup.Catalina.load(Catalina.java:629)\n  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:95)\n  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:55)\n  at java.lang.reflect.Method.invoke(Method.java:508)\n  at org.apache.catalina.startup.Bootstrap.load(Bootstrap.java:311)\n  at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:494)\n\nChanging protocol=\"TLSv1.2\" to protocol=\"TLSv1\" avoids the exception and connections are made with TLSv1. TLSv1.1 and TLSv1.2 are conspicuously missing.\n\nAgain, I must stress that the underlying environment is identical in both cases, including environment variables, Java home directory, system properties specified at startup (-D), etc. The singular difference that I am aware of is moving from Tomcat 7 to Tomcat 8.", "bug_id": 60138, "attachment_id": null, "id": 193735, "time": "2016-09-14T23:38:11Z", "creator": "pscott@skycoast.us", "creation_time": "2016-09-14T23:38:11Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 60138, "attachment_id": null, "id": 193840, "time": "2016-09-20T13:08:17Z", "creator": "markt@apache.org", "creation_time": "2016-09-20T13:08:17Z", "is_private": false, "text": "It looks like we are mixing up default and supported protocols. I'm working on a fix."}, {"count": 2, "tags": [], "bug_id": 60138, "attachment_id": null, "id": 193848, "time": "2016-09-20T18:36:24Z", "creator": "pscott@skycoast.us", "creation_time": "2016-09-20T18:36:24Z", "is_private": false, "text": "Great news. Thanks you! Looking forward to fix so we can move forward."}, {"count": 3, "tags": [], "bug_id": 60138, "attachment_id": null, "id": 193851, "time": "2016-09-20T19:03:12Z", "creator": "markt@apache.org", "creation_time": "2016-09-20T19:03:12Z", "is_private": false, "text": "This has been fixed in the following branches:\n- 9.0.x for 9.0.0.M11 onwards\n- 8.5.x for 8.5.6 onwards"}, {"count": 4, "text": "Verified fix in 8.5.6", "bug_id": 60138, "attachment_id": null, "id": 195365, "time": "2016-12-06T03:46:35Z", "creator": "pscott@skycoast.us", "creation_time": "2016-12-06T03:46:35Z", "tags": [], "is_private": false}]
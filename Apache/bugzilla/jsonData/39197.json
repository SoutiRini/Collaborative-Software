[{"count": 0, "tags": [], "text": "The sshexec task should support an input property in the same was as the output\nproperty. While the output/outputProperty property stores the output (stdout and\nstderr) of the remote command in either a file or a property, the\ninput/inputProperty should allow to supply stdin for the remote command.\n\nThe following patch provides an implementation for input/inputProperty:\n\nIndex: SSHExecMod.java\n===================================================================\nRCS file:\n/usr/local/cvsveritas/build.maven.dev.tools/src/build/maven/dev/tools/sshmod/SSHExecMod.java,v\nretrieving revision 1.1\ndiff -u -r1.1 SSHExecMod.java\n--- SSHExecMod.java\t30 Mar 2006 10:47:44 -0000\t1.1\n+++ SSHExecMod.java\t3 Apr 2006 11:13:24 -0000\n@@ -17,10 +17,14 @@\n \n package build.maven.dev.tools.sshmod;\n \n+import java.io.ByteArrayInputStream;\n import java.io.ByteArrayOutputStream;\n import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n import java.io.FileWriter;\n import java.io.IOException;\n+import java.io.InputStream;\n import java.io.StringReader;\n \n import org.apache.tools.ant.BuildException;\n@@ -53,6 +57,8 @@\n \n     private String outputProperty = null;   // like <exec>\n     private File outputFile = null;   // like <exec>\n+    private String inputProperty = null;   // like <exec>\n+    private File inputFile = null;   // like <exec>\n     private boolean append = false;   // like <exec>\n \n     private static final String TIMEOUT_MESSAGE =\n@@ -93,6 +99,24 @@\n     public void setOutput(File output) {\n         outputFile = output;\n     }\n+    \n+    /**\n+     * If used, the content of the file is piped to the remote command\n+     *\n+     * @param input  The file which provides the input data for the remote command\n+     */\n+    public void setInput(File input) {\n+        inputFile = input;\n+    }\n+\n+    /**\n+     * If used, the content of the property is piped to the remote command\n+     *\n+     * @param inputProperty  The property which contains the input data for the\nremote command.\n+     */\n+    public void setInputProperty(String inputProperty) {\n+    \tthis.inputProperty = inputProperty;\n+    }\n \n     /**\n      * Determines if the output is appended to the file given in\n@@ -134,10 +158,32 @@\n         if (command == null) {\n             throw new BuildException(\"Command is required.\");\n         }\n+        if (this.inputFile != null && this.inputProperty != null) {\n+        \tthrow new BuildException(\"You can't specify both inputFile and\ninputProperty.\");\n+        }\n+        if (this.inputFile != null && !inputFile.exists()) {\n+        \tthrow new BuildException(\"The input file \" +\nthis.inputFile.getAbsolutePath() + \" does not exist.\");\n+        }\n \n         ByteArrayOutputStream out = new ByteArrayOutputStream();\n         TeeOutputStream tee = new TeeOutputStream(out, System.out);\n \n+        InputStream istream = null ;\n+        if (this.inputFile != null) {\n+        \ttry {\n+\t\t\t\tistream = new FileInputStream(this.inputFile) ;\n+\t\t\t} catch ( FileNotFoundException e ) {\n+\t\t\t\t// because we checked the existence before, this one shouldn't happen \n+\t\t\t\t// What if the file exists, but there are no read permissions?\n+\t\t\t}\n+        }\n+        if (this.inputProperty != null) {\n+        \tString inputData = getProject().getProperty(this.inputProperty) ;\n+        \tif (inputData != null) {\n+        \t\tistream = new ByteArrayInputStream(inputData.getBytes()) ;\n+        \t}        \t\n+        }\n+        \n         Session session = null;\n         try {\n             // execute the command\n@@ -147,6 +193,7 @@\n             channel.setCommand(command);\n             channel.setOutputStream(tee);\n             channel.setExtOutputStream(tee);\n+            channel.setInputStream(istream) ;\n             channel.connect();\n \n             // wait for it to finish", "is_private": false, "id": 87557, "creator": "Markus.Barchfeld@dvag.com", "time": "2006-04-04T09:22:10Z", "bug_id": 39197, "creation_time": "2006-04-04T09:22:10Z", "attachment_id": null}, {"count": 1, "attachment_id": 18034, "bug_id": 39197, "text": "Created attachment 18034\nDiff -u of the suggested change, with a minor change\n\nRenamed the setInput(File file) method to setInputFile(File file). Created diff\n-u for patching. Tested both inputproperty and inputfile.", "id": 87635, "time": "2006-04-06T18:33:50Z", "creator": "riznob@hotmail.com", "creation_time": "2006-04-06T18:33:50Z", "tags": [], "is_private": false}, {"count": 2, "attachment_id": 18035, "creator": "riznob@hotmail.com", "is_private": false, "id": 87636, "time": "2006-04-06T19:02:24Z", "bug_id": 39197, "creation_time": "2006-04-06T19:02:24Z", "tags": [], "text": "Created attachment 18035\nshould have left the setInput method name as it was, undid change\n\nAfter reviewing exec task, I undid the rename of setInput, so it will be\nconsistent with other tasks."}, {"count": 3, "tags": [], "bug_id": 39197, "attachment_id": null, "is_private": false, "id": 118676, "time": "2008-07-15T06:14:57Z", "creator": "bodewig@apache.org", "creation_time": "2008-07-15T06:14:57Z", "text": "committed in subversion revision 676906"}]
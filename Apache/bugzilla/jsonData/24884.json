[{"attachment_id": null, "tags": [], "creator": "qnxuserit@yahoo.it", "text": "I made a lot of test with apache 2.0.48 compiled on HP-UX 11.00 and with the\nApache included in MandrakeLinux 9.1.\n\nWhen I do a GET and obtain a 200 in the reply there are the cache headers, but\nwhen the reply is 304 there is no way have theese headers. So when the browser's\ncache expires, the expire-date is not updated more. For each page I obtain a 304\nfor each element for ever...\n\nExample:\n\nthe request:\n\nGET /test.html HTTP/1.1\nAccept: */*\nAccept-Language: it\nAccept-Encoding: gzip, deflate\nIf-modified-since: Thu, 20 Nov 2003 11:54:42 GMT\nIf-None-Match: \"12a-a0006480\"\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0)\nHost: 10.254.3.20\nConnection: Keep-Alive\n\nthe 304 (expire-date is not updated):\n\nHTTP/1.1 304 Not Modified\nDate: Fri, 21 Nov 2003 09:40:43 GMT\nServer: Apache\nConnection: Keep-Alive\nKeep-Alive: timeout=10, max=8\nETag: \"12a-a0006480\"\n\n\nthe 200 (the cache is updated):\n\nHTTP/1.1 200 OK\nDate: Fri, 21 Nov 2003 09:40:43 GMT\nServer: Apache\nLast-Modified: Thu, 20 Nov 2003 11:54:42 GMT\nETag: \"12a-a0006480\"\nAccept-Ranges: bytes\nContent-Length: 298\nCache-Control: max-age=86400\nExpires: Sat, 22 Nov 2003 09:40:33 GMT\nKeep-Alive: timeout=10, max=10\nConnection: Keep-Alive\nContent-Type: text/html; charset=ISO-8859-1\nData (298 bytes)\n\nI think there is a problem in mod_expires...\n\nThanks\nFabio", "count": 0, "id": 47755, "time": "2003-11-21T10:55:46Z", "bug_id": 24884, "creation_time": "2003-11-21T10:55:46Z", "is_private": false}, {"count": 1, "tags": [], "creator": "qnxuserit@yahoo.it", "attachment_id": null, "id": 48073, "time": "2003-11-25T09:27:10Z", "bug_id": 24884, "creation_time": "2003-11-25T09:27:10Z", "is_private": false, "text": "I found an old issue (http://www.apacheweek.com/issues/96-08-30)... seems to be \nan old problem:\n\n<cut....>\n\nResponses can also contain a definite time when the document will expire, in \nthe Expires HTTP header. There are some cases where the expiry time of a \ndocument might change, even if the document itself has not changed. So a 304 \nstatus message can include an updated expires time, which the browser should \nuse to replace the expires time in it's cached copy of the file. Currently \nApache does not send out the expires header on 304 status, which is required by \nHTTP/1.1. The problem with not sending out the expires header is that the \nbrowser still keeps the old expiry time, so it thinks the document has expired \nstraight away. This will be fixed in the next release. \n\n<cut....>\n\nIs there a work-around?\n\nThanks,\nFabio\n"}, {"count": 2, "tags": [], "text": "I am currently working on this problem. There is not currently a workaround that\nI know of. I know what the problem is (only certain filters are run in the error\npath and expires is not one of them). I am currently working on a solution to\nthe problem. Thank you for reporting this and for using Apache.", "is_private": false, "bug_id": 24884, "id": 48104, "time": "2003-11-25T17:05:31Z", "creator": "rederpj@remulak.net", "creation_time": "2003-11-25T17:05:31Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "slive@apache.org", "text": "*** Bug 25123 has been marked as a duplicate of this bug. ***", "id": 48364, "time": "2003-12-01T23:07:23Z", "bug_id": 24884, "creation_time": "2003-12-01T23:07:23Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "The solution lies somewhere within the following:\n\nmod_expires only register with \"ap_register_output_filter\"...\n\nand within \"modules/http/http_protocol.c\", we do this (flushing the output filter):\n\nAP_DECLARE(void) ap_send_error_response(request_rec *r, int recursive_error)\n{\n    int status = r->status;\n    int idx = ap_index_of_response(status);\n    char *custom_response;\n    const char *location = apr_table_get(r->headers_out, \"Location\");\n\n    /* At this point, we are starting the response over, so we have to reset\n     * this value.\n     */\n    r->eos_sent = 0;\n\n    /* and we need to get rid of any RESOURCE filters that might be lurking\n     * around, thinking they are in the middle of the original request\n     */\n\n    r->output_filters = r->proto_output_filters;\n", "attachment_id": null, "bug_id": 24884, "id": 48366, "time": "2003-12-02T00:02:19Z", "creator": "marc@r4l.com", "creation_time": "2003-12-02T00:02:19Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 24884, "is_private": false, "text": "This PR has been fixed in the 2.1-dev branch and has been suggested for\nbackporting to the 2.0 stable branch. Thank you for using Apache and for\nsubmitting this report.", "id": 48994, "time": "2003-12-12T17:33:51Z", "creator": "rederpj@remulak.net", "creation_time": "2003-12-12T17:33:51Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "I can't use \"-dev\" version...\nI'll wait for the 2.0.49 (I hope).\n\nThank you very much for your work!!\n\nBye", "is_private": false, "bug_id": 24884, "id": 49040, "time": "2003-12-13T00:17:12Z", "creator": "qnxuserit@yahoo.it", "creation_time": "2003-12-13T00:17:12Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 59746, "attachment_id": null, "id": 191902, "time": "2016-06-23T09:22:56Z", "creator": "robert.owen@pfizer.com", "creation_time": "2016-06-23T09:22:56Z", "is_private": false, "text": "I have an excel xlsx file that was exported by some mass spec software (ThemoScientific I think) that looks to contain hierarchical or grouped data. There are two examples of these files in the attached, one that is the full export and one where only the top level data is exported. If you try to open these files using POI, the file opens correctly, but the lastRowNum for the only sheet is -1 (example code is also in the attachment). However, excel can open the file and if you immediately hit save on the file (no changes needed) and then try to open with POI, the file opens and the correct number of rows are found. \n\nLooking at the XLM for the saved file, there are definitely changes that excel has made, but I am not sure where POI is failing in parsing the original XML. Not sure where the problem lies, but I have found a python package (https://pypi.python.org/pypi/xlrd) that will correctly read the files that POI is unable to read, so the XML does not appear to be completely nonstandard (or only one that excel itself can read). \n\nThis appears still be a problem with 3.15-beta1 as well."}, {"count": 1, "tags": [], "text": "Created attachment 33977\nSuporting docs with xlsx files\n\nI cannot attached the larger files as it goes over the allowed file size.", "attachment_id": 33977, "id": 191903, "creator": "robert.owen@pfizer.com", "time": "2016-06-23T09:34:56Z", "bug_id": 59746, "creation_time": "2016-06-23T09:34:56Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 59746, "text": "Created attachment 33978\nFull data that will not open", "id": 191904, "time": "2016-06-23T09:36:05Z", "creator": "robert.owen@pfizer.com", "creation_time": "2016-06-23T09:36:05Z", "is_private": false, "attachment_id": 33978}, {"count": 3, "tags": [], "creator": "robert.owen@pfizer.com", "is_private": false, "text": "Created attachment 33979\nFull data saved by excel", "id": 191905, "time": "2016-06-23T09:36:31Z", "bug_id": 59746, "creation_time": "2016-06-23T09:36:31Z", "attachment_id": 33979}, {"count": 4, "tags": [], "bug_id": 59746, "is_private": false, "id": 191908, "attachment_id": null, "creator": "apache@gagravarr.org", "creation_time": "2016-06-23T11:12:31Z", "time": "2016-06-23T11:12:31Z", "text": "The problem is that all the rows in your file neglect to say which one they are!\n\nIn a normal file, the sheet xml should be like:\n\n <x:sheetData>\n    <x:row r=\"1\">\n      <x:c r=\"A1\" t=\"str\">\n        <x:v>Destination</x:v>\n      </x:c>\n      <x:c r=\"B1\" t=\"str\">\n        <x:v>Dial Code</x:v>\n      </x:c>\n    </x:row>\n    <x:row r=\"2\">\n      <x:c r=\"A2\" t=\"str\">\n        <x:v>Abkhazia - Fixed</x:v>\n      </x:c>\n      <x:c r=\"B2\" t=\"str\">\n        <x:v>7840</x:v>\n      </x:c>\n\nWhere each row indicates the row number. However, in your files, the row numbers are missing:\n\n  <x:sheetData>\n    <x:row hidden=\"0\" outlineLevel=\"0\" collapsed=\"0\">\n      <x:c s=\"1\" t=\"inlineStr\">\n        <x:is>\n          <x:t>Checked</x:t>\n        </x:is>\n      </x:c>\n      <x:c s=\"1\" t=\"inlineStr\">\n        <x:is>\n          <x:t>Ion</x:t>\n        </x:is>\n      </x:c>\n    </x:row>\n    <x:row hidden=\"0\" outlineLevel=\"0\" collapsed=\"0\">\n      <x:c s=\"4\" t=\"b\">\n        <x:v>1</x:v>\n      </x:c>\n      <x:c s=\"4\" t=\"inlineStr\">\n        <x:is>\n          <x:t>[M+H]+1</x:t>\n        </x:is>\n      </x:c>\n\n\nMy guess is that Excel assumes that a row with no row number should be treated as the next row, and if all have no row number start from row 1.\n\n\nAny chance you could produce a much smaller problematic excel file from the other software, perhaps with just a few 10s of lines, which we could use for unit testing and a possible fix?"}, {"count": 5, "tags": [], "bug_id": 59746, "attachment_id": null, "id": 191909, "time": "2016-06-23T11:15:37Z", "creator": "robert.owen@pfizer.com", "creation_time": "2016-06-23T11:15:37Z", "is_private": false, "text": "Thanks for the rapid follow up. I will find a smaller file and attached it ASAP"}, {"attachment_id": 33980, "tags": [], "creator": "robert.owen@pfizer.com", "is_private": false, "count": 6, "id": 191918, "time": "2016-06-23T15:47:03Z", "bug_id": 59746, "creation_time": "2016-06-23T15:47:03Z", "text": "Created attachment 33980\nSmaller file that does not work\n\nHere is a smaller file. Software did not make it easy so it might be slightly biger than you were hoping"}, {"count": 7, "attachment_id": null, "bug_id": 59746, "text": "Hopefully fixed in r1749971 - I can now read back the values the same as shown in OpenOffice for the file\n\nDo let us know if there are other issues with these files due to them having missed other parts of the XML out though!", "id": 191919, "time": "2016-06-23T19:00:05Z", "creator": "apache@gagravarr.org", "creation_time": "2016-06-23T19:00:05Z", "tags": [], "is_private": false}]
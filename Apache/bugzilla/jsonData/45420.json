[{"attachment_id": null, "tags": [], "bug_id": 45420, "is_private": false, "count": 0, "id": 118766, "time": "2008-07-17T09:34:55Z", "creator": "david@reliablehosting.com", "creation_time": "2008-07-17T09:34:55Z", "text": "Apache 2.2.9 with worker mpm on linux 2.6\n\n\nWhen mod_proxy_ajp is used as follows,\n\nProxyPass / ajp://localhost:8009/test/\nProxyPassReverse / ajp://localhost:8009/test/\n\nrequests to page http://domain.com/index.jsp gets rewritten to http://domain.com/test/index.jsp\n\nWhen mod_proxy_http is used as follows,\n\nProxyPass / http://localhost:8009/test/\nProxyPassReverse / http://localhost:8009/test/\n\nrequests to page http://domain.com/index.jsp get correctly rewritten to http://domain.com/index.jsp in the /test/ folder on the tomcat server.\n\nmod_proxy_ajp is incorrectly adding the \"test\" folder on the proxy url to the user's request."}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "is_private": false, "id": 118767, "time": "2008-07-17T12:01:02Z", "bug_id": 45420, "creation_time": "2008-07-17T12:01:02Z", "text": "1. Bugzilla is not user support forum, but for reporting bugs. So please the user support mailing list (http://httpd.apache.org/lists.html#http-users).\n2. Your ProxyPassReverse directive in the ajp case is wrong.\nIt must be ProxyPassReverse / http://localhost:8009/test/"}, {"count": 2, "text": "So I did not have ProxyPassReverse listed correctly, that does not change the different behavior I see between mod_proxy_ajp and mod_proxy_http\n\nUsing the http connector\nProxyPass / http://localhost:8009/test/\na request to http://domain.com/index.jsp goes correctly to http://localhost:8009/test/index.jsp\n\nIf the ajp connector is used\nProxyPass / ajp://localhost:8009/test/\n\na request to http://domain.com/index.jsp goes to http://localhost:8009/test/test/index.jsp\nwhich is not the expected behavior.\n", "bug_id": 45420, "is_private": false, "id": 118771, "time": "2008-07-17T13:12:49Z", "creator": "david@reliablehosting.com", "creation_time": "2008-07-17T13:12:49Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 118776, "time": "2008-07-17T13:41:57Z", "bug_id": 45420, "creation_time": "2008-07-17T13:41:57Z", "is_private": false, "text": "Please set the loglevel to debug and post the error log of a faulty request with ajp."}, {"count": 4, "tags": [], "text": "The debug log below was for the following two directives set in a VirtualHost\n\nProxyPass / ajp://localhost:8009/test/\nProxyPassReverse / http://localhost:8009/test/\n\najp_unmarshal_response: Header[1] [Location] entry appears to be where the original URL is being altered and /test/ added to it. The URL should either be http://devsite.local/index.jsp or ajp://localhost:8009/test/index.jsp\n\n\n[Thu Jul 17 15:54:13 2008] [debug] proxy_util.c(1854): proxy: grabbed scoreboard slot 2 in child 2574 for worker ajp://localhost:8009/test/\n[Thu Jul 17 15:54:13 2008] [debug] proxy_util.c(1950): proxy: initialized worker 2 in child 2574 for (localhost) min=0 max=25 smax=25\n[Thu Jul 17 15:54:13 2008] [debug] proxy_util.c(1854): proxy: grabbed scoreboard slot 2 in child 2576 for worker ajp://localhost:8009/test/\n[Thu Jul 17 15:54:13 2008] [debug] proxy_util.c(1873): proxy: worker ajp://localhost:8009/test/ already initialized\n[Thu Jul 17 15:54:13 2008] [debug] proxy_util.c(1950): proxy: initialized worker 2 in child 2576 for (localhost) min=0 max=25 smax=25\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(45): proxy: AJP: canonicalising URL //localhost:8009/test/\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(1488): [client 192.168.1.157] proxy: ajp: found worker ajp://localhost:8009/test/ for ajp://localhost:8009/test/\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy.c(966): Running scheme ajp handler (attempt 0)\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_http.c(1899): proxy: HTTP: declining URL ajp://localhost:8009/test/\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(579): proxy: AJP: serving URL ajp://localhost:8009/test/\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(2044): proxy: AJP: has acquired connection for (localhost)\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(2102): proxy: connecting ajp://localhost:8009/test/ to localhost:8009\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(2195): proxy: connected /test/ to localhost:8009\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(2347): proxy: AJP: fam 2 socket created to connect to localhost\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(224): Into ajp_marshal_into_msgb\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[0] [Host] = [devsite.local]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[1] [User-Agent] = [Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.16) Gecko/20080702 Firefox/2.0.0.16]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[2] [Accept] = [text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[3] [Accept-Language] = [en-us,en;q=0.5]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[4] [Accept-Encoding] = [gzip,deflate]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[5] [Accept-Charset] = [ISO-8859-1,utf-8;q=0.7,*;q=0.7]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[6] [Keep-Alive] = [300]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[7] [Connection] = [keep-alive]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(430): ajp_marshal_into_msgb: Done\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(239): proxy: APR_BUCKET_IS_EOS\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(244): proxy: data to read (max 8186 at 4)\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(259): proxy: got 0 bytes of data\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(652): ajp_read_header: ajp_ilink_received 04\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(662): ajp_parse_type: got 04\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(491): ajp_unmarshal_response: status = 302\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(502): ajp_unmarshal_response: Number of headers is = 3\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(564): ajp_unmarshal_response: Header[0] [Set-Cookie] = [JSESSIONID=9D894ECC78168E1915FC9EAB08CDEF32.worker2; Path=/test]\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(1071): ppr: real: http://localhost:8009/test/\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(564): ajp_unmarshal_response: Header[1] [Location] = [http://devsite.local/test/index.jsp;jsessionid=9D894ECC78168E1915FC9EAB08CDEF32.worker2]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(564): ajp_unmarshal_response: Header[2] [Content-Length] = [0]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(652): ajp_read_header: ajp_ilink_received 05\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(662): ajp_parse_type: got 05\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(498): proxy: got response from (null) (localhost)\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(2062): proxy: AJP: has released connection for (localhost)\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(45): proxy: AJP: canonicalising URL //localhost:8009/test/test/index.jsp;jsessionid=9D894ECC78168E1915FC9EAB08CDEF32.worker2\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(1488): [client 192.168.1.157] proxy: ajp: found worker ajp://localhost:8009/test/ for ajp://localhost:8009/test/test/index.jsp;jsessionid=9D894ECC78168E1915FC9EAB08CDEF32.worker2\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy.c(966): Running scheme ajp handler (attempt 0)\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_http.c(1899): proxy: HTTP: declining URL ajp://localhost:8009/test/test/index.jsp;jsessionid=9D894ECC78168E1915FC9EAB08CDEF32.worker2\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(579): proxy: AJP: serving URL ajp://localhost:8009/test/test/index.jsp;jsessionid=9D894ECC78168E1915FC9EAB08CDEF32.worker2\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(2044): proxy: AJP: has acquired connection for (localhost)\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(2102): proxy: connecting ajp://localhost:8009/test/test/index.jsp;jsessionid=9D894ECC78168E1915FC9EAB08CDEF32.worker2 to localhost:8009\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(2195): proxy: connected /test/test/index.jsp;jsessionid=9D894ECC78168E1915FC9EAB08CDEF32.worker2 to localhost:8009\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(224): Into ajp_marshal_into_msgb\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[0] [Host] = [devsite.local]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[1] [User-Agent] = User-Agent] = [Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.16) Gecko/20080702 Firefox/2.0.0.16]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[2] [Accept] = [text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[3] [Accept-Language] = [en-us,en;q=0.5]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[4] [Accept-Encoding] = [gzip,deflate]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[5] [Accept-Charset] = [ISO-8859-1,utf-8;q=0.7,*;q=0.7]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[6] [Keep-Alive] = [300]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[7] [Connection] = [keep-alive]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(290): ajp_marshal_into_msgb: Header[8] [Cookie] = [JSESSIONID=9D894ECC78168E1915FC9EAB08CDEF32.worker2]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(430): ajp_marshal_into_msgb: Done\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(239): proxy: APR_BUCKET_IS_EOS\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(244): proxy: data to read (max 8186 at 4)\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(259): proxy: got 0 bytes of data\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(652): ajp_read_header: ajp_ilink_received 04\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(662): ajp_parse_type: got 04\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(491): ajp_unmarshal_response: status = 200\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(502): ajp_unmarshal_response: Number of headers is = 5\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(564): ajp_unmarshal_response: Header[0] [Pragma] = [No-cache]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(564): ajp_unmarshal_response: Header[1] [Cache-Control] = [no-cache]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(564): ajp_unmarshal_response: Header[2] [Expires] = [Thu, 01 Jan 1970 02:00:00 SAST]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(564): ajp_unmarshal_response: Header[3] [Content-Type] = [text/html]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(574): ajp_unmarshal_response: ap_set_content_type done\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(564): ajp_unmarshal_response: Header[4] [Content-Length] = [1950]\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(652): ajp_read_header: ajp_ilink_received 03\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(662): ajp_parse_type: got 03\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(652): ajp_read_header: ajp_ilink_received 05\n[Thu Jul 17 15:54:21 2008] [debug] ajp_header.c(662): ajp_parse_type: got 05\n[Thu Jul 17 15:54:21 2008] [debug] mod_proxy_ajp.c(498): proxy: got response from 216.131.96.102:8009 (localhost)\n[Thu Jul 17 15:54:21 2008] [debug] proxy_util.c(2062): proxy: AJP: has released connection for (localhost)", "is_private": false, "bug_id": 45420, "id": 118783, "time": "2008-07-17T16:39:12Z", "creator": "david@reliablehosting.com", "creation_time": "2008-07-17T16:39:12Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 118794, "time": "2008-07-18T02:09:10Z", "bug_id": 45420, "creation_time": "2008-07-18T02:09:10Z", "is_private": false, "text": "As I suspected this is a configuration issue and not a bug. Please use\n\nProxyPassReverse / http://devsite.local/test/\n\nto get this right. As mentioned before Bugzilla is no user support forum but a bug reporting tool. So please try the users mailing list first when you encounter such problems."}]
[{"count": 0, "tags": [], "creator": "daniele@orlandi.com", "is_private": false, "text": "I'm experiencing high CPU utilization in the master process with httpd 2.0.44\ncompiled from scratch with prefork mpm under RedHat Linux 8.0 (gcc 3.2) with the\nlates errata kernel. All my httpds run in a chroot jail, some with mod_tls and\nmod_php and some without.\n\nServer version: Apache/2.0.44\nServer built:   Feb 24 2003 17:40:02\nServer's Module Magic Number: 20020903:0\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/prefork\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/opt/apache2\"\n -D SUEXEC_BIN=\"/opt/apache2/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_LOCKFILE=\"logs/accept.lock\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\n\nI'm assuming that the CPU utilization of the master process should be lower than\nthe one for the childs so I'm reporting this. If my assumption is wrong... well\nsorry :)\n\nThe utilization is proportional to the requests rate and much higher than the\nutilization for the childs. The server is responsive and quick.\n\n# ps xaf|grep httpd\n 7880 ?        S      1:53 /bin/httpd -f /conf/httpd.conf\n11343 ?        S      0:30  \\_ /bin/httpd -f /conf/httpd.conf\n24704 ?        S      0:02  \\_ /bin/httpd -f /conf/httpd.conf\n24887 ?        S      0:01  \\_ /bin/httpd -f /conf/httpd.conf\n24901 ?        S      0:01  \\_ /bin/httpd -f /conf/httpd.conf\n.....[20 more childs follow]\n\nThis is a strace of the master process for some second:\n\nselect(0, NULL, NULL, NULL, {0, 54684}) = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwrite(70, \"!\", 1)                       = 1\nsocket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 83\nfcntl64(83, F_GETFL)                    = 0x2 (flags O_RDWR)\nfcntl64(83, F_SETFL, O_RDWR|O_NONBLOCK) = 0\nconnect(83, {sin_family=AF_INET, sin_port=htons(80),\nsin_addr=inet_addr(\"212.110.160.123\")}}, 16) = -1 EINPROGRESS (Operation now in\nprogress)\npoll([{fd=83, events=POLLOUT, revents=POLLOUT}], 1, 3000) = 1\ngetsockopt(83, SOL_SOCKET, SO_ERROR, [0], [4]) = 0\nclose(83)                               = 0\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = ? ERESTARTNOHAND (To be restarted)\n--- SIGCHLD (Child exited) ---\nselect(0, NULL, NULL, NULL, {0, 990171}) = 0 (Timeout)\nwrite(70, \"!\", 1)                       = 1\nsocket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 83\nfcntl64(83, F_GETFL)                    = 0x2 (flags O_RDWR)\nfcntl64(83, F_SETFL, O_RDWR|O_NONBLOCK) = 0\nconnect(83, {sin_family=AF_INET, sin_port=htons(80),\nsin_addr=inet_addr(\"212.110.160.123\")}}, 16) = -1 EINPROGRESS (Operation now in\nprogress)\npoll([{fd=83, events=POLLOUT, revents=POLLOUT}], 1, 3000) = 1\ngetsockopt(83, SOL_SOCKET, SO_ERROR, [0], [4]) = 0\nclose(83)                               = 0\nwait4(-1, [WIFEXITED(s) && WEXITSTATUS(s) == 0], WNOHANG|WUNTRACED, NULL) = 26029\ngettimeofday({1047165258, 98807}, NULL) = 0\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = ? ERESTARTNOHAND (To be restarted)\n--- SIGCHLD (Child exited) ---\nselect(0, NULL, NULL, NULL, {0, 990171}) = 0 (Timeout)\nwrite(70, \"!\", 1)                       = 1\nsocket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 83\nfcntl64(83, F_GETFL)                    = 0x2 (flags O_RDWR)\nfcntl64(83, F_SETFL, O_RDWR|O_NONBLOCK) = 0\nconnect(83, {sin_family=AF_INET, sin_port=htons(80),\nsin_addr=inet_addr(\"212.110.160.123\")}}, 16) = -1 EINPROGRESS (Operation now in\nprogress)\npoll([{fd=83, events=POLLOUT, revents=POLLOUT}], 1, 3000) = 1\ngetsockopt(83, SOL_SOCKET, SO_ERROR, [0], [4]) = 0\nclose(83)                               = 0\nwait4(-1, [WIFEXITED(s) && WEXITSTATUS(s) == 0], WNOHANG|WUNTRACED, NULL) = 26075\ngettimeofday({1047165259, 99400}, NULL) = 0\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = ? ERESTARTNOHAND (To be restarted)\n--- SIGCHLD (Child exited) ---\nselect(0, NULL, NULL, NULL, {0, 996030}) = 0 (Timeout)\nwait4(-1, [WIFEXITED(s) && WEXITSTATUS(s) == 0], WNOHANG|WUNTRACED, NULL) = 26256\ngettimeofday({1047165260, 98021}, NULL) = 0\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwrite(70, \"!\", 1)                       = 1\nsocket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 83\nfcntl64(83, F_GETFL)                    = 0x2 (flags O_RDWR)\nfcntl64(83, F_SETFL, O_RDWR|O_NONBLOCK) = 0\nconnect(83, {sin_family=AF_INET, sin_port=htons(80),\nsin_addr=inet_addr(\"212.110.160.123\")}}, 16) = -1 EINPROGRESS (Operation now in\nprogress)\npoll([{fd=83, events=POLLOUT, revents=POLLOUT}], 1, 3000) = 1\ngetsockopt(83, SOL_SOCKET, SO_ERROR, [0], [4]) = 0\nclose(83)                               = 0\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = ? ERESTARTNOHAND (To be restarted)\n--- SIGCHLD (Child exited) ---\nselect(0, NULL, NULL, NULL, {0, 994077}) = 0 (Timeout)\nwait4(-1, [WIFEXITED(s) && WEXITSTATUS(s) == 0], WNOHANG|WUNTRACED, NULL) = 26199\ngettimeofday({1047165265, 96741}, NULL) = 0\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwrite(70, \"!\", 1)                       = 1\nsocket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 83\nfcntl64(83, F_GETFL)                    = 0x2 (flags O_RDWR)\nfcntl64(83, F_SETFL, O_RDWR|O_NONBLOCK) = 0\nconnect(83, {sin_family=AF_INET, sin_port=htons(80),\nsin_addr=inet_addr(\"212.110.160.123\")}}, 16) = -1 EINPROGRESS (Operation now in\nprogress)\npoll([{fd=83, events=POLLOUT, revents=POLLOUT}], 1, 3000) = 1\ngetsockopt(83, SOL_SOCKET, SO_ERROR, [0], [4]) = 0\nclose(83)                               = 0\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = ? ERESTARTNOHAND (To be restarted)\n--- SIGCHLD (Child exited) ---\nselect(0, NULL, NULL, NULL, {0, 996030}) = 0 (Timeout)\nwait4(-1, [WIFEXITED(s) && WEXITSTATUS(s) == 0], WNOHANG|WUNTRACED, NULL) = 26228\ngettimeofday({1047165268, 97936}, NULL) = 0\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwrite(70, \"!\", 1)                       = 1\nsocket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 83\nfcntl64(83, F_GETFL)                    = 0x2 (flags O_RDWR)\nfcntl64(83, F_SETFL, O_RDWR|O_NONBLOCK) = 0\nconnect(83, {sin_family=AF_INET, sin_port=htons(80),\nsin_addr=inet_addr(\"212.110.160.123\")}}, 16) = -1 EINPROGRESS (Operation now in\nprogress)\npoll([{fd=83, events=POLLOUT, revents=POLLOUT}], 1, 3000) = 1\ngetsockopt(83, SOL_SOCKET, SO_ERROR, [0], [4]) = 0\nclose(83)                               = 0\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = ? ERESTARTNOHAND (To be restarted)\n--- SIGCHLD (Child exited) ---\nselect(0, NULL, NULL, NULL, {0, 990171}) = 0 (Timeout)\nwait4(-1, [WIFEXITED(s) && WEXITSTATUS(s) == 0], WNOHANG|WUNTRACED, NULL) = 26097\ngettimeofday({1047165270, 99926}, NULL) = 0\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\ngettimeofday({1047165274, 98473}, NULL) = 0\nfork()                                  = 26277\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\ngettimeofday({1047165276, 99665}, NULL) = 0\nfork()                                  = 26284\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\ngettimeofday({1047165278, 101233}, NULL) = 0\nfork()                                  = 26288\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwait4(-1, 0xbfffde00, WNOHANG|WUNTRACED, NULL) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)", "id": 32727, "time": "2003-03-08T23:23:13Z", "bug_id": 17808, "creation_time": "2003-03-08T23:23:13Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 17808, "attachment_id": null, "id": 35600, "time": "2003-04-18T21:16:04Z", "creator": "daniele@orlandi.com", "creation_time": "2003-04-18T21:16:04Z", "is_private": false, "text": "The problem probably was related to CPU usage accounting in a redhat kernel.\n\nUpgrading to the last errata (2.4.18-27.8.0) seems to have fixed the problem."}, {"count": 2, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "text": "Thanks for your update. Closing this bug :)\n\nThanks for using Apache.", "id": 36731, "time": "2003-05-06T00:39:55Z", "bug_id": 17808, "creation_time": "2003-05-06T00:39:55Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 50282, "attachment_id": null, "is_private": false, "id": 141753, "time": "2010-11-16T20:14:17Z", "creator": "justin.almquist@pnl.gov", "creation_time": "2010-11-16T20:14:17Z", "text": "The class javax.security.auth.login.LoginContext has a \"contextClassLoader\" field that I believe is causing a similar problem as identified in bug #49669, which is related to the class not being garbage collected even though the application has been undeployed.\n\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=49669\n\nI was able to notice this by deploying a very simple spring-based webapp that utilizes javax.security for authentication in which the LoginContext class is used.\n\nI then used YourKit profiler as specified in this writeup to find any lingering classes without instances:\n\nhttp://www.yourkit.com/docs/kb/class_loaders.jsp\n\nThe following class had the most instances (inside of a WebappClassLoader):\n\"contextClassLoader of javax.security.auth.login.Configuration [Class]\"\n\nThis looks almost identical to bug #49669 with the only difference being that the contextClassLoader field isn't static, however it is initialized in a static code block.  Thus, it looks like the solution for bug #49669 would solve this problem as well."}, {"count": 1, "tags": [], "bug_id": 50282, "text": "I think I confused myself a little while researching this and somehow referenced javax.security.auth.login.LoginContext when in fact I *meant* javax.security.auth.login.Configuration.  The LoginContext may be a problem as well, however the Configuration class is what is being listed in YourKit as the offending class causing the WebappClassloader to stick around.  Once again, here's the output of YourKit:\n\n\"contextClassLoader of javax.security.auth.login.Configuration [Class]\"\n\n\nThen, looking at the code for Configuration (http://kickjava.com/src/javax/security/auth/login/Configuration.java.htm), the following line of code is similar to the problem fixed by bug #49669 (https://issues.apache.org/bugzilla/show_bug.cgi?id=49669)\n\n\"private static ClassLoader  JavaDoc contextClassLoader;\"\n\n\nSorry for any confusion...", "id": 141771, "attachment_id": null, "creator": "justin.almquist@pnl.gov", "creation_time": "2010-11-17T13:47:15Z", "time": "2010-11-17T13:47:15Z", "is_private": false}, {"count": 2, "tags": [], "creator": "slaurent@apache.org", "text": "Created attachment 26309\npatch for tc 7\n\nHere is a patch for tc 7. It just loads the faulty class in the JreMemoryLeakPreventionListener:\nClass.forName(\"javax.security.auth.login.Configuration\", true, ClassLoader.getSystemClassLoader());", "id": 141804, "time": "2010-11-18T16:53:47Z", "bug_id": 50282, "creation_time": "2010-11-18T16:53:47Z", "is_private": false, "attachment_id": 26309}, {"count": 3, "tags": [], "bug_id": 50282, "text": "Is there any recipe how to reproduce this issue? (A sample webapp, and/or configuration)?", "id": 141812, "attachment_id": null, "creator": "knst.kolinko@gmail.com", "creation_time": "2010-11-18T19:49:56Z", "time": "2010-11-18T19:49:56Z", "is_private": false}, {"count": 4, "tags": [], "text": "I don't have a sample webapp, however this article describes exactly how we setup our authentication mechanism using JAAS:\n\nhttp://download.oracle.com/javase/1.4.2/docs/guide/security/jgss/tutorials/AcnOnly.html", "is_private": false, "bug_id": 50282, "id": 141855, "time": "2010-11-19T16:19:34Z", "creator": "justin.almquist@pnl.gov", "creation_time": "2010-11-19T16:19:34Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 50282, "is_private": false, "count": 5, "id": 142351, "time": "2010-12-03T17:21:17Z", "creator": "slaurent@apache.org", "creation_time": "2010-12-03T17:21:17Z", "text": "patch applied on trunk, will be available for tomcat 7.0.6\nBackport to tomcat 6 proposed."}, {"attachment_id": null, "tags": [], "bug_id": 50282, "is_private": false, "count": 6, "id": 143198, "time": "2011-01-08T14:24:12Z", "creator": "markt@apache.org", "creation_time": "2011-01-08T14:24:12Z", "text": "Applied to 6.0.x and will be included in 6.0.30 onwards."}]
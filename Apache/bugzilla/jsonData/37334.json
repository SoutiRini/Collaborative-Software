[{"count": 0, "attachment_id": null, "bug_id": 37334, "is_private": false, "id": 82054, "time": "2005-11-02T16:32:11Z", "creator": "andrea.pompili@inwind.it", "creation_time": "2005-11-02T16:32:11Z", "tags": [], "text": "I noticed that if you set up the \"digest\" property on a Authentication Realm \n(Memory, LDAP or whatever you want) you have to put the password digested \ndirectly in the repository but you can't use the administration console because \nthe code allows the correct use of the digested password only in the \nauthenticate method (RealmBase.java) and not in in the addUser one or in the \nGenericPrincipal class.\nThe effect is that (for example using a Memory local database) the password is \nset in clear on the configuration file (tomcat-users.xml) and the \nauthentication fails because the system try to chek it after digesting...\n\nHere,s the differences:\n\n    public Principal authenticate(String username, String credentials) {\n        GenericPrincipal principal = (GenericPrincipal)principals.get(username);\n        boolean validated = false;\n        if (principal != null)\n            if (hasMessageDigest())  ....... etc etc (password is checked \nencrypted)\n\n\n    void addUser(String username, String password, String roles) {\n           ....\n\n           GenericPrincipal principal = new GenericPrincipal(this, username, \npassword, list);\n           principals.put(username, principal);\n\n           ... (password now is in clear)\n  \n    }"}, {"count": 1, "tags": [], "bug_id": 37334, "attachment_id": null, "id": 83060, "time": "2005-12-01T05:04:18Z", "creator": "yoavs@computer.org", "creation_time": "2005-12-01T05:04:18Z", "is_private": false, "text": "Did you really mean to select version 5.0.31 for this?  Does it also happen on\n5.5.12?"}, {"count": 2, "attachment_id": null, "bug_id": 37334, "is_private": false, "id": 83328, "time": "2005-12-06T20:04:38Z", "creator": "andrea.pompili@inwind.it", "creation_time": "2005-12-06T20:04:38Z", "tags": [], "text": "(In reply to comment #1)\n> Did you really mean to select version 5.0.31 for this?  Does it also happen on\n> 5.5.12?\n\nYes, the problem was tested both in a 5.5 and a 5.0 version of Tomcat (I don't \nknow why it was selected 5.0.31 because I didn't set anything).\nBesides that I looked inside version 5.5.12 and the methods and classes \ninvolved are also the \"createUser\" inside MemoryUserDatabase (it's the same \nalso in other similar factories) and the \"AbstractUser\" class that do \nsetPassword in clear for the console mBean...\n "}, {"count": 3, "tags": [], "bug_id": 37334, "attachment_id": 19051, "id": 95199, "time": "2006-10-29T17:08:26Z", "creator": "markt@apache.org", "creation_time": "2006-10-29T17:08:26Z", "is_private": false, "text": "Created attachment 19051\nProposed patch\n\nThis is still an issue in 5.5.x (I'll update the version) and I was about to\ncommit a simple patch for it (attached) when I remembered that things get more\ncomplicated if DIGEST authentication is used along with digested passwords.\nCorrect generation of the digest for a new user requires knowledge of the realm\nconfiguration and the configuration of the web applications using the realm.\nImplementing this would require a more invasive patch for UserDatabase than I\nam happy with at the moment.\n\nGiven that system administrators have to manually generate the digest and then\nupdate the relevant database, file, directory etc then the UserDatabase admin\ninterface is really no different at this point. I am therefore marking this as\nan enhancement request but I can't, at the moment, see a patch to do this that\nI would be happy with."}, {"count": 4, "attachment_id": null, "bug_id": 37334, "is_private": false, "id": 97222, "time": "2006-12-24T08:50:40Z", "creator": "yoavs@computer.org", "creation_time": "2006-12-24T08:50:40Z", "tags": [], "text": "I tend to agree with you, Mark, on this issue.  Setting to NEEDINFO until a\nfurther patch is proposed.  If no such patch is proposed in a few months, we'll\nsee what to do."}, {"count": 5, "attachment_id": null, "bug_id": 37334, "is_private": false, "id": 146488, "time": "2011-05-20T19:12:54Z", "creator": "markt@apache.org", "creation_time": "2011-05-20T19:12:54Z", "tags": [], "text": "The administration web application no longer exists in 6.0.x onwards. The\ndirection things are moving in (slowly) is to generally improve the JMX\ninterface."}]
[{"count": 0, "tags": [], "bug_id": 58371, "attachment_id": null, "is_private": false, "id": 185128, "time": "2015-09-12T01:25:15Z", "creator": "yilong.li@runtimeverification.com", "creation_time": "2015-09-12T01:25:15Z", "text": "Reported by RV-Predict (a dynamic race detector) when running the test suite:\nData race on field org.apache.tomcat.util.buf.MessageBytes.hasStrValue: {{{\n    Concurrent read in thread T18 (locks held: {Monitor@56dc46b6})\n ---->  at org.apache.tomcat.util.buf.MessageBytes.toString(MessageBytes.java:156)\n        at org.apache.catalina.connector.Request.getRequestURI(Request.java:2178)\n        at org.apache.catalina.core.AsyncContextImpl.dispatch(AsyncContextImpl.java:202)\n        - locked Monitor@56dc46b6 at org.apache.catalina.core.AsyncContextImpl.dispatch(AsyncContextImpl.java:192) \n        at org.apache.catalina.core.AsyncContextImpl.dispatch(AsyncContextImpl.java:187)\n        at org.apache.catalina.core.TestAsyncContextImpl$DispatchingServlet$1.run(TestAsyncContextImpl.java:710)\n    T18 is created by T17\n        at org.apache.catalina.core.TestAsyncContextImpl$DispatchingServlet.doGet(TestAsyncContextImpl.java:715)\n\n    Concurrent write in thread T17 (locks held: {Monitor@74cf9f3a})\n ---->  at org.apache.tomcat.util.buf.MessageBytes.toString(MessageBytes.java:167)\n        at org.apache.coyote.RequestInfo.updateCounters(RequestInfo.java:167)\n        at org.apache.coyote.Request.updateCounters(Request.java:566)\n        at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1153)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:673)\n        at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:277)\n        - locked Monitor@74cf9f3a at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:259) \n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n    T17 is created by T15\n        at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:1010)\n}}}\n\nConsider declaring hasStrValue as volatile to avoid instructions reordering?"}, {"count": 1, "tags": [], "creator": "yilong.li@runtimeverification.com", "attachment_id": null, "text": "One more report on field strValue:\nData race on field org.apache.tomcat.util.buf.MessageBytes.strValue: {{{\n    Concurrent read in thread T20 (locks held: {Monitor@45a7152e})\n ---->  at org.apache.tomcat.util.buf.MessageBytes.toString(MessageBytes.java:157)\n        at org.apache.catalina.connector.Request.getRequestURI(Request.java:2178)\n        at org.apache.catalina.connector.Request.getContextPath(Request.java:1918)\n        at org.apache.catalina.core.AsyncContextImpl.dispatch(AsyncContextImpl.java:203)\n        - locked Monitor@45a7152e at org.apache.catalina.core.AsyncContextImpl.dispatch(AsyncContextImpl.java:192)\n        at org.apache.catalina.core.AsyncContextImpl.dispatch(AsyncContextImpl.java:187)\n        at org.apache.catalina.core.TestAsyncContextImpl$DispatchingServlet$1.run(TestAsyncContextImpl.java:710)\n    T20 is created by T19\n        at org.apache.catalina.core.TestAsyncContextImpl$DispatchingServlet.doGet(TestAsyncContextImpl.java:715)\n\n    Concurrent write in thread T19 (locks held: {Monitor@75c39be9})\n ---->  at org.apache.tomcat.util.buf.MessageBytes.toString(MessageBytes.java:166)\n        at org.apache.coyote.RequestInfo.updateCounters(RequestInfo.java:167)\n        at org.apache.coyote.Request.updateCounters(Request.java:566)\n        at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1153)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:673)\n        at org.apache.tomcat.util.net.Nio2Endpoint$SocketProcessor.doRun(Nio2Endpoint.java:1074)\n        at org.apache.tomcat.util.net.Nio2Endpoint$SocketProcessor.run(Nio2Endpoint.java:1033)\n        - locked Monitor@75c39be9 at org.apache.tomcat.util.net.Nio2Endpoint$SocketProcessor.run(Nio2Endpoint.java:1032)\n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n    T19 is created by T18\n        at java.util.concurrent.ThreadPoolExecutor.addWorker(ThreadPoolExecutor.java:1010)\n}}}", "id": 185152, "time": "2015-09-12T16:30:10Z", "bug_id": 58371, "creation_time": "2015-09-12T16:30:10Z", "is_private": false}, {"count": 2, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "root cause is trying to build the request statistics when switching from sync to async rather than waiting until the request processing is complete.\n\nFixed in trunk and 8.0.x for 8.0.27 onwards.", "id": 185227, "time": "2015-09-14T15:43:46Z", "bug_id": 58371, "creation_time": "2015-09-14T15:43:46Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "*** Bug 58399 has been marked as a duplicate of this bug. ***", "id": 185333, "time": "2015-09-18T08:58:57Z", "bug_id": 58371, "creation_time": "2015-09-18T08:58:57Z", "attachment_id": null}]
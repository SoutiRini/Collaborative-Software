[{"count": 0, "tags": [], "bug_id": 54686, "text": "Created attachment 30044\nDataFormatter changes\n\nSome Excel formats are displayed incorrect in the application (fractional, accounting and currency formats).\n\nFor example, this formats displays incorrect:\n\nCategory - Fraction:\n1/4   (Up to one digit (1/4) cell type)    --> 0/\n21/25 (Up to two digits (21/25) cell type) --> 1/\n1/2   (As halves (1/2) cell type)          --> 0/2\n2/4   (As quarters (2/4) cell type)        --> 0/4\n\nCategory - Accounting:\n0,001000000   (Decimal places - 9, Symbol - \u0440.)               --> 0,00\n$ 1,234567890 (Decimal places - 9, Symbol - $English(Canada)) --> 1,23\n\nCategory - Currency:\n0,001000000   (Decimal places - 9, Symbol - \u0440.)               --> 0,00\n$ 1,234567890 (Decimal places - 9, Symbol - $English(Canada)) --> 1,23", "id": 165793, "attachment_id": 30044, "creator": "Razr9@mail.ru", "creation_time": "2013-03-13T12:30:34Z", "time": "2013-03-13T12:30:34Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 54686, "text": "Are you able to work up a quick unit test to go with this? Just something that tries to format a couple of different numbers with each of the formats. That way, we'll know it's fixed, and we'll also be able to make sure it doesn't get broken in future!", "id": 165794, "attachment_id": null, "creator": "apache@gagravarr.org", "creation_time": "2013-03-13T13:15:30Z", "time": "2013-03-13T13:15:30Z", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 30430\n3/4's of a patch, might be good enough\n\nThanks to Ryan Krueger and https://issues.apache.org/jira/browse/TIKA-1132 for the custom formatting test case on fractions.  I added some test cases, and offer a 3/4's patch.  This patch passes 3148 tests and fails on 38.  Without the patch, there are 3062 failurs and 124 successes.\n\nI refactored the fraction calculator to avoid the n^2 calculations that could lead to 100,000,000 calculations if the format was ##/####.  By \"refactored,\" I mean copied and pasted from org.apache.math.fraction.", "is_private": false, "id": 167812, "creator": "tallison@mitre.org", "time": "2013-06-13T19:45:14Z", "bug_id": 54686, "creation_time": "2013-06-13T19:45:14Z", "attachment_id": 30430}, {"count": 3, "tags": [], "bug_id": 54686, "attachment_id": null, "id": 167814, "time": "2013-06-13T21:31:47Z", "creator": "apache@gagravarr.org", "creation_time": "2013-06-13T21:31:47Z", "is_private": false, "text": "We debated adding a dependency on commons math, but decided against it. Copying their code is probably more sensible, though someone came up with a contribution which we accepted in the mean time...\n\nHopefully someone with slightly stronger math skills can offer an opinion on your suggested fix!"}, {"count": 4, "tags": [], "bug_id": 54686, "is_private": false, "id": 167815, "attachment_id": 30431, "creator": "tallison@mitre.org", "creation_time": "2013-06-13T23:53:47Z", "time": "2013-06-13T23:53:47Z", "text": "Created attachment 30431\npatch for fraction format\n\nCompletely agree.  Should have stepped away from the computer before submitting the last.  This passes all tests.  Still only handles fraction formatting."}, {"count": 5, "tags": [], "bug_id": 54686, "attachment_id": null, "id": 167925, "time": "2013-06-20T13:38:17Z", "creator": "apache@gagravarr.org", "creation_time": "2013-06-20T13:38:17Z", "is_private": false, "text": "Thanks for this patch Tim!\n\nFor the unit test, I renamed it to TestFractionFormat + changed package, and updated how it gets the test text file to be consistent with the xls, as well as re-enabling the single test\n\nOne thing I've just found - inner class Fraction of CellNumberFormat - seems to do something similar. Any chance you could cast an eye over it, and decide if we can rationalise / refactor to just have the one?\n\nPatch applied (with tweaks described above) in r1494986, thanks"}, {"count": 6, "tags": [], "creator": "tallison@mitre.org", "attachment_id": null, "text": "(In reply to Nick Burch from comment #5)\n> Thanks for this patch Tim!\n> \n> For the unit test, I renamed it to TestFractionFormat + changed package, and\n> updated how it gets the test text file to be consistent with the xls, as\n> well as re-enabling the single test\n> \n> One thing I've just found - inner class Fraction of CellNumberFormat - seems\n> to do something similar. Any chance you could cast an eye over it, and\n> decide if we can rationalise / refactor to just have the one?\n> \n> Patch applied (with tweaks described above) in r1494986, thanks\n\nThank you, Nick.  Will do.", "id": 167930, "time": "2013-06-20T15:08:50Z", "bug_id": 54686, "creation_time": "2013-06-20T15:08:50Z", "is_private": false}, {"count": 7, "tags": [], "text": "Created attachment 30981\nFraction cells in 2003 format\n\nAdding an excel sheet suitable for use as test of fraction formatting, HTH", "is_private": false, "id": 170877, "creator": "chrislott@maultech.com", "time": "2013-10-28T13:08:37Z", "bug_id": 54686, "creation_time": "2013-10-28T13:08:37Z", "attachment_id": 30981}, {"count": 8, "tags": [], "creator": "tallison@mitre.org", "is_private": false, "text": "Thank you, Chris.  POI-55419 covers the examples you offered.  Fraction formatting is still not perfect...there are some rounding differences btwn Java and MSExcel...but I think the fraction component of this issue should be closed.  \n\nI haven't had a chance to look into the currency and accounting items that are raised by this issue.  If you have a need and POI is failing for you in those areas, please submit a file that shows those problems.\n\nThank you, again!", "id": 170889, "time": "2013-10-28T18:27:02Z", "bug_id": 54686, "creation_time": "2013-10-28T18:27:02Z", "attachment_id": null}, {"count": 9, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "text": "Just in case it isn't clear - we're still waiting on some new tests (unit test + sample file) that shows up the last remaining parts of this issue around currenct / accounting formatting\n\nWith those, it should be possible to investigate what logic changes are still needed, then work on those.", "id": 176776, "time": "2014-07-30T16:16:42Z", "bug_id": 54686, "creation_time": "2014-07-30T16:16:42Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 54686, "attachment_id": null, "id": 185943, "time": "2015-10-25T21:50:37Z", "creator": "apache@gagravarr.org", "creation_time": "2015-10-25T21:50:37Z", "is_private": false, "text": "The currency / accounting pieces may have been solved by the work for #58536, or at least partially, would be great if someone could check and write a unit test for any parts that remain outstanding!"}]
[{"count": 0, "tags": [], "creator": "twapache@online.de", "is_private": false, "text": "Created attachment 29152\nant-generated patch file (no new files, only changes to existing source)\n\nFor a detailed analysis of the formula evalution - especially in cases of exceptions or wrong results - a detailed logging of the recursive evaluation is very helpful.\nI needed this for a very complex XLS to find the missing POI implementations (I will add them as separate patch).\n\nUsage documentation with source extract is given in documentation/content/xdocs/spreadsheet/eval.xml at the end (I did not test the HTML generation for this).\n\nChanges in detail:\n\n- org/apache/poi/ss/formula/WorkbookEvaluator.java\n  * The main extension go here, inside evaluateFormula().\n  * see spreadsheet/eval.xml and source comments for details\n  * Note: I know, the use of a public static attribute is a no-go for real code, but this is for specific development use only, simple to use in this way, and worst case situation is missing or surplus logging.\n\n- SystemOutLogger.java\n  * added a shortcut of the log level in the output (helps to find good logging configuration)\n\n- POILogger.java\n  * made log level constants final\n  * added string representation for the log levels (used by SystemOutLogger)\n\n- org/apache/poi/hssf/usermodel/HSSFSheet.java\n  * Bugfix for logging because \"cval\" is not always an instance of Record (results in ClassCastExceptions when logging is on debug level).\n  * added {..} around some not very simple one-line if-blocks\n\nTested with HSSFWorkbook only.", "id": 161061, "time": "2012-08-02T12:58:20Z", "bug_id": 53642, "creation_time": "2012-08-02T12:58:20Z", "attachment_id": 29152}, {"count": 1, "tags": [], "bug_id": 53642, "attachment_id": null, "id": 161266, "time": "2012-08-11T17:26:19Z", "creator": "yegor@dinom.ru", "creation_time": "2012-08-11T17:26:19Z", "is_private": false, "text": ">* Note: I know, the use of a public static attribute is a no-go for real code, \n>but this is for specific development use only, simple to use in this way, and \n>worst case situation is missing or surplus logging.\n\nWhy did you make dbgEvaluationOutputForNextEval static ? It is an instance-scope variable and it is much better to set it per-evaluator.\n\nThat is, user code woulde change from\n\nWorkbookEvaluator.dbgEvaluationOutputForNextEval = true;\nevaluator.evaluateFormulaCell(cell);\n\nto\n\nevaluator.dbgEvaluationOutputForNextEval = true;\nevaluator.evaluateFormulaCell(cell);\n\nor even better:\n\nevaluator.setDebugEvaluationOutputForNextEval(true);\nevaluator.evaluateFormulaCell(cell);\n\nI agree that a \"public static\" modifier is a \"no go\" for production but since POI is a public program API we should minimize possibilities of its incorrect usage. \n\nRegards,\nYegor"}, {"count": 2, "tags": [], "creator": "superrubiroyd@gmail.com", "attachment_id": null, "text": "Thanks for your patch.\n\nApplied in revision 53642.\nI've added changes that Yegor proposed.\n\nRegards, Evgeniy.", "id": 161950, "time": "2012-09-04T21:05:01Z", "bug_id": 53642, "creation_time": "2012-09-04T21:05:01Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 53642, "attachment_id": 29332, "is_private": false, "id": 161964, "time": "2012-09-05T13:00:41Z", "creator": "twapache@online.de", "creation_time": "2012-09-05T13:00:41Z", "text": "Created attachment 29332\nPatch for \"ss\" package level interface\n\nThanks for your changes Evgeniy. I did not see the connection from the user API (FormulaEvaluator) to the implementation (WorkbookEvaluator) - this private instance variable is better!\n\nThis patch adds generic user model (\"ss\" package) support, i.e. in the FormulaEvaluator interface and the XSSF implementation. The usage docs are adjusted accordingly."}, {"count": 4, "tags": [], "bug_id": 53642, "attachment_id": null, "id": 161975, "time": "2012-09-05T17:05:35Z", "creator": "superrubiroyd@gmail.com", "creation_time": "2012-09-05T17:05:35Z", "is_private": false, "text": "Thanks, for updated patch\n\nApplied in revision 1381249\n\nRegards, Evgeniy"}]
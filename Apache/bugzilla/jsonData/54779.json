[{"count": 0, "tags": [], "bug_id": 54779, "is_private": false, "id": 166288, "creation_time": "2013-04-01T13:53:43Z", "time": "2013-04-01T13:53:43Z", "creator": "colin@mageia.org", "text": "Hi,\n\nUnder certain circumstances, apr_sockaddr_info_get() can return APR_SUCCESS but fail to fill in the sockaddr argument with valid data, leaving it NULL.\n\nCalling code may use the return value to assume that all is well and sockaddr has been filled and then pass it to further functions.\n\nCode in apache 2.4.4 does exactly this. e.g. from server/util.c:\n\n            if (apr_sockaddr_info_get(&sockaddr, str, APR_UNSPEC, 0, 0, a) == APR_SUCCESS) {\n                if ( (apr_getnameinfo(&hostname, sockaddr, 0) == APR_SUCCESS) &&\n\n\nSadly, apr_getnameinfo() does not sanitise it's input and even when sockaddr is null, it dereferences it resulting in a segv.\n\nI will attach two fixes for correcting incorrect APR_SUCCESS return value, but I did not do any work to add sanity checks to apr_getnameinfo() although I would highly recommend this be done also.", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 54779, "is_private": false, "id": 166289, "creation_time": "2013-04-01T13:55:13Z", "time": "2013-04-01T13:55:13Z", "creator": "colin@mageia.org", "text": "Created attachment 30125\nFix return value when glibc returns bogus data to us which we ignore.", "attachment_id": 30125}, {"count": 2, "tags": [], "text": "Created attachment 30126\nAdditional fix to not blindly return errno on getaddrinfo() returns EAI_SYSTEM", "is_private": false, "bug_id": 54779, "id": 166290, "time": "2013-04-01T13:56:06Z", "creator": "colin@mageia.org", "creation_time": "2013-04-01T13:56:06Z", "attachment_id": 30126}, {"count": 3, "tags": [], "text": "Note without these fixes (and in particular the second patch) the backtrace from apache was:\nhttps://bugs.mageia.org/attachment.cgi?id=3680\n\nDownstream bug report:\nhttps://bugs.mageia.org/show_bug.cgi?id=9579", "is_private": false, "bug_id": 54779, "id": 166291, "time": "2013-04-01T13:57:10Z", "creator": "colin@mageia.org", "creation_time": "2013-04-01T13:57:10Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Thanks for the patches, though I saw the patches from a different report first. Fixes are at:\n\nhttp://svn.apache.org/r1478905 trunk\nhttp://svn.apache.org/r1478909 1.5\nhttp://svn.apache.org/r1478911 1.4", "is_private": false, "bug_id": 54779, "id": 167015, "time": "2013-05-03T18:46:07Z", "creator": "sf@sfritsch.de", "creation_time": "2013-05-03T18:46:07Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 54779, "attachment_id": null, "id": 172590, "time": "2014-01-21T12:55:40Z", "creator": "trawick@apache.org", "creation_time": "2014-01-21T12:55:40Z", "is_private": false, "text": "Fixed in apr 1.4.7 and later releases..."}]
[{"count": 0, "tags": [], "text": "The protection mechanism against session fixation attacks available in Tomcat 6.0.24 has the problem that if a Valve or a custom Authenticator implementation enforces creation of an HTTP session for a request and the JSESSIONID is created before the authenticator registers the session and it is required to change the session id (which is the default behavior) then instead of changing the session id a second one is issued and both are sent to the user agent.\n\nHere is the details on how I encounter the problem:\nDuring authentication my Authenticator implementation requires access to the HTTP session before it invokes method register(request, response, principal, authType, username, password). When it accesses the HTTP session the Response is instructed to send Set-Cookie with a newly generated JSESSIONID and immediately after that - as part of the register method invocation - the Request is instructed to change the JSESSIONID. The problem is that Request.changeSessionId does not check whether the response is already instructed to issue a Set-Cookie header for the session ID and simply adds a second cookie to be sent to the browser. The HTTP response contains two Set-Cookie headers for JSESSIONID with different values, where the second is the newest one. As MS IE uses the first cookie it receives it is\nnot able to connect to the session with next requests.\n\nCan you confirm this is not the intended behavior and let me know when this problem can be corrected?", "attachment_id": null, "bug_id": 48913, "id": 135350, "time": "2010-03-15T08:05:45Z", "creator": "stephan.zlatarev@yahoo.com", "creation_time": "2010-03-15T08:05:45Z", "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 135801, "time": "2010-03-30T21:59:05Z", "bug_id": 48913, "creation_time": "2010-03-30T21:59:05Z", "is_private": false, "text": "I can confirm that the current implementation does not expect other components to force the creation of a session earlier in the pipeline.\n\nThis looks to be fixable but I'm worried about the overhead that will be associated with the fix. My performance concerns may be unfounded but if you were able to find an alternative solution (eg not requiring the session to be created in your custom authenticator) then that might be a better overall solution."}, {"count": 2, "attachment_id": 25219, "bug_id": 48913, "is_private": false, "id": 135803, "time": "2010-03-30T23:06:18Z", "creator": "markt@apache.org", "creation_time": "2010-03-30T23:06:18Z", "tags": [], "text": "Created attachment 25219\nProposed patch to remove previously set session cookies\n\nI haven't applied the attached patch to trunk. I'd appreciate some feedback onthe patch before I do."}, {"count": 3, "tags": [], "bug_id": 48913, "attachment_id": null, "text": "*** Bug 49158 has been marked as a duplicate of this bug. ***", "id": 136269, "time": "2010-04-20T13:12:35Z", "creator": "markt@apache.org", "creation_time": "2010-04-20T13:12:35Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 48913, "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of bug 49158 ***", "id": 136273, "time": "2010-04-20T13:17:04Z", "creator": "fhanik@apache.org", "creation_time": "2010-04-20T13:17:04Z", "is_private": false}]
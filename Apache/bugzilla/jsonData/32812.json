[{"count": 0, "attachment_id": null, "bug_id": 32812, "text": "Sometimes, a page from my server is offered as text/plain when they are not.\nYou can trigger this by clearing the brower cache, going to the main page, \nselecting CV and the one other, photography and the going back to CV, if you \nload the page you will have to clear the cashe again, but if you don't locad the \npage, wait a bit, a few seconds, and then try to get the same page that error'd, \nit will load correctly.\n\nI have to say that it does take some perserverence of the user to trigger this \nbug.\n\nI have checked the pages on w3c's site and they are aparently ok, so I am \nsuspecting the server (unfortunatly).", "id": 68869, "time": "2004-12-22T22:54:09Z", "creator": "stephen@g6dzj.demon.co.uk", "creation_time": "2004-12-22T22:54:09Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "creator": "petri.suutarinen@pp1.inet.fi", "text": "I found out the same problem. I have Apache 2.0.50 and Mandrake 10.1. The \ncontent-type is changed to default mime type after hitting referesh multiply \ntimes. I have disabled proxies and other software running so this looks \ndefinitely as an Apache problem. The interesting part was that if I added i.e. \nmy css/html file to Document root I wasn't able to see the problem. However \nwhen I created new directory and added test files there the problem occured.\n\nI haven't touched mime type configuration manually. Basicly the configuration \nis Mandrake 10.1 default.", "count": 1, "id": 71748, "time": "2005-03-03T08:07:20Z", "bug_id": 32812, "creation_time": "2005-03-03T08:07:20Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 32812, "attachment_id": null, "is_private": false, "id": 75842, "time": "2005-06-03T00:32:48Z", "creator": "chip@force-elite.com", "creation_time": "2005-06-03T00:32:48Z", "text": "We need more information on what causes this.  I have not seen anything like\nthis in production."}, {"attachment_id": null, "tags": [], "creator": "gustavo@angulosolido.pt", "is_private": false, "count": 3, "id": 76414, "time": "2005-06-15T02:53:56Z", "bug_id": 32812, "creation_time": "2005-06-15T02:53:56Z", "text": "I can confirm this behaviour to happen, with default apache2 install with\nmandrake 10.1.\n\n[root@]# rpm -q apache2\napache2-2.0.50-7.2.101mdk\n[root@]#\n\nIt is difficult to reproduce this directly, but if using squid proxy, you can\nreproduce it easily with the following steps:\n\n0. configure Firefox to use a proxy server, running squid\n1. clear Firefox cache\n2. go to http://mysite/myfile.html\n3. observe that Firefox shows the html source code, instead of the rendering page\n4. check that the squid log is something like:\n\n1118795583.631  http://mysite/myfile.html  344 192.168.1.100 TCP_MISS/200 11670\nGET  - DIRECT/195.23.112.199 text/plain\n\n(note the http code 200, which means it was actually downloaded from the server)\n\n5. reload with page with ctrl+R as many times as desired, and verify that the\ndocument remains as text\n\n(firefox issues a \"load only if changed\" request, squid receives a code 304 from\napache, so the page isn't downloaded again)\n\n6. hit shift+ctrl+R and check that the page is now rendered, as squid receives\ntext/html which is then handed to Firefox. The squid log line is now:\n\n1118796256.885 http://mysite/myfile.html 397 192.168.1.100\nTCP_CLIENT_REFRESH_MISS/200 11659 GET  - DIRECT/195.23.112.199 text/html\n\n7. from now on, as long as the browser cache lives, the result will be correct,\nno matter if you reload it with ctrl+R or shift+ctrl+R\n\nFrom this scenario I would guess that there is some difference between the http\nrequests sent by squid to apache on the first browser request and all the\nfollowing ones, that triggers the bug.\n\nNote:\n\nThis is not reproducible with Internet Explorer, since (as everyone knows\nalready) it ignores the Contet Type information present in the http replies.\nThus it receives text/plain from squid but renders the web page normally.\n\n"}, {"count": 4, "tags": [], "bug_id": 32812, "text": "some additional notes:\n\n- this can be verified with wget simply by wgeting the site trough a proxy (set\nthe http_proxy variable for wget ...). In this case one doesn't have to worry\nabout the \"browser cache\" so the text is even easier\n\n- the \"root\" of the site, http://mysite/ returns http code 404, if downloaded\nthrough squid \n(but particular files http://mysite/myfile.html will allways return 200 and are\nreceived as plain text as explained before)", "id": 76416, "time": "2005-06-15T02:59:41Z", "creator": "gustavo@angulosolido.pt", "creation_time": "2005-06-15T02:59:41Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 32812, "is_private": false, "text": "is this dependent on using a squid proxy?\n\nYou make it sound like it only happens when using a Squid proxy.  Can you test\nit directly?\n\nCan you capture the requests that Squid is sending to apache? (tcpdump?)\n", "id": 76419, "time": "2005-06-15T07:38:26Z", "creator": "chip@force-elite.com", "creation_time": "2005-06-15T07:38:26Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "gustavo@angulosolido.pt", "is_private": false, "id": 76424, "time": "2005-06-15T11:00:38Z", "bug_id": 32812, "creation_time": "2005-06-15T11:00:38Z", "tags": [], "text": "I think it is _not_ dependent on using a squid proxy (see the comments from the\nprevious reporters).\n\nI once managed to make the w3c validator complain that the server was sending\ntext/plain (http://validator.w3.org/) - I guess the validator doesn't use a\nproxy or else it would not be useful...\n\nThat said, I could never reproduce it with firefox, unless I was using squid\n(tested with 3 different squid installations) in the middle.\n\nAlso, the comments from the first reporter mentions that \"does take some\nperserverence\" to reproduce it... However, reproducing it through squid is very\neasy.\n\nIn short: directly works most of the time, trhough squid fails most of the time.\n\nI will provide the tcpdump output ASAP."}, {"count": 7, "attachment_id": 15428, "creator": "gustavo@angulosolido.pt", "text": "Created attachment 15428\napache and suiqd logs plus snort output dump", "id": 76439, "time": "2005-06-16T03:54:32Z", "bug_id": 32812, "creation_time": "2005-06-16T03:54:32Z", "tags": [], "is_private": false}, {"count": 8, "attachment_id": null, "creator": "gustavo@angulosolido.pt", "text": "Hello again,\n\nI just submited selective squid and apache logs plus a snort dump to help on\nresolving this issue.\n\nThe attached archive contains 3 directories:\n\nclear evidence - evidence that apache returns text/plain on the first squid\nrequest (from empty squid and firefox caches)\n\nroot - conversation log for http://mysite/ requests\nfile - conversation log for http://mysite/myfile.html requests\n\nI hope this helps.\n\nBest regards\nGustavo", "id": 76440, "time": "2005-06-16T03:55:33Z", "bug_id": 32812, "creation_time": "2005-06-16T03:55:33Z", "tags": [], "is_private": false}, {"count": 9, "attachment_id": null, "bug_id": 32812, "text": "The offending server packet seems to be:\n\n=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+\n\n06/16-02:44:58.985296 195.23.112.199:80 -> 195.23.156.165:2599\nTCP TTL:63 TOS:0x0 ID:40402 IpLen:20 DgmLen:436 DF\n***AP*** Seq: 0xE259264D  Ack: 0xD86B0C7D  Win: 0x6AC  TcpLen: 32\nTCP Options (3) => NOP NOP TS: 578141109 442694553\n48 54 54 50 2F 31 2E 31 20 32 30 30 20 4F 4B 0D  HTTP/1.1 200 OK.\n0A 44 61 74 65 3A 20 54 68 75 2C 20 31 36 20 4A  .Date: Thu, 16 J\n75 6E 20 32 30 30 35 20 30 31 3A 34 34 3A 35 38  un 2005 01:44:58\n20 47 4D 54 0D 0A 53 65 72 76 65 72 3A 20 41 70   GMT..Server: Ap\n61 63 68 65 2D 41 64 76 61 6E 63 65 64 45 78 74  ache-AdvancedExt\n72 61 6E 65 74 53 65 72 76 65 72 2F 32 2E 30 2E  ranetServer/2.0.\n35 30 20 28 4D 61 6E 64 72 61 6B 65 6C 69 6E 75  50 (Mandrakelinu\n78 2F 37 2E 32 2E 31 30 31 6D 64 6B 29 20 6D 6F  x/7.2.101mdk) mo\n64 5F 70 65 72 6C 2F 31 2E 39 39 5F 31 36 20 50  d_perl/1.99_16 P\n65 72 6C 2F 76 35 2E 38 2E 35 20 50 48 50 2F 34  erl/v5.8.5 PHP/4\n2E 33 2E 38 0D 0A 45 54 61 67 3A 20 22 31 30 30  .3.8..ETag: \"100\n30 64 33 2D 33 39 35 66 2D 61 32 61 66 30 31 38  0d3-395f-a2af018\n30 22 0D 0A 41 63 63 65 70 74 2D 52 61 6E 67 65  0\"..Accept-Range\n73 3A 20 62 79 74 65 73 0D 0A 4C 61 73 74 2D 4D  s: bytes..Last-M\n6F 64 69 66 69 65 64 3A 20 54 75 65 2C 20 31 34  odified: Tue, 14\n20 4A 75 6E 20 32 30 30 35 20 30 30 3A 32 32 3A   Jun 2005 00:22:\n34 36 20 47 4D 54 0D 0A 43 6F 6E 74 65 6E 74 2D  46 GMT..Content-\n4C 65 6E 67 74 68 3A 20 31 34 36 38 37 0D 0A 43  Length: 14687..C\n6F 6E 74 65 6E 74 2D 54 79 70 65 3A 20 74 65 78  ontent-Type: tex\n74 2F 70 6C 61 69 6E 0D 0A 41 67 65 3A 20 31 34  t/plain..Age: 14\n38 34 36 0D 0A 4B 65 65 70 2D 41 6C 69 76 65 3A  846..Keep-Alive:\n20 74 69 6D 65 6F 75 74 3D 31 35 2C 20 6D 61 78   timeout=15, max\n3D 31 30 30 0D 0A 43 6F 6E 6E 65 63 74 69 6F 6E  =100..Connection\n3A 20 4B 65 65 70 2D 41 6C 69 76 65 0D 0A 0D 0A  : Keep-Alive....\n", "id": 76441, "time": "2005-06-16T03:58:58Z", "creator": "gustavo@angulosolido.pt", "creation_time": "2005-06-16T03:58:58Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "bug_id": 32812, "is_private": false, "text": "There's nothing here I can reproduce.\n\nI see three people (the OP + two others) reporting this.  Two of you are using\nmandrake's packaging; the third (the OP) doesn't tell us, but reports \"Linux\". \nCan anyone NOT using Mandrake's package reproduce this \"bug\"?", "id": 76517, "time": "2005-06-18T10:38:05Z", "creator": "nick@webthing.com", "creation_time": "2005-06-18T10:38:05Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 32812, "text": "The server is , returning text/plain content-type if the request has a \nCache-Control: max-age header but no Pragma: no-cache header.\n\n  GET /index.html HTTP/1.0\n  Host: myhost.tld\n  Cache-Control: max-age=259200\n\nreturns text/plain\n\n\n  GET /index.html HTTP/1.0\n  Host: myhost.tld\n\nor\n\n  GET /index.html HTTP/1.0\n  Host: angulosolido.pt\n  Cache-Control: max-age=259200\n  Pragma: no-cache\n\nreturns text/html.", "id": 76596, "time": "2005-06-22T00:14:42Z", "creator": "gustavo@angulosolido.pt", "creation_time": "2005-06-22T00:14:42Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 32812, "is_private": false, "text": "OK, now we're getting somewhere (at last, some usable information)!  Changing \nit to a cache bug.  Though it's still not clear whether this is an Apache bug \nor a MANDRAKE bug! \n \nApache 2.1 has quite a lot of cache fixes.  If anyone who has experienced this \nproblem would like to try the 2.1 mod_cache, maybe you could tell us if it's \nfixed there. \n ", "id": 76600, "time": "2005-06-22T11:56:43Z", "creator": "nick@webthing.com", "creation_time": "2005-06-22T11:56:43Z", "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 32812, "text": "A temporary workaround is totally disabling mod_cache, by comenting the\ncorresponding line one:\n\n/etc/httpd/conf.d/55_mod_cache.conf\n\n<IfDefine HAVE_CACHE>\n  <IfModule !mod_cache.c>\n  #    LoadModule cache_module            modules/mod_cache.so\n    </IfModule>\n</IfDefine>\n\nHTH!", "id": 76624, "time": "2005-06-22T20:38:30Z", "creator": "gustavo@angulosolido.pt", "creation_time": "2005-06-22T20:38:30Z", "is_private": false, "attachment_id": null}, {"count": 14, "tags": [], "bug_id": 32812, "attachment_id": null, "text": "I can confirm the bug also exists in Mandrake 10.0 (and their Corporate Server\nproduct), with the following apache2 RPMs:\n\napache2-mod_php-2.0.48_4.3.4-1mdk\napache2-mod_perl-2.0.48_1.99_11-3mdk\napache2-modules-2.0.48-6.9.C30mdk\napache2-2.0.48-6.9.C30mdk\napache2-mod_ssl-2.0.48-6.9.C30mdk\napache2-mod_disk_cache-2.0.48-6.9.C30mdk\napache2-mod_ldap-2.0.48-6.9.C30mdk\napache2-mod_proxy-2.0.48-6.9.C30mdk\napache2-mod_dav-2.0.48-6.9.C30mdk\napache-conf-2.0.48-4mdk\napache2-mod_suexec-2.0.48-1mdk\napache2-common-2.0.48-6.9.C30mdk\napache2-mod_cache-2.0.48-6.9.C30mdk\n\nDrove me nuts for a good day before I figured out this is an apache bug!  I hope\nit is able to be resolved soon.  Same symptoms as listed: no proxy = usually\nworks, squid proxy = mostly fails.\n", "id": 79034, "time": "2005-08-26T05:24:28Z", "creator": "drtester@netzero.net", "creation_time": "2005-08-26T05:24:28Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 32812, "text": "This is fixed in 2.2.0, at least from all indications from the massive overhaul\nof mod_cache and mod_disk_cache.", "id": 83282, "time": "2005-12-06T07:33:04Z", "creator": "chip@force-elite.com", "creation_time": "2005-12-06T07:33:04Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 32812, "is_private": false, "text": "Possibly a duplicate of PR 21492. PR 21492 was fixed in 2.0.53.", "id": 83332, "time": "2005-12-06T22:43:02Z", "creator": "rpluem@apache.org", "creation_time": "2005-12-06T22:43:02Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "rpluem@apache.org", "text": "Sorry wrong bug number. Must be PR 30278.", "count": 17, "id": 83333, "time": "2005-12-06T22:44:11Z", "bug_id": 32812, "creation_time": "2005-12-06T22:44:11Z", "is_private": false}]
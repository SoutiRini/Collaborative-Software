[{"count": 0, "tags": [], "bug_id": 52293, "attachment_id": 28034, "id": 152013, "time": "2011-12-06T18:54:27Z", "creator": "jumiller@utah.gov", "creation_time": "2011-12-06T18:54:27Z", "is_private": false, "text": "Created attachment 28034\nContextConfig.java\n\nIt appears that Tomcat is attempting to copy the WAR from the $CATALINA_HOME/webapps directory to the $CATALINA_HOME/temp directory without the .war extension (e.g., original docBase is $CATALINA_HOME/webapps/example.war and a new docBase of $CATALINA_HOME/temp/1-example ).  I think that line 973 in ContextConfig.java method antiLocking never evaluates correctly because the docBase gets set to the value of path on line 969, which removes the .war extension so the file ends up being $CATALINA_HOME/temp/1-example instead of 1-example.war.  \n \nAdditionally, applications with sub-context paths (e.g., foo#bar.war) never get deployed to temp correctly with antiResourceLocking=\"true\" regardless of the unpackWARs setting because of the above scenario and because the docBase gets set to the context path in the antiLocking method which converts the # separator to /.  There appears to be a fix on line 882 of fixDocBase that converts the / character to # in the path but that doesn't make it to the antiLocking method.\n\nBoth 6.0.35 and 7.0.23 exhibit the same behaviour.  In 7.0.23, the docBase is changed back to the context path via the ContextName now instead of the context.getPath() but the result is the same.  Interestingly enough, there is a comment in the 7.0.23 source on line 750 that suggests the code to copy the .war file is never reached and that it's possibly a bug.  This code is never reached because the docBase is changed to the path without the .war extension."}, {"text": "Comment on attachment 28034\nContextConfig.java\n\npatch changes antiLocking method to convert '/' to '#' in docBase.", "tags": [], "creator": "jumiller@utah.gov", "is_private": false, "count": 1, "id": 152014, "time": "2011-12-06T18:58:27Z", "bug_id": 52293, "creation_time": "2011-12-06T18:58:27Z", "attachment_id": 28034}, {"count": 2, "attachment_id": 28037, "bug_id": 52293, "is_private": false, "id": 152017, "time": "2011-12-06T19:08:01Z", "creator": "jumiller@utah.gov", "creation_time": "2011-12-06T19:08:01Z", "tags": [], "text": "Created attachment 28037\nContextConfig.java\n\nforgot to include patch for the actual bug.  Line 974 now checks the originalDocBase for the \".war\" extension and behaves appropriately.  The changing of '/' to '#' is secondary but also required to handle sub-pathed contexts"}, {"count": 3, "tags": [], "bug_id": 52293, "attachment_id": null, "id": 152018, "time": "2011-12-06T19:13:35Z", "creator": "jumiller@utah.gov", "creation_time": "2011-12-06T19:13:35Z", "is_private": false, "text": "This bug presents when antiResourceLocking = \"true\" and unpackWARs = \"false\".  Additionally, regardless of the unpackWARs setting, sub-pathed contexts will not be copied correctly to the temp directory because no check exists in the antiLocking method for the sub-path"}, {"count": 4, "attachment_id": null, "bug_id": 52293, "is_private": false, "id": 152019, "time": "2011-12-06T19:21:27Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-12-06T19:21:27Z", "tags": [], "text": "(In reply to comment #1)\n> patch changes antiLocking method to convert '/' to '#' in docBase.\n\nIt is much easier to handle an issue when you submit a diff against previous version of a file, instead of attaching new file version as a whole.\n\nThe diff is several lines, a file is hundreds of lines. See the following pages:\n\nhttp://tomcat.apache.org/bugreport.html#Patches_and_enhancement_requests\n\nhttp://www.apache.org/dev/contributors.html#patches"}, {"count": 5, "attachment_id": 28038, "bug_id": 52293, "is_private": false, "id": 152020, "time": "2011-12-06T19:36:54Z", "creator": "jumiller@utah.gov", "creation_time": "2011-12-06T19:36:54Z", "tags": [], "text": "Created attachment 28038\ndifferences\n\ndiff of patched antiLocking method with 6.0.35 version"}, {"count": 6, "attachment_id": null, "bug_id": 52293, "is_private": false, "id": 152359, "time": "2011-12-21T19:29:10Z", "creator": "markt@apache.org", "creation_time": "2011-12-21T19:29:10Z", "tags": [], "text": "Fixed in trunk and will be included in 7.0.24 onwards."}, {"count": 7, "tags": [], "text": "Proposed for 6.0.x", "attachment_id": null, "id": 152360, "creator": "markt@apache.org", "time": "2011-12-21T19:31:43Z", "bug_id": 52293, "creation_time": "2011-12-21T19:31:43Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 52293, "attachment_id": 28097, "id": 152364, "time": "2011-12-22T09:42:04Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-12-22T09:42:04Z", "is_private": false, "text": "Created attachment 28097\n2011-12-22_tc6_ContextConfig.java.patch (the same as above, but in unified diff format)\n\nThe same as Justin Miller's patch, but now in Unified diff format.\nIt is against tc6.0.x."}, {"count": 9, "attachment_id": null, "bug_id": 52293, "is_private": false, "id": 152614, "time": "2012-01-06T16:10:34Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-01-06T16:10:34Z", "tags": [], "text": "Fixed in 6.0 with r1228244 and will be in 6.0.36."}]
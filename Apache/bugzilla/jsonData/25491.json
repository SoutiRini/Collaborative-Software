[{"count": 0, "tags": [], "text": "Im am currently running Tomcat 4.1.29 with Java version 1.4.0_02-b02 on a Sun \nE450 with 4gbs of RAM with quad 400mhz Sparc cpus.\n\nI downloaded the binary distribution for testing, and discovered that whenever \nTomcat compiles a jsp page, the jasper2 opens a pipe for the compile whether it \nis javac or jikes, and does not release them. Under a heavy jsp compilation \nthese PIPES would eventually take up all the file descriptors and the tomcat \nwould be render out of memory. This happens when we enable JVM forking in the \nweb.xml config.\n\nI am running the settings below and was able to replicate this error on all my \nSolaris 9 servers.\n\n29472:  /opt/j2se/usr/j2se/bin/java -server -Xms256m -Xmx256m -\nXX:PermSize=128m -XX:New\nargv[0]: /opt/j2se/usr/j2se/bin/java\nargv[1]: -server\nargv[2]: -Xms256m\nargv[3]: -Xmx256m\nargv[4]: -XX:PermSize=128m\nargv[5]: -XX:NewSize=128m\nargv[6]: -XX:SurvivorRatio=2000\nargv[7]: -XX:+UseParNewGC\nargv[8]: -XX:+UseConcMarkSweepGC\nargv[9]: -XX:MaxTenuringThreshold=0\nargv[10]: -Xloggc:/opt/tomcat/logs/gc.log\nargv[11]: -XX:+PrintGCDetails\nargv[12]: -XX:+PrintGCTimeStamps\nargv[13]: -Dbuild.compiler.emacs=true\nargv[14]: -Djava.endorsed.dirs=/opt/jakarta-tomcat-4.1.29/common/endorsed\nargv[15]: -classpath\nargv[16]: /opt/j2se/usr/j2se/lib/tools.jar:/opt/jakarta-tomcat-\n4.1.29/bin/bootstrap.jar\nargv[17]: -Dcatalina.base=/opt/jakarta-tomcat-4.1.29\nargv[18]: -Dcatalina.home=/opt/jakarta-tomcat-4.1.29\nargv[19]: -Djava.io.tmpdir=/opt/jakarta-tomcat-4.1.29/temp\nargv[20]: org.apache.catalina.startup.Bootstrap\nargv[21]: start\n\nA lsof of the tomcat process shows the PIPES being formed.\n\n# lsof -p 29472\nCOMMAND   PID   USER   FD   TYPE        DEVICE SIZE/OFF       NODE NAME\njava    29472 tomcat  cwd   VDIR         85,90      512     488618 /opt/jakarta-\ntomcat-4.1.29/bin\njava    29472 tomcat  txt   VREG         85,90    38468     \n359689 /opt/j2se/usr/j2se/bin/java\njava    29472 tomcat  txt   VREG         85,90   753709     624919 /opt/jakarta-\ntomcat-4.1.29/server/lib/catalina.jar\njava    29472 tomcat  txt   VREG         85,90   736810     624950 /opt/jakarta-\ntomcat-4.1.29/common/lib/ant.jar\njava    29472 tomcat  txt   VREG         85,90  5092912     \n410527 /opt/j2se/usr/j2se/lib/tools.jar\njava    29472 tomcat  txt   VREG         85,90   498051     624768 /opt/jakarta-\ntomcat-4.1.29/server/webapps/admin/WEB-INF/lib/struts.jar\njava    29472 tomcat  txt   VREG         85,90   769335     \n546205 /opt/j2se/usr/j2se/jre/lib/ext/localedata.jar\njava    29472 tomcat  txt   VREG         85,90   498051     624963 /opt \n(/dev/md/dsk/d90)\njava    29472 tomcat  txt   VREG         85,90    58904     \n566568 /opt/j2se/usr/j2se/jre/lib/sparc/libnet.so\njava    29472 tomcat  txt   VREG         85,90    65508     624932 /opt/jakarta-\ntomcat-4.1.29/server/lib/tomcat-jk.jar\njava    29472 tomcat  txt   VREG         85,90    22379     624930 /opt/jakarta-\ntomcat-4.1.29/server/lib/commons-fileupload-1.0.jar\njava    29472 tomcat  txt   VREG         85,90    97076     624929 /opt/jakarta-\ntomcat-4.1.29/server/lib/tomcat-jk2.jar\njava    29472 tomcat  txt   VREG         85,90    23336     624926 /opt/jakarta-\ntomcat-4.1.29/server/lib/tomcat-warp.jar\njava    29472 tomcat  txt   VREG         85,90    21435     624925 /opt/jakarta-\ntomcat-4.1.29/server/lib/servlets-webdav.jar\njava    29472 tomcat  txt   VREG         85,90     7031     624924 /opt/jakarta-\ntomcat-4.1.29/server/lib/servlets-common.jar\njava    29472 tomcat  txt   VREG         85,90   104195     624922 /opt/jakarta-\ntomcat-4.1.29/server/lib/jaas.jar\njava    29472 tomcat  txt   VREG         85,90    66846     624921 /opt/jakarta-\ntomcat-4.1.29/server/lib/tomcat-coyote.jar\njava    29472 tomcat  txt   VREG         85,90   118726     624920 /opt/jakarta-\ntomcat-4.1.29/server/lib/commons-beanutils.jar\njava    29472 tomcat  txt   VREG         85,90   186651     624918 /opt/jakarta-\ntomcat-4.1.29/server/lib/tomcat-util.jar\njava    29472 tomcat  txt   VREG         85,90   109670     624914 /opt/jakarta-\ntomcat-4.1.29/server/lib/commons-modeler.jar\njava    29472 tomcat  txt   VREG         85,90    47714     624916 /opt/jakarta-\ntomcat-4.1.29/server/lib/tomcat-http11.jar\njava    29472 tomcat  txt   VREG         85,90   343900     624907 /opt/jakarta-\ntomcat-4.1.29/server/lib/mx4j-jmx.jar\njava    29472 tomcat  txt   VREG         85,90    14804     624927 /opt/jakarta-\ntomcat-4.1.29/server/lib/catalina-ant.jar\njava    29472 tomcat  txt   VREG         85,90    19278     624915 /opt/jakarta-\ntomcat-4.1.29/server/lib/servlets-default.jar\njava    29472 tomcat  txt   VREG         85,90    18929     624913 /opt/jakarta-\ntomcat-4.1.29/server/lib/servlets-manager.jar\njava    29472 tomcat  txt   VREG         85,90    25429     624911 /opt/jakarta-\ntomcat-4.1.29/server/lib/jakarta-regexp-1.3.jar\njava    29472 tomcat  txt   VREG         85,90   109096     624909 /opt/jakarta-\ntomcat-4.1.29/server/lib/commons-digester.jar\njava    29472 tomcat  txt   VREG         85,90    31605     624908 /opt/jakarta-\ntomcat-4.1.29/server/lib/commons-logging.jar\njava    29472 tomcat  txt   VREG         85,90     8674     624951 /opt/jakarta-\ntomcat-4.1.29/common/lib/jta.jar\njava    29472 tomcat  txt   VREG         85,90    28520     624949 /opt/jakarta-\ntomcat-4.1.29/common/lib/naming-common.jar\njava    29472 tomcat  txt   VREG         85,90    38836     624948 /opt/jakarta-\ntomcat-4.1.29/common/lib/naming-resources.jar\njava    29472 tomcat  txt   VREG         85,90  5604126     \n546194 /opt/j2se/usr/j2se/jre/lib/charsets.jar\njava    29472 tomcat  txt   VREG         85,90     5964     624912 /opt/jakarta-\ntomcat-4.1.29/server/lib/servlets-invoker.jar\njava    29472 tomcat  txt   VREG         85,90    72933     624947 /opt/jakarta-\ntomcat-4.1.29/common/lib/jasper-runtime.jar\njava    29472 tomcat  txt   VREG         85,90    45386     624946 /opt/jakarta-\ntomcat-4.1.29/common/lib/activation.jar\njava    29472 tomcat  txt   VREG         85,90   100776     624945 /opt/jakarta-\ntomcat-4.1.29/common/lib/commons-dbcp-1.1.jar\njava    29472 tomcat  txt   VREG         85,90   183104     624942 /opt/jakarta-\ntomcat-4.1.29/common/lib/jasper-compiler.jar\njava    29472 tomcat  txt   VREG         85,90    98496     624944 /opt/jakarta-\ntomcat-4.1.29/common/lib/jndi.jar\njava    29472 tomcat  txt   VREG         85,90     6727     624940 /opt/jakarta-\ntomcat-4.1.29/common/lib/jdbc2_0-stdext.jar\njava    29472 tomcat  txt   VREG         85,90   165119     624939 /opt/jakarta-\ntomcat-4.1.29/common/lib/commons-collections.jar\njava    29472 tomcat  txt   VREG         85,90    22327     624938 /opt/jakarta-\ntomcat-4.1.29/common/lib/commons-logging-api.jar\njava    29472 tomcat  txt   VREG         85,90   280984     624937 /opt/jakarta-\ntomcat-4.1.29/common/lib/mail.jar\njava    29472 tomcat  txt   VREG         85,90    79265     624936 /opt/jakarta-\ntomcat-4.1.29/common/lib/servlet.jar\njava    29472 tomcat  txt   VREG         85,90 26811340     \n546256 /opt/j2se/usr/j2se/jre/lib/rt.jar\njava    29472 tomcat  txt   VREG         85,90    18245     624943 /opt/jakarta-\ntomcat-4.1.29/common/lib/naming-factory.jar\njava    29472 tomcat  txt   VREG         85,90   895647     \n546249 /opt/j2se/usr/j2se/jre/lib/jsse.jar\njava    29472 tomcat  txt   VREG         85,90    39523     624941 /opt/jakarta-\ntomcat-4.1.29/common/lib/commons-pool-1.1.jar\njava    29472 tomcat  txt   VREG         85,90   927669     624953 /opt/jakarta-\ntomcat-4.1.29/common/endorsed/xercesImpl.jar\njava    29472 tomcat  txt   VREG         85,90    24694     488630 /opt/jakarta-\ntomcat-4.1.29/bin/bootstrap.jar\njava    29472 tomcat  txt   VREG         85,90   111374     \n546206 /opt/j2se/usr/j2se/jre/lib/ext/sunjce_provider.jar\njava    29472 tomcat  txt   VREG         85,90    69596     \n546248 /opt/j2se/usr/j2se/jre/lib/jce.jar\njava    29472 tomcat  txt   VREG         85,90    89343     \n546257 /opt/j2se/usr/j2se/jre/lib/sunrsasign.jar\njava    29472 tomcat  txt   VREG         85,90   123705     624954 /opt/jakarta-\ntomcat-4.1.29/common/endorsed/xmlParserAPIs.jar\njava    29472 tomcat  txt   VREG         85,90    73032     \n566574 /opt/j2se/usr/j2se/jre/lib/sparc/libzip.so\njava    29472 tomcat  txt   VREG         85,90   146524     \n566553 /opt/j2se/usr/j2se/jre/lib/sparc/libjava.so\njava    29472 tomcat  txt   VREG         85,90    96452     \n566572 /opt/j2se/usr/j2se/jre/lib/sparc/libverify.so\njava    29472 tomcat  txt   VREG         85,90     9550     488629 /opt/jakarta-\ntomcat-4.1.29/bin/commons-daemon.jar\njava    29472 tomcat  txt   VREG           0,2    16384 3153301845 /tmp (swap)\njava    29472 tomcat  txt   VREG         85,90    44620     \n593603 /opt/j2se/usr/j2se/jre/lib/sparc/native_threads/libhpi.so\njava    29472 tomcat  txt   VREG         85,30    11452     \n136329 /usr/platform/sun4u/lib/libmd5_psr.so.1\njava    29472 tomcat  txt   VREG         85,30    11448     \n104659 /usr/lib/libmd5.so.1\njava    29472 tomcat  txt   VREG         85,30    43960     \n104623 /usr/lib/libaio.so.1\njava    29472 tomcat  txt   VREG         85,30    35916     \n104678 /usr/lib/librt.so.1\njava    29472 tomcat  txt   VREG         85,30    21676     \n104662 /usr/lib/libmp.so.2\njava    29472 tomcat  txt   VREG         85,30    11580     \n104681 /usr/lib/libsched.so.1\njava    29472 tomcat  txt   VREG         85,30   742660     \n105122 /usr/lib/libnsl.so.1\njava    29472 tomcat  txt   VREG         85,90    53247     \n546204 /opt/j2se/usr/j2se/jre/lib/ext/ldapsec.jar\njava    29472 tomcat  txt   VREG         85,30   110116     \n104728 /usr/lib/libm.so.1\njava    29472 tomcat  txt   VREG         85,90  7434928     \n593607 /opt/j2se/usr/j2se/jre/lib/sparc/server/libjvm.so\njava    29472 tomcat  txt   VREG         85,90     8896     \n546203 /opt/j2se/usr/j2se/jre/lib/ext/dnsns.jar\njava    29472 tomcat  txt   VREG         85,30    58504     \n104686 /usr/lib/libsocket.so.1\njava    29472 tomcat  txt   VREG         85,30    58780     \n104719 /usr/lib/libCrun.so.1\njava    29472 tomcat  txt   VREG         85,30     6476     \n104693 /usr/lib/libw.so.1\njava    29472 tomcat  txt   VREG         85,30   855484     \n104626 /usr/lib/libc.so.1\njava    29472 tomcat  txt   VREG         85,30    16768     \n136328 /usr/platform/sun4u/lib/libc_psr.so.1\njava    29472 tomcat  txt   VREG         85,30   138560     \n104689 /usr/lib/libthread.so.1\njava    29472 tomcat  txt   VREG         85,30     3984     \n104616 /usr/lib/libdl.so.1\njava    29472 tomcat  txt   VREG         85,30   192692     \n105127 /usr/lib/ld.so.1\njava    29472 tomcat    0r  VCHR          13,2      0t0     \n318874 /devices/pseudo/mm@0:null\njava    29472 tomcat    1w  VREG         85,90    31060     624972 /opt/jakarta-\ntomcat-4.1.29/logs/catalina.out\njava    29472 tomcat    2w  VREG         85,90    31060     624972 /opt/jakarta-\ntomcat-4.1.29/logs/catalina.out\njava    29472 tomcat    3u  VCHR         13,12      0t0     \n318876 /devices/pseudo/mm@0:zero\njava    29472 tomcat    4w  VREG         85,90        0      \n31764 /opt/tomcat/logs/gc.log\njava    29472 tomcat    5r  DOOR         234,0      0t0      43118 /var/run \n(swap) (door to nscd[210])\njava    29472 tomcat    6u  IPv4 0x3001f5be1e8      0t0        TCP *:9080 \n(LISTEN)\njava    29472 tomcat    7u  IPv4 0x305df9ba060      0t0        TCP \nlocalhost:64965->localhost:64964 (BOUND)\njava    29472 tomcat    8r  VREG         85,90      778     624960 /opt/jakarta-\ntomcat-4.1.29/conf/jk2.properties\njava    29472 tomcat    9w  VREG         85,90    30964     624979 /opt/jakarta-\ntomcat-4.1.29/logs/localhost_log.2003-12-12.txt\njava    29472 tomcat   10w  VREG         85,90      450     624983 /opt/jakarta-\ntomcat-4.1.29/logs/catalina_log.2003-12-12.txt\njava    29472 tomcat   11w  VREG         85,90     6552     624981 /opt/jakarta-\ntomcat-4.1.29/logs/localhost_admin_log.2003-12-12.txt\njava    29472 tomcat   12r  VREG         85,90   111374     \n546206 /opt/j2se/usr/j2se/jre/lib/ext/sunjce_provider.jar\njava    29472 tomcat   13r  VREG         85,90   769335     \n546205 /opt/j2se/usr/j2se/jre/lib/ext/localedata.jar\njava    29472 tomcat   14r  VREG         85,90    53247     \n546204 /opt/j2se/usr/j2se/jre/lib/ext/ldapsec.jar\njava    29472 tomcat   15r  VREG         85,90     8896     \n546203 /opt/j2se/usr/j2se/jre/lib/ext/dnsns.jar\njava    29472 tomcat   16r  VREG         85,90   927669     624953 /opt/jakarta-\ntomcat-4.1.29/common/endorsed/xercesImpl.jar\njava    29472 tomcat   17r  VREG         85,90   123705     624954 /opt/jakarta-\ntomcat-4.1.29/common/endorsed/xmlParserAPIs.jar\njava    29472 tomcat   18r  VREG         85,90 26811340     \n546256 /opt/j2se/usr/j2se/jre/lib/rt.jar\njava    29472 tomcat   19r  VREG         85,90    89343     \n546257 /opt/j2se/usr/j2se/jre/lib/sunrsasign.jar\njava    29472 tomcat   20r  VREG         85,90   895647     \n546249 /opt/j2se/usr/j2se/jre/lib/jsse.jar\njava    29472 tomcat   21r  VREG         85,90    69596     \n546248 /opt/j2se/usr/j2se/jre/lib/jce.jar\njava    29472 tomcat   22r  VREG         85,90  5604126     \n546194 /opt/j2se/usr/j2se/jre/lib/charsets.jar\njava    29472 tomcat   23r  VREG         85,90  5092912     \n410527 /opt/j2se/usr/j2se/lib/tools.jar\njava    29472 tomcat   24r  VREG         85,90    24694     488630 /opt/jakarta-\ntomcat-4.1.29/bin/bootstrap.jar\njava    29472 tomcat   25u  IPv4 0x31321b37528      0t0        TCP *:9009 \n(LISTEN)\njava    29472 tomcat   26u  IPv4 0x3008b8c4df0      0t0        TCP \nlocalhost:9005 (LISTEN)\njava    29472 tomcat   32u  FIFO 0x3000fe7d8e0      0t0     504826 (fifofs) \nPIPE->0x3000fe7d7e0\njava    29472 tomcat   33u  FIFO 0x313116e8fe0      0t0     504827 (fifofs) \nPIPE->0x313116e90e0\njava    29472 tomcat   34u  FIFO 0x313116e8860      0t0     504830 (fifofs) \nPIPE->0x313116e8760\njava    29472 tomcat   35u  FIFO 0x300b89f8920      0t0     504828 (fifofs) \nPIPE->0x300b89f8a20\njava    29472 tomcat   36u  FIFO 0x30b8202cfa0      0t0     504831 (fifofs) \nPIPE->0x30b8202d0a0\njava    29472 tomcat   38u  FIFO 0x31311700740      0t0     504832 (fifofs) \nPIPE->0x31311700840\njava    29472 tomcat   39u  FIFO 0x313116e8420      0t0     504858 (fifofs) \nPIPE->0x313116e8320\njava    29472 tomcat   40u  FIFO 0x313116e9200      0t0     504859 (fifofs) \nPIPE->0x313116e9300\njava    29472 tomcat   42u  FIFO 0x3000114c8c0      0t0     504860 (fifofs) \nPIPE->0x3000114c9c0\n\nThese PIPEs die and they only build up.\n\nAny ideas on what is going on?", "attachment_id": null, "bug_id": 25491, "id": 49021, "time": "2003-12-12T22:27:43Z", "creator": "thomas.tang@thestreet.com", "creation_time": "2003-12-12T22:27:43Z", "is_private": false}, {"count": 1, "tags": [], "text": "I have tested this with the latest 4.1.x from CVS on Linux with 1.4.2_08 JVM.\n\nIf I am quick (or the JSP compilation is slow) I do see pipes created but they\ndisappear once compilation has been completed.\n\nThe root cause may well be bug 26025 that was fixed in 4.1.31\n\nEither way, this now works so I will resolve it as fixed. If you still see the\nerror after upgrading to 4.1.31 and 1.4.2_08, please re-open the report and I\nwill test with 4.1.31 to determine if it is a Tomcat bug fixed in CVS or a\nSolaris specific JVM issue.\n", "is_private": false, "id": 76983, "creator": "markt@apache.org", "time": "2005-07-04T23:50:42Z", "bug_id": 25491, "creation_time": "2005-07-04T23:50:42Z", "attachment_id": null}]
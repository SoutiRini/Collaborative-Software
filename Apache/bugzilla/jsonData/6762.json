[{"count": 0, "tags": [], "text": "I'm running JDK 1.3. At Tomcat startup time my web app executes a servlet which \nadds a cleanup thread via Runtime.getRuntime().addShutdownHook( ...)\n\nWhen I normally shutdown Tomcat the following exception is thrown:\n\nStopping service Tomcat-Standalone\nStopping service Tomcat-Apache\nWebappClassLoader: Lifecycle error : CL stopped\njava.lang.NoClassDefFoundError: java/util/Enumeration\n        at com.replaytv.shared.logger.LogManager.initCleanUp \n(LogManager.java:196)\n        at com.replaytv.shared.logger.LogCleanUpThread.run\n(LogCleanUpThread.java:22)\n\nIn this example the class java.util.Enumeration hasn't been used before and is \ntherefore not loaded yet. During shutdown, the cleanup thread tries to load the \nclass but the Tomcats custom classloader has been removed already.\n\nI work around it by loading the handful of classes I need in the cleanup thread \nduring startup via Class.forName( ...).\n\nWhen the custom classloader is removed shouldn't at least the default class \nloader be set?\n\n-Georg", "is_private": false, "id": 11316, "creator": "gpuchta@sonicblue.com", "time": "2002-02-28T18:45:25Z", "bug_id": 6762, "creation_time": "2002-02-28T18:45:25Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "The classloader is destroyed and the webapps stopped long before the VM is\nshutdown. That's why it doesn't work.\nYou should use the container-provided lifecycle handling instead (init and\ndestroy methods from the servlet).", "is_private": false, "id": 11317, "creator": "remm@apache.org", "time": "2002-02-28T18:50:51Z", "bug_id": 6762, "creation_time": "2002-02-28T18:50:51Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 6762, "attachment_id": null, "id": 11318, "time": "2002-02-28T19:08:42Z", "creator": "gpuchta@sonicblue.com", "creation_time": "2002-02-28T19:08:42Z", "is_private": false, "text": "Init and destroy methods from the servlet don't work for me. The thing I try to \nachieve is to execute something before the JVM exits. I need to close log files \nand do some additional clean-up processing.\n\n-Georg"}, {"count": 3, "tags": [], "bug_id": 6762, "text": "I understand, but by doing this, you're violating the J2EE model and\noverstepping the container boundaries, so it doesn't have to be supported (and I\ndon't really see how it could, since, as I said, when the VM is shutdown, the\nwebapp and related components will have been stopped long before).", "id": 11320, "time": "2002-02-28T19:25:33Z", "creator": "remm@apache.org", "creation_time": "2002-02-28T19:25:33Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 6762, "attachment_id": null, "id": 11336, "time": "2002-03-01T00:56:50Z", "creator": "gpuchta@sonicblue.com", "creation_time": "2002-03-01T00:56:50Z", "is_private": false, "text": "Thanks Remy"}]
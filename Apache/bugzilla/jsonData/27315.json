[{"count": 0, "attachment_id": null, "bug_id": 27315, "text": "Hello,\n\nI have recently upgraded from Tomcat 4.1.29 to 4.1.30, primarily to avoid bug \n#24970.  Since the upgraded, everything seems to work OK, but intermittently I \nget the following error:\n\njava.util.ConcurrentModificationException\n        at java.util.AbstractList$Itr.checkForComodification\n(AbstractList.java:448)\n        at java.util.AbstractList$Itr.next(AbstractList.java:419)\n        at java.util.AbstractCollection.remove(AbstractCollection.java:254)\n        at org.apache.coyote.RequestGroupInfo.removeRequestProcessor\n(RequestGroupInfo.java:17)\n        at org.apache.coyote.RequestInfo.setGlobalProcessor(RequestInfo.java:96)\n        at org.apache.coyote.http11.Http11Protocol$MXPoolListener.threadEnd\n(Http11Protocol.java:620)\n        at org.apache.tomcat.util.threads.ThreadPool.removeThread\n(ThreadPool.java:279)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:727)\n        at java.lang.Thread.run(Thread.java:534)\n\nThe system seems to operate OK even with this issue.  I have not made any \nchange to my codebase since the upgrade from 4.1.29 to 4.1.30.\n\nI would be grateful if anyone could shed any light on this issue.\n\nKind regards,\n\nMinh Tran", "id": 53191, "time": "2004-02-28T18:06:30Z", "creator": "mntran@btinternet.com", "creation_time": "2004-02-28T18:06:30Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 27315, "attachment_id": null, "id": 59218, "time": "2004-06-15T11:23:27Z", "creator": "plynch@apache.org", "creation_time": "2004-06-15T11:23:27Z", "is_private": false, "text": "There was a change in RequestInfo.java which may contribute to the problem:\n\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat-connectors/coyote/src/java/org/apache/coyote/RequestInfo.java,v\nretrieving revision 1.6\nretrieving revision 1.7\ndiff -u -r1.6 -r1.7\n---\njakarta-tomcat-connectors/coyote/src/java/org/apache/coyote/RequestInfo.java\n2003/11/13 20:03:33\t1.6\n+++\njakarta-tomcat-connectors/coyote/src/java/org/apache/coyote/RequestInfo.java\n2004/01/15 13:16:49\t1.7\n@@ -92,6 +92,9 @@\n         if( global != null) {\n             this.global=global;\n             global.addRequestProcessor( this );\n+        } else {\n+            this.global.removeRequestProcessor( this );\n+            this.global = null;\n         }\n     }\n\n\nThe change was made by 'remm'. Can 'remm' review the code?\n\nThe exception happens on line 96 which is \n\nthis.global.removeRequestProcessor( this );\n\n\n\n\n\n"}, {"count": 2, "tags": [], "bug_id": 27315, "attachment_id": null, "text": "Addtional changes found which may contribute to the problem. Perhaps\n'processors' which is an ArrayList should be synchronized via\nCollections.synchronizedList(new ArrayList(...)).\n\nI am concerned because it appears that some object cannot be removed from a pool\nand is therefore creating a memory leak.\n\nCan one of the developers have a look to see if that is the solution?\n\n===================================================================\nRCS file:\n/home/cvspublic/jakarta-tomcat-connectors/coyote/src/java/org/apache/coyote/RequestGroupInfo.java,v\nretrieving revision 1.1\nretrieving revision 1.2\ndiff -u -r1.1 -r1.2\n---\njakarta-tomcat-connectors/coyote/src/java/org/apache/coyote/RequestGroupInfo.java\n2003/01/20 23:43:41\t1.1\n+++\njakarta-tomcat-connectors/coyote/src/java/org/apache/coyote/RequestGroupInfo.java\n2004/01/15 13:16:49\t1.2\n@@ -13,6 +13,10 @@\n         processors.add( rp );\n     }\n \n+    public void removeRequestProcessor( RequestInfo rp ) {\n+        processors.remove( rp );\n+    }\n+\n     public long getMaxTime() {\n         long maxTime=0;\n         for( int i=0; i<processors.size(); i++ ) {\n\n\n\nAdjust summary to be clearer of the problem.", "id": 59219, "time": "2004-06-15T11:39:20Z", "creator": "plynch@apache.org", "creation_time": "2004-06-15T11:39:20Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 27315, "attachment_id": null, "id": 59246, "time": "2004-06-15T18:08:17Z", "creator": "william.barker@wilshire.com", "creation_time": "2004-06-15T18:08:17Z", "is_private": false, "text": "While browsing the CVS log, you should have seen that this was fixed in R1.3 \nof RequestGroupInfo."}, {"count": 4, "tags": [], "bug_id": 27315, "attachment_id": null, "id": 59286, "time": "2004-06-16T13:52:21Z", "creator": "plynch@apache.org", "creation_time": "2004-06-16T13:52:21Z", "is_private": false, "text": "Yes I should have seen it. I had the 4.1.30 tag blinders on, thanks for the\npointer and for closing the issue."}, {"count": 5, "tags": [], "bug_id": 27315, "attachment_id": null, "text": "*** Bug 30139 has been marked as a duplicate of this bug. ***", "id": 60731, "time": "2004-07-17T06:12:06Z", "creator": "william.barker@wilshire.com", "creation_time": "2004-07-17T06:12:06Z", "is_private": false}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 69366, "time": "2005-01-07T16:49:38Z", "bug_id": 27315, "creation_time": "2005-01-07T16:49:38Z", "is_private": false, "text": "*** Bug 30063 has been marked as a duplicate of this bug. ***"}]
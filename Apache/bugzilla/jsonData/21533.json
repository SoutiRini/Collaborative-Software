[{"count": 0, "tags": [], "bug_id": 21533, "text": "When using Digest authentication along with .htaccess files, where the\nDocumentRoot contains an .htaccess file with \"AuthDigestGroupFile\" and \"Require\nvalid-user\" directives, and some subdirectories contain .htaccess files with a\n\"Require group testgroup\" directive, Apache may crash when trying to access\nthose group-restricted directories or the index of a directory directly above\nthose IF the authenticated username does NOT appear among the usernames of that\ngroup in the AuthDigestGroupFile file.\n\nExample:\n\n* User to log in as \"foo\".\n* Group \"testgroup\" in AuthDigestGroupFile does NOT contain the user \"foo\".\n\nDocumentRoot\n     | .htaccess with \"AuthDigestGroupFile\", \"Require valid-user\"\n     |\n     +-Files\n         |\n         +-Unrestricted\n         | \n         +-Restricted\n               | .htaccess with \"Require group testgroup\"\n               | Restricted files go here\n               .\n               .\n               .\n\nIn this example, the user may log in as \"foo\" using digest authentication and\naccess the DocumentRoot. However, as soon as he/she accesses the \"Files\"\ndirectory (mod_autoindex is on), Apache crashes.\n\nUnder normal circumstances, mod_autoindex should list the subdirectory\n\"Unrestricted\" (only), since there is no .htaccess in that directory - and more\nimportant - there is an .htaccess in the \"Restricted\" directory, requiring the\nuser to be part of the group \"testgroup\" (which \"foo\" is not).\n\n\nI've spent quite some time experimenting with this, but still haven't figured\nout why this happens. To make things worse, it doesn't happen for all \"examples\"\nI've tried.\n\nThe only consistent behavior I managed to track was that if the user \"foo\" DOES\nappear in the group file as a member of the \"testgroup\" group, everything works\njust fine. As soon as \"foo\" is removed from the group, no matter if there are\nother users left in the group or not, the problem appears.\n\nThe problem also appears if the required group does not exist in the\nAuthDigestGroupFile file, no matter if other groups appear in the\nAuthDigestGroupFile file or not.\n\n\nMy name-based virtual host configuration contains the following for the\nDocumentRoot:\n\n  AllowOverride AuthConfig Indexes Limit\n  Options Indexes MultiViews\n\n\nThe DocumentRoot directory contains an .htaccess file with:\n\n  AuthType Digest\n  AuthName \"myserver.dyndns.org\"\n  AuthDigestDomain /\n  AuthDigestFile \"custom/auth/.htdigest.pwd\"\n  AuthDigestGroupFile \"custom/auth/.htdigest.group\"\n  Require valid-user\n\n  Order Allow,Deny\n  Allow from all\n\n  Satisfy All\n\n\nThe \"Restricted\" directory in the example contains an .htaccess file with:\n\n  # Require user to be part of group \"testgroup\"\n  Require group testgroup\n\n\nThe Apache error log states that it denied the client access, just before Apache\ncrashed:\n\n[Sat Jul 12 00:11:56 2003] [error] [client xx.xxx.xxx.xxx] Digest: access to\n/Files/Restricted/ failed, reason: user foo not allowed access, referer:\nhttp://myserver.dyndns.org/\n\nOn the client side, the connection of course hangs since Apache crashes.\n\n\nThe crash information given by Dr. Watson on my Swedish Windows XP Professional\nSP-1 v5.1.2600 is (sorry for the long listing):\n\nszAppName : Apache.exe     szAppVer : 2.0.47.0     \nszModName : mod_auth_digest.so     szModVer : 2.0.47.0     offset : 0000259d\n\n[appcompat.txt]\n<?xml version=\"1.0\" encoding=\"UTF-16\"?>\n<DATABASE>\n<EXE NAME=\"Apache.exe\" FILTER=\"GRABMI_FILTER_PRIVACY\">\n    <MATCHING_FILE NAME=\"ab.exe\" SIZE=\"65601\" CHECKSUM=\"0xF5F7BB53\"\nBIN_FILE_VERSION=\"2.0.47.0\" BIN_PRODUCT_VERSION=\"2.0.47.0\"\nPRODUCT_VERSION=\"2.0.47\" FILE_DESCRIPTION=\"ApacheBench Utility\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache HTTP Server\"\nFILE_VERSION=\"2.0.47\" ORIGINAL_FILENAME=\"ab.exe.exe\" INTERNAL_NAME=\"ab.exe\"\nLEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2002 The Apache Software Foundation.\"\nVERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\" VERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\"\nMODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\" LINKER_VERSION=\"0x0\"\nUPTO_BIN_FILE_VERSION=\"2.0.47.0\" UPTO_BIN_PRODUCT_VERSION=\"2.0.47.0\"\nLINK_DATE=\"07/09/2003 04:57:39\" UPTO_LINK_DATE=\"07/09/2003 04:57:39\"\nVER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"Apache.exe\" SIZE=\"20541\" CHECKSUM=\"0xBD1E49DF\"\nBIN_FILE_VERSION=\"2.0.47.0\" BIN_PRODUCT_VERSION=\"2.0.47.0\"\nPRODUCT_VERSION=\"2.0.47\" FILE_DESCRIPTION=\"Apache HTTP Server\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache HTTP Server\"\nFILE_VERSION=\"2.0.47\" ORIGINAL_FILENAME=\"Apache.exe.exe\"\nINTERNAL_NAME=\"Apache.exe\" LEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2002 The Apache\nSoftware Foundation.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\"\nLINKER_VERSION=\"0x0\" UPTO_BIN_FILE_VERSION=\"2.0.47.0\"\nUPTO_BIN_PRODUCT_VERSION=\"2.0.47.0\" LINK_DATE=\"07/09/2003 05:02:14\"\nUPTO_LINK_DATE=\"07/09/2003 05:02:14\" VER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"ApacheMonitor.exe\" SIZE=\"41042\" CHECKSUM=\"0xC8BD35DD\"\nBIN_FILE_VERSION=\"2.0.47.0\" BIN_PRODUCT_VERSION=\"2.0.47.0\"\nPRODUCT_VERSION=\"2.0.47\" FILE_DESCRIPTION=\"Apache HTTP Server Monitor\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache HTTP Server\"\nFILE_VERSION=\"2.0.47\" ORIGINAL_FILENAME=\"ApacheMonitor.exe.exe\"\nINTERNAL_NAME=\"ApacheMonitor.exe\" LEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2002 The\nApache Software Foundation.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\"\nLINKER_VERSION=\"0x0\" UPTO_BIN_FILE_VERSION=\"2.0.47.0\"\nUPTO_BIN_PRODUCT_VERSION=\"2.0.47.0\" LINK_DATE=\"07/09/2003 04:57:46\"\nUPTO_LINK_DATE=\"07/09/2003 04:57:46\" VER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"htdbm.exe\" SIZE=\"77892\" CHECKSUM=\"0x8BBD3D38\"\nBIN_FILE_VERSION=\"2.0.47.0\" BIN_PRODUCT_VERSION=\"2.0.47.0\"\nPRODUCT_VERSION=\"2.0.47\" FILE_DESCRIPTION=\"htdbm Utility\" COMPANY_NAME=\"Apache\nSoftware Foundation\" PRODUCT_NAME=\"Apache HTTP Server\" FILE_VERSION=\"2.0.47\"\nORIGINAL_FILENAME=\"htdbm.exe.exe\" INTERNAL_NAME=\"htdbm.exe\"\nLEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2002 The Apache Software Foundation.\"\nVERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\" VERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\"\nMODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\" LINKER_VERSION=\"0x0\"\nUPTO_BIN_FILE_VERSION=\"2.0.47.0\" UPTO_BIN_PRODUCT_VERSION=\"2.0.47.0\"\nLINK_DATE=\"07/09/2003 04:57:40\" UPTO_LINK_DATE=\"07/09/2003 04:57:40\"\nVER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"htdigest.exe\" SIZE=\"65607\" CHECKSUM=\"0x2D18206F\"\nBIN_FILE_VERSION=\"2.0.47.0\" BIN_PRODUCT_VERSION=\"2.0.47.0\"\nPRODUCT_VERSION=\"2.0.47\" FILE_DESCRIPTION=\"htdigest Utility\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache HTTP Server\"\nFILE_VERSION=\"2.0.47\" ORIGINAL_FILENAME=\"htdigest.exe.exe\"\nINTERNAL_NAME=\"htdigest.exe\" LEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2002 The Apache\nSoftware Foundation.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\"\nLINKER_VERSION=\"0x0\" UPTO_BIN_FILE_VERSION=\"2.0.47.0\"\nUPTO_BIN_PRODUCT_VERSION=\"2.0.47.0\" LINK_DATE=\"07/09/2003 04:57:40\"\nUPTO_LINK_DATE=\"07/09/2003 04:57:40\" VER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"htpasswd.exe\" SIZE=\"73799\" CHECKSUM=\"0xF2B639AE\"\nBIN_FILE_VERSION=\"2.0.47.0\" BIN_PRODUCT_VERSION=\"2.0.47.0\"\nPRODUCT_VERSION=\"2.0.47\" FILE_DESCRIPTION=\"htpasswd Utility\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache HTTP Server\"\nFILE_VERSION=\"2.0.47\" ORIGINAL_FILENAME=\"htpasswd.exe.exe\"\nINTERNAL_NAME=\"htpasswd.exe\" LEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2002 The Apache\nSoftware Foundation.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\"\nLINKER_VERSION=\"0x0\" UPTO_BIN_FILE_VERSION=\"2.0.47.0\"\nUPTO_BIN_PRODUCT_VERSION=\"2.0.47.0\" LINK_DATE=\"07/09/2003 04:57:41\"\nUPTO_LINK_DATE=\"07/09/2003 04:57:41\" VER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"libapr.dll\" SIZE=\"122952\" CHECKSUM=\"0x9971AC84\"\nBIN_FILE_VERSION=\"0.0.0.0\" BIN_PRODUCT_VERSION=\"0.0.0.0\"\nPRODUCT_VERSION=\"0.0.0.0\" FILE_DESCRIPTION=\"Apache Portability Runtime Library\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache Portable Runtime\"\nFILE_VERSION=\"0.0.0.0\" ORIGINAL_FILENAME=\"libapr.dll\" INTERNAL_NAME=\"libapr\"\nLEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2003 The Apache Software Foundation.\"\nVERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\" VERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\"\nMODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\" LINKER_VERSION=\"0x0\"\nUPTO_BIN_FILE_VERSION=\"0.0.0.0\" UPTO_BIN_PRODUCT_VERSION=\"0.0.0.0\"\nLINK_DATE=\"07/09/2003 04:53:02\" UPTO_LINK_DATE=\"07/09/2003 04:53:02\"\nVER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"libapriconv.dll\" SIZE=\"36947\" CHECKSUM=\"0x9E006DC2\"\nBIN_FILE_VERSION=\"0.0.0.0\" BIN_PRODUCT_VERSION=\"0.0.0.0\"\nPRODUCT_VERSION=\"0.0.0.0\" FILE_DESCRIPTION=\"Apache APR I18N Conversion Library\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache Portable Runtime\"\nFILE_VERSION=\"0.0.0.0\" ORIGINAL_FILENAME=\"libapriconv.dll\"\nINTERNAL_NAME=\"libapriconv\" LEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2003 The Apache\nSoftware Foundation.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\"\nLINKER_VERSION=\"0x0\" UPTO_BIN_FILE_VERSION=\"0.0.0.0\"\nUPTO_BIN_PRODUCT_VERSION=\"0.0.0.0\" LINK_DATE=\"07/09/2003 04:53:08\"\nUPTO_LINK_DATE=\"07/09/2003 04:53:08\" VER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"libaprutil.dll\" SIZE=\"168017\" CHECKSUM=\"0x16072260\"\nBIN_FILE_VERSION=\"0.0.0.0\" BIN_PRODUCT_VERSION=\"0.0.0.0\"\nPRODUCT_VERSION=\"0.0.0.0\" FILE_DESCRIPTION=\"Apache APR Utility Library\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache Portable Runtime\"\nFILE_VERSION=\"0.0.0.0\" ORIGINAL_FILENAME=\"libaprutil.dll\"\nINTERNAL_NAME=\"libaprutil\" LEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2003 The Apache\nSoftware Foundation.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\"\nLINKER_VERSION=\"0x0\" UPTO_BIN_FILE_VERSION=\"0.0.0.0\"\nUPTO_BIN_PRODUCT_VERSION=\"0.0.0.0\" LINK_DATE=\"07/09/2003 04:55:48\"\nUPTO_LINK_DATE=\"07/09/2003 04:55:48\" VER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"libhttpd.dll\" SIZE=\"249919\" CHECKSUM=\"0x1C2F6C94\"\nBIN_FILE_VERSION=\"2.0.47.0\" BIN_PRODUCT_VERSION=\"2.0.47.0\"\nPRODUCT_VERSION=\"2.0.47\" FILE_DESCRIPTION=\"Apache HTTP Server Core\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache HTTP Server\"\nFILE_VERSION=\"2.0.47\" ORIGINAL_FILENAME=\"libhttpd.dll.exe\"\nINTERNAL_NAME=\"libhttpd.dll\" LEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2002 The Apache\nSoftware Foundation.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\"\nLINKER_VERSION=\"0x0\" UPTO_BIN_FILE_VERSION=\"2.0.47.0\"\nUPTO_BIN_PRODUCT_VERSION=\"2.0.47.0\" LINK_DATE=\"07/09/2003 05:02:13\"\nUPTO_LINK_DATE=\"07/09/2003 05:02:13\" VER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"logresolve.exe\" SIZE=\"20553\" CHECKSUM=\"0x5B12A316\"\nBIN_FILE_VERSION=\"2.0.47.0\" BIN_PRODUCT_VERSION=\"2.0.47.0\"\nPRODUCT_VERSION=\"2.0.47\" FILE_DESCRIPTION=\"logresolve Utility\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache HTTP Server\"\nFILE_VERSION=\"2.0.47\" ORIGINAL_FILENAME=\"logresolve.exe.exe\"\nINTERNAL_NAME=\"logresolve.exe\" LEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2002 The Apache\nSoftware Foundation.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\"\nLINKER_VERSION=\"0x0\" UPTO_BIN_FILE_VERSION=\"2.0.47.0\"\nUPTO_BIN_PRODUCT_VERSION=\"2.0.47.0\" LINK_DATE=\"07/09/2003 04:57:42\"\nUPTO_LINK_DATE=\"07/09/2003 04:57:42\" VER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"rotatelogs.exe\" SIZE=\"41033\" CHECKSUM=\"0x943B360E\"\nBIN_FILE_VERSION=\"2.0.47.0\" BIN_PRODUCT_VERSION=\"2.0.47.0\"\nPRODUCT_VERSION=\"2.0.47\" FILE_DESCRIPTION=\"rotatelogs Utility\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache HTTP Server\"\nFILE_VERSION=\"2.0.47\" ORIGINAL_FILENAME=\"rotatelogs.exe.exe\"\nINTERNAL_NAME=\"rotatelogs.exe\" LEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2002 The Apache\nSoftware Foundation.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\"\nLINKER_VERSION=\"0x0\" UPTO_BIN_FILE_VERSION=\"2.0.47.0\"\nUPTO_BIN_PRODUCT_VERSION=\"2.0.47.0\" LINK_DATE=\"07/09/2003 04:57:42\"\nUPTO_LINK_DATE=\"07/09/2003 04:57:42\" VER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n    <MATCHING_FILE NAME=\"wintty.exe\" SIZE=\"20555\" CHECKSUM=\"0xCB14B75A\"\nBIN_FILE_VERSION=\"2.0.47.0\" BIN_PRODUCT_VERSION=\"2.0.47.0\"\nPRODUCT_VERSION=\"2.0.47\" FILE_DESCRIPTION=\"wintty Console Utility\"\nCOMPANY_NAME=\"Apache Software Foundation\" PRODUCT_NAME=\"Apache HTTP Server\"\nFILE_VERSION=\"2.0.47\" ORIGINAL_FILENAME=\"wintty.exe.exe\"\nINTERNAL_NAME=\"wintty.exe\" LEGAL_COPYRIGHT=\"Copyright \u00a9 2000-2002 The Apache\nSoftware Foundation.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x1\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0x0\"\nLINKER_VERSION=\"0x0\" UPTO_BIN_FILE_VERSION=\"2.0.47.0\"\nUPTO_BIN_PRODUCT_VERSION=\"2.0.47.0\" LINK_DATE=\"07/09/2003 04:57:46\"\nUPTO_LINK_DATE=\"07/09/2003 04:57:46\" VER_LANGUAGE=\"Engelska (USA) [0x409]\" />\n</EXE>\n<EXE NAME=\"kernel32.dll\" FILTER=\"GRABMI_FILTER_THISFILEONLY\">\n    <MATCHING_FILE NAME=\"kernel32.dll\" SIZE=\"944128\" CHECKSUM=\"0xE974D2BD\"\nBIN_FILE_VERSION=\"5.1.2600.1106\" BIN_PRODUCT_VERSION=\"5.1.2600.1106\"\nPRODUCT_VERSION=\"5.1.2600.1106\" FILE_DESCRIPTION=\"Klient-DLL f\u00f6r Windows NT BASE\nAPI\" COMPANY_NAME=\"Microsoft Corporation\" PRODUCT_NAME=\"Operativsystemet\nMicrosoft\u00ae Windows\u00ae \" FILE_VERSION=\"5.1.2600.1106 (xpsp1.020828-1920)\"\nORIGINAL_FILENAME=\"kernel32\" INTERNAL_NAME=\"kernel32\" LEGAL_COPYRIGHT=\"\u00a9\nMicrosoft Corporation. Med ensamr\u00e4tt.\" VERFILEDATEHI=\"0x0\" VERFILEDATELO=\"0x0\"\nVERFILEOS=\"0x40004\" VERFILETYPE=\"0x2\" MODULE_TYPE=\"WIN32\" PE_CHECKSUM=\"0xE818D\"\nLINKER_VERSION=\"0x50001\" UPTO_BIN_FILE_VERSION=\"5.1.2600.1106\"\nUPTO_BIN_PRODUCT_VERSION=\"5.1.2600.1106\" LINK_DATE=\"09/09/2002 21:06:43\"\nUPTO_LINK_DATE=\"09/09/2002 21:06:43\" VER_LANGUAGE=\"Svenska [0x41d]\" />\n</EXE>\n</DATABASE>\n\nPlease let me know if I can be of any further assistance. The temporary solution\nfor me is not to use the group feature of digest authentication... :-/\n\nBest regards,\nBj\u00f6rn", "id": 40519, "time": "2003-07-11T22:28:41Z", "creator": "bjorn.wiberg@outlook.com", "creation_time": "2003-07-11T22:28:41Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 21533, "attachment_id": null, "id": 42438, "time": "2003-08-08T19:00:44Z", "creator": "kurt@intricatesoftware.com", "creation_time": "2003-08-08T19:00:44Z", "is_private": false, "text": "This bug also exists in 1.3.28. I've encounterd it without using groups, just \nrequre user in the sub-DocumentRoot will cause apache to crash. It occurs if \nthe sub-DocumentRoot is restricted using .htaccess or via httpd.conf.\n\nI've debugged this somewhat and found that it is related to FancyIndexing \ncombined with auth digest. Here's a stack trace:\n\nnote_digest_auth_failure(request_rec * 0x00860dc0, const digest_config_struct * \n0x007c5e30, digest_header_struct * 0x00000000, int 0) line 1210 + 3 bytes\ndigest_check_auth(request_rec * 0x00860dc0) line 1861 + 33 bytes\nrun_method(request_rec * 0x00860dc0, int 7, int 0) line 370 + 7 bytes\nap_check_auth(request_rec * 0x00860dc0) line 427 + 17 bytes\nap_sub_req_lookup_file(const char * 0x00864f9e, const request_rec * 0x0085dad8) \nline 1027 + 186 bytes\nmake_autoindex_entry(char * 0x00864f9e, int 1, autoindex_config_struct * \n0x007b7478, request_rec * 0x0085dad8, char 78, char 65) line 1281 + 13 bytes\nindex_directory(request_rec * 0x0085dad8, autoindex_config_struct * 0x007b7478) \nline 1762 + 32 bytes\nhandle_autoindex(request_rec * 0x0085dad8) line 1822 + 13 bytes\nap_invoke_handler(request_rec * 0x0085dad8) line 518 + 10 bytes\nprocess_request_internal(request_rec * 0x0085dad8) line 1324 + 9 bytes\nap_process_request(request_rec * 0x0085dad8) line 1340 + 9 bytes\nchild_sub_main(int 0) line 5992\nchild_main(int 0) line 6062 + 9 bytes\n_threadstartex(void * 0x007f3a48) line 212 + 13 bytes\nKERNEL32! 77e8b2d8()\n\nnote_digest_auth_failure bombs because the third parameter (digest_header_rec \n*resp) is null. Here's the call to note_digest_auth_failure from \ndigest_check_auth:\n\n    note_digest_auth_failure(r, conf,\n\t(digest_header_rec *) ap_get_module_config(r->request_config,\n\t\t\t\t\t\t   &digest_auth_module),\n\t0);\n\nThe third parameter is passed via ap_get_module_config which returns 0.\n\nThis is as far as I got. I don't know enough about  \napache/mod_autoindex/mod_auth_digest to suggest a patch. I do have some \nquestions though. Why is FancyIndexing checking auth for sub directories while \nbuilding the index for the parrent? If this this valid, why would \nmod_auth_digest log an error in this case? The user hasn't even selected the \nsub directory, but the log file records it like they did:\n\nDigest: access to /webfolder/Kurt failed, reason: user kurt not allowed access\n\nHope this helps somewhat. I will help testing any proposed patches.\n\n-Kurt"}, {"count": 2, "tags": [], "creator": "bjorn.wiberg@outlook.com", "attachment_id": null, "text": "Hello Kurt!\n\nGlad that someone else has encountered the same thing. Well, sort of. :-)\n\nThe reason for mod_autoindex to look for .htaccess files in subdirectories is to exclude those subdirectories from the directory listing if the user isn't allowed access to them; a pretty nice feature.\n\nI have also noticed the \"access failed\" error messages in the error log, and they are somewhat annoying, although perhaps necessary to make things simple.\n    \nBasic authentication (instead of digest authentication) seems to work fine, though, without any crashes and with the intended functionality. That's my temporary solution until this bug gets fixed.\n\nBest regards,\nBj\u00f6rn", "id": 42454, "time": "2003-08-09T07:48:56Z", "bug_id": 21533, "creation_time": "2003-08-09T07:48:56Z", "is_private": false}, {"count": 3, "tags": [], "creator": "kurt@intricatesoftware.com", "attachment_id": null, "text": "I reviewed the 1.3.28 code some more and have a proposed patch (should I have \nopened a separate bug report for 1.3.28?). If I understand things correctly the \nfollowing is happening... request_req.request_config is being intialized in \nupdate_nonce_count. update_nonce_count appears to be called when the client \nsends authorization records. Since the call to digest_check_auth is comming \nfrom mod_autoindex's call to ap_sub_req_lookup_file and not from a browser \nrequest with authorization records, update_nonce_count is not being called and \nthus request_config is not being initialized. \n\nThe following patch assumes that if request_config is NULL then the call to \ndigest_check_auth must be coming from a non user request. If this is not true \nthen maybe another solution may be better. However, if the assumption is \ncorrect then we know when a call to digest_check_auth has been initiated not by \na user, so we don't need to log and note the failure. \n\n--- mod_auth_digest.c.orig\tSat Feb 15 22:42:24 2003\n+++ mod_auth_digest.c\tSun Aug 10 23:03:16 2003\n@@ -1788,6 +1788,7 @@\n     const digest_config_rec *conf =\n \t\t(digest_config_rec *) ap_get_module_config(r->per_dir_config,\n \t\t\t\t\t\t\t   &digest_auth_module);\n+    digest_header_rec *resp;\n     const char *user = r->connection->user;\n     int m = r->method_number;\n     int method_restricted = 0;\n@@ -1851,15 +1852,21 @@\n     if (!method_restricted)\n \treturn OK;\n \n-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, r,\n-\t\"Digest: access to %s failed, reason: user %s not allowed access\",\n-\tr->uri, user);\n+\tresp = (digest_header_rec *) ap_get_module_config(r->request_config,\n+\t\t\t\t\t\t\t\t  \n&digest_auth_module);\n \n-    note_digest_auth_failure(r, conf,\n-\t(digest_header_rec *) ap_get_module_config(r->request_config,\n-\t\t\t\t\t\t   &digest_auth_module),\n-\t0);\n-    return AUTH_REQUIRED;\n+\t/* if there isn't a resp initalized then this check auth\n+\tdidn't come from a user request (i.e. FancyIndexing) \n+\tso don't log it */\n+\tif (resp != NULL) {\n+\t\tap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, r,\n+\t\t\"Digest: access to %s failed, reason: user %s not allowed \naccess\",\n+\t\tr->uri, user);\n+\n+\t\tnote_digest_auth_failure(r, conf, resp,\t0);\n+\t}\n+\n+\treturn AUTH_REQUIRED;\n }\n\nPlease excuse any white space style errors, I wasn't sure what the style was \nfrom the existing code and didn't take the time to see if there was a published \nstyle for apache.\n\n-Kurt", "id": 42509, "time": "2003-08-11T03:49:39Z", "bug_id": 21533, "creation_time": "2003-08-11T03:49:39Z", "is_private": false}, {"count": 4, "tags": [], "creator": "bjorn.wiberg@outlook.com", "text": "Changed severity according to classification recommendations (\"crashes, loss of data, severe memory leak\").", "id": 42616, "attachment_id": null, "bug_id": 21533, "creation_time": "2003-08-12T12:11:42Z", "time": "2003-08-12T12:11:42Z", "is_private": false}]
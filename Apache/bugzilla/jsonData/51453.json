[{"count": 0, "tags": [], "creator": "apachebugs@chaney.e4ward.com", "is_private": false, "id": 147641, "attachment_id": null, "bug_id": 51453, "creation_time": "2011-06-30T14:10:50Z", "time": "2011-06-30T14:10:50Z", "text": "In Tomcat 7, I've noticed that a request to a URL that does not require authentication will get forwarded to the login page if the request contains an \"Authorization\" header.\n\nOur application expects these requests to be processed by the servlet.  The servlet parses the Authorization header and takes appropriate action (possibly redirecting to the login page or allowing the request if the headers contain an acceptible token).  This has worked in older versions of Tomcat.\n\nThe relevant part of our web.xml looks like:\n\n<security-constraint>\n\n  <web-resource-collection>\n    <web-resource-name>open</web-resource-name>\n    <url-pattern>/*</url-pattern>\n    <!-- several other url patterns -->\n  </web-resource-collection>\n\n  <user-data-constraint>\n    <transport-guarantee>CONFIDENTIAL</transport-guarantee>\n  </user-data-constraint>\n\n  <!-- Notice no auth-constraint element -->\n\n</security-constraint>\n\nI observed the behavior of org.apache.catalina.authenticator.AuthenticatorBase.invoke(), here's what I saw:\n\nThe constraints variable contains a single constraint that matches the security constraint from our web.xml above.\n\nOn line 520, authRequired is set to true because of the presence of the Authorization header.\n\nThe authenticate() call on line 535 fails and redirects to the login page."}, {"count": 1, "tags": [], "bug_id": 51453, "is_private": false, "text": "Please provide a simple sample web application that demonstrates this issue.\n\nYour snippet of web.xml is incomplete: I suspect that this issue depends on the <auth-method> that you are using.\n\n(The Authorization header is used by Tomcat Ant tasks, and nobody reported that those were broken.)\n\n> This has worked in older versions of Tomcat.\n\nWhich versions?", "id": 147643, "time": "2011-06-30T15:14:57Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-06-30T15:14:57Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "markt@apache.org", "is_private": false, "id": 147647, "attachment_id": null, "bug_id": 51453, "creation_time": "2011-06-30T15:32:02Z", "time": "2011-06-30T15:32:02Z", "text": "This looks like a regression due to the addition of the optional pre-authentication support. I should have a fix for this shortly."}, {"count": 3, "tags": [], "text": "This has been fixed in 7.0.x and will be included in 7.0.17 onwards.", "is_private": false, "bug_id": 51453, "id": 147650, "time": "2011-06-30T15:41:44Z", "creator": "markt@apache.org", "creation_time": "2011-06-30T15:41:44Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "sudarsha_wijenayake@ca.ibm.com", "is_private": false, "id": 147917, "attachment_id": null, "bug_id": 51453, "creation_time": "2011-07-14T15:44:50Z", "time": "2011-07-14T15:44:50Z", "text": "(In reply to comment #3)\n> This has been fixed in 7.0.x and will be included in 7.0.17 onwards.\n\nIs this fix now available in the following SVN path?\n\nhttp://svn.apache.org/repos/asf/tomcat/tc7.0.x/tags/TOMCAT_7_0_17/\n\nI would like to give it a try before 7.0.17 goes out. Thanks!"}, {"count": 5, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "The 7.0.17 was stopped, as was 7.0.18. 7.0.19 in currently in progress. You can build it from the tag or from http://people.apache.org/~markt/dev/tomcat-7/\n\nWARNING: This is NOT an official ASF release. It is a release candidate for testing purposes only.", "id": 147918, "time": "2011-07-14T15:47:46Z", "bug_id": 51453, "creation_time": "2011-07-14T15:47:46Z", "is_private": false}]
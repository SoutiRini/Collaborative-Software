[{"count": 0, "tags": [], "text": "APR_VERSION_STRING_CSV definition is malformed in apr HEAD and as far back as v1.5.1. I discovered this while attempting to build a win32 version using the mingwpy (gcc-based) toolchain. Some compilers (e.g., clang on macosx) don't fail until you actually reference the malformed definition, which is how I am guessing this malformed constant passed your builds. However, other compilers (e.g., in mingwpy toolchain) choke on it.\n\nTo reproduce, try compiling the following code sample, first as is to see how the HEAD version of the macro breaks; then comment out the first APR_VERSION_STRING_CSV definition and uncomment the second definition to see how the one from apr v1.5.1 breaks.\n\n```c\n#define APR_MAJOR_VERSION 2\n#define APR_MINOR_VERSION 0\n#define APR_PATCH_VERSION 0\n\n# From apr 2.0.0\n#define APR_VERSION_STRING_CSV APR_MAJOR_VERSION, \\\n                               APR_MINOR_VERSION, \\\n                               APR_PATCH_VERSION\n\n\n# From apr 1.5.1; was also malformed\n//#define APR_VERSION_STRING_CSV APR_MAJOR_VERSION ##, \\\n//                               ##APR_MINOR_VERSION ##, \\\n//                               ##APR_PATCH_VERSION\n\n\nint main() {\n    char* version = APR_VERSION_STRING_CSV;\n    return 0;\n}\n```\n\nThe error that I got while building apr with the mingwpy toolchain was the following:\n\n[ 97%] Building RC object CMakeFiles/libapr-1.dir/libapr.rc.obj\nC:\\mingwpy\\bin\\windres.exe  -O coff -DAPR_DECLARE_EXPORT -DWINNT -Dlibapr_1_EXPORTS -IC:\\Users\\Administrator\\nta\\nupic.c\nore\\build\\apr\\build -IC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\include -IC:\\Users\\Administrator\\nta\\nupic.core\\bu\nild\\apr\\include\\arch\\win32 -IC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\include\\arch\\unix -IC:\\Users\\Administrator\\\nnta\\nupic.core\\build\\apr\\include\\private   C:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\libapr.rc CMakeFiles\\libapr-1\n.dir\\libapr.rc.obj\nIn file included from C:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\libapr.rc:1:0:\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\include/apr_version.h:117:32: error: pasting \"APR_MAJOR_VERSION\" and \",\"\n does not give a valid preprocessing token\n #define APR_VERSION_STRING_CSV APR_MAJOR_VERSION ##, \\\n                                ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\libapr.rc:21:14: note: in expansion of macro 'APR_VERSION_STRING_CSV'\n  FILEVERSION APR_VERSION_STRING_CSV,0\n              ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\include/apr_version.h:117:52: error: pasting \",\" and \"APR_MINOR_VERSION\"\n does not give a valid preprocessing token\n #define APR_VERSION_STRING_CSV APR_MAJOR_VERSION ##, \\\n                                                    ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\libapr.rc:21:14: note: in expansion of macro 'APR_VERSION_STRING_CSV'\n  FILEVERSION APR_VERSION_STRING_CSV,0\n              ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\include/apr_version.h:118:32: error: pasting \"APR_MINOR_VERSION\" and \",\"\n does not give a valid preprocessing token\n                              ##APR_MINOR_VERSION ##, \\\n                                ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\libapr.rc:21:14: note: in expansion of macro 'APR_VERSION_STRING_CSV'\n  FILEVERSION APR_VERSION_STRING_CSV,0\n              ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\include/apr_version.h:118:52: error: pasting \",\" and \"APR_PATCH_VERSION\"\n does not give a valid preprocessing token\n                              ##APR_MINOR_VERSION ##, \\\n                                                    ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\libapr.rc:21:14: note: in expansion of macro 'APR_VERSION_STRING_CSV'\n  FILEVERSION APR_VERSION_STRING_CSV,0\n              ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\include/apr_version.h:117:32: error: pasting \"APR_MAJOR_VERSION\" and \",\"\n does not give a valid preprocessing token\n #define APR_VERSION_STRING_CSV APR_MAJOR_VERSION ##, \\\n                                ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\libapr.rc:22:17: note: in expansion of macro 'APR_VERSION_STRING_CSV'\n  PRODUCTVERSION APR_VERSION_STRING_CSV,0\n                 ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\include/apr_version.h:117:52: error: pasting \",\" and \"APR_MINOR_VERSION\"\n does not give a valid preprocessing token\n #define APR_VERSION_STRING_CSV APR_MAJOR_VERSION ##, \\\n                                                    ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\libapr.rc:22:17: note: in expansion of macro 'APR_VERSION_STRING_CSV'\n  PRODUCTVERSION APR_VERSION_STRING_CSV,0\n                 ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\include/apr_version.h:118:32: error: pasting \"APR_MINOR_VERSION\" and \",\"\n does not give a valid preprocessing token\n                              ##APR_MINOR_VERSION ##, \\\n                                ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\libapr.rc:22:17: note: in expansion of macro 'APR_VERSION_STRING_CSV'\n  PRODUCTVERSION APR_VERSION_STRING_CSV,0\n                 ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\include/apr_version.h:118:52: error: pasting \",\" and \"APR_PATCH_VERSION\"\n does not give a valid preprocessing token\n                              ##APR_MINOR_VERSION ##, \\\n                                                    ^\nC:\\Users\\Administrator\\nta\\nupic.core\\build\\apr\\libapr.rc:22:17: note: in expansion of macro 'APR_VERSION_STRING_CSV'\n  PRODUCTVERSION APR_VERSION_STRING_CSV,0\n                 ^\nC:\\mingwpy\\bin\\windres.exe: preprocessing failed.", "attachment_id": null, "id": 188741, "creator": "vitaly.krugl.web@gmail.com", "time": "2016-02-24T00:48:47Z", "bug_id": 59057, "creation_time": "2016-02-24T00:48:47Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59057, "text": "The head version of the file containing malformed APR_VERSION_STRING_CSV definition is http://svn.apache.org/viewvc/apr/apr/trunk/include/apr_version.h?view=markup\n\n\nThe 1.5.1 version of the file containing the malformed definition of APR_VERSION_STRING_CSV is http://svn.apache.org/viewvc/apr/apr/tags/1.5.1/include/apr_version.h?view=markup", "id": 188742, "time": "2016-02-24T00:51:37Z", "creator": "vitaly.krugl.web@gmail.com", "creation_time": "2016-02-24T00:51:37Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "It should have been defined similarly to APR_VERSION_STRING (using APR_STRINGIFY and quotes around punctuation), but with commas instead of periods.", "attachment_id": null, "id": 188743, "creator": "vitaly.krugl.web@gmail.com", "time": "2016-02-24T00:55:21Z", "bug_id": 59057, "creation_time": "2016-02-24T00:55:21Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 59057, "attachment_id": null, "id": 188747, "time": "2016-02-24T02:49:35Z", "creator": "vitaly.krugl.web@gmail.com", "creation_time": "2016-02-24T02:49:35Z", "is_private": false, "text": "Ignore my earlier comment about \"It should have been defined similarly to APR_VERSION_STRING (using APR_STRINGIFY and quotes around punctuation), but with commas instead of periods.\"\n\nI see what's going on here, and it's a catch-22 situation given how the *OLDER* apr_version.h and libapr.rc were implemented:\n\n\nFirst, apr_version.h in apr v1.5.1 contains a definition considered malformed by the gcc toolchain (mingwpy in particular):\n\n#define APR_VERSION_STRING_CSV APR_MAJOR_VERSION ##, \\\n                               ##APR_MINOR_VERSION ##, \\\n                               ##APR_PATCH_VERSION\n\nSo, the gcc compiler chokes on it. this was intended to produce the equivalent of\n\n#define APR_VERSION_STRING_CSV 1,5,1\n\nwhich libapr.rc relies on here:\n\nFILEVERSION APR_VERSION_STRING_CSV,0\nPRODUCTVERSION APR_VERSION_STRING_CSV,0\n\n\n\n\nThe ones in HEAD should be okay, though, since APR_VERSION_STRING_CSV has been redefined as the following, which passes the mingwpy build:\n\n#define APR_VERSION_STRING_CSV APR_MAJOR_VERSION, \\\n                               APR_MINOR_VERSION, \\\n                               APR_PATCH_VERSION"}]
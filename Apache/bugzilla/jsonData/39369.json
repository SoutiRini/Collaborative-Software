[{"count": 0, "tags": [], "creator": "thadig@gmail.com", "attachment_id": null, "id": 88329, "time": "2006-04-20T19:53:05Z", "bug_id": 39369, "creation_time": "2006-04-20T19:53:05Z", "is_private": false, "text": "Using the following setup:\nin apache2.conf, default setting for handling shtml files):\n<FilesMatch \"\\.shtml(\\..+)?$\">\n    SetOutputFilter INCLUDES\n</FilesMatch>\n\nin Directory directive:\n        <Directory /var/www/test>\n                Options +Includes\n                XBitHack On\n        </Directory>\n\nfollowing SSI code on a webpage:\ncat /var/www/test/foo.shtml\n<!--#config timefmt=\"%Y\" -->\nToday is <!--#echo var=\"DATE_LOCAL\" -->\n\nWeb page is called .shtml and is executable:\nchmod +x /var/www/test/foo.shtml\n\nOutput of this command is:\nToday is Thursday, 20-Apr-2006 12:34:11 PDT\n\ninstead of correct\nToday is 2006\n\nThus, SSI statements are parsed but timefmt is ignored.\n\n\nPotential workarounds:\n- Remove XBitHack On\n- Replace shtml handling in apache2.conf with\n  AddHandler server-parsed .shtml\n- Remove executable flag on web page\n- Rename web page to .html\n\n\nNote:\nThe settings depend on the name of file containing the timefmt statement\nbut the x bit of the file referenced in the URI.\n\nExample:\nUser goes to http://localhost/test/foo2.html\nfoo2.html has x bit set\nfoo2.html contains: <!--#include virtual=\"foo.shtml\" -->\nfoo.shtml contains above example code but does NOT have the x bit set\nProblem still appears\n\n\nNote:\nFound one reference to the same or similar problem here:\nhttp://www.columbia.edu/acis/dev/unixdev/doc/www2-transition-issues.shtml#config"}, {"count": 1, "tags": [], "bug_id": 39369, "is_private": false, "text": "Hmm. My first guess is, that the INCLUDES filter is added twice (which is\ntotally legal by itself, but perhaps not in this situtation) and these filters\nconflict somehow.\n\nNeed to dig deeper.", "id": 88332, "time": "2006-04-20T20:41:23Z", "creator": "nd@perlig.de", "creation_time": "2006-04-20T20:41:23Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 39369, "is_private": false, "text": "While experimenting with Apache 2.0 and 2.2 in preparation for an upgrade from \n1.3, I as well ran into this bug.  Some testing suggests that the bug may be \nrelated to content negotiation (yet, I'm not an Apache expert):\n\n- If I access a page not under content negotiation using the full URI, timefmt \nworks.\n\n- If I access a page under content negotion using the full URI (e.g. \n\"index.html.en\" instead of \"index.html\" - i.e. skipping the negotiation) \ntimefmt works.\n\n- If I access \"/\" (with only an \"index.html\" available) timefmt is ignored.\n\n- If I access a page under content negotiation without using the full URI (e.g. \n\"index.html\" instead of \"index.html.en\" or \"index.html.dk\" - i.e. leaving it up \nto the negotation to determine which file to display) timefmt is ignored.\n\nThis is with Debian etch's default configuration, with the addition of \n\"XBitHack on\", and the executable bit set on the HTML files.\n", "id": 95187, "time": "2006-10-28T18:22:31Z", "creator": "kaare@nightcall.dk", "creation_time": "2006-10-28T18:22:31Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 39369, "text": "I can confirm this on apache-2.2.3 on Gentoo.\n\ntimefmt doesn't get parsed if a file is accessed through content negotiation. \nAccesses using the full URI or through a rewrite work just fine.", "id": 95881, "time": "2006-11-15T15:05:40Z", "creator": "jani-matti.hatinen@iki.fi", "creation_time": "2006-11-15T15:05:40Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 39369, "attachment_id": null, "text": "*** Bug 32622 has been marked as a duplicate of this bug. ***", "id": 107233, "time": "2007-08-24T10:29:41Z", "creator": "slive@apache.org", "creation_time": "2007-08-24T10:29:41Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 39369, "text": "Hard to believe this is now 2009 and this bug is discovered a lot of times without fix for several years.\n\nI hit this problem recently, and after a google search for workaround I found this bug is keep being reported in the recent 3 years (so it seems the problem started 3 years ago)\n\nHere are my finding of report of this bug on multiple forums:\n\nhttp://objectmix.com/apache/671983-ssi-config-timefmt-not-working-properly.html\n\nhttp://www.columbia.edu/acis/dev/unixdev/doc/www2-transition-issues.shtml#config (see the bottom of this page describe timefmt doesn't work in certain cases)\n\nhttp://bugs.debian.org/cgi-bin/bugreport.cgi?bug=363964\n(the bug report of the same issue on debian)\n\nhttp://markmail.org/message/74x5a67wdvsxqort\n(note this may not be the same bug)\n\nhttp://www.webmasterworld.com/apache/3574077.htm\n(a good bug report, state clearly for him this issue occurs only if x-bit is set)\n\nhttp://mail-archives.apache.org/mod_mbox/httpd-users/200403.mbox/%3c20040305105747.6408209f.shane@howsyournetwork.com%3e\n(this guy is quite clueless but found the issue)\n\nhttp://www.computing.net/answers/webdevel/ssi-config-timefmt-not-working/2708.html\n(in this case, the people who wanted to answer him is clueless)\n", "id": 124213, "time": "2009-01-20T18:39:40Z", "creator": "zhangweiwu@realss.com", "creation_time": "2009-01-20T18:39:40Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 39369, "is_private": false, "text": "In my case, my gentoo linux installation ignore config timefmt if x-bit is set, for my ubuntu installation it ignores config timefmt whatever I do (all workarounds doesn't work, including: rename it to .shtml, remove the x-bit, refer to it directly in URI without content negotiation...)", "id": 124214, "time": "2009-01-20T18:41:27Z", "creator": "zhangweiwu@realss.com", "creation_time": "2009-01-20T18:41:27Z", "attachment_id": null}, {"count": 7, "text": "Is this reproducible in 2.2.9?  I would wonder whether this is the same root-cause as bug 41960.", "creator": "jorton@redhat.com", "attachment_id": null, "id": 124225, "time": "2009-01-21T03:46:55Z", "bug_id": 39369, "creation_time": "2009-01-21T03:46:55Z", "tags": [], "is_private": false}, {"attachment_id": 23150, "tags": [], "bug_id": 39369, "text": "Created attachment 23150\nPatch to not add the filter twice\n\nIt does seem to be due to the filter getting added to the chain more than once.  This patch for trunk fixes that for me.", "count": 8, "id": 124233, "time": "2009-01-21T05:25:55Z", "creator": "poirier@pobox.com", "creation_time": "2009-01-21T05:25:55Z", "is_private": false}, {"count": 9, "tags": [], "creator": "nick@webthing.com", "text": "*** Bug 46556 has been marked as a duplicate of this bug. ***", "id": 124237, "time": "2009-01-21T07:14:01Z", "bug_id": 39369, "creation_time": "2009-01-21T07:14:01Z", "is_private": false, "attachment_id": null}, {"count": 10, "text": "Created attachment 23206\nTest for this problem\n\nThis patch for the Apache test framework (trunk) adds a test that reproduces the problem, failing on trunk and 2.2.x right now, and passes on trunk after applying the fix patch from above.", "bug_id": 39369, "attachment_id": 23206, "id": 124533, "time": "2009-01-30T09:06:28Z", "creator": "poirier@pobox.com", "creation_time": "2009-01-30T09:06:28Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 39369, "text": "Can someone else verify that this patch resolves the problem for them?", "id": 124534, "time": "2009-01-30T09:06:52Z", "creator": "poirier@pobox.com", "creation_time": "2009-01-30T09:06:52Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 39369, "attachment_id": null, "id": 124838, "time": "2009-02-13T06:07:00Z", "creator": "zhangweiwu@realss.com", "creation_time": "2009-02-13T06:07:00Z", "is_private": false, "text": "Hi. I wish to test if the patch solves the problem but I am too dump to patch packages in Ubuntu Server. I used to do it in Gentoo with ease because it is a source-code-based distribution, but don't know how can I do it for Debian. Googling around it (things like builder's handbook) seems to be too complicated for me. If you can offer a debian package then I'd be glad to test...\n\nI have the following packages:\n\n$ aptitude search apache | grep ^i\ni   apache2                         - Next generation, scalable, extendable web \ni A apache2-mpm-prefork             - Traditional model for Apache HTTPD        \ni A apache2-utils                   - utility programs for webservers           \ni A apache2.2-common                - Next generation, scalable, extendable web \ni   libapache2-mod-jk               - Apache 2 connector for the Tomcat Java ser\ni   libapache2-mod-perl2            - Integration of perl with the Apache2 web s\ni A libapache2-mod-php5             - server-side, HTML-embedded scripting langu\ni   zimbra-apache                   - Best email money can buy                  \n"}, {"count": 13, "tags": [], "creator": "covener@gmail.com", "text": "(In reply to comment #12)\n\n> If you can offer a debian package then I'd be glad to test...\n\nRoughly:\n\napt-get source apache2\napt-get build-dep apache2.2-common\ncd apache2-2*\napply patch\ndpkg-buildpackage\ninstall the resulting pkg\n\n", "id": 124840, "time": "2009-02-13T06:15:40Z", "bug_id": 39369, "creation_time": "2009-02-13T06:15:40Z", "is_private": false, "attachment_id": null}, {"count": 14, "tags": [], "bug_id": 39369, "is_private": false, "text": "(In reply to comment #8)\n> Created an attachment (id=23150) [details]\n> Patch to not add the filter twice\n> \n> It does seem to be due to the filter getting added to the chain more than once.\n>  This patch for trunk fixes that for me.\n> \n\nI'm having this problem as well, but the patch does not fix the issue for me.\n", "id": 124981, "time": "2009-02-19T07:59:12Z", "creator": "lars@apache.org", "creation_time": "2009-02-19T07:59:12Z", "attachment_id": null}, {"count": 15, "text": "> This patch for the Apache test framework (trunk) adds a test that reproduces\n> the problem, failing on trunk and 2.2.x right now, and passes on trunk after\n> applying the fix patch from above.  \n\nSorry I couldn't understand what do you want me to do. I downloaded both httpd-2.2.10 source code and snapshot http://cvs.apache.org/snapshots/httpd/httpd_20090317091426.tar.gz and both cannot accept the patch. The file being patched to could not be found (e.g. \"find . -iname include.conf.in\" gives zero results for source extracted from both tar-ball.\n\nI could be too stupid to know how to patch apache (I patched a lot other software before, however). Can you give me a link what should I do in order to test your patch?", "bug_id": 39369, "attachment_id": null, "id": 125599, "time": "2009-03-17T07:01:47Z", "creator": "zhangweiwu@realss.com", "creation_time": "2009-03-17T07:01:47Z", "tags": [], "is_private": false}, {"count": 16, "tags": [], "creator": "jorton@redhat.com", "text": "From a gdb session:\n\n1) yes, there are indeed two adjacent INCLUDES filters in the filter chain\n\n2) at the time that handle_echo() evaluates the DATE_LOCAL variable, r->subprocess_env has DATE_LOCAL set to the LAZY_VALUE sentinel.\n\n3) it then calls into add_include_vars_lazy() to set up DATE_LOCAL properly\n\n4) add_include_vars_lazy() uses the default timefmt setting from the configuration -- ignoring any timefmt setting from the SSI script itself\n\nUnverified conjecture: (2) is happening because the second INCLUDES filter is coming in and nuking the DATE_LOCAL etc set up correctly when the first filter interpreted the \"config timefmt\" section.\n\nAvoiding multiple INCLUDES in a filter chain sounds kind of attractive but I'm not sure why such a configuration should be a explicitly forbidden.\n\nFixing add_include_vars_lazy() to inherit the script's timefmt setting would seem to be an alternative fix for this.  Indeed, add_include_vars() already takes ctx->time_str but ignores it.", "id": 125600, "time": "2009-03-17T07:49:40Z", "bug_id": 39369, "creation_time": "2009-03-17T07:49:40Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "bug_id": 39369, "text": "Created attachment 23391\nalternative fix\n\nThis is an alternative fix which passes Dan's test case for me (thanks for that, Dan!).", "id": 125601, "time": "2009-03-17T08:00:28Z", "creator": "jorton@redhat.com", "creation_time": "2009-03-17T08:00:28Z", "is_private": false, "attachment_id": 23391}, {"count": 18, "tags": [], "creator": "poirier@pobox.com", "attachment_id": null, "text": "Status update: Joe Orton committed fix to trunk\nhttp://svn.apache.org/viewvc?view=rev&revision=757376\nNot yet proposed for backport.", "id": 125755, "time": "2009-03-24T06:03:28Z", "bug_id": 39369, "creation_time": "2009-03-24T06:03:28Z", "is_private": false}, {"count": 19, "tags": [], "bug_id": 39369, "text": "Backported to 2.2.x as r773352.", "id": 126915, "time": "2009-05-10T08:14:36Z", "creator": "rpluem@apache.org", "creation_time": "2009-05-10T08:14:36Z", "is_private": false, "attachment_id": null}, {"count": 20, "text": "*** Bug 30773 has been marked as a duplicate of this bug. ***", "bug_id": 39369, "is_private": false, "id": 127286, "time": "2009-05-22T07:41:19Z", "creator": "poirier@pobox.com", "creation_time": "2009-05-22T07:41:19Z", "tags": [], "attachment_id": null}, {"count": 21, "tags": [], "creator": "zhangweiwu@realss.com", "attachment_id": null, "text": "Hi. As a stupid administrator who don't know about version control can you please hint since which version of 2.2.x release should I download and install on the production server that would contain this backport? Thanks in advance!", "id": 138233, "time": "2010-07-06T21:58:35Z", "bug_id": 39369, "creation_time": "2010-07-06T21:58:35Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 39369, "text": "(In reply to comment #21)\n> Hi. As a stupid administrator who don't know about version control can you\n> please hint since which version of 2.2.x release should I download and install\n> on the production server that would contain this backport? Thanks in advance!\n\nGet the latest. The changelog:\n\n  http://www.apache.org/dist/httpd/CHANGES_2.2\n\nshows it was in 2.2.12 and later.", "count": 22, "id": 138235, "time": "2010-07-06T22:18:37Z", "creator": "covener@gmail.com", "creation_time": "2010-07-06T22:18:37Z", "is_private": false}]
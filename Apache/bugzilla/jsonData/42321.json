[{"count": 0, "tags": [], "text": "Installed the version of Apache that comes with Solaris 10.  It is based on\nhttpd-2.0.52,55, and 58, depending on the patch level.  They added LFS support\nwith the patch (120543-09), which also brought apache up to version 2.0.58.  We\nhave an in house developed auth module (mod_bluestem,\nhttp://www-dev.cites.uiuc.edu/mod_bluestem/) that break when the patch is\ninstalled.  The problem is the request_rec structure is corrupted when calling\nany of the bluestem hooks.  Specifically, r->per_dir_config is set to NULL.  In\nmy debugging with the Sun Apache source code, the vanilla httpd-2.0.58 source\ncode, I found that the configure script for srclib/apr has a bug in it.  \n\nsupirzyk@nani:/scratch/httpd-2.0.58/srclib/apr\n9>diff -Nru configure.in.orig configure.in\n--- configure.in.orig   2006-03-16 04:04:04.000000000 -0600\n+++ configure.in        2007-05-02 10:50:46.687788000 -0500\n@@ -1199,7 +1199,7 @@\n if test \"$ac_cv_type_off_t\" = \"yes\"; then\n     APR_CHECK_SIZEOF_EXTENDED([#include <sys/types.h>], off_t, 8)\n     AC_MSG_CHECKING([which type to use for apr_off_t])\n-    if test \"${ac_cv_sizeof_off_t}${ac_cv_sizeof_long}\" = \"44\"; then\n+    if test \"${ac_cv_sizeof_off_t}${ac_cv_sizeof_long}\" != \"44\"; then\n         # Special case: off_t may change size with _FILE_OFFSET_BITS\n         # on 32-bit systems with LFS support.  To avoid compatibility\n         # with other software which may export _FILE_OFFSET_BITS,\n\nI have verified the problem exists in 2.0.59 as well.", "is_private": false, "id": 102769, "creation_time": "2007-05-02T10:57:40Z", "time": "2007-05-02T10:57:40Z", "creator": "pirzyk+apache@uiuc.edu", "bug_id": 42321, "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "jorton@redhat.com", "text": "That bit of configure code works as intended.  APR 0.9.x does not (and cannot)\nsupport LFS - adding such support will change the ABI.  It looks like Sun knew\nthis; see \"note 2\":\n\nhttp://sunsolve.sun.com/search/document.do?assetkey=1-21-120543-09-1", "id": 102777, "time": "2007-05-02T11:50:29Z", "bug_id": 42321, "creation_time": "2007-05-02T11:50:29Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "pirzyk+apache@uiuc.edu", "text": "After recomping mod_bluestem, per note 2, the problem still exists.  Why do you set off_t to long when \noff_t and long are the same.  It is a no-op and a waste of code for configure.  If it is supposed to be \nthat way, then there still is a MAJOR bug in apache.  r->per_dir_config should NEVER be NULL when \ncalling modules.  The macro, ap_get_module_config never test to see of r->per_dir_config is NULL.\n\nThe second point, per the comments in configure.in\n\n        # Special case: off_t may change size with _FILE_OFFSET_BITS\n        # on 32-bit systems with LFS support.  To avoid compatibility\n        # with other software which may export _FILE_OFFSET_BITS,\n        # hard-code apr_off_t to long.\n\n\nThis means that _FILE_OFFSET_BITS is set to something other than a long.  On a 32 bit OS, that is 4 \nbytes.  The test case will be true if off_t == long.  The comments do not say this, the comments imply \nthat off_t != long.  That makes the test wrong.", "id": 102779, "time": "2007-05-02T12:25:21Z", "bug_id": 42321, "creation_time": "2007-05-02T12:25:21Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 42321, "text": "Found that mod_bluestem is not honoring CPPFLAGS as defined by apxs.", "id": 102784, "time": "2007-05-02T14:47:52Z", "creator": "pirzyk+apache@uiuc.edu", "creation_time": "2007-05-02T14:47:52Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "jorton@redhat.com", "text": "Ah, yes, the comment is wrong; APR 0.9.x sets apr_off_t to \"long\" for the cases\nwhere other packages may redefine _FILE_OFFSET_BITS and change the definition of\noff_t.  I've updated it: http://svn.apache.org/viewvc?view=rev&rev=534764", "id": 102802, "time": "2007-05-03T02:38:38Z", "bug_id": 42321, "creation_time": "2007-05-03T02:38:38Z", "is_private": false, "attachment_id": null}]
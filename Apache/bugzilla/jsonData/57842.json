[{"count": 0, "tags": [], "creator": "pcllau@gmail.com", "attachment_id": 32673, "text": "Created attachment 32673\norg.eclipse.mat report\n\nI am running a web application on Apache Tomcat version 7.0.56, using jdk 1.7.0_45, spring 3.1.0.RC2, and experiencing what I think is a memory leak in the POI API version 3.9, or one of it's dependencies.\n\nWhen using POI 3.9 API memory consumed reading an xlsx file is not released back to the operating system after completion.\n\norg.eclipse.mat reports the following information (See attachment for full details):\n\nThe thread org.apache.tomcat.util.threads.TaskThread @ 0x5eca3afb0 http-bio-8091-exec-10 keeps local variables with total size 68,205,584 (35.67%) bytes.\nThe memory is accumulated in one instance of \"byte[]\" loaded by \"<system class loader>\".", "id": 182534, "time": "2015-04-21T14:54:34Z", "bug_id": 57842, "creation_time": "2015-04-21T14:54:34Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 57842, "attachment_id": null, "id": 182542, "time": "2015-04-21T23:52:51Z", "creator": "apache@gagravarr.org", "creation_time": "2015-04-21T23:52:51Z", "is_private": false, "text": "Please re-test with at least 3.12 beta 1, or ideally a build from svn / nightly build. There have been lots of bugs fixed (including memory related ones) since 3.9 came out in 2012"}, {"count": 2, "tags": [], "bug_id": 57842, "attachment_id": null, "text": "Failed test case information below:\n\nUsed following to read xlsx spreadsheet files:\n\n  // XSSFWorkbook, File\n  OPCPackage pkg = OPCPackage.open(new File(\"file.xlsx\"));\n  XSSFWorkbook wb = new XSSFWorkbook(pkg);\n  ....\n  pkg.close();\n  // XSSFWorkbook, InputStream, needs more memory\n  OPCPackage pkg = OPCPackage.open(myInputStream);\n  XSSFWorkbook wb = new XSSFWorkbook(pkg);\n  ....\n  pkg.close();\n\nVersions POI tested on:\n\n3.9\n3.11\n3.12-beta1\n\nWebserver: Apache Tomcat 7.0.61\nJDK: 1.7.0_79", "id": 182554, "time": "2015-04-22T12:11:42Z", "creator": "pcllau@gmail.com", "creation_time": "2015-04-22T12:11:42Z", "is_private": false}, {"count": 3, "tags": [], "creator": "pcllau@gmail.com", "is_private": false, "id": 182556, "creation_time": "2015-04-22T13:36:53Z", "time": "2015-04-22T13:36:53Z", "bug_id": 57842, "text": "To clarify, I have confirmed that I am experiencing the same memory leak issue for POI versions 3.9, 3.11, 3.12-beta1. After calling new XSSFWorkbook(file), the consumed memory is not released back to the operating system", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 57842, "text": "My Apache Tomcat server stderr logs the following issue below which may be closely linked to an existing bugzilla issue https://issues.apache.org/jira/browse/XMLBEANS-502\n\nApr 22, 2015 3:58:12 PM org.apache.catalina.loader.WebappClassLoader checkThreadLocalMapForLeaks\nSEVERE: The web application [/ProVista] created a ThreadLocal with key of type [org.apache.xmlbeans.XmlBeans$1] (value [org.apache.xmlbeans.XmlBeans$1@29c9fb0e]) and a value of type [java.lang.ref.SoftReference] (value [java.lang.ref.SoftReference@56d53bd3]) but failed to remove it when the web application was stopped. Threads are going to be renewed over time to try and avoid a probable memory leak.", "count": 4, "id": 182562, "time": "2015-04-22T15:28:50Z", "creator": "pcllau@gmail.com", "creation_time": "2015-04-22T15:28:50Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 57842, "attachment_id": null, "id": 182582, "time": "2015-04-23T02:10:29Z", "creator": "apache@gagravarr.org", "creation_time": "2015-04-23T02:10:29Z", "is_private": false, "text": "Try calling close on the workbook, and also ensure that no references to the workbook or sheets within it remain when you're done processing"}, {"count": 6, "tags": [], "text": "Test-case-1:\n\nConfiguration:\n    Apache Tomcat 7.0.61\n    JDK 1.7.0_79\n    POI-3.12-beta1\nCode: \n    // open a 6.2MB xlsx file containg 910,000 rows data \n    Workbook wb = new XSSFWorkbook(new File(\"file_name\")); \n    wb.close(); \n\nTest-case-1 result: memory-use: 1.9GB (doesn't release after closing workbook). On subsequently re-opening the same workbook the memory use remains at 1.9GB, and tomcat stderr logs the following severe messages:\nApr 23, 2015 1:12:24 PM org.apache.catalina.loader.WebappClassLoader checkThreadLocalMapForLeaks\nSEVERE: The web application [/ProVista] created a ThreadLocal with key of type [org.apache.xmlbeans.XmlBeans$1] (value [org.apache.xmlbeans.XmlBeans$1@3c59c852]) and a value of type [java.lang.ref.SoftReference] (value [java.lang.ref.SoftReference@2b19a30e]) but failed to remove it when the web application was stopped. Threads are going to be renewed over time to try and avoid a probable memory leak.\n\n\nTest-case2:\n\nConfiguration:\n    Apache Tomcat 7.0.61\n    JDK 1.7.0_79\n    POI-3.11\nCode: \n    // open a 6.2MB xlsx file containg 910,000 rows data \n    Workbook wb = new XSSFWorkbook(new File(\"file_name\")); \n    wb.close(); \n\nTest-case-2 result: memory-use: 1.8GB (doesn't release after closing workbook). On subsequently re-opening the same workbook the memory use remains at 1.8GB", "is_private": false, "id": 182594, "creator": "pcllau@gmail.com", "time": "2015-04-23T12:23:33Z", "bug_id": 57842, "creation_time": "2015-04-23T12:23:33Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 57842, "attachment_id": null, "id": 196187, "time": "2017-01-19T08:15:04Z", "creator": "onealj@apache.org", "creation_time": "2017-01-19T08:15:04Z", "is_private": false, "text": "Allow the workbook and anything it references to be garbage collected\n> wb = null\nor just let wb fall out of scope.\n\nAre you able to get a refcount on POI objects?"}]
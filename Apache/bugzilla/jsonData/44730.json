[{"count": 0, "tags": [], "text": "I have the following config:\n\n<VirtualHost *:80>\n    ServerName alpha.xri.net\n    ProxyRequests Off\n    ProxyPass / http://localhost:8003/ nocanon\n    ProxyPassReverse / http://localhost:8003/\n    ErrorLog logs/alphaxriproxy-error_log\n    CustomLog \"|/usr/sbin/cronolog /usr/local/apache2/logs/alphaxriproxy.log.%Y-%m-%d\" combined\n</VirtualHost>\n\n\nWhen a request comes in to the local server:\n\nhttp://alpha.xri.net/proxy/=kermit*%E6%97%A5%E6%9C%AC%E7%89%88?_xrd_r=application/xrds+xml\n\nthe mapped remote server URL became:\n\nhttp://localhost:8003/proxy/=kermit*%E6%97%A5%E6%9C%AC%E7%89%88?_xrd_r=application/xrds+xml?_xrd_r=application/xrds+xml\n\nThis seems to happen when \"nocanon\" is turned on.\n\nThis is related to bug 41798.", "is_private": false, "id": 115193, "creator": "wil@dready.org", "time": "2008-04-01T10:58:29Z", "bug_id": 44730, "creation_time": "2008-04-01T10:58:29Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 44730, "attachment_id": 21755, "is_private": false, "id": 115194, "time": "2008-04-01T11:02:27Z", "creator": "wil@dready.org", "creation_time": "2008-04-01T11:02:27Z", "text": "Created attachment 21755\nProof-of-concept that fixes the issue\n\nThis seems to be due to the code handling the \"nocanon\" option using r->unparsed_uri instead of r->uri. The r->unparsed_uri contains the query string while r->uri does not.\n\nThis patch excludes the query portion of r->unparsed_uri when constructing the remote server URL."}]
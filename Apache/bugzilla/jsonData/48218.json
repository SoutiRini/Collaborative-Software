[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "is_private": false, "id": 132070, "time": "2009-11-17T18:36:19Z", "bug_id": 48218, "creation_time": "2009-11-17T18:36:19Z", "text": "If I run \"catalina.bat start -security\" with the latest tc6.0.x as of rev.881628, it fails with the following exception:\n\n18.11.2009 4:36:16 org.apache.catalina.loader.WebappClassLoader findClass\nWARNING: WebappClassLoader.findClassInternal(chat.ChatServlet) security exception: access denied (java.lang.RuntimePermission accessClassInPackage.org.apache.catalina)\njava.security.AccessControlException: access denied (java.lang.RuntimePermission accessClassInPackage.org.apache.catalina)\n\tat java.security.AccessControlContext.checkPermission(AccessControlContext.java:323)\n\tat java.security.AccessController.checkPermission(AccessController.java:546)\n\tat java.lang.SecurityManager.checkPermission(SecurityManager.java:532)\n\tat java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1512)\n\tat java.lang.ClassLoader$1.run(ClassLoader.java:331)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.lang.ClassLoader.checkPackageAccess(ClassLoader.java:329)\n\tat java.lang.ClassLoader.defineClass1(Native Method)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:621)\n\tat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124)\n\tat org.apache.catalina.loader.WebappClassLoader.findClassInternal(WebappClassLoader.java:1956)\n\tat org.apache.catalina.loader.WebappClassLoader.findClass(WebappClassLoader.java:913)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1387)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1266)\n\tat org.apache.catalina.startup.WebAnnotationSet.loadApplicationServletAnnotations(WebAnnotationSet.java:108)\n\tat org.apache.catalina.startup.WebAnnotationSet.loadApplicationAnnotations(WebAnnotationSet.java:58)\n\tat org.apache.catalina.startup.ContextConfig.applicationAnnotationsConfig(ContextConfig.java:297)\n\tat org.apache.catalina.startup.ContextConfig.start(ContextConfig.java:1069)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:261)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:4339)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:791)\n\tat org.apache.catalina.core.ContainerBase.access$000(ContainerBase.java:123)\n\tat org.apache.catalina.core.ContainerBase$PrivilegedAddChild.run(ContainerBase.java:145)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:769)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:526)\n\tat org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:989)\n\tat org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:912)\n\tat org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:495)\n\tat org.apache.catalina.startup.HostConfig.start(HostConfig.java:1225)\n\tat org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:314)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1053)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:722)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1045)\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:516)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:710)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:583)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:289)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414)\n\n\nApparently the cause of it is that the chat.ChatServlet class of the examples webapp fails to load the following classes:\n  org.apache.catalina.CometEvent;\n  org.apache.catalina.CometProcessor;\n\nThis issue is observable in 6.0.20, but manifests itself silently: the following URL [1] works when running without security manager and fails with Error 500 (java.lang.ClassNotFoundException: chat.ChatServlet) when running with security manager.\n\n[1] http://localhost:8080/examples/jsp/chat/chat\n\nI mean that the statement that prints out the exception was added in revision 832373 and 6.0.20 just swallows it.\n\nI wonder\na) whether we should preload those Comet API classes,\nb) why do we have them directly in \"org.apache.catalina\",\nc) whether there is another way to fix it, e.g. like Servlet API classes do not throw such exception though they are not preloaded"}, {"count": 1, "attachment_id": null, "bug_id": 48218, "is_private": false, "id": 132080, "time": "2009-11-18T03:51:12Z", "creator": "markt@apache.org", "creation_time": "2009-11-18T03:51:12Z", "tags": [], "text": "Access is controlled per package so the Comet API really needs to be in a separate package (like the Servlet API). This was done for trunk in r833510 but it is an API breaking change so a straight back-port to 6.0.x is not possible.\n\nGiven the circumstances, I leaning towards won't fix for this issue."}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 132220, "time": "2009-11-22T15:17:44Z", "bug_id": 48218, "creation_time": "2009-11-22T15:17:44Z", "text": "Thought about this some more and there is no easy fix for 6.0.x that doesn't break the API. Note this has been fixed for 7.0.x but is a WONTFIX for 6.0.x."}, {"count": 3, "tags": [], "bug_id": 48218, "attachment_id": 25379, "id": 136554, "time": "2010-04-30T01:41:27Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-04-30T01:41:27Z", "is_private": false, "text": "Created attachment 25379\n2010-04-30_tc6_bug48218.patch - patch for catalina.policy\n\nAttaching a patch for catalina.policy.\n\nFor reference: RuntimePermission matching rules are described in its JavaDoc:\nhttp://java.sun.com/javase/6/docs/api/java/lang/RuntimePermission.html\n\nI will not propose this patch for TC6. Granting this permission by default is too risky because it provides access to Server API. Granting it to the examples app, as the patch does, is better, but will confuse those who do not have the examples app installed.\n\nThis issue remains as WONTFIX.\n\nWe can add a note to the RELEASE-NOTES, though."}, {"count": 4, "tags": [], "creator": "knst.kolinko@gmail.com", "is_private": false, "text": "*** Bug 49212 has been marked as a duplicate of this bug. ***", "id": 136557, "time": "2010-04-30T01:49:38Z", "bug_id": 48218, "creation_time": "2010-04-30T01:49:38Z", "attachment_id": null}]
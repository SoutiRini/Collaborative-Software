[{"count": 0, "tags": [], "creator": "billb@haht.com", "attachment_id": null, "is_private": false, "id": 21557, "time": "2002-08-22T19:42:34Z", "bug_id": 11947, "creation_time": "2002-08-22T19:42:34Z", "text": "A memory profiler that I am using reports a growing number of CaptureLog \nobjects that are referenced in the static Hashtable \"logs\" in the class \norg.apache.tomcat.util.log.SystemLogHandler.   By examing the Tomcat source \ncode, I believe I have discovered the reason for this (but not the appropriate \nfix):  \n\n1. The class org.apache.catalina.connector.RequestBase calls \nSystemLogHandler.startCapture() in the setContext() method, and calls \nSystemLogHandler.stopCapture() in the recycle() method.   So if setContext() is \ncalled and recycle() isn't, stopCapture is not called, and the CaptureLog \nobject created by startCapture isn't removed from the Hashtable in \nSystemLogHandler.\n\n2. In org.apache.catalina.core.ApplicationContext, the getRequestDispatcher() \nmethod calls setContext() on a HttpRequestBase object, but doesn't call recycle\n():\n\n        // The remaining code is duplicated in PrivilegedGetRequestDispatcher,\n        // we need to make sure they stay in sync\n        HttpRequestBase request = new HttpRequestBase();\n        request.setContext(context);\n        request.setContextPath(context.getPath());\n        request.setRequestURI(contextPath + relativeURI);\n        request.setQueryString(queryString);\n        Wrapper wrapper = (Wrapper) context.map(request, true);\n        if (wrapper == null)\n            return (null);\n\n        // Construct a RequestDispatcher to process this request\n        HttpServletRequest hrequest =\n            (HttpServletRequest) request.getRequest();\n\t\t\n        return (RequestDispatcher) new ApplicationDispatcher(wrapper,\n                        hrequest.getServletPath(),\n                        hrequest.getPathInfo(),\n                        hrequest.getQueryString(),\n                        null);"}, {"count": 1, "tags": [], "text": "I have noticed a memory leak also, this could very well be it.\nI am looking into a better way to capture stderr/stdout so it\ncan be logged to the Context log.  Thanks for reporting this.", "attachment_id": null, "bug_id": 11947, "id": 21709, "time": "2002-08-26T01:46:55Z", "creator": "glenn@apache.org", "creation_time": "2002-08-26T01:46:55Z", "is_private": false}, {"count": 2, "tags": [], "creator": "glenn@apache.org", "attachment_id": null, "id": 21753, "time": "2002-08-26T20:28:24Z", "bug_id": 11947, "creation_time": "2002-08-26T20:28:24Z", "is_private": false, "text": "I have committed a patch to CVS for this bug.  It should be available\ntomorrow after the nightly build."}]
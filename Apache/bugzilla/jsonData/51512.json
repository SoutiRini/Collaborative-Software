[{"count": 0, "tags": [], "bug_id": 51512, "attachment_id": null, "text": "Using Jmeter on a system with IPv6 addressing and brings to \nthe issue: \nHTTP Cookies aren't inserted in the HTTP request. \nUsing the same jmx-test, but with IPv4 addressing, everything works fine. \nThe HTTP Requests are pretty much the same except for the Host header: \nIPv4: \nHost: 172.31.61.41:8123 \nIPv6: \nHost: [2002::12]:8123 \n \nIt seems like there is a bug in the way cookies are stored/retrieved for \nIPv6 hosts. \n\nNote: I tried changing the Cookie Policy to all the possible values \n(rfc2965, etc.). It didn't help. \n\nNote2: tried CookieManager.check.cookies=false in jmeter.properties didn't help.\n\nLooks like there is no workaround for this bug.\n\n== Details: ===\n\nIPv4: \n-------- \nGET /xxx.xxx HTTP/1.1 \nConnection: keep-alive \nUser-Agent: Java/1.6.0_14 \nHost: 172.31.61.44:8123 \nAccept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 \n\n\n-------- \nHTTP/1.1 200 OK \nDate: Fri, 08 Jul 2011 23:17:18 GMT \nContent-Length: 659 \nContent-Type: text/html; charset=utf-8 \nSet-Cookie: TS48550d=7c55fc5f609f3263a19d5bf56ba87e4adc1f801ce2a34e724e1744d9; Path=/ \nSet-Cookie: TS48550d_1=bf7c6f914d6181372dfe392362bf8dc4dc1f801ce2a34e7200c6c833d9e562f258; Path=/ \n\n<html><head><style> \n    TABLE, TD { border: 3px solid black; border-collapse: collapse } \n</style></head> \n<body><table> \n    <TR><TD>path        </TD><TD>     /xxx.xxx</TD></TR> \n    <TR><TD>query       </TD><TD>     </TD></TR> \n    <TR><TD>method      </TD><TD>     GET</TD></TR> \n    <TR><TD>cookie      </TD><TD>     </TD></TR> \n    <TR><TD>content_type</TD><TD>     </TD></TR> \n    <TR><TD>content     </TD><TD>     </TD></TR> \n    <TR><TD>as_string   </TD><TD><PRE>GET /xxx.xxx HTTP/1.1 \nConnection: keep-alive \nAccept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 \nHost: 172.31.61.44:8123 \nUser-Agent: Java/1.6.0_14 \n\n</PRE></TD></TR> \n</table></body></html> \n\n-------- \nGET /fff.zip HTTP/1.1 \nConnection: keep-alive \nCookie: TS48550d=7c55fc5f609f3263a19d5bf56ba87e4adc1f801ce2a34e724e1744d9; TS48550d_1=bf7c6f914d6181372dfe392362bf8dc4dc1f801ce2a34e7200c6c833d9e562f258 \nUser-Agent: Java/1.6.0_14 \nHost: 172.31.61.44:8123 \nAccept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 \n\n\n\nIPv6: \n-------- \nGET /xxx.xxx HTTP/1.1 \nConnection: keep-alive \nUser-Agent: Java/1.6.0_14 \nHost: [2002::12]:8123 \nAccept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 \n\n\n-------- \nHTTP/1.1 200 OK \nDate: Fri, 08 Jul 2011 20:37:53 GMT \nContent-Length: 657 \nContent-Type: text/html; charset=utf-8 \nSet-Cookie: TS48550d=d1f940e9b0d067b9e4d9b7870a3b76fed46c8da98c8b21124e171f7e; Path=/ \nSet-Cookie: TS48550d_1=f2ca831a9781d3a13d30c433d2d18d43d46c8da98c8b211200c6c833d9e562f258; Path=/ \n\n<html><head><style> \n    TABLE, TD { border: 3px solid black; border-collapse: collapse } \n</style></head> \n<body><table> \n    <TR><TD>path        </TD><TD>     /xxx.xxx</TD></TR> \n    <TR><TD>query       </TD><TD>     </TD></TR> \n    <TR><TD>method      </TD><TD>     GET</TD></TR> \n    <TR><TD>cookie      </TD><TD>     </TD></TR> \n    <TR><TD>content_type</TD><TD>     </TD></TR> \n    <TR><TD>content     </TD><TD>     </TD></TR> \n    <TR><TD>as_string   </TD><TD><PRE>GET /xxx.xxx HTTP/1.1 \nConnection: keep-alive \nAccept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 \nHost: [2002::12]:8123 \nUser-Agent: Java/1.6.0_14 \n\n</PRE></TD></TR> \n</table></body></html> \n\n-------- \nGET /fff.zip HTTP/1.1 \nConnection: keep-alive \nUser-Agent: Java/1.6.0_14 \nHost: [2002::12]:8123 \nAccept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 \n\n--------", "id": 147924, "time": "2011-07-14T21:58:52Z", "creator": "hife.me@gmail.com", "creation_time": "2011-07-14T21:58:52Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 51512, "text": "Created attachment 27467\nThe fix to FunctionProperty#hashCode\n\nThe patch as described in previous comment\nPhilippe Mouawad", "id": 149080, "time": "2011-09-07T17:14:10Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-09-07T17:14:10Z", "is_private": false, "attachment_id": 27467}, {"text": "Sorry, attached patch is not for this issue,", "tags": [], "bug_id": 51512, "attachment_id": null, "count": 2, "id": 149082, "time": "2011-09-07T17:19:41Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-09-07T17:19:41Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 51512, "text": "Cookies are stored by the client, not by the server.  Report this to your client software project/vendor.  The server is sending proper set-cookie headers and the client is ignoring them.", "id": 149111, "time": "2011-09-09T04:05:02Z", "creator": "wrowe@apache.org", "creation_time": "2011-09-09T04:05:02Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 51512, "text": "The JMeter Cookie Manager uses HTTPClient API to validate/parse Cookie header. \n\nThis bug is provide by Httpclient 3.1 which not support host with IPv6 address.\nhttps://issues.apache.org/jira/browse/HTTPCLIENT-654\n\nA workaround is use a host header with a name (not ip).\n\nThe fix is to use HTTPClient 4.x for cookie manager (I works on this).", "id": 149116, "time": "2011-09-09T08:11:47Z", "creator": "milamber@apache.org", "creation_time": "2011-09-09T08:11:47Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 51512, "attachment_id": null, "text": "Thanks Milamber!\nI currently use hostnames, \nbut it would be great to be able to run the traffic with IPv6 in the Host header.\nLooking forward for your fix.", "id": 149680, "time": "2011-09-22T23:39:05Z", "creator": "hife.me@gmail.com", "creation_time": "2011-09-22T23:39:05Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 51512, "text": "Created attachment 28084\nTest Plan", "id": 152261, "time": "2011-12-18T14:51:51Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-12-18T14:51:51Z", "is_private": false, "attachment_id": 28084}, {"count": 7, "tags": [], "bug_id": 51512, "text": "Date: Sun Dec 18 15:52:56 2011\nNew Revision: 1220440\n\nURL: http://svn.apache.org/viewvc?rev=1220440&view=rev\nLog:\nMake method exposing HTTPClient object not public (prepare enhancement of CookieManager supporting IPv6 (using HTTPClient4))", "id": 152263, "time": "2011-12-18T15:54:34Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-12-18T15:54:34Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 51512, "text": "Date: Sun Dec 18 21:55:32 2011\nNew Revision: 1220552\n\nURL: http://svn.apache.org/viewvc?rev=1220552&view=rev\nLog:\nBug 51512 - Cookies aren't inserted into HTTP request with IPv6 Host header\nFirst part, introduce interface CookieHandler and make CookieManager use it.\n\nSecond step will introduce HC4CookieHandler that will enable parsing of IPv6 IPs.\n\nAdded:\n   jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieHandler.java   (with props)\n   jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/HC3CookieHandler.java   (with props)\nModified:\n   jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java\n   jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/gui/CookiePanel.java\n   jmeter/trunk/test/src/org/apache/jmeter/protocol/http/control/TestCookieManager.java", "id": 152264, "time": "2011-12-18T21:56:53Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-12-18T21:56:53Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 51512, "text": "I think we should fix this one soon according to this:\n- http://www.google.com/intl/en/ipv6/\n\nWorld IPv6 Launch on June 6, 2012", "id": 159776, "time": "2012-06-06T19:53:25Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-06-06T19:53:25Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "milamber@apache.org", "attachment_id": null, "id": 161574, "time": "2012-08-21T15:55:41Z", "bug_id": 51512, "creation_time": "2012-08-21T15:55:41Z", "is_private": false, "text": "See Bug 53755"}, {"count": 11, "tags": [], "bug_id": 51512, "attachment_id": null, "id": 161631, "creation_time": "2012-08-22T23:56:52Z", "time": "2012-08-22T23:56:52Z", "creator": "milamber@apache.org", "text": "URL: http://svn.apache.org/viewvc?rev=1376320&view=rev\nLog:\nAdding a HttpClient 4 cookie implementation in JMeter. Cookie Manager has now the default HC3.1 implementation and a new choice HC4 implementation (compliant with IPv6 address)\nand\nBug 51512 - Cookies aren't inserted into HTTP request with IPv6 Host header\nBugzilla Id: 53755\n\nAdded:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/HC4CookieHandler.java   (with props)\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages.properties\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages_fr.properties\n    jmeter/trunk/src/jorphan/org/apache/jorphan/reflect/ClassTools.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/gui/CookiePanel.java\n    jmeter/trunk/xdocs/changes.xml", "is_private": false}]
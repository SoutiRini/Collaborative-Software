[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "Created attachment 27313\nTEST-org.apache.tomcat.util.net.TestXxxEndpoint.BIO.txt\n\nWhile running TestXxxEndpoint test I observed the following error - see attached log:\n\nAn invalid Lifecycle transition was attempted ([before_stop]) for component [org.apache.catalina.connector.MapperListener@e3849c] in state [INITIALIZED]\norg.apache.catalina.LifecycleException: An invalid Lifecycle transition was attempted ([before_stop]) for component [org.apache.catalina.connector.MapperListener@e3849c] in state [INITIALIZED]\n\tat org.apache.catalina.util.LifecycleBase.invalidTransition(LifecycleBase.java:386)\n\tat org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:212)\n\tat org.apache.catalina.connector.Connector.stopInternal(Connector.java:973)\n\tat org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:225)\n\tat org.apache.tomcat.util.net.TestXxxEndpoint.testStartStopBindOnStart(TestXxxEndpoint.java:172)\n\n\nThe test case contains two tests.\nThe first one (on port 8001) succeeded, while the second one (on port 8002) failed with \"Address already in use: JVM_Bind\". This failure to bind to 8002 was unexpected and does not occur during normal run.\n\nWhile Tomcat was stopping after failed start, the above \"invalid Lifecycle transition\" exception was thrown by MapperListener.\n\n\nI was testing with BIO connector only, running a single test (test.entry=org.apache.tomcat.util.net.TestXxxEndpoint).\n\nI think that the cause of the startup failure was that I accidentally started two copies of Ant in parallel. In Eclipse it happens if you double-click on \"Run External Tool\" button.\n\n\n\nLooking at o.a.catalina.connector.Connector#startInternal(), it does\n - protocolHandler.start();\n - mapperListener.start();\n\nThe logs show that protocolHandler.start() call failed. Thus mapperListener.start() was not called.\n\n\nThis second test TestXxxEndpoint.testStartStopBindOnStart() runs with \"bindOnInit\" property of connector set to \"false\". Thus binding failure did not happen in init(), but occurred in start().", "id": 148150, "time": "2011-07-25T21:40:38Z", "bug_id": 51555, "creation_time": "2011-07-25T21:40:38Z", "is_private": false, "attachment_id": 27313}, {"count": 1, "tags": [], "bug_id": 51555, "attachment_id": null, "text": "A simple way to reproduce this:\n\n1. Add bindOnInit=\"false\" to HTTP connector in server.xml and remove AJP connector.\n2. Start an instance of Tomcat.\n3. Try to start second instance of Tomcat. It fails with the same \"invalid transition\" exception:\n\n26.07.2011 3:50:09 org.apache.catalina.core.StandardService destroyInternal\nSEVERE: standardService.connector.destroyfailed\norg.apache.catalina.LifecycleException: An invalid Lifecycle transition was attempted ([before_destroy]) for component [org.apache.catalina.connector.MapperListener@17779e3] in state [INITIALIZED]\n\tat org.apache.catalina.util.LifecycleBase.invalidTransition(LifecycleBase.java:386)\n\tat org.apache.catalina.util.LifecycleBase.destroy(LifecycleBase.java:278)\n\tat org.apache.catalina.connector.Connector.destroyInternal(Connector.java:979)\n\tat org.apache.catalina.util.LifecycleBase.destroy(LifecycleBase.java:284)\n\tat org.apache.catalina.core.StandardService.destroyInternal(StandardService.java:578)\n\tat org.apache.catalina.util.LifecycleBase.destroy(LifecycleBase.java:284)\n\tat org.apache.catalina.core.StandardServer.destroyInternal(StandardServer.java:789)\n\tat org.apache.catalina.util.LifecycleBase.destroy(LifecycleBase.java:284)\n\tat org.apache.catalina.startup.Catalina.stop(Catalina.java:695)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:655)", "id": 148152, "time": "2011-07-25T23:54:44Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-07-25T23:54:44Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 51555, "text": "Fixed in 7.0.x and will be included in 7.0.20 onwards.", "count": 2, "id": 148166, "time": "2011-07-26T08:25:57Z", "creator": "markt@apache.org", "creation_time": "2011-07-26T08:25:57Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "frank.hofmann@lexon-gmbh.de", "attachment_id": null, "id": 104509, "time": "2007-06-18T10:10:02Z", "bug_id": 42693, "creation_time": "2007-06-18T10:10:02Z", "is_private": false, "text": "addendum: it's Version 6.13 (not available in combobox above)\n\nscenario:\n=========\na menu is decribed by a tree structure;\nrendering the menu is done by a tagfile 'render_menuitem', which renders the\ncurrent item either as a leaf item (clicking on it causes an action) or as a\nnode item (clicking on it opens another next-level submenu);\nrendering the submenu is done by calling the tagfile again from within its body;\nthis worked fine with tomcat 5.0.x and 5.5.x\n\nto make it clear see the following pseudo code (the original code is to\nvoluminous): \ntagfile 'render_menuitem.tagx':\n<jsp:root ...>\n   <jsp:directive.attribute name=\"menu_item\"/>\n   <c:choose>\n      <c:when test=\"${menu_item.isNode}\n         <div>node: ${menu_item.label}</div>\n         <c:forEach var=\"sub_item\" items=\"menu_item.children\">\n            <!-- THIS IS GOING TO CAUSE THE PROBLEM WITH TOMCAT6: -->\n            <tags:render_menuitem menu_item=\"${sub_item}\"/>\n         </c:forEach>\n      <c:when>\n      <c:otherwise>\n         <div>leaf: ${menu_item.label}</div>\n      </c:otherwise>\n   </c:choose>\n</jsp:root>\n\nfaulty behaviour:\n================\nwith tomcat 6.0.13, the generated Java-Source for the tagfile reveals, that the\nbody of the doTag() method is empty and therefore emits no html; the compilation\nitself was silently done, no error or warning was shown in the logfiles."}, {"count": 1, "tags": [], "bug_id": 42693, "text": "Created attachment 20374\nlog entries from localhost.log\n\nthese stack traces might have something to do with the described error", "id": 104535, "time": "2007-06-20T02:17:44Z", "creator": "frank.hofmann@lexon-gmbh.de", "creation_time": "2007-06-20T02:17:44Z", "is_private": false, "attachment_id": 20374}, {"count": 2, "tags": [], "creator": "lgalfaso@gmail.com", "attachment_id": null, "is_private": false, "id": 109006, "time": "2007-10-04T19:33:06Z", "bug_id": 42693, "creation_time": "2007-10-04T19:33:06Z", "text": "Tested with Tomcat 6.0.14 Windows XP SP2 and it works as expected.\nAFAICT, there should be no differences with the Linux version.\n\nPlease attach a full test case that shows the faulty behavior."}, {"count": 3, "tags": [], "creator": "frank.hofmann@lexon-gmbh.de", "attachment_id": 20926, "id": 109033, "time": "2007-10-05T11:01:23Z", "bug_id": 42693, "creation_time": "2007-10-05T11:01:23Z", "is_private": false, "text": "Created attachment 20926\nwar file to demonstrate defect\n\nI did describe the defect as tomcat 6 not being able any more (contrary to\ntomcat 5.5.x) to process reentrant / recursive tagfiles. As far as I see, there\nis an error in the algorithm to generate the java sources, because the way it\nis implemented now (in version 6) assumes a static call stack for tagfiles.\n\nThe tester was a little bit lazy and didn't read my bug description properly,\nso I had to spent the time to write a ready to run test case: see the test.war\nfile attached. It shows the jdk file structure on the machine running tomcat,\nand it works with 5.5.17, but not any more with version 6.0.13!\n\nPlease process this incident more properly and timely, because it really takes\na lot of time to create such contributions! Thanks."}, {"count": 4, "tags": [], "bug_id": 42693, "attachment_id": 20931, "text": "Created attachment 20931\nAttaching the generated file by renderFileSystemEntry.tagx\n\n(In reply to comment #3)\n\nTested the attached war file with Tomcat 6.0.13 and 6.0.14 using Java 1.5_10\nand Java 1.5_11 using the war file to deploy the web app and expanding the war\ninto a folder at TOMCAT_HOME/webapps/test.\nIn all eight cases, the page worked as expected, there was only a warning\nsaying that the file /WEB-INF/web.xml was missing.\n\nPlease specify the specific OS used and Java version that was used to perform\nthis test.\n\nPlease, lets try to keep this using good manners.", "id": 109044, "time": "2007-10-05T19:06:17Z", "creator": "lgalfaso@gmail.com", "creation_time": "2007-10-05T19:06:17Z", "is_private": false}, {"count": 5, "tags": [], "creator": "frank.hofmann@lexon-gmbh.de", "attachment_id": 20933, "is_private": false, "id": 109048, "time": "2007-10-06T05:08:49Z", "bug_id": 42693, "creation_time": "2007-10-06T05:08:49Z", "text": "Created attachment 20933\nslightly modified test application to show runtime specifica\n\njust throw it into webapps dir of \na) tomcat 5.5.x\nb) tomcat 6.0.x\nand request http://SERVER:8081/tomcat_bug\n-- it will show different results, with the latter being wrong,\nbecause the JSP specification doesn't disallow Tags or tagfiles (which should\ntransparently being transformed into equivalent Java code) to recursively call\nanother instance of itself. Many problems are naturally solved by recursive\nalgorithms.\n\nPlease watch the 2 html files attached hereafter, where the evidence is\ndocumented for the 2 machines/configurations I currently have access to. They\ndefinitively differ."}, {"count": 6, "tags": [], "text": "Created attachment 20934\ncorrect result from running the web app with tomcat 5.5.17 (save as HTML to view, correct MIME type was not permitted for upload by Bugzilla)", "attachment_id": 20934, "bug_id": 42693, "id": 109049, "time": "2007-10-06T05:10:03Z", "creator": "frank.hofmann@lexon-gmbh.de", "creation_time": "2007-10-06T05:10:03Z", "is_private": false}, {"count": 7, "tags": [], "text": "Created attachment 20935\nincorrect results from running web app with tomcat 6.0.13 (save as HTML to view, correct MIME type was not permitted for upload by Bugzilla)", "is_private": false, "id": 109050, "creator": "frank.hofmann@lexon-gmbh.de", "time": "2007-10-06T05:11:14Z", "bug_id": 42693, "creation_time": "2007-10-06T05:11:14Z", "attachment_id": 20935}, {"count": 8, "tags": [], "creator": "lgalfaso@gmail.com", "attachment_id": 20940, "id": 109075, "time": "2007-10-07T13:14:53Z", "bug_id": 42693, "creation_time": "2007-10-07T13:14:53Z", "is_private": false, "text": "Created attachment 20940\nOpen the outputWriter when sure that no other process will write a file with the same name\n\nThis patch fixes the following situation, when a .tagx file needs to be\ncompiled, and by any form of dependency it depends on itself, be sure that the\noutput .java file is opened after the prototype file is generated compiled and\nclosed."}, {"count": 9, "tags": [], "creator": "lgalfaso@gmail.com", "attachment_id": null, "id": 109076, "time": "2007-10-07T13:21:39Z", "bug_id": 42693, "creation_time": "2007-10-07T13:21:39Z", "is_private": false, "text": "(In reply to comment #8)\n\nMmm.. I think that a better description would be:\n\nOpen the outputWriter when positive that this same process will not open a\ncompilation context to generate a prototype of this same class.\n\nThis patch fixes the following situation, when a .tagx file needs to be\ncompiled, and by any form of dependency it depends on itself, be sure that the\noutput .java file is opened after the prototype .java file is generated,\ncompiled and closed.\n\n"}, {"count": 10, "tags": [], "creator": "funkman@joedog.org", "attachment_id": null, "id": 112216, "time": "2007-12-26T17:48:24Z", "bug_id": 42693, "creation_time": "2007-12-26T17:48:24Z", "is_private": false, "text": "The patch looks to be applied against tomcat trunk as well as 6.0 HEAD.\n\nCan this be verified?\n"}, {"count": 11, "tags": [], "text": "if you invoke recursive twice tag the bug still occurs\n\nexample:\n\nindex.jsp\n-------------------------------------------------------------\n<%@ taglib prefix=\"u\" tagdir=\"/WEB-INF/tags\" %>\n<html>\n<head><title>taglib test</title></head>\n<body>\n<u:seq arg=\"5\" max=\"12\"/>\n</body>\n</html>\n\n\nseq.tag\n-------------------------------------------------------------\n<%@ attribute \n    name=\"arg\"\n    required=\"true\"\n    type=\"java.lang.Integer\"\n%>\n<%@ attribute\n    name=\"max\"\n    required=\"true\"\n    type=\"java.lang.Integer\"\n%>\n<%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\n<%@ taglib prefix=\"n\" tagdir=\"/WEB-INF/tags\" %>\n\n<p><c:out value=\"${arg}\"/></p>\n<c:if test=\"${arg lt max}\">\n  <n:seq arg=\"${arg + 1}\" max=\"${max}\"/>\n  <n:seq arg=\"${arg + 1}\" max=\"${max}\"/>\n</c:if>\n\n\njdk: 1.6.0_07\ntomcat: 6.0.18\nos: Windows XP and Ubuntu 8.04.1\n", "is_private": false, "id": 121859, "creator": "dyk@gazeta.pl", "time": "2008-10-24T12:48:44Z", "bug_id": 42693, "creation_time": "2008-10-24T12:48:44Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 122752, "time": "2008-11-23T13:28:32Z", "bug_id": 42693, "creation_time": "2008-11-23T13:28:32Z", "is_private": false, "text": "I have committed a fix to trunk. After a little more testing I'll propose it for 6.0.x."}, {"count": 13, "tags": [], "text": "This has now been proposed for 6.0.x", "is_private": false, "bug_id": 42693, "id": 123500, "time": "2008-12-23T05:24:11Z", "creator": "markt@apache.org", "creation_time": "2008-12-23T05:24:11Z", "attachment_id": null}, {"count": 14, "tags": [], "bug_id": 42693, "attachment_id": null, "text": "This has been fixed in 6.0.x and will be included in 6.0.19 onwards.", "id": 124051, "time": "2009-01-14T15:27:06Z", "creator": "markt@apache.org", "creation_time": "2009-01-14T15:27:06Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "bjenkins@dynamicsoft.com", "is_private": false, "id": 22868, "attachment_id": null, "bug_id": 12651, "creation_time": "2002-09-14T21:45:09Z", "time": "2002-09-14T21:45:09Z", "text": "Steps to dupe:\n\n1. Create a jar with a few entries\n2. Sign the jar using the signjar task\n3. Update the jar with a specified manifest containing at least one section \nwith entries\n4. The specified manifest replaces the original manifest containing the SHA1-\nDigest for the signed files\n\nTo fix the problem, I made the following modification to the Jar task:\n\n1.  Add a Manifest reference to the Jar task\n\n    private Manifest originalManifest;\n\n2.  Override the setDestFile(File) method to grab the original manifest\n\n    public void setDestFile(File destFile) {\n      super.setDestFile(destFile);\n      try {\n        JarFile jf = new JarFile(destFile);\n\n        ByteArrayOutputStream out = new ByteArrayOutputStream();\n        jf.getManifest().write(out);\n        jf.close();\n        ByteArrayInputStream in = new ByteArrayInputStream(out.toByteArray());\n        originalManifest = new Manifest(new InputStreamReader(in));\n      }\n      catch (Throwable t) {\n        originalManifest = null;\n      }\n    }\n\n3.  Modify the createManifest() method to use the originalManifest\n\n    private Manifest createManifest()\n        throws IOException, BuildException {\n        try {\n            Manifest finalManifest = null;  // changed \n            if (originalManifest != null && this.isInUpdateMode()) // changed \n               finalManifest = originalManifest; // changed\n            else finalManifest = Manifest.getDefaultManifest();  // changed\n            if (manifest == null) {"}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 29518, "time": "2003-01-16T11:29:39Z", "bug_id": 12651, "creation_time": "2003-01-16T11:29:39Z", "is_private": false, "text": "*** Bug 16100 has been marked as a duplicate of this bug. ***"}, {"count": 2, "attachment_id": null, "bug_id": 12651, "is_private": false, "id": 29520, "time": "2003-01-16T11:30:32Z", "creator": "bodewig@apache.org", "creation_time": "2003-01-16T11:30:32Z", "tags": [], "text": "*** Bug 6521 has been marked as a duplicate of this bug. ***"}, {"count": 3, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 29597, "time": "2003-01-17T12:29:32Z", "bug_id": 12651, "creation_time": "2003-01-17T12:29:32Z", "is_private": false, "text": "I couldn't use the JarFile code suggested as Ant still tries to be JDK 1.1\ncompatible, but it was not too hard to code myself.\n\nPlease try the nightly build of 2003-01-18 or later."}]
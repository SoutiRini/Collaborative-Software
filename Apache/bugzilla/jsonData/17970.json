[{"count": 0, "tags": [], "bug_id": 17970, "text": "When a webapp with a multi-level context path (i.e. \"/tomcat/myapp\" as opposed\nto \"/myapp\") is auto-deployed by placing an xml file containing its\nContext element into the appBase directory, and the server.xml file also\ncontains a Context element for the same webapp, Tomcat erroneously tries\nto deploy the webapp twice.  This results in a slew of logged exceptions\nwhen Tomcat attempts to deploy the second copy of the webapp using the same\ncontext path as the first copy.\n\nThis situation happens frequently when the Tomcat admin webapp is used to\ncommit changes - upon commit a Context element is written to the server.xml\nfile for each webapp, including auto-deployed ones.  When the server is\nrestarted, the exceptions occur.\n\nCode in the auto-deployer's deployDescriptors() method should catch and\nsilently ignore the second attempt to deploy the webapp, but the code in\nthat method incorrectly calculates the context path to search for by\nappending the name of the xml file (minus the .xml extension) to \"/\".\nIn the case described above this results in a check to see if \"/myapp\"\nis deployed.  Since the application was really deployed as \"/tomcat/myapp\"\nafter the server.xml file was parsed, the auto-deployer check assumes\nthe app has not yet been deployed and then tries to deploy a second\ncopy.\n\nThe right way to fix this is for the deployDescriptors() method to pull\nthe contextPath attribute from the Context element in the xml file and\nuse that to determine if the webapp has already been deployed.  I have\nattached diffs for a working solution, but you may want to pull the code\nfor creating a Context object from an xml file into a utility class\nsomewhere for general use.", "id": 33138, "time": "2003-03-13T19:26:38Z", "creator": "Richard.June@hp.com", "creation_time": "2003-03-13T19:26:38Z", "is_private": false, "attachment_id": null}, {"text": "Created attachment 5325\nDiffs for HostConfig.java fix", "tags": [], "bug_id": 17970, "is_private": false, "count": 1, "id": 33139, "time": "2003-03-13T19:27:36Z", "creator": "Richard.June@hp.com", "creation_time": "2003-03-13T19:27:36Z", "attachment_id": 5325}, {"count": 2, "tags": [], "bug_id": 17970, "attachment_id": 5326, "text": "Created attachment 5326\nActual diffs for HostConfig.java", "id": 33140, "time": "2003-03-13T19:33:17Z", "creator": "Richard.June@hp.com", "creation_time": "2003-03-13T19:33:17Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 17970, "attachment_id": null, "is_private": false, "id": 33141, "time": "2003-03-13T19:35:37Z", "creator": "Richard.June@hp.com", "creation_time": "2003-03-13T19:35:37Z", "text": "Please ignore the first set of diffs I attached, the second set\nis the real one."}, {"text": "Rather a long time after the patch was submitted but I have now committed a\nvariant of this to TC4. It will be included in 4.1.32 onwards.", "tags": [], "bug_id": 17970, "is_private": false, "count": 4, "id": 83034, "time": "2005-11-30T22:33:00Z", "creator": "markt@apache.org", "creation_time": "2005-11-30T22:33:00Z", "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Created attachment 33692\nThis is the XLS file to test\n\nI'm trying to get an active sheet of HSSFWorkbook, but always get java.lang.IllegalArgumentException. \nHere is the code and the xls file to reproduce the problem. \n\npackage org.apache.poi.mytest;\n\nimport java.io.FileInputStream;\nimport java.io.FileNotFoundException;\nimport java.io.IOException;\nimport java.util.Iterator;\nimport org.apache.poi.hssf.usermodel.HSSFWorkbook;\nimport org.apache.poi.ss.usermodel.Sheet;\nimport org.apache.poi.ss.usermodel.Workbook;\nimport org.junit.Test;\n\npublic class PoiTest {\n    \n    public PoiTest() {\n    }\n\n     @Test\n     public void testIt() throws FileNotFoundException, IOException {\n         FileInputStream fis = new FileInputStream(\"Fir.xls\"); \n         Workbook wb = new HSSFWorkbook(fis);\n        Iterator<Sheet> shIt = wb.sheetIterator();\n        while (shIt.hasNext()) {  \n            Sheet sheet = shIt.next();\n            System.out.println(\"Sheet name = \"+sheet.getSheetName());\n        }\n         Sheet sheet = wb.getSheetAt(wb.getActiveSheetIndex());           \n     }\n}\n\nWhen you run, you'll get the following output.\n\n------------- Standard Output ---------------\nSheet name = Module1\n------------- ---------------- ---------------\nTestcase: testIt(org.apache.poi.mytest.PoiTest):\tCaused an ERROR\nSheet index (1) is out of range (0..0)\njava.lang.IllegalArgumentException: Sheet index (1) is out of range (0..0)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.validateSheetIndex(HSSFWorkbook.java:522)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.getSheetAt(HSSFWorkbook.java:994)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.getSheetAt(HSSFWorkbook.java:109)\n\tat org.apache.poi.mytest.PoiTest.testIt(PoiTest.java:30)\n\nAs you see, the Module1 is recognized as sheet, but active sheet's index=1, although the workbook has only one sheet.", "is_private": false, "bug_id": 59214, "id": 189649, "time": "2016-03-22T15:34:50Z", "creator": "aliyev.jafar@gmail.com", "creation_time": "2016-03-22T15:34:50Z", "attachment_id": 33692}, {"count": 1, "tags": [], "text": "Created attachment 33693\nPoiTest.java", "is_private": false, "id": 189650, "creator": "aliyev.jafar@gmail.com", "time": "2016-03-22T15:37:17Z", "bug_id": 59214, "creation_time": "2016-03-22T15:37:17Z", "attachment_id": 33693}, {"count": 2, "tags": [], "text": "Seema like the problem is that active sheet index could potentially be out of range.\n\nWhat software was used to save Fir.xls? This seems like a bug on the creator of the file.\n\nWe could band-aid this problem by changing getActiveSheetIndex to return 0 if out of range, though this would still break if there were no sheets in the workbook. A sheet index of -1 could be used to indicate no sheet is active, though that would always break an unchecked call to getSheetAt.\n\nWhat does Excel identify as the active sheet index if all sheets are deleted or hidden?\n\nAnother solution to this problem is to provide a nullable getActiveSheet().", "is_private": false, "bug_id": 59214, "id": 189651, "time": "2016-03-22T16:30:47Z", "creator": "onealj@apache.org", "creation_time": "2016-03-22T16:30:47Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 59214, "attachment_id": null, "id": 189661, "time": "2016-03-23T02:44:33Z", "creator": "aliyev.jafar@gmail.com", "creation_time": "2016-03-23T02:44:33Z", "is_private": false, "text": "Hello,\nI'm using Excel 2007 (12.0.4518.1014), and the file is saved from this version.\nI have nearly hundred of such files. These files are created initially on Excel 2013, then resaved on Excel 2007. Every month these files are updated, saved. In legacy application I converted them into database using Microsoft COM object and there was no problem with files. But the new application written in Java and I use POI to handle these files.\nI deleted contents and an extra sheets, leaving only one sheet in this example. I can send you the filled file too. Even with information inside of sheets, it cant find the last sheet.\nWhen I delete macros entirely, POI finds the sheet. The problem is macro Module.\nIt sees Macro1 as a sheet.\nIf I get null in getActiveSheet() it will not help me.\nActually wb.getSheet(\"Fir\") gives me null value in this situation. But the sheet exists with information and I can't reach the cells of this sheet."}]
[{"count": 0, "tags": [], "creator": "hirenpatel5684@yahoo.com", "attachment_id": 28378, "text": "Created attachment 28378\noutput of lsof -p <pid>\n\nHello Team,\n\nWe are facing high cpu utilization issue for Apache httpd process(child)\n\nApache version:2.2.11\n\nTomcat version:6.0.18\n\nOS:linux \n\nuname-a :Linux WEB10_64 2.6.18-92.el5 #1 SMP Tue Apr 29 13:16:15 EDT 2008 x86_64 x86_64 x86_64 GNU/Linux\n\nlsof output is attached below.\n\n-->Apache childprocess is waiting for closed state hence it is consuming high CPU.", "id": 154105, "time": "2012-02-24T10:44:44Z", "bug_id": 52759, "creation_time": "2012-02-24T10:44:44Z", "is_private": false}, {"count": 1, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "text": "please collect and post periodic backtraces and ps output.", "id": 154106, "time": "2012-02-24T12:20:31Z", "bug_id": 52759, "creation_time": "2012-02-24T12:20:31Z", "is_private": false}, {"count": 2, "tags": [], "creator": "hirenpatel5684@yahoo.com", "attachment_id": 28444, "text": "Created attachment 28444\npstack and gdb trace output...", "id": 154728, "time": "2012-03-09T10:35:49Z", "bug_id": 52759, "creation_time": "2012-03-09T10:35:49Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 52759, "text": "Created attachment 28445\nupdated backtrace output of gdb", "id": 154730, "time": "2012-03-09T10:45:41Z", "creator": "hirenpatel5684@yahoo.com", "creation_time": "2012-03-09T10:45:41Z", "is_private": false, "attachment_id": 28445}, {"text": "Created attachment 28446\nps output\n\noutput of ps command...", "tags": [], "creator": "hirenpatel5684@yahoo.com", "attachment_id": 28446, "count": 4, "id": 154732, "time": "2012-03-09T10:50:08Z", "bug_id": 52759, "creation_time": "2012-03-09T10:50:08Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 52759, "attachment_id": null, "id": 154761, "time": "2012-03-09T18:57:11Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-03-09T18:57:11Z", "is_private": false, "text": "The problem seems to happen, when mod_jk reveiced the final package from the AJP back end and at the end of the response request cycle calls ap_finalize_request_protocol(). The connection to the client is an HTTPS connection and maybe it happens during lingering close? Was the lsof taken during the spining CPU? The lsof output does not contain the client connection, so it seems that connection was already closed.\n\nThe loop seems to be in OpenSSL. What looks suspicious in the dumps is len=0x7fff95282a50 in ssl_io_input_read().\n\nI don't have a real recommendation here.\n\nRainer"}, {"count": 6, "tags": [], "bug_id": 52759, "attachment_id": null, "id": 154775, "time": "2012-03-10T05:46:02Z", "creator": "hirenpatel5684@yahoo.com", "creation_time": "2012-03-10T05:46:02Z", "is_private": false, "text": "Yes, lsof output was taken when Apache process was taking high cpu..\nopenssl version is 0.9.8b\n\nIs this issue related to socket connection or timeouts as in worker.properties we have not set any timeouts??\n\nor is it related to application which is not closing connections properly??\n\nI have gone through many forums for this issue...\n\nsetting value for CFLAGS=NO_LINGERCLOSE and then building apache again..\n\nwhether increasing the ulimit (no of open files) help ??\n\nPlease help as this issue is impacting production servers..."}, {"count": 7, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "I don't see any relation to mod_jk settings. The stacks show the code is looping in the HTTPS handling of the client/browser connection. The lsof output shows, that the connection no longer exists. So it seems some error condition is not handled properly around OpenSSL/mod_ssl.\n\nYour Apache and OpenSSL versions are pretty old. Any chance to update and retest? It might well be some problem fixed long ago.\n\nRegards,\n\nRainer", "id": 154780, "time": "2012-03-10T10:55:03Z", "bug_id": 52759, "creation_time": "2012-03-10T10:55:03Z", "is_private": false}, {"count": 8, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "text": "No news in 4 years...", "id": 190996, "time": "2016-05-16T15:15:39Z", "bug_id": 52759, "creation_time": "2016-05-16T15:15:39Z", "is_private": false}]
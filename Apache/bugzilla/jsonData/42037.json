[{"count": 0, "tags": [], "bug_id": 42037, "text": "In certain cases the user principal is overwritten and set to null. Especially\nin cases of parallel request when for instance using tiles.", "id": 101385, "time": "2007-04-03T13:22:53Z", "creator": "allan@2bc.com", "creation_time": "2007-04-03T13:22:53Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 42037, "attachment_id": 19903, "text": "Created attachment 19903\nPatches Request.java fixing user principal bug", "id": 101386, "time": "2007-04-03T13:24:15Z", "creator": "allan@2bc.com", "creation_time": "2007-04-03T13:24:15Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 42037, "text": "I have no idea what you are talking about. For starters, \"parallel request\" is\nusually not a valid use case.", "id": 101387, "time": "2007-04-03T13:41:14Z", "creator": "remm@apache.org", "creation_time": "2007-04-03T13:41:14Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "Ok, maybe I was not using the correct wording. I was hoping the patch would be\nself explanatory. Let me explain our case. We use struts tiles. In some of the\ntiles (included jsps) we request the user principal. However sometimes when the\nuser is logged in, in the tiles getUserPrincipal() returns null. This patch\nfixes that problem.", "is_private": false, "id": 101390, "creator": "allan@2bc.com", "time": "2007-04-03T14:00:55Z", "bug_id": 42037, "creation_time": "2007-04-03T14:00:55Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 42037, "text": "I don't see how this patch could fix the bug you are seeing. Neither subject nor\nthe session attribute Globals.SUBJECT_ATTR plays any part in getUserPrincipal().\nAre you using a security manager? If you are, do you see the problem if you\ndon't use one?\n\nI suspect that you have two requests in a session, the first authenticates the\nuser and the second calls getUserPrincipal(). If the call in the second request\nis made to getUserPrincipal() before the first request completes then it will\nreturn null.\n\nWithout a test case that demonstrates a valid user principal value being\noverwritten with null or an explanation of *how* the patch fixes the issue, this\nissue is going to get resolved as invalid.", "id": 101736, "time": "2007-04-15T12:17:13Z", "creator": "markt@apache.org", "creation_time": "2007-04-15T12:17:13Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 42037, "text": "My apologies, it's the Subject.getSubject() that returns null and consequently\nthere's no Principal either.\n\nYes, we use a security manager. Trying to run the application without the\nsecurity manager would be a challenging one, because it heavily depends on it\nand basically doesn't work without it.\n\nWith regards to the two requests in one session, your assumption is probably\ncorrect as struts-tiles does just that (multiple requests in one session).\nHowever I would assume that once the user is logged in this situation of order\nof requests should not matter anymore as the subject has already been set and\navailable to every request from then on. Yet, still some requests retrieve null\neven though the user has been logged in for quite a while.\n\nI will try to produce a small isolated test case. However time is not in\nabundance for me, it might take a bit of time to produce one.", "id": 101819, "time": "2007-04-17T13:39:59Z", "creator": "allan@2bc.com", "creation_time": "2007-04-17T13:39:59Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "Can you clarify? Is getUserPrincipal() returning null or are you accessing the\nsubject directly? If accessing the subject directly, how are you doing this?", "is_private": false, "id": 101826, "creator": "markt@apache.org", "time": "2007-04-17T17:09:59Z", "bug_id": 42037, "creation_time": "2007-04-17T17:09:59Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "allan@2bc.com", "text": "Subject.getSubject(AccessController.getContext())", "id": 102735, "time": "2007-05-02T02:59:44Z", "bug_id": 42037, "creation_time": "2007-05-02T02:59:44Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 103848, "time": "2007-05-30T18:41:22Z", "bug_id": 42037, "creation_time": "2007-05-30T18:41:22Z", "is_private": false, "text": "I have been over the code several times and just can't see how the subject could\nbe null. Whilst a test case would be ideal, could you provide a stacktrace for\nwhen the subject is null.\n\nAlso, how repeatable is this for you? If it is repeatable, any further\ninformation on circumstances would be very helpful."}, {"count": 9, "tags": [], "bug_id": 42037, "text": "I am marking this as WONTFIX since:\n- there are no obvious code paths that could explain this\n- no reasoning has been provided for why the patch works and I can't see one\n- there has been no response to the request for further info for many months\n\nI suspect tile and/or the app is doing something odd.\n\nIf you, or anyone else, still see this issue and you have new information that sheds some light feel free to re-open this issue and add the new info.", "id": 114157, "time": "2008-03-01T09:49:05Z", "creator": "markt@apache.org", "creation_time": "2008-03-01T09:49:05Z", "is_private": false, "attachment_id": null}]
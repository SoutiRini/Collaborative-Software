[{"count": 0, "attachment_id": null, "bug_id": 37269, "text": "Hi,\n\nI don't know if this is the right place, maybe it's a bug in mod_jk, maybe in\nTomcat, or maybe there's no bug at all...\n\nI have configured a mod_jk loadbalancer on Apache 2. I have two tomcats running\non  two differents servers. I don't have activated the cluster element in\nserver.xml. Both tomcats are running the same webapp. In the title of every jsp\nI write the name of the server so that I can check that sticky session works.\nAnd it doesn't.\n\nHere is my workers.properties :\n\n----------------------------------------------------------\nworker.list=loadbalancer,status\nworker.node1.port=8009\nworker.node1.host=noeud_1\nworker.node1.type=ajp13\nworker.node1.lbfactor=1\n\nworker.node2.port=8009\nworker.node2.host=noeud_2\nworker.node2.type=ajp13\nworker.node2.lbfactor=1\n\nworker.loadbalancer.type=lb\nworker.loadbalancer.sticky_session=true\nworker.loadbalancer.balance_workers=node1, node2\n\n# Status worker for managing load balancer\nworker.status.type=status\n\n----------------------------------------------------------\n\nnoeud_1 and noeud_2 are the tomcat servers.\n\nIn each tomcats I've added the jvmRoute attribute :\n\n----------------------------------------------------------\n<Engine name=\"Catalina\" defaultHost=\"localhost\"\tjvmRoute=\"noeud_1\">\n------------------------------------------------------------\n\nOf course on the noeud_2 server I wrote jvmRoute=\"noeud_2\"...\n\nHere is my jk.load file :\n\n-----------------------------------------------------------\nJkWorkersFile /etc/apache2/workers.properties\n\nJkLogFile /var/log/apache2/mod_jk.log\nJkLogLevel info\nJkLogStampFormat  \"[%a %b %d %H:%M:%S %Y]\"\n\n# JkOptions indicates to send SSK KEY SIZE\n#JkOptions +ForwardKeySize +ForwardURICompat -ForwardDirectories\n\nJkRequestLogFormat \"%w %V %T\"\n\nJkMount /* loadbalancer\nJkMount /jkstatus status\n\nJkShmFile /var/log/apache2/jk.shm\n\n<Location /jkstatus/>\n        JkMount status\n        Order deny,allow\n        Deny from all\n        Allow from all\n</Location>\n------------------------------------------------------------\n\nAnd finally here is the way I write the server name in jsps :\n\n<title><% java.net.InetAddress local =\njava.net.InetAddress.getLocalHost();out.print(local.getHostName()); %></title>\n\n\n\nNow the test :\n\nI open http://MY_SERVER/ in firefox :\n\nI see \"noeud_1\" in the title.\nI have a JSESSIONIN in HTTP Headers.\nI press F5 to reload\nI see \"noeud_2\" in the title.\nI still have the same JSESSIONID...\n\nSo is it normal ? I think that the point of sticky session is to always redirect\nto the same server right ? Did I forgot something in some config files ?", "id": 81822, "time": "2005-10-27T15:54:51Z", "creator": "rflament@onyme.com", "creation_time": "2005-10-27T15:54:51Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "rflament@onyme.com", "attachment_id": null, "text": "I got it to work : the jvmRoute attribute must be the name of the worker, not\nthe name of the server... This is not documented, the doc only says the the\njvmRoute mus be unique.", "id": 81889, "time": "2005-10-28T12:21:11Z", "bug_id": 37269, "creation_time": "2005-10-28T12:21:11Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 37269, "text": "\"The second word is the worker name that can be any name. The worker name\nreflects the name of the jvmRoute defined in Tomcat's server.xml configuration\nfile.\"\n\nSorry...", "id": 82028, "time": "2005-11-02T11:12:00Z", "creator": "rflament@onyme.com", "creation_time": "2005-11-02T11:12:00Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 1791, "attachment_id": null, "is_private": false, "id": 2493, "time": "2001-05-16T22:54:57Z", "creator": "carnold@houston.rr.com", "creation_time": "2001-05-16T22:54:57Z", "text": "1. AbstractDOMImplementation.hasFeature is implemented using a\nHashTable where feature names are used as keys and versions as\nvalues.  This approach depends on the feature argument being identical\nto the key value where the DOM spec states that features are compared\nin a case insenitive manner.  From the DOM spec:\n\nhasFeature \nTest if the DOM implementation implements a specific feature. \nParameters \nfeature of type DOMString \nThe name of the feature to test (case-insensitive). The values used by DOM \nfeatures are defined throughout the DOM Level 2 specifications and ...\n\n\n2. hasFeature(\"XML\",\"1.0\") would return false as would \nhasFeature(\"Core\",\"2.0\").\n\n\n3. The NIST DOM tests expect hasFeature(\"XML\",\"\") to return true,\nbasically interpreting \"version is not specified\" in the following\nparagraph to be equivalent to \"version is an empty string or null\"\n\nversion of type DOMString \nThis is the version number of the feature to test. In Level 2, the string can \nbe either \"2.0\" or \"1.0\". If the version is not specified, supporting any \nversion of the feature causes the method to return true.\n\nThe following modifications to AbstractDOMImplementation and \nSVGDOMImplementation replace the HashTable implementation with\na simplistic implementation using String arrays.  If you don't like the\ncode, at least you can get the idea.\n\ncvs diff AbstractDOMImplementation.java (in directory D:\\apache-xml\\xml-\nbatik\\sources\\org\\apache\\batik\\dom\\)\nIndex: AbstractDOMImplementation.java\n===================================================================\nRCS file: /home/cvspublic/xml-\nbatik/sources/org/apache/batik/dom/AbstractDOMImplementation.java,v\nretrieving revision 1.3\ndiff -r1.3 AbstractDOMImplementation.java\n24c24\n<      * The supported features.\n---\n>      * The supported features and corresponding versions\n26,35c26,32\n<     protected final HashTable features = new HashTable();\n<     {\n< \tfeatures.put(\"XML\",            \"2.0\");\n< \tfeatures.put(\"Events\",         \"2.0\");\n< \tfeatures.put(\"MouseEvents\",    \"2.0\");\n< \tfeatures.put(\"MutationEvents\", \"2.0\");\n< \tfeatures.put(\"Traversal\",      \"2.0\");\n< \tfeatures.put(\"UIEvents\",       \"2.0\");\n<     }\n<     \n---\n>     private static final String abstractFeatures[] = {\n> \t\"XML\", \"XML\", \"Core\", \"Events\",\"MouseEvents\",\n>         \"MutationEvents\",\"Traversal\",\"UIEvents\"};\n>     private static final String abstractVersions[] = {\n>         \"1.0\", \"2.0\", \"2.0\", \"2.0\", \"2.0\",\n>         \"2.0\", \"2.0\", \"2.0\", \"2.0\" };\n> \n47,54c44\n< \tString v = (String)features.get(feature);\n< \tif (v == null) {\n< \t    return false;\n< \t}\n< \tif (version == null) {\n< \t    return true;\n< \t}\n< \treturn version.equals(v);\n---\n>       return hasFeatureImpl(abstractFeatures, abstractVersions, feature, \nversion);\n55a46,67\n> \n> \n>     protected boolean hasFeatureImpl(String[] features, String[] versions, \nString feature, String version) {\n>         for(int i = 0; i < features.length; i++) {\n>            //\n>            //    feature comparision is case-insensitive\n>            //\n>            if(feature.equalsIgnoreCase(features[i])) {\n>               //\n>               //     if version is null or \"\" and\n>               //        the feature was supported in any version\n>               //        then return true\n>               if(version == null || version.length() == 0) {\n>                   return true;\n>               }\n>               if(version.equals(versions[i])) {\n>                   return true;\n>               }\n>             }\n>           }\n>           return false;\n>         }\n\n*****CVS exited normally with code 1*****\n\ncvs diff SVGDOMImplementation.java (in directory D:\\apache-xml\\xml-\nbatik\\sources\\org\\apache\\batik\\dom\\svg\\)\nIndex: SVGDOMImplementation.java\n===================================================================\nRCS file: /home/cvspublic/xml-\nbatik/sources/org/apache/batik/dom/svg/SVGDOMImplementation.java,v\nretrieving revision 1.9\ndiff -r1.9 SVGDOMImplementation.java\n71,75c71,80\n<     {\n<         features.put(\"CSS\",            \"2.0\");\n<         features.put(\"StyleSheets\",    \"2.0\");\n<         features.put(\"SVG\",            \"1.0\");\n<         features.put(\"SVGEvents\",      \"1.0\");\n---\n>     private final static String svgFeatures[] =\n>     { \"CSS\", \"StyleSheets\", \"SVG\", \"SVGEvents\" };\n>     private final static String svgVersions[] =\n>     { \"2.0\", \"2.0\", \"1.0\", \"1.0\" };\n> \n>     public boolean hasFeature(String feature, String version) {\n>       if(super.hasFeature(feature,version)) {\n>           return true;\n>       }\n>       return hasFeatureImpl(svgFeatures, svgVersions, feature, version);\n\n*****CVS exited normally with code 1*****"}, {"count": 1, "attachment_id": null, "creator": "hillion@apache.org", "text": "for this one I choose a different solution.", "id": 2505, "time": "2001-05-17T09:36:24Z", "bug_id": 1791, "creation_time": "2001-05-17T09:36:24Z", "tags": [], "is_private": false}]
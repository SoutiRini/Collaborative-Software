[{"attachment_id": 31801, "tags": [], "creator": "dan.haughey@swinton.co.uk", "is_private": false, "count": 0, "id": 176267, "time": "2014-07-07T14:51:06Z", "bug_id": 56701, "creation_time": "2014-07-07T14:51:06Z", "text": "Created attachment 31801\nPatch to alter SPN generation behaviour in AuthManager.java\n\nWe are load testing a server using Kerberos authentication, but the server principal name is not being generated in the format that the server expects. JMeter appears to use this format:\n\nHTTP/example-server.com\n\nbut our server expects:\n\nHTTP/example-server.com:12345\n\n(where 12345 is the port number of the site being tested).\n\nChrome has a command-line switch '--enable-auth-negotiate-port' (disabled by default) that adds this port number to the SPN for sites that are on a port other than 80 or 443. (This is documented at http://dev.chromium.org/developers/design-documents/http-authentication) - using this switch allows the site to be browsed in Chrome.\n\nCould a similar option be added to JMeter? At the moment I've hacked a solution in src/protocol/http/org/apache/jmeter/protocol/http/control/AuthManager.java that adds the port number on if it is a non-standard port to mimic Chrome's behaviour with the switch enabled. This obviously needs putting behind some sort of option but I haven't had time to code this properly. My diff is attached in case this is useful to anyone."}, {"count": 1, "tags": [], "bug_id": 56701, "is_private": false, "text": "Hello,\nThanks for patch.\nI commited it to trunk nearly as is without adding option as it does not seem necessary to me.\nBut it would be great if you could test toward your initial site and a site with regular port (80 or 443).\n\nVersion should be available in nightly build:\nhttp://jmeter.apache.org/nightly.html\n\n Installing JMeter runtime\nDownload the _bin and _lib files\nUnpack the archives into the same directory structure\nThe other archives are not needed to run JMeter. \n\nPhilippe M.\n@philmdot", "id": 176424, "time": "2014-07-16T14:44:16Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-07-16T14:44:16Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Date: Wed Jul 16 14:42:17 2014\nNew Revision: 1611028\n\nURL: http://svn.apache.org/r1611028\nLog:\nBug 56701 - HTTP Authorization Manager/ Kerberos Authentication: add port to SPN when server port is neither 80 nor 443\nBugzilla Id: 56701\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/AuthManager.java\n    jmeter/trunk/xdocs/changes.xml", "count": 2, "id": 176425, "time": "2014-07-16T14:44:48Z", "bug_id": 56701, "creation_time": "2014-07-16T14:44:48Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Hello Felix,\nAS you are the Kerberos expert of JMeter, it would be nice to have your opinion on this issue and fix in nightly build.\n\nThanks for your help in advance\nRegards\nPhilippe", "count": 3, "id": 176436, "time": "2014-07-16T19:38:22Z", "bug_id": 56701, "creation_time": "2014-07-16T19:38:22Z", "is_private": false}, {"count": 4, "tags": [], "creator": "felix.schumacher@internetallee.de", "attachment_id": null, "is_private": false, "id": 176499, "time": "2014-07-18T17:04:05Z", "bug_id": 56701, "creation_time": "2014-07-18T17:04:05Z", "text": "I don't think that it is a good idea to make a non default option, that is available in only one major browser, to be the default for jmeter.\n\nAs written in the chrome url given in an cited by Dan only chrome supports the port embedded in the spn. IE and firefox will not embed ports into the spn. As SPNEGO is essential a child of microsoft, I would opt to be compatible with IE as the default. (I have done my tests only with firefox, though)\n\nThe easiest solution would be to introduce a system property to decide which algortihm should be used. But it might be, that someone would like to test two different systems, which behave different in respect to port embedded into spn. (We could wait for that to happen :)"}, {"count": 5, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "is_private": false, "id": 176501, "time": "2014-07-18T17:08:00Z", "bug_id": 56701, "creation_time": "2014-07-18T17:08:00Z", "text": "Hello Felix,\nThanks for feedback.\nCurrently what will happen is the following:\n- If port if 443 or 80 then it will not be appended.\n- If port is none of the above , then :<port> will be appended.\n\nWith this behaviour , is your note still valid ? If yes I will introduce a system property.\nThanks"}, {"attachment_id": null, "tags": [], "creator": "felix.schumacher@internetallee.de", "text": "Yes, that is exactly what I meant. Firefox and IE will produce a SPN HTTP/hostname for every given port. Chrome will do that as default. Chrome will construct a HTTP/hostname:port SPN only if you start it with --enable-auth-negotiate-port.\n\nSo I would opt for generating HTTP/hostname as default for every given port. \n\nIf someone really wants HTTP/hostname:port for non standard ports (80 and 443) we should give him a chance by setting a system property (something like -Dorg.apache.jmeter.enable-auth-negotiate-port=true)", "count": 6, "id": 176502, "time": "2014-07-18T17:13:43Z", "bug_id": 56701, "creation_time": "2014-07-18T17:13:43Z", "is_private": false}, {"count": 7, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "is_private": false, "id": 176504, "time": "2014-07-18T17:19:15Z", "bug_id": 56701, "creation_time": "2014-07-18T17:19:15Z", "text": "Thanks a lot for feedback Felix.\nYou think System property is better of jmeter property ?\nFeel free to contribute a patch, otherwise I should be handling this in the upcoming days.\nRegards"}, {"count": 8, "tags": [], "bug_id": 56701, "is_private": false, "text": "Created attachment 31831\nAdd an option to enable the chrome optional behavior\n\nHaven't tested it yet against my kerberos setup. But you can review it anyway, since the changes seems to be trivial enough.\n\nWill add a comment, as soon as I tested it against my previous setup (using a tomcat listening on port 8080)", "id": 176511, "time": "2014-07-18T19:28:55Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2014-07-18T19:28:55Z", "attachment_id": 31831}, {"count": 9, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "is_private": false, "id": 176517, "time": "2014-07-18T20:07:29Z", "bug_id": 56701, "creation_time": "2014-07-18T20:07:29Z", "text": "Date: Fri Jul 18 20:05:59 2014\nNew Revision: 1611785\n\nURL: http://svn.apache.org/r1611785\nLog:\nBug 56701 - HTTP Authorization Manager/ Kerberos Authentication: add port to SPN when server port is neither 80 nor 443\nAdd a jmeter property to control behaviour.\nBy default strip port.\nBugzilla Id: 56701\n\nModified:\n    jmeter/trunk/bin/jmeter.properties\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/AuthManager.java\n    jmeter/trunk/xdocs/changes.xml\n    jmeter/trunk/xdocs/usermanual/component_reference.xml"}, {"count": 10, "tags": [], "text": "Thanks a lot Felix, I updated the name of property to relate it to kerberos.", "is_private": false, "bug_id": 56701, "id": 176518, "time": "2014-07-18T20:07:57Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-07-18T20:07:57Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 56701, "text": "I have tested the current trunk against my test setup, which uses HTTP/www.example.com@EXAMPLE.COM as SPN for a tomcat service which runs on port 8080. That setup works.\n\nI have tried to change my SPN to HTTP/www.example.com:8080@EXAMPLE.COM. Generated a new ktab for tomcat, changed kerberos.spnego.strip_port to \"false\". And tried again. It seems to use the correct SPN, but tomcat can't authenticate that SPN with its keytab against apacheds. That might be a setup problem though.\n\nSo all in all. I think the feature will do, what the original requestor wants.", "id": 176539, "time": "2014-07-20T09:15:40Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2014-07-20T09:15:40Z", "is_private": false, "attachment_id": null}]
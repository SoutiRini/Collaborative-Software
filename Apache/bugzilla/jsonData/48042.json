[{"count": 0, "tags": [], "bug_id": 48042, "attachment_id": 24408, "id": 131315, "time": "2009-10-22T20:20:43Z", "creator": "nkalpana@gmail.com", "creation_time": "2009-10-22T20:20:43Z", "is_private": false, "text": "Created attachment 24408\nOriginal file containing a simple barchart\n\nI  tried saving a change made to a chart of an Excel 2007 file\n for(POIXMLDocumentPart poixmlpartSheet : xssfSheet.getRelations())\n                {\n                   \nif(poixmlpartSheet.getPackageRelationship().getRelationshipType().equalsIgnoreCase(\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/printerSettings\")\n== false)\n                    {\n                       \nif(poixmlpartSheet.getPackageRelationship().getRelationshipType().equalsIgnoreCase(\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing\")\n== true)\n                        {\n                            for(POIXMLDocumentPart poixmlpartDrawing :\npoixmlpartSheet.getRelations())\n                            {\n                               \nif(poixmlpartDrawing.getPackageRelationship().getRelationshipType().equalsIgnoreCase(\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart\")\n== true)\n                                {\n                                    ChartSpaceDocument docChartSpace =\nChartSpaceDocument.Factory.parse(poixmlpartDrawing.getPackagePart().getInputStream());\n                                    CTChartSpace xChartSpace =\ndocChartSpace.getChartSpace();\n                                    CTChart xChart = xChartSpace.getChart();\n\n                                    CTTitle xTitle = xChart.addNewTitle();\n                                   \nxTitle.addNewTx().addNewRich().addNewP().addNewR().setT(\"new title\");\n                                    xChart.setTitle(xTitle);\n                                    XmlOptions oOptions = new XmlOptions();\n                                   \ndocChartSpace.save(poixmlpartDrawing.getPackagePart().getOutputStream(),\noOptions);\n                                }\n                            }\n                        }\n                    }\n\n                }\n\n\nThe original file \"Barchart.xlsx\" did not have a title. \nIs there a specific way to save changes to a chart?\n\nRegards,\nnk"}, {"count": 1, "tags": [], "creator": "nkalpana@gmail.com", "attachment_id": 24409, "text": "Created attachment 24409\nThe file created after Chartspace doc changes. Excel throws \"unreadable content\" error when this is opened, and removes the drawing1.xml part\n\nThe file created after Chartspace doc changes. Excel throws \"unreadable content\" error when this is opened, and removes the drawing1.xml part", "id": 131316, "time": "2009-10-22T20:22:37Z", "bug_id": 48042, "creation_time": "2009-10-22T20:22:37Z", "is_private": false}, {"count": 2, "tags": [], "creator": "yegor@dinom.ru", "text": "There are two errors:\n\n(1) PackagePart's output stream must be closed. \n\n(2) bodyPr is a required element in CT_TextBody, see 5.7.2.157 of the OOXML spec.\n\nThe correct code to set chart title is as follows:\n\n  ChartSpaceDocument docChartSpace =\n          ChartSpaceDocument.Factory.parse(poixmlpartDrawing.getPackagePart().getInputStream());\n  CTChartSpace xChartSpace =\n          docChartSpace.getChartSpace();\n  CTChart xChart = xChartSpace.getChart();\n\n  CTTitle xTitle = xChart.addNewTitle();\n\n  CTTextBody ctBody = xTitle.addNewTx().addNewRich();\n  ctBody.addNewBodyPr(); //required\n  ctBody.addNewP().addNewR().setT(\"new title\");\n  xChart.setTitle(xTitle);\n  XmlOptions oOptions = new XmlOptions();\n\n  PackagePart part = poixmlpartDrawing.getPackagePart();\n  OutputStream out = part.getOutputStream();\n  docChartSpace.save(out, oOptions);\n  out.close(); //must close\n\n\nYegor", "id": 131455, "time": "2009-10-28T06:00:03Z", "bug_id": 48042, "creation_time": "2009-10-28T06:00:03Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 48042, "text": "Thanks Yegor,\n\nI figured it out myself over the weekend. Reading up on the mandatory nodes required for chart title, helped me.\n\nI forgot to update this message, and close it.\n\nSorry for the unnecessary thread.\n\nRegards,\nKalpana", "id": 131461, "time": "2009-10-28T07:17:55Z", "creator": "nkalpana@gmail.com", "creation_time": "2009-10-28T07:17:55Z", "is_private": false, "attachment_id": null}]
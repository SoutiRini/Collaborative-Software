[{"count": 0, "tags": [], "bug_id": 48400, "is_private": false, "text": "mod_jk retries http post requests in case of timeout in getting response from tomcat with default configurations(no retries or recovery_options specified).\n\nAFAIK HTTP Get and Head requests are only considered idempotent, shouldn't post requests be non-recoverable ?\n\nWe are using apache <--> mod_jk-1.2.28 <--AJP13--> tomcat\nWe also are using DisableReuse flag in mod_jk config\n\nI understand this can be fixed with disabling the recovery option.\n\nWondering if its a default config issue or a bug in mod_jk.\nIf it is intentional can someone please explain the intention ?\n\nmod_jk logs :\n----------------------------\n[Tue Dec 15 05:53:50 2009] [13935:0] [debug] init_ws_service::mod_jk.c (935): Service protocol=HTTP/1.1 method=POST\nssl=true host=(null) addr=XXXXXXXX name=XXXXXXXXX port=XXXX auth=(null)\nuser=(null) laddr=XXXXXXXX raddr=XXXXXXXX uri=/XXXXXXXXXXXX-MASKING--XXXX\n\n[Tue Dec 15 05:53:50 2009] [13935:0] [debug] jk_open_socket::jk_connect.c (541): timeout 120 set for socket=43\n[Tue Dec 15 05:53:50 2009] [13935:0] [debug] jk_open_socket::jk_connect.c (576): trying to connect socket 43 to\n127.0.0.1:8009\n[Tue Dec 15 05:53:50 2009] [13935:0] [debug] jk_open_socket::jk_connect.c (602): socket 43 connected to 127.0.0.1:8009\n[Tue Dec 15 05:53:50 2009] [13935:0] [debug] ajp_connection_tcp_send_message::jk_ajp_common.c (1070): sending to ajp13\npos=4 len=2495 max=8192\n\n\nAfter 2 mins ........\n\n\n[Tue Dec 15 05:55:50 2009] [13935:0] [debug] jk_shutdown_socket::jk_connect.c (681): About to shutdown socket 43\n[Tue Dec 15 05:55:52 2009] [13935:0] [debug] jk_shutdown_socket::jk_connect.c (732): Shutdown socket 43 and read 0\nlingering bytes\n[Tue Dec 15 05:55:52 2009] [13935:0] [info] ajp_connection_tcp_get_message::jk_ajp_common.c (1150): (consWorker) can't\nreceive the response header message from tomcat, network problems or tomcat (127.0.0.1:8009) is down (errno=11)\n[Tue Dec 15 05:55:52 2009] [13935:0] [error] ajp_get_reply::jk_ajp_common.c (1962): (consWorker) Tomcat is down or\nrefused connection. No response has been sent to the client (yet)\n[Tue Dec 15 05:55:52 2009] [13935:0] [info] ajp_service::jk_ajp_common.c (2447): (consWorker) sending request to tomcat\nfailed (recoverable),  (attempt=1)\n[Tue Dec 15 05:55:52 2009] [13935:0] [debug] ajp_service::jk_ajp_common.c (2304): retry 1, sleeping for 100 ms before\nretrying\n[Tue Dec 15 05:55:53 2009] [13935:0] [debug] ajp_send_request::jk_ajp_common.c (1501): (consWorker) all endpoints are\ndisconnected.\n[Tue Dec 15 05:55:53 2009] [13935:0] [debug] jk_open_socket::jk_connect.c (452): socket TCP_NODELAY set to On\n[Tue Dec 15 05:55:53 2009] [13935:0] [debug] jk_open_socket::jk_connect.c (541): timeout 120 set for socket=43\n[Tue Dec 15 05:55:53 2009] [13935:0] [debug] jk_open_socket::jk_connect.c (576): trying to connect socket 43 to\n127.0.0.1:8009\n[Tue Dec 15 05:55:53 2009] [13935:0] [debug] jk_open_socket::jk_connect.c (602): socket 43 connected to 127.0.0.1:8009\n[Tue Dec 15 05:55:53 2009] [13935:0] [debug] ajp_connect_to_endpoint::jk_ajp_common.c (931): Connected socket 43 to\n(127.0.0.1:8009)\n[Tue Dec 15 05:55:53 2009] [13935:0] [debug] ajp_connection_tcp_send_message::jk_ajp_common.c (1070): sending to ajp13\npos=4 len=2495 max=8192\n----------------------------", "id": 132882, "time": "2009-12-16T21:21:05Z", "creator": "discoversudhir@gmail.com", "creation_time": "2009-12-16T21:21:05Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 48400, "attachment_id": null, "is_private": false, "id": 132895, "time": "2009-12-17T02:26:04Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2009-12-17T02:26:04Z", "text": "(In reply to comment #0)\n\n> I understand this can be fixed with disabling the recovery option.\n> \n> Wondering if its a default config issue or a bug in mod_jk.\n\nDefault config issue. It should have been \"don't retry POST by default\", but for compatibility reasons the wrong defaults chosen once were never changed during 1.2.x. This will be kept as is and only change for the next \"major\" version 1.3. For that we will change a lot of configuration options to more sensble defaults."}, {"count": 2, "tags": [], "text": "Hello Rainer,\nCan those better defaults be found somewhere ? I looked at svn branch 1.3 but only found ROADMAP.\n\nRegarding \"don't retry POST by default\",\nCan this be configured by setting: \nrecovery_options=27\n\n\nThanks", "attachment_id": null, "id": 177556, "creator": "p.mouawad@ubik-ingenierie.com", "time": "2014-09-05T12:22:58Z", "bug_id": 48400, "creation_time": "2014-09-05T12:22:58Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 48400, "attachment_id": null, "is_private": false, "id": 177576, "time": "2014-09-06T10:48:39Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2014-09-06T10:48:39Z", "text": "Hi Philippe,\n\nlook for workers.properties (*not* the \"minimal\" one) and httpd-jk.conf in http://svn.apache.org/viewvc/tomcat/jk/trunk/conf/ or in the conf/ directory of every released source archive download (starting many years ago).\n\nFor recovery_options, yes, \"3\" or \"27\" are reasonable defaults. See http://tomcat.apache.org/connectors-doc/reference/workers.html.\n\nPlease post further questions to the appropriate Tomcat mailing list (mostly the users list), not here."}, {"count": 4, "tags": [], "bug_id": 48400, "attachment_id": null, "id": 177604, "time": "2014-09-07T13:49:31Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-09-07T13:49:31Z", "is_private": false, "text": "Thanks a lot for answers Rainer.\nI thought it might be interesting to ask here so that other users can find the answer in the related issue."}]
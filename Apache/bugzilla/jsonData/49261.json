[{"count": 0, "tags": [], "text": "The copy task in prior versions (I tried 1.7.0 & 1.7.1) allowed one to overwrite a read-only file if overwrite=\"true\" was set. Now it seems that in 1.8.0 that no longer works and results in an exception:\n\n\n/private/tmp/build.xml:3: Failed to copy /private/tmp/source to /private/tmp/dest due to java.io.FileNotFoundException /private/tmp/dest (Permission denied)\n\nMy steps to reproduce are below.\n\n$ whoami\ncquinn\n\n$ echo 'The quick brown fox jumped over the lazy dog.' > source\n\n$ touch dest; chmod -w dest\n\n$ ls -l source dest\n-r--r--r--  1 cquinn  wheel   0 May  6 14:39 dest\n-rw-r--r--  1 cquinn  wheel  46 May  6 14:35 source\n\n$ cat build.xml \n<project default=\"bug\">\n   <target name=\"bug\">\n      <copy file=\"source\" tofile=\"dest\" overwrite=\"true\"/>\n   </target>\n</project>\n\n$ ant -version\nApache Ant version 1.8.0 compiled on February 1 2010\n\n$ ant\nBuildfile: /private/tmp/build.xml\n\nbug:\n     [copy] Copying 1 file to /private/tmp\n\nBUILD FAILED\n/private/tmp/build.xml:3: Failed to copy /private/tmp/source to /private/tmp/dest due to java.io.FileNotFoundException /private/tmp/dest (Permission denied)\n\n$ ls -l source dest\nls: dest: No such file or directory\n-rw-r--r--  1 cquinn  wheel  46 May  6 14:35 source\n\n>> Note that it not only failed to copy, but it removed the file.\n>> Now, put the dest file back and switch ants to show how it used to work:\n\n$ touch dest; chmod -w dest\n\n$ ant -version\nApache Ant version 1.7.1 compiled on June 27 2008\n\n$ ant\nBuildfile: build.xml\n\nbug:\n     [copy] Copying 1 file to /private/tmp\n\nBUILD SUCCESSFUL\nTotal time: 0 seconds\n\n$ ls -l source dest\n-rw-r--r--  1 cquinn  wheel  46 May  6 14:57 dest\n-rw-r--r--  1 cquinn  wheel  46 May  6 14:35 source", "attachment_id": null, "id": 136713, "creator": "carl.quinn@gmail.com", "time": "2010-05-06T18:04:36Z", "bug_id": 49261, "creation_time": "2010-05-06T18:04:36Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 49261, "attachment_id": null, "text": "My guess is that our changed copy code using NIO is taking the target's\npermissions into account whlie the old stream based approach did not.\n\noverwrite really only says \"write even if the dest isn't out of date\" and never\nhad any influence on whether a readonly dest file would get overwritten.\nIf you create dest befaore source in your testcase Ant 1.7.1 will happily\noverwrite dest without the overwrite attribute as well.\n\nI must admit that I actually like the change - Ant shouldn't ignore the\nread-only state if the destination.  We may want to throw in an additional\nattribute that controls the behavior.\n\nIf my guess is correct then you can trick Ant into using the non-NIO code\nby filtering- i.e. you could throw in a filter that doesn't change your\nfiles.  This will not work for binary files.  Another \"trick\" would be to\nZIP or TAR up the sources and extract from there since the NIO code\nis only used if source and dest are files and no filtering occurs at all.", "id": 136720, "time": "2010-05-07T05:14:26Z", "creator": "bodewig@apache.org", "creation_time": "2010-05-07T05:14:26Z", "is_private": false}, {"count": 2, "tags": [], "text": "my guess seems to be correct.  I've added four testcases to Ant in svn revision 942805 - two of them disabled because they fail with Ant 1.8.x.\n\nIf I specify a dummy <filterset> Ant will happily overwrite the existing file,\nwithout one - when Ant uses NIO - it won't but throw an exception instead.\n\nDiscussion about how to deal with it for Ant 1.8.2 will follow on the dev\nlist.", "attachment_id": null, "id": 136725, "creator": "bodewig@apache.org", "time": "2010-05-07T10:34:56Z", "bug_id": 49261, "creation_time": "2010-05-07T10:34:56Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 49261, "text": "(In reply to comment #2)\n> in revision 942805\n\nshould have been svn revision 942085", "id": 136726, "time": "2010-05-07T10:36:11Z", "creator": "bodewig@apache.org", "creation_time": "2010-05-07T10:36:11Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 49261, "attachment_id": null, "id": 136755, "time": "2010-05-10T10:46:21Z", "creator": "bodewig@apache.org", "creation_time": "2010-05-10T10:46:21Z", "is_private": false, "text": "With svn revision 942752 <copy> behaves consistently and has a new attribute \"force\" that can be used to overwrite read-only destinations.\n\nI'll check the other clients of out \"copy\" method to see which other tasks would need a force attribute as well before I close this."}, {"count": 5, "tags": [], "text": "<move> has been adapted with svn revision 943056 and <concat> and <echo>\nwith svn revision 943068", "is_private": false, "id": 136772, "creator": "bodewig@apache.org", "time": "2010-05-11T05:54:50Z", "bug_id": 49261, "creation_time": "2010-05-11T05:54:50Z", "attachment_id": null}]
[{"attachment_id": null, "tags": [], "bug_id": 40093, "is_private": false, "count": 0, "id": 91481, "time": "2006-07-22T08:39:25Z", "creator": "efanomars@yahoo.com", "creation_time": "2006-07-22T08:39:25Z", "text": "The reference 'ant.PropertyHelper' isn't passed correctly to\nthe target of an ant (task) call. If a new PropertyHelper (a subclass of it)\nis installed, it is not passed to the called build.\nIt seems that property expansion is executed before the references \nare passed (with inherirefs=\"true\"). This means that a\nstandard PropertyHelper instance is created for the reference \n'ant.PropertyHelper' and the new reference is therefore ignored.\nMaybe this reference should be treated separately?\nSee:\n- the call to newProject.setInheritedProperty in Ant.execute()\n- overrideProperties() calling Property.execute()"}, {"count": 1, "tags": [], "text": "Created attachment 18624\nbuild.xml showing problem", "is_private": false, "id": 91482, "creator": "efanomars@yahoo.com", "time": "2006-07-22T08:42:00Z", "bug_id": 40093, "creation_time": "2006-07-22T08:42:00Z", "attachment_id": 18624}, {"attachment_id": null, "tags": [], "bug_id": 40093, "is_private": false, "count": 2, "id": 91484, "time": "2006-07-22T09:37:38Z", "creator": "efanomars@yahoo.com", "creation_time": "2006-07-22T09:37:38Z", "text": "I see that passing the property helper as reference doesn't even\nmake sense. Adding a property to the build would (AFAIK) also add\nit to the called build, which is wrong. A solution would be\nto clone the PropertyHelper if it's subclassed and if an\nattribute inheritPropertyHelper=\"true\" is set.\nAnd I guess there are other tasks that would have to implement the same."}, {"count": 3, "tags": [], "bug_id": 40093, "attachment_id": null, "id": 91488, "time": "2006-07-22T12:16:34Z", "creator": "efanomars@yahoo.com", "creation_time": "2006-07-22T12:16:34Z", "is_private": false, "text": "Sorry for polluting bugzilla. I think the PropertyHelper isn't\nconceived for being (cloned and) passed to a sub build, so \nI mark this bug as invalid and live with the limitation."}, {"count": 4, "tags": [], "bug_id": 40093, "attachment_id": 18638, "id": 91583, "time": "2006-07-26T00:35:42Z", "creator": "efanomars@yahoo.com", "creation_time": "2006-07-26T00:35:42Z", "is_private": false, "text": "Created attachment 18638\nPatch to clone PropertyHelper for subbuilds\n\nCustom property helper is not passed to subbuilds at all. \nThis clones the PropertyHelper if inheritAll\nis true (but an additional attribute like \ninheritPropertyHandler may be better)."}, {"count": 5, "tags": [], "text": "Created attachment 18639\nCloneable PropertyHelper\n\nThis patch declares PropertyHelper as Cloneable.\nThe implementation sets values as if it where\nnewly constructed, since properties are set\nthrough the project.", "attachment_id": 18639, "id": 91584, "creator": "efanomars@yahoo.com", "time": "2006-07-26T00:38:41Z", "bug_id": 40093, "creation_time": "2006-07-26T00:38:41Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 40093, "attachment_id": 18640, "id": 91585, "time": "2006-07-26T00:42:04Z", "creator": "efanomars@yahoo.com", "creation_time": "2006-07-26T00:42:04Z", "is_private": false, "text": "Created attachment 18640\nTest: custom property helper cloned in subbuilds\n\nThis test should be successful if patches are applied.\nCalls subbuilds with ant,antcall,subant."}, {"attachment_id": null, "tags": [], "bug_id": 40093, "is_private": false, "count": 7, "id": 91586, "time": "2006-07-26T00:49:01Z", "creator": "efanomars@yahoo.com", "creation_time": "2006-07-26T00:49:01Z", "text": "I know not many care about the property helper,\nbut I think the current behaviour is wrong.\nThe PropertyHelper class is there to be extended\nand Ant should therefore handle it correctly.\nThe patch implementation clones the PH when inheritAll \nis true, but a new attribute may be defined."}, {"count": 8, "tags": [], "creator": "efanomars@yahoo.com", "is_private": false, "id": 91591, "creation_time": "2006-07-26T09:19:18Z", "time": "2006-07-26T09:19:18Z", "bug_id": 40093, "text": "Created attachment 18641\nPatches of Ant.java and PropertyFunction.java (patch.xml)\n\nFound out there is the very handy patch.xml build\nto create patches for Ant.\nAdded a missing setProject() in the code.", "attachment_id": 18641}, {"count": 9, "tags": [], "creator": "efanomars@yahoo.com", "is_private": false, "id": 91694, "creation_time": "2006-07-28T13:15:49Z", "time": "2006-07-28T13:15:49Z", "bug_id": 40093, "text": "Created attachment 18659\nPatches of sources, tests and docu, plus new files\n\nPropertyHelper patches.\n \nWhy (the problem): \n  even though it is possible for a custom task to install a \n  new property helper as a hook or even as the main property helper, \n  at present there is no way to pass the helper to subbuilds. \n  The additional data in the PropertyHelper subclass and the hooks \n  are not inherited. \nProposed solution:\n  this patch extends the PropertyHelper interface to install\n  and clone PropertyHelper instances in a way suitable to Ant.\n\n** Sources **\nPropertyHelper.java:\n - installPropertyHelper(project, newHelper) \n      to install a custom PropertyHelper into a project \n - clonePropertyHelper(fromProject, newProject, inheritAll)\n      to clone a PropertyHelper to a new project and optionally\n      copy hooks' properties to their clones\n - areYouOverridableBy(newHelper) method that let's the main \n      property helper decide whether it wants to give up control \n      of the build's property handling to a new helper.\n\nAnt.java, CallTarget.java, SubAnt.java: \n - new \"inheritph\" attribute telling whether the property helper\n   and its hooks should be cloned to the new project\n\n** Tests **\nPropertyHelperTest.java:\n - created new test case, testing installation of property helpers\n   and hooks into a project\n\nAntTest.java, CallTargetTest.java:\n - extended to test cloning of property helper and its hooks\n\n** Docu **\nAnt.html, AntCall.html, SubAnt.html:\n - added \"inheritph\" attribute with a small comment\n\n** Note **\nModified and patched against latest 1.70alpha.\nThe proposed changes should be backward compatible.", "attachment_id": 18659}, {"count": 10, "tags": [], "bug_id": 40093, "attachment_id": 18662, "id": 91720, "time": "2006-07-30T06:47:59Z", "creator": "efanomars@yahoo.com", "creation_time": "2006-07-30T06:47:59Z", "is_private": false, "text": "Created attachment 18662\nCorrected PropertyHelper patch.txt\n\nNew in patch:\n- added PropertyHelper.installPropertyHelperHook(project, newHook) \n- added minimal SubAntTest.java\n- corrected some bugs (setProject on clones,...)\n\nFurther corrections, comments, suggestions, motivated refusals are welcome.\n\nI know the bugzilla title no longer reflects the contents \nof the patch and sorry for the many files posted, \nbut this was my first patch ever (I'm sure you noticed :-)\n\nThank you,\nStefano Marsili"}, {"count": 11, "text": "Thanks for the patch, unit tests and doc - this is\ngreat!.\n", "creator": "peterreilly@apache.org", "attachment_id": null, "id": 93908, "time": "2006-09-20T09:40:15Z", "bug_id": 40093, "creation_time": "2006-09-20T09:40:15Z", "tags": [], "is_private": false}]
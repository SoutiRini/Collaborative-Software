[{"count": 0, "tags": [], "text": "In the servlet standard it says that ISO-8859-1 is the default charset if\nnothing else is said but if running Tomcat under a en_US locale on Solaris it\nconverts text to ASCII instead, replacing any iso-8859-1-chars with ? (question\nmarks). We've confirmed that changing the Solaris locale to fr_CA fixes that\nproblem but running wit fr_CA is not an option for us.", "is_private": false, "id": 17273, "creator": "bratell@lysator.liu.se", "time": "2002-06-06T05:51:00Z", "bug_id": 9654, "creation_time": "2002-06-06T05:51:00Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Tomcat default to ISO-8859-1 when no encoding is specified when using a writer\nto output data.\nYou'll have to indicate which parts of the code incorrectly handle encodings.", "attachment_id": null, "bug_id": 9654, "id": 17274, "time": "2002-06-06T06:04:08Z", "creator": "remm@apache.org", "creation_time": "2002-06-06T06:04:08Z", "is_private": false}, {"count": 2, "tags": [], "creator": "bratell@lysator.liu.se", "attachment_id": null, "is_private": false, "id": 17276, "time": "2002-06-06T06:05:11Z", "bug_id": 9654, "creation_time": "2002-06-06T06:05:11Z", "text": "I think the problem may be that setLocale in ResponseBase.java sets |encoding|\nand if |encoding| is set, it won't be overridden by the default charset\n(ISO-8859-1) in HTTP. One solution (not necessarily the right one) could be to\nset |encoding| to null efter the call to super.setLocale in\nHttpResponseBase.setLocale. \n\nThat is, if setLocale is called by the servlet engine."}, {"count": 3, "attachment_id": null, "creator": "remm@apache.org", "is_private": false, "id": 17281, "time": "2002-06-06T06:15:08Z", "bug_id": 9654, "creation_time": "2002-06-06T06:15:08Z", "tags": [], "text": "I'm not sure I understand correctly. If the encoding is set, I don't see why you\nwould want setLocale to reset that to the HTTP default.\n\nCould you give an example which doesn't work (and why you think it should do\nsomething different) ?"}, {"count": 4, "tags": [], "text": "From what I can see in the sourcecode, all the translation between Locales and Charset is done \nby o.a.c.util.CharsetMapper.\n\nNow, if your locale (Locale.toString()) returns en_US, that locale will not be recognized by the \ndefault properties, but it will in \"second match\" because we attempt to match on the full locale \nfirst, and on the Locale.getLanguage() then (so, if en_US is not in the CharsetMapper.properties \nfile -and it's not- it will be retried only with \"en\" and that resolves back to ISO-88590-1, so it \nshould work allright.\n\nSo, either you're setting some weird locale default in your VM, or your OS configuration is _really_ \nfoobared... I just verified, and it works on Solaris 8 with JDK 1.3.1_03 on a SparcV9 system.\n\nFor sure we make some wild assumptions in setLocale (we set the \"encoding\" field which is not \nused when creating the writer, for example, and if someone sets the locale, then sets a content \ntype which includes a \";\" character, and then sets the locale again, we might as well send \neverything down the drain), but with fairly well constructed servlets, this shouldn't be an issue.\n\nIt's hard to say what's wrong without seeing your code. It _should_ work (on paper).", "attachment_id": null, "id": 17288, "creator": "pier@betaversion.org", "time": "2002-06-06T06:51:10Z", "bug_id": 9654, "creation_time": "2002-06-06T06:51:10Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 9654, "is_private": false, "id": 17289, "creation_time": "2002-06-06T06:56:25Z", "time": "2002-06-06T06:56:25Z", "creator": "bratell@lysator.liu.se", "text": "Reopening to set INVALID", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 9654, "attachment_id": null, "text": "You're right. Tomcat works. The problem was that our code did\n   PrintWriter out = new PrintWriter(resp.getOutputStream());\ninstead of\n   PrintWriter out = resp.getWriter()\n\n\nSorry for the false alarm. :-(", "id": 17290, "time": "2002-06-06T06:57:59Z", "creator": "bratell@lysator.liu.se", "creation_time": "2002-06-06T06:57:59Z", "is_private": false}]
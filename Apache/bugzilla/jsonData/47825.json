[{"count": 0, "tags": [], "creator": "daniel.unfried@u-net.de", "text": "Created attachment 24248\nsimple Maven2 web project to reproduce the error\n\nTrying to do\n  response.addCookie(new Cookie(\"cookie0\", myData));\nwhere myData is a UTF-8 String retrieved through request parameter, all 5.5\nversions after and including 5.5.26 produce the following ServletException\nerror:\n\njavax.servlet.ServletException: Control character in cookie value, consider\nBASE64 encoding your value\norg.apache.struts.chain.ComposableRequestProcessor.process(ComposableRequestProcessor.java:286)\n\nThe instructions from http://wiki.apache.org/tomcat/FAQ/CharacterEncoding to\nhandle encodings correctly state:\n - Set URIEncoding=\"UTF-8\" on your <Connector> in server.xml\n - Use a character encoding filter with the default encoding set to UTF-8\n - Change all your JSPs to set the correct Content-Type (use <%@page\ncontentType=\"mime/type; charset=UTF-8\" %>)\n\nFollowing these instructions I started out with vanilla installations of 5.25,\n5.26, 5.27 and 5.28 on both Windows (Vista64) and Linux (Debian 5.0) using\njdk-1.5.0_12 with the only change from default configuration being the\nURIEncoding set to UTF-8 in server.xml. By deploying the sample application\nattached the error can be reproduced for 5.5.26+.", "id": 130314, "time": "2009-09-11T07:56:55Z", "bug_id": 47825, "creation_time": "2009-09-11T07:56:55Z", "is_private": false, "attachment_id": 24248}, {"count": 1, "tags": [], "creator": "daniel.unfried@u-net.de", "text": "Created attachment 24249\ntrace log", "id": 130315, "time": "2009-09-11T07:58:42Z", "bug_id": 47825, "creation_time": "2009-09-11T07:58:42Z", "is_private": false, "attachment_id": 24249}, {"count": 2, "tags": [], "text": "As the error message says, if you want to do that you'll need to encode the data, eg using Base64.", "is_private": false, "id": 130316, "creator": "markt@apache.org", "time": "2009-09-11T08:05:00Z", "bug_id": 47825, "creation_time": "2009-09-11T08:05:00Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "daniel.unfried@u-net.de", "text": "But why did the exact same thing work on 5.5.25? Is this some non-standard behavior? Is it just a coincidence it works? Would be great if you could shed some more light.", "id": 130317, "time": "2009-09-11T08:10:46Z", "bug_id": 47825, "creation_time": "2009-09-11T08:10:46Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "markt@apache.org", "text": "Cookie handling is now stricter. Non-compliant cookies will get rejected.", "id": 130318, "time": "2009-09-11T08:18:20Z", "bug_id": 47825, "creation_time": "2009-09-11T08:18:20Z", "is_private": false, "attachment_id": null}]
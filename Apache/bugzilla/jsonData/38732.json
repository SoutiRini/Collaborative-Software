[{"count": 0, "tags": [], "bug_id": 38732, "attachment_id": null, "id": 86001, "time": "2006-02-21T10:44:00Z", "creator": "robbiexgibson@yahoo.com", "creation_time": "2006-02-21T10:44:00Z", "is_private": false, "text": "We launch rmic with the -Xnew flag to use the alternative doclet-based stub\ngenerator.  This works fine from the command line under JDK 5.0 and JDK 6.0-b72;\nand with the ant rmic task under JDK 5.0. However the ant rmic task crashes when\nthe -Xnew flag is used with JDK 6.0-b72. The error given is \"rmic: error -\nDoclet class sun.rmi.rmic.newrmic.Main does not contain a start method\""}, {"count": 1, "tags": [], "text": "I don't think there is any problem with Ant here, Ant invokes the compile\nmethod in sun.rmi.rmic.Main, nothing else.\n\nDoes it work if you run without -Xnew?  Could you run rmic from the command\nline without Ant?", "is_private": false, "id": 87864, "creator": "bodewig@apache.org", "time": "2006-04-12T20:36:23Z", "bug_id": 38732, "creation_time": "2006-04-12T20:36:23Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Like I said in the description, it works:\n- from the command line without -Xnew with JDK5 and JDK6\n- from the command line with -Xnew with JDK5 and JDK6\n- from ant without -Xnew with JDK5 and JDK6\n- from any without -Xnew with JDK5\n\nThe only combination that doesn't seem to work is running it from ant with the\n-Xnew flag under JDK6.\n\nI re-verified with JDK6 build 79 and the problem still exists.\nI know it seems strange, but the problem is 100% reproducible in my environment.", "is_private": false, "id": 88057, "creator": "robbiexgibson@yahoo.com", "time": "2006-04-14T12:52:05Z", "bug_id": 38732, "creation_time": "2006-04-14T12:52:05Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Can you do a full -d stack trace. We need to see if this is something with Ant\nor java 1.6", "is_private": false, "id": 88139, "creator": "stevel@apache.org", "time": "2006-04-16T16:50:14Z", "bug_id": 38732, "creation_time": "2006-04-16T16:50:14Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 38732, "attachment_id": 18118, "id": 88191, "time": "2006-04-18T08:05:31Z", "creator": "robbiexgibson@yahoo.com", "creation_time": "2006-04-18T08:05:31Z", "is_private": false, "text": "Created attachment 18118\nant -d -v output\n\nWhat's \"a full -d stack trace\"? I've attached the output from ant -d -v rmic.\nDo you want a stack trace? At which point should I generate one?"}, {"count": 5, "tags": [], "bug_id": 38732, "text": "Hmmm... ordinarily you wouldn't use -d and -v together.  Does -d without -v\nproduce more output?\n\nP.S. when your report is marked NEEDINFO, once you provide that info you should\npick Reassign to dev@ant.apache.org or it could get lost in the madness.", "id": 88211, "attachment_id": null, "creator": "mbenson@apache.org", "creation_time": "2006-04-18T13:58:20Z", "time": "2006-04-18T13:58:20Z", "is_private": false}, {"count": 6, "text": "Created attachment 18125\nant -d output\n\nOK thanks. Here is the plain ant -d output.\nReassigning to dev.", "creator": "robbiexgibson@yahoo.com", "is_private": false, "id": 88213, "time": "2006-04-18T15:07:48Z", "bug_id": 38732, "creation_time": "2006-04-18T15:07:48Z", "tags": [], "attachment_id": 18125}, {"count": 7, "tags": [], "creator": "mbenson@apache.org", "is_private": false, "text": "I do find it interesting that this report is marked with Ant version 1.6.5\ndespite the fact that the debug output shows Ant 1.6.0.  :|", "id": 88214, "time": "2006-04-18T15:39:06Z", "bug_id": 38732, "creation_time": "2006-04-18T15:39:06Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "Created attachment 18127\nant -d output\n\nOK, here is the ant -d output using ant 1.6.5", "is_private": false, "id": 88216, "creator": "robbiexgibson@yahoo.com", "time": "2006-04-18T17:41:59Z", "bug_id": 38732, "creation_time": "2006-04-18T17:41:59Z", "attachment_id": 18127}, {"attachment_id": null, "tags": [], "bug_id": 38732, "text": "Thanks for helping us be sure the problem does indeed affect 1.6.5.", "count": 9, "id": 88218, "time": "2006-04-18T17:52:46Z", "creator": "mbenson@apache.org", "creation_time": "2006-04-18T17:52:46Z", "is_private": false}, {"count": 10, "text": "Thanks for the diagnostics. Could you stick in the <rmic> tag used. We should\nmake a unit test for this, regardless of the underlying cause. \n\nI note that ant1.7 has a forking adapter that forks rmic into a new process. I\nsuspect (indeed, hope) that this problem will make the error go away. Maybe we\nshould make the default rmic compiler for Java1.6 the forking one if -xnew is\nset? We could even add a newstub attribute to say 'new stub generator' that\ncould be used as a trigger for this behaviour.. ", "creator": "stevel@apache.org", "attachment_id": null, "id": 88223, "time": "2006-04-18T20:15:54Z", "bug_id": 38732, "creation_time": "2006-04-18T20:15:54Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 38732, "attachment_id": 18133, "id": 88252, "time": "2006-04-19T07:22:09Z", "creator": "robbiexgibson@yahoo.com", "creation_time": "2006-04-19T07:22:09Z", "is_private": false, "text": "Created attachment 18133\nExtract from build.xml\n\nAttached my rmic task - nothing complicated at all"}, {"count": 12, "tags": [], "text": "This is rather strange.  I've added to tests to Ant's tests in SVN, both setting\n-Xnew, one forking, one not.\n\nIf I run the corresponding targets directly, I get the behavior Robert describes -\nbut only in the not-forking case.\n\nIf I run the tests via <junit>, either both fail (when I don't fork JUnit) or both\npass (when I fork JUnit).\n\nLooks like a classloader issue with Sun's rmic at first glance.  It doesn't seem\nto like it when Ant pulls in tools.jar via the launcher logic.", "is_private": false, "id": 88659, "creator": "bodewig@apache.org", "time": "2006-04-29T15:27:05Z", "bug_id": 38732, "creation_time": "2006-04-29T15:27:05Z", "attachment_id": null}, {"count": 13, "tags": [], "text": "\nWhat are we doing with this? Can we take it up with Sun? Or should we switch to\nforking rmic on java6.0+", "attachment_id": null, "id": 90936, "creator": "stevel@apache.org", "time": "2006-07-06T10:36:36Z", "bug_id": 38732, "creation_time": "2006-07-06T10:36:36Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 38732, "text": "Hello Steve,\n\nI think we should do both take it with Sun and fork rmic in JDK 6.0.\nSun may or may not fix the problem soon. If we fork rmic in JDK 6.0, then we\nwill have a good workaround in Ant 1.7.0. Afterwards it can change again.\n\nThis is one of the nice things of ant that it hides or wipes away so of the\ndissonance between \"write once, run everywhere\" and the reality.\n\nAntoine", "count": 14, "id": 91008, "time": "2006-07-07T17:47:02Z", "creator": "antoine@apache.org", "creation_time": "2006-07-07T17:47:02Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 38732, "attachment_id": null, "id": 92457, "time": "2006-08-23T11:51:32Z", "creator": "stevel@apache.org", "creation_time": "2006-08-23T11:51:32Z", "is_private": false, "text": "If we look at the rmic source\n\nhttp://www.cs.duke.edu/csed/java/source1.5/src/share/classes/sun/rmi/rmic/Main.java\n\nwe can see that -xnew triggers a load+invoke of sun.rmi.rmic.newrmic.Main,\ncompletely bypassing the other bits.\n\nWhat we could do is have a new compiler adapter \"xnew\" that \n -uses this as the entry point (or runs classic rmic with -Xnew)\n -forks on all java versions\nThis would eliminate the need to look for -XNew as an argument to rmic itself,\nand make management of the problem much less contrived (the alternate is to\ncheck for sun && java1.6+ && -XNew in the argument list and switch to the\nforking compiler)"}, {"count": 16, "tags": [], "text": "Ok. committed a new xnew compiler that works on java1.5; not tested on java1.6\n\nRobert, when ant1.7 appears in beta form next week, can you download it and see\nif the xnew adapter meets your needs?", "is_private": false, "id": 92459, "creator": "stevel@apache.org", "time": "2006-08-23T12:34:49Z", "bug_id": 38732, "creation_time": "2006-08-23T12:34:49Z", "attachment_id": null}, {"count": 17, "tags": [], "creator": "stevel@apache.org", "is_private": false, "text": "closing as fixed; if it isnt, feel free to reopen it.", "id": 92460, "time": "2006-08-23T12:35:39Z", "bug_id": 38732, "creation_time": "2006-08-23T12:35:39Z", "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 38732, "attachment_id": null, "text": "(In reply to comment #16)\n> Robert, when ant1.7 appears in beta form next week, can you download it and see\n> if the xnew adapter meets your needs?\n\nSure thing, do you mean I should replace\n      <rmic base=\"${javaclasses}\">\n            <compilerarg value=\"-Xnew\"/>\n...\n      </rmic>\nwith\n      <xnew base=\"${javaclasses}\">\n...\n      </xnew>\n?", "id": 92466, "time": "2006-08-23T12:50:31Z", "creator": "robbiexgibson@yahoo.com", "creation_time": "2006-08-23T12:50:31Z", "is_private": false}, {"count": 19, "tags": [], "text": "no, you'd go\n\n      <rmic base=\"${javaclasses}\"\n        compiler=\"xnew\" >\n      </rmic>", "is_private": false, "id": 92472, "creator": "stevel@apache.org", "time": "2006-08-23T18:11:53Z", "bug_id": 38732, "creation_time": "2006-08-23T18:11:53Z", "attachment_id": null}, {"count": 20, "tags": [], "text": "Seems fixed.", "attachment_id": null, "id": 92649, "creator": "robbiexgibson@yahoo.com", "time": "2006-08-29T09:23:18Z", "bug_id": 38732, "creation_time": "2006-08-29T09:23:18Z", "is_private": false}, {"count": 21, "tags": [], "bug_id": 38732, "text": "reopening this just to add some more comments for searches to turn up.\n\nWhen we run the testXNew test in a recent Java6 update 3 JVM, the XML parser\nconfiguration get stamped on :\n\norg.apache.xerces.parsers.XIncludeAwareParserConfiguration cannot be cast to\norg.apache.xerces.xni.parser.XMLParserConfiguration\n\njava.lang.ClassCastException:\norg.apache.xerces.parsers.XIncludeAwareParserConfiguration cannot be cast to\norg.apache.xerces.xni.parser.XMLParserConfiguration\nat org.apache.xerces.parsers.SAXParser.(Unknown Source)\nat org.apache.xerces.parsers.SAXParser.(Unknown Source)\nat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.(Unknown Source)\nat org.apache.xerces.jaxp.SAXParserImpl.(Unknown Source)\nat org.apache.xerces.jaxp.SAXParserFactoryImpl.newSAXParser(Unknown Source)\nat org.apache.tools.ant.util.JAXPUtils.newSAXParser(JAXPUtils.java:215)\nat org.apache.tools.ant.util.JAXPUtils.getNamespaceXMLReader(JAXPUtils.java:172)\nat org.apache.tools.ant.helper.ProjectHelper2.parse(ProjectHelper2.java:182)\nat org.apache.tools.ant.helper.ProjectHelper2.parse(ProjectHelper2.java:138)\nat org.apache.tools.ant.ProjectHelper.configureProject(ProjectHelper.java:93)\nat org.apache.tools.ant.BuildFileTest.configureProject(BuildFileTest.java:289)\nat org.apache.tools.ant.BuildFileTest.configureProject(BuildFileTest.java:272)\nat org.apache.tools.ant.taskdefs.RmicAdvancedTest.setUp(RmicAdvancedTest.java:44)\nat junit.framework.TestCase.runBare(TestCase.java:128)\nat junit.framework.TestResult$1.protect(TestResult.java:106)\nat junit.framework.TestResult.runProtected(TestResult.java:124)\nat junit.framework.TestResult.run(TestResult.java:109)\nat junit.framework.TestCase.run(TestCase.java:120)\nat junit.framework.TestSuite.runTest(TestSuite.java:230)\nat junit.framework.TestSuite.run(TestSuite.java:225)\nat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:420)\nat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTask.executeInVM(JUnitTask.java:1327)\nat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTask.execute(JUnitTask.java:824)\nat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTask.executeOrQueue(JUnitTask.java:1751)\nat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTask.execute(JUnitTask.java:774)\nat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:597)\nat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\nat org.apache.tools.ant.Task.perform(Task.java:348)\nat org.apache.tools.ant.taskdefs.Sequential.execute(Sequential.java:62)\nat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:597)\nat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\nat org.apache.tools.ant.Task.perform(Task.java:348)\nat org.apache.tools.ant.taskdefs.MacroInstance.execute(MacroInstance.java:394)\nat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\nat sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\nat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:597)\nat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\nat org.apache.tools.ant.Task.perform(Task.java:348)\nat org.apache.tools.ant.Target.execute(Target.java:354)\nat org.apache.tools.ant.Target.performTasks(Target.java:379)\nat org.apache.tools.ant.Project.executeSortedTargets(Project.java:1324)\nat org.apache.tools.ant.Project.executeTarget(Project.java:1293)\nat\norg.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\nat org.apache.tools.ant.Project.executeTargets(Project.java:1176)\nat org.apache.tools.ant.Main.runBuild(Main.java:758)\nat org.apache.tools.ant.Main.startAnt(Main.java:217)\nat org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\nat org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)\n\nThis is yet another reason not to run the -Xnew compiler unforked under java6. ", "id": 110116, "time": "2007-11-01T06:58:32Z", "creator": "stevel@apache.org", "creation_time": "2007-11-01T06:58:32Z", "is_private": false, "attachment_id": null}, {"count": 22, "tags": [], "bug_id": 38732, "text": "\nfixing non forking rmic -Xnew test so that it doesnt run. Since this rmic option\ndoesnt work on java6 anyway, the <rmic> -Xnew option is still broken.\n\nmarking as wontfix, as users are required to switch to the xnew adapter to get\nthings to work. ", "id": 110117, "time": "2007-11-01T07:08:57Z", "creator": "stevel@apache.org", "creation_time": "2007-11-01T07:08:57Z", "is_private": false, "attachment_id": null}]
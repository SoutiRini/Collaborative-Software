[{"count": 0, "attachment_id": null, "creator": "bruce.nolan@pbsg.com", "is_private": false, "id": 67740, "time": "2004-12-01T23:37:30Z", "bug_id": 32479, "creation_time": "2004-12-01T23:37:30Z", "tags": [], "text": "I read through some other bug notes (#9011), but did not see a fix for this \nproblem in versions 2.0.43 - 2.0.58 or whether this fix is still in dev.\n\nApache will stop responding to request after a couple of hours.  I'm running 4 \ndifferent/seperate Apache binary installations on this hardware, all running \non individually unique (sometimes multiple) IP addressess under unique install \nlocations.  The hanging server is isolated to one install location and is this \nsame one that stops everytime. All other running servers continue to run fine. \nA graceful or full restart using apachectl clears up the problem.  Please see \nfollowing for compile options and log file entries:\n\nRunning Apache 2.0.42 on AIX 5.2\n\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6\n -D APR_USE_PROC_PTHREAD_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/usr/local/apache/pvt/prod\"\n -D SUEXEC_BIN=\"/usr/local/apache/pvt/prod/bin/suexec\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\nCompiled in modules:\n  core.c\n  mod_access.c\n  mod_auth.c\n  mod_auth_anon.c\n  mod_auth_dbm.c\n  mod_auth_digest.c\n  mod_include.c\n  mod_log_config.c\n  mod_env.c\n  mod_expires.c\n  mod_headers.c\n  mod_setenvif.c\n  worker.c\n  http_core.c\n  mod_mime.c\n  mod_dav.c\n  mod_status.c\n  mod_autoindex.c\n  mod_asis.c\n  mod_info.c\n  mod_cgid.c\n  mod_dav_fs.c\n  mod_vhost_alias.c\n  mod_negotiation.c\n  mod_dir.c\n  mod_imap.c\n  mod_actions.c\n  mod_speling.c\n  mod_userdir.c\n  mod_alias.c\n  mod_rewrite.c\n  mod_so.c\n\n### Section 1: Global Environment\nTimeout 300\nKeepAlive On\nMaxKeepAliveRequests 100\nKeepAliveTimeout 10\n\n<IfModule worker.c>\nServerLimit           32\nStartServers         5\nMaxClients            1024\nMinSpareThreads    160\nMaxSpareThreads   256\nThreadsPerChild     32\nMaxRequestsPerChild 200\nThreadLimit         32\n</IfModule>\n\n$ tail -25 error.log\n[Wed Dec 01 14:52:57 2004] [warn] child process 188190 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:57 2004] [warn] child process 158422 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:58 2004] [warn] child process 226262 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:58 2004] [warn] child process 148218 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:58 2004] [warn] child process 196450 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:58 2004] [warn] child process 188190 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:58 2004] [warn] child process 158422 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:59 2004] [warn] child process 226262 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:59 2004] [warn] child process 148218 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:59 2004] [warn] child process 196450 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:59 2004] [warn] child process 188190 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:52:59 2004] [warn] child process 158422 still did not exit, \nsending a SIGTERM\n[Wed Dec 01 14:53:02 2004] [crit] the listener thread didn't exit\n[Wed Dec 01 14:53:02 2004] [crit] the listener thread didn't exit\n[Wed Dec 01 14:53:02 2004] [crit] the listener thread didn't exit\n[Wed Dec 01 14:53:02 2004] [crit] the listener thread didn't exit\n[Wed Dec 01 14:53:02 2004] [crit] the listener thread didn't exit\n[Wed Dec 01 14:53:02 2004] [crit] the listener thread didn't exit\n[Wed Dec 01 14:53:02 2004] [crit] the listener thread didn't exit\n[Wed Dec 01 14:53:02 2004] [crit] the listener thread didn't exit\n[Wed Dec 01 14:53:03 2004] [notice] SIGHUP received.  Attempting to restart  \n<< This is where I did a full web server restart  >>\n\n\n[Wed Dec 01 14:53:03 2004] [notice] Digest: generating secret for digest \nauthentication ...\n[Wed Dec 01 14:53:03 2004] [notice] Digest: done\n[Wed Dec 01 14:53:03 2004] [notice] Apache/2.0.42 (Unix) DAV/2 configured -- \nresuming normal operations\n[Wed Dec 01 14:53:03 2004] [notice] child pid 192162 exit signal Segmentation \nfault (11)"}, {"count": 1, "tags": [], "bug_id": 32479, "text": "There are bugs fixed since 2.0.42 which cause all manner of symptoms, and I\nwould encourage you to upgrade.  Note also that you're getting a crash in\naddition to the hang, but there is no reason to waste any time diagnosing a\nsegfault on that level of code.\n\nRegarding the hang:\n\nOf particular concern to users of Apache on AIX 5.2 is a vulnerability which was\nresolved in 2.0.49 and which could cause a hang.  It is configuration-specific\nso it could easily affect some Apache instances but not others.  Note also that\nAIX 5.2 APAR IY46214 corrects a problem which could result in a web server hang.\n\nWhen Apache hangs again, you can run the script at\n  http://www.apache.org/~trawick/aixthrdbt.pl\nto get backtraces of all the threads, and tar up the resulting files and attach\nto this PR.\n\nAs root (assuming you start Apache as root):\n  ./aixthrdbt.pl -p PARENTPID\nwhere PARENTPID is the process id of the parent of this Apache instance (from\nlogs/httpd.pid or your PidFile).  dbx must be installed for this to work\n(normally it is installed, but some folks omit that fileset).\nThis will create a bunch of files called \"backtraces.nnn\" in the current directory.", "id": 67746, "time": "2004-12-02T00:29:51Z", "creator": "trawick@apache.org", "creation_time": "2004-12-02T00:29:51Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 32479, "is_private": false, "id": 67817, "time": "2004-12-02T20:45:06Z", "creator": "bruce.nolan@pbsg.com", "creation_time": "2004-12-02T20:45:06Z", "tags": [], "text": "Server hung again this morning. Here is a list of the running proccessess at \nthe time of the hang\n\nroot   109646 1        0 21:01:01 \nnobody 158426 109646   0 21:01:01 \nnobody 166522 109646   0 21:01:01 \nnobody 174000 109646   0 21:01:01  \nnobody 188202 109646   0 21:01:01   \nnobody 194726 109646   0 21:01:01\nnobody 197150 109646   0 21:01:01\nnobody 200108 109646   0 11:08:22\n\nHere is the output of the backtrace.  I ran the trace against the parent PID \nand all of the child procs:\n\ndbx: fatal error: 1283-013 could not attach to pid 109646\ndbx: fatal error: 1283-013 could not attach to pid 158426\ndbx: fatal error: 1283-013 could not attach to pid 166522\ndbx: fatal error: 1283-013 could not attach to pid 174000\ndbx: fatal error: 1283-013 could not attach to pid 188202\ndbx: fatal error: 1283-013 could not attach to pid 194726\ndbx: fatal error: 1283-013 could not attach to pid 197150\ndbx: fatal error: 1283-013 could not attach to pid 200108\ndbx: fatal error: 1283-013 could not attach to pid 206574"}, {"count": 3, "tags": [], "bug_id": 32479, "attachment_id": 13627, "id": 67819, "time": "2004-12-02T20:58:16Z", "creator": "bruce.nolan@pbsg.com", "creation_time": "2004-12-02T20:58:16Z", "is_private": false, "text": "Created attachment 13627\nApache backtraces for parent PID\n\nRan the previous backtrace incorrectly."}, {"count": 4, "tags": [], "creator": "trawick@apache.org", "is_private": false, "id": 67821, "attachment_id": null, "bug_id": 32479, "creation_time": "2004-12-02T21:37:56Z", "time": "2004-12-02T21:37:56Z", "text": "It won't accept new connections because of an issue with the accept mutex.  I\nnoticed that the listener threads in processes which aren't trying to exit are\nall waiting on the accept mutex, and nobody owns it.  Furthermore, the mutex\ntype is \"AcceptMutex pthread.\"  \n\n\"AcceptMutex pthread\" isn't the default for your build, is it?  Did you code\n\"AcceptMutex pthread\" in your conf file?  If so, what problem was that intended\nto resolve?\n\nAre there any \"exit signal\" messages in your error log from child process crashes?\n"}, {"count": 5, "tags": [], "bug_id": 32479, "text": "Yes.  There are multiple exit signal messages in the error log file. I checked \nmy httpd.conf file and I have coded AcceptMutex into the file ", "id": 68249, "time": "2004-12-10T17:23:24Z", "creator": "bruce.nolan@pbsg.com", "creation_time": "2004-12-10T17:23:24Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 32479, "is_private": false, "id": 68251, "time": "2004-12-10T17:25:28Z", "creator": "bruce.nolan@pbsg.com", "creation_time": "2004-12-10T17:25:28Z", "tags": [], "text": "Here's the output of httpd -V\n\nServer version: Apache/2.0.48\nServer built:   Nov  9 2004 16:30:10\nServer's Module Magic Number: 20020903:4\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_PROC_PTHREAD_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/usr/local/apache/pvt/prod4\"\n -D SUEXEC_BIN=\"/usr/local/apache/pvt/prod4/bin/suexec\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\""}, {"count": 7, "tags": [], "text": "hmmm, on all known platforms, pthread mutex for accept mutex is bad news if\nthere are unresolved causes of child process crashes since a child process crash\ncan result in a web server hang...  (hang won't occur every time the crash occurs)\n\nif you add \"AcceptMutex sysvsem\" to httpd.conf and restart, child process\ncrashes should no longer cause a hang...\n\nwith the hang hopefully resolved, see if you can get coredump/backtrace for the\ncrash symptom...\n\nare you now using 2.0.48 instead of 2.0.42?\n", "is_private": false, "id": 68255, "creator": "trawick@apache.org", "time": "2004-12-10T17:48:07Z", "bug_id": 32479, "creation_time": "2004-12-10T17:48:07Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 32479, "text": "We have a similar problem with Apache 2.0.52 on AIX5.2. Apache 2.0.52 hangs on\ndifferent times. When Apache begins to give errors we get following errors on\nthe AIX system and restarting Apache do not solve the problem.\n------------------------------------------------------------------------\n# dig a a.domain.name\nnet.c:83: socket() failed: There is not enough buffer space for the requested so\ncket operation.\nnet.c:83: socket() failed: There is not enough buffer space for the requested so\ncket operation.\ndig: can't find either v4 or v6 networking\n# no -a | less\n0821-055 no: Cannot create a socket. The error number is 74.\n------------------------------------------------------------------------\nApache server is compiled with:\n\nServer version: Apache/2.0.52\nServer built:   Dec 23 2004 16:08:21\nServer's Module Magic Number: 20020903:9\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/usr/local/apache\"\n -D SUEXEC_BIN=\"/usr/local/apache/bin/suexec\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n---------------------------------------------------------------------------\nOur environments are:\n\n<IfModule worker.c>\nServerLimit         50\nStartServers        10\nMaxClients        1000\nMinSpareThreads     75\nMaxSpareThreads    150\nThreadsPerChild     25\nMaxRequestsPerChild  0\n</IfModule>\n----------------------------------------------------------------------------\nWhen the system and and Apache hangs on the following logs are seen in the\nerror_log.\n\n[Sat Aug 21 00:26:39 2004] [error] [client x.x.x.x] (74)No buffer space\navailable: unable to create socket to cgi daemon:\n/usr/local/apache/cgi-bin/sozluk/turing/sozluk, referer: ...\n[Sat Aug 21 00:26:46 2004] [error] [client x.x.x.x] (74)No buffer space\navailable: unable to create socket to cgi daemon:\n/usr/local/apache/cgi-bin/sozluk/turing/sozluk, referer: ...\n[Sat Aug 21 00:28:08 2004] [error] [client x.x.x.x] (74)No buffer space\navailable: unable to create socket to cgi daemon:\n/usr/local/apache/cgi-bin/sozluk/turing/sozluk, referer: ...\n[Sat Aug 21 00:30:58 2004] [error] [client x.x.x.x] (74)No buffer space\navailable: unable to create socket to cgi daemon:\n/usr/local/apache/cgi-bin/sozluk/turing/sozluk, referer: ...\n[Sat Aug 21 02:32:59 2004] [error] [client x.x.x.x] (74)No buffer space\navailable: unable to create socket to cgi daemon:\n/usr/local/apache/cgi-bin/formmail.pl, referer: ...\n[Thu Nov 04 13:19:12 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Fri Nov 19 22:04:07 2004] [error] [client x.x.x.x] (74)No buffer space\navailable: unable to create socket to cgi daemon:\n/usr/local/apache/cgi-bin/ftp/ftpcc, referer: ...\n[Wed Dec 08 14:57:55 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:14 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:15 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:16 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:17 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:18 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:19 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:20 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:21 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:22 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:23 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:23 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Thu Dec 16 15:17:25 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Fri Dec 24 13:42:30 2004] [error] (74)No buffer space available: Couldn't\ncreate unix domain socket\n[Mon Jan 03 11:34:38 2005] [error] [client x.x.x.x] (74)No buffer space\navailable: unable to create socket to cgi daemon:\n/usr/local/apache/cgi-bin/sozluk/turing/sozluk\n\n[Mon Jan 03 15:01:57 2005] [notice] Apache configured -- resuming normal operations\n[Mon Jan 03 15:01:57 2005] [info] Server built: Dec 23 2004 16:08:21\n[Mon Jan 03 15:01:57 2005] [debug] worker.c(1631): AcceptMutex: sysvsem\n(default: sysvsem)\n\n---------------------------------------------------------------------------\nwhen apache hangs on, a core file is not created or we can not find any\nsegmentation fault line in error logs.\n\nyours,\n\nfeyza", "id": 69150, "time": "2005-01-03T15:12:05Z", "creator": "taskazan@metu.edu.tr", "creation_time": "2005-01-03T15:12:05Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 32479, "text": ">(74)No buffer space available:\nWhat is happening is that there is not enough of a certain type of kernel memory\nto perform common TCP/IP-related operations, so various applications can fail.\n\nThe most likely cause of this is:\n\na) your network buffer cache maximum size is too large for the amount of memory\non your system\nand\nb) you are sending a wide variety of static files with Apache such that a large\namount of memory gets used by the network buffer cache\n\nThe quick fix is to do both of these steps:\n\na) get Apache to stop using network buffer cache by adding \"EnableSendfile Off\"\nin httpd.conf, then restart Apache\nb) empty the network buffer cache to relieve the memory problem, which will\ncontinue even after restarting Apache since the network buffer cache won't be\ncleared automatically; empty the cache by running \"no -o nbc_limit=0\"\nAfter clearing the cache, if you still have that type of problem (\"No buffer\nspace available\") you may have to reboot the system to recover.  (I'd like to\nhear if clearing the cache didn't resolve the problem.)  The current cache usage\ncan be displayed via \"netstat -c\".\n\nA more permanent solution:\n\nAfter you've determined that the above change resolves the problem permanently,\nthere is still a potential problem on your system: the default network buffer\ncache size for your system is too large, so that if any application (whether or\nnot Apache) fully utilizes the cache you'll hit the same problem again.  You can\npermanently avoid such issues by adding \"no -o nbc_limit=0\" to a startup script,\nor you can specify a relatively small cache size (e.g., 100MB) and get Apache to\nuse sendfile again by commenting out your \"EnableSendfile Off\" directive and\nrestarting Apache, then see if that small cache size is safe.", "id": 69153, "time": "2005-01-03T16:08:55Z", "creator": "trawick@apache.org", "creation_time": "2005-01-03T16:08:55Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 32479, "is_private": false, "count": 10, "id": 75826, "time": "2005-06-02T23:54:15Z", "creator": "chip@force-elite.com", "creation_time": "2005-06-02T23:54:15Z", "text": "Resolving: Seems to be a local OS configuration issue."}, {"count": 11, "tags": [], "creator": "taskazan@metu.edu.tr", "text": "*** Bug 37961 has been marked as a duplicate of this bug. ***", "id": 83878, "attachment_id": null, "bug_id": 32479, "creation_time": "2005-12-21T09:26:22Z", "time": "2005-12-21T09:26:22Z", "is_private": false}]
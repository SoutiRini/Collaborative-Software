[{"attachment_id": null, "tags": [], "bug_id": 46038, "text": "Attached is a contribution of an alternate connection pool to Tomcat.\nIt includes documentation as well.\n\nI would suggest this connection pool would\na) replace the default connection pool in tomcat-trunk\nb) ship as an alternate connection pool in tomcat-6.0.x\n\nReasons for contribution:\nThe reasons for this new implementation are documented in jdbc-pool.xml\n\nMain reasons are:\na) JDK independent. you wont get a NoSuchMethodException running the pool with the new java.sql.* apis in JDK 1.7 even though the it is compiled with 1.5\n\nb) support for highly concurrent environment (performance). On average it is between 2 to 10 times faster than commons-dbcp\n\nc) simplicity - the core pool is 8 classes to maintain, compared to 60+ with other implementations\n\nd) flexibility - can easily be extended, also has a pluggable interceptor framework that lets you plug in custom components to control pool behavior.\n\ne) Maintainable - part of Tomcat core, so simple that anyone can maintain it. Easier to maintain 8 classes, than have to rewrite 60+ to get another pool to perform and provide same feature set.\n\nBuild from source\nsvn co --username yjp --password yjp123 http://svn.hanik.com/svn/repos/filip/dbcp\ncd dbcp/build\nant\n\n\nPerformance numbers\nfhanik@solaris-devx 08:38:36: /development/filip/dbcp/build$ JAVA5\nfhanik@solaris-devx 08:38:36: /development/filip/dbcp/build$ ant run\nBuildfile: build.xml\n\nrun:\n     [java] JUnit version 4.3.1\n     [java] .[testDBCPThreads10Connections10]Test complete:9057 ms. Iterations:1000000\n     [java] .[testPoolThreads10Connections10]Test complete:2015 ms. Iterations:1000000\n     [java] .[testDBCPThreads20Connections10]Test complete:15332 ms. Iterations:2000000\n     [java] .[testPoolThreads20Connections10]Test complete:4463 ms. Iterations:2000000\n     [java] .[testDBCPThreads10Connections10Validate]Test complete:19765 ms. Iterations:1000000\n     [java] .[testPoolThreads10Connections10Validate]Test complete:2049 ms. Iterations:1000000\n     [java] .[testDBCPThreads20Connections10Validate]Test complete:43135 ms. Iterations:2000000\n     [java] .[testPoolThreads20Connections10Validate]Test complete:4639 ms. Iterations:2000000\n     [java]\n     [java] Time: 101.495\n     [java]\n     [java] OK (8 tests)\n     [java]\n\nBUILD SUCCESSFUL\nTotal time: 1 minute 41 seconds\nfhanik@solaris-devx 08:40:22: /development/filip/dbcp/build$ JAVA6\nfhanik@solaris-devx 08:40:28: /development/filip/dbcp/build$ ant run\nBuildfile: build.xml\n\nrun:\n     [java] JUnit version 4.3.1\n     [java] .[testDBCPThreads10Connections10]Test complete:2400 ms. Iterations:1000000\n     [java] .[testPoolThreads10Connections10]Test complete:1919 ms. Iterations:1000000\n     [java] .[testDBCPThreads20Connections10]Test complete:5570 ms. Iterations:2000000\n     [java] .[testPoolThreads20Connections10]Test complete:4109 ms. Iterations:2000000\n     [java] .[testDBCPThreads10Connections10Validate]Test complete:15986 ms. Iterations:1000000\n     [java] .[testPoolThreads10Connections10Validate]Test complete:2025 ms. Iterations:1000000\n     [java] .[testDBCPThreads20Connections10Validate]Test complete:38999 ms. Iterations:2000000\n     [java] .[testPoolThreads20Connections10Validate]Test complete:4336 ms. Iterations:2000000\n     [java]\n     [java] Time: 76.391\n     [java]\n     [java] OK (8 tests)\n     [java]\n\nBUILD SUCCESSFUL\nTotal time: 1 minute 16 seconds\nfhanik@solaris-devx 08:41:46: /development/filip/dbcp/build$", "count": 0, "id": 121680, "time": "2008-10-19T07:56:03Z", "creator": "fhanik@apache.org", "creation_time": "2008-10-19T07:56:03Z", "is_private": false}, {"attachment_id": 22756, "tags": [], "bug_id": 46038, "is_private": false, "count": 1, "id": 121681, "time": "2008-10-19T07:57:23Z", "creator": "fhanik@apache.org", "creation_time": "2008-10-19T07:57:23Z", "text": "Created attachment 22756\ncompiled version, source and test cases"}, {"count": 2, "tags": [], "bug_id": 46038, "attachment_id": 22757, "text": "Created attachment 22757\ndocumentation", "id": 121682, "time": "2008-10-19T07:58:16Z", "creator": "fhanik@apache.org", "creation_time": "2008-10-19T07:58:16Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 46038, "attachment_id": null, "is_private": false, "id": 121683, "time": "2008-10-19T08:00:40Z", "creator": "fhanik@apache.org", "creation_time": "2008-10-19T08:00:40Z", "text": "To migrate from commons-dbcp/tomcat-dbcp to this new pool requires a single attribute change - factory - in the resource element.\n\nAll the other attributes are identical. Making it easy to switch to and back."}, {"count": 4, "tags": [], "creator": "fhanik@apache.org", "attachment_id": null, "id": 122419, "time": "2008-11-12T17:32:21Z", "bug_id": 46038, "creation_time": "2008-11-12T17:32:21Z", "is_private": false, "text": "Completed and contributed as a module"}, {"attachment_id": null, "tags": [], "bug_id": 46038, "is_private": false, "count": 5, "id": 130170, "time": "2009-09-06T17:42:13Z", "creator": "phil@steitz.com", "creation_time": "2009-09-06T17:42:13Z", "text": "What versions of commons dbcp and pool were used in the microbenchmarks?  Comments in the doc indicating that dbcp locks the pool on validate, etc., would indicate you must be referring to pool 1.3.  As of pool 1.4, this is not true.  Is the source for the benchmarks available anywhere?"}, {"count": 6, "tags": [], "bug_id": 46038, "attachment_id": null, "text": "(In reply to comment #5)\n> What versions of commons dbcp and pool were used in the microbenchmarks? \n> Comments in the doc indicating that dbcp locks the pool on validate, etc.,\n> would indicate you must be referring to pool 1.3.  As of pool 1.4, this is not\n> true.  Is the source for the benchmarks available anywhere?\n\nDBCP 1.4 while solving the validation bottleneck, introduces a new set of performance reducing code, and handles worse than 1.3.\n\n  svn co http://svn.apache.org/repos/asf/tomcat/trunk/modules/jdbc-pool\n  cd jdbc-pool\n  ant test", "id": 134909, "time": "2010-02-25T21:51:49Z", "creator": "fhanik@apache.org", "creation_time": "2010-02-25T21:51:49Z", "is_private": false}]
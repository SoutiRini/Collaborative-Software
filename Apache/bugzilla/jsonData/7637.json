[{"count": 0, "tags": [], "bug_id": 7637, "is_private": false, "id": 12555, "creation_time": "2002-03-30T23:00:56Z", "time": "2002-03-30T23:00:56Z", "creator": "paults@powerup.com.au", "text": "I am running Win2K with SP2 applied and the latest version of MDAC (2.7). When \nI run a test page that connects to a database, does a query and outputs the \nresults, the page is displayed with the correct results but I then receive the \nmessage \"The instruction at '0x1f9c6bce' referenced memory at '0x1f9c6bce'. The \nmemory could not be 'read' (This is a java.exe application error). Following \nthis Tomcat terminates. Exactly the same code can be put into a java class and \nrun from command line without any problems. If the class is called from a JSP \nrun by Tomcat, the same error occurs.\nDatabase:SQLServer2000 and Access2000\n\nMicrosoft standard ODBC drivers used\nSQLSRV32.DLL Version 2000.81.7713.00\nODBCJT32.DLL Version 4.00.6019.00\nAll MDAC components have been tested using the Microsoft ComCheck.exe component \nchecker. All tested as being OK with no conflicts.\nBrowser is Microsoft IE6.0\n\nHave been using JDK1.2.2 to allow jk_nt_service.exe to work correctly but same \nissue occurs with JDK1.4.\n\nEventviewer does not give any other information than the above error.\n\nThe following is tha java class that does the connection and queries:\n\nimport java.sql.*;\n\npublic class FruitConnect {\n\n   private Driver drv = null;\n   private Connection conn = null;\n   private ResultSet rs = null;\n   private Statement stmt = null;\n\n\n   public FruitConnect(){}\n\n   public void dbConnect() throws Exception{\n      drv = (Driver) Class.forName(\"sun.jdbc.odbc.JdbcOdbcDriver\").newInstance\n();\n      conn = DriverManager.getConnection\n(\"jdbc:odbc:Fruit\",\"fruit_login\",\"fruit_login\");\n   }\n\n   public boolean getNextItem() throws Exception{\n      boolean ret = rs.next();\n      return(ret);\n   }\n\n   public String getItemNameString(String columnName) throws Exception{\n      String name = rs.getString(columnName);\n      return(name);\n   }\n\n   public float getItemNameFloat(String columnName) throws Exception{\n      float name = rs.getFloat(columnName);\n      return(name);\n   }\n\n   public boolean selectFruits() throws Exception{\n      String query = \"SELECT Id, Name FROM Fruit\";\n      stmt = conn.createStatement();\n      rs = stmt.executeQuery(query);\n      boolean ret = false;\n      if (rs != null)\n         ret = true;\n      return(ret);\n   }\n\n   public boolean selectMonths() throws Exception{\n      String query = \"SELECT Id, Name FROM Month\";\n      stmt = conn.createStatement();\n      rs = stmt.executeQuery(query);\n      boolean ret = false;\n      if (rs != null)\n         ret = true;\n      return(ret);\n   }\n\n   public boolean selectFruitForSale() throws Exception{\n      String query = \"SELECT F.Name AS Fruit, M.Name AS Month, Price, Weight, \n(Price * Weight) AS TotalPrice FROM FruitMonth AS FM, Fruit AS F, Month AS M \nWHERE FM.FruitId = F.Id AND FM.MonthId = M.Id ORDER BY M.Id\";\n      stmt = conn.createStatement();\n      rs = stmt.executeQuery(query);\n      boolean ret = false;\n      if (rs != null)\n         ret = true;\n      return(ret);\n   }\n\n   public int insertFruit(String name) throws Exception{\n      String query = \"INSERT INTO Fruit (Name) VALUES ('\" + name + \"')\";\n      stmt = conn.createStatement();\n      int ret = stmt.executeUpdate(query);\n      return(ret);\n   }\n\n   public int insertFruitForSale(String insertValues) throws Exception{\n      String query = \"INSERT INTO FruitMonth (FruitId, MonthId, Price, Weight) \nVALUES (\" + insertValues + \")\";\n      stmt = conn.createStatement();\n      int ret = stmt.executeUpdate(query);\n      return(ret);\n   }\n\n   public int deleteFruit(String fruitList) throws Exception{\n      String query = \"DELETE FROM Fruit WHERE Name IN (\" + fruitList + \")\";\n      stmt = conn.createStatement();\n      int ret = stmt.executeUpdate(query);\n      return(ret);\n   }\n\n   public void dbDisconnect() throws Exception{\n      stmt.close();\n      conn.close();\n   }\n\n}\n\nThe following is the JSP that calls the class:\n\n   <%@ page import=\"java.sql.*\" %>\n   <jsp:include page=\"adminHeader.html\" flush=\"true\" />\n\n   <div align=\"center\">\n   <table border=\"1\" cellspacing=\"2\" cellspacing=\"2\" width=\"150\">\n   <tr>\n     <th>Fruit</th>\n   </tr>\n\n   <% FruitConnect fruitConnect = new FruitConnect(); %>\n   <%\n   int counter = 0;\n   String bgColor = \"\";\n   String mode = request.getParameter(\"mode\");\n   if ( mode == null )\n   mode = \"view\";\n\n   fruitConnect.dbConnect();\n   if (fruitConnect.selectFruits()) {\n   while (fruitConnect.getNextItem()) {\n   //alternate the background color of the rows for readability\n     if ((counter % 2) == 0){\n       bgColor = \"#6464FF\"; \n     } else {\n       bgColor = \"#FFFFFF\";\n     } \n     String fruitName = fruitConnect.getItemNameString(\"Name\");\n     %>\n     \n     <form method=\"post\" action=\"delFruit.jsp\">\n     <tr bgcolor=\"<%= bgColor %>\">\n       <td align=\"left\">\n         <% if (mode.equals(\"delete\")) {%>\n           <input type=\"checkbox\" name=\"delFruit\" value=\"<%=fruitName %>\">\n         <% } %>\n         <%= fruitName %>\n       </td>\n     </tr>\n\n     <%\n\n   counter = counter + 1;\n   }\n     \n   if (mode.equals(\"delete\")) {\n   %>\n     <tr>\n       <td><input type=\"submit\" name=\"submit\" value=\"Delete Checked\n   Fruit\"></td>\n     </tr>\n   <% \n   }\n   }\n   fruitConnect.dbDisconnect();\n   %>\n   </form>\n   </table>\n   </div>\n   <jsp:include page=\"adminFooter.html\" flush=\"true\" />\n\nThe same class can be called from command line without problem using a simple \nstub.", "attachment_id": null}, {"count": 1, "tags": [], "creator": "hgomez@slib.fr", "attachment_id": null, "text": "This is a jvm error, and have nothing to do with tomcat.\nTry to get an updated JDK", "id": 18336, "time": "2002-06-21T16:01:42Z", "bug_id": 7637, "creation_time": "2002-06-21T16:01:42Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 50721, "attachment_id": null, "id": 143996, "time": "2011-02-04T20:42:49Z", "creator": "mach@zhaw.ch", "creation_time": "2011-02-04T20:42:49Z", "is_private": false, "text": "When calling org.apache.catalina.util.RequestUtil.URLDecode() for a valid URL ending with a %xx-Code, the method throws the IllegalArgumentException \"The % character must be followed by two hexademical digits\".\nThis only happens, if the %xx-Code is at the  at the end of the URL. It works fine for URLs ending with normal characters.\nExample:\nRequestUtil.URLDecode(\"http://localhost:8080/webdav/test%C3%A4\", \"UTF8\") fails\nRequestUtil.URLDecode(\"http://localhost:8080/webdav/test%C3%A4n\", \"UTF8\") works fine\n\nThe problem is with the the test in line 329 (added in revision: 905073):\nif (ix + 2 >= len) {\n\nBecause the index ix is already incremented in line 325, after reading the current byte b (e.g. the %-character), this test fails if \"%A4\" is at the end, but does not fail for \"%A4n\".\n\nSimple fix: In line 329 the '>=' should be replaced by a '>':\nif (ix + 2 > len) {\n\nThis change should have no side effects, because ix is checked again before the next iteration.\nBecause this change is trivial I did not include a patch.\n\nBest regards\nChristof"}, {"count": 1, "tags": [], "text": "Thanks for the report. This has been fixed in 7.0.x and will be in 7.0.9 onwards.", "is_private": false, "id": 144117, "creator": "markt@apache.org", "time": "2011-02-09T18:42:43Z", "bug_id": 50721, "creation_time": "2011-02-09T18:42:43Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "eric@vdmaarel.nl", "text": "Created attachment 27955\npatch of  poll/unix/select.c\n\nIn Windows XP select is used in socket polling. The present poll implementation based on select() has no way to set the POLLHUP and/or POLLERR flags in a poll return event. As noted in\nhttp://mail-archives.apache.org/mod_mbox/apr-dev/201105.mbox/ajax/%3C4DC12E28.8010402%40nedap.com%3E\nthe Comet functionality in the Tomcat Native project based on apr, depends on receiving those return values when a client 'unexpectedly' disconnects. When that doesn't happen the result is a 100% CPU when the last client disconnects. As such we find that to happen on Windows XP.\n\nSo, I propose a patch here that uses the recv() function to peek at the fd when it has been found to be ready for read. In the case a connection has been gracefully closed the result == 0 and the APR_POLLHUP flag is set in the return event. When the result < 0 there must be an error and the APR_POLLERR flag is set.\n\nThis peeking is added to impl_pollset_poll() and apr_poll().", "id": 151559, "time": "2011-11-16T15:30:50Z", "bug_id": 52198, "creation_time": "2011-11-16T15:30:50Z", "is_private": false, "attachment_id": 27955}]
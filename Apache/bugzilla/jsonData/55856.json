[{"count": 0, "attachment_id": 31101, "bug_id": 55856, "text": "Created attachment 31101\nThe Patch\n\nIn server/util_expr_parse.c there is a bug in the handling of yytoken when yytoken is equal to YYEMPTY. YYEMPTY is set to -2. The only place this function, yysyntax_error, is used is in yyparse's section for yyerrlab. In yyerrlab, yytoken is set as:\n\n    yytoken = yychar == YYEMPTY ? YYEMPTY : YYTRANSLATE (yychar);\n\nClearly, when yysyntax_error is called yytoken may be YYEMPTY. When yytnamerr is called with the value of yytname[yytoken], it is undefined what will happen.\n\nI have included the patch I think needs to be made below. I'm not completely sure, however, of this fix. Regardless, this is a bug.\n\n----- patch -----\n\nIndex: server/util_expr_parse.c\n===================================================================\n--- server/util_expr_parse.c\t(revision 1548995)\n+++ server/util_expr_parse.c\t(working copy)\n@@ -1054,7 +1054,8 @@\n yysyntax_error (YYSIZE_T *yymsg_alloc, char **yymsg,\n                 yytype_int16 *yyssp, int yytoken)\n {\n-  YYSIZE_T yysize0 = yytnamerr (YY_NULL, yytname[yytoken]);\n+  YYSIZE_T yysize0 = yytoken == YYEMPTY\n+    ? 0 : yytnamerr (YY_NULL, yytname[yytoken]);\n   YYSIZE_T yysize = yysize0;\n   enum { YYERROR_VERBOSE_ARGS_MAXIMUM = 5 };\n   /* Internationalized format string. */", "id": 171632, "time": "2013-12-08T06:56:02Z", "creator": "jaredlwong@gmail.com", "creation_time": "2013-12-08T06:56:02Z", "tags": [], "is_private": false}]
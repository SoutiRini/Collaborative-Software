[{"count": 0, "tags": [], "text": "The <sql:setDataSource> doesn't allow the definition of a scoped configuration\ndata source, i.e., a <sql:setDataSource> with attribute scope but without\natribute var.\n\nI think the specification allows that (sorry if I misunderstood the\nspecification :), according to the definition of the scope atribute on section 10.6:\n\nIf var is specified, scope of the exported variable. Otherwise, scope of the\ndata source configuration variable.\n\n\n\nThe reason it doesn't work is that the JstlSqlTLV.java checks for dangling\nscope, as changed in the bug below:\n\n\nhttp://cvs.apache.org/viewcvs/jakarta-taglibs/standard/src/org/apache/taglibs/standard/tlv/JstlSqlTLV.java.diff?r1=1.6&r2=1.7\n\nThe fix is pretty simple, it's only a matter of adding an exception for the\ndangling rule to the setDataSource tag, as shown below:\n\n\n[felipeal@localhost]/usr/local/java/jakarta-taglibs-src/standard-1.0.3/src/org/apache/taglibs/standard/tlv:\ndiff -u JstlSqlTLV.java JstlSqlTLV-patched.java\n--- JstlSqlTLV.java     2003-05-23 16:47:41.000000000 -0300\n+++ JstlSqlTLV-patched.java     2003-05-23 16:47:30.000000000 -0300\n@@ -155,7 +155,8 @@\n                     SCOPE, qn, a.getValue(SCOPE)));\n            if (qn.startsWith(prefix + \":\") && hasEmptyVar(a))\n                fail(Resources.getMessage(\"TLV_EMPTY_VAR\", qn));\n-           if (qn.startsWith(prefix + \":\") && hasDanglingScope(a))\n+\n+           if (qn.startsWith(prefix + \":\") && hasDanglingScope(a) &&\n!qn.startsWith(prefix + \":\" + SETDATASOURCE))\n                fail(Resources.getMessage(\"TLV_DANGLING_SCOPE\", qn));\n\n            // now, modify state\n\n\n\nRegards,\n\nFelipe", "attachment_id": null, "bug_id": 20197, "id": 37687, "time": "2003-05-23T20:01:38Z", "creator": "t5jtjj502@sneakemail.com", "creation_time": "2003-05-23T20:01:38Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 20197, "attachment_id": null, "id": 37688, "time": "2003-05-23T20:52:56Z", "creator": "t5jtjj502@sneakemail.com", "creation_time": "2003-05-23T20:52:56Z", "is_private": false, "text": "I forgot to mention, but it looks like the code's logic already handle what the\nspecifications says, the problem is really the TLV:\n\nSetDataSourceTagSupport.java, method doStartTag:\n\n\n        if (var != null) {\n\t    pageContext.setAttribute(var, ds, scope);\n        } else {\n            Config.set(pageContext, Config.SQL_DATA_SOURCE, ds, scope);\n        }\n"}, {"attachment_id": null, "tags": [], "creator": "pierre.delisle@sun.com", "text": "Thanks for the report and the patch. This is now fixed.", "count": 2, "id": 37881, "time": "2003-05-28T00:32:17Z", "bug_id": 20197, "creation_time": "2003-05-28T00:32:17Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "marco.walther@sun.com", "attachment_id": 26764, "text": "Created attachment 26764\nmod_rewrite additional debug logs\n\nIt looks like a thread acquires the lock, sends a request line to the map program and `disappears'??\n\nThe next thread acquires the lock (?) sends it's request line and reads the response from the previous request:-(\n\nAfter that, the synchronisation is broken:-(\n\nI added a couple of debug prints to mod_rewrite (diff attached) and they generated the following log (after about two days of running fine:-()\n\n-------------------------------------------------------------\nii.247 - - [10/Mar/2011:10:02:27 +0000] usersguide.bd/sid#81f8778rid#9381588/initial (1) mw before lookup_map_program(http://ih/api;usersguide) thread= 0x00000014\nii.247 - - [10/Mar/2011:10:02:27 +0000] usersguide.bd/sid#81f8778rid#9381588/initial (1) mw lookup_map_program thread= 0x00000014 aquire_lock\nii.247 - - [10/Mar/2011:10:02:28 +0000] versioncontrol.bd/sid#81f8778rid#98d7060/initial (1) mw before lookup_map_program(http://ih/api;versioncontrol) thread= 0x00000009\nii.247 - - [10/Mar/2011:10:02:28 +0000] versioncontrol.bd/sid#81f8778rid#98d7060/initial (1) mw lookup_map_program thread= 0x00000009 aquire_lock\nii.247 - - [10/Mar/2011:10:02:28 +0000] versioncontrol.bd/sid#81f8778rid#98d7060/initial (1) mw lookup_map_program thread= 0x00000009 release_lock\nii.247 - - [10/Mar/2011:10:02:28 +0000] versioncontrol.bd/sid#81f8778rid#98d7060/initial (1) mw after lookup_map_program(http://ih/api;versioncontrol)= /projects/usersguide/content thread= 0x00000009\nii.247 - - [10/Mar/2011:10:02:28 +0000] versioncontrol.bd/sid#81f8778rid#98d7060/initial (1) go-ahead with proxy request proxy:balancer://ch/projects/usersguide/content/subversion/teepee/svnclientadapter.html [OK]\n\nThread 0x14 acquires the lock but somehow 0x09 can acquire the lock as well and gets the line actually intended for 0x14. It looks like 0x14 never finishes that request. It's later showing up with other requests. But after this, the results are off by one line.", "id": 144939, "time": "2011-03-11T12:13:36Z", "bug_id": 50916, "creation_time": "2011-03-11T12:13:36Z", "is_private": false}, {"count": 1, "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "is_private": false, "id": 145655, "time": "2011-04-08T15:45:15Z", "bug_id": 50916, "creation_time": "2011-04-08T15:45:15Z", "text": "Look into the error log, too. Maybe the process with thread 0x00000014 died at that time?"}, {"count": 2, "tags": [], "bug_id": 50916, "text": "I looked in the error log and everywhere. No sign of sudden thread-death:-( so I'm somewhat at a loss there:-(\n\nMy solution :-( to the problem is to send a timestamp along to the mapping helpers and they send it back with their response. So I can read again when I find a response from a previous request.\n\nI would still like to know where those threads go:-(", "id": 145659, "time": "2011-04-08T16:50:07Z", "creator": "marco.walther@sun.com", "creation_time": "2011-04-08T16:50:07Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "Hi, there.\n\nI'm facing the sync problem. I'm also using mod_rewrite with external map program, written in Java.\n\nMy problem rarely happens on my production server, and some days the server is messed up, out of the blue. I'm trying to force the problem to happen again, with no success. I've created a program that starts 65 threads that continuously ask for a random URL on the server in a random ammount of milliseconds, then checks to see if the page matches the expected result. I've create another 25 threads that in a random time kill one of the 65 threads and recreate it, willing to stop the connection abruptly in the middle.\n\nThe program is running for several minutes without issuing the sync error.\n\nDo you guys have any tips on forcing this error to happen consistently, so we could start to understand it?\n\n\nCheers,\nCaioToOn!", "attachment_id": null, "id": 146777, "creation_time": "2011-05-31T19:40:32Z", "time": "2011-05-31T19:40:32Z", "creator": "caio@caiotoon.com", "bug_id": 50916, "is_private": false}]
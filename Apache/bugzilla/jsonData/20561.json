[{"count": 0, "text": "Solaris 9\nApache 2.0.46\nJakarta 4.1.18\nmod_jk2 2.0.2\n\nThere seems to be a limitation on the range of ports you can use for the jk2 \nconnector.  For example port=\"7009\" or port=\"17005\" work in server.xml.\nHowever, high ports such as port=\"58009\" will not.\n\nWhen the port is too high it seems to default to the default value (8009), even \nwhen 8009 isn't even mentioned in server.xml.  Tomcat does start a listener on \nport 58009 and netstat sees it as in a LISTEN state.\n\nWhen the port is \"in range\" the logs are clean.\n\nfrom apache 2.0.46 error.log:\n\n[Fri Jun 06 11:56:47 2003] [error] channelSocket.open() connect failed 127.0.0.1\n:8009 146 Connection refused \n[Fri Jun 06 11:56:47 2003] [error] ajp13.connect() failed ajp13:localhost:58009\n[Fri Jun 06 11:56:47 2003] [error] ajp13.service() failed to connect endpoint er\nrno=146 Connection refused\n[Fri Jun 06 11:56:47 2003] [error] ajp13.service() Error  forwarding ajp13:local\nhost:58009 1 1\n[Fri Jun 06 11:56:47 2003] [error] mod_jk.handler() Error connecting to tomcat 1\n20000\n\n-Eric", "creator": "eric@icky.org", "is_private": false, "id": 38529, "time": "2003-06-06T18:36:43Z", "bug_id": 20561, "creation_time": "2003-06-06T18:36:43Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "creator": "eric@icky.org", "is_private": false, "text": "The TCP port is defined as a 'short' and is limited to 32767\n\nA quick hack was to tweak jakarta-tomcat-connectors-jk2-2.0.2-\nsrc/jk/native2/common/jk_channel_socket.c\n\n$ diff jk_channel_socket.c.old jk_channel_socket.c.new\n\n94c94\n<     short port;\n---\n>     long port;\n110c110\n<                                                short port,\n---\n>                                                long port,\n204c204\n< static int JK_METHOD jk2_channel_socket_resolve(jk_env_t *env, char\n*host, short port,\n---\n> static int JK_METHOD jk2_channel_socket_resolve(jk_env_t *env, char\n*host, long port,\n\nThis is being tested now.  At first glance it appears to work.\n\n-e", "id": 39788, "time": "2003-07-01T19:57:19Z", "bug_id": 20561, "creation_time": "2003-07-01T19:57:19Z", "attachment_id": null}, {"count": 2, "text": "Why go from short to long (8 bytes on some boxes) to hold what can be stored in\n16 bits?  Try \"unsigned short\".", "creator": "trawick@apache.org", "is_private": false, "id": 39790, "time": "2003-07-01T20:06:56Z", "bug_id": 20561, "creation_time": "2003-07-01T20:06:56Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 20561, "text": "Used 'unsigned short' and it still seems to be working fine.  Thanks for the \ntip!\n\n-e", "count": 3, "id": 39791, "time": "2003-07-01T20:22:19Z", "creator": "eric@icky.org", "creation_time": "2003-07-01T20:22:19Z", "is_private": false}, {"count": 4, "tags": [], "text": "Created attachment 7057\n[Patch] for high Unix TCP ports for JK2", "attachment_id": 7057, "id": 39861, "creator": "eric@icky.org", "time": "2003-07-02T15:10:08Z", "bug_id": 20561, "creation_time": "2003-07-02T15:10:08Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 20561, "text": "I attached a proposed patch that seems to be working.  I am using port 48009.\n\nI have never wrote anything for JK2 and I am not familiar with it's inner \nworkings.  But I gave it a try.  Please don't beat me up.  :)\n\n-e", "count": 5, "id": 39865, "time": "2003-07-02T15:12:30Z", "creator": "eric@icky.org", "creation_time": "2003-07-02T15:12:30Z", "is_private": false}, {"count": 6, "tags": [], "text": "Cleaning house...\n\nI have been using the patch I provided for a couple of monthes now.  It works \nfine.  I will close this bug.  Thanks everyone!\n\n-e", "attachment_id": null, "id": 43473, "creator": "eric@icky.org", "time": "2003-08-29T15:57:42Z", "bug_id": 20561, "creation_time": "2003-08-29T15:57:42Z", "is_private": false}]
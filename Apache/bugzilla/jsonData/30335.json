[{"count": 0, "tags": [], "text": "I have a big problem, I have mod_proxy and other server with squid proxy on my \nnetwork because I need mod_clamav virus checking\n \nI have this config\n \nListen 8080 \nProxyRequests On \nProxyVia on\nProxyPreserveHost On \nProxyRemote * http://192.168.1.1:3128 \nClamavMode local \nClamavTmpdir /var/tmp/clamav \nClamavDbdir /home/clamav/share/clamav \nInclude /home/etc/httpd/safepatterns.conf \nClamavSizelimit 100000 \nClamavReloadInterval 3600 \n<Proxy *>  \nOrder Deny,Allow \nSetOutputFilter CLAMAV \n</Proxy>  \n<Location /clamav>  \nSetHandler clamav  \n</Location>  \n\n \nYou note that I use ProxyRemote to send traffic to my squid server the problem \nis that my squid server receives something like\n \n090619793.398 11775 192.168.1.2 TCP_CLIENT_REFRESH_MISS/200 74969 GET \nhttp://www.interactive.net.ec/ - DEFAULT_PARENT/127.0.0.1 text/html\n\n \nWhere 192.168.1.2 is ip address from my web server but not my client ip address \n(192.168.1.32)  then I lose every squid config like control access because my \nclient ip was masquerade to server ip (192.168.1.2). You note in my config file\nI have ProxyPreserveHost On  but doesnt work and my Client host ip always is \nchanged.\n \nPlease help me\n \n \nMauricio", "is_private": false, "id": 61156, "creator": "mlara@novadevices.com", "time": "2004-07-26T23:09:06Z", "bug_id": 30335, "creation_time": "2004-07-26T23:09:06Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 30335, "text": "ProxyPreserveHost preserves the HTTP Host request header, which has nothing to\ndo with the client IP address.\n\nAs far as I know, there is no way to do what you want.  Revealing the IP address\nof forward-proxy clients is generally considered a privacy violation, and is\ntherefore not supported.  If you look at the mod_proxy_http source code, you'll\nsee a section where an X-Forwarded-For header is added to reverse proxy\nrequests.  You can easily modify this to also work on forward proxy requests if\nyou'd like.\n\nOtherwise, you can consider doing the access restrictions on the apache proxy\nrather than the squid proxy.", "id": 61157, "time": "2004-07-26T23:31:26Z", "creator": "slive@apache.org", "creation_time": "2004-07-26T23:31:26Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "tony_clayton@mitel.com", "attachment_id": null, "id": 61495, "time": "2004-08-03T14:02:54Z", "bug_id": 30335, "creation_time": "2004-08-03T14:02:54Z", "is_private": false, "text": "I've attached mod_proxy patches for saving the client IP/port in r->notes to bug\n30195.  I'm not sure if this could help at all."}]
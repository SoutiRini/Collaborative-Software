[{"count": 0, "tags": [], "bug_id": 58635, "is_private": false, "text": "Steps to reproduce this issue:\n1. prepare a simple java agent, named TestJavaAgent\n2. add a break point to the premain method of TestJavaAgent\n3. modify bin/setenv.sh:\nexport JPDA_SUSPEND=y\nexport CATALINA_OPTS=\"$CATALINA_OPTS -javaagent:/path/to/test/java/agent.jar\"\n4. start tomcat in debugging mode: \nbin/catalina.sh jpda run \n\nExpected behavior:\nThe tomcat prompts \"Listening for transport dt_socket at address: 8000\", and when attach a debugger to port 8000, the process stops at the break point in premain method of TestJavaAgent\n\nActual behavior:\nThe premain method of TestJavaAgent has been executed, and then tomcat prompts \"Listening for transport dt_socket at address: 8000\", the process never stopped at the break point in premain method of TestJavaAgent\n\nPutting $JPDA_OPTS before $CATALINA_OPTS will solve this issue:\n\nIndex: bin/catalina.sh\n===================================================================\n--- bin/catalina.sh\t(revision 1715719)\n+++ bin/catalina.sh\t(working copy)\n@@ -279,7 +279,7 @@\n   if [ -z \"$JPDA_OPTS\" ]; then\n     JPDA_OPTS=\"-agentlib:jdwp=transport=$JPDA_TRANSPORT,address=$JPDA_ADDRESS,server=y,suspend=$JPDA_SUSPEND\"\n   fi\n-  CATALINA_OPTS=\"$CATALINA_OPTS $JPDA_OPTS\"\n+  CATALINA_OPTS=\"$JPDA_OPTS $CATALINA_OPTS\"\n   shift\n fi\n\nNote: setting -agentlib=/path/to/agent.jar to JAVA_OPTS won't fix this issue, neither. Because JAVA_OPTS always goes before CATALINA_OPTS.", "id": 186489, "time": "2015-11-23T05:52:46Z", "creator": "huxing.zhang@gmail.com", "creation_time": "2015-11-23T05:52:46Z", "attachment_id": null}, {"count": 1, "text": "Thanks for the report and patch. Do keep in mind when working on scripts that you need to consider the Windows scripts as well.\n\nThis has been fixed in 9.0.x for 9.0.0.M2 onwards, 8.0.x for 8.0.30 onwards, 7.0.x for 7.0.66 onwards and 6.0.x for 6.0.45 onwards.", "bug_id": 58635, "attachment_id": null, "id": 186547, "time": "2015-11-25T14:06:41Z", "creator": "markt@apache.org", "creation_time": "2015-11-25T14:06:41Z", "tags": [], "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 58635, "text": "I've thought about it, but I am too busy to provide such a for patch for windows. Thanks for your quick work. :)\nFrom next time I will consider both cases.", "id": 186570, "time": "2015-11-25T23:54:01Z", "creator": "huxing.zhang@gmail.com", "creation_time": "2015-11-25T23:54:01Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "creator": "rmg@terc.edu", "attachment_id": null, "is_private": false, "id": 86647, "time": "2006-03-09T16:42:36Z", "bug_id": 38910, "creation_time": "2006-03-09T16:42:36Z", "text": "In the default configuration of Apache httpd-2.2.0, filenames printed by\nmod_autoindex are not properly html-escaped. This can inject arbitrary html\ndirectly in the autoindex output, potentially making it unusable for navigation\npurposes. For example:\n\n[build, install, and run httpd-2.2.0]\ncd $PREFIX/htdocs\nmkdir foo\ntouch \"foo/<body onload=alert(1)>\"\n[visit /foo/ in a browser (tested with Firefox)]\n[an alert dialog appears]\n\nEarlier versions of Apache httpd do contain this bug, but are not affected in\ntheir default configurations. The difference is that versions prior to 2.2.0\nhave \"IndexOptions FancyIndexing\" enabled in the default httpd.conf, so a\ndifferent code path is used to display the filenames.\n\nHere's a patch against 2.2.0 (and probably applicable to earlier versions) which\nadds the necessary escaping to the displayed filename in non-fancy, non-table\nautoindex output. I'll include it inline because I don't see how to attach a\nfile in Bugzilla.\n\n--- httpd-2.2.0/modules/generators/mod_autoindex.c.orig\tThu Nov 10 09:20:05 2005\n+++ httpd-2.2.0/modules/generators/mod_autoindex.c\tThu Mar  9 02:42:54 2006\n@@ -1819,8 +1819,9 @@\n             ap_rputc('\\n', r);\n         }\n         else {\n-            ap_rvputs(r, \"<li><a href=\\\"\", anchor, \"\\\"> \", t2,\n-                         \"</a></li>\\n\", NULL);\n+            ap_rvputs(r, \"<li><a href=\\\"\", anchor, \"\\\"> \",\n+                      ap_escape_html(scratch, t2),\n+                      \"</a></li>\\n\", NULL);\n         }\n     }\n     if (autoindex_opts & TABLE_INDEXING) {"}, {"count": 1, "tags": [], "bug_id": 38910, "is_private": false, "text": "Created attachment 17857\nadds proper html escaping\n\nOk, fine, so I can add an attachment after first creating the bug report.", "id": 86648, "time": "2006-03-09T16:49:22Z", "creator": "rmg@terc.edu", "creation_time": "2006-03-09T16:49:22Z", "attachment_id": 17857}, {"attachment_id": null, "tags": [], "creator": "wrowe@apache.org", "is_private": false, "count": 2, "id": 86651, "time": "2006-03-09T19:19:25Z", "bug_id": 38910, "creation_time": "2006-03-09T19:19:25Z", "text": "Thank you for your patch; it appears this affects 2.0 and 1.3 httpd as well?\n\nWe very rarely patch httpd 1.3, but this looks like one of those rare examples\nof a very clean change affecting all versions."}, {"count": 3, "tags": [], "bug_id": 38910, "attachment_id": null, "is_private": false, "id": 86652, "time": "2006-03-09T19:28:33Z", "creator": "rmg@terc.edu", "creation_time": "2006-03-09T19:28:33Z", "text": "(In reply to comment #2)\n> Thank you for your patch; it appears this affects 2.0 and 1.3 httpd as well?\n\nYes, that's correct."}, {"count": 4, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "id": 89213, "time": "2006-05-17T14:40:18Z", "bug_id": 38910, "creation_time": "2006-05-17T14:40:18Z", "is_private": false, "text": "Thanks a lot for the patch.  Committed to trunk:\n\n  http://svn.apache.org/viewcvs.cgi?rev=407265&view=rev\n\nand proposed for 2.2.x."}]
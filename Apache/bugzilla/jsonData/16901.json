[{"count": 0, "tags": [], "text": "I believe in file \"jk_service_apache2.c\", in method \"jk2_init_ws_service\"\n\n    /* get server name */\n    s->server_name= (char *)(r->hostname ? r->hostname :\n                             r->server->server_hostname);\n\n    /* get the real port (otherwise redirect failed) */\n    apr_sockaddr_port_get(&port,r->connection->local_addr);\n    s->server_port = port;\n\n  Should be\n    \n    /* get server name */\n    s->server_name= (char *)ap_get_server_name(r);\n\n    /* get the real port (otherwise redirect failed) */\n    s->server_port = ap_get_server_port(r);\n\nMy setup:\nApache's listening on port 8001. NAT in front of Apache (for other technical \nreasons) is listening on 80, forwarding to 8001.\n\nWhen Apache receives a request it knows the request is for the external port 80-\nI can tell by going to a non existent page, ex. \"Apache/2.0.44 (Win32) \nmod_jk2/2.0.2 Server at [site] Port 80\"\n\n-BUT-\n\nBy the time Tomcat gets the request through jk2, it thinks the port is 8001. If \nI go to http://[site]:80/examples/jsp/snp/snoop.jsp everything's correct except \nServer port.", "attachment_id": null, "bug_id": 16901, "id": 30929, "time": "2003-02-08T08:29:26Z", "creator": "apache@kshakir.org", "creation_time": "2003-02-08T08:29:26Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 16901, "attachment_id": 4819, "text": "Created attachment 4819\nServer Name/Port correction in jk_service_apache2.c", "id": 31091, "time": "2003-02-11T21:51:48Z", "creator": "apache@kshakir.org", "creation_time": "2003-02-11T21:51:48Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 16901, "attachment_id": null, "text": "Changed summary to reflect added patch.\n\nI've compiled and tested it on my setup and fixes the problem.", "id": 31092, "time": "2003-02-11T21:56:35Z", "creator": "apache@kshakir.org", "creation_time": "2003-02-11T21:56:35Z", "is_private": false}, {"count": 3, "tags": [], "text": "I just made a similar patch for my mod_jk2 seutp.  Seems pretty important that\njk2 use the Apache Way (TM) of figuring out the server name and port.  The ap_\ncalls exist for it.\n\nPlease apply!", "is_private": false, "id": 39963, "creator": "kylev@yaga.com", "time": "2003-07-03T23:14:02Z", "bug_id": 16901, "creation_time": "2003-07-03T23:14:02Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 16901, "text": "FYI, this patch makes jk2 behave in accordance with the UseCanonicalName\ndocumentation:\n\nhttp://httpd.apache.org/docs-2.0/mod/core.html#usecanonicalname\n\nThe current behaviour is unexpected and icky.", "id": 39964, "time": "2003-07-03T23:20:31Z", "creator": "kylev@yaga.com", "creation_time": "2003-07-03T23:20:31Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 16901, "attachment_id": 8969, "text": "Created attachment 8969\nI'll add my own patch, against CVS HEAD", "id": 46963, "time": "2003-11-07T00:21:14Z", "creator": "kylev@yaga.com", "creation_time": "2003-11-07T00:21:14Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 16901, "attachment_id": null, "text": "The latest code in CVS use :\n\n    /* get server name like in jk 1.2.x */\n    s->server_name= (char *)ap_get_server_name(r);\n\n    /* get the real port (otherwise redirect failed) */\n    s->server_port = r->connection->local_addr->port;\n\n\nThanks to reopen if it didn't fix your problem", "id": 52316, "time": "2004-02-16T08:27:12Z", "creator": "hgomez@apache.org", "creation_time": "2004-02-16T08:27:12Z", "is_private": false}, {"count": 7, "tags": [], "text": "It is still not working.\n\ni'm using mod_jk2-2.0.4 apache-2.0.49 and \nmy setup is almost the same:\nhttpd is listening on 9000 and when trying to do a rewrite the connector\nresponds with www.anyurl.com:9000/x/y/z\n\nThe FW only allows http+https and therefore the connection got lost\n\nin the httpd.conf i've added the\nCanonicalName directive and also the \n'ServerName www.anyurl.com:9000' in the Virtual Host directives\n\nwithout any result.", "attachment_id": null, "bug_id": 16901, "id": 58548, "time": "2004-06-02T14:18:49Z", "creator": "old-schepperhand@gmx.net", "creation_time": "2004-06-02T14:18:49Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 16901, "attachment_id": null, "id": 67673, "time": "2004-12-01T02:54:31Z", "creator": "funkman@joedog.org", "creation_time": "2004-12-01T02:54:31Z", "is_private": false, "text": "As of November 15, 2004, JK2 is no longer supported. All bugs related to JK2 \nwill be marked as WONTFIX. In its place, some of its features have been \nbackported to jk1. Most of those features will be seen in 1.2.7, which is \nslated for release on November 30th, 2004.\n\nAnother alternative is the ajp addition to mod_proxy which will be part of \napache 2.\n\nFor more information on the Tomat connectors docs at\nhttp://jakarta.apache.org/tomcat/connectors-doc/"}, {"count": 9, "tags": [], "bug_id": 16901, "text": "Is there a reason that the latest version of jk_service_apache2.c doesn't use\nthe ap_get_server_port() function?  When I use a modified version of mod_jk2\nthat uses this function, the correct value for\nHttpServletRequest.getServerPort() is returned in both a BigIP and a non-BigIP\nenvironment.\n\nI also found that the latest version of mod_jk.c at\nhttp://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-connectors/jk/native/apache-2.0/\n(version 1.105 as of the time of this writing) includes the necessary code for\ninvoking the ap_get_server_port() function, but that this code is commented out.\n\nIs there a reason that the ap_get_server_port() function cannot be used in the\nmod_jk module either?\n\nThanks in advance,\nMike", "id": 67893, "time": "2004-12-03T19:08:28Z", "creator": "Michael.Spoonauer@fmr.com", "creation_time": "2004-12-03T19:08:28Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "text": "Set UseCannonicalName On in the apache conf, and you'll get the\nsame results on Apache too, I think.\n\nAlso what would report Tomcat if you make a NAT from 80 to 8080?\n\n", "attachment_id": null, "id": 67909, "creator": "mturk@apache.org", "time": "2004-12-03T22:34:33Z", "bug_id": 16901, "creation_time": "2004-12-03T22:34:33Z", "is_private": false}]
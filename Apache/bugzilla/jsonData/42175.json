[{"count": 0, "tags": [], "text": "When running an apache that was configured with suexec support as a non-root\nuser the variable suexec_enabled is incorrectly set.  The test should really\ncheck access(R_OK|X_OK) as well as for root ownership and the set uid bit.\n\nThis patch fixes the problem and allows me to run the standard Fedora install of\napache as myself and use mod_fcgid which relies on the correct setting of\nsuexec_enabled.\n\n--- httpd-2.2.4/os/unix/unixd.c~        2006-07-11 20:38:44.000000000 -0700\n+++ httpd-2.2.4/os/unix/unixd.c 2007-04-19 21:33:43.000000000 -0700\n@@ -215,7 +215,7 @@\n     }\n\n     if ((wrapper.protection & APR_USETID) && wrapper.user == 0) {\n-        unixd_config.suexec_enabled = 1;\n+        unixd_config.suexec_enabled = access(SUEXEC_BIN, R_OK|X_OK) == 0;\n     }\n }", "is_private": false, "bug_id": 42175, "id": 101972, "time": "2007-04-19T22:30:19Z", "creator": "radford@blackbean.org", "creation_time": "2007-04-19T22:30:19Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "radford@blackbean.org", "attachment_id": 20004, "id": 101973, "time": "2007-04-19T22:33:51Z", "bug_id": 42175, "creation_time": "2007-04-19T22:33:51Z", "is_private": false, "text": "Created attachment 20004\nA patch to fix suexec detection"}, {"count": 2, "tags": [], "creator": "poirier@pobox.com", "attachment_id": null, "id": 132037, "time": "2009-11-17T05:42:07Z", "bug_id": 42175, "creation_time": "2009-11-17T05:42:07Z", "is_private": false, "text": "I guess this is the problem code in fcgi:\n\n        if (ap_unixd_config.suexec_enabled) {\n            if (getuid() != 0) {\n                ap_log_error(APLOG_MARK, APLOG_EMERG, 0, main_server,\n                             \"mod_fcgid: current user is not root while suexec is enabled, exiting now\");\n                exit(1);\n\n\nWhy not just test getuid()==0 in unixd.c when setting\nsuexec_enabled?   That seems more direct than checking\naccess to the suexec program."}, {"count": 3, "tags": [], "creator": "radford@blackbean.org", "attachment_id": null, "id": 132043, "time": "2009-11-17T10:18:31Z", "bug_id": 42175, "creation_time": "2009-11-17T10:18:31Z", "is_private": false, "text": "(In reply to comment #2)\n> I guess this is the problem code in fcgi:\n\nYes.\n\n> Why not just test getuid()==0 in unixd.c when setting\n> suexec_enabled?\n\nBecause we are not running as root at this point even if the server was started by root.\n\n> That seems more direct than checking\n> access to the suexec program.\n\nI agree it seems odd, but I couldn't come up with either a lighter weight or more direct solution.  It just runs once at module load time."}, {"count": 4, "tags": [], "creator": "poirier@pobox.com", "attachment_id": null, "id": 132044, "time": "2009-11-17T10:25:24Z", "bug_id": 42175, "creation_time": "2009-11-17T10:25:24Z", "is_private": false, "text": "I wasn't sure when this code was run, but I tested it and if the server is started as root, it's still running as root at the time this code is executed.  getuid() returns 0."}, {"count": 5, "tags": [], "creator": "radford@blackbean.org", "attachment_id": null, "id": 132048, "time": "2009-11-17T11:02:25Z", "bug_id": 42175, "creation_time": "2009-11-17T11:02:25Z", "is_private": false, "text": "(In reply to comment #4)\n> I wasn't sure when this code was run, but I tested it and if the server is\n> started as root, it's still running as root at the time this code is executed. \n> getuid() returns 0.\n\nLooks like I was wrong about that; I get 0 in my setup too, so using getuid() should be fine."}, {"count": 6, "tags": [], "creator": "radford@blackbean.org", "text": "I think the reason I did access() instead of getuid() was that it was the more direct.  If someone didn't install susexec with the suid bit set, then the access() would notice that whereas the getuid() wouldn't.", "id": 132050, "time": "2009-11-17T11:11:43Z", "bug_id": 42175, "creation_time": "2009-11-17T11:11:43Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "radford@blackbean.org", "text": "Would it help to get this fixed if I made a patch using getuid()?", "id": 132102, "time": "2009-11-18T10:13:22Z", "bug_id": 42175, "creation_time": "2009-11-18T10:13:22Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 42175, "is_private": false, "text": "Maybe someone who better understands what suexec_enabled is intended for can comment on whether the correct fix here is to get suexec_enabled turned off in this case, or whether fcgi should be making this check in the first place?", "id": 132109, "time": "2009-11-18T14:10:43Z", "creator": "poirier@pobox.com", "creation_time": "2009-11-18T14:10:43Z", "attachment_id": null}, {"count": 9, "tags": [], "creator": "radford@blackbean.org", "attachment_id": null, "id": 142728, "time": "2010-12-15T00:26:26Z", "bug_id": 42175, "creation_time": "2010-12-15T00:26:26Z", "is_private": false, "text": "This patch is a one line \"obvious\" fix and has been applied to the trunk (2.3.3) for over and year and has been in Fedora for over two.  It would be nice to see it make it into the stable branch at some point."}, {"count": 10, "tags": [], "bug_id": 42175, "attachment_id": null, "text": "r791337", "id": 150390, "time": "2011-10-09T22:27:17Z", "creator": "sf@sfritsch.de", "creation_time": "2011-10-09T22:27:17Z", "is_private": false}, {"count": 11, "tags": [], "creator": "sf@sfritsch.de", "text": "fixed in 2.4.1", "id": 154193, "time": "2012-02-26T16:43:49Z", "bug_id": 42175, "creation_time": "2012-02-26T16:43:49Z", "is_private": false, "attachment_id": null}]
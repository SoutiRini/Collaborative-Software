[{"count": 0, "tags": [], "creator": "nk@rt.mipt.ru", "is_private": false, "text": "If servlet is secure and trys to do:\n\nif (fromFile.exists() && !fromFile.isDirectory()) {\n      \t    byte[] buf = new byte[100*1024];\n      \t    //Set header and mime type\n      \t    String mimetype = downloadConfig.getServletContext().getMimeType( \nfileName );\n      \t    response.setContentType( (mimetype != null) ? \nmimetype : \"application/octet-stream\" );\n            response.setContentLength( (int)fromFile.length() );\n            response.setHeader( \"Content-Disposition\", \"attachment; \nfilename=\\\"\" + request.getParameter(\"file\") + \"\\\"\" );\n      \t    BufferedInputStream bufIS = new BufferedInputStream(new \nFileInputStream(fromFile),1024*1024);\n      \t    int byteRead;\n      \t    ServletOutputStream out = response.getOutputStream();\n      \t    while( (bufIS != null) && (byteRead = bufIS.read(buf,0,100*1024)) !\n= -1) {\n      \t      out.write(buf,0,byteRead);\n      \t    }\n      \t    bufIS.close();\n      \t    out.flush();      \t    \n      \t    out.close();\n\nthan output is ok only first time. Any other attempt to do it arise the socket \nerror and put in log file:\n\n2002-03-13 17:47:02 [org.apache.catalina.connector.warp.WarpConnector] Error \naccepting requests\njava.net.SocketException: socket closed\n\tat java.net.PlainSocketImpl.socketAccept(Native Method)\n\tat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:468)\n\tat java.net.ServerSocket.implAccept(ServerSocket.java:243)\n\tat java.net.ServerSocket.accept(ServerSocket.java:222)\n\tat org.apache.catalina.connector.warp.WarpConnector.run\n(WarpConnector.java:590)\n\tat java.lang.Thread.run(Thread.java:484)", "id": 11737, "time": "2002-03-13T17:01:39Z", "bug_id": 7092, "creation_time": "2002-03-13T17:01:39Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 7092, "text": "\n\n*** This bug has been marked as a duplicate of 3509 ***", "id": 15004, "attachment_id": null, "creator": "pier@betaversion.org", "creation_time": "2002-04-29T12:44:06Z", "time": "2002-04-29T12:44:06Z", "is_private": false}]
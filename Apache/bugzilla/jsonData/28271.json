[{"count": 0, "tags": [], "text": "Filters that need to access a DataSource via JNDI fail to initilze when the JNDI\nresource is linked to the webapp via a ResourceLink in a DefaultContext. The\nsame code works fine when the ResourceLink is in a Context. Also, by the time\nthe Filter.doFilter method a request for a JNDI resource that would fail in the\ninit method will succeed. In case that is unclear, here is a table of where a\nJNDI look up will work:\n\nResourceLink in | Filter.init | Filter.doFilter\nDefaultContext  |    fail     |    succeed\n   Context      |  succeed    |    succeed\n\nI've been privately told that: \"DefaultContext JNDI references do not get\ninitialized until after plugin init methods are called.  It does not appear that\nthe apache developers think this is a problem.  The recommendation was to put\nthe resource link into the app's context instead.\"\n\nIf that is the case, could the documentation at\nhttp://jakarta.apache.org/tomcat/tomcat-5.0-doc/config/defaultcontext.html be\nupdated with a comment on this unexpected behavior. It would have saved me half\na day's worth of work trying to track this down.\n\nIf you want test code that demonstrates the problem I'd be happy to upload it.\nHere is the stack trace from my test code:\n\n2004-04-07 18:11:09 StandardContext[/JNDI]Exception starting filter InitLookup\njavax.servlet.UnavailableException: Problem looking up resource.\n        at com.example.filter.InitLookup.lookup(InitLookup.java:54)\n        at com.example.filter.InitLookup.init(InitLookup.java:26)\n        at\norg.apache.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:272)\n        at\norg.apache.catalina.core.ApplicationFilterConfig.setFilterDef(ApplicationFilterConfig.java:355)\n        at\norg.apache.catalina.core.ApplicationFilterConfig.<init>(ApplicationFilterConfig.java:126)\n        at\norg.apache.catalina.core.StandardContext.filterStart(StandardContext.java:3644)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4276)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1126)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:832)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1126)\n        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:521)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2345)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:594)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)\nCaused by: javax.naming.NamingException: Cannot create resource instance\n        at\norg.apache.naming.factory.ResourceEnvFactory.getObjectInstance(ResourceEnvFactory.java:146)\n        at javax.naming.spi.NamingManager.getObjectInstance(NamingManager.java:301)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:838)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:185)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:826)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:198)\n        at com.example.filter.InitLookup.lookup(InitLookup.java:48)\n        ... 19 more", "is_private": false, "bug_id": 28271, "id": 55502, "time": "2004-04-07T22:17:32Z", "creator": "sandymac@apache.org", "creation_time": "2004-04-07T22:17:32Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Please do not file a bug before testing with the latest build.", "is_private": false, "bug_id": 28271, "id": 55503, "time": "2004-04-07T22:38:00Z", "creator": "remm@apache.org", "creation_time": "2004-04-07T22:38:00Z", "attachment_id": null}]
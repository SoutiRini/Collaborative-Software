[{"count": 0, "tags": [], "text": "mod_deflate module generates corrupted result with large data (over 200kbytes).\ndeflate_out_filter deflate input buckets into output bucket, but output buffer\ninformation reset every input bucket, it means waste partial deflated data at\nprocess next input bucket.\nOutput buffer must initialize before BRIGADE_FOREACH loop.\n\n--- mod_deflate.c.org   Tue May  7 09:35:16 2002\n+++ mod_deflate.c       Mon May 13 00:32:18 2002\n@@ -328,4 +328,8 @@\n     }\n \n+    /* initialize deflate output buffer */\n+    ctx->stream.next_out = ctx->buffer;\n+    ctx->stream.avail_out = c->bufferSize;\n+\n     APR_BRIGADE_FOREACH(e, bb) {\n         const char *data;\n@@ -437,6 +441,4 @@\n                                                       * trust zlib */\n         ctx->stream.avail_in = len;\n-        ctx->stream.next_out = ctx->buffer;\n-        ctx->stream.avail_out = c->bufferSize;\n \n         while (ctx->stream.avail_in != 0) {", "attachment_id": null, "id": 15964, "creator": "kaz@asada.sytes.net", "time": "2002-05-12T15:32:54Z", "bug_id": 9014, "creation_time": "2002-05-12T15:32:54Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 9014, "attachment_id": null, "is_private": false, "id": 15987, "time": "2002-05-13T07:13:24Z", "creator": "jerenkrantz@apache.org", "creation_time": "2002-05-13T07:13:24Z", "text": "Woo-hoo!\n\nI was tracking this down last week, but I had to leave for WWDC and didn't\nfollow up.  Your patch is right and has been committed in revision 1.4 of\nmodules/filters/mod_deflate.c.  It will be included in the next release of\nApache 2.0!\n\nThanks for using Apache (and keep the patches coming)!"}, {"text": "I am still seeing these symptoms in the httpd-2.0_20020530221254.tar.gz\nsnapshot. The difference may be that for the files having problems\nthe output is generated by a cgi script and then fed through INCLUDES\nand then DEFLATE. 50KB files work OK. 450KB files fail to be\nuncompressed using lynx 2.5-dev, Netscape 4.08 and IE 5.?.\nI am running this under linux 2.2.16 (Redhat) on a Athlon Tbird.", "tags": [], "creator": "bruno@wolff.to", "attachment_id": null, "count": 2, "id": 16975, "time": "2002-05-31T03:12:49Z", "bug_id": 9014, "creation_time": "2002-05-31T03:12:49Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 9014, "attachment_id": null, "id": 17036, "time": "2002-06-01T15:45:36Z", "creator": "bruno@wolff.to", "creation_time": "2002-06-01T15:45:36Z", "is_private": false, "text": "I tested things a bit more and found that if I am just using the\nDEFLATE filter things work OK. But when I use DEFLATE after INCLUDES\nthen they don't. I also tried just INCLUDES and the only\ndifferences were the expected ones."}, {"count": 4, "tags": [], "text": "Is there any chance that you can provide a sample CGI script that \ngenerates the right include tags to causes mod_include to create \na sequence of data that mod_deflate can't handle?\n\nThanks!", "is_private": false, "id": 17191, "creator": "trawick@apache.org", "time": "2002-06-05T15:47:33Z", "bug_id": 9014, "creation_time": "2002-06-05T15:47:33Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 9014, "attachment_id": null, "is_private": false, "id": 17193, "time": "2002-06-05T16:18:03Z", "creator": "bruno@wolff.to", "creation_time": "2002-06-05T16:18:03Z", "text": "A CGI-BIN script isn't needed to duplicate the problem.\nA sample broken link is at:\nhttp://wolff.to/area/test.html\nSource to the actual files is available at:\nhttp://wolff.to/area/test.txt\nhttp://wolff.to/area/sig.txt\nhttp://wolff.to/area/links.txt\nThe .txt files are sym links to the .html files. INCLUDES and DEFLATE\nfilters are run on .html files, but not on .txt files."}, {"count": 6, "tags": [], "text": "Justin Erenkrantz committed a patch to mod_deflate earlier today that might \nfix this problem.  Try out the CVS version of mod_deflate.c (rev 1.16) and see \nif that fixes your problem. \n \nThanks! ", "is_private": false, "bug_id": 9014, "id": 17200, "time": "2002-06-05T16:46:40Z", "creator": "jwoolley@apache.org", "creation_time": "2002-06-05T16:46:40Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "I tried 1.16 in a CVS snapshot from a few days ago and the problem\nappears to be fixed. I will be removing the test files shortly.\nThanks for fixing this.", "attachment_id": null, "bug_id": 9014, "id": 17205, "time": "2002-06-05T17:15:17Z", "creator": "bruno@wolff.to", "creation_time": "2002-06-05T17:15:17Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "ehsforward@yahoo.com", "text": "Task zip hangs on my win2000 sp1 machine with jdk1.3 & hotspot2 (don't know \nabout other configurations). Works if compression is set to false. This problem \ndoes not appear on ant 1.2.\n\nBTW performance doing the task (without compression) is 1 second with ant 1.2 \nand 3(!) second with ant 1.3b1 .\n\nHere is the build file:\n\n<?xml version=\"1.0\"?>\n\n<!-- ======================================================================= -->\n<!-- EJBUtils distribution zip build \nfile                                                      -->\n<!-- ======================================================================= -->\n\n<project name=\"EJBUtils distribution zip\" default=\"main\" basedir=\"..\">\n  <patternset id=\"dist\">\n\t<include name=\"src/**/*\" />\n\t<include name=\"javadoc/**/*\" />\n\t<include name=\"lib/**/*\" />\n\t<include name=\"*\" />\n  </patternset>\n\n  <target name=\"init\">\n\t<tstamp/>\n\t<property name=\"file\" value=\"ejbutils\" />\n\n\t<delete file=\"lib/${file}.jar\" />\n\t<delete file=\"${file}.zip\" />\n\t<delete file=\"${file}.tar\" />\n\t<delete file=\"${file}.tar.gz\" />\n  </target>\n\n  <target name=\"main\" depends=\"init\">\n\t<jar jarfile=\"lib/${file}.jar\" manifest=\"etc/manifest\">\n\t\t<fileset dir=\"classes\"\n\t\t\texcludes=\"**/*.dependency\"\n\t\t/>\n\t</jar>\n\t<zip zipfile=\"${file}.zip\">\n\t\t<fileset dir=\".\" >\n\t\t\t<patternset refid=\"dist\"/>\n\t\t</fileset>\n\t</zip>\n\t<tar tarfile=\"${file}.tar\" basedir=\".\">\n\t\t<patternset refid=\"dist\"/>\n\t</tar>\n\t<gzip src=\"${file}.tar\" zipfile=\"${file}.tar.gz\"/>\n\t<delete file=\"${file}.tar\" />\n  </target>\n\n</project>", "id": 632, "time": "2001-02-09T08:34:15Z", "bug_id": 564, "creation_time": "2001-02-09T08:34:15Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 564, "text": "This was validated with both \n\njava version \"1.3.0\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.3.0-C)\nJava HotSpot(TM) Client VM (build 1.3.0-C, mixed mode)\n\nand \n\njava version \"1.3.0\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.3.0-C)\nJava HotSpot(TM) Server VM (build 2.0fcs-E, mixed mode)\n\nsince the latter was the only thing I had which was named similar to \"hotspot2\".\n\nRuns pretty well, time was 2 secs with Client-VM and 3 secs with Server-VM on a \nPIII 650MHz with 256 MB and a German W2K SP1. Fast enough for me :-)\n\nLet me add that there *may* be a problem resulting from adding the same zip-\nfile you are creating to itself - but this would be a problem of the OS and not \nof Ant :-) (but maybe this is just a simplified test-case?). \nIn fact the jar-file is added to the zip which is added partly to itself and \nwhich again is added to the tar.gz-file. If this is not a test-case it should \nbe changed in my opinion. ", "id": 688, "time": "2001-02-14T15:52:57Z", "creator": "nico@apache.org", "creation_time": "2001-02-14T15:52:57Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 564, "attachment_id": null, "id": 698, "creation_time": "2001-02-15T05:51:37Z", "time": "2001-02-15T05:51:37Z", "creator": "ehsforward@yahoo.com", "text": "Cannot reproduce it either now... must have been a strange environment problem.\n\nEmmanuel", "is_private": false}, {"count": 3, "tags": [], "creator": "d.rees.l@usa.net", "attachment_id": null, "id": 758, "time": "2001-02-18T22:37:35Z", "bug_id": 564, "creation_time": "2001-02-18T22:37:35Z", "is_private": false, "text": "I am able to reproduce this. However, I am not sure its a \"bug\".\n\nThe problem is that the patternset \"dist\" in the build file includes all the \nfiles in the main directory. For the Zip task this results in the target file \nbeing included and you get an \"infinite Zip\". Simply adding an exclude of the \nZip target file to the pattern set keeps the problem from happening. \n\nHowever, Tar with the same patternset does not result in the target file being \nincluded in the tarred files. So at the very least there is a bug in that Tar \nand Zip are inconsistent (which I have re-prioritized to low)\n\nI am not sure exactly where the difference in the code lies - Tar and Zip are \ncoded very differently and I haven't tracked down the specific location (yet?).\n"}, {"count": 4, "tags": [], "creator": "ehsforward@yahoo.com", "attachment_id": null, "id": 760, "time": "2001-02-19T02:35:55Z", "bug_id": 564, "creation_time": "2001-02-19T02:35:55Z", "is_private": false, "text": "I would suggest it is a kind of bug although I agree it is in the fringes of \nbeing a \"missing feature\". Maybe the ant ZIP code should then make sure that it \ndoes not include the zip being created in itself?\n\n"}, {"count": 5, "tags": [], "creator": "conor@apache.org", "attachment_id": null, "id": 763, "time": "2001-02-19T05:34:09Z", "bug_id": 564, "creation_time": "2001-02-19T05:34:09Z", "is_private": false, "text": "I have added a check which will prevent <zip> and <tar> from attempting to \ninclude the target file in the archive."}, {"count": 6, "attachment_id": null, "bug_id": 564, "text": "Sorry to reopen, but the previous committed changes do not fully solve the \nproblem. First of all the ZipTest has a minor typo in that it runs Tar instead \nof Zip for the new test case. More importantly, it does not test for the case \nwhere the Zip file does not already exist. I am submitting a patch that updates \ntest cases and patches code.", "id": 778, "time": "2001-02-19T23:28:22Z", "creator": "d.rees.l@usa.net", "creation_time": "2001-02-19T23:28:22Z", "tags": [], "is_private": false}, {"count": 7, "attachment_id": null, "bug_id": 564, "text": "committed David's patch. Fixed in 1.3beta3.", "id": 782, "time": "2001-02-20T03:23:23Z", "creator": "bodewig@apache.org", "creation_time": "2001-02-20T03:23:23Z", "tags": [], "is_private": false}]
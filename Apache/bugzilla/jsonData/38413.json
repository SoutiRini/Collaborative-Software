[{"count": 0, "tags": [], "text": "i have added a couple of <i18n:text key=\"something\"/> tags to my\npage2xhtml.xsl and created a directory <mypub>/lenya/resources/i18n\nwhich contains the two files cmsui_de.xml and cmsui_en.xml.\n\nmy publication.xconf defines the languages \"de\" (as default) and \"en\".\nin my page2xhtml.xsl, i use a link href=\"{$root}{$document-id}_en.html\"\nto switch to english.\n\nif i view index.html or index_de.html, all i18n keys are duly\ntranslated. in index_en.html however, all keys show as \"untranslated\".\n\nobviously the catalogue file for english is not found.\n\ni have restarted lenya multiple times to rule out cache issues.\n\nthe $language variable is set correctly, i'm using it to switch language buttons.", "attachment_id": null, "id": 85088, "creator": "nettings@apache.org", "time": "2006-01-27T11:10:04Z", "bug_id": 38413, "creation_time": "2006-01-27T11:10:04Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 38413, "text": "Would you mind adding a patch that allows to reproduce the problem? Thanks!", "id": 85118, "time": "2006-01-27T16:35:47Z", "creator": "andreas@apache.org", "creation_time": "2006-01-27T16:35:47Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "gotcha. i found the issue when i tried to reproduce that behaviour in the\ndefault publication.\n\nthe problem was that i don't have a cmsui.xml file for english, but a\ncmsui_en.xml. i thought this is more logical given that my default language is \"de\".\n\nfor some reason, lenya seems to assume that english is always the generic file\nwithout a 2-letter language code.\n\nto reproduce this, use the attached patch.\n\nthe easy workaround is to always use the generic catalog file name for english.", "is_private": false, "id": 85122, "creator": "nettings@apache.org", "time": "2006-01-27T17:29:37Z", "bug_id": 38413, "creation_time": "2006-01-27T17:29:37Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Created attachment 17518\npatch to reproduce the observed problem.", "attachment_id": 17518, "bug_id": 38413, "id": 85123, "time": "2006-01-27T17:30:47Z", "creator": "nettings@apache.org", "creation_time": "2006-01-27T17:30:47Z", "is_private": false}, {"count": 4, "tags": [], "creator": "nettings@apache.org", "attachment_id": null, "is_private": false, "id": 85727, "time": "2006-02-12T15:07:50Z", "bug_id": 38413, "creation_time": "2006-02-12T15:07:50Z", "text": "the issue seems to be back - i just started a lenya build from scratch, and\nnon-default languages are broken again. it looks like i18n.xmap is not properly\nfallback-enabled. my quick fix for the problem is this:\n\nadd fallback:// calls to i18n.xmap (see attached patch, it works but i'm not\nsure it's correct), and make sure each publication has their own catalogue.xsp\n(without it, non-default languages will break for some reason)."}, {"attachment_id": 17665, "tags": [], "bug_id": 38413, "is_private": false, "count": 5, "id": 85728, "time": "2006-02-12T15:09:08Z", "creator": "nettings@apache.org", "creation_time": "2006-02-12T15:09:08Z", "text": "Created attachment 17665\nfixes i18n problem for me, but needs review."}, {"count": 6, "tags": [], "creator": "nettings@apache.org", "attachment_id": 17669, "is_private": false, "id": 85729, "time": "2006-02-12T19:17:25Z", "bug_id": 38413, "creation_time": "2006-02-12T19:17:25Z", "text": "Created attachment 17669\nthis is probably the correct approach.\n\nthe previous patch was b0rken, it breaks i18n in the cms gui.\nfallback://lenya/resources/... does not exist in the core. i have now changed\nthe uris to fallback://resources/...\nthis means that publications must now store their catalogues under\n<pubname>/resources/i18n (as opposed to the previous\n<pubname>/lenya/resources/i18n/, but this is a lot nicer anyway. \n\nplease review and comment and possibly apply."}, {"count": 7, "tags": [], "text": "*** Bug 38386 has been marked as a duplicate of this bug. ***", "is_private": false, "bug_id": 38413, "id": 89449, "time": "2006-05-24T16:42:09Z", "creator": "nettings@apache.org", "creation_time": "2006-05-24T16:42:09Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 38413, "is_private": false, "count": 8, "id": 89450, "time": "2006-05-24T16:45:07Z", "creator": "nettings@apache.org", "creation_time": "2006-05-24T16:45:07Z", "text": "just a heads-up, because my suggested fix has not been discussed yet. please\nreview and apply."}, {"count": 9, "tags": [], "creator": "nettings@apache.org", "attachment_id": null, "is_private": false, "id": 92211, "time": "2006-08-14T16:57:28Z", "bug_id": 38413, "creation_time": "2006-08-14T16:57:28Z", "text": "please apply the patch above. the current i18n.xmap is obviously incorrect,\nsince it circumvents the fallback mechanism, thus breaking i18n transformation\nfor templated publications.  this is a blocker for 1.4 imho with a simple and\nobvious fix.\n\nthis patch has the (positive) side effect that publications now must have their\ncatalogue files in <pub_basedir>/resources/i18n (instead of\n<pub_basedir>/lenya/resources/i18n, which makes sense, since we are *not*\noverloading core functionality, but rather merging our own catalogue data in.\nthat means the existing documentation needs to be fixed, and the committer\nshould post a headsup to the list that people move their catalogues\n"}, {"count": 10, "tags": [], "text": "Thanks - I applied the patch. Please verify if it works now.", "is_private": false, "bug_id": 38413, "id": 92402, "time": "2006-08-22T11:36:52Z", "creator": "andreas@apache.org", "creation_time": "2006-08-22T11:36:52Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "(In reply to comment #10)\n> Thanks - I applied the patch. Please verify if it works now.\n\nthe original patch worked, but the later change of the fallback uris broke it again.", "attachment_id": null, "bug_id": 38413, "id": 92589, "time": "2006-08-27T17:05:14Z", "creator": "nettings@apache.org", "creation_time": "2006-08-27T17:05:14Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 38413, "attachment_id": null, "id": 92603, "time": "2006-08-28T07:46:58Z", "creator": "andreas@apache.org", "creation_time": "2006-08-28T07:46:58Z", "is_private": false, "text": "(In reply to comment #11)\n> (In reply to comment #10)\n> > Thanks - I applied the patch. Please verify if it works now.\n> \n> the original patch worked, but the later change of the fallback\n> uris broke it again.\n\nThe original patch didn't work for me. Maybe someone else could try it. Thanks!"}, {"count": 13, "tags": [], "text": "(In reply to comment #12)\n> (In reply to comment #11)\n> > (In reply to comment #10)\n> > > Thanks - I applied the patch. Please verify if it works now.\n> > \n> > the original patch worked, but the later change of the fallback\n> > uris broke it again.\n> \n> The original patch didn't work for me. Maybe someone else could try it. Thanks!\n\ni have just done the following:\n\nsvn update, clean rebuild (i.e. containing your version with \"/lenya/\" in the\ni18n.xmap paths.\nmoved the language resources in my 2 pubs A and B from ./resources/i18n to\n./lenya/resources/i18n. the inheritance is as follows: default is a template for\nA, which is a template for B. both A and B have their own catalogues. only A\nprovides a catalogue.xsp.\n\nnow the i18n in my custom pubs works, but the core stuff is broken: the lenya\nmenu shows \"untranslated\".\n\nwhen i change the paths in i18n.xmap to my original proposal \"./resources\" (as\nopposed to ./lenya/resources\" and move the resources in my custom pubs back, i\ncan make i18n work for both core (i.e. lenya cms menus), A and B. \n\ni don't know why this is so, but since it works, i'm not going to investigate\nfurther. eventually i18n transforming could use a rewrite, but not today. for\nnow i suggest to revert to my original patch and move the i18n resources in the\ndefault pub from ./lenya/resources/i18n to ./resources/i18n\n\n\n", "is_private": false, "bug_id": 38413, "id": 93137, "time": "2006-09-07T10:44:34Z", "creator": "nettings@apache.org", "creation_time": "2006-09-07T10:44:34Z", "attachment_id": null}, {"count": 14, "tags": [], "text": "Now the i18n uses the aggregate-fallback protocol.\nWould you mind trying it again?", "attachment_id": null, "bug_id": 38413, "id": 95868, "time": "2006-11-15T08:21:28Z", "creator": "andreas@apache.org", "creation_time": "2006-11-15T08:21:28Z", "is_private": false}]
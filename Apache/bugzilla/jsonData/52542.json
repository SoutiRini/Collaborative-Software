[{"count": 0, "attachment_id": null, "creator": "aansel@denyall.com", "is_private": false, "id": 153209, "time": "2012-01-27T10:27:22Z", "bug_id": 52542, "creation_time": "2012-01-27T10:27:22Z", "tags": [], "text": "I have to use a data in the peer certificate on my RewriteConds like this :\n\nRewriteCond %{LA-U:SSL_Client_I_DN_CN} my_domain [OR]\nRewriteCond %{SSL:SSL_Client_I_DN_CN} my_domain\n...\n\nbut those data can't be accessed on an initial request ( [Thu Jan 26 17:39:20 2012] [info] Initial (No.1) HTTPS request received for child 28 ) so my RewriteCond doesn't match even if the peer certificate is correctly send ( error 404 ), the values are always empty string in initial request, but they are always correctly retrieved by subsequent requests (Subsequent (No.14) HTTPS request received for child 26 ... )\n\nSo i have my RewriteRule are not applied at each first access to a resource and sometimes after that when the initial request thread (process ?!?) handle the request again."}, {"count": 1, "attachment_id": null, "bug_id": 52542, "is_private": false, "id": 153214, "time": "2012-01-27T12:09:13Z", "creator": "covener@gmail.com", "creation_time": "2012-01-27T12:09:13Z", "tags": [], "text": "It makes sense that the SSL var is not available timing wise, and the lookahead feature only gets env vars not SSL vars."}, {"count": 2, "tags": [], "bug_id": 52542, "text": "(In reply to comment #1)\n> It makes sense that the SSL var is not available timing wise, and the lookahead\n> feature only gets env vars not SSL vars.\n\nWhy shouldn't it be available at this point of time? The handshake has already happened, provided there is no directory based SSLRequire in combination with a global rewrite rule. So I guess we need to see the whole configuration and not just the RewriteCond snippet.", "id": 153217, "attachment_id": null, "creator": "rpluem@apache.org", "creation_time": "2012-01-27T15:00:48Z", "time": "2012-01-27T15:00:48Z", "is_private": false}, {"count": 3, "tags": [], "creator": "covener@gmail.com", "text": "> Why shouldn't it be available at this point of time?\n\nsorry, was confused re: envvars vs ssl vars and how they're spilled over in fixups.", "id": 153218, "time": "2012-01-27T15:10:01Z", "bug_id": 52542, "creation_time": "2012-01-27T15:10:01Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "asfbugz@velox.ch", "text": "(In reply to comment #2)\n> So I guess we need to see the whole configuration and not just the RewriteCond snippet.\n\nI agree. In particular, we should know in what context these RewriteConds appear, and what SSLVerifyClient is set to at that point.\n\nIf you log %{SSL_CLIENT_I_DN_CN}x with a CustomLog, does it also appear as \"-\" for the initial request?", "id": 153435, "time": "2012-02-04T07:51:10Z", "bug_id": 52542, "creation_time": "2012-02-04T07:51:10Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 52542, "text": "The Apache is used in ReverseProxy mode ( but i have commented ProxyPass  and ProxyPassReverse directives because they didn't work with the RewriteRules )\n\nSome stuff of the configurations\n\n<VirtualHost *:*> \nSSLEngine On\nRewriteEngine On\n</VirtualHost>\n\n<Location/>                            \nSSLVerifyClient require                                                                                                                  \nSSLVerifyDepth 1                                                                                                                         \nSSLOptions  +StdEnvVars +ExportCertData                                                                                                  \nRequestHeader set Remote-Name \"%{SSL_CLIENT_S_DN}s\"      \nRequestHeader set Remote-Name-Client \"%{SSL_CLIENT_S_DN_CN}s\"                                                \nRequestHeader set Remote-CA \"%{SSL_CLIENT_I_DN_CN}s\"                                                        \n</Location>      \n\n\nI can't make tests with CustomLog for now, but later i will and i will post the results here.", "id": 153503, "time": "2012-02-06T13:32:28Z", "creator": "aansel@denyall.com", "creation_time": "2012-02-06T13:32:28Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "(In reply to comment #5)\n> The Apache is used in ReverseProxy mode ( but i have commented ProxyPass  and\n> ProxyPassReverse directives because they didn't work with the RewriteRules )\n> \n> Some stuff of the configurations\n> \n> <VirtualHost *:*> \n> SSLEngine On\n> RewriteEngine On\n> </VirtualHost>\n> \n> <Location/>                            \n> SSLVerifyClient require                                                         \n> SSLVerifyDepth 1                \n\nThis causes a renegotiation later on and is bogus since you require the client cert for the whole virtual server. Move the above two directives on virtual host level and everything works fine. So in fact it is not a bug, but a wrong configuration.", "is_private": false, "id": 153550, "creation_time": "2012-02-07T12:37:34Z", "time": "2012-02-07T12:37:34Z", "creator": "rpluem@apache.org", "bug_id": 52542, "attachment_id": null}]
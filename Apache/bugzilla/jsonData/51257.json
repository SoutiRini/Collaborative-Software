[{"attachment_id": null, "tags": [], "bug_id": 51257, "is_private": false, "count": 0, "id": 146585, "time": "2011-05-24T12:34:33Z", "creator": "henrik.strand@axis.com", "creation_time": "2011-05-24T12:34:33Z", "text": "When cross-compiling Apache httpd 2.2.19 \"make\" fails with the following error:\n\n./dftables: ./dftables: cannot execute binary file\n\nAccording to the README file in /srclib/pcre it should be possible to specify CC_FOR_BUILD when calling the \"configure\" command, but even when doing so \"make\" fails. \n\nA known workaround is to first build Apache httpd for local host and then copy the dftables binary to the other host build folder and run \"make\" again. However, since I would like to automate the build process the workaround is not sufficient for me. \n\n\nAlso, the same type of error exists with the gen_test_char binary:\n\n/bin/sh: ./gen_test_char: cannot execute binary file"}, {"count": 1, "tags": [], "creator": "henrik.strand@axis.com", "text": "The build problem with gen_test_char still exists on Apache HTTP Server 2.4.1", "id": 154612, "time": "2012-03-07T08:47:39Z", "bug_id": 51257, "creation_time": "2012-03-07T08:47:39Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "henrik.strand@axis.com", "text": "Created attachment 28632\nSimple patch for defining the C compiler command to be used for compilation of programs that run on BUILD during cross-compiling, e.g. gen_test_char.\n\nVerified on httpd_2.4.1", "id": 158160, "time": "2012-04-18T07:45:54Z", "bug_id": 51257, "creation_time": "2012-04-18T07:45:54Z", "is_private": false, "attachment_id": 28632}, {"count": 3, "tags": [], "text": "Created attachment 28633\nSame patch as previous file but for httpd_trunk.", "attachment_id": 28633, "id": 158161, "creator": "henrik.strand@axis.com", "time": "2012-04-18T07:48:55Z", "bug_id": 51257, "creation_time": "2012-04-18T07:48:55Z", "is_private": false}, {"count": 4, "tags": [], "creator": "eflash@gmx.net", "attachment_id": null, "id": 158198, "creation_time": "2012-04-19T12:03:01Z", "time": "2012-04-19T12:03:01Z", "bug_id": 51257, "text": "Hi Henrik,\n(In reply to comment #3)\n> Created attachment 28633 [details]\n> Same patch as previous file but for httpd_trunk.\nI've just commited a slightly modified patch to trunk:\nhttp://svn.apache.org/viewvc?rev=1327907&view=rev\nthis should work same way as with your patch provided that you export CC_FOR_BUILD=gcc. I hope that we can finally figure out how we can configure teach to set CC_FOR_BUILD automatically in case of detecting cross-compilation so that the export is then not needed. The CC_FOR_BUILD should appear in build/config_vars.mk because then server/Makefile can access it.\nFor 2.2.x you will then need in addition:\n--- srclib/pcre/Makefile.in.orig        2005-02-11 13:00:41.000000000 +0100\n+++ srclib/pcre/Makefile.in     2012-04-19 13:29:06.000000000 +0200\n@@ -11,8 +11,13 @@\n\n $(LTLIBRARY_OBJECTS) dftables.lo: config.h\n\n+ifdef CC_FOR_BUILD\n+dftables: dftables.c\n+       $(CC_FOR_BUILD) -o $@ $<\n+else\n dftables: dftables.lo\n        $(LINK) $(EXTRA_LDFLAGS) dftables.lo $(EXTRA_LIBS)\n+endif\n\n $(srcdir)/chartables.c: dftables\n        ./dftables $@", "is_private": false}, {"count": 5, "tags": [], "creator": "eflash@gmx.net", "text": "I've just committed a follow-up patch:\nhttp://svn.apache.org/viewvc?view=revision&revision=1328390\nit is *required* that you re-run buildconf so that configure gets re-created! After you've run configure with f.e.:\nCC_FOR_BUILD=gcc ./configure --host=...\nyou can check ./build/config_vars.mk where CC_FOR_BUILD should appear now and ./server/Makefile should now see the var ...", "id": 158225, "time": "2012-04-20T15:17:06Z", "bug_id": 51257, "creation_time": "2012-04-20T15:17:06Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 51257, "text": "Here's the summarize of all patches:\n* cross-compile: allow to provide CC_FOR_BUILD so that gen_test_char will be\n  compiled by the build compiler instead of the host compiler.\n  Also set CC_FOR_BUILD to 'cc' when cross-compilation is detected.\n  Trunk patches: http://svn.apache.org/viewvc?view=revision&revision=1327907\n                 http://svn.apache.org/viewvc?view=revision&revision=1328390\n                 http://svn.apache.org/viewvc?view=revision&revision=1328714\n\nBackport proposal added for 2.4.x patch:\nhttp://people.apache.org/~fuankg/diffs/httpd-2.4.x-cross_compile.diff\nBackport proposal added for 2.2.x patch:\nhttp://people.apache.org/~fuankg/diffs/httpd-2.2.x-cross_compile.diff\nSince PCRE is included with 2.2.x this patch also takes care for dftables.\n\nplease test both with and without providing CC_FOR_BUILD - if not set and cross-compilation is detected then CC_FOR_BUILD defaults to 'cc'.", "id": 158264, "time": "2012-04-21T18:23:14Z", "creator": "eflash@gmx.net", "creation_time": "2012-04-21T18:23:14Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "henrik.strand@axis.com", "attachment_id": 28680, "id": 158414, "time": "2012-04-25T12:07:35Z", "bug_id": 51257, "creation_time": "2012-04-25T12:07:35Z", "is_private": false, "text": "Created attachment 28680\nUpdated document patch."}, {"count": 8, "tags": [], "text": "Created attachment 28681\nUpdated document patch.", "is_private": false, "id": 158416, "creator": "henrik.strand@axis.com", "time": "2012-04-25T12:19:24Z", "bug_id": 51257, "creation_time": "2012-04-25T12:19:24Z", "attachment_id": 28681}, {"count": 9, "tags": [], "creator": "henrik.strand@axis.com", "text": "Created attachment 28682\nUpdated document patch.", "id": 158417, "time": "2012-04-25T12:20:26Z", "bug_id": 51257, "creation_time": "2012-04-25T12:20:26Z", "is_private": false, "attachment_id": 28682}]
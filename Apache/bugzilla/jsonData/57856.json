[{"count": 0, "tags": [], "creator": "james+apache@lonelystorm.com", "text": "I've noticed an issue with the org.apache.catalina.connector.Response where the toAbsolute method called during a relative redirect is generating the wrong absolute uri.\n\nIf you enable the org.apache.catalina.filters.RemoteIpFilter to allow an upstream proxy to control whether the server is available over HTTP/HTTPS by setting an header such as \"X-Forwarded-Proto\", this state is not replicated within the Response.\n\nTherefore, when the uri is generated, the scheme is not replaced with the value that is actually available within the Request so it will generate for HTTP scheme only.\n\nI believe the RemoteIpFilter should also implement a wrapper for the Response on the sendRedirect method to correctly generate the URI.", "id": 182615, "time": "2015-04-24T15:02:15Z", "bug_id": 57856, "creation_time": "2015-04-24T15:02:15Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "markt@apache.org", "text": "Looking at the code, there will be a similar problem for ports.\n\nThere doesn't appear to be an easy/obvious way to fix this as the current sendRedirect() implementation makes extensive use of Tomcat internals. I'm currently looking at various options.", "id": 182653, "time": "2015-04-27T13:56:20Z", "bug_id": 57856, "creation_time": "2015-04-27T13:56:20Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 57856, "text": "I found a reasonably simple way to fix this. It isn't as clean as I would like but it should work with any app server and didn't require a large duplication of code or equivalent refactoring.\n\nThe fix has been applied to trunk (for 9.0.x), 8.0.x/trunk (for 8.0.22 onwards) and 7.0.x (for 7.0.62 onwards).\n\nThanks for the report and enjoy the fix.", "count": 2, "id": 182670, "time": "2015-04-27T20:33:27Z", "creator": "markt@apache.org", "creation_time": "2015-04-27T20:33:27Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 58608, "attachment_id": null, "text": "We have run into an issue with Tomcat Connector and IIS7+. The request to Tomcat routed via the Connector contains a number of batch requests that require batch responses which are then processed as they arrive by the client. IIS buffers the HTTP response until the buffer is full or the response is fulfilled. This is described by Microsoft in the following KB article [1]. While IIS sits and buffers the response our client loses interactivity and just sits idle waiting for the whole result to arrive. The issue is also exacerbated by dealing with large batch responses (think of a multiple files sent back as part of the response) where the client decides the connection is dead and closes the connection.\n\nIf we call \n\nlpEcb->ServerSupportFunction(lpEcb->ConnID, HSE_REQ_SET_FLUSH_FLAG, (LPVOID) TRUE, NULL, NULL);\n\nIn \"DWORD WINAPI HttpExtensionProc(LPEXTENSION_CONTROL_BLOCK lpEcb)\" it fixes the issue.\n\nI don't have a patch to attach (though if encouraged I can look into getting one) but I propose to introduce a registry setting that controls this flag. The default value of it can be debated but at least it will give the ability to work around the problems with use case described above.\n\n\n[1] https://support.microsoft.com/en-us/kb/946086", "id": 186378, "time": "2015-11-13T17:18:25Z", "creator": "stanchev@hotmail.com", "creation_time": "2015-11-13T17:18:25Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 58608, "attachment_id": null, "text": "This has been fixed in trunk for 1.2.42 onwards with a new option called \"flush_packets\".", "id": 193747, "time": "2016-09-15T14:13:13Z", "creator": "markt@apache.org", "creation_time": "2016-09-15T14:13:13Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "As a downstream we(Fedora) modify a number of the Tomcat jars to add OSGi metadata in them. You can see them here http://pkgs.fedoraproject.org/gitweb/?p=tomcat.git;a=tree . But the process is really error prone and somethimes versions go out of sync. It would be really cool if this metadata is properly generated by the buildsystem.", "is_private": false, "bug_id": 52381, "id": 152369, "time": "2011-12-22T12:28:15Z", "creator": "akurtakov@gmail.com", "creation_time": "2011-12-22T12:28:15Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 52381, "attachment_id": null, "text": "The manifests used aren't good enough for inclusion but I'll try to come with something better after vacation.", "id": 152370, "time": "2011-12-22T12:40:36Z", "creator": "akurtakov@gmail.com", "creation_time": "2011-12-22T12:40:36Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 52381, "is_private": false, "count": 2, "id": 152386, "time": "2011-12-23T21:27:07Z", "creator": "markt@apache.org", "creation_time": "2011-12-23T21:27:07Z", "text": "Not knowing much about OSGI, if you could provide suitable manifests that would be great. Once we have them, plugging them into the build is relatively simple."}, {"count": 3, "tags": [], "bug_id": 52381, "text": "Marking as an enhancement.", "id": 152469, "time": "2011-12-29T20:11:43Z", "creator": "markt@apache.org", "creation_time": "2011-12-29T20:11:43Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "This is a very important issue for us too, because of our Apache Karaf environment. See bugs 52318 and 52429", "attachment_id": null, "id": 152590, "creator": "ssku4eto@web.de", "time": "2012-01-05T12:45:51Z", "bug_id": 52381, "creation_time": "2012-01-05T12:45:51Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 52381, "is_private": false, "count": 5, "id": 152734, "time": "2012-01-12T21:49:43Z", "creator": "violetagg@apache.org", "creation_time": "2012-01-12T21:49:43Z", "text": "Hello,\n\nIn Eclipse Virgo we add OSGi metadata using Bundlor. The process is pretty straightforward and we have projects that do that stuff. Unfortunately we do not add OSGi metadata for every Apache Tomcat release but only for those that we include in Eclipse Virgo.\n\nThe artifacts are available through EBR. Here they are:\n\nhttp://ebr.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.apache.catalina&version=7.0.23&searchType=bundlesByName&searchQuery=catalina\n\nhttp://ebr.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.apache.catalina.ha&version=7.0.23&searchType=bundlesByName&searchQuery=catalina\n\nhttp://ebr.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.apache.catalina.tribes&version=7.0.23&searchType=bundlesByName&searchQuery=catalina\n\nhttp://ebr.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.apache.coyote&version=7.0.23&searchType=bundlesByName&searchQuery=coyote\n\nhttp://ebr.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.apache.jasper&version=7.0.23&searchType=bundlesByName&searchQuery=jasper\n\nhttp://ebr.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.apache.el&version=7.0.23&searchType=bundlesBySymbolicName&searchQuery=org.apache.el\n\nhttp://ebr.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.apache.juli.extras&version=7.0.23&searchType=bundlesBySymbolicName&searchQuery=juli\n\nhttp://ebr.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.apache.tomcat.api&version=7.0.23&searchType=bundlesBySymbolicName&searchQuery=org.apache.tomcat\n\nhttp://ebr.springsource.com/repository/app/bundle/version/detail?name=com.springsource.org.apache.tomcat.util&version=7.0.23&searchType=bundlesBySymbolicName&searchQuery=org.apache.tomcat\n\nBest Regards\nVioleta Georgieva"}, {"count": 6, "tags": [], "bug_id": 52381, "text": "If OSGi metadata is added, I suggest also adding a basic test to Tomcat's build to check that the Tomcat bundle resolve. (I created a similar test for Spring and I recommend the approach of using Pax Exam - see https://jira.springsource.org/browse/SPR-8791).", "id": 153868, "time": "2012-02-17T11:17:56Z", "creator": "gnormington@vmware.com", "creation_time": "2012-02-17T11:17:56Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 52381, "text": "In order to avoid cyclic dependencies and yes servlet.jar is used in too many places so having dependencies to build its osgi metadata will be a big PITA I think that the simplest approach for building would be best - no bundlor, no pam-exam and etc.The manifest is just few key/value pairs in the manifest after all. This doesn't mean that tests/verification/etc. targets should not be added but the buildsystem itself should work without them.", "id": 153869, "time": "2012-02-17T11:21:59Z", "creator": "akurtakov@gmail.com", "creation_time": "2012-02-17T11:21:59Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 52381, "attachment_id": null, "text": "As far as I am aware, there is very little OSGI expertise amongst the Tomcat devs. What is really required for this enhancement is either:\n- a patch that generates the necessary meta data as part of the build script; or\n- a simple (no long words please) explanation of exactly what needs to be included in the meta data so someone with no OSGI understanding can generate it.", "id": 155152, "time": "2012-03-20T22:36:51Z", "creator": "markt@apache.org", "creation_time": "2012-03-20T22:36:51Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 52381, "text": "Very important for each bundle are the imports and exports sections in the MANIFEST file. We do this so:\n\n<plugin>\n\t<groupId>org.apache.felix</groupId>\n\t<artifactId>maven-bundle-plugin</artifactId>\n\t<version>2.3.4</version>\n\t<extensions>true</extensions>\n\t<configuration>\n        <instructions>\n\t\t<Require-Bundle />\n\t\t<Export-Package>our.package;version=\"${pom.version}\"\n                </Export-Package>\n\t\t<Import-Package>!our.package,org.springframework.aop;version=\"${spring.version}\",org.springframework.aop.framework;version=\"${spring.version}\",org.aopalliance.aop, *               </Import-Package>\n\t\t<Embed-Dependency>*;artifactId=postgresql,*;artifactId=tomcat-jdbc</Embed-Dependency>\n\t</instructions>\n\t</configuration>\n</plugin>\n\nEmbed-Dependency because postgresql and tomcat-jdbs are not correct bundles.", "id": 155164, "time": "2012-03-21T06:18:23Z", "creator": "ssku4eto@web.de", "creation_time": "2012-03-21T06:18:23Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 52381, "attachment_id": null, "id": 155216, "time": "2012-03-22T12:51:21Z", "creator": "ssku4eto@web.de", "creation_time": "2012-03-22T12:51:21Z", "is_private": false, "text": "if you need a more detailed POM ... i will submit a complete one :)"}, {"count": 11, "tags": [], "bug_id": 52381, "text": "The POM is no use since Tomcat is not built with Maven. What is required is details of what needs to go into the manifests.", "id": 155217, "time": "2012-03-22T12:54:10Z", "creator": "markt@apache.org", "creation_time": "2012-03-22T12:54:10Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "ssku4eto@web.de", "attachment_id": null, "id": 155220, "time": "2012-03-22T13:18:20Z", "bug_id": 52381, "creation_time": "2012-03-22T13:18:20Z", "is_private": false, "text": "All dependencies (imports) you need in a project, should be in Import-Package:\nAll packages you want to expose (make them public), should be in Export-Package: \n\nIn the OSGI way you can expose throgh the Export-Package only that what you want to be public. In the sample MANIFEST we are exposing only our interfaces without exposing the implementation. Sooo no external package running in Karaf can access the implementation.\n\n\nSample MANIFEST:\n\nManifest-Version: 1.0\nExport-Package: our.package;version=\"0.0.1.SNAPSHOT\"\nBundle-ClassPath: .,postgresql-9.0-801.jdbc4.jar,tomcat-jdbc-7.0.22.jar\nBuilt-By: hudson\nTool: Bnd-1.15.0\nBundle-Name: our.package\nCreated-By: Apache Maven Bundle Plugin\nBuild-Jdk: 1.6.0_21\nBundle-Version: 0.0.1.SNAPSHOT\nBnd-LastModified: 1330958118424\nBundle-ManifestVersion: 2\nEmbed-Dependency: *;artifactId=postgresql,*;artifactId=tomcat-jdbc\nImport-Package: org.springframework.jdbc.core.namedparam;version=\"[3\n .0,4)\",org.springframework.jdbc.core.simple;version=\"[3.0,4)\",org.spr\n ingframework.jdbc.datasource;version=\"[3.0,4)\",org.springframework.tr\n ansaction.annotation;version=\"[3.0,4)\",org.w3c.dom,org.xml.sax\nBundle-SymbolicName: our.package"}, {"count": 13, "tags": [], "bug_id": 52381, "attachment_id": 35625, "id": 202871, "time": "2017-12-20T21:59:05Z", "creator": "csutherl@apache.org", "creation_time": "2017-12-20T21:59:05Z", "is_private": false, "text": "Created attachment 35625\nAttempt to add OSGi metadata\n\nBack on 2011-09-06 Roland Grunberg added the OSGi manifests that are used in the Fedora-generated Tomcat JARs today (see http://pkgs.fedoraproject.org/cgit/rpms/tomcat.git/tree/ for more details). I see now that those are outdated (old spec versions and such) so I'll update them at some point. Using those as an example of what's required, I updated the templates found in res/META-INF/*.manifest to add the OSGi metadata and added a few new manifests that include OSGi metadata in the manner discussed in previous comments (not using bundlor, or anything special). Hopefully this is correct...\n\nDisclaimer: I don't know much about OSGi, have no way to test this, and it seems that nobody is using the Fedora ones because there is incorrect information in them, so they may be wrong."}, {"count": 14, "tags": [], "creator": "violetagg@apache.org", "text": "(In reply to Coty Sutherland from comment #13)\n> Created attachment 35625 [details]\n> Attempt to add OSGi metadata\n> \n> Back on 2011-09-06 Roland Grunberg added the OSGi manifests that are used in\n> the Fedora-generated Tomcat JARs today (see\n> http://pkgs.fedoraproject.org/cgit/rpms/tomcat.git/tree/ for more details).\n> I see now that those are outdated (old spec versions and such) so I'll\n> update them at some point. Using those as an example of what's required, I\n> updated the templates found in res/META-INF/*.manifest to add the OSGi\n> metadata and added a few new manifests that include OSGi metadata in the\n> manner discussed in previous comments (not using bundlor, or anything\n> special). Hopefully this is correct...\n> \n> Disclaimer: I don't know much about OSGi, have no way to test this, and it\n> seems that nobody is using the Fedora ones because there is incorrect\n> information in them, so they may be wrong.\n\nHi Coty,\n\nI'm can help with OSGi (I'm committer in Gemini Web - OSGi web container reference implementation). Tomcat version 8.5.16 is the latest version that I have with OSGi meta data.\nHowever every project has its own understanding what should be included in the OSGi meta data.\n\nRegards,\nVioleta", "id": 202872, "time": "2017-12-20T22:50:03Z", "bug_id": 52381, "creation_time": "2017-12-20T22:50:03Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 52381, "text": "Any thoughts on the patch? It's a rough draft and I should replace all the hard coded spec version info with dynamic stuff, but as far as using these manifests as a template to fill in other info, does that look OK to anyone/everyone? I don't see any other easy alternative to generate this info except maybe Apache Ivy, which has an experimental OSGi bundle thingy.", "id": 203471, "time": "2018-01-24T20:46:41Z", "creator": "csutherl@apache.org", "creation_time": "2018-01-24T20:46:41Z", "is_private": false, "attachment_id": null}]
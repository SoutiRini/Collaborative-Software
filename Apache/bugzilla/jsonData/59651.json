[{"count": 0, "tags": [], "text": "Web app generates both JSESSIONID and csrftoken as cookies.\n\nAdd HTTP Cookie Manager\nSettings:\nClear Cookies each iteration\nPolicy = compatibiloty\nImplementation = HC3CookieHandler\n\nIn HTTP Request add parameter\nName = csrftoken\nValue = ${COOKIE_csrftoken}\n\nWhen running this test in JMeter 2.13 the csrftoken variable is resolving as expected and the request succeeds.\n\nWhen running this test plan in JMeter 3.0 the csrftoken variable is not being resolved and the request fails.", "attachment_id": null, "id": 191350, "creator": "jfo.sqa@gmail.com", "time": "2016-06-01T18:00:29Z", "bug_id": 59651, "creation_time": "2016-06-01T18:00:29Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59651, "attachment_id": null, "id": 191351, "time": "2016-06-01T18:07:26Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-06-01T18:07:26Z", "is_private": false, "text": "Did you select standard policy with hc4cookiehandler in 3.0 ?\n\nIf not that is probably your problem.\n\nRegards\nPhilippe M."}, {"count": 2, "tags": [], "bug_id": 59651, "attachment_id": null, "id": 191352, "time": "2016-06-01T18:10:33Z", "creator": "jfo.sqa@gmail.com", "creation_time": "2016-06-01T18:10:33Z", "is_private": false, "text": "Yes, I've set Implementation = HC4CookieHandler and Policy = standard."}, {"count": 3, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "can you attach your simplified test plan and also response that you receive from server including headers.\nPlease also attach jmeter.log", "id": 191354, "time": "2016-06-01T18:31:04Z", "bug_id": 59651, "creation_time": "2016-06-01T18:31:04Z", "is_private": false}, {"count": 4, "tags": [], "creator": "jfo.sqa@gmail.com", "attachment_id": 33905, "text": "Created attachment 33905\njmeter3_logfile", "id": 191355, "time": "2016-06-01T18:46:04Z", "bug_id": 59651, "creation_time": "2016-06-01T18:46:04Z", "is_private": false}, {"count": 5, "tags": [], "creator": "jfo.sqa@gmail.com", "attachment_id": 33906, "text": "Created attachment 33906\nsimplified_login_testplan", "id": 191356, "time": "2016-06-01T18:48:58Z", "bug_id": 59651, "creation_time": "2016-06-01T18:48:58Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 59651, "is_private": false, "id": 191357, "time": "2016-06-01T19:06:24Z", "creator": "jfo.sqa@gmail.com", "creation_time": "2016-06-01T19:06:24Z", "tags": [], "text": "In test plan HTTP Req 12 = the Initial Login, JSESSIONID is generated. Req 49 is where the csrftoken is added to the cookie. \nReq 48 is where the csrftoken is used and is failing\n\nSamplerProperties:\nHTTPSampler.DO_MULTIPART_POST=false\nHTTPSampler.auto_redirects=false\nHTTPSampler.concurrentPool=4\nHTTPSampler.connect_timeout=\nHTTPSampler.contentEncoding=\nHTTPSampler.cookie_manager=org.apache.jmeter.protocol.http.control.CookieManager@3aadf3f1\nHTTPSampler.domain=localhost\nHTTPSampler.embedded_url_re=\nHTTPSampler.follow_redirects=true\nHTTPSampler.header_manager=org.apache.jmeter.protocol.http.control.HeaderManager@4f72a9aa\nHTTPSampler.method=GET\nHTTPSampler.monitor=false\nHTTPSampler.path=/vestmark/servlet/viviport/action/Dispatcher/nocacheid/1464806184676/hsid/6f4f91d064c788355b1bc64dd0514e09\nHTTPSampler.port=8080\nHTTPSampler.protocol=http\nHTTPSampler.response_timeout=\nHTTPSampler.use_keepalive=true\nHTTPsampler.Arguments=componentType=portlet.application.console()&componentId=1269()&componentAction=getDashboard()&widgetListId=primaryTab2-WidgetList()&csrftoken=${COOKIE_csrftoken}()\nTestElement.enabled=true\nTestElement.gui_class=org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui\nTestElement.name=48 /vestmark/servlet/viviport/action/Dispatcher/nocacheid/1463515254913/hsid/25c82edb13162cfee0b568733f381575\nTestElement.test_class=org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy\nTestPlan.comments="}, {"count": 7, "tags": [], "text": "Thanks but in order to investigate, we need to have the >>>>>response<<<< headers of request that contains the CSRF Token, not the one that uses the COOKIE_csrftoken.", "attachment_id": null, "id": 191359, "creation_time": "2016-06-01T19:33:57Z", "time": "2016-06-01T19:33:57Z", "creator": "p.mouawad@ubik-ingenierie.com", "bug_id": 59651, "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 59651, "is_private": false, "id": 191361, "time": "2016-06-01T19:46:26Z", "creator": "jfo.sqa@gmail.com", "creation_time": "2016-06-01T19:46:26Z", "tags": [], "text": "This is the response header for the thread that returns the csrftoken:\n\nResponse headers:\nHTTP/1.1 200 OK\nServer: Apache-Coyote/1.1\nAccept-Ranges: bytes\nETag: W/\"61-1464269441221\"\nLast-Modified: Thu, 26 May 2016 13:30:41 GMT\nContent-Type: text/html\nContent-Length: 61\nDate: Wed, 01 Jun 2016 19:37:35 GMT\n\nThis is in the request header for that thread:\nConnection\tkeep-alive\n\nAccept-Language\ten-US,en;q=0.5\nAccept-Encoding\tgzip, deflate\nUser-Agent\tMozilla/5.0 (Windows NT 6.1; WOW64; rv:44.0) Gecko/20100101 Firefox/44.0\nAccept\ttext/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nHost\ttest0007:8080\nCookie\tJSESSIONID=34094CB68585965386B657E81D335C0E.node01; csrftoken=fof9y7Jehr0EQgQuOhfj6PSGMmDCpKGBuCqKKth1cmaltKQbaTltBeWhR89ZDwWW4wHQYJ54ZRMXR1oVBHTfp1G"}, {"count": 9, "tags": [], "text": "Did you set in user.properties:\n\nCookieManager.save.cookies=true", "attachment_id": null, "id": 191362, "creator": "p.mouawad@ubik-ingenierie.com", "time": "2016-06-01T19:50:32Z", "bug_id": 59651, "creation_time": "2016-06-01T19:50:32Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 59651, "text": "That was it, I neglected to update my user.properties file when updating. Sorry for the static.", "id": 191363, "time": "2016-06-01T19:56:21Z", "creator": "jfo.sqa@gmail.com", "creation_time": "2016-06-01T19:56:21Z", "is_private": false, "attachment_id": null}]
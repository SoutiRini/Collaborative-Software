[{"count": 0, "tags": [], "creator": "alex@apache.org", "text": "Currently the shutdown script (\"shutdown.sh\" or \"catalina.sh\nshutdown\") connects to Tomcat, tells it to shut down, then immediately\nexits.  It would be desirable if there were a mode in which it delayed\nexiting until all webapps were completely shut down and no aspect of\nthe server were able to accept TCP or HTTP requests.\n\nBonus points if it provided feedback during the shutdown process,\nannouncing mesages like \"Beginning to stop context foo\" and \"Finished\nstopping context foo\" and \"Tomcat completely shut down\".\n\nMotivation: I have been using Tomcat in a testing mode, where I launch\nTomcat, run my tests, and then shut Tomcat down.  Prior to launching\nTomcat, I need to shut down any *already-running* instances.  However,\nsince the time required to *really* shut down is variable, I often\nmisjudge the timing and end up launching the new instance before the\nold one is shut down.  This leads to an unclean startup for the new\ninstance, due to (I presume) port conflicts.  If, instead, the\nshutdown script did not exit until shutdown of the old instance were\n*complete* (and not just started), I would be assured of a clean\nstartup for the new instance.\n\nA simple implementation of this would just \"ping\" the control port,\nexiting only when the port is closed.  Would that work, or is it\npossible that the control port is closed (no longer accepting\nrequests) but one or more contexts are still active?\n\nI have been off the Tomcat team for a while, but if this feature is\ndesirable, and a current developer wants to point me in the right\ndirection, please let me know and I'll see if I can take a stab at\nwriting a patch myself.", "id": 21141, "time": "2002-08-15T23:39:56Z", "bug_id": 11754, "creation_time": "2002-08-15T23:39:56Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 11754, "attachment_id": null, "is_private": false, "id": 21154, "time": "2002-08-16T09:05:57Z", "creator": "remm@apache.org", "creation_time": "2002-08-16T09:05:57Z", "text": "\n\n*** This bug has been marked as a duplicate of 11753 ***"}, {"count": 2, "tags": [], "bug_id": 11754, "attachment_id": null, "is_private": false, "id": 21175, "time": "2002-08-16T18:49:39Z", "creator": "remm@apache.org", "creation_time": "2002-08-16T18:49:39Z", "text": "I closed that by accident."}, {"count": 3, "tags": [], "bug_id": 11754, "text": "Anders Madsen posts the following workaround for Linux (tomcat-dev, 19 Aug 2002).  \n\nNote that this is merely a patch for the init.d script.  A solution built in to\nthe stop script itself would be more versatile.\n\n---\n\n\nFrom: \"Golden Planet Support\" <support@goldenplanet.dk>                        \n                                                                       \nOrganization: Golden Planet                                                    \n                                                                        To:\ntomcat-dev@jakarta.apache.org                                                  \n                                                                    Date: Mon,\n19 Aug 2002 09:57:31 +0200                                                     \n                                                             Subject: Modified\n\"stop\"-script for Linux                                                        \n                                                      Priority: normal         \n                                                                               \n                                              X-mailer: Pegasus Mail for Windows\n(v4.01)                                                                        \n                                     X-Spam-Rating: daedalus.apache.org 1.6.2\n0/1000/N                                                                       \n                               \nHello All\n\nI have noticed that the /etc/init.d/tomcat4 script still contains\nwhat is described as an \"Ugly hack\" - a short two second pause when\nrestarting the service instead of something that confirms that all\nthreads have been shut down.\n\nA while ago I modified my own script to conatain the following lines -\n perhaps they could be of some use for others, I don't know. I am by\nno means an experienced coder so please bear with me if this is not\nthe most elegant solution - it just works for me... ;-)\n\nstop() {\n    echo -n \"Stopping $TOMCAT_PROG: \"\n    if [ -x /etc/rc.d/init.d/functions ]; then\n        daemon --user $TOMCAT_USER $TOMCAT_SCRIPT stop\n    else\n        su - $TOMCAT_USER -c \"$TOMCAT_SCRIPT stop\"\n    fi\n    RETVAL=$?\n    echo\n\n    echo 'Waiting for java threads to finish...'\n    threads=1\n    until [ $threads = '0' ]\n                do\n                ps -aux | grep $TOMCAT_USER -c > /tmp/threads\n                read threads < /tmp/threads\n    done\n    rm -f /tmp/threads\n    echo 'Java threads cleaned up - shutdown complete.'\n\n    [ $RETVAL = 0 ] && rm -f /var/lock/subsys/tomcat4\n/var/run/tomcat4.pid\n}                                                                              \n                                                                        \nThe above works on a x86 RedHat 7.1 - I don't know if things may work\ndifferently on other systems.\n\n---\n\n", "id": 21304, "time": "2002-08-19T18:13:47Z", "creator": "alex@apache.org", "creation_time": "2002-08-19T18:13:47Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 11754, "text": "*** Bug 12018 has been marked as a duplicate of this bug. ***", "id": 21700, "time": "2002-08-25T02:52:40Z", "creator": "alex@apache.org", "creation_time": "2002-08-25T02:52:40Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 11754, "text": "You can do this in Tomcat 7 if you specify a PID file.", "id": 142751, "time": "2010-12-15T13:00:46Z", "creator": "markt@apache.org", "creation_time": "2010-12-15T13:00:46Z", "tags": [], "is_private": false}]
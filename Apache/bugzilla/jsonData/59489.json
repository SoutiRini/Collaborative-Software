[{"count": 0, "tags": [], "bug_id": 59489, "attachment_id": null, "text": "Hello,\nWe have an issue in current 3.0 rc4 as seen by Rainer :\n- https://issues.apache.org/jira/browse/HTTPCLIENT-1742\n\nThe issue is due to a behavioral change in HttpClient 4.5.2 vs httpclient-4.2.6:\n\n    ResponseContentEncoding removes 3 headers from Response : Content-Encoding, Content-Length, Content-MD5\n    JMeter uses DefaultRequestDirector which is replaced by MainClientExec\n\n\nNow here is what happens:\n\nAt this line, PostProcessor run , leading to removal of 3 headers\n\n    https://github.com/apache/httpclient/blob/4.5.x/httpclient/src/main/java-deprecated/org/apache/http/impl/client/DefaultRequestDirector.java#L496\n\nAt the next line, keepAlive management is run, but it's too late as headers have been removed:\n\n    https://github.com/apache/httpclient/blob/4.5.x/httpclient/src/main/java-deprecated/org/apache/http/impl/client/DefaultRequestDirector.java#L500\n\n\nWhile in new HC Class ProtocolExec:\n\nThe keepAlive is managed in this\n\nhttps://github.com/apache/httpclient/blob/4.5.x/httpclient/src/main/java/org/apache/http/impl/execchain/ProtocolExec.java#L184\n\nWhich calls this:\n\nhttps://github.com/apache/httpclient/blob/4.5.x/httpclient/src/main/java/org/apache/http/impl/execchain/MainClientExec.java#L274\n\nAnd Compression is managed afterwards in :\n\nhttps://github.com/apache/httpclient/blob/4.5.x/httpclient/src/main/java/org/apache/http/impl/execchain/ProtocolExec.java#L189\n\n\nSo no issue in HC4.5.2, but in JMeter. I think it's unfortunately a stopper for the release.\n\nBreaking KeepAlive is a big issue", "id": 190858, "time": "2016-05-11T20:42:23Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-05-11T20:42:23Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59489, "text": "As per the dev list:\n\nA much simpler way to restore the headers would\nbe to save them, call the parent method, then restore them.\n\nNo need to mess around with the context.\n\nBasically that would revert the change made to HC4.5.", "id": 190859, "time": "2016-05-11T20:45:53Z", "creator": "sebb@apache.org", "creation_time": "2016-05-11T20:45:53Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 59489, "attachment_id": null, "id": 190861, "time": "2016-05-11T21:09:58Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-05-11T21:09:58Z", "is_private": false, "text": "Author: pmouawad\nDate: Wed May 11 21:09:00 2016\nNew Revision: 1743429\n\nURL: http://svn.apache.org/viewvc?rev=1743429&view=rev\nLog:\nBug 59489 - Regression in JMeter 3.0 : Compressed responses break keepalive management\nBugzilla Id: 59489\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java"}, {"count": 3, "tags": [], "bug_id": 59489, "attachment_id": null, "text": "Author: pmouawad\nDate: Thu May 12 06:09:21 2016\nNew Revision: 1743467\n\nURL: http://svn.apache.org/viewvc?rev=1743467&view=rev\nLog:\nBug 59489 - Regression in JMeter 3.0 : Compressed responses break keepalive management\nTake into account sebb note\nINstanciate ArrayList only when needed\nBugzilla Id: 59489\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java", "id": 190913, "time": "2016-05-12T19:10:51Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-05-12T19:10:51Z", "is_private": false}]
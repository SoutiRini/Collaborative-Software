[{"attachment_id": null, "tags": [], "bug_id": 49771, "text": "After a graceful restart of our RHEL 5.5's Apache 2.2\n(httpd-2.2.3-43.el5.x86_64), all four of our webservers complained that:\n\n[Tue Aug 17 08:48:54 2010] [notice] Graceful restart requested, doing restart\n[Tue Aug 17 09:28:41 2010] [error] (111)Connection refused: proxy: AJP: attempt\nto connect to 128.227.74.27:8000 (sakaiapp-prod06.osg.ufl.edu) failed\n[Tue Aug 17 09:28:41 2010] [error] ap_proxy_connect_backend disabling worker\nfor (sakaiapp-prod06.osg.ufl.edu)\n[Tue Aug 17 09:28:41 2010] [error] proxy: AJP: failed to make connection to\nbackend: sakaiapp-prod06.osg.ufl.edu\n[Tue Aug 17 09:28:41 2010] [error] proxy: BALANCER:\n(balancer://elearning2.courses.ufl.edu). All workers are in error state for\nroute (sakaiapp-prod05.osg.ufl.edu)\n[Tue Aug 17 09:32:00 2010] [error] (111)Connection refused: proxy: AJP: attempt\nto connect to 128.227.74.13:8000 (sakaiapp-prod04.osg.ufl.edu) failed\n[Tue Aug 17 09:32:00 2010] [error] ap_proxy_connect_backend disabling worker\nfor (sakaiapp-prod04.osg.ufl.edu)\n[Tue Aug 17 09:32:00 2010] [error] proxy: AJP: failed to make connection to\nbackend: sakaiapp-prod04.osg.ufl.edu\n[Tue Aug 17 09:32:00 2010] [error] proxy: BALANCER:\n(balancer://elearning2.courses.ufl.edu). All workers are in error state for\nroute (sakaiapp-prod03.osg.ufl.edu)\n\n\nIn the Tomcat 5.5.30 logs, we saw hundreds of:\n2010-08-17 09:00:34.601 [ERROR] org.apache.coyote.ajp.AjpMessage:239 - Cannot\nappend null value\njava.lang.NullPointerException\n        at org.apache.coyote.ajp.AjpMessage.appendString(AjpMessage.java:239)\n        at org.apache.coyote.ajp.AjpMessage.appendBytes(AjpMessage.java:175)\n        at\norg.apache.coyote.ajp.AjpAprProcessor.prepareResponse(AjpAprProcessor.java:1005)\n        at\norg.apache.coyote.ajp.AjpAprProcessor.action(AjpAprProcessor.java:510)\n        at org.apache.coyote.Response.action(Response.java:183)\n        at org.apache.coyote.Response.sendHeaders(Response.java:379)\n        at\norg.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:313)\n        at\norg.apache.catalina.connector.OutputBuffer.close(OutputBuffer.java:280)\n        at\norg.apache.catalina.connector.Response.finishResponse(Response.java:484)\n        at\norg.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:177)\n        at\norg.apache.coyote.ajp.AjpAprProcessor.process(AjpAprProcessor.java:444)\n        at\norg.apache.coyote.ajp.AjpAprProtocol$AjpConnectionHandler.process(AjpAprProtocol.java:472)\n        at\norg.apache.tomcat.util.net.AprEndpoint$Worker.run(AprEndpoint.java:1293)\n        at java.lang.Thread.run(Thread.java:619)\n\nAll I can figure is that this a bug in the AJP connector on the Tomcat side,\nthough doing a 'real' (i.e. not graceful) restart of Apache httpd fixed the\nissue. I'm submitting the issue to the Apache side as well, though, since a full restart fixed it.\n\nThe only change during the graceful was editing the balancer members of an unused vhost.", "count": 0, "id": 139180, "time": "2010-08-17T19:01:31Z", "creator": "martin@mbs3.org", "creation_time": "2010-08-17T19:01:31Z", "is_private": false}]
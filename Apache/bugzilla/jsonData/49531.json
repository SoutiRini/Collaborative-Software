[{"count": 0, "tags": [], "creator": "yokubo@takedasd.com", "is_private": false, "id": 138037, "attachment_id": 25672, "bug_id": 49531, "creation_time": "2010-06-30T17:03:46Z", "time": "2010-06-30T17:03:46Z", "text": "Created attachment 25672\nlog\n\nTomcat 6.0.18, 20, 24, 26\nOS:  Linux  2.6.18-194.3.1.el5 #1 SMP Sun May 2 04:17:42 EDT 2010 x86_64 x86_64 x86_64 GNU/Linux\nJdk 1.6.0_20\n\nWhen the node shuts down and destroys the context, singlesignon removes sessions created for the context.  Then, DeltaSession.expire() method is called and then calls super.exire() method.   This sequence of events signals to the listeners and one of listeners sends the message to SimpleTpcCluster that propagates the message to other nodes in the same cluster.  Therefore, sso session will be removed from other nodes upon shutdown.\n\nI would like to request an enhancement that both sso session and regular session identifiers should be retained on other nodes upon the node shutdown.\n\n\n== DeltaSession.java ==\n    public void expire(boolean notify, boolean notifyCluster) {\n        if (expiring)\n            return;\n        String expiredId = getIdInternal();\n    \n        if(expiredId != null && manager != null &&\n           manager instanceof DeltaManager) {\n           DeltaManager dmanager = (DeltaManager)manager;\t\t   \n              CatalinaCluster cluster = dmanager.getCluster();\n              ClusterMessage msg = dmanager.requestCompleted(expiredId, true);\n              if (msg != null) {\n                 if(dmanager.doDomainReplication()) {\n                    cluster.sendClusterDomain(msg);\n                 } else {\n                    cluster.send(msg);\n                 }\n              }\n        }\n        \n        super.expire(notify);\n\n        if (notifyCluster) {\n            if (log.isDebugEnabled())\n                log.debug(sm.getString(\"deltaSession.notifying\",\n                                       ((ClusterManager)manager).getName(), \n                                       new Boolean(isPrimarySession()), \n                                       expiredId));\t\t\t\t\t\t\t    \n            if ( manager instanceof DeltaManager ) {\n                ( (DeltaManager) manager).sessionExpired(expiredId);\n            }\n        }\n    }"}, {"count": 1, "tags": [], "bug_id": 49531, "attachment_id": null, "id": 199531, "time": "2017-07-03T12:40:31Z", "creator": "markt@apache.org", "creation_time": "2017-07-03T12:40:31Z", "is_private": false, "text": "Tested with the latest 7.0.x code and this works as expected. The session is not lost when the current node shuts down. The user is transferred to another node and the session (and the single sign on) is maintained."}]
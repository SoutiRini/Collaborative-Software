[{"count": 0, "tags": [], "text": "It is impossible to interrupt() a FileWatchdog from outside.\nIn method run the catch does nothing and should be enhanced by two lines:\n\n  public\n  void run() {    \n    while(!interrupted) {\n      try {\n\tThread.currentThread().sleep(delay);\n      } catch(InterruptedException e) {\n\t// no interruption expected\n        interrupted = true; // to be added!\n        break;              // to be added!\n      }\n      checkAndConfigure();\n    }\n  }", "is_private": false, "bug_id": 4913, "id": 7980, "time": "2001-11-16T02:27:11Z", "creator": "juergen.regel@tui.de", "creation_time": "2001-11-16T02:27:11Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "\nThe Watchdog architecture will be revisited in log4j 1.3.", "is_private": false, "bug_id": 4913, "id": 14797, "time": "2002-04-25T21:56:15Z", "creator": "ceki@apache.org", "creation_time": "2002-04-25T21:56:15Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 4913, "is_private": false, "text": "Created attachment 28705\nWebapp to demonstrate the filewatchdog leak", "id": 158720, "time": "2012-05-01T18:02:29Z", "creator": "apache@tomwitmer.com", "creation_time": "2012-05-01T18:02:29Z", "attachment_id": 28705}, {"count": 3, "tags": [], "bug_id": 4913, "text": "Ten years on, this is still an issue. I've attached a test case to reproduce the problem, and hopefully accelerate a fix.\n\nThe test case is a webapp that I deploy to Tomcat (v7.0.26 in my case) and configures logging. The webapp can be undeployed, but results in a leak because Log4j's Filewatchdog thread is still running, despite the explicit call to LogManager.shutdown() in the ContextListener.\n\nTo Reproduce:\n1) Install Tomcat with the manager application (not covered here)\n2) Build the attached webapp (Ant)\n3) Deploy the LeakyWeb.war file to Tomcat, either via Tomcat's manager application, or by dropping the war file into the \"webapps\" directory.\n4) [Optional] Visit http://localhost:8080/LeakyWeb to view the \"Success\" method.\n5) Use Tomcat's manager application to undeploy the webapp.\n5a) Note this error message from Tcomat:\n\nMay 1, 2012 11:43:08 AM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads\nSEVERE: The web application [/LeakyWeb] appears to have started a thread named [FileWatchdog] but has failed to stop it. This is very likely to create a memory leak.\n\n6) Alternatively, press the \"Find Leaks\" button in Tomcat's manager application to see the same information.\n\n\nDESIRED OUTCOME:\nInvoking LogManager.shutdown() should interrupt and shut down any watchdog threads that were started by the associated configurer (PropertyConfigurer in this case.)\n\nNaturally this same problem applies to the XML config files as well.", "id": 158721, "time": "2012-05-01T18:03:18Z", "creator": "apache@tomwitmer.com", "creation_time": "2012-05-01T18:03:18Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "wow... ten years and seems as it could be fixed with 2 lines?\nWhen I ever manage to release 1.2.17 I will put this issue on my list for 1.2.18", "is_private": false, "bug_id": 4913, "id": 158722, "time": "2012-05-01T19:35:20Z", "creator": "grobmeier@gmail.com", "creation_time": "2012-05-01T19:35:20Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 4913, "text": "The two-line change is a good start, but wouldn't cause the watchdog threads to stop when LogManager.shutdown() is invoked.", "id": 158725, "time": "2012-05-01T21:24:36Z", "creator": "apache@tomwitmer.com", "creation_time": "2012-05-01T21:24:36Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 4913, "is_private": false, "text": "Thanks. All suggestions etc from your side welcome.\n\nI will look at the shutdown method pretty soonish as I suspect it should clear the MDC stuff too. I can then try to dig into the filewatchdog too.\n\nAnyway, if you want to help, you are welcome :-)", "id": 158728, "time": "2012-05-02T05:44:50Z", "creator": "grobmeier@gmail.com", "creation_time": "2012-05-02T05:44:50Z", "attachment_id": null}, {"count": 7, "attachment_id": null, "creator": "juergen.regel@tui.de", "is_private": false, "id": 158733, "time": "2012-05-02T08:16:54Z", "bug_id": 4913, "creation_time": "2012-05-02T08:16:54Z", "tags": [], "text": "As the originator of this bug I'm very glad to see that someone is working on it after more than ten years ...\nAnd I'll have a look at the old bugs assigned to me.\n\nJ\u00fcrgen M. Regel, TUI-InfoTec, Hannover, Germany"}, {"count": 8, "tags": [], "bug_id": 4913, "text": "Thank you J\u00fcrgen.\n\nFeel free to ping me / us on the log4j-dev mailinglist if you want to discuss.", "id": 158734, "time": "2012-05-02T08:21:18Z", "creator": "grobmeier@gmail.com", "creation_time": "2012-05-02T08:21:18Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 4913, "is_private": false, "text": "Created attachment 29103\nPatch to end FileWatchdog threads when log4j is shut down\n\nI've attached a patch that works for me. Patch is against the 1.2.17 tag in svn.", "id": 160848, "time": "2012-07-24T04:55:23Z", "creator": "petefeltham.dev@internode.on.net", "creation_time": "2012-07-24T04:55:23Z", "attachment_id": 29103}, {"count": 10, "tags": [], "bug_id": 4913, "text": "As I see in Pete Feltham's  attachment 29103, a solution much better than my quick-and-dirty fix ten years ago has been found. Even if my server, where the problem arose, is still running without changes and issues for some years, I am not able to verify this now and have confidence in your solution. I'll migrate to the new version of log4j when my program has to be changed again.", "id": 161018, "time": "2012-07-31T07:07:44Z", "creator": "juergen.regel@tui.de", "creation_time": "2012-07-31T07:07:44Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 4913, "text": "attachment 29103's target milestone is 1.2.18. Is there any target release date for 1.2.18?", "id": 166363, "time": "2013-04-03T19:02:05Z", "creator": "seansong2004@gmail.com", "creation_time": "2013-04-03T19:02:05Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "grobmeier@gmail.com", "attachment_id": null, "text": "not yet, i hope i can find some time in may", "id": 166505, "time": "2013-04-10T05:15:00Z", "bug_id": 4913, "creation_time": "2013-04-10T05:15:00Z", "is_private": false}, {"count": 13, "tags": [], "creator": "Alexander@Kriegisch.name", "attachment_id": null, "text": "Please?! 12 years for such a small issue? What is the problem? Is it so hard to commit the patch and retest? How can any developer be so ignorant toward users? The people in my project (I am ta Scrum coach) actually decided to switch from Log4J to LogBack just because of this issue because SEVERE log messages in Tomcat which are created by this blocking thread keep ringing alarm bells in our operations team. They get woken up at night or on weekends whenever this happens during Tomcat shutdown. Compiling out own version of L4J is not an option, so we need to switch to a whole new logging framework.", "id": 169040, "time": "2013-08-02T14:06:39Z", "bug_id": 4913, "creation_time": "2013-08-02T14:06:39Z", "is_private": false}, {"count": 14, "tags": [], "creator": "Alexander@Kriegisch.name", "attachment_id": null, "text": "Sorry for the typos, I cannot edit my previous message.", "id": 169041, "time": "2013-08-02T14:08:40Z", "bug_id": 4913, "creation_time": "2013-08-02T14:08:40Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "romanws@gmail.com", "text": "Hi,\nAre there any plans of fixing this issue?\nThank you.\nRom\u00e1n", "count": 15, "id": 176268, "time": "2014-07-07T15:04:31Z", "bug_id": 4913, "creation_time": "2014-07-07T15:04:31Z", "is_private": false}, {"count": 16, "attachment_id": null, "creator": "garydgregory@gmail.com", "is_private": false, "id": 176270, "time": "2014-07-07T15:29:29Z", "bug_id": 4913, "creation_time": "2014-07-07T15:29:29Z", "tags": [], "text": "Can you switch to Log4j 2?\n\nLog4j 1 is not getting much attention as all our focus is on 2?"}, {"count": 17, "tags": [], "bug_id": 4913, "is_private": false, "text": "Hi all.\nI faced out with this problem today and migrating to the log4j 2, is too expensive for me... so I preferred to look the code and try to fix the problem.\n\nSo I added a method, that shutdown all FileWatchDog threads, callable from: \n\n    PropertyConfigurator.shutdown().\n\nFor me this works, and so I hope it will for you. Look at the attachment as log4j-1.2.18.jar.\n\nBest regards\n\nR. A.", "id": 177401, "time": "2014-08-27T13:07:17Z", "creator": "roberto.agostino@urmetsistemi.it", "creation_time": "2014-08-27T13:07:17Z", "attachment_id": null}, {"count": 18, "tags": [], "text": "Created attachment 31949\nTerminate the FileWatchDog threads from PropertyConfigurator.\n\nTo use the new function, call the PropertyConfigurator.shutdown() before exit from the application.\n\nNote: I suppose you called PropertyConfigurator.configure...(...) at the init of your application.", "is_private": false, "bug_id": 4913, "id": 177402, "time": "2014-08-27T13:11:36Z", "creator": "roberto.agostino@urmetsistemi.it", "creation_time": "2014-08-27T13:11:36Z", "attachment_id": 31949}, {"count": 19, "attachment_id": null, "bug_id": 4913, "is_private": false, "id": 177416, "time": "2014-08-28T06:20:56Z", "creator": "roberto.agostino@urmetsistemi.it", "creation_time": "2014-08-28T06:20:56Z", "tags": [], "text": "Good morning to all!\nI apologize for yesterday's post, but the rush to get a solution, I did not read all the posts and have found the solution to this only after my post. I think the best solution is previously provided, although the one contained in the library provided by me works. \nHave a good day and job. \nR.A."}, {"count": 20, "attachment_id": null, "creator": "garydgregory@gmail.com", "is_private": false, "id": 177423, "time": "2014-08-28T12:42:54Z", "bug_id": 4913, "creation_time": "2014-08-28T12:42:54Z", "tags": [], "text": "Keep in mind that the 1.x line is not actively maintained in favor of concentrating our efforts on 2.x."}, {"count": 21, "tags": [], "creator": "garydgregory@gmail.com", "attachment_id": null, "text": "You are correct, version 2.0.2 does not support the properties file format for configuration.", "id": 177437, "time": "2014-08-29T11:44:47Z", "bug_id": 4913, "creation_time": "2014-08-29T11:44:47Z", "is_private": false}]
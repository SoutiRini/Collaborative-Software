[{"count": 0, "tags": [], "bug_id": 55011, "text": "Logs are not written to new .log file after an old one was rolled by RollingFileAppender. Several messages appear in the new file, with a last entry timestamp nearly identical to log.gz file creation time and that is all. Logging resumes after tomcat restart.\nThis only happens to server.log file, specified in config below. Others work fine.\n\nLog4j version - 1.2.16\nTomcat version - 7.0.23\n\nLog4j config:\n\n<log4j:configuration xmlns:log4j=\"http://jakarta.apache.org/log4j/\" debug=\"false\">\n\n     <!-- File Appender -->\n     <appender name=\"FILE\" class=\"org.apache.log4j.rolling.RollingFileAppender\">\n          <param name=\"Append\" value=\"true\" />\n          <param name=\"File\" value=\"${catalina.base}/logs/server.log\" />\n          <rollingPolicy class=\"com.logging.AgingTimeBasedRollingFilePolicy\">\n               <param name=\"fileNamePattern\" value=\"${catalina.base}/logs/archive/server.%d{yyyy-MM-dd}.log.gz\" />\n               <param name=\"keepFilesForDays\" value=\"30\" />\n          </rollingPolicy> \n          <layout class=\"com.logging.jboss.WebappAwarePattern\">\n               <param name=\"ConversionPattern\" value=\"%d{ISO8601}{${server.localTimezone}} %p [%X{webapp}:%c{2}] %m%n\" />\n          </layout>\n     </appender>\n     \n     <!-- Console Appender -->\n     <appender name=\"CONSOLE\" class=\"org.apache.log4j.ConsoleAppender\">\n      \n          <param name=\"Target\" value=\"System.out\" />\n          <layout class=\"com.logging.jboss.WebappAwarePattern\">\n               <param name=\"ConversionPattern\" value=\"%d{ISO8601}{${server.localTimezone}} %p [%X{webapp}:%c] %m%n\" />\n          </layout>\n     </appender>\n     \n    <!-- Audit File Appender -->\n    <appender name=\"AUDIT-FILE\" class=\"org.apache.log4j.RollingFileAppender\">\n        <param name=\"Append\" value=\"true\" />\n        <param name=\"File\" value=\"${catalina.base}/logs//audit.log\" />\n        <param name=\"MaxBackupIndex\" value=\"10\" />\n        <layout class=\"com.logging.jboss.WebappAwarePattern\">\n             <param name=\"ConversionPattern\" value=\"%m%n\" />\n        </layout>\n    </appender>\n\n    <!-- Perf4J appenders -->\n    <appender name=\"CoalescingStatistics\" class=\"org.perf4j.log4j.AsyncCoalescingStatisticsAppender\">\n        <!-- 600000ms = 10 minutes -->\n        <param name=\"TimeSlice\" value=\"600000\"/>\n        <appender-ref ref=\"PERFFILE\"/>\n    </appender>\n    \n    <!-- This file appender is used to output aggregated performance statistics -->\n    <appender name=\"PERFFILE\" class=\"org.apache.log4j.rolling.RollingFileAppender\">\n        <param name=\"Append\" value=\"true\" />\n        <param name=\"File\" value=\"${catalina.base}/logs/performance.log\" />\n        <rollingPolicy class=\"com.logging.AgingTimeBasedRollingFilePolicy\">\n            <param name=\"fileNamePattern\" value=\"${catalina.base}/logs/archive/performance.%d{yyyy-MM-dd}.log.gz\" />\n            <param name=\"keepFilesForDays\" value=\"30\" />\n        </rollingPolicy>\n        <layout class=\"com.logging.jboss.WebappAwarePattern\">\n            <param name=\"ConversionPattern\" value=\"%d{ISO8601}{${server.localTimezone}} %p [%X{webapp}:%c{2}] %throwable{0} %m%n\" />\n        </layout>\n    </appender>\n    \n    <logger name=\"AUDIT_LOG\" additivity=\"false\">\n        <level value=\"TRACE\"/>\n        <appender-ref ref=\"AUDIT-FILE\"/>\n    </logger>\n    \n    <logger name=\"org.perf4j.TimingLogger\" additivity=\"false\">\n        <level value=\"INFO\"/>\n        <appender-ref ref=\"CoalescingStatistics\"/>\n    </logger>\n    ...\n     <!-- Anything else is logged as INFO -->\n     <root>\n          <priority value=\"INFO\" />\n          <appender-ref ref=\"FILE\" />\n     </root>\n</log4j:configuration>", "id": 167373, "time": "2013-05-23T12:03:59Z", "creator": "moon3854@yandex.ru", "creation_time": "2013-05-23T12:03:59Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "timofey.volkov@gmail.com", "text": "Dmitry, just in case:\n\nThere're also some suspicious messages at catalina.out shortly after tomcat startup:\n\nINFO: Initializing log4j from [file:///export0/home/tomcat/appconf/log4j.xml]\nlog4j:WARN Unrecognized element rollingPolicy\nlog4j:WARN Please set a rolling policy for the RollingFileAppender named 'PERFFILE'\nlog4j:WARN Unrecognized element rollingPolicy\nlog4j:WARN Please set a rolling policy for the RollingFileAppender named 'FILE'\n\nAnd when the actual log messages should print, I see the following:\n\nlog4j:ERROR No output stream or file set for the appender named [FILE].\nlog4j:ERROR No output stream or file set for the appender named [PERFFILE].", "id": 167776, "time": "2013-06-11T08:02:24Z", "bug_id": 55011, "creation_time": "2013-06-11T08:02:24Z", "tags": [], "is_private": false}]
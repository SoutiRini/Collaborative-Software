[{"count": 0, "tags": [], "creator": "shu.chen@oracle.com", "is_private": false, "text": "With Java 1.8.0_20-ea (http://jre.us.oracle.com/java/re/jdk/8u20/promoted/all/b15/bundles/windows-i586/jdk-8u20-ea-windows-i586.exe), we got a JSP compilation error as below.\n\nTomcat 6 & 7 both have compilation error when trying to interpret the following code in JSP: \n     str = str.replace(\"'\", @ \"\\\\'\").replace(\"\\\"\",\"\\\\\\\"\"); \n(str is a string here)\n . \n Below is the error message: \n  SEVERE: Compilation error \n org.eclipse.jdt.internal.compiler.classfmt.ClassFormatException \n         at \n org.eclipse.jdt.internal.compiler.classfmt.ClassFileReader.<init>(ClassFileRea \n der.java:342) \n         at \n org.apache.jasper.compiler.JDTCompiler$1.findType(JDTCompiler.java:206) \n         at \n org.apache.jasper.compiler.JDTCompiler$1.findType(JDTCompiler.java:163) \n         at \n org.eclipse.jdt.internal.compiler.lookup.LookupEnvironment.askForType(LookupEn \n vironment.java:96) \n         at \n org.eclipse.jdt.internal.compiler.lookup.UnresolvedReferenceBinding.resolve(Un \n resolvedReferenceBinding.java:49) \n         at \n org.eclipse.jdt.internal.compiler.lookup.BinaryTypeBinding.resolveType(BinaryT \n ypeBinding.java:131) \n         at \n org.eclipse.jdt.internal.compiler.lookup.BinaryTypeBinding.resolveTypesFor(Bin \n aryTypeBinding.java:903) \n         at \n org.eclipse.jdt.internal.compiler.lookup.BinaryTypeBinding.getExactMethod(Bina \n ryTypeBinding.java:705) \n         at \n org.eclipse.jdt.internal.compiler.lookup.Scope.findExactMethod(Scope.java:763) \n . \n         at \n org.eclipse.jdt.internal.compiler.lookup.Scope.getMethod(Scope.java:2057) \n         at \n org.eclipse.jdt.internal.compiler.ast.MessageSend.resolveType(MessageSend.java \n :417) \n         at \n org.eclipse.jdt.internal.compiler.ast.MessageSend.resolveType(MessageSend.java \n :334) \n         at \n org.eclipse.jdt.internal.compiler.ast.Assignment.resolveType(Assignment.java:1 \n 84) \n         at \n org.eclipse.jdt.internal.compiler.ast.Expression.resolve(Expression.java:906) \n         at \n org.eclipse.jdt.internal.compiler.ast.Block.resolve(Block.java:101) \n         at \n org.eclipse.jdt.internal.compiler.ast.IfStatement.resolve(IfStatement.java:233 \n ) \n         at \n org.eclipse.jdt.internal.compiler.ast.Block.resolve(Block.java:101) \n         at \n org.eclipse.jdt.internal.compiler.ast.IfStatement.resolve(IfStatement.java:233 \n ) \n         at \n org.eclipse.jdt.internal.compiler.ast.Block.resolveUsing(Block.java:115) \n         at \n org.eclipse.jdt.internal.compiler.ast.TryStatement.resolve(TryStatement.java:7 \n 99) \n         at \n org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.resolveStateme \n nts(AbstractMethodDeclaration.java:429) \n         at \n org.eclipse.jdt.internal.compiler.ast.MethodDeclaration.resolveStatements(Meth \n odDeclaration.java:196) \n         at \n org.eclipse.jdt.internal.compiler.ast.AbstractMethodDeclaration.resolve(Abstra \n ctMethodDeclaration.java:400) \n         at \n org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.resolve(TypeDeclaration. \n java:1085) \n         at \n org.eclipse.jdt.internal.compiler.ast.TypeDeclaration.resolve(TypeDeclaration. \n java:1164) \n         at \n org.eclipse.jdt.internal.compiler.ast.CompilationUnitDeclaration.resolve(Compi \n lationUnitDeclaration.java:366) \n         at \n org.eclipse.jdt.internal.compiler.Compiler.process(Compiler.java:623) \n         at \n org.eclipse.jdt.internal.compiler.Compiler.compile(Compiler.java:392) \n         at \n org.apache.jasper.compiler.JDTCompiler.generateClass(JDTCompiler.java:429) \n         at org.apache.jasper.compiler.Compiler.compile(Compiler.java:349) \n         at org.apache.jasper.compiler.Compiler.compile(Compiler.java:327) \n         at org.apache.jasper.compiler.Compiler.compile(Compiler.java:314) \n         at \n org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:592 \n ) \n         at \n org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:326 \n ) \n         at \n org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313) \n         at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260) \n         at javax.servlet.http.HttpServlet.service(HttpServlet.java:717) \n         at \n org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFi \n lterChain.java:290) \n         at \n org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChai \n n.java:206) \n         at \n com.demantra.common.servlets.ServerStartupFilter.doFilter(ServerStartupFilter. \n java:52) \n         at \n org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFi \n lterChain.java:235) \n         at \n org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChai \n n.java:206) \n         at \n com.demantra.common.utils.ParamEncodingFilter.doFilter(ParamEncodingFilter.jav \n a:29) \n         at \n org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFi \n lterChain.java:235) \n         at \n org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChai \n n.java:206) \n         at \n com.demantra.security.server.csrf.CSRFFilter.doFilter(CSRFFilter.java:138) \n         at \n org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFi \n lterChain.java:235) \n         at \n org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChai \n n.java:206) \n         at \n com.demantra.security.server.authorization.AuthorizationFilter.doFilter(Author \n izationFilter.java:115) \n         at \n org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFi \n lterChain.java:235) \n         at \n org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChai \n n.java:206) \n         at \n org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java \n :233) \n         at \n org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java \n :191) \n         at \n org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.j \n ava:470) \n         at \n org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127) \n         at \n org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102) \n         at \n org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:1 \n 09) \n         at \n org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298) \n         at \n org.apache.coyote.http11.Http11AprProcessor.process(Http11AprProcessor.java:86 \n 4) \n         at \n org.apache.coyote.http11.Http11AprProtocol$Http11ConnectionHandler.process(Htt \n p11AprProtocol.java:579) \n         at \n org.apache.tomcat.util.net.AprEndpoint$Worker.run(AprEndpoint.java:1665) \n         at java.lang.Thread.run(Unknown Source) \n   \n   \n\n From this page (http://tomcat.apache.org/tomcat-6.0-doc/jasper-howto.html), we know that Tomcat6 is using Eclipse JDT Java compiler for the JSP \n compilation. \n . \n Please note: \n This JSP file can compile successfully with Java 7, and also JDK8u5. We got this error only on Java 1.8.0_20-ea", "id": 175778, "time": "2014-06-12T02:47:27Z", "bug_id": 56613, "creation_time": "2014-06-12T02:47:27Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 56613, "text": "First, you are missing required information: you are not mentioning what exact x.y.z. version of Tomcat you are using.\n\n\nSecond, for Java 8 you have to use a version of Eclipse ECJ compiler that supports Java 8. See [1].\n\nThe \"ClassFormatException\" probably means that your version of ECJ does not know about Java 8 at all.\n\n\n\nNote that\n1. We cannot update the version of ECJ included with Tomcat 6, as Tomcat 6 must be able to run on Java 1.5, but current ECJ releases require minimum of Java 6.\n\n2. There are known issues - see bug 56543\n\n3. You may replace ecj-*.jar with a later version that you may download from http://www.eclipse.org/\n\nSee archives of Tomcat Users mailing list, and ask on the mailing list if you have questions. (Bugzilla is not a support forum).\n\n4. Tomcat can be configured to use Java javac compiler instead of Eclipse ECJ. [2]\n\n\n[1] http://www.eclipse.org/downloads/index-java8.php\n[2] http://tomcat.apache.org/tomcat-7.0-doc/jasper-howto.html\n\n*** This bug has been marked as a duplicate of bug 56283 ***", "id": 175783, "time": "2014-06-12T09:33:19Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-06-12T09:33:19Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "creator": "minfrin@sharp.fm", "text": "Created attachment 32567\nPatch for tomcat v7.0.x\n\nIn the current implementation of the tomcatAuthentication parameter, this allows the REMOTE_USER variable from the webserver to be used as the principal for the tomcat request.\n\nA side effect of this option is that if the web application uses roles (authorization), the roles will be silently ignored, and the user will be locked out.\n\nThis limits the usefulness of tomcatAuthentication.\n\nThe attached patches introduce the tomcatAuthorization flag. When true, the REMOTE-USER will be used as the principal, while authorization will continue in Tomcat as normal.\n\nWhat this means practically is that it now becomes possible to place a webserver in front of a web application, and the authentication performed by the webserver will cleanly replace the authentication performed by tomcat, while leaving the web application authorization configuration intact.", "id": 181769, "time": "2015-03-14T23:00:43Z", "bug_id": 57708, "creation_time": "2015-03-14T23:00:43Z", "is_private": false, "attachment_id": 32567}, {"count": 1, "tags": [], "bug_id": 57708, "text": "Created attachment 32568\nPatch for tomcat v8.0.x", "id": 181770, "time": "2015-03-14T23:01:26Z", "creator": "minfrin@sharp.fm", "creation_time": "2015-03-14T23:01:26Z", "is_private": false, "attachment_id": 32568}, {"count": 2, "tags": [], "bug_id": 57708, "text": "Created attachment 32569\nPatch for tomcat v9.0.x", "id": 181771, "time": "2015-03-14T23:02:01Z", "creator": "minfrin@sharp.fm", "creation_time": "2015-03-14T23:02:01Z", "is_private": false, "attachment_id": 32569}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "I've taken a quick look at the patch for 9.0.x. I suspect that my comments will apply equally to the back-ports.\n\nOverall, +1. I'd change some of the details (see below) but the general approach looks sound.\n\nI'm happy fixing the details when I apply the patch so no need to re-submit.\n\nOn those details:\n- 'remote user' has a specific meaning in a servlet container. I think this\n  needs to be changed to 'AJP authenticated user'or something similar.\n- The indentation is inconsistent (it should be four spaces). Some of that is\n  because the patch is trying to follow the existing code which itself is not\n  very consistent. In particular, the continuation lines look odd.\n- There is clearly some scope for refactoring to reduce duplication in the\n  authenticators. That should be completed first.\n\nI'm a little wary of adding a new method to Realm but, we have done that before when the need arose and there is an implementation in RealmBase so the impact should be minimal.\n\nThanks for the patch. This is on my todo list for tomorrow.", "id": 181826, "time": "2015-03-16T21:53:28Z", "bug_id": 57708, "creation_time": "2015-03-16T21:53:28Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 57708, "text": "I did look at this yesterday and I got as far as having something ready to commit but I'm not entirely happy with.\n\nThe question is where to do the authorization.\n\nIf authorization is done in the CoyoteAdaptor (the Context and therefore the Realm is available) then it will work regardless of the Authenticator implementation that is used. The down side is that it happens before the Principal caching that avoids large numbers of Realm lookups is reached (this is in AuthenticatorBase). It also makes an assumption that the request mapping won't changed (e.g. by the RewriteValve).\n\nIf authorization is done in AuthenticatorBase then Connector authorization depends on the Authenticator implementation and that doesn't seem right.\n\nI've looked at several options and - so far - all of them have issues. I'll spend some more time thinking about this.", "id": 181859, "time": "2015-03-18T10:43:15Z", "creator": "markt@apache.org", "creation_time": "2015-03-18T10:43:15Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "I opted for a combination of both approaches.\n\nImplemented in r4667546 for Tomcat 9 based on the provided patch.\n\nI'm happy to back-port this to 8.0.x. Not so sure about 7.0.x. Definitely not for 6.0.x.", "is_private": false, "id": 181861, "creator": "markt@apache.org", "time": "2015-03-18T13:35:18Z", "bug_id": 57708, "creation_time": "2015-03-18T13:35:18Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 57708, "attachment_id": null, "text": "Back-ported to 8.0.x for 8.0.21 onwards.", "id": 181863, "time": "2015-03-18T14:19:39Z", "creator": "markt@apache.org", "creation_time": "2015-03-18T14:19:39Z", "is_private": false}, {"count": 7, "tags": [], "text": "Thanks for this.\n\nWe backported all the way back to v7.0.x, as we're forced to use that by support contracts on various software, such as Jira and Confluence.", "is_private": false, "bug_id": 57708, "id": 181864, "time": "2015-03-18T14:43:07Z", "creator": "minfrin@sharp.fm", "creation_time": "2015-03-18T14:43:07Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 57708, "attachment_id": null, "id": 181898, "time": "2015-03-18T21:38:41Z", "creator": "markt@apache.org", "creation_time": "2015-03-18T21:38:41Z", "is_private": false, "text": "Backported to 7.0.xfor 7.0.60 onwards."}]
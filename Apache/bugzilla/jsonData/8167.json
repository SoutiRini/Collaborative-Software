[{"count": 0, "tags": [], "bug_id": 8167, "attachment_id": null, "is_private": false, "id": 13771, "time": "2002-04-16T14:37:07Z", "creator": "chrisd@apache.org", "creation_time": "2002-04-16T14:37:07Z", "text": "When using --with-module=module-type:module-file, if the module-type is not the\nsame as any of the modules enabled using --enable-module (or similar means),\nthen the MODULE_DIRS and MODULE_CLEANDIRS variables in the build/config_vars.mk\nfile are not properly created.  The module-type is missing from MODULE_DIRS and\nis present in MODULE_CLEANDIRS, which prevents the additional module from\ncompiling with make.\n\nMy current solution is to edit the configure script and save $modtype into a\nvariable following the block that deals with --with-module.  Then, after the\nblock that deals with mod_so and before the lines that begin with\nAPACHE_VAR_SUBST=\"$APACHE_VAR_SUBST progname\", I loop over $MODULE_DIRS (and\n$MODULE_CLEANDIRS) and add (and remove) the additional $modtype, but only if it\nhas not been added to $MODULE_DIRS already by a preceding configuration block.\n\nThe following diff shows my current solution (hopefully the newlines will\ndisplay properly):\n\n8993d8992\n<     extra_module_dir=\"$modtype\"\n11278,11298d11276\n<   if test ! -z \"$extra_module_dir\"; then\n<     extra_module_flag=\"0\"\n<     for i in $MODULE_DIRS; do\n<       if test \"x$i\" = \"x$extra_module_dir\"; then\n<         extra_module_flag=\"1\"\n<         break\n<       fi\n<     done\n<     if test $extra_module_flag = \"0\"; then\n<       echo \"  adding \\\"$extra_module_dir\\\" to MODULE_DIRS\"\n<       MODULE_DIRS=\"$MODULE_DIRS $extra_module_dir\"\n<       extra_module_cleandirs=\"\"\n<       for i in $MODULE_CLEANDIRS; do\n<         if test \"x$i\" != \"x$extra_module_dir\"; then\n<           extra_module_cleandirs=\"$extra_module_cleandirs $i\"\n<         fi\n<       done\n<       echo \"  removing \\\"$extra_module_dir\\\" from MODULE_CLEANDIRS\"\n<       MODULE_CLEANDIRS=\"$extra_module_cleandirs\"\n<     fi\n<   fi"}, {"count": 1, "tags": [], "text": "I notice now that my current fix only works if one uses --with-module, because\notherwise $extra_module_dir will not be instantiated.  So somewhere around line\n8952, before the code that checks for --with-module, is needed the statement\n$extra_module_dir=\"\".\n\nObviously the actual fix will need to be made to whatever files are used to\nconstruct the configure script; being a neophyte in such matters I leave that to\nothers ...", "attachment_id": null, "bug_id": 8167, "id": 13811, "time": "2002-04-17T02:42:40Z", "creator": "chrisd@apache.org", "creation_time": "2002-04-17T02:42:40Z", "is_private": false}, {"count": 2, "tags": [], "creator": "chrisd@apache.org", "attachment_id": null, "id": 17308, "time": "2002-06-06T10:54:19Z", "bug_id": 8167, "creation_time": "2002-06-06T10:54:19Z", "is_private": false, "text": "The following two patches seem to enable buildconf to build a configure script\nthat contains my original suggestions.  First, to modules/config5.m4:\n\n2d1\n< extra_module_dir=\"\"\n41d39\n<     extra_module_dir=\"$modtype\"\n\nSecond, to configure.in:\n\n304,325d303\n< if test ! -z \"$extra_module_dir\"; then\n<   extra_module_flag=\"0\"\n<   for i in $MODULE_DIRS; do\n<     if test \"x$i\" = \"x$extra_module_dir\"; then\n<       extra_module_flag=\"1\"\n<       break\n<     fi\n<   done\n<   if test $extra_module_flag = \"0\"; then\n<     echo \"  adding \\\"$extra_module_dir\\\" to MODULE_DIRS\"\n<     MODULE_DIRS=\"$MODULE_DIRS $extra_module_dir\"\n<     extra_module_cleandirs=\"\"\n<     for i in $MODULE_CLEANDIRS; do\n<       if test \"x$i\" != \"x$extra_module_dir\"; then\n<         extra_module_cleandirs=\"$extra_module_cleandirs $i\"\n<       fi\n<     done\n<     echo \"  removing \\\"$extra_module_dir\\\" from MODULE_CLEANDIRS\"\n<     MODULE_CLEANDIRS=\"$extra_module_cleandirs\"\n<   fi\n< fi\n< \n\nSorry it look so long for me to get around to working with buildconf.  Hope this\nhelps."}, {"count": 3, "tags": [], "bug_id": 8167, "attachment_id": null, "is_private": false, "id": 69418, "time": "2005-01-08T03:46:57Z", "creator": "erik@codefaktor.de", "creation_time": "2005-01-08T03:46:57Z", "text": "I strongly believe this is fixed by now, at least I couldn't spot any problems with it while adding support \nfor multiple external modules. Please re-open the report if the current SVN trunk (*) doesn't fix this for \nyou.\n\n* http://cvs.apache.org/viewcvs.cgi?root=Apache-SVN&rev=124600&view=rev"}]
[{"count": 0, "tags": [], "text": "I used the JNDIRealm coming with the 4.1.7 beta version to authenticate against\niPlanet LDAP server, and found that the JNDIRealm successfully authenticated a\nnon-existing user. The following is the log output:\n\n------------------- begin quoting logs -----------------------------------\n2002-07-25 12:12:15 JNDIRealm[/phonebook-app]: lookupUser(sfsdf)\n2002-07-25 12:12:15 JNDIRealm[/phonebook-app]:   dn=employeenumber=sfsdf, \nou=people, dc=pb, dc=com\n2002-07-25 12:12:15 JNDIRealm[/phonebook-app]:   validating credentials by \nbinding as the user\n2002-07-25 12:12:15 JNDIRealm[/phonebook-app]:   binding as \nemployeenumber=sfsdf, ou=people, dc=pb, dc=com\n2002-07-25 12:12:15 JNDIRealm[/phonebook-app]: Username sfsdf successfully \nauthenticated\n2002-07-25 12:12:15 JNDIRealm[/phonebook-app]:   getRoles(employeenumber=sfsdf, \nou=people, dc=pb, dc=com)\n2002-07-25 12:12:15 JNDIRealm[/phonebook-app]:   Searching role \nbase 'ou=groups,dc=pb,dc=com' for attribute 'cn'\n2002-07-25 12:12:15 JNDIRealm[/phonebook-app]:   With filter \nexpression '(uniquemember=employeenumber=sfsdf, ou=people, dc=pb, dc=com)'\n2002-07-25 12:12:15 JNDIRealm[/phonebook-app]:   Returning 0 roles\n2002-07-25 12:12:15 JNDIRealm[/phonebook-app]: Username sfsdf does NOT have \nrole Gateway Admin\n2002-07-25 12:15:21 JNDIRealm[/phonebook-app]: Closing directory context\n\n--------------------- end of quoting log -------------------------------\n\nNotice that the user doesn't exist in the directory at all, so it should fail at\nthe binding step. Here is my config for the JNDIRealm in the server.xml:\n\n--------------- start quoting xml -------------------------------------\n\t<Context path=\"/phonebook-app\" docBase=\"phonebook-app\" debug=\"99\"\n\t\treloadable=\"true\">\n\t    <Logger className=\"org.apache.catalina.logger.FileLogger\"\n\t\tprefix=\"jdgw_log.\" suffix=\".txt\" timestamp=\"true\"/>\n\t    <Realm   className=\"org.apache.catalina.realm.JNDIRealm\" \n\t\tdebug=\"99\"\n\t\n\tconnectionName=\"uid=admin,ou=administrators,ou=topologymanagement,o=nets\ncaperoot\"\n\t\tconnectionPassword=\"iplanetsa\"\n\t\tconnectionURL=\"ldap://localhost:389\"\n\t\tcontextFactory=\"com.netscape.jndi.ldap.LdapContextFactory\"\n\t\troleBase=\"ou=groups,dc=pb,dc=com\"\n\t\troleName=\"cn\"\n\t\troleSearch=\"(uniquemember={0})\"\n\t\troleSubtree=\"false\"\n\t\tuserPattern=\"employeenumber={0}, ou=people, dc=pb, dc=com\"\n\t    />\n\t</Context>\n-------------------------- end quoting xml --------------------------------\n\nIf you want to test again the iPlanet directory server, I think you can \ndownload a free one from their web site. \n\nPlease let me know if this is not a bug. Thanks.", "is_private": false, "id": 20267, "creation_time": "2002-07-26T16:19:31Z", "time": "2002-07-26T16:19:31Z", "creator": "xin.guo@sun.com", "bug_id": 11210, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 11210, "text": "I suspect this is an issue with using the Netscape LDAP provider\n(com.netscape.jndi.ldap.LdapContextFactory) rather than with the type of\ndirectory server. Could you try again using the Sun provider? Also detailed logs\nfrom the iPlanet directory server for both providers would help.\n\nI'll try to get hold of the Netscape provider and see if I can replicate against\nOpenLDAP.", "id": 20295, "time": "2002-07-27T10:43:27Z", "creator": "j.g.holman@qmul.ac.uk", "creation_time": "2002-07-27T10:43:27Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 11210, "text": "Created attachment 2506\nJNDIRealm patch to support  iPlanet/Netscape LDAP provider", "id": 20302, "attachment_id": 2506, "creator": "j.g.holman@qmul.ac.uk", "creation_time": "2002-07-27T15:07:25Z", "time": "2002-07-27T15:07:25Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 11210, "is_private": false, "text": "I downloaded the iPlanet/Netscape/Mozilla Directory SDK 4.1 from Sun and\nreplicated the problem, which is due to a failure of this LDAP provider\n(com.netscape.jndi.ldap.LdapContextFactory) to conform to the JNDI specification.\n\nSection 6.6.2 of the JNDI 1.2 spec on the timeliness of modifications to the\ncontext environment says that changes to an environment property should be\neffective the next time an operation using that property is envoked. JNDIRealm\nrelies on this to authenticate by binding as the user - it changes the principal\nand password properties and then carries out a search operation with the new\nenvironment. This all works as expected when using the default LDAP provider\nfrom Sun.\n\nThe iPlanet implementation, on the other hand, seems to ignore any change to\nenvironment properties when the changed property pertains to the connection.\n(This discrepancy is hinted at in the section on JNDI Environmental Properties\nin the Netscape documentation). Thus it never even attempts to rebind as the user.\n\nThis should really be fixed by whoever is now maintaining the Netscape provider,\nbut I have a feeling that may not be trivial. So I've just attached a patch to\nJNDIRealm to work around the problem. This invokes reconnect() on the context to\nforce an immediate rebind both when switching from administrator to user\ncredentials for authentication and when switching from user to administrator\ncredentials to search for user entries and role information. \n\nOne, perhaps slight, downside is that the context must now be an LdapContext\ninstead of the more generic DirectoryContext. On the other hand the realm is\nslightly more efficient than before when using the Sun LDAP provider. With the\nNetscape provider, it works correctly, but is rather inefficient since this\nprovider closes the LDAP connection and creates a new one when reconnect() is\ninvoked instead of keeping the same connection and rebinding with the new\ncredentials.\n\n\n\n", "id": 20303, "time": "2002-07-27T15:08:31Z", "creator": "j.g.holman@qmul.ac.uk", "creation_time": "2002-07-27T15:08:31Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 11210, "is_private": false, "id": 42250, "time": "2003-08-06T11:51:25Z", "creator": "funkman@joedog.org", "creation_time": "2003-08-06T11:51:25Z", "tags": [], "text": "Since this seems to be a bug with iPlanet - marking as WONTFIX. A javadoc\ncomment will be been added to JNDIRealm to point to this bug as a warning for\niPlanet users."}]
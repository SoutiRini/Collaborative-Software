[{"count": 0, "tags": [], "text": "Randomly, IE has to wait for 5 minutes for its request to be processed. After 5 mins, it gets a 500. Upon debugging, mod_proxy didnt send this request to backend server for processing. Instead it failed with \n\n[Wed Mar 12 09:21:08 2008] [error] (OS 10060)A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.  : proxy: prefetch request body failed to 10.33.35.97:8080 (usdawdev05.infor.com) from 10.33.130.130 ()\n\nAny clues on how to resolve this? Thanks \n\nMore snippets\n=============\n[Wed Mar 12 09:16:07 2008] [debug] mod_proxy_http.c(54): proxy: HTTP: canonicalising URL //usdawdev05.infor.com:8080/wmweb/wms/wmsapp.ctrl\n[Wed Mar 12 09:16:07 2008] [debug] proxy_util.c(1412): [client 10.33.130.130] proxy: http: found worker http://usdawdev05.infor.com:8080/wmweb for http://usdawdev05.infor.com:8080/wmweb/wms/wmsapp.ctrl, referer: http://usdawdev05.infor.com/wmweb/wms/wmsapp.ctrl?S|G|loginRequest=1274\n[Wed Mar 12 09:16:07 2008] [debug] mod_proxy.c(819): Running scheme http handler (attempt 0)\n[Wed Mar 12 09:16:07 2008] [debug] mod_proxy_http.c(1693): proxy: HTTP: serving URL http://usdawdev05.infor.com:8080/wmweb/wms/wmsapp.ctrl\nSometime\n[Wed Mar 12 09:16:07 2008] [debug] proxy_util.c(1852): proxy: HTTP: has acquired connection for (usdawdev05.infor.com)\n[Wed Mar 12 09:16:07 2008] [debug] proxy_util.c(1913): proxy: connecting http://usdawdev05.infor.com:8080/wmweb/wms/wmsapp.ctrl to usdawdev05.infor.com:8080\n[Wed Mar 12 09:16:07 2008] [debug] proxy_util.c(2012): proxy: connected /wmweb/wms/wmsapp.ctrl to usdawdev05.infor.com:8080\n[Wed Mar 12 09:16:07 2008] [debug] proxy_util.c(2109): proxy: HTTP: backend socket is disconnected.\n[Wed Mar 12 09:16:07 2008] [debug] proxy_util.c(2169): proxy: HTTP: fam 2 socket created to connect to usdawdev05.infor.com\n[Wed Mar 12 09:16:07 2008] [debug] proxy_util.c(2266): proxy: HTTP: connection complete to 10.33.35.97:8080 (usdawdev05.infor.com)\n[Wed Mar 12 09:21:08 2008] [error] (OS 10060)A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.  : proxy: prefetch request body failed to 10.33.35.97:8080 (usdawdev05.infor.com) from 10.33.130.130 ()\n[Wed Mar 12 09:21:08 2008] [debug] proxy_util.c(1870): proxy: HTTP: has released connection for (usdawdev05.infor.com)\n[Wed Mar 12 09:21:08 2008] [error] [client 10.33.130.130] Handler for proxy-server returned invalid result code 730060, referer: http://usdawdev05.infor.com/wmweb/wms/wmsapp.ctrl?S|G|loginRequest=1274\n[Wed Mar 12 09:21:08 2008] [debug] mod_deflate.c(601): [client 10.33.130.130] Zlib: Compressed 535 to 322 : URL /wmweb/wms/wmsapp.ctrl, referer: http://usdawdev05.infor.com/wmweb/wms/wmsapp.ctrl?S|G|loginRequest=1274", "is_private": false, "id": 114549, "creator": "arouncoumar@gmail.com", "time": "2008-03-12T17:43:15Z", "bug_id": 44592, "creation_time": "2008-03-12T17:43:15Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 44592, "attachment_id": null, "text": "Your client at 10.33.130.130 did not sent the request body. I cannot tell if this is your IE or some other proxy in between.", "id": 114554, "time": "2008-03-13T00:18:48Z", "creator": "rpluem@apache.org", "creation_time": "2008-03-13T00:18:48Z", "is_private": false}, {"count": 2, "attachment_id": null, "creator": "arouncoumar@gmail.com", "text": "(In reply to comment #1)\n> Your client at 10.33.130.130 did not sent the request body. I cannot tell if\n> this is your IE or some other proxy in between.\n> \n\nI am using httpwatch which captures what browser posts to the web server. There I clearly see the post data being sent. Do you want me to capture anything specific? Could this be the same issue as https://issues.apache.org/bugzilla/show_bug.cgi?id=37920.\n\nThanks\n\n", "id": 114599, "time": "2008-03-13T11:48:45Z", "bug_id": 44592, "creation_time": "2008-03-13T11:48:45Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "id": 114603, "attachment_id": null, "bug_id": 44592, "creation_time": "2008-03-13T12:55:49Z", "time": "2008-03-13T12:55:49Z", "text": "(In reply to comment #2)\n> (In reply to comment #1)\n> > Your client at 10.33.130.130 did not sent the request body. I cannot tell if\n> > this is your IE or some other proxy in between.\n> > \n> \n> I am using httpwatch which captures what browser posts to the web server. There\n> I clearly see the post data being sent. Do you want me to capture anything\n> specific? Could this be the same issue as\n> https://issues.apache.org/bugzilla/show_bug.cgi?id=37920.\n\nNo.\nThe error message on httpd side\n\n[Wed Mar 12 09:21:08 2008] [error] (OS 10060)A connection attempt failed\nbecause the connected party did not properly respond after a period of time, or\nestablished connection failed because connected host has failed to respond.  :\nproxy: prefetch request body failed to 10.33.35.97:8080 (usdawdev05.infor.com)\nfrom 10.33.130.130 ()\n\nclearly indicates that the data gets lost on its way to the server. Please use a network sniffer instead of httpwatch\n\n1. On your client.\n2. On your server running httpd\n\nto verify that the data is really sent and attach the network dumps to this report for further analysis.\n\n\n"}, {"count": 4, "tags": [], "creator": "jdlewis@xactware.com", "text": "I am currently experiencing the same issue.  My set-up is:  Apache w/mod_proxy as a Reverse Proxy Server to IIS 6 on Windows 2003 on the back end.  (As such, this could be an issue with IIS 6...)\n\nThe Apache error.log is showing:\n[Wed Mar 26 16:26:27 2008] [error] (OS 10060)A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.  : proxy: pass request body failed to 172.23.21.60:80 (172.23.21.60) from 63.175.160.199 ()\n[Wed Mar 26 16:26:27 2008] [error] [client 63.175.160.199] Handler for proxy-server returned invalid result code 730060, referer: http://beta.xactcontents.com/contents/cc/ew/?id=2008-3-21-1031&readonly=0&prof=5L&comp=\n\nThe IIS error.log is showing:\n#Fields: date time c-ip c-port s-ip s-port cs-version cs-method cs-uri sc-status s-siteid s-reason s-queuename\n2008-03-26 20:46:43 207.14.128.6 4474 172.23.21.60 80 HTTP/1.1 POST /contents/cc/ew/ExcelFileLoader.aspx?id=TEST3&prof=5L - 1 Timer_EntityBody DefaultAppPool\n\nIIS is saying that it never got the request body.  I am POST-ing a 1 Meg Excel file.  This works most of the time from the same network that the Apache server is on, but we almost always get this error from outside on the general internet.\n\nPlease let me know what additional information might be helpful...\n\nHere are the changes I've made to httpd.config:\n...\nWin32DisableAcceptEx\n\nProxyRequests Off\n\n<Proxy *>\nOrder deny,allow\nAllow from all\n</Proxy>\n\n<VirtualHost _default_:80>\nProxyPass / http://172.23.21.60/\nProxyPassReverse / http://172.23.21.60/\n\n<IfModule mod_cache.c>\n\t<IfModule mod_disk_cache.c>\n\t\tCacheRoot c:/cacheroot\n\t\tCacheEnable disk /contents/css\n\t\tCacheEnable disk /contents/img\n\t\tCacheEnable disk /contents/js\n\t\tCacheDirLevels 5\n\t\tCacheDirLength 3\n\t</IfModule> \n</IfModule> \n\n\n\n", "id": 115033, "time": "2008-03-27T09:46:06Z", "bug_id": 44592, "creation_time": "2008-03-27T09:46:06Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "One additional piece of information:  Sometimes, when posting from the internet, I just get really slow upload performance:  12 Kb/s or so.", "is_private": false, "id": 115035, "creator": "jdlewis@xactware.com", "time": "2008-03-27T09:49:14Z", "bug_id": 44592, "creation_time": "2008-03-27T09:49:14Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 44592, "text": "I have the same problem - at least I think so and I found a work-around which could help to trace the cause.\nBy setting \"setenv proxy-sendcl\", it solved the problem.", "id": 116901, "time": "2008-05-22T07:09:20Z", "creator": "marc.stern@approach.be", "creation_time": "2008-05-22T07:09:20Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 44592, "is_private": false, "text": "Created attachment 22162\nNetwork capture Client to Apache\n\nFrame 289 is the POST request from the client (11:38:49.472677)", "id": 117903, "time": "2008-06-23T03:26:14Z", "creator": "brnrd@freebsd.org", "creation_time": "2008-06-23T03:26:14Z", "attachment_id": 22162}, {"count": 8, "tags": [], "text": "Created attachment 22163\nNetwork capture Apacheto Backend", "is_private": false, "id": 117904, "creator": "brnrd@freebsd.org", "time": "2008-06-23T03:26:55Z", "bug_id": 44592, "creation_time": "2008-06-23T03:26:55Z", "attachment_id": 22163}, {"count": 9, "tags": [], "creator": "brnrd@freebsd.org", "text": "We are experiencing this issue on our reverse proxies. Meanwhile, we've confirmed this on\nApache-2.2.6/Windows Server 2003 (VS2008 build from apachelounge.com)\nApache-2.2.8/Windows Server 2003 (VS2008 build from apachelounge.com)\nApache-2.2.9/Windows Server 2003 (standard ASF build)\nApache-2.2.8/Ubuntu 8.04 (standard package)\n\nThis error is infrequent, ca. one POST request per 100 fails (1%). We've captured the network-data on our dev-box whilst triggering the error.\n\nThe request to Apache has a POST-body (see decrypted frame 289 below)\n\n== Decrypted frame 289 ==\nPOST /sap(bD1lbiZjPTI1MCZkPW1pbiZpPTEmcz1TSUQlM2FBTk9OJTNhcGxzYXBkYzIwMF9EQzJfMDAlM2FWZ3VNRER3Mk1EbWpRdjJreHFBc2x5SUc1MFlvNmJFV0VWa2Zuc1hwLUFUVA==)/bc/bsp/sap/crm_ui_frame/bspwdapplication.do?id=218&target_id=MD-BP-OV&entity_name=BuilHeader&entity_key=FF060101010280003431303200000000010400000000100000003C030000000000000000000000000000000000000000004B00450059BC000000100A81BC7BA3914F67B4FE53F54883D55FBD04 HTTP/1.1\nAccept: */*\nAccept-Language: en,th;q=0.8,fr;q=0.7,pl;q=0.5,zh;q=0.3,nl;q=0.2\nx-prototype-version: 1.3.1\nReferer: https://www.dev.tradelink.com/sap(bD1FTiZjPTI1MCZkPW1pbiZpPTEmcz1TSUQlM2FBTk9OJTNhcGxzYXBkYzIwMF9EQzJfMDAlM2FWZ3VNRER3Mk1EbWpRdjJreHFBc2x5SUc1MFlvNmJFV0VWa2Zuc1hwLUFUVA==)/bc/bsp/sap/crm_ui_frame/bspwdapplication.do?id=238&target_id=TSEGFR_ED&entity_name=SEGSet&entity_key=FF060101010280003431303200000000010400000000100000003C030000000000000000000000000000000000000000004B00450059BC0000001046D9D464D19C0432E1008000828BF835BD04\nx-requested-with: XMLHttpRequest\nContent-Type: application/x-www-form-urlencoded\nAccept-Encoding: gzip, deflate\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.1)\nHost: www.dev.tradelink.com\nContent-Length: 1153\nConnection: Keep-Alive\nCache-Control: no-cache\nCookie: smuid=10032008-668-1301382274084061205134725; colstate=-#-#undefined#undefined#undefined#undefined#; sap-usercontext=sap-language=EN&sap-client=250; MYSAPSSO2=AjQxMDIBABgATgBMAFkAMgA2ADEAMAA0ACAAIAAgACACAAYAMgA1ADADABAARABDADIAIAAgACAAIAAgBAAYADIAMAAwADgAMAA2ADEANwAwADgAMwAzBQAEAAAACAYAAgBYCQACAEX%2fAZgwggGUBgkqhkiG9w0BBwKgggGFMIIBgQIBATELMAkGBSsOAwIaBQAwCwYJKoZIhvcNAQcBMYIBYDCCAVwCAQEwEzAOMQwwCgYDVQQDEwNNRUkCAQAwCQYFKw4DAhoFAKBdMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTA4MDYxNzA4MzMwNFowIwYJKoZIhvcNAQkEMRYEFIDMRk8sRkKCPzZbn2yj8syOtZ6iMIGmBgUrDgMCGzCBnAJBAJQ%2f%21BvMlO438nBG1f0FClCbEbRI2SfTcTOJItOHZ6bWOXqux0Eh8ar%2fusZv21ME4zukJjnfB7ojFb3jqUuKgAsCFQDUmKLfAYXcLt7S0XDVjzPoiXBF9wJATF6H5rabRtyKht509WDmvyb0mneKh6WCwUVDjgybhnVZCWjiX7jA3CxmB2%2f05llqGpoLwmMfP0nwFbKMfcCEJwQvMC0CFQCT3xI6NJUwto4ha1Zc4TqatcCR7wIUPi348KqSKQdrfwT1xMKGX1DviHY%3d\n\nhtmlbevt_ty=thtmlb%3Alink%3Aclick%3A0&htmlbevt_frm=myFormId&htmlbevt_oid=C4_W14_V15_Z_SLS_OPP&htmlbevt_id=SLS-CYC-WC&htmlbevt_cnt=0&htmlbevt_par1=&htmlbevt_par2=&htmlbevt_par3=&htmlbevt_par4=&htmlbevt_par5=&htmlbevt_par6=&htmlbevt_par7=&htmlbevt_par8=&htmlbevt_par9=&onInputProcessing=htmlb&myFormId_complete=&sap-htmlb-design=&sap-ajaxtarget=C1_W1_V2_C4_W14_V15_MainNavigationLinks.do&sap-ajax_dh_mode=AUTO&thtmlbKeyboardFocusId=C4_W14_V15_Z_SLS_OPP&C6_W18_V19_selected_key=481371179A7A01E9E1008000828BF835&crmFrwScrollXPos=0&crmFrwScrollYPos=160&C1_W1_V2_V3_V20_bchistory_selection=&C20_W51_V52_0001_iscollapsed=&C20_W51_V52_0002_iscollapsed=&C20_W51_V52_0003_iscollapsed=&C20_W51_V52_0004_iscollapsed=&C20_W51_V52_0005_iscollapsed=&C20_W51_V52_0006_iscollapsed=X&C20_W51_V52_0007_iscollapsed=&C20_W51_V52_0008_iscollapsed=&C20_W51_V52_0009_iscollapsed=X&C20_W51_V52_0010_iscollapsed=X&C20_W51_V52_0014_iscollapsed=&thtmlbScrollAreaWidth=1107&thtmlbScrollAreaHeight=537&LTX_PREFIX_ID=C1_W1_V2_&C1_W1_V2_LTX_VETO_FLAG=&C1_W1_V2_ACTION_GUID=&C1_W1_V2_AC_OBJECT_KEY=&C1_W1_V2_AC_VALUE=&C1_W1_V2_AC_CONTAINER=&C1_W1_V2_MYITSLOCATION=&sap-ajax_request=X&_=\n== End ==\n\naccess-log\n130.144.209.17 - - [17/Jun/2008:11:38:38 +0200] \"POST /sap(bD1lbiZjPTI1MCZkPW1pbiZpPTEmcz1TSUQlM2FBTk9OJTNhcGxzYXBkYzIwMF9EQzJfMDAlM2FWZ3VNRER3Mk1EbWpRdjJreHFBc2x5SUc1MFlvNmJFV0VWa2Zuc1hwLUFUVA==)/bc/bsp/sap/crm_ui_frame/bspwdapplication.do?id=218&target_id=MD-BP-OV&entity_name=BuilHeader&entity_key=FF060101010280003431303200000000010400000000100000003C030000000000000000000000000000000000000000004B00450059BC000000100A81BC7BA3914F67B4FE53F54883D55FBD04 HTTP/1.1\" 200 105406\n130.139.104.40 - - [17/Jun/2008:11:39:09 +0200] \"GET /sap/public/myssocntl?sap-client=250 HTTP/1.1\" 302 -\n<snip>\n130.139.104.40 - - [17/Jun/2008:11:43:42 +0200] \"GET /sap(bD1lbiZjPTI1MA==)/bc/bsp/sap/zget_opp_order/result_header.htm?customer_number=0300095243&scope=Q HTTP/1.1\" 200 195478\n130.144.209.17 - - [17/Jun/2008:11:38:49 +0200] \"POST /sap(bD1lbiZjPTI1MCZkPW1pbiZpPTEmcz1TSUQlM2FBTk9OJTNhcGxzYXBkYzIwMF9EQzJfMDAlM2FWZ3VNRER3Mk1EbWpRdjJreHFBc2x5SUc1MFlvNmJFV0VWa2Zuc1hwLUFUVA==)/bc/bsp/sap/crm_ui_frame/bspwdapplication.do?id=218&target_id=MD-BP-OV&entity_name=BuilHeader&entity_key=FF060101010280003431303200000000010400000000100000003C030000000000000000000000000000000000000000004B00450059BC000000100A81BC7BA3914F67B4FE53F54883D55FBD04 HTTP/1.1\" 403 -\n130.139.104.40 - - [17/Jun/2008:11:44:40 +0200] \"GET /sap(bD1lbiZjPTI1MCZkPW1pbg==)/bc/bsp/sap/crm_ui_frame/sessionexit.gif?sap-contextid=SID%3aANON%3aplsapdc200_DC2_00%3aVguMDDx6dRfmx-zTCL3ffp8jf0Yo6bwQMln2UiQp-ATT&sap-sessioncmd=CLOSE HTTP/1.1\" 200 -\n\nerror-log\n[Tue Jun 17 11:43:49 2008] [error] (OS 10060)A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.  : proxy: prefetch request body failed to 130.144.0.220:8000 () from 130.144.209.17 ()\n[Tue Jun 17 11:43:49 2008] [error] [client 130.144.209.17] Handler for proxy-server returned invalid result code 730060, referer: https://www.dev.tradelink.philips.com/sap(bD1FTiZjPTI1MCZkPW1pbiZpPTEmcz1TSUQlM2FBTk9OJTNhcGxzYXBkYzIwMF9EQzJfMDAlM2FWZ3VNRER3Mk1EbWpRdjJreHFBc2x5SUc1MFlvNmJFV0VWa2Zuc1hwLUFUVA==)/bc/bsp/sap/crm_ui_frame/bspwdapplication.do?id=238&target_id=TSEGFR_ED&entity_name=SEGSet&entity_key=FF060101010280003431303200000000010400000000100000003C030000000000000000000000000000000000000000004B00450059BC0000001046D9D464D19C0432E1008000828BF835BD04\n \nNetwork Captures attached\nClient-to-Apache.pcap: Frame 289 is the POST request from the client (11:38:49.472677)\nApache-to-Backend.pcap: No corresponding frame (frame 273 corresponds to the next GET request in Client-to-Apache dump)\n\nStrangely, this capture show a 403 error whereas on our productive system this results in a 500 error (I did notice directory access for the error-docs was incorrect)\n", "id": 117905, "attachment_id": null, "bug_id": 44592, "creation_time": "2008-06-23T03:35:45Z", "time": "2008-06-23T03:35:45Z", "is_private": false}, {"count": 10, "tags": [], "text": "(In reply to comment #9)\n\n> \n> The request to Apache has a POST-body (see decrypted frame 289 below)\n\nCan you try without SSL on the reverse proxy. This would give us more information about the packet flow times and would rule out that this the\nfault of mod_ssl.\nPlease also sent the proxy configuration and your TimeOut settting\n\n\n> \n> error-log\n> [Tue Jun 17 11:43:49 2008] [error] (OS 10060)A connection attempt failed\n> because the connected party did not properly respond after a period of time, or\n> established connection failed because connected host has failed to respond.  :\n> proxy: prefetch request body failed to 130.144.0.220:8000 () from\n> 130.144.209.17 ()\n\nThis is a Windows specific error message. What error messages shows up if you use the Ubuntu Apache as reverse proxy?\n\n", "is_private": false, "id": 117909, "creator": "rpluem@apache.org", "time": "2008-06-23T06:20:38Z", "bug_id": 44592, "creation_time": "2008-06-23T06:20:38Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "SSL:\nWe are currently building a small Java App to help us trigger the problem (takes ages to trigger error manually). When done, we'll trace a non-ssl error (if it then exists) and attach it to this bug.\n\nTimeOut: \nTimeOut not specified, i.e. default 300 sec\nProxyTimeOut 600\n\nUbuntu error-log:\n[Fri Jun 20 11:33:08 2008] [error] (70007)The timeout specified has expired: proxy: prefetch request body failed to 130.144.0.220:8000 (plsapdc200.local) from 127.0.0.1 ()\n[Fri Jun 20 11:33:08 2008] [error] [client 127.0.0.1] Handler for proxy-server returned invalid result code 70007, referer: https://www.dev.tradelink.com/sap(bD1lbiZjPTI1MCZkPW1pbg==)/bc/bsp/sap/crm_ui_frame/bspwdapplication.do?id=31&target_id=TBT110APPC&entity_name=BTOrder&entity_key=FF060101010280003431303200000000010400000000100000003C030000000000000000000000000000000000000000004B00450059BC000000104782618331254037E1008000828BF835BD04\n\nConfig on dev machine:\nNameVirtualHost *:443\n\n<VirtualHost *:443>\nServerName www.dev.tradelink.com\nServerAlias www.dev.tradelink.com:443\n\nBrowserMatch \".*MSIE.*\" ssl-unclean-shutdown\n\nSSLEngine On\n# SSLOptions +StdEnvVars +ExportCertData\nSSLCertificateFile conf/ssl/tradedev.crt\nSSLCertificateKeyFile conf/ssl/tradedev.key\n\nCustomLog logs/www.dev.tradelink.com/access_ssl_%y%m%d.log common\nErrorLog logs/www.dev.tradelink.com/error.log\n\n#Reverse Proxy Configuration\n\nDocumentRoot D:/htdocs\n\n#   RewriteCond %{REQUEST_URI} !/maintenance.htm\n#   RewriteRule ^.*$ /maintenance.htm [R]\n\nSSLProxyEngine On\n\n# ProxyPreserveHost Off\nProxyPreserveHost On\nProxyVia On\nHeader add vhost https-default\nProxyTimeout 600\nRequestHeader set ClientProtocol https\nRewriteEngine On\n\nRewriteRule ^/sap(.*) http://plsapdc200.local:8000/sap$1 [P]\n<Location /sap>\n   ProxyPassReverse /sap\n</Location>\n\nRewriteRule ^/SAP(.*) http://plsapdc200.local:8000/sap$1 [P]\n<Location /SAP>\n   ProxyPassReverse /sap\n</Location>\n\n</VirtualHost>\n", "is_private": false, "bug_id": 44592, "id": 117911, "time": "2008-06-23T07:01:52Z", "creator": "brnrd@freebsd.org", "creation_time": "2008-06-23T07:01:52Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 44592, "is_private": false, "text": "(In reply to comment #11)\n> SSL:\n> We are currently building a small Java App to help us trigger the problem\n> (takes ages to trigger error manually). When done, we'll trace a non-ssl error\n> (if it then exists) and attach it to this bug.\n\nIf you can reproduce the error it would be interesting to get a backtrace of the processing tread / process that is stalling. Please try to get one via gdb as described on http://httpd.apache.org/dev/debugging.html.\n\n> \n> TimeOut: \n> TimeOut not specified, i.e. default 300 sec\n> ProxyTimeOut 600\n\nDoes this mean you are waiting for 10 minutes with your browser until you give up?\n\n> \n> Ubuntu error-log:\n> [Fri Jun 20 11:33:08 2008] [error] (70007)The timeout specified has expired:\n> proxy: prefetch request body failed to 130.144.0.220:8000 (plsapdc200.local)\n\nOk so httpd waits for reading data and then times out.\n\n", "id": 117922, "time": "2008-06-23T12:51:46Z", "creator": "rpluem@apache.org", "creation_time": "2008-06-23T12:51:46Z", "attachment_id": null}, {"count": 13, "tags": [], "creator": "brnrd@freebsd.org", "text": "Created attachment 22169\nhttp capture client to proxy", "id": 117940, "time": "2008-06-24T08:01:42Z", "bug_id": 44592, "creation_time": "2008-06-24T08:01:42Z", "is_private": false, "attachment_id": 22169}, {"count": 14, "tags": [], "bug_id": 44592, "attachment_id": null, "is_private": false, "id": 117941, "time": "2008-06-24T08:18:57Z", "creator": "brnrd@freebsd.org", "creation_time": "2008-06-24T08:18:57Z", "text": "Completed one of the tests, which was capturing an error whilst not using ssl.\n\nerror.log\n[Tue Jun 24 17:02:36 2008] [error] (70007)The timeout specified has expired: proxy: prefetch request body failed to 127.0.0.1:80 (www.dev.tradelink.com) from 130.144.213.244 ()\n[Tue Jun 24 17:02:36 2008] [error] [client 130.144.213.244] Handler for proxy-server returned invalid result code 70007, referer: http://www.dev.tradelink.com/sap(bD1FTiZjPTI1MCZkPW1pbiZpPTEmcz1TSUQlM2FBTk9OJTNhcGxzYXBkYzIwMF9EQzJfMDAlM2EzS1hBejZVYkFmVjJibXM0cDljUkdmQ19uLXMyMldSRWZKRlBtQ2kxLUFUVA==)/bc/bsp/sap/crm_ui_frame/bspwdapplication.do?popup-name=_POPUP0004&\n\naccess.log\n130.144.215.213 - - [24/Jun/2008:17:02:36 +0200] \"GET http://www.dev.tradelink.com/SAP/BC/BSP/SAP/thtmlb_styles/sap_skins/thtmlb_core_stand.css HTTP/1.0\" 200 84628\n130.144.213.244 - - [24/Jun/2008:16:57:36 +0200] \"POST http://www.dev.tradelink.com/sap(bD1FTiZjPTI1MCZkPW1pbiZpPTEmcz1TSUQlM2FBTk9OJTNhcGxzYXBkYzIwMF9EQzJfMDAlM2EzS1hBejZVYkFmVjJibXM0cDljUkdmQ19uLXMyMldSRWZKRlBtQ2kxLUFUVA==)/bc/bsp/sap/crm_ui_frame/bspwdapplication.do?popup-name=_POPUP0004& HTTP/1.1\" 500 722\n130.144.215.213 - - [24/Jun/2008:17:02:36 +0200] \"GET http://www.dev.tradelink.com/SAP/BC/BSP/SAP/thtmlb_styles/sap_skins/thtmlb_visuals_stand.css HTTP/1.0\" 200 10776\n\nAttachment error2-client-213244.pcap is network between client and server (filtered only the client affected) frame 257 is the request and 271 the response.\n\nThe capture for proxy to backend I can't attach here, it is 11MB zipped (need a lot of cliking around to trigger the error).\n\nWe are aware of the 10min timeout (this is dev). The appserver behind the proxy may execute long-running queries on a database, and the end-users accept such a query time.\n\nHopefully I can trigger this on a single-process apache as well, debugable apache is installed. Takes 10 users about half an hour, so me alone would be.....\n\nHope this helps!"}, {"count": 15, "tags": [], "creator": "rpluem@apache.org", "text": "(In reply to comment #14)\n\n> \n> Attachment error2-client-213244.pcap is network between client and server\n> (filtered only the client affected) frame 257 is the request and 271 the\n> response.\n\nThanks for the dump. I evaluated the request send by the client and the client fails to send the request body:\n\n00000786  63 4d 37 5a 49 33 59 25  33 64 0d 0a 0d 0a       cM7ZI3Y% 3d....\n\nThe string cM7ZI3Y%3d is the end of the value for the MYSAPSSO2 cookie. Afterwards the client sends \\r\\n\\r\\n which tells the server that the headers are now finished an that the request body follows next. But the client does not send a request body!\nIt seems that this request is sent via AJAX:\n\nx-requested-with: XMLHttpRequest\n\nAre you sure that there is no bug in your AJAX javascript? Using POST is not the typical way of using XMLHttpRequest. It requires some things to be done. Maybe something got wrong there in the javascript on the client side.\n\nSo in short: For this request httpd just works as designed besides that it should sent a 400 instead of a 500 return code. But I think this is fixed since 2.2.9.\n\n", "id": 117948, "attachment_id": null, "bug_id": 44592, "creation_time": "2008-06-24T12:51:50Z", "time": "2008-06-24T12:51:50Z", "is_private": false}, {"count": 16, "tags": [], "bug_id": 44592, "text": "Still analyzing the captures. And not understanding what I see.\n\nSeems that the POST header is in one SSL session, the POST body is in the next SSL session.\n\nExample : Framenumber, Time, S(erver), C(lient):port\n\n3045 C:1530->S POST /sap(<cookie>)/........\n3046 C:1530->S continuation of 3045 upto end of headers + 0D0A0D0A\n3047 C:1530->S [FIN,ACK]\n3050 C:1531->S [SYN]\n3052 S->C:1530 [ACK] \n3054 S->C:1531 [SYN,ACK]\n3061 C:1531->S Client Hello\n3062 S->C:1531 Server Hello\n3063 C:1531->S Client Key Exchange\n3064 S->C:1531 Change Cipher Spec, Finished\n3065 C:1531->S POST body\n3066 C:1531->S continuation of POST\n\nProblem in the Wireshark (Win32 1.0.0) version is that the Decrypted SSL shows the complete POST (header and body) so we inadvertedly assumed the POST was complete. The payload of the header is 1460+61 bytes, the payload of the body 1948 bytes. Wireshark shows the complete POST whichever TCP stream I select, indicating that Wireshark is able to figure out that this is in fact one http request.\n\nIs this an error with the client or is it an error with the server?\n\n", "id": 117971, "time": "2008-06-25T05:57:55Z", "creator": "brnrd@freebsd.org", "creation_time": "2008-06-25T05:57:55Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "bug_id": 44592, "is_private": false, "text": "It seems I have a problem with the Keep-Alive in conjunction with a changing order in sending and receiving of the TCP/IP frames.\n\nWe noticed that the last successful request from the client (as captured on the client) near to exactly 5 seconds before the first part of the next POST was sent by the client. Neither KeepAlive nor KeepAliveTimeout were set on Apache leaving it default 'on' and 5 seconds.\n\n(numbering of frame differs from previous post in this bugreport)\nTrace on client\n30 10:05:39.241734 S->C HTTP/1.1 200 OK [PSH,ACK]\n31 10:05:39.390101 C->S [ACK]\n32 10:05:44.269173 C->S First frame of POST\n33 10:05:44.269313 C->S First frame of POST\n34 10:05:44.275964 S->C [FIN,ACK]\n\nTrace on proxy (clocks NOT synchronized, frame matching on Seq en Ack in tcp)\n1800 11:05:55.007933 S->C SSL Continuation (client trace frame 30)\n1801 11:05:55.010493 C->S ACK\n1802 11:05:55.013463 C->S ACK\n1803 11:05:55.163385 C->S ACK\n1804 10:05:59.981127 [FIN,ACK] (client trace frame 34)\n1805 10:06:00.048579 SSL Unreassembled packet (client trace frame 32)\n1807 10:06:00.049030 Continuation (client trace frame 33)\n\nDue to the latency of the network the sending and receiving order on client and server-side have switched around.\nMy workaround was to set a specific KeepAliveTimeout in the Virtual Hosts affected (37 seconds) on the productive instance. After 2 hours I had 2 more errors:\n- one where the previous request from the client was around 37 seconds before the failing POST request\n- the other had 2 requests in short succesion from which the last one failed and the request before that was around 37 seconds earlier\n\nThe default Keep-Alive Time-Out of the Internet Explorer clients is 60 seconds (source http://support.microsoft.com/kb/813827). I am now switching the KeepAliveTimeout on the Apache servers to 67 seconds so it is longer than the Keep-Alive timeout on the client.\n\nAdditionally I found my bug described in http://support.microsoft.com/kb/921090, the PSH,ACK and FIN,ACK are listed in the client trace. I am told that wininet.dll builds after the one mentioned in this article can implement the fix by applying the registry setting FEATURE_HANDLE_SSL_CLOSE_NOTIFY_KB921090 from the MSKB article. Hopefully I can have this fix rolled out through the landscape (thousands of PC's) but that still won't fix issues with clients not under our control.\n\nSome questions remain open\n- What are the downsides of increasing the KeepAliveTimeout > 12 times?\n- Is apache behaving as should be expected?\n", "id": 118119, "time": "2008-06-30T12:38:58Z", "creator": "brnrd@freebsd.org", "creation_time": "2008-06-30T12:38:58Z", "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 44592, "text": "Please also have a look at the following excerpt from the delivered httpd \nconfiguration:\n\n#   SSL Protocol Adjustments:\n#   The safe and default but still SSL/TLS standard compliant shutdown\n#   approach is that mod_ssl sends the close notify alert but doesn't wait for\n#   the close notify alert from client. When you need a different shutdown\n#   approach you can use one of the following variables:\n#   o ssl-unclean-shutdown:\n#     This forces an unclean shutdown when the connection is closed, i.e. no\n#     SSL close notify alert is send or allowed to received.  This violates\n#     the SSL/TLS standard but is needed for some brain-dead browsers. Use\n#     this when you receive I/O errors because of the standard approach where\n#     mod_ssl sends the close notify alert.\n#   o ssl-accurate-shutdown:\n#     This forces an accurate shutdown when the connection is closed, i.e. a\n#     SSL close notify alert is send and mod_ssl waits for the close notify\n#     alert of the client. This is 100% SSL/TLS standard compliant, but in\n#     practice often causes hanging connections with brain-dead browsers. Use\n#     this only for browsers where you know that their SSL implementation\n#     works correctly.\n#   Notice: Most problems of broken clients are also related to the HTTP\n#   keep-alive facility, so you usually additionally want to disable\n#   keep-alive for those clients, too. Use variable \"nokeepalive\" for this.\n#   Similarly, one has to force some clients to use HTTP/1.0 to workaround\n#   their broken HTTP/1.1 implementation. Use variables \"downgrade-1.0\" and\n#   \"force-response-1.0\" for this.\nBrowserMatch \".*MSIE.*\" \\\n         nokeepalive ssl-unclean-shutdown \\\n         downgrade-1.0 force-response-1.0\n\nMaybe adding the BrowserMatch directive to your configuration helps.", "id": 118132, "time": "2008-06-30T13:14:10Z", "creator": "rpluem@apache.org", "creation_time": "2008-06-30T13:14:10Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "text": "(In reply to comment #17)\n\n> Some questions remain open\n> - What are the downsides of increasing the KeepAliveTimeout > 12 times?\n\nYou bind resources (threads / processes) to connections on which nothing may happen for this time. So this\n\n1. might require you to increase maximum number of clients.\n2. increase the possibility for simple DoS attacks.\n\n> - Is apache behaving as should be expected?\n> \n\nSee my previous post. IE + SSL + keepalive is a long known troublemaker and its an IE bug that causes this.\n\n", "attachment_id": null, "id": 118133, "creator": "rpluem@apache.org", "time": "2008-06-30T13:18:44Z", "bug_id": 44592, "creation_time": "2008-06-30T13:18:44Z", "is_private": false}, {"count": 20, "tags": [], "creator": "brnrd@freebsd.org", "text": "My references to the Microsoft Knowledgebase Article 921090 seem to support labeling IE as having a buggy SSL implementation. I will be attempting to get Microsoft to support us in solving this problem as well (this might be a case where buying software pays off?), this problem seems to have enough 'management attention'.\n\nHopefully my post here helps other people struggling with similar issues.\n\nWhen the KeepAliveTimeout adjustment is running a bit longer I will be able to see if there is an improvement in the number of occurences of the 'prefetch request body failed' vs the number of POST requests to the server. Will report back succes or failure to improve the situation.\n\nIn addition to these \"hangs\" as they're described by the users the users are reporting poor performance already with this service. Downgrading to HTTP/1.0 or disabling Keep-Alive will add an additional TCP and SSL negotiation step by for every request will not improve performance. (using curl --write-out \"%{time_total}\" on the server an SSL request takes at least .234 seconds for a local resource of 0 bytes).\n", "id": 118137, "time": "2008-06-30T14:02:21Z", "bug_id": 44592, "creation_time": "2008-06-30T14:02:21Z", "is_private": false, "attachment_id": null}, {"count": 21, "tags": [], "bug_id": 44592, "attachment_id": null, "is_private": false, "id": 125998, "time": "2009-04-03T19:17:38Z", "creator": "fielding@apache.org", "creation_time": "2009-04-03T19:17:38Z", "text": "This doesn't seem to be a problem that Apache can fix.\nServices generally expect a client to either make a fairly\nregular set of requests over time (justifying a keepalive)\nor to make big requests every once in a while (no keepalive).\n\nI suggest a workaround: if you can't speed up the client so\nthat it doesn't delay for so long while constructing the request,\nthen send an OPTIONS request in a regular interval before\nthe huge POST so that the connection is primed and alive.\n\nAlternatively, just use a long keepalive timeout since it\nwill only apply to SSL sessions that have already\nsuccessfully negotiated, and thus should not be as much\nof a denial of service issue as it would for a normal\npublic-facing website."}, {"count": 22, "tags": [], "bug_id": 44592, "text": "*** Bug 52965 has been marked as a duplicate of this bug. ***", "id": 167772, "time": "2013-06-10T18:54:29Z", "creator": "sczerniewicz@wp.pl", "creation_time": "2013-06-10T18:54:29Z", "is_private": false, "attachment_id": null}, {"count": 23, "tags": [], "creator": "arindam.hit@gmail.com", "text": "Hi,\n\nI am also facing the same issue. I am using it on the Windows 7 and my version is 2.2.11 for the HTTP Server. \n\nIt is showing the below error:\n\n(OS 10054)An existing connection was forcibly closed by the remote host.  : proxy: prefetch request body failed to 10.131.x.x:80 (10.131.x.x) from 10.131.y.y ()\n\nI have tried adding the keep alive and other properties but it did not resolve my issue. Here is my httpd.config file changes:\n\n<IfModule ssl_module>\n    SSLRandomSeed startup builtin\n    SSLRandomSeed connect builtin\n    </IfModule>\n    <IfModule mod_proxy.c>\n    ProxyRequests On\n    ProxyVia On\n   </IfModule>\n\n    <Proxy *>\n        Order deny,allow\n        Deny from all\n        Allow from 10.131.x.x\n    </Proxy>\n\nAlso added the below variables:\n\n KeepAlive On\n MaxKeepAliveRequests 0\n KeepAliveTimeout 15\n Listen 8080\n\nI am using it forward proxy. So what can be the issue?\n\nNote: I have tried with the Wireshark and noticed that it is connecting to my destination IP Address or server. But in the middle something is messing up the connection.\n\nThanks,\nArindam", "id": 172988, "attachment_id": null, "bug_id": 44592, "creation_time": "2014-02-11T12:44:08Z", "time": "2014-02-11T12:44:08Z", "is_private": false}, {"count": 24, "tags": [], "bug_id": 44592, "is_private": false, "text": "If it's the same issue, the disposition doesn't change. \n\nIf it's not, appending to this report is invalid.  \n\nEither way, resetting status to WONTFIX.  I suggest taking your issue to users@ or serverfault if you want help interpreting your packet capture.", "id": 172989, "time": "2014-02-11T12:53:40Z", "creator": "covener@gmail.com", "creation_time": "2014-02-11T12:53:40Z", "attachment_id": null}]
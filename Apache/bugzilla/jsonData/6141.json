[{"count": 0, "tags": [], "bug_id": 6141, "is_private": false, "id": 10103, "creation_time": "2002-01-31T05:19:19Z", "time": "2002-01-31T05:19:19Z", "creator": "dknowles@clearfield.com", "text": "There definitely appears to be an error in the InputStream which is gained from\nthe HttpServletRequest.\n\nIf the bytes are read from the data stream using the read function it returns\nbytes larger than 127 as negative values i.e. as for signed bytes. This is a\ndirect contravention of the JDK specification which states that these values\nshould be in the range of 0 to 255.\n\nThis has a flow on effect on other functions. For example if a stream of bytes\nis received by the stream the other read functions will read to the first value\nwhich is hex 0xFF and then falsly indicate that the stream is closed.\n\nI have briefly looked at the code and cannot fault it however the return of the\nread value is clearly -ve.\n\nI believe this may be why Bug 5827 is occuring.\n\nCode snipit in the servlet which exhibits this behaviour\n\nbyte [] byteBuff = new byte [ 4096 ] ;\n\n\n    public void doPost(HttpServletRequest request, HttpServletResponse response)\nthrows ServletException, IOException\n    {\n        // Get the input stream from the request\n        InputStream in = request.getInputStream ( ) ;\n\n        // Tell the log what the data length is\n        log ( \"Content Available bytes: \" + request.getContentLength() ) ;\n        // Read the data into the buffer\n        readInputSingly ( in, byteBuff, request.getContentLength() ) ;\n    }\n\n\n\n    protected void readInputSingly ( InputStream input, byte [] data, int\ndataLength ) throws java.io.IOException\n    {\n        int offset = 0 ;\n        int dataByte ;\n        log ( \"Reading bytes\" ) ;\n        while ( offset < dataLength )\n        {\n            dataByte = input.read ( ) ;\n            if ( (dataByte < 0) )\n            {\n                log ( \"The data value is negative: \" + dataByte ) ;\n            } else\n\t        {\n\t            log ( \"Byte: \" + Integer.toHexString ( dataByte ) ) ;\n                data [ offset ] = (byte)dataByte ;\n                offset ++ ;\n            }\n        }\n    }", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 6141, "is_private": false, "id": 10108, "creation_time": "2002-01-31T10:25:22Z", "time": "2002-01-31T10:25:22Z", "creator": "remm@apache.org", "text": "Please don't file a new bug if you know your report is a duplicate of an\nexisting report.\n\n*** This bug has been marked as a duplicate of 5827 ***", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 50107, "attachment_id": 26181, "id": 140793, "time": "2010-10-18T03:05:40Z", "creator": "mashmk02@gmail.com", "creation_time": "2010-10-18T03:05:40Z", "is_private": false, "text": "Created attachment 26181\npatch for MBeanFactory.java\n\nWhen I call MBeanFactory#removeHost operation via JMX(jconsle), I get the following message.\n\nINFO: The destroy() method was called on component [Pipeline[StandardHost[localhost]]] after destroy() had already been called. The second call will be ignored.\n\nStandardPipeline is destroyed two times.\nAt first, pipeline is destroyed at ContainerBase.java L.1096:\n<<ContainerBase.java destroyInternal() L.1094-1097>>\n   1094         // Stop the Valves in our pipeline (including the basic), if any\n   1095         if (pipeline instanceof Lifecycle) {\n   1096             ((Lifecycle) pipeline).destroy();\n   1097         }\n\n<<ContainerBase.java destroyInternal() L.1104-1107>>\n   1104         // Required if the child is destroyed directly.\n   1105         if (parent != null) {\n   1106             parent.removeChild(this);\n   1107         }\nWhen above-mentioned \"parent\" is StandardEngine, the parent.removeChild() calls the  LifecycleBase#child.destroy(), and child.destroy() calls ContainerBase#destroyInternal().\nAt this time ContainerBase is StandardHost.\n<<ContainerBase.java removeChild() L.960-964>>\n    960         // Set child's parent to null to prevent a loop\n    961         child.setParent(null);\n    962         try {\n    963             child.destroy();\n    964         } catch (LifecycleException e) {\n\nAs a result, pipeline is destroyed again(, and get the above-mentioned info message).\n\nIn Tomcat 6.0, child.destroy() is not called from ContainerBase#removeChild().\nBut, as seen above, the removeChild() that is contained in Tomcat7.0 calls the child.destroy().\nIMHO, it might not be better to call the child.destroy() from removeHost().\n\nI made the patch that removed host.destroy() from removeHost(). \n\nBest regards."}, {"count": 1, "tags": [], "bug_id": 50107, "text": "Thanks for the report and the patch.\n\nYour patch has been applied to 7.0.x and will be included in 7.0.5 onwards.", "id": 140821, "time": "2010-10-19T09:15:11Z", "creator": "markt@apache.org", "creation_time": "2010-10-19T09:15:11Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 3973, "text": "I'm noticing some strange behaviour with a class that implements\nHttpSessionListener and is registered in webapp.xml file.\n\nWhen I call session.getAttribute(\"xxx\") on a session passed into\nsessionDestroyed() the thread seems to lock. No exceptions are thrown. \n\nI'm running tomcat 4.0 final on windows 2k. I've received the same\nresults on both jdk 1.3.1 and 1.4 beta.\n\nI've simplified my class as a test case and it never makes it to the\nSystem.out.println(\"attribute shown\") statement.\n\nTo create and destroy the session i used two jsp pages: \n\npopulateSession.jsp\ninvalidateSession.jsp \n\none sets a value in the session, another\ncalls session.invalidate().\n\noutput from stdout.log and class definition are included bellow.\n\nstdout.log\n----\nCreate Catalina server\nStarting service Tomcat-Standalone\nApache Tomcat/4.0\nServletContext Initialized\nStarting service Tomcat-Apache\nApache Tomcat/4.0\nSession Created <!-- click on populateSession.jsp -->\nattribute added\nSession Destroyed <!-- click on invalidateSession.jsp -->\n     <!-- execution stops before showing attribute value -->\n----\n\nimport java.util.*;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\n\npublic class LoggingController implements ServletContextListener,\nHttpSessionListener\n{\n\npublic LoggingController()\n{\n // System.out.println(\"LoggingController constructed\");\n}\n\npublic void contextInitialized(ServletContextEvent sce)\n{\n\tSystem.out.println(\"ServletContext Initialized\");\n}\n\npublic void contextDestroyed(ServletContextEvent sce)\n{\n\tSystem.out.println(\"ServletContext Destroyed\");\n}\n\npublic void sessionCreated(HttpSessionEvent hse)\n{\n System.out.println(\"Session Created\");\n\n HttpSession session = hse.getSession();\n session.setAttribute(\"name\", \"scott\");\n\n // execution makes it here ok\n System.out.println(\"attribute added\");\n}\n\n\npublic void sessionDestroyed(HttpSessionEvent hse)\n{\n System.out.println(\"Session Destroyed\");\n\n HttpSession session = hse.getSession();\n\n // seems to hang up on the following line\n System.out.println(session.getAttribute(\"name\"));\n\n System.out.println(\"attribute shown\");\n }\n}", "id": 6372, "time": "2001-10-04T09:33:40Z", "creator": "pixel@pixelfreak.net", "creation_time": "2001-10-04T09:33:40Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 3973, "attachment_id": null, "text": "Actually, what very likely happens is that an IllegalStateException is raised \non the session.getAttribute call, since the session is invalidated (and so the \nmessage is never displayed). Is the exception printed out in the logs ?\n\nHttpSession.getAttribute Javadoc:\n\nReturns the object bound with the specified name in this session, or null if no \nobject is bound under the name.\nParameters:\nname - a string specifying the name of the object\nReturns:\nthe object with the specified name\nThrows:\njava.lang.IllegalStateException - if this method is called on an invalidated \nsession\n", "id": 6397, "time": "2001-10-04T18:15:21Z", "creator": "remm@apache.org", "creation_time": "2001-10-04T18:15:21Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 3973, "attachment_id": null, "text": "I'm not seeing any exceptions, which led me to post this issue. \n\nstderr.log is empty\n\nbellow is the entire stdout.log file from startup to shutdown with only the\nclass posted in the web.xml file and two JSP pages to create and invalidate the\nsession. i can post the jsps if you might find them useful. as indicated in the\ncode, i didn't wrap the call to session.getAttribute() in a try / catch block so\nI would have expected any exceptions thrown to show up here. none are listed\n\nCreate Catalina server <!-- start tomcat service -->\nStarting service Tomcat-Standalone\nApache Tomcat/4.0\nServletContext Initialised\nStarting service Tomcat-Apache\nApache Tomcat/4.0\nSession Created <!-- click on populateSession.jsp -->\nattribute added\nSession Destroyed <!-- click on invalidateSession.jsp -->\nStopping service Tomcat-Standalone <!-- stop tomcat service - no exception?-->\nServletContext Destroyed\nStopping service Tomcat-Apache\nStop server complete", "id": 6398, "time": "2001-10-04T20:10:15Z", "creator": "pixel@pixelfreak.net", "creation_time": "2001-10-04T20:10:15Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 3973, "text": "No, those are some NT specific logs which capture the stdout and stderr when \nTomcat is run as a service. The exceptions would actually go to one of the \nother logs: localhost_log or localhost_examples_log (if you put your JSPs in \nthe examples webapp).", "id": 6399, "time": "2001-10-04T20:13:56Z", "creator": "remm@apache.org", "creation_time": "2001-10-04T20:13:56Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 3973, "text": "found it... along with a few other exceptions, which explains other strange\nbehaviour i was seeing.. \n\nsorry for the false alarm!\n\ni've already moved code i was planning to execute here to the valueUnbound()\nmethod of HttpSessionBindingListener. it's a round about way to do it, but it\nworks... \n\nthanks!\n\nlocalhost_log.2001-10-03.txt\n---\n2001-10-03 23:40:04 jsp: init\n2001-10-03 23:40:04 StandardManager[] Session event listener threw exception\njava.lang.IllegalStateException: getAttribute: Session already invalidated\n\tat org.apache.catalina.session.StandardSession.getAttribute(StandardSession.java:900)\n\tat\norg.apache.catalina.session.StandardSessionFacade.getAttribute(StandardSessionFacade.java:171)", "id": 6400, "time": "2001-10-04T20:39:08Z", "creator": "pixel@pixelfreak.net", "creation_time": "2001-10-04T20:39:08Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 3973, "attachment_id": null, "id": 36261, "time": "2003-04-29T06:04:39Z", "creator": "univerz@21cn.com", "creation_time": "2003-04-29T06:04:39Z", "is_private": false, "text": "I don't think this bug has been solved.\nI still find it in tomcat4.1.24.\n\nIn addition,I found the same bug at jetty4.2.9,but not at weblogic8.1"}, {"count": 6, "tags": [], "text": "*** Bug 19410 has been marked as a duplicate of this bug. ***", "attachment_id": null, "id": 36263, "creator": "remm@apache.org", "time": "2003-04-29T06:16:49Z", "bug_id": 3973, "creation_time": "2003-04-29T06:16:49Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 3973, "text": "<spec-quote version=\"servlet-2.3\" section=\"15.1.14.1\">\npublic void sessionDestroyed(HttpSessionEvent se)\nNotification that a session was invalidated.\n</spec-quote>\n\nNote the word \"was\".  After the session has been invalidated, it is illegal to \naccess any of the (former) attributes.\n\n", "id": 36266, "time": "2003-04-29T07:06:09Z", "creator": "william.barker@wilshire.com", "creation_time": "2003-04-29T07:06:09Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "funkman@joedog.org", "attachment_id": null, "text": "*** Bug 29444 has been marked as a duplicate of this bug. ***", "id": 58875, "time": "2004-06-08T15:47:46Z", "bug_id": 3973, "creation_time": "2004-06-08T15:47:46Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "abashev@gmail.com", "attachment_id": null, "id": 72048, "time": "2005-03-09T14:56:29Z", "bug_id": 33928, "creation_time": "2005-03-09T14:56:29Z", "is_private": false, "text": "Essence of this bug lie in unusual the java task's output processing.\nHow reproduce it:\n1. This is simple class which dump on the screen string \"{220} {221}Click\n{222}`Yes'{223}\" in UTF-8 encoding. \n\nimport java.io.*;\n\npublic class Main {\n\tpublic static void main(String[] args) throws Exception {\n\t\tbyte[] b = new byte[] {123, 50, 50, 48, 125, 32, 123, 50, 50, 49, 125, 67,\n108, 105, 99, 107, 32, 123, 50, 50, 50, 125, -30, -128, -104, 89, 101, 115, -30,\n-128, -103, 123, 50, 50, 51, 125, 46};\n\n        System.out.write(b);\n        System.out.println();\n\t}\n}\n\nAnd then you ran this class from command line no unusual happens.\n%java_home%\\bin\\java -cp . Main > text_file\n\n2. But then we trying to do the same from ant build file like this:\n<target name=\"test\">\n  <java classname=\"Main\" output=\"other_text\">\n    <classpath>\n      <pathelement location=\".\"/>\n    </classpath>\n  </java>\n</target>\n\nother_text file is differ from text_file. And difference in left quote.\n\nJDK 1.4.2_07"}, {"attachment_id": null, "tags": [], "creator": "stevel@apache.org", "is_private": false, "count": 1, "id": 72049, "time": "2005-03-09T15:16:35Z", "bug_id": 33928, "creation_time": "2005-03-09T15:16:35Z", "text": "This is interesting. what locale are you running in? How exactly are the two\nfiles different.\n\nHave you had a play with the <redirector> element and its outputEncoding\nattribute to control the encoding of output streams?"}, {"count": 2, "attachment_id": null, "creator": "abashev@gmail.com", "is_private": false, "id": 72050, "time": "2005-03-09T15:24:56Z", "bug_id": 33928, "creation_time": "2005-03-09T15:24:56Z", "tags": [], "text": "(In reply to comment #1)\n> This is interesting. what locale are you running in? How exactly are the two\n> files different.\n> \n> Have you had a play with the <redirector> element and its outputEncoding\n> attribute to control the encoding of output streams?\n\nLocale ru_RU\n25th byte is differ. In correct file three bytes E2 80 98 are equal left quote.\nBut in not correct file E2 80 3F (25th is '?')\n"}, {"count": 3, "tags": [], "text": "Redirector tag don't help me. And in this case I must use inputEncoding\nparameter as I think. \n\nAnd I can't use this tag because output encoding was setup only at runtime.\n\n", "is_private": false, "bug_id": 33928, "id": 72051, "time": "2005-03-09T15:35:30Z", "creator": "abashev@gmail.com", "creation_time": "2005-03-09T15:35:30Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Does ANT read STDOUT as characters?", "attachment_id": null, "id": 72065, "creation_time": "2005-03-09T18:13:15Z", "time": "2005-03-09T18:13:15Z", "creator": "alexeys@inventigo.com", "bug_id": 33928, "is_private": false}, {"count": 5, "attachment_id": null, "creator": "abashev@gmail.com", "is_private": false, "id": 72066, "time": "2005-03-09T18:17:28Z", "bug_id": 33928, "creation_time": "2005-03-09T18:17:28Z", "tags": [], "text": "(In reply to comment #4)\n> Does ANT read STDOUT as characters?\n\nIf this question to me - I don't know :)"}, {"count": 6, "tags": [], "creator": "mbenson@apache.org", "attachment_id": null, "id": 72146, "time": "2005-03-10T20:02:32Z", "bug_id": 33928, "creation_time": "2005-03-10T20:02:32Z", "is_private": false, "text": "I am confused.  You said redirector doesn't help you.  You said you need\ninputencoding.  Redirector has it.  This seems to work for me:\n\n<java classname=\"Main\" output=\"other_text\">\n  <classpath>\n    <pathelement location=\".\"/>\n  </classpath>\n  <redirector inputencoding=\"UTF-8\" />\n</java>\n\nPlease verify."}, {"count": 7, "tags": [], "bug_id": 33928, "is_private": false, "text": "(In reply to comment #6)\n> I am confused.  You said redirector doesn't help you.  You said you need\n> inputencoding.  Redirector has it.  This seems to work for me:\n> \n> <java classname=\"Main\" output=\"other_text\">\n>   <classpath>\n>     <pathelement location=\".\"/>\n>   </classpath>\n>   <redirector inputencoding=\"UTF-8\" />\n> </java>\n> \n> Please verify.\n\nNope. This is not help. I'm gettin text like this:\n{220} {221}Click {222}??Yes\u00d2{223}.\n", "id": 72147, "time": "2005-03-10T20:05:54Z", "creator": "abashev@gmail.com", "creation_time": "2005-03-10T20:05:54Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "mbenson@apache.org", "attachment_id": null, "id": 72148, "time": "2005-03-10T20:11:00Z", "bug_id": 33928, "creation_time": "2005-03-10T20:11:00Z", "is_private": false, "text": "And what do you see when you also set the outputencoding to UTF-8?"}, {"count": 9, "tags": [], "creator": "abashev@gmail.com", "attachment_id": null, "id": 72149, "time": "2005-03-10T20:13:48Z", "bug_id": 33928, "creation_time": "2005-03-10T20:13:48Z", "is_private": false, "text": "(In reply to comment #8)\n> And what do you see when you also set the outputencoding to UTF-8?\n\n{220} {221}Click {222}&#9576;&#9619;&#9576;\u00c2?Yes&#9576;&#9619;&#9576;\u00c2\u00f2\u00c4\u00e2{223}.\n\n"}, {"count": 10, "tags": [], "bug_id": 33928, "is_private": false, "text": "(In reply to comment #9)\n> (In reply to comment #8)\n> > And what do you see when you also set the outputencoding to UTF-8?\n> \n> {220} {221}Click {222}&#9576;&#9619;&#9576;\u00c2?Yes&#9576;&#9619;&#9576;\u00c2\u00f2\u00c4\u00e2{223}.\n> \n \nSorry, this is ASCII graphics.\n", "id": 72150, "time": "2005-03-10T20:15:45Z", "creator": "abashev@gmail.com", "creation_time": "2005-03-10T20:15:45Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 33928, "is_private": false, "text": "Can you attach the text file created when you run your class from the\ncommand-line?  Attach it as an octet type or whatever to make sure it doesn't\nget corrupted in any way.", "id": 72152, "time": "2005-03-10T20:31:28Z", "creator": "mbenson@apache.org", "creation_time": "2005-03-10T20:31:28Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 33928, "attachment_id": 14461, "id": 72185, "creation_time": "2005-03-11T10:08:18Z", "time": "2005-03-11T10:08:18Z", "creator": "abashev@gmail.com", "text": "Created attachment 14461\nOutput from command line", "is_private": false}, {"count": 13, "tags": [], "creator": "abashev@gmail.com", "attachment_id": 14462, "id": 72186, "time": "2005-03-11T10:09:38Z", "bug_id": 33928, "creation_time": "2005-03-11T10:09:38Z", "is_private": false, "text": "Created attachment 14462\nOutput from ant script (without redirector)\n\nScript\n\n<project name=\"Ant test\" default=\"test\" basedir=\".\">\n    <target name=\"test\">\n\t    <java classname=\"Main\" output=\"other_text\">\n\t\t <classpath>\n\t   <pathelement location=\".\"/>\n\t </classpath>\n      </java>\n    </target>\n</project>"}, {"count": 14, "tags": [], "text": "I can still reproduce such a problem in a Java 1.7 VM which runs under \"US-ASCII\" encoding. All non ascii characters in the output of java are then replaced by question marks.\n\nThe current behavior seems to be that bytes which are output by the class run by the java class are captured correctly only if these bytes are legal characters in the current encoding on the VM.", "attachment_id": null, "id": 165918, "creation_time": "2013-03-18T00:39:19Z", "time": "2013-03-18T00:39:19Z", "creator": "antoine@apache.org", "bug_id": 33928, "is_private": false}, {"count": 15, "tags": [], "text": "Closing this bug for now, feel free to reopen if this is still an issue, explaining which JVM is being used and under which encoding the JVM is running.", "is_private": false, "bug_id": 33928, "id": 166917, "time": "2013-04-28T20:42:29Z", "creator": "antoine@apache.org", "creation_time": "2013-04-28T20:42:29Z", "attachment_id": null}]
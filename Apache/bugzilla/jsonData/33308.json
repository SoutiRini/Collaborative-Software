[{"count": 0, "attachment_id": null, "bug_id": 33308, "is_private": false, "id": 70261, "time": "2005-01-31T08:06:56Z", "creator": "cstach-asf@ldsys.net", "creation_time": "2005-01-31T08:06:56Z", "tags": [], "text": "Apache version apache-1.3.27-9.ent.src.rpm (RedHat ES 2.1)\nTomcat version 5.5.4\nSun JDK 1.5.0_01\nmod_jk 1.2.8 (local AJP 1.3 through loadbalancer)\n\nThe webapps are local to apache, so the dirs are all readable.  mod_dir works \nproperly.  When ForwardDirectories is not specified, it dumps index.html.  When \nForwardDirectories is enabled, the httpd worker segfaults.  Specifying the \nindex.jsp works properly.  Specifying index.html works, too.  Only after a \nsuccessful search does it come to this.\n\nTomcat log:\n\nDEBUG TP-Processor3 org.apache.jk.common.ChannelSocket - read() [B@7c7894 8192 \n0 4 = -1\nDEBUG TP-Processor3 org.apache.jk.common.ChannelSocket - server has been \nrestarted or reset this connection\n\njk log:\n\n[Mon Jan 31 02:01:50 2005] [12751:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (671): enter\n[Mon Jan 31 02:01:50 2005] [12751:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (700): Attempting to map URI '/WEBAPP' \nfrom 3 maps\n[Mon Jan 31 02:01:50 2005] [12751:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (559): enter\n[Mon Jan 31 02:01:50 2005] [12751:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (656): exit\n[Mon Jan 31 02:01:50 2005] [12751:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (718): Attempting to map context \nURI '/*.jsp'\n[Mon Jan 31 02:01:50 2005] [12751:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (845): exit\n[Mon Jan 31 02:01:50 2005] [12751:0] [debug] jk_translate::mod_jk.c (1955): \nmod_jk::jk_translate, check alias_dir: /com/webapps\n[Mon Jan 31 02:01:50 2005] [12751:0] [debug] jk_translate::mod_jk.c (2011): \nmod_jk::jk_translate, AutoAlias OK for file: /com/webapps/WEBAPP\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (671): enter\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (700): Attempting to map URI '/WEBAPP/' \nfrom 3 maps\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (559): enter\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (656): exit\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (718): Attempting to map context \nURI '/*.jsp'\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (845): exit\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] jk_translate::mod_jk.c (1955): \nmod_jk::jk_translate, check alias_dir: /com/webapps\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] jk_translate::mod_jk.c (1980): \nmod_jk::jk_translate, AutoAlias child_dir: \n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] jk_translate::mod_jk.c (2011): \nmod_jk::jk_translate, AutoAlias OK for file: /com/webapps/WEBAPP/\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (671): enter\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (700): Attempting to map \nURI '/WEBAPP/index.jsp' from 3 maps\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (559): enter\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (656): exit\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (718): Attempting to map context \nURI '/*.jsp'\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (808): Found a suffix match lb1 -> *.jsp\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (821): exit\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (671): enter\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (700): Attempting to map \nURI '/WEBAPP/index.php' from 3 maps\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (559): enter\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (656): exit\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (718): Attempting to map context \nURI '/*.jsp'\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (845): exit\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] jk_translate::mod_jk.c (1955): \nmod_jk::jk_translate, check alias_dir: /com/webapps\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] jk_translate::mod_jk.c (1980): \nmod_jk::jk_translate, AutoAlias child_dir: index.php\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] jk_translate::mod_jk.c (2011): \nmod_jk::jk_translate, AutoAlias OK for file: /com/webapps/WEBAPP/index.php\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (671): enter\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (700): Attempting to map \nURI '/WEBAPP/index.html' from 3 maps\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (559): enter\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (656): exit\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (718): Attempting to map context \nURI '/*.jsp'\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (845): exit\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] jk_translate::mod_jk.c (1955): \nmod_jk::jk_translate, check alias_dir: /com/webapps\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] jk_translate::mod_jk.c (1980): \nmod_jk::jk_translate, AutoAlias child_dir: index.html\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] jk_translate::mod_jk.c (2011): \nmod_jk::jk_translate, AutoAlias OK for file: /com/webapps/WEBAPP/index.html\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (671): enter\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (700): Attempting to map \nURI '/WEBAPP/index.html' from 3 maps\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (559): enter\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nis_nomap_match::jk_uri_worker_map.c (656): exit\n[Mon Jan 31 02:01:50 2005] [12749:0] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (718): Attempting to map context \nURI '/*.jsp'\n[Mon Jan 31 02:01:50 2005] [12749:0] [trace] \nmap_uri_to_worker::jk_uri_worker_map.c (845): exit\n\nI'm a little too tired to track this down right now, but in case anyone else \nwants the stack trace to check it out:\n\n[root@rx ~]# gdb /usr/sbin/httpd 12718\nGNU gdb Red Hat Linux (5.3.90-0.20030710.41.2.1rh)\nCopyright 2003 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-redhat-linux\"...\n(no debugging symbols found)...Using host libthread_db \nlibrary \"/lib/libthread_db.so.1\".\n\nAttaching to program: /usr/sbin/httpd, process 12718\nReading symbols from /lib/i686/libpthread.so.0...done.\n[Thread debugging using libthread_db enabled]\n[New Thread 8192 (LWP 12718)]\nLoaded symbols for /lib/i686/libpthread.so.0\nReading symbols from /lib/i686/libm.so.6...done.\nLoaded symbols for /lib/i686/libm.so.6\nReading symbols from /lib/libcrypt.so.1...done.\nLoaded symbols for /lib/libcrypt.so.1\nReading symbols from /lib/libdb-3.3.so...done.\nLoaded symbols for /lib/libdb-3.3.so\nReading symbols from /usr/lib/libmm.so.11...done.\nLoaded symbols for /usr/lib/libmm.so.11\nReading symbols from /usr/lib/libexpat.so.0...done.\nLoaded symbols for /usr/lib/libexpat.so.0\nReading symbols from /lib/libdl.so.2...done.\nLoaded symbols for /lib/libdl.so.2\nReading symbols from /lib/i686/libc.so.6...done.\nLoaded symbols for /lib/i686/libc.so.6\nReading symbols from /lib/ld-linux.so.2...done.\nLoaded symbols for /lib/ld-linux.so.2\nReading symbols from /lib/libnss_files.so.2...done.\nLoaded symbols for /lib/libnss_files.so.2\nReading symbols from /etc/httpd/modules/mod_vhost_alias.so...done.\nLoaded symbols for /etc/httpd/modules/mod_vhost_alias.so\nReading symbols from /etc/httpd/modules/mod_env.so...done.\nLoaded symbols for /etc/httpd/modules/mod_env.so\nReading symbols from /etc/httpd/modules/mod_log_config.so...done.\nLoaded symbols for /etc/httpd/modules/mod_log_config.so\nReading symbols from /etc/httpd/modules/mod_log_agent.so...done.\nLoaded symbols for /etc/httpd/modules/mod_log_agent.so\nReading symbols from /etc/httpd/modules/mod_log_referer.so...done.\nLoaded symbols for /etc/httpd/modules/mod_log_referer.so\nReading symbols from /etc/httpd/modules/mod_mime.so...done.\nLoaded symbols for /etc/httpd/modules/mod_mime.so\nReading symbols from /etc/httpd/modules/mod_negotiation.so...done.\nLoaded symbols for /etc/httpd/modules/mod_negotiation.so\nReading symbols from /etc/httpd/modules/mod_status.so...done.\nLoaded symbols for /etc/httpd/modules/mod_status.so\nReading symbols from /etc/httpd/modules/mod_info.so...done.\nLoaded symbols for /etc/httpd/modules/mod_info.so\nReading symbols from /etc/httpd/modules/mod_include.so...done.\nLoaded symbols for /etc/httpd/modules/mod_include.so\nReading symbols from /etc/httpd/modules/mod_autoindex.so...done.\nLoaded symbols for /etc/httpd/modules/mod_autoindex.so\nReading symbols from /etc/httpd/modules/mod_dir.so...done.\nLoaded symbols for /etc/httpd/modules/mod_dir.so\nReading symbols from /etc/httpd/modules/mod_cgi.so...done.\nLoaded symbols for /etc/httpd/modules/mod_cgi.so\nReading symbols from /etc/httpd/modules/mod_asis.so...done.\nLoaded symbols for /etc/httpd/modules/mod_asis.so\nReading symbols from /etc/httpd/modules/mod_imap.so...done.\nLoaded symbols for /etc/httpd/modules/mod_imap.so\nReading symbols from /etc/httpd/modules/mod_actions.so...done.\nLoaded symbols for /etc/httpd/modules/mod_actions.so\nReading symbols from /etc/httpd/modules/mod_userdir.so...done.\nLoaded symbols for /etc/httpd/modules/mod_userdir.so\nReading symbols from /etc/httpd/modules/mod_alias.so...done.\nLoaded symbols for /etc/httpd/modules/mod_alias.so\nReading symbols from /etc/httpd/modules/mod_rewrite.so...done.\nLoaded symbols for /etc/httpd/modules/mod_rewrite.so\nReading symbols from /etc/httpd/modules/mod_access.so...done.\nLoaded symbols for /etc/httpd/modules/mod_access.so\nReading symbols from /etc/httpd/modules/mod_auth.so...done.\nLoaded symbols for /etc/httpd/modules/mod_auth.so\nReading symbols from /etc/httpd/modules/mod_auth_anon.so...done.\nLoaded symbols for /etc/httpd/modules/mod_auth_anon.so\nReading symbols from /etc/httpd/modules/mod_auth_db.so...done.\nLoaded symbols for /etc/httpd/modules/mod_auth_db.so\nReading symbols from /etc/httpd/modules/mod_expires.so...done.\nLoaded symbols for /etc/httpd/modules/mod_expires.so\nReading symbols from /etc/httpd/modules/mod_headers.so...done.\nLoaded symbols for /etc/httpd/modules/mod_headers.so\nReading symbols from /etc/httpd/modules/mod_setenvif.so...done.\nLoaded symbols for /etc/httpd/modules/mod_setenvif.so\nReading symbols from /etc/httpd/modules/libperl.so...done.\nLoaded symbols for /etc/httpd/modules/libperl.so\nReading symbols from /lib/libnsl.so.1...done.\nLoaded symbols for /lib/libnsl.so.1\nReading symbols from /lib/libutil.so.1...done.\nLoaded symbols for /lib/libutil.so.1\nReading symbols from /etc/httpd/modules/libphp4.so...done.\nLoaded symbols for /etc/httpd/modules/libphp4.so\nReading symbols from /lib/libpam.so.0...done.\nLoaded symbols for /lib/libpam.so.0\n---Type <return> to continue, or q <return> to quit---\nReading symbols from /usr/lib/libltdl.so.3...done.\nLoaded symbols for /usr/lib/libltdl.so.3\nReading symbols from /usr/lib/libpspell-modules.so.1...done.\nLoaded symbols for /usr/lib/libpspell-modules.so.1\nReading symbols from /usr/lib/libstdc++-libc6.2-2.so.3...done.\nLoaded symbols for /usr/lib/libstdc++-libc6.2-2.so.3\nReading symbols from /usr/lib/libz.so.1...done.\nLoaded symbols for /usr/lib/libz.so.1\nReading symbols from /lib/libcrypto.so.2...done.\nLoaded symbols for /lib/libcrypto.so.2\nReading symbols from /lib/libssl.so.2...done.\nLoaded symbols for /lib/libssl.so.2\nReading symbols from /lib/libresolv.so.2...done.\nLoaded symbols for /lib/libresolv.so.2\nReading symbols from /usr/lib/libpspell.so.4...done.\nLoaded symbols for /usr/lib/libpspell.so.4\nReading symbols from /usr/lib/libgmp.so.3...done.\nLoaded symbols for /usr/lib/libgmp.so.3\nReading symbols from /usr/lib/libgd.so.1.8...done.\nLoaded symbols for /usr/lib/libgd.so.1.8\nReading symbols from /usr/lib/libxml2.so.2...done.\nLoaded symbols for /usr/lib/libxml2.so.2\nReading symbols from /usr/lib/libgdbm.so.2...done.\nLoaded symbols for /usr/lib/libgdbm.so.2\nReading symbols from /usr/lib/libcurl.so.1...done.\nLoaded symbols for /usr/lib/libcurl.so.1\nReading symbols from /usr/lib/libbz2.so.1...done.\nLoaded symbols for /usr/lib/libbz2.so.1\nReading symbols from /usr/lib/libttf.so.2...done.\nLoaded symbols for /usr/lib/libttf.so.2\nReading symbols from /usr/lib/libfreetype.so.6...done.\nLoaded symbols for /usr/lib/libfreetype.so.6\nReading symbols from /usr/lib/libpng.so.2...done.\nLoaded symbols for /usr/lib/libpng.so.2\nReading symbols from /usr/lib/libjpeg.so.62...done.\nLoaded symbols for /usr/lib/libjpeg.so.62\nReading symbols from /etc/httpd/modules/libdav.so...done.\nLoaded symbols for /etc/httpd/modules/libdav.so\nReading symbols from /etc/httpd/modules/libssl.so...done.\nLoaded symbols for /etc/httpd/modules/libssl.so\nReading symbols from /etc/httpd/modules/mod_python.so...done.\nLoaded symbols for /etc/httpd/modules/mod_python.so\nReading symbols from /etc/httpd/modules/mod_jk.so...done.\nLoaded symbols for /etc/httpd/modules/mod_jk.so\nReading symbols from /usr/lib/php4/imap.so...done.\nLoaded symbols for /usr/lib/php4/imap.so\nReading symbols from /usr/kerberos/lib/libgssapi_krb5.so.2...done.\nLoaded symbols for /usr/kerberos/lib/libgssapi_krb5.so.2\nReading symbols from /usr/kerberos/lib/libkrb5.so.3...done.\nLoaded symbols for /usr/kerberos/lib/libkrb5.so.3\nReading symbols from /usr/kerberos/lib/libk5crypto.so.3...done.\nLoaded symbols for /usr/kerberos/lib/libk5crypto.so.3\nReading symbols from /usr/kerberos/lib/libcom_err.so.3...done.\nLoaded symbols for /usr/kerberos/lib/libcom_err.so.3\nReading symbols from /usr/lib/php4/ldap.so...done.\nLoaded symbols for /usr/lib/php4/ldap.so\nReading symbols from /usr/lib/libldap.so.2...done.\nLoaded symbols for /usr/lib/libldap.so.2\nReading symbols from /usr/lib/liblber.so.2...done.\nLoaded symbols for /usr/lib/liblber.so.2\nReading symbols from /usr/lib/libsasl.so.7...done.\nLoaded symbols for /usr/lib/libsasl.so.7\nReading symbols from /usr/lib/php4/mysql.so...done.\nLoaded symbols for /usr/lib/php4/mysql.so\nReading symbols from /usr/lib/mysql/libmysqlclient.so.10...done.\nLoaded symbols for /usr/lib/mysql/libmysqlclient.so.10\nReading symbols from /usr/lib/php4/pgsql.so...done.\nLoaded symbols for /usr/lib/php4/pgsql.so\nReading symbols from /usr/lib/libpq.so.2...done.\nLoaded symbols for /usr/lib/libpq.so.2\nReading symbols from /lib/libnss_nisplus.so.2...done.\nLoaded symbols for /lib/libnss_nisplus.so.2\n0x40249ed2 in semop (semid=2064384, sops=0x8087870, nsops=1)\n    at ../sysdeps/unix/sysv/linux/semop.c:36\n36      ../sysdeps/unix/sysv/linux/semop.c: No such file or directory.\n        in ../sysdeps/unix/sysv/linux/semop.c\n(gdb) cont\nContinuing.\n\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 8192 (LWP 12718)]\n0x40a2a3d6 in jk_translate (r=0x8127d68) at mod_jk.c:1936\n1936    mod_jk.c: No such file or directory.\n        in mod_jk.c\n(gdb) where\n#0  0x40a2a3d6 in jk_translate (r=0x8127d68) at mod_jk.c:1936\n#1  0x08054762 in run_method ()\n#2  0x080547c4 in ap_translate_name ()\n#3  0x08067b13 in process_request_internal ()\n#4  0x403c7d43 in handle_dir () from /etc/httpd/modules/mod_dir.so\n#5  0x08054bad in ap_invoke_handler ()\n#6  0x08067edc in process_request_internal ()\n#7  0x08067f53 in ap_process_request ()\n#8  0x08060067 in child_main ()\n#9  0x080602a9 in make_child ()\n#10 0x080605fb in perform_idle_server_maintenance ()\n#11 0x08060b9c in standalone_main ()\n#12 0x080612a3 in main ()\n(gdb) list\n1936                    r->prev && !strcmp(r->prev->handler, JK_HANDLER) &&\n1937                    r->uri[strlen(r->uri) - 1] == '/') {\n1938\n1939                    /* Nothing here to do but assign the first worker since \nwe\n1940                     * already tried mapping and it didn't work out */\n1941                    worker = worker_env.first_worker;\n1942\n1943                    jk_log(l, JK_LOG_DEBUG, \"Manual configuration for %s %\ns\\n\",\n1944                           r->uri, worker_env.first_worker);\n1945                }"}, {"count": 1, "attachment_id": null, "bug_id": 33308, "text": "I don't know why the handler isn't being set, but this patch remedies the \nsegfault for now.\n\n--- jakarta-tomcat-connectors-1.2.8-src.orig/jk/native/apache-1.3/mod_jk.c     \nFri Dec 24 05:18:10 2004\n+++ jakarta-tomcat-connectors-1.2.8-src/jk/native/apache-1.3/mod_jk.c   Mon Jan \n31 16:41:58 2005\n@@ -1933,7 +1933,8 @@\n              * jk_fixups) and the request is for a directory:\n              * --> forward to Tomcat, via default worker */\n             if (!worker && (conf->options & JK_OPT_FWDDIRS) &&\n-                r->prev && !strcmp(r->prev->handler, JK_HANDLER) &&\n+                r->prev && r->prev->handler &&\n+                !strcmp(r->prev->handler, JK_HANDLER) &&\n                 r->uri[strlen(r->uri) - 1] == '/') {\n \n                 /* Nothing here to do but assign the first worker since we\n", "id": 70716, "time": "2005-02-09T23:29:55Z", "creator": "cstach-asf@ldsys.net", "creation_time": "2005-02-09T23:29:55Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "mturk@apache.org", "text": "Hi,\nThis has already been fixed in the CVS. Take a look at:\nhttp://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-connectors/jk/native/apache-\n1.3/mod_jk.c?r1=1.61&r2=1.62&diff_format=h\n\n", "id": 70736, "time": "2005-02-10T08:19:34Z", "bug_id": 33308, "creation_time": "2005-02-10T08:19:34Z", "is_private": false, "attachment_id": null}]
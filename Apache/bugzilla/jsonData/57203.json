[{"count": 0, "tags": [], "text": "Hi.\n\nI use the tool Collabnet Subversion Edge 4.0.11 which is bundled with httpd 2.4.10\n\nWhen using ldap to authenticate users, it works for some time (1-2 hours) then these errors are logged.\n[auth_basic:error] [pid 30962] [client xxx.xxx.xxx.xxx:51772] AH01618: user auser not found:\n\nIf I restart the httpd deamon, it works for a new time period but then back to the errors.\n\nWorkaround:\nLDAPConnectionPoolTTL 60\n(previous used the default -1 value)\n\nQuestion:\nThe problems are gone now, but is this setting really good (60 value) ?\nWill we have any other problems in future (performance)\n\nI thought the apache ldap module could detect closed connections and then create a new ones when needed.\n\nOur ldap configuration works without problem in Jenkins, JIRA for example.\n\nBR Jorgen", "is_private": false, "id": 179063, "creator": "jorgen.sandstrom@gmail.com", "time": "2014-11-12T13:07:35Z", "bug_id": 57203, "creation_time": "2014-11-12T13:07:35Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 57203, "attachment_id": null, "id": 179064, "time": "2014-11-12T13:15:36Z", "creator": "covener@gmail.com", "creation_time": "2014-11-12T13:15:36Z", "is_private": false, "text": "There is a fix in 2.4.11 that may be related, but tough to tell w/o context:\n\n  *) mod_ldap: In 2.4.10, some LDAP searches or comparisons might be done with\n     the wrong credentials when a backend connection is reused.\n\nCan you get it to fail under loglevel debug or trace8?\n\nOtherwise you are right that you should just see a retry and maybe a short delay if a connection in the pool goes south."}, {"count": 2, "tags": [], "bug_id": 57203, "attachment_id": null, "is_private": false, "id": 179065, "time": "2014-11-12T13:42:03Z", "creator": "jorgen.sandstrom@gmail.com", "creation_time": "2014-11-12T13:42:03Z", "text": "(In reply to Eric Covener from comment #1)\n> There is a fix in 2.4.11 that may be related, but tough to tell w/o context:\n> \n>   *) mod_ldap: In 2.4.10, some LDAP searches or comparisons might be done\n> with\n>      the wrong credentials when a backend connection is reused.\n> \n> Can you get it to fail under loglevel debug or trace8?\n> \n> Otherwise you are right that you should just see a retry and maybe a short\n> delay if a connection in the pool goes south.\n\n\n\nI have logs from Subversion edge in debug mode (I think thats trace8)\n\n[Thu Nov 06 09:44:54.159442 2014] [ssl:debug] [pid 23265] ssl_engine_kernel.c(236): [client 10.249.66.28:49770] AH02034: Subsequent (No.2) HTTPS request received for child 1 (server svn-it.got.company.net:443)\n[Thu Nov 06 09:44:54.159483 2014] [authz_core:debug] [pid 23265] mod_authz_core.c(799): [client 10.249.66.28:49770] AH01626: authorization result of Require valid-user : denied (no authenticated user yet)\n[Thu Nov 06 09:44:54.159488 2014] [authz_core:debug] [pid 23265] mod_authz_core.c(799): [client 10.249.66.28:49770] AH01626: authorization result of <RequireAny>: denied (no authenticated user yet)\n[Thu Nov 06 09:44:54.159560 2014] [authnz_ldap:debug] [pid 23265] mod_authnz_ldap.c(515): [client 10.249.66.28:49770] AH01691: auth_ldap authenticate: using URL ldaps://vds.company.biz:636/ou=Internal,ou=Users,o=XXX?uid?sub\n[Thu Nov 06 09:44:54.161569 2014] [authnz_ldap:info] [pid 23265] [client 10.249.66.28:49770] AH01695: auth_ldap authenticate: user userX authentication failed; URI /svn/some-path/pom.xml [User not found][No such object]\n[Thu Nov 06 09:44:54.161580 2014] [auth_basic:error] [pid 23265] [client 10.249.66.28:49770] AH01618: user userX not found: /svn/EIE/!svn/rvr/452/some-path/pom.xml"}, {"count": 3, "tags": [], "bug_id": 57203, "attachment_id": null, "is_private": false, "id": 179066, "time": "2014-11-12T13:47:03Z", "creator": "covener@gmail.com", "creation_time": "2014-11-12T13:47:03Z", "text": "That could actually be a match.  You could probably test this using e.g. ldapsearch.  The issue would be that your actual users (userX) can't perform the DN search themselves (and get that same \"object not found\") but the webserver LDAPBindDN can."}, {"count": 4, "tags": [], "text": "Hi again Eric.\n\nI always validate with ldapsearch before configuring the tool (the server must accept ldap cert and connect thru firewall)\n\nDo the search with 'ldapmanger-user' in ldap for looking up 'myuser'\n-- This always works, no surprise --\nldapsearch -xLLLH ldaps://vds.company.biz:636 -D \"cn=ldapmanger-user,ou=Internal,ou=Users,o=company\" -w '*****' -b \"ou=Internal,ou=Users,o=Company\" \"(&(objectClass=inetOrgPerson)(cn=myuser))\"\n\nDo the search with 'myuser' in ldap for looking up 'myuser'\n-- This return nothing --\nldapsearch -xLLLH ldaps://vds.company.biz:636 -D \"cn=myuser,ou=Internal,ou=Users,o=company\" -w '*****' -b \"ou=Internal,ou=Users,o=Company\" \"(&(objectClass=inetOrgPerson)(cn=myuser))\"\n\nDo the search with 'unkownuser' in ldap for looking up 'myuser'\n-- This return 'ldap_bind: Invalid credentials (49)' , no surprise --\nldapsearch -xLLLH ldaps://vds.company.biz:636 -D \"cn=unkownuser,ou=Internal,ou=Users,o=company\" -w '*****' -b \"ou=Internal,ou=Users,o=Company\" \"(&(objectClass=inetOrgPerson)(cn=myuser))\"\n\nBR Jorgen", "attachment_id": null, "id": 179069, "creator": "jorgen.sandstrom@gmail.com", "time": "2014-11-12T16:05:48Z", "bug_id": 57203, "creation_time": "2014-11-12T16:05:48Z", "is_private": false}, {"count": 5, "text": "okay, based on that then I think you are affected by that bug in 2.4.10 fixed in 2.4.11. Unfortunately you'll need a new mod_ldap (util_ldap.c) to verify.", "bug_id": 57203, "attachment_id": null, "id": 179071, "time": "2014-11-12T16:38:40Z", "creator": "covener@gmail.com", "creation_time": "2014-11-12T16:38:40Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 57203, "attachment_id": null, "is_private": false, "id": 179072, "time": "2014-11-12T16:43:51Z", "creator": "jorgen.sandstrom@gmail.com", "creation_time": "2014-11-12T16:43:51Z", "text": "Thank you so much for your time Eric.\n\nNext upgrade from CollabNet Subversion Edge will problaby be shipped with 2.4.11.\n\nUntil then, what do you recommend\nLDAPConnectionPoolTTL 60\nor\nLDAPConnectionPoolTTL 0 (never try to reuse a ldap connection)\n\nBR Jorgen"}, {"count": 7, "tags": [], "text": "I think 60 is reasonable", "is_private": false, "id": 179073, "creator": "covener@gmail.com", "time": "2014-11-12T16:59:28Z", "bug_id": 57203, "creation_time": "2014-11-12T16:59:28Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "tcastelle@generali.fr", "text": "Hello,\n\nThis bug is very related to the bug 16492 \"mod_proxy doesn't correctly retrieve\nvalues from Cache-Control Headers\", please look at it also.\n\nWhile trying to compare Apache 2.0's mod_cache and Apache 1.3's mod_proxy, I saw\na bug in the manner Apache handles Cache-Control directives. In the\nproxy_cache.c file, near the line 1225, the following test :\n\n/* handle expiration */\n         ((-1 < smaxage && age < (smaxage - minfresh)) ||\n          (-1 < maxage && age < (maxage + maxstale - minfresh)) ||\n          (c->expire != BAD_DATE && age < (c->expire - c->date + maxstale -\nminfresh)))\n         ) {\n\nis useless because it is always true, no matter if max-age is set or not. \nLet's take an example (I suppose here s-maxage, max-stale and min-fresh not set,\nso smaxage = - 1, maxstale = 0 and minfresh = 0) :\n- with age = 20, maxage = -1 (not set) and expire - date = 30, the second test\nis FALSE. The third is TRUE. So the whole test is TRUE, the page is considered\nto be fresh => no problem.\n- with age = 20, maxage = 10 and expire - date = 30, the second test is FALSE,\nbut the third is still TRUE. So the whole test is TRUE, the page is considered\nto be fresh => problem !!\n\nI propose to change this like that :\n\n      /* handle expiration */\n         (-1 == smaxage || age < (smaxage - minfresh)) &&\n         (-1 == maxage || age < (maxage + maxstale - minfresh)) &&\n         (c->expire != BAD_DATE && age < (c->expire - c->date + maxstale -\nminfresh))\n         ) {\n\nWhat do you think ?\n\nSame kind problem exists with the test on line 1239...\n\nI attach the patch I wrote to correct this.\n\nThanks for looking at it and tell me if it is correct or not !\n\nThomas.", "id": 30168, "time": "2003-01-28T14:46:07Z", "bug_id": 16493, "creation_time": "2003-01-28T14:46:07Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 16493, "attachment_id": 4586, "text": "Created attachment 4586\nPatch to take in consideration max-age, max-stale and other Cache-Control directives", "id": 30170, "time": "2003-01-28T14:46:49Z", "creator": "tcastelle@generali.fr", "creation_time": "2003-01-28T14:46:49Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 16493, "is_private": false, "id": 30432, "time": "2003-01-31T16:23:44Z", "creator": "tcastelle@generali.fr", "creation_time": "2003-01-31T16:23:44Z", "tags": [], "text": "Is someone looking at this bug ?\nPlease keep me informed !\n\nThomas."}, {"count": 3, "tags": [], "creator": "tcastelle@generali.fr", "attachment_id": null, "id": 30992, "time": "2003-02-10T10:06:55Z", "bug_id": 16493, "creation_time": "2003-02-10T10:06:55Z", "is_private": false, "text": "I'm very sad, nobody's looking at my bugs ! I'm going to cry very loud...\n\nHelp ! I need somebody's help ! ;-)\n\nThomas."}, {"count": 4, "tags": [], "creator": "coad@measurement-factory.com", "attachment_id": null, "id": 31272, "time": "2003-02-14T00:23:41Z", "bug_id": 16493, "creation_time": "2003-02-14T00:23:41Z", "is_private": false, "text": "FYI: This bug may be related to bug 15869 and bug 16136."}, {"count": 5, "tags": [], "text": "Yes, indeed, the same problem exists with Apache 2.0. But mod_cache is far from\nbeing finished (as I was told on the Apache dev list...), so I opened this bug\nonly for Apache 1.3.\n\nHas anyone looked at it so far ?\n\nThanks,\n\nThomas", "is_private": false, "id": 32393, "creation_time": "2003-03-04T08:48:33Z", "time": "2003-03-04T08:48:33Z", "creator": "tcastelle@generali.fr", "bug_id": 16493, "attachment_id": null}, {"count": 6, "tags": [], "creator": "trawick@apache.org", "text": "I'm going through the bug db to make sure patches are findable.  Please see \nhttp://httpd.apache.org/dev/patches.html\n", "id": 47831, "time": "2003-11-21T18:10:08Z", "bug_id": 16493, "creation_time": "2003-11-21T18:10:08Z", "is_private": false, "attachment_id": null}]
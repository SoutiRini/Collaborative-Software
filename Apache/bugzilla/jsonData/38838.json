[{"count": 0, "tags": [], "bug_id": 38838, "attachment_id": null, "is_private": false, "id": 86446, "time": "2006-03-03T12:52:44Z", "creator": "tiamat@komi.mts.ru", "creation_time": "2006-03-03T12:52:44Z", "text": "Hi,\n\nI'm build Apache 2.2.0 on Solaris 9.\nApache 64-bit permanent got a Signal 10, Bus error with mod_ssl:\n\n[Fri Mar 03 14:45:25 2006] [notice] child pid 14003 exit signal Bus error (10),\npossible coredump in /usr/local\n\ngdb say me:\nReading symbols from /usr/lib/sparcv9/nss_files.so.1...done.\nLoaded symbols for /usr/lib/64/nss_files.so.1\n#0  ssl_scache_shmcb_store (s=0x1001efc90, id=<value optimized out>,\nidlen=<value optimized out>,\n    timeout=1141386623, pSession=<value optimized out>) at ssl_scache_shmcb.c:241\n241             memset(ptr, 0, size);\n(gdb) bt\n#0  ssl_scache_shmcb_store (s=0x1001efc90, id=<value optimized out>,\nidlen=<value optimized out>,\n    timeout=1141386623, pSession=<value optimized out>) at ssl_scache_shmcb.c:241\n#1  0xffffffff7b1166b4 in ssl_callback_NewSessionCacheEntry (ssl=<value\noptimized out>,\n    session=0xffffffff7bf00008) at ssl_engine_kernel.c:1635\n#2  0xffffffff7af31480 in ssl_update_cache () from /usr/local/lib/libssl.so.3\n#3  0xffffffff7af1c10c in ssl3_accept () from /usr/local/lib/libssl.so.3\n#4  0xffffffff7af31b60 in SSL_accept () from /usr/local/lib/libssl.so.3\n#5  0xffffffff7af24ce8 in ssl23_get_client_hello () from /usr/local/lib/libssl.so.3\n#6  0xffffffff7af2544c in ssl23_accept () from /usr/local/lib/libssl.so.3\n#7  0xffffffff7af31b84 in SSL_accept () from /usr/local/lib/libssl.so.3\n#8  0xffffffff7b112af8 in ssl_io_filter_connect (filter_ctx=0x1002534f8) at\nssl_engine_io.c:1047\n#9  0xffffffff7b113104 in ssl_io_filter_input (f=0x10025d478, bb=0x10025f968,\nmode=AP_MODE_GETLINE,\n    block=APR_BLOCK_READ, readbytes=4297403752) at ssl_engine_io.c:1292\n#10 0x000000010003c9bc in ap_get_brigade (next=0x10025d478, bb=0x10025f968,\nmode=AP_MODE_GETLINE,\n    block=APR_BLOCK_READ, readbytes=0) at util_filter.c:489\n#11 0x000000010002471c in ap_rgetline_core (s=0x10025e4d8, n=8192,\nread=0xffffffff7ffff2e0, r=0x10025e4a8,\n    fold=0, bb=0x10025f968) at protocol.c:222\n#12 0x0000000100025424 in ap_read_request (conn=0x100252d68) at protocol.c:587\n#13 0x000000010003cf98 in ap_process_http_connection (c=0x100252d68) at\nhttp_core.c:164\n#14 0x0000000100039180 in ap_run_process_connection (c=0x100252d68) at\nconnection.c:43\n#15 0x0000000100044060 in child_main (child_num_arg=<value optimized out>) at\nprefork.c:640\n#16 0x0000000100044374 in make_child (s=0x100172e38, slot=0) at prefork.c:736\n#17 0x000000010004447c in startup_children (number_to_start=4) at prefork.c:757\n#18 0x0000000100045120 in ap_mpm_run (_pconf=0x10016daf8, plog=<value optimized\nout>, s=<value optimized out>)\n    at prefork.c:975\n#19 0x000000010001d7e0 in main (argc=1, argv=0xffffffff7ffffb18) at main.c:712\n\n# /usr/local/sbin/apachectl -v\nServer version: Apache/2.2.0\nServer built:   Mar  3 2006 14:17:26\n# /usr/local/sbin/apachectl -V\nServer version: Apache/2.2.0\nServer built:   Mar  3 2006 14:17:26\nServer's Module Magic Number: 20051115:0\nArchitecture:   64-bit\nServer MPM:     Prefork\n  threaded:     no\n    forked:     yes (variable process count)\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/prefork\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_USE_FCNTL_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=128\n -D HTTPD_ROOT=\"/usr/local\"\n -D SUEXEC_BIN=\"/usr/local/bin/suexec\"\n -D DEFAULT_PIDLOG=\"/var/run/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_LOCKFILE=\"/var/run/accept.lock\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"etc/apache/mime.types\"\n -D SERVER_CONFIG_FILE=\"etc/apache/httpd.conf\"\n\nApache build with openssl 0.9.8a:\n\n# ldd /usr/local/sbin/httpd\n        libm.so.1 =>     /usr/lib/64/libm.so.1\n        libpcre.so.0 =>  /usr/local/lib/libpcre.so.0\n        libaprutil.so.0 =>       /usr/local/lib/libaprutil.so.0\n        libldap.so.5 =>  /usr/lib/64/libldap.so.5\n        libdb.so.4 =>    /usr/local/lib/libdb.so.4\n        libexpat.so.1 =>         /usr/local/lib/libexpat.so.1\n        libiconv.so.2 =>         /usr/local/lib/libiconv.so.2\n        libapr.so.0 =>   /usr/local/lib/libapr.so.0\n        libresolv.so.2 =>        /usr/lib/64/libresolv.so.2\n        libuuid.so.1 =>  /usr/lib/64/libuuid.so.1\n        libsendfile.so.1 =>      /usr/lib/64/libsendfile.so.1\n        librt.so.1 =>    /usr/lib/64/librt.so.1\n        libsocket.so.1 =>        /usr/lib/64/libsocket.so.1\n        libnsl.so.1 =>   /usr/lib/64/libnsl.so.1\n        libpthread.so.1 =>       /usr/lib/64/libpthread.so.1\n        libdl.so.1 =>    /usr/lib/64/libdl.so.1\n        libc.so.1 =>     /usr/lib/64/libc.so.1\n        libmd5.so.1 =>   /usr/lib/64/libmd5.so.1\n        libaio.so.1 =>   /usr/lib/64/libaio.so.1\n        libmp.so.2 =>    /usr/lib/64/libmp.so.2\n        libthread.so.1 =>        /usr/lib/64/libthread.so.1\n        /usr/platform/SUNW,Sun-Fire-V210/lib/sparcv9/libc_psr.so.1\n        /usr/platform/SUNW,Sun-Fire-V210/lib/sparcv9/libmd5_psr.so.1\n\nmy httpd.conf:\n\nServerRoot \"/usr/local\"\nListen 80\n\nLoadModule authz_host_module lib/apache/mod_authz_host.so\n#LoadModule include_module lib/apache/mod_include.so\nLoadModule log_config_module lib/apache/mod_log_config.so\nLoadModule logio_module lib/apache/mod_logio.so\nLoadModule env_module lib/apache/mod_env.so\nLoadModule setenvif_module lib/apache/mod_setenvif.so\nLoadModule ssl_module lib/apache/mod_ssl.so\nLoadModule mime_module lib/apache/mod_mime.so\nLoadModule dir_module lib/apache/mod_dir.so\n#LoadModule alias_module lib/apache/mod_alias.so\n\nUser apache\nGroup apache\nServerAdmin root@komi.mts.ru\nDocumentRoot \"/var/apache/data\"\n\n<Directory />\n        Options FollowSymLinks\n        AllowOverride None\n        Order deny,allow\n        Deny from all\n</Directory>\n\n<Directory \"/var/apache/data\">\n        Options Indexes FollowSymLinks\n        AllowOverride None\n        Order allow,deny\n        Allow from all\n</Directory>\n\n<IfModule dir_module>\n        DirectoryIndex index.html\n</IfModule>\n\n<FilesMatch \"^\\.ht\">\n        Order allow,deny\n        Deny from all\n</FilesMatch>\n\nErrorLog /var/log/apache/error.log\nLogLevel warn\n\n<IfModule log_config_module>\n        LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\"\ncombined\n        LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b\" common\n   <IfModule logio_module>\n        LogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\n%I %O\" combinedio\n   </IfModule>\n        CustomLog /var/log/apache/access.log common\n</IfModule>\n\nDefaultType text/plain\n\n<IfModule mime_module>\n        TypesConfig etc/apache/mime.types\n        AddType application/x-compress .Z\n        AddType application/x-gzip .gz .tgz\n</IfModule>\n\n<IfModule ssl_module>\n        SSLRandomSeed startup builtin\n        SSLRandomSeed connect builtin\n        Include etc/apache/ssl.conf\n</IfModule>\n\nServerTokens Prod\n\nmy ssl.conf:\n\nListen 443\nAddType application/x-x509-ca-cert .crt\nAddType application/x-pkcs7-crl    .crl\nSSLPassPhraseDialog  builtin\nSSLSessionCache        shmcb:/var/run/ssl_scache(512000)\nSSLSessionCacheTimeout  300\nSSLMutex  file:/var/run/ssl_mutex\n\n<VirtualHost _default_:443>\n\nDocumentRoot \"/var/apache/data\"\nServerName www.example.com:443\nServerAdmin you@example.com\nErrorLog /var/log/apache/error.log\nTransferLog /var/log/apache/access.log\nSSLEngine on\nSSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL\nSSLCertificateFile /usr/local/etc/ssl/server.crt\nSSLCertificateKeyFile /usr/local/etc/ssl/server.key\nSSLCACertificateFile /usr/local/etc/ssl/ca.crt\n\n<FilesMatch \"\\.(cgi|shtml|phtml|php)$\">\n    SSLOptions +StdEnvVars\n</FilesMatch>\n<Directory \"/var/apache/cgi-bin\">\n    SSLOptions +StdEnvVars\n</Directory>\n\nBrowserMatch \".*MSIE.*\" \\\n         nokeepalive ssl-unclean-shutdown \\\n         downgrade-1.0 force-response-1.0\n\nCustomLog /var/log/apache/ssl.log \\\n          \"%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \\\"%r\\\" %b\"\n\n</VirtualHost>\n\nOther programms, which build with openssl works fine for me: samba, sendmail,\ncyrus-imap, cups, etc...\n\nThanks!"}, {"count": 1, "tags": [], "text": "Created attachment 17823\nshmcb inline-beats-alignment-workaround fix\n\nGosh, haven't had to fix one of these for ages.  Are you using gcc?  If so,\nwhat version?\n\nCan you try the attached patch?", "is_private": false, "bug_id": 38838, "id": 86447, "time": "2006-03-03T13:04:58Z", "creator": "jorton@redhat.com", "creation_time": "2006-03-03T13:04:58Z", "attachment_id": 17823}, {"text": "# /usr/local/bin/gcc -v\nUsing built-in specs.\nTarget: sparc64-sun-solaris2.9\nConfigured with: ../configure --prefix=/usr/local --libexecdir=/usr/local/lib\n--enable-threads=solaris --enable-languages=c,c++ --enable-shared=libstdc++\n--disable-multilib --disable-nls --disable-libstdcxx-pch sparc64-sun-solaris2.9\nThread model: solaris\ngcc version 4.0.2\n", "tags": [], "creator": "tiamat@komi.mts.ru", "attachment_id": null, "count": 2, "id": 86448, "time": "2006-03-03T13:18:44Z", "bug_id": 38838, "creation_time": "2006-03-03T13:18:44Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 38838, "is_private": false, "id": 86449, "attachment_id": null, "creator": "tiamat@komi.mts.ru", "creation_time": "2006-03-03T13:45:43Z", "time": "2006-03-03T13:45:43Z", "text": "> Can you try the attached patch?\n\nPatch work fine for me. Thanks for a fast reply!\n\nThanks a lot!"}, {"count": 4, "tags": [], "bug_id": 38838, "attachment_id": null, "is_private": false, "id": 87396, "time": "2006-03-29T16:09:26Z", "creator": "jorton@redhat.com", "creation_time": "2006-03-29T16:09:26Z", "text": "Fixed on trunk and proposed for inclusion in 2.2.x: thanks for the report.\n\nhttp://svn.apache.org/viewcvs?rev=382799&view=rev"}]
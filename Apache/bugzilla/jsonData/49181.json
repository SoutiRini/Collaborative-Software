[{"count": 0, "tags": [], "bug_id": 49181, "attachment_id": null, "is_private": false, "id": 136387, "time": "2010-04-24T19:14:59Z", "creator": "bugzilla@pidster.com", "creation_time": "2010-04-24T19:14:59Z", "text": "ApplicationContext.addListener(instance) always throws an exception if the listener is a ServletContextListener or an HttpSessionListener because successful instanceof checks don't finish with a return."}, {"count": 1, "tags": [], "text": "Created attachment 25345\nAdds return on successful instanceof test", "is_private": false, "bug_id": 49181, "id": 136388, "time": "2010-04-24T19:15:53Z", "creator": "bugzilla@pidster.com", "creation_time": "2010-04-24T19:15:53Z", "attachment_id": 25345}, {"count": 2, "tags": [], "bug_id": 49181, "is_private": false, "id": 136390, "attachment_id": 25346, "creator": "bugzilla@pidster.com", "creation_time": "2010-04-24T19:20:10Z", "time": "2010-04-24T19:20:10Z", "text": "Created attachment 25346\nAlternative patch, in case the listener implements multiple interfaces"}, {"count": 3, "tags": [], "bug_id": 49181, "attachment_id": null, "text": "Thanks for the patch. I applied the second one to 7.0.x and it will be included in 7.0.x onwards.", "id": 136391, "time": "2010-04-24T19:27:10Z", "creator": "markt@apache.org", "creation_time": "2010-04-24T19:27:10Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 49181, "attachment_id": null, "is_private": false, "id": 136412, "time": "2010-04-26T07:24:58Z", "creator": "bugzilla@pidster.com", "creation_time": "2010-04-26T07:24:58Z", "text": "(In reply to comment #3)\n> Thanks for the patch. I applied the second one to 7.0.x and it will be included\n> in 7.0.x onwards.\n\nThis was bugging me.  I've spotted a possible error in the patch.\n\nSrv3.0 4.4.3 says \"If the ServletContext was passed to the ServletContainerInitializer\u2019s onStartup method, then the given listener MAY also implement javax.servlet.ServletContextListener in addition to...\" in each subclause, implying that a class that only implements ServletContextListener should not be dynamically added.\n\nSeems crazy, but it is easy enough to fix, patch attached.\n\nI'm now reading these clauses to also mean that anything else with access to the ServletContext shouldn't be able to dynamically add classes, (e.g. in a Servlet.config(config), or another ServletContextListener), which could be a resolved by wrapping the supplied ServletContext in an object which just throws UnsupportedOperationException's for each of the relevant methods, and delegates the rest.\n\nI aim to supply a patch for this shortly."}, {"count": 5, "tags": [], "text": "Created attachment 25353\nMore spec compliant way to handle dynamically added listeners", "attachment_id": 25353, "bug_id": 49181, "id": 136413, "time": "2010-04-26T07:26:04Z", "creator": "bugzilla@pidster.com", "creation_time": "2010-04-26T07:26:04Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 49181, "attachment_id": null, "is_private": false, "id": 136505, "time": "2010-04-28T19:15:49Z", "creator": "markt@apache.org", "creation_time": "2010-04-28T19:15:49Z", "text": "The wording is ambiguous to me. My instinct is to lean towards the current implementation as the correct interpretation but I'll wait for Filip or Remy who are on the EG to comment on what the intended behavior is.\n\nIf I get a chance (I'm rather snowed under at the moment) I'll try running the TCK with this patch to see if it passes or fails."}, {"count": 7, "tags": [], "bug_id": 49181, "attachment_id": null, "is_private": false, "id": 136506, "time": "2010-04-28T20:06:10Z", "creator": "markt@apache.org", "creation_time": "2010-04-28T20:06:10Z", "text": "As I catch up on e-mail, I think Konstantin has ID'd the correct interpretation here.\n\nTo quote Konstantin:\na) Before we start calling ServletContextListener.contextInitialized()\nany listeners allowed in addListener() can be added.\n\nb) Once we started calling\nServletContextListener.contextInitialized(), a new\nServletContextListener cannot be added anymore.\n\nc) Once contextInitialized() calls are done, no more listeners,\nservlets, filters can be added programmatically.\n\na) and c) are currently enforced. b) isn't."}, {"count": 8, "tags": [], "text": "I've added an additional check to trunk to implement b)", "attachment_id": null, "id": 136800, "creator": "markt@apache.org", "time": "2010-05-12T06:24:23Z", "bug_id": 49181, "creation_time": "2010-05-12T06:24:23Z", "is_private": false}]
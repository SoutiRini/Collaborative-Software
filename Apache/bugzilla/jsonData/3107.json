[{"attachment_id": null, "tags": [], "bug_id": 3107, "text": "I'm getting a \"duplicate class definition\" exception the *first* time I access \na frameset where each frame uses the same tag library. On reloading, everything \nworks fine. Is this some sort of threading issue, with the request for the \nsecond frame page coming in before Jasper has initialized properly? It appears \nto be identical to Struts bug #2466.\n\nThe stack trace I'm seeing is always something like this:\n\nException Report:\njavax.servlet.ServletException: duplicate class definition: wrox/HelloTag\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:466)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:1264)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:243)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:215)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2314)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:164)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.valves.AccessLogValve.invoke\n(AccessLogValve.java:462)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:163)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.connector.http.HttpProcessor.process\n(HttpProcessor.java:1000)\n\tat org.apache.catalina.connector.http.HttpProcessor.run\n(HttpProcessor.java:1093)\n\tat java.lang.Thread.run(Thread.java:484)\n\nRoot Cause:\njava.lang.LinkageError: duplicate class definition: wrox/HelloTag\n\tat java.lang.ClassLoader.defineClass0(Native Method)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:486)\n\tat java.security.SecureClassLoader.defineClass\n(SecureClassLoader.java:111)\n\tat org.apache.catalina.loader.WebappClassLoader.findClassInternal\n(WebappClassLoader.java:1484)\n\tat org.apache.catalina.loader.WebappClassLoader.findClass\n(WebappClassLoader.java:851)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1230)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1113)\n\tat org.apache.jasper.servlet.JasperLoader.loadClass\n(JasperLoader.java:198)\n\tat org.apache.jasper.servlet.JasperLoader.loadClass\n(JasperLoader.java:132)\n\tat java.lang.ClassLoader.loadClassInternal(ClassLoader.java:313)\n\tat java.lang.Class.newInstance0(Native Method)\n\tat java.lang.Class.newInstance(Class.java:237)\n\tat org.apache.jasper.servlet.JspServlet$JspServletWrapper.load\n(JspServlet.java:138)\n\tat \norg.apache.jasper.servlet.JspServlet$JspServletWrapper.loadIfNecessary\n(JspServlet.java:178)\n\tat org.apache.jasper.servlet.JspServlet$JspServletWrapper.service\n(JspServlet.java:188)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:381)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:458)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:1264)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:243)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:215)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2314)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:164)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.valves.AccessLogValve.invoke\n(AccessLogValve.java:462)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:163)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.connector.http.HttpProcessor.process\n(HttpProcessor.java:1000)\n\tat org.apache.catalina.connector.http.HttpProcessor.run\n(HttpProcessor.java:1093)\n\tat java.lang.Thread.run(Thread.java:484)\n\nHowever, just which class it complains about varies each time, and it only \noccurs on the first access to the frameset after the web app has been started, \nor after class reloading.", "count": 0, "id": 4524, "time": "2001-08-13T03:49:46Z", "creator": "richardh@wrox.com", "creation_time": "2001-08-13T03:49:46Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 409\nSmall .war file illustrating the issue", "is_private": false, "id": 4525, "creator": "richardh@wrox.com", "time": "2001-08-13T03:50:45Z", "bug_id": 3107, "creation_time": "2001-08-13T03:50:45Z", "attachment_id": 409}, {"count": 2, "tags": [], "bug_id": 3107, "text": "I was able to duplicate this (thanks for the test case!).  Looks like we've got\nan unhandled race condition at startup time when more than one JSP page is being\ncompiled simultaneously.\n", "id": 4566, "time": "2001-08-14T12:50:32Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-08-14T12:50:32Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 3107, "attachment_id": null, "id": 4967, "time": "2001-08-28T11:14:22Z", "creator": "remm@apache.org", "creation_time": "2001-08-28T11:14:22Z", "is_private": false, "text": "The call to defineClass is now synced. It appears to be fixing the problem."}]
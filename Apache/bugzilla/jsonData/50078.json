[{"count": 0, "tags": [], "creator": "takayoshi@gmail.com", "attachment_id": 26163, "text": "Created attachment 26163\nProposed patch for tc6 trunk\n\nThere is a WeakHashMap instance that is accessed concurrently and sometimes causes infinite loop. It's extremely hard to reproduce but you can refer to similar concurrent access looping problem by the following search keywords:\n\n* weakhashmap infinite loop 100% cpu stuck synchronized concurrent\n* java.util.WeakHashMap.put(WeakHashMap.java:405)\n* java.util.WeakHashMap.get(WeakHashMap.java:355)\n\nThe org.apache.el.util.ConcurrentCache and javax.el.BeanELResolver.ConcurrentCache classes have this problem.\n\nThere are 20 threads get stuck at the following thread stack:\n\n\"ajp-146.215.106.42-8009-38\" daemon prio=10 tid=0x00002aab6425d800 nid=0x135b runnable [0x0000000048c14000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.util.WeakHashMap.get(WeakHashMap.java:355)\n\tat org.apache.el.util.ConcurrentCache.get(ConcurrentCache.java:24)\n\tat org.apache.el.lang.ExpressionBuilder.createNodeInternal(ExpressionBuilder.java:90)\n\n\"ajp-146.215.106.42-8009-18\" daemon prio=10 tid=0x00002aab643ea000 nid=0x538d runnable [0x00000000458fd000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.util.WeakHashMap.put(WeakHashMap.java:405)\n\tat java.util.WeakHashMap.putAll(WeakHashMap.java:518)\n\tat org.apache.el.util.ConcurrentCache.put(ConcurrentCache.java:34)", "id": 140688, "time": "2010-10-12T01:10:00Z", "bug_id": 50078, "creation_time": "2010-10-12T01:10:00Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 50078, "attachment_id": null, "is_private": false, "id": 140700, "time": "2010-10-12T11:46:18Z", "creator": "remm@apache.org", "creation_time": "2010-10-12T11:46:18Z", "text": "Ooops, this needs to be fixed ASAP.\n\nThe map sizes need to be made configurable I think (with the sync, 5000 might be too low for big setups and would result in a lot of syncs)."}, {"count": 2, "tags": [], "bug_id": 50078, "text": "Thanks for the patch. I have fixed in this in trunk and that fix will be in 7.0.4 onwards. I added the ability to control the cache sizes.\nThe patches have also been proposed for 6.0.x.", "id": 140755, "attachment_id": null, "creator": "markt@apache.org", "creation_time": "2010-10-14T13:40:24Z", "time": "2010-10-14T13:40:24Z", "is_private": false}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "This has been fixed in 6.0.x and will be included in 6.0.30 onwards.", "id": 141007, "time": "2010-10-25T12:38:14Z", "bug_id": 50078, "creation_time": "2010-10-25T12:38:14Z", "is_private": false, "attachment_id": null}]
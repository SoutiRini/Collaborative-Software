[{"count": 0, "tags": [], "bug_id": 48088, "text": "When a Servlet implements javax.servlet.SingleThreadModel the method init is called twice. This should not happen according to the Servlet specification.\n\nhttp://developer.java.sun.com/developer/onlineTraining/Servlets/Fundamentals/servlets.html#lifeCycle\n\nI first saw the bug when someone tried when someone submitted a bug in my open source web services framework \"xins\"\nhttp://sourceforge.net/tracker/?func=detail&aid=2884574&group_id=71598&atid=531814 (bug submitted from Linux with Tomcat 5.5.25)\n\nHere the petstore demo is initialized at the start-up of Tomcat and with the first request http://localhost:8080/petstore/. This apparently happens on the same Servlet object.\nI've attached the war file that contains removed code so that the Servlet initializes correctly the first time without looking for a database.\nSource code and Demo available at http://xins.sourceforge.net/\n\nI've tried to reproduce it (See code below) and had a slightly different behaviour:\nThe init method is called twice but at the first request and it seems to be done on 2 different objects as the exception is not thrown. The destroy method is also called twice at the end.\n\npublic class SimpleServlet extends HttpServlet implements javax.servlet.SingleThreadModel {\n\n    private boolean initialized = false;\n    private int initCount = 0;\n\n    public void init(ServletConfig config)\n        throws IllegalArgumentException, ServletException {\n        if (initialized) {\n            throw new ServletException(\"Servlet already initialized. Should not happen according to the specs.\");\n        }\n        initialized = true;\n        System.err.println(\"------------ Initialized -\");\n        initCount++;\n    }\n\n\n    public void doGet(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws ServletException, IOException {\n\n        PrintWriter out = response.getWriter();\n        out.println(\"SimpleServlet Executed \" + initCount);\n        out.flush();\n        out.close();\n    }\n\n    public void destroy() {\n        initialized = false;\n        System.err.println(\"------------ destroy\");\n    }\n}", "id": 131508, "time": "2009-10-30T03:28:03Z", "creator": "anthony.goubard@wanadoo.nl", "creation_time": "2009-10-30T03:28:03Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 48088, "text": "When a servlet implements javax.servlet.SingleThreadModel multiple instances of the Servlet will be created to provide a pool of Servlet objects. This looks like what you are seeing.\n\nIf this does not explain what you are seeing, please re-open and attach a test case that demonstrates the problem.", "id": 131776, "time": "2009-11-06T13:39:44Z", "creator": "markt@apache.org", "creation_time": "2009-11-06T13:39:44Z", "is_private": false, "attachment_id": null}]
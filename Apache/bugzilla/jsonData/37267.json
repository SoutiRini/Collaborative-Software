[{"count": 0, "tags": [], "creator": "hughesj@apache.org", "text": "Overview Description:\nThe serialVersionUID for the original QName as used by JAX-RPC 1.0 was\n-9120448754896609940. The suid for the JAXP 1.3 version is 4418622981026545151.\nThis means instances of the old class cannot be serialized into the new class. \n\nSteps to Reproduce:\n\nUse a J2SE 1.4 JVM (don't use J2SE 5 as this includes QName class in rt.jar -\nwe're testing the QName in XmlCommons xml-apis.jar)\n\nTest case at:\nhttp://people.apache.org/~hughesj/bugs/QName/QNameReadObjectNull.zip\ncd into QNameReadObjectNull/bin directory.\njava -cp .;<path to xml-apis.jar shipped in xerces2_7_1>;<path to junit.jar>\njavax.xml.namespace.QNameTest\n\nresults in:\n\n.E\nTime: 0.2\nThere was 1 error:\n1)\ntestGoodDeserializeQNameWithoutPrefix(javax.xml.namespace.QNameTest)java.io.InvalidClassException:\njavax.xml.namespace.QName; local class incompatible: stream classdesc\nserialVersionUID = -9120448754896609940, local class serialVersionUID =\n4418622981026545151\n\n...\n\n\nExpected Results: Test should pass\n\nNote this test case is a subset of a test case in Apache Woden:\n\nhttp://svn.apache.org/repos/asf/incubator/woden/java/test/javax/xml/namespace/\n\nThanks,\nJeremy Hughes (hughesj at apache.org)", "id": 81816, "time": "2005-10-27T14:52:59Z", "bug_id": 37267, "creation_time": "2005-10-27T14:52:59Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 37267, "attachment_id": null, "text": "Can this really be changed now? I did some investigating and here's what I've found.\n\nThe QName in JAX-RPC 1.0 [1] didn't have an explicitly declared\nserialVersionUID, nor did it have the prefix property. I'm guessing the value\nposted in the original comment is the runtime calculated value. The QName that's\nbeing packaged by Sun as part of the Java Web Services Developer Pack v1.6 [2]\nhas the serialVersionUID of 4418622981026545151. The QName that's being packaged\nby Sun in the J2EE 1.4 SDK with the Sun Java Application Server [3] doesn't\nexplicitly declare a serialVersionUID, but does have a prefix property. This\nshould then change the generated ID, correct? The QName that's being packaged\nwith Geronimo [4] is similar to this one; no ID, but has a prefix field. The\nQName that's being packaged in Sun's Java SE 5 SDK [5] and BEA's Java SE 5 SDK\n[6] have the serialVersionUID of 4418622981026545151. I would assume other Java\nSE 5 SDK distributions have the same values.\n\nI understand there's a need for passivity here, but I this point I'd say the cat\nis out of the bag and the ID of 4418622981026545151 has become the defacto\n\"correct\" version, especially since it's part of the Java SE 5 Javadoc [5].\n\n\n[1] http://java.sun.com/xml/downloads/javaxmlpack.html\n[2] http://java.sun.com/webservices/downloads/webservicespack.html\n[3] http://java.sun.com/j2ee/1.4/download.html\n[4]\nhttp://svn.apache.org/viewcvs.cgi/geronimo/specs/trunk/geronimo-spec-qname/src/java/javax/xml/namespace/QName.java?view=markup\n[5]\nhttp://java.sun.com/j2se/1.5.0/docs/api/serialized-form.html#javax.xml.namespace.QName\n[6] http://edocs.bea.com/wljrockit/docs50/index.html\n\nBesides the Java SE 5 Javadoc, I got the rest of the information by looking at\nthe class files.", "id": 84506, "time": "2006-01-12T05:08:27Z", "creator": "ndbeyer@apache.org", "creation_time": "2006-01-12T05:08:27Z", "is_private": false}, {"count": 2, "tags": [], "text": "This is a real interoperability problem. Because the serialVersionUIDs do not \nmatch, currently QNames cannot be exchanged between J2SE 5.0 and J2EE 1.4. Sun \nhas acknolwedged the problem and has addressed it [1] (see evaluation at the \nbottom of the bug report) by restoring -9120448754896609940 as the \nserialVersionUID. I believe the same should be done in the Apache version, \npreferably sooner than later to minimize the impact on users. If this isn't \nchanged now I can see it becoming a bigger issue when Apache Harmony eventually \npicks up the XML APIs.\n\n[1] http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6355051", "attachment_id": null, "id": 84623, "creator": "mrglavas@ca.ibm.com", "time": "2006-01-13T23:02:47Z", "bug_id": 37267, "creation_time": "2006-01-13T23:02:47Z", "is_private": false}, {"count": 3, "tags": [], "creator": "ndbeyer@apache.org", "attachment_id": null, "text": "While looking through those bug evaluations, it looks like the the resolution\nwasn't just to replace the serialVersionUID with the original, but also to\nprovide a compatibility property that could be used to swap the ID. I found this\nnote about it [1] in Sun's JAXP 1.3.1 revision notes. Apparently a similar\nsolution was used for some JMX classes. Should the same compatibility property\nbe provided in xml-commons as well? Should there be a property, but of a\ndifferent name?\n\nIn any case, it seems that the default value is now the original value of\n\"-9120448754896609940\".\n\n[1] http://java.sun.com/webservices/docs/2.0/jaxp/ReleaseNotes.html#migrationFrom13", "id": 84629, "time": "2006-01-14T20:13:33Z", "bug_id": 37267, "creation_time": "2006-01-14T20:13:33Z", "is_private": false}, {"count": 4, "attachment_id": 17422, "bug_id": 37267, "text": "Created attachment 17422\nPatch for javax.xml.namespace.QName\n\nA proposal patch for fixing the QName serialVersionUID. This patch returns the\ndefault suid to what was packaged with J2EE 1.4 and provides a means of setting\na System Property to switch the suid to a compatibility value to work with the\nQName packaged in Java 5 SE.\n\nThe System Property is based on the Sun JAXP 1.3.1 RI release notes [1]. The\nproperty name may need to change, but the current key name allows for\ncompatibility with Sun Java Web Services toolkit.\n\nAnother item that may need to be added is looking up the property value via a\nprivileged action, but I'm not completely familiar with the security model, if\nany, here.\n\n[1]\nhttp://java.sun.com/webservices/docs/2.0/jaxp/ReleaseNotes.html#migrationFrom13", "id": 84630, "time": "2006-01-14T22:43:29Z", "creator": "ndbeyer@apache.org", "creation_time": "2006-01-14T22:43:29Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 37267, "attachment_id": null, "text": "Hi Nathan, from the Sun release notes for jaxp [1] I wasn't entirely clear which\nserialVersionUID was the compatible one and which was the default! In your patch\nyou have the original (-9120448754896609940L suid) as the default which is great\n- this is what I want, however I'm just wondering whether this is what Sun\nmeant. Have you by any chance tried Sun's jaxp 1.3.1 RI to see if their code\ndoes the same?\n\nThanks,\nJeremy\n[1] http://java.sun.com/webservices/docs/2.0/jaxp/ReleaseNotes.html#migrationFrom13", "id": 84775, "time": "2006-01-19T16:14:47Z", "creator": "hughesj@apache.org", "creation_time": "2006-01-19T16:14:47Z", "is_private": false}, {"count": 6, "tags": [], "creator": "ndbeyer@apache.org", "attachment_id": null, "text": "I determined which was the default and compatibility ID by downloading the JWSDP\n2.0 and loading the jaxp-api.jar into Eclipse and looked at the class in the\nbinary Class File Editor (viewer) and it showed the following static fields.\n\nprivate static final long defaultSerialVersionUID = -9120448754896609940L;\n\nprivate static final long compatibleSerialVersionUID = 4418622981026545151L;\n\nFrom this I assume the \"default*\" was the default setting. I can try to\nserialize an object from Sun's impl to a file and then try to deserialize it\nwith the commons version. This is probably about the best we can do for a unit test.", "id": 84795, "time": "2006-01-20T03:18:35Z", "bug_id": 37267, "creation_time": "2006-01-20T03:18:35Z", "is_private": false}, {"count": 7, "text": "Hi Nathan,\n\nSince this is the Apache implementation of QName (and also considering that \nApache Harmony probably won't contain com.sun.* classes), my preference for the \nproperty name would be \norg.apache.xml.namespace.QName.useCompatibleSerialVersionUID.\n\nRegarding looking up system properties and Java's security model, there's a \npackage private class called SecuritySupport which exists in all JAXP \nsubpackages which need to execute privileged actions. A copy could be added to \njavax.xml.namespace.", "bug_id": 37267, "attachment_id": null, "id": 84873, "time": "2006-01-23T05:53:49Z", "creator": "mrglavas@ca.ibm.com", "creation_time": "2006-01-23T05:53:49Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 37267, "text": "Created attachment 17544\nQName.java Patch (apache)\n\nReplacement patch.\n\nProvides security support for the system property lookup. Instead of copying\nthe entire SecuritySupport class, I just created an inline PrivilegedAction.\n\nThe System property is named\n\"org.apache.xml.namespace.QName.useCompatibleSerialVersionUID\".", "id": 85245, "time": "2006-01-31T04:00:59Z", "creator": "ndbeyer@apache.org", "creation_time": "2006-01-31T04:00:59Z", "is_private": false, "attachment_id": 17544}, {"count": 9, "tags": [], "bug_id": 37267, "text": "Created attachment 17545\nQName.java Patch (jaxp)\n\nThis is an alternate version of the previous patch. The only difference is that\nthis uses the QName's fully qualified class name as the System property prefix.\n\n\nThe System property is named\n\"javax.xml.namespace.QName.useCompatibleSerialVersionUID\".", "id": 85246, "time": "2006-01-31T04:02:42Z", "creator": "ndbeyer@apache.org", "creation_time": "2006-01-31T04:02:42Z", "is_private": false, "attachment_id": 17545}, {"count": 10, "text": "Thanks Nathan. I chose the \nthe \"org.apache.xml.namespace.QName.useCompatibleSerialVersionUID\" patch and \ncommitted to SVN (with some minor clean-up).", "bug_id": 37267, "attachment_id": null, "id": 86171, "time": "2006-02-23T23:39:03Z", "creator": "mrglavas@ca.ibm.com", "creation_time": "2006-02-23T23:39:03Z", "tags": [], "is_private": false}]
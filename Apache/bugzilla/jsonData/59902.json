[{"count": 0, "tags": [], "bug_id": 59902, "is_private": false, "text": "Created attachment 34072\nJMX to reproduce the issue\n\nThe recent upgrade to HttpClient 4.5.2 solved handshake failure issue by introducing support for HTTPS SNI certificates. Unfortunately, it breaks again when enabling HTTPS bandwidth limitation.\n\nSteps to reproduce:\n1. Edit bin/user.properties: add the following line:\nhttpclient.socket.https.cps=1280000\n2. Run the attached JMX,\n3. The Https request fails with the following stack:\n\njavax.net.ssl.SSLHandshakeException: Received fatal alert: handshake_failure\n\tat sun.security.ssl.Alerts.getSSLException(Alerts.java:192)\n\tat sun.security.ssl.Alerts.getSSLException(Alerts.java:154)\n\tat sun.security.ssl.SSLSocketImpl.recvAlert(SSLSocketImpl.java:2023)\n\tat sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1125)\n\tat sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1375)\n\tat sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1403)\n\tat sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1387)\n\tat org.apache.jmeter.util.SlowSSLSocket.startHandshake(SlowSSLSocket.java:160)\n\tat org.apache.http.conn.ssl.SSLSocketFactory.connectSocket(SSLSocketFactory.java:553)\n\tat org.apache.http.conn.ssl.SSLSocketFactory.connectSocket(SSLSocketFactory.java:412)\n\tat org.apache.jmeter.protocol.http.sampler.LazySchemeSocketFactory.connectSocket(LazySchemeSocketFactory.java:97)\n\tat org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:179)\n\tat org.apache.http.impl.conn.ManagedClientConnectionImpl.open(ManagedClientConnectionImpl.java:328)\n\tat org.apache.jmeter.protocol.http.sampler.MeasuringConnectionManager$MeasuredConnection.open(MeasuringConnectionManager.java:114)\n\tat org.apache.http.impl.client.DefaultRequestDirector.tryConnect(DefaultRequestDirector.java:612)\n\tat org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:447)\n\tat org.apache.http.impl.client.AbstractHttpClient.doExecute(AbstractHttpClient.java:884)\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:82)\n\tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:55)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPHC4Impl.executeRequest(HTTPHC4Impl.java:566)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPHC4Impl.sample(HTTPHC4Impl.java:326)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:74)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1146)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1135)\n\tat org.apache.jmeter.threads.JMeterThread.executeSamplePackage(JMeterThread.java:465)\n\tat org.apache.jmeter.threads.JMeterThread.processSampler(JMeterThread.java:410)\n\tat org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:241)\n\tat java.lang.Thread.run(Thread.java:745)\n\n\nWhen running exactly the same JMX without the cps property, it's working properly.", "id": 192648, "time": "2016-07-26T10:03:32Z", "creator": "loisel.jerome@gmail.com", "creation_time": "2016-07-26T10:03:32Z", "attachment_id": 34072}, {"count": 1, "tags": [], "bug_id": 59902, "is_private": false, "id": 192752, "attachment_id": null, "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-07-31T20:08:47Z", "time": "2016-07-31T20:08:47Z", "text": "Author: pmouawad\nDate: Sun Jul 31 20:07:10 2016\nNew Revision: 1754681\n\nURL: http://svn.apache.org/viewvc?rev=1754681&view=rev\nLog:\nBug 59902 - Https handshake failure when setting httpclient.socket.https.cps property\nBugzilla Id: 59902\n\nAdded:\n    jmeter/trunk/src/core/org/apache/jmeter/util/HostNameSetter.java   (with props)\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/util/SlowSSLSocket.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/JMeterClientConnectionOperator.java\n    jmeter/trunk/xdocs/changes.xml"}]
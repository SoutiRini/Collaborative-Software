[{"count": 0, "attachment_id": null, "bug_id": 49033, "text": "Hello\n\nWhen we create the following rewrite in .htaccess\n\n\nRewriteEngine On\n\nRewriteRule ^a a.php [N]\n\n\napache will consume all memory\nThe LimitInternalRecursion 100 added in config doesnt help \n\n\nprocess\n\napache    8169 78.1 64.4 2900320 2823532 ?     R    01:20   0:21 /usr/sbin/httpd -k start -DSSL\n\nstrace\n\nbrk(0x5ffaf000)                         = 0x5ffaf000\nbrk(0x5ffd1000)                         = 0x5ffd1000\nbrk(0x5fff3000)                         = 0x5fff3000\nbrk(0x60015000)                         = 0x60015000\nbrk(0x60037000)                         = 0x60037000\nbrk(0x60059000)                         = 0x60059000\n\n\n\nGDB\n\nGNU gdb 6.8-debian\nCopyright (C) 2008 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nAttaching to process 8169\nReading symbols from /usr/sbin/httpd...done.\nReading symbols from /usr/lib/libz.so.1...done.\nLoaded symbols for /usr/lib/libz.so.1\nReading symbols from /usr/lib/libssl.so.0.9.8...Reading symbols from /usr/lib/debug/usr/lib/libssl.so.0.9.8...done.\ndone.\nLoaded symbols for /usr/lib/libssl.so.0.9.8\nReading symbols from /usr/lib/libcrypto.so.0.9.8...Reading symbols from /usr/lib/debug/usr/lib/libcrypto.so.0.9.8...done.\ndone.\nLoaded symbols for /usr/lib/libcrypto.so.0.9.8\nReading symbols from /lib/libm.so.6...done.\nLoaded symbols for /lib/libm.so.6\nReading symbols from /usr/local/lib/libpcre.so.0...done.\nLoaded symbols for /usr/local/lib/libpcre.so.0\nReading symbols from /etc/httpd/lib/libaprutil-1.so.0...done.\nLoaded symbols for /etc/httpd/lib/libaprutil-1.so.0\nReading symbols from /usr/lib/libexpat.so.1...done.\nLoaded symbols for /usr/lib/libexpat.so.1\nReading symbols from /usr/lib/libiconv.so.2...done.\nLoaded symbols for /usr/lib/libiconv.so.2\nReading symbols from /etc/httpd/lib/libapr-1.so.0...done.\nLoaded symbols for /etc/httpd/lib/libapr-1.so.0\nReading symbols from /lib/librt.so.1...done.\nLoaded symbols for /lib/librt.so.1\nReading symbols from /lib/libcrypt.so.1...done.\nLoaded symbols for /lib/libcrypt.so.1\nReading symbols from /lib/libpthread.so.0...done.\n[Thread debugging using libthread_db enabled]\n[New Thread 0x71c8f06bf6e0 (LWP 8169)]\nLoaded symbols for /lib/libpthread.so.0\nReading symbols from /lib/libdl.so.2...done.\nLoaded symbols for /lib/libdl.so.2\nReading symbols from /lib/libc.so.6...done.\nLoaded symbols for /lib/libc.so.6\nReading symbols from /lib/ld-linux-x86-64.so.2...done.\nLoaded symbols for /lib64/ld-linux-x86-64.so.2\nReading symbols from /lib/libnss_compat.so.2...done.\nLoaded symbols for /lib/libnss_compat.so.2\nReading symbols from /lib/libnsl.so.1...done.\nLoaded symbols for /lib/libnsl.so.1\nReading symbols from /lib/libnss_nis.so.2...done.\nLoaded symbols for /lib/libnss_nis.so.2\nReading symbols from /lib/libnss_files.so.2...done.\nLoaded symbols for /lib/libnss_files.so.2\nReading symbols from /usr/lib/apache/mod_python.so...done.\nLoaded symbols for /usr/lib/apache/mod_python.so\nReading symbols from /usr/lib/libpython2.5.so.1.0...Reading symbols from /usr/lib/debug/usr/lib/libpython2.5.so.1.0...done.\ndone.\nLoaded symbols for /usr/lib/libpython2.5.so.1.0\nReading symbols from /lib/libutil.so.1...done.\nLoaded symbols for /lib/libutil.so.1\nReading symbols from /usr/lib/apache/mod_fastcgi.so...done.\nLoaded symbols for /usr/lib/apache/mod_fastcgi.so\nReading symbols from /usr/lib/apache/mod_suphp.so...done.\nLoaded symbols for /usr/lib/apache/mod_suphp.so\nReading symbols from /usr/lib/apache/mod_security2.so...done.\nLoaded symbols for /usr/lib/apache/mod_security2.so\nReading symbols from /usr/lib/libxml2.so.2...done.\nLoaded symbols for /usr/lib/libxml2.so.2\nReading symbols from /usr/lib/apache/mod_wsgi.so...done.\nLoaded symbols for /usr/lib/apache/mod_wsgi.so\nReading symbols from /opt/ruby-enterprise-1.8.7-2010.01/lib/ruby/gems/1.8/gems/passenger-2.2.11/ext/apache2/mod_passenger.so...done.\nLoaded symbols for /opt/ruby-enterprise-1.8.7-2010.01/lib/ruby/gems/1.8/gems/passenger-2.2.11/ext/apache2/mod_passenger.so\nReading symbols from /usr/lib/libstdc++.so.6...done.\nLoaded symbols for /usr/lib/libstdc++.so.6\nReading symbols from /lib/libgcc_s.so.1...done.\nLoaded symbols for /lib/libgcc_s.so.1\n0x000071c8ee3550e5 in strlen () from /lib/libc.so.6\n(gdb) bt full\n#0  0x000071c8ee3550e5 in strlen () from /lib/libc.so.6\nNo symbol table info available.\n#1  0x000071c8eee9ef4a in apr_pstrcat (a=0x4d229b8) at strings/apr_strings.c:138\n        cp = 0x37903f60 \"a.php\"\n        argp = <value optimized out>\n        res = <value optimized out>\n        saved_lengths = {43, 5, 80960600, 4954449, 137199080128336, 10}\n        nargs = 1\n        len = 43\n        adummy = {{gp_offset = 24, fp_offset = 0, overflow_arg_area = 0x7cc8266f4010, reg_save_area = 0x7cc8266f3f30}}\n#2  0x00000000004bbac1 in apply_rewrite_rule (p=0x4d35ba8, ctx=0x4d3aa68) at mod_rewrite.c:3904\n        regmatch = {{rm_so = 0, rm_eo = 1}, {rm_so = -1, rm_eo = -1}, {rm_so = -1, rm_eo = -1}, {rm_so = -1, rm_eo = -1}, {rm_so = -1, rm_eo = -1}, {\n    rm_so = -1, rm_eo = -1}, {rm_so = -1, rm_eo = -1}, {rm_so = -1, rm_eo = -1}, {rm_so = -1, rm_eo = -1}, {rm_so = -1, rm_eo = -1}}\n        rewriteconds = (apr_array_header_t *) 0x4d35b28\n        conds = (rewritecond_entry *) 0x4d35b48\n        i = 80960392\n        rc = 80960600\n        newuri = 0x37903f60 \"a.php\"\n        r = (request_rec *) 0x4d22a30\n        is_proxyreq = 0\n#3  0x00000000004bbf72 in apply_rewrite_list (r=0x4d22a30, rewriterules=0x4d35b88, perdir=0x4d35c58 \"/path/to/file\")\n    at mod_rewrite.c:4027\n        entries = (rewriterule_entry *) 0x4d35ba8\n        p = (rewriterule_entry *) 0x4d35ba8\n        i = <value optimized out>\n        changed = 1\n        rc = 1\n        s = <value optimized out>\n        ctx = (rewrite_ctx *) 0x4d3aa68\n#4  0x00000000004bc9ee in hook_fixup (r=0x4d22a30) at mod_rewrite.c:4584\n        dconf = (rewrite_perdir_conf *) 0x4d362e0\n        cp = <value optimized out>\n        cp2 = <value optimized out>\n        ccp = <value optimized out>\n        l = 42\n        rulestatus = <value optimized out>\n        n = <value optimized out>\n        ofilename = 0x4d2b5c0 \"/path/to/a\"\n#5  0x000000000044130a in ap_run_fixups (r=0x4d22a30) at request.c:73\n        n = 5\n        rv = 1735339360\n#6  0x000000000048fc08 in ap_process_request (r=0x4d22a30) at http_request.c:280\n        access_status = 932200293\n#7  0x000000000048cc38 in ap_process_http_connection (c=0x4d16740) at http_core.c:190\n        r = (request_rec *) 0x4d22a30\n        csd = (apr_socket_t *) 0x0\n#8  0x000000000044d943 in ap_run_process_connection (c=0x4d16740) at connection.c:43\n        n = 1\n---Type <return> to continue, or q <return> to quit---\n        rv = 1735339360\n#9  0x00000000004be150 in child_main (child_num_arg=<value optimized out>) at prefork.c:662\n        current_conn = <value optimized out>\n        csd = (void *) 0x4d16550\n        ptrans = (apr_pool_t *) 0x4d164d8\n        allocator = (apr_allocator_t *) 0x4cd47c0\n        status = <value optimized out>\n        i = <value optimized out>\n        lr = <value optimized out>\n        pollset = (apr_pollset_t *) 0x4d147a0\n        sbh = (ap_sb_handle_t *) 0x4d14798\n        bucket_alloc = (apr_bucket_alloc_t *) 0x4d209a8\n        last_poll_idx = 1\n#10 0x00000000004be414 in make_child (s=0x71d690, slot=12) at prefork.c:758\nNo locals.\n#11 0x00000000004be9bc in ap_mpm_run (_pconf=<value optimized out>, plog=<value optimized out>, s=<value optimized out>) at prefork.c:776\n        index = <value optimized out>\n        remaining_children_to_start = 3\n        rv = <value optimized out>\n#12 0x0000000000432da5 in main (argc=4, argv=0x7cc8266f47f8) at main.c:740\n        c = 68 'D'\n        configtestonly = 0\n        confname = 0x4c0ac8 \"conf/httpd.conf\"\n        def_server_root = 0x4c0ad8 \"/etc/httpd\"\n        temp_error_log = 0x0\n        error = <value optimized out>\n        process = <value optimized out>\n        server_conf = (server_rec *) 0x71d690\n        pglobal = (apr_pool_t *) 0x70d728\n        pconf = (apr_pool_t *) 0x70f738\n        plog = (apr_pool_t *) 0x76db38\n        ptemp = (apr_pool_t *) 0x71d8b8\n        pcommands = (apr_pool_t *) 0x711748\n        opt = (apr_getopt_t *) 0x711838\n        rv = <value optimized out>\n        mod = <value optimized out>\n        optarg = 0x7cc8266f4a33 \"SSL\"\n(gdb) quit\n\n\nits really a bug ?\n\nRegards,\nPiotr", "id": 135828, "time": "2010-03-31T23:23:40Z", "creator": "piotr.kloc@poszkole.pl", "creation_time": "2010-03-31T23:23:40Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "jonathan.petersson@binero.se", "text": "This issue can also be duplicated using \n\nRewriteRule ^([^_]*)_+(.*)$ $1-$2 [E=underscores:Yes,N]\nRewriteCond %{ENV:underscores} ^Yes$\nRewriteRule (.*) $1 [R=301,L]", "id": 135988, "time": "2010-04-09T12:30:55Z", "bug_id": 49033, "creation_time": "2010-04-09T12:30:55Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "covener@gmail.com", "text": "writing loops with the N flag that never complete is not a bug in the server.  \n\n(LimitInternalRecursion only applies to requests internally redirected, not ones that have been rigged to spend their entire left executing the same regex and never getting out of a single invocation of mod_rewrite)", "id": 149728, "time": "2011-09-25T17:55:06Z", "bug_id": 49033, "creation_time": "2011-09-25T17:55:06Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "Hello !\n\nIn new apache 2.2.22 the problem still exists\nthat rewrite cause 100% of usage memory", "is_private": false, "id": 159291, "creator": "pio@rdl.pl", "time": "2012-05-24T14:20:29Z", "bug_id": 49033, "creation_time": "2012-05-24T14:20:29Z", "attachment_id": null}]
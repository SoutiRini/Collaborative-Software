[{"count": 0, "tags": [], "bug_id": 44980, "attachment_id": 21953, "id": 116540, "time": "2008-05-12T16:55:07Z", "creator": "lateralcoder@gmail.com", "creation_time": "2008-05-12T16:55:07Z", "is_private": false, "text": "Created attachment 21953\nAnt Recursion Patch\n\nAnt has some support for recursing a target down a build hierarchy in the form of the following:\n- fileset can specify a list of directories or build files\n- antcontrib:for can do iteration\n\nHowever each target has to handle recursion itself.\n\nI have developed a patch (roughly 30 extra lines of code across 6 files) adds two new\n*dynamic* properties to Ant:\n 1) ant.project.target - the default target of the current project\n 2) ant.current.target - a comma-separated list of the actual targets\nthat were invoked on the current project\n\nThese properties are updated automatically, similar to ant.file or\nant.project.name.\n\nThe \"recurse\" macro uses the antcontrib:for task to iterate over\nmultiple targets (btw, the currnet antcontrib jar is missing the \"for\" task in its properties). The macro can accept an explicit list of\ntargets, but I also wanted to be able to recurse on the targets that\nwere actually invoked.\n\nHere's how you would use it:\n\n <!-- define the \"recurse\" macro -->\n <typedef file=\"recurse.xml\"/>\n\n <!-- \"subdirs\" is the ordered list of sub-folders that \"recurse\" uses -->\n <filelist dir=\".\" id=\"subdirs\" files=\"x1,x2\"/>\n\n <!-- invokes the macro on the current target(s), which may be the\nones specified or falls back to the default target -->\n <recurse/>\n\nAlternatively:\n <!-- invoke the macro on the specified targets -->\n <recurse targets=\"this,that,other\"/>\n\nI've attached the patch. The \"recurse\" macro is trivial using the new properties:\n<?xml version=\"1.0\"?>\n<antlib xmlns:antcontrib=\"antlib:net.sf.antcontrib\">\n    <macrodef name=\"recurse\">\n        <attribute name=\"targets\" default=\"${ant.current.target}\"/>\n        <sequential>\n            <condition property=\"recurseTargets\" value=\"${ant.project.target}\" else=\"@{targets}\">\n              <equals arg1=\"@{targets}\" arg2=\"\" />\n            </condition>\n            <antcontrib:for list=\"${recurseTargets}\" param=\"target\">\n                <sequential>\n                    <subant target=\"@{target}\">\n                        <filelist refid=\"subdirs\"/>\n                    </subant>\n                </sequential>\n            </antcontrib:for>\n        </sequential>\n    </macrodef>\n</antlib>"}, {"count": 1, "attachment_id": null, "bug_id": 44980, "is_private": false, "id": 117171, "time": "2008-05-30T01:07:31Z", "creator": "bodewig@apache.org", "creation_time": "2008-05-30T01:07:31Z", "tags": [], "text": "personally I don't see any problems with adding the two properties you suggested, will start a dedicated thread on the dev list.\n\nI might disagree with minor details of the patch, in particular I'd probably move the listTo... method into oata.util.CollectionUtils.\n\nEven though the patch looks trivial, I'd appreciate tests ;-)\n\nThose details can and will be hashed out within minutes once we agree that the feature itself is desirable."}, {"count": 2, "tags": [], "text": "http://svn.apache.org/viewvc?rev=663051&view=rev\nhttp://svn.apache.org/viewvc?rev=663061&view=rev\n\nBy changing Project rather than Main to set the list of invoked targets no longer was necessary to modify <*ant*> at all. \n\nThanks", "is_private": false, "id": 117332, "creator": "bodewig@apache.org", "time": "2008-06-04T04:00:06Z", "bug_id": 44980, "creation_time": "2008-06-04T04:00:06Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 52504, "attachment_id": 28195, "text": "Created attachment 28195\nSample code.\n\nI'm using apache poi 3.8 beta 5 (20111217) it It cant add a picture on a XSSFWorkbook using the margin I configured at the anchor. The same code works normally when I try to insert it on a HSSFWorkbook.\n\nThe only way i found to display the picture was to call picture.resize, but if i do this it will ignore the dx and dy values I configured at the Anchor.", "id": 153059, "time": "2012-01-23T16:05:01Z", "creator": "felipe.issa@simova.com.br", "creation_time": "2012-01-23T16:05:01Z", "is_private": false}, {"count": 1, "attachment_id": null, "creator": "yegor@dinom.ru", "text": "The problem is that XSSF interprets dx and dy offsets differently than HSSF.  \nIn HSSF dx is a fraction of cell width in units of 1/1024. \nanchor.setDx1(400) sets the offset to approximately 40% of the cell width (400/1024) and anchor.setDx2(655) sets the second dx offset to 65% of the cell. that is, the image is located in the middle of the cell between 40% and 65% of the width.\n\nIn XSSF all dx and dy offsets are set in EMUS (one pixel is 9525 EMUs) and the equivalent code to anchor your image is as follows:\n\n            anchor.setDx1(25*XSSFShape.EMU_PER_PIXEL);\n            anchor.setDx2(41*XSSFShape.EMU_PER_PIXEL);\n            anchor.setDy1(1*XSSFShape.EMU_PER_PIXEL);\n            anchor.setDy2(14*XSSFShape.EMU_PER_PIXEL);\n\nSetting dx and dy offsets is not portable between HSSF and XSSF. Change your code to set them in pixels. If both .xls and .xlsx should be supported then add a 'if' clause for each format:\n\n        if(wb instanceof HSSFWorkbook){\n            anchor.setDx1(400);\n            anchor.setDx2(655);\n            anchor.setDy1(10);\n            anchor.setDy2(200);\n        } else {\n            anchor.setDx1(25*XSSFShape.EMU_PER_PIXEL);\n            anchor.setDx2(41*XSSFShape.EMU_PER_PIXEL);\n            anchor.setDy1(1*XSSFShape.EMU_PER_PIXEL);\n            anchor.setDy2(14*XSSFShape.EMU_PER_PIXEL);\n        }\n\nCheers,\nYegor", "id": 153399, "time": "2012-02-03T11:23:43Z", "bug_id": 52504, "creation_time": "2012-02-03T11:23:43Z", "tags": [], "is_private": false}]
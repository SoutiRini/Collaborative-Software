[{"count": 0, "attachment_id": null, "bug_id": 41274, "text": "I'm getting a dead lock as follows, wondering if this is a known issue or if a\nfix is available in a later release.\n\nPlease let me know if you need more information.\n\nFound one Java-level deadlock:\n=============================\n\"SW_WORKER.12\":\n  waiting to lock monitor 0x08777644 (object 0xce2f6478, a\norg.apache.log4j.spi.RootLogger),\n  which is held by \"SW_WORKER.13\"\n\"SW_WORKER.13\":\n  waiting to lock monitor 0x08777604 (object 0xce3ac200, a\ncom.aol.jwal.sapi.KSLog$Appender),\n  which is held by \"SW_WORKER.12\"\n\nJava stack information for the threads listed above:\n===================================================\n\"SW_WORKER.12\":\n    at org.apache.log4j.Category.callAppenders(Category.java:193)\n    - waiting to lock <0xce2f6478> (a org.apache.log4j.spi.RootLogger)\n    at org.apache.log4j.Category.forcedLog(Category.java:379)\n    at org.apache.log4j.Category.debug(Category.java:248)\n    at com.aol.jwal.sapi.PreemptorPipe.Preempt(PreemptorPipe.java:69)\n    at com.aol.jwal.sapi.NTKRunFIFO.schedule(NTKRunFIFO.java:158)\n    at com.aol.jwal.sapi.KSLog$Appender$Writer.done(KSLog.java:357)\n    at com.aol.jwal.sapi.KSLog$Appender.append(KSLog.java:292)\n    at org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:221)\n    - locked <0xce3ac200> (a com.aol.jwal.sapi.KSLog$Appender)\n    at\norg.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:57)\n    at org.apache.log4j.Category.callAppenders(Category.java:194)\n    - locked <0xce399418> (a org.apache.log4j.Logger)\n    at org.apache.log4j.Category.forcedLog(Category.java:379)\n    at org.apache.log4j.Category.debug(Category.java:248)\n    at com.aol.jdb.somldb.SomlDbToJdbc.handleInt(SomlDbToJdbc.java:220)\n    at com.aol.jdb.somldb.SomlDbToJdbc.fillArguments(SomlDbToJdbc.java:87)\n    at com.aol.jdb.source.SomlDbSpSource.fillArguments(SomlDbSpSource.java:79)\n    at com.aol.jdb.source.SomlDbSourceBase.processRequest(SomlDbSourceBase.java:110)\n    at com.aol.jdb.source.SomlDbSourceBase.perform(SomlDbSourceBase.java:81)\n    at com.aol.jdb.service.JdbServiceBase.processRequest(JdbServiceBase.java:70)\n    at\ncom.aol.jdb.somldb.SomlDbRequestProcessor.processRequest(SomlDbRequestProcessor.java:38)\n    at com.aol.jdb.somldb.SomldbJdbRequest.process(SomldbJdbRequest.java:49)\n    at com.aol.jdb.engine.Worker.run(Worker.java:106)\n\"SW_WORKER.13\":\n    at org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:201)\n    - waiting to lock <0xce3ac200> (a com.aol.jwal.sapi.KSLog$Appender)\n    at\norg.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:57)\n    at org.apache.log4j.Category.callAppenders(Category.java:194)\n    - locked <0xce2f6478> (a org.apache.log4j.spi.RootLogger)\n    at org.apache.log4j.Category.forcedLog(Category.java:379)\n    at org.apache.log4j.Category.debug(Category.java:248)\n    at com.aol.jwal.sapi.PreemptorPipe.Preempt(PreemptorPipe.java:69)\n    at com.aol.jwal.sapi.NTKRunFIFO.schedule(NTKRunFIFO.java:158)\n    at\ncom.aol.jwal.sapi.channels.QMIChannelBase$MessageSender.sendASAP(QMIChannelBase.java:138)\n    at com.aol.jwal.sapi.channels.QMIChannel.sendMessage(QMIChannel.java:43)\n    at com.aol.jdb.somldb.ResultDispatcher.sendOverQMI(ResultDispatcher.java:151)\n    at com.aol.jdb.somldb.ResultDispatcher.dispatch(ResultDispatcher.java:134)\n    at com.aol.jdb.somldb.SomlDbResponse.dispatch(SomlDbResponse.java:267)\n    at com.aol.jdb.source.SomlDbSourceBase.processRequest(SomlDbSourceBase.java:170)\n    at com.aol.jdb.source.SomlDbSourceBase.perform(SomlDbSourceBase.java:81)\n    at com.aol.jdb.service.JdbServiceBase.processRequest(JdbServiceBase.java:70)\n    at\ncom.aol.jdb.somldb.SomlDbRequestProcessor.processRequest(SomlDbRequestProcessor.java:38)\n    at com.aol.jdb.somldb.SomldbJdbRequest.process(SomldbJdbRequest.java:49)\n    at com.aol.jdb.engine.Worker.run(Worker.java:106)\n\nFound 1 deadlock.\n\nThanks\nRavi", "id": 97519, "time": "2007-01-01T23:30:11Z", "creator": "ravitx12@yahoo.com", "creation_time": "2007-01-01T23:30:11Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "Note, the KSLog$Appender looks as below :\n\npublic final class KSLog\n{\n..\nstatic public final class Appender extends AppenderSkeleton;\n..\n}", "is_private": false, "id": 97520, "creator": "ravitx12@yahoo.com", "time": "2007-01-01T23:39:16Z", "bug_id": 41274, "creation_time": "2007-01-01T23:39:16Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "bayard@apache.org", "text": "This looks remarkably similar to\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=41214.\n\nWhich particular version of log4j are you running against? If the line numbers\nbelow correspond with the File object usage in 41214, then I think this can be\nresolved a dupe.", "id": 98538, "time": "2007-01-25T17:34:46Z", "bug_id": 41274, "creation_time": "2007-01-25T17:34:46Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 41274, "text": "This is definitely not a duplicate of 41214. This is a classic deadlock issue. \nI tried even with the latest version of log4j and noticed the same behavior.\n\nThe main problem is, we are calling log4j within the appender itself after \nlog4j calls the appender. A fix for this got to be expensive as you need to \nlock all appenders for a logger when that logger is logging. Or you should \natleast publish a guideline stating log4j should not be called from the \nappenders.\n\nThanks for looking into this.\n\nRavi\n\n(In reply to comment #2)\n> This looks remarkably similar to\n> http://issues.apache.org/bugzilla/show_bug.cgi?id=41214.\n> Which particular version of log4j are you running against? If the line \nnumbers\n> below correspond with the File object usage in 41214, then I think this can \nbe\n> resolved a dupe.\n\n", "id": 98544, "time": "2007-01-25T20:12:42Z", "creator": "ravitx12@yahoo.com", "creation_time": "2007-01-25T20:12:42Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 41274, "attachment_id": null, "id": 98590, "time": "2007-01-26T17:58:10Z", "creator": "genman@noderunner.net", "creation_time": "2007-01-26T17:58:10Z", "is_private": false, "text": "\nI'm guessing a dupe of 24159.\n\nCan you attempt to use the concurrent appender classes?  These are in the\nsubversion repository.\n\nThis may require refactoring your KSLog class, assuming it is yours.\nUnfortunately, AppenderSkeleton cannot be fixed without breaking compatibility."}, {"count": 5, "tags": [], "text": "\n\n*** This bug has been marked as a duplicate of 24159 ***", "is_private": false, "id": 107106, "creator": "carnold@apache.org", "time": "2007-08-22T19:44:50Z", "bug_id": 41274, "creation_time": "2007-08-22T19:44:50Z", "attachment_id": null}]
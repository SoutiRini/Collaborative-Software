[{"count": 0, "tags": [], "bug_id": 1494, "attachment_id": null, "text": "I traced it to:\n\ntomcat/modules/generators/ErrorHandler: handleStatusImpl() near line 165:\n\n\tif( code != 302 && code != 401 && code!=400  ) {// tuneme\n\t    ctx.log( \"Status code:\" + code + \" request:\"  + req + \" msg:\" +\n\t\t     req.getAttribute(\"javax.servlet.error.message\"));\n\t}\n\nhere ctx is null, this is bad. The reason is is from handleError() where:\n\n\tif(ctx==null) {\n\t    // that happens only if the request can't pass contextMap\n\t    // hook. The reason for that is a malformed request, or any\n\t    // other error.\n\t    ctx=rootContext;\n\t}\n\nhere rootContext is also null.\n\nAll I can say is that the server was being load tested. It is also likely that\nwhen the load testing ended many connections were killed by the tester causing\n\"connection reset by peer\". I don't know if that is related to this problem.", "id": 2082, "time": "2001-04-25T03:03:43Z", "creator": "rmager@vgkk.com", "creation_time": "2001-04-25T03:03:43Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 1494, "attachment_id": null, "id": 2083, "time": "2001-04-25T03:04:55Z", "creator": "rmager@vgkk.com", "creation_time": "2001-04-25T03:04:55Z", "is_private": false, "text": "I forgot to mention that at this point if I try to access the server about 1 in\n2 attempts get this error. I'm wondering if certain threads in the pool are bad\nnow for some reason. Mind you, I know almost nothing about Tomcat's internal\nworkings."}, {"count": 2, "tags": [], "creator": "rmager@vgkk.com", "text": "In ErrorHandler the contextInit method has the following. As you can see, if the\ncondition is true the rootContext is never set. This may be the heart of the\nproblem.\n\n\n\tpublic void contextInit( Context ctx)\n\tthrows TomcatException\n\t{\n\tif( ctx.getHost() == null && ctx.getPath().equals(\"\"))\n\t\trootContext = ctx;\n", "id": 2103, "time": "2001-04-25T15:19:31Z", "bug_id": 1494, "creation_time": "2001-04-25T15:19:31Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "cmanolache@yahoo.com", "text": "The code tries to find a default context - that's the ROOT context for the \ndefault host. Do you happen to not have a default context, but only \nvirtual hosts ? Or no ROOT context ? \nWhat kind of load testing are you doing ? Can you reproduce it with a normal\nservlet ( like in examples/something ) ? \nIt's very strange that it still happens after you stop the load - if you are\nusing the default config than it may be a serious problem.", "count": 3, "id": 2195, "time": "2001-05-01T16:58:04Z", "bug_id": 1494, "creation_time": "2001-05-01T16:58:04Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 1494, "attachment_id": null, "text": "Not enough data ( please let me know if you still have this problem,\nif you have a ROOT context ). It should be re-analyzed later, but I can't\nreproduce it.", "id": 2967, "time": "2001-06-13T15:52:19Z", "creator": "cmanolache@yahoo.com", "creation_time": "2001-06-13T15:52:19Z", "is_private": false}, {"count": 5, "tags": [], "creator": "rmager@vgkk.com", "is_private": false, "text": "We've switched to 3.2.x for now so I'm not actively using 3.3. Sorry I can't \nprovide any new info. If we move to 3.3 and the problems comes up again I will \nreopen this.", "id": 2971, "time": "2001-06-13T16:24:15Z", "bug_id": 1494, "creation_time": "2001-06-13T16:24:15Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "Can't reproduce.", "is_private": false, "id": 4072, "creator": "cmanolache@yahoo.com", "time": "2001-07-26T17:34:05Z", "bug_id": 1494, "creation_time": "2001-07-26T17:34:05Z", "attachment_id": null}]
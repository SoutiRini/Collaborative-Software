[{"count": 0, "tags": [], "bug_id": 36423, "attachment_id": null, "text": "I used the following jsp to login under TOMCAT 4 and it works fine. Under Tomcat\n5 it does not work. It just passes once in the first if{}.\n\n<%@ page import=\"jcifs.ntlmssp.Type3Message\" %>\n<%\nString auth = request.getHeader(\"Authorization\");\n\nif (auth == null) {\n  response.setContentLength(0);\n  response.setStatus(response.SC_UNAUTHORIZED);\n  response.setHeader(\"WWW-Authenticate\", \"NTLM\");\n  response.flushBuffer();\n  return;\n}\n\nif (auth.startsWith(\"NTLM \")) {\n  byte[] msg = new sun.misc.BASE64Decoder().decodeBuffer(auth.substring(5));\n  int off = 0, length, offset;\n  if (msg[8] == 1) {\n    byte z = 0;\n    byte[] msg1 = {(byte)'N', (byte)'T', (byte)'L',\n      (byte)'M', (byte)'S', (byte)'S', (byte)'P', z,(byte)2, z,\n      z, z, z, z, z, z,(byte)40, z, z, z, (byte)1, (byte)130,\n      z, z, z, (byte)2, (byte)2, (byte)2, z, z, z, z, z, z, z,\n      z, z, z, z, z};\n    out.println(\" \");\n    response.setContentLength(3);\n    response.setHeader(\"WWW-Authenticate\", \"NTLM \" +\n    new sun.misc.BASE64Encoder().encodeBuffer(msg1).trim());\n    response.sendError(response.SC_UNAUTHORIZED);\n    return;\n  }\n  else if (msg[8] == 3) {\n    logCat.debug(\"Type3\");\n    Type3Message type3 = new Type3Message(msg);\n    session.setAttribute(\"osUser\",type3.getUser());\n    session.setAttribute(\"osRemoteHost\",type3.getWorkstation());\n    session.setAttribute(\"osDomain\",type3.getDomain());\n    response.sendRedirect(\"index.jsp\");\n  }\n}\n%>", "id": 79191, "time": "2005-08-30T17:57:21Z", "creator": "peterjung101@hotmail.com", "creation_time": "2005-08-30T17:57:21Z", "is_private": false}, {"count": 1, "tags": [], "text": "Once response.setContentLength(0); is called, the response is commited and any\nother header settings will trigger an ISE.\n\nPlease use tomcat-user for more help debugging.", "is_private": false, "id": 79193, "creator": "funkman@joedog.org", "time": "2005-08-30T18:01:50Z", "bug_id": 36423, "creation_time": "2005-08-30T18:01:50Z", "attachment_id": null}]
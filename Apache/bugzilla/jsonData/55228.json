[{"count": 0, "tags": [], "bug_id": 55228, "text": "If the application sets the Date header, then it is most likely for caching purposes and Tomcat needs to return it as is.\n\n\n\nA consistent Date header is very important for proper Age/Max-Age calculations.\n\nhttp://www.w3.org/Protocols/HTTP/Issues/add-age.html", "id": 168441, "time": "2013-07-10T00:35:33Z", "creator": "fern@alum.mit.edu", "creation_time": "2013-07-10T00:35:33Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 55228, "attachment_id": null, "id": 168442, "time": "2013-07-10T00:41:10Z", "creator": "fern@alum.mit.edu", "creation_time": "2013-07-10T00:41:10Z", "is_private": false, "text": "I opened this bug against Tomcat6 since that is what we're using, but this bug exists on all Tomcat7, as well, and most likely Tomcat8.  I'm not sure how to deal with that.\n\n\n\nLooking at tomcat-embed-core-7.0.42.jar:\nAbstractHttp11Processor.prepareResponse\nline: 1458\n\n// Add date header\nheaders.setValue(\"Date\").setString(FastHttpDateFormat.getCurrentDate());\n\n\nYou see that it sets the Date header, not checking if it had been already set by that application.  Should be able to easily wrap it with:\n\nif ( headers.getValue(\"Date\") == null ) {\n  ...\n}"}, {"count": 2, "tags": [], "bug_id": 55228, "attachment_id": null, "id": 168452, "time": "2013-07-10T11:56:56Z", "creator": "markt@apache.org", "creation_time": "2013-07-10T11:56:56Z", "is_private": false, "text": "If a bug affects multiple versions open an issue (as you have done) against the earliest supported version you want to see the fix in. Fixes are applied to trunk and then back-ported through each supported version until the bug the issue was reported against is reached. So this will be fixed (assuming the bug is valid and it looks like it is at first glance) in trunk, 7.0.x and 6.0.x."}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "text": "I'm currently leaning to resolving this as invalid. As an origin server, Tomcat is required by RFc2616 to set the date header (using the current time) on every request.\n\nI'd be prepared to implement this change given a valid use case but I currently don't see a valid, RFC 2616 compliant reason for an application to set the date header.", "count": 3, "id": 168453, "time": "2013-07-10T12:54:44Z", "bug_id": 55228, "creation_time": "2013-07-10T12:54:44Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "fern@alum.mit.edu", "text": "The valid usecase is that we have implemented a Caching Filter (and many people have to).  And per that spec, we're supposed to return the Date header of when the original response was cached/generated.  It's required so that clients can properly calculate the age of the returned resource.  But Tomcat keeps overwriting the Date header, thus messing up the age calculation.\n\nhttp://www.w3.org/Protocols/HTTP/Issues/add-age.html", "count": 4, "id": 168486, "time": "2013-07-10T22:06:17Z", "bug_id": 55228, "creation_time": "2013-07-10T22:06:17Z", "is_private": false}, {"count": 5, "tags": [], "text": "Fair enough.\n\nThis has been fixed for trunk and 7.0.x and will be included in 7.0.43 onwards.\n\nThe fix has been proposed for 6.0.x.", "attachment_id": null, "bug_id": 55228, "id": 168514, "time": "2013-07-11T16:05:34Z", "creator": "markt@apache.org", "creation_time": "2013-07-11T16:05:34Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 55228, "text": "Fixed in 6.0.x and will be included in 6.0.38 onwards.", "id": 170052, "time": "2013-09-11T20:36:04Z", "creator": "markt@apache.org", "creation_time": "2013-09-11T20:36:04Z", "is_private": false, "attachment_id": null}]
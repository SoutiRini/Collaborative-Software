[{"count": 0, "tags": [], "creator": "ville.skytta@iki.fi", "attachment_id": null, "id": 24086, "creation_time": "2002-10-07T17:38:36Z", "time": "2002-10-07T17:38:36Z", "bug_id": 13372, "text": "I've been experiencing NPE's with Ant 1.5 in a situation where I run JBoss\nstarted from Ant on a Linux system, and hit Control-C to terminate the JBoss\nprocess.  Here's a stack trace, and I'll attach a patch against current CVS that\nmight avoid the NPE (untested).\n\njava.lang.NullPointerException\n        at java.lang.System.arraycopy(Native Method)\n        at\njava.io.BufferedInputStream.read1(BufferedInputStream.java:227)\n        at\njava.io.BufferedInputStream.read(BufferedInputStream.java:277)\n        at java.io.FilterInputStream.read(FilterInputStream.java:90)\n        at\norg.apache.tools.ant.taskdefs.StreamPumper.run(StreamPumper.java:105)\n        at java.lang.Thread.run(Thread.java:536)", "is_private": false}, {"count": 1, "attachment_id": 3381, "bug_id": 13372, "is_private": false, "id": 24087, "time": "2002-10-07T17:39:46Z", "creator": "ville.skytta@iki.fi", "creation_time": "2002-10-07T17:39:46Z", "tags": [], "text": "Created attachment 3381\nPossible fix for StreamPumper NPE"}, {"count": 2, "tags": [], "bug_id": 13372, "attachment_id": null, "id": 30653, "time": "2003-02-04T14:40:48Z", "creator": "conor@apache.org", "creation_time": "2003-02-04T14:40:48Z", "is_private": false, "text": "I don't think your patch will work since \"is\" is, IMHO, not actually null (the\nfact that java.io.BufferedInputStream.read(BufferedInputStream.java:277) occurs\nin the stack trace would probably confirm that). Something within \"is\" must be null.\n\nCan you tell me what JDK you are using and exactly how you are launching jBoss\nfrom Ant.\n\n"}, {"count": 3, "tags": [], "creator": "ville.skytta@iki.fi", "attachment_id": null, "id": 30696, "creation_time": "2003-02-04T22:30:12Z", "time": "2003-02-04T22:30:12Z", "bug_id": 13372, "text": "Yeah, that patch was a shot in the dark in the first place, I'm not surprised if\nit doesn't work :)\n\nAnyway, I've just confirmed the same error using Sun's J2SE 1.4.1_01, Ant 1.5.1\nand JBoss 3.0.6 (with integrated Tomcat 4.1.18) on a Red Hat Linux 8.0 box.\n\nThe results vary, usually I get the NPE, sometimes absolutely no output (and\nimmediate return) and sometimes a graceful JBoss shutdown.\n\nThis is the java task from my build.xml.  jboss.home and java.home properties\nare properly set.\n\n<target name=\"run\">\n  <java fork=\"yes\" classname=\"org.jboss.Main\">\n    <jvmarg value=\"-Xms32M\"/>\n    <jvmarg value=\"-Xmx64M\"/>\n    <arg line=\"-c myserver\"/> \n    <classpath>\n      <pathelement location=\"${jboss.home}/bin/run.jar\"/>\n      <pathelement location=\"${java.home}/lib/tools.jar\"/>\n    </classpath>\n  </java>\n</target>\n", "is_private": false}, {"count": 4, "tags": [], "bug_id": 13372, "attachment_id": null, "is_private": false, "id": 30994, "time": "2003-02-10T11:22:40Z", "creator": "conor@apache.org", "creation_time": "2003-02-10T11:22:40Z", "text": "I've reworked the output stuff a little in recent changes. It was not to address\nthis bug and I don't expect this bug to have gone away (it may have since I\nremove a layer of closing). Are you able to try out the latest code (either from\nCVS or a nightly build) and give me a full stacktrace to see if I can figure out\nwhat is happening."}, {"count": 5, "attachment_id": null, "bug_id": 13372, "is_private": false, "id": 31169, "time": "2003-02-12T20:54:32Z", "creator": "ville.skytta@iki.fi", "creation_time": "2003-02-12T20:54:32Z", "tags": [], "text": "Here's the full stacktrace for Ant HEAD from CVS a couple of minutes ago.  Only\nthe line number for StreamPumper has changed.  I also did some testing, and when\nthe NPE is thrown, neither \"is\" or \"buf\" is null... *shrug*.  A J2SE bug?\n\nBTW; I tried using the latest (2003-02-12) nightly binary first, but\n-diagnostics say it's \"Apache Ant version 1.6alpha compiled on February 10\n2003\".  Note 10th vs 12th... maybe the autobuilder hasn't been updated according\nto CVS reorganization?\n\njava.lang.NullPointerException\n    at java.lang.System.arraycopy(Native Method)\n    at java.io.BufferedInputStream.read1(BufferedInputStream.java:227)\n    at java.io.BufferedInputStream.read(BufferedInputStream.java:277)\n    at java.io.FilterInputStream.read(FilterInputStream.java:90)\n    at org.apache.tools.ant.taskdefs.StreamPumper.run(StreamPumper.java:119)\n    at java.lang.Thread.run(Thread.java:536)\n"}, {"count": 6, "tags": [], "text": "OK, thanks. The Null pointer is actually within BufferedInputStream. The\ninternal buffer has been freed because the stream has been closed.\n\nThis is what I think is happening. When you control-C JBoss, the process gets\nkilled, closing the stream. However, this happens in a separate thread from the\nread operation. When the read operation starts, the stream is open, but by the\ntime the buf gets to be used, the stream has been closed and the NPE results.\nThis sequence bypassses the stream's check to ensure it is open. This is why the\nresults vary - it depends on the timing of events between two thread.\n\nI will change the IOException catch to an Exception catch which should take care\nof this situation.", "is_private": false, "id": 31180, "creator": "conor@apache.org", "time": "2003-02-12T23:05:55Z", "bug_id": 13372, "creation_time": "2003-02-12T23:05:55Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 13372, "attachment_id": null, "id": 31360, "time": "2003-02-16T14:08:56Z", "creator": "conor@apache.org", "creation_time": "2003-02-16T14:08:56Z", "is_private": false, "text": "Changed catch clause to soak up and NPEs due to multithread interations when\nthings are getting closed. "}]
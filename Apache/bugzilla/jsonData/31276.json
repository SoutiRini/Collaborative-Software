[{"count": 0, "tags": [], "bug_id": 31276, "attachment_id": null, "id": 63729, "time": "2004-09-17T15:04:20Z", "creator": "peter.edwards@astrazeneca.com", "creation_time": "2004-09-17T15:04:20Z", "is_private": false, "text": "Using the HTML manager interface I deployed a war file that was already on the \nserver (i.e. I did not upload the war file). The war file contained a META-\nINF/context.xml which itself had some context parameter elements and a logger \nelement. The application deploys correctly and these parameters are read but \nthe xml file created in conf/Catalina/localhost does not contain any child \nelements - just a rewritten version of the <context>.\n\nIf the server is restarted, the application fails to start correctly because of \nthe missing context elements.\n\nI have seen related queries about the context failing to load resources but \nthis is different. It loads them but does not preserve them for a restart."}, {"count": 1, "attachment_id": null, "creator": "yoavs@computer.org", "text": "Was there an app.xml in conf/Catalina/localhost already?  Such aas from a \nprevious deployment?  If so, it won't be overwritten by the HTML manager \ndeployment.", "id": 67014, "time": "2004-11-17T14:54:15Z", "bug_id": 31276, "creation_time": "2004-11-17T14:54:15Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "is_private": false, "id": 67346, "time": "2004-11-22T15:57:01Z", "bug_id": 31276, "creation_time": "2004-11-22T15:57:01Z", "text": "This works for me fine when doing a clean deployment.  If there's already an \napp.xml in conf/[engine]/[host] then it won't be overwritten, and the effect is \nthat META-INF/context.xml will appear to be ignored.  So you need to be \nvigilant about the server's configuration state with respect to these app.xml \nfile when using the META-INF/context.xml feature."}, {"count": 3, "attachment_id": null, "creator": "peter.edwards@astrazeneca.com", "text": "I have rechecked the sitation and it definitely happens as I describe. Let me \nexplain again, starting with a clean installation of Tomcat.\n\nI created a war file that contained a context.xml that included a parameter \n(see attachment). This file exists on the server but not in any place that \nTomcat knows about. Then I go through the following steps (on Tomcat 5.0.28).\n\n1. Use the HTML manager. In \"WAR or directory URL:\" I \nput \"file:/apps/servlet/targets/test/MyApp.war\" and click Deploy\n\n2. The war file onthe server is untouched by tomcat and a copy is not placed in \nwebapps. Tomcat does create \"myapp.xml\" in conf/Catalina/localhost but the \nparameters are lost:\n<?xml version='1.0' encoding='utf-8'?>\n<Context docBase=\"/apps/servlet/targets/test/MyApp.war\" path=\"/myapp\">\n</Context>\n\n3. I go to the test JSP page and I get\n  Context param: myparam = My test parameter \nIt worked because the parameters were used, just not copied through to \nconf/Catalina/localhost/myapp.xml\n\n4. If I stop teh server and restart it, it obviously uses the new myapp.xml, \nfails to find the parameter and the JSP page returns:\n  Context param: myparam = null \n\nI also tried this on Tomat 5.5.7 but got entirely different (and more \nconfusing) results\n\n1. Use the HTML manager. In \"WAR or directory URL:\" I \nput \"file:/apps/servlet/targets/test/MyApp.war\" and click Deploy\nThis fails with \"Invalid context path\". I get around this by adding /myapp to \nthe web form in \"Context Path\". Why do I need to do this? It says this is \noptional and I wanted Tomcat to get the path out of the context file in the war.\n\n2. This time Tomcat creates a copy of MyApp.war in the webapps directory as \nmyapp.war and correctly copies the context.xml file to \nconf/Catalina/localhost/myapp.xml\n\n\nSo, \n  Tomcat 5.0.28 appears to have a bug\n  Tomcat 5.5.7 does not appear to operate as I expected\n", "id": 71511, "time": "2005-02-25T12:27:50Z", "bug_id": 31276, "creation_time": "2005-02-25T12:27:50Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "peter.edwards@astrazeneca.com", "attachment_id": 14359, "is_private": false, "id": 71512, "time": "2005-02-25T12:29:02Z", "bug_id": 31276, "creation_time": "2005-02-25T12:29:02Z", "text": "Created attachment 14359\nThe war file I was testing Tomcat with"}, {"count": 5, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "Tomcat 5.5.7 will never get the context path from your context file. I recommend\nyou get used to it, because this will not be changed.", "id": 71514, "time": "2005-02-25T13:02:05Z", "bug_id": 31276, "creation_time": "2005-02-25T13:02:05Z", "is_private": false}, {"count": 6, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "text": "If you feel like posting a patch for 5.0.30, that's great.  Evidently, no one \nelse feels like working on it.  For 5.5.x, see Remy's remarks.", "id": 72170, "time": "2005-03-11T04:08:09Z", "bug_id": 31276, "creation_time": "2005-03-11T04:08:09Z", "is_private": false}]
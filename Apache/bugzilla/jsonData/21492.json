[{"count": 0, "attachment_id": null, "bug_id": 21492, "is_private": false, "id": 40429, "time": "2003-07-11T09:01:31Z", "creator": "sebastien.gautrias@laposte.net", "creation_time": "2003-07-11T09:01:31Z", "tags": [], "text": "Overview Description :\n\nSome css size are not good into httpd cache disk.\n\nHere my cache configuration :\n\n<IfModule mod_cache.c>\n\t<IfModule mod_disk_cache.c>\n\t\tCacheRoot /cacheproxy/CR844-Production-SSL\n\t\tCacheSize 100000\n\t\tCacheEnable disk /\n\t\tCacheDirLevels 1\n\t\tCacheDirLength 2\n\t\tCacheMaxExpire 86400\n\t\tCacheDefaultExpire 7200\n\t\tCacheForceCompletion 100\n\t</IfModule>\n</IfModule>\n\nAnd the results of my observations (we have 5 urls for the same file, because we\nuse dispatching into url) :\n\nNormal size : 43648 bytes (43648 Jul 10 18:39 feuille.css)\n\nInto the Httpd cache disk (bytes) : The header Content-Length is always : 43648\nInto the disk (size in bytes) : (we have only write the affinity)\n- /g1/ssl/css/feuille.css --> \t25716 ===> KO\n- /g1_k/ssl/css/feuille.css -->\t43648 ===> OK\n- /g1_l/ssl/css/feuille.css -->\t43648 ===> OK\n- /g1_m/ssl/css/feuille.css -->\t28476 ===> KO\n- /g1_n/ssl/css/feuille.css -->\t43648 ===> OK\n\n\nSteps to Reproduce: This problem is not reproducible.\n\nActual Results: The navigator show some page with css file not complete ==> Bad\nposting\n\nExpected Results: Good file size into disk cache\n\nBuild Date & Platform: Apache 2.0.46 build on AIX 5.1 FP3, H70 server 64 bits,\ncompiled with gcc 3.2.3, Apache 32 bits\n\nAdditional Builds and Platforms: Apache 2.0.45 on AIX 5.2, p610 server 64 bits,\ncompiled with XLC  6.0.0.5, Apache 64 bits"}, {"count": 1, "attachment_id": 7239, "bug_id": 21492, "text": "Created attachment 7239\n.header and .data files", "id": 40430, "time": "2003-07-11T09:02:35Z", "creator": "sebastien.gautrias@laposte.net", "creation_time": "2003-07-11T09:02:35Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "ruediger.pluem@vodafone.com", "text": "I guess my problem is the same. I use mod_disk_cache to cache static files\ndelivered by Tomcat via\nmod_jk. Unfortunately you did not write if you are caching local files or remote\nfiles (delivered\nby mod_jk, mod_proxy or something similar).\n\nI noticed that when you abort the download of a file which should be cached and\nwhos origin is\non a remote server, the partly downloaded file gets cached.\nThe second request for this file only delivers the partly cached file and thus\nleads to the problems\ndescribed by you. In my case the problem showed up by incomplete jpg pictures.\n\nThe reason for this behaviour can be found in mod_disk_cache. mod_disk_cache\ndoes not notice\nthat a request has been aborted. I wrote a small patch (against 2.0.50) that\ndrops the partly cached file\nif the connection has been aborted. \nUnfortunately the CacheForceCompletion of mod_cache is not implemented right now\nsuch that nearly\ncompletely downloaded files get lost for the cache. But this is better than\ndelivering only\nparts of the files in the following requests.", "id": 62379, "attachment_id": null, "bug_id": 21492, "creation_time": "2004-08-24T08:53:48Z", "time": "2004-08-24T08:53:48Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 21492, "is_private": false, "text": "Created attachment 12516\nProposed Patch", "id": 62380, "time": "2004-08-24T08:54:48Z", "creator": "ruediger.pluem@vodafone.com", "creation_time": "2004-08-24T08:54:48Z", "attachment_id": 12516}, {"count": 4, "tags": [], "bug_id": 21492, "attachment_id": null, "id": 63827, "time": "2004-09-19T20:03:51Z", "creator": "chip@force-elite.com", "creation_time": "2004-09-19T20:03:51Z", "is_private": false, "text": "Can you please test this in 2.0.51?\n\nLots of fixes for mod_disk_cache were made."}, {"count": 5, "attachment_id": null, "bug_id": 21492, "is_private": false, "id": 64104, "time": "2004-09-23T11:18:00Z", "creator": "ruediger.pluem@vodafone.com", "creation_time": "2004-09-23T11:18:00Z", "tags": [], "text": "I checked this with 2.0.51 and it is only partially fixed. It should work with\nlocal files, but it does not work if\nthe length of the content to be cached is unknown and the file is large as it is\nthe case if you cache large dynamic\ncontent originally created by Tomcat. And this is what I am doing. I try to\nlower the load on the Tomcats by caching\nlarge files generated by Tomcat that are valid for some time via mod_cache on\nthe webserver.\n\n\nThe problem is that in this case we get to line 663 of mod_disk_cache.c as the\ncondition in line 661 is true in\nany case (content written completely to file or only partially because the\nconnection has been aborted).\nSo this operation is handled as successful caching of the request in any case\neven if the content was only\nsaved partially.\n\n\nNevertheless the changes to mod_disk_cache provide an better environment now for\nthe needed changes so I provide\nan updated version of my patch for 2.0.51."}, {"count": 6, "tags": [], "creator": "ruediger.pluem@vodafone.com", "text": "Created attachment 12847\nPatch for 2.0.51", "id": 64105, "time": "2004-09-23T11:18:36Z", "bug_id": 21492, "creation_time": "2004-09-23T11:18:36Z", "is_private": false, "attachment_id": 12847}, {"count": 7, "tags": [], "bug_id": 21492, "attachment_id": null, "id": 64334, "time": "2004-09-28T17:41:49Z", "creator": "jerenkrantz@apache.org", "creation_time": "2004-09-28T17:41:49Z", "is_private": false, "text": "A variant of the 'patch for 2.0.51' has been committed to HEAD as\nmodules/experimental/mod_disk_cache.c rev 1.64.\n\nThanks!"}, {"count": 8, "tags": [], "bug_id": 21492, "attachment_id": null, "id": 65078, "time": "2004-10-13T16:43:15Z", "creator": "minfrin@apache.org", "creation_time": "2004-10-13T16:43:15Z", "is_private": false, "text": "Backported to v2.0.53.\n"}]
[{"count": 0, "tags": [], "bug_id": 12946, "attachment_id": null, "id": 23289, "time": "2002-09-24T09:13:11Z", "creator": "r.apel@deutschepost.de", "creation_time": "2002-09-24T09:13:11Z", "is_private": false, "text": "Despite jk2.properties contains line\n\nserverRoot=/usr/local/apache2\n\ncatalina.out shows (at startup):\n\n[Tue Sep 24 09:42:14 2002] (error ) [jk_config_file.c (261)]  config.update(): \nCan't find config file ${serverRoot}/conf/workers2.properties\n[Tue Sep 24 09:42:14 2002] ( info ) [jk_config.c (246)]  config.setAttribute() \nError setting config: file ${serverRoot}/conf/workers2.properties\n[Tue Sep 24 09:42:14 2002] ( info ) [jk_workerEnv.c (403)]  workerEnv.init() ok \n${serverRoot}/conf/workers2.properties\n\nWorkaround as follows:\n\nSet \n\n$ serverRoot=/usr/local/apache2; export serverRoot\n\nin the Unix environment before startup.sh"}, {"count": 1, "tags": [], "creator": "cmanolache@yahoo.com", "attachment_id": null, "text": "I'm confused: the output is from the native side jk, which is configured using\nworkers2.properties. Are you using in-process jk ? Can you give more info\nabout the env and a full log file ?", "id": 23773, "time": "2002-10-02T20:15:18Z", "bug_id": 12946, "creation_time": "2002-10-02T20:15:18Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 12946, "text": "Right!\nAs I now notice, there is no \"serverRoot\" parameter mentioned in Jakarta's JK2-\nDocumentation.\n\nEven so: How does the native side JK get to know about the location of \nworkers2.properties ?? Appearently the value of \"serverRoot\", as stated in \n$CATALINA_HOME/conf/jk2.properties or elsewhere, must be read in order for the \nnative JK to take knowledge of the location of workers2.properties and be able \nto process it.\n\nAt the time I submitted this report, $CATALINA_HOME/conf/jk2.properties was one \nI took from Simon Steward's web site \nhttp://www.pubbitch.org/jboss/mod_jk2.html, having only modified \n$CATALINA_HOME. Locations were correct\n\n#---- jk2.properties\n\t\n\t# list of needed handlers.\n\thandler.list=apr,channelSocket,channelUnix,request\n\t\n\t# Set the default port for the channelSocket\n\tchannelSocket.port=8009\n\t\n\t# State where the UNIX domain socket is located\n\tchannelUnix.file=/opt/jakarta-tomcat-4.1.10/work/jk2.socket\n\t\n\t# Dynamic library\n\tserverRoot=/usr/local/apache2\n\tapr.NativeSo=/opt/jakarta-tomcat-4.1.10/lib/libjkjni.so\n\n#---- end of jk2.properties\n      \nBy the time, $APACHE_HOME/conf/workers2.properties also was one I took from the \nsame JBoss web site, having only modified $CATALINA_HOME. Locations were correct\n\n#---- workers2.properties\n\t\n\t# Shared memory handling. Needs to be set.\n\t[shm]\n\tfile=/usr/local/apache2/logs/shm.file\n\tsize=1048576\n\t\n\t# Example socket channel, explicitly set port and host.\n\t[channel.socket:localhost:8009]\n\tport=8009\n\thost=127.0.0.1\n\t\n\t# Example UNIX domain socket\n\t[channel.un:/usr/local/tomcat/work/jk2.socket]\n\ttomcatId=localhost:8009\n\tdebug=0\n\t\n\t# define the worker\n\t[ajp13:localhost:8009]\n\tchannel=channel.un:/usr/local/tomcat/work/jk2.socket\n\t# To use the TCP/IP socket instead, just comment out the above\n\t# line, and uncomment the one below\n\t#channel=channel.socket:localhost:8009\n\t\n\t# Announce a \"status\" worker\n\t[status:status]\n\t\n\t# Uri mapping\n\t[uri:/examples/*]\n\t#worker=ajp13:localhost:8009\n\tworker=ajp13:/usr/local/tomcat/work/jk2.socket\n\t\n\t[uri:/status/*]\n\tworker=status:status\n\t\n#---- end of workers2.properties\n\nBefore exporting  \"serverRoot=/usr/local/apache2\", thee startup messages in \n$CATALINA_HOME/logs/catalina.out were like\n\n\n[INFO] Registry - -Loading registry information\n[INFO] Registry - -Creating new Registry instance\n[INFO] Registry - -Creating MBeanServer\n[INFO] Http11Protocol - -Initializing Coyote HTTP/1.1 on port 8080\nStarting service Tomcat-Standalone\nApache Tomcat/4.1.10\n[INFO] Http11Protocol - -Starting Coyote HTTP/1.1 on port 8080\n[Fri Oct 04 09:51:29 2002] (error ) [jk_config_file.c (261)]  config.update(): \nCan't find config file ${serverRoot}/conf/workers2.properties\n[Fri Oct 04 09:51:29 2002] ( info ) [jk_config.c (246)]  config.setAttribute() \nError setting config: file ${serverRoot}/conf/workers2.properties\n[Fri Oct 04 09:51:29 2002] (error ) [jk_logger_file.c (171)]  Initializing log \nfile stderr\n[Fri Oct 04 09:51:29 2002] (error ) [jk_shm.c (333)]  shm.init(): No file\n[Fri Oct 04 09:51:29 2002] ( info ) [jk_workerEnv.c (403)]  workerEnv.init() ok \n${serverRoot}/conf/workers2.properties\n[INFO] ChannelSocket - -JK2: ajp13 listening on tcp port 8009\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.socket\n[INFO] JkMain - -Jk running ID=0 time=1/87  config=/opt/jakarta-tomcat-\n4.1.10/conf/jk2.properties\n[INFO] ChannelSocket - -Port busy 8009 java.net.BindException: Address already \nin use\n[INFO] ChannelSocket - -JK2: ajp13 listening on tcp port 8010\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.socket1\n[INFO] JkMain - -Jk running ID=1 time=1/18  config=/opt/jakarta-tomcat-\n4.1.10/conf/jk2.properties\n[Fri Oct 04 09:51:29 2002] ( info ) [jk_jni_aprImpl.c (470)]  jkInvoke() invoke \nf30d4c38 \n[Fri Oct 04 09:51:29 2002] ( info ) [jk_jni_aprImpl.c (470)]  jkInvoke() invoke \nf30d4c38 \n\n\nAFTER putting\n\nserverRoot=/usr/local/apache2\nexport serverRoot\n\nat the top of $CATALINA_HOME/bin/startup.sh\n\nthe startup messages turned to\n\n[INFO] Registry - -Loading registry information\n[INFO] Registry - -Creating new Registry instance\n[INFO] Registry - -Creating MBeanServer\n[INFO] Http11Protocol - -Initializing Coyote HTTP/1.1 on port 8080\nStarting service Tomcat-Standalone\nApache Tomcat/4.1.10\n[INFO] Http11Protocol - -Starting Coyote HTTP/1.1 on port 8080\n[Fri Oct 04 09:55:24 2002] ( info ) [jk_config_file.c (302)]  cfg.update() \nUpdating config /usr/local/apache2/conf/workers2.properties 1548561606 \n1033717825\n[Fri Oct 04 09:55:24 2002] ( info ) [jk_config_file.c (313)]  config.setConfig\n():  Reading properties /usr/local/apache2/conf/workers2.properties 7\n[Fri Oct 04 09:55:24 2002] (error ) [jk_logger_file.c (171)]  Initializing log \nfile stderr\n[Fri Oct 04 09:55:24 2002] ( info ) [jk_workerEnv.c (403)]  workerEnv.init() \nok /usr/local/apache2/conf/workers2.properties\n[INFO] ChannelSocket - -JK2: ajp13 listening on tcp port 8009\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.socket\n[INFO] JkMain - -Jk running ID=0 time=2/84  config=/opt/jakarta-tomcat-\n4.1.10/conf/jk2.properties\n[INFO] ChannelSocket - -Port busy 8009 java.net.BindException: Address already \nin use\n[INFO] ChannelSocket - -JK2: ajp13 listening on tcp port 8010\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.socket1\n[INFO] JkMain - -Jk running ID=1 time=0/22  config=/opt/jakarta-tomcat-\n4.1.10/conf/jk2.properties\n\n\nIn fact, I am now running with the following properties AND serverRoot set in \nthe Unix Environment:\n\n#---- jk2.properties\n\t\n      class.channelUnix2=org.apache.jk.common.ChannelUn\n      # List of needed handlers\n      handler.list=apr,channelUnix,channelUnix2,request\n \n      # State where the Unix domain socket is located\n      channelUnix.file=/opt/jakarta-tomcat-4.1.10/work/jk2.socket\n      channelUnix2.file=/opt/jakarta-tomcat-4.1.10/work/jk2.secure\n \n      # Dynamic library\n      serverRoot=/usr/local/apache2\n      apr.NativeSo=/opt/jakarta-tomcat-4.1.10/lib/libjkjni.so\n\n#---- end of jk2.properties\n\n#---- workers2.properties\n\n      # Shared memory handling. Needs to be set.\n      [shm]\n      file=/usr/local/apache2/logs/shm.file\n      size=1048576\n \n      # UNIX domain socket for http schema\n      [channel.un:/opt/jakarta-tomcat-4.1.10/work/jk2.socket]\n      tomcatId=localhost:8009\n      debug=0\n \n      # UNIX domain socket for https schema\n      [channel.un:/opt/jakarta-tomcat-4.1.10/work/jk2.secure]\n      tomcatId=localhost:8099\n      debug=0\n \n      # define the worker\n      [ajp13:localhost:8009]\n      channel=channel.un:/opt/jakarta-tomcat-4.1.10/work/jk2.socket\n \n      # define the worker\n      [ajp13:localhost:8099]\n      channel=channel.un:/opt/jakarta-tomcat-4.1.10/work/jk2.secure\n \n      # Announce a \"status\" worker\n      [status:status]\n \n      # Uri mapping\n      [uri:/examples/*]\n      worker=ajp13:/opt/jakarta-tomcat-4.1.10/work/jk2.socket\n \n      [uri:/status/*]\n      worker=status:status\n \n      [uri:/*.jsp]\n      worker=ajp13:/opt/jakarta-tomcat-4.1.10/work/jk2.socket\n\n      .......\n\n#---- end of workers2.properties\n\nWITH serverRoot=/usr/local/apache2 SET as \n\"export serverRoot=/usr/local/apache2\" the startup messages are like\n\n[INFO] Registry - -Loading registry information\n[INFO] Registry - -Creating new Registry instance\n[INFO] Registry - -Creating MBeanServer\n[INFO] Http11Protocol - -Initializing Coyote HTTP/1.1 on port 8080\nStarting service Tomcat-Standalone\nApache Tomcat/4.1.10\n[INFO] Http11Protocol - -Starting Coyote HTTP/1.1 on port 8080\n[Fri Oct 04 10:09:16 2002] ( info ) [jk_config_file.c (302)]  cfg.update() \nUpdating config /usr/local/apache2/conf/workers2.properties 4 1033718307\n[Fri Oct 04 10:09:16 2002] ( info ) [jk_config_file.c (313)]  config.setConfig\n():  Reading properties /usr/local/apache2/conf/workers2.properties 13\n[Fri Oct 04 10:09:16 2002] (error ) [jk_logger_file.c (171)]  Initializing log \nfile stderr\n[Fri Oct 04 10:09:16 2002] (error ) [jk_worker_ajp13.c (712)]  ajp13.init(): No \nchannel localhost:8009\n[Fri Oct 04 10:09:16 2002] (error ) [jk_workerEnv.c (193)]  \nworkerEnv.initWorkers() init failed for ajp13:localhost:8009\n[Fri Oct 04 10:09:16 2002] (error ) [jk_worker_ajp13.c (712)]  ajp13.init(): No \nchannel localhost:8099\n[Fri Oct 04 10:09:16 2002] (error ) [jk_workerEnv.c (193)]  \nworkerEnv.initWorkers() init failed for ajp13:localhost:8099\n[Fri Oct 04 10:09:16 2002] ( info ) [jk_workerEnv.c (403)]  workerEnv.init() \nok /usr/local/apache2/conf/workers2.properties\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.socket\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.secure\n[INFO] JkMain - -Jk running ID=0 time=5/102  config=/opt/jakarta-tomcat-\n4.1.10/conf/jk2.properties\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.socket\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.secure\n[INFO] JkMain - -Jk running ID=0 time=1/25  config=/opt/jakarta-tomcat-\n4.1.10/conf/jk2.properties\n\n\nWITHOUT SETTING serverRoot in the environment, the startup messages from \ncatalina.out are\n\n[INFO] Registry - -Loading registry information\n[INFO] Registry - -Creating new Registry instance\n[INFO] Registry - -Creating MBeanServer\n[INFO] Http11Protocol - -Initializing Coyote HTTP/1.1 on port 8080\nStarting service Tomcat-Standalone\nApache Tomcat/4.1.10\n[INFO] Http11Protocol - -Starting Coyote HTTP/1.1 on port 8080\n[Fri Oct 04 10:11:24 2002] (error ) [jk_config_file.c (261)]  config.update(): \nCan't find config file ${serverRoot}/conf/workers2.properties\n[Fri Oct 04 10:11:24 2002] ( info ) [jk_config.c (246)]  config.setAttribute() \nError setting config: file ${serverRoot}/conf/workers2.properties\n[Fri Oct 04 10:11:24 2002] (error ) [jk_logger_file.c (171)]  Initializing log \nfile stderr\n[Fri Oct 04 10:11:24 2002] (error ) [jk_shm.c (333)]  shm.init(): No file\n[Fri Oct 04 10:11:24 2002] ( info ) [jk_workerEnv.c (403)]  workerEnv.init() ok \n${serverRoot}/conf/workers2.properties\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.socket\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.secure\n[INFO] JkMain - -Jk running ID=0 time=2/83  config=/opt/jakarta-tomcat-\n4.1.10/conf/jk2.properties\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.socket\n[INFO] ChannelUn - -JK: listening on unix socket: /opt/jakarta-tomcat-\n4.1.10/work/jk2.secure\n[INFO] JkMain - -Jk running ID=0 time=1/30  config=/opt/jakarta-tomcat-\n4.1.10/conf/jk2.properties\n\n\n", "id": 23891, "time": "2002-10-04T08:15:54Z", "creator": "r.apel@deutschepost.de", "creation_time": "2002-10-04T08:15:54Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 12946, "text": "Encountered the same problem with a basic installation of Tomcat 5.0.16 and \nApache 2.0.46 on RH Enterprise Linux 3.0. Setting serverRoot as an environment \nvariable worked, but it sure doesn't seem like it's being read from \njk2.properties...\n\nHave you guys made any progress on this? We can provide additional info about \nour setup if needed.\n\nThanks and happy hunting...\n\n-David Norris <d-norris@cecer.army.mil>", "id": 49116, "time": "2003-12-15T04:54:14Z", "creator": "d-norris@cecer.army.mil", "creation_time": "2003-12-15T04:54:14Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "markt@apache.org", "text": "As of November 15, 2004, JK2 is no longer supported. All bugs related to JK2 \nwill be marked as WONTFIX. In its place, some of its features have been \nbackported to jk1. Most of those features will be seen in 1.2.7, which is \nslated for release on November 30th, 2004.\n\nAnother alternative is the ajp addition to mod_proxy which will be part of \napache 2.\n\nFor more information on the Tomat connectors docs at\nhttp://jakarta.apache.org/tomcat/connectors-doc/\n", "id": 68832, "time": "2004-12-22T21:20:05Z", "bug_id": 12946, "creation_time": "2004-12-22T21:20:05Z", "tags": [], "is_private": false}]
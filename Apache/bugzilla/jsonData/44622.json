[{"count": 0, "tags": [], "creator": "nickh@reactrix.com", "attachment_id": null, "text": "I have an Apache server that uses mod_rewrite to proxy incoming requests to one of several backend HTTP servers based on incoming request headers.  Most requests work correctly but one particular multipart/form-data POST always fails if the vhost accepting the request is using SSL.  One of the requests that works fine is another multipart/form-data POST formatted in a very similar way.\n\nI have reproduced the error using Apache 2.2.3 from CentOS 5.1 (RPM version httpd-2.2.3-11.el5.centos) and with a fresh RPM build from the current 2.2.8 source.\n\nThe server configuration contains the following (some server and log paths changed):\n\nListen 30100\n<VirtualHost _default_:30100>\n    ServerName server.reactrix.com\n    ErrorLog /path/to/logs/apache-error_log\n    CustomLog /path/to/logs/apache-access_log reactrix\n \n    SSLEngine on\n    SSLVerifyClient require\n    SSLVerifyDepth 10\n    SSLCertificateFile /path/to/ssl/server.crt\n    SSLCertificateKeyFile /path/to/ssl/server.key\n    SSLCACertificatePath /path/to/ssl/\n \n    RewriteEngine on\n    RewriteOptions inherit\n\n    <Directory /path/to/git/>\n        Options -indexes\n        order allow,deny\n        allow from all\n    </Directory>\n</VirtualHost>\n\nListen 8100\n<VirtualHost _default_:8100>\n    ServerName server.reactrix.com\n    ErrorLog /path/to/logs/apache-error_log\n    CustomLog /path/to/logs/apache-access_log reactrix\n\n    RewriteEngine on\n    RewriteOptions inherit\n\n    <Directory /path/to/git/>\n        Options -indexes\n        order allow,deny\n        allow from all\n    </Directory>\n</VirtualHost>\n\nThe request I am trying to send (some headers removed) is:\n\nPOST http://server.reactrix.com/path/to/upload\nHost: server.reactrix.com\nContent-Length: 465\nContent-Type: multipart/form-data; boundary=xYzZY\n\n--xYzZY\nContent-Disposition: form-data; name=\"upload[handle]\"\n\nhandle\n--xYzZY\nContent-Disposition: form-data; name=\"upload[display_id]\"\n\n1\n--xYzZY\nContent-Disposition: form-data; name=\"upload[controller_id]\"\n\n1\n--xYzZY\nContent-Disposition: form-data; name=\"upload[file]\"; filename=\"/tmp/file.png\"\nContent-Type: application/gzip\n\n\u00eb\n\u0081\u00bcC\u00e7\u00e5\u0092\u00e2b``\u00e0\u00f5\u00f4p  b``\u0094\u00b2\u00efp \u0086\u00be\u00d7\u00dd\u0080T\u00b0\u00a7\u008bcH\u00c5\u00ad\u00b7\n   \u00be\u00fa\u00e7\u00f2\u00f2/` 4\u00a43\u007f\u00aca`\u00ecO\u00f5X  \u00e2z\u00ba\u00fa\u00b9\u00acsJh\\\u00b3\u00fbu\u008c\n--xYzZY--\n\nWhen I send the above request to the SSL listener on port 30100, I get the following response (some headers removed):\n\nHTTP/1.1 404 Not Found\nConnection: close\nDate: Tue, 18 Mar 2008 00:21:42 GMT\nVia: 1.1 127.0.0.1:30100\nContent-Length: 0\nContent-Type: text/plain\nClient-Date: Tue, 18 Mar 2008 00:21:15 GMT\nClient-Response-Num: 1\n\nWhen I send the same request to the listener on port 8100, I get the following response (some headers removed):\n\nHTTP/1.1 200 OK\nCache-Control: no-cache\nConnection: close\nDate: Tue, 18 Mar 2008 00:24:59 GMT\nVia: 1.1 127.0.0.1:8100\nServer: Mongrel 1.1.2\nContent-Length: 16\nContent-Type: text/html\nClient-Date: Tue, 18 Mar 2008 00:24:32 GMT\nClient-Response-Num: 1\nSet-Cookie: _session_id=3368cec4d8f4f2c3f7f8e1ecc63dc86a; path=/\nStatus: 200 OK\n\nUpload succeeded", "id": 114694, "time": "2008-03-17T18:12:10Z", "bug_id": 44622, "creation_time": "2008-03-17T18:12:10Z", "is_private": false}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "text": "1. Please set the loglevel to debug and post the snippets of the error_log here (from both virtual hosts, plus the global one).\n2. Have you tried if it works when you remove the authentication via client certificates in the SSL virtual host?", "id": 114696, "time": "2008-03-18T00:59:54Z", "bug_id": 44622, "creation_time": "2008-03-18T00:59:54Z", "is_private": false}]
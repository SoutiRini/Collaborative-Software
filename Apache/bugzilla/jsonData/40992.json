[{"count": 0, "tags": [], "bug_id": 40992, "attachment_id": null, "id": 95925, "time": "2006-11-17T06:54:26Z", "creator": "seva_ostapenko@hotmail.com", "creation_time": "2006-11-17T06:54:26Z", "is_private": false, "text": "Environment variables are case insensitive on Windows, but ANT ignores that \nfact.\nIf an environment variable is already defined on the system, ENV property of \nthe EXEC tag fails to modify it, if name case does not match.\n\nFor example, nls_lang variable is defined at the system level as \namerican_america.we8mswin1252.\nTo perform correct export of data from Oracle, it needs to be set to \namerican_america.al32utf8.\n<exec executable=\"exp.exe\" failonerror=\"true\">\n  <env key=\"NLS_LANG\" value=\"american_america.al32utf8\"/>\n  <arg line=\"scott/tiger file=scott-exp.dmp\"/>\n</exec>\nThe above task would fail to change the NLS_LANG variable (because nls_lang \nvariable is already defined) and exported data won't be valid (loss of \nlocalized data and questionable statistics).\n\nIf ENV parameter is specified as\n  <env key=\"nls_lang\" value=\"american_america.al32utf8\"/>\nthe variable in question will be properly matched and overwritten.\n\nUnfortunately, there are 128 (2^7) possible ways how the \"NLS_LANG\" variable \ncan be defined on Windows and it's not realistic to \"use the right case\".\n\nWhile running on Windows, ANT should defaults to the Windows behavior, or al \nleast provide an extra attribute (something like casesensitivity=\n{\"true\"|false\"}) to allow case insensitive environment variable match."}, {"count": 1, "tags": [], "bug_id": 40992, "text": "\nThis may seem a silly question, but where in the Win32 API does it say that env\nvariables are case insenstive.\n\nIt isnt in 'environement variables':\nhttp://msdn2.microsoft.com/en-us/library/ms682653.aspx\n\nit isnt in ::SetEnvironmentVariable\nhttp://msdn2.microsoft.com/en-us/library/ms686206.aspx\n\nand it isnt in ::GetEnvironmentVariable \nhttp://msdn2.microsoft.com/en-us/library/ms683188.aspx\n\nNow, I can see that echo %PATH% is doing a case insensitive lookup, but unless\nsome can show that ::SetEnvironmentVariable and ::GetEnvironmentVariable does\ncase sensitive matching, we are left in a bit of a mess. We cannot be sure that\nthe whole of windows is doing case insensitive matching.\n\nWhy not set newenvironment=true in <exec> and have the old settings lost. You\nneed to set up everything (including maybe PATH), but you wont get hurt by any\nexisting values?", "id": 95926, "time": "2006-11-17T07:13:43Z", "creator": "stevel@apache.org", "creation_time": "2006-11-17T07:13:43Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 40992, "text": "Actually, this is probably a dupe of bug 28874, which is fixed since Ant\n1.7.0B2; can we confirm?", "id": 95929, "time": "2006-11-17T07:31:01Z", "creator": "mbenson@apache.org", "creation_time": "2006-11-17T07:31:01Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 40992, "attachment_id": null, "id": 95930, "time": "2006-11-17T07:37:14Z", "creator": "mbenson@apache.org", "creation_time": "2006-11-17T07:37:14Z", "is_private": false, "text": "(In reply to comment #1)\n> This may seem a silly question, but where in the Win32 API does it say that env\n> variables are case insenstive.\n> \n> It isnt in 'environement variables':\n> http://msdn2.microsoft.com/en-us/library/ms682653.aspx\n> \n> it isnt in ::SetEnvironmentVariable\n> http://msdn2.microsoft.com/en-us/library/ms686206.aspx\n> \n> and it isnt in ::GetEnvironmentVariable \n> http://msdn2.microsoft.com/en-us/library/ms683188.aspx\n> \n\nGoogling for: windows \"environment variable\" \"case sensitive\" yielded:\n\nhttp://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/ntcmds_shelloverview.mspx?mfr=true"}, {"count": 4, "tags": [], "creator": "seva_ostapenko@hotmail.com", "attachment_id": null, "text": "(In reply to comment #3)\nYes, it looks like Win32 API does not provide \"case insensitive\" option for ::\n(Set|Get)EnvironmentVariable() methods.\nYet, the shell and applications treat environment variables as case insensitive.\nWhich can be relatively easy achived by calling ::GetEnvironmentStrings() first \nand then iterating through the array of strings doing case insensitive \nsubstring match of the \"variable_name\"+\"=\".\nI suppose converting the output from ::GetEnvironmentStrings() into a hash \ntable ith an upper- or lower-case key is another option.\n\n> (In reply to comment #1)\n> > This may seem a silly question, but where in the Win32 API does it say that \nenv\n> > variables are case insenstive.\n> > \n> > It isnt in 'environement variables':\n> > http://msdn2.microsoft.com/en-us/library/ms682653.aspx\n> > \n> > it isnt in ::SetEnvironmentVariable\n> > http://msdn2.microsoft.com/en-us/library/ms686206.aspx\n> > \n> > and it isnt in ::GetEnvironmentVariable \n> > http://msdn2.microsoft.com/en-us/library/ms683188.aspx\n> > \n> Googling for: windows \"environment variable\" \"case sensitive\" yielded:\n> http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-\nus/ntcmds_shelloverview.mspx?mfr=true\n\n(In reply to comment #1)\n> This may seem a silly question, but where in the Win32 API does it say that \nenv\n> variables are case insenstive.\n> It isnt in 'environement variables':\n> http://msdn2.microsoft.com/en-us/library/ms682653.aspx\n> it isnt in ::SetEnvironmentVariable\n> http://msdn2.microsoft.com/en-us/library/ms686206.aspx\n> and it isnt in ::GetEnvironmentVariable \n> http://msdn2.microsoft.com/en-us/library/ms683188.aspx\n> Now, I can see that echo %PATH% is doing a case insensitive lookup, but unless\n> some can show that ::SetEnvironmentVariable and ::GetEnvironmentVariable does\n> case sensitive matching, we are left in a bit of a mess. We cannot be sure \nthat\n> the whole of windows is doing case insensitive matching.\n> Why not set newenvironment=true in <exec> and have the old settings lost. You\n> need to set up everything (including maybe PATH), but you wont get hurt by any\n> existing values?\n\n", "id": 95931, "time": "2006-11-17T07:48:01Z", "bug_id": 40992, "creation_time": "2006-11-17T07:48:01Z", "is_private": false}, {"count": 5, "tags": [], "creator": "mbenson@apache.org", "attachment_id": null, "text": "Great.  Still, this sounds like a duplicate of the bug I mentioned.  So you\nshould try the 1.7.0 release candidate to verify.", "id": 95932, "time": "2006-11-17T07:53:14Z", "bug_id": 40992, "creation_time": "2006-11-17T07:53:14Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 40992, "text": "(In reply to comment #5)\n> Great.  Still, this sounds like a duplicate of the bug I mentioned.  So you\n> should try the 1.7.0 release candidate to verify.\n\nYep, it looks like it's fixed in 1.7 RC1. So, it's a dupe of 28874 (in a way).\nIs there a change to have this backported to 1.6.5+? \nSwitching developers and testers from one ANT version to another is a no \novernight task. And 1.7.0 is not even released yet.", "id": 95934, "time": "2006-11-17T08:12:22Z", "creator": "seva_ostapenko@hotmail.com", "creation_time": "2006-11-17T08:12:22Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "text": "(In reply to comment #6)\n> (In reply to comment #5)\n> > Great.  Still, this sounds like a duplicate of the bug I mentioned.  So you\n> > should try the 1.7.0 release candidate to verify.\n> \n> Yep, it looks like it's fixed in 1.7 RC1. So, it's a dupe of 28874 (in a way).\n> Is there a change to have this backported to 1.6.5+? \n> Switching developers and testers from one ANT version to another is a no \n> overnight task. And 1.7.0 is not even released yet.\n\nIt's a duplicate \"in a way?\"  What way would that be?  As for backporting the\nfix, we don't generally do that.  A backport would amount to a revision, which\nwould bump a version number, yielding 1.6.6.  With 1.7.0 in the final stages of\nwhat has been a very long development and release process, such a 1.6.6 release\nwould probably take longer than waiting for 1.7.0 and delay 1.7.0 as well. \nSorry for the bad news.\n\n\n*** This bug has been marked as a duplicate of 28874 ***", "attachment_id": null, "id": 95935, "creator": "mbenson@apache.org", "time": "2006-11-17T08:18:16Z", "bug_id": 40992, "creation_time": "2006-11-17T08:18:16Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 40992, "text": "You are of course free to backport the changes yourself, if you think that will\nreduce the cost to your project. Just find the SVN commit that fixed the bug,\napply it to a local copy of the 1.6.5 branch, rebuild and retest. You do have to\nrecognise that this is now a less-supported release, and unless you have all the\ndependencies, bits of ant will be missing.\n\nI'd recommend trying the upgrade, as now is the best time for regressions. You\ncan use the workaround I suggested too, namely 'dont inherit the environment'", "id": 95937, "time": "2006-11-17T08:51:55Z", "creator": "stevel@apache.org", "creation_time": "2006-11-17T08:51:55Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "ddevienne@gmail.com", "attachment_id": null, "text": "FWIW, Peter and myself discussed this a few weeks ago, and I believe we came up\nto the conclusion that some case insensitive handling *was* necessary on\nwindows, especially when trying to augment Path (or PATH, or path). The case\nmatters if you have mixed case (yes, it does happen. Some users will use PATH\ninstead of Path, and the build file uses the other kind). --DD", "id": 95938, "time": "2006-11-17T08:56:19Z", "bug_id": 40992, "creation_time": "2006-11-17T08:56:19Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 40992, "attachment_id": null, "id": 95945, "time": "2006-11-17T10:54:43Z", "creator": "seva_ostapenko@hotmail.com", "creation_time": "2006-11-17T10:54:43Z", "is_private": false, "text": "(In reply to comment #7)\n[...]\n> It's a duplicate \"in a way?\"  What way would that be?  As for backporting the\n> fix, we don't generally do that.  A backport would amount to a revision, which\n> would bump a version number, yielding 1.6.6.  With 1.7.0 in the final stages \nof\n> what has been a very long development and release process, such a 1.6.6 \nrelease\n> would probably take longer than waiting for 1.7.0 and delay 1.7.0 as well. \n> Sorry for the bad news.\n> *** This bug has been marked as a duplicate of 28874 ***\n\nLike the same egg, end-user point of view, I guess?\nOn 1.6.6: point taken."}, {"count": 11, "tags": [], "text": "(In reply to comment #8)\n> You are of course free to backport the changes yourself, if you think that \nwill\n> reduce the cost to your project. Just find the SVN commit that fixed the bug,\n> apply it to a local copy of the 1.6.5 branch, rebuild and retest. You do have \nto\n> recognise that this is now a less-supported release, and unless you have all \nthe\n> dependencies, bits of ant will be missing.\n> I'd recommend trying the upgrade, as now is the best time for regressions. You\n> can use the workaround I suggested too, namely 'dont inherit the environment'\n\nThanks for the suggestion; might be a bit of overkill for a PL/SQL developer \nthough :)\nRe: newenvironment=true, it's catch 22. At time of the process fork, I know \nonly case insensitive names and values of the required evironment variables. \nBut the set of the required variables is only a sub-set the set of the \nsufficient variables. To find and set the rest of the values, I need to know \nthe exact variable names, 'cause the system treats the names as case \ninsensitive, while ANT does not. Alas, the proposed solution does not work.\n\nWorkaround in that case is to use external batch as a wrapper for ANT and clear \nvariables that are known to belong to the \"required set\".", "attachment_id": null, "id": 95946, "creator": "seva_ostapenko@hotmail.com", "time": "2006-11-17T11:10:09Z", "bug_id": 40992, "creation_time": "2006-11-17T11:10:09Z", "is_private": false}]
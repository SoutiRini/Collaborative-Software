[{"count": 0, "tags": [], "creator": "sullivan@mathcom.com", "attachment_id": null, "id": 3462, "time": "2001-07-06T15:16:35Z", "bug_id": 2485, "creation_time": "2001-07-06T15:16:35Z", "is_private": false, "text": "Hi, I'm using Xerces 1.4.1 on RedHat 7.1 on\na Pentium with JDK:\nJava(TM) 2 Runtime Environment,\nStandard Edition (build 1.4.0-beta-b65)\n\nWhen I attempt to use Schema validation I get\nparse error: java.lang.NullPointerException\njava.lang.NullPointerException\n\tat org.apache.xerces.framework.XMLParser.parse(XMLParser.java:1094)\n\tat org.apache.xerces.framework.XMLParser.parse(XMLParser.java:1122)\n\tat txmlapk.Txmld.<init>(Txmld.java:89)\n\tat txmlapk.Txmld.main(Txmld.java:38)\n\nMy java source and test files are below.\nHow can I get Schema validation running?\n\nMany thanks,\nSteve\n\n===== begin Txmld.java =====\n\nimport java.io.IOException;\nimport java.io.StringWriter;\nimport java.util.HashMap;\n\nimport org.apache.xerces.dom.TextImpl;\nimport org.apache.xerces.parsers.DOMParser;\n\nimport  org.apache.xml.serialize.OutputFormat;\nimport  org.apache.xml.serialize.Serializer;\nimport  org.apache.xml.serialize.SerializerFactory;\nimport  org.apache.xml.serialize.XMLSerializer;\n\nimport org.w3c.dom.Attr;\nimport org.w3c.dom.Document;\nimport org.w3c.dom.Element;\nimport org.w3c.dom.NamedNodeMap;\nimport org.w3c.dom.Node;\nimport org.w3c.dom.NodeList;\nimport org.xml.sax.ErrorHandler;\nimport org.xml.sax.InputSource;\nimport org.xml.sax.SAXParseException;\n\nimport vgenpk.Vgen;\nimport vgenpk.Vobject;\n\n\npublic class Txmld\nimplements ErrorHandler\n{\n\n\n\tpublic static void main(\n\t\tString[] args)\n\t{\n\t\tnew Txmld( args);\n\t}\n\n\n\n\tvoid badparms(\n\t\tString msg)\n\t{\n\t\tSystem.out.println(\"Error: \" + msg);\n\t\tSystem.out.println(\"args: filename\");\n\t\tSystem.exit( 1);\n\t}\n\n\n\n\tpublic Txmld(\n\t\tString[] args)\n\t{\n\t\tDocument doc = null;\n\t\tif (args.length != 1) badparms(\"wrong num parms\");\n\t\tString inuri = args[0];\n\n\t\ttry {\n\t\t\tDOMParser parser = new DOMParser();\n\n\t\t\tparser.setFeature(\n\t\t\t\t\"http://apache.org/xml/features/dom/defer-node-expansion\",\n\t\t\t\tfalse);\n\n\t\t\t// Validation (must also set error handler):\n\t\t\tparser.setFeature(\n\t\t\t\t\"http://xml.org/sax/features/validation\",\n\t\t\t\ttrue);\n\t\t\tparser.setErrorHandler( this);\n\n\t\t\t// Namespace\n\t\t\tparser.setFeature(\n\t\t\t\t\"http://xml.org/sax/features/namespaces\",\n\t\t\t\ttrue);\n\n\t\t\t// Schema support\n\t\t\tparser.setFeature(\n\t\t\t\t\"http://apache.org/xml/features/validation/schema\",\n\t\t\t\ttrue);\n\n\t\t\t// Schema full constraint checking\n            parser.setFeature(\n\t\t\t\"http://apache.org/xml/features/validation/schema-full-checking\",\n\t\t\t\ttrue);\n\n\t\t\tSystem.out.println(\"inuri: \\\"\" + inuri + \"\\\"\");\n\t\t\tparser.parse( inuri);\n\u0018\u0013\t\t\tdoc = parser.getDocument();\n        }\n\t\tcatch (Exception spe) {\n\t\t\tSystem.out.println( \"parse error: \" + spe);\n\t\t\tspe.printStackTrace();\n\t\t\tSystem.exit(1);\n\t\t}\n\n\t} // end constructor\n\n\n\n\t// ErrorHandler interface\n\tpublic void error( SAXParseException exc) {\n\t\tSystem.out.println(\"ErrorHandler: error: \" + exc);\n\t}\n\tpublic void fatalError( SAXParseException exc) {\n\t\tSystem.out.println(\"ErrorHandler: fatalError: \" + exc);\n\t}\n\tpublic void warning( SAXParseException exc) {\n\t\tSystem.out.println(\"ErrorHandler: warning: \" + exc);\n\t}\n\n} // end class Txmld\n\n===== end file =====\n\n\n\n\n\n===== begin tempa.xml =====\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<personnel xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t   xsi:noNamespaceSchemaLocation=\"tempa.xsd\">\n\n  <person id=\"Big.Boss\" >\n    <name><family>Boss</family> <given>Big</given></name>\n    <email>chief@foo.com</email>\n    <link subordinates=\"one.worker two.worker three.worker four.worker\nfive.worker\"/>\n  </person>\n\n  <person id=\"one.worker\">\n    <name><family>Worker</family> <given>One</given></name>\n    <email>one@foo.com</email>\n    <link manager=\"Big.Boss\"/>\n  </person>\n\n  <person id=\"two.worker\">\n    <name><family>Worker</family> <given>Two</given></name>\n    <email>two@foo.com</email>\n    <link manager=\"Big.Boss\"/>\n  </person>\n\n  <person id=\"three.worker\">\n    <name><family>Worker</family> <given>Three</given></name>\n    <email>three@foo.com</email>\n    <link manager=\"Big.Boss\"/>\n  </person>\n\n  <person id=\"four.worker\">\n    <name><family>Worker</family> <given>Four</given></name>\n    <email>four@foo.com</email>\n    <link manager=\"Big.Boss\"/>\n  </person>\n\n  <person id=\"five.worker\">\n    <name><family>Worker</family> <given>Five</given></name>\n    <email>five@foo.com</email>\n    <link manager=\"Big.Boss\"/>\n  </person>\n\n</personnel>\n===== end file =====\n\n\n\n\n\n===== begin tempa.xsd =====\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\">\n\n <xs:element name=\"personnel\">\n  <xs:complexType>\n   <xs:sequence>\n     <xs:element ref=\"person\" minOccurs='1' maxOccurs='unbounded'/>\n   </xs:sequence>\n  </xs:complexType>\n\n  <xs:unique name=\"unique1\">\n   <xs:selector xpath=\"person\"/>\n   <xs:field xpath=\"@name\"/>\n  </xs:unique>\n  <xs:key name='empid'>\n   <xs:selector xpath=\"person\"/>\n   <xs:field xpath=\"@id\"/>\n  </xs:key>\n  <xs:keyref name=\"keyref1\" refer='empid'>\n   <xs:selector xpath=\"person\"/> \n   <xs:field xpath=\"link/@manager\"/>  \n  </xs:keyref>\n\n </xs:element>\n\n <xs:element name=\"person\">\n  <xs:complexType>\n   <xs:sequence>\n     <xs:element ref=\"name\"/>\n     <xs:element ref=\"email\" minOccurs='0' maxOccurs='unbounded'/>\n     <xs:element ref=\"url\"   minOccurs='0' maxOccurs='unbounded'/>\n     <xs:element ref=\"link\"  minOccurs='0' maxOccurs='1'/>\n   </xs:sequence>\n   <xs:attribute name=\"id\"  type=\"xs:ID\" use='required'/>\n   <xs:attribute name=\"note\" type=\"xs:string\"/>\n   <xs:attribute name=\"contr\" default=\"false\">\n    <xs:simpleType>\n     <xs:restriction base = \"xs:string\">\n       <xs:enumeration value=\"true\"/>\n       <xs:enumeration value=\"false\"/>\n     </xs:restriction>\n    </xs:simpleType>\n   </xs:attribute>\n   <xs:attribute name=\"salary\" type=\"xs:integer\"/>\n  </xs:complexType>\n </xs:element>\n\n <xs:element name=\"name\">\n  <xs:complexType>\n   <xs:all>\n    <xs:element ref=\"family\"/>\n    <xs:element ref=\"given\"/>\n   </xs:all>\n  </xs:complexType>\n </xs:element>\n\n <xs:element name=\"family\" type='xs:string'/>\n\n <xs:element name=\"given\" type='xs:string'/>\n\n <xs:element name=\"email\" type='xs:string'/>\n\n <xs:element name=\"url\">\n  <xs:complexType>\n   <xs:attribute name=\"href\" type=\"xs:string\" default=\"http://\"/>\n  </xs:complexType>\n </xs:element>\n\n <xs:element name=\"link\">\n  <xs:complexType>\n   <xs:attribute name=\"manager\" type=\"xs:IDREF\"/>\n   <xs:attribute name=\"subordinates\" type=\"xs:IDREFS\"/>\n  </xs:complexType>\n </xs:element>\n\n <xs:notation name='gif' public='-//APP/Photoshop/4.0' system='photoshop.exe'/>\n\n</xs:schema>\n===== end file ====="}, {"count": 1, "tags": [], "bug_id": 2485, "is_private": false, "text": "This bug had been fixed in CVS. Go grab the latest version.", "id": 3508, "time": "2001-07-09T08:44:06Z", "creator": "sandygao@ca.ibm.com", "creation_time": "2001-07-09T08:44:06Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 2485, "is_private": false, "count": 2, "id": 3510, "time": "2001-07-09T10:23:10Z", "creator": "sullivan@mathcom.com", "creation_time": "2001-07-09T10:23:10Z", "text": "I just installed and tested with: xml-xerces_20010709114340.tar.gz\nThe bug still exists:\njava.lang.NullPointerException\n\tat org.apache.xerces.framework.XMLParser.parse(XMLParser.java:1094)\n\tat org.apache.xerces.framework.XMLParser.parse(XMLParser.java:1122)\n\tat txmlapk.Txmld.<init>(Txmld.java:89)\n\tat txmlapk.Txmld.main(Txmld.java:38)\n"}, {"attachment_id": null, "tags": [], "bug_id": 2485, "is_private": false, "count": 3, "id": 3516, "time": "2001-07-09T12:01:25Z", "creator": "sandygao@ca.ibm.com", "creation_time": "2001-07-09T12:01:25Z", "text": "so your program triggered more than one bug :-) Now it's fixed in CVS.\n\nwhen defer-node-expansion is set to false in DOMParser, \nfDocumentHandle.characters() should be the last method to call when processing \ncharacters and whitespaces. (XMLValidator.java)"}]
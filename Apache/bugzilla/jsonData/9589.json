[{"count": 0, "text": "First I create a custom type and a custom task, and place them in the same jar.\n Then, in my build script, for each of those I specify a custom classpath\npointing to the same jar in their respective taskdef/typedef.  If in my task I\nthen try to use the type by casting a reference to the types Type, I get a\nClassCastException because the task and type are defined in different\nclassloaders, and thus the Task's use of the type's Type is going to be an\nentirely different class.  e.g:\n\n//FooType.java\n//-------------\n\npackage com.foo;\n\nimport org.apache.tools.ant.types.DataType;\n\npublic class FooType extends DataType\n{\n\n\tprivate String foo;\n\t\n\tpublic FooType()\n\t{\n\t\tsuper();\n\t\tSystem.out.println(\"FooType ctor\");\n\t}\n\n\tpublic void setFoo(String foo)\n\t{\n\t\tthis.foo = foo;\n\t\tproject.log(\"FooType setFoo\", project.MSG_WARN);\n\t}\n\n\tpublic String toString()\n\t{\n\t\treturn foo;\n\t}\n}\n\n//BlahTask.java\n//-------------\n\npackage com.foo;\n\nimport org.apache.tools.ant.BuildException;\nimport org.apache.tools.ant.Task;\nimport org.apache.tools.ant.types.Reference;\n\npublic class BlahTask extends Task\n{\n\tprivate FooType foo;\n\t\n\tpublic BlahTask()\n\t{\n\t\tsuper();\n\t\tSystem.out.println(\"BlahTask ctor\");\n\t}\n\n\tpublic void setFooref(Reference fooref)\n\t{\n\t\tif (fooref != null)\n\t\t{\n\t\t\tObject thefoo = fooref.getReferencedObject(project);\n\t\t\tif (thefoo != null)\n\t\t\t\tthis.foo = (FooType) thefoo;  //ClassCastEx here\n\t\t}\n\t}\n\n\tpublic void execute() throws BuildException\n\t{\n\t\tproject.log(\"Blah\", project.MSG_INFO);\n\t}\n\n}\n\nbuild.xml\n---------\n\n<project name=\"antbug\" default=\"all\">\n\n\t<taskdef name=\"blah\" classname=\"com.foo.BlahTask\" classpath=\"classes\"/>\n\t<typedef name=\"footype\" classname=\"com.foo.FooType\" classpath=\"classes\"/>\n\t\n\t<footype id=\"somefoo\" foo=\"foobar\"/>\n\t\n\t<target name=\"all\">\n\t\t<echo message=\"Howdy\"/>\n\t\t<blah fooref=\"somefoo\"/>\n\t</target>\n\n</project>", "creator": "wr0ngway@yahoo.com", "is_private": false, "id": 17110, "time": "2002-06-03T21:18:01Z", "bug_id": 9589, "creation_time": "2002-06-03T21:18:01Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 9589, "attachment_id": null, "text": "Try out the new attribute on <taskdef> and <typedef> called 'loaderRef'.  That \nwas designed to solve this very problem.  If it works, please close this \nissue.  If not, report back the details.", "id": 17128, "time": "2002-06-03T23:36:47Z", "creator": "jakarta@ehatchersolutions.com", "creation_time": "2002-06-03T23:36:47Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 9589, "attachment_id": null, "id": 17148, "time": "2002-06-04T23:07:18Z", "creator": "wr0ngway@yahoo.com", "creation_time": "2002-06-04T23:07:18Z", "is_private": false, "text": "That works perfectly, thanks.\n"}]
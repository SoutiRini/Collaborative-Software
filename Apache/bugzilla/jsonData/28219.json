[{"count": 0, "tags": [], "creator": "gruber@dbai.tuwien.ac.at", "attachment_id": null, "is_private": false, "id": 55358, "time": "2004-04-06T01:00:44Z", "bug_id": 28219, "creation_time": "2004-04-06T01:00:44Z", "text": "In my server.xml I defined a JNDI datasource as described in the Tomcat docs,\nbut I couldn't connect to the database and I always got the exception \"Cannot\ncreate PoolableConnectionFactory\". After a few hours of investigation I found\nout that the Database Connection Pool (DBCP) didn't get the right password,\nbecause the dolar sign of the password disappeared. So the password a$a$a of the\nconfiguration file server.xml changed to aaa in the DataSource.\nBelow the configuration of server.xml (it requires the mysql connector package):\n\n<Resource name=\"jdbc/foo\" scope=\"Shareable\" type=\"javax.sql.DataSource\"/>\n<ResourceParams name=\"jdbc/foo\">\n  <parameter>\n    <name>factory</name>\n    <value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n  </parameter>\n\n  <!-- DBCP database connection settings -->\n  <parameter>\n    <name>url</name>\n    <value>jdbc:mysql://localhost/bar?autoReconnect=true</value>\n  </parameter>\n  <parameter>\n    <name>driverClassName</name>\n    <value>org.gjt.mm.mysql.Driver</value>\n  </parameter>\n  <parameter>\n    <name>username</name>\n    <value>root</value>\n  </parameter>\n  <parameter>\n    <name>password</name>\n    <value>a$a$a</value>\n  </parameter>\n\n  <!-- and a few other parameters as described in the JNDI Datasource howto -->\n</ResourceParams>\n\nAnd the jsp file to test it:\n\n<%@ page import=\"javax.naming.*\" %>\n<%@ page import=\"javax.sql.*\" %>\n<%@ page import=\"java.sql.*\" %>\n<%@ page import=\"org.apache.commons.dbcp.*\" %>\n<%\ntry\n{\n  Context ctx = new InitialContext();\n  if (ctx == null ) throw new Exception(\"Boom - No Context\");\n\n  DataSource ds = (DataSource)ctx.lookup(\"java:comp/env/jdbc/foo\");\n\n  if (ds != null)\n  {\n    BasicDataSource bds = (BasicDataSource)ds;\n    out.println(bds.getUsername());\n    out.println(bds.getPassword()); // gives aaa instead of a$a$a\n    out.println(bds.getUrl());\n    out.println(bds.getDriverClassName());\n  }\n  else { out.print(\"No DataSource\"); }\n}\ncatch (SQLNestedException ee)\n{\n  StackTraceElement b[] = ee.getStackTrace();\n  out.print(ee.getMessage() + \" in method \" + b[0].getMethodName() + \" in file \"\n+ b[0].getFileName() + \" line \" + String.valueOf(b[0].getLineNumber()));\n}\ncatch(Exception e)\n{ out.print(e.getMessage()); }\n%>\n\nI did a short test if this behavoir occurs also with other parameters (ex\nusername) and the same error appeared, so maybe the whole deployment descriptor\nis affected"}, {"count": 1, "tags": [], "text": "At worst, this will only occur when you save your server.xml through the admin\nwebapp.", "attachment_id": null, "bug_id": 28219, "id": 55370, "time": "2004-04-06T09:08:26Z", "creator": "remm@apache.org", "creation_time": "2004-04-06T09:08:26Z", "is_private": false}, {"count": 2, "tags": [], "text": "I've just verified this is still not fixed (in tomcat 5.0.25), but I'm not sure \nhow to fix it ;)", "is_private": false, "bug_id": 28219, "id": 59013, "time": "2004-06-10T14:04:40Z", "creator": "yoavs@computer.org", "creation_time": "2004-06-10T14:04:40Z", "attachment_id": null}, {"text": "The same problem exists with the driverClassName. We using the \nJData2_0.sql.$Driver from JDataConnect. It only works when we write double $$ \nsigns directly in the server.xml:\n\n<parameter>\n  <name>driverClassName</name>\n  <value>JData2_0.sql.$$Driver</value>\n </parameter>\n\nBut after saving the server.xml through the admin webapp, one of the two $ \ndisappeared. And Tomcat looks after then for a class called JData2_0.sql.Driver \ninstead of JData2_0.sql.$Driver.\n\nWe cant use the admin webapp because of this bug.", "tags": [], "bug_id": 28219, "attachment_id": null, "count": 3, "id": 60297, "time": "2004-07-08T11:40:08Z", "creator": "roland.durrer@concordia.ch", "creation_time": "2004-07-08T11:40:08Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 28219, "attachment_id": null, "is_private": false, "id": 60299, "time": "2004-07-08T13:14:09Z", "creator": "pr@objektpark.de", "creation_time": "2004-07-08T13:14:09Z", "text": "This is a diegster side effect.\n\nWith Tomcat 5.x you can used all system properties variable inside\nserver.xml or context.xml. But with one \"$\" the Diegster interpreter\nyou $Driver as empty variable...\n\nYour \"$$\" trick work not really. The StandardServer.storeConfig save the actual\nmemory state from Tomcat. Admin used this method and your problem comes back.\n\nSorry, but currently you have no chance to used Admin app with your configuration.\n\nregards.\nPeter"}, {"count": 5, "tags": [], "creator": "roland.durrer@concordia.ch", "text": "I tried to use a java system property as workaround. When i define a property -\nDdriver.name=\"JData2_0.sql.$Driver\" and use that one in the server.xml like this\n      \n<parameter>\n        <name>driverClassName</name>\n        <value>${driver.name}</value>\n</parameter>\n\nthen it works one time. The problem is, that the Administrator webapp saves \nwhen i commit the changes the property value (JData2_0.sql.$Driver) instead of \nthe property name (${driver.name}). After save, the file looks like this:\n\n<parameter>\n        <name>driverClassName</name>\n        <value>JData2_0.sql.$Driver<value>\n</parameter>\n\nWith Tomcat 5 it's possible to use some java system properties in the \nserver.xml files, but only if you don't handle with the Administrator webapp. \n\nIs it necessarily to open a new bug report for that behavior? imho i think, the \nused java system property in the server.xml should be persistent and may not \nreplaced by its value when saving with the Administrator webapp.\n", "id": 60360, "time": "2004-07-09T13:32:02Z", "bug_id": 28219, "creation_time": "2004-07-09T13:32:02Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "pr@objektpark.de", "text": "Hey,\n\nI have start to implement a new storage system\nfor server.xml and context.xml. OK, I add this \nSystem.property replacement at my feature list.\n\nregards\npeter", "id": 60376, "time": "2004-07-09T18:05:34Z", "bug_id": 28219, "creation_time": "2004-07-09T18:05:34Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "yoavs@computer.org", "text": "This is related to the encoding issue with saving the Admin webapp.  I'm \nunifying this with the EBCDIC issue and the non-ASCII characters issue.", "id": 61378, "time": "2004-07-30T14:34:19Z", "bug_id": 28219, "creation_time": "2004-07-30T14:34:19Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "is_private": false, "id": 61379, "time": "2004-07-30T14:34:50Z", "bug_id": 28219, "creation_time": "2004-07-30T14:34:50Z", "text": "\n\n*** This bug has been marked as a duplicate of 29091 ***"}]
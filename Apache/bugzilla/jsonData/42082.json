[{"count": 0, "tags": [], "creator": "jz-2007@heute-morgen.de", "text": "Hi.\n\nAfter an INCLUDES filter a subsequent filters filter_init function is called\nonce for the main document and once for each included document. It should be\ncalled only once.\n\nTo check this a filter is used that counts the calls to filter_init (see below).\n\nThe output in the error log is:\n\n[Tue Apr 10 07:43:45 2007] [debug] mod_count_init.c(24): [client 192.168.201.87]\nci_filter_init counted 1.\n[Tue Apr 10 07:43:45 2007] [debug] mod_count_init.c(24): [client 192.168.201.87]\nci_filter_init counted 2.\n[Tue Apr 10 07:43:45 2007] [debug] mod_count_init.c(24): [client 192.168.201.87]\nci_filter_init counted 3.\n[Tue Apr 10 07:43:45 2007] [debug] mod_count_init.c(24): [client 192.168.201.87]\nci_filter_init counted 4.\n[Tue Apr 10 07:43:45 2007] [debug] mod_count_init.c(24): [client 192.168.201.87]\nci_filter_init counted 5.\n[Tue Apr 10 07:43:45 2007] [debug] mod_count_init.c(24): [client 192.168.201.87]\nci_filter_init counted 6.\n\n-------------------------------------------------------------------------------\nLoadModule ci_module modules/mod_count_init.so\n\nAddOutputFilter  INCLUDES;count-init .html\n\nbug.html----------------------------------------------------------------------\n<html>\n<!--#include virtual=\"test.txt\" -->\n<!--#include virtual=\"test.txt\" -->\n<!--#include virtual=\"test.txt\" -->\n<!--#include virtual=\"test.txt\" -->\n<!--#include virtual=\"test.txt\" -->\n</html>\ntest.txt----------------------------------------------------------------------\nTest\nmod_count_init.c--------------------------------------------------------------\n/* \n * Test for an apache 2.2 bug\n */\n\n#include <apr.h>\n#include <apr_general.h>\n#include <apr_buckets.h>\n#include <http_protocol.h>\n#include <http_log.h>\n#include <mpm.h>\n\nmodule AP_MODULE_DECLARE_DATA ci_module;\n\n/*****************************************************************************\n * The main filter\n *****************************************************************************/\n\n/*\n * ci_filter_init\n */\nstatic int ci_filter_init(ap_filter_t * f)\n{\n    int *cnt = (int *)(&f->ctx);\n    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, f->r,\n                  \"ci_filter_init counted %d.\", ++(*cnt));\n\n    return OK;\n}\n\n/**\n * Does nothing\n */\nstatic int ci_filter(ap_filter_t * f, apr_bucket_brigade * bb)\n{\n    return ap_pass_brigade(f->next, bb);\n}\n\n/*****************************************************************************\n * The usual module stuff\n *****************************************************************************/\n\nstatic void ci_hooks(apr_pool_t * p)\n{\n    ap_register_output_filter(\"count-init\", ci_filter,\n                              ci_filter_init, AP_FTYPE_RESOURCE);\n}\n\nmodule AP_MODULE_DECLARE_DATA ci_module = {\n    STANDARD20_MODULE_STUFF, NULL, NULL, NULL, NULL,\n    NULL, ci_hooks\n};", "id": 101562, "time": "2007-04-10T12:01:49Z", "bug_id": 42082, "creation_time": "2007-04-10T12:01:49Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "attachment_id": null, "creator": "bozy@fgm.com.cy", "text": "Built Apache-2.0.50 on PowerPC 601 machine (IBM 7009 C10) running AIX 5.1 \n(maintenance level 006), using Visual Age C for AIX v 6.0 (with latest \nmaintenance levels applied). Following options were used:\n\"./configure\" \\\n\"--with-mpm-worker\" \\\n\"--enable-so\" \\\n\"--enable-layout=Apache\" \\\n\"--enable-mods-shared=most\" \\\n\"--with-expat=/home/bozy/src/httpd-2.0.50/srclib/apr-util/xml/expat\" \\\n\"--enable-static-support\" \\\n\"CC=xlc_r\" \\\n\"CFLAGS=-O2 -I/usr/local/include\" \\\n\"LDFLAGS=-L/usr/local/lib\" \\\n\nNote: I neded specifically '_r' compiler for Apache to build properly with \nlibdb-4.2, since Berkeley DB on AIX builds as multithreaded.\n\nEverything compiled and built OK apart from some compiler warnings about \nincorrect file suffixes on '.la' files (I guess these could be ignored). I made \nan 'apachectl start' - everything started OK, error_log showing:\n[quote]\n[Thu Aug 05 13:20:40 2004] [notice] Apache/2.0.50 (Unix) PHP/5.0.0 DAV/2 \nconfigured -- resuming normal operations\n[unquote]\nWhen trying to telnet to port 80 of the server I get following:\n[quote]\n$ telnet powerpc 80  \nTrying...\nConnected to powerpc.unicom.cg.\nEscape character is '^]'.\nConnection closed.\n[unquote]\nNo errors/messages logged in access_log/error_log. I tried all thinkable \ncombinations of optimization flags during compile, unloaded nearly all modules \n(including PHP5) etc. to no avail.\n\nFinally (being almost sure nothing will change) I used 'cc_r' compiler instead \nof 'xlc_r' - not sure exactly what is the difference between the two, I guess \nit may be different C language level/standard and linking with some other set \nof default libraries. And everything works great! I've just checked couple of \nPHP scripts with MySQL - works perfectly fine. It can't be really called \na 'bug' in Apache software, rather some weirdness of IBM C compiler, but I felt \nlike reporting it to save some time to thers trying to compile it, as I've \nspent 3 days myself, must admit - I am no computer programmer. By the way, perl \n5.8.5 compiles, builds and tests with both flavors - either with 'cc_r' \nor 'xlc_r'.\n\n\nRegards\n\nAlexei", "id": 61570, "time": "2004-08-05T10:44:24Z", "bug_id": 30487, "creation_time": "2004-08-05T10:44:24Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 30487, "attachment_id": null, "text": "As far as we can tell, this problem is due to a bug in the native AIX compiler\nwhen building Apache at -O2.\n\nA special patch will resolve this; go to\nhttp://www.apache.org/~trawick/aixstatus.html and search for \"optimization problem\".\n\nPlease re-open if this patch does not resolve the problem.", "id": 61571, "time": "2004-08-05T11:00:13Z", "creator": "trawick@apache.org", "creation_time": "2004-08-05T11:00:13Z", "is_private": false}, {"count": 2, "attachment_id": null, "creator": "bozy@fgm.com.cy", "text": "Well, I've been reading about this as well (perl, for example, does not even \ncompile with '-O2', while it does with '-O2 -qstrict'). I have tried 'xlc_r -O' \nwith Apache as well to no avail, while 'cc_r' compiles equally well with '-O' \nand '-O2' and I could not see any difference in Apache behavior so far (at \nleast with PHP5/MySQL CGI scripts). To me looks more like a difference in set \nof default libraries to link with. \nMaybe this deserves to be put in some sort of README for Apache, since both AIX \n5.1 and C for AIX 6.0 are fairly recent products.\nAn excerpt from 'man xlc':\n[quote]\n-O        Optimize generated code.\n-O2       Same as -O.\n[unquote]\n\nActual 'httpd' binaries do not compare, when compiled with '-O' and '-O2'.\nMaybe IBM does not tell all the truth...\n\nregards\n\nAlexey", "id": 61574, "time": "2004-08-05T11:35:55Z", "bug_id": 30487, "creation_time": "2004-08-05T11:35:55Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "creator": "trawick@apache.org", "text": "Yes, putting it in README.platforms is a good idea; I'll do that.", "id": 61576, "time": "2004-08-05T12:19:09Z", "bug_id": 30487, "creation_time": "2004-08-05T12:19:09Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 30487, "attachment_id": null, "text": "Yes, I have applied the 'optimize bug' patch, but I forgot to mention it in my \ninitial report, thanks for pointing it out. `Apache AIX status' document \nmentions 'xlc' as working (with '-O') when called as 'xlc_r' or 'xlC_r'. Seems \nthat in C for AIX V6.0 this behavior had changed and it is better to resort \nto 'cc_r'. I guess the case could be closed :-)\n\nAlexei", "id": 61577, "time": "2004-08-05T12:29:06Z", "creator": "bozy@fgm.com.cy", "creation_time": "2004-08-05T12:29:06Z", "is_private": false}, {"count": 5, "tags": [], "text": "okay, I can verify that with xlc 5.0.2.5 I don't need the patch if I use CC=cc_r\nCFLAGS=-O2 but I do need the patch if I use CC=xlc_r CFLAGS=-O2\n\nthe difference in xlc_r and cc_r behavior can be seen in /etc/vac.cfg, which\nspecifies what libraries and other options are used based on the wrapper (CC)\n\nthe difference is in the default options\n  cc_r has -qlanglvl=extended,-qnoro,-qnoroconst\n xlc_r has -qansialias\n\nall other options, libraries, stubs, and library paths are the same\n\nI've updated README.platforms to point out\n  stable location of the server/core.c patch\n  xlc_r -O2 needs the patch\n  cc_r  -O2 doesn't need the patch\n\nThanks for your research on this topic!\n\n(I'll update my unofficial notes on AIX + Apache2 shortly.)", "attachment_id": null, "bug_id": 30487, "id": 63215, "time": "2004-09-08T14:58:33Z", "creator": "trawick@apache.org", "creation_time": "2004-09-08T14:58:33Z", "is_private": false}]
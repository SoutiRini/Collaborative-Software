[{"count": 0, "tags": [], "creator": "dhc4z@virginia.edu", "is_private": false, "text": "Deactivate attempt fails with the message:\n\nAn error occured.\n\nCannot write to source\n[lenya://lenya/pubs/nextlev/content/authoring/index/index_en.xml.meta]: not locked!\n\norg.apache.avalon.framework.CascadingRuntimeException: uncaught JavaScript\nexception: at executeUsecase\n(file:/C:/src/lenya-1.4.x.WEBDAV/build/lenya/webapp/lenya/usecases/usecases.js,\nLine 168): org.apache.lenya.cms.usecase.UsecaseException:\njava.lang.RuntimeException: java.lang.RuntimeException:\norg.apache.lenya.cms.publication.DocumentException: java.lang.RuntimeException:\nCannot write to source\n[lenya://lenya/pubs/nextlev/content/authoring/index/index_en.xml.meta]: not locked!\n\n\nThis patch seems to have resolved the problem for me:\n\nIndex:\nC:/src/lenya-1.4.x.WEBDAV/src/webapp/lenya/pubs/default/java/src/org/apache/lenya/defaultpub/cms/usecases/Deactivate.java\n===================================================================\n---\nC:/src/lenya-1.4.x.WEBDAV/src/webapp/lenya/pubs/default/java/src/org/apache/lenya/defaultpub/cms/usecases/Deactivate.java\n(revision 190330)\n+++\nC:/src/lenya-1.4.x.WEBDAV/src/webapp/lenya/pubs/default/java/src/org/apache/lenya/defaultpub/cms/usecases/Deactivate.java\n(working copy)\n@@ -93,6 +93,12 @@\n             for (int i = 0; i < documents.length; i++) {\n                 nodes.addAll(Arrays.asList(documents[i].getRepositoryNodes()));\n             }\n+            \n+            set = SiteUtil.getSubSite(this.manager, doc);\n+            documents = set.getDocuments();\n+            for (int i = 0; i < documents.length; i++) {\n+                nodes.addAll(Arrays.asList(documents[i].getRepositoryNodes()));\n+            }\n \n             nodes.add(SiteUtil.getSiteStructure(this.manager,\n                     doc.getIdentityMap(),", "id": 76444, "time": "2005-06-16T06:21:09Z", "bug_id": 35381, "creation_time": "2005-06-16T06:21:09Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 35381, "text": "applied, thanks", "id": 76477, "time": "2005-06-16T17:52:08Z", "creator": "gregor@apache.org", "creation_time": "2005-06-16T17:52:08Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 46316, "attachment_id": null, "id": 122958, "time": "2008-12-01T03:52:30Z", "creator": "jem.rayfield@bbc.co.uk", "creation_time": "2008-12-01T03:52:30Z", "is_private": false, "text": "Hi,\n\nIt seems that the mod_proxy ProxyTimeout has a nasty side effect when it \nkicks in when used with proxied SSI. Everything after a proxied (and timed out) SSI is ignored and not rendered.\n\nFor example the following simple shtml -> \n\n<html> \n  <body> \n     <h1>SSI CGI via a proxy test</h1> \n     <!--#include virtual=\"test-include.html\" --> \n     <!--#include virtual=\"proxy/cgi-bin/perl-sleep.cgi?${QUERY_STRING}\" --> \n    <h1> \n      Content that must be displayed even after a proxy timeout \n    </h1> \n  </body> \n</html> \n\nHas render problems with the CGI is timedout via ProxyTimeOut.\nIt appear to interrupt the subsequent output filter on timeout? \n\nThe proxy configuration is as follows -->\nApache 2.2.10 (SHTML+mod_proxy+SSI):80 --> Squid:3128 --> Apache 2.2.10(mod_cgi):8080 \n\n   <Proxy balancer://squidbalancer> \n      BalancerMember http://localhost:3128/ \n      ProxySet lbmethod=bytraffic \n      ProxySet timeout=1 \n    </Proxy> \n    ProxyTimeout 2 \n    RewriteEngine On \n    RewriteRule ^/proxy/(.*) balancer://squidbalancer/$1 [P,QSA,L] \n\nIf the ProxyTimeout kicks in before Squid+Apache/CGI returns the \nfollowing is rendered: \n\n<html> \n <body> \n <h1>SSI CGI via a proxy test</h1> \n <br/> \n             **MISSING HTML HERE** \n\nHowever when I increase the ProxyTimeout in order that Squid times \nout and not the calling Apache before the CGI returns the render looks a \ntad better. \n\nAt least the full shtml is rendered. (Plus some horrid squid \nresponse). Please see below.\n\nI need proxied server side includes where a ProxyTimeout ensures that the backend server does not consume and hold up all the requests/threads.\n\n\nPlease do let me have your thoughts \nCheers\nJem\n\n\n<html> \n <body> \n <h1>SSI CGI via a proxy test</h1> \n <br/> \n <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \n\"http://www.w3.org/TR/html4/loose.dtd\"> \n <HTML><HEAD><META HTTP-EQUIV=\"Content-Type\" CONTENT=\"text/html; \ncharset=iso-8859-1\"> \n <TITLE>ERROR: The requested URL could not be retrieved</TITLE> \n <STYLE type=\"text/css\"><!--BODY{background-color:#ffffff;font- \nfamily:verdana,sans-serif}PRE{font-family:sans-serif}--></STYLE> \n </HEAD><BODY> \n <H1>ERROR</H1> \n <H2>The requested URL could not be retrieved</H2> \n <HR noshade size=\"1px\"> \n <P> \n While trying to retrieve the URL: \n <A HREF=\"http://127.0.0.1//cgi-bin/perl-sleep.cgi?\">http:// \n127.0.0.1// \ncgi-bin/perl-sleep.cgi?</A> \n <P> \n The following error was encountered: \n <UL> \n <LI> \n <STRONG> \n Read Timeout \n </STRONG> \n </UL> \n <P> \n The system returned: \n <PRE><I> [No Error]</I></PRE> \n <P> \n A Timeout occurred while waiting to read data from the network. The \nnetwork \n or server may be down or congested. Please retry your request. \n <P>Your cache administrator is <A \nHREF=\"mailto:webmaster\">webmaster</ \nA>. \n <BR clear=\"all\"> \n <HR noshade size=\"1px\"> \n <ADDRESS> \n Generated Wed, 26 Nov 2008 12:19:09 GMT by PC- \nS043915.national.core.bbc.co.uk (squid/2.6.STABLE17) \n </ADDRESS> \n </BODY></HTML> \n <h1> \n Content that must be displayed even after a proxy timeout \n </h1> \n </body> \n </html>"}, {"count": 1, "tags": [], "creator": "jem.rayfield@bbc.co.uk", "attachment_id": null, "text": "Hi,\nIt seems that the mod_proxy ProxyTimeout has a nasty side effect when it \nkicks in when used with proxied SSI. Everything after a proxied (and timed out)\nSSI is ignored and not rendered.\n\nFor example the following simple shtml -> \n\n<html> \n  <body> \n     <h1>SSI CGI via a proxy test</h1> \n     <!--#include virtual=\"test-include.html\" --> \n     <!--#include virtual=\"proxy/cgi-bin/perl-sleep.cgi?${QUERY_STRING}\" --> \n    <h1> \n      Content that must be displayed even after a proxy timeout \n    </h1> \n  </body> \n</html> \n\nThe above shtml has render problems when the CGI times out via ProxyTimeOut.\nmod_proxy appears to interrupt the render and subsequent output filter on timeout? \n\nThe proxy configuration is as follows --> Apache 2.2.10 (SHTML+mod_proxy+SSI):80 --> Squid:3128 --> Apache 2.2.10(mod_cgi):8080 \n\n    <Proxy balancer://squidbalancer> \n       BalancerMember http://localhost:3128/ \n       ProxySet lbmethod=bytraffic \n       ProxySet timeout=1 \n     </Proxy> \n     ProxyTimeout 2 \n     RewriteEngine On \n     RewriteRule ^/proxy/(.*) balancer://squidbalancer/$1 [P,QSA,L] \n\nSo as an example if the ProxyTimeout kicks in before Squid+Apache/CGI returns the following is rendered: \n\n <html> \n  <body> \n  <h1>SSI CGI via a proxy test</h1> \n  <br/> \n              **MISSING HTML HERE** \n\nHowever when I increase the ProxyTimeout in order that Squid times \nout and not the calling Apache before the CGI returns the render looks a \ntad better. \nAt least the full shtml is rendered. (Plus some horrid squid \nresponse). Please see below.\nI need proxied server side includes where a ProxyTimeout ensures that the\nbackend server does not consume and hold up all the requests/threads.\n\nPlease do let me have your thoughts \nCheers\nJem\n\n <html> \n  <body> \n  <h1>SSI CGI via a proxy test</h1> \n  <br/> \n  <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \n \"http://www.w3.org/TR/html4/loose.dtd\"> \n  <HTML><HEAD><META HTTP-EQUIV=\"Content-Type\" CONTENT=\"text/html; \n charset=iso-8859-1\"> \n  <TITLE>ERROR: The requested URL could not be retrieved</TITLE> \n  <STYLE type=\"text/css\"><!--BODY{background-color:#ffffff;font- \n family:verdana,sans-serif}PRE{font-family:sans-serif}--></STYLE> \n  </HEAD><BODY> \n  <H1>ERROR</H1> \n  <H2>The requested URL could not be retrieved</H2> \n  <HR noshade size=\"1px\"> \n  <P> \n  While trying to retrieve the URL: \n  <A HREF=\"http://127.0.0.1//cgi-bin/perl-sleep.cgi?\">http:// \n 127.0.0.1// \n cgi-bin/perl-sleep.cgi?</A> \n  <P> \n  The following error was encountered: \n  <UL> \n  <LI> \n  <STRONG> \n  Read Timeout \n  </STRONG> \n  </UL> \n  <P> \n  The system returned: \n  <PRE><I> [No Error]</I></PRE> \n  <P> \n  A Timeout occurred while waiting to read data from the network. The \n network \n  or server may be down or congested. Please retry your request. \n  <P>Your cache administrator is <A \n HREF=\"mailto:webmaster\">webmaster</ \n A>. \n  <BR clear=\"all\"> \n  <HR noshade size=\"1px\"> \n  <ADDRESS> \n  Generated Wed, 26 Nov 2008 12:19:09 GMT by PC- > S043915.national.core.bbc.co.uk (squid/2.6.STABLE17) \n  </ADDRESS> \n  </BODY></HTML> \n  <h1> \n  Content that must be displayed even after a proxy timeout \n  </h1> \n  </body> \n  </html>\n", "id": 122959, "time": "2008-12-01T03:59:01Z", "bug_id": 46316, "creation_time": "2008-12-01T03:59:01Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "macherius@infonyte.com", "attachment_id": null, "text": "Summary:\norg.apache.tools.bzip2.CBZip2InputStream dies in constructor\n\nEffect:\nException in thread \"main\" java.lang.NullPointerException\nat org.apache.tools.bzip2.CBZip2InputStream.bsR(CBZip2InputStream.java:327)\nat org.apache.tools.bzip2.CBZip2InputStream.bsGetUChar(CBZip2InputStream.java:346)\nat org.apache.tools.bzip2.CBZip2InputStream.initBlock(CBZip2InputStream.java:232)\nat org.apache.tools.bzip2.CBZip2InputStream.<init>(CBZip2InputStream.java:180)\nat tgz.main(tgz.java:21)\n\nReproduce:\n1) Take any file and compressed it with a current bzip2\ne.g. \"bzip2, a block-sorting file compressor.  Version 1.0.2, 30-Dec-2001.\"\n2) Try to open a CBZip2InputStream from that file as follows\n\n...\nFile f = new File(freeb_win_tar_bz2);\nFileInputStream fis = new FileInputStream(f);\nSystem.out.println(fis);\n// This object is fine, gives e.g. java.io.FileInputStream@1ea2dfe\nCBZip2InputStream cbz2is = new CBZip2InputStream(fis);\n// -> NPE\n...\n\n3) See it dying.\n\nFix:\nVery simple. The issue is in the \"initialize()\" method of CBZip2InputStream.java\n(line 215 ff). It just does not skip the initial \"BZ\" constant chars as follows:\n\n----- old version follows (as in Apache CVS by today)\n    private void initialize() {\n        char magic3, magic4;\n        magic3 = bsGetUChar();\n        magic4 = bsGetUChar();\n        if (magic3 != 'h' || magic4 < '1' || magic4 > '9') {\n...\n----- new follows\n    private void initialize() {\n        char magic1, magic2;\n        char magic3, magic4;\n        magic1 = bsGetUChar();\n        magic2 = bsGetUChar();\n        magic3 = bsGetUChar();\n        magic4 = bsGetUChar();\n        if (magic1 != 'B' || magic2 != 'Z' | magic3 != 'h' || magic4 < '1' ||\nmagic4 > '9') {\n...\n\nIs it considered that the user application skips the first two bytes of an\nInputStream ? If so, it should be documented somewhere. If not, the above fix\nshould be put into the CVS.\n\nThanks for your attention !\nIngo Macherius <macherius at infonyte dot com>", "id": 27979, "time": "2002-12-17T23:12:45Z", "bug_id": 15465, "creation_time": "2002-12-17T23:12:45Z", "is_private": false}, {"count": 1, "tags": [], "text": "The docs may be terse, but the class comment says:\n\n> An input stream that decompresses from the BZip2 format (without the file\n> header chars)\n\nnote the paren.", "attachment_id": null, "id": 29260, "creator": "bodewig@apache.org", "time": "2003-01-13T14:03:27Z", "bug_id": 15465, "creation_time": "2003-01-13T14:03:27Z", "is_private": false}]
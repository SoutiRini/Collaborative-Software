[{"count": 0, "tags": [], "bug_id": 3545, "is_private": false, "text": "The BUILDING.txt file states in step (7) that JavaMail and Java Activation\nFramework are optional, but in catalina/build.xml, the files activation.jar and\nmail.jar are unconditionally copied to ${catalina.build}/common/lib/ (lines\nadded  on 09-Sep-01)", "id": 5349, "time": "2001-09-11T02:51:28Z", "creator": "lvl@bvdep.com", "creation_time": "2001-09-11T02:51:28Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 3545, "text": "The following patches works for me. I haven't tested the case where both files\nare present though... (perhaps later today)\n\nI changed the copy task in catalina/build.xml to use a fileset with conditional\nincludes and the compile task in webapps/examples/build.xml to exclude\nSendMailServlet.java if mail.jar is not present.\n\nBy the way: I noticed that the <copy> tasks for the jar files in\ncatalina/build.xml use tofile=\"...\" instead of todir=\"...\" effectively renaming\nthe files.  Wouldn't it be better to leave the names as they are?\n\nLuc Vanlerberghe\n\nPatches:\n\nIndex: build.xml\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-4.0/catalina/build.xml,v\nretrieving revision 1.56\ndiff -u -r1.56 build.xml\n--- build.xml\t2001/09/10 20:30:33\t1.56\n+++ build.xml\t2001/09/11 11:45:30\n@@ -72,6 +72,8 @@\n \n     <available classname=\"junit.framework.TestCase\" property=\"junit.present\" />\n     <available file=\"${jaxp.jar}\" property=\"jaxp.jar.present\" />\n+    <available file=\"${activation.jar}\" property=\"activation.jar.present\" />\n+    <available file=\"${mail.jar}\" property=\"mail.jar.present\" />\n \n     <mkdir dir=\"${catalina.build}\"/>\n     <mkdir dir=\"${catalina.build}/bin\"/>\n@@ -113,10 +115,12 @@\n     <!--   Copy the JNDI JAR file for use under JDK 1.2.2 -->\n     <copy file=\"${jndi.jar}\"    tofile=\"${catalina.build}/common/lib/jndi.jar\" />\n     <!--   Copy activation.jar and mail.jar for the mail resource factories -->\n-    <copy file=\"${activation.jar}\"\n-        tofile=\"${catalina.build}/common/lib/activation.jar\"/>\n-    <copy file=\"${mail.jar}\"\n-        tofile=\"${catalina.build}/common/lib/mail.jar\"/>\n+    <copy todir=\"${catalina.build}/common/lib/\">\n+      <fileset dir=\".\">\n+        <include name=\"${activation.jar}\" if=\"activation.jar.present\" />\n+        <include name=\"${mail.jar}\" if=\"mail.jar.present\" />\n+      </fileset>\n+    </copy>\n \n     <!-- Server Components -->\n     <!--   Catalina needs JAXP compliant XML parser -->\n@@ -164,6 +168,7 @@\n            excludes=\"**/CVS/**\">\n       <classpath refid=\"catalina.classpath\" />\n       <exclude name=\"**/factory/Tyrex*.java\" unless=\"tyrex.present\" />\n+      <exclude name=\"**/factory/*Mail*.java\" unless=\"mail.present\" />\n       <exclude name=\"**/util/ProcessHelper.java\" unless=\"jdk.1.3.present\"/>\n       <exclude name=\"**/servlets/CGIServlet.java\" unless=\"jdk.1.3.present\"/>\n     </javac>\n\n\n\nIndex: build.xml\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-4.0/webapps/examples/build.xml,v\nretrieving revision 1.13\ndiff -u -r1.13 build.xml\n--- build.xml\t2001/09/10 16:55:40\t1.13\n+++ build.xml\t2001/09/11 11:48:41\n@@ -41,18 +41,19 @@\n \n   <!-- ================= BUILD: Compile Server Components ================= -->\n   <target name=\"build-main\" depends=\"build-static\">\n+    <available file=\"${mail.jar}\" property=\"mail.jar.present\" />\n \n     <javac   srcdir=\"WEB-INF/classes\" \n              destdir=\"${webapps.build}/${webapp.name}/WEB-INF/classes\"\n              classpath=\"${servlet.jar}:${jndi.jar}:${activation.jar}:${mail.jar}\"\n-             deprecation=\"off\" debug=\"on\" optimize=\"off\"\n-             excludes=\"**/CVS/**\"/>\n+             deprecation=\"off\" debug=\"on\" optimize=\"off\">\n+      <exclude name=\"SendMailServlet.java\" unless=\"mail.jar.present\" />\n+    </javac>\n \n     <javac   srcdir=\"jsp/plugin/applet\" \n              destdir=\"${webapps.build}/${webapp.name}/jsp/plugin/applet\"\n              classpath=\"${servlet.jar}\"\n-             deprecation=\"off\" debug=\"on\" optimize=\"off\"\n-             excludes=\"**/CVS/**\"/>\n+             deprecation=\"off\" debug=\"on\" optimize=\"off\"/>\n \n   </target>\n \n \n\n\n", "id": 5351, "time": "2001-09-11T05:02:49Z", "creator": "lvl@bvdep.com", "creation_time": "2001-09-11T05:02:49Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 3545, "attachment_id": null, "is_private": false, "id": 5354, "time": "2001-09-11T07:18:47Z", "creator": "remm@apache.org", "creation_time": "2001-09-11T07:18:47Z", "text": "I'll check with Craig, but I don't think he meant to state that they were \noptional."}, {"count": 3, "tags": [], "text": "Later on in BUILDING.txt, you will find that the JAF and JavaMail requirements\nare explicitly stated.  However, I forgot to remove the old \"optional\"\nparagraph.  This has now been corrected for the version that will be in RC2.\n", "attachment_id": null, "bug_id": 3545, "id": 5361, "time": "2001-09-11T10:27:28Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-09-11T10:27:28Z", "is_private": false}]
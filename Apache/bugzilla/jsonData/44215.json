[{"count": 0, "tags": [], "creator": "yuelu@stanford.edu", "is_private": false, "text": "I was trying to use JkUnMount directive to have gif files served by apache\ninstead of tomcat.  The gif files are originally in the\nwebapps/selfservice/images directory.  I copied them to the\n/var/www/html/selfservice/images directory. I am getting apache error message:\n\n******************************************************************************\nYou don't have permission to access /selfservice/images/welcome.gif on this server.\n******************************************************************************\n\nHowever if I add a rewrite rule:\n\n******************************************************************************\nRewriteRule ([^\\/\\.]+)\\.(gif|jpg|jpeg|png|wbmp)$ /selfservice/images/$1.$2 [L]\n******************************************************************************\n\nit works fine.\n\nMy apache conf file is as follows:\n\n**********************************************\nDocumentRoot /var/www/html\n\nLoadModule jk_module modules/mod_jk.so\nJkWorkersFile \"/etc/httpd/workers.properties\"\nJkLogFile \"/var/log/httpd/mod_jk.log\"\nJkLogLevel debug\nJkAutoAlias /usr/share/tomcat5/webapps\nJkMount /selfservice/* worker1\nJkUnMount /selfservice/*.html worker1\nJkUnMount /selfservice/*.jpg  worker1\nJkUnMount /selfservice/*.gif  worker1\n\n<VirtualHost *:80>\n    ServerName  www.examples.com\n    ServerAlias examples\n    DocumentRoot /var/www/html\n</VirtualHost>\n********************************************\n\nThe version of mod_jk is 1.2.21, apache is 2.0.52, tomcat is 5.5.25.", "id": 112774, "time": "2008-01-11T13:15:32Z", "bug_id": 44215, "creation_time": "2008-01-11T13:15:32Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 44215, "text": "Out your JkMount/JkUnMount into the virtual host or add JkMountCopy On into the \nvirtual host.\n\nNot sure, what you are using \"JkAutoAlias /usr/share/tomcat5/webapps\" for, \nsince you copied the static images to the appropriate DocumentRoot subfolder.\n\nI'm closing this as \"WORKSFORME\", because it's most likely a configuration \nissue.\n\nIn case of moving the Jk(Un)Mount into the vhost doesn't help, please do also \nprovide\n\n- the contents of the httpd error logs\n- the original URL your are using when trying to retrieve the image\n", "id": 112779, "time": "2008-01-12T03:48:25Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-01-12T03:48:25Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "Sorry, typo in previous comment: Out -> Put", "id": 112780, "time": "2008-01-12T03:52:37Z", "bug_id": 44215, "creation_time": "2008-01-12T03:52:37Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 44215, "text": "Thanks for your response.  The image files and jsp files are both under the\n/usr/share/tomcat5/webapps/selfservice directory.  For performance improvement,\nwe want to serve the static files directly from apache, but jsp files from\ntomcat.  That's why we need to have JkAutoAlias /usr/share/tomcat5/webapps in\nthe conf file.\n\nHere is what we see:\nWe request the URL http://www.examples.com/selfservice/images/welcome.gif, but\nwe got permission denied error:\n\n*******************************************************************************\n[Mon Jan 14 10:50:01 2008] [notice] Apache/2.0.52 (Red Hat) configured --\nresuming normal operations\n[Mon Jan 14 10:50:39 2008] [error] [client 171.64.19.235] (13)Permission denied:\naccess to /selfservice/images/welcome.gif denied\n*******************************************************************************  \n\nNote there is no welcome.gif file in\n/usr/share/tomcat5/webapps/selfservice/image (we removed it), but there is one\nin /var/www/html/selfservice/images.  The file permission on\n/var/www/html/selfservice/images is OK because if we use mod_rewrite the files\nare served correctly.\n\nWe added \"JkMountCopy On\" in virtual host directive as you suggested, but it\nmade no difference.\n\nHere is the current conf file:\n\n*************************************************\nDocumentRoot /var/www/html\n\n# load mod_jk\n#LoadModule jk_module modules/mod_jk.so\nJkWorkersFile \"/etc/httpd/workers.properties\"\nJkLogFile \"/var/log/httpd/mod_jk.log\"\nJkLogLevel debug\nJkAutoAlias /usr/share/tomcat5/webapps\nJkMount /selfservice/* worker1\nJkUnMount /selfservice/*.html worker1\nJkUnMount /selfservice/*.jpg  worker1\nJkUnMount /selfservice/*.gif  worker1\n\n<VirtualHost *:80>\n    ServerName  www.examples.com\n    ServerAlias examples\n    JkMountCopy On\n    DocumentRoot /var/www/html\n</VirtualHost>\n************************************************\n", "count": 3, "id": 112836, "time": "2008-01-14T11:10:32Z", "creator": "yuelu@stanford.edu", "creation_time": "2008-01-14T11:10:32Z", "is_private": false}, {"count": 4, "tags": [], "creator": "rainer.jung@kippdata.de", "is_private": false, "text": "I tested your setup. I have two different types of answers.\n\nPart I: Questioning your setup\n\nThere are two things, which are in conflict in your setup:\n\n- you set a JkAutoAlias. This says: if there is a JkMount in a vhost, but a \nrequest does not match, then look for the file below the directory given in the \nJkAutoAlias.\n\n- you say, that the file does *not* exist in the appropriate sub directory of \nthe directory given in JkAutoAlias, and instead it exists below the \nDocumentRoot.\n\nSo it looks like you want to serve the static content from the DocumentRoot. In \nthis case simply remove the JkAutoAlias.\n\n\nPart II: Testing your setup\n\n1) JK version 1.2.21 as indicated in your first post: when requesting\n\nhttp://www.examples.com/selfservice/images/welcome.gif\n\nthe config resolves this to\n\n- do not forward to Tomcat\n- use the JkAutoAlias\n- return with file /usr/share/tomcat5/webapps/selfservice/images/welcome.gif\n\nAs you can see from Part I, this works as desinged. It actually works with or \nwithout JkMountCopy. No rewrite rule needed. The Jk log shows debug log lines\n\n... [16927:0006] [debug] jk_translate::mod_jk.c (2878): check \nalias_dir: /usr/share/tomcat5/webapps\n... [16927:0006] [debug] jk_translate::mod_jk.c (2904): AutoAlias child_dir: \ntest.html\n... [16927:0006] [debug] jk_translate::mod_jk.c (2939): AutoAlias OK for \nfile: /usr/share/tomcat5/webapps/selfservice/test.html\n\nThe fact, that it works without JkMountCopy is a bug in 1.2.21.\n\n2) Version 1.2.26: does *not* work either with or without JkMountCopy. Should \nwork with JkMountCopy, but does not, because when cleaning up the mount \nhandling in vhosts, we treated JkAutoAlias wrong :(\n\nSo: which version are you actually testing against? Is it still really 1.2.21, \nlike you posted in your first message?\n\nConcerning 1.2.26, the following patch against 1.2.26 should do the trick:\n\n--- mod_jk.c.orig       2007-12-14 19:50:44.000000000 +0100\n+++ mod_jk.c    2008-01-14 21:28:01.000000000 +0100\n@@ -2551,6 +2551,8 @@\n         }\n         if (!overrides->mount_file)\n             overrides->mount_file = base->mount_file;\n+    }\n+    if (overrides->mountcopy == JK_TRUE) {\n         if (!overrides->alias_dir)\n             overrides->alias_dir = base->alias_dir;\n     }\n\nQuestions:\n\n- which jk version?\n- do you want to serve the files from the DocumentRoot or from the JkAutoAlias \ndirectory?\n- does the file exist there?\n- if you only request one of those static files, what's the jk debog log output?\n", "id": 112838, "time": "2008-01-14T12:45:16Z", "bug_id": 44215, "creation_time": "2008-01-14T12:45:16Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "yuelu@stanford.edu", "text": "It turns out that apache doesn't have read permission to\n/usr/share/tomcat5/webapps.  Sorry about the false alarm.  I have closed the bug.", "id": 112846, "time": "2008-01-14T18:50:16Z", "bug_id": 44215, "creation_time": "2008-01-14T18:50:16Z", "is_private": false, "attachment_id": null}]
[{"attachment_id": null, "tags": [], "bug_id": 12570, "is_private": false, "count": 0, "id": 22736, "time": "2002-09-12T10:58:32Z", "creator": "rune.johannesen@digitalrum.com", "creation_time": "2002-09-12T10:58:32Z", "text": "I have noticed a problem using the configureAndWatch option of the \nDOMConfigurator. I suspect the same problem to apply to the \nPropertyConfigurator as well.\n\nFirst I run a test program logging with this initial config file:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE log4j:configuration SYSTEM \"log4j.dtd\">\n<log4j:configuration threshold=\"null\">\n    <appender name=\"console\" class=\"org.apache.log4j.ConsoleAppender\">\n        <layout class=\"org.apache.log4j.PatternLayout\">\n            <param name=\"ConversionPattern\" value=\"%-25d{yyyy-MM-dd  \nHH:mm:ss.SSS}  %-5p  %F:%L  %m%n\"/>\n        </layout>\n    </appender>\n    <root>\n        <priority value=\"debug\"/>\n        <appender-ref ref=\"console\"/>                         \n    </root>\n</log4j:configuration>\n\nThis works fine, all the logging statements\n\n    \t_logClass.info(\"info\");\n    \t_logClass.debug(\"debug\");\n    \t_logClass.warn(\"warn\");\n    \t_logClass.error(\"error\");\n    \t_logClass.fatal(\"fatal\");\n\nare displayed in the console.\n\nThen I change the file to use threshold=\u201dwarn\u201d in the log4j:configuration \nelement. The change applies immediately. However, if I change the file back to \nthreshold=\u201dnull\u201d (and save it, of course), the change is not adopted. If I \nrestart the program it starts logging all the levels again.\n\nIn version 1.1.4 of Log4j the DOMConfigurator inherited a resetConfiguration \nmethod from its superclass BasicConfigurator, which solved the problem (calling \nresetConfiguration() before doConfigure()). I think the configurations need to \nbe reset before they are reconfigured to ensure a consistent behaviour.\n\n\n\nBest regards\n \nRune Toalango Johannesen\n\nDigital Rum Limited\n264A Belsize Road\nLondon NW6 4BT\nTelephone: +44 20 76 04 20 19 (direct)\nFax: +44 20 76 04 20 01"}, {"attachment_id": null, "tags": [], "bug_id": 12570, "text": "\nthreshold=null is not a valid instruction.", "count": 1, "id": 24169, "time": "2002-10-09T00:23:10Z", "creator": "ceki@apache.org", "creation_time": "2002-10-09T00:23:10Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 12570, "attachment_id": null, "text": "According to the DTD \"null\" is a valid value for threshold:\n\n<!ATTLIST log4j:configuration\n\txmlns:log4j CDATA #FIXED \"http://jakarta.apache.org/log4j/\"\n\tthreshold (all | debug | info | warn | error | fatal | off | \nnull) \"null\"\n\tdebug (true | false | null) \"null\"\n>\n\nAs you can see it is actually the default value.\n\nThe initial startup doesn't complain about it either, and it works as expected \n(all loggings are displayed).", "id": 24200, "time": "2002-10-09T13:05:50Z", "creator": "rune.johannesen@digitalrum.com", "creation_time": "2002-10-09T13:05:50Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 12570, "attachment_id": null, "text": "\nMy bad. I rechecked and there is indeed a bug in the way DOMConfigurator \nhandles the threshold attribute. It'll be fixed in 1.2.7. Thanks for insisting.", "id": 24215, "time": "2002-10-09T17:23:37Z", "creator": "ceki@apache.org", "creation_time": "2002-10-09T17:23:37Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 12570, "is_private": false, "text": "\nWell, actually the existing code is correct. The log4j.dtd is misleading. The \nthreshold field of a repository cannot be set to null. The \"null\" value for the \nthreshold attribute simply means don't touch the threshold field, the threshold \nfield keeps its old value. ", "id": 24230, "time": "2002-10-09T20:02:18Z", "creator": "ceki@apache.org", "creation_time": "2002-10-09T20:02:18Z", "attachment_id": null}]
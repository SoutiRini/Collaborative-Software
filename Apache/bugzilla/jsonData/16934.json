[{"count": 0, "tags": [], "bug_id": 16934, "attachment_id": null, "is_private": false, "id": 31020, "time": "2003-02-10T17:15:45Z", "creator": "rich.naylor@active-endpoints.com", "creation_time": "2003-02-10T17:15:45Z", "text": "When the BuildNumber task is executed, it sets a build.number property which \ncan then be referenced from within the ant build file. Unfortunately, it is \nsetting it to the previous build number before it was incremented and not the \nnew build number. Is this performing as designed or truly an error. I really \nneed to have the new build number, and I'm currently using some javascript code \nto work around this. Thanks"}, {"count": 1, "text": "Could you attach a build file snippet, please?", "bug_id": 16934, "attachment_id": null, "id": 31063, "time": "2003-02-11T12:17:29Z", "creator": "conor@apache.org", "creation_time": "2003-02-11T12:17:29Z", "tags": [], "is_private": false}, {"count": 2, "text": "      <!-- Increment the build number using the built in ant tag. -->\n      <buildnumber file=\"ae.version\"/>\n      \n      <!-- Now we need to use some javascript manipulation to get the new build \nnumber. Ant -->\n      <!-- sets the build.number property to the previous version instead of \ncurrent one!!  -->\n      <script language=\"javascript\"> <![CDATA[\n      var lBuildNumber = parseInt(project.getProperty(\"build.number\")) + 1;\n      project.setProperty(\"build.number\", lBuildNumber);]]> \n      </script>\n", "bug_id": 16934, "attachment_id": null, "id": 31073, "time": "2003-02-11T14:15:56Z", "creator": "rich.naylor@active-endpoints.com", "creation_time": "2003-02-11T14:15:56Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "text": "This is by design. From the docs\n\nIt will first attempt to read a build number from a file (by default,\nbuild.number in the current directory), then set the property build.number to\nthe value that was read in (or to 0, if no such value). It will then increment\nthe number by one and write it back out to the file.\n\nSo, the contents of the file will always be one ahead of the property in the build.\n\nTo achieve the result you want, try this instead.\n\n      <propertyfile file=\"ae.version\">\n        <entry key=\"build.number\" type=\"int\" operation=\"+\" value=\"1\"/>\n      </propertyfile>\n      <property file=\"ae.version\"/>\n", "is_private": false, "id": 34156, "creator": "conor@apache.org", "time": "2003-03-31T06:17:56Z", "bug_id": 16934, "creation_time": "2003-03-31T06:17:56Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Your suggestion works fine as long as there is an existing version file. \nOtherwise I get the following stack trace only on the initial execution when \nthere is no existing property file.\n\n[propertyfile] Creating new property file: C:\\temp\\build.txt\n[propertyfile] java.lang.NullPointerException\n[propertyfile]  at java.text.DecimalFormat.parse(DecimalFormat.java:1044)\n[propertyfile]  at java.text.NumberFormat.parse(NumberFormat.java:312)\n[propertyfile]  at \norg.apache.tools.ant.taskdefs.optional.PropertyFile$Entry.executeIntege\nr(PropertyFile.java:477)\n[propertyfile]  at \norg.apache.tools.ant.taskdefs.optional.PropertyFile$Entry.executeOn(Pro\npertyFile.java:392)\n[propertyfile]  at \norg.apache.tools.ant.taskdefs.optional.PropertyFile.executeOperation(Pr\nopertyFile.java:197)\n[propertyfile]  at org.apache.tools.ant.taskdefs.optional.PropertyFile.execute\n(PropertyFile.java:184)\n[propertyfile]  at org.apache.tools.ant.Task.perform(Task.java:319)\n[propertyfile]  at org.apache.tools.ant.Target.execute(Target.java:309)\n[propertyfile]  at org.apache.tools.ant.Target.performTasks(Target.java:336)\n[propertyfile]  at org.apache.tools.ant.Project.executeTarget(Project.java:1306)\n[propertyfile]  at org.apache.tools.ant.Project.executeTargets\n(Project.java:1250)\n[propertyfile]  at org.apache.tools.ant.Main.runBuild(Main.java:610)\n[propertyfile]  at org.apache.tools.ant.Main.start(Main.java:196)\n[propertyfile]  at org.apache.tools.ant.Main.main(Main.java:235)\n     [echo] Build number = 1", "attachment_id": null, "id": 34262, "creator": "rich.naylor@active-endpoints.com", "time": "2003-04-01T17:24:18Z", "bug_id": 16934, "creation_time": "2003-04-01T17:24:18Z", "is_private": false}]
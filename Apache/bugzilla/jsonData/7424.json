[{"count": 0, "tags": [], "bug_id": 7424, "attachment_id": null, "id": 12259, "creation_time": "2002-03-25T04:03:43Z", "time": "2002-03-25T04:03:43Z", "creator": "Ryan.Lubke@Sun.COM", "text": "After tracing through BundleSupport and LocaleSupport classes of\norg/apache/taglibs/standard/tag/core/fmt, I discovered that the preferred\nlocales as provided by the Accept-Language request header were being ignored.\n\nThe problem is that the algorithm will check to see if the context init param,\nor scoped attribute javax.servlet.jsp.jstl.fmt.locale was set before\ninterrogating the browser locales.  This is correct based on the spec, however,\nthe problem lies in LocaleSupport.parseLocale(String, String) - line 170.  If a\nnull value was returned, as it would be of javax.servlet.jsp.jstl.fmt.locale was\nnot set, parseLocale(String, String) will return the default locale of the\nsystem where the container runs, and thus return a value when none should be\nreturned (See line 221 of BundleSupport).  Based on the spec (Section 8.3.2,\npage 8-73), I would think that consideration of the containers default locale\nwould be illegal.\n\nI changed the null check in LocalSupport.parseLocale(String, String) to return\nnull instead of the default locale (see diff below) and the algorithm began to\nwork as expected.  I haven't spent the time to see if the diff below has any\nside effects, but I believe this is enough information to correct the issue.\n\n*****************************************************************\nIndex: LocaleSupport.java\n===================================================================\nRCS file:\n/home/cvs/jakarta-taglibs/standard/src/org/apache/taglibs/standard/tag/common/fmt/LocaleSupport.java,v\nretrieving revision 1.14\ndiff -u -r1.14 LocaleSupport.java\n--- LocaleSupport.java\t23 Mar 2002 01:33:50 -0000\t1.14\n+++ LocaleSupport.java\t25 Mar 2002 03:55:29 -0000\n@@ -175,7 +175,8 @@\n \tint index = -1;\n \n \tif ((locale == null) || locale.equals(\"\")) {\n-\n    return Locale.getDefault();\n+\n    //return Locale.getDefault();\n+        return null;\n \t}\n \n \tif (((index = locale.indexOf(HYPHEN)) > -1)\n*************************************************************", "is_private": false}, {"count": 1, "tags": [], "bug_id": 7424, "attachment_id": null, "id": 12263, "time": "2002-03-25T04:11:55Z", "creator": "Ryan.Lubke@Sun.COM", "creation_time": "2002-03-25T04:11:55Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of 7423 ***"}]
[{"count": 0, "tags": [], "bug_id": 10707, "text": "It would be nice if we can have the <mapper> feature in <delete> like <copy>.\nThis is good if we want to delete only the files with certain extension but not \nall files with that extension.\n\ne.x.\nSQLJ generates .java and .ser file from .sqlj file. There are other non \nSQLJ .java files in the same directory. We only want to delete the .java files \ngenerated from .sqlj files.\n\nex. \n  <Delete>\n    <fileset dir=\"./src\">\n        <include name=\"**/*.sqlj\"/>\n    </fileset>\n    <mapper type=\"glob\" from=\"**/*.sqlj\" to=\"**/*.java\"/>\n    <mapper type=\"glob\" from=\"**/*.sqlj\" to=\"**/*.ser\"/>\n  </Delete>", "id": 19341, "time": "2002-07-11T17:53:39Z", "creator": "benjachi@yahoo.com", "creation_time": "2002-07-11T17:53:39Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "Upgrade to Ant 1.5 and use a <present> selector in your fileset.", "id": 19375, "time": "2002-07-12T06:11:23Z", "bug_id": 10707, "creation_time": "2002-07-12T06:11:23Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 10707, "attachment_id": null, "id": 19397, "time": "2002-07-12T14:30:03Z", "creator": "benjachi@yahoo.com", "creation_time": "2002-07-12T14:30:03Z", "is_private": false, "text": "It doesn't support multiple <mapper>. Can we add it?\n\nSo, e.x. ABC.sqlj maps to two files: ABC.ser, and ABC.java.\n\nThanks,\nBenjamin"}, {"count": 3, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "No task that accepts mappers supports more than one.\n\nYou have two choices here:\n\n(1) Write your own mapper that returns two file names (borrow from <rmic>).\n(2) Simply use two filesets.", "id": 19398, "time": "2002-07-12T14:35:56Z", "bug_id": 10707, "creation_time": "2002-07-12T14:35:56Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 10707, "attachment_id": null, "text": "Another option would be to wrap two <present> selectors in an <or> selector, \nlike this:\n\n\n  <Delete>\n    <fileset dir=\"./src\">\n        <include name=\"**/*.sqlj\"/>\n    </fileset>\n    <or>\n        <present>\n            <mapper type=\"glob\" from=\"**/*.sqlj\" to=\"**/*.java\"/>\n        </present>\n        <present>\n            <mapper type=\"glob\" from=\"**/*.sqlj\" to=\"**/*.ser\"/>\n        </present>\n    </or>\n  </Delete>", "id": 19415, "time": "2002-07-12T15:44:23Z", "creator": "bruce@callenish.com", "creation_time": "2002-07-12T15:44:23Z", "is_private": false}, {"count": 5, "tags": [], "text": "Oops, typo. Move the closing </fileset> tag to after the selectors.", "attachment_id": null, "id": 19416, "creator": "bruce@callenish.com", "time": "2002-07-12T15:45:54Z", "bug_id": 10707, "creation_time": "2002-07-12T15:45:54Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 10707, "attachment_id": null, "id": 19418, "time": "2002-07-12T15:58:57Z", "creator": "holtdl@yahoo.com", "creation_time": "2002-07-12T15:58:57Z", "is_private": false, "text": "I'm not sure I understand why you need to map for both .java and .ser, since \nyou say you only want to remove the generated .java files, so it seems like \njust mapping from .sqlj to .java will get you the files you want.\n\nBut in any case, while you can't put two mappers within the same <present>, you \ncan in fact <and> two <present> selectors, each of which has a <mapper>."}, {"count": 7, "tags": [], "bug_id": 10707, "attachment_id": null, "id": 19427, "time": "2002-07-12T17:03:49Z", "creator": "benjachi@yahoo.com", "creation_time": "2002-07-12T17:03:49Z", "is_private": false, "text": "Thanks. I create a modified Delete task that takes multiple Mapper.\n\nI optimized the directory scan to be done once only for 1..n mappers. This way \nwhen I delete files that were generated by SQLJ (SQLJ generates two \nfiles .java and .ser files from a single .sqlj file.) The Delete would only \nscan the drive once, and delete those .java .ser files if exists. \n\nIt takes about 35 seconds to scan our clearcase drive, if they were seperate \nscan and it would take 70 seconds.\n\nWill the last ANT task given do two directory scan or one?\n\nThanks!\nBenjamin Chi"}, {"count": 8, "tags": [], "bug_id": 10707, "text": "I misread your problem. Here is how I would do what you are asking for using \nselectors:\n\n<delete>\n  <fileset dir=\"./src\">\n    <or>\n      <and>\n        <filename name=\"**/*.java\"/>\n        <present targetdir=\"./src\">\n          <mapper type=\"glob\" from=\"*.java\" to=\"*.sqlj\"/>\n        </present>\n      </and>\n      <and>\n        <filename name=\"**/*.ser\"/>\n        <present targetdir=\"./src\">\n          <mapper type=\"glob\" from=\"*.java\" to=\"*.sqlj\"/>\n        </present>\n      </and>\n    </or>\n  </fileset>\n</delete>\n\nI haven't actually tested this but it should be approximately right. If not, it \nshould be clear what you need to fix, anyway.\n", "id": 19432, "time": "2002-07-12T17:34:44Z", "creator": "bruce@callenish.com", "creation_time": "2002-07-12T17:34:44Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 10707, "text": "Thanks! That works!", "id": 19437, "time": "2002-07-12T17:53:41Z", "creator": "benjachi@yahoo.com", "creation_time": "2002-07-12T17:53:41Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 10707, "attachment_id": null, "id": 19440, "time": "2002-07-12T18:25:28Z", "creator": "benjachi@yahoo.com", "creation_time": "2002-07-12T18:25:28Z", "is_private": false, "text": "hmm, I thought it worked. \nIt's deleting .java files, but not .ser files.\n\nThis is what I have:\n\t<delete verbose=\"true\">\n\t  <fileset dir=\"${cc.src}\">\n\t\t<or>\n\t\t  <and>\n\t\t\t<filename name=\"**/*.java\"/>\n\t\t\t<present targetdir=\"${cc.src}\">\n\t\t\t  <mapper type=\"glob\" from=\"*.java\" to=\"*.sqlj\"/>\n\t\t\t</present>\n\t\t  </and>\n\t\t  <and>\n\t\t\t<filename name=\"**/*.ser\"/>\n\t\t\t<present targetdir=\"${cc.src}\">\n\t\t\t  <mapper type=\"glob\" from=\"*.ser\" to=\"*.sqlj\"/>\n\t\t\t</present>\n\t\t  </and>\n\t\t</or>\n\t  </fileset>\n\t</delete>"}, {"count": 11, "tags": [], "bug_id": 10707, "attachment_id": null, "text": "I see, the .ser file name has additional name appended \"_SJProfile0.ser\"\n\nIt's working now:\n\t<delete verbose=\"true\">\n\t  <fileset dir=\"${cc.src}\">\n\t\t<or>\n\t\t  <and>\n\t\t\t<filename name=\"**/*.java\"/>\n\t\t\t<present targetdir=\"${cc.src}\">\n\t\t\t  <mapper type=\"glob\" from=\"*.java\" to=\"*.sqlj\"/>\n\t\t\t</present>\n\t\t  </and>\n\t\t  <and>\n\t\t\t<filename name=\"**/*.ser\"/>\n\t\t\t<present targetdir=\"${cc.src}\">\n\t\t\t  <mapper type=\"glob\" from=\"*_SJProfile0.ser\" \nto=\"*.sqlj\"/>\n\t\t\t</present>\n\t\t  </and>\n\t\t</or>\n\t  </fileset>\n\t</delete>", "id": 19441, "time": "2002-07-12T18:30:46Z", "creator": "benjachi@yahoo.com", "creation_time": "2002-07-12T18:30:46Z", "is_private": false}]
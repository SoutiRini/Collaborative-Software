[{"count": 0, "tags": [], "creator": "jleslie@placebase.com", "is_private": false, "text": "mod_jk registers its cleanup handler to be called both during plain_cleanup and child_cleanup:\n\n  apr_pool_cleanup_register(p, s, jk_apr_pool_cleanup, jk_apr_pool_cleanup);\n\nSo, whenever a server forks a child, ie, when mod_cgi creates its child process, jk_apr_pool_cleanup() gets called.  jk_apr_pool_cleanup() does a shutdown() on its sockets, which closes down the socket for the parent process.\n\nMaybe it should use close() instead of shutdown(), or be registered as apr_pool_cleanup_register(p, s, jk_apr_pool_cleanup, jk_apr_pool_cleanup_null); ?\n\nNote, with mod_jk 1.2.18, a load balancing worker isn't able to recover from this, and it brings down the whole LB worker for awhile.  1.2.27 seems to be able to recover.\n\nAfter a CGI is hit and jk's sockets get closed underneath it, the logs look like:\n\n[Wed Jan 28 21:39:50 2009] [22841:42432] [info]  ajp_send_request::jk_ajp_common.c (1178): Socket 75 is not connected any more (errno=-1)\n[Wed Jan 28 21:39:50 2009] [22841:42432] [info]  ajp_send_request::jk_ajp_common.c (1202): Error sending request. Will try another pooled connection\n[Wed Jan 28 21:39:50 2009] [22841:42432] [info]  ajp_send_request::jk_ajp_common.c (1224): All endpoints are disconnected or dead\n[Wed Jan 28 21:39:50 2009] [22841:42432] [info]  ajp_service::jk_ajp_common.c (1783): Sending request to tomcat failed,  recoverable operation attempt=1", "id": 124503, "time": "2009-01-29T14:52:42Z", "bug_id": 46632, "creation_time": "2009-01-29T14:52:42Z", "attachment_id": null}, {"text": "Fixed in the SVN.\n\nIf needed the child cleanup certainly cannot be the same as standard pool cleanup we are using currently.", "tags": [], "creator": "mturk@apache.org", "is_private": false, "count": 1, "id": 133005, "time": "2009-12-21T03:26:27Z", "bug_id": 46632, "creation_time": "2009-12-21T03:26:27Z", "attachment_id": null}, {"count": 2, "text": "Will be part of 1.2.29.", "bug_id": 46632, "is_private": false, "id": 134801, "time": "2010-02-23T02:48:07Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2010-02-23T02:48:07Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "creator": "letuan88153@zing.vn", "text": "Name: Le Van Tuan\nClass: LPI- IP-MAC\nCountry: Viet Nam", "id": 135904, "attachment_id": null, "bug_id": 46632, "creation_time": "2010-04-06T14:54:53Z", "time": "2010-04-06T14:54:53Z", "is_private": false}, {"count": 4, "tags": [], "creator": "letuan88153@zing.vn", "attachment_id": null, "text": "Name: Le Van Tuan\nClass: LPI- IP-MAC\nCountry: Viet Nam", "id": 135905, "time": "2010-04-06T14:57:01Z", "bug_id": 46632, "creation_time": "2010-04-06T14:57:01Z", "is_private": false}, {"count": 5, "text": "Spam removal", "bug_id": 46632, "attachment_id": null, "id": 135906, "time": "2010-04-06T15:00:58Z", "creator": "markt@apache.org", "creation_time": "2010-04-06T15:00:58Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "is_private": false, "id": 135919, "time": "2010-04-06T22:52:25Z", "bug_id": 46632, "creation_time": "2010-04-06T22:52:25Z", "text": "Restoring the original value of OS/Version field."}]
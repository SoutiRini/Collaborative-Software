[{"count": 0, "tags": [], "text": "Directory /srv/www/html/dir>\n Order allow,deny\n Allow from all\n     <IfModule mod_ssl.c>\n      DAV on\n      SSLOptions +StrictRequire\n      SSLVerifyClient require\n      SSLVerifyDepth 10\n      SSLRequire       %{SSL_CLIENT_S_DN_C} eq \"DE\"\n     </IfModule>\n</Directory>\n\nDirectory /srv/www/html/dir/subdir>\n Order allow,deny\n Allow from all\n     <IfModule mod_ssl.c>\n      DAV on\n      SSLOptions +StrictRequire\n      SSLVerifyClient require\n      SSLVerifyDepth 10\n      SSLRequire       %{SSL_CLIENT_S_DN_C} eq \"DK\"\n     </IfModule>\n</Directory>\n\n1.  Using webdavs to access /dir\n\n2. Using a DE certificate, it is possible to get access to /dir\nwhere dir/subdir is also shown.  Under webdavs, it is also possible\nto get access to /dir/subdir  Is that \"expected\" behaviour?\n\n3.  After getting access to /dir/subdir, where it is possible to see\nthe files in /dir/subdir, attempts to access \nsubdirectories /dir/subdir/subsubdir are rejected (according to the\nerror message in the log file, because the \"Requirement expression not \nfulfilled\"  (as it should)\n\n3.  If one attempts to access /dir/subdir directory (via URL, either via https: \nor webdavs:), then it is rejected with the \"Requirement expression not \nfulfilled\" (as it should)", "attachment_id": null, "bug_id": 41911, "id": 100707, "time": "2007-03-20T20:29:02Z", "creator": "seth@psydpu.adsl.dk", "creation_time": "2007-03-20T20:29:02Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 41911, "is_private": false, "id": 100973, "time": "2007-03-26T13:28:36Z", "creator": "basant.kukreja@sun.com", "creation_time": "2007-03-26T13:28:36Z", "tags": [], "text": "As you written in your second point :\n>2. Using a DE certificate, it is possible to get access to /dir\n>where dir/subdir is also shown.  Under webdavs, it is also possible\n>to get access to /dir/subdir  Is that \"expected\" behaviour?\n\nI could not reproduce the issue. Here is my experimentation :\n\nHere is my configuration :\n\n<Directory \"/disk/apache/apache2/htdocs/test\">\n Order allow,deny\n Allow from all\n    Options Indexes\n     <IfModule mod_ssl.c>\n      DAV on\n      SSLOptions +StrictRequire\n      SSLVerifyClient require\n      SSLVerifyDepth 10\n      SSLRequire       %{SSL_CLIENT_S_DN_C} eq \"US\"\n     </IfModule>\n</Directory>\n\n<Directory \"/disk/apache/apache2/htdocs/test/subdir\">\n Order allow,deny\n Allow from all\n     Options Indexes\n     <IfModule mod_ssl.c>\n      DAV on\n      SSLOptions +StrictRequire\n      SSLVerifyClient require\n      SSLVerifyDepth 10\n      SSLRequire       %{SSL_CLIENT_S_DN_C} eq \"DE\"\n     </IfModule>\n</Directory>\n\n\nUsing \"US\" based client certificate when I send the /test/ request then I\ndon't see the subdir in directory listing.\n\n------------------------------------------------------\n[/disk/apache/apache2] $ curl --cacert ./certs/rootcert.pem  -E\ncerts/client1.pem:password --dump-header - -o - https://lbasantk3:4005/test/\nHTTP/1.1 200 OK\nDate: Mon, 26 Mar 2007 20:09:53 GMT\nServer: Apache/2.2.5-dev (Unix) mod_ssl/2.2.5-dev OpenSSL/0.9.8a DAV/2\nContent-Length: 256\nContent-Type: text/html\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\n<html>\n <head>\n  <title>Index of /test</title>\n </head>\n <body>\n<h1>Index of /test</h1>\n<ul><li><a href=\"/\"> Parent Directory</a></li>\n<li><a href=\"test.html\"> test.html</a></li>\n</ul>\n</body></html>\n------------------------------------------------------\n\n\nIf I try to access /test/subdir/ then I get permission\n------------------------------------------------------\n[/disk/apache/apache2] $ curl --cacert ./certs/rootcert.pem  -E\ncerts/client1.pem:password --dump-header - -o - https://lbasantk3:4005/test/subdir/\nHTTP/1.1 403 Forbidden\nDate: Mon, 26 Mar 2007 20:10:55 GMT\nServer: Apache/2.2.5-dev (Unix) mod_ssl/2.2.5-dev OpenSSL/0.9.8a DAV/2\nContent-Length: 214\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>403 Forbidden</title>\n</head><body>\n<h1>Forbidden</h1>\n<p>You don't have permission to access /test/subdir/\non this server.</p>\n</body></html>\n------------------------------------------------------\n\n\n\nNow If I change the subdirectory configuration e.g\n\n<Directory \"/disk/apache/apache2/htdocs/test/subdir\">\n Order allow,deny\n Allow from all\n     Options Indexes\n     <IfModule mod_ssl.c>\n      DAV on\n      SSLOptions +StrictRequire\n      SSLVerifyClient require\n      SSLVerifyDepth 10\n      SSLRequire       %{SSL_CLIENT_S_DN_C} eq \"US\"\n     </IfModule>\n</Directory>\n\n[/disk/apache/apache2] $ bin/apachectl restart \n\nNow if I send the request again then I see the \"/subdir\" as part of my\nlisting.\n------------------------------------------------------\n[/disk/apache/apache2] $ curl --cacert ./certs/rootcert.pem  -E\ncerts/client1.pem:password --dump-header - -o - https://lbasantk3:4005/test/\nHTTP/1.1 200 OK\nDate: Mon, 26 Mar 2007 20:11:17 GMT\nServer: Apache/2.2.5-dev (Unix) mod_ssl/2.2.5-dev OpenSSL/0.9.8a DAV/2\nContent-Length: 296\nContent-Type: text/html\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\n<html>\n <head>\n  <title>Index of /test</title>\n </head>\n <body>\n<h1>Index of /test</h1>\n<ul><li><a href=\"/\"> Parent Directory</a></li>\n<li><a href=\"subdir/\"> subdir/</a></li>\n<li><a href=\"test.html\"> test.html</a></li>\n</ul>\n</body></html>\n------------------------------------------------------\n\nAlso as expected, if I send the /test/subdir/ URI then I get the listing.\n\nKindly provide more information which could be helpful to reproduce the issue.\nAlso kindly provide information about which webdav tool you are using.\n"}, {"count": 2, "tags": [], "creator": "seth@psydpu.adsl.dk", "is_private": false, "id": 100993, "creation_time": "2007-03-26T16:50:26Z", "time": "2007-03-26T16:50:26Z", "bug_id": 41911, "text": "Thank you for your detailed analysis.  \n\nI am using Konqueror 3.5.6  (from KDE) as client, where it is possible\nto use webdavs:// or https:// as a URL.\n\nI was not able to reproduce the problem today. I suspect/believe the \nexplanation is that the certificates were being cached by Konqueror.\nI had suspected this problem, before submitting my report, and therefore\ntried both to restart the server and open a \"new\" Konqueror.  However, I \nbelieve that I did not close ALL the open Konqueror clients, and that seems to\nbe the source of the problem I reported.  (I more or less repeated such an \nexperiment today -- that is, I could reproduce the problem that I reported, but \nI now understand that the problem is with the client and not Apache).\n\nWhile you have your test set up.  I would like to ask a related question.  In \nyour first setup, if you (a) try to access /test/subdir  with (b)) a 'DE \ncertificate), then (c) you will see that it is *impossible* because \n\n [info] Access to /disk/apache/apache2/htdocs/test/subdir/ for 123.456.789.123\n(requirement expression not fulfilled)\n [info] Failed expression: %{SSL_CLIENT_S_DN_C} eq \"US\"\n\nThat is, the SSLRequire from Directory cascades to test/subdir (as it is \nsupposed to), but this makes it impossible then for a person with only a DE \ncertificate to get access to the subdirectory.\n\nI am able to reliably repeat that problem.\n\nAs best as I can tell, this cannot be overcome with a special Boolean \ncombination to SSLRequire, and the way Apache is currently designed, there does \nnot seem any possibility to override this behavior.  \n\nIs there a good reason to maintain that behavior?  Maybe it should be an \nenhancement request to allow the possibility to turn off or override \nthe \"directory cascade\" ?  \n", "attachment_id": null}, {"count": 3, "tags": [], "creator": "basant.kukreja@sun.com", "is_private": false, "id": 100997, "creation_time": "2007-03-26T18:07:43Z", "time": "2007-03-26T18:07:43Z", "bug_id": 41911, "text": "Yes, If I access the /test/subdir using \"DE\" client certificate, I get 403.\n\n-------------------------------------------\n[/disk/apache/apache2] $ curl --cacert ./certs/rootcert.pem  -E\ncerts/client2.pem:password --dump-header - -o -\nhttps://lbasantk3.red.iplanet.com:4005/test/subdir/\nHTTP/1.1 403 Forbidden\nDate: Tue, 27 Mar 2007 00:39:18 GMT\nServer: Apache/2.2.5-dev (Unix) mod_ssl/2.2.5-dev OpenSSL/0.9.8a DAV/2\nContent-Length: 214\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>403 Forbidden</title>\n</head><body>\n<h1>Forbidden</h1>\n<p>You don't have permission to access /test/subdir/\non this server.</p>\n</body></html>\n-------------------------------------------\n\nIn error log, I see \n[Mon Mar 26 17:39:18 2007] [info] Failed expression: %{SSL_CLIENT_S_DN_C} eq \"US\"\n[Mon Mar 26 17:39:18 2007] [error] [client 192.18.120.216] access to\n/disk/apache/apache2/htdocs/test/subdir/ failed, reason: SSL requirement\nexpression not fulfilled (see SSL logfile for more details)\n\nProbably regular expression can help you e.g.\n\n<Directory ~ \"/disk/apache/apache2/htdocs/test$\">\n...\n      SSLRequire       %{SSL_CLIENT_S_DN_C} eq \"US\"\n</Directory>\n\n\nI believe you certainly can write a special module which can be used to check\nthe URI and make such requirements.\n\n\n>Maybe it should be an \n>enhancement request to allow the possibility to turn off or override \n>the \"directory cascade\" ?\nTurning off the \"directory cascade\" is not intuitive and may be considered a\nbig security hole. Unix OS provides a file system and doesn't provide any way\nto set this to off (afaik).\n\nAlso I believe, you can achieve your target by redisigning the\nfiles/directory and place various constraints e.g\n/test : provide constraint like %{SSL_CLIENT_S_DN_C} eq \"US\" or eq \"DE\"\n/test/files_US : if accessibly by client  %{SSL_CLIENT_S_DN_C} eq \"US\"\n/test/files_DE : if accessibly by client  %{SSL_CLIENT_S_DN_C} eq \"DE\"\n\nShould we close this bug as \"Invalid\"?", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 41911, "attachment_id": null, "id": 101017, "time": "2007-03-27T01:57:20Z", "creator": "jorton@redhat.com", "creation_time": "2007-03-27T01:57:20Z", "is_private": false, "text": "Yes, thanks a lot to for the detailed analysis on this."}]
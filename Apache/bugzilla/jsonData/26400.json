[{"count": 0, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "If a jsp lies inside a path, where a directory name e.g. starts with a digit,\nthen /org/apache/jasper/JspC.java produces an invalid package name. I provide a\nsmall patch following.\n\n*** JspC.java.orig      Wed Mar 19 10:20:58 2003\n--- JspC.java   Sun Jun 15 19:22:48 2003\n***************\n*** 998,1006 ****\n--- 998,1011 ----\n          int iSep = jspUri.lastIndexOf('/');\n        // Start after the first slash\n          int nameStart = 1;\n+         int firstIdentifierChar = 1;\n        for (int i = 1; i < iSep; i++) {\n            char ch = jspUri.charAt(i);\n            if (Character.isJavaIdentifierPart(ch)) {\n+               if ( ( firstIdentifierChar == 1 ) && ( !\nCharacter.isJavaIdentifierStart(ch) ) ) {\n+                   modifiedPackageName.append('_');\n+                   firstIdentifierChar=0;\n+               }\n                modifiedPackageName.append(ch);\n            }\n            else if (ch == '/') {\n***************\n*** 1009,1014 ****\n--- 1014,1020 ----\n                  }\n                  nameStart = i+1;\n                modifiedPackageName.append('.');\n+               firstIdentifierChar=1;\n            } else {\n                modifiedPackageName.append(mangleChar(ch));\n            }", "id": 51115, "time": "2004-01-24T20:27:14Z", "bug_id": 26400, "creation_time": "2004-01-24T20:27:14Z", "is_private": false}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "I updated the patch for Tomcat 4.1.30. Please consider including in CVS. The\npatch is based on JspC.java 1.12.2.8 from the branch tomcat_4_branch. For tomcat\n5 this case is already correctly handled (using the same logic), but not in TC 4.\n\n*** 985,998 ****\n--- 985,1005 ----\n       * @param jspUri the context-relative path for the JSP file, starting\n       *  with a slash\n       */\n+ \n      private String toPackageName(String jspUri) {\n          StringBuffer modifiedPackageName = new StringBuffer();\n          int iSep = jspUri.lastIndexOf('/');\n        // Start after the first slash\n          int nameStart = 1;\n+         boolean isFirstIdentifierChar = true;\n        for (int i = 1; i < iSep; i++) {\n            char ch = jspUri.charAt(i);\n            if (Character.isJavaIdentifierPart(ch)) {\n+                 if ( isFirstIdentifierChar &&\n+                   ( !Character.isJavaIdentifierStart(ch)) ) {\n+                     modifiedPackageName.append('_');\n+                     isFirstIdentifierChar = false;\n+                 }\n                modifiedPackageName.append(ch);\n            }\n            else if (ch == '/') {\n***************\n*** 1001,1006 ****\n--- 1008,1014 ----\n                  }\n                  nameStart = i+1;\n                modifiedPackageName.append('.');\n+                 isFirstIdentifierChar = true;\n            } else {\n                modifiedPackageName.append(mangleChar(ch));\n            }\n", "id": 58411, "attachment_id": null, "bug_id": 26400, "creation_time": "2004-05-30T17:09:23Z", "time": "2004-05-30T17:09:23Z", "is_private": false}, {"count": 2, "attachment_id": null, "creator": "markt@apache.org", "text": "This has now been fixed in CVS for TC4 with a slightly modified version of the \npatch given above.", "id": 63428, "time": "2004-09-12T22:02:13Z", "bug_id": 26400, "creation_time": "2004-09-12T22:02:13Z", "tags": [], "is_private": false}]
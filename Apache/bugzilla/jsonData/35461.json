[{"count": 0, "tags": [], "creator": "joerg.cebulla@bertelsmann.de", "text": "We were running Apache 2.0.54 which forwards requests to tomcat\n5.0.28 server using mod_jk/ajp13 and its loadbalancing features.\n\nRunning this combination we were getting a lot of http status 400 error \nmessages in our webservers access logs. The errors are not deterministic. They \nare not caused by calling a special url but are caused by many different calls.\n\nHere is an example:\n\n[21/Jun/2005:11:49:14 +0200] \"GET /content/abo_formular_agb_content.jsp \nHTTP/1.0\" 400 \n16376 \"http://www.premiere.de/content/abo_formular_agb_popup.jsp\" \"Mozilla/4.0 \n(compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)\"\n\nMonitoring the logfile of the mod_jk you can see the following error messages:\n\n [info]  service::jk_lb_worker.c (642): unrecoverable error 400, request \nfailed. Client failed in the middle of request, we can't recover to another \ninstance.\n\nAfter getting the bad request the tomcat server produces a rather long stack \ntrace. Here is an example:\n\n2005 12:02:55 org.apache.jk.common.HandlerRequest invoke\nSCHWERWIEGEND: Error decoding request\njava.net.SocketTimeoutException: Read timed out\n        at java.net.SocketInputStream.socketRead0(Native Method)\n        at java.net.SocketInputStream.read(SocketInputStream.java:129)\n        at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)\n        at java.io.BufferedInputStream.read1(BufferedInputStream.java:256)\n        at java.io.BufferedInputStream.read(BufferedInputStream.java:313)\n        at org.apache.jk.common.ChannelSocket.read(ChannelSocket.java:598)\n        at org.apache.jk.common.ChannelSocket.receive(ChannelSocket.java:535)\n        at org.apache.jk.common.JkInputStream.receive(JkInputStream.java:247)\n        at org.apache.jk.common.HandlerRequest.decodeRequest\n(HandlerRequest.java:500)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:352)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:743)\n        at org.apache.jk.common.ChannelSocket.processConnection\n(ChannelSocket.java:675)\n        at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:866)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:683)\n        at java.lang.Thread.run(Thread.java:595)\n12 34 03 53 02 04 00 08 48 54 54 50 2f 31 2e 31  | .4.S....HTTP/1.1\n00 00 2b 2f 63 6f 6d 6d 6f 6e 2f 63 75 73 74 6f  | ..+/common/custom\n6d 65 72 2f 62 6f 75 6e 64 61 72 79 2f 6c 6f 67  | mer/boundary/log\n69 6e 5a 69 70 63 6f 64 65 52 48 2e 64 6f 00 00  | inZipcodeRH.do..\n0d 31 39 35 2e 39 33 2e 36 30 2e 31 30 35 00 ff  | .195.93.60.105.?\nff 00 0f 77 77 77 2e 70 72 65 6d 69 65 72 65 2e  | ?..www.premiere.\n64 65 00 00 50 00 00 0d 00 0d 43 61 63 68 65 2d  | de..P.....Cache-\n43 6f 6e 74 72 6f 6c 00 00 08 6e 6f 2d 63 61 63  | Control...no-cac\n68 65 00 00 03 56 69 61 00 00 6d 48 54 54 50 2f  | he...Via..mHTTP/\n31 2e 31 20 28 56 65 6c 6f 63 69 74 79 2f 31 2e  | 1.1 (Velocity/1.\n31 2e 31 20 5b 75 53 63 4d 73 20 66 20 70 20 65  | 1.1 [uScMs f p e\n4e 3a 74 20 63 43 4d 70 20 73 20 5d 29 2c 20 48  | N:t cCMp s ]), H\n54 54 50 2f 31 2e 30 20 66 72 72 2d 61 64 30 33  | TTP/1.0 frr-ad03\n5b 43 33 35 44 33 43 36 39 5d 20 28 54 72 61 66  | [C35D3C69] (Traf\n66 69 63 2d 53 65 72 76 65 72 2f 35 2e 33 2e 38  | fic-Server/5.3.8\n20 5b 75 53 63 4d 5d 29 00 a0 03 00 0d 67 7a 69  |  [uScM]).?...gzi\n70 2c 20 64 65 66 6c 61 74 65 00 a0 09 00 44 4a  | p, deflate.?..DJ\n53 45 53 53 49 4f 4e 49 44 3d 38 36 37 45 30 38  | SESSIONID=867E08\n33 41 41 32 32 44 34 30 30 38 35 41 46 39 43 35  | 3AA22D40085AF9C5\n43 41 33 32 37 44 39 32 41 46 2e 41 53 54 50 50  | CA327D92AF.ASTPP\n52 4d 31 39 3b 20 63 6f 6f 6b 69 65 63 68 65 63  | RM19; cookiechec\n6b 3d 31 00 a0 0c 00 08 6e 6f 2d 63 61 63 68 65  | k=1.?...no-cache\n00 a0 08 00 03 31 36 32 00 a0 0e 00 53 4d 6f 7a  | .?...162.?..SMoz\n69 6c 6c 61 2f 34 2e 30 20 28 63 6f 6d 70 61 74  | illa/4.0 (compat\n69 62 6c 65 3b 20 4d 53 49 45 20 36 2e 30 3b 20  | ible; MSIE 6.0;\n41 4f 4c 20 39 2e 30 3b 20 57 69 6e 64 6f 77 73  | AOL 9.0; Windows\n20 4e 54 20 35 2e 31 3b 20 53 56 31 3b 20 2e 4e  |  NT 5.1; SV1; .N\n45 54 20 43 4c 52 20 31 2e 31 2e 34 33 32 32 29  | ET CLR 1.1.4322)\n00 00 0f 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e  | ...~~~~~~~~~~~~~\n7e 7e 00 00 0d 7e 7e 7e 7e 7e 20 7e 7e 7e 7e 7e  | ~~...~~~~~ ~~~~~\n7e 7e 00 a0 07 00 21 61 70 70 6c 69 63 61 74 69  | ~~.?..!applicati\n6f 6e 2f 78 2d 77 77 77 2d 66 6f 72 6d 2d 75 72  | on/x-www-form-ur\n6c 65 6e 63 6f 64 65 64 00 a0 04 00 02 64 65 00  | lencoded.?...de.\n00 07 7e 7e 7e 7e 7e 7e 7e 00 00 6f 7e 7e 7e 7e  | ..~~~~~~~..o~~~~\n3a 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e  | :~~~~~~~~~~~~~~~\n7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e  | ~~~~~~~~~~~~~~~~\n7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e  | ~~~~~~~~~~~~~~~~\n7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e  | ~~~~~~~~~~~~~~~~\n7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e  | ~~~~~~~~~~~~~~~~\n7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e  | ~~~~~~~~~~~~~~~~\n7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 7e 00 a0 01 00 a4  | ~~~~~~~~~~~.?..?\n69 6d 61 67 65 2f 67 69 66 2c 20 69 6d 61 67 65  | image/gif, image\n2f 78 2d 78 62 69 74 6d 61 70 2c 20 69 6d 61 67  | /x-xbitmap, imag\n65 2f 6a 70 65 67 2c 20 69 6d 61 67 65 2f 70 6a  | e/jpeg, image/pj\n70 65 67 2c 20 61 70 70 6c 69 63 61 74 69 6f 6e  | peg, application\n2f 78 2d 73 68 6f 63 6b 77 61 76 65 2d 66 6c 61  | /x-shockwave-fla\n73 68 2c 20 61 70 70 6c 69 63 61 74 69 6f 6e 2f  | sh, application/\n76 6e 64 2e 6d 73 2d 65 78 63 65 6c 2c 20 61 70  | vnd.ms-excel, ap\n70 6c 69 63 61 74 69 6f 6e 2f 76 6e 64 2e 6d 73  | plication/vnd.ms\n2d 70 6f 77 65 72 70 6f 69 6e 74 2c 20 61 70 70  | -powerpoint, app\n6c 69 63 61 74 69 6f 6e 2f 6d 73 77 6f 72 64 2c  | lication/msword,\n20 2a 2f 2a 00 a0 0b 00 0f 77 77 77 2e 70 72 65  |  */*.?...www.pre\n21.06.2005 12:02:55 org.apache.jk.common.ChannelSocket processConnection\nWARNUNG: processCallbacks status 2\n21.06.2005 12:02:58 org.apache.jk.common.ChannelSocket processConnection\nINFO: connection timeout reached\n\nAfter downgrading our webservers to 1.3.33 and using mod_jk 1.2.5 the problems \nhave gone. After we changed our webservers to run the combination 1.3.33 and \nmod_jk 1.2.10 we meet the problems again.\n\nSo I would conclude that the problems result from newer versions of the mod_jk \nmodule.\n\nYour help solving this problem would be appreciated.\n\nRegards\nJ\u00f6rg Cebulla", "id": 76599, "time": "2005-06-22T11:39:25Z", "bug_id": 35461, "creation_time": "2005-06-22T11:39:25Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "mturk@apache.org", "text": "Fixed in the CVS by using a shutdown on the socket.", "id": 76942, "time": "2005-07-03T10:57:20Z", "bug_id": 35461, "creation_time": "2005-07-03T10:57:20Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 35461, "is_private": false, "count": 2, "id": 77895, "time": "2005-08-01T10:36:55Z", "creator": "joerg.cebulla@bertelsmann.de", "creation_time": "2005-08-01T10:36:55Z", "text": "Hello,\n\nthank you very much for your help so far.\n\nWe have now installed newest mod_jk version (1.2.14) but the bug still exists. \nDoes the newest version include the bugfix already ?\n\nIf yes it would be very kind if you would reinvestigate:\n\n29.07.2005 15:55:00 org.apache.jk.common.HandlerRequest invoke\nSCHWERWIEGEND: Error decoding request\njava.net.SocketTimeoutException: Read timed out\n        at java.net.SocketInputStream.socketRead0(Native Method)\n        at java.net.SocketInputStream.read(SocketInputStream.java:129)\n        at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)\n        at java.io.BufferedInputStream.read1(BufferedInputStream.java:256)\n        at java.io.BufferedInputStream.read(BufferedInputStream.java:313)\n        at org.apache.jk.common.ChannelSocket.read(ChannelSocket.java:598)\n        at org.apache.jk.common.ChannelSocket.receive(ChannelSocket.java:535)\n        at org.apache.jk.common.JkInputStream.receive(JkInputStream.java:247)\n        at org.apache.jk.common.HandlerRequest.decodeRequest\n(HandlerRequest.java:500)\n        at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:352)\n        at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:743)\n        at org.apache.jk.common.ChannelSocket.processConnection\n(ChannelSocket.java:675)\n        at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:866)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:683)\n        at java.lang.Thread.run(Thread.java:595)\n12 34 02 f2 02 04 00 08 48 54 54 50 2f 31 2e 31  | .4.?....HTTP/1.1\n00 00 2b 2f 63 6f 6d 6d 6f 6e 2f 63 75 73 74 6f  | ..+/common/custo\n6d 65 72 2f 62 6f 75 6e 64 61 72 79 2f 6c 6f 67  | mer/boundary/log\n69 6e 5a 69 70 63 6f 64 65 52 48 2e 64 6f 00 00  | inZipcodeRH.do..\n0d 31 39 35 2e 39 33 2e 36 30 2e 31 30 35 00 ff  | .195.93.60.105.?\nff 00 0f 77 77 77 2e 70 72 65 6d 69 65 72 65 2e  | ?..www.premiere.\n64 65 00 00 50 00 00 0c a0 01 00 a4 69 6d 61 67  | de..P...?..?imag\n65 2f 67 69 66 2c 20 69 6d 61 67 65 2f 78 2d 78  | e/gif, image/x-x\n62 69 74 6d 61 70 2c 20 69 6d 61 67 65 2f 6a 70  | bitmap, image/jp\n65 67 2c 20 69 6d 61 67 65 2f 70 6a 70 65 67 2c  | eg, image/pjpeg,\n20 61 70 70 6c 69 63 61 74 69 6f 6e 2f 78 2d 73  |  application/x-s\n68 6f 63 6b 77 61 76 65 2d 66 6c 61 73 68 2c 20  | hockwave-flash,\n61 70 70 6c 69 63 61 74 69 6f 6e 2f 6d 73 77 6f  | application/mswo\n72 64 2c 20 61 70 70 6c 69 63 61 74 69 6f 6e 2f  | rd, application/\n76 6e 64 2e 6d 73 2d 65 78 63 65 6c 2c 20 61 70  | vnd.ms-excel, ap\n70 6c 69 63 61 74 69 6f 6e 2f 76 6e 64 2e 6d 73  | plication/vnd.ms\n2d 70 6f 77 65 72 70 6f 69 6e 74 2c 20 2a 2f 2a  | -powerpoint, */*\n00 a0 03 00 0d 67 7a 69 70 2c 20 64 65 66 6c 61  | .?...gzip, defla\n74 65 00 a0 04 00 02 64 65 00 00 0d 43 61 63 68  | te.?...de...Cach\n65 2d 43 6f 6e 74 72 6f 6c 00 00 08 6e 6f 2d 63  | e-Control...no-c\n61 63 68 65 00 a0 08 00 03 31 36 31 00 a0 07 00  | ache.?...161.?..\n21 61 70 70 6c 69 63 61 74 69 6f 6e 2f 78 2d 77  | !application/x-w\n77 77 2d 66 6f 72 6d 2d 75 72 6c 65 6e 63 6f 64  | ww-form-urlencod\n65 64 00 a0 09 00 43 4a 53 45 53 53 49 4f 4e 49  | ed.?..CJSESSIONI\n44 3d 33 38 44 31 41 46 42 43 32 39 33 30 30 31  | D=38D1AFBC293001\n46 42 33 45 44 37 44 31 41 45 35 43 32 33 38 39  | FB3ED7D1AE5C2389\n37 43 2e 41 53 54 50 50 52 4d 42 3b 20 63 6f 6f  | 7C.ASTPPRMB; coo\n6b 69 65 63 68 65 63 6b 3d 31 00 a0 0b 00 0f 77  | kiecheck=1.?...w\n77 77 2e 70 72 65 6d 69 65 72 65 2e 64 65 00 a0  | ww.premiere.de.?\n0c 00 08 6e 6f 2d 63 61 63 68 65 00 a0 0d 00 3a  | ...no-cache.?..:\n68 74 74 70 3a 2f 2f 77 77 77 2e 70 72 65 6d 69  | http://www.premi\n65 72 65 2e 64 65 2f 63 6f 6d 6d 6f 6e 2f 63 75  | ere.de/common/cu\n73 74 6f 6d 65 72 2f 62 6f 75 6e 64 61 72 79 2f  | stomer/boundary/\n6c 6f 67 69 6e 52 48 2e 64 6f 00 a0 0e 00 53 4d  | loginRH.do.?..SM\n6f 7a 69 6c 6c 61 2f 34 2e 30 20 28 63 6f 6d 70  | ozilla/4.0 (comp\n61 74 69 62 6c 65 3b 20 4d 53 49 45 20 36 2e 30  | atible; MSIE 6.0\n3b 20 41 4f 4c 20 39 2e 30 3b 20 57 69 6e 64 6f  | ; AOL 9.0; Windo\n77 73 20 4e 54 20 35 2e 31 3b 20 53 56 31 3b 20  | ws NT 5.1; SV1;\n2e 4e 45 54 20 43 4c 52 20 31 2e 31 2e 34 33 32  | .NET CLR 1.1.432\n32 29 00 00 03 56 69 61 00 00 6d 48 54 54 50 2f  | 2)...Via..mHTTP/\n31 2e 31 20 28 56 65 6c 6f 63 69 74 79 2f 31 2e  | 1.1 (Velocity/1.\n31 2e 31 20 5b 75 53 63 4d 73 20 66 20 70 20 65  | 1.1 [uScMs f p e\n4e 3a 74 20 63 43 4d 70 20 73 20 5d 29 2c 20 48  | N:t cCMp s ]), H\n54 54 50 2f 31 2e 30 20 66 72 72 2d 61 64 30 33  | TTP/1.0 frr-ad03\n5b 43 33 35 44 33 43 36 39 5d 20 28 54 72 61 66  | [C35D3C69] (Traf\n66 69 63 2d 53 65 72 76 65 72 2f 35 2e 33 2e 38  | fic-Server/5.3.8\n20 5b 75 53 63 4d 5d 29 00 06 00 08 41 53 54 50  |  [uScM])....ASTP\n50 52 4d 32 00 ff                                | PRM2.?\n\n\n\n\n"}, {"count": 3, "tags": [], "text": "Hmm,\n\nThis seems like you are using 'application/x-www-form-urlencoded'\nwith GET request.\n\nCan you post the full mod_jk log from the beggining of the transaction\nto the end for that request. There must be some errors in ajp protocol,\neither setting timeout too low or forbidding post requests.\n\n", "is_private": false, "id": 77898, "creator": "mturk@apache.org", "time": "2005-08-01T11:08:00Z", "bug_id": 35461, "creation_time": "2005-08-01T11:08:00Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "You should also attach your mod_jk configuration (workers.properties and\nJk-directives from httpd.conf) as well as the connector configuration from\nserver.xml. This way we can check your timeout settings etc.", "id": 77915, "time": "2005-08-01T20:33:00Z", "bug_id": 35461, "creation_time": "2005-08-01T20:33:00Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "joerg.cebulla@bertelsmann.de", "text": "Created attachment 15844\nworkers.properties from mod_jk configuration", "id": 77930, "time": "2005-08-02T14:05:31Z", "bug_id": 35461, "creation_time": "2005-08-02T14:05:31Z", "is_private": false, "attachment_id": 15844}, {"count": 6, "tags": [], "bug_id": 35461, "attachment_id": 15845, "is_private": false, "id": 77931, "time": "2005-08-02T14:07:12Z", "creator": "joerg.cebulla@bertelsmann.de", "creation_time": "2005-08-02T14:07:12Z", "text": "Created attachment 15845\nmodjk directives"}, {"count": 7, "tags": [], "bug_id": 35461, "attachment_id": null, "is_private": false, "id": 77932, "time": "2005-08-02T14:09:13Z", "creator": "joerg.cebulla@bertelsmann.de", "creation_time": "2005-08-02T14:09:13Z", "text": "I have attached our workers.properties file and a file jk.conf including the \ndirectives."}, {"count": 8, "tags": [], "bug_id": 35461, "attachment_id": null, "text": "(In reply to comment #3)\n> Hmm,\n> This seems like you are using 'application/x-www-form-urlencoded'\n> with GET request.\n> Can you post the full mod_jk log from the beggining of the transaction\n> to the end for that request. There must be some errors in ajp protocol,\n> either setting timeout too low or forbidding post requests.\n\nHello,\n\nI have sent attachements concerning workers.properties an directives.\n\nOur application is using webservers running behind a loadbalancer. Therefore it \nis a little bit difficult to find the exact statement that matches the stack \ntrace of the tomcat. But there some stack traces in our Tomcats logfile and I \nwill sent a you a typical error sequence from a modjk log file\n\n[Mon Aug 01 18:56:03 2005] [info]  ajp_send_request::jk_ajp_common.c (1178): \nSocket 7 is not connected any moreajp_service::jk_ajp_common.c (1749): Sending \nrequest to tomcat failed,  recoverable operation attempt=1\n[Mon Aug 01 18:54:17 2005] [info]  jk_open_socket::jk_connect.c (444): connect \nto 145.228.205.181:16008 failed with errno=111\n[Mon Aug 01 18:54:17 2005] [info]  ajp_connect_to_endpoint::jk_ajp_common.c \n(889): Failed opening socket to (145.228.205.181:16008) with (errno=111)\n[Mon Aug 01 18:54:17 2005] [info]  ajp_send_request::jk_ajp_common.c (1248): \nError connecting to the Tomcat process.\n[Mon Aug 01 18:54:17 2005] [info]  ajp_service::jk_ajp_common.c (1749): Sending \nrequest to tomcat failed,  recoverable operation attempt=2\n[Mon Aug 01 18:54:17 2005] [info]  jk_open_socket::jk_connect.c (444): connect \nto 145.228.205.181:16008 failed with errno=111\n[Mon Aug 01 18:54:17 2005] [info]  ajp_connect_to_endpoint::jk_ajp_common.c \n(889): Failed opening socket to (145.228.205.181:16008) with (errno=111)\n[Mon Aug 01 18:54:17 2005] [info]  ajp_send_request::jk_ajp_common.c (1248): \nError connecting to the Tomcat process.\n[Mon Aug 01 18:54:17 2005] [info]  ajp_service::jk_ajp_common.c (1749): Sending \nrequest to tomcat failed,  recoverable operation attempt=3\n[Mon Aug 01 18:54:17 2005] [error] ajp_service::jk_ajp_common.c (1758): Error \nconnecting to tomcat. Tomcat is probably not started or is listening on the \nwrong port. worker=ASTPPRMB failed\n[Mon Aug 01 18:54:17 2005] [info]  service::jk_lb_worker.c (662): service \nfailed, worker ASTPPRMB is in error state\n[Mon Aug 01 18:55:09 2005] [info]  ajp_send_request::jk_ajp_common.c (1178): \nSocket 7 is not connected any more (errno=-1)\n[Mon Aug 01 18:55:09 2005] [info]  ajp_send_request::jk_ajp_common.c (1202): \nError sending request. Will try another pooled connection\n[Mon Aug 01 18:55:09 2005] [info]  ajp_send_request::jk_ajp_common.c (1225): \nAll endpoints are disconnected or dead\n[Mon Aug 01 18:55:09 2005] [info]  ajp_service::jk_ajp_common.c (1749): Sending \nrequest to tomcat failed,  recoverable operation attempt=1\n[Mon Aug 01 18:55:53 2005] [info]  ajp_send_request::jk_ajp_common.c (1178): \nSocket 13 is not connected any more (errno=-1)\n[Mon Aug 01 18:55:53 2005] [info]  ajp_send_request::jk_ajp_common.c (1202): \nError sending request. Will try another pooled connection\n[Mon Aug 01 18:55:53 2005] [info]  ajp_send_request::jk_ajp_common.c (1225): \nAll endpoints are disconnected or dead\n[Mon Aug 01 18:55:53 2005] [info]  ajp_service::jk_ajp_common.c (1749): Sending \nrequest to tomcat failed,  recoverable operation attempt=1\n[Mon Aug 01 18:55:09 2005] [info]  ajp_send_request::jk_ajp_common.c (1178): \nSocket 7 is not connected any more (errno=-1)\n[Mon Aug 01 18:55:09 2005] [info]  ajp_send_request::jk_ajp_common.c (1202): \nError sending request. Will try another pooled connection\n[Mon Aug 01 18:55:09 2005] [info]  ajp_send_request::jk_ajp_common.c (1225): \nAll endpoints are disconnected or dead\n[Mon Aug 01 18:55:09 2005] [info]  ajp_service::jk_ajp_common.c (1749): Sending \nrequest to tomcat failed,  recoverable operation attempt=1\n[Mon Aug 01 18:55:53 2005] [info]  ajp_send_request::jk_ajp_common.c (1178): \nSocket 13 is not connected any more (errno=-1)\n[Mon Aug 01 18:55:53 2005] [info]  ajp_send_request::jk_ajp_common.c (1202): \nError sending request. Will try another pooled connection\n[Mon Aug 01 18:55:53 2005] [info]  ajp_send_request::jk_ajp_common.c (1225): \nAll endpoints are disconnected or dead\n[Mon Aug 01 18:55:53 2005] [info]  ajp_service::jk_ajp_common.c (1749): Sending \nrequest to tomcat failed,  recoverable operation attempt=1\n[Mon Aug 01 18:55:57 2005] [info]  ajp_process_callback::jk_ajp_common.c \n(1384): Connection aborted or network problems\n[Mon Aug 01 18:55:57 2005] [info]  ajp_service::jk_ajp_common.c (1731): \nReceiving from tomcat failed, because of client error without recovery in send \nloop 0\n[Mon Aug 01 18:55:57 2005] [info]  service::jk_lb_worker.c (677): unrecoverable \nerror 400, request failed. Client failed in the middle of request, we can't \nrecover to another instance.\n[Mon Aug 01 18:55:57 2005] [info]  jk_handler::mod_jk.c (1837): Aborting \nconnection for worker=loadbalancer\n\nThank you very much for your help.\n\nJoerg Cebulla", "id": 77933, "time": "2005-08-02T14:29:16Z", "creator": "joerg.cebulla@bertelsmann.de", "creation_time": "2005-08-02T14:29:16Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 35461, "attachment_id": null, "text": "I am getting the exact same problem. When will this be fixed? Is there a new \nrelease slated soon?", "id": 79576, "time": "2005-09-07T20:18:15Z", "creator": "faisal.arif@sdgc.com", "creation_time": "2005-09-07T20:18:15Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 35461, "attachment_id": null, "text": "Same problem here. Please let us know how we can help debugging that issue.\n\nThanks\n\nAlex", "id": 80091, "time": "2005-09-18T20:52:50Z", "creator": "alexander.stagun@mindmatics.de", "creation_time": "2005-09-18T20:52:50Z", "is_private": false}, {"count": 11, "tags": [], "creator": "william.barker@wilshire.com", "is_private": false, "text": "(In reply to comment #10)\n> Same problem here. Please let us know how we can help debugging that issue.\n> Thanks\n> Alex\n\nIt's pretty clear what is happening:  mod_jk isn't sending the POST body \nbefore the Tomcat-configured connectionTimeout has been reached.  What isn't \nclear is why.  In the first dump example, the worker in the JSESSIONID cookie \nisn't in the list (there are also some decoding problems, but they shouldn't \naffect Tomcat).  In the second dump example, mod_jk has decided to send the \nrequest to a different worker than the one in the cookie for some reason.  \nOtherwise, they are perfectly normal POST request records.\n\nProbably, somebody is going to have to be able to reproduce this \nwith 'JkLogLevel debug' (or even 'JkLogLevel trace' :) to get some idea why \nthe POST body wasn't sent.\n\nAs an aside, Tomcat 5.5.11+ won't have this particular error, but it is also \nextremely unlikely to actually work.", "id": 80094, "time": "2005-09-19T00:48:39Z", "bug_id": 35461, "creation_time": "2005-09-19T00:48:39Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "ejne@excite.com", "is_private": false, "text": "...seems to still exist folks.  \n\nmy environment is solaris 10/sparc, apache ver 2.0.55 (worker mpm), mod_jk ver\n1.2.14.1 (compiled locally), java ver 1.5.0_05, tomcat ver 5.5.12 (via jsvc). \nApache and tomcat running on same box.\n\n\n\nmy httpd.conf relevent settings:\n\nLoadModule jk_module modules/mod_jk.so\n\nJkLogFile     \"/usr/local/apache/logs/mod_jk.log\"\nJkLogLevel    error\n\n#\n# Prohibit public access to property files used by web applications.\n#\n<LocationMatch \".properties$\">\n        AllowOverride None\n        Deny from all\n</LocationMatch>\n\n<LocationMatch \".*/WEB-INF/.*\">\n        AllowOverride None\n        Deny from all\n</LocationMatch>\n\n<LocationMatch \".*/META-INF/.*\">\n        AllowOverride None\n        Deny from all\n</LocationMatch>\n\n#\n# Forward (everything) to tomcat:\n#\nJkMount /* myApp\n\n\n# --------------------------------------------------------------------\n#\n# Note: \"JkWorkerProperty\" is a new directive available from JK 1.2.7\n#       version. It is a convenient method for setting directives that\n#       are usually set inside workers.propetiesfile. The parameter for\n#       that directive is raw line from workers.properties file.\n#\n# --------------------------------------------------------------------\n\n# In Unix, we use forward slashes:\nJkWorkerProperty ps=/\n\n# list the workers by name\nJkWorkerProperty worker.list=myApp\n\n# --------------------------------------------------------------------\n# tomcat server instances:\n#\n# Note: The worker name should match the value of the \"jvmRoute=\"\n#       parameter found in the $TOMCAT_HOME/conf/server.xml file.\n# --------------------------------------------------------------------\n\nJkWorkerProperty worker.myApp.type=ajp13\nJkWorkerProperty worker.myApp.lbfactor=1\nJkWorkerProperty worker.myApp.cachesize=25\nJkWorkerProperty worker.myApp.cache_timeout=0\nJkWorkerProperty worker.myApp.port=8888\nJkWorkerProperty worker.myApp.host=localhost\n\n##### end of tomcat/mod_jk/workers.properties settings #####\n\n\n\n\nmy server.xml relevent settings:\n\n    <!-- Define an AJP 1.3 Connector on port 8888 -->\n    <Connector port=\"8888\"\n               maxThreads=\"150\"\n               minSpareThreads=\"25\"\n               maxSpareThreads=\"75\"\n               enableLookups=\"false\"\n               acceptCount=\"100\"\n               connectionTimeout=\"20000\"\n               redirectPort=\"8443\"\n               protocol=\"AJP/1.3\" />\n\n    <Engine name=\"Catalina\" debug=\"0\" defaultHost=\"localhost\" jvmRoute=\"myApp\">\n\n\n\nerror/warn/info messages in apache/logs/mod_jk.log:\n\n[Tue Nov 01 23:18:39 2005] [16920:0019] [warn] \najp_get_endpoint::jk_ajp_common.c (2138): Unable to get the free endpoint for\nworker myApp from 1 slots\n[Tue Nov 01 23:18:39 2005] [16920:0019] [info] \najp_get_endpoint::jk_ajp_common.c (2152): can't find free endpoint\n[Tue Nov 01 23:18:39 2005] [16920:0019] [error] jk_handler::mod_jk.c (1911):\nCould not get endpoint for worker=myApp\n[Tue Nov 01 23:18:39 2005] [16920:0019] [info]  jk_handler::mod_jk.c (1971):\nService error=0 for worker=myApp\n[Tue Nov 01 23:18:41 2005] [16921:0019] [warn] \najp_get_endpoint::jk_ajp_common.c (2138): Unable to get the free endpoint for\nworker myApp from 1 slots\n[Tue Nov 01 23:18:41 2005] [16921:0019] [info] \najp_get_endpoint::jk_ajp_common.c (2152): can't find free endpoint\n[Tue Nov 01 23:18:41 2005] [16921:0019] [error] jk_handler::mod_jk.c (1911):\nCould not get endpoint for worker=myApp\n[Tue Nov 01 23:18:41 2005] [16921:0019] [info]  jk_handler::mod_jk.c (1971):\nService error=0 for worker=myApp\n[Tue Nov 01 23:18:46 2005] [16921:0019] [warn] \najp_get_endpoint::jk_ajp_common.c (2138): Unable to get the free endpoint for\nworker myApp from 1 slots\n[Tue Nov 01 23:18:46 2005] [16921:0019] [info] \najp_get_endpoint::jk_ajp_common.c (2152): can't find free endpoint\n[Tue Nov 01 23:18:46 2005] [16921:0019] [error] jk_handler::mod_jk.c (1911):\nCould not get endpoint for worker=myApp\n[Tue Nov 01 23:18:46 2005] [16921:0019] [info]  jk_handler::mod_jk.c (1971):\nService error=0 for worker=myApp\n[Tue Nov 01 23:18:52 2005] [16920:0019] [warn] \najp_get_endpoint::jk_ajp_common.c (2138): Unable to get the free endpoint for\nworker myApp from 1 slots\n[Tue Nov 01 23:18:52 2005] [16920:0019] [info] \najp_get_endpoint::jk_ajp_common.c (2152): can't find free endpoint\n[Tue Nov 01 23:18:52 2005] [16920:0019] [error] jk_handler::mod_jk.c (1911):\nCould not get endpoint for worker=myApp\n[Tue Nov 01 23:18:52 2005] [16920:0019] [info]  jk_handler::mod_jk.c (1971):\nService error=0 for worker=myApp\n...\n[Tue Nov 01 23:27:06 2005] [16939:0022] [info] \najp_send_request::jk_ajp_common.c (1178): Socket 17 is not connected any more\n(errno=-1)\n[Tue Nov 01 23:27:06 2005] [16939:0022] [info] \najp_send_request::jk_ajp_common.c (1202): Error sending request. Will try\nanother pooled connection\n[Tue Nov 01 23:27:06 2005] [16939:0022] [info] \najp_send_request::jk_ajp_common.c (1225): All endpoints are disconnected or dead\n[Tue Nov 01 23:27:06 2005] [16939:0022] [info]  ajp_service::jk_ajp_common.c\n(1749): Sending request to tomcat failed,  recoverable operation attempt=1\n[Tue Nov 01 23:35:16 2005] [16939:0022] [info] \najp_send_request::jk_ajp_common.c (1178): Socket 22 is not connected any more\n(errno=-1)\n[Tue Nov 01 23:35:16 2005] [16939:0022] [info] \najp_send_request::jk_ajp_common.c (1202): Error sending request. Will try\nanother pooled connection\n[Tue Nov 01 23:35:16 2005] [16939:0022] [info] \najp_send_request::jk_ajp_common.c (1225): All endpoints are disconnected or dead\n[Tue Nov 01 23:35:16 2005] [16939:0022] [info]  ajp_service::jk_ajp_common.c\n(1749): Sending request to tomcat failed,  recoverable operation attempt=1\n\n\n\nerror messages in apache/logs/error_log:\n\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\nmap_uri_to_worker::jk_uri_worker_map.c (443): Removing Session path\n';jsessionid=0418375B66D57231B89911A9C5340317.jvm1' URI\n'/faces/finder/search/SearchMake\n.jsp' failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\nmap_uri_to_worker::jk_uri_worker_map.c (449): Attempting to map URI\n'/faces/finder/search/SearchMake.jsp;jsessionid=0418375B66D57231B89911A9C5340317.jvm1'\nf\nrom 1 maps failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\nmap_uri_to_worker::jk_uri_worker_map.c (461): Attempting to map context URI '/*'\nfailed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\nmap_uri_to_worker::jk_uri_worker_map.c (475): Found a wildchar match myApp -> /*\nfailed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug] jk_handler::mod_jk.c (1825):\nInto handler jakarta-servlet worker=myApp r->proxyreq=0 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\nwc_get_worker_for_name::jk_worker.c (111): found a worker myApp failed: File too\nlarge\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug] init_ws_service::mod_jk.c (517):\nService protocol=HTTP/1.1 method=POST host=(null) addrr=10.100.100.13\nname=dev.myApp.com port=80 auth=(null) user=(null) la\nddr=10.100.100.69 raddr=10.100.100.13 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_get_endpoint::jk_ajp_common.c (2131): acquired connection cache slot=3\nfailed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_marshal_into_msgb::jk_ajp_common.c (566): ajp marshaling done failed: File\ntoo large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug] ajp_service::jk_ajp_common.c\n(1670): processing with 3 retries failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_connection_tcp_send_message::jk_ajp_common.c (909): sending to ajp13 pos=4\nlen=376 max=8192 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_connection_tcp_send_message::jk_ajp_common.c (909): 0000    12 34 01 74 02\n04 00 08 48 54 54 50 2F 31 2E 31  - .4.t....HTTP/1.1 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_connection_tcp_send_message::jk_ajp_common.c (909): 0010    00 00 54 2F 66\n61 63 65 73 2F 66 69 6E 64 65 72  - ..T/faces/finder failed: File too large\n...\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_send_request::jk_ajp_common.c (1261): request body to send 185 - request\nbody to resend 0 failed: File too large\n...\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_unmarshal_response::jk_ajp_common.c (621): status = 200 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_unmarshal_response::jk_ajp_common.c (628): Number of headers is = 2 failed:\nFile too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_unmarshal_response::jk_ajp_common.c (684): Header[0] [Content-Type] =\n[text/html;charset=UTF-8] failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_unmarshal_response::jk_ajp_common.c (684): Header[1] [Content-Language] =\n[en] failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_connection_tcp_get_message::jk_ajp_common.c (1037): received from ajp13\npos=0 len=8188 max=8192 failed: File too large\n...\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug] ws_write::mod_jk.c (398):\nwritten 8184 out of 8184 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_connection_tcp_get_message::jk_ajp_common.c (1037): received from ajp13\npos=0 len=8188 max=8192 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug] ws_write::mod_jk.c (398):\nwritten 8184 out of 8184 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_connection_tcp_get_message::jk_ajp_common.c (1037): received from ajp13\npos=0 len=1731 max=8192 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug] ws_write::mod_jk.c (398):\nwritten 1727 out of 1727 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_connection_tcp_get_message::jk_ajp_common.c (1037): received from ajp13\npos=0 len=2 max=8192 failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug]\najp_connection_tcp_get_message::jk_ajp_common.c (1037): 0000    05 01 00 00 00\n00 00 00 00 00 00 00 00 00 00 00  - ................ failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug] ajp_done::jk_ajp_common.c\n(2074): recycling connection cache slot=2 for worker myApp failed: File too large\n[Tue Nov 01 23:49:44 2005] [16939:0022] [debug] jk_handler::mod_jk.c (1955):\nService finished with status=200 for worker=myApp failed: File too large\n\n\n\nThese errors manifest during sustained load (19.35805 hits/second), the\napplication is a relatively simple database query form, server cpu ~65% busy.\n\nThanks,\n-Eddie\n\n\n\n", "id": 82065, "time": "2005-11-02T20:01:11Z", "bug_id": 35461, "creation_time": "2005-11-02T20:01:11Z", "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 35461, "attachment_id": null, "text": "I seem to be running into this issue as well. Just a suggestion (not sure if it\nmakes a difference here yet), but have you tried setting maxPostSize=\"0\" or to\nsome high value on the AJP connector definition in your Tomcat server.xml files?\nAccording to http://tomcat.apache.org/tomcat-5.0-doc/config/http.html the\ndefault maximum is 2MB.", "id": 82409, "time": "2005-11-11T23:23:48Z", "creator": "lannocc@lannocc.com", "creation_time": "2005-11-11T23:23:48Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 35461, "is_private": false, "count": 14, "id": 82410, "time": "2005-11-11T23:44:11Z", "creator": "lannocc@lannocc.com", "creation_time": "2005-11-11T23:44:11Z", "text": "Just to followup to my previous suggestion... it did not fix the problem. We are\nusing the following versions:\n\napache-2.0.54\nmod_jk-1.2.13\ntomcat-5.0.27\n\nApache is using mod_jk for load balancing between four Tomcat instances on other\nmachines. This is what we see throughout our mod_jk log:\n\n[Fri Nov 11 22:39:02 2005] [info]  ajp_process_callback::jk_ajp_common.c (1375):\nConnection aborted or network problems\n[Fri Nov 11 22:39:02 2005] [info]  ajp_service::jk_ajp_common.c (1719):\nReceiving from tomcat failed, because of client error without recovery in send\nloop 0\n[Fri Nov 11 22:39:02 2005] [info]  service::jk_lb_worker.c (677): unrecoverable\nerror 400, request failed. Client failed in the middle of request, we can't\nrecover to another instance.\n[Fri Nov 11 22:39:02 2005] [info]  jk_handler::mod_jk.c (1970): Aborting\nconnection for worker=balancer\n"}, {"count": 15, "attachment_id": null, "bug_id": 35461, "text": "We are using:\n\nServer Version: Apache/2.0.46 (Red Hat) \nJK Version: 1.2.13 \n\nWe have been using mod jk for a long time WITHOUT load balancing, but rather \nsending different types of requests to two different Tomcat servers. Our jk log \nhas always been full of the following type of errors:\n\n[Sun Dec 11 00:18:21 2005] [info]  ajp_process_callback::jk_ajp_common.c \n(1375): Connection aborted or network problems\n[Sun Dec 11 00:18:21 2005] [info]  ajp_service::jk_ajp_common.c (1719): \nReceiving from tomcat failed, because of client error without recovery in send \nloop 0\n[Sun Dec 11 00:18:21 2005] worker2 www.example.com 200 \n0.127023 /example/servlet/url\n[Sun Dec 11 00:18:21 2005] [info]  jk_handler::mod_jk.c (1970): Aborting \nconnection for worker=worker2\n\nAt 10 requests per second this occurs about 10 times per minute. Note that this \nerror is the same in all regards to the one in comment #14, except for the \nABSENCE of the \"error 400\" message and the presence of an interspersed \"normal\" \nline.\n\nThis morning at midnight, I configured load balancing between the two servers. \nThe above type of error messages continued to happen at about the same rate, \nonly 1 in 50 were now the type described in comment #14:\n\n[Mon Dec 12 00:12:47 2005] [info]  ajp_process_callback::jk_ajp_common.c \n(1375): Connection aborted or network problems\n[Mon Dec 12 00:12:47 2005] [info]  ajp_service::jk_ajp_common.c (1719): \nReceiving from tomcat failed, because of client error without recovery in send \nloop 0\n[Mon Dec 12 00:12:48 2005] [info]  service::jk_lb_worker.c (677): unrecoverable \nerror 400, request failed. Client failed in the middle of request, we can't \nrecover to another instance.\n[Mon Dec 12 00:12:48 2005] lb1 www.example.com 200 7.535697 /\n[Mon Dec 12 00:12:48 2005] [info]  jk_handler::mod_jk.c (1970): Aborting \nconnection for worker=lb1\n\nI went back and spot checked a few old jk log files, and it seems that in all \nthe years that we have been using mod_jk, this is the first time we ever got \nthe \"error 400\" line (obviously, given the fact that the error message is \ncoming from \"jk_lb_worker.c\" and we have never used load balancing before).\n\nContrary to what others have noted on this bug, it seems that for us \nthis \"error 400\" was happening in the complete absence of an POST request.\n\nIt is also worthwhile to note that as soon as traffic picked up in the morning, \nthe jk load balancer put both of our servers into \"error\" state and shut down \nour entire application. I immediately undid the load balancing configuration \nand went back to the old one, which is holding up just fine. So much for doing \nthings the \"right\" way.", "id": 83584, "time": "2005-12-12T23:29:26Z", "creator": "nathan_w_cheng@yahoo.com", "creation_time": "2005-12-12T23:29:26Z", "tags": [], "is_private": false}, {"count": 16, "tags": [], "bug_id": 35461, "attachment_id": null, "text": "I encountered similar issue.\nAfter installing win2000 sp4, it is resolved.\nSo, try installing win2000 sp4.", "id": 83909, "time": "2005-12-22T06:17:52Z", "creator": "yy2better@gmail.com", "creation_time": "2005-12-22T06:17:52Z", "is_private": false}, {"count": 17, "tags": [], "bug_id": 35461, "attachment_id": null, "is_private": false, "id": 84447, "time": "2006-01-10T20:03:04Z", "creator": "yoavs@computer.org", "creation_time": "2006-01-10T20:03:04Z", "text": "Jorg, Faisal, and others who've reported the problem: please see Nathan and\nMichael's resolutions and give those a shot.  I'm closing the issue given what\nthey said, but if it still occurs with the latest versions (Tomcat 5.5.12, JK\n1.2.15 at the time of this writing), then feel free to reopen the issue."}, {"count": 18, "tags": [], "creator": "paul.hettl@mindmatics.com", "text": "HI this bugs  semas to be still unsolved.\n\nWe observe the same with: Apache/2.0.59 (Unix) mod_ssl/2.0.59 OpenSSL/0.9.7d\nmod_jk/1.2.19\n\nI reopend this bug.\n\n\n\n(In reply to comment #17)\n> Jorg, Faisal, and others who've reported the problem: please see Nathan and\n> Michael's resolutions and give those a shot.  I'm closing the issue given what\n> they said, but if it still occurs with the latest versions (Tomcat 5.5.12, JK\n> 1.2.15 at the time of this writing), then feel free to reopen the issue.\n\n", "id": 95469, "time": "2006-11-06T05:00:11Z", "bug_id": 35461, "creation_time": "2006-11-06T05:00:11Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "text": "Please reopen a new bug report with the 1.2.19 related data.\nSimply stating that 1.2.19 is faulty without giving at least a\nlog file will never be treated as error\n\nRegards.\n", "is_private": false, "id": 95473, "creator": "mturk@apache.org", "time": "2006-11-06T05:19:40Z", "bug_id": 35461, "creation_time": "2006-11-06T05:19:40Z", "attachment_id": null}]
[{"attachment_id": null, "tags": [], "bug_id": 47799, "text": "I used domain =\"{1,2,3,4}\" as follows by the Cluster configuration. \n<Cluster className=\"org.apache.catalina.ha.tcp.SimpleTcpCluster\"\n    channelSendOptions=\"6\">\n...\n<Membership className=\"org.apache.catalina.tribes.membership.McastService\"\n    address=\"228.0.0.4\" port=\"45564\" frequency=\"500\" dropTime=\"3000\"\n    domain=\"{1,2,3,4}\"/>\n...\n<Interceptor className=\"org.apache.catalina.tribes.group.interceptors.DomainFilterInterceptor\" \n    domain=\"{1,2,3,4}\"/>\n...\n</Cluster>\n\nHowever, domain does not work in Membership and DomainFilterInterceptor.\n\nThe type of instance variable domain of org.apache.catalina.tribes.membership.McastService\nand org.apache.catalina.tribes.group.interceptors.DomainFilterInterceptor is byte array.\n\norg.apache.tomcat.util.IntrospectionUtils#setProperty is invoked \nin org.apache.tomcat.util.digester.SetPropertyRule#begin. \nHowever, \n\nBecause byte array property is not supported in org.apache.tomcat.util.IntrospectionUtils#setProperty, \nMcastService#setDomain(byte array) and DomainFilterInterceptor#setDomain(byte array) is never invoked. \n\nAs a result, domain can not set, and domain is always null.\n\nThere are two workarounds as follows.\n1:org.apache.tomcat.util.IntrospectionUtils#setProperty supports byte array property.\n\n2:Prepares setDomain(String) method for McastService and DomainFilterInterceptor.\n  Invoke setDomain(byte array) from setDomain(String).\n  This is the same way as org.apache.catalina.tribes.membership.StaticMember. \n\nI think that it is easy to prepare setDomain(String) method.\nI made the patch. \n\nMcastService's patch against tomcat_trunk.\n[start.]\nIndex: java/org/apache/catalina/tribes/membership/McastService.java\n===================================================================\n--- java/org/apache/catalina/tribes/membership/McastService.java\t(revision 787304)\n+++ java/org/apache/catalina/tribes/membership/McastService.java\t(working copy)\n@@ -30,6 +30,7 @@\n import org.apache.catalina.tribes.MessageListener;\n import org.apache.catalina.tribes.io.ChannelData;\n import org.apache.catalina.tribes.io.XByteBuffer;\n+import org.apache.catalina.tribes.util.Arrays;\n import org.apache.catalina.tribes.util.StringManager;\n import org.apache.catalina.tribes.util.UUIDGenerator;\n \n@@ -607,6 +608,12 @@\n         }\n     }\n \n+    public void setDomain(String domain) {\n+        if ( domain == null ) return;\n+        if ( domain.startsWith(\"{\") ) setDomain(Arrays.fromString(domain));\n+        else setDomain(Arrays.convert(domain));\n+    }\n+\n     /**\n      * Simple test program\n      * @param args Command-line arguments\n\n[end.]\n\nDomainFilterInterceptor's patch against tomcat_trunk.\n[start.]\nIndex: java/org/apache/catalina/tribes/group/interceptors/DomainFilterInterceptor.java\n===================================================================\n--- java/org/apache/catalina/tribes/group/interceptors/DomainFilterInterceptor.java\t(revision 763870)\n+++ java/org/apache/catalina/tribes/group/interceptors/DomainFilterInterceptor.java\t(working copy)\n@@ -97,4 +97,13 @@\n     public void setDomain(byte[] domain) {\n         this.domain = domain;\n     }\n+\n+    public void setDomain(String domain) {\n+        if ( domain == null ) return;\n+        if (domain.startsWith(\"{\"))\n+            setDomain(org.apache.catalina.tribes.util.Arrays.fromString(domain));\n+\t    else\n+            setDomain(org.apache.catalina.tribes.util.Arrays.convert(domain));\n+    }\n+\n }\n\n[end.]\n\n\nBest regards.", "count": 0, "id": 130202, "time": "2009-09-08T02:39:42Z", "creator": "fujino.keiichi@oss.ntt.co.jp", "creation_time": "2009-09-08T02:39:42Z", "is_private": false}, {"attachment_id": 24224, "tags": [], "bug_id": 47799, "is_private": false, "count": 1, "id": 130203, "time": "2009-09-08T02:52:50Z", "creator": "fujino.keiichi@oss.ntt.co.jp", "creation_time": "2009-09-08T02:52:50Z", "text": "Created attachment 24224\nMcastService's patch\n\nsorry.\nThe previous patch is broken. \nThis is correct patch."}, {"count": 2, "tags": [], "creator": "fujino.keiichi@oss.ntt.co.jp", "attachment_id": 24225, "id": 130204, "time": "2009-09-08T02:54:08Z", "bug_id": 47799, "creation_time": "2009-09-08T02:54:08Z", "is_private": false, "text": "Created attachment 24225\nDomainFilterInterceptor's patch\n\nsorry.\nThe previous DomainFilterInterceptor's patch is broken. \nThis is correct patch."}, {"count": 3, "tags": [], "bug_id": 47799, "attachment_id": null, "text": "Hi.\n\nPlease do not ignore this bug report and patch. \nThis problem is important.\n\nIf we can not specify domain in Membership and DomainFilterInterceptor, \nwe can not divide the cluster into a smaller group by the domain.\n\nAfter all, DomainFilterInterceptor can not be used.", "id": 130401, "time": "2009-09-15T02:11:41Z", "creator": "fujino.keiichi@oss.ntt.co.jp", "creation_time": "2009-09-15T02:11:41Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 47799, "text": "Thanks for the patch. It has been applied to trunk and proposed for 6.0.x", "count": 4, "id": 132215, "time": "2009-11-22T14:39:00Z", "creator": "markt@apache.org", "creation_time": "2009-11-22T14:39:00Z", "is_private": false}, {"count": 5, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 133029, "time": "2009-12-21T08:26:33Z", "bug_id": 47799, "creation_time": "2009-12-21T08:26:33Z", "is_private": false, "text": "This has been fixed in 6.0.x and will be included in 6.0.21 onwards. Thanks again for the patch."}]
[{"count": 0, "tags": [], "creator": "martin@mhengesbach.de", "text": "I'm using tomcat 4.0 RC1 with apache 1.3.14 and mod_webapp. Everything works \nfine but the upload of binary files doesn't work. For the file upload we are \nusing the oreilly classes (www.servlets.com). The upload terminates with the \nmessage \"unexpected end of part\". While debugging I saw that the \nServletInputStream.read() returns -1 although the end of the file is not \nreached. The uploaded file is a little bit shorter than the original file. The \nupload of ASCII files works withount any problems. It seems that this error is \nsimilar to the error in tomcat 3.2.2 with ServletInputStream (Bug #1993).\nWith tomcat 3.2.3 our application is working without any problems!\n\nI also tried tomcat 4.0 B7 - it's the same error!\n\nMartin", "id": 5319, "time": "2001-09-10T12:20:08Z", "bug_id": 3534, "creation_time": "2001-09-10T12:20:08Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "martin@mhengesbach.de", "is_private": false, "count": 1, "id": 5347, "time": "2001-09-11T02:15:36Z", "bug_id": 3534, "creation_time": "2001-09-11T02:15:36Z", "text": "I have tried tomcat 4.0 RC1 without apache and mod_webapp. That works! So the \nproblem seems to be in the apache-tomcat connector. \nI'am using the mod_webapp B7 because I haven't found the mod_webapp RC1. \n\n\nMartin"}, {"count": 2, "tags": [], "bug_id": 3534, "is_private": false, "id": 5372, "attachment_id": null, "creator": "pier@betaversion.org", "creation_time": "2001-09-11T12:50:36Z", "time": "2001-09-11T12:50:36Z", "text": "I will investigate it. Do you have any log file and/or stack trace error I can \nlook at?\n\n    Pier"}, {"count": 3, "text": "No, sorry, I don't have any stack traces. There isn't a exception or something \nsimilar. The read function just returns -1 altough the end of file is not \nreached.\n\nMartin", "bug_id": 3534, "is_private": false, "id": 5412, "time": "2001-09-12T02:03:46Z", "creator": "martin@mhengesbach.de", "creation_time": "2001-09-12T02:03:46Z", "tags": [], "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 3534, "text": "As far as I can see, this works for me on MacOS/X and BETA7 (and no changes were committed on that part of the code between that version and RC1).\nWhat browser are you using? (I'm using OmniWeb 4.0.5 on MacOS/X).", "id": 5604, "time": "2001-09-15T13:53:33Z", "creator": "pier@betaversion.org", "creation_time": "2001-09-15T13:53:33Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "martin@mhengesbach.de", "text": "My server is running suse linux v. 7.2 witha apache 1.3.14. I have tried it from \na MS Windows NT client with IE V 5.5-SP1 and with Netscape V 4.74\n\nI will retry it tomorrow on another server with tomcat 4.0 RC2.\n\nI'am going on holiday on tuesday for 2 weeks! Sorry if I can't help you then \nfinding the error...\n\nMartin", "count": 5, "id": 5627, "time": "2001-09-16T10:13:10Z", "bug_id": 3534, "creation_time": "2001-09-16T10:13:10Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 3534, "is_private": false, "count": 6, "id": 5649, "time": "2001-09-17T00:31:54Z", "creator": "martin@mhengesbach.de", "creation_time": "2001-09-17T00:31:54Z", "text": "I have verified it on an other computer with a new installation of tomcat 4 RC2 \nand mod_webapp version BETA 7. The problem is the same! Is it possible that the \nreason is the version of the mod_webapp? I haven't found a newer one... \n\nNow I have tried it with the standard webdav application. There is altough the \nerror. I up load a textdocument - it works. I upload a MS Excel document and it \ndoesn't work. From the originial 2700 bytes there are only 68 bytes uploaded!\n\nThe problem onlys occurs when I use tomcat 4 with mod_webdav and apache. When I \nuse it standalone or tomcat V 3.2.3 it works. Is it possible that my apache \nversion (1.3.14) is to old? Or is there a configuratioin option wich can cause \nsuch a behaviour?\n\n\nMartin"}, {"count": 7, "tags": [], "creator": "dgrinberg@vision.com", "is_private": false, "id": 6362, "attachment_id": null, "bug_id": 3534, "creation_time": "2001-10-04T08:14:20Z", "time": "2001-10-04T08:14:20Z", "text": "I have the same problem (jdk 1.3.1, Tomcat 4.0, Apache 3.2.3, oreilly upload \nclasses on unix solaris), and here is the stack trace:\n\njava.io.IOException: unexpected end of part\n        at com.oreilly.servlet.multipart.PartInputStream.fill\n(PartInputStream.java:95)\n        at com.oreilly.servlet.multipart.PartInputStream.read\n(PartInputStream.java:178)\n        at com.oreilly.servlet.multipart.PartInputStream.read\n(PartInputStream.java:151)\n        at com.oreilly.servlet.multipart.FilePart.write(FilePart.java:186)\n        at com.oreilly.servlet.multipart.FilePart.writeTo(FilePart.java:145)\n        at com.oreilly.servlet.MultipartRequest.<init>\n(MultipartRequest.java:139)\n        at com.oreilly.servlet.MultipartRequest.<init>(MultipartRequest.java:75)\n        at ... (my servlet)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n        at fm.servlet.FMBaseServlet.service(FMBaseServlet.java:48)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(Unknown Source)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(Unknown \nSource)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(Unknown Source)\n        at org.apache.catalina.core.StandardPipeline.invokeNext(Unknown Source)\n        at org.apache.catalina.core.StandardPipeline.invoke(Unknown Source)\n        at org.apache.catalina.core.ContainerBase.invoke(Unknown Source)\n        at org.apache.catalina.core.StandardContextValve.invoke(Unknown Source)\n        at org.apache.catalina.core.StandardPipeline.invokeNext(Unknown Source)\n        at org.apache.catalina.core.StandardPipeline.invoke(Unknown Source)\n        at org.apache.catalina.core.ContainerBase.invoke(Unknown Source)\n        at org.apache.catalina.core.StandardContext.invoke(Unknown Source)\n        at org.apache.catalina.core.StandardHostValve.invoke(Unknown Source)\n        at org.apache.catalina.core.StandardPipeline.invokeNext(Unknown Source)\n        at org.apache.catalina.core.StandardPipeline.invoke(Unknown Source)\n        at org.apache.catalina.core.ContainerBase.invoke(Unknown Source)\n        at org.apache.catalina.core.StandardEngineValve.invoke(Unknown Source)\n        at org.apache.catalina.core.StandardPipeline.invokeNext(Unknown Source)\n        at org.apache.catalina.core.StandardPipeline.invoke(Unknown Source)\n        at org.apache.catalina.core.ContainerBase.invoke(Unknown Source)\n        at org.apache.catalina.connector.warp.WarpRequestHandler.handle(Unknown \nSource)\n        at org.apache.catalina.connector.warp.WarpConnection.run(Unknown Source)\n        at java.lang.Thread.run(Thread.java:484)\n\nDmitry."}, {"attachment_id": null, "tags": [], "creator": "dgrinberg@vision.com", "is_private": false, "count": 8, "id": 6368, "time": "2001-10-04T08:48:27Z", "bug_id": 3534, "creation_time": "2001-10-04T08:48:27Z", "text": "This might help - http://www.servlets.com/soapbox/bugs.html has:\n\n\" ... Bug: File upload does not work with with Apache/Tomcat using the ajp13 \nconnector\n\nSymptoms: When handling a file upload the com.oreilly.servlet.MultipartRequest \nclass throws an IOException that says \"Corrupt form data: premature ending\" or \nsometimes \"unexpected end of part\".\n\nReason: Quoted from Lucian Cionca on tomcat-dev: \"The reason for this is a bug \nin the doRead() method of Ajp13ConnectorRequest, which causes the doRead(byte[] \nb, int off, int len) in that same class to prematurely end processing . The bug \nis in the conversion of the value read from the bodyBuff byte-array, to an \ninteger result. Bytes can have values from -128 to 127, while the result is \nexpected to be a positive integer (in the range 0 to 255). A result of -1 is \ninterpreted in the doRead(byte[] b, int off, int len) method as an error/end of \ninput. The patch to Tomcat sources is very simple. In function \"int doRead()\" \nin Ajp13ConnectorRequest.java instead of the line \n\nreturn bodyBuff[pos++]; \n\nthe line \n\nreturn bodyBuff[pos++] & 0xFF; \n\nshould be used. Credit for the solution should go to Amir Nuri who indicated \nthe solution to me.\"\n\nWorkaround: The best workaround is to upgrade to Tomcat 3.2.3. You can also \nupgrade to Tomcat 3.3 (currently beta) or Tomcat 4.0 (also currently beta), or \nrevert to ajp12 ... \"\n\nI have found your (Pier's) few days old ajp jar file in cvs, and that doRead() \nin Ajp13.class. I can not find Ajp13.class in Tomcat 4.0 source or binary \ndistribution, though.\n\nDmitry.\n\n"}, {"count": 9, "tags": [], "bug_id": 3534, "attachment_id": null, "is_private": false, "id": 6370, "time": "2001-10-04T08:53:25Z", "creator": "dgrinberg@vision.com", "creation_time": "2001-10-04T08:53:25Z", "text": "small note: I am using warp, it might not ne ajp all together."}, {"attachment_id": null, "tags": [], "creator": "remm@apache.org", "is_private": false, "count": 10, "id": 6684, "time": "2001-10-14T10:58:05Z", "bug_id": 3534, "creation_time": "2001-10-14T10:58:05Z", "text": "The bug is still unconfirmed, and it will be addressed later."}, {"count": 11, "tags": [], "bug_id": 3534, "text": "Reopening this bug since 4.0.1 is out of the door.", "id": 6718, "time": "2001-10-15T13:55:50Z", "creator": "pier@betaversion.org", "creation_time": "2001-10-15T13:55:50Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "pier@betaversion.org", "text": "Updating severity to Blocker. Now that there is a testcase, there won't be \nanother release of WebApp until this is not fixed.", "id": 6722, "time": "2001-10-15T14:01:00Z", "bug_id": 3534, "creation_time": "2001-10-15T14:01:00Z", "is_private": false, "attachment_id": null}, {"count": 13, "text": "Fixed in CVS... Should be picked up by next daily snapshot at http://\nnagoya.apache.org/~pier/", "bug_id": 3534, "is_private": false, "id": 6907, "time": "2001-10-19T12:25:16Z", "creator": "pier@betaversion.org", "creation_time": "2001-10-19T12:25:16Z", "tags": [], "attachment_id": null}, {"count": 14, "tags": [], "bug_id": 3534, "text": "I just downloaded sources from the CVS, compiled them and tried uploading \nfiles. I tries to upload to files using Jason Hunter's libraries. Result:\nfile 1 - original file size : 8,348 bytes, after upload 8,297\nfile 2 - original file size : 9,903 bytes, after upload 9,870\nThey seem to be corrupted. Also first ten bytes of corrupted files seemed to be \nthe same altough different from original files.\nWhen doing same operation directly with Tomcat (http://myserver:8080/....) \neverything seems to be ok.\nApache 1.3.19\nTomcat 4.01\nRedhat Linix 7.1\n", "id": 6921, "time": "2001-10-19T15:27:39Z", "creator": "adamskobo@yahoo.com", "creation_time": "2001-10-19T15:27:39Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 3534, "attachment_id": null, "text": "This has been fixed in the jakarta-tomcat-connectors CVS repository, not \nin the Tomcat repository (yet). We still have to find out how in the next \nversions we're going to build the WARP connector.\nPlease check out the sources from that CVS repository and build your \nWARP.JAR from there. It's fixed.", "id": 6923, "time": "2001-10-19T19:02:10Z", "creator": "pier@betaversion.org", "creation_time": "2001-10-19T19:02:10Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 3534, "is_private": false, "count": 16, "id": 9332, "time": "2002-01-03T17:25:25Z", "creator": "dlr@finemaltcoding.com", "creation_time": "2002-01-03T17:25:25Z", "text": "*** Bug 5549 has been marked as a duplicate of this bug. ***"}, {"count": 17, "tags": [], "bug_id": 3534, "attachment_id": null, "is_private": false, "id": 9360, "time": "2002-01-04T10:36:01Z", "creator": "dlr@finemaltcoding.com", "creation_time": "2002-01-04T10:36:01Z", "text": "*** Bug 5427 has been marked as a duplicate of this bug. ***"}, {"text": "*** Bug 5549 has been marked as a duplicate of this bug. ***", "tags": [], "bug_id": 3534, "is_private": false, "count": 18, "id": 9374, "time": "2002-01-05T08:49:10Z", "creator": "misciii@hotmail.com", "creation_time": "2002-01-05T08:49:10Z", "attachment_id": null}, {"count": 19, "tags": [], "bug_id": 3534, "text": "*** Bug 5728 has been marked as a duplicate of this bug. ***", "id": 9766, "time": "2002-01-21T11:32:31Z", "creator": "dlr@finemaltcoding.com", "creation_time": "2002-01-21T11:32:31Z", "is_private": false, "attachment_id": null}, {"count": 20, "tags": [], "bug_id": 3534, "text": "*** Bug 5427 has been marked as a duplicate of this bug. ***", "id": 45098, "time": "2003-10-05T18:00:01Z", "creator": "medthomas@ntlworld.com", "creation_time": "2003-10-05T18:00:01Z", "is_private": false, "attachment_id": null}]
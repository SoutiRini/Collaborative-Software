[{"count": 0, "tags": [], "bug_id": 43413, "attachment_id": null, "text": "SQL task manual (http://ant.apache.org/manual/CoreTasks/sql.html) states, \nthat \"...Multiple statements can be provided, separated by semicolons (or the \ndefined delimiter). Individual lines within the statements can be commented \nusing either --, // or REM at the start of the line...\"\n\nHaving keepformat=\"true\", ant sql task attempts to execute commented lines and \nfails.\n\n<target name=\"sql.test\">\n    <sql driver=\"${database.driver}\" \n        url=\"${database.url}\" \n        userid=\"${database.user_name}\" \n        password=\"${database.user_pwd}\"\n        classpathref=\"classpath-database\"\n        keepformat=\"true\"\n    >\n        <transaction>\n            REM test\n        </transaction>\n    </sql>\n</target>\n\nResults in:\njava.sql.SQLException: ORA-00900: invalid SQL statement\n\nWith other types of comments\n<transaction>--test</transaction>\nand\n<transaction>//test</transaction>\nexecution results in:\njava.sql.SQLException: Invalid SQL type\n\nHaving keepformat=\"false\" all calls succeed.", "id": 108305, "time": "2007-09-18T00:26:20Z", "creator": "barahlo@hot.ee", "creation_time": "2007-09-18T00:26:20Z", "is_private": false}, {"count": 1, "tags": [], "creator": "barahlo@hot.ee", "attachment_id": null, "text": "Attaching error stacktrace:\n\nC:\\myproject\\build.xml:23: java.sql.SQLException: Invalid SQL type\n        at org.apache.tools.ant.taskdefs.SQLExec.execute(SQLExec.java:454)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\n        at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute\n(DispatchUtils.java:105)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:357)\n        at org.apache.tools.ant.Target.performTasks(Target.java:385)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1298)\n        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets\n(DefaultExecutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1181)\n        at org.apache.tools.ant.Main.runBuild(Main.java:698)\n        at org.apache.tools.ant.Main.startAnt(Main.java:199)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)\nCaused by: java.sql.SQLException: Invalid SQL type\n        at oracle.jdbc.driver.DatabaseError.throwSqlException\n(DatabaseError.java:112)\n        at oracle.jdbc.driver.DatabaseError.throwSqlException\n(DatabaseError.java:146)\n        at oracle.jdbc.driver.DatabaseError.throwSqlException\n(DatabaseError.java:208)\n        at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:67)\n        at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:946)\n        at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout\n(OracleStatement.java:1168)\n        at oracle.jdbc.driver.OracleStatement.executeInternal\n(OracleStatement.java:1687)\n        at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:1653)\n        at org.apache.tools.ant.taskdefs.SQLExec.execSQL(SQLExec.java:564)\n        at org.apache.tools.ant.taskdefs.SQLExec.runStatements(SQLExec.java:532)\n        at org.apache.tools.ant.taskdefs.SQLExec$Transaction.runTransaction\n(SQLExec.java:768)\n        at org.apache.tools.ant.taskdefs.SQLExec$Transaction.access$000\n(SQLExec.java:707)\n        at org.apache.tools.ant.taskdefs.SQLExec.execute(SQLExec.java:438)\n        ... 16 more\n--- Nested Exception ---\njava.sql.SQLException: Invalid SQL type\n        at oracle.jdbc.driver.DatabaseError.throwSqlException\n(DatabaseError.java:112)\n        at oracle.jdbc.driver.DatabaseError.throwSqlException\n(DatabaseError.java:146)\n        at oracle.jdbc.driver.DatabaseError.throwSqlException\n(DatabaseError.java:208)\n        at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:67)\n        at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:946)\n        at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout\n(OracleStatement.java:1168)\n        at oracle.jdbc.driver.OracleStatement.executeInternal\n(OracleStatement.java:1687)\n        at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:1653)\n        at org.apache.tools.ant.taskdefs.SQLExec.execSQL(SQLExec.java:564)\n        at org.apache.tools.ant.taskdefs.SQLExec.runStatements(SQLExec.java:532)\n        at org.apache.tools.ant.taskdefs.SQLExec$Transaction.runTransaction\n(SQLExec.java:768)\n        at org.apache.tools.ant.taskdefs.SQLExec$Transaction.access$000\n(SQLExec.java:707)\n        at org.apache.tools.ant.taskdefs.SQLExec.execute(SQLExec.java:438)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\n        at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute\n(DispatchUtils.java:105)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:357)\n        at org.apache.tools.ant.Target.performTasks(Target.java:385)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1298)\n        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets\n(DefaultExecutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1181)\n        at org.apache.tools.ant.Main.runBuild(Main.java:698)\n        at org.apache.tools.ant.Main.startAnt(Main.java:199)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)", "id": 108315, "time": "2007-09-18T02:06:16Z", "bug_id": 43413, "creation_time": "2007-09-18T02:06:16Z", "is_private": false}, {"count": 2, "tags": [], "creator": "barahlo@hot.ee", "attachment_id": null, "id": 108316, "time": "2007-09-18T02:08:47Z", "bug_id": 43413, "creation_time": "2007-09-18T02:08:47Z", "is_private": false, "text": "Note: when the commented line is surrounded by correct sql clauses, script \nexecution succeeds even with keepformat=\"true\"\n\ni.e. \n\n<transaction>\n    select 1 from dual;\n    -- test\n    select 2 from dual;\n</transaction>\n\nis executed without errors"}, {"count": 3, "tags": [], "bug_id": 43413, "is_private": false, "id": 108324, "attachment_id": null, "creator": "stevel@apache.org", "creation_time": "2007-09-18T03:23:38Z", "time": "2007-09-18T03:23:38Z", "text": "This doesnt surprise me; When I took the sql code for use in my own project, I\ntook one look at the statement parsing code and decided to leave it well alone.\n\nAnyway, thanks for the tests; we should be able to replicate this pretty easily."}, {"count": 4, "tags": [], "creator": "riznob@hotmail.com", "attachment_id": null, "id": 108652, "time": "2007-09-26T10:31:35Z", "bug_id": 43413, "creation_time": "2007-09-26T10:31:35Z", "is_private": false, "text": "The keepformat attribute was created specifically for loading sql packages, \nfunctions and procedures, in order to maintain the formatting of the files \nbeing loaded, including comments. Unless you are loading packages, functions or \nprocedures, you probably want to leave keepformat=\"false\". \n\n-Rob Anderson"}, {"count": 5, "tags": [], "text": "I'd like to know if this bug is going to be fixed one day\nAccording to Bugzilla it's of \"major\" importance but it has not been fixed yet.\nAny ETA for that?\nAny workaround solution?", "is_private": false, "id": 173304, "creator": "franck93@gmail.com", "time": "2014-02-17T16:31:50Z", "bug_id": 43413, "creation_time": "2014-02-17T16:31:50Z", "attachment_id": null}]
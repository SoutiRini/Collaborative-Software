[{"count": 0, "tags": [], "bug_id": 51376, "attachment_id": null, "is_private": false, "id": 147130, "time": "2011-06-15T10:14:25Z", "creator": "axtavt@gmail.com", "creation_time": "2011-06-15T10:14:25Z", "text": "When a pre-existing instance of Servlet class is added dynamically by calling ServletContext.addServlet(String, Servlet) in ServletContainerInitializer, multiple problems arise:\n\n * setLoadOnStartup() is ignored\n * @ServletSecurity is ignored\n * destroy() can be called on non-initialized servlet\n\nAdding a servlet class (addServlet(String, String), addServlet(String, Class)) doesn't have this problems.\n\nIt happens because methods of org.apache.catalina.core.StandardWrapper treat presence of servlet instance as an indicator of the fact that servlet have been initialized, that is not true when addServlet(String, Servlet) is used."}, {"count": 1, "tags": [], "text": "(In reply to comment #0)\n>  * @ServletSecurity is ignored\n\nThis is as required by the Servlet spec (section 13.4.1) so this aspect of the bug report is INVALID. This is also made clear in the Servlet 3.0 Javadoc.\n\nI'm still researching the other issues. The specification is ambiguous on what to do here. I'm leaning towards making a change but I need to check that any such change doesn't trigger any TCK failures.", "is_private": false, "id": 147133, "creator": "markt@apache.org", "time": "2011-06-15T12:04:43Z", "bug_id": 51376, "creation_time": "2011-06-15T12:04:43Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 51376, "text": "The Servlet TCK still passes with my change in place so I am going to go ahead and commit it to fix this issue. I'll be a little while as I need to write a test case first.", "id": 147137, "time": "2011-06-15T12:48:20Z", "creator": "markt@apache.org", "creation_time": "2011-06-15T12:48:20Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 51376, "text": "Fixed in 7.0.x and will be included in 7.0.17 onwards.", "id": 147138, "time": "2011-06-15T13:21:19Z", "creator": "markt@apache.org", "creation_time": "2011-06-15T13:21:19Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 51376, "text": "(In reply to comment #3)\n> Fixed in 7.0.x and will be included in 7.0.17 onwards.\n\nThis one is still unresolved:\n\n * destroy() can be called on non-initialized servlet\n\nIf servlet added via addServlet(String, Servlet) without setLoadOnStartup() was never accessed, its destroy() method is called during shutdown despite the fact that init() was never called.", "id": 147144, "time": "2011-06-15T14:50:26Z", "creator": "axtavt@gmail.com", "creation_time": "2011-06-15T14:50:26Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "text": "Thanks for the catch. Fixed in 7.0.x and will be in 7.0.17 onwards.", "is_private": false, "id": 147159, "creator": "markt@apache.org", "time": "2011-06-15T20:32:36Z", "bug_id": 51376, "creation_time": "2011-06-15T20:32:36Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 11784, "text": "We are implementing Tomcat in our Production environment (on AIX 4.3.3), and \nhave been facing a problem. In our Servlet init() function, we load a class \ndynamically using Class.forName(). The class being loaded resides in our WEB-\nINF/classes directory. The init() method works fine. But when we load another \nclass in our destroy() method, we get a ClassNotFoundException. Both classes \nreside in the same WEB-INF/classes directory.\n\nThis problem occurs only when the classes are in WEB-INF/classes directory. If \nwe put the classes in a JAR file and place the JAR file in WEB-INF/lib, the \nproblem goes away.\n\nI managed to reproduce the problem on my PC (running on Windows 98) by creating \na small test servlet. The code for the servlet and the helper classes are given \nbelow:\n\nTry class:\n----------\n\nimport java.io.*;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\n\npublic class Try extends HttpServlet {\n\n    public void init() throws ServletException {\n        getServletContext().log(\"Try initialized\");\n        try {\n             Class.forName(\"Test1\");\n        }\n        catch(Exception e) {\n            getServletContext().log(\"Caught exception\" + e);\n        }\n    }\n\n    public void destroy() {\n        getServletContext().log(\"Try destroyed\");\n        try {\n             Class.forName(\"Test2\");\n        }\n        catch(Exception e) {\n            getServletContext().log(\"Caught exception\" + e);\n        }\n    }\n\n    public void doGet(HttpServletRequest request, HttpServletResponse response)\n        throws IOException, ServletException {\n        response.setContentType(\"text/plain\");\n        PrintWriter writer = response.getWriter();\n        writer.println(\"Hello World\");\n    }\n}\n\nTest1 class:\n------------\npublic class Test1 {\n\tpublic void sayHello() {\n\t\tSystem.out.println(\"In Test1\");\n\t}\n}\n\nTest2 class:\n------------\npublic class Test2 {\n\n\tpublic void sayHello() {\n\t\tSystem.out.println(\"In Test2\");\n\t}\n}\n\nOutput from log file:\n---------------------\n2002-08-16 23:39:09 StandardHost[localhost]: Installing web application at \ncontext path /dm from URL file:C:\\Program Files\\Apache Tomcat 4.0\\webapps\\dm\n2002-08-16 23:39:09 WebappLoader[/dm]: Deploying class repositories to work \ndirectory C:\\Program Files\\Apache Tomcat 4.0\\work\\Standalone\\localhost\\dm\n2002-08-16 23:39:09 StandardManager[/dm]: Seeding random number generator class \njava.security.SecureRandom\n2002-08-16 23:39:09 StandardManager[/dm]: Seeding of random number generator \nhas been completed\n2002-08-16 23:39:09 ContextConfig[/dm]: Missing application web.xml, using \ndefaults only\n2002-08-16 23:39:09 ContextConfig[/dm]: Added certificates -> request attribute \nValve\n2002-08-16 23:39:09 StandardWrapper[/dm:default]: Loading container servlet \ndefault\n2002-08-16 23:39:09 default: init\n2002-08-16 23:39:09 StandardWrapper[/dm:invoker]: Loading container servlet \ninvoker\n2002-08-16 23:39:09 invoker: init\n2002-08-16 23:39:09 jsp: init\n2002-08-16 23:39:09 Internal Error: File /WEB-INF/web.xml not found\n2002-08-16 23:39:18 org.apache.catalina.INVOKER.Try: init\n2002-08-16 23:39:18 Try initialized\n2002-08-16 23:39:45 StandardHost[localhost]: Removing web application at \ncontext path /manager\n2002-08-16 23:39:45 StandardHost[localhost]: Removing web application at \ncontext path /dm\n2002-08-16 23:39:45 Try destroyed\n2002-08-16 23:39:45 Caught exceptionjava.lang.ClassNotFoundException: Test2", "id": 21187, "time": "2002-08-16T23:02:41Z", "creator": "dibyendu@mazumdar.demon.co.uk", "creation_time": "2002-08-16T23:02:41Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "medthomas@ntlworld.com", "attachment_id": null, "is_private": false, "id": 50154, "time": "2004-01-06T23:31:35Z", "bug_id": 11784, "creation_time": "2004-01-06T23:31:35Z", "text": "It looks like you are using packageless classes. This could well be the root \ncause of the problem. See \nhttp://jakarta.apache.org/tomcat/faq/classnotfound.html for more info.\n\nI haven't tested this but I am going to resolve as invalid as this is a fairly \ncommon problem. If using packages doesn't solve the problem than please feel \nfree to re-open this bug and I will look at it further."}]
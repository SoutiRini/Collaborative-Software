[{"count": 0, "tags": [], "creator": "felix.schumacher@internetallee.de", "attachment_id": null, "id": 147704, "time": "2011-07-03T10:19:46Z", "bug_id": 51467, "creation_time": "2011-07-03T10:19:46Z", "is_private": false, "text": "In StandardContext method Thread#run is used. This is most probably a mistake, since a few lines below Thread#join is called to wait for the completion of the thread.\n\nSo we could either remove the join and get rid of the thread by using just a runnable, or start the thread."}, {"count": 1, "tags": [], "bug_id": 51467, "attachment_id": 27245, "text": "Created attachment 27245\nuse start instead of run to start a thread", "id": 147705, "time": "2011-07-03T10:20:20Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2011-07-03T10:20:20Z", "is_private": false}, {"count": 2, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "id": 147707, "time": "2011-07-03T16:43:45Z", "bug_id": 51467, "creation_time": "2011-07-03T16:43:45Z", "is_private": false, "text": "I'm wondering why the whole process is run in a Thread in the first place. If the thread is start()ed, when immediately join()ed, and all exceptions are documented not to be expected, it seems like the use of a thread is wasteful.\n\nYour patch, while slightly more clear than the original code, does not appear to actually any behavior: the parent thread will still block, except this time the thread is actually launched."}, {"count": 3, "tags": [], "bug_id": 51467, "text": "Re Comment #2: http://svn.apache.org/viewvc?view=revision&revision=1044145\n\nLog says:\n\nbug 49159: Improve ThreadLocal memory leak clean-up \nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=49159\n\nUse a dedicated thread when calling web application code when it is started and stopped (calls to Listeners, Filters, Servlets).\n\nCode comment says:\n\n// we do it in a dedicated thread for memory leak protection, in\n// case some webapp code registers some ThreadLocals that they\n// forget to cleanup\n\nRegards,\n\nRainer", "id": 147708, "time": "2011-07-03T17:45:23Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2011-07-03T17:45:23Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "chris@christopherschultz.net", "text": "Rainer,\n\nAah, I didn't look far enough up in the code to see that comment: thanks for clarifying.\n\nWithout running Thread.start(), I believe any ThreadLocals registered will be registered to the calling thread, so Felix is right: changing Thread.run to Thread.start is appropriate in this case.", "id": 147710, "attachment_id": null, "bug_id": 51467, "creation_time": "2011-07-03T18:41:59Z", "time": "2011-07-03T18:41:59Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 51467, "attachment_id": null, "id": 147723, "time": "2011-07-04T12:50:46Z", "creator": "markt@apache.org", "creation_time": "2011-07-04T12:50:46Z", "is_private": false, "text": "Thanks for the patch.\n\nFixed in 7.0.x and will be included in 7.0.18 onwards."}, {"count": 6, "tags": [], "bug_id": 51467, "attachment_id": null, "id": 147729, "creation_time": "2011-07-04T18:50:13Z", "time": "2011-07-04T18:50:13Z", "creator": "slaurent@apache.org", "text": "It seems there used to be call to DedicatedThreadExecutor.executeInOwnThread()\nbut r1087715 changed it to create a new Thread : http://svn.apache.org/viewvc/tomcat/trunk/java/org/apache/catalina/core/StandardContext.java?r1=1087715&r2=1087714&pathrev=1087715", "is_private": false}]
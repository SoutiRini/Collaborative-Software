[{"count": 0, "attachment_id": null, "bug_id": 40749, "text": "Hello,\n\nI have discovered a minor bug in mod_mime_magic. If an entry in the magic file\nhas the type \"string\" and a mime type containing \"%n\", and you try to fetch a\nfile with Apache that matches that entry, the Apache child will crash with a\nsegmentation fault.\n\nI suppose that the reason why the code supports format strings in the desc\nvariable is so you can use \"%d\" or \"%s\" and include data from the file you are\ntrying to determine the type of in the output, but does anyone use this\nfunctionality with Apache? If they do, is it necessary to support the full\nformat string functionality with things like \"%n\" and \"%x\", or is it enough to\nsimulate a subset of it (say, only \"%s\" and \"%d\")?\n\nBelow is a session that shows off this problem by downloading a SID file,\nchanging the magic file entry for SID files, and then crashing the Apache child\nby fetching the file.\n\n// Ulf Harnhammar\n   metaur@telia.com\n\n\n$ cd htdocs\n$ wget http://hafnium.prg.dtu.dk/HVSC/C64Music/Galway_Martin/Yie_Ar_Kung_Fu.sid\n--01:04:01-- \nhttp://hafnium.prg.dtu.dk/HVSC/C64Music/Galway_Martin/Yie_Ar_Kung_Fu.sid\n           => `Yie_Ar_Kung_Fu.sid'\nResolving hafnium.prg.dtu.dk... 130.225.91.226\nConnecting to hafnium.prg.dtu.dk|130.225.91.226|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 7,934 (7.7K) [audio/prs.sid]\n\n100%[=================================================================================================================>]\n7,934         --.--K/s\n\n01:04:01 (190.93 KB/s) - `Yie_Ar_Kung_Fu.sid' saved [7934/7934]\n\n$ mv Yie_Ar_Kung_Fu.sid yiear.kungfu\n$ cd ..\n$ bin/httpd\n$ nc localhost 1337\nHEAD /yiear.kungfu HTTP/1.0\n\nHTTP/1.1 200 OK\nDate: Thu, 12 Oct 2006 23:05:01 GMT\nServer: Apache/2.0.59 (Unix)\nLast-Modified: Sat, 17 Aug 2002 23:55:45 GMT\nETag: \"c46e-1efe-13ace240\"\nAccept-Ranges: bytes\nContent-Length: 7934\nConnection: close\nContent-Type: audio/prs.sid\n\n$ cd conf\n$ fgrep prs.sid magic\n0   string      PSID        audio/prs.sid\n$ sed -e 's/prs\\.sid/%n%n%n%n/' magic > magic2\n$ mv magic2 magic\n$ fgrep '%n%n' magic\n0   string      PSID        audio/%n%n%n%n\n$ ps ax | fgrep httpd\n14354 ?        Ss     0:00 bin/httpd\n14355 ?        S      0:00 bin/httpd\n14356 ?        S      0:00 bin/httpd\n14357 ?        S      0:00 bin/httpd\n14358 ?        S      0:00 bin/httpd\n14359 ?        S      0:00 bin/httpd\n14361 ?        S      0:00 bin/httpd\n14378 pts/0    R+     0:00 grep -F httpd\n$ kill -HUP 14354\n$ cd ..\n$ nc localhost 1337\nHEAD /yiear.kungfu HTTP/1.0\n\n$ cd logs\n$ cat access_log\n127.0.0.1 - - [13/Oct/2006:01:05:01 +0200] \"HEAD /yiear.kungfu HTTP/1.0\" 200 -\n$ cat error_log\n[Fri Oct 13 01:04:46 2006] [notice] Apache/2.0.59 (Unix) configured -- resuming\nnormal operations\n[Fri Oct 13 01:05:58 2006] [notice] SIGHUP received.  Attempting to restart\n[Fri Oct 13 01:05:58 2006] [notice] Apache/2.0.59 (Unix) configured -- resuming\nnormal operations\n[Fri Oct 13 01:06:17 2006] [notice] child pid 14379 exit signal Segmentation\nfault (11)\n$", "id": 94788, "time": "2006-10-12T16:41:29Z", "creator": "metaur@telia.com", "creation_time": "2006-10-12T16:41:29Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "rahul.g.nair@gmail.com", "is_private": false, "text": "Created attachment 22332\nvalidate the mime magic file correctly\n\nSince the only use for place holders (%xx) in desc is to allow a string from the file to be used, it cannot have more than one %xx. This can be checked during the read config time itself.", "id": 119129, "time": "2008-07-30T10:29:10Z", "bug_id": 40749, "creation_time": "2008-07-30T10:29:10Z", "attachment_id": 22332}]
[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "is_private": false, "id": 164425, "attachment_id": null, "bug_id": 54379, "creation_time": "2013-01-07T04:07:15Z", "time": "2013-01-07T04:07:15Z", "text": "There appears to be a feature that web[-fragment].xml file can contain such elements as <post-construct> and <pre-destroy>, and they are treated as equivalents to @PostConstruct and @PreDestroy annotations being present on the classes mentioned in them.\n\nThis feature is\n1. mentioned in the Java EE 6 Platform Specification, chapter \"EE.5.2.5 Annotations and Injection\" [1]\n2. mentioned in chapter \"8.2.3 Assembling the descriptor from web.xml, webfragment.xml and annotations\",\nsee points \"k.\" and \"l.\" on page 81 (103/230) of servlet-3_0-mrel-spec.pdf\n\n[1] javaee_platform-6_0-fr-spec.pdf\nhttp://jcp.org/aboutJava/communityprocess/final/jsr316/index.html\n\nAn example can be found in Jetty wiki:\nhttp://wiki.eclipse.org/Jetty/Feature/Annotations#Lifecycle_callbacks:_PostConstruct_PreDestroy\n\nSearching by the tag names, I do not see any code in the current trunk that processes those XML elements."}, {"count": 1, "tags": [], "creator": "violetagg@apache.org", "is_private": false, "id": 164446, "attachment_id": null, "bug_id": 54379, "creation_time": "2013-01-07T20:27:41Z", "time": "2013-01-07T20:27:41Z", "text": "Hi,\n\nI'm going to work on this.\n\nRegards\nVioleta"}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Could you provide a progress update please. This is (currently) the only remaining issue that needs fixing before the 7.0.35 tag.", "id": 164519, "time": "2013-01-09T12:02:53Z", "bug_id": 54379, "creation_time": "2013-01-09T12:02:53Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 54379, "attachment_id": null, "text": "I'm preparing the test cases just now.\nI'll be ready till end of the day is that OK?", "id": 164520, "time": "2013-01-09T12:10:02Z", "creator": "violetagg@apache.org", "creation_time": "2013-01-09T12:10:02Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 54379, "text": "That sounds great. Thanks.", "id": 164521, "time": "2013-01-09T12:16:49Z", "creator": "markt@apache.org", "creation_time": "2013-01-09T12:16:49Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "violetagg@apache.org", "is_private": false, "id": 164552, "attachment_id": 29840, "bug_id": 54379, "creation_time": "2013-01-10T07:32:02Z", "time": "2013-01-10T07:32:02Z", "text": "Created attachment 29840\nPatch proposal + tests\n\nHi,\n\nPlease find attached a patch proposal and tests.\n\nImportant notes to the implementation:\n1. Only one method per given event is allowed per class.\n2. As per javaee_6.xsd if 'lifefycle-callback-class' element is not specified then the component that contains definitions for post-construct or pre-destroy should be used. For web applications we can specify this functionality only per web application and not per web component so in the implementation if the class is not specified then IllegalArgumentException will be thrown.\n3. If method for a given event is specified in deployment descriptor and with annotation - the definition in the descriptor will be used.\n4. If there are definitions in web.xml and in web-fragment.xml then web-fragment.xml will be ignored.\n5. If there are no definitions in the web.xml and we have definitions in web fragments then they will be merged. However if there are conflicts - more than one method per given event per class - the merge operation will not succeed.\n6. If the method specified in the deployment descriptor cannot be found in the class then IllegalArgumentException will be thrown.\n\nI'm looking forward to your comment.\n\nRegards\nVioleta"}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Many thanks for the patch. That was a much bigger job than I realised.\n\nI have applied the patch to trunk with just a few minor tweaks:\n- fixed various IDE / Checkstyle warnings (Java 7 <>, whitespace etc)\n- removed unnecessary use of this (just a style thing)\n- removed syncs from new maps in StandardContext (deployment is always single threaded for an app)\n- renamed a test class for consistency\n- correct a few indents\n- Used Tomcat.enableNaming() rather than system property\n\nI'll back-port to 7.0.x shortly.", "id": 164558, "time": "2013-01-10T11:43:07Z", "bug_id": 54379, "creation_time": "2013-01-10T11:43:07Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 54379, "text": "Fixed in 7.0.x and will be included in 7.0.35 onwards. Thanks again for the patch.", "id": 164559, "time": "2013-01-10T11:48:06Z", "creator": "markt@apache.org", "creation_time": "2013-01-10T11:48:06Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 15497, "is_private": false, "text": "I think I have found a possible deadlock in Tomcat 4.1.12 and 4.1.14 using JDk \n1.4.1\nHere is the thread dump of the vm:\n\n\"Thread-15\" daemon prio=5 tid=0x0AE6E520 nid=0x10c0 in Object.wait() \n[c71f000..c71fd88]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <05289758> (a \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\n        at java.lang.Object.wait(Object.java:426)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:512)\n        - locked <05289758> (a \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\n        at java.lang.Thread.run(Thread.java:536)\n\n\"Thread-14\" daemon prio=5 tid=0x0AE72D90 nid=0x9f0 in Object.wait() \n[c6df000..c6dfd88]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <052897C0> (a \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\n        at java.lang.Object.wait(Object.java:426)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:512)\n        - locked <052897C0> (a \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\n        at java.lang.Thread.run(Thread.java:536)\n\n\n\n\n\"Thread-9\" daemon prio=5 tid=0x0AEE38E8 nid=0x1134 in Object.wait() \n[c55f000..c55fd88]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <039BF8B8> (a \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\n        at java.lang.Object.wait(Object.java:426)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:512)\n        - locked <039BF8B8> (a \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\n        at java.lang.Thread.run(Thread.java:536)\n\n\"MonitorRunnable\" daemon prio=5 tid=0x0B694950 nid=0xca8 in Object.wait() \n[c4df000..c4dfd88]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <037A6708> (a \norg.apache.tomcat.util.threads.ThreadPool$MonitorRunnable)\n        at org.apache.tomcat.util.threads.ThreadPool$MonitorRunnable.run\n(ThreadPool.java:423)\n        - locked <037A6708> (a \norg.apache.tomcat.util.threads.ThreadPool$MonitorRunnable)\n        at java.lang.Thread.run(Thread.java:536)\n\n\"Thread-6\" daemon prio=5 tid=0x0B693DC0 nid=0x908 in Object.wait() \n[c49f000..c49fd88]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <037B2880> (a \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\n        at java.lang.Object.wait(Object.java:426)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:512)\n        - locked <037B2880> (a \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\n        at java.lang.Thread.run(Thread.java:536)\n\n\"Thread-5\" daemon prio=5 tid=0x0B6933D0 nid=0xe4c in Object.wait() \n[c45f000..c45fd88]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <037B28E8> (a \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\n        at java.lang.Object.wait(Object.java:426)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:512)\n        - locked <037B28E8> (a \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\n        at java.lang.Thread.run(Thread.java:536)\n\n\n\"HostConfig[localhost]\" daemon prio=5 tid=0x0B6923E8 nid=0x1044 waiting on \ncondition [c39f000..c39fd88]\n        at java.lang.Thread.sleep(Native Method)\n        at org.apache.catalina.startup.HostConfig.threadSleep\n(HostConfig.java:985)\n        at org.apache.catalina.startup.HostConfig.run(HostConfig.java:1009)\n        at java.lang.Thread.run(Thread.java:536)\n\n\"StandardManager[/webdav]\" daemon prio=5 tid=0x0AE40E98 nid=0x9d4 waiting on \ncondition [c35f000..c35fd88]\n        at java.lang.Thread.sleep(Native Method)\n        at org.apache.catalina.session.StandardManager.threadSleep\n(StandardManager.java:780)\n        at org.apache.catalina.session.StandardManager.run\n(StandardManager.java:839)\n        at java.lang.Thread.run(Thread.java:536)\n\n\"StandardManager[]\" daemon prio=5 tid=0x0AE40200 nid=0x112c waiting on \ncondition [c2df000..c2dfd88]\n        at java.lang.Thread.sleep(Native Method)\n        at org.apache.catalina.session.StandardManager.threadSleep\n(StandardManager.java:780)\n        at org.apache.catalina.session.StandardManager.run\n(StandardManager.java:839)\n        at java.lang.Thread.run(Thread.java:536)\n\n\"Thread-2\" daemon prio=5 tid=0x0AD67230 nid=0x11b8 waiting on condition \n[c25f000..c25fd88]\n        at java.lang.Thread.sleep(Native Method)\n        at com.sap.mw.jco.JCO$PoolManager$TimeoutChecker.run(JCO.java:3001)\n\n\"StandardManager[/adstar]\" daemon prio=5 tid=0x0AD84670 nid=0x1330 waiting on \ncondition [bedf000..bedfd88]\n        at java.lang.Thread.sleep(Native Method)\n        at org.apache.catalina.session.StandardManager.threadSleep\n(StandardManager.java:780)\n        at org.apache.catalina.session.StandardManager.run\n(StandardManager.java:839)\n        at java.lang.Thread.run(Thread.java:536)\n\n\"StandardManager[/manager]\" daemon prio=5 tid=0x0AC92CD0 nid=0x13ec waiting on \ncondition [be9f000..be9fd88]\n        at java.lang.Thread.sleep(Native Method)\n        at org.apache.catalina.session.StandardManager.threadSleep\n(StandardManager.java:780)\n        at org.apache.catalina.session.StandardManager.run\n(StandardManager.java:839)\n        at java.lang.Thread.run(Thread.java:536)\n\n\"StandardManager[/admin]\" daemon prio=5 tid=0x0B62BCA0 nid=0xdbc waiting on \ncondition [be5f000..be5fd88]\n        at java.lang.Thread.sleep(Native Method)\n        at org.apache.catalina.session.StandardManager.threadSleep\n(StandardManager.java:780)\n        at org.apache.catalina.session.StandardManager.run\n(StandardManager.java:839)\n        at java.lang.Thread.run(Thread.java:536)\n\n\"Signal Dispatcher\" daemon prio=10 tid=0x00848D60 nid=0x1038 waiting on \ncondition [0..0]\n\n\"Finalizer\" daemon prio=9 tid=0x0023FD28 nid=0xeec in Object.wait() \n[aa8f000..aa8fd88]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <02E25148> (a java.lang.ref.ReferenceQueue$Lock)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:111)\n        - locked <02E25148> (a java.lang.ref.ReferenceQueue$Lock)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:127)\n        at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\n\n\"Reference Handler\" daemon prio=10 tid=0x0023E8A0 nid=0x10d8 in Object.wait() [a\na4f000..aa4fd88]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <02E251B0> (a java.lang.ref.Reference$Lock)\n        at java.lang.Object.wait(Object.java:426)\n        at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:113)\n        - locked <02E251B0> (a java.lang.ref.Reference$Lock)\n\n\"main\" prio=5 tid=0x00235570 nid=0xa8c runnable [6f000..6fc3c]\n        at java.net.PlainSocketImpl.socketAccept(Native Method)\n        at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:353)\n        - locked <03818C18> (a java.net.PlainSocketImpl)\n        at java.net.ServerSocket.implAccept(ServerSocket.java:439)\n        at java.net.ServerSocket.accept(ServerSocket.java:410)\n        at org.apache.catalina.core.StandardServer.await\n(StandardServer.java:526)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:521)\n        at org.apache.catalina.startup.Catalina.execute(Catalina.java:400)\n        at org.apache.catalina.startup.Catalina.process(Catalina.java:180)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)\n\n\"VM Thread\" prio=5 tid=0x0023D668 nid=0x1274 runnable\n\n\"VM Periodic Task Thread\" prio=10 tid=0x00847B68 nid=0x1388 waiting on condition\n\n\"Suspend Checker Thread\" prio=10 tid=0x00848780 nid=0xdec runnable", "id": 28026, "time": "2002-12-18T19:09:32Z", "creator": "alfred.bruckmann@siemens.com", "creation_time": "2002-12-18T19:09:32Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 28059, "time": "2002-12-19T16:07:36Z", "bug_id": 15497, "creation_time": "2002-12-19T16:07:36Z", "is_private": false, "text": "Nothing looks wrong. The threads are waiting for something to do."}, {"count": 2, "attachment_id": null, "creator": "remm@apache.org", "is_private": false, "id": 28097, "time": "2002-12-20T09:33:42Z", "bug_id": 15497, "creation_time": "2002-12-20T09:33:42Z", "tags": [], "text": "*** Bug 15560 has been marked as a duplicate of this bug. ***"}, {"count": 3, "tags": [], "text": "I too am having the same problem. Tomcat runs fine for hours, sometimes even\ndays then suddnly stop answering requests. Browser is hung waiting for response\nforever. Similar thread dump to the poster of the duplicate bug, and again when\nshutting down tomcat I get:\n\nStopping service FraudScrubClient\nStopping service FraudScrubAdmin\nStopping service GetOnline\nFeb 21, 2003 9:04:27 PM org.apache.tomcat.util.log.CommonLogHandler log\nSEVERE: Caught exception executing\norg.apache.tomcat.util.net.TcpWorkerThread@11cc367, terminating thread\njava.lang.IllegalStateException\n        at org.apache.tomcat.util.threads.ThreadPool.runIt(ThreadPool.java:245)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:503)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:530)\n        at java.lang.Thread.run(Thread.java:536)\nFeb 21, 2003 9:04:27 PM org.apache.tomcat.util.log.CommonLogHandler log\nSEVERE: Caught exception executing\norg.apache.tomcat.util.net.TcpWorkerThread@11cc367, terminating thread\njava.lang.IllegalStateException\n        at org.apache.tomcat.util.threads.ThreadPool.runIt(ThreadPool.java:245)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:503)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:530)\n        at java.lang.Thread.run(Thread.java:536)\nFeb 21, 2003 9:04:27 PM org.apache.tomcat.util.log.CommonLogHandler log\nSEVERE: Caught exception executing\norg.apache.tomcat.util.net.TcpWorkerThread@11cc367, terminating thread\njava.lang.IllegalStateException\n        at org.apache.tomcat.util.threads.ThreadPool.runIt(ThreadPool.java:245)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:503)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:530)\n        at java.lang.Thread.run(Thread.java:536)\nFeb 21, 2003 9:04:27 PM org.apache.tomcat.util.log.CommonLogHandler log\nSEVERE: Caught exception executing\norg.apache.tomcat.util.net.TcpWorkerThread@11cc367, terminating thread\njava.lang.IllegalStateException\n        at org.apache.tomcat.util.threads.ThreadPool.runIt(ThreadPool.java:245)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:503)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:530)\n        at java.lang.Thread.run(Thread.java:536)\n\netc. etc.\n\nThere is no way this is an invalid bug. The server is totally dead until a\nstop/start is performed.", "attachment_id": null, "bug_id": 15497, "id": 31782, "time": "2003-02-22T02:18:17Z", "creator": "rnice@websitebilling.com", "creation_time": "2003-02-22T02:18:17Z", "is_private": false}, {"count": 4, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 31788, "time": "2003-02-22T08:54:23Z", "bug_id": 15497, "creation_time": "2003-02-22T08:54:23Z", "is_private": false, "text": "If you look at the code, you'll see that neither your errors on shutdown (which\nyou can get if you shutdown Tomcat while requests are being processed), nor the\nthread dump given before, do indicate a bug. Something else may be wrong in your\nsituation, but the information you provide does not indicate a wrong behavior\nfrom Tomcat (which is why the bug is invalid). I strongly doubt there is a\ndeadlock or similar problem in that thread pool code."}, {"count": 5, "tags": [], "text": "As I have yet again received an email from someone with the same problem asking\nif I have a workaround, let me post my resolution here.\n\nI was using 4.1.18 at the time with an SSL direct to client browser setup.\nMoving to 4.1.24 cleared this right up. I remember a few months ago there were\nsome messages on the dev mailing list regarding thread fixes, either way it\nmagically disappeared with this release.\n\nOne other thing regarding direct SSL; don't do it. Hook it up via Apache/mod_jk\nbecause there are still session bug issues with Internet Explorer and it's\nnothing but pain. This should be in big bold wording on the main website.", "is_private": false, "bug_id": 15497, "id": 40884, "time": "2003-07-17T07:07:28Z", "creator": "rnice@websitebilling.com", "creation_time": "2003-07-17T07:07:28Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "alfred.bruckmann@siemens.com", "attachment_id": null, "is_private": false, "id": 40885, "time": "2003-07-17T07:16:19Z", "bug_id": 15497, "creation_time": "2003-07-17T07:16:19Z", "text": "This deadlock only happens when using SSL and using Coyote connector. Changing \nto 'old' HttpConnector solved the problem."}]
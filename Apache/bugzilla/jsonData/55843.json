[{"count": 0, "tags": [], "bug_id": 55843, "attachment_id": 31090, "is_private": false, "id": 171561, "time": "2013-12-04T16:45:25Z", "creator": "detlef.brendle@canoo.com", "creation_time": "2013-12-04T16:45:25Z", "text": "Created attachment 31090\njunit test case\n\nConsider the attached test case:\n- If I evaluate the formula:\nIF(B1=0,\"\",((ROW()-ROW(A$1))*12))\nthe result is:\norg.apache.poi.ss.usermodel.CellValue [-12.0]\n\nwhich in my eyes is wrong.\n\nWhen negating the condition and  the formula results in the correct value:\nIF(NOT(B1=0),((ROW()-ROW(A$1))*12),\"\")"}, {"count": 1, "tags": [], "text": "This problem occurs also with POI 3.10. Generally speaking, I've noticed that none of ROW() or COLUMN() functions work fine if used as THIRD argument of an IF() function.\n\nExamples are:\nIF(FALSE,0,ROW()) returns FALSE instead of <row number>\nIF(FALSE,0,-ROW()) returns 0.0 instead of -<row number>\n\nSame behavior with COLUMN() Function.\nIf other functions (SUM(), NOW(), etc..) are used, it works as expected\nIf these fumctions are used as SECOND argument (TRUE branch) it works as expected.\n\nDebugging POI code I've noticed the following \"strange\" if statement, which, in my opinion is the cause of the wrong behavior:\n\nWorkbookEvaluator line 479 (POI 3.10)\nif (ptgs[i] instanceof AttrPtg && nextPtg instanceof FuncVarPtg) {\n    // this is an if statement without a false param [...]\n    i++;\t\t\t\t\t\t\t   \n    stack.push(BoolEval.FALSE);\n}\nWhen processing IF function, nextPtg IS the ROW() function and this code makes it always return FALSE (or 0.0).", "attachment_id": null, "id": 177269, "creator": "guarale@hotmail.com", "time": "2014-08-19T14:04:13Z", "bug_id": 55843, "creation_time": "2014-08-19T14:04:13Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 55843, "is_private": false, "text": "There was some optimization for IF() added some time ago under Bug 48195 which did not take a nested function as else-part into consideration.\n\nThis should be fixed with r1621641.", "id": 177479, "time": "2014-08-31T21:50:18Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2014-08-31T21:50:18Z", "attachment_id": null}]
[{"count": 0, "text": "We have been having intermittent Apache crashes on OS X 10.7.5 (Lion Server).  These crashes seem to happen at random and we've tried everything to find the cause.\n\nWe started noticing them more when we changed was MaxRequestsPerChild to 10 to stop memleaks on some scripts we are running.  We noticed that the crashes seem to happen when the children are coming to the end of their life and have served their 10 requests.\n\nWe also notice the segfaults come in waves.  For example, we won't notice any for three hours and the all of a sudden they happen every minute for 10 faults and then go quiet again (possible somebody running a vulnerability scanner).\n \nThe problem may be with PHP or Apache itself.  We have also noticed the same crashes with XCache/APC disabled.\n \nThe crashes seem to always be on \"Thread 1\" which is kernel/OS side of things most of the time - e.g.:\n\n    Thread 1 Crashed:\n    0   libsystem_kernel.dylib                  0x00007fff910eb192 __workq_kernreturn + 10\n    1   libsystem_c.dylib                       0x00007fff8fe96594 _pthread_wqthread + 758\n    2   libsystem_c.dylib                       0x00007fff8fe97b85 start_wqthread + 13\n \nAny help, suggestions, tips or bug fixed are very greatly appreciated.  Although, please do not suggest upgrading PHP/Apache or OS X - we need a fix for the system in its current state; we're not in a position to upgrade/recompile anything on such a live server so feel free to let us know of patches or fixes (band-aids!) either on the OS side or Apache side.\n\nWe would love help in finding the cause or what page request creates the crash (however we can't use mod_whatkilledus because we haven't compiled with exception hooks.\n\nAny suggested Apache modules and debugging tools are greatly appreciated.\n \nOur crash report:\n\n<pre>\nProcess:         httpd [52830]\nPath:            /usr/sbin/httpd\nIdentifier:      httpd\nVersion:         ??? (???)\nCode Type:       X86-64 (Native)\nParent Process:  httpd [86996]\n \n \nDate/Time:       2013-05-15 09:39:36.067 +0100\nOS Version:      Mac OS X Server 10.7.5 (11G63)\nReport Version:  9\n \n \nCrashed Thread:  1  Dispatch queue: com.apple.libdispatch-manager\n \n \nException Type:  EXC_CRASH (SIGSEGV)\nException Codes: 0x0000000000000000, 0x0000000000000000\n \n \nApplication Specific Information:\nobjc[86996]: garbage collection is OFF\n \n \nThread 0:: Dispatch queue: com.apple.main-thread\n0   libphp5.so                              0x0000000103dbd7e2 _zend_hash_add_or_update + 75\n1   libphp5.so                              0x0000000103d6f5ad zend_symtable_update + 208\n2   libphp5.so                              0x0000000103d7047b php_register_variable_ex + 1584\n3   libphp5.so                              0x0000000103b5311d php_sapi_filter + 964\n4   libphp5.so                              0x0000000103d6a462 sapi_getenv + 99\n5   libphp5.so                              0x0000000103d74a7d php_security_log + 193\n6   libphp5.so                              0x0000000103dcccd2 _zend_mm_free_canary_int + 110\n7   libphp5.so                              0x0000000103d9786e _efree + 52\n8   libphp5.so                              0x0000000103db07b8 _zval_dtor_func + 56\n9   libphp5.so                              0x0000000103daa6ce destroy_op_array + 181\n10  libphp5.so                              0x0000000103dbc712 zend_hash_destroy + 53\n11  libphp5.so                              0x0000000103daa849 destroy_zend_class + 100\n12  libphp5.so                              0x0000000103dbc464 zend_hash_apply_deleter + 189\n13  libphp5.so                              0x0000000103dbc50f zend_hash_reverse_apply + 102\n14  libphp5.so                              0x0000000103da8dd2 shutdown_executor + 650\n15  libphp5.so                              0x0000000103db1963 zend_deactivate + 99\n16  libphp5.so                              0x0000000103d61a4d php_request_shutdown + 583\n17  libphp5.so                              0x0000000103e2a5d4 php_handler + 1186\n18  httpd                                   0x0000000103755031 ap_run_handler + 97\n19  httpd                                   0x0000000103755bd6 ap_invoke_handler + 422\n20  httpd                                   0x0000000103791616 ap_internal_redirect + 118\n21  mod_rewrite.so                          0x0000000103a5dc70 handler_redirect + 256\n22  httpd                                   0x0000000103755031 ap_run_handler + 97\n23  httpd                                   0x0000000103755bd6 ap_invoke_handler + 422\n24  httpd                                   0x00000001037909cd ap_process_request + 125\n25  httpd                                   0x000000010378c5c3 ap_process_http_connection + 131\n26  httpd                                   0x000000010376c651 ap_run_process_connection + 97\n27  httpd                                   0x000000010376cc31 ap_process_connection + 113\n28  httpd                                   0x0000000103799c73 child_main + 1699\n29  httpd                                   0x0000000103799eb3 make_child + 435\n30  httpd                                   0x000000010379a23f perform_idle_server_maintenance + 703\n31  httpd                                   0x000000010379a96c ap_mpm_run + 1740\n32  httpd                                   0x0000000103760077 main + 4055\n33  httpd                                   0x0000000103754374 start + 52\n \n \nThread 1 Crashed:: Dispatch queue: com.apple.libdispatch-manager\n0   libsystem_kernel.dylib                  0x00007fff8e2557e6 kevent + 10\n1   libdispatch.dylib                       0x00007fff89870786 _dispatch_mgr_invoke + 923\n2   libdispatch.dylib                       0x00007fff8986f316 _dispatch_mgr_thread + 54\n \n \nThread 1 crashed with X86 Thread State (64-bit):\n  rax: 0x0000000000000004  rbx: 0x00007fff763a31a0  rcx: 0x00000001432cb528  rdx: 0x0000000000000000\n  rdi: 0x000000000000001b  rsi: 0x0000000000000000  rbp: 0x00000001432cb6a0  rsp: 0x00000001432cb528\n   r8: 0x0000000000000001   r9: 0x0000000000000000  r10: 0x00000001432cb538  r11: 0xffffff80002dad60\n  r12: 0x00007fff763a2540  r13: 0x0000000000000000  r14: 0x00007fff763a3230  r15: 0x0000000000000000\n  rip: 0x00007fff8e2557e6  rfl: 0x0000000000000247  cr2: 0x00007fff763a4310\nLogical CPU: 0\n\n \nExternal Modification Summary:\n  Calls made by other processes targeting this process:\n    task_for_pid: 0\n    thread_create: 0\n    thread_set_state: 0\n  Calls made by this process:\n    task_for_pid: 0\n    thread_create: 0\n    thread_set_state: 0\n  Calls made by all processes on this machine:\n    task_for_pid: 4267\n    thread_create: 0\n    thread_set_state: 0\n \n \nVM Region Summary:\nReadOnly portion of Libraries: Total=143.3M resident=54.1M(38%) swapped_out_or_unallocated=89.2M(62%)\nWritable regions: Total=96.9M written=30.2M(31%) resident=36.1M(37%) swapped_out=0K(0%) unallocated=60.9M(63%)\n \nREGION TYPE                      VIRTUAL\n===========                      =======\nMALLOC                             86.3M\nMALLOC guard page                    48K\nSTACK GUARD                        56.0M\nStack                              8712K\nVM_ALLOCATE                         688K\n__CI_BITMAP                          80K\n__DATA                             10.9M\n__LINKEDIT                         51.0M\n__TEXT                             92.3M\n__UNICODE                           544K\nmapped file                         1.0G\nshared memory                        12K\n===========                      =======\nTOTAL                               1.3G\n</pre>", "bug_id": 54989, "is_private": false, "id": 167274, "time": "2013-05-17T22:03:48Z", "creator": "ryan@rbftpnetworks.com", "creation_time": "2013-05-17T22:03:48Z", "tags": [], "attachment_id": null}]
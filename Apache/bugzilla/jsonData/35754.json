[{"count": 0, "tags": [], "creator": "icoloma@infoinnova.com", "attachment_id": null, "is_private": false, "id": 77331, "time": "2005-07-15T14:21:55Z", "bug_id": 35754, "creation_time": "2005-07-15T14:21:55Z", "text": "Hi, I'm trying to use log4j 1.2.11 initialized via DOMConfigurator inside\nWeblogic app server 8.1. For this, I read the log4j.xml from the init() method\nof a servlet inside my war. The log4j.xml is not included inside the war file,\nbut outside, to be able to change it while running, and the XMLWatchdog should\ntake care of re-reading it. \n\nThe config is read OK the first time (on deploy), and I'm mostly sure because it\nis done in the deploy thread instead of the XMLWatchdog thread. After that, if\nyou try to change the file the XMLWatchdog tries to read it again and throws a\nMalformedUrlException because it is not able to find the log4j.dtd. Debugging\ninside weblogic I have found that the ClassLoader that is being used by\nLog4jEntityResolver to load the resource is not correct IMHO:\n\nCorrect ClassLoader (the one that is able to find log4j.xml):\nThread.currentThread().getContextClassLoader().toString()=\n\nweblogic.utils.classloaders.ChangeAwareClassLoader@126f304( finder:\nweblogic.utils.classloaders.CodeGenClassFinder@1f335bb, annotation:\n_appsdir_myapp_ear@myapp, parent:\nweblogic.utils.classloaders.GenericClassLoader@1ca3cb( finder:\nweblogic.utils.classloaders.CodeGenClassFinder@4c9860, annotation:\n_appsdir_myapp_ear@, parent:\nweblogic.utils.classloaders.GenericClassLoader@8c39d7( finder:\nweblogic.utils.classloaders.CodeGenClassFinder@a7d316, annotation:\nApplicationClassLoader@, parent:\nweblogic.utils.classloaders.GenericClassLoader@1d4d493( finder:\nweblogic.utils.classloaders.CodeGenClassFinder@1370ab, annotation: null, parent:\nsun.misc.Launcher$AppClassLoader@e80a59))))\n\nIncorrect ClassLoader (the one that log4j ends up using):\nclazz.getClassLoader().toString()=\n\nweblogic.utils.classloaders.GenericClassLoader@1ca3cb( finder:\nweblogic.utils.classloaders.CodeGenClassFinder@4c9860, annotation:\n_appsdir_myapp_ear@, parent:\nweblogic.utils.classloaders.GenericClassLoader@8c39d7( finder:\nweblogic.utils.classloaders.CodeGenClassFinder@a7d316, annotation:\nApplicationClassLoader@, parent:\nweblogic.utils.classloaders.GenericClassLoader@1d4d493( finder:\nweblogic.utils.classloaders.CodeGenClassFinder@1370ab, annotation: null, parent:\nsun.misc.Launcher$AppClassLoader@e80a59)))\n\nA fix would be to substitute this:\nClass clazz = getClass();\n      InputStream in = clazz.getResourceAsStream(\"/org/apache/log4j/xml/log4j.dtd\");\n\n\nWith this:\nInputStream in =\nThread.currentThread().getResourceAsStream(\"org/apache/log4j/xml/log4j.dtd\");"}, {"count": 1, "tags": [], "bug_id": 35754, "text": "Wait a minute, this is weird. Right now I am not being able to reproduce it\nagain, it works fine (I swear to god I have reviewed it carefully before\nwriting). Can I close the bug as STUPID? ", "id": 77333, "time": "2005-07-15T15:04:22Z", "creator": "icoloma@infoinnova.com", "creation_time": "2005-07-15T15:04:22Z", "is_private": false, "attachment_id": null}]
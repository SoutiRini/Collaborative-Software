[{"count": 0, "tags": [], "bug_id": 12774, "attachment_id": null, "text": "Note: this may be related to http://nagoya.apache.org/bugzilla/show_bug.cgi?\nid=12635 (bug #12635)\n\nthe following was written on Aug. 27:\n        I have an apache 2.0.40 server using the worker MPM that's been running\non a linux 2.2 kernel for about 4 days now, and every day I run\napache -k graceful after rotating the logs (the program is named apache\ninstead of httpd). It looks like that's not working for killing the child\nprocesses, though. A look at ps shows 271 apache processes running, most\nof which have been started sometime today. There are 6, though, that have\nnot:\n\nroot     12526  0.0  0.2  5164 2152 ?        S    Aug24   0:51 lt-apache\nweb      23633  0.0  1.7 37328 16668 ?       S    Aug25   0:00 lt-apache\nweb      23635  0.0  1.7 37328 16668 ?       S    Aug25   0:04 lt-apache\nweb      23681  0.0  1.7 37328 16668 ?       S    Aug25   0:00 lt-apache\nweb       2754  0.0  1.6 37128 16372 ?       S    Aug25   0:00 lt-apache\nweb       2755  0.0  1.6 37128 16372 ?       S    Aug25   0:04 lt-apache\nweb       2797  0.0  1.6 37128 16372 ?       S    Aug25   0:00 lt-apache\n\n        One of them is my root process, one of them is presumably cgid, and\nthe other five look to be the control processes for the threads I have\nrunning. A look in /proc for these processes shows that the root process\nhas all my current log files open. The other six, though, have the log\nfiles from the day they were started open (a look in /proc/2797/fd shows\nthat most of the log files it has open are deleted).\n\n        This doesn't cause any problems with logging, since the threads that\nare spawned are using the correct log files. The problem it causes is that\nthe 500MB that the deleted logfiles take up won't be freed from the\nfilesystem until I stop and restart apache.\n\n        I've tried apache -k graceful, apache -k restart, and kill -HUP 12526\nand none of them have caused the children to close their logfiles.\n\n-- end of original message --\n\nHere's the ps of my apache today. It was last restarted (apache -k stop, \nkillall lt-apache, /etc/init.d/apache start) on Sept. 16th\n\n\nsara:/home/michael# ps auwx | grep apache | grep Sep\nroot     31708  0.0  0.2  5164 2896 ?        S    Sep16   0:28 lt-apache\nweb      22401  0.0  1.7 58908 16620 ?       S    Sep16   0:00 lt-apache\nweb      22402  0.0  1.7 58908 16620 ?       S    Sep16   0:03 lt-apache\nweb      22540  0.0  1.7 58908 16620 ?       S    Sep16   0:00 lt-apache\nweb       9222  0.0  1.6 83940 15796 ?       S    Sep16   0:00 lt-apache\nweb       9223  0.0  1.6 83940 15796 ?       S    Sep16   0:03 lt-apache\nweb       9243  0.0  1.6 83940 15796 ?       S    Sep16   0:00 lt-apache\nweb      30047  0.0  1.4 57984 14140 ?       S    Sep17   0:00 lt-apache\nweb      30048  0.0  1.4 57984 14140 ?       S    Sep17   0:02 lt-apache\nweb      30068  0.0  1.4 57984 14140 ?       S    Sep17   0:00 lt-apache\nweb      13156  0.0  1.6 97008 16176 ?       S    Sep17   0:00 lt-apache\nweb      13157  0.0  1.6 97008 16176 ?       S    Sep17   0:01 lt-apache\nweb      13165  0.0  1.6 97008 16176 ?       S    Sep17   0:00 lt-apache\nweb      14975  0.0  1.6 48444 16056 ?       S    Sep17   0:00 lt-apache\nweb      14976  0.0  1.6 48444 16056 ?       S    Sep17   0:01 lt-apache\nweb      15007  0.0  1.6 48444 16056 ?       S    Sep17   0:00 lt-apache\nsara:/home/michael# ps auwx | grep apache | wc -l\n    302\nsara:/home/michael#\n\nA look at /proc for the root process shows all the right logfiles open:\n\nsara:/proc/31708# ls -al fd\ntotal 0\ndr-x------    2 root     wheel           0 Sep 18 09:59 .\ndr-xr-xr-x    3 root     wheel           0 Sep 18 09:59 ..\nlr-x------    1 root     wheel          64 Sep 18 09:59 0 -> /dev/null\nl-wx------    1 root     wheel          64 Sep 18 09:59 1 -> /dev/null\nl-wx------    1 root     wheel          64 Sep 18 09:59 10 -\n> /var/log/apache/manage-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 11 -\n> /var/log/apache/author-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 12 -\n> /var/log/apache/qz-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 13 -\n> /var/log/apache/qz-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 14 -\n> /var/log/apache/asstr-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 15 -\n> /var/log/apache/redirect-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 16 -\n> /var/log/apache/assmadmin-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 17 -\n> /var/log/apache/assm-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 18 -\n> /var/log/apache/assm-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 19 -\n> /var/log/apache/mcstories-access_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 2 -\n> /var/log/apache/error.log\nl-wx------    1 root     wheel          64 Sep 18 09:59 20 -\n> /var/log/apache/mcstories-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 21 -\n> /var/log/apache/test-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 22 -\n> /var/log/apache/asstr-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 23 -\n> /var/log/apache/asstr-access_log\nlr-x------    1 root     wheel          64 Sep 18 09:59 24 -> pipe:[614447598]\nl-wx------    1 root     wheel          64 Sep 18 09:59 25 -> pipe:[614447598]\nlrwx------    1 root     wheel          64 Sep 18 09:59 26 -\n> /var/log/apache/error.log\nlrwx------    1 root     wheel          64 Sep 18 09:59 27 -\n> /var/log/apache/acctcgi-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 28 -\n> /var/log/apache/search-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 29 -\n> /var/log/apache/author-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 3 -> socket:[607040926]\nlrwx------    1 root     wheel          64 Sep 18 09:59 30 -\n> /var/log/apache/iflc-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 31 -\n> /var/log/apache/manage-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 32 -\n> /var/log/apache/asstr-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 33 -\n> /var/log/apache/redirect-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 34 -\n> /var/log/apache/assmadmin-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 35 -\n> /var/log/apache/assm-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 36 -\n> /var/log/apache/mcstories-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 37 -\n> /var/log/apache/test-error_log\nlrwx------    1 root     wheel          64 Sep 18 09:59 4 -> socket:[607040927]\nl-wx------    1 root     wheel          64 Sep 18 09:59 5 -\n> /var/log/apache/acctcgi-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 6 -\n> /var/log/apache/search-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 7 -\n> /var/log/apache/search-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 8 -\n> /var/log/apache/author-access_log\nl-wx------    1 root     wheel          64 Sep 18 09:59 9 -\n> /var/log/apache/iflc-access_log\nsara:/proc/31708# \n\nA look at one of the child processes (22401) shows the following:\n\nsara:/proc/22401# ls -al fd\ntotal 0\ndr-x------    2 root     wheel           0 Sep 18 10:00 .\ndr-xr-xr-x    3 web      www-data        0 Sep 18 10:00 ..\nlr-x------    1 root     wheel          64 Sep 18 10:00 0 -> /dev/null\nl-wx------    1 root     wheel          64 Sep 18 10:00 1 -> /dev/null\nl-wx------    1 root     wheel          64 Sep 18 10:00 10 -\n> /var/log/apache/manage-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 11 -\n> /var/log/apache/author-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 12 -\n> /var/log/apache/qz-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 13 -\n> /var/log/apache/qz-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 14 -\n> /var/log/apache/asstr-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 15 -\n> /var/log/apache/redirect-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 16 -\n> /var/log/apache/assmadmin-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 17 -\n> /var/log/apache/assm-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 18 -\n> /var/log/apache/assm-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 19 -\n> /var/log/apache/mcstories-access_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 2 -\n> /var/log/apache/error.log\nl-wx------    1 root     wheel          64 Sep 18 10:00 20 -\n> /var/log/apache/mcstories-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 21 -\n> /var/log/apache/test-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 22 -\n> /var/log/apache/asstr-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 23 -\n> /var/log/apache/asstr-access_log.new (deleted)\nlr-x------    1 root     wheel          64 Sep 18 10:00 24 -> pipe:[607040934]\nl-wx------    1 root     wheel          64 Sep 18 10:00 25 -> pipe:[607040934]\nlrwx------    1 root     wheel          64 Sep 18 10:00 26 -\n> /var/log/apache/error.log\nlrwx------    1 root     wheel          64 Sep 18 10:00 27 -\n> /var/log/apache/acctcgi-error_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 28 -\n> /var/log/apache/search-error_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 29 -\n> /var/log/apache/author-error_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 3 -> socket:[607040926]\nlrwx------    1 root     wheel          64 Sep 18 10:00 30 -\n> /var/log/apache/iflc-error_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 31 -\n> /var/log/apache/manage-error_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 32 -\n> /var/log/apache/asstr-error_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 33 -\n> /var/log/apache/redirect-error_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 34 -\n> /var/log/apache/assmadmin-error_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 35 -\n> /var/log/apache/assm-error_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 36 -\n> /var/log/apache/mcstories-error_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 37 -\n> /var/log/apache/test-error_log.new (deleted)\nlr-x------    1 root     wheel          64 Sep 18 10:00 38 -> pipe:[607357926]\nl-wx------    1 root     wheel          64 Sep 18 10:00 39 -> pipe:[607357926]\nlrwx------    1 root     wheel          64 Sep 18 10:00 4 -> socket:[607040927]\nl-wx------    1 root     wheel          64 Sep 18 10:00 5 -\n> /var/log/apache/acctcgi-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 6 -\n> /var/log/apache/search-access_log.new (deleted)\nlrwx------    1 root     wheel          64 Sep 18 10:00 63 -> socket:[607361473]\nl-wx------    1 root     wheel          64 Sep 18 10:00 7 -\n> /var/log/apache/search-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 8 -\n> /var/log/apache/author-access_log.new (deleted)\nl-wx------    1 root     wheel          64 Sep 18 10:00 9 -\n> /var/log/apache/iflc-access_log.new (deleted)\nsara:/proc/22401# \n\nThe .new files are renames of the original logfiles by the debian savelog \nscript.\n\nA look at the partition with our logs on it shows that these files are indeed \ndeleted but still open:\n\nsara:/var/log# df .\nFilesystem           1k-blocks      Used Available Use% Mounted on\n/dev/sda9              1517920   1129948    310864  79% /var/log\nsara:/var/log# du -s\n593008  .\nsara:/var/log# \n\nI'd be happy to provide any additional information you need.... as it is I get \na page every 3 days about my hard drive getting full, and have to do a hard \nstop and start of apache to fix it...", "id": 23034, "time": "2002-09-18T14:10:42Z", "creator": "michael@asstr.org", "creation_time": "2002-09-18T14:10:42Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 12774, "attachment_id": null, "id": 24713, "time": "2002-10-17T02:34:41Z", "creator": "slive@apache.org", "creation_time": "2002-10-17T02:34:41Z", "is_private": false, "text": "[This is a mass bug update.]\nThis bug reports a problem in an older version of Apache 2.\nCould you please update to the most recent version and see\nif you can reproduce this problem.  If the bug still exists,\nplease update the bug with the latest version number.  If \nthe bug no longer exists, please close the bug report.\n\nSorry for this impersonal response, but we get many more bug\nreports than our volunteers can keep up with.\nThanks for using Apache!"}, {"count": 2, "tags": [], "bug_id": 12774, "attachment_id": null, "text": "[This is a mass bug update.] [Resolve-20021102]\nNo response from submitter; assuming issue is resolved.\nIf the problem still exists in the lastest version,\nplease reopen this report and update appropriately.", "id": 25539, "time": "2002-11-02T20:18:21Z", "creator": "slive@apache.org", "creation_time": "2002-11-02T20:18:21Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "lianggt08@sei.pku.edu.cn", "is_private": false, "text": "The fix revision 1179452 was aimed to remove an NPE bug on the  \"zipArchive\" in the method \"close\" of the file \"/poi/trunk/src/ooxml/java/org/apache/poi/openxml4j/util/ZipFileZipEntrySource.java\" , but it is incomplete. \nSince the \"zipArchive\" could be null during the run-time execution, its value should also be null-checked before being dereferenced in other methods. \n\nThe buggy code locations the same fix needs to be applied at are as bellows: \n \nLine 44 of the method \"getEntries()\" : \n    public Enumeration<? extends ZipEntry> getEntries() {\n[Line 44]      return zipArchive.entries();\n   }\n\nLine  48 of the method \"getInputStream()\" :\n  public InputStream getInputStream(ZipEntry entry) throws IOException {\n[Line 48]      return zipArchive.getInputStream(entry);\n   }", "id": 153774, "time": "2012-02-14T10:18:23Z", "bug_id": 52665, "creation_time": "2012-02-14T10:18:23Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "is_private": false, "text": "I'm not sure that zipArchive should ever be null - how are you triggering this?", "id": 153782, "time": "2012-02-14T12:59:12Z", "bug_id": 52665, "creation_time": "2012-02-14T12:59:12Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 52665, "attachment_id": null, "is_private": false, "id": 153796, "time": "2012-02-15T06:03:36Z", "creator": "lianggt08@sei.pku.edu.cn", "creation_time": "2012-02-15T06:03:36Z", "text": "If the method \"close\" is called, zipArchive will be null. After that, if the methods \"getEntries()\" and \"getInputStream()\" are called, NPE will happen at the code line 44 and 48.  \n\nPlease check the bug issue 51949 at https://issues.apache.org/bugzilla/show_bug.cgi?id=51949  for the method \"close\": \n\n\n    public void close() throws IOException {\n        zipArchive.close();\n        zipArchive = null;\n    }\n\n\n\nThanks."}, {"count": 3, "attachment_id": null, "bug_id": 52665, "text": "What do you expect from  \"getEntries()\" and \"getInputStream()\": return null or throw a more sensible exception? \n\nI would say that instead of the NPE they should throw IllegalStateException(\"zip file closed\"), the way java.util.ZipFile does. Does it seem the right fix for you? \n\nYegor\n\n(In reply to comment #2)\n> If the method \"close\" is called, zipArchive will be null. After that, if the\n> methods \"getEntries()\" and \"getInputStream()\" are called, NPE will happen at\n> the code line 44 and 48.  \n> \n> Please check the bug issue 51949 at\n> https://issues.apache.org/bugzilla/show_bug.cgi?id=51949  for the method\n> \"close\": \n> \n> \n>     public void close() throws IOException {\n>         zipArchive.close();\n>         zipArchive = null;\n>     }\n> \n> \n> \n> Thanks.", "id": 153801, "time": "2012-02-15T08:16:08Z", "creator": "yegor@dinom.ru", "creation_time": "2012-02-15T08:16:08Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 52665, "text": "OK.\nThrowing an IllegalStateException(\"zip file closed\") will be much better. \nThanks.", "count": 4, "id": 153804, "time": "2012-02-15T11:41:37Z", "creator": "lianggt08@sei.pku.edu.cn", "creation_time": "2012-02-15T11:41:37Z", "is_private": false}, {"count": 5, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "text": "As of r1244450, we now through an IllegalArgumentException for this case", "id": 153807, "time": "2012-02-15T11:51:25Z", "bug_id": 52665, "creation_time": "2012-02-15T11:51:25Z", "is_private": false}]
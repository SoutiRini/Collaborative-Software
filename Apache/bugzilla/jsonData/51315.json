[{"count": 0, "tags": [], "creator": "violetagg@apache.org", "attachment_id": null, "text": "Hello,\n\nI have the following scenario - runtime I want to remove one Valve from a specified StandardContext.\n\nI'm using the following method:\n\norg.apache.catalina.core.StandardContext.removeValve(Valve valve)\n\nwhich invokes\n\norg.apache.catalina.core.StandardPipeline.removeValve(Valve valve)\n\n\nThe problem is that the following exception is thrown:\n\nCaused by: java.lang.IllegalArgumentException: Configuration error:  Must be attached to a Context\n       at org.apache.catalina.authenticator.AuthenticatorBase.setContainer(AuthenticatorBase.java:277)\n       at org.apache.catalina.core.StandardPipeline.removeValve(StandardPipeline.java:537)\n\nIt appears that setContainer is invoked with \"null\" which leads to this IlleagalArgumentException.\n\nI want to propose the following change:\n\nIndex: AuthenticatorBase.java\n===================================================================\n--- AuthenticatorBase.java\t(revision 1100912)\n+++ AuthenticatorBase.java\t(working copy)\n@@ -273,7 +273,7 @@\n      */\n     public void setContainer(Container container) {\n \n-        if (!(container instanceof Context))\n+        if (container != null && !(container instanceof Context))\n             throw new IllegalArgumentException\n                 (sm.getString(\"authenticator.notContext\"));\n \nPlease tell me if there is more appropriate way to remove a Valve if the one above that I'm describing is not the correct one.\n\nThanks in advance.\nRegards\nVioleta Georgieva", "id": 146833, "time": "2011-06-03T09:02:08Z", "bug_id": 51315, "creation_time": "2011-06-03T09:02:08Z", "is_private": false}, {"count": 1, "attachment_id": null, "creator": "markt@apache.org", "is_private": false, "id": 146841, "time": "2011-06-03T18:15:21Z", "bug_id": 51315, "creation_time": "2011-06-03T18:15:21Z", "tags": [], "text": "You are doing exactly the right thing. That is a bug in 6.0.x (that is fixed in 7.0.x by the way).\n\nI have proposed your patch for 6.0.x"}, {"count": 2, "tags": [], "bug_id": 51315, "text": "Thanks for the patch. It has been applied to 6.0.x and will be included in 6.0.33 onwards.", "id": 147106, "time": "2011-06-14T13:05:18Z", "creator": "markt@apache.org", "creation_time": "2011-06-14T13:05:18Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "(In reply to comment #2)\n> Thanks for the patch. It has been applied to 6.0.x and will be included in\n> 6.0.33 onwards.\n\nGreat!Thanks!", "attachment_id": null, "bug_id": 51315, "id": 147109, "time": "2011-06-14T13:16:29Z", "creator": "violetagg@apache.org", "creation_time": "2011-06-14T13:16:29Z", "is_private": false}, {"count": 4, "tags": [], "creator": "violetagg@apache.org", "is_private": false, "id": 147110, "attachment_id": null, "bug_id": 51315, "creation_time": "2011-06-14T13:26:43Z", "time": "2011-06-14T13:26:43Z", "text": "(In reply to comment #2)\n> Thanks for the patch. It has been applied to 6.0.x and will be included in\n> 6.0.33 onwards.\n\nI just checked the commit and the description of the problem is IAE not NPE :(\n\nIndex: changelog.xml\n===================================================================\n--- changelog.xml\t(revision 1135555)\n+++ changelog.xml\t(working copy)\n@@ -115,7 +115,7 @@\n         than as a String. (markt)\n       </fix>\n       <fix>\n-        <bug>51315</bug>: Fix NPE when removing an authenticator valve from a\n+        <bug>51315</bug>: Fix IAE when removing an authenticator valve from a\n         container. Patch provided by Violeta Georgieva. (markt)\n       </fix>\n       <fix>"}, {"count": 5, "attachment_id": null, "creator": "markt@apache.org", "is_private": false, "id": 147111, "time": "2011-06-14T13:30:18Z", "bug_id": 51315, "creation_time": "2011-06-14T13:30:18Z", "tags": [], "text": "Corrected"}, {"count": 6, "tags": [], "text": "(In reply to comment #5)\n> Corrected\n\nThanks", "attachment_id": null, "bug_id": 51315, "id": 147112, "time": "2011-06-14T13:37:08Z", "creator": "violetagg@apache.org", "creation_time": "2011-06-14T13:37:08Z", "is_private": false}]
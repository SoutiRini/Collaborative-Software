[{"count": 0, "tags": [], "creator": "ikuya@flab.fujitsu.co.jp", "attachment_id": null, "text": "When I put a '-' in a character class definition ('[...]'), there are some\ncases that a simple char in the definition is ignored. In such cases,\ninstructions in REProgram objects are not as expected. This may be related to\nthe bugs #2121 and #5212. \n\nFor example, '[a-zA]' works fine, while for '[Aa-z]', 'A' is ignored, and\nfor '[abcd\\-]', 'd' is ignored. The point is that the ignored char is at\n2-chars before '-'.\n\nNear Line 710 in RECompiler.java, we can see:\n>                  // If simple character and not start of range, include it\n>                 if ((idx + 1) >= len || pattern.charAt(idx + 1) != '-')\n>                  {\n>                     range.include(simpleChar, include);\n>                  }\nIn my understanding, idx is pointing the next char of the simpleChar in\nquestion. The simpleChar should not be included when its next char (if any)\nis '-' (in that case, the simpleChar turns to be a start of a new range.)\nTherefore, the following code seems correct:\n>                 if (idx >= len || pattern.charAt(idx) != '-')\n\nI tried this fix on the CVS'ed source tree last night, with some new testcases,\nand it worked fine. I'm not sure there is no side effect of this; at least all\ntests in RETest.txt are still successful.\n\nThe diff output follows. Does this help?\n\nIkuya\n\n\nIndex: docs/RETest.txt\n===================================================================\nRCS file: /home/cvspublic/jakarta-regexp/docs/RETest.txt,v\nretrieving revision 1.3\ndiff -c -r1.3 RETest.txt\n*** docs/RETest.txt     27 Feb 2001 08:37:05 -0000      1.3\n--- docs/RETest.txt     28 Nov 2002 14:22:25 -0000\n***************\n*** 1011,1014 ****\n--- 1011,1030 ----\n  YES\n  aaabc\n\n+ #168\n+ [a-zA]+\n+ JakartaAnt\n+ YES\n+ akartaAnt\n\n+ #169\n+ [Aa-z]+\n+ JakartaAnt\n+ YES\n+ akartaAnt\n+\n+ #170\n+ [akrt\\-]+\n+ Jakarta-Ant\n+ YES\n+ akarta-\nIndex: src/java/org/apache/regexp/RECompiler.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-\nregexp/src/java/org/apache/regexp/RECompiler.java,v\nretrieving revision 1.4\ndiff -c -r1.4 RECompiler.java\n*** src/java/org/apache/regexp/RECompiler.java  27 Feb 2001 08:37:05 -0000     \n 1.4\n--- src/java/org/apache/regexp/RECompiler.java  28 Nov 2002 14:22:26 -0000\n***************\n*** 710,716 ****\n              else\n              {\n                  // If simple character and not start of range, include it\n!                 if ((idx + 1) >= len || pattern.charAt(idx + 1) != '-')\n                  {\n                      range.include(simpleChar, include);\n                  }\n--- 710,716 ----\n              else\n              {\n                  // If simple character and not start of range, include it\n!                 if (idx >= len || pattern.charAt(idx) != '-')\n                  {\n                      range.include(simpleChar, include);\n                  }", "id": 27161, "time": "2002-11-29T11:05:58Z", "bug_id": 14954, "creation_time": "2002-11-29T11:05:58Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 14954, "text": "*** Bug 15381 has been marked as a duplicate of this bug. ***", "id": 36086, "time": "2003-04-25T12:32:15Z", "creator": "vgritsenko@apache.org", "creation_time": "2003-04-25T12:32:15Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 14954, "text": "*** Bug 15455 has been marked as a duplicate of this bug. ***", "id": 36088, "time": "2003-04-25T12:34:25Z", "creator": "vgritsenko@apache.org", "creation_time": "2003-04-25T12:34:25Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "vgritsenko@apache.org", "text": "*** Bug 16434 has been marked as a duplicate of this bug. ***", "count": 3, "id": 36090, "time": "2003-04-25T12:36:32Z", "bug_id": 14954, "creation_time": "2003-04-25T12:36:32Z", "is_private": false}, {"count": 4, "tags": [], "creator": "vgritsenko@apache.org", "attachment_id": null, "is_private": false, "id": 36099, "time": "2003-04-25T13:26:46Z", "bug_id": 14954, "creation_time": "2003-04-25T13:26:46Z", "text": "*** Bug 16214 has been marked as a duplicate of this bug. ***"}, {"count": 5, "tags": [], "bug_id": 14954, "is_private": false, "text": "Fixed by patch in bug #19329\n\n*** This bug has been marked as a duplicate of 19329 ***", "id": 36149, "time": "2003-04-25T18:26:33Z", "creator": "vgritsenko@apache.org", "creation_time": "2003-04-25T18:26:33Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 14954, "attachment_id": null, "id": 36484, "time": "2003-05-02T01:10:34Z", "creator": "vgritsenko@apache.org", "creation_time": "2003-05-02T01:10:34Z", "is_private": false, "text": "Fixed by Bug #19329"}]
[{"count": 0, "attachment_id": null, "bug_id": 50168, "text": "While calling the method destory() on the StandardContext directly, it seems that the method destoryInternal() is called twice in the LifecycleMBeanBase, the two stacktraces are below :\n    a.  LifecycleMBeanBase.unregister(ObjectName) line: 191   \n         LifecycleMBeanBase.destroyInternal() line: 73   \n         ContainerBase.destroyInternal() line: 1109   \n         StandardContext.destroyInternal() line: 5114   \n         LifecycleBase.destroy() line: 271   \n         ContainerBase.removeChild(Container) line: 963   \n         ContainerBase.destroyInternal() line: 1106   \n         StandardContext.destroyInternal() line: 5114   \n         LifecycleBase.destroy() line: 271   \n         ...\n     b. LifecycleMBeanBase.unregister(ObjectName) line: 191   \n         LifecycleMBeanBase.destroyInternal() line: 73   \n         ContainerBase.destroyInternal() line: 1109   \n         StandardContext.destroyInternal() line: 5114   \n         LifecycleBase.destroy() line: 271\n         ...", "id": 141116, "time": "2010-10-27T22:47:42Z", "creator": "xhhsld@gmail.com", "creation_time": "2010-10-27T22:47:42Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 50168, "text": "When StandardContext is destroyed is destroys assets is manages which also have their own lifecycle. So you might be seeing those log messages. (Most likely StandardManager)\n\nPlease reopen with more proof if this diagnosis is wrong.", "id": 141323, "time": "2010-11-01T18:08:06Z", "creator": "funkman@apache.org", "creation_time": "2010-11-01T18:08:06Z", "is_private": false, "attachment_id": null}, {"text": "(In reply to comment #1)\n> When StandardContext is destroyed is destroys assets is manages which also have\n> their own lifecycle. So you might be seeing those log messages. (Most likely\n> StandardManager)\n> \n> Please reopen with more proof if this diagnosis is wrong.\n\nI'm also seeing this on undeploying any app via the Manager application.", "tags": [], "creator": "bugzilla@pidster.com", "is_private": false, "count": 2, "id": 141332, "time": "2010-11-01T20:42:06Z", "bug_id": 50168, "creation_time": "2010-11-01T20:42:06Z", "attachment_id": null}, {"text": "(In reply to comment #1)\n> When StandardContext is destroyed is destroys assets is manages which also have\n> their own lifecycle. So you might be seeing those log messages. (Most likely\n> StandardManager)\n> \n> Please reopen with more proof if this diagnosis is wrong.\n\nNot sure I understand your comments clearly. From the stack trace, while destorying the standcontext directly, it will check check whether its parent is null, if not, it will call the parent.removeChild() method, but removeChild method also try to destory the child. (As it does not known who calls the method).\nI will reopen the it, and try to attach a patch file.\nthanks.", "tags": [], "creator": "xhhsld@gmail.com", "is_private": false, "count": 3, "id": 141333, "time": "2010-11-01T22:08:52Z", "bug_id": 50168, "creation_time": "2010-11-01T22:08:52Z", "attachment_id": null}, {"count": 4, "attachment_id": 26248, "bug_id": 50168, "text": "Created attachment 26248\nSimple patch\n\nTry to provide a patch for it. Might not be proper, but it should be helpful to find what happens.\nException for the issue about double destory invocation, also, seems that Mapper.unregister action occurs before its  internal destory (e.g. remove welcome resources).", "id": 141334, "time": "2010-11-01T22:11:16Z", "creator": "xhhsld@gmail.com", "creation_time": "2010-11-01T22:11:16Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 50168, "text": "I don't think the patch works.\n\nWhat I (think I) notice is StandardWrapperValve being destroyed for each servlet in the webapp.\n\nBy default there is the default servlet and jsp servlet. If you enable ssi and cgi, I think you will see the call being done 4 times.\n\nWhy? TBD.", "id": 141345, "time": "2010-11-02T15:17:10Z", "creator": "funkman@apache.org", "creation_time": "2010-11-02T15:17:10Z", "is_private": false, "attachment_id": null}, {"text": "(In reply to comment #5)\n> I don't think the patch works.\n> \n> What I (think I) notice is StandardWrapperValve being destroyed for each\n> servlet in the webapp.\n> \n> By default there is the default servlet and jsp servlet. If you enable ssi and\n> cgi, I think you will see the call being done 4 times.\n> \n> Why? TBD.\n\nHmmm, the problem is not how many times the call is been done, currently, what I found is that the call is done on the same Context for more than more time. \nthanks.", "tags": [], "creator": "xhhsld@gmail.com", "is_private": false, "count": 6, "id": 141376, "time": "2010-11-03T22:19:21Z", "bug_id": 50168, "creation_time": "2010-11-03T22:19:21Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Fixed in trunk and will be included in 7.0.5 onwards.", "id": 141443, "time": "2010-11-04T19:04:31Z", "bug_id": 50168, "creation_time": "2010-11-04T19:04:31Z", "is_private": false}]
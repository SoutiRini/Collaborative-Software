[{"count": 0, "tags": [], "text": "Created attachment 32733\nNPE-example file\n\nI tried parse xls file with incorrect formula (incorrect link to cell) and give NPE:\n<pre>\nCaused by: java.lang.NullPointerException\n\tat org.apache.poi.ss.formula.OperationEvaluationContext.createExternSheetRefEvaluator(OperationEvaluationContext.java:97)\n\tat org.apache.poi.ss.formula.OperationEvaluationContext.createExternSheetRefEvaluator(OperationEvaluationContext.java:88)\n\tat org.apache.poi.ss.formula.OperationEvaluationContext.getRef3DEval(OperationEvaluationContext.java:305)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.getEvalForPtg(WorkbookEvaluator.java:631)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateNameFormula(WorkbookEvaluator.java:690)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.getEvalForNameRecord(WorkbookEvaluator.java:679)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.getEvalForPtg(WorkbookEvaluator.java:597)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:505)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:263)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:205)\n\tat org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateFormulaCellValue(HSSFFormulaEvaluator.java:374)\n\tat org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateFormulaCell(HSSFFormulaEvaluator.java:234)\n\tat org.apache.poi.ss.usermodel.DataFormatter.formatCellValue(DataFormatter.java:816)\n\tat com.ptnl.acube.server.excel.WorkbookProcessor.getCellValue(WorkbookProcessor.java:233)\n</pre>\n\nIt's mistake on code:\n<pre>\nSheetRangeEvaluator createExternSheetRefEvaluator(ExternalSheet externalSheet) {\n\t\tWorkbookEvaluator targetEvaluator;\n\t\tint otherFirstSheetIndex;\n\t\tint otherLastSheetIndex = -1;\n\t\tif (externalSheet == null || externalSheet.getWorkbookName() == null) {\n\t\t\t// sheet is in same workbook\n\t\t\ttargetEvaluator = _bookEvaluator;\n\t\t\totherFirstSheetIndex = _workbook.getSheetIndex(externalSheet.getSheetName()); //<-- row 97, mistake there\n\t\t\t\n\t\t\tif (externalSheet instanceof ExternalSheetRange) {\n\t\t\t    String lastSheetName = ((ExternalSheetRange)externalSheet).getLastSheetName();\n\t\t\t    otherLastSheetIndex = _workbook.getSheetIndex(lastSheetName);\n\t\t\t}\n</pre>\nIf externalSheet == null then tried call method getSheetName() on externalSheet and give exception.", "attachment_id": 32733, "id": 182962, "creation_time": "2015-05-12T16:35:15Z", "time": "2015-05-12T16:35:15Z", "creator": "timreset@gmail.com", "bug_id": 57925, "is_private": false}, {"count": 1, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 183671, "time": "2015-06-21T08:36:52Z", "bug_id": 57925, "creation_time": "2015-06-21T08:36:52Z", "is_private": false, "text": "I tried to reproduce this but couldn't, can you post self-contained sample code which allows to see how you trigger this exception?"}, {"count": 2, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "text": "I found the flaw in my unit-test and have now adjusted the code to more gracefully handle such invalid external references in r1703999.", "id": 185358, "time": "2015-09-19T20:16:20Z", "bug_id": 57925, "creation_time": "2015-09-19T20:16:20Z", "is_private": false}]
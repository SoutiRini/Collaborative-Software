[{"count": 0, "text": "In Tomcat 6.0.29, there's a new parameter in WebappClassLoader: clearReferencesLogFactoryRelease\n\nIt is by default true, and executes the following code when undeploying a web application:\n\n        // Clear the classloader reference in common-logging\n        if (clearReferencesLogFactoryRelease) {\n            org.apache.juli.logging.LogFactory.release(this);\n        }\n\nThe called method on JULI does the following:\n\n        java.util.logging.LogManager.getLogManager().reset();\n\nWhich basically removes all handlers of all loggers of the Java util logger.\n\nThis cause a severe regression: all other applications in the same JVM as Tomcat do not log anything anymore (since their handlers have disappeared).\n\nIs this an expected behaviour? How do we tell Catalina to only remove the handlers for the loggers by the Web application that is being undeployed?\n\nFor now, in the Tomcat integration in our application server, we have worked around the problem by setting clearReferencesLogFactoryRelease to false. This is of course a very bad workaround.\n\nCheers\n\nS. Ali Tokmen\nhttp://ali.tokmen.com/", "bug_id": 49792, "attachment_id": null, "id": 139294, "time": "2010-08-20T15:05:31Z", "creator": "postmaster@alishomepage.com", "creation_time": "2010-08-20T15:05:31Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "Sorry, I meant Tomcat 7.0.0 and Tomcat 7.0.2 instead of 6.0.29.", "is_private": false, "bug_id": 49792, "id": 139295, "time": "2010-08-20T15:08:08Z", "creator": "postmaster@alishomepage.com", "creation_time": "2010-08-20T15:08:08Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 49792, "attachment_id": null, "text": "The fix would I guess look like that:\n\n    To clean up all of the current Web application's loggers:\n\n    get all loggers' names\n    for each logger\n        get all handlers\n        for each handler\n            if the handler's class can be loaded using the WebAppClassLoader\n               AND cannot be loaded using the WebAppClassLoader's parent\n            then\n              remove this handler\n            else don't touch\n              // that logger belongs to some other application or to Tomcat itself", "id": 139309, "time": "2010-08-21T07:55:10Z", "creator": "postmaster@alishomepage.com", "creation_time": "2010-08-21T07:55:10Z", "is_private": false}, {"count": 3, "tags": [], "text": "\n\n*** This bug has been marked as a duplicate of bug 48716 ***", "is_private": false, "bug_id": 49792, "id": 139325, "time": "2010-08-22T09:34:08Z", "creator": "markt@apache.org", "creation_time": "2010-08-22T09:34:08Z", "attachment_id": null}]
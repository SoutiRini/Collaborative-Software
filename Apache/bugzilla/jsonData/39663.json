[{"attachment_id": null, "tags": [], "creator": "brad.jackson@planetdiscover.com", "text": "This happens in Tomcat 5.5.17, but not in 5.0.28. It does not occur if the\ncontext path is something other than \"\".\n\n1. Add this new host block to the %TOMCAT_HOME%\\conf\\server.xml file. Note that\nhalflife is a hostname mapped to 127.0.0.1 in my hosts file.\n\n<Host name=\"halflife\" appBase=\"C:\\bugtest\"\n       unpackWARs=\"true\" autoDeploy=\"true\"\n       xmlValidation=\"false\" xmlNamespaceAware=\"false\">\n\n    <Context docBase=\"C:\\bugtest\" path=\"\"/>\n\n</Host>\n\n2. Create these directories:\n\nC:\\bugtest\nC:\\bugtest\\testdir\nC:\\bugtest\\WEB-INF\n\n3. Add a file named index.jsp with this content to both the C:\\bugtest and\nC:\\bugtest\\testdir directories:\n\n<%@ taglib uri=\"/WEB-INF/bugtest.tld\" prefix=\"bean\" %>\n\nBugtest\n\n4. Create a file named bugtest.tld with this content in the C:\\bugtest\\WEB-INF\ndirectory:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<!DOCTYPE taglib PUBLIC \"-//Sun Microsystems, Inc.//DTD JSP Tag Library 1.1//EN\"\n\"http://java.sun.com/j2ee/dtds/web-jsptaglibrary_1_1.dtd\">\n<taglib>\n<tlibversion>1.0</tlibversion>\n<jspversion>1.1</jspversion>\n<shortname>bean</shortname>\n<uri></uri>\n</taglib>\n\n5. Create a minimal web.xml with this content in the C:\\bugtest\\WEB-INF directory:\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee\nhttp://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"\n    version=\"2.4\">\n\n  <display-name>Bug Test</display-name>\n  <description>\n     Bug Test\n  </description>\n\n</web-app>\n\n6. Start Tomcat and go to http://halflife:8080/ in a browser. It should display\n\"Bugtest\"\n\n7. Go to http://halflife:8080/testdir/ in a browser. It should display this\nexception:\n\norg.apache.jasper.JasperException: File \"/WEB-INF/bugtest.tld\" not found\n\torg.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:510)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:375)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:264)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\nroot cause\n\norg.apache.jasper.JasperException: File \"/WEB-INF/bugtest.tld\" not found\n\torg.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:50)\n\torg.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:407)\n\torg.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:114)\n\torg.apache.jasper.compiler.TagLibraryInfoImpl.<init>(TagLibraryInfoImpl.java:159)\n\torg.apache.jasper.compiler.Parser.parseTaglibDirective(Parser.java:423)\n\torg.apache.jasper.compiler.Parser.parseDirective(Parser.java:492)\n\torg.apache.jasper.compiler.Parser.parseElements(Parser.java:1552)\n\torg.apache.jasper.compiler.Parser.parse(Parser.java:126)\n\torg.apache.jasper.compiler.ParserController.doParse(ParserController.java:211)\n\torg.apache.jasper.compiler.ParserController.parse(ParserController.java:100)\n\torg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:155)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:295)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:276)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:264)\n\torg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:563)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:303)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:264)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\nIt appears that TldLocationsCache.processWebDotXml() thinks the /testdir/\ndirectory is a different context rather than a subdirectory of the default \"\"\ncontext, so it is looking for /testdir/WEB-INF/bugtest.tld.\n\nI cannot upgrade from Tomcat 5.0 to 5.5 on my development machine because of\nthis same problem on the application I normally work on.", "count": 0, "id": 89501, "time": "2006-05-25T22:00:03Z", "bug_id": 39663, "creation_time": "2006-05-25T22:00:03Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 39663, "text": "I'm experiencing the same issue with my application (MeshCMS). The taglib \nstandard-fmt-rt does not work, while my custom taglib still works. I tested the \napp on both Windows (JDK 1.5 and 1.6) and Linux (JDK 1.5). The issue happens \nwith all versions of Tomcat > 5.5.12, which works fine instead. \n\nThis is my test server.xml:\n\n-----------------\n<Server port=\"8005\" shutdown=\"SHUTDOWN\">\n  <Service name=\"Catalina\">\n    <Connector port=\"8080\" />\n\n    <Engine name=\"Catalina\" defaultHost=\"localhost\">\n      <Host name=\"localhost\" appBase=\"/home/tomcat/meshcms\">\n        <Context path=\"\" docBase=\"\" debug=\"0\" reloadable=\"false\" \nallowLinking=\"false\" />\n      </Host>\n    </Engine>\n  </Service>\n</Server>\n-----------------\n\n", "id": 89514, "time": "2006-05-26T09:24:45Z", "creator": "luciano@virgilio.it", "creation_time": "2006-05-26T09:24:45Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 39663, "text": "Some further considerations:\n\nTomcat reports\n26-mag-2006 12.14.00 org.apache.jasper.compiler.TldLocationsCache \nprocessWebDotXml\nAVVERTENZA: Internal Error: File /WEB-INF/web.xml not found\n\nThe org.apache.jasper.compiler.TldLocationsCache.processWebDotXml() has changed \na lot between 5.5.12 and 5.5.16. Maybe going back to the old method could solve \nthis issue.", "id": 89517, "time": "2006-05-26T12:32:45Z", "creator": "luciano@virgilio.it", "creation_time": "2006-05-26T12:32:45Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 39663, "attachment_id": null, "id": 89898, "time": "2006-06-07T17:24:37Z", "creator": "fhanik@apache.org", "creation_time": "2006-06-07T17:24:37Z", "is_private": false, "text": "Are you sure this is not just a result of you having appBase (Host) set to the\nsame directory as docBase(Context). these two should not be the same, appBase\nshould contain one or more webapps\n\nFilip"}, {"count": 4, "tags": [], "bug_id": 39663, "attachment_id": null, "id": 89900, "time": "2006-06-07T18:00:02Z", "creator": "brad.jackson@planetdiscover.com", "creation_time": "2006-06-07T18:00:02Z", "is_private": false, "text": "For the \"default web application\" (with the Context's path=\"\") as it's called by\nthe Tomcat Context tag documentation, the Hosts's appBase directory will always\nbe the same as the Context's docBase directory, I think.  I just tried testing\nwith a blank value for the Context's docBase instead of the full path, and it\nhas the same problem. Removing the Context tag entirely also gives the same error.\n\nRegardless of whether this is technically correct or not, I think a large number\nof people are currently relying on this functionality that worked in versions of\nTomcat in 5.5.12 and before."}, {"count": 5, "tags": [], "bug_id": 39663, "attachment_id": null, "id": 89903, "time": "2006-06-07T18:23:24Z", "creator": "fhanik@apache.org", "creation_time": "2006-06-07T18:23:24Z", "is_private": false, "text": "No, this bug is self inflicted.\nappBase must be different than docBase. Please verify that this bug works if you\nsetup the system correctly, until then we will leave as invalid.\nif the bug persist when appBase != docBase, then reopen the bug and I will fix it.\n\n\n(In reply to comment #4)\n> For the \"default web application\" (with the Context's path=\"\") as it's called by\n> the Tomcat Context tag documentation, the Hosts's appBase directory will always\n> be the same as the Context's docBase directory, I think.  I just tried testing\n> with a blank value for the Context's docBase instead of the full path, and it\n> has the same problem. Removing the Context tag entirely also gives the same error.\n> \n> Regardless of whether this is technically correct or not, I think a large number\n> of people are currently relying on this functionality that worked in versions of\n> Tomcat in 5.5.12 and before.\n\n"}, {"count": 6, "tags": [], "text": "So you're telling me I cannot have a default web application with a context path\nof \"\" unless I put it in a ROOT directory under appBase like Tomcat's webapps\ndirectory has? That is the only way I can make it work. I dropped my bugtest\nfiles into %TOMCAT_HOME%\\webapps then renamed the %TOMCAT_HOME%\\webapps\\ROOT\ndirectory and left the server.xml file unchanged and it is still broken.", "attachment_id": null, "id": 89909, "creator": "brad.jackson@planetdiscover.com", "time": "2006-06-07T18:43:46Z", "bug_id": 39663, "creation_time": "2006-06-07T18:43:46Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 39663, "attachment_id": null, "id": 89912, "time": "2006-06-07T19:19:02Z", "creator": "fhanik@apache.org", "creation_time": "2006-06-07T19:19:02Z", "is_private": false, "text": "you can name the app whatever you want and still serve it up as \"\"\n\ndocBase=\"bugtest\" path=\"\" should work fine, but if are saying its still bust,\nthen I will reopen and take a look at it."}, {"attachment_id": 18427, "tags": [], "creator": "fhanik@apache.org", "text": "Created attachment 18427\nTest application", "count": 8, "id": 89914, "time": "2006-06-07T19:28:21Z", "bug_id": 39663, "creation_time": "2006-06-07T19:28:21Z", "is_private": false}, {"count": 9, "tags": [], "creator": "fhanik@apache.org", "attachment_id": null, "text": "I have webapps/bugtest\n\nserver.xml I have \n<Context docBase=\"bugtest\" path=\"\"/>\n\nand it works just fine.\n\ndocBase should not be set to the same as appBase, as appBase is the directory\nfor one ore more applications. \n\nin your setting, my guess is that it could work if you turn off autoDeploy.", "id": 89915, "time": "2006-06-07T19:29:51Z", "bug_id": 39663, "creation_time": "2006-06-07T19:29:51Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 39663, "text": "Try this in server.xml as replacement for the default Host. Shouldn't this be\nallowed?\n\n<Host name=\"localhost\" appBase=\"webapps2\"\n       unpackWARs=\"true\" autoDeploy=\"true\"\n       xmlValidation=\"false\" xmlNamespaceAware=\"false\">\n\n  <Context docBase=\"\" path=\"\"/>\n</Host>\n\nIn %TOMCAT_HOME%\\webapps2:\n\n%TOMCAT_HOME%\\webapps2\\index.jsp\n%TOMCAT_HOME%\\webapps2\\testdir\\index.jsp\n%TOMCAT_HOME%\\webapps2\\WEB-INF\\bugtest.tld\n%TOMCAT_HOME%\\webapps2\\WEB-INF\\web.xml\n\nThen go to:\nhttp://localhost:8080/ [Works]\nhttp://localhost:8080/testdir/ [org.apache.jasper.JasperException: File\n\"/WEB-INF/bugtest.tld\" not found]\n\nIf I then remove the Context tag, it's odd that I get a blank page for the first\nURL but the same error for the second URL.\n\nIn Tomcat 5.5.12, I get no errors for both URLs with the Context tag, and blank\npages for both URLs without the tag.\n\nIf you'd like to continue this conversation via direct email instead of filling\nthe inbox of everyone being copied, feel free.", "id": 89916, "time": "2006-06-07T20:04:18Z", "creator": "brad.jackson@planetdiscover.com", "creation_time": "2006-06-07T20:04:18Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 39663, "attachment_id": null, "id": 89921, "time": "2006-06-07T20:59:33Z", "creator": "fhanik@apache.org", "creation_time": "2006-06-07T20:59:33Z", "is_private": false, "text": "As I said, stop setting docBase to the same as appBase, then your problems will\ngo away.\n\nIf you insist on setting appBase to docBase, like you have below, then at least\ntry to set autoDeploy=\"false\" \n\ndocBase is a relative path, so setting docBase=\"\" means that you are setting\ndocBase==appBase\n\nso you haven't presented a new scenario"}, {"count": 12, "text": "I've been looking at this for the past few hours - and there is something not\nquite consistent here. I believe it has to do with how the\nProxyDirContext.contextName gets setup. When this gets setup to \"\" - ie. blank\ncontext then everything works as expected. However, when the context is set to\n\"/meshcms\" then this causes the misery.\n\nAs far as I can tell this occurs under the following conditions - which I\nsuppose amounts to the same thing:\n\n  Host's appBase == Context's docBase || docBase == \"\"\n\n... if appBase is set to anything else (a non-existent dir or even \"\") and\ndocBase is set to the exact path then contextName is \"\" - otherwise it\ninterprets the first bit of the path as the context, ie. \"/meshcms\". In this\nevent the web.xml is not found - hence the warning about web.xml not found - and\nthe taglib is not setup. The \"/admin/...\" path is a red-herring - I can't\nremember why it happens - but it's not important - the failure occurs from\ntrying to find web.xml at /meshcms/WEB-INF/web.xml - and failing.\n\nThis does seem a little inconsistent to me - if the docBase is set to a\nparticular value - either derived as it is \"\", a relative path or a\nfully-qualified path then this should probably take prority - even if the\nappBase points to the same dir. Working as it currently does gives the following\nbehaviour that I think is confusing:\n\n#  appBase    docBase   contextName  Works?\n-  -------    -------   -----------  ------\n1  /tmp/wa1   \"\"        \"/wa1\"       fails\n2  /tmp/wa1   /tmp/wa1  \"/wa1\"       fails\n3  /tmp/bb    /tmp/wa1  \"\"           works\n4  \"\"         /tmp/wa1  \"\"           works\n\nIt seems in .12 - contextName == \"\" - for at least the scenario outlined by\nLuciano - scenario 1, above - hence why this worked in .12 - and does not now\nwork in .16.\n\nHaving re-read the definitions for the above - Filip is of course correct - that\nthis is an inconsistent use of these properties - having the webapps' parent and\na webapp pointing to the same directory - but the confusing element is that this\nbehaviour has changed between .12 and .16  - this has bitten several of us here\n- me included.\n\nI suspect the change lies somewhere in the code that sets the\n\"ContainerBase.resources\" (ProxyDirContext) .contextName - by examining the\ndefined values for appBase and docBase - but  I presume this change has been\nmade for good reason - I have not attempted to track-down the details of this\nchange.\n\nI have re-opened this bug (sorry Filip) - so that it can be investigated further\n- I believe there either needs to be an exception thrown to indicate the fact\nthat the context has the same base as the webapps so at least a visible\nexception is thrown - or it needs to behave as it did in .12 - ie. the context's\ndocBase setting takes priority when determining the webapp's context.\n\nAs a simple workaround - set the appBase=\"\" and the docBase to the\nfully-qualified path of the webapp - works for me. A better, more-robust\nsolution may be to follow Filip's advice given for putting the webapp in a\ndirectory under the appBase.\n", "creator": "hueh-asf@openAction.net", "attachment_id": null, "id": 89923, "time": "2006-06-07T21:19:01Z", "bug_id": 39663, "creation_time": "2006-06-07T21:19:01Z", "tags": [], "is_private": false}, {"count": 13, "attachment_id": null, "creator": "fhanik@apache.org", "is_private": false, "id": 89924, "time": "2006-06-07T21:25:36Z", "bug_id": 39663, "creation_time": "2006-06-07T21:25:36Z", "tags": [], "text": "Closing the bug to invalid, yes a warning might be nice, but its also self\nexplanatory. If you want a warning message, then submit an enhancement request,\nI suggest not to try to slip that into the original bug.\n\nHere you go, and now you understand why :) as well\n\n#  appBase    docBase   contextName  Works?  Why?\n-  -------    -------   -----------  ------  -----\n1  /tmp/wa1   \"\"        \"/wa1\"       fails   appBase==docBase\n2  /tmp/wa1   /tmp/wa1  \"/wa1\"       fails   appBase==docBase\n3  /tmp/bb    /tmp/wa1  \"\"           works   appBase!=docBase\n4  \"\"         /tmp/wa1  \"\"           works   appBase!=docBase\n\n\n"}, {"count": 14, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "By default, auto and live deployment are enabled, so the configuration works\naround that. If a webapp folder is located inside the appBase folder of the\nhost, it will be picked up by the auto deployer, and so the choice is to either\nignore the docBase of the webapp or deploy it twice. In \"newer\" versions of\nTomcat (above 5.5.9, at least), docBase is thus ignored if inside appBase.\nSimilarly, path is infered from the webapp folder name (or war name). I\nunderstand in some cases it doesn't work as before, but my goal was to get\nsomething that was predictable with very few changes, even if it's not the most\nconvinient or most logical sometimes. As it's independent of Tomcat (it's the\nhost config class), it could be esily swapped with a better one.", "id": 89951, "time": "2006-06-08T12:27:59Z", "bug_id": 39663, "creation_time": "2006-06-08T12:27:59Z", "is_private": false}]
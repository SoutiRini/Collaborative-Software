[{"count": 0, "tags": [], "bug_id": 27183, "text": "I have a datasource defined in server.xml and bound as o global resource as\nfollowing \n\n  <GlobalNamingResources>\n    <Resource name=\"jdbc/testdb\" auth=\"Container\" \n              type=\"javax.sql.DataSource\"/>\n    <ResourceParams name=\"jdbc/testdb\">\n      <parameter>\n        <name>factory</name>\n        <value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n      </parameter>\n      <parameter>\n        <name>driverClassName</name>\n        <value>org.postgresql.Driver</value>\n      </parameter>\n      <parameter>\n        <name>url</name>\n        <value>jdbc:postgresql://localhost:5432/testdb</value>\n      </parameter>\n      <parameter>\n        <name>username</name>\n        <value>tomcat</value>\n      </parameter>\n      <parameter>\n        <name>password</name>\n        <value>******</value>\n      </parameter>\n      <parameter>\n        <name>maxActive</name>\n        <value>4</value>\n      </parameter>\n      <parameter>\n        <name>maxIdle</name>\n        <value>2</value>\n      </parameter>\n      <parameter>\n        <name>maxWait</name>\n        <value>5000</value>\n      </parameter>\n    </ResourceParams>\n  </GlobalNamingResources>\n\n... and a DataSource realm\n\n      <Realm  className=\"org.apache.catalina.realm.DataSourceRealm\" debug=\"99\"\n              dataSourceName=\"java:/comp/env/jdbc/testdb\"\n              userTable=\"useraccount\" userNameCol=\"name\" userCredCol=\"md5pass\"\n              userRoleTable=\"userroles\" roleNameCol=\"role\" digest=\"md5\"/>\n\n... all according to <tomcat-docs>/realm-howto.html#DataSourceRealm and\n<tomcat-docs>/jndi-datasource-examples-howto.html\n\nI am getting the following error on an access to the context which requires\nauthentication and on each subsequent attempt of using the realm.\n\n2004-02-24 09:41:48 DataSourceRealm[Catalina]: Exception performing authentication\njavax.naming.NameNotFoundException: Name java: is not bound in this Context\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:815)\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:198)\n\tat org.apache.catalina.realm.DataSourceRealm.open(DataSourceRealm.java:482)\n\tat org.apache.catalina.realm.DataSourceRealm.authenticate(DataSourceRealm.java:323)\n\tat\norg.apache.catalina.authenticator.BasicAuthenticator.authenticate(BasicAuthenticator.java:176)\n\tat\norg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:551)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:184)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:578)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:833)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:732)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:619)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:688)\n\tat java.lang.Thread.run(Thread.java:566)\n\nOk, changing the dataSourceName=\"java:/comp/env/jdbc/testdb\" to\ndataSourceName=\"java:comp/env/jdbc/testdb\" (which is more likely to be correct\n;) results in the following error:\n\n2004-02-24 09:45:34 DataSourceRealm[Catalina]: Exception performing authentication\njavax.naming.NameNotFoundException: Name java:comp is not bound in this Context\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:815)\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:198)\n\tat org.apache.catalina.realm.DataSourceRealm.open(DataSourceRealm.java:482)\n\tat org.apache.catalina.realm.DataSourceRealm.authenticate(DataSourceRealm.java:323)\n\tat\norg.apache.catalina.authenticator.BasicAuthenticator.authenticate(BasicAuthenticator.java:176)\n\tat\norg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:551)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:184)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:578)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:833)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:732)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:619)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:688)\n\tat java.lang.Thread.run(Thread.java:566)\n\nOnly setting the dataSourceName=\"jdbc/testdb\" results in the correct behaviour\n(no stack traces, user is authenticated). Therefore there is a bug in docs,\ntomcat itself (o.a.c.r.DataSourceRealm?) or both?", "id": 52836, "time": "2004-02-24T08:58:28Z", "creator": "drzewo@post.pl", "creation_time": "2004-02-24T08:58:28Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 52837, "time": "2004-02-24T09:01:47Z", "bug_id": 27183, "creation_time": "2004-02-24T09:01:47Z", "is_private": false, "text": "Yes, indeed, it's not a reference to the ENC."}]
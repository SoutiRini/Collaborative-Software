[{"count": 0, "tags": [], "creator": "kl223hun@gmail.com", "text": "Created attachment 28383\nTest program to reproduce bug.\n\nSteps to reproduce bug (see attached test program):\n 1. load an existing .xls file that has comments on multiple cells into a HSSFWorkbook\n 2. delete the comment from one of the cells and create a new comment on the same cell. Do not touch any of the other cells containing comments.\n 3. write the HSSFWorkbook instance to a file.\n 4. the resulting file will only contain a single comment on the cell that we modified. Any other previously existing comments disappeared into thin air.\n\nThe test program...\n 1. creates A1_B1_commented.xls in the current directory. In this file there is a single sheet with comments on the A1 and B1 cells.\n 2. loads the created file again and creates a new comment for A1, then writes the HSSFWorkbook to B1_comment_lost.xls\n 3. as the name suggests, the comment for B1 is gone (can be checked in LibreOffice or Apache POI), though nobody ever touched it.\n\nTested on with the latest svn release (poi-3.8-beta6-20120225).", "id": 154131, "time": "2012-02-25T01:11:42Z", "bug_id": 52764, "creation_time": "2012-02-25T01:11:42Z", "is_private": false, "attachment_id": 28383}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 154134, "time": "2012-02-25T05:56:25Z", "bug_id": 52764, "creation_time": "2012-02-25T05:56:25Z", "is_private": false, "text": "How are you creating the additional comments? Does it by any chance include a call to createDrawingPatriarch?\n\nIf so, you should note the warning in the javadocs - \nhttp://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFSheet.html#createDrawingPatriarch() - \"This will have the effect of removing any existing drawings on this sheet.\"\n\n(Comments are a kind of drawing)"}, {"count": 2, "text": "(In reply to comment #1)\n> How are you creating the additional comments? Does it by any chance include a\n> call to createDrawingPatriarch?\n> \n> If so, you should note the warning in the javadocs - \n> http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFSheet.html#createDrawingPatriarch()\n> - \"This will have the effect of removing any existing drawings on this sheet.\"\n> \n> (Comments are a kind of drawing)\n\nPlease have a look at the attached test program to see the answer for yourself.\nI only call the createDrawingPatriarch() method once, when creating the sheet.\nThe second time, after loading the file from the disk to modify cell comments, I call the getDrawingPatriarch() method to get the existing instance.", "bug_id": 52764, "attachment_id": null, "id": 154139, "time": "2012-02-25T14:12:59Z", "creator": "kl223hun@gmail.com", "creation_time": "2012-02-25T14:12:59Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "yegor@dinom.ru", "text": "It is a known limitation of POI: if a template workbook has graphics (shapes, comments, pictures, etc.) then an attempt to modify / append new graphic elements *may* destroy the original drawing. The behavior is not fully deterministic: in simple cases graphics is preserved OK, it more complex it is lost.\n\nIn other words, POI is good to create new drawings from scratch, but it can't append / modify existing drawings.\n\nThere is a plan to improve it, but unfortunately it is a quite a big piece of work and no one has volunteered to implement it.\n\n\nYegor", "id": 154274, "time": "2012-02-27T08:49:28Z", "bug_id": 52764, "creation_time": "2012-02-27T08:49:28Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 52764, "attachment_id": null, "is_private": false, "id": 161438, "time": "2012-08-15T20:28:58Z", "creator": "superrubiroyd@gmail.com", "creation_time": "2012-08-15T20:28:58Z", "text": "In your code you try to create two comments for one cell. Thus, Excel shows warning \"The data may have been lost\". Now POI checks all the comments for each sheet and throws an exception if find two or more comments for single cell.\n\nRegards, Evgeniy"}]
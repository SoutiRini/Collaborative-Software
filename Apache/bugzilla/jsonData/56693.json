[{"count": 0, "tags": [], "bug_id": 56693, "text": "When uploading a file using webdav in Tomcat 8.0.9 it doesn't show up immediately even though the server responds with \"201 created\".\n\nThis results in a 404 or even 500 on operations on a file that is supposed to be available on the server.\n\nDisabling the static resource caching in the context didn't help. Tomcat 6.0.41 and 7.0.54 act normally.\n\nAccording to rfc, if the server delays the file creation it should return a 202 accepted, not a 201 created.\n\n\nExamples:\n\n(1)\n> dav:/webdav/> ls\n> Listing collection `/webdav/': collection is empty.\n> dav:/webdav/> put testfile.bin\n> Uploading testfile.bin to `/webdav/testfile.bin':\n> Progress: [=============================>] 100,0% of 102400 bytes succeeded.\n> dav:/webdav/> propget testfile.bin\n> Fetching properties for `testfile.bin': failed:\n> 404 Not Found\n\n[now I'm waiting for a couple of seconds]\n\n> dav:/webdav/> propget testfile.bin\n> Fetching properties for `testfile.bin':\n> DAV: creationdate = 2014-07-01T16:29:35Z\n> DAV: displayname = testfile.bin\n> DAV: getlastmodified = Tue, 01 Jul 2014 16:29:35 GMT\n> DAV: getcontentlength = 102400\n> DAV: getcontenttype = application/octet-stream\n> DAV: getetag = W/\"102400-1404232175000\"\n> DAV: resourcetype =\n> DAV: source =\n> DAV: supportedlock = <DAV:lockentry><DAV:lockscope><DAV:exclusive></DAV:exclusive></DAV:lockscope><DAV:locktype><DAV:write></DAV:write></DAV:locktype></DAV:lockentry><DAV:lockentry><DAV:lockscope><DAV:shared></DAV:shared></DAV:lockscope><DAV:locktype><DAV:write></DAV:write></DAV:locktype></DAV:lockentry> \n\n(2)\n> dav:/webdav/> rm testfile.bin\n> Deleting `testfile.bin': succeeded.\n> dav:/webdav/> ls\n> Listing collection `/webdav/': collection is empty.\n> dav:/webdav/> put testfile.bin testfile.bin.tmp\n> Uploading testfile.bin to `/webdav/testfile.bin.tmp':\n> Progress: [=============================>] 100,0% of 102400 bytes succeeded.\n> dav:/webdav/> move testfile.bin.tmp testfile.bin\n> Moving `/webdav/testfile.bin.tmp' to `/webdav/testfile.bin':  failed:\n> 500 Internal Server Error\n\n[again, waiting for a couple of seconds]\n\n> dav:/webdav/> move testfile.bin.tmp testfile.bin\n> Moving `/webdav/testfile.bin.tmp' to `/webdav/testfile.bin':  succeeded.\n\n\nmy web.xml:\n--%snip%--\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"\n\tversion=\"2.5\">\n\n\t<display-name>webdav</display-name>\n\t<description>webdav access</description>\n\n\t<servlet>\n\t\t<servlet-name>webdav</servlet-name>\n\t\t<servlet-class>org.apache.catalina.servlets.WebdavServlet</servlet-class>\n\t\t<init-param>\n\t\t\t<param-name>debug</param-name>\n\t\t\t<param-value>0</param-value>\n\t\t</init-param>\n\t\t<init-param>\n\t\t\t<param-name>listings</param-name>\n\t\t\t<param-value>true</param-value>\n\t\t</init-param>\n\t\t<init-param>\n\t\t\t<param-name>readonly</param-name>\n\t\t\t<param-value>false</param-value>\n\t\t</init-param>\n\t</servlet>\n\n\t<servlet-mapping>\n\t\t<servlet-name>webdav</servlet-name>\n\t\t<url-pattern>/*</url-pattern>\n\t</servlet-mapping>\n\n\n\t<security-constraint>\n\t\t<web-resource-collection>\n\t\t\t<web-resource-name>WebDAV</web-resource-name>\n\t\t\t<url-pattern>/*</url-pattern>\n\t\t\t<http-method>CANCELUPLOAD</http-method>\n\t\t\t<http-method>CHECKIN</http-method>\n\t\t\t<http-method>CHECKOUT</http-method>\n\t\t\t<http-method>COPY</http-method>\n\t\t\t<http-method>DELETE</http-method>\n\t\t\t<http-method>GET</http-method>\n\t\t\t<http-method>GETLIB</http-method>\n\t\t\t<http-method>HEAD</http-method>\n\t\t\t<http-method>LOCK</http-method>\n\t\t\t<http-method>MKCOL</http-method>\n\t\t\t<http-method>MOVE</http-method>\n\t\t\t<http-method>PROPFIND</http-method>\n\t\t\t<http-method>PROPPATCH</http-method>\n\t\t\t<http-method>PUT</http-method>\n\t\t\t<http-method>REPORT</http-method>\n\t\t\t<http-method>UNCHECKOUT</http-method>\n\t\t\t<http-method>UNLOCK</http-method>\n\t\t\t<http-method>UPDATE</http-method>\n\t\t\t<http-method>VERSION-CONTROL</http-method>\n\t\t</web-resource-collection>\n\t\t<auth-constraint>\n\t\t\t<role-name>*</role-name>\n\t\t</auth-constraint>\n\t</security-constraint>\n\n\t<login-config>\n\t\t<auth-method>BASIC</auth-method>\n\t\t<realm-name>WebDAV</realm-name>\n\t</login-config>\n\n\t<security-role>\n\t\t<description>WebDAV User</description>\n\t\t<role-name>webdav</role-name>\n\t</security-role>\n\n\t<distributable />\n</web-app>\n--%snip%--", "id": 176182, "time": "2014-07-03T08:15:16Z", "creator": "aidbmfqognnq6gizaigaqaaaaaaaa@protected32.unixadm.org", "creation_time": "2014-07-03T08:15:16Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 56693, "attachment_id": null, "id": 176184, "time": "2014-07-03T09:33:57Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-07-03T09:33:57Z", "is_private": false, "text": "(In reply to aidbmfqognnq6gizaigaqaaaaaaaa from comment #0)\n> \n> Disabling the static resource caching in the context didn't help.\n\nDid you read my answer?\nhttp://markmail.org/message/tm5acr27a6j6hfga\n\nYou did it wrong. There is no such attribute as \"cachingAllowed\" on Context in Tomcat 8.\n\nThe attribute was moved to nested <Resources> element.\nhttp://tomcat.apache.org/migration-8.html#Web_application_resources"}, {"count": 2, "tags": [], "bug_id": 56693, "text": "Hi Konstantin,\n\nthanks for your reply, that email you mentioned sadly never arrived here.\n\nAs I'm not familiar enough with it, is the right way to add a META-INF/context.xml containing\n> <Context>\n> <Resource name=\"org.apache.catalina.servlets.WebdavServlet\" cachingAllowed=\"false\" />\n> </Context>\n?\n\nIf that's the case -- it didn't help.\n\nRegardless of whether or not disabling the cache may help, if the file is not ready for immediate access after upload tomcat should return a \"202 accepted\", not a \"201 created\".", "id": 176190, "time": "2014-07-03T12:47:44Z", "creator": "aidbmfqognnq6gizaigaqaaaaaaaa@protected32.unixadm.org", "creation_time": "2014-07-03T12:47:44Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 56693, "attachment_id": null, "id": 176193, "time": "2014-07-03T14:31:32Z", "creator": "markt@apache.org", "creation_time": "2014-07-03T14:31:32Z", "is_private": false, "text": "It was the static resource cache that wasn't invalidating cache entries when it knew the current entry was invalid. This has been fixed in 8.0.x for 8.0.10 onwards.\n\nI have also fixed a handful of other failures identified by the Litmus WebDAV testsuite."}]
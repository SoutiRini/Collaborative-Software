[{"count": 0, "tags": [], "creator": "jljlmatu@jp.ibm.com", "text": "When the following XHTML document is accessed through Tomcat,\n----- jsp document -----\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\" ?>\n<jsp:root xmlns:jsp=\"http://java.sun.com/JSP/Page\" version=\"2.0\">\n\t<jsp:directive.page language=\"java\"\n\t\tcontentType=\"text/html; charset=ISO-8859-1\" pageEncoding=\"ISO-8859-1\" />\n\t<jsp:text>\n\t\t<![CDATA[ <?xml version=\"1.0\" encoding=\"ISO-8859-1\" ?> ]]>\n\t</jsp:text>\n\t<jsp:text>\n\t\t<![CDATA[ <!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.1//EN\"\n\"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd\"> ]]>\n\t</jsp:text>\n\t<html xmlns=\"http://www.w3.org/1999/xhtml\">\n\t<head>\n\t<title>jsp-xhtml.jsp</title>\n\t</head>\n\t<body>\n\t\t<p>&nbsp;</p>\n\t\t<hr/>\n\t\t<p>&#160;</p>\n\t\t<hr/>\n\t\t<p>&lt;</p>\n\t\t<hr/>\n\t\t<p>&gt;</p>\n\t\t<hr/>\n\t\t<p>&quot;</p>\n\t\t<hr/>\n\t\t<p>&amp;</p>\n\t\t<hr/>\n\t\t<p>&apos;</p>\n\t</body>\n\t</html>\n</jsp:root>\n----- jsp document -----\njasper throws the following exception.\norg.apache.jasper.JasperException: /xml/jsp-xhtml3.jsp(16,12) The entity \"nbsp\"\nwas referenced, but not declared.\n\torg.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:39)\n\torg.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:405)\n\torg.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:86)\n\torg.apache.jasper.compiler.JspDocumentParser.parse(JspDocumentParser.java:211)\n\torg.apache.jasper.compiler.ParserController.doParse(ParserController.java:196)\n\torg.apache.jasper.compiler.ParserController.parse(ParserController.java:100)\n\torg.apache.jasper.compiler.Compiler.generateJava(Compiler.java:146)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:286)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:267)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:255)\n\torg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:556)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:293)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:291)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\nbut when I removed the line of <p>&nbsp;</p>, it works.\nI'm wondering why jasper accepts :\n\t\t<p>&#160;</p>\n\t\t<p>&lt;</p>\n\t\t<p>&gt;</p>\n\t\t<p>&quot;</p>\n\t\t<p>&amp;</p>\n\t\t<p>&apos;</p>\nbut doesn't accept <p>&nbsp;</p>. All above entitis are valid\nfor XHTML usage.\n\n\n.", "id": 77278, "time": "2005-07-14T06:37:46Z", "bug_id": 35725, "creation_time": "2005-07-14T06:37:46Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 35725, "is_private": false, "id": 77279, "attachment_id": null, "creator": "jljlmatu@jp.ibm.com", "creation_time": "2005-07-14T06:38:52Z", "time": "2005-07-14T06:38:52Z", "text": "Changing the severity because this is a runtime problem\n"}, {"count": 2, "tags": [], "bug_id": 35725, "attachment_id": null, "text": "The other entities defined in\n- http://www.w3.org/TR/xhtml1/DTD/xhtml-lat1.ent\n- http://www.w3.org/TR/xhtml1/DTD/xhtml-special.ent\n- http://www.w3.org/TR/xhtml1/DTD/xhtml-symbol.ent\n, such as &pound; , &euro; , &hearts; ,&Alpha; cause the\nsame exception... Looks like jaspter doesn't take care of\nentities which are used by XHTML defined in \nhttp://www.w3.org/TR/xhtml1/#h-A2\n\n.", "id": 77280, "time": "2005-07-14T06:51:17Z", "creator": "jljlmatu@jp.ibm.com", "creation_time": "2005-07-14T06:51:17Z", "is_private": false}, {"count": 3, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "id": 77308, "time": "2005-07-14T21:04:19Z", "bug_id": 35725, "creation_time": "2005-07-14T21:04:19Z", "is_private": false, "text": "Entity resolution is done at translation time (as required by the spec), so \nall entity definitions must be available then.\n\nSince you almost certainly don't want &nbsp;, &gt;, &lt;, etc. to be resolved \nat translation time, you need to quote them in the source either in a CDATA \nsection or as &amp;nbsp;."}, {"count": 4, "tags": [], "creator": "jljlmatu@jp.ibm.com", "attachment_id": null, "id": 77314, "time": "2005-07-15T02:41:51Z", "bug_id": 35725, "creation_time": "2005-07-15T02:41:51Z", "is_private": false, "text": "I'm still unclear about something.\n\n- You said \"Entity resolution is done at translation time\n  (as required by the spec),\", could you provide us which spec\n  and where( i.e. which section ) has this requirement ?\n\n- Current jasper can resolve some entities(&lt;, &gt;, \n  &quot;, &amp;, &apos; ). I'd like to know why.\n  If what you said is correct, they should be also flagged as an\n  error. Why I'm asking is that I'd like to know how to\n  have Jasper recognize additional entities. ( adding something\n  to jsp:root tag ? or something like that. )\n\n- When I tried the syntax \"&#D;\", jasper seems to recognize it.\n  (Note that according to HTML spec, this syntax is valid. )\n  Is this shure that this syntax is also runnable for jasper ?\n\nWhy I'm asking these is that current jasper accepts some\nentities while it doesn't accept others so I'm wondering\nwhat is the threshold for jasper to accept/not accept\nentities.\n\nThank you very much.\n\n.\n\n\n\n\n."}, {"count": 5, "tags": [], "bug_id": 35725, "attachment_id": null, "text": "(In reply to comment #4)\n> I'm still unclear about something.\n> - You said \"Entity resolution is done at translation time\n>   (as required by the spec),\", could you provide us which spec\n>   and where( i.e. which section ) has this requirement ?\n\n<spec-quote spec=\"JSP\" version=\"2.0\" section=\"6.2.3\">\nThe first step in processing a JSP document is to process it as an XML\ndocument, checking for well-formedness, processing entity resolution and, if\napplicable, performing validation as described in Section JSP.6.2.4.\n</spec-quote>\n\n> - Current jasper can resolve some entities(&lt;, &gt;, \n>   &quot;, &amp;, &apos; ). I'd like to know why.\n>   If what you said is correct, they should be also flagged as an\n>   error. Why I'm asking is that I'd like to know how to\n>   have Jasper recognize additional entities. ( adding something\n>   to jsp:root tag ? or something like that. )\n\nDoh, those are standard XML entities that all XML parsers recognize.  Use them \nin (without escaping) your JSPX page, and you're toast ;-).  Watch your \nbrowser choke on:\n  <jsp:root xmlns:jsp==\"http://java.sun.com/JSP/Page\" version=\"2.0\">\n     <jsp:output omit-xml-declaration=\"no\"\n           doctype-root-element=\"html\" \n           doctype-public=\"-//W3C//DTD XHTML 1.1//EN\"\n           doctype-system=\"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd\"/> \n      <html>\n        <body>Hello &lt;World</body>\n      </html>\n  </jsp:root>\n\n> - When I tried the syntax \"&#D;\", jasper seems to recognize it.\n>   (Note that according to HTML spec, this syntax is valid. )\n>   Is this shure that this syntax is also runnable for jasper ?\n\nAgain, a standard XML entity.\n\n> Why I'm asking these is that current jasper accepts some\n> entities while it doesn't accept others so I'm wondering\n> what is the threshold for jasper to accept/not accept\n> entities.\n\nIt's really simple:  Jasper accepts the standard XML entities, as well as \nthose defined in the internal and/or external DTD of the source document. And, \nof course, DTD declarations buried in CDATA sections don't count (they are \nnothing more than text Strings at translation time).\n\nBut you are really missing the point:  You don't want Jasper to resolve the \nXHTML entities at translation time.\n\n> Thank you very much.\n> .\n> .\n\n", "id": 77317, "time": "2005-07-15T05:08:04Z", "creator": "william.barker@wilshire.com", "creation_time": "2005-07-15T05:08:04Z", "is_private": false}]
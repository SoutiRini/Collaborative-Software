[{"count": 0, "tags": [], "bug_id": 43732, "attachment_id": null, "id": 109939, "time": "2007-10-30T00:40:57Z", "creator": "xiaoshimimi@sohu.com", "creation_time": "2007-10-30T00:40:57Z", "is_private": false, "text": "While Peephole.java is a small program in the manual to remove \u201cNOP\u201d\ninstructions in any class file, it uses the method search() defined in\norg.apache.bcel.util.InstructionFinder with string pattern \u2018NOP+\u2019 to locate the\n\u201cNOP\u201d instructions in the instructionList. After several tests, I found the\nsearch() method will always find one more instruction after the expected\ninstructions, what\u2019s more, it will raise a\njava.lang.ArrayIndexOutOfBoundsException if the expected instruction is at the\nend of the method.\n\nAfter reading the source-code of org.apache.bcel.util.InstructionFinder, I found\nthere is something wrong when we calculate the length of the match[] array.\n\nIn the codes of how to get the match[] array. The startExpr is the first index\nof the \u201dNOP\u201d instruction, and the endExpr is the first index of the non-NOP\ninstruction. So the real length of the match[] should be endExpr-startExpr. But\nwe use endExpr-startExpr+1 as the length of the array. So instead of getting the\nexpected match[] array, we\u2019ll get an one-instruction-longer match[] in the\ninstructionList incorrectly.\n\nAs a result, I guess if the statement \u201cint lenExpr = (endExpr - startExpr) + 1;\u201d\nshould be replaced by \u201cint lenExpr =endExpr - startExpr;\u201d."}, {"count": 1, "tags": [], "creator": "xiaoshimimi@sohu.com", "attachment_id": 21058, "text": "Created attachment 21058\nDesribe of the Bug, and two example to show the bug", "id": 109940, "time": "2007-10-30T00:44:27Z", "bug_id": 43732, "creation_time": "2007-10-30T00:44:27Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 43732, "text": "Please verify", "id": 113380, "time": "2008-02-02T12:23:04Z", "creator": "tcurdt@apache.org", "creation_time": "2008-02-02T12:23:04Z", "is_private": false, "attachment_id": null}]
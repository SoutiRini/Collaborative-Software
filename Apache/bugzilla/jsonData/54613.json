[{"count": 0, "tags": [], "text": "TLDR: apache-2.4 cannot be compiled on FreeBSD<=5.2, this is not clearly documented, the requirements for threading support are not clearly documented, \"configure\" issues no warning or errors, the compile step fails inelegantly.\n\nThe unconditional presence of the type \"apr_thread_mutex_t\" in the \"request_rec\" struct member \"invoke_mtx\" (include/httpd.h) means that httpd will only compile when apr is built with APR_HAS_THREADS defined non-zero. This member was not present in 2.2.x.\n\nObserved on \n- x86 FreeBSD-4.11 (don't ask)\n- httpd-2.4.4\n- apr-1.4.6\n- apr-util-1.5.1\n\nThis means that httpd-2.4.4 can be configured successfully with \"--with-mpm=prefork\" but the wheels come off part way through the compile.\n(apr support for threading support on FreeBSD is limited to >=5.2, specifically kern.osreldate >= 502102 when libpthread/libkse support was enabled)\n\nThe only place this structure member is used in core (modules/http/http_request.c) *is* guarded with \"#if APR_HAS_THREADS\", so it appears safe to fix, but I do not know to what extent this structure is used in the ABI.\n(The experimental mod_dialup also uses it, it implicitly requires threading.)\n\nmod_proxy's \"proxy_worker\" and \"proxy_balancer\" have a similar issue. mod_proxy appears to require threads, though it does not check for apr support, and the documentation (http://httpd.apache.org/docs/2.4/mod/mod_proxy.html) still refers to prefork MPM support. I also mention this because server/core.c includes mod_proxy.h even if no proxy module is enabled.", "attachment_id": null, "bug_id": 54613, "id": 165509, "time": "2013-02-27T14:40:20Z", "creator": "Conor@kerna.ie", "creation_time": "2013-02-27T14:40:20Z", "is_private": false}, {"count": 1, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 165514, "time": "2013-02-27T16:40:00Z", "bug_id": 54613, "creation_time": "2013-02-27T16:40:00Z", "text": "Fair to say any environment where the request_rec offsets would change as a result of #if APR_HAS_THREADS are today not compiling at all?  In such a case it could be changed without a major ABI bump."}, {"count": 2, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 181443, "time": "2015-03-02T17:48:06Z", "bug_id": 54613, "creation_time": "2015-03-02T17:48:06Z", "text": "Thanks for the report, finally fixed in trunk."}, {"count": 3, "tags": [], "creator": "Conor@kerna.ie", "attachment_id": null, "is_private": false, "id": 181474, "time": "2015-03-03T18:09:30Z", "bug_id": 54613, "creation_time": "2015-03-03T18:09:30Z", "text": "Great, thanks! I'll keep an eye out for 2.4.13 and check it builds as expected."}]
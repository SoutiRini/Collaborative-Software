[{"count": 0, "tags": [], "bug_id": 31037, "attachment_id": null, "text": "Using RDBMSexpressionFactory there is a problem with \"ored\" expressions.\nFor example:\n\n<D:searchrequest xmlns:D=\"DAV:\">\n  <D:basicsearch>\n    <D:select>\n      <D:allprop />\n    </D:select>\n    <D:from>\n      <D:scope>\n        <D:href>/slide/files/repo/staging/documents</D:href>\n        <D:depth>infinity</D:depth>\n      </D:scope>\n    </D:from>\n    <D:where>\n      <D:or>\n        <D:eq> \n          <D:prop><D:prop1/></D:prop>\n          <D:literal>value1</D:literal>\n        </D:eq>\n        <D:eq> \n          <D:prop><D:prop2/></D:prop>\n          <D:literal>value2</D:literal>\n        </D:eq>\n      <D:or>\n    </D:where>\n  </D:basicsearch>\n</D:searchrequest>\n\nresults in the following SQL query:\n\nselect u.URI_STRING, o.CLASS_NAME from\n(((OBJECT o inner join URI u on u.URI_ID = o.URI_ID)\ninner join VERSION_HISTORY vh on vh.URI_ID = u.URI_ID)\nnner join PROPERTIES p0 on p0.VERSION_ID = vh.VERSION_ID)\nwhere\n(u.URI_STRING = '/files/repo/staging/documents' OR u.URI_STRING \nLIKE '/files/repo/staging/documents/%')\nAND\n(p0.PROPERTY_NAME = 'state' AND p0.PROPERTY_NAMESPACE = 'http://s-und-\nn.de/sundance/props/1.0' AND p0.PROPERTY_VALUE = 'tobeprocessed')\nor\n(p0.PROPERTY_NAME = 'doctype-url' AND p0.PROPERTY_NAMESPACE = 'http://s-und-\nn.de/sundance/props/1.0' AND p0.PROPERTY_VALUE = 'article')\n\nwhich gives the wrong result (at least with a MySQL datebase). Since AND has a \nhigher priority than OR, the scoping criteria is \"anded\" with the first \nselection criteria and the result is \"ored\" with the second selection criteria.\n\nThe SQL query should rather be\n\nselect u.URI_STRING, o.CLASS_NAME from\n(((OBJECT o inner join URI u on u.URI_ID = o.URI_ID)\ninner join VERSION_HISTORY vh on vh.URI_ID = u.URI_ID)\nnner join PROPERTIES p0 on p0.VERSION_ID = vh.VERSION_ID)\nwhere\n(u.URI_STRING = '/files/repo/staging/documents' OR u.URI_STRING \nLIKE '/files/repo/staging/documents/%')\nAND\n(\n(p0.PROPERTY_NAME = 'state' AND p0.PROPERTY_NAMESPACE = 'http://s-und-\nn.de/sundance/props/1.0' AND p0.PROPERTY_VALUE = 'tobeprocessed')\nor\n(p0.PROPERTY_NAME = 'doctype-url' AND p0.PROPERTY_NAMESPACE = 'http://s-und-\nn.de/sundance/props/1.0' AND p0.PROPERTY_VALUE = 'article')\n)\n\nwhich the attached patch produces.", "id": 63021, "time": "2004-09-03T12:16:15Z", "creator": "gcasper@s-und-n.de", "creation_time": "2004-09-03T12:16:15Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 31037, "attachment_id": 12627, "text": "Created attachment 12627\nthe patch", "id": 63022, "time": "2004-09-03T12:17:30Z", "creator": "gcasper@s-und-n.de", "creation_time": "2004-09-03T12:17:30Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 31037, "attachment_id": null, "text": "OK, applied. Thanks!", "id": 63024, "time": "2004-09-03T12:52:58Z", "creator": "unico@hippo.nl", "creation_time": "2004-09-03T12:52:58Z", "is_private": false}]
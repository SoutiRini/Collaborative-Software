[{"count": 0, "attachment_id": null, "creator": "tmclaugh@sdf.lonestar.org", "is_private": false, "id": 138614, "time": "2010-07-21T15:18:47Z", "bug_id": 49633, "creation_time": "2010-07-21T15:18:47Z", "tags": [], "text": "In an AD environment a user's primary group is not stored in the member attribute.  Instead, the group's RID value is stored in the primaryGroupID attribute of the user.  To find the user's primary group name you need to find the domain SID and then search for the group that has the SID value <domain SID>-<group RID> in their objectSid attribute.  The following is an example in Python using py-ldap for doing this:\n\n---\ndef sid2str(self,sid):\n srl = ord(sid[0])\n number_sub_id = ord(sid[1])\n iav = struct.unpack('!Q','\\x00\\x00'+sid[2:8])[0]\n sub_ids = [\n struct.unpack('<I',sid[8+4*i:12+4*i])[0]\n for i in range(number_sub_id)\n ]\n return 'S-%d-%d-%s' % (\n srl,\n iav,\n '-'.join([str(s) for s in sub_ids]),\n )\n\n# Get RID of primary group\n>>> pri_grp_rid = l.search_s('cn=users,dc=example,dc=com', ldap.SCOPE_SUBTREE, 'sAMAccountName=tmclaughlin', ['primaryGroupID'])[0][1]['primaryGroupID'][0]\n# Get domain SID\n>>> domain_sid = l.search_s('dc=example,dc=com', ldap.SCOPE_BASE)[0][1]['objectSid'][0]\n# Convert domain SID to string form\n>>> domain_sid_s = sid2str(domain_sid)\n# Search for group with <domain SID>-<group RID> objectSid value\n>>> pprint.pprint(l.search_s('ou=groups,dc=example,dc=com', ldap.SCOPE_SUBTREE, 'objectSid=%s-%s' % (domain_sid_s, pri_grp_rid), ['cn']))\n\n[('CN=Domain Users,OU=Groups,DC=example,DC=com',\n {'cn': ['Domain Users']})]\n---\n\nI have some more on AD primary groups here:\nhttp://blogs.freebsdish.org/tmclaugh/2010/07/21/finding-a-users-primary-group-in-ad/"}, {"count": 1, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "id": 138664, "time": "2010-07-23T12:33:45Z", "bug_id": 49633, "creation_time": "2010-07-23T12:33:45Z", "is_private": false, "text": "So are you saying AD can't find member=tmclaughlin under \"Domain Users\"?  Or just that one can't find \"Domain Users\" under cn=tmclaughlin?\n\nDoesn't require ldap-group only care about the former?  Are you using other require types to get a the group info?"}, {"count": 2, "tags": [], "creator": "tmclaugh@sdf.lonestar.org", "text": "With AD neither of those exist.  Here's both my user and the Domain Users group as they're stored in AD.  (Pulled this with py-ldap.)\n\n[('CN=TMCLAUGHLIN,CN=Users,DC=example,DC=com',\n  {'accountExpires': ['129278192266610000'],\n   'adminCount': ['1'],\n   'badPasswordTime': ['129242031791197715'],\n   'badPwdCount': ['0'],\n   'cn': ['TMCLAUGHLIN'],\n   'codePage': ['0'],\n   'countryCode': ['0'],\n   'dSCorePropagationData': ['20100412182352.0Z',\n                             '20100412182158.0Z',\n                             '16010101000417.0Z'],\n   'description': ['Systems Administrator'],\n   'displayName': ['McLaughlin,Thomas'],\n   'distinguishedName': ['CN=TMCLAUGHLIN,CN=Users,DC=example,DC=com'],\n   'gidNumber': ['10002'],\n   'instanceType': ['4'],\n   'lastLogoff': ['0'],\n   'lastLogon': ['129243748272588172'],\n   'lastLogonTimestamp': ['129243298494895070'],\n   'loginShell': ['/bin/bash'],\n   'logonCount': ['65535'],\n   'logonHours': ['\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\xff\\\nxff\\xff\\xff\\xff\\xff\\xff'],\n   'memberOf': ['CN=Employee,OU=Groups,DC=example,DC=com',\n                'CN=Radius Admins,OU=Groups,DC=example,DC=com',\n                'CN=Domain Server Admin,OU=Groups,DC=example,DC=com',\n                'CN=Schema Admins,OU=Groups,DC=example,DC=com',\n                'CN=Domain Admins,OU=Groups,DC=example,DC=com',\n                'CN=Enterprise Admins,OU=Groups,DC=example,DC=com'],\n   'msSFU30Name': ['TMCLAUGHLIN'],\n   'msSFU30NisDomain': ['example'],\n   'name': ['TMCLAUGHLIN'],\n   'objectCategory': ['CN=Person,CN=Schema,CN=Configuration,DC=example,DC=com'],\n   'objectClass': ['top', 'person', 'organizationalPerson', 'user'],\n   'objectGUID': ['\\xa4~\\x932\\x86\\x85vC\\x8f\\x13\\xda\\x96a\\\\\\x0b\\xc0'],\n   'objectSid': ['\\x01\\x05\\x00\\x00\\x00\\x00\\x00\\x05\\x15\\x00\\x00\\x007~;e\\xa0\\x07\\x\ne4I\\x18IF\\x17\\xfa\\x1f\\x00\\x00'],\n   'primaryGroupID': ['513'],\n   'pwdLastSet': ['129234992266771052'],\n   'sAMAccountName': ['TMCLAUGHLIN'],\n   'sAMAccountType': ['805306368'],\n   'scriptPath': ['Default.bat'],\n   'uSNChanged': ['99938168'],\n   'uSNCreated': ['30981'],\n   'uid': ['tmclaughlin'],\n   'uidNumber': ['10000'],\n   'unixHomeDirectory': ['/home/tmclaughlin'],\n   'userAccountControl': ['512'],\n   'whenChanged': ['20100723033758.0Z'],\n   'whenCreated': ['20070304152704.0Z']})]\n\n\n[('CN=Domain Users,OU=Groups,DC=example,DC=com',\n  {'cn': ['Domain Users'],\n   'dSCorePropagationData': ['20100412182218.0Z',\n                             '20100412181952.0Z',\n                             '20091218151750.0Z',\n                             '20091216205638.0Z',\n                             '16010714223649.0Z'],\n   'description': ['All domain users'],\n   'distinguishedName': ['CN=Domain Users,OU=Groups,DC=example,DC=com'],\n   'gidNumber': ['10002'],\n   'groupType': ['-2147483646'],\n   'instanceType': ['4'],\n   'isCriticalSystemObject': ['TRUE'],\n   'memberOf': ['CN=Users,CN=Builtin,DC=example,DC=com'],\n   'msSFU30Name': ['Domain Users'],\n   'msSFU30NisDomain': ['example'],\n   'name': ['Domain Users'],\n   'objectCategory': ['CN=Group,CN=Schema,CN=Configuration,DC=example,DC=com'],\n   'objectClass': ['top', 'group'],\n   'objectGUID': ['[\\x1b>Jo\\x12\\x1bB\\xb2\\xe6\\x8b[\\rV\\xf4S'],\n   'objectSid': ['\\x01\\x05\\x00\\x00\\x00\\x00\\x00\\x05\\x15\\x00\\x00\\x007~;e\\xa0\\x07\\x\ne4I\\x18IF\\x17\\x01\\x02\\x00\\x00'],\n   'sAMAccountName': ['Domain Users'],\n   'sAMAccountType': ['268435456'],\n   'uSNChanged': ['81880376'],\n   'uSNCreated': ['7589'],\n   'whenChanged': ['20100205162639.0Z'],\n   'whenCreated': ['20070304152927.0Z']})]\n\nThe only reliable way to get the user's primary group is to get the group RID from the user's PrimaryGroupID and then search for the group using 'objectSid=<Domain SID>-<RID>'", "id": 138665, "time": "2010-07-23T13:01:06Z", "bug_id": 49633, "creation_time": "2010-07-23T13:01:06Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "cborisa@outlook.com", "attachment_id": null, "id": 200090, "time": "2017-07-28T07:45:32Z", "bug_id": 49633, "creation_time": "2017-07-28T07:45:32Z", "is_private": false, "text": "Is there a fix planned for this issue?"}, {"count": 4, "tags": [], "bug_id": 49633, "text": "(In reply to Boris from comment #3)\n> Is there a fix planned for this issue?\n\nBased on the age, it doesn't appear anyone is working on it", "id": 200099, "time": "2017-07-28T11:54:47Z", "creator": "covener@gmail.com", "creation_time": "2017-07-28T11:54:47Z", "is_private": false, "attachment_id": null}]
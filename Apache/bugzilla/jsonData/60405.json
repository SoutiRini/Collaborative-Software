[{"count": 0, "tags": [], "bug_id": 60405, "attachment_id": 34467, "is_private": false, "id": 195156, "time": "2016-11-22T21:36:40Z", "creator": "martin.oberhuber@gmx.at", "creation_time": "2016-11-22T21:36:40Z", "text": "Created attachment 34467\nMyWB.xls containing Excel 4.0 macro functions\n\nI'm using poi-3.15 from Sourceforge Docfetcher, to index Excel documents (among others) for searching. On attached document, the following exception is thrown, making it impossible to access any data of the document; this is a severe issue that I don't have any workaround for.\n\n\njava.lang.ArrayIndexOutOfBoundsException: -32725\n\tat org.apache.poi.ss.formula.function.FunctionMetadataRegistry.getFunctionByIndexInternal(FunctionMetadataRegistry.java:66)\n\tat org.apache.poi.ss.formula.function.FunctionMetadataRegistry.getFunctionByIndex(FunctionMetadataRegistry.java:62)\n\tat org.apache.poi.ss.formula.ptg.FuncVarPtg.create(FuncVarPtg.java:56)\n\tat org.apache.poi.ss.formula.ptg.FuncVarPtg.create(FuncVarPtg.java:45)\n\tat org.apache.poi.ss.formula.ptg.Ptg.createClassifiedPtg(Ptg.java:103)\n\tat org.apache.poi.ss.formula.ptg.Ptg.createPtg(Ptg.java:84)\n\tat org.apache.poi.ss.formula.ptg.Ptg.readTokens(Ptg.java:55)\n\tat org.apache.poi.ss.formula.Formula.getTokens(Formula.java:82)\n\tat org.apache.poi.hssf.record.FormulaRecord.getParsedExpression(FormulaRecord.java:314)\n\tat org.apache.poi.hssf.record.aggregates.FormulaRecordAggregate.getFormulaTokens(FormulaRecordAggregate.java:201)\n\tat org.apache.poi.hssf.usermodel.HSSFCell.getCellFormula(HSSFCell.java:649)\n\tat org.apache.poi.hssf.extractor.ExcelExtractor.getText(ExcelExtractor.java:339)\n\tat net.sourceforge.docfetcher.model.parse.MSExcelParser.renderText(MSExcelParser.java:57)\n\n\nThe issue is severe, since no other contents from the Excel file is available, due to the exception. Docfetcher runs POI like this:\n\n    POIFSFileSystem fs = new POIFSFileSystem(in);\n    extractor = new ExcelExtractor(fs);\n    extractor.setFormulasNotResults(true);\n    return extractor.getText();\n\nRunning my testcase in the debugger, the exception seems to occur on the sheet \"Macro1\" row 1 column 0 which contains this:\n    =ALIGNMENT(2;FALSE;1;0;FALSE)\nwhich appears to relate to this FormulaRecord._byteEncoding:\n    [30, 2, 0, 29, 0, 30, 1, 0, 30, 0, 0, 29, 0, 66, 5, 43, -128]\n\nNote that the document must be opened with \"Macros disabled\" in order to make this contents visible in Excel. The particular sheet contains several other \"Excel 4.0 macro functions\".\n\nExpected behavior would be, that POI can ignore unknown functions/formulas/macros, such that at least the rest of the document can be indexed for search."}]
[{"count": 0, "tags": [], "bug_id": 34764, "is_private": false, "id": 74492, "attachment_id": null, "creator": "cshi@atg.com", "creation_time": "2005-05-05T17:38:38Z", "time": "2005-05-05T17:38:38Z", "text": "Recently, we upgraded ANT from 1.5.3 to 1.6.2. However, I've encountered\npermission issue in following scenario:\n  - A jar file is built on Windows\n  - This jar file is merged into another jar file via zipfileset on Linux or Solaris\n  - Extract the jar file built in 2nd step using unzip by Info-ZIP\n\nAll entries from the jar file built on Windows have '000' permission. As a\nresult, they are inaccessible."}, {"count": 1, "tags": [], "bug_id": 34764, "text": "There are no unix file permissions in Jar files; they are like zip files: DOS only.\n\n1. what non-standard field is info-zip using for storing its permissions?\n2. what happens when you unzip using other popular tools?", "id": 74494, "time": "2005-05-05T18:05:30Z", "creator": "stevel@apache.org", "creation_time": "2005-05-05T18:05:30Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 34764, "attachment_id": null, "id": 74495, "time": "2005-05-05T18:35:01Z", "creator": "cshi@atg.com", "creation_time": "2005-05-05T18:35:01Z", "is_private": false, "text": "(In reply to comment #1)\n> There are no unix file permissions in Jar files; they are like zip files: DOS \nonly.\n> 1. what non-standard field is info-zip using for storing its permissions?\n> 2. what happens when you unzip using other popular tools?\n\nWell, according to ANT's source code, it's the jar task extended from zip task \nto set the permission on an entry, no matter if you build a jar file or zip \nfile.\n\nFor the questions you asked, I don't have the answers. Sorry.\n"}, {"count": 3, "tags": [], "bug_id": 34764, "text": "oh, i see, yes, it is at the bottom. I hadn't noticed that. Thank you for your\ncorrection.\n\n-are the original JAR file permissions ok, but the merged ones broken?\n-did this work before?\n\nAs usual, try Ant1.6.3 to see if this changes anything. In this case I doubt it,\nbut it's the first step to fixing things.\n\nWe are going to have some fun writing a test case for this problem. ", "id": 74523, "time": "2005-05-06T12:25:39Z", "creator": "stevel@apache.org", "creation_time": "2005-05-06T12:25:39Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 34764, "attachment_id": null, "id": 77110, "time": "2005-07-08T16:20:53Z", "creator": "bodewig@apache.org", "creation_time": "2005-07-08T16:20:53Z", "is_private": false, "text": "jar files generated by the JDK's jar tool in general have broken permissions when\nextracted by InfoZIP's unzip (the directories are not executable).  This was\nthe main reason that made us implement our own Zip*Stream and ZipEntry classes\n- adding support for filemode and dirmode.\n\nSteve, the permissions are stored inside the external attributes of the zip entry,\nyou can access them via Ant's ZipEntry class.\n\nOK, how do you create the jar file on Windows?  How do the permissions look\nlike if you run unzip on the jar created in the first step?\n\nYour <zipfileset> probably has neither a filemode nor a dirmode attribute,\nin which case it later on you don't get the default permissions (0744 and 0755\nrespectively) but whatever the external attributes in the first jar said.\n"}, {"count": 5, "tags": [], "bug_id": 34764, "attachment_id": null, "text": "I beleive that we may be seeing the same issue.\n\n    104     <target name=\"client-inject-tlds\">\n    105         <echo message=\"Injecting TLDs into ${client.war.name}\" />\n    106         <!-- Something is broken in Ant's zip task \n    107                 It doesn't do zip updating properly it effectively unzips\n    108                 then rezips the old contents into the new file, and\n    109                 messes the permissions up in the process (Unix \"0000\")\n    110             -->\n    111         <move file=\"${client.war.name}\" tofile=\"${client.war.name}.tmp\" />\n    112         <zip\n    113                 destfile=\"${client.war.name}\"\n    114                 duplicate=\"fail\"\n    115                 >\n    116             <zipfileset\n    117                     src=\"${client.war.name}.tmp\"\n    118                     filemode=\"0744\"\n    119                     dirmode=\"0755\"\n    120                     />\n    121             <zipfileset\n    122                     dir=\"${client.dir.build.tld}\"\n    123                     prefix=\"WEB-INF/lib\"\n    124                     filemode=\"0744\"\n    125                     dirmode=\"0755\"\n    126                     />\n    127         </zip>\n    128         <delete file=\"${client.war.name}.tmp\" />\n    129         <!-- this should work but doesn't... \n    130         <zip\n    131                 destfile=\"${client.war.name}\"\n    132                 duplicate=\"fail\"\n    133                 update=\"true\"\n    134                 keepcompression=\"true\"\n    135                 >\n    136             <zipfileset\n    137                     dir=\"${client.dir.build.tld}\"\n    138                     prefix=\"WEB-INF/lib\"\n    139                     filemode=\"0744\"\n    140                     dirmode=\"0755\"\n    141                     />\n    142         </zip>\n    143         -->\n    144     </target>\n\nThe commented out version at the bottom produces\nd---------    2 nslm     users          80 Aug 30 14:28 META-INF\ndrwxr-xr-x    4 nslm     users         288 Aug 30 14:28 WEB-INF\n----------    1 nslm     users        3311 Jul 25 09:32 advancedSearch.jsp\n\nWhere as the kludged version at the top produces\ndrwxr-xr-x    2 nslm     users          80 Aug 30 15:23 META-INF\ndrwxr-xr-x    4 nslm     users         288 Aug 30 15:23 WEB-INF\n-rwxr--r--    1 nslm     users        3311 Jul 25 09:32 advancedSearch.jsp\n\n\nMETA-INF and advancedSearch are in ${client.war.name}\n\nIt would appear that in \"preserving\" the contents of the original file you are\ndropping the permissions associated with the existing entries.  I can see no way\nto reset said permissions as suggested by Stefan, since it is the file we are\nattempting to merge things into which is being corrupted. ${client.war.name} was\nalso created through ant during the same build sequence.\n\nThis is also with ant 1.6.2", "id": 79186, "time": "2005-08-30T17:08:30Z", "creator": "apache@nslm.org", "creation_time": "2005-08-30T17:08:30Z", "is_private": false}, {"count": 6, "text": "I've just realised I didn't mention that the file which is being messed up looks\nfine if unzipped before the zip task is run.", "bug_id": 34764, "attachment_id": null, "id": 79187, "time": "2005-08-30T17:10:51Z", "creator": "apache@nslm.org", "creation_time": "2005-08-30T17:10:51Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 34764, "is_private": false, "id": 115475, "attachment_id": null, "creator": "k.georgiou@atreides.org.uk", "creation_time": "2008-04-09T17:17:46Z", "time": "2008-04-09T17:17:46Z", "text": "releated to #42122 maybe?"}, {"count": 8, "text": "svn revision 677871 contains a testcase for the update case which passes, this has probably been fixed as a side effect of fixing bug 42122\n", "bug_id": 34764, "attachment_id": null, "id": 118802, "time": "2008-07-18T03:21:32Z", "creator": "bodewig@apache.org", "creation_time": "2008-07-18T03:21:32Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "creator": "prescindor@gmail.com", "attachment_id": 22730, "id": 121519, "time": "2008-10-14T20:34:00Z", "bug_id": 46009, "creation_time": "2008-10-14T20:34:00Z", "is_private": false, "text": "Created attachment 22730\nA test case that clones sheets with and without a merged region.\n\nIf you clone a sheet that has a merged region, you get an exception when you attempt to write the workbook:\n\n$ run\nThere is 1 sheet.\nThere are 2 sheets.\nWorked for: noMergedRegion\nThere is 1 sheet.\nThere are 2 sheets.\nFailed for: hasMergedRegion\njava.lang.ArrayStoreException\n\tat java.lang.System.arraycopy(Native Method)\n\tat java.util.ArrayList.toArray(ArrayList.java:304)\n\tat org.apache.poi.hssf.record.aggregates.MergedCellsTable.visitContainedRecords(MergedCellsTable.java:85)\n\tat org.apache.poi.hssf.model.Sheet.visitContainedRecords(Sheet.java:577)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.getBytes(HSSFWorkbook.java:1319)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.write(HSSFWorkbook.java:1229)\n\tat TestCase.test(TestCase.java:30)\n\tat TestCase.main(TestCase.java:10)\n\nCode to reproduced the above is attached.\n\nWorkaround: Remove all the merged regions from the cloned sheet. Then loop over the merged regions in the original sheet and add each one found to the cloned sheet. The resulting workbook saves without a problem."}, {"count": 1, "tags": [], "text": "If you clone a sheet with a merged region and then call getMergedRegion on the clone, it falls over at line 111 in MergedCellsTable with a ClassCastException trying to return a value retrieved from an internal ArrayList as a CellRangeAddress.\n\njava.lang.ClassCastException: org.apache.poi.ss.util.CellRangeAddress\norg/apache/poi/hssf/record/aggregates/MergedCellsTable.java:111:in `get'\norg/apache/poi/hssf/model/Sheet.java:506:in `getMergedRegionAt'\norg/apache/poi/hssf/usermodel/HSSFSheet.java:674:in `getMergedRegion'\n", "attachment_id": null, "id": 121557, "creator": "prescindor@gmail.com", "time": "2008-10-15T10:51:21Z", "bug_id": 46009, "creation_time": "2008-10-15T10:51:21Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 46009, "attachment_id": null, "id": 121926, "time": "2008-10-27T14:33:34Z", "creator": "josh@apache.org", "creation_time": "2008-10-27T14:33:34Z", "is_private": false, "text": "fixed in svn r708325.\n\nJunit added."}]
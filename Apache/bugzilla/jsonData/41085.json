[{"count": 0, "attachment_id": null, "creator": "rfrovarp@apache.org", "text": "I have three pubs. default -> edchanges -> dark. Default is the base from a\nfresh checkout. edchanges contains usecase changes but does not contain an xslt\ndirectory. It should be getting its layout from default. dark does have an xslt\ndirectory and files. If I start up Lenya and go to edchanges it grabs it from\ndefault, if I then go to dark, it gets it from default (wrong since it has its\nown). If I start up Lenya and go to dark it grabs its own layout. If I then go\nto edchanges or default it grabs the layout from dark, which is falling forward.\n\nUnder the second situation, I see the following in the logs:\n\nSocketListener0-9 DEBUG core.xslt - resolve(href =\nfallback://xslt/page2xhtml.xsl, base =\nfile:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/default/xslt\n/page2xhtml-xhtml.xsl); resolver =\norg.apache.cocoon.components.CocoonComponentManager@30b601\nSocketListener0-9 DEBUG core.manager - Resolving\n'fallback://xslt/page2xhtml.xsl' with base\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/edchanges\n/' in context 'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/'\nSocketListener0-9 DEBUG core.manager - ComponentFactory creating new instance of\norg.apache.lenya.cms.cocoon.source.FallbackSourceFactory.\nSocketListener0-9 DEBUG core.manager - logger attribute is lenya.source.fallback\nSocketListener0-9 DEBUG core.manager - Resolved to systemID :\nfallback://xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG source.fallback - Location:    \n[fallback://xslt/page2xhtml.xsl]\nSocketListener0-9 DEBUG source.fallback - Path:         [xslt/page2xhtml.xsl]\nSocketListener0-9 DEBUG core.manager - ComponentFactory creating new instance of\norg.apache.lenya.cms.publication.templating.PublicationTemplateManagerImpl.\nSocketListener0-9 DEBUG core.manager - logger attribute is\nlenya.publication.templatemanager\nSocketListener0-9 DEBUG core.manager - ComponentFactory creating new instance of\norg.apache.lenya.cms.publication.DocumentManagerImpl.\nSocketListener0-9 DEBUG core.manager - no logger attribute available, using\nstandard logger\nSocketListener0-9 DEBUG core.manager - ComponentFactory decommissioning instance\nof org.apache.lenya.cms.publication.DocumentManagerImpl.\nSocketListener0-9 DEBUG publication.templatemanager - Trying to resolve URI\n[context://lenya/pubs/dark/xslt/page2xhtml.xsl]\nSocketListener0-9 DEBUG core.manager - Resolving\n'context://lenya/pubs/dark/xslt/page2xhtml.xsl' with base\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya\n/pubs/edchanges/' in context 'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/'\nSocketListener0-9 DEBUG core.manager - Resolved to systemID :\ncontext://lenya/pubs/dark/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG core.manager - Creating source object for\ncontext://lenya/pubs/dark/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG servlet.ServletHandler - getRealPath of\n//lenya/pubs/dark/xslt/page2xhtml.xsl in\norg.mortbay.jetty.servlet.WebApplicationHandler@153f67e\nSocketListener0-9 DEBUG core.manager - Resolving\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/dark/xslt/page2xhtml.xsl'\nwith base 'file:/home/rfro\nvarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/edchanges/' in context\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/'\nSocketListener0-9 DEBUG core.manager - Resolved to systemID :\nfile:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/dark/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG publication.templatemanager - Trying to resolve URI\n[context://lenya/pubs/edchanges/xslt/page2xhtml.xsl]\nSocketListener0-9 DEBUG core.manager - Resolving\n'context://lenya/pubs/edchanges/xslt/page2xhtml.xsl' with base\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/\nlenya/pubs/edchanges/' in context\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/'\nSocketListener0-9 DEBUG core.manager - Resolved to systemID :\ncontext://lenya/pubs/edchanges/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG core.manager - Creating source object for\ncontext://lenya/pubs/edchanges/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG servlet.ServletHandler - getRealPath of\n//lenya/pubs/edchanges/xslt/page2xhtml.xsl in\norg.mortbay.jetty.servlet.WebApplicationHandler@153f67\ne\nSocketListener0-9 DEBUG core.manager - Resolving\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/edchanges/xslt/page2xhtml.xsl'\nwith base 'file:/home\n/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/edchanges/' in context\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/'\nSocketListener0-9 DEBUG core.manager - Resolved to systemID :\nfile:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/edchanges/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG publication.templatemanager - Trying to resolve URI\n[context://lenya/pubs/default/xslt/page2xhtml.xsl]\nSocketListener0-9 DEBUG core.manager - Resolving\n'context://lenya/pubs/default/xslt/page2xhtml.xsl' with base\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/le\nnya/pubs/edchanges/' in context\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/'\nSocketListener0-9 DEBUG core.manager - Resolved to systemID :\ncontext://lenya/pubs/default/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG core.manager - Creating source object for\ncontext://lenya/pubs/default/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG servlet.ServletHandler - getRealPath of\n//lenya/pubs/default/xslt/page2xhtml.xsl in\norg.mortbay.jetty.servlet.WebApplicationHandler@153f67e\nSocketListener0-9 DEBUG core.manager - Resolving\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/default/xslt/page2xhtml.xsl'\nwith base 'file:/home/r\nfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/edchanges/' in context\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/'\nSocketListener0-9 DEBUG core.manager - Resolved to systemID :\nfile:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/default/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG publication.templatemanager - Trying to resolve URI\n[context:///xslt/page2xhtml.xsl]\nSocketListener0-9 DEBUG core.manager - Resolving\n'context:///xslt/page2xhtml.xsl' with base\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/edchanges\n/' in context 'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/'\nSocketListener0-9 DEBUG core.manager - Resolved to systemID :\ncontext:///xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG core.manager - Creating source object for\ncontext:///xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG servlet.ServletHandler - getRealPath of\n///xslt/page2xhtml.xsl in org.mortbay.jetty.servlet.WebApplicationHandler@153f67e\nSocketListener0-9 DEBUG core.manager - Resolving\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/xslt/page2xhtml.xsl' with\nbase 'file:/home/rfrovarp/lenya-1.4.x\n/build/lenya/webapp/lenya/pubs/edchanges/' in context\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/'\nSocketListener0-9 DEBUG core.manager - Resolved to systemID :\nfile:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG source.fallback - Resolved URI: \n[file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/dark/xslt/page2xhtml.xsl]\nSocketListener0-9 DEBUG core.manager - Resolving\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/dark/xslt/page2xhtml.xsl'\nwith base 'file:/home/rfro\nvarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/edchanges/' in context\n'file:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/'\nSocketListener0-9 DEBUG core.manager - Resolved to systemID :\nfile:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/dark/xslt/page2xhtml.xsl\nSocketListener0-9 DEBUG core.manager - ComponentFactory decommissioning instance\nof org.apache.lenya.cms.publication.templating.PublicationTemplateManagerImpl.\nSocketListener0-9 DEBUG source.fallback - Processing time: 06:00:00.3\nSocketListener0-9 DEBUG core.manager - ComponentFactory decommissioning instance\nof org.apache.lenya.cms.cocoon.source.FallbackSourceFactory.\nSocketListener0-9 DEBUG core.xslt - xslSource =\norg.apache.excalibur.source.impl.FileSource@13e3940, system id =\nfile:/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/\nlenya/pubs/dark/xslt/page2xhtml.xsl", "id": 96413, "time": "2006-11-30T08:42:39Z", "bug_id": 41085, "creation_time": "2006-11-30T08:42:39Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "creator": "andreas@apache.org", "text": "This looks like a caching issue.", "id": 96414, "time": "2006-11-30T08:48:54Z", "bug_id": 41085, "creation_time": "2006-11-30T08:48:54Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "rfrovarp@apache.org", "text": "It might be. I have dark, elegant, and gloss as siblings. They are all using\ntheir correct template. The parent is not grabbing from default. default is\nusing its template correctly at this moment.", "id": 96421, "time": "2006-11-30T10:15:14Z", "bug_id": 41085, "creation_time": "2006-11-30T10:15:14Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 41085, "attachment_id": null, "is_private": false, "id": 96423, "time": "2006-11-30T10:22:10Z", "creator": "rfrovarp@apache.org", "creation_time": "2006-11-30T10:22:10Z", "text": "Nope, I was wrong. They are pulling in the correct images and CSS, but not the\ncorrect XSLT. It is using the first one I requested."}, {"count": 4, "tags": [], "creator": "rfrovarp@apache.org", "text": "However, if I make a change to the template, the change is reflected on the page\nusing a reload. That is if the change is made to the one template it insists on\nusing.", "id": 96424, "time": "2006-11-30T10:26:41Z", "bug_id": 41085, "creation_time": "2006-11-30T10:26:41Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "rfrovarp@apache.org", "text": "I found the problem and a work around. Not entirely sure what other areas are\naffected. It would appear that it might be a caching issue. I really couldn't\ntrack much down in the code or the logs. I did not have a\npubname/xslt/page2xhtml-xhtml.xsl file. I figured the one in the default\npublication was good enough. As soon as I copied\ndefault/xslt/page2xhtml-xhtml.xsl into pubname/xslt/page2xhtml-xhtml.xsl\neverything works. The 5 siblings now look like they should. I will need to\nverify this against the static HTML templates tomorrow.", "id": 96449, "time": "2006-11-30T21:43:11Z", "bug_id": 41085, "creation_time": "2006-11-30T21:43:11Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 41085, "is_private": false, "id": 96461, "creation_time": "2006-12-01T09:19:26Z", "time": "2006-12-01T09:19:26Z", "creator": "rfrovarp@apache.org", "text": "Copying the page2xhtml-xhtml.xsl file into the derived publications removes the\nproblem. It makes sense from a performance standpoint to not have the fallbacks\ngo back and forth for something that is this easy to fix. People just need to\nkeep in mind that falling back then expecting that to fallback back up the tree\nfor XSLT doesn't work properly.", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 41085, "attachment_id": null, "is_private": false, "id": 96462, "time": "2006-12-01T09:48:58Z", "creator": "dhc4z@virginia.edu", "creation_time": "2006-12-01T09:48:58Z", "text": "I believe that this is a caching problem, but with cocoon caching the xslt.  I\nbelieve that I have run into your problem in the past and resolved it by setting\nthe xslt use-store parameter to false for my xslt processor in cocoon.xconf"}, {"count": 8, "tags": [], "creator": "thorsten@apache.org", "text": "Renaming Lenya 1.4 to 2.0", "id": 105577, "time": "2007-07-16T01:59:24Z", "bug_id": 41085, "creation_time": "2007-07-16T01:59:24Z", "is_private": false, "attachment_id": null}]
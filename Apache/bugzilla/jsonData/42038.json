[{"count": 0, "attachment_id": null, "creator": "gears@umich.edu", "text": "Exclusion rules that differ from non-excluded mappings only by case appear to be\nignored.\n\nWith JK 1.2.20 installed on IIS on Windows 2003, and\ngiven the following in uriworkermap.properties:\n\n/umich|/*=v7CDALiveWorker\n#Added for Friendly URL Mapper\n/*=v7CDALiveWorker\n#Exclude static files\n!/UMICH/*=v7CDALiveWorker\n!/System/*=v7CDALiveWorker\n\nRequests to /umich are sent appropriately to Tomcat. [Correct]\nRequests to /UMICH are sent to Tomcat (resulting in a Tomcat 404 error) [Bug]\nRequest to /System are sent to IIS, NOT Tomcat. [Correct]\n\nSomehow I think it's the case sensitivity, but the fact that there's a Root\ncontext might complicate things. I've tried looking through the source code, but\n it's beyond me to figure out what's going on.", "id": 101391, "time": "2007-04-03T14:14:41Z", "bug_id": 42038, "creation_time": "2007-04-03T14:14:41Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "gears@umich.edu", "text": "Created attachment 19914\nlog file for the ISAPI Redirector\n\nThis is the log file, set to debug.", "id": 101435, "time": "2007-04-04T12:16:07Z", "bug_id": 42038, "creation_time": "2007-04-04T12:16:07Z", "is_private": false, "attachment_id": 19914}, {"count": 2, "tags": [], "text": "Turns out it has nothing to do with case. The presence of a root context mapping\nmeans that any exclusion rules such as \"!/UMICH\" appear to be ignored. I had an\nold /System context that was causing that to properly work (Tomcat was serving\nthe static files). \n\nRequests to /umich are sent appropriately to Tomcat. [Correct]\nRequests to /UMICH are sent to Tomcat (resulting in a Tomcat 404 error) [Bug]\nRequest to /System  sent to Tomcat (resulting in a Tomcat 404 error) [Bug]\n\nI have updated the summary to reflect this.", "is_private": false, "bug_id": 42038, "id": 101436, "time": "2007-04-04T13:10:36Z", "creator": "gears@umich.edu", "creation_time": "2007-04-04T13:10:36Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 42038, "attachment_id": null, "text": "On IIS, if you have a root context rule, you must specify the virtual host for\nany exclusion rules for them to correctly identify a no match. This occurs in jk\n1.2.20 and 1.2.21. This appears to be because jk_isapi_plugin.c (line 870-875 in\n1.2.21) checks for successful map_uri_to_worker (with is always true when there\nis a root context rule) with the Virtual Host Redirection before attempting a\nDefault redirection map_uri_to_worker. \n\nFor example a uriworkermap.properties file:\n\n/*=v7CDALiveWorker\n#Exclude static files (take turns commenting out the following for testing)\n!/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/UMICH/*=v7CDALiveWorker\n!/UMICH/*=v7CDALiveWorker\n\nIf you omit the virtual host line, then it fails to find the non-virtual\nexclusion rule (This means it does not successfully find a  wildchar no match).\n\nWithout the virtual host line, it compares:\njk_uri_worker_map.c (161): wildchar_match(str, exp)  for\n/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/UMICH/MichInWash/Home/For Students/Fall\nApplication Information/MIWF07app.pdf compared to /UMICH/*\n\nWith only the virtual host line, it compares:\njk_uri_worker_map.c (161):wildchar_match(str, exp)  for\n/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/UMICH/MichInWash/Home/For Students/Fall\nApplication Information/MIWF07app.pdf compared to\n/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/UMICH/*\n\n\n", "id": 101541, "time": "2007-04-09T17:12:58Z", "creator": "gears@umich.edu", "creation_time": "2007-04-09T17:12:58Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 42038, "attachment_id": null, "text": "Sorry. Correcting version information for latest connector.", "id": 101542, "time": "2007-04-09T17:15:06Z", "creator": "gears@umich.edu", "creation_time": "2007-04-09T17:15:06Z", "is_private": false}, {"count": 5, "attachment_id": null, "creator": "mturk@apache.org", "is_private": false, "id": 101555, "time": "2007-04-10T07:08:18Z", "bug_id": 42038, "creation_time": "2007-04-10T07:08:18Z", "tags": [], "text": "Hi,\n\n> /*=v7CDALiveWorker\nThis is wrong.\nIn case you have multiple virtual hosts you shuld never do that.\nAlways use the /VHOST/URI form:\n/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/*=v7CDALiveWorker\nor at least ...\n/*/*=v7CDALiveWorker\n\n> #Exclude static files (take turns commenting out the following for testing)\n> !/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/UMICH/*=v7CDALiveWorker\n> !/UMICH/*=v7CDALiveWorker\n\nAgain, use the:\n!/*/UMICH/*=v7CDALiveWorker\n\nThere is simply no way to know what the virtual host is from the\nuriworkermap.properties unless we change the configuration, and\nmark the VHOST part somehow. That would make configs backward incompatible,\nso it'll have to wait some post 1.2 version\n"}, {"count": 6, "tags": [], "bug_id": 42038, "attachment_id": 19932, "id": 101586, "time": "2007-04-11T10:42:07Z", "creator": "gears@umich.edu", "creation_time": "2007-04-11T10:42:07Z", "is_private": false, "text": "Created attachment 19932\nCorrected version of files from 1.2.21\n\nAttached is a patch which corrects the behavior to match the documentation.\nThis allows a site without multiple virtual hosts to use a\nuriworkermap.properties such as:\n\n/*=v7CDALiveWorker\n/umich|/*=v7CDALiveWorker\n#Exclude static files\n!/UMICH/*=v7CDALiveWorker\n!/StaticFiles/*=v7CDALiveWorker\n!/System/*=v7CDALiveWorker\n!/Humin-migration/*=v7CDALiveWorker\n\nIt also allows a site with multiple virtual hosts to use a\nuriworkermap.properties like:\n/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/*=v7CDALiveWorker\n/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/umich|/*=v7CDALiveWorker\n#Exclude static files\n!/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/UMICH/*=v7CDALiveWorker\n!/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/StaticFiles/*=v7CDALiveWorker\n!/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/System/*=v7CDALiveWorker\n!/lsa-cmsdev1.lsa.adsroot.itcs.umich.edu/Humin-migration/*=v7CDALiveWorker\n\nI have submitted the complete altered files rather than a patch because I do\nnot know the patch format preferred, and I am concerned I did not correctly\nfollow the tab/spacing standards. Also, I believe the files have changed since\nthe last release, and a patch may not cleanly apply. Let me know if you would\nlike me to correct these."}, {"count": 7, "tags": [], "bug_id": 42038, "attachment_id": null, "id": 101587, "time": "2007-04-11T10:47:58Z", "creator": "gears@umich.edu", "creation_time": "2007-04-11T10:47:58Z", "is_private": false, "text": "I believe that the current behavior is contrary to the documentation, and that\naltering the configuration file format is not necessary to solve it. My attached\nsolution may break working configurations that mixed and matched virtual with\nnon-virtual mounts, but it may not. I would like someone who is more familiar\nwith the code and C to examine my solution, as I may have overlooked something."}, {"count": 8, "tags": [], "bug_id": 42038, "attachment_id": 19934, "is_private": false, "id": 101594, "time": "2007-04-11T14:13:16Z", "creator": "gears@umich.edu", "creation_time": "2007-04-11T14:13:16Z", "text": "Created attachment 19934\nAltered Files against 1.2.22\n\nThis updates the files to be against the\ntomcat-connectors-1.2.22-dev-527493-src.zip that Mladen made available. You can\nuncompress them as an overlay."}, {"count": 9, "tags": [], "bug_id": 42038, "attachment_id": null, "is_private": false, "id": 101745, "time": "2007-04-15T18:16:23Z", "creator": "gears@umich.edu", "creation_time": "2007-04-15T18:16:23Z", "text": "Adding keyword because there is a patch attached."}, {"count": 10, "attachment_id": null, "bug_id": 42038, "text": "Is there any reason why this patch has not been applied?", "id": 108991, "time": "2007-10-04T09:36:14Z", "creator": "gears@umich.edu", "creation_time": "2007-10-04T09:36:14Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 42038, "attachment_id": null, "is_private": false, "id": 110218, "time": "2007-11-03T14:16:45Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-11-03T14:16:45Z", "text": "1) case-sensitivity\n\nMost parts of URLs are case-sensitive in general (as stated by the respective\nRFCs). Although on the windows platform file system pathes are not, and\ntherefore URLs pointing to file system objects usually behave case-insensitive,\nmod_jk decides about forwarding to backends, whose case-sensitivity is unknown.\n\nSo we wont change the default for the Windows platform to case-insensitive. One\nmight argue, that it would make configuration for the windows platform easier,\nif one could choose mappings to be case insensitive (not active by default). For\nthis we could extent the syntax of uriworkermap.properties resp. JkMount (in the\napache case). If you think that's an important feature, please open a separate\nBZ for this feature and people can discuss it.\n\n2) Root-Context mounts and unmounts\n\nI'm thinking about your patch resp. something close to it.\n"}, {"count": 12, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "Your configuration\n\n/umich|/*=v7CDALiveWorker\n#Added for Friendly URL Mapper\n/*=v7CDALiveWorker\n#Exclude static files\n!/UMICH/*=v7CDALiveWorker\n!/System/*=v7CDALiveWorker\n\nshould now work (apart from the fact, that we still match URLs case sensitive).\nYou can find a dev snapshot of 1.2.26 under\n\nhttp://people.apache.org/~rjung/mod_jk-dev/\n\nThe IIS mount checks are restructured now. They should be compatible as long no\nexclusion is defined. Whenever an exclusion is defined, it is always matched\nlast, after any positive match, independeant of possible vhosts.\n\nPlease report back, if this fixes your problem.\n", "id": 110224, "time": "2007-11-04T10:22:32Z", "bug_id": 42038, "creation_time": "2007-11-04T10:22:32Z", "is_private": false, "attachment_id": null}]
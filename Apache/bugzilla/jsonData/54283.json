[{"count": 0, "tags": [], "bug_id": 54283, "text": "Created attachment 29746\nScreenshot from profiler, showing large number of calls when opening spreadsheet\n\nI'm seeing very slow load times for XSSF spreadsheets. One example spreadsheet takes several minutes to open, whereas the same spreadsheet same as an xls/HSSF opens in a fraction of a second.\n\nThis is about the same spreadsheets mentioned in bug 54282, but this one looks harder to fix.\n\nAttached is a screenshot from a profiler session that highlights the problem. Basically, when opening a single spreadsheet that contains two sheets, there is behaviour that looks like it's O(N^3) with respects to the number of columns in the spreadsheet. The sequence is roughly as follows:\n\n- 1 call to XSSFWorkbook.onDocumentRead()\n- 2 calls to XSSFSheet.onDocumentRead()\n<...>\n- 2 calls to ColumnHelper.cleanColumns()\n- 5,317 calls to ColumnHelper.addCleanColIntoCols()\n- 5,317 calls to ColumnHelper.sortColumns()\n- 7,812,463 calls to Xobj.find_element_user() \n- 8,243,994,339 calls to Xobj.isElem() and QName.equals().\n\nThere's a similar bottleneck that goes like this:\n\n- 1 call to XSSFWorkbook.onDocumentRead()\n- 2 calls to XSSFSheet.onDocumentRead()\n- 2 calls to ColumnHelper.cleanColumns()\n- 5,317 calls to ColumnHelper.addCleanColIntoCols()\n- 7,807,146 calls to ColumHelper.getColArray()\n- 8,243,994,339 calls to Xobj.isElem() and QName.equals().\n\nI realise that this code bottoms out in in XMLBeans so maybe this is partly an issue there. I did find this bug report on XMLBeans which sounds relevant, but it's been open for a couple of years: https://issues.apache.org/jira/browse/XMLBEANS-438\n\nStill, I wonder if there's something that could be done in the POI code to avoid hitting the XMLBeans data structures so hard. As it is, it unfortunately renders the API unusable for certain spreadsheets.", "id": 164036, "time": "2012-12-12T11:08:51Z", "creator": "jan.stette@gmail.com", "creation_time": "2012-12-12T11:08:51Z", "is_private": false, "attachment_id": 29746}, {"attachment_id": null, "tags": [], "creator": "vladk.dev@gmail.com", "text": "rolled back to version 3.9-dev that was changed accidentally", "count": 1, "id": 169925, "time": "2013-09-05T12:14:19Z", "bug_id": 54283, "creation_time": "2013-09-05T12:14:19Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 54283, "attachment_id": null, "text": "Any chance you could attach a spreadsheet that is taking a long time to load for you?", "id": 177473, "time": "2014-08-31T19:07:46Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2014-08-31T19:07:46Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "dominik.stadler@gmx.at", "text": "There have been some performance-fixes regarding XMLBeans lists, likely this also made the case described here run faster.\n\nAlso no response for a long time, therefore I am closing this as WORKSFORME for now, please reopen if you can attach a sample file which shows the problem.", "count": 3, "id": 184981, "time": "2015-09-05T14:59:42Z", "bug_id": 54283, "creation_time": "2015-09-05T14:59:42Z", "is_private": false}]
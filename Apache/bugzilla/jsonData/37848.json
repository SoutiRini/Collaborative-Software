[{"count": 0, "tags": [], "bug_id": 37848, "attachment_id": null, "text": "bin/catalina.sh issues some informational output to \"stdout\" when executed. If\nTomcat is being started by a Unix init script (ie. as part of the boot process),\nthen this output disrupts the boot messages. It would be useful if this output\nwas only issued when Tomcat is being started from the command line.\n\nA simple patch is included below:\n\n-----patch file-----------------------------------------------------------------\n--- catalina.sh 2005-12-09 10:22:44.000000000 +1100\n+++ catalina.sh 2005-12-09 10:24:30.000000000 +1100\n@@ -131,6 +131,11 @@\n   CATALINA_TMPDIR=\"$CATALINA_BASE\"/temp\n fi\n\n+have_tty=0\n+if [ \"`tty`\" != \"not a tty\" ]; then\n+    have_tty=1\n+fi\n+\n # For Cygwin, switch paths to Windows format before running java\n if $cygwin; then\n   JAVA_HOME=`cygpath --absolute --windows \"$JAVA_HOME\"`\n@@ -150,13 +155,15 @@\n\n # ----- Execute The Requested Command -------------------------------\n\n\n-echo \"Using CATALINA_BASE:   $CATALINA_BASE\"\n-echo \"Using CATALINA_HOME:   $CATALINA_HOME\"\n-echo \"Using CATALINA_TMPDIR: $CATALINA_TMPDIR\"\n-if [ \"$1\" = \"debug\" -o \"$1\" = \"javac\" ] ; then\n-  echo \"Using JAVA_HOME:       $JAVA_HOME\"\n-else\n-  echo \"Using JRE_HOME:       $JRE_HOME\"\n+if [ $have_tty -eq 1 ]; then\n+  echo \"Using CATALINA_BASE:   $CATALINA_BASE\"\n+  echo \"Using CATALINA_HOME:   $CATALINA_HOME\"\n+  echo \"Using CATALINA_TMPDIR: $CATALINA_TMPDIR\"\n+  if [ \"$1\" = \"debug\" -o \"$1\" = \"javac\" ] ; then\n+    echo \"Using JAVA_HOME:       $JAVA_HOME\"\n+  else\n+    echo \"Using JRE_HOME:       $JRE_HOME\"\n+  fi\n fi\n\n if [ \"$1\" = \"jpda\" ] ; then", "id": 83464, "time": "2005-12-09T00:32:04Z", "creator": "dshaw@avaya.com", "creation_time": "2005-12-09T00:32:04Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 37848, "text": "Good idea, applied.", "id": 88073, "time": "2006-04-14T15:24:41Z", "creator": "yoavs@computer.org", "creation_time": "2006-04-14T15:24:41Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "eric@freesa.org", "attachment_id": null, "id": 130753, "time": "2009-09-30T00:48:42Z", "bug_id": 37848, "creation_time": "2009-09-30T00:48:42Z", "is_private": false, "text": "Shouldn't the \"Using Security Manager\" messages be similarly guarded?\n\n\ndiff -Naur original/apache-tomcat-6.0.20/bin/catalina.sh bug37848/apache-tomcat-6.0.20/bin/catalina.sh\n--- original/apache-tomcat-6.0.20/bin/catalina.sh\t2009-05-14 01:15:04.000000000 +0200\n+++ bug37848/apache-tomcat-6.0.20/bin/catalina.sh\t2009-09-30 09:33:54.000000000 +0200\n@@ -241,7 +241,9 @@\n   else\n     shift\n     if [ \"$1\" = \"-security\" ] ; then\n-      echo \"Using Security Manager\"\n+      if [ $have_tty -eq 1 ]; then\n+        echo \"Using Security Manager\"\n+      fi\n       shift\n       exec \"$_RUNJDB\" \"$LOGGING_CONFIG\" $JAVA_OPTS $CATALINA_OPTS \\\n         -Djava.endorsed.dirs=\"$JAVA_ENDORSED_DIRS\" -classpath \"$CLASSPATH\" \\\n@@ -267,7 +269,9 @@\n \n   shift\n   if [ \"$1\" = \"-security\" ] ; then\n-    echo \"Using Security Manager\"\n+    if [ $have_tty -eq 1 ]; then\n+      echo \"Using Security Manager\"\n+    fi\n     shift\n     exec \"$_RUNJAVA\" \"$LOGGING_CONFIG\" $JAVA_OPTS $CATALINA_OPTS \\\n       -Djava.endorsed.dirs=\"$JAVA_ENDORSED_DIRS\" -classpath \"$CLASSPATH\" \\\n@@ -291,7 +295,9 @@\n   shift\n   touch \"$CATALINA_BASE\"/logs/catalina.out\n   if [ \"$1\" = \"-security\" ] ; then\n-    echo \"Using Security Manager\"\n+    if [ $have_tty -eq 1 ]; then\n+      echo \"Using Security Manager\"\n+    fi\n     shift\n     \"$_RUNJAVA\" \"$LOGGING_CONFIG\" $JAVA_OPTS $CATALINA_OPTS \\\n       -Djava.endorsed.dirs=\"$JAVA_ENDORSED_DIRS\" -classpath \"$CLASSPATH\" \\"}, {"count": 3, "tags": [], "bug_id": 37848, "attachment_id": null, "text": "Thanks for the patch\n\nThis has been applied to trunk and proposed for 6.0.x and 5.5.x", "id": 131281, "time": "2009-10-21T14:42:23Z", "creator": "markt@apache.org", "creation_time": "2009-10-21T14:42:23Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 37848, "text": "The patch has been applied to 5.5.x and will be included in 5.5.29 onwards. It\nhas also been applied to 6.0.x and will be in 6.0.21 onwards.", "id": 132499, "time": "2009-11-30T16:34:04Z", "creator": "markt@apache.org", "creation_time": "2009-11-30T16:34:04Z", "is_private": false, "attachment_id": null}]
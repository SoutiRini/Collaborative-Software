[{"count": 0, "tags": [], "creator": "randynichols@yahoo.com", "attachment_id": null, "text": "There appears to be a bug in the include directive when the included code is \nan \"if\" block with a trailing \"else\" that has no statement or block following.  \nIt is assumed that the following \"else\" block is in \"including\" code.\n\nI have inserted sample code below.  There are two files \"test.jsp\" \nand \"incl_test.jsp\".  The first file includes the second with an include \ndirective.  The \"if\" statement should execute only one of the two alternatives; \nhowever, it appears to execute both, as if the \"else\" keyword is completely \nignored.\n\nPlease let me know if you need further information:\n\n-Randy Nichols\nrandynichols@yahoo.com\n\n\ncontents of file \"incl_test.jsp\" below:\n\n<%\nif (str.equals(\"hello\"))\n{\n    out.println(\"helloblock \" + str);\n}\nelse  // is this being ignored?\n\n%>\n\n\n\ncontents of file \"test.jsp\" below:\n\n\n<%@ page\tlanguage=\"java\"%>\n\n<html>\n<head>\n<title>test</title>\n\n</HEAD>\n\n<body>\n<pre>\nThis page should print out a single line as follows:\n\nhelloblock hello\n\nIf instead it prints out two lines as follows:\n\nhelloblock hello\n\nnon-helloblock hello\n\nthen I believe there is a Tomcat 4 bug in the include directive, where\nit is ignoring the \"else\" after an \"if\" block in the include file.\n\nTest printout below\n\n\n<%\nString str = \"hello\";\n%>\n<%@ include file=\"incl_test.jsp\"%>\n<%\n{\n  // this should be the else block after the include file.\n  out.println(\"non-helloblock \" + str);\n}\n\n%>\n</pre>\n</body>\n</html>\n\n%>", "id": 31883, "time": "2003-02-25T00:47:59Z", "bug_id": 17351, "creation_time": "2003-02-25T00:47:59Z", "is_private": false}, {"count": 1, "tags": [], "creator": "kin-man.chung@sun.com", "attachment_id": null, "id": 31887, "time": "2003-02-25T01:14:06Z", "bug_id": 17351, "creation_time": "2003-02-25T01:14:06Z", "is_private": false, "text": "Ah, you forgot that there is a line feed character after the include directive,\nso the dangling \"else\" got that instead!\n\nPlaying trick like this never work, and you'll need to know exactly what you are\ndoing.  In general, it will not be safe to include a scriptlet that is not a\ncomplete Java statement.\n"}, {"count": 2, "tags": [], "creator": "randynichols@yahoo.com", "attachment_id": null, "id": 31929, "time": "2003-02-25T18:37:17Z", "bug_id": 17351, "creation_time": "2003-02-25T18:37:17Z", "is_private": false, "text": "I don't follow your assessment.\n\nCarriage returns do not terminate Java statements, so\neither a syntax error should be generated, or the\nstatement should work the same as if it were pasted\ndirectly in the text.\n\nI have never seen any documentation that says \"<%@\ninclude ... %> statements must be complete statements.\n If that is true, it should be clearly documented.\n\nI see no reason that \"<%@ include ... %> statements\nshould not simply flow text into the host document,\nbut if there are such restrictions, they should be\nclearly specified.\n\nI would like to keep this issue open to get more\nclarification on the limitations of the \"<%@ include\n... %> statements.\n\n"}, {"count": 3, "tags": [], "creator": "kin-man.chung@sun.com", "attachment_id": null, "id": 31933, "time": "2003-02-25T19:42:55Z", "bug_id": 17351, "creation_time": "2003-02-25T19:42:55Z", "is_private": false, "text": "A line feed in the JSP page got translated into a\n\n\tout.print(\"\\n\");\n\t\nwhich is then consumed by \"else\".\n\nThis part of the spec is defined by the transformation rule: the rules for\ntraslation of a JSP page into Java source is defined in the spec, the rest is\ndetermined by Java language rules.\n\nThe spec does not prevent you from having a dangling else, but it is not\nrecommanded, because the result is usually not what a casual user expects.  Like\nI said, you'll have to know what you are doing.\n\n"}]
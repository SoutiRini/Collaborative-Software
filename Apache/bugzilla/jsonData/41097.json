[{"count": 0, "tags": [], "bug_id": 41097, "attachment_id": null, "is_private": false, "id": 96466, "time": "2006-12-01T16:21:50Z", "creator": "apache-issues@harkless.org", "creation_time": "2006-12-01T16:21:50Z", "text": "It's not documented that mod_proxy_http (starting in httpd 2.0.15) adds\nX-Forwarded-For, X-Forwarded-Host, and X-Forwarded-Server HTTP headers.  These\nare very useful to know about so that if you utilize a reverse proxy you'll know\nhow to modify the LogFormat on your destination webserver to log actual client\nIPs rather than just the IP address of the proxy.  (And so you'll know that with\nrecent versions of httpd, you don't need to install the third-party\nmod_proxy_add_forward module, as much advice online says to do.)\n\nIn the documentation it would be good to note that if traffic has an existing\nX-Forwarded-For: header, it will be overwritten by the Apache reverse proxy with\nits IP, rather than appending its IP to the value of that header as some other\nproxies do.\n\nYou might even give the configuration code from\nhttp://groups.google.com/group/alt.apache.configuration/msg/6f0ecadabc20623f as\nan example of how to always log the client IP in the first field, regardless of\nwhether the particular connection went through the reverse proxy.  If you do\nthat, though, you should probably add a note that malicious parties not going\nthrough the reverse proxy could hide their IP addresses from the logs by adding\ntheir own X-Forwarded-For headers, so for security it's better to log *both* the\n value of %h and %{X-Forwarded-For}i."}, {"count": 1, "tags": [], "text": "IME Apache 2.2.0 used as a reverse proxy *does* append to an existing\nX-Forwarded-For header.\n\nWhen I access a private server at work from my home machine, I connect via a\nforward proxy (Squid 2.6) on my home machine, an authenticating reverse proxy\n(Apache 2.2.0) on the remote firewall, and a reverse proxy (Apache 2.2.0) on the\nremote DMZ machine.  The server (running under Tomcat 5.5) has a facility for\nreporting the headers in the request it receives, and the X-Forwarded-For:\nheader contains the private IP address of my home machine (added by Squid), the\npublic IP address of my home machine (added by the firewall Apache), and the DMZ\nIP address of the remote firewall (added by the DMZ Apache).  As I would expect.", "is_private": false, "id": 97136, "creation_time": "2006-12-20T14:15:04Z", "time": "2006-12-20T14:15:04Z", "creator": "Dave.Sparks@dandasparks.org.uk", "bug_id": 41097, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 41097, "is_private": false, "id": 106116, "attachment_id": null, "creator": "slive@apache.org", "creation_time": "2007-07-31T13:10:33Z", "time": "2007-07-31T13:10:33Z", "text": "These headers are now somewhat documented on trunk. Thanks."}]
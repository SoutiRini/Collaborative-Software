[{"count": 0, "tags": [], "text": "I'm running gentoo linux, kernel 2.6.30.\n\nThis may be related to bug 37469 and bug 37470, but I'm running mod_jk 1.2.28 (apache 2.2.11) which is supposed to have the fix for that and I still seem to have a related symptom: a two-second delay on a cgi script when tomcat isn't going to handle it.  Static files are fine, it's just cgi scripts that seem to be affected.  \n\nThe symptoms are much like the previously mentioned bugs.  If I hit a tomcat-handled uri first, then subsequent requests to any (simple) cgi-script (perl, ruby, etc) which don't use mod_jk takes exactly two seconds seemingly waiting for mod_jk to finish its pre-processing.  If I turn off mod_jk, the cgi script runs in milliseconds.  If I don't hit the tomcat-handled uri first, the cgi-script is also run in milliseconds.\n\nI ran an strace on the fork of apache that was doing this; I've marked the place where the 2-second delay happened with \"======>\":\n\n<... epoll_wait resumed> {{EPOLLHUP, {u32=136451400, u64=136451400}}}, 2, 300000) = 1 <0.000745>\nread(19, \"\"..., 8000)                   = 0 <0.000005>\nread(21, 0xbfc7c420, 1)                 = -1 EAGAIN (Resource temporarily unavailable) <0.000006>\npoll([{fd=21, events=POLLIN}], 1, 300000) = 1 ([{fd=21, revents=POLLHUP}]) <0.000012>\nread(21, \"\"..., 1)                      = 0 <0.000005>\nclose(21)                               = 0 <0.000009>\nread(14, 0x8222188, 8000)               = -1 EAGAIN (Resource temporarily unavailable) <0.000006>\nwrite(9, \"10.49.220.36 - - [10/Nov/2009:10:\"..., 71) = 71 <0.000024>\nclose(16)                               = 0 <0.000007>\nclose(17)                               = 0 <0.000008>\nclose(19)                               = 0 <0.000007>\nwaitpid(9331, 0xbfc825f0, WNOHANG|WSTOPPED) = 0 <0.000006>\nkill(9331, SIGTERM)                     = -1 EPERM (Operation not permitted) <0.000006>\nkill(9331, SIGKILL)                     = -1 EPERM (Operation not permitted) <0.000005>\nwaitpid(9331, [{WIFEXITED(s) && WEXITSTATUS(s) == 0}], WSTOPPED) = 9331 <0.000021>\n--- SIGCHLD (Child exited) @ 0 (0) ---\npoll([{fd=14, events=POLLIN}], 1, 15000) = 1 ([{fd=14, revents=POLLIN}]) <0.008233>\nread(14, \"GET /styles/screen.css HTTP/1.1\\r\\n\"..., 8000) = 659 <0.000007>\ngettimeofday({1257875417, 523164}, NULL) = 0 <0.000005>\nstat64(\"/var/lib/tomcat-*/webapps//styles\", 0xbfc824b0) = -1 ENOENT (No such file or directory) <0.000009>\nstat64(\"/home/troy/public_html/styles/screen.css\", {st_mode=S_IFREG|0644, st_size=2400, ...}) = 0 <0.000010>\nopen(\"/home/troy/public_html/.htaccess\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = -1 ENOENT (No such file or directory) <0.000009>\nopen(\"/home/troy/public_html/styles/.htaccess\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = -1 ENOENT (No such file or directory) <0.000008>\nopen(\"/home/troy/public_html/styles/screen.css/.htaccess\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = -1 ENOTDIR (Not a directory) <0.000008>\nopen(\"/home/troy/public_html/styles/screen.css\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = 16 <0.000010>\nfcntl64(16, F_GETFD)                    = 0x1 (flags FD_CLOEXEC) <0.000005>\nfcntl64(16, F_SETFD, FD_CLOEXEC)        = 0 <0.000005>\nclose(16)                               = 0 <0.000006>\nwritev(14, [{\"HTTP/1.1 304 Not Modified\\r\\nDate: \"..., 172}], 1) = 172 <0.000018>\nread(14, 0x821c170, 8000)               = -1 EAGAIN (Resource temporarily unavailable) <0.000006>\nwrite(9, \"10.49.220.36 - - [10/Nov/2009:10:\"..., 86) = 86 <0.000012>\npoll([{fd=14, events=POLLIN}], 1, 15000) = 1 ([{fd=14, revents=POLLIN}]) <3.503299>\nread(14, \"GET /styles/print.css HTTP/1.1\\r\\nH\"..., 8000) = 658 <0.000008>\ngettimeofday({1257875421, 27117}, NULL) = 0 <0.000005>\nstat64(\"/var/lib/tomcat-*/webapps//styles\", 0xbfc824b0) = -1 ENOENT (No such file or directory) <0.000011>\nstat64(\"/home/troy/public_html/styles/print.css\", {st_mode=S_IFREG|0644, st_size=2340, ...}) = 0 <0.000010>\nopen(\"/home/troy/public_html/.htaccess\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = -1 ENOENT (No such file or directory) <0.000010>\nopen(\"/home/troy/public_html/styles/.htaccess\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = -1 ENOENT (No such file or directory) <0.000008>\nopen(\"/home/troy/public_html/styles/print.css/.htaccess\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = -1 ENOTDIR (Not a directory) <0.000009>\nopen(\"/home/troy/public_html/styles/print.css\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = 16 <0.000010>\nfcntl64(16, F_GETFD)                    = 0x1 (flags FD_CLOEXEC) <0.000006>\nfcntl64(16, F_SETFD, FD_CLOEXEC)        = 0 <0.000005>\nclose(16)                               = 0 <0.000007>\nwritev(14, [{\"HTTP/1.1 304 Not Modified\\r\\nDate: \"..., 172}], 1) = 172 <0.000029>\nread(14, 0x8220180, 8000)               = -1 EAGAIN (Resource temporarily unavailable) <0.000007>\nwrite(9, \"10.49.220.36 - - [10/Nov/2009:10:\"..., 85) = 85 <0.000018>\npoll([{fd=14, events=POLLIN}], 1, 15000) = 1 ([{fd=14, revents=POLLIN}]) <3.844867>\nread(14, \"GET / HTTP/1.1\\r\\nHost: gargamel.so\"..., 8000) = 551 <0.000008>\ngettimeofday({1257875424, 872759}, NULL) = 0 <0.000004>\nstat64(\"/home/troy/public_html/\", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0 <0.000010>\nopen(\"/home/troy/public_html/.htaccess\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = -1 ENOENT (No such file or directory) <0.000010>\nstat64(\"/var/lib/tomcat-*/webapps//index.rb\", 0xbfc823b0) = -1 ENOENT (No such file or directory) <0.000009>\nstat64(\"/home/troy/public_html/index.rb\", {st_mode=S_IFREG|0755, st_size=5138, ...}) = 0 <0.000009>\nopen(\"/home/troy/public_html/index.rb\", O_RDONLY|O_LARGEFILE|O_CLOEXEC) = 16 <0.000014>\nfcntl64(16, F_GETFD)                    = 0x1 (flags FD_CLOEXEC) <0.000006>\nfcntl64(16, F_SETFD, FD_CLOEXEC)        = 0 <0.000005>\nread(16, \"#!/usr/bin/ruby\\n\\nrequire 'cgi'\\nre\"..., 4096) = 4096 <0.000008>\npipe([17, 18])                          = 0 <0.000009>\nfcntl64(18, F_GETFL)                    = 0x1 (flags O_WRONLY) <0.000005>\nfcntl64(18, F_SETFL, O_WRONLY|O_NONBLOCK) = 0 <0.000005>\nfcntl64(18, F_GETFD)                    = 0 <0.000006>\nfcntl64(18, F_SETFD, FD_CLOEXEC)        = 0 <0.000005>\npipe([19, 20])                          = 0 <0.000008>\nfcntl64(19, F_GETFL)                    = 0 (flags O_RDONLY) <0.000005>\nfcntl64(19, F_SETFL, O_RDONLY|O_NONBLOCK) = 0 <0.000005>\nfcntl64(19, F_GETFD)                    = 0 <0.000005>\nfcntl64(19, F_SETFD, FD_CLOEXEC)        = 0 <0.000005>\npipe([21, 22])                          = 0 <0.000007>\nfcntl64(21, F_GETFL)                    = 0 (flags O_RDONLY) <0.000006>\nfcntl64(21, F_SETFL, O_RDONLY|O_NONBLOCK) = 0 <0.000006>\nfcntl64(21, F_GETFD)                    = 0 <0.000006>\nfcntl64(21, F_SETFD, FD_CLOEXEC)        = 0 <0.000005>\nclone(Process 9334 attached\nchild_stack=0, flags=CLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, child_tidptr=0xb7c9b958) = 9334 <0.000256>\n[pid  4536] close(17)                   = 0 <0.000006>\n[pid  4536] close(20)                   = 0 <0.000005>\n[pid  4536] close(22)                   = 0 <0.000006>\n[pid  4536] close(18 <unfinished ...>\n[pid  9334] close(4)                    = 0 <0.000011>\n[pid  4536] <... close resumed> )       = 0 <0.000033>\n[pid  9334] close(3 <unfinished ...>\n[pid  4536] SYS_329(0x80000, 0x821c1a0, 0xb7e56ff4, 0x821a280, 0x82234d0 <unfinished ...>\n[pid  9334] <... close resumed> )       = 0 <0.000020>\n[pid  4536] <... SYS_329 resumed> )     = 17 <0.000017>\n[pid  9334] close(9 <unfinished ...>\n[pid  4536] epoll_ctl(17, EPOLL_CTL_ADD, 19, {EPOLLIN, {u32=136459600, u64=136459600}} <unfinished ...>\n[pid  9334] <... close resumed> )       = 0 <0.000024>\n[pid  4536] <... epoll_ctl resumed> )   = 0 <0.000017>\n[pid  9334] close(8 <unfinished ...>\n[pid  4536] epoll_ctl(17, EPOLL_CTL_ADD, 21, {EPOLLIN, {u32=136459632, u64=136459632}} <unfinished ...>\n[pid  9334] <... close resumed> )       = 0 <0.000024>\n[pid  4536] <... epoll_ctl resumed> )   = 0 <0.000019>\n[pid  9334] close(7)                    = 0 <0.000006>\n[pid  4536] epoll_wait(17,  <unfinished ...>\n[pid  9334] munmap(0xb802a000, 1024)    = 0 <0.000010>\n[pid  9334] close(11)                   = 0 <0.000005>\n[pid  9334] close(12)                   = 0 <0.000006>\n[pid  9334] unlink(\"/var/log/apache2/mod_jk.shm.4529.lock\") = -1 ENOENT (No such file or directory) <0.000011>\n[pid  9334] unlink(\"/var/log/apache2/mod_jk.shm.4529\") = -1 ENOENT (No such file or directory) <0.000008>\n[pid  9334] time(NULL)                  = 1257875424 <0.000006>\n[pid  9334] shutdown(15, 1 /* send */)  = 0 <0.000007>\n======> [pid  9334] select(16, [15], NULL, NULL, {2, 0}) = 0 (Timeout) <2.002357>\n[pid  9334] close(15)                   = 0 <0.000009>\n[pid  9334] close(6)                    = 0 <0.000007>\n[pid  9334] close(5)                    = 0 <0.000006>\n[pid  9334] close(13)                   = 0 <0.000006>\n[pid  9334] close(14)                   = 0 <0.000005>\n[pid  9334] close(21)                   = 0 <0.000006>\n[pid  9334] close(19)                   = 0 <0.000005>\n[pid  9334] close(18)                   = 0 <0.000007>\n[pid  9334] close(16)                   = 0 <0.000006>\n[pid  9334] dup2(17, 0)                 = 0 <0.000007>\n[pid  9334] close(17)                   = 0 <0.000006>\n[pid  9334] dup2(20, 1)                 = 1 <0.000005>\n[pid  9334] close(20)                   = 0 <0.000005>\n[pid  9334] dup2(22, 2)                 = 2 <0.000006>\n[pid  9334] close(22)                   = 0 <0.000005>\n[pid  9334] rt_sigaction(SIGCHLD, {SIG_DFL, [], SA_INTERRUPT}, {SIG_DFL, [], 0}, 8) = 0 <0.000006>\n[pid  9334] chdir(\"/home/troy/public_html/\") = 0 <0.000012>\n[pid  9334] execve(\"/usr/sbin/suexec\", [\"/usr/sbin/suexec\", \"10060\", \"100\", \"index.rb\"], [/* 28 vars */]) = 0 <0.000327>\n[pid  9334] brk(0)                      = 0x804d000 <0.000006>\n...rest of strace ran the ruby script quickly\n\n\nmod_jk.log (again marked with \"======>\" where the pause happens)\n\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] map_uri_to_worker_ext::jk_uri_worker_map.c (1036): Attempting to map URI '/' from 8 maps\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/soar*/*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/jmx-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/web-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/manager*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/status*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jnlp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jsp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/Soar*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] jk_translate::mod_jk.c (3450): check alias_dir: /var/lib/tomcat-*/webapps/\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] map_uri_to_worker_ext::jk_uri_worker_map.c (1036): Attempting to map URI '/' from 8 maps\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/soar*/*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/jmx-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/web-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/manager*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/status*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jnlp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jsp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/Soar*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] jk_map_to_storage::mod_jk.c (3603): no match for / found\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] jk_translate::mod_jk.c (3411): JkAutoAlias, no DirectoryIndex file for URI /index.rb\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] map_uri_to_worker_ext::jk_uri_worker_map.c (1036): Attempting to map URI '/index.rb' from 8 maps\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/soar*/*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/jmx-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/web-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/manager*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/status*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jnlp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jsp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/Soar*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:44.354 2009] [20377:3082942736] [debug] jk_map_to_storage::mod_jk.c (3603): no match for /index.rb found\n======>[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] map_uri_to_worker_ext::jk_uri_worker_map.c (1036): Attempting to map URI '/styles/print.css' from 8 maps\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/soar*/*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/jmx-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/web-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/manager*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/status*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jnlp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jsp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/Soar*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] jk_translate::mod_jk.c (3450): check alias_dir: /var/lib/tomcat-*/webapps/\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] jk_translate::mod_jk.c (3476): AutoAlias child_dir: print.css\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] map_uri_to_worker_ext::jk_uri_worker_map.c (1036): Attempting to map URI '/styles/print.css' from 8 maps\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/soar*/*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/jmx-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/web-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/manager*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/status*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jnlp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jsp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/Soar*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.433 2009] [20377:3082942736] [debug] jk_map_to_storage::mod_jk.c (3603): no match for /styles/print.css found\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] map_uri_to_worker_ext::jk_uri_worker_map.c (1036): Attempting to map URI '/styles/screen.css' from 8 maps\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/soar*/*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/jmx-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/web-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/manager*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/status*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jnlp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jsp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/Soar*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] jk_translate::mod_jk.c (3450): check alias_dir: /var/lib/tomcat-*/webapps/\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] jk_translate::mod_jk.c (3476): AutoAlias child_dir: screen.css\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] map_uri_to_worker_ext::jk_uri_worker_map.c (1036): Attempting to map URI '/styles/screen.css' from 8 maps\n[Tue Nov 10 15:01:46.434 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/soar*/*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.435 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/jmx-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.435 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/web-console*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.435 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/manager*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.435 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/status*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.435 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jnlp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.435 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/*.jsp=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.435 2009] [20377:3082942736] [debug] find_match::jk_uri_worker_map.c (850): Attempting to map context URI '/Soar*=loadbalancer' source 'JkMount'\n[Tue Nov 10 15:01:46.435 2009] [20377:3082942736] [debug] jk_map_to_storage::mod_jk.c (3603): no match for /styles/screen.css found", "attachment_id": null, "id": 131854, "creator": "troy@dublan.net", "time": "2009-11-10T14:13:45Z", "bug_id": 48169, "creation_time": "2009-11-10T14:13:45Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 48169, "attachment_id": null, "id": 131856, "time": "2009-11-10T16:10:35Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2009-11-10T16:10:35Z", "is_private": false, "text": "Which Linux do you exactly use?\n\nThe cgi process closes the existing backend connections after start (likely because of CLOEXEC). Since we set SO_LINGER this is done by trying to drain the connection in the tcp layer, which blocks.\n\nWe need to investigate a better way. I expect we don't set SO_LINGER to prevent the OS from blocking during forked cgi processes and try to handle lingering behaviour during normal worker process shutdown on our own.\n\nAdditional note: strace/truss also reveals, that the cgi process and also rotatelogs try to close the shm file and its lock. But that's not the cause of the hang here."}, {"count": 2, "tags": [], "bug_id": 48169, "text": "The linux distro is Gentoo.  Best distro for people who like to drive stick-shift. ;)\n\nThanks to your explanation, I changed the following and the delay indeed completely disappeared.  I'm going to use this patch for now on my servers, since I can't stand the 2-second delay.  Novice's suggestion: could the SO_LINGER option start as zero and then be modified once mod_jk knows that it is going to do real work?  :)\n\n--- tomcat-connectors-1.2.28-src/native/common/jk_connect.c.old      2009-11-11 16:49:57.089490502 -0700\n+++ tomcat-connectors-1.2.28-src/native/common/jk_connect.c  2009-11-11 16:46:57.583251504 -0700\n@@ -640,7 +640,7 @@\n #ifndef MAX_SECS_TO_LINGER\n #define MAX_SECS_TO_LINGER 30\n #endif\n-#define SECONDS_TO_LINGER  2\n+#define SECONDS_TO_LINGER  0\n \n #ifndef SHUT_WR\n #ifdef SD_SEND", "id": 131894, "time": "2009-11-11T16:24:45Z", "creator": "troy@dublan.net", "creation_time": "2009-11-11T16:24:45Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 48169, "text": "Can you check if the\nhttp://svn.apache.org/viewvc?rev=892725&view=rev\nfixes the issue?\n\nIt uses SOCK_CLOEXEC|FD_CLOEXEC so it should close all sockets on fork()", "id": 133000, "time": "2009-12-21T00:34:01Z", "creator": "mturk@apache.org", "creation_time": "2009-12-21T00:34:01Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 48169, "text": "(In reply to comment #3)\n> Can you check if the\n> http://svn.apache.org/viewvc?rev=892725&view=rev\n> fixes the issue?\n> \n> It uses SOCK_CLOEXEC|FD_CLOEXEC so it should close all sockets on fork()\n\nIndeed it does.  Nice and speedy, no delay.  Thanks so much for fixing it!  When's the next release?  :)", "id": 133398, "time": "2010-01-06T16:51:04Z", "creator": "troy@dublan.net", "creation_time": "2010-01-06T16:51:04Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 134806, "time": "2010-02-23T02:54:09Z", "bug_id": 48169, "creation_time": "2010-02-23T02:54:09Z", "is_private": false, "text": "Will be part of 1.2.29."}]
[{"count": 0, "tags": [], "bug_id": 37194, "attachment_id": null, "id": 81505, "time": "2005-10-21T10:49:51Z", "creator": "KlausRusch@atmedia.net", "creation_time": "2005-10-21T10:49:51Z", "is_private": false, "text": "The X-Forwarded-For input header is modified for proxied requests, for example\nwhen using\n\nLogFormat \"%{x-forwarded-for}i %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\"\n\\\"%{User-Agent}i\\\" \\\"%{Cookie}i\\\"\" forward-log\n\nthe server logs record the request X-Forwarded-For header plus the remote address:\n\n        /* Add X-Forwarded-For: so that the upstream has a chance to\n         * determine, where the original request came from.\n         */\n        apr_table_mergen(r->headers_in, \"X-Forwarded-For\",\n                       r->connection->remote_ip);\n\n(the same is true for the other X-Forwarded-* headers).\n\nInput headers should be logged unmodified.\n\n\nmanageNow"}, {"count": 1, "attachment_id": null, "bug_id": 37194, "is_private": false, "id": 107877, "time": "2007-09-08T15:28:17Z", "creator": "nick@webthing.com", "creation_time": "2007-09-08T15:28:17Z", "tags": [], "text": "RFC2616 has different rules for different classes of header, but is silent on\nX-Forwarded-For.  Is there an RFC that tells us what to do?"}, {"count": 2, "tags": [], "creator": "KlausRusch@atmedia.net", "text": "\nX-Forwarded-For is a de-facto standard, not a formally specified header.\n\nThe problem is not with how the header is used though, but with how it is\nlogged. When logging an INPUT header, any processing done by the Webserver\nshould not be reflected in the logged value.\n", "id": 107883, "time": "2007-09-08T17:23:06Z", "bug_id": 37194, "creation_time": "2007-09-08T17:23:06Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "RFC2616 calls out that all headers can be merged and split as tokens.  Cookie\nheaders pre-RFC are a special exception.\n\nKJR is wrong with respect to the intermediaries, they may register their\npresence as all intermediary proxies can.  Just do so in the right order.\nBut it would be nice to be able to stow the client address in another field\nother than X-FF, such as X-Client-IP as most firewalls are capable of.", "is_private": false, "id": 130668, "creator": "wrowe@apache.org", "time": "2009-09-24T22:35:19Z", "bug_id": 37194, "creation_time": "2009-09-24T22:35:19Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 37194, "attachment_id": null, "text": "Reading this a third time through, the behavior KJR describes is correct\nby design of the implementors of the X-FF header.  Closed.", "id": 130669, "time": "2009-09-24T22:37:40Z", "creator": "wrowe@apache.org", "creation_time": "2009-09-24T22:37:40Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 37194, "is_private": false, "text": "Will, I agree that Apache may (and should) add the remote address to the X-Forwarded-For header when proxying the request to another server, that behavior is working as designed.\n\nWhat's incorrect though is logging the MODIFIED X-Forwarded-For header for %{x-forwarded-for}i since the input header did not contain the remote address of the current request.", "id": 130671, "time": "2009-09-25T00:40:30Z", "creator": "KlausRusch@atmedia.net", "creation_time": "2009-09-25T00:40:30Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "I agree that the modifed x-forwarded-for shouldn't be added to the log file. Any news around this bug? We have the same bug in apache 2.2.17.\n\n/Peter", "attachment_id": null, "id": 145809, "creator": "peter.hans.nilsson@volvo.com", "time": "2011-04-15T08:15:13Z", "bug_id": 37194, "creation_time": "2011-04-15T08:15:13Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "covener@gmail.com", "text": "mod_log_config doc already says that %{foo}i reflects modifications by modules, so this is working as designed.", "count": 7, "id": 145810, "time": "2011-04-15T08:20:17Z", "bug_id": 37194, "creation_time": "2011-04-15T08:20:17Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 37194, "is_private": false, "text": "I'm going to reclass this as a documentation bug, since we should illustrate\ncapturing and logging an input header with mod_headers/env or similar and\nprovide a pointer to this workaround in the %{foo}i documentation.", "id": 145815, "time": "2011-04-15T12:35:52Z", "creator": "wrowe@apache.org", "creation_time": "2011-04-15T12:35:52Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 37194, "attachment_id": null, "id": 155395, "time": "2012-03-30T13:14:26Z", "creator": "covener@gmail.com", "creation_time": "2012-03-30T13:14:26Z", "is_private": false, "text": "I added a pointer to using setenvif to save an \"early\" but not necessarily initial value of an input header into mod_log_config back through 2.2"}]
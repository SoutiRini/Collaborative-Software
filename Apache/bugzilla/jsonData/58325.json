[{"count": 0, "tags": [], "bug_id": 58325, "text": "I am trying to find out the position (sheet, row, column) of each embedded file in my workbook.\n\nI am testing my code with two different files both created and handled exclusively using Excel 2010:\n1) lt.xlsx : only one embedded file in a single sheet\n2) db.xlsx : three embedded files in a single sheet\n\nCode:\n\tpublic static void bugcheck(String path) throws EncryptedDocumentException, InvalidFormatException, FileNotFoundException, IOException{\n\t\tWorkbook wbook = WorkbookFactory.create(new FileInputStream(path));\n\t\tif (wbook instanceof XSSFWorkbook ) {\n\t\t\t//test each sheet\n\t\t\tfor (int n = 0; n < wbook.getNumberOfSheets(); n++){\n\t\t\t\tXSSFSheet sheet = ((XSSFWorkbook)wbook).getSheetAt(n);\n\t\t\t\tSystem.out.print(\"sheet \" + sheet.getSheetName() + \" - \");\n\t\t\t\tXSSFDrawing drawing = ((XSSFSheet)sheet).getDrawingPatriarch();\n\t\t\t\t//drawing = ((XSSFSheet)sheet).createDrawingPatriarch();\n\n\t\t\t\tList<XSSFShape> shapes = drawing.getShapes();\n\t\t\t\tSystem.out.println(\"drawing.getShapes().size() = \" + drawing.getShapes().size());\n\t\t\t\tIterator<XSSFShape> it = shapes.iterator();\n\t\t\t\twhile(it.hasNext()) {           \n\t\t\t\t\tXSSFShape shape = it.next();\n\t\t\t\t\tSystem.out.println(\"Col1:\"+((XSSFClientAnchor)shape.getAnchor()).getCol1());\n\t\t\t\t\tSystem.out.println(\"Col2:\"+((XSSFClientAnchor)shape.getAnchor()).getCol2());\n\t\t\t\t\tSystem.out.println(\"Row1:\"+((XSSFClientAnchor)shape.getAnchor()).getRow1());\n\t\t\t\t\tSystem.out.println(\"Row2:\"+((XSSFClientAnchor)shape.getAnchor()).getRow2());\n\n\t\t\t\t} \n\t\t\t}\n\t\t}\n\t}\n\n\nCode returns the following:\nTesting: lt.xlsx\nsheet MetasNM001 - drawing.getShapes().size() = 1\nCol1:1\nCol2:1\nRow1:2\nRow2:2\n\nTesting: db.xlsx\nsheet MetasNM001 - drawing.getShapes().size() = 0\nsheet Plan1 - drawing.getShapes().size() = 0\n\n\nThe tested files are attached to this bug submission", "id": 184934, "time": "2015-09-03T13:29:35Z", "creator": "leotamura@gmail.com", "creation_time": "2015-09-03T13:29:35Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 58325, "text": "The attachments can be found at: https://dl.dropboxusercontent.com/u/24010836/excel%20files.zip", "count": 1, "id": 184935, "time": "2015-09-03T13:33:40Z", "creator": "leotamura@gmail.com", "creation_time": "2015-09-03T13:33:40Z", "is_private": false}, {"count": 2, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 187324, "time": "2016-01-02T21:14:14Z", "bug_id": 58325, "creation_time": "2016-01-02T21:14:14Z", "is_private": false, "text": "Some initial analysis:\n* Usually shapes are stored in elements of <xdr:twoCellAnchor editAs=\"oneCell\">\n* The provided document with multiple shapes uses some VML/DrawingML compatibility structure via an \"AlternateContent\" structure:\n<mc:AlternateContent xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\">\n    <mc:Choice Requires=\"a14\" xmlns:a14=\"http://schemas.microsoft.com/office/drawing/2010/main\">\n      <xdr:twoCellAnchor editAs=\"oneCell\">\n\nSo in order to support these types of documents, we would need to add support for the alternate content section, however the version of the XML Schema that we use does not seem to have these. See also the spec at 2.17.4 \"Roundtripping Alternate Content\" in the spec \"WordprocessingML Reference Material\" for some related description.\n\nI have added a disabled unit test in r1722665 which can be used as reproducer."}, {"count": 3, "tags": [], "creator": "fanningpj@yahoo.com", "attachment_id": null, "is_private": false, "id": 199052, "time": "2017-06-04T16:34:43Z", "bug_id": 58325, "creation_time": "2017-06-04T16:34:43Z", "text": "The tests in TestUnfixedBugs.java for this test case are passing now."}, {"attachment_id": null, "tags": [], "bug_id": 58325, "text": "https://github.com/apache/poi/pull/57 enables the tests", "count": 4, "id": 199053, "time": "2017-06-04T16:51:18Z", "creator": "fanningpj@yahoo.com", "creation_time": "2017-06-04T16:51:18Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 58325, "text": "This appears to have been fixed.\nMoved disabled unit tests into production in r1797600 and r1797602.\n\nThanks for the help!", "count": 5, "id": 199055, "time": "2017-06-04T19:03:09Z", "creator": "onealj@apache.org", "creation_time": "2017-06-04T19:03:09Z", "is_private": false}]
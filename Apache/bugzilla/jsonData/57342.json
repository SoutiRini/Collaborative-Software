[{"count": 0, "tags": [], "bug_id": 57342, "is_private": false, "text": "Created attachment 32284\nAttached! source\n\nHi,\nAfter 7 lakh records file are getting corroupted,when i am writing 1 million recors with 60 columns its working fine but when i am writing 7.5 lakh records with 100 columns file are getting corrupted.\n\nI have attached snipnet of code . Kindly suggest i if doing something wrong\n\npackage com.rati.Dec;\n\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\n\nimport org.apache.poi.ss.usermodel.Cell;\nimport org.apache.poi.ss.usermodel.Row;\nimport org.apache.poi.xssf.streaming.SXSSFSheet;\nimport org.apache.poi.xssf.streaming.SXSSFWorkbook;\n\npublic class MillionTest1 {\n\n\tpublic static void main(String[] args) {\n\t\t// TODO Auto-generated method stub\n\t\tSXSSFWorkbook workbook = new SXSSFWorkbook(100);\n\t\tworkbook.setCompressTempFiles(true);\n\t\tSXSSFSheet sheet = null;\n\t\tRow row = null;\n\t\tCell cell = null;\n\t\tsheet = (SXSSFSheet) workbook.createSheet(\"Test\");\n\t\tFileOutputStream fileOut = null;\n\t\ttry {\n\t\t\tSystem.out.println(\"Started!\");\n\t\t\tfor (int i = 0; i < 777384; i++) {\n\t\t\t\trow = sheet.createRow(i);\n\t\t\t\tfor (int j = 0; j < 100; j++) {\n\t\t\t\t\tcell = row.createCell(j);\n\t\t\t\t\tcell.setCellValue(\"Rati : row : \"+i +\" Col: \"+ j);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfileOut = new FileOutputStream(\n\t\t\t\t\tnew File(\"Z:\\\\output\\\\Version\\\\Version11.xlsx\"));\n\t\t\tworkbook.write(fileOut);\n\n\t\t} catch (Exception exception) {\n\t\t\texception.printStackTrace();\n\t\t} finally {\n\t\t\tworkbook.dispose();\n\t\t\ttry {\n\t\t\t\tfileOut.flush();\n\t\t\t\tfileOut.close();\n\t\t\t} catch (IOException e) {\n\t\t\t\t// TODO Auto-generated catch block\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"Completed!\");\n\t\t}\n\t}\n\n}", "id": 179717, "time": "2014-12-11T19:55:11Z", "creator": "pal.ratikanta@gmail.com", "creation_time": "2014-12-11T19:55:11Z", "attachment_id": 32284}, {"count": 1, "tags": [], "bug_id": 57342, "attachment_id": null, "is_private": false, "id": 179718, "time": "2014-12-11T20:21:16Z", "creator": "apache@gagravarr.org", "creation_time": "2014-12-11T20:21:16Z", "text": "How is the file getting corrupt?\n\nHow do the files differ between 3.9 and 3.10?\n\nDid you try with 3.11 beta 3?\n\nDid you try generating a simple file with the same number of rows+columns using SSPerformanceTest (see http://poi.apache.org/faq.html#faq-N10109)? Did that file work fine when generated at the same row+column size?"}, {"count": 2, "tags": [], "bug_id": 57342, "attachment_id": null, "is_private": false, "id": 179721, "time": "2014-12-11T20:30:48Z", "creator": "pal.ratikanta@gmail.com", "creation_time": "2014-12-11T20:30:48Z", "text": "sir.i have tried all version and compatible dependency jars.still file is getting corrupted.\n\nu can also try running this or attached code!\n\n:("}, {"count": 3, "tags": [], "bug_id": 57342, "attachment_id": null, "id": 179753, "time": "2014-12-14T10:12:05Z", "creator": "pal.ratikanta@gmail.com", "creation_time": "2014-12-14T10:12:05Z", "is_private": false, "text": "(In reply to Nick Burch from comment #1)\n> How is the file getting corrupt?\n> \n> How do the files differ between 3.9 and 3.10?\n> \n> Did you try with 3.11 beta 3?\n> \n> Did you try generating a simple file with the same number of rows+columns\n> using SSPerformanceTest (see http://poi.apache.org/faq.html#faq-N10109)? Did\n> that file work fine when generated at the same row+column size?\n\nNo Sir,\ni have tried using SSPerformanceTest \n\nargs = new String[4];\nargs[0] = \"SXSSF\";\nargs[1] = \"1000000\";->Rows\nargs[2] = \"100\";--->Cols\nargs[3] = \"1\";\n\n\nbut still file is getting corrupt."}, {"count": 4, "tags": [], "creator": "gretchen@dougandgretchen.com", "attachment_id": null, "id": 179832, "time": "2014-12-18T02:17:02Z", "bug_id": 57342, "creation_time": "2014-12-18T02:17:02Z", "is_private": false, "text": "We are also using 3.9 and experiencing the same corruption. Ran the performance test with the same results as reporting user."}, {"count": 5, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 180145, "time": "2015-01-04T23:35:04Z", "bug_id": 57342, "creation_time": "2015-01-04T23:35:04Z", "is_private": false, "text": "I think this the problem may happen around the 2G/4G size border, so it may be related to the trouble in some JDK versions with handling zip-files larger than 2G/4G, can you state which exact Java version you are using?"}, {"count": 6, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 180146, "time": "2015-01-04T23:38:43Z", "bug_id": 57342, "creation_time": "2015-01-04T23:38:43Z", "is_private": false, "text": "I tried to look up details of support of large zip files in Java, but the bug-database is not very definite about what is supported.\n\nHowever https://en.wikipedia.org/wiki/Zip_(file_format)#ZIP64 states that only Java 7 fully supports files larger than 4G, can you try running your test with the latest patchlevel of this version to verify this?"}, {"count": 7, "tags": [], "bug_id": 57342, "is_private": false, "text": "I tried with java version \"1.6.0_26\" and could not reproduce the problem there.", "id": 180149, "time": "2015-01-05T07:58:36Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-01-05T07:58:36Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 57342, "attachment_id": 32355, "text": "Created attachment 32355\nError Shown from Excel\n\nError and compiler version", "id": 180223, "time": "2015-01-08T07:17:08Z", "creator": "pal.ratikanta@gmail.com", "creation_time": "2015-01-08T07:17:08Z", "is_private": false}, {"count": 9, "tags": [], "creator": "pal.ratikanta@gmail.com", "attachment_id": 32356, "id": 180224, "time": "2015-01-08T07:20:06Z", "bug_id": 57342, "creation_time": "2015-01-08T07:20:06Z", "is_private": false, "text": "Created attachment 32356\nJars Used\n\nHI,\nRun the test using Jdk 1.8 and latest poi jars.\n\nhere the code I used \n\n\npackage com.rati.Dec;\n\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\n\nimport org.apache.poi.ss.usermodel.Cell;\nimport org.apache.poi.ss.usermodel.Row;\nimport org.apache.poi.xssf.streaming.SXSSFSheet;\nimport org.apache.poi.xssf.streaming.SXSSFWorkbook;\n\npublic class MillionTest1 {\n\n\t@SuppressWarnings(\"resource\")\n\tpublic static void main(String[] args) {\n\t\t// TODO Auto-generated method stub\n\t\tSXSSFWorkbook workbook = new SXSSFWorkbook(100);\n\t\tworkbook.setCompressTempFiles(true);\n\t\tSXSSFSheet sheet = null;\n\t\tRow row = null;\n\t\tCell cell = null;\n\t\tsheet = (SXSSFSheet) workbook.createSheet(\"Test\");\n\t\tFileOutputStream fileOut = null;\n\t\ttry {\n\t\t\tSystem.out.println(\"Started!\");\n\t\t\tfor (int i = 0; i < 777384; i++) {\n\t\t\t\trow = sheet.createRow(i);\n\t\t\t\tfor (int j = 0; j < 100; j++) {\n\t\t\t\t\tcell = row.createCell(j);\n\t\t\t\t\tcell.setCellValue(\"Rati : row : \"+i +\" Col: \"+ j);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfileOut = new FileOutputStream(\n\t\t\t\t\tnew File(\"Z:\\\\Version11.xlsx\"));\n\t\t\tworkbook.write(fileOut);\n\n\t\t} catch (Exception exception) {\n\t\t\texception.printStackTrace();\n\t\t} finally {\n\t\t\tworkbook.dispose();\n\t\t\ttry {\n\t\t\t\tfileOut.flush();\n\t\t\t\tfileOut.close();\n\t\t\t} catch (IOException e) {\n\t\t\t\t// TODO Auto-generated catch block\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"Completed!\");\n\t\t}\n\t}\n\n}\n\n\nSame error Is popping up.\n\nI have also attached the screen shots in the attachment section.\n\nPlease check once."}, {"count": 10, "tags": [], "text": "It also been tested multiple system but issue remains the same.", "is_private": false, "bug_id": 57342, "id": 180225, "time": "2015-01-08T08:02:34Z", "creator": "pal.ratikanta@gmail.com", "creation_time": "2015-01-08T08:02:34Z", "attachment_id": null}, {"count": 11, "tags": [], "creator": "apache@gagravarr.org", "text": "I've just run your test program on this jvm:\n\njava version \"1.6.0_33\"\nOpenJDK Runtime Environment (IcedTea6 1.13.5) (6b33-1.13.5-1ubuntu0.12.04)\n\nThe generated file (268mb!) is processed just fine with Apache Tika\n\nThe generated file takes an absolute epic age to load in Excel \nthen Excel gives a warning about unreadable content, after repairing it reports:\n\"System error: - 2134163449. Line 437452, column 5899\". However, it does still show 777384 rows, all with 100 columns\n\nThe only thing I can suggest is finding the exact point when the file files to load (eg 777384 fails, 777383 works), then unzip both files and compare the XML to see how they differ. (We now have a tool to help with this - OOXMLPrettyPrint)", "id": 180806, "time": "2015-02-05T17:45:57Z", "bug_id": 57342, "creation_time": "2015-02-05T17:45:57Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "matthewtckr@gmail.com", "attachment_id": null, "id": 181343, "time": "2015-02-25T22:05:46Z", "bug_id": 57342, "creation_time": "2015-02-25T22:05:46Z", "is_private": false, "text": "Using Rati's code with Java 7u76, the file works with a row count of 561564, but breaks at 561565 and higher."}, {"count": 13, "tags": [], "text": "Matt i think this is the range can you provide the file size and column count.", "is_private": false, "bug_id": 57342, "id": 181344, "time": "2015-02-26T02:20:02Z", "creator": "pal.ratikanta@gmail.com", "creation_time": "2015-02-26T02:20:02Z", "attachment_id": null}, {"count": 14, "tags": [], "creator": "matthewtckr@gmail.com", "text": "Hi Rati,\n\nBoth files are reported as 197,511 KB (202,250,805 and 202,251,162 bytes), and have the 100 columns as in the sample code.\n\n7-Zip reports the uncompressed size of the worksheet as 4,294,971,804 bytes and 4,294,979,492 bytes, which is just over the 4GB size for the broken file.\n\nI'm also uploading the files that were created, before being opened/repaired by Excel.  The files will be available at https://www.dropbox.com/sh/v322ryfnw7zk6ra/AADlEnu9t-25OCKNquJvdDyQa?dl=0", "id": 181380, "time": "2015-02-27T16:59:40Z", "bug_id": 57342, "creation_time": "2015-02-27T16:59:40Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 57342, "attachment_id": null, "text": "I think bug 54523 reports pretty much the same thing.", "id": 182029, "time": "2015-03-23T21:43:40Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-03-23T21:43:40Z", "is_private": false}, {"count": 16, "tags": [], "creator": "aldrin.baroi@gmail.com", "attachment_id": null, "id": 190419, "time": "2016-04-21T00:50:27Z", "bug_id": 57342, "creation_time": "2016-04-21T00:50:27Z", "is_private": false, "text": "I am using version 3.14"}, {"count": 17, "tags": [], "creator": "aldrin.baroi@gmail.com", "attachment_id": null, "id": 193901, "time": "2016-09-22T00:38:52Z", "bug_id": 57342, "creation_time": "2016-09-22T00:38:52Z", "is_private": false, "text": "Here is additional details:\n\nExcel Version     :  Excel 2010\nApache POI Version:  3.14 & 3.15\nJava Version      :  JDK 8 (1.8.0_101)\nOS Version        :  Windows 7 Enterprise 64-bit\n\n\nExcel sheet information:\nNumber of columns   :  208\nNumber of rows      :  390,000 or more\nAverage column width:  15 characters\nMax column width    :  40 characters \n\nProblem starts when the number of rows exceed 410,000 or so... \n\nError message displayed in Excel:\n\n  \"Excel found unreadable content in [file name].  Do you want to recover the contents of this workbook? If you trust the source of this workbook, click Yes\"\n\nThis ONLY HAPPENS when the number of rows exceeds 410,000 rows or so."}, {"count": 18, "tags": [], "bug_id": 57342, "attachment_id": null, "id": 194306, "time": "2016-10-10T14:39:11Z", "creator": "dramesh123@gmail.com", "creation_time": "2016-10-10T14:39:11Z", "is_private": false, "text": "Dear All,\n\nAny workaround to this issue? We are also facing the same issue with similar approach. Appreciate your help on this.\n\nThanks\nRamesh"}, {"count": 19, "tags": [], "creator": "onealj@apache.org", "attachment_id": null, "id": 194307, "time": "2016-10-10T14:59:45Z", "bug_id": 57342, "creation_time": "2016-10-10T14:59:45Z", "is_private": false, "text": "Patches are greatly appreciated. Appreciate your help on this."}, {"count": 20, "tags": [], "creator": "fanningpj@yahoo.com", "attachment_id": null, "id": 194382, "time": "2016-10-12T21:40:50Z", "bug_id": 57342, "creation_time": "2016-10-12T21:40:50Z", "is_private": false, "text": "I ran the test case in https://bz.apache.org/bugzilla/show_bug.cgi?id=54523 using latest poi code and Excel 2016 (Mac) gives the error about corrupt data.\nI was able to unzip the generated xlsx with p7zip. The default unzip on Macs can't handle zips containing such large files.\nThe generated worksheet is 4Gb but the XML looks fine."}, {"count": 21, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 194762, "time": "2016-11-01T20:03:14Z", "bug_id": 57342, "creation_time": "2016-11-01T20:03:14Z", "is_private": false, "text": "The comment at https://bz.apache.org/bugzilla/show_bug.cgi?id=54523#c6 indicates that a workaround is to unzip the file with 7zip and then zipping it again lead to a file that was usable in Excel."}, {"count": 22, "text": "*** Bug 54523 has been marked as a duplicate of this bug. ***", "bug_id": 57342, "is_private": false, "id": 194764, "time": "2016-11-01T20:04:28Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-11-01T20:04:28Z", "tags": [], "attachment_id": null}]
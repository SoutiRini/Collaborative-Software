[{"attachment_id": null, "tags": [], "creator": "gerhardus.geldenhuis@gmail.com", "text": "The current default location is:\nlogs/jk-runtime-status\n\na more appropriate location if the Linux File System Hierarchy is followed,\nwould be:\n/var/run/jk-runtime-status", "count": 0, "id": 108535, "time": "2007-09-24T08:47:48Z", "bug_id": 43463, "creation_time": "2007-09-24T08:47:48Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 43463, "attachment_id": null, "is_private": false, "id": 108536, "time": "2007-09-24T09:15:20Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-09-24T09:15:20Z", "text": "I don't agree with this one.\nJK is multi-platform. In terms of Apache httpd the correct directory would be\nruntimedir (or DEFAULT_REL_RUNTIMEDIR) both of which are configured during httpd\nbuild time, but unfortunately they are not available after httpd installation.\nSo the apxs build system doesn't give a hook to get the correct run directory\nfrom httpd.\n\nSo we are up to decide upon good defaults. Since the logs directory exists for\nall ASF provided httpd downloads, it seems this is a good directory for a default.\n\nIf the user doesn't use the JkShmFile, he gets a log message about JK using the\ndefault. So if he looks at his logs, he will be aware, that the logs directory\ngets used.\n\nIn case you've got a better solution, please reopen this issue."}, {"count": 2, "attachment_id": null, "creator": "gerhardus.geldenhuis@gmail.com", "is_private": false, "id": 108564, "time": "2007-09-25T02:18:17Z", "bug_id": 43463, "creation_time": "2007-09-25T02:18:17Z", "tags": [], "text": "I did have a bit of a narrow view forgetting that apache runs on other unixes too.\n\nIdeally one would want apache to provide a hook for a runtime directory but that\nis a different bugzilla...\n\nI am still not keen on using the log directory. It is not a logical place to put\nruntime files and will cause confusion for new admins that's been taught that\nonly log files go in /var/log/\n\nWould a better solution not be to force the declaration of this parameter and do\nthe following:\n* In the example config file add options for various platforms clearly commented\n* Ensure that documentation is very clear on locations and the configuration of\nthis parameter.\n\nAlternatively, one could detect platform and set location of file accordingly. "}, {"count": 3, "tags": [], "bug_id": 43463, "text": "The problem is that logfile location can be virtual if for\nexample one chooses to pipe the log trough some external process.\nIn that case any detection falls apart. Shared memory is one\nproblem, other is shared memory process mutex.\n\nAlso the /var/log can be on the NFS share, and having a shared memory\non NFS is performance killer. So, the admin must know what JK shared\nmemory is, what it's used for, and how to set up a simple config line.\n\nThe current system where we cannot depend on APR for anonymous shared\nmemory and anonymous process mutexes involves minimum admin understanding\nof the problem, while keeping our code to the minimum.\n\n", "id": 108566, "time": "2007-09-25T02:30:33Z", "creator": "mturk@apache.org", "creation_time": "2007-09-25T02:30:33Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 43463, "text": "Really just an install gotcha but the default location on Redhat/CentOS with SELinux enforced produces an error in the log:\n\n[Sun Jun 05 04:02:02 2011] [1475:47614514131712] [error] init_jk::mod_jk.c (3181): Initializing shm:/etc/httpd/logs/jk-runtime-status.1475 errno=13. Load balancing workers will not function properly.\n\nSetting SELinux to \"Permissive\" mode fixes the problem but this was not acceptable so I chose to set JKShmFile explicitly to another location (/var/run/httpd/mod_jk.shm).\n\nBelow is the \"sealert\" diagnostic from my server but please note that the fix it suggests may be too broad for some security-conscious admins. Basically it says that httpd does not have the correct context to write to the file /var/log/httpd/jk-runtime-status.PID (even though that file does actually get created).\n\n\nThe following command will allow this access:\n\nsetsebool -P httpd_unified=1\n\nAdditional Information:\n\nSource Context                user_u:system_r:httpd_t\nTarget Context                user_u:object_r:httpd_log_t\nTarget Objects                ./jk-runtime-status.6564 [ file ]\nSource                        httpd\nSource Path                   /usr/sbin/httpd\nPort                          <Unknown>\nHost                          my.host.domain\nSource RPM Packages           httpd-2.2.3-45.el5.centos\nTarget RPM Packages\nPolicy RPM                    selinux-policy-2.4.6-279.el5_5.2\nSelinux Enabled               True\nPolicy Type                   targeted\nMLS Enabled                   True\nEnforcing Mode                Enforcing\nPlugin Name                   httpd_unified\nHost Name                     my.host.domain\nPlatform                      Linux my.host.domain 2.6.18-194.32.1.el5xen\n                              #1 SMP Wed Jan 5 18:44:24 EST 2011 x86_64 x86_64\nAlert Count                   1\nFirst Seen                    Tue Jun 28 13:00:42 2011\nLast Seen                     Tue Jun 28 13:00:42 2011\nLocal ID                      9c16d601-7a97-475f-b4cc-ae309a980e5f\nLine Numbers\n\nRaw Audit Messages\n\nhost=my.host.domain type=AVC msg=audit(1309230042.538:9038): avc:  denied  { write } for  pid=6564 comm=\"httpd\" name=\"jk-ru  ntime-status.6564\" dev=dm-0 ino=196748 scontext=user_u:system_r:httpd_t:s0 tcontext=user_u:object_r:httpd_log_t:s0 tclass=file\n\nhost=my.host.domain type=SYSCALL msg=audit(1309230042.538:9038): arch=c000003e syscall=77 success=no exit=-13 a0=11 a1=1c0   a2=2 a3=75746174732d656d items=0 ppid=6563 pid=6564 auid=500 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) se  s=1452 comm=\"httpd\" exe=\"/usr/sbin/httpd\" subj=user_u:system_r:httpd_t:s0 key=(null)", "id": 147545, "time": "2011-06-28T07:44:15Z", "creator": "Ross.Johnson@acma.gov.au", "creation_time": "2011-06-28T07:44:15Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "priyesh.nair@wipro.com", "attachment_id": null, "is_private": false, "id": 49695, "time": "2003-12-25T11:44:00Z", "bug_id": 25757, "creation_time": "2003-12-25T11:44:00Z", "text": "We have a site which is running on Apache Webserver, Weblogic App server. We \nhave two instances of Apache runing on two separte boxes with load balancer. We \nhave a user base of around 2000+ users. We start Apache using the \ncommand \"apachectl startssl\".\n\nThe problem we are facing is after few hours (10-12 hrs) CSS and Images stop \nappaering on the site and JSP pages get distorted since CSS doesn't get loaded. \nWhen we check the log files at that moment we find lot of error messages \nsaying \"(24)Too many open files: file permissions deny server access: <actual \nfile name>\". Only when we restart Apache this problem gets resolved and CSS and \nImages start appearing on the site. So currently we have to restart Apache very \nfrequently (almost every 12 hrs).\n\nWe tried one option wherein we specified \"ulimit -n 8192\"  inside \"apachectl\" \nfile and restarted Apache. But still the problem exists.\n\nPlease help us in resolving this issue.\n\nSome standard entries in our httpd.conf file is given below:\n\nTimeout 300\nKeepAlive On\nMaxKeepAliveRequests 100\nKeepAliveTimeout 15\nMinSpareServers 5\nMaxSpareServers 10\nStartServers 5\nMaxClients 250\nMaxRequestsPerChild 10000"}, {"count": 1, "text": "Hmm. It's questionable if it's apache or the jsp module which leaks descriptors.\nDid you try 1.3.29?", "bug_id": 25757, "attachment_id": null, "id": 50514, "time": "2004-01-14T00:57:53Z", "creator": "nd@perlig.de", "creation_time": "2004-01-14T00:57:53Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "is_private": false, "id": 51310, "time": "2004-01-28T19:54:44Z", "bug_id": 25757, "creation_time": "2004-01-28T19:54:44Z", "text": "No further response. Feel free to reopen the report if you can supply the\nrequested information.\n\nThanks for using Apache."}, {"count": 3, "tags": [], "creator": "andresb@swissmedical.com.ar", "attachment_id": null, "id": 56186, "time": "2004-04-21T17:01:29Z", "bug_id": 25757, "creation_time": "2004-04-21T17:01:29Z", "is_private": false, "text": "We have the EXACT same problem. If i check the open files of each of the httpd \nchilds they grow all the time, until the server eventually hangs up.\n\nWe are using 1.3.29"}, {"count": 4, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "id": 56187, "time": "2004-04-21T17:04:35Z", "bug_id": 25757, "creation_time": "2004-04-21T17:04:35Z", "is_private": false, "text": "Use lsof to see what type of descriptors are leaking.\n\nThis is most likely an issue with third-party modules.\n"}, {"count": 5, "attachment_id": null, "bug_id": 25757, "is_private": false, "id": 59793, "time": "2004-06-23T18:38:41Z", "creator": "kevin.bartholomew@nike.com", "creation_time": "2004-06-23T18:38:41Z", "tags": [], "text": "Jeff,\n\nI am seeing the exact same problem with our 1.3.26 server.  We are seeing \nthe \"(24)Too many open files: file permissions deny server access: <actual \nfile name>\" and we are restarting Apache every 15 minutes. We are using the \nauth_ldap module for LDAP authentication.  This is the only third party module \nthat we are using.  Help!!\n\nKevin "}, {"count": 6, "text": "Suggestion is the same: Use lsof to see what sort of descriptors are open in the\nchild processes.  Taking a few snapshots of the same child process over time may\nshow the leak.\n\nWith large numbers of Apache child processes and a fair number of open file\ndescriptors open in each one (log files, sockets, connections to app servers,\nconnections to security servers, etc.), while there may not be a descriptor leak\nit is possible to encounter system-wide file descriptor limits.", "bug_id": 25757, "attachment_id": null, "id": 59799, "time": "2004-06-23T19:16:57Z", "creator": "trawick@apache.org", "creation_time": "2004-06-23T19:16:57Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "kevin.bartholomew@nike.com", "attachment_id": null, "is_private": false, "id": 60603, "time": "2004-07-14T15:06:28Z", "bug_id": 25757, "creation_time": "2004-07-14T15:06:28Z", "text": "Jeff,\n\nI have set the hard file descriptor limit to 16384 and the soft limit to 1024 \nin /etc/system.  In the apachectl script I have added ulimit -n 16384 and set \nthe lsof utility to run every 10 minutes.  The most descriptors open at any one \ntime has been 9000 yet I am still getting the Too many open files: file \npermissions deny server access error frequently?  Any ideas?  Any help is \ngreatly appreciated\n\nKevin"}, {"count": 8, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "is_private": false, "id": 60608, "time": "2004-07-14T17:35:34Z", "bug_id": 25757, "creation_time": "2004-07-14T17:35:34Z", "text": "Kevin,\n\nThe hard file descriptor limit you set is per-process file descriptors \n(rlim_fd_max setting in /etc/system), right?\n\nYour lsof output is showing 9000 total system-wide descriptors, right (vs. file \ndescriptors for a particular httpd process)?\n\nI don't see how you would be hitting per-process limits then.\n\nWhat about system-wide or per-user limits?  (I dunno if Solaris has these \nconcerns.)\n\nAs far as determining that there is an Apache bug which results in hitting some \nsort of file descriptor limit:\n\nUse your lsof output to find out if any particular httpd process has an \nunreasonable set of open file descriptors.  Can you find such a process and \nsummarize what sorts of files are open?  Perhaps there are numerous open \nsockets which have been connected to an LDAP server?\n"}, {"count": 9, "tags": [], "text": "we are facing the same problem with Apache 1.3  and tomcat4.06 ", "is_private": false, "bug_id": 25757, "id": 65312, "time": "2004-10-19T14:26:22Z", "creator": "sharad@fsltechnologies.com", "creation_time": "2004-10-19T14:26:22Z", "attachment_id": null}, {"count": 10, "tags": [], "creator": "sharad@fsltechnologies.com", "attachment_id": null, "is_private": false, "id": 65313, "time": "2004-10-19T14:33:54Z", "bug_id": 25757, "creation_time": "2004-10-19T14:33:54Z", "text": "we are facing the same problem with Apache 1.3  and tomcat4.06 "}, {"count": 11, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "is_private": false, "id": 65314, "time": "2004-10-19T14:45:36Z", "bug_id": 25757, "creation_time": "2004-10-19T14:45:36Z", "text": "What problem exactly? Please reopen only, if you have more information that help\nto track down the problem. -> invalid again."}, {"count": 12, "text": "I'm not reopening this call at this point, because I don't have enough data to\ngive, but wanted to log some information before it was forgotten.\n\nI have just also experienced this bug, but not knowing what was going on at the\ntime, I restarted the server before doing any solid investigation, and the\nserver seems to be working fine now.  If it acts up again, I will be certain to\nget a lsof dump and post the information here.\n\nHowever, our server started getting these errors over the weekend.  About 1 in\nevery 1000 requests started returning a 403 Forbidden because of it, very odd\nreaction there.\n\nFirst of all, our setup:\nSolaris 8, Apache 1.3.32, with PHP 4.3.7, mod_rewrite\n\nNow, there were a few configuration changes I had done in the middle of the\nprevious week, and perhaps helped cause this to surface, they were:\nA) This host serves multiple IP based websites, I converted one of them into a\nVirtual host server, and added 3 virtual hosts to it.\nB) I added mod_usertrack and activated it\nC) I changed the logging parameters to a custom format, including the usertrack\ndata, and generic cookie information.\n\nAlso, perhaps related, perhaps not, is this:\n\nThe first 'too many files' error occured on 7:42pm Saturday Night.  At 4:14am\nSunday morning, the RAID system suddenly had 2 of it's 12 drives simultaneously\n(or awfully close) fail.  These drives, when removed and readded to the RAID,\nbegan working properly again without signs of damage.  It is unknown what\nhappened, however there is the chance that these are somehow related, or else an\nawfully big coincidence.\n\nAgain, as stated, I'm now watching the server closely, and if this happens again\nI will gather as much information as I can and repost here.", "bug_id": 25757, "attachment_id": null, "id": 66939, "time": "2004-11-15T19:42:41Z", "creator": "ewhite@stsci.edu", "creation_time": "2004-11-15T19:42:41Z", "tags": [], "is_private": false}, {"count": 13, "tags": [], "text": "Hello, me again with more information, but perhaps not ALL information.\n\nIt happened again to me.  Just today 11/19 ... my check server script starting\nrandomly getting 403 errors, and the logfile showed 403's and the 'too many\nfiles open' error message.\n\nUnfortunately, I do not have access myself to run lsof on the servers, and\neveryone who had access was already gone for the weekend.  Therefore, yet again,\nI did not get the lsof output as people are wanting.\n\nHOWEVER, I do in fact have more information now.\n\nI mentioned last time that I had made 3 config changes, and not long after, the\nproblem started.\n\nWell, I since then had also turned on mod_usertrack on our other 4 (rather\nindentical-ish) servers.  I also turned on the same custom logging.\n\nNo other server is having an issue.\n\nThis means that the ONLY change to this server, unique to it, before the problem\nstarted ... was in taking it from a multihost, 1 host per ip server ... to a\nmultihost, 1 host for 1 ip, 3 virtual hosts on another ip, type server.\n\nIt would seem that something about that change/setup in particular, is causing\nthe FD leak, which takes a few days to leak enough.\n\nFor the record, hopefully it will be a little longer before my next leak, as I\nhave upped the ulimit on the process to 1024 (was at 256), and I have disabled\n.htaccess (AllowOverride None), since I wasn't using .htaccess files anyway, and\ndidn't need it on.   Yet all the errors were based around trying to get a\n.htaccess file.\n\nI'm marking this for reopening, so that someone hopefully takes a look at this,\nand at the virtual host code for fd leaks (perhaps mixed in with .htaccess stuff?)\n\nPlease contact me for any more questions/information.", "is_private": false, "bug_id": 25757, "id": 67276, "time": "2004-11-19T23:31:01Z", "creator": "ewhite@stsci.edu", "creation_time": "2004-11-19T23:31:01Z", "attachment_id": null}, {"count": 14, "tags": [], "creator": "jim@apache.org", "attachment_id": null, "id": 67857, "time": "2004-12-03T02:16:59Z", "bug_id": 25757, "creation_time": "2004-12-03T02:16:59Z", "is_private": false, "text": "Is Apache being built locally, on a Sol8 system? If built on a Sol2.6 system you \"inherit\" the stdio \nlimitations with the number of available fd's. You need to build on Sol8 and force the number of fd's \navailable to 64k as well as bumping up the kernel and user limits"}, {"count": 15, "tags": [], "creator": "soal2001@hotmail.com", "attachment_id": null, "id": 94897, "time": "2006-10-17T09:50:09Z", "bug_id": 25757, "creation_time": "2006-10-17T09:50:09Z", "is_private": false, "text": "the command:\nlsof|grep httpd|grep mediamarketing.com.co\n\nthe output:\nhttpd     19749     root  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     19749     root  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     19749     root  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     19749     root  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26532     root  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26532     root  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26532     root  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26532     root  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26533   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26533   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26533   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26533   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26534   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26534   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26534   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26534   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26535   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26535   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26535   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26535   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26536   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26536   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26536   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26536   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26537   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26537   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26537   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26537   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26538   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26538   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26538   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26538   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26539   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26539   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26539   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26539   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26540   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26540   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26540   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26540   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26609   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26609   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26609   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26609   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26615   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26615   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26615   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26615   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26620   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26620   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26620   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26620   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26630   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26630   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26630   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26630   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26633   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26633   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26633   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26633   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26643   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26643   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26643   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26643   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26648   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26648   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26648   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26648   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log\nhttpd     26662   apache  465w   REG        8,3  1212159    6815881\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_log\nhttpd     26662   apache  466w   REG        8,3  8677843    6815882\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/error_ssl_log\nhttpd     26662   apache  964w   REG        8,3   278161    6815883\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_log\nhttpd     26662   apache  965w   REG        8,3    71090    6815884\n/var/www/vhosts/mediamarketing.com.co/statistics/logs/access_ssl_log"}]
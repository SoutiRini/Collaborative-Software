[{"count": 0, "tags": [], "creator": "bugs@ausics.net", "text": "Web hosting environment\nSlackware 11 and 12\nLinux www1 2.6.23.8 #1 SMP Tue Nov 20 07:53:02 EST 2007 i686 Intel(R) Pentium(R)\n4 CPU 2.60GHz GenuineIntel GNU/Linux\ngcc version 4.1.2\n\nIf apache is stopped and restarted within a short period of time on several\noccasions, apache hangs at starting.\n\nShows one process only:  \n\n19180 ?        Ss     0:00 /usr/local/apache/bin/httpd -k start\n\n# ./apachectl stop\nhttpd (no pid file) not running\n#\n\n#./apachectl start\n(98)Address already in use: make_sock: could not bind to address 0.0.0.0:80\nno listening sockets available, shutting down\nUnable to open logs\n\n# strace -p 19180\nProcess 19180 attached - interrupt to quit\nread(13,\n\n\nit will hang there, stopping, killing, HUP, nothing will correct this state\nexcept for a reboot (waited about 5 minutes, but as you can appreciate,\ncustomers don't like a dead server )\n\nThis occurs on at least 2 separate servers, one with MySQL, one without\n\nThis can be reproduced by stop/start/stop/start/stop/start allowing a second or\ntwo between them, it has happened even on 2.2.4. Occasionally as much as a\nminute can lapse between them and it locks, strace -p does nothing it just sits\nthere.\n\nit is noticeable when new vhosts are added or old ones deleted by the scripts,\nthat do a restart obviously after changing httpd.conf, this is ordinarily fine,\nbut if a few happen almost simultaneously it sets off alarms and we find it in\nthis \"suspended state\"\n\n\nKilling it so all httpd process are gone, restart same thing, its like memory or\nsomething is not being freed?", "id": 111001, "time": "2007-11-22T22:23:33Z", "bug_id": 43945, "creation_time": "2007-11-22T22:23:33Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 43945, "is_private": false, "id": 111041, "time": "2007-11-23T14:21:58Z", "creator": "rpluem@apache.org", "creation_time": "2007-11-23T14:21:58Z", "tags": [], "text": "Please try to get a back trace of the hanging process (thread apply all bt full)\nvia gdb (see also http://httpd.apache.org/dev/debugging.html). Additionally\nplease let us know the user under which the remaining process runs. Is it root\nor the unprivileged user?"}, {"count": 2, "tags": [], "bug_id": 43945, "attachment_id": null, "text": "Everything at that time is owned by root, the other processes are owned by\nuser/group apache\n\nI hope this is what you're after...\n\nAttaching to process 17929\nReading symbols from /usr/local/apache/bin/httpd...done.\nUsing host libthread_db library \"/lib/libthread_db.so.1\".\nReading symbols from /usr/local/apache/lib/libaprutil-1.so.0...done.\nLoaded symbols for /usr/local/apache/lib/libaprutil-1.so.0\nReading symbols from /usr/lib/libmysqlclient_r.so.15...done.\nLoaded symbols for /usr/X11R6/lib/libmysqlclient_r.so.15\nReading symbols from /lib/libnsl.so.1...done.\nLoaded symbols for /lib/libnsl.so.1\nReading symbols from /lib/libm.so.6...done.\nLoaded symbols for /lib/libm.so.6\nReading symbols from /usr/lib/libz.so.1...done.\nLoaded symbols for /usr/X11R6/lib/libz.so.1\nReading symbols from /usr/lib/libssl.so.0...done.\nLoaded symbols for /usr/X11R6/lib/libssl.so.0\nReading symbols from /usr/lib/libcrypto.so.0...done.\nLoaded symbols for /usr/X11R6/lib/libcrypto.so.0\nReading symbols from /usr/lib/libexpat.so.1...done.\nLoaded symbols for /usr/X11R6/lib/libexpat.so.1\nReading symbols from /usr/local/apache/lib/libapr-1.so.0...done.\nLoaded symbols for /usr/local/apache/lib/libapr-1.so.0\nReading symbols from /lib/libuuid.so.1...done.\nLoaded symbols for /lib/libuuid.so.1\nReading symbols from /lib/librt.so.1...done.\nLoaded symbols for /lib/librt.so.1\nReading symbols from /lib/libcrypt.so.1...done.\nLoaded symbols for /lib/libcrypt.so.1\nReading symbols from /lib/libpthread.so.0...done.\n[Thread debugging using libthread_db enabled]\n[New Thread -1214298432 (LWP 17929)]\nLoaded symbols for /lib/libpthread.so.0\nReading symbols from /lib/libdl.so.2...done.\nLoaded symbols for /lib/libdl.so.2\nReading symbols from /lib/libc.so.6...done.\nLoaded symbols for /lib/libc.so.6\nReading symbols from /lib/ld-linux.so.2...done.\nLoaded symbols for /lib/ld-linux.so.2\nReading symbols from /usr/lib/libgcc_s.so.1...done.\nLoaded symbols for /usr/X11R6/lib/libgcc_s.so.1\nReading symbols from /lib/libnss_compat.so.2...done.\nLoaded symbols for /lib/libnss_compat.so.2\nReading symbols from /lib/libnss_nis.so.2...done.\nLoaded symbols for /lib/libnss_nis.so.2\nReading symbols from /lib/libnss_files.so.2...done.\nLoaded symbols for /lib/libnss_files.so.2\nReading symbols from /usr/local/apache/modules/mod_perl.so...done.\nLoaded symbols for /usr/local/apache/modules/mod_perl.so\nReading symbols from /lib/libutil.so.1...done.\nLoaded symbols for /lib/libutil.so.1\nReading symbols from /usr/local/apache/modules/libphp5.so...done.\nLoaded symbols for /usr/local/apache/modules/libphp5.so\nReading symbols from /usr/lib/libmysqlclient.so.15...done.\nLoaded symbols for /usr/X11R6/lib/libmysqlclient.so.15\nReading symbols from /usr/lib/libpng.so.3...done.\nLoaded symbols for /usr/X11R6/lib/libpng.so.3\nReading symbols from /usr/local/lib/libjpeg.so.62...done.\nLoaded symbols for /usr/local/lib/libjpeg.so.62\nReading symbols from /lib/libresolv.so.2...done.\nLoaded symbols for /lib/libresolv.so.2\nReading symbols from /usr/lib/libxml2.so.2...done.\nLoaded symbols for /usr/X11R6/lib/libxml2.so.2\nReading symbols from /usr/local/apache/modules/mod_cband.so...done.\nLoaded symbols for /usr/local/apache/modules/mod_cband.so\n0xb7b47cd1 in ?? () from /lib/libpthread.so.0\n\n\ngdb> thread apply all bt full\n\nThread 1 (Thread -1213647168 (LWP 17359)):\n#0  0xb7be6cd1 in ?? () from /lib/libpthread.so.0\nNo symbol table info available.\n#1  0xb7c428dc in apr_generate_random_bytes (buf=0x80ddc7c \"\", length=12)\n    at misc/unix/rand.c:104\n        rc = <value optimized out>\n        fd = 51\n#2  0x08082bba in initialize_module (p=0x80e60a8, plog=0x8128660,\n    ptemp=0x80ee578, s=0x80ed4d0) at mod_auth_digest.c:233\n        data = (void *) 0x1\n#3  0x08073aa1 in ap_run_post_config (pconf=0x80e60a8, plog=0x8128660,\n    ptemp=0x80ee578, s=0x80ed4d0) at config.c:91\n        n = 5\n        rv = 12\n#4  0x08062828 in main (argc=135151776, argv=0x8224e10) at main.c:719\n        c = 0 '\\0'\n        configtestonly = 0\n        confname = 0x80c0e6b \"conf/httpd.conf\"\n        def_server_root = 0x80c0e7b \"/usr/local/apache\"\n        temp_error_log = 0x0\n        error = <value optimized out>\n        process = (process_rec *) 0x80e4120\n#3  0x08073aa1 in ap_run_post_config (pconf=0x80e60a8, plog=0x8128660,\n    ptemp=0x80ee578, s=0x80ed4d0) at config.c:91\n        n = 5\n        rv = 12\n#4  0x08062828 in main (argc=135151776, argv=0x8224e10) at main.c:719\n        c = 0 '\\0'\n        configtestonly = 0\n        confname = 0x80c0e6b \"conf/httpd.conf\"\n        def_server_root = 0x80c0e7b \"/usr/local/apache\"\n        temp_error_log = 0x0\n        error = <value optimized out>\n        process = (process_rec *) 0x80e4120\n---Type <return> to continue, or q <return> to quit---\n        server_conf = (server_rec *) 0x80ed4d0\n        pglobal = (apr_pool_t *) 0x80e40a0\n        pconf = (apr_pool_t *) 0x80e60a8\n        plog = (apr_pool_t *) 0x8128660\n        ptemp = (apr_pool_t *) 0x80ee578\n        pcommands = (apr_pool_t *) 0x80e80b0\n        opt = (apr_getopt_t *) 0x80e8148\n        rv = <value optimized out>\n        optarg = 0xb7e01558 \"\"\n#0  0xb7be6cd1 in ?? () from /lib/libpthread.so.0\n                                                                               \n                    \n", "id": 111045, "time": "2007-11-23T19:28:06Z", "creator": "bugs@ausics.net", "creation_time": "2007-11-23T19:28:06Z", "is_private": false}, {"count": 3, "attachment_id": null, "creator": "rpluem@apache.org", "is_private": false, "id": 111047, "time": "2007-11-24T00:39:25Z", "bug_id": 43945, "creation_time": "2007-11-24T00:39:25Z", "tags": [], "text": "(In reply to comment #2)\n> Everything at that time is owned by root, the other processes are owned by\n> user/group apache\n> \n> I hope this is what you're after...\n\nYes, I was looking after this. Could you please provide the following additional\ninformation:\n\nAs root please execute\n\nlsof | grep <pid of the hanging process>\n\n"}, {"count": 4, "tags": [], "bug_id": 43945, "is_private": false, "text": "httpd     8642    root  cwd       DIR        3,1     4096          2 /\nhttpd     8642    root  rtd       DIR        3,1     4096          2 /\nhttpd     8642    root  txt       REG        3,1  2307499    1343570\n/usr/local/apache/bin/httpd\nhttpd     8642    root  mem       REG        3,1   156208    2605060\n/usr/local/apache/modules/mod_cband.so\nhttpd     8642    root  mem       REG        3,1   207720    1836778\n/usr/lib/locale/en_US/LC_CTYPE\nhttpd     8642    root  mem       REG        3,1    45552    3375367\n/lib/libnss_files-2.5.sohttpd     8642    root  mem       REG        3,1   \n41045    3375345 /lib/libnss_nis-2.5.so\nhttpd     8642    root  mem       REG        3,1    35494    3375246\n/lib/libnss_compat-2.5.so\nhttpd     8642    root  DEL       REG        0,8              589825 /SYSV00000000\nhttpd     8642    root  DEL       REG        0,8              557056 /SYSV00000000\nhttpd     8642    root  mem       REG        3,1  1147020     590301\n/usr/lib/libxml2.so.2.6.28\nhttpd     8642    root  mem       REG        3,1    77439    3375368\n/lib/libresolv-2.5.so\nhttpd     8642    root  mem       REG        3,1   140324    7323751\n/usr/local/lib/libjpeg.so.62.0.0\nhttpd     8642    root  mem       REG        3,1   240492     590042\n/usr/lib/libpng.so.3.1.2.23\nhttpd     8642    root  mem       REG        3,1  1322284    3473482\n/usr/lib/mysql/libmysqlclient.so.15.0.0\nhttpd     8642    root  mem       REG        3,1 16984904    2605201\n/usr/local/apache/modules/libphp5.so\nhttpd     8642    root  mem       REG        3,1    12537    3375364\n/lib/libutil-2.5.so\nhttpd     8642    root  mem       REG        3,1  1479754    2605200\n/usr/local/apache/modules/mod_perl.so\nhttpd     8642    root  mem       REG        3,1    41224     589830\n/usr/lib/libgcc_s.so.1\nhttpd     8642    root  mem       REG        3,1  1528742    3375356\n/lib/libc-2.5.so\nhttpd     8642    root  mem       REG        3,1    13506    3375365\n/lib/libdl-2.5.so\nhttpd     8642    root  mem       REG        3,1   110796    3375363\n/lib/libpthread-2.5.so\nhttpd     8642    root  mem       REG        3,1    25250    3375358\n/lib/libcrypt-2.5.so\nhttpd     8642    root  mem       REG        3,1    34905    3375349\n/lib/librt-2.5.so\nhttpd     8642    root  mem       REG        3,1     8844    3375205\n/lib/libuuid.so.1.2\nhttpd     8642    root  mem       REG        3,1   525809    1916984\n/usr/local/apache/lib/libapr-1.so.0.2.11\nhttpd     8642    root  mem       REG        3,1   126996     590365\n/usr/lib/libexpat.so.1.5.2\nhttpd     8642    root  mem       REG        3,1  1296024     590701\n/usr/lib/libcrypto.so.0.9.8\nhttpd     8642    root  mem       REG        3,1   256252     590575\n/usr/lib/libssl.so.0.9.8httpd     8642    root  mem       REG        3,1   \n77688     590574 /usr/lib/libz.so.1.2.3\nhttpd     8642    root  mem       REG        3,1   184820    3375360\n/lib/libm-2.5.so\nhttpd     8642    root  mem       REG        3,1    96480    3375361\n/lib/libnsl-2.5.so\nhttpd     8642    root  mem       REG        3,1  1334668    3473472\n/usr/lib/mysql/libmysqlclient_r.so.15.0.0\nhttpd     8642    root  mem       REG        3,1       59    1458505\n/usr/lib/locale/en_US/LC_NUMERIC\nhttpd     8642    root  mem       REG        3,1     2459     180229\n/usr/lib/locale/en_US/LC_TIME\nhttpd     8642    root  mem       REG        3,1      291     180230\n/usr/lib/locale/en_US/LC_MONETARY\nhttpd     8642    root  mem       REG        3,1       57    4636815\n/usr/lib/locale/en_US/LC_MESSAGES/SYS_LC_MESSAGES\nhttpd     8642    root  mem       REG        3,1       39     655399\n/usr/lib/locale/en_US/LC_PAPER\nhttpd     8642    root  mem       REG        3,1       82    7012361\n/usr/lib/locale/en_US/LC_NAME\nhttpd     8642    root  mem       REG        3,1      160     180231\n/usr/lib/locale/en_US/LC\n_ADDRESS\nhttpd     8642    root  mem       REG        3,1       64    7012360\n/usr/lib/locale/en_US/LC_TELEPHONE\nhttpd     8642    root  mem       REG        3,1       28     655398\n/usr/lib/locale/en_US/LC_MEASUREMENT\nhttpd     8642    root  mem       REG        3,1      378     180228\n/usr/lib/locale/en_US/LC_IDENTIFICATION\nhttpd     8642    root  mem       REG        3,1   328206    1917366\n/usr/local/apache/lib/libaprutil-1.so.0.2.11\nhttpd     8642    root  mem       REG        3,1   131484    3375388 /lib/ld-2.5.so\nhttpd     8642    root    0r      CHR        1,3                 183 /dev/null\nhttpd     8642    root    1w      CHR        1,3                 183 /dev/null\nhttpd     8642    root    2w      REG        3,1   467031    3490261\n/var/log/apache/error_log\nhttpd     8642    root    3r      CHR        1,9                 834 /dev/urandom\nhttpd     8642    root    4u     IPv4      29293                 TCP *:http (LISTEN)\nhttpd     8642    root    5r     FIFO        0,5               29349 pipe\nhttpd     8642    root    6w     FIFO        0,5               29349 pipe\nhttpd     8642    root    7w      REG        3,1    13213    1589497\n/var/log/apache/forums/error_log\nhttpd     8642    root    8w      REG        3,1   467031    3490261\n/var/log/apache/error_log\nhttpd     8642    root    9w      REG        3,1        0    3473445\n/var/log/apache/trojan/error_log\nhttpd     8642    root   10w      REG        3,1        0    2048078\n/var/log/apache/linux/error_log\nhttpd     8642    root   11w      REG        3,1     1042      16946\n/var/log/apache/qms/error_log\nhttpd     8642    root   12w      REG        3,1      348    8455193\n/var/log/apache/netfilter/error_log\nr/error_log\nhttpd     8642    root   13w      REG        3,1    19310    7422505\n/var/log/apache/samba/error_log\nhttpd     8642    root   14w      REG        3,1        0     278756\n/var/log/apache/cpan/error_log\nhttpd     8642    root   15w      REG        3,1   137439    4129085\n/var/log/apache/ldp/error_log\nhttpd     8642    root   16w      REG        3,1     3213    3425205\n/var/log/apache/support/error_log\nhttpd     8642    root   17w      REG        3,1        0    3490264\n/var/log/apache/admin.ausics.net/error_log\nhttpd     8642    root   18w      REG        3,1      131    4522458\n/var/log/apache/mrtg/error_log\nhttpd     8642    root   19w      REG        3,1    88276    5177852\n/var/log/apache/ecartis/error_log\nhttpd     8642    root   20w      REG        3,1        0    3490266\n/var/log/apache/aviation/error_log\nhttpd     8642    root   21w      REG        3,1     3397    2981976\n/var/log/apache/polls/error_log\nhttpd     8642    root   22w      REG        3,1    41536    2654889\n/var/log/apache/lyrics/error_log\nhttpd     8642    root   23w      REG        3,1     1818    4820125\n/var/log/apache/ftp/error_log\nhttpd     8642    root   24w      REG        3,1     1386    3490268\n/var/log/apache/rfc/error_log\nhttpd     8642    root   25w      REG        3,1        0    3490248\n/var/log/apache/wasteland/error_log\nhttpd     8642    root   26w      REG        3,1     1433    3999405\n/var/log/apache/its/error_log\nhttpd     8642    root   27w      REG        3,1    46655    9208382\n/var/log/apache/webmail/\nerror_log\nhttpd     8642    root   28w      REG        3,1   492678    3490245\n/var/log/apache/access_log\nhttpd     8642    root   29w      REG        3,1   338731    1589488\n/var/log/apache/forums/access_log\nhttpd     8642    root   30w      REG        3,1        0    3473444\n/var/log/apache/trojan/access_log\nhttpd     8642    root   31w      REG        3,1     7747    2048004\n/var/log/apache/linux/access_log\nhttpd     8642    root   32w      REG        3,1    45812      16925\n/var/log/apache/qms/access_log\nhttpd     8642    root   33w      REG        3,1    13530    8455195\n/var/log/apache/netfilter/access_log\nhttpd     8642    root   34w      REG        3,1   338754    7422491\n/var/log/apache/samba/access_log\nhttpd     8642    root   35w      REG        3,1   166810     278576\n/var/log/apache/cpan/access_log\nhttpd     8642    root   36w      REG        3,1  1789634    4129081\n/var/log/apache/ldp/access_log\nhttpd     8642    root   37w      REG        3,1   121183    3424834\n/var/log/apache/support/access_log\nhttpd     8642    root   38w      REG        3,1    54351    3490263\n/var/log/apache/admin.ausics.net/access_log\nhttpd     8642    root   39w      REG        3,1     1933    4522440\n/var/log/apache/mrtg/access_log\nhttpd     8642    root   40w      REG        3,1   976581    5177845\n/var/log/apache/ecartis/access_log\nhttpd     8642    root   41w      REG        3,1     1010    3490265\n/var/log/apache/aviation/access_log\nhttpd     8642    root   42w      REG        3,1    20723    2981961\n/var/log/apache/polls/access_log\nhttpd     8642    root   43w      REG        3,1  3137987    2654888\n/var/log/apache/lyrics/access_log\nhttpd     8642    root   44w      REG        3,1     8719    4816920\n/var/log/apache/ftp/access_log\nhttpd     8642    root   45w      REG        3,1   271212    3490267\n/var/log/apache/rfc/access_log\nhttpd     8642    root   46w      REG        3,1   492678    3490245\n/var/log/apache/access_log\nhttpd     8642    root   47w      REG        3,1        0    3490247\n/var/log/apache/wasteland/access_log\nhttpd     8642    root   48w      REG        3,1    39829    3999404\n/var/log/apache/its/access_log\nhttpd     8642    root   49w      REG        3,1   492678    3490245\n/var/log/apache/access_log\nhttpd     8642    root   50w      REG        3,1   548190    9208378\n/var/log/apache/webmail/access_log\nhttpd     8642    root   51r      CHR        1,8                 827 /dev/random\n", "id": 111048, "time": "2007-11-24T01:03:30Z", "creator": "bugs@ausics.net", "creation_time": "2007-11-24T01:03:30Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "text": "httpd is hanging because it waits for random data from /dev/random. This device\nblocks if not enough entropy is present. So either\n\n- disable mod_auth_digest (which will do no harm if you do not use digest\n  authentication in your configuration)\n\n- recompile your httpd and add the following option to your call of configure:\n\n  --with-devrandom=/dev/urandom", "id": 111049, "time": "2007-11-24T02:01:41Z", "bug_id": 43945, "creation_time": "2007-11-24T02:01:41Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 43945, "attachment_id": null, "text": "recompiled with --with-devrandom=/dev/urandom and stopped/started  14 times in a\nrow and each time httpd starts properly thanks, I guess its a slackware thing \nwhere it doesnt use it by default in first place.\nThanks again\n", "id": 111051, "time": "2007-11-24T04:16:49Z", "creator": "bugs@ausics.net", "creation_time": "2007-11-24T04:16:49Z", "is_private": false}]
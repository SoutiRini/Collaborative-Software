[{"count": 0, "tags": [], "text": "This is the code of close() in org.apache.tools.ant.util.ReaderInputStream:\n\n    public synchronized void close() throws IOException {\n        in.close();\n        slack = null;\n        in = null;\n    }\n\nThe problem comes from setting in to null (in = null, third statement). If one\ncall the close() method twice, a NullPointerException is thrown the second time!\nThis should not happen according to the contract of InputStream.close().\n\nFollowing scenario shows a situation where this is problematic:\n\npublic void example(  )\n{\n\tInputStream ins = null;\n\t\n\ttry\n\t{\n\t\t// do something with ins\n\t\t// ...\n\t\t\n\t\tins.close();\n\t\t\n\t\t// further processing\n\t\t// ...\n\t\t\n\t}\n\tcatch( IOException e )\n\t{\n\t\te.printStackTrace();\n\t}\n\tfinally\n\t{\n\t\t// here comes the problem: a NullPointerException is thrown!!!\n\t\tIOUtils.closeQuietly( ins );\n\t}\n}", "attachment_id": null, "id": 76798, "creator": "smarc@gmx.net", "time": "2005-06-29T17:15:18Z", "bug_id": 35544, "creation_time": "2005-06-29T17:15:18Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 35544, "text": "rather than not null-out the members, perhaps it would be better to add a null\ncheck against \"ins\"?", "count": 1, "id": 76799, "time": "2005-06-29T17:30:39Z", "creator": "carej@us.ibm.com", "creation_time": "2005-06-29T17:30:39Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 35544, "attachment_id": null, "id": 76802, "time": "2005-06-29T17:54:14Z", "creator": "smarc@gmx.net", "creation_time": "2005-06-29T17:54:14Z", "is_private": false, "text": "(In reply to comment #1)\n> rather than not null-out the members, perhaps it would be better to add a null\n> check against \"ins\"?\n\nYes, you're right. Sorry for the Summary of the Bug... I should have written\nsomething like \"ReaderInputStream.close() must check members for nullability\".\n\nThanks for the comment."}, {"count": 3, "tags": [], "bug_id": 35544, "text": "Fixed, thanks", "id": 76804, "time": "2005-06-29T18:30:19Z", "creator": "jkf@apache.org", "creation_time": "2005-06-29T18:30:19Z", "is_private": false, "attachment_id": null}]
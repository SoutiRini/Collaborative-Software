[{"count": 0, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "Created attachment 23650\nAdding stddef.h to header files using sentinel attribute.\n\nIn revision 683278 a sentinel attribute mark was introduced to some APR\nfunctions (trunk and 1.4).\n\nOn Solaris 8 and 10 using GCC 4 I get warnings about missing sentinels in function calls. It turns out, that this is due to \"NULL\" being defined as \"0\" instead of e.g. (void *)0.\n\nThis comes from the inclusion of sys/types.h, which leads to iso/time_iso.h being included. That file defines NULL as 0.\n\nsys/types.h occurs very early in the list of includes in apr.h\n\nFor gcc 4.1.2 I can add stddef.h, because the fixincludes\nversion of it defines NULL as (void *)0.\n\nUnfortunately apr does set HAVE_STDDEF_H only in apr_private.h, so we can't simply add something like\n\n#ifdef HAVE_STDDEF_H\n#include <stddef.h> /* NULL */\n#endif\n\nto apr_strings.h etc. I think we need to add APR_HAVE_STDDEF_H to\napr.h(.in) (and configure) so we can use\n\n#if APR_HAVE_STDDEF_H\n#include <stddef.h> /* NULL */\n#endif\n\nin apr_strings.h and apr_tables.h.\n\nI attach a patch for trunk and 1.4.x. The sentinel attribute does not exist in other branches.\n\nRegards,\n\nRainer", "id": 126975, "time": "2009-05-13T03:39:42Z", "bug_id": 47191, "creation_time": "2009-05-13T03:39:42Z", "is_private": false, "attachment_id": 23650}, {"count": 1, "tags": [], "text": "All supported platforms should have stddef.h, just include it unconditionally.", "is_private": false, "bug_id": 47191, "id": 126985, "time": "2009-05-13T06:17:31Z", "creator": "jorton@redhat.com", "creation_time": "2009-05-13T06:17:31Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Do you suggest to include it directly in apr.h (like we do e.g. in apr.hw), or like my patch does more fine-grained in those header files, that actually declare a function with a sentinel attribute?", "is_private": false, "bug_id": 47191, "id": 126987, "time": "2009-05-13T06:28:12Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2009-05-13T06:28:12Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 47191, "attachment_id": null, "is_private": false, "id": 126989, "time": "2009-05-13T06:53:36Z", "creator": "jorton@redhat.com", "creation_time": "2009-05-13T06:53:36Z", "text": "Doing it in apr.h near the includes for sys/types.h et al seems fine to me."}, {"count": 4, "tags": [], "bug_id": 47191, "attachment_id": 23661, "is_private": false, "id": 127005, "time": "2009-05-14T03:22:27Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2009-05-14T03:22:27Z", "text": "Created attachment 23661\nMinimal patch, including stddef.h unconditionally in apr.h\n\nThis is the minimal patch, I guess the way as proposed by Joe."}, {"count": 5, "tags": [], "bug_id": 47191, "attachment_id": 23662, "is_private": false, "id": 127006, "time": "2009-05-14T03:24:27Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2009-05-14T03:24:27Z", "text": "Created attachment 23662\nThe mid-size patch: include in apr.h, but detect via configure.\n\nThis is the variant I propose, because it includes stddef.h in apr.h, so we don't need to put it into every future header file where the attribute mark gets used, but on the other hand it is more consistent with the rest of apr.h (detecting the header file)."}]
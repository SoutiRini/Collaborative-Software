[{"count": 0, "tags": [], "bug_id": 17871, "is_private": false, "text": "The \"war\" task's \"webxml\" attrib is no longer able to use a value with a \nstarting backslash for the path in Windows.\n\nFor example, if the \"webxml\" attrib value is specified as \"\\test\\web.xml\", in \nprevious releases (before v1.5.2 [like v1.5Beta]), the \"war\" task was able to \ninterpret this as meaning that the \"web.xml\" file located in the \"test\" \ndirectory of the project's base drive should be used.\n\nWith the latest nightly build (and v1.5.2), the \"war\" task ignores the previous \nexample \"webxml\" attrib.\n\n(Note that other attribs of the \"war\" task like \"destfile\", \"basedir\", etc. are \nable to handle correctly values that start with \"\\\".  Perhaps this is due to \nthe fact that the \"war\" file subclasses the \"zip\" task.)", "id": 32945, "time": "2003-03-11T12:53:09Z", "creator": "stoehr@cincro.com", "creation_time": "2003-03-11T12:53:09Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "bodewig@apache.org", "is_private": false, "id": 33053, "time": "2003-03-12T16:26:35Z", "bug_id": 17871, "creation_time": "2003-03-12T16:26:35Z", "tags": [], "text": "Are you sure it gets ignored?  How do you check the resulting war archive?\n\nWinZIP?  Does your web.xml show up if you run \"jar tf\" against the war file?\n\nIf you answer yes to the last two questions, please mark this bug as a duplicate\nof bug 17648."}, {"attachment_id": null, "tags": [], "creator": "stoehr@cincro.com", "text": "I verified that it gets ignored.  I used both UnZip 5.41 and jar (JDK1.4.1_02) \n[both on Windows].\n\n(Besides, when the \"war\" task runs, it just so happens that there is a \"WEB-\nINF/web.xml\" file in the selected war files of the task, so the task \ndisplays \"[war] Warning: selected war files include a WEB-INF/web.xml which \nwill be ignored (please use webxml attribute to war task)\" when the \"webxml\" \nattrib of the task has something like \"\\Xxx\\Yyy\\Zzz.xml\" -- presumably because \nthe task was not able to find \"\\Xxx\\Yyy\\Zzz.xml\" to use as the \"web.xml\" file; \nbut when the \"webxml\" attrib is \"D:\\Xxx\\Yyy\\Zzz.xml\", then all is well.  Keep \nin mind that Ant is invoked on the Windows command line at the \"D:\" drive, the \nbuild file is also located on the \"D:\" drive, and all the files that the task \nuses are also on the \"D:\" drive.)\n\nSo I believe that this issue is NOT a duplicate of bug 17648.", "count": 2, "id": 33060, "time": "2003-03-12T16:45:27Z", "bug_id": 17871, "creation_time": "2003-03-12T16:45:27Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 17871, "text": "Hmm,\n\nthe main change is that the webxml attribute now uses <fileset>'s file\nattribute internally.  I don't have Windows around, could you please try this\nsnippet and port the result?\n\n<path id=\"foo\">\n  <fileset file=\"\\Xxx\\Yyy\\Zzz.xml\"/>\n</path>\n<property name=\"foo-as-prop\" refid=\"foo\"/>\n<echo>${foo-as-prop}</echo>\n\nand compare it to\n\n<path id=\"foo\">\n  <fileset file=\"D:\\Xxx\\Yyy\\Zzz.xml\"/>\n</path>\n<property name=\"foo-as-prop\" refid=\"foo\"/>\n<echo>${foo-as-prop}</echo>\n\nthey are supposed to echo the same file name.", "id": 33066, "time": "2003-03-12T17:04:24Z", "creator": "bodewig@apache.org", "creation_time": "2003-03-12T17:04:24Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "stoehr@cincro.com", "is_private": false, "id": 33068, "time": "2003-03-12T17:37:35Z", "bug_id": 17871, "creation_time": "2003-03-12T17:37:35Z", "tags": [], "text": "For the following \"test\" task:\n\n--------\n\n  <target name=\"test\">\n    <antcall target=\"test1\" />\n    <antcall target=\"test2\" />\n    <antcall target=\"test3\" />\n    <antcall target=\"test4\" />\n  </target>\n\n  <target name=\"test1\">\n    <path id=\"foo\">\n      <fileset file=\"\\Xxx\\Yyy\\Zzz.xml\"/>\n    </path>\n    <property name=\"foo-as-prop\" refid=\"foo\"/>\n    <echo>${foo-as-prop}</echo>\n  </target>\n\n  <target name=\"test2\">\n    <path id=\"foo\">\n      <fileset file=\"D:\\Xxx\\Yyy\\Zzz.xml\"/>\n    </path>\n    <property name=\"foo-as-prop\" refid=\"foo\"/>\n    <echo>${foo-as-prop}</echo>\n  </target>\n\n  <target name=\"test3\">\n    <war destfile=\"\\test3.war\"\n         webxml=\"\\Xxx\\Yyy\\Zzz.xml\">\n    </war>\n  </target>\n\n  <target name=\"test4\">\n    <war destfile=\"\\test4.war\"\n         webxml=\"D:\\Xxx\\Yyy\\Zzz.xml\">\n    </war>\n  </target>\n\n--------\n\n\nHere is the output:\n\n--------\n\nBuildfile: D:\\Stoehr\\cincro\\src\\build.xml\n\ntest:\n\ntest1:\n     [echo] D:\\Xxx\\Yyy\\Zzz.xml\n\ntest2:\n     [echo] D:\\Xxx\\Yyy\\Zzz.xml\n\ntest3:\n      [war] Building war: D:\\test3.war\n      [war] Warning: selected war files include a WEB-INF/web.xml which will be \nignored (please use webxml attribute to war task)\n\ntest4:\n      [war] Building war: D:\\test4.war\n\nBUILD SUCCESSFUL\nTotal time: 1 second\n\n--------\n"}, {"count": 5, "attachment_id": null, "creator": "stoehr@cincro.com", "is_private": false, "id": 33069, "time": "2003-03-12T17:48:26Z", "bug_id": 17871, "creation_time": "2003-03-12T17:48:26Z", "tags": [], "text": "One clarification about the \"test3\" and \"test4\" tasks are that there are no \nfiles to be included in the war file except for the \"web.xml\" file.  So it is \nweird to get the \"war\" warning for the \"test3\" task.\n\nAlso note that in both cases, the \"destfile\" attrib of the \"war\" task does not \ninclude the drive -- yet the \"war\" task was able to output both war files at \nthe correct location."}, {"count": 6, "tags": [], "bug_id": 17871, "text": "I can confirm the existence of this bug.\n\n\nI have done a test of this bug under Win2000 and  JDK 1.4.1_01-b01\n\n\nI think I also have found the origin of this bug :\n\n\n1)War.java#zipFile(File file, ZipOutputStream zOut, String vPath, \n\n\n                           int mode)\n\n\ncontains a line saying ... !deploymentDescriptor.equals(file) ...\n\n\nin test3 deploymentDescriptor = \\Xxx\\Yyy\\Zzz.xml\n\n\n         file                 = D:\\Xxx\\Yyy\\Zzz.xml\n\n\ntherefore War.java#zipFile refuses to include \\Xxx\\Yyy\\Zzz.xml into the war file\n\n\n\n\n\n\n2) AbstractFileSet.java does this\n\n\n   public void setFile(File file) {\n\n\n        ...\n\n\n        setDir(fileUtils.getParentFile(file));\n\n\n        ...\n\n\n    }\n\n\ngetParentFile returns D:\\Xxx\\Yyy\\ always, independently of whether file contains \nthe drive specification or not\n\n\n\n\n", "id": 33086, "time": "2003-03-12T22:28:42Z", "creator": "levylambert@tiscali-dsl.de", "creation_time": "2003-03-12T22:28:42Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "levylambert@tiscali-dsl.de", "attachment_id": 5298, "text": "Created attachment 5298\nfixes the problem in War.java", "id": 33091, "time": "2003-03-12T22:38:55Z", "bug_id": 17871, "creation_time": "2003-03-12T22:38:55Z", "is_private": false}, {"count": 8, "attachment_id": null, "creator": "bodewig@apache.org", "is_private": false, "id": 33108, "time": "2003-03-13T08:54:40Z", "bug_id": 17871, "creation_time": "2003-03-13T08:54:40Z", "tags": [], "text": "Hmm,  I see.\n\nI don't think using the canonical path is the correct solution (we'll technically\nthe solution is correct, but probably not in terms of how it should be\naddressed in Ant).\n\ndeploymentDescriptor should probably get the drive letter added to it in the\nfirst place - I'll look into it."}, {"count": 9, "tags": [], "bug_id": 17871, "is_private": false, "id": 33124, "creation_time": "2003-03-13T16:25:08Z", "time": "2003-03-13T16:25:08Z", "creator": "bodewig@apache.org", "text": "Could you please either try the next nightly build (i.e. 2003-03-14) or replace\nthe 1.5.2 ant.jar with the one from <http://cvs.apache.org/~bodewig/ant.jar>\nand see whether it fixes the problem?\n", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 17871, "is_private": false, "id": 33132, "creation_time": "2003-03-13T17:51:08Z", "time": "2003-03-13T17:51:08Z", "creator": "stoehr@cincro.com", "text": "After deleting the \"test?.war\" files and re-running the \"test\" target with the \nhttp://cvs.apache.org/~bodewig/ant.jar JAR, it now appears that the \"test3.war\" \nfile is generated with the appropriate \"web.xml\" file within it.\n\nThanks!", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 17871, "is_private": false, "text": "Thanks.", "id": 33191, "time": "2003-03-14T15:15:59Z", "creator": "bodewig@apache.org", "creation_time": "2003-03-14T15:15:59Z", "attachment_id": null}]
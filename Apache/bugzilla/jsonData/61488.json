[{"count": 0, "tags": [], "text": "Created attachment 35288\nmod_proxy_http patch\n\nFor a POST request proxied through mod_proxy_http, it looks like a response timeout is always handled by this block even after 100-continue has been received:\n\n            ap_log_rerror(APLOG_MARK, APLOG_ERR, rc, r, APLOGNO(01102)\n                          \"error reading status line from remote \"\n                          \"server %s:%d\", backend->hostname, backend->port);\n            if (APR_STATUS_IS_TIMEUP(rc)) {\n                apr_table_setn(r->notes, \"proxy_timedout\", \"1\");\n                ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r, APLOGNO(01103) \"read timeout\");\n                if (do_100_continue) {\n                    return ap_proxyerror(r, HTTP_SERVICE_UNAVAILABLE, \"Timeout on 100-Continue\");\n                }\n            }\n\n\nFor instance, logging shows a 100 response is received, but a \"Timeout on 100-continue\" is still indicated:\n\n[Fri Sep 01 15:59:25.264579 2017] [proxy_http:trace2] [pid 13455:tid 140308050339584] mod_proxy_http.c(1536): [client 127.0.0.1:55835] HTTP: received interim 100 response\n[Fri Sep 01 15:59:25.264583 2017] [dumpio:trace7] [pid 13455:tid 140308050339584] mod_dumpio.c(140): [remote 127.0.0.1:8080] mod_dumpio: dumpio_in [getline-blocking] 0 readbytes\n[Fri Sep 01 15:59:26.265697 2017] [dumpio:trace7] [pid 13455:tid 140308050339584] mod_dumpio.c(151): [remote 127.0.0.1:8080] mod_dumpio: dumpio_in - 70007\n[Fri Sep 01 15:59:26.265753 2017] [proxy_http:error] [pid 13455:tid 140308050339584] (70007)The timeout specified has expired: [client 127.0.0.1:55835] AH01102: error reading status line from remote server 127.0.0.1:8080\n[Fri Sep 01 15:59:26.265769 2017] [proxy_http:debug] [pid 13455:tid 140308050339584] mod_proxy_http.c(1264): [client 127.0.0.1:55835] AH01103: read timeout\n[Fri Sep 01 15:59:26.265785 2017] [proxy:error] [pid 13455:tid 140308050339584] [client 127.0.0.1:55835] AH00898: Timeout on 100-Continue returned by /app/page\n\n\nThis can result in unwanted worker error states.  Attached is a patch that addressed this on my end.", "attachment_id": 35288, "bug_id": 61488, "id": 200648, "time": "2017-09-04T13:54:46Z", "creator": "aogburn@redhat.com", "creation_time": "2017-09-04T13:54:46Z", "is_private": false}, {"count": 1, "tags": [], "text": "Fixed in trunk by r1807318", "attachment_id": null, "bug_id": 61488, "id": 200667, "time": "2017-09-05T12:02:01Z", "creator": "jfclere@gmail.com", "creation_time": "2017-09-05T12:02:01Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 61488, "attachment_id": null, "is_private": false, "id": 201870, "time": "2017-11-03T10:18:08Z", "creator": "suv3ndu@gmail.com", "creation_time": "2017-11-03T10:18:08Z", "text": "I found that Apache is \u201cmarking down\u201d a JVM once ProxyTimeout elapsed. This is what happens:\n 1. A process got kicked off on a JVM. Let\u2019s assume it is going to take lots of time(10 min) to complete.\n 2. While this processing is halfway, ProxyTimeout(5 min) elapsed.\n 3. Then Apache completely ignores default failontimeout=off setting and marks the JVM down for next 180 Sec(retry value).\n 4. Problem started!\n 5. Existing users logged on that JVM via that Apache instance\n\nThis behavior sounds like bug to me because:\n - If you forcefully failed a HTTP GET request by elapsing ProxyTimeout, Apache \n   *do not* mark the JVM down. It only fails that long running request with 502 \n   error. That is expected.\n - If you do the same thing for a HTTP POST request, Apache *mark the\n   JVM down*. I am pretty sure, this is *NOT* a desired behavior.\n\nI can easily reproduce the issue with Apache/2.4.10/2.4.25/2.4.28 versions. \n\nMy questions are: \nIs this fix is also going to take care this ProxyTimeout and other different types of timeout scenarios? If yes, from which version this fix will be generally available? If not, please let me know if I can open a separate bug. \n\n\nThanks!\nSuvendu\n\nLogs:\n[Thu Nov 02 19:25:39.810408 2017] [proxy_http:trace1] [pid 12484:tid 1204] mod_proxy_http.c(1904): [client ::1:59825] HTTP: serving URL http://localhost:8080/second.jsp, referer: http://localhost/\n[Thu Nov 02 19:25:39.810408 2017] [proxy:debug] [pid 12484:tid 1204] proxy_util.c(2154): AH00942: HTTP: has acquired connection for (localhost)\n[Thu Nov 02 19:25:39.810408 2017] [proxy:debug] [pid 12484:tid 1204] proxy_util.c(2208): [client ::1:59825] AH00944: connecting http://localhost:8080/second.jsp to localhost:8080, referer: http://localhost/\n[Thu Nov 02 19:25:39.810408 2017] [proxy:debug] [pid 12484:tid 1204] proxy_util.c(2417): [client ::1:59825] AH00947: connected /second.jsp to localhost:8080, referer: http://localhost/\n[Thu Nov 02 19:25:39.811908 2017] [proxy_http:trace3] [pid 12484:tid 1204] mod_proxy_http.c(1375): [client ::1:59825] Status from backend: 100, referer: http://localhost/\n[Thu Nov 02 19:25:39.811908 2017] [proxy_http:trace2] [pid 12484:tid 1204] mod_proxy_http.c(1536): [client ::1:59825] HTTP: received interim 100 response, referer: http://localhost/\n[Thu Nov 02 19:25:49.812161 2017] [proxy_http:error] [pid 12484:tid 1204] (OS 10060)A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.  : [client ::1:59825] AH01102: error reading status line from remote server localhost:8080, referer: http://localhost/\n[Thu Nov 02 19:25:49.812161 2017] [proxy_http:debug] [pid 12484:tid 1204] mod_proxy_http.c(1265): [client ::1:59825] AH01103: read timeout, referer: http://localhost/\n[Thu Nov 02 19:25:49.812161 2017] [proxy:error] [pid 12484:tid 1204] [client ::1:59825] AH00898: Timeout on 100-Continue returned by /second.jsp, referer: http://localhost/\n[Thu Nov 02 19:25:49.812655 2017] [proxy:debug] [pid 12484:tid 1204] proxy_util.c(2169): AH00943: HTTP: has released connection for (localhost)\n[Thu Nov 02 19:25:49.812655 2017] [proxy:debug] [pid 12484:tid 1204] proxy_util.c(1904): AH00933: BALANCER: too soon to retry worker for (localhost)\n[Thu Nov 02 19:25:49.812655 2017] [proxy_balancer:debug] [pid 12484:tid 1204] mod_proxy_balancer.c(307): [client ::1:59825] AH01160: Found value DAE82EC9814CC59C66442A5925C32EE7.Tomcat_1 for stickysession JSESSIONID, referer: http://localhost/\n[Thu Nov 02 19:25:49.813155 2017] [proxy_balancer:debug] [pid 12484:tid 1204] mod_proxy_balancer.c(320): [client ::1:59825] AH01161: Found route Tomcat_1, referer: http://localhost/\n[Thu Nov 02 19:25:49.813155 2017] [proxy:debug] [pid 12484:tid 1204] proxy_util.c(1904): AH00933: BALANCER: too soon to retry worker for (localhost)\n[Thu Nov 02 19:25:49.813155 2017] [proxy_balancer:error] [pid 12484:tid 1204] [client ::1:59825] AH01167: balancer://lb-mycluster: All workers are in error state for route (Tomcat_1), referer: http://localhost/"}, {"count": 3, "tags": [], "bug_id": 61488, "attachment_id": null, "text": "Can someone please let me know when this fix will be GA'ed?", "id": 202329, "time": "2017-11-22T09:30:20Z", "creator": "suv3ndu@gmail.com", "creation_time": "2017-11-22T09:30:20Z", "is_private": false}]
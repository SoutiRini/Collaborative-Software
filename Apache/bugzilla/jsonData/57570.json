[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 180982, "creation_time": "2015-02-11T22:40:53Z", "time": "2015-02-11T22:40:53Z", "bug_id": 57570, "text": "Two weeks ago Apache HTTPD 2.4.12 release was announced. It contains a fix for the following issue:\n\n<quote>\nCVE-2013-5704 (cve.mitre.org)\n core: HTTP trailers could be used to replace HTTP headers\n late during request processing, potentially undoing or\n otherwise confusing modules that examined or modified\n request headers earlier.  Adds \"MergeTrailers\" directive to restore\n legacy behavior.\n</quote>\n\n-> [1],[2].\n\n\nApparently this has been discussed in the open for about a year in relation to HTTPD [3] and in general [4], but I have not seen anyone raising the issue for Tomcat yet.\n\n\nIn Tomcat  chunked encoding trailers are processed by ChunkedInputFilter  (.parseEndChunk() -> .parseHeader()). The values are available as headers (TestChunkedInputFilter$EchoHeaderServlet)\n\nThis was implemented via bug 49860 and is available since 6.0.30, 7.0.5 in all current versions. (r1039090 in 6.0.x)\n\n\nIf we follow in HTTPD steps, a solution is to make processing of these trailers an opt-in feature, being off by default.  A mitigation is already available with the existing features: it is possible to limit size of trailer headers via configuration.\n\nTomcat 6: [5]\norg.apache.coyote.MAX_TRAILER_SIZE=0\n\nTomcat 7 and later: [6]\nmaxTrailerSize=\"0\" on an HTTP connector\n\n\nIn the simplest case \"making processing of trailers an opt-in feature\" means changing the defaults for those options to be 0.\n\nNote that setting those values to 0 does enforce the limit. It differs from \"just ignoring\" the headers. So there is a place for having a separate option.\n\nI think that if someone is actually using trailers, a better configuration option would be a white list of expected trailer names, with non-whitelisted trailers being ignored.\n\n\n\n[1] https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-5704\n[2] https://access.redhat.com/security/cve/CVE-2013-5704\n\n[3] http://marc.info/?l=apache-httpd-dev&m=139636309822854&w=2\n\"CVE-2013-5704, mod_headers and chunked trailer fields\"\nmail thread, April 2014\n\n[4] http://martin.swende.se/blog/HTTPChunked.html\n\"Chunked HTTP transfer encoding\"\n\n[5] http://tomcat.apache.org/tomcat-6.0-doc/config/systemprops.html#Other\n\n[6] http://tomcat.apache.org/tomcat-7.0-doc/config/http.html#Standard_Implementation", "is_private": false}, {"count": 1, "tags": [], "bug_id": 57570, "attachment_id": null, "id": 180983, "time": "2015-02-11T23:27:16Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2015-02-11T23:27:16Z", "is_private": false, "text": "The servlet specification (3.1) does not mention chunked encoding trailers. It would be better if there were a separate API to access them.  Treating trailers as proper headers is a simplification, it hides the difference between them."}, {"count": 2, "tags": [], "bug_id": 57570, "attachment_id": null, "id": 181477, "time": "2015-03-03T20:10:00Z", "creator": "markt@apache.org", "creation_time": "2015-03-03T20:10:00Z", "is_private": false, "text": "RFC 7230 has added additional constraints [1] for the handling of trailers.\n\n[1] http://tools.ietf.org/html/rfc7230#page-37"}, {"count": 3, "tags": [], "bug_id": 57570, "attachment_id": null, "id": 181723, "time": "2015-03-13T11:13:42Z", "creator": "markt@apache.org", "creation_time": "2015-03-13T11:13:42Z", "is_private": false, "text": "Fixed in trunk, 8.0.x (for 8.0.21 onwards) and 7.0.x (for 7.0.60 onwards) and proposed for 6.0.x."}, {"count": 4, "attachment_id": null, "bug_id": 57570, "is_private": false, "id": 182222, "time": "2015-04-02T12:51:44Z", "creator": "markt@apache.org", "creation_time": "2015-04-02T12:51:44Z", "tags": [], "text": "Fixed in 6.0.x for 6.0.44 onwards."}]
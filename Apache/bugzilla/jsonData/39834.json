[{"count": 0, "tags": [], "text": "I am using mod_jk 1.2.15 with Apache 2.0.58 on x64 Linux.\n\nWhen JkLogLevel is set to debug, \"apachectl graceful\" reproducably causes \nsegmentation faults. Occasionally they occur at other times as well.\n\n[Mon Jun 19 11:47:19 2006] [error] (43)Identifier removed: apr_global_mutex_lock\n(jk_log_lock) failed\n[Mon Jun 19 11:47:19 2006] [notice] child pid 17568 exit signal Segmentation \nfault (11)\n\nThe eror occurs in ap_log_rerror (), called from jk_log_to_file ().", "attachment_id": null, "bug_id": 39834, "id": 90352, "time": "2006-06-19T12:06:53Z", "creator": "mail@ulfm.de", "creation_time": "2006-06-19T12:06:53Z", "is_private": false}, {"count": 1, "tags": [], "text": "I fixed a similar problem in the forthcoming 1.2.16.\n\nCould you please enable core dumping and get a backtrace via gdb, so that we can\ncheck which jk method called jk_log_to_file? From your report I assume you\nalreyd have a full stack?\n\nAlso: if you are able to build from SVN trunk, please do so and retry!\n\nDoes the problem occur wuth \"apachectl restart\" also?\n\nFinally, could you please give some details on your Linux (kernel version) and\nGCC version.", "is_private": false, "bug_id": 39834, "id": 90368, "time": "2006-06-19T17:34:52Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-06-19T17:34:52Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 39834, "attachment_id": null, "id": 90392, "time": "2006-06-20T10:39:20Z", "creator": "mail@ulfm.de", "creation_time": "2006-06-20T10:39:20Z", "is_private": false, "text": "I tried the version from SVN. The problem still occurs:\n\n#0  0x080a085e in ap_log_rerror ()\n#1  0x558eeacc in jk_log_to_file (l=0x814bc58, level=1, \n    what=0xffff9390 \"[Tue Jun 20 08:55:56 2006] [4415:24352] [debug] \njk_cleanup_shmem::mod_jk.c (1758): Shmem cleanup\\n\") at mod_jk.c:2199\n#2  0x558f6dda in jk_log (l=0x814bc58, file=0x5590db20 \"mod_jk.c\", line=1758, \nfuncname=0x5590de7e \"jk_cleanup_shmem\", level=1, fmt=0x5590de70 \"Shmem cleanup\")\n    at jk_util.c:372\n#3  0x558ee9c9 in jk_cleanup_shmem (data=0x814bc58) at mod_jk.c:1758\n#4  0x5574269f in run_cleanups () from /abcdef/lib/libapr-0.so.0\n#5  0x55741bdc in apr_pool_destroy () from /abcdef/lib/libapr-0.so.0\n#6  0x08096a9b in clean_child_exit ()\n#7  0x080984c6 in child_main ()\n#8  0x080985dc in make_child ()\n#9  0x08098bc4 in perform_idle_server_maintenance ()\n#10 0x08098e30 in server_main_loop ()\n#11 0x080991dd in ap_mpm_run ()\n#12 0x080a28c3 in main ()\n\n\"apachectl restart\" doesn't cause the error.\n\nGCC is version 3.3.3, Linux kernel 2.6.5.\n"}, {"count": 3, "tags": [], "bug_id": 39834, "text": "Fixed in the SVN.\nThe problem was caused by the ordering of apr_pool_t cleanup\ncalls. The simples solution is to remove the DEBUG logging\non shmem cleanup hook.\n", "id": 90578, "time": "2006-06-24T10:47:38Z", "creator": "mturk@apache.org", "creation_time": "2006-06-24T10:47:38Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 39834, "attachment_id": null, "text": "*** Bug 39914 has been marked as a duplicate of this bug. ***", "id": 90679, "time": "2006-06-27T20:56:03Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-06-27T20:56:03Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 39834, "attachment_id": null, "text": "hi\n\nWe are now facing the same problem.\nWe are using mod_jk 1.2.18 with Apache 2.0.58 in RHELv3.\n\nWhen JkLogLevel is set to error (not only debug), \"apachectl graceful\" causes \nsegmentation faults. \nDid the problem be fixed already?\n\nCould you give us any idea to solve this problem?\n\n- Reproduction steps\n 1. making a rush with 10 multiple users\n 2. # mv access_log access_log.1\n    (we'd like to rotate the log file when we reboot Apache(graceful).)\n 3. # apachectl graceful\n\n\n- error_log\n[Tue Aug 22 15:35:06 2006] [notice] Graceful restart requested, doing restart  \nhttpd: Could not determine the server's fully qualified domain name, using 127.\n.0.1 for ServerName                                                            \n[Tue Aug 22 15:35:06 2006] [notice] Apache configured -- resuming normal operat\nons                                                                            \n[Tue Aug 22 15:35:09 2006] [error] (43)Identifier removed: apr_global_mutex_loc\n(jk_log_lock) failed                                                           \n[Tue Aug 22 15:35:09 2006] [error] (43)Identifier removed: apr_global_mutex_loc\n(jk_log_lock) failed                                                           \n[Tue Aug 22 15:35:09 2006] [error] (43)Identifier removed: apr_global_mutex_loc\n(jk_log_lock) failed                                                           \n[Tue Aug 22 15:35:09 2006] [error] (43)Identifier removed: apr_global_mutex_loc\n(jk_log_lock) failed                                                           \n[Tue Aug 22 15:35:10 2006] [notice] child pid 1958 exit signal Segmentation fau\nt (11)                                                                         \n[Tue Aug 22 15:35:10 2006] [notice] child pid 1960 exit signal Segmentation fau\nt (11)                                                                         \n[Tue Aug 22 15:35:10 2006] [notice] child pid 1962 exit signal Segmentation fau\nt (11)                                                                         \n[Tue Aug 22 15:35:10 2006] [notice] child pid 1963 exit signal Segmentation fau\nt (11)                                                                         \n", "id": 92392, "time": "2006-08-22T10:09:29Z", "creator": "y3-tanaka@nri.co.jp", "creation_time": "2006-08-22T10:09:29Z", "is_private": false}, {"count": 6, "tags": [], "text": "I could not reproduce the segfaults with mod_jk 1.2.18/httpd 2.0.58:\n\nSetting JkLogLevel to error and stressing apache with requests going to tomcat \nand sleeping there for 50 ms with a parallelity of 20 did not produce any \nproblem during \"apachectl graceful\".\n\nWhen I increased JkLogLevel to debug, I could reproduce the apr_global_mutex_* \nmessages, but still *not* the segfaults.\n\nPlatform was Linux x86_64 (SLES 9 SP2).\n\nDo you use piped logs for mod_jk? Is it possible, that the reason for the \nsegfaults is another module? Are you loading any unusual modules?\n\nIn case you want to discuss this further, please open another bugzilla.\n", "attachment_id": null, "bug_id": 39834, "id": 92434, "time": "2006-08-22T20:53:18Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-08-22T20:53:18Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 39834, "text": "I have tried to reproduce the graceful segv, but cannot reproduce too.\nPlatform is: RHEL4U3, kernel-2.6.9-34.EL, httpd-2.0.52-22.ent, mod_jk 1.2.18.", "id": 92444, "time": "2006-08-23T01:41:36Z", "creator": "takayoshi@gmail.com", "creation_time": "2006-08-23T01:41:36Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 39834, "attachment_id": null, "text": "Thank you for your quick reply.\n\n> In case you want to discuss this further, please open another bugzilla.\nI'll open another bugzilla if i can't resolve this problem after some our tests.\n\nthansks,\n", "id": 92455, "time": "2006-08-23T10:00:45Z", "creator": "y3-tanaka@nri.co.jp", "creation_time": "2006-08-23T10:00:45Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 39834, "text": "r417586 and r416898 seem to apply to this issue.", "id": 95640, "time": "2006-11-09T18:18:17Z", "creator": "dlr@apache.org", "creation_time": "2006-11-09T18:18:17Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 52651, "attachment_id": null, "id": 153727, "time": "2012-02-13T13:08:39Z", "creator": "jeanva@gmail.com", "creation_time": "2012-02-13T13:08:39Z", "is_private": false, "text": "Hello,\n\nconfig:\nwe are running apache 2.2.15 with mod_jk 1.2.32 (as module) on rhel 5, 64 bit servers.\n\nthe jk.conf include\nJkShmSize 256\nJkShmFile tmp/jk.shm\n\nissue description:\nBefore last week everything was working fine.\nWe then add some more workers in our config (till we had 361 workers configured) and then issue begin:\n - in the mod_jk log file i saw that sometimes, the apache consider the workers as down. the connection was working 90% of the time, but 10% of the connections were replied with a 503 error.\n - I saw at tcp level that apache sent SYN to the jboss, jboss replies with the SYN-ACK, then apache directly send a RST package.\n - when stopping the apache and starting again, it fails with the error \"You can remove the JkShmSize directive if you want to use the optimal size\" in the mod_jk log\n\nI made a lot of tests, removing the jkshmsize directive, setting it to 512, 1024 or even 4096 but without success\n\nI had to reduce the numbers of workers configured in order to solve the issue. \n\nSounds like the jkshmfile is limited in size leading to some kind of memory issue when we configure more than +- 325 workers. \n\ncould you check that ? \n\nbrgds\n\nJF"}, {"count": 1, "tags": [], "bug_id": 52651, "attachment_id": null, "is_private": false, "id": 153741, "time": "2012-02-13T16:54:56Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-02-13T16:54:56Z", "text": "Version 1.2.32 is able to comute the needed shared memory size without the need for the JkShmSize configuration directive. It is a leftover from previous versions. Remove it (I think mod_jk now logs an info or warning during startup, that you should remove it).\n\nWhether there's a problem with too many workers or not? I wouldn't expect one, but your experience contradicts myexpectation. So let's first see what happens if you remove that configuration directive completely.\n\nIf it still doesn't work, please post whatever the JK log file contains during the startup and the first test request. It would help, if you could increse the JkLogLevel for this simple test to debug (or even better trace).\n\nRegards,\n\nRainer"}, {"count": 2, "attachment_id": 28339, "bug_id": 52651, "text": "Created attachment 28339\nmod_jk log with JKshmsize set to 256", "id": 153837, "time": "2012-02-16T15:38:15Z", "creator": "jeanva@gmail.com", "creation_time": "2012-02-16T15:38:15Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 52651, "text": "Created attachment 28340\nmod_jk log without the JKshmsize set", "id": 153838, "time": "2012-02-16T15:38:50Z", "creator": "jeanva@gmail.com", "creation_time": "2012-02-16T15:38:50Z", "is_private": false, "attachment_id": 28340}, {"count": 4, "tags": [], "creator": "jeanva@gmail.com", "attachment_id": 28341, "text": "Created attachment 28341\nworker.properties with 350 workers", "id": 153839, "time": "2012-02-16T15:39:34Z", "bug_id": 52651, "creation_time": "2012-02-16T15:39:34Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 52651, "is_private": false, "text": "Hello,\n\nI made some more tests with 350 workers with and without the JKshmsize (set to 256 or removed) (see workers.properties in attach)\nwith the JKshmsize set to 256 apache won't start\nwitout the settings, apache start as expected.\n\nnow, i've to generate enough load to generate 503 errors, and be able to see the RST packages from apache... \n\nI can easily reproduce it on our \"real\" environment, but i have a lot of poeple working there... and i cannot blocke their testing :-s\n\nJF", "id": 153840, "time": "2012-02-16T15:43:59Z", "creator": "jeanva@gmail.com", "creation_time": "2012-02-16T15:43:59Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 52651, "text": "Created attachment 28379\napache config & logs from my tests\n\nhello, \n\nin attach i've put the httpd.conf, the worker.conf, jk.conf and vhost.conf.\nyou'll also find the logs.\n\nin mod_jk_log.20120224.120000 log, you'll see that we have \"connecting to backend failed\" errors for worker above worker151-node1 (while all workers have the same config... ) \n\nthe jkshmsize is not limited, so theoretically we should be able to use as many as needed workers... \n\ncould you keep me updated on this ? \n\nmany thanks\n\nJean-Francois", "id": 154109, "time": "2012-02-24T13:47:33Z", "creator": "jeanva@gmail.com", "creation_time": "2012-02-24T13:47:33Z", "is_private": false, "attachment_id": 28379}, {"count": 7, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "is_private": false, "id": 179920, "time": "2014-12-21T19:32:04Z", "bug_id": 52651, "creation_time": "2014-12-21T19:32:04Z", "text": "I had a detailed look at this. The original log and the later provided log both indicate that the startup procedure for the first Apache parent process is truncated. But both runs seem to break at different places. Looking at the code I can't find a common reason for this.\n\nTrying to reproduce here using version 1.2.32 and also 1.2.40 and 1.2.41-dev didn't succeed. In my test environment I don't get a problem during startup, all workers seem to initialize correctly. I was using Apache 2.4 though.\n\nI would be interested to know, if you can still reproduce with current 1.2.40 or even 1.2.41 once we start to do release testing. I'm resolving this as WORKSFORME now. Feel free to reopen, if the problem still persists with newer versions of mod_jk and Apache for you.\n\nThanks and regards,\n\nRainer"}]
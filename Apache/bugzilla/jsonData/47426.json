[{"count": 0, "tags": [], "creator": "bart.vanhaute@punchtelematix.com", "attachment_id": null, "text": "I have a web service deployed on tomcat-5.5.15 (bundled in jboss-4.2.3). The web-service is reacheable from an apache 2.2.11 web server, through mod_jk 1.2.29. Everything is deployed on openSuSE 11.0 (but with updated apache en mod_jk packages). \n\nIn the following scenario, I get a strange 400 Bad Request error report back:\nOn the same connection, sent two POST requests (HTTP/1.1 with connection keep-alive). The value of the content length of the first request is between 512 and 768 bytes. The size of the second POST request does not matter.\n\nIn the server logs, I see:\n\njava.lang.ArrayIndexOutOfBoundsException: 15432\n\tat org.apache.coyote.ajp.AjpMessage.getInt(AjpMessage.java:301)\n\tat org.apache.coyote.ajp.AjpMessage.getBytes(AjpMessage.java:327)\n\tat org.apache.coyote.ajp.AjpProcessor.prepareRequest(AjpProcessor.java:641)\n\tat org.apache.coyote.ajp.AjpProcessor.process(AjpProcessor.java:425)\n\tat org.apache.coyote.ajp.AjpProtocol$AjpConnectionHandler.process(AjpProtocol.java:366)\n\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:446)\n\tat java.lang.Thread.run(Thread.java:595)\n\n\nThe strange thing is, if the size is smaller than 512 or bigger than 768, I get no Bad Request result. If I do the requests directly to tomcat, there is also no problem. \n\nI am not sure the problem is in tomcat or in mod_jk, I just picked the most plausible one. The trace logging of mod_jk does not show any problems: the second request is printed correctly.", "id": 128274, "time": "2009-06-25T07:14:26Z", "bug_id": 47426, "creation_time": "2009-06-25T07:14:26Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "is_private": false, "count": 1, "id": 132509, "time": "2009-11-30T16:40:17Z", "bug_id": 47426, "creation_time": "2009-11-30T16:40:17Z", "text": "The APR classes quoted in the stack trace were not added to Tomcat 6 until\nseveral months after Tomcat 5.5.15 was released. If that Tomcat version is\naccurate, this looks like a local change in the JBoss source tree.\nAdditionally, that particular APR connector is not the default APR connector in\n6.0.x and has to be explicitly enabled.\n\nI have run your test using the latest 6.0.x code and I can't reproduce this\nproblem. I'd suggest upgrading JBoss to a more recent version that uses a newer\nversion of Apache Tomcat."}]
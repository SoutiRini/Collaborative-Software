[{"count": 0, "tags": [], "bug_id": 42381, "text": "When loading a document with no 'viewBox' attribute in the header, the last line\nof the JSVGScrollPane.getViewBoxRect method throws a NullPointerException.  This\nhappens because the GraphicsNode (gn) is present (not null), but 'getBounds()'\nreturns null, so 'gn.getBounds().clone()' on the last line of the method throws\nNullPointerException.\n\nSuggested fix:\nat the end of the JSVGScrollPane.getViewBoxRect method,\nchange\n        return (Rectangle2D)gn.getBounds().clone();\nto\n        Rectangle2D bounds = gn.getBounds();\n        if (bounds == null) return null;\n\n        return (Rectangle2D) bounds.clone();\n[end patch]\n\nImpact of bug:  The bug is annoying but not severe: \nEventDispatcher.dispatchEvent catches the exception (as Throwable) and does\n'.printStackTrace()', sending it to System.err.  It's annoying and causes people\nto get nervous, to see a NullPointerException in the output/log every time an\nimage is loaded.  But other than that, the effect of the exception is about the\nsame as more careful null checking and returning null, as is done in most other\ncases in the JSVGScrollPane.getViewBoxRect method:  Returning null pretty much\ncauses the callers to avoid doing any further processing, and the exception\naccomplishes the same result, less gracefully.   ;->\n\nHas been observed in both Microsoft Windows and Linux environments.\n\n\nExample problem document:\n<?xml version=\"1.0\" standalone=\"no\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" id=\"body\" width=\"2048\" height=\"1536\" ></svg>\n\nExample good document:\n<?xml version=\"1.0\" standalone=\"no\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" id=\"body\" width=\"2048\" height=\"1536\"\nviewBox=\"0 0 800 600\" ></svg>\n\n\nStack trace:\njava.lang.NullPointerException\n\tat org.apache.batik.swing.JSVGScrollPane.getViewBoxRect(JSVGScrollPane.java:607)\n\tat\norg.apache.batik.swing.JSVGScrollPane.checkAndSetViewBoxRect(JSVGScrollPane.java:584)\n\tat org.apache.batik.swing.JSVGScrollPane.resizeScrollBars(JSVGScrollPane.java:451)\n\tat\norg.apache.batik.swing.JSVGScrollPane$ScrollListener.gvtRenderingCompleted(JSVGScrollPane.java:391)\n\tat org.apache.batik.swing.gvt.GVTTreeRenderer$4.dispatch(GVTTreeRenderer.java:193)\n\tat org.apache.batik.util.EventDispatcher.dispatchEvent(EventDispatcher.java:103)\n\tat org.apache.batik.util.EventDispatcher.fireEvent(EventDispatcher.java:87)\n\tat org.apache.batik.util.EventDispatcher$1.run(EventDispatcher.java:46)\n\tat java.awt.event.InvocationEvent.dispatch(InvocationEvent.java:199)\n\tat java.awt.EventQueue.dispatchEvent(EventQueue.java:461)\n\tat\njava.awt.EventDispatchThread.pumpOneEventForHierarchy(EventDispatchThread.java:242)\n\tat\njava.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:163)\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:157)\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:149)\n\tat java.awt.EventDispatchThread.run(EventDispatchThread.java:110)", "id": 103039, "time": "2007-05-10T08:24:29Z", "creator": "Jeff.Grigg@asolutions.com", "creation_time": "2007-05-10T08:24:29Z", "is_private": false, "attachment_id": null}, {"id": 108690, "tags": [], "bug_id": 42381, "attachment_id": null, "count": 1, "text": "Yep agreed, thanks!  Fixed in SVN now.", "time": "2007-09-26T20:56:21Z", "creator": "cam@apache.org", "creation_time": "2007-09-26T20:56:21Z", "is_private": false}]
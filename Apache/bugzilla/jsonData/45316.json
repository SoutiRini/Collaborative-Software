[{"count": 0, "tags": [], "bug_id": 45316, "text": "rpmbuild cannot build rpm when called from ant. Ant called rpmbuid with\nfollowing parameters (example taken using strace):\n\n\"/usr/bin/rpmbuild\" \"--define\"\n\"_topdir/home/vlisivka/svnwork/ops/trunk-clean/tools/prr-mysqld_multi/build\"\n\"-bb\" \"--clean\" \"SPECS/prr-mysqld_multi.spec\"\n\nrpmbuild reports following error:\n\n      [rpm] Building the RPM based on the prr-mysqld_multi.spec file\n      [rpm] error: File\n/home/vlisivka/svnwork/ops/trunk_clean/tools/prr_mysqld_multi/build/SOURCES/prr-mysqld_multi-3.2.tar.gz:\nNo such file or directory\nBUILD FAILED\n\nNote the strange \"_\" character inserted instead of \"-\" in \".../trunk-clean/...\".\n\nVersion-Release number of selected component (if applicable):\n\nant-1.7.0-1jpp.4.fc9.i386\n\nThe problem is in parameter for --define option: _topdir and path must be separated by space to work correctly (but they must remain as single parameter). Example:\n  \"--define\" \"_topdir /home/vlisivka/svnwork/ops/trunk-clean/tools/prr-mysqld_multi/build\"\n\nNote the space between \"_topdir\" and rest of parameter.\n\nWhen rpmbuild is called manually with corrected argument, it works fine.\n\nHow to test:\n\n  * install Fedora 9;\n  * create temporary directory with \"-\" in path, e.g. /tmp/foo-bar;\n  * unarchive example project to that directory (see attachment);\n  * try to build project using \"ant\" command.\n\nActual result:\n\n-(/tmp/foo-bar:$)-> ant\nBuildfile: build.xml\n\nrpm:\n      [rpm] Building the RPM based on the example.spec file\n      [rpm] Processing files: example-1-1\n      [rpm] Checking for unpackaged file(s): /usr/lib/rpm/check-files %{buildroot}\n      [rpm] error: cannot create /tmp/foo_bar/build/RPMS/noarch: No such file or directory\n      [rpm] error: Could not open /tmp/foo_bar/build/RPMS/noarch/example-1-1.noarch.rpm: No such file or directory\n      [rpm] \n      [rpm] \n      [rpm] RPM build errors:\n      [rpm]     cannot create /tmp/foo_bar/build/RPMS/noarch: No such file or directory\n      [rpm]     Could not open /tmp/foo_bar/build/RPMS/noarch/example-1-1.noarch.rpm: No such file or directory\n\nBUILD FAILED\n/tmp/foo-bar/build.xml:24: '/usr/bin/rpmbuild' failed with exit code 1\n\nTotal time: 0 seconds\n\n\nExpected result:\n\n-(/tmp/foobar:$)-> ant\nBuildfile: build.xml\n\nrpm:\n      [rpm] Building the RPM based on the example.spec file\n      [rpm] Processing files: example-1-1\n      [rpm] Checking for unpackaged file(s): /usr/lib/rpm/check-files %{buildroot}\n      [rpm] Wrote: /tmp/foobar/build/RPMS/noarch/example-1-1.noarch.rpm\n      [rpm] Executing(--clean): /bin/sh -e /var/tmp/rpm-tmp.33406\n      [rpm] + umask 022\n      [rpm] + cd /tmp/foobar/build/BUILD\n      [rpm] + exit 0\n\nBUILD SUCCESSFUL\n\n\nWorkaround:\nThis small shell wrapper script can be used as workaround:\n\n#!/bin/bash\nOPTIONS=( )\nfor I in \"$@\"\ndo\n  [[ \"$I\" == _topdir* ]] && I=\"_topdir ${I#_topdir}\"\n  OPTIONS[${#OPTIONS[@]}]=\"$I\"\ndone\nrpmbuild.orig \"${OPTIONS[@]}\"\n\n\nJust rename original rpmbuild tool to rpmbuild.orig and sotre the shell script as /usr/bin/rpmbuild (don't forget to chmod a+rwx /usr/bin/rpmbuild).\n\n\nSee also: https://bugzilla.redhat.com/show_bug.cgi?id=453121", "id": 118148, "time": "2008-07-01T05:56:17Z", "creator": "vlisivka@gmail.com", "creation_time": "2008-07-01T05:56:17Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 45316, "attachment_id": 22201, "id": 118149, "time": "2008-07-01T05:57:51Z", "creator": "vlisivka@gmail.com", "creation_time": "2008-07-01T05:57:51Z", "is_private": false, "text": "Created attachment 22201\nExample build.xml and .spec file"}, {"count": 2, "tags": [], "bug_id": 45316, "attachment_id": null, "id": 118150, "time": "2008-07-01T06:38:52Z", "creator": "hgomez@apache.org", "creation_time": "2008-07-01T06:38:52Z", "is_private": false, "text": "The RPM spec is not maintened for ages. And I recommand you to check jpackage initiative (www.jpackage.org), where ant and majors Java projects are actively maintened\n\nRegards"}, {"count": 3, "tags": [], "bug_id": 45316, "text": "Please, commit this trivial patch:\n\ndiff -rub\napache-ant-1.7.0.orig/src/main/org/apache/tools/ant/taskdefs/optional/Rpm.java\napache-ant-1.7.0/src/main/org/apache/tools/ant/taskdefs/optional/Rpm.java\n---\napache-ant-1.7.0.orig/src/main/org/apache/tools/ant/taskdefs/optional/Rpm.java \n    2006-12-13 14:16:22.000000000 +0200\n+++ apache-ant-1.7.0/src/main/org/apache/tools/ant/taskdefs/optional/Rpm.java  \n2008-07-02 16:10:42.000000000 +0300\n@@ -120,7 +120,7 @@\n                                 : rpmBuildCommand);\n         if (topDir != null) {\n             toExecute.createArgument().setValue(\"--define\");\n-            toExecute.createArgument().setValue(\"_topdir\" + topDir);\n+            toExecute.createArgument().setValue(\"_topdir \" + topDir);\n         }\n\n         toExecute.createArgument().setLine(command);\n\n-\n", "id": 118193, "attachment_id": null, "creator": "vlisivka@gmail.com", "creation_time": "2008-07-02T06:45:13Z", "time": "2008-07-02T06:45:13Z", "is_private": false}, {"count": 4, "tags": [], "creator": "vlisivka@gmail.com", "attachment_id": null, "text": "Can someone apply that one symbol patch or it will stay forever?", "id": 127778, "time": "2009-06-10T02:15:13Z", "bug_id": 45316, "creation_time": "2009-06-10T02:15:13Z", "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 45316, "text": "(In reply to comment #2)\n> The RPM spec is not maintened for ages. And I recommand you to check jpackage\n> initiative (www.jpackage.org), where ant and majors Java projects are actively\n> maintened\n> \n> Regards\n\n(In reply to comment #4)\n> Can someone apply that one symbol patch or it will stay forever?\n\nIt looks like there is a misunderstanding here.  This bug is not about Ant's old spec file; the problem is that the Ant RPM task isn't calling rpmbuild properly for newer versions of RPM.\n\nFor the record, I encountered this bug on Red Hat Enterprise Linux 5.3 while setting topdir in my Ant build file.  It would really help if the suggest patch was applied.  For now, I'm working around it by making sure my topdir doesn't have any hyphens in it.", "id": 128035, "time": "2009-06-17T14:41:00Z", "creator": "Joseph.Wilkicki@gtech.com", "creation_time": "2009-06-17T14:41:00Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 45316, "text": "Trivial one-character bug is still no applied because Henri Gomez just ignores it for more than 1 year. Is Henri Gomez still alive? Can he respond here?", "count": 6, "id": 131808, "time": "2009-11-09T03:09:10Z", "creator": "vlisivka@gmail.com", "creation_time": "2009-11-09T03:09:10Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 45316, "attachment_id": null, "id": 141384, "time": "2010-11-04T09:11:39Z", "creator": "bodewig@apache.org", "creation_time": "2010-11-04T09:11:39Z", "is_private": false, "text": "you are talking about the rpm task, not about RPM containing Ant that we once provided (or better, Henri Gomez once did).\n\nUnfortunately I lack the karma to change the \"assigned to\" field, so either Volodymyr or Henri must change it to notifications@ant.a.o"}, {"count": 8, "tags": [], "bug_id": 45316, "text": "this bug is a duplicate of 46659 which is fixed.\n\n*** This bug has been marked as a duplicate of bug 46659 ***", "id": 141462, "attachment_id": null, "creator": "antoine@apache.org", "creation_time": "2010-11-05T04:27:46Z", "time": "2010-11-05T04:27:46Z", "is_private": false}]
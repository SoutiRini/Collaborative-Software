[{"count": 0, "tags": [], "text": "I am using Tomcat 4.1.24 on an IBM iSeries (formerly AS/400).\nI cannot access a class that resides in a JAR file (utilities.jar) in \n$CATALINA_HOME/shared/lib and get a java.lang.NoClassDefFoundError.\n\nI wrote a very simple servlet to reproduce this problem. It attempts to use \na class (CASDate) in the shared dir. \n---- \nimport com.myco.utilities.CASDate; \nimport javax.servlet.http.HttpServlet; \nimport javax.servlet.http.HttpServletRequest; \nimport javax.servlet.http.HttpServletResponse; \n\npublic class Test1 extends HttpServlet { \n\npublic void doGet(HttpServletRequest request, HttpServletResponse \nresponse) throws javax.servlet.ServletException, java.io.IOException { \n\nSystem.out.println(\"GET method of Test1 invloked\"); \nperformTask(request, response); \n} \n// \npublic void doPost(HttpServletRequest request, HttpServletResponse \nresponse) throws javax.servlet.ServletException, java.io.IOException { \n\nSystem.out.println(\"POST method of Test1 invloked\"); \nperformTask(request, response); \n} \n/** \n* Test the use of a shared class. \n*/ \npublic void performTask(HttpServletRequest request, HttpServletResponse \nresponse) { \n\ntry { \njava.io.PrintWriter pw = response.getWriter(); \nCASDate today = new CASDate(); \npw.println(\"CASDate today is \" + today.toString()); \npw.println(\"CASDate class loaded...\"); \n} \ncatch(Throwable theException) { \nSystem.out.println(\"Error...\"); \ntheException.printStackTrace(System.out); \n} \n} \n} \n---- \nThis is the utility class (some getXXX methods deleted for brevity): \n---- \npackage com.myco.utilities; \n\nimport java.util.Calendar; \nimport java.util.GregorianCalendar; \n\npublic class CASDate { \nprivate int ccc = 0; \nprivate int yyy = 0; \nprivate int mmm = 0; \nprivate int ddd = 0; \nprivate int time = 0; \n/** \n* Default constructor is to create CAS date using the current date. \n*/ \npublic CASDate() { \nsuper(); \nGregorianCalendar cal = new GregorianCalendar(); \nccc = 20; \nyyy = cal.get(Calendar.YEAR) - 2000; \nmmm = cal.get(Calendar.MONTH) + 1; \nddd = cal.get(Calendar.DAY_OF_MONTH); \n} \n/** \n* Return a string in MM/DD/CCYY format. \n*/ \npublic String toString() { \nString returnValue = getMonth() + \"/\" + getDay() + \"/\" + \ngetYearAndCentury(); \nreturn returnValue; \n} \n} \n---- \n\nThe error I get is: \njava.lang.NoClassDefFoundError: com/myco/utilities/CASDate \n\nWhen I moved utilities.jar to my <webapp>/WEB-INF/lib the error goes away so I\nknow it is not a coding error.\nThe error also goes away when I put the JAR file in $CATALINA_HOME/common/lib\nbut the documentation says:\n\n\"For classes and resources that must be shared across all web applications,\nplace unpacked classes and resources under $CATALINA_HOME/shared/classes, or\nplace JAR files containing those classes and resources under\n$CATALINA_HOME/shared/lib.\" \n\nPlease update the documentation or fix the functionality to save others the\nheadaches I've experienced.\n\nThank you.", "is_private": false, "bug_id": 18577, "id": 34267, "time": "2003-04-01T18:51:10Z", "creator": "bahbahbooie@go.com", "creation_time": "2003-04-01T18:51:10Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "remm@apache.org", "text": "I think this is a user error. I will try to reproduce this issue using a simple\nbean (attaching an easy to run test case would have helped).", "id": 35515, "time": "2003-04-18T13:35:19Z", "bug_id": 18577, "creation_time": "2003-04-18T13:35:19Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "bahbahbooie@go.com", "attachment_id": null, "id": 36259, "time": "2003-04-29T05:23:36Z", "bug_id": 18577, "creation_time": "2003-04-29T05:23:36Z", "is_private": false, "text": "I would love it if this were a user error.\nMy example is easily reproducable so I fear it is not a user error.\nMoving the jar file from $CATALINA_HOME/shared/lib to $CATALINA_HOME/common/lib \nsolved the problem immediately.\n\nThanks for the reply.\n"}, {"count": 3, "tags": [], "creator": "william.barker@wilshire.com", "text": "I'd suggest a reading of:\nhttp://jakarta.apache.org/tomcat/tomcat-4.1-doc/class-loader-howto.html\n\nIt seems that you are loading the Servlet from common, and the bean from \nshared.  This is not supported.  \n\nPlease feel free to re-open with (and only with :) a web-app that demonstrates \nthis problem.  ", "id": 36265, "time": "2003-04-29T06:54:04Z", "bug_id": 18577, "creation_time": "2003-04-29T06:54:04Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "bahbahbooie@go.com", "text": "Created attachment 6249\nJAR file containing CASDate .class and .java files", "id": 36800, "time": "2003-05-07T05:17:08Z", "bug_id": 18577, "creation_time": "2003-05-07T05:17:08Z", "is_private": false, "attachment_id": 6249}, {"count": 5, "tags": [], "creator": "bahbahbooie@go.com", "attachment_id": 6250, "id": 36801, "time": "2003-05-07T05:21:23Z", "bug_id": 18577, "creation_time": "2003-05-07T05:21:23Z", "is_private": false, "text": "Created attachment 6250\nTest1 servlet source code"}, {"count": 6, "tags": [], "creator": "bahbahbooie@go.com", "attachment_id": null, "text": "No, I was NOT loading the servlet from common.  The servlet was in my <webapp> \ndirectory. I should add that my webapp dir. was outside of $CATALINA_HOME. It \nis configured to be in an entirely different directory. I don't know if that is \ncausing the problem.  I've been through the classloader how-to many, many times.\nThe CASDate was the class that I attempted to load from shared.\nThe class was loaded fine when I moved the utilities JAR file from \n$CATALINA_HOME/shared/lib to $CATALINA_HOME/common/lib.\nI've attached the simple servlet (Test1) and a JAR file (utilities.jar) \ncontaining the utility class (CASDate).\nI hope that is what you need. I can provide more info. as needed.\n\nThanks for looking into this.\n", "id": 36802, "time": "2003-05-07T05:23:53Z", "bug_id": 18577, "creation_time": "2003-05-07T05:23:53Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 18577, "text": "I (very obviously, and unsurprisingly) can't reproduce this with either the\nprovided test case or my own equivalent one. Also, the test case is badly\npackaged, and not ready to run.\nPlease do not reopen the report, which is invalid.", "id": 36814, "time": "2003-05-07T11:54:42Z", "creator": "remm@apache.org", "creation_time": "2003-05-07T11:54:42Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "bahbahbooie@go.com", "text": "Please tell me what I need to package better and I will do so.\nI've never created a bug report before so any tips you can provide would be \nhelpful.\nI assure you I can recreate this error without fail.\n\nThanks.\n", "id": 36871, "time": "2003-05-07T20:55:59Z", "bug_id": 18577, "creation_time": "2003-05-07T20:55:59Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 18577, "text": "Closing this (again) as Remy's test case works.\n\nWell packaged means a ready to deploy WAR file that can be placed in the \nwebapps and requires zero additional configuration for a developer to run. In \nthis case an additional jar file would be required to place in shared/lib.", "id": 55965, "time": "2004-04-18T00:02:22Z", "creator": "markt@apache.org", "creation_time": "2004-04-18T00:02:22Z", "is_private": false, "attachment_id": null}]
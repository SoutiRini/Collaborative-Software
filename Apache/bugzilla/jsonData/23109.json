[{"count": 0, "text": "Hi,\n\nmy apache2 config uses per virtual server log pipe \"cronolog\". On start, per log\n definition one cronolog is started.\n\ninit-+-\n     |-httpd-+-26*[cronolog]\n     |       `-10*[httpd]\n\nOn stop/reload/restart, such processes aren't killed, resulting in\nhanging-around old cronolog processes.\n\ninit-+-\n     |-13*[cronolog]\n\nNote, 26 cronolog processes started, after stop, 13 are still haning around. All\n of them are CustomLog processes, none of them are ErrorLog processes\n\nTypical ps -axw\n\n 3276 ?  S  0:00 /usr/sbin/cronolog /path/to/logs/www.server.de-log.%Y%m\n\nConfig:\n\nErrorLog  \"|/usr/sbin/cronolog /path/to/logs/www.server.de-error.%Y%m\"\nCustomLog \"|/usr/sbin/cronolog /path/to/logs/www.server.de-log.%Y%m\" combined\n\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" %I %O\"\ncombined\n\nNote: I use mod_logio here, too.\n\nApache log on stop:\n\npiped log program '/usr/sbin/cronolog /path/to/logs/www.server.de-log.%Y%m'\nfailed unexpectedly\n[Thu Sep 11 18:05:04 2003] [notice] caught SIGTERM, shutting down\n[Thu Sep 11 18:05:52 2003] [notice] suEXEC mechanism enabled (wrapper:\n/usr/sbin/suexec)\n[Thu Sep 11 18:05:55 2003] [notice] Apache/2 configured -- resuming normal\noperations\n\nI've tried already the patch from attachement given in \nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=21648\nbut it doesn't help.\n\nCurrently I have on config changes to stop Apache2, kill still living cronolog\nprocesses (normal kill helps) and start Apache2 again.\n\nBTW: config is rebuilded from a Apache1 system, here also cronolog is heavily\nused, but never seen such problems.\n\nPls. help me, e.g. leading to some debug capabilities. It's no problem for me to\ntest some patches, because system is current still in semi-productive state.\n\nThanky you very much,\n Peter", "bug_id": 23109, "attachment_id": null, "id": 44050, "time": "2003-09-11T16:26:19Z", "creator": "pb@bieringer.de", "creation_time": "2003-09-11T16:26:19Z", "tags": [], "is_private": false}, {"count": 1, "text": "FWIW, I notice the same behavior after upgrading to Apache 2.0.47.  Apache\n1.3.27 did not exhibit this behavior.", "bug_id": 23109, "attachment_id": null, "id": 44541, "time": "2003-09-23T22:16:28Z", "creator": "drees76@gmail.com", "creation_time": "2003-09-23T22:16:28Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "text": "Can you do an strace on one of your piped log processes across an \"apachectl stop\"?\n\nHere's what I get with rotatelogs and HEAD of stable branch, which isn't too\ndifferent than 2.0.47:\n\n$ strace -p 28824\nread(0, 0xbffefea8, 65536)              = ? ERESTARTSYS (To be restarted)\n--- SIGTERM (Terminated) ---\n\nAlso, what MPM are you using?\n", "is_private": false, "id": 46160, "creator": "trawick@apache.org", "time": "2003-10-23T18:34:25Z", "bug_id": 23109, "creation_time": "2003-10-23T18:34:25Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Same here:\n\n# strace  -p 22264\nread(0,\n0xbffeef00, 65536)              = ? ERESTARTSYS (To be restarted)\n--- SIGTERM (Terminated) @ 0 (0) ---\n\nCurrently I use MPM=prefork, but can easily switch to \"worker\" by startup config\noption. System is RHL 9 with all updates, Apache2 is built on a RHL 9 devel\nstaging system.\n", "is_private": false, "id": 46161, "creator": "pb@bieringer.de", "time": "2003-10-23T18:53:55Z", "bug_id": 23109, "creation_time": "2003-10-23T18:53:55Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "I guess I was expecting to see something different in your strace.  Isn't\n\"apachectl stop\" one of the situations where your piped log programs aren't\ndying properly?  Maybe the problem doesn't occur consistently?\n\nThe goal is to find out if Apache isn't sending SIGTERM to the piped logger\nprocesses, or if it is doing so but they aren't exiting when it happens.\n", "is_private": false, "bug_id": 23109, "id": 46168, "time": "2003-10-23T19:28:26Z", "creator": "trawick@apache.org", "creation_time": "2003-10-23T19:28:26Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "pb@bieringer.de", "attachment_id": null, "is_private": false, "id": 46169, "time": "2003-10-23T19:43:05Z", "bug_id": 23109, "creation_time": "2003-10-23T19:43:05Z", "text": "Hmm, it's reproducable.\n\nTested again: resulting in 24 log lines...\n\npiped log program '/usr/sbin/cronolog /path/to/server/www.server.de-log.%Y%m'\nfailed unexpectedly\n....\n\nI have 12 virtual server configured, each has one error and one custom log piped\nvia cronolog.\n\nUnfortunally, after playing around many more cronolog processes:\n\n# ps -ax|grep cronolog |wc -l\n    140\n\nAfter stopping Apache, still a bunch are in the process table:\n# ps -ax |grep cronolog |wc -l\n     92\n\nHave now killed them by a loop.\n\nWhat do you expect?\n\n\n\n"}, {"count": 6, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "is_private": false, "id": 46188, "time": "2003-10-23T22:55:53Z", "bug_id": 23109, "creation_time": "2003-10-23T22:55:53Z", "text": ">What do you expect?\n\nWhen you ran strace on one of the log programs, I expected it to *not* exit,\nsince *not* exiting is the bad symptom you normally experience.\n\nIf it were me, I'd attach strace to a handful of log programs and stop Apache\nand see what happens to that handful of log programs -- Do they all get SIGTERM?\n Do they all exit once they get SIGTERM?\n\nIf tracing the log process always results in the log process exiting at the\nright time, then I don't know what doc can be gathered.\n"}, {"count": 7, "tags": [], "creator": "drees76@gmail.com", "attachment_id": null, "is_private": false, "id": 46411, "time": "2003-10-28T23:26:04Z", "bug_id": 23109, "creation_time": "2003-10-28T23:26:04Z", "text": "I did some additional research into this issue.  It turns out I can pretty\neasily reproduce this issue by starting, waiting a few seconds and then stopping\nApache2 on a RH 7.3 Linux server here.  \n\nWhat's interesting is that the cronolog processes are not the same processes\nthat were originally started by Apache2.  So it appears that Apache2 sees that\nthe log processes die, but for some reason starts it back up right before\ncompletely shutting down.\n"}, {"count": 8, "tags": [], "text": "Bug is also present on 2.0.48 and FreeBSD 4.x ...", "is_private": false, "bug_id": 23109, "id": 46905, "time": "2003-11-06T01:37:51Z", "creator": "info@orangexl.com", "creation_time": "2003-11-06T01:37:51Z", "attachment_id": null}, {"count": 9, "tags": [], "creator": "info@orangexl.com", "is_private": false, "text": "By the way, this bug seems to have replaced this bug \nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=12033. ", "id": 46913, "time": "2003-11-06T10:42:21Z", "bug_id": 23109, "creation_time": "2003-11-06T10:42:21Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 23109, "attachment_id": null, "id": 49067, "time": "2003-12-13T22:02:42Z", "creator": "trawick@apache.org", "creation_time": "2003-12-13T22:02:42Z", "is_private": false, "text": "Traces showed that the piped loggers really exited (at least some).\nMeanwhile, we have a known problem (PR 24805) where piped loggers can\nbe restarted at termination.  This problem, where it looks like the\nloggers aren't really killed, is assumed to be the same as the known\nproblem where they are killed but then unfortunately we start more copies.\n\nPR 24805 has more info, so I'll keep that one open.\n\n\n*** This bug has been marked as a duplicate of 24805 ***"}]
[{"count": 0, "tags": [], "bug_id": 36563, "is_private": false, "id": 79681, "attachment_id": null, "creator": "ondrej@sury.org", "creation_time": "2005-09-08T21:48:59Z", "time": "2005-09-08T21:48:59Z", "text": "I am author of mod_vhost_ldap (second module based on mod_ldap :-) and I found\nsome rather nasty bug in mod_ldap caching.\n\nThere is error in caching, when any attribute returned from LDAP is null, then\nmod_ldap caches only attributes fetched before this null attribute.\n\nExample from logs:\n(first run)\n[Thu Sep 08 21:30:13 2005] [debug] mod_vhost_ldap.c(383): [client 172.16.21.2]\n[mod_vhost_ldap.c]: dn:\napacheServerName=000001.tld,ou=VHosts,ou=web,dc=active24,dc=com\n[Thu Sep 08 21:30:13 2005] [debug] mod_vhost_ldap.c(395): [client 172.16.21.2]\n[mod_vhost_ldap.c]: processing apacheServerName: 000001.tld\n[Thu Sep 08 21:30:13 2005] [debug] mod_vhost_ldap.c(395): [client 172.16.21.2]\n[mod_vhost_ldap.c]: processing apacheServerAdmin: (null)\n[Thu Sep 08 21:30:13 2005] [debug] mod_vhost_ldap.c(395): [client 172.16.21.2]\n[mod_vhost_ldap.c]: processing apacheDocumentRoot: /var/www/00/10/04/000001.tld/www/\n[Thu Sep 08 21:30:13 2005] [debug] mod_vhost_ldap.c(395): [client 172.16.21.2]\n[mod_vhost_ldap.c]: processing apacheScriptAlias:\n/var/www/00/10/04/000001.tld/cgi-bin\n[Thu Sep 08 21:30:13 2005] [debug] mod_vhost_ldap.c(395): [client 172.16.21.2]\n[mod_vhost_ldap.c]: processing apacheSuexecUid: 1004\n[Thu Sep 08 21:30:13 2005] [debug] mod_vhost_ldap.c(395): [client 172.16.21.2]\n[mod_vhost_ldap.c]: processing apacheSuexecGid: 1004\n\n(second run -> results from cache)\n[Thu Sep 08 21:30:18 2005] [debug] mod_vhost_ldap.c(383): [client 172.16.21.2]\n[mod_vhost_ldap.c]: dn:\napacheServerName=000001.tld,ou=VHosts,ou=web,dc=active24,dc=com\n[Thu Sep 08 21:30:18 2005] [debug] mod_vhost_ldap.c(395): [client 172.16.21.2]\n[mod_vhost_ldap.c]: processing apacheServerName: 000001.tld\n[Thu Sep 08 21:30:18 2005] [debug] mod_vhost_ldap.c(395): [client 172.16.21.2]\n[mod_vhost_ldap.c]: processing apacheServerAdmin: (null)\n[Thu Sep 08 21:30:18 2005] [debug] mod_vhost_ldap.c(395): [client 172.16.21.2]\n[mod_vhost_ldap.c]: processing apacheDocumentRoot: (null)\n[Thu Sep 08 21:30:18 2005] [debug] mod_vhost_ldap.c(395): [client 172.16.21.2]\n[mod_vhost_ldap.c]: processing apacheScriptAlias: (null)\n[Thu Sep 08 21:30:19 2005] [notice] child pid 3379 exit signal Segmentation\nfault (11)\n\nQuick workaround is to move attributes which can be NULL to end or to define\n_all_ attributes in LDAP.\n\nCorect way is to fix this bug in mod_ldap.  Since structure is returned ok on\nfirst run I think that there is a way how to fix it.\n\nI will look on this when I have some time.\n\nOndrej.\nP.S.: Tested on 2.0.53, but I have checked 2.0.54 ChangeLog and diffs and it\nincludes only addition of LDAPConnectionTimeout."}, {"count": 1, "tags": [], "creator": "bnicholes@apache.org", "text": "  This has been fixed in Apache 2.1 rev. 156587 but never backported to Apache \n2.0.\n\n*** This bug has been marked as a duplicate of 33901 ***", "id": 79692, "time": "2005-09-08T23:51:53Z", "bug_id": 36563, "creation_time": "2005-09-08T23:51:53Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 36563, "attachment_id": null, "text": "Will you accept backported patch if I prepare it?\n\nOndrej", "id": 79707, "time": "2005-09-09T09:38:59Z", "creator": "ondrej@sury.org", "creation_time": "2005-09-09T09:38:59Z", "is_private": false}, {"count": 3, "tags": [], "creator": "bnicholes@apache.org", "text": "  Sure.  It will have to be proposed for backport, reviewed and accepted by a \nvote before it actually makes it into the code.  But it can certainly be done.", "id": 79735, "time": "2005-09-09T17:01:58Z", "bug_id": 36563, "creation_time": "2005-09-09T17:01:58Z", "is_private": false, "attachment_id": null}, {"attachment_id": 16429, "tags": [], "creator": "ondrej@sury.org", "text": "Created attachment 16429\nBackported patch to fix invalid cache content handling", "count": 4, "id": 80052, "time": "2005-09-16T23:04:42Z", "bug_id": 36563, "creation_time": "2005-09-16T23:04:42Z", "is_private": false}, {"count": 5, "tags": [], "creator": "ondrej@sury.org", "text": "Hi,\nI have created backport of fix for correct cache items handling if they include\nNULL values, thus reopening bug and changing severity to wishlist.\n\nOndrej.\nP.S.: If this is not correct way how to propose backport then bang me :-)", "id": 80053, "time": "2005-09-16T23:06:18Z", "bug_id": 36563, "creation_time": "2005-09-16T23:06:18Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "Proposed for backport to 2.0.  Waiting for votes.", "is_private": false, "id": 80058, "creator": "bnicholes@apache.org", "time": "2005-09-17T01:06:25Z", "bug_id": 36563, "creation_time": "2005-09-17T01:06:25Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "ondrej@sury.org", "text": "Changing severity to Major, since this bug is not as harmless as I thought to be.\nThere is memory leak in util_ldap_search_node_free().  Only items before first\nitem with NULL value are freed, and rest of items are left in cache.", "id": 80112, "time": "2005-09-19T15:10:01Z", "bug_id": 36563, "creation_time": "2005-09-19T15:10:01Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 36563, "is_private": false, "id": 80377, "attachment_id": null, "creator": "bnicholes@apache.org", "creation_time": "2005-09-23T16:27:47Z", "time": "2005-09-23T16:27:47Z", "text": "Backported to 2.0.55"}]
[{"count": 0, "tags": [], "bug_id": 22503, "attachment_id": null, "is_private": false, "id": 42890, "time": "2003-08-18T09:28:31Z", "creator": "koyama@cs.pit-nagano.ac.jp", "creation_time": "2003-08-18T09:28:31Z", "text": "Tomcat5 is able to parse a XML format JSP file encoding, but Tomcat4 isn't.\nI thought org.xml.sax.InputSource didn't instantiate with java.io.InputStream.\nSo, I read Jasper source and made two patches as follows.\n\njakarta-tomcat-4.0.6-src/jasper/src/share/org/apache/jasper/compiler/ParserController.java\njakarta-tomcat-4.0.6-src/jasper/src/share/org/apache/jasper/compiler/ParserXJspSax.java\n\n--- original/ParserController.java      Sun Aug 17 17:15:53 2003\n+++ ParserController.java       Sun Aug 17 17:17:37 2003\n@@ -209,7 +209,7 @@\n             reader = getReader(absFileName, encoding);\n             jspHandler.setDefault(isXml);\n             if (isXml) {\n-                (new ParserXJspSax(absFileName, reader, jspHandler)).parse();\n+                (new ParserXJspSax(absFileName, getStream(absFileName), jspHand\nler)).parse();\n             } else {\n                 (new Parser(ctxt, absFileName, encoding, reader, jspHandler)).p\narse();\n             }\n@@ -443,6 +443,16 @@\n        }\n     }\n \n+    private InputStream getStream(String file)\n+       throws FileNotFoundException\n+    {\n+        InputStream in;\n+       in = ctxt.getResourceAsStream(file);\n+       if (in == null) {\n+           throw new FileNotFoundException(file);\n+       }\n+       return in;\n+    }\n     /* NOT COMPILED\n     private String getFileContent(String fileName) {\n         InputStream inStream;\n\n\n#################################################################################\n--- original/ParserXJspSax.java Sun Aug 17 17:16:01 2003\n+++ ParserXJspSax.java  Sun Aug 17 17:17:14 2003\n@@ -136,6 +136,15 @@\n        this.jspHandler = jspHandler;\n     }\n     \n+    public ParserXJspSax(String filePath,\n+                        InputStream stream, \n+                        ParseEventListener jspHandler)\n+    {\n+       this.filePath = filePath;\n+       this.is = new InputSource(stream);\n+       this.jspHandler = jspHandler;\n+    }\n+\n     //*********************************************************************\n     // Parse"}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "is_private": false, "count": 1, "id": 59366, "time": "2004-06-16T21:17:53Z", "bug_id": 22503, "creation_time": "2004-06-16T21:17:53Z", "text": "The 4.0 branch will not be patched. The 4.1 branch may be patched (see bug \n22502) but this is not a high priority. There are many Japser fixes in TC5 \nthat should be ported back to the TC4 brnach. As yet, no-one has stepped up to \nvolunteer to do this."}]
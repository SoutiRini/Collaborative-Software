[{"count": 0, "tags": [], "bug_id": 42031, "is_private": false, "id": 101362, "attachment_id": null, "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-04-03T02:50:53Z", "time": "2007-04-03T02:50:53Z", "text": "Child process freezes with many downloading against MaxClients.\n\nHow to reproduce:\n\n(1) configuration to httpd.conf\n\nStartServers          1\nMaxClients          3\nMinSpareThreads      1\nMaxSpareThreads      3\nThreadsPerChild      3\nMaxRequestsPerChild   0\nTimeout 10\nKeepAlive On\nMaxKeepAliveRequests 0\nKeepAliveTimeout 5\n\n(2) put a large file \"test.mpg\" (about 200MB) on DocumentRoot\n(3) apachectl start\n(4) execute many downloading simultaneously.\ne.g. bash and wget:\n$ for (( i=0 ; i<20 ; i++ )); do wget -b http://localhost/test.mpg; done;\n\nThen the child process often freezes. If not, try to download more.\n\n(5) terminate downloading\ne.g. bash and wget:\n$ killall wget\n\n(6) access to any file from web browser.\nHowever long you wait, server won't response.\n\n\n\"apachectl graceful\" then in error log\n[Tue Apr 03 16:41:14 2007] [debug] event.c(1392): the listener thread didn't \nexit\n\n\"apachectl stop\" then in error log\n[Tue Apr 03 16:48:18 2007] [warn] child process 31077 still did not exit, \nsending a SIGTERM\n[Tue Apr 03 16:48:20 2007] [warn] child process 31077 still did not exit, \nsending a SIGTERM\n[Tue Apr 03 16:48:22 2007] [warn] child process 31077 still did not exit, \nsending a SIGTERM\n[Tue Apr 03 16:48:24 2007] [error] child process 31077 still did not exit, \nsending a SIGKILL\n\n\n\nOS: Fedora Core 6\nkernel: 2.6.20-1.2933.fc6\nglibc: 2.5-10.fc6\n\nhttpd revision 525116.\n$ ./httpd -V\nServer version: Apache/2.3.0-dev (Unix)\nServer built:   Apr  3 2007 15:49:09\nServer's Module Magic Number: 20060905:2\nServer loaded:  APR 1.3.0-dev, APR-UTIL 1.3.0-dev\nCompiled using: APR 1.3.0-dev, APR-UTIL 1.3.0-dev\nArchitecture:   32-bit\nServer MPM:     Event\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/experimental/event\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=128\n -D HTTPD_ROOT=\"/usr/local/apache2\"\n -D SUEXEC_BIN=\"/usr/local/apache2/bin/suexec\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\n\n\nbacktrace of frozen child process:\n\nThread 5 (Thread -1219343472 (LWP 30355)):\n#0  0x007b9402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x4bb3998e in __lll_mutex_lock_wait () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x4bb357fc in _L_mutex_lock_85 () from /lib/libpthread.so.0\nNo symbol table info available.\n#3  0x4bb3533d in pthread_mutex_lock () from /lib/libpthread.so.0\nNo symbol table info available.\n#4  0x0055a308 in apr_thread_mutex_lock (mutex=0x83c72f8)\n    at locks/unix/thread_mutex.c:92\n        rv = 0\n#5  0x08091234 in process_socket (p=0x83f3cd0, sock=0x83f3d10, cs=0x83f3eb0,\n    my_child_num=0, my_thread_num=0) at event.c:656\n        output_filter = (ap_filter_t *) 0x83f4448\n        rv = 0\n        c = (conn_rec *) 0x83f3f08\n        pt = (listener_poll_type *) 0x83f3ee8\n        conn_id = 0\n        rc = 2\n        sbh = (ap_sb_handle_t *) 0x83f45c8\n#6  0x0809215c in worker_thread (thd=0x83b94e0, dummy=0x83e94e0)\n    at event.c:1194\n        ti = (proc_info *) 0x83e94e0\n        process_slot = 0\n        thread_slot = 0\n        csd = (apr_socket_t *) 0x83f3d10\n        cs = (conn_state_t *) 0x83f3eb0\n        ptrans = (apr_pool_t *) 0x83f3cd0\n        rv = 0\n        is_idle = 0\n#7  0x00566f70 in dummy_worker (opaque=0x83b94e0)\n    at threadproc/unix/thread.c:142\n        thread = (apr_thread_t *) 0x83b94e0\n#8  0x4bb333db in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#9  0x4ba1726e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\n\n\nThread 4 (Thread -1229833328 (LWP 30356)):\n#0  0x007b9402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x4bb3998e in __lll_mutex_lock_wait () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x4bb357fc in _L_mutex_lock_85 () from /lib/libpthread.so.0\nNo symbol table info available.\n#3  0x4bb3533d in pthread_mutex_lock () from /lib/libpthread.so.0\nNo symbol table info available.\n#4  0x0055a308 in apr_thread_mutex_lock (mutex=0x83c72f8)\n    at locks/unix/thread_mutex.c:92\n        rv = 0\n#5  0x08091234 in process_socket (p=0x83e9c38, sock=0x83e9c78, cs=0x83e9e18,\n    my_child_num=0, my_thread_num=1) at event.c:656\n        output_filter = (ap_filter_t *) 0x83ea3b0\n        rv = 0\n        c = (conn_rec *) 0x83e9e70\n        pt = (listener_poll_type *) 0x83e9e50\n        conn_id = 1\n        rc = 2\n        sbh = (ap_sb_handle_t *) 0x83ea818\n#6  0x0809215c in worker_thread (thd=0x83b9500, dummy=0x83e94f0)\n    at event.c:1194\n        ti = (proc_info *) 0x83e94f0\n        process_slot = 0\n        thread_slot = 1\n        csd = (apr_socket_t *) 0x83e9c78\n        cs = (conn_state_t *) 0x83e9e18\n        ptrans = (apr_pool_t *) 0x83e9c38\n        rv = 0\n        is_idle = 0\n#7  0x00566f70 in dummy_worker (opaque=0x83b9500)\n    at threadproc/unix/thread.c:142\n        thread = (apr_thread_t *) 0x83b9500\n#8  0x4bb333db in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#9  0x4ba1726e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\n\n\n#8  0x4bb333db in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#9  0x4ba1726e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 3 (Thread -1240323184 (LWP 30357)):\n#0  0x007b9402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x4bb3998e in __lll_mutex_lock_wait () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x4bb357fc in _L_mutex_lock_85 () from /lib/libpthread.so.0\nNo symbol table info available.\n#3  0x4bb3533d in pthread_mutex_lock () from /lib/libpthread.so.0\nNo symbol table info available.\n#4  0x0055a308 in apr_thread_mutex_lock (mutex=0x83c72f8)\n    at locks/unix/thread_mutex.c:92\n        rv = 0\n#5  0x08091382 in process_socket (p=0x8419eb8, sock=0x8419ef0, cs=0x841a090,\n    my_child_num=0, my_thread_num=2) at event.c:697\n        rc = 0\n        pt = (listener_poll_type *) 0x841a0c8\n        c = (conn_rec *) 0x841a0e8\n        pt = (listener_poll_type *) 0x841a0c8\n        conn_id = 2\n        rc = -2\n        sbh = (ap_sb_handle_t *) 0x841a088\n#6  0x0809215c in worker_thread (thd=0x83b9520, dummy=0x83e94e0)\n    at event.c:1194\n        ti = (proc_info *) 0x83e94e0\n        process_slot = 0\n        thread_slot = 2\n        csd = (apr_socket_t *) 0x8419ef0\n        cs = (conn_state_t *) 0x0\n        ptrans = (apr_pool_t *) 0x8419eb8\n        rv = 0\n        is_idle = 0\n#7  0x00566f70 in dummy_worker (opaque=0x83b9520)\n    at threadproc/unix/thread.c:142\n        thread = (apr_thread_t *) 0x83b9520\n#8  0x4bb333db in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#9  0x4ba1726e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 2 (Thread -1250813040 (LWP 30358)):\n#0  0x007b9402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x4bb371a6 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x0055876f in apr_thread_cond_wait (cond=0x83b9478, mutex=0x83b9448)\n    at locks/unix/thread_cond.c:68\n        rv = 0\n#3  0x08094de4 in ap_queue_info_wait_for_idler (queue_info=0x83b9430)\n    at fdqueue.c:158\n        rv = 0\n        prev_idlers = 0\n#4  0x080917bd in get_worker (have_idle_worker_p=0xb5721364) at event.c:855\n        rc = 1270095860\n#5  0x08091dd1 in listener_thread (thd=0x83b9540, dummy=0x83e9500)\n    at event.c:1063\n        rc = 0\n        ti = (proc_info *) 0x83e9500\n        process_slot = 0\n        tpool = (apr_pool_t *) 0x83c72c0\n        csd = (void *) 0x8419ef0\n        ptrans = (apr_pool_t *) 0x8419eb8\n        lr = (ap_listen_rec *) 0x832b520\n        have_idle_worker = 0\n        cs = (conn_state_t *) 0x83fff50\n        out_pfd = (const apr_pollfd_t *) 0x83c73ac\n        num = 0\n        time_now = 1175583389600457\n        timeout_interval = 1000000\n        timeout_time = 1175583389700457\n        pt = (listener_poll_type *) 0x83c73f0\n#6  0x00566f70 in dummy_worker (opaque=0x83b9540)\n    at threadproc/unix/thread.c:142\n        thread = (apr_thread_t *) 0x83b9540\n#7  0x4bb333db in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#8  0x4ba1726e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 1 (Thread -1208617280 (LWP 30353)):\n#0  0x007b9402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x4bb39d6b in read () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x08095389 in ap_mpm_pod_check (pod=0x8341640) at pod.c:54\n        c = 0 '\\0'\n        fd = 5\n        rc = -1075834592\n#3  0x08092bb6 in child_main (child_num_arg=0) at event.c:1553\n        threads = (apr_thread_t **) 0x83e94d0\n        rv = 0\n        ts = (thread_starter *) 0x83b9300\n        thread_attr = (apr_threadattr_t *) 0x83b9310\n        start_thread_id = (apr_thread_t *) 0x83b9348\n#4  0x08092d3c in make_child (s=0x832ef78, slot=0) at event.c:1639\n        pid = 0\n#5  0x08092dbf in startup_children (number_to_start=1) at event.c:1658\n        i = 0\n#6  0x080934e4 in ap_mpm_run (_pconf=0x832d0a8, plog=0x835d168, s=0x832ef78)\n    at event.c:1978\n        remaining_children_to_start = 1\n#7  0x08064abb in main (argc=3, argv=0xbfe011a4) at main.c:750\n        c = 0 '\\0'\n        configtestonly = 0\n        confname = 0x80a0d7d \"conf/httpd.conf\"\n        def_server_root = 0x80a0d8d \"/usr/local/apache2\"\n        temp_error_log = 0x0\n        error = 0x0\n        process = (process_rec *) 0x832b128\n        server_conf = (server_rec *) 0x832ef78\n        pglobal = (apr_pool_t *) 0x832b0a0\n        pconf = (apr_pool_t *) 0x832d0a8\n        plog = (apr_pool_t *) 0x835d168\n        ptemp = (apr_pool_t *) 0x8361178\n        pcommands = (apr_pool_t *) 0x832f0b0\n        opt = (apr_getopt_t *) 0x832f148\n        rv = 0\n        mod = (module **) 0x80acc90\n        optarg = 0x0\n        signal_server = (\n    apr_OFN_ap_signal_server_t *) 0x80859a8 <ap_signal_server>\n#0  0x007b9402 in __kernel_vsyscall ()"}, {"count": 1, "tags": [], "bug_id": 42031, "attachment_id": null, "is_private": false, "id": 101384, "time": "2007-04-03T13:21:05Z", "creator": "rpluem@apache.org", "creation_time": "2007-04-03T13:21:05Z", "text": "I have not have the time to analyse this in more detail, but from first glance I\ntend to say that the lock aquired in line 1058 of event.c is being held for too\nlong, such that we can run into a deadlock. In the backtrace below thread 2 is\nholding this lock and preventing all the worker threads from doing their jobs\n(they need to get hold of this lock). OTH thread 2 waits for a free worker via a\nconditional wait. BOOOM."}, {"count": 2, "tags": [], "bug_id": 42031, "is_private": false, "id": 106947, "attachment_id": 20684, "creator": "chip@force-elite.com", "creation_time": "2007-08-20T14:45:02Z", "time": "2007-08-20T14:45:02Z", "text": "Created attachment 20684\n2.2.x deadlock fix\n\nHere is a patch that might fix this issue on 2.2.x.  I haven't been able to\nlocally reproduce it --  can you please try this patch out and let me know if\nit fixes the issue?\n\nThis reorders the locking logic inside the timeout ring iteration, so that we\nonly lock when doing ops on the ring, but once we are ready to push to a child,\nwe are lock free."}, {"count": 3, "attachment_id": null, "creator": "chip@force-elite.com", "is_private": false, "id": 106950, "time": "2007-08-20T15:13:09Z", "bug_id": 42031, "creation_time": "2007-08-20T15:13:09Z", "tags": [], "text": "I've committed a potential fix to trunk with r567852:\nhttps://svn.apache.org/viewvc?view=rev&revision=567852\n\nThe approach is different form the patch attached here -- it avoids rewriting\nthe loops."}, {"count": 4, "attachment_id": null, "creator": "takashi.asfbugzilla@tks.st", "text": "> Here is a patch that might fix this issue on 2.2.x.  I haven't been able to\n> locally reproduce it --  can you please try this patch out and let me know if\n> it fixes the issue?\n\nI wasn't able to reproduce the bug on 2.2.x. I should've mentioned it.", "id": 106968, "time": "2007-08-21T08:23:38Z", "bug_id": 42031, "creation_time": "2007-08-21T08:23:38Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 42031, "is_private": false, "text": "Now I can't reproduce the bug on trunk rev 567852 nor rev 525116.\n(4) execute many downloading simultaneously,\nThen child process exit signal Segmentation fault.\nWhy???\n\ngdb output (rev 525116)\n\n(gdb) run -X\nStarting program: /usr/local/apache2/bin/httpd -X\n[Thread debugging using libthread_db enabled]\n[New Thread -1208502592 (LWP 561)]\n[New Thread -1208738928 (LWP 574)]\n[New Thread -1219228784 (LWP 575)]\n[New Thread -1229718640 (LWP 576)]\n[New Thread -1240208496 (LWP 577)]\n[New Thread -1250698352 (LWP 578)]\n[Thread -1208738928 (LWP 574) exited]\n\nProgram received signal SIGPIPE, Broken pipe.\n[Switching to Thread -1240208496 (LWP 577)]\n0x00110402 in __kernel_vsyscall ()\n(gdb) thread apply all bt full\n\nThread 6 (Thread -1250698352 (LWP 578)):\n#0  0x00110402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x003e2b21 in __lll_mutex_unlock_wake () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x003df839 in _L_mutex_unlock_99 () from /lib/libpthread.so.0\nNo symbol table info available.\n#3  0x003df4b0 in __pthread_mutex_unlock_usercnt () from /lib/libpthread.so.0\nNo symbol table info available.\n#4  0x003df830 in pthread_mutex_unlock () from /lib/libpthread.so.0\nNo symbol table info available.\n#5  0x0016b37e in apr_thread_mutex_unlock (mutex=0x9a99010)\n    at /home/user1/httpd-trunk/srclib/apr/locks/unix/thread_mutex.c:121\n\tstatus = 0\n#6  0x0809518f in ap_queue_push (queue=0x9a98ff8, sd=0x9b2bec8, cs=0x0, \np=0x9b2be90)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/fdqueue.c:337\n\telem = (fd_queue_elem_t *) 0x9a99094\n\trv = 0\n#7  0x08091cc7 in listener_thread (thd=0x9a991d0, dummy=0x9ac7168)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1027\n\trc = 0\n\tti = (proc_info *) 0x9ac7168\n\tprocess_slot = 0\n\ttpool = (apr_pool_t *) 0x9aa2f80\n\tcsd = (void *) 0x9b2bec8\n\tptrans = (apr_pool_t *) 0x9b2be90\n\tlr = (ap_listen_rec *) 0x9a33520\n\thave_idle_worker = 1\n\tcs = (conn_state_t *) 0x9b0dea0\n\tout_pfd = (const apr_pollfd_t *) 0x9aa3080\n\tnum = 1\n\ttime_now = 1187710557998374\n\ttimeout_interval = 1000000\n\ttimeout_time = 1187710558098374\n\tpt = (listener_poll_type *) 0x9aa30b0\n#8  0x00179754 in dummy_worker (opaque=0x9a991d0)\n    at /home/user1/httpd-trunk/srclib/apr/threadproc/unix/thread.c:142\n\tthread = (apr_thread_t *) 0x9a991d0\n#9  0x003dc44b in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#10 0x002bd80e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 5 (Thread -1240208496 (LWP 577)):\n#0  0x00110402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x002b41ee in sendfile64 () from /lib/libc.so.6\nNo symbol table info available.\n#2  0x00173b2a in apr_socket_sendfile (sock=0x9b2bec8, file=0x9b2c618, \nhdtr=0x17f9f8, offset=0xb613e0e0, \n    len=0xb613e0dc, flags=0) at /home/user1/httpd-\ntrunk/srclib/apr/network_io/unix/sendrecv.c:329\n\trv = 0\n\tnbytes = 0\n\ttotal_hdrbytes = 0\n\ti = 134909576\n\tarv = 1569892\n\toff = 16384\n#3  0x0807a583 in sendfile_nonblocking (s=0x9b2bec8, bucket=0x9b2e0c8, \ncumulative_bytes_written=0x9b2c5d0, \n    c=0x9b2c0c0) at /home/user1/httpd-trunk/server/core_filters.c:774\n\tn = 190898180\n\tarv = 0\n\told_timeout = 10000000\n\trv = 0\n\tfile_bucket = (apr_bucket_file *) 0x9b2e018\n\tfd = (apr_file_t *) 0x9b2c618\n\tfile_length = 190898180\n\tfile_offset = 16384\n\tbytes_written = 0\n#4  0x08079ea7 in send_brigade_nonblocking (s=0x9b2bec8, bb=0x9b2c5f8, \nbytes_written=0x9b2c5d0, c=0x9b2c0c0)\n    at /home/user1/httpd-trunk/server/core_filters.c:576\n\tfile_bucket = (apr_bucket_file *) 0x9b2e018\n\tfd = (apr_file_t *) 0x9b2c618\n\tdid_sendfile = 1\n\tbucket = (apr_bucket *) 0x9b2e0c8\n\tnext = (apr_bucket *) 0x9b2e070\n\trv = 162731568\n\tvec = {{iov_base = 0x9b31388, iov_len = 0}, {iov_base = 0x9b2c09c, \niov_len = 162717632}, {\n    iov_base = 0x9b31368, iov_len = 162728960}, {iov_base = 0x9b31488, iov_len \n= 0}, {iov_base = 0x0, \n    iov_len = 162727224}, {iov_base = 0x0, iov_len = 162731128}, {iov_base = \n0x9b2dfc0, \n    iov_len = 162717808}, {iov_base = 0x9b31388, iov_len = 3054756344}, \n{iov_base = 0x8074626, \n    iov_len = 162728960}, {iov_base = 0x9b31488, iov_len = 0}, {iov_base = \n0x0, iov_len = 190914564}, {\n    iov_base = 0x0, iov_len = 162717632}, {iov_base = 0x198e18, iov_len = \n162103320}, {iov_base = 0x0, \n    iov_len = 0}, {iov_base = 0x16e525, iov_len = 4129}, {iov_base = \n0xffffffff, iov_len = 162031304}}\n\tnvec = 0\n#5  0x08079c97 in ap_core_output_filter (f=0x9b2c568, new_bb=0x9b2c6a0)\n    at /home/user1/httpd-trunk/server/core_filters.c:488\n\trv = 162709608\n\tc = (conn_rec *) 0x9b2c0c0\n\tnet = (core_net_rec *) 0x9b2c540\n\tctx = (core_output_filter_ctx_t *) 0x9b2c5c8\n\tbb = (apr_bucket_brigade *) 0x9b2c5f8\n\tbucket = (apr_bucket *) 0x9b2c5fc\n\tnext = (apr_bucket *) 0x9b2c5fc\n\tbytes_in_brigade = 190898180\n\tnon_file_bytes_in_brigade = 0\n#6  0x08087609 in ap_pass_brigade (next=0x9b2c568, bb=0x9b2c6a0)\n    at /home/user1/httpd-trunk/server/util_filter.c:526\n\te = (apr_bucket *) 0x9b2dfc0\n#7  0x0808b0e5 in ap_process_async_request (r=0x9b2fed8)\n    at /home/user1/httpd-trunk/modules/http/http_request.c:261\n\taccess_status = 0\n\tbb = (apr_bucket_brigade *) 0x9b2c6a0\n\tb = (apr_bucket *) 0x9b2dfc0\n\tc = (conn_rec *) 0x9b2c0c0\n#8  0x08087b6a in ap_process_http_async_connection (c=0x9b2c0c0)\n    at /home/user1/httpd-trunk/modules/http/http_core.c:140\n\tr = (request_rec *) 0x9b2fed8\n\tcs = (conn_state_t *) 0x9b2c068\n#9  0x0808353f in ap_run_process_connection (c=0x9b2c0c0) at /home/user1/httpd-\ntrunk/server/connection.c:43\n\tpHook = (ap_LINK_process_connection_t *) 0x9ac1970\n\tn = 0\n\trv = -2\n#10 0x080911eb in process_socket (p=0x9b2be90, sock=0x9b2bec8, cs=0x9b2c068, \nmy_child_num=0, \n    my_thread_num=2) at /home/user1/httpd-\ntrunk/server/mpm/experimental/event/event.c:626\n\tc = (conn_rec *) 0x9b2c0c0\n\tpt = (listener_poll_type *) 0x9b2c0a0\n\tconn_id = 2\n\trc = -2\n\tsbh = (ap_sb_handle_t *) 0x9b2c060\n#11 0x080921e8 in worker_thread (thd=0x9a991b0, dummy=0x9ac7158)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1194\n\tti = (proc_info *) 0x9ac7158\n\tprocess_slot = 0\n\tthread_slot = 2\n\tcsd = (apr_socket_t *) 0x9b2bec8\n\tcs = (conn_state_t *) 0x0\n\tptrans = (apr_pool_t *) 0x9b2be90\n\trv = 0\n\tis_idle = 0\n#12 0x00179754 in dummy_worker (opaque=0x9a991b0)\n    at /home/user1/httpd-trunk/srclib/apr/threadproc/unix/thread.c:142\n\tthread = (apr_thread_t *) 0x9a991b0\n#13 0x003dc44b in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#14 0x002bd80e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 4 (Thread -1229718640 (LWP 576)):\n#0  0x00110402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x003e0206 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x0016cf4f in apr_thread_cond_wait (cond=0x9a99040, mutex=0x9a99010)\n    at /home/user1/httpd-trunk/srclib/apr/locks/unix/thread_cond.c:68\n\trv = 0\n#3  0x08095200 in ap_queue_pop (queue=0x9a98ff8, sd=0xb6b3f38c, cs=0xb6b3f388, \np=0xb6b3f384)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/fdqueue.c:363\n\telem = (fd_queue_elem_t *) 0x0\n\trv = 0\n#4  0x08092147 in worker_thread (thd=0x9a99190, dummy=0x9ac7168)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1162\n\tti = (proc_info *) 0x9ac7168\n\tprocess_slot = 0\n\tthread_slot = 1\n\tcsd = (apr_socket_t *) 0x9ad1970\n\tcs = (conn_state_t *) 0x9ad1b10\n\tptrans = (apr_pool_t *) 0x9ad1938\n\trv = 0\n\tis_idle = 1\n#5  0x00179754 in dummy_worker (opaque=0x9a99190)\n    at /home/user1/httpd-trunk/srclib/apr/threadproc/unix/thread.c:142\n\tthread = (apr_thread_t *) 0x9a99190\n#6  0x003dc44b in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#7  0x002bd80e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 3 (Thread -1219228784 (LWP 575)):\n#0  0x00110402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x002b41ee in sendfile64 () from /lib/libc.so.6\nNo symbol table info available.\n#2  0x00173b2a in apr_socket_sendfile (sock=0x9ac78d8, file=0x9ac8028, \nhdtr=0x17f9f8, offset=0xb7540190, \n    len=0xb754018c, flags=0) at /home/user1/httpd-\ntrunk/srclib/apr/network_io/unix/sendrecv.c:329\n\trv = 0\n\tnbytes = 0\n\ttotal_hdrbytes = 0\n\ti = 0\n\tarv = 162676768\n\toff = 10301440\n#3  0x0807a583 in sendfile_nonblocking (s=0x9ac78d8, bucket=0x9ac9ad8, \ncumulative_bytes_written=0x9ac7fe0, \n    c=0x9ac7ad0) at /home/user1/httpd-trunk/server/core_filters.c:774\n\tn = 183644164\n\tarv = 0\n\told_timeout = 10000000\n\trv = 0\n\tfile_bucket = (apr_bucket_file *) 0x9ac9a28\n\tfd = (apr_file_t *) 0x9ac8028\n\tfile_length = 183644164\n\tfile_offset = 7270400\n\tbytes_written = 0\n#4  0x08079ea7 in send_brigade_nonblocking (s=0x9ac78d8, bb=0x9ac80c0, \nbytes_written=0x9ac7fe0, c=0x9ac7ad0)\n    at /home/user1/httpd-trunk/server/core_filters.c:576\n\tfile_bucket = (apr_bucket_file *) 0x9ac9a28\n\tfd = (apr_file_t *) 0x9ac8028\n\tdid_sendfile = 1\n\tbucket = (apr_bucket *) 0x9ac9ad8\n\tnext = (apr_bucket *) 0x9ac9a80\n\trv = 0\n\tvec = {{iov_base = 0x9afbc70, iov_len = 162511984}, {iov_base = \n0x9afa3d8, iov_len = 162503552}, {\n    iov_base = 0x0, iov_len = 162505488}, {iov_base = 0x1302f4, iov_len = \n3075736136}, {\n    iov_base = 0x8087564, iov_len = 162505304}, {iov_base = 0x9afa3d8, iov_len \n= 2549142}, {\n    iov_base = 0x17bccc, iov_len = 3075736132}, {iov_base = 0x0, iov_len = \n162511752}, {iov_base = 0xb, \n    iov_len = 0}, {iov_base = 0x46cb065c, iov_len = 457949}, {iov_base = \n0x9af9d70, iov_len = 0}, {\n    iov_base = 0x9af9da4, iov_len = 3075736184}, {iov_base = 0x806ae86, \niov_len = 0}, {iov_base = 0x0, \n    iov_len = 3075736184}, {iov_base = 0x806ce1f, iov_len = 162512072}, \n{iov_base = 0x9b23e20, \n    iov_len = 3075736216}}\n\tnvec = 0\n#5  0x08079ad6 in ap_core_output_filter (f=0x9ac7f78, new_bb=0x0)\n    at /home/user1/httpd-trunk/server/core_filters.c:423\n\trv = 304\n\tc = (conn_rec *) 0x9ac7ad0\n\tnet = (core_net_rec *) 0x9ac7f50\n\tctx = (core_output_filter_ctx_t *) 0x9ac7fd8\n\tbb = (apr_bucket_brigade *) 0x9ac80c0\n\tbucket = (apr_bucket *) 0x3e2b21\n\tnext = (apr_bucket *) 0x9ac8330\n\tbytes_in_brigade = 162297992\n\tnon_file_bytes_in_brigade = 4112372\n#6  0x0809123c in process_socket (p=0x9ac78a0, sock=0x9ac78d8, cs=0x9ac7a78, \nmy_child_num=0, \n    my_thread_num=0) at /home/user1/httpd-\ntrunk/server/mpm/experimental/event/event.c:644\n\toutput_filter = (ap_filter_t *) 0x9ac7f78\n\trv = 0\n\tc = (conn_rec *) 0x9ac7ad0\n\tpt = (listener_poll_type *) 0x9ac7ab0\n\tconn_id = 0\n\trc = 2\n\tsbh = (ap_sb_handle_t *) 0x9ac8330\n#7  0x080921e8 in worker_thread (thd=0x9a99170, dummy=0x9ac7158)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1194\n\tti = (proc_info *) 0x9ac7158\n\tprocess_slot = 0\n\tthread_slot = 0\n\tcsd = (apr_socket_t *) 0x9ac78d8\n\tcs = (conn_state_t *) 0x9ac7a78\n\tptrans = (apr_pool_t *) 0x9ac78a0\n\trv = 0\n\tis_idle = 0\n#8  0x00179754 in dummy_worker (opaque=0x9a99170)\n    at /home/user1/httpd-trunk/srclib/apr/threadproc/unix/thread.c:142\n\tthread = (apr_thread_t *) 0x9a99170\n#9  0x003dc44b in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#10 0x002bd80e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 1 (Thread -1208502592 (LWP 561)):\n#0  0x00110402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x003e3f3e in do_sigwait () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x003e3fdf in sigwait () from /lib/libpthread.so.0\nNo symbol table info available.\n#3  0x0017b242 in apr_signal_thread (signal_handler=0x8092279 <check_signal>)\n    at /home/user1/httpd-trunk/srclib/apr/threadproc/unix/signals.c:383\n\tsignal_received = 4095\n\tsig_mask = {__val = {1073340935, 4294967294, 4294967295 <repeats 30 \ntimes>}}\n\tsig_func = (int (*)(int)) 0x8092279 <check_signal>\n#4  0x08092be4 in child_main (child_num_arg=0)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1520\n\tthreads = (apr_thread_t **) 0x9ac7148\n\trv = 0\n\tts = (thread_starter *) 0x9a98f90\n\tthread_attr = (apr_threadattr_t *) 0x9a98fa0\n\tstart_thread_id = (apr_thread_t *) 0x9a98fd8\n#5  0x08092d42 in make_child (s=0x9a36f78, slot=0)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1602\n\tpid = 0\n#6  0x08092e4b in startup_children (number_to_start=1)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1658\n\ti = 0\n#7  0x08093570 in ap_mpm_run (_pconf=0x9a350a8, plog=0x9a65168, s=0x9a36f78)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1978\n\tremaining_children_to_start = 1\n#8  0x08064aeb in main (argc=2, argv=0xbff4d244) at /home/user1/httpd-\ntrunk/server/main.c:750\n\tc = 88 'X'\n\tconfigtestonly = 0\n\tconfname = 0x80a0e3d \"conf/httpd.conf\"\n\tdef_server_root = 0x80a0e4d \"/usr/local/apache2\"\n\ttemp_error_log = 0x0\n\terror = 0x0\n\tprocess = (process_rec *) 0x9a33128\n\tserver_conf = (server_rec *) 0x9a36f78\n\tpglobal = (apr_pool_t *) 0x9a330a0\n\tpconf = (apr_pool_t *) 0x9a350a8\n\tplog = (apr_pool_t *) 0x9a65168\n\tptemp = (apr_pool_t *) 0x9a69178\n\tpcommands = (apr_pool_t *) 0x9a370b0\n\topt = (apr_getopt_t *) 0x9a37148\n\trv = 0\n\tmod = (module **) 0x80ae0b0\n\toptarg = 0x0\n\tsignal_server = (apr_OFN_ap_signal_server_t *) 0\n#0  0x00110402 in __kernel_vsyscall ()\n(gdb) c\nContinuing.\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00117186 in apr_brigade_cleanup (data=0x0)\n    at /home/user1/httpd-trunk/srclib/apr-util/buckets/apr_brigade.c:42\n42\t    while (!APR_BRIGADE_EMPTY(b)) {\n(gdb) thread apply all bt full\n\nThread 6 (Thread -1250698352 (LWP 578)):\n#0  0x00110402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x003e0206 in pthread_cond_wait@@GLIBC_2.3.2 () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x0016cf4f in apr_thread_cond_wait (cond=0x9a99108, mutex=0x9a990d8)\n    at /home/user1/httpd-trunk/srclib/apr/locks/unix/thread_cond.c:68\n\trv = 0\n#3  0x08094e70 in ap_queue_info_wait_for_idler (queue_info=0x9a990c0)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/fdqueue.c:158\n\trv = 0\n\tprev_idlers = 0\n#4  0x08091849 in get_worker (have_idle_worker_p=0xb573d364)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:855\n\trc = 4112372\n#5  0x08091f10 in listener_thread (thd=0x9a991d0, dummy=0x9ac7168)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1087\n\trc = 0\n\tti = (proc_info *) 0x9ac7168\n\tprocess_slot = 0\n\ttpool = (apr_pool_t *) 0x9aa2f80\n\tcsd = (void *) 0x9b2bec8\n\tptrans = (apr_pool_t *) 0x9b2be90\n\tlr = (ap_listen_rec *) 0x9a33520\n\thave_idle_worker = 0\n\tcs = (conn_state_t *) 0x9ae5c40\n\tout_pfd = (const apr_pollfd_t *) 0x9aa3094\n\tnum = 0\n\ttime_now = 1187710592861859\n\ttimeout_interval = 1000000\n\ttimeout_time = 1187710592961859\n\tpt = (listener_poll_type *) 0x9aa30b0\n#6  0x00179754 in dummy_worker (opaque=0x9a991d0)\n    at /home/user1/httpd-trunk/srclib/apr/threadproc/unix/thread.c:142\n\tthread = (apr_thread_t *) 0x9a991d0\n#7  0x003dc44b in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#8  0x002bd80e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 5 (Thread -1240208496 (LWP 577)):\n#0  0x00117186 in apr_brigade_cleanup (data=0x0)\n    at /home/user1/httpd-trunk/srclib/apr-util/buckets/apr_brigade.c:42\n\tb = (apr_bucket_brigade *) 0x0\n\te = (apr_bucket *) 0x0\n#1  0x08079921 in ap_core_output_filter (f=0x9b2c568, new_bb=0x0)\n    at /home/user1/httpd-trunk/server/core_filters.c:357\n\tc = (conn_rec *) 0x9b2c0c0\n\tnet = (core_net_rec *) 0x9b2c540\n\tctx = (core_output_filter_ctx_t *) 0x9b2c5c8\n\tbb = (apr_bucket_brigade *) 0x808366d\n\tbucket = (apr_bucket *) 0x0\n\tnext = (apr_bucket *) 0x9b2c068\n\tbytes_in_brigade = 3054756600\n\tnon_file_bytes_in_brigade = 134755647\n#2  0x0809123c in process_socket (p=0x9b2be90, sock=0x9b2bec8, cs=0x9b2c068, \nmy_child_num=0, \n    my_thread_num=2) at /home/user1/httpd-\ntrunk/server/mpm/experimental/event/event.c:644\n\toutput_filter = (ap_filter_t *) 0x9b2c568\n\trv = 0\n\tc = (conn_rec *) 0x9b2c0c0\n\tpt = (listener_poll_type *) 0x9b2c0a0\n\tconn_id = 2\n\trc = -2\n\tsbh = (ap_sb_handle_t *) 0x9b2c060\n#3  0x080921e8 in worker_thread (thd=0x9a991b0, dummy=0x9ac7158)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1194\n\tti = (proc_info *) 0x9ac7158\n\tprocess_slot = 0\n\tthread_slot = 2\n\tcsd = (apr_socket_t *) 0x9b2bec8\n\tcs = (conn_state_t *) 0x0\n\tptrans = (apr_pool_t *) 0x9b2be90\n\trv = 0\n\tis_idle = 0\n#4  0x00179754 in dummy_worker (opaque=0x9a991b0)\n    at /home/user1/httpd-trunk/srclib/apr/threadproc/unix/thread.c:142\n\tthread = (apr_thread_t *) 0x9a991b0\n#5  0x003dc44b in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#6  0x002bd80e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 4 (Thread -1229718640 (LWP 576)):\n#0  0x00110402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x003e2a0e in __lll_mutex_lock_wait () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x003de883 in _L_mutex_lock_79 () from /lib/libpthread.so.0\nNo symbol table info available.\n#3  0x003de3ad in pthread_mutex_lock () from /lib/libpthread.so.0\nNo symbol table info available.\n#4  0x0016b2fc in apr_thread_mutex_lock (mutex=0x9aa2fb8)\n    at /home/user1/httpd-trunk/srclib/apr/locks/unix/thread_mutex.c:92\n\trv = 0\n#5  0x080912c0 in process_socket (p=0x9b0dcc8, sock=0x9b0dd00, cs=0x9b0dea0, \nmy_child_num=0, \n    my_thread_num=1) at /home/user1/httpd-\ntrunk/server/mpm/experimental/event/event.c:656\n\toutput_filter = (ap_filter_t *) 0x9b0e3a0\n\trv = 0\n\tc = (conn_rec *) 0x9b0def8\n\tpt = (listener_poll_type *) 0x9b0ded8\n\tconn_id = 1\n\trc = 2\n\tsbh = (ap_sb_handle_t *) 0x9b0e568\n#6  0x080921e8 in worker_thread (thd=0x9a99190, dummy=0x9ac7168)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1194\n\tti = (proc_info *) 0x9ac7168\n\tprocess_slot = 0\n\tthread_slot = 1\n\tcsd = (apr_socket_t *) 0x9b0dd00\n\tcs = (conn_state_t *) 0x9b0dea0\n\tptrans = (apr_pool_t *) 0x9b0dcc8\n\trv = 0\n\tis_idle = 0\n#7  0x00179754 in dummy_worker (opaque=0x9a99190)\n    at /home/user1/httpd-trunk/srclib/apr/threadproc/unix/thread.c:142\n\tthread = (apr_thread_t *) 0x9a99190\n#8  0x003dc44b in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#9  0x002bd80e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 3 (Thread -1219228784 (LWP 575)):\n#0  0x00110402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x003e2a0e in __lll_mutex_lock_wait () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x003de883 in _L_mutex_lock_79 () from /lib/libpthread.so.0\nNo symbol table info available.\n#3  0x003de3ad in pthread_mutex_lock () from /lib/libpthread.so.0\nNo symbol table info available.\n#4  0x0016b2fc in apr_thread_mutex_lock (mutex=0x9aa2fb8)\n    at /home/user1/httpd-trunk/srclib/apr/locks/unix/thread_mutex.c:92\n\trv = 0\n#5  0x080912c0 in process_socket (p=0x9ac78a0, sock=0x9ac78d8, cs=0x9ac7a78, \nmy_child_num=0, \n    my_thread_num=0) at /home/user1/httpd-\ntrunk/server/mpm/experimental/event/event.c:656\n\toutput_filter = (ap_filter_t *) 0x9ac7f78\n\trv = 0\n\tc = (conn_rec *) 0x9ac7ad0\n\tpt = (listener_poll_type *) 0x9ac7ab0\n\tconn_id = 0\n\trc = 2\n\tsbh = (ap_sb_handle_t *) 0x9ac8330\n#6  0x080921e8 in worker_thread (thd=0x9a99170, dummy=0x9ac7158)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1194\n\tti = (proc_info *) 0x9ac7158\n\tprocess_slot = 0\n\tthread_slot = 0\n\tcsd = (apr_socket_t *) 0x9ac78d8\n\tcs = (conn_state_t *) 0x9ac7a78\n\tptrans = (apr_pool_t *) 0x9ac78a0\n\trv = 0\n\tis_idle = 0\n#7  0x00179754 in dummy_worker (opaque=0x9a99170)\n    at /home/user1/httpd-trunk/srclib/apr/threadproc/unix/thread.c:142\n\tthread = (apr_thread_t *) 0x9a99170\n#8  0x003dc44b in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#9  0x002bd80e in clone () from /lib/libc.so.6\nNo symbol table info available.\n\nThread 1 (Thread -1208502592 (LWP 561)):\n#0  0x00110402 in __kernel_vsyscall ()\nNo symbol table info available.\n#1  0x003e3f3e in do_sigwait () from /lib/libpthread.so.0\nNo symbol table info available.\n#2  0x003e3fdf in sigwait () from /lib/libpthread.so.0\nNo symbol table info available.\n#3  0x0017b242 in apr_signal_thread (signal_handler=0x8092279 <check_signal>)\n    at /home/user1/httpd-trunk/srclib/apr/threadproc/unix/signals.c:383\n\tsignal_received = 4095\n\tsig_mask = {__val = {1073340935, 4294967294, 4294967295 <repeats 30 \ntimes>}}\n\tsig_func = (int (*)(int)) 0x8092279 <check_signal>\n#4  0x08092be4 in child_main (child_num_arg=0)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1520\n\tthreads = (apr_thread_t **) 0x9ac7148\n\trv = 0\n\tts = (thread_starter *) 0x9a98f90\n\tthread_attr = (apr_threadattr_t *) 0x9a98fa0\n\tstart_thread_id = (apr_thread_t *) 0x9a98fd8\n#5  0x08092d42 in make_child (s=0x9a36f78, slot=0)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1602\n\tpid = 0\n#6  0x08092e4b in startup_children (number_to_start=1)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1658\n\ti = 0\n#7  0x08093570 in ap_mpm_run (_pconf=0x9a350a8, plog=0x9a65168, s=0x9a36f78)\n    at /home/user1/httpd-trunk/server/mpm/experimental/event/event.c:1978\n\tremaining_children_to_start = 1\n#8  0x08064aeb in main (argc=2, argv=0xbff4d244) at /home/user1/httpd-\ntrunk/server/main.c:750\n\tc = 88 'X'\n\tconfigtestonly = 0\n\tconfname = 0x80a0e3d \"conf/httpd.conf\"\n\tdef_server_root = 0x80a0e4d \"/usr/local/apache2\"\n\ttemp_error_log = 0x0\n\terror = 0x0\n\tprocess = (process_rec *) 0x9a33128\n\tserver_conf = (server_rec *) 0x9a36f78\n\tpglobal = (apr_pool_t *) 0x9a330a0\n\tpconf = (apr_pool_t *) 0x9a350a8\n\tplog = (apr_pool_t *) 0x9a65168\n\tptemp = (apr_pool_t *) 0x9a69178\n\tpcommands = (apr_pool_t *) 0x9a370b0\n\topt = (apr_getopt_t *) 0x9a37148\n\trv = 0\n\tmod = (module **) 0x80ae0b0\n\toptarg = 0x0\n\tsignal_server = (apr_OFN_ap_signal_server_t *) 0\n0x00117186\t42\t    while (!APR_BRIGADE_EMPTY(b)) {\n(gdb) c\nContinuing.\n\nProgram terminated with signal SIGSEGV, Segmentation fault.\nThe program no longer exists.\n(gdb) quit\n", "id": 106969, "time": "2007-08-21T09:01:04Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-08-21T09:01:04Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 42031, "text": "Your latest backtrace appears to be a separate bug. The crashing thread is\ncrashing in sendfile_nonblocking, which is also new code in trunk.", "id": 106973, "attachment_id": null, "creator": "chip@force-elite.com", "creation_time": "2007-08-21T10:18:56Z", "time": "2007-08-21T10:18:56Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 42031, "text": "Please update to trunk again, I believe I have fixed the last crash with r568202:\nhttps://svn.apache.org/viewvc?view=rev&revision=568202", "id": 106975, "time": "2007-08-21T10:28:27Z", "creator": "chip@force-elite.com", "creation_time": "2007-08-21T10:28:27Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 42031, "is_private": false, "text": "I tried two source trees:\n(A)rev 568202\n(B)rev 568202 + revert r567852 ( svn merge -r 567852:567851 ./ )\n\n(A) works fine, there seems to be no issues.\nAnd I can reproduce the dead lock bug on (B).\nRESOLVED FIXED?\n\nthanks\n\n", "id": 107000, "time": "2007-08-21T18:08:08Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-08-21T18:08:08Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 42031, "text": "sorry, not resolved\n\nOn (A), repeat \n(4) execute many downloading simultaneously.\n(5) terminate downloading\nthen child freezes.\n\nReproducing the deadlock issue on (A) is harder than on (B),\nso r567852 is effective but not complete, IMHO.", "id": 107005, "time": "2007-08-21T19:09:07Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-08-21T19:09:07Z", "is_private": false, "attachment_id": null}, {"count": 10, "attachment_id": null, "creator": "takashi.asfbugzilla@tks.st", "text": "I took a bachtrace of a frozen child process.\nThe bt was the same as  bt I have posted in April.\n\n\"Reproducing the deadlock issue on (A) is harder than on (B)\" was how I felt, \nbut now seems wrong.", "id": 107015, "time": "2007-08-22T01:41:16Z", "bug_id": 42031, "creation_time": "2007-08-22T01:41:16Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 42031, "is_private": false, "text": "I tried 2.2 and reproduced the deadlock, so I tried that patch against 2.2.\n\nAother error occurs:\n\n[Wed Aug 22 19:51:22 2007] [error] event_loop: unexpected state 2\n[Wed Aug 22 19:51:22 2007] [crit] [Wed Aug 22 19:51:22 2007] \nfile /home/user1/httpd-2.2.x/server/mpm/experimental/event/event.c, line 925, \nassertion \"0\" failed\n[Wed Aug 22 19:51:23 2007] [notice] child pid 17224 exit signal Aborted (6)\n\nThis error occurs when I access a HTML page from browser.", "id": 107026, "time": "2007-08-22T05:17:14Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-08-22T05:17:14Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 42031, "is_private": false, "text": "Created attachment 20769\nfor trunk\n\nHow about this patch?\n\nnow:\napr_thread_mutex_lock(timeout_mutex)\nget_worker(&have_idle_worker)\nAPR_RING_REMOVE(cs, timeout_list)\napr_thread_mutex_unlock(timeout_mutex)\npush2worker(&cs->pfd, event_pollset)\n\nthis patch:\napr_thread_mutex_lock(timeout_mutex)\nAPR_RING_REMOVE(cs, timeout_list)\napr_thread_mutex_unlock(timeout_mutex)\nget_worker(&have_idle_worker)\npush2worker(&cs->pfd, event_pollset)", "id": 107712, "time": "2007-09-04T09:44:25Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-09-04T09:44:25Z", "attachment_id": 20769}, {"count": 13, "tags": [], "bug_id": 42031, "text": "I've committed a slightly modified version of your patch in r574462.", "id": 108003, "attachment_id": null, "creator": "chip@force-elite.com", "creation_time": "2007-09-10T22:30:28Z", "time": "2007-09-10T22:30:28Z", "is_private": false}]
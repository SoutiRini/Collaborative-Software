[{"count": 0, "tags": [], "bug_id": 61445, "is_private": false, "text": "Created attachment 35250\nCatalina log with SSL problem\n\nI have this Connector in server.xml:\n\n<Connector port=\"8443\" protocol=\"org.apache.coyote.http11.Http11NioProtocol\" maxThreads=\"150\" SSLEnabled=\"true\" scheme=\"https\" secure=\"true\">\n    <SSLHostConfig truststoreProvider=\"SunMSCAPI\" truststoreType=\"Windows-Root\" protocols=\"+TLSv1.2,+TLSv1.1,+TLSv1\">\n        <Certificate certificateKeystoreProvider=\"SunMSCAPI\" certificateKeystoreFile=\"\" certificateKeystoreType=\"Windows-MY\" certificateKeyAlias=\"my-web-cz\" type=\"RSA\" />\n    </SSLHostConfig>\n</Connector>\n\nTomcat is running as a service under account \"ServiceAccount\". In Tomcat 8.5.14 the site is functioning normally and certificate from LocalMachine (Windows-Root) is accessed and used.\nSetting certificateKeystoreFile=\"\" is correct for SunMSCAPI, not an error, without it the \"java.lang.IllegalArgumentException: Illegal character in opaque part at index 2: C:\\Users\\ServiceAccount/.keystore\" occurs.\n\nHowever after upgrading 8.5.14 to 8.5.20, this error appears in log (see attachment for full log):\n\n...\n17-Aug-2017 16:41:45.976 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent Loaded APR based Apache Tomcat Native library [1.2.12] using APR version [1.5.2].\n17-Aug-2017 16:41:45.976 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR capabilities: IPv6 [true], sendfile [true], accept filters [false], random [true].\n17-Aug-2017 16:41:45.976 INFO [main] org.apache.catalina.core.AprLifecycleListener.lifecycleEvent APR/OpenSSL configuration: useAprConnector [false], useOpenSSL [true]\n17-Aug-2017 16:41:46.633 INFO [main] org.apache.catalina.core.AprLifecycleListener.initializeSSL OpenSSL successfully initialized [OpenSSL 1.0.2k  26 Jan 2017]\n17-Aug-2017 16:41:46.836 INFO [main] org.apache.coyote.AbstractProtocol.init Initializing ProtocolHandler [\"https-openssl-nio-8443\"]\n17-Aug-2017 16:41:47.398 SEVERE [main] org.apache.coyote.AbstractProtocol.init Failed to initialize end point associated with ProtocolHandler [\"https-openssl-nio-8443\"]\n java.lang.IllegalArgumentException: java.security.KeyStoreException: Cannot get key bytes, not PKCS#8 encoded\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.createSSLContext(AbstractJsseEndpoint.java:114)\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.initialiseSsl(AbstractJsseEndpoint.java:85)\n\tat org.apache.tomcat.util.net.NioEndpoint.bind(NioEndpoint.java:225)\n\tat org.apache.tomcat.util.net.AbstractEndpoint.init(AbstractEndpoint.java:982)\n\tat org.apache.tomcat.util.net.AbstractJsseEndpoint.init(AbstractJsseEndpoint.java:244)\n\tat org.apache.coyote.AbstractProtocol.init(AbstractProtocol.java:620)\n\tat org.apache.coyote.http11.AbstractHttp11Protocol.init(AbstractHttp11Protocol.java:66)\n\tat org.apache.catalina.connector.Connector.initInternal(Connector.java:997)\n\tat org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:107)\n\tat org.apache.catalina.core.StandardService.initInternal(StandardService.java:549)\n...", "id": 200370, "time": "2017-08-18T07:03:55Z", "creator": "radek.nemec@solitea.cz", "creation_time": "2017-08-18T07:03:55Z", "attachment_id": 35250}, {"count": 1, "tags": [], "bug_id": 61445, "is_private": false, "text": "> In Tomcat 8.5.14 the site is functioning normally and certificate from\n> LocalMachine (Windows-Root) is accessed and used.\n\nI wanted to write CurrentUser (Windows-MY) instead of LocalMachine (Windows-Root).", "id": 200371, "time": "2017-08-18T07:11:06Z", "creator": "radek.nemec@solitea.cz", "creation_time": "2017-08-18T07:11:06Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 61445, "text": "Seems to be duplicate of https://bz.apache.org/bugzilla/show_bug.cgi?id=61451. Can someone prove this?", "id": 200503, "time": "2017-08-28T21:41:43Z", "creator": "radek.nemec@solitea.cz", "creation_time": "2017-08-28T21:41:43Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 61445, "text": "Confirmed. This is a duplicate.\n\n*** This bug has been marked as a duplicate of bug 61451 ***", "id": 200550, "time": "2017-08-31T19:35:43Z", "creator": "markt@apache.org", "creation_time": "2017-08-31T19:35:43Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "attachment_id": null, "bug_id": 46535, "text": "I use following codes which assign a string value into a cell.\n\nThat cell is a formula cell originally, I found that after the value is assigned, the cell type is still remain \"Formula Type\".\n\nAND when I open the output excel file, it cannot be opened by MS Excel 2007.\n(In fact, it can be opened but which need to be recovered by MS Excel 2007.)\n\n--\n\nWorkbook wb = new XSSFWorkbook(\"original.xlsm\");\nString value = \"ABC\";\nSheet sheet = wb.getSheet(\"Test\");\nRow row = sheet.getRow(0);\nCell cell = row.getCell(4);\nSystem.out.println(\"before cell.getCellType() :\" + cell.getCellType());\ncell.setCellType(Cell.CELL_TYPE_STRING);\ncell.setCellValue(value);\ncell.setCellType(Cell.CELL_TYPE_STRING);\nSystem.out.println(\"after cell.getCellType() :\" + cell.getCellType());\nFileOutputStream output = new FileOutputStream(\"output.xlsm\");\nwb.write(output);\n\n--\n\nThanks!", "id": 124067, "time": "2009-01-14T22:41:30Z", "creator": "matthew.knl@gmail.com", "creation_time": "2009-01-14T22:41:30Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "matthew.knl@gmail.com", "attachment_id": 23120, "id": 124068, "time": "2009-01-14T22:42:43Z", "bug_id": 46535, "creation_time": "2009-01-14T22:42:43Z", "is_private": false, "text": "Created attachment 23120\nthe source excel file."}, {"count": 2, "tags": [], "bug_id": 46535, "attachment_id": 23121, "text": "Created attachment 23121\nthe ouput excel file.", "id": 124069, "time": "2009-01-14T22:43:52Z", "creator": "matthew.knl@gmail.com", "creation_time": "2009-01-14T22:43:52Z", "is_private": false}, {"text": "Created attachment 23122\nerror prompt by ms excel 2007", "tags": [], "bug_id": 46535, "attachment_id": 23122, "count": 3, "id": 124070, "time": "2009-01-14T22:44:20Z", "creator": "matthew.knl@gmail.com", "creation_time": "2009-01-14T22:44:20Z", "is_private": false}, {"count": 4, "attachment_id": 23123, "bug_id": 46535, "text": "Created attachment 23123\nerror fixed by ms excel 2007", "id": 124071, "time": "2009-01-14T22:44:41Z", "creator": "matthew.knl@gmail.com", "creation_time": "2009-01-14T22:44:41Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 46535, "attachment_id": null, "text": "I have to delay my company project because it rely heavily on this function. I raise the severity to critical and hope POI developers can get this bug resolved. Many thanks!", "id": 124675, "time": "2009-02-05T00:01:26Z", "creator": "matthew.knl@gmail.com", "creation_time": "2009-02-05T00:01:26Z", "is_private": false}, {"count": 6, "tags": [], "creator": "dfisher@jmlafferty.com", "attachment_id": null, "id": 124680, "time": "2009-02-05T09:01:38Z", "bug_id": 46535, "creation_time": "2009-02-05T09:01:38Z", "is_private": false, "text": "Hi -\n\nSo far XSSFWorkbook supports xlsx and does not yet support xlsm.\n\nxlsm is the version that can carry macros and program code.\n\nI have two thoughts:\n\n(1) What happens if you make and open an xlsx files instead. You can just change the suffix.\n\n(2) The error box you attached show that there is a log file of repairs made. It might help if you would attach that as well.\n\nFYI - xlsm is on the list, but we aren't sure when we will get to it - SpreadsheetML support is already ahead of WordProcessingML (docx) and PresentationML (pptx)\n\nRegards,\nDave"}, {"attachment_id": null, "tags": [], "creator": "matthew.knl@gmail.com", "text": "Thanks for your reply!\nNow I use a xlsx file for testing, it produces the same error, please check the\nattachment file.\n", "count": 7, "id": 124687, "time": "2009-02-05T22:06:33Z", "bug_id": 46535, "creation_time": "2009-02-05T22:06:33Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 46535, "text": "Created attachment 23236\nxlsx file for test", "id": 124689, "time": "2009-02-05T22:08:53Z", "creator": "matthew.knl@gmail.com", "creation_time": "2009-02-05T22:08:53Z", "is_private": false, "attachment_id": 23236}, {"count": 9, "tags": [], "text": "Created attachment 23237\nexcel error log", "attachment_id": 23237, "bug_id": 46535, "id": 124690, "time": "2009-02-05T22:09:09Z", "creator": "matthew.knl@gmail.com", "creation_time": "2009-02-05T22:09:09Z", "is_private": false}, {"count": 10, "attachment_id": null, "bug_id": 46535, "text": "You are not supposed to call setCellType directly, instead setCellValue(String) does it for you behind the scene.\n\nThere are two possible scenarios when setting value for a formula cell;\n\n 1. Update the precalculated value of the formula.\n If a cell contains formula then cell.setCellValue just updates the precalculated formula value, \n the formula iself remains and the cell type is not changed:\n\n        XSSFWorkbook wb = new XSSFWorkbook(\"original.xlsx\");\n        XSSFSheet sheet = wb.getSheet(\"Test\");\n        XSSFRow row = sheet.getRow(0);\n        XSSFCell cell = row.getCell(4);\n        cell.setCellValue(\"ABC\"); //only update the precalculated formula value, the cell type remains CELL_TYPE_FORMULA.\n        FileOutputStream output = new FileOutputStream(\"output.xlsx\");\n        wb.write(output);\n        output.close();\n\n 2. Remove the formula and change the cell type to String or Number:\n\n        XSSFWorkbook wb = new XSSFWorkbook(\"original.xlsx\");\n        XSSFSheet sheet = wb.getSheet(\"Test\");\n        XSSFRow row = sheet.getRow(0);\n        XSSFCell cell = row.getCell(4);\n        cell.setCellFormula(null); //Remove the formula\n        cell.setCellValue(\"ABC\"); //set the string value, the cell type is changed to CELL_TYPE_STRING\n        FileOutputStream output = new FileOutputStream(\"output.xlsx\");\n        wb.write(output);\n        output.close();\n\n\nExcel 2007 files can contain supplementary data called Calculation Chain. This object specifies the order in which the cells in a workbook were last calculated. It turns out that when a formula is deleted we need to remove all references to it from the calculation chain, otherwise the resulting file cannot be opened.\nThis problem was fixed in r742077.\n\nRegards,\nYegor", "id": 124713, "time": "2009-02-08T05:24:19Z", "creator": "yegor@dinom.ru", "creation_time": "2009-02-08T05:24:19Z", "tags": [], "is_private": false}]
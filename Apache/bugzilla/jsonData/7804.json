[{"count": 0, "tags": [], "bug_id": 7804, "attachment_id": null, "id": 12947, "time": "2002-04-07T01:04:30Z", "creator": "maxes2@chat.ru", "creation_time": "2002-04-07T01:04:30Z", "is_private": false, "text": "In httdp.conf :\n...\nChildperUserID  test1 test1 1\nChildperUserID  test2 test2 2\nChildperUserID  test3 test3 3\n\n<VirtualHost 10.0.1.1>\n    ServerAdmin x@y.z\n    DocumentRoot /usr/local/apache2/htdocs/test\n    ServerName h11.test\n    ErrorLog /dev/null\n    CustomLog /dev/null common\n    AssignUserID test1 test1\n</VirtualHost>\n...\nother virtual host sections\n\n\nOn start apache say:\nSyntax error on line 1064 of /usr/local/apache2/conf/httpd.conf:\nUnable to find process with matching uid/gid.\n/usr/local/apache2/bin/apachectl start: httpd could not be started\n\nline 1064 in my case is \"AssignUserID test1 test1\"\n\nUnder gdb :\nstructure child_info_table fill not correct, imho.\n(gdb) p child_info_table[0]\n$23 = {uid = 1002, gid = 1002, sd = -1}\n(gdb) p child_info_table[1]\n$24 = {uid = 1002, gid = 1002, sd = -1}\n(gdb) p child_info_table[2]\n$25 = {uid = 1003, gid = 1003, sd = -1}\n(gdb) p child_info_table[3]\n$26 = {uid = 1003, gid = 1003, sd = -1}\n(gdb) p child_info_table[4]\n$27 = {uid = 1003, gid = 1003, sd = -1}\n(gdb) p child_info_table[5]\n$28 = {uid = 4294967295, gid = 4294967295, sd = -1}\n(gdb) p child_info_table[6]\n$29 = {uid = 4294967295, gid = 4294967295, sd = -1}\n\nuid test1 is 1001, test2 = 1002, test3 = 1003\nAs You see, first element absent, but we have 2 1002 and 3 1003  member.\nIf don't use FIRST assignet uid/gid (1001/1001), then server start and some\nchild fork under SECOND uid/gid test2/test2 (1002/1002):\n ps axuww| grep http | grep test2\ntest2   1127  0.0  1.2 14196 3100  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1128  0.0  1.2 16316 3164  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1132  0.0  1.2 16316 3164  ??  S     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1135  0.0  1.2 14196 3100  ??  S     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1136  0.0  1.2 16316 3164  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1140  0.0  1.2 14196 3100  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1141  0.0  1.2 16316 3164  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1145  0.0  1.2 14196 3100  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1146  0.0  1.2 16316 3164  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1150  0.0  1.2 14196 3100  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1151  0.0  1.2 16316 3164  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1155  0.0  1.2 14196 3100  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1156  0.0  1.2 16316 3164  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1160  0.0  1.2 14196 3100  ??  I     4:08     0:00.00\n/usr/local/apache2/bin/httpd\ntest2   1174  0.0  1.2 16316 3164  ??  I     4:10     0:00.00\n/usr/local/apache2/bin/httpd\n\nBut other child work from user test3, who present in \"ChildperUserID\", but\nnot assigned for any virtualhost.\n\nI belive, that function set_child_per_uid() work incorrect.\nSee patch below (in first test all work):\n\n--- server/mpm/perchild/perchild.c.orig Sun Apr  7 04:28:15 2002\n+++ server/mpm/perchild/perchild.c      Sun Apr  7 04:50:37 2002\n@@ -1823,22 +1823,19 @@\n                                      const char *g, const char *num)\n {\n-    int i;\n-    int max_this_time = atoi(num) + curr_child_num;\n+    int curr_num = atoi(num);\n\n-    for (i = curr_child_num; i < max_this_time; i++, curr_child_num++) {\n-        child_info_t *ug = &child_info_table[i - 1];\n-\n-        if (i > num_daemons) {\n+    if (curr_num > num_daemons) {\n             return \"Trying to use more child ID's than NumServers.  Increase \"\n                    \"NumServers in your config file.\";\n-        }\n-\n-        ug->uid = ap_uname2id(u);\n-        ug->gid = ap_uname2id(g);\n+    }\n+    {\n+       child_info_t *ug = &child_info_table[curr_num-1];\n+       ug->uid = ap_uname2id(u);\n+       ug->gid = ap_uname2id(g);\n\n #ifndef BIG_SECURITY_HOLE\n-        if (ug->uid == 0 || ug->gid == 0) {\n+       if (ug->uid == 0 || ug->gid == 0) {\n             return \"Assigning root user/group to a child.\";\n-        }\n+       }\n #endif\n     }"}, {"count": 1, "tags": [], "creator": "jerenkrantz@apache.org", "attachment_id": null, "id": 13583, "time": "2002-04-15T06:38:17Z", "bug_id": 7804, "creation_time": "2002-04-15T06:38:17Z", "is_private": false, "text": "Are you really using FreeBSD?  Threading on FreeBSD is NOT supported by APR and\nApache httpd-2.0.\n\nThanks for using Apache!"}, {"count": 2, "attachment_id": null, "bug_id": 7804, "text": "Yes. With linux_threads + some changes (more hack, then patch) in configure.\n(As in case mysqld, for imporvment performance).\n>* If you are building on FreeBSD, be aware that threads will\n>  be disabled and the prefork MPM will be used by default,\n>  as threads do not work well with Apache on FreeBSD.  If\n>  you wish to try a threaded Apache on FreeBSD anyway, use\n>  \"./configure --enable-threads\".\n\nWork with worker MPM and with perchild. ", "id": 13619, "time": "2002-04-15T12:59:55Z", "creator": "maxes2@chat.ru", "creation_time": "2002-04-15T12:59:55Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 7804, "attachment_id": null, "text": "Perchild is an experimental MPM and is not currently expected to work on\nplatforms other than Linux.  In the forthcoming release of Apache 2.0.36, we\nhave moved perchild to our experimental/mpm directory.  This should better\nindicate our perspective on perchild's status.\n\nThere is not enough developer support currently to maintain perchild and see\nthat it works on all supported platforms of Apache 2.0.  If you wish to\ncontribute patches, we will welcome them on the developer mailing list. \nHowever, we will not provide support for perchild on the bug database until we\nhave enough developer support to improve the quality of the perchild MPM code first.\n\nThanks for using Apache!", "id": 14690, "time": "2002-04-25T06:33:17Z", "creator": "jerenkrantz@apache.org", "creation_time": "2002-04-25T06:33:17Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 7804, "attachment_id": null, "text": "switch to wontfix, since it's not maintained.", "id": 63644, "time": "2004-09-15T22:59:54Z", "creator": "nd@perlig.de", "creation_time": "2004-09-15T22:59:54Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 7804, "text": "I have some problem in Gentoo linux with last emerge update (Apache/2.0.52)\n\nWhy it's bug not fixed yet? :(", "id": 68948, "time": "2004-12-23T23:55:42Z", "creator": "balancer@balancer.ru", "creation_time": "2004-12-23T23:55:42Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 7804, "text": "perchild DOES NOT WORK and is not maintained until someone feels like she should\nrestart development.", "id": 68949, "time": "2004-12-24T00:05:03Z", "creator": "nd@perlig.de", "creation_time": "2004-12-24T00:05:03Z", "is_private": false, "attachment_id": null}]
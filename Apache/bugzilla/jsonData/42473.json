[{"count": 0, "tags": [], "bug_id": 42473, "is_private": false, "text": "Dear all,\n\nwe have a webmail platform based on Reverse Proxies + Apache + Squirrelmail. \n\nLately we updated Apache's from 1.3.x to 2.0.54 (using standard Sarge Debian\npackages), since this update, we are watching that Apache reaches MaxClients\noften (once or twice daily), and the only one way to restore the service is to\nrestart the daemon.\n\nLuckly, we have been able to test a \"hanged-up\" server, and we made several\ntest/meassures:\n1. We noticed that MaxClients works, because it's configured to manage X clients\nand there're X processes runing into de OS.\n2. We watched that we had X established connections too.\nAt this point everything looks fine, but there are a few strange things...\n3. The connection among reverse proxy and apaches didn't carry data, just ACKs.\nWhy isn't TimeOut rejecting this connections?\n4. In order to verify who's working bad Apache or Proxies (Although the haven't\nbeen cahnged during the update), we inserted a rule into the firewall rejecting\nany input packet to the webserver.\nResult: connections became closed, but only after 45 minutes (and our TimeOut is\nconfigured in 120 seconds...!)\n5. Once connections closed, we hoped that processes should be removed, and the\nserver will start to accept new incoming requests. Not as expected, the server\nis still \"hanged-up\".\n\nData:\nMDM: Prefork\n\nii  apache-common  1.3.33-6sarge3 support files for all Apache webservers\nii  apache2        2.0.54-5sarge1 next generation, scalable, extendable web se\nii  apache2-common 2.0.54-5sarge1 next generation, scalable, extendable web se\nii  apache2-mpm-pr 2.0.54-5sarge1 traditional model for Apache2\nii  apache2-utils  2.0.54-5sarge1 utility programs for webservers\nii  libapache2-mod 4.3.10-19      server-side, HTML-embedded scripting languag\n\nLockFile /var/lock/apache2/accept.lock\nPidFile /var/run/apache2.pid\nTimeout 120\nKeepAlive Off\nMaxKeepAliveRequests 100\nKeepAliveTimeout 15\nServerTokens Prod\n\n<IfModule prefork.c>\nStartServers        10\nMinSpareServers     10\nMaxSpareServers     15\nMaxClients          25\nMaxRequestsPerChild 1000\n</IfModule>", "id": 103423, "time": "2007-05-21T09:33:49Z", "creator": "borja.pacheco@juntadeandalucia.es", "creation_time": "2007-05-21T09:33:49Z", "attachment_id": null}, {"count": 1, "text": "This might be a problem with PHP / Squirrelmail. Please try to obtain backtraces\nfrom \"hanging\" processes (see http://httpd.apache.org/dev/debugging.html).\nYou might misread the meaning of Timeout in httpd. Timeout here means the\nmaximum amount of time httpd waits to *write* data to or to *read* data from the\nnetwork. If you are using PHP via mod_php (running as a CGI is a different\nstory) and your php script simply generates no output httpd will keep the\nconnection open forever which works as designed as there is nothing to read from\nthe network for httpd (we are sending the response) and there is nothing to\nwrite to the network (since the script produces no output). The\nmax_execution_time setting in PHP is used to prevent such long running scripts.\nI cannot tell you if this works reliable.", "bug_id": 42473, "is_private": false, "id": 103443, "time": "2007-05-21T14:14:43Z", "creator": "rpluem@apache.org", "creation_time": "2007-05-21T14:14:43Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 42473, "is_private": false, "text": "Additional information....\n\nThis is the variable of the max_execution_time...\nphp.ini:max_execution_time = 30     ; Maximum execution time of each script, in\nseconds\n\nAs you could see, after 30 seconds the execution should be turned off, and\nprocesses being released, but it didn't happen.\n\n\n\n", "id": 103476, "time": "2007-05-22T00:53:33Z", "creator": "borja.pacheco@juntadeandalucia.es", "creation_time": "2007-05-22T00:53:33Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "borja.pacheco@juntadeandalucia.es", "attachment_id": null, "text": "Debug info...\n\n#ps -ef | grep apache\nroot      5224     1  0 May20 ?        00:00:02 /usr/sbin/apache2 -k start -DSSL\nDebian-   5171  5224  0 May21 ?        00:00:00 /usr/sbin/apache2 -k start -DSSL\nDebian-   5183  5224  0 May21 ?        00:00:01 /usr/sbin/apache2 -k start -DSSL\n\n// ***************************************************\n// PSTACK\n// ***************************************************\nIt's seems that there aren't symbols into binaries included into Debian package,\nso, there's no inof here, isn't there?\n\n#pstack  5224        \n\n5224: /usr/sbin/apache2 -k start -DSSL\n(No symbols found)\n0x4042b9f8: ???? (f4240, 0, bffff118, 1, 80b00a8, c)\n0x08084598: ???? (bffff118, bffff11c, bffff120, 80b00a8, 80b4b78, 809c495) + 40\n0x08077042: ???? (80b00a8, 80e6180, 80b4b78, 80b4b78, bffff194, 403651a8) + 40\n0x0807da8d: ???? (4, bffff234, bffff248, 0, 4048bf40, 40016540) + 40\n0x4036f974: ???? (807d3c0, 4, bffff234, 80948e0, 8094940, 4000c380) + 40000dd8\n\n# pstack 5183\n\n5183: /usr/sbin/apache2 -k start -DSSL\n(No symbols found)\n0x40424ca1: ???? (8225c8c, 824dae4, bfffa048, 40726945, 8235574, 40883dc1) + 80\n0x406713eb: ???? (408cc3f0, 824dae4, bfffa0b4, bfffa0b8, 824dae4, 82a95ec) + 10\n0x4066d656: ???? (82a95ec, 20, a, bfffa100, 0, bfffa104) + 30\n0x4066ebe0: ???? (408c8274, 8c)\n0x40670660: ???? (0, 824db1c, 0, 0, 4, bfffa14c) + 2a0\n0x407331c0: ???? (824d9e8, 0, 0, 4071a600, 0, 0) + bf0\n0x40732f25: ???? (824da4c, 8, 2d, bfffb808, 4, 0) + 8e0\n0x40734614: ???? (821634c, 8, 2b, bfffca88, 4, 0) + 1260\n0x40734614: ???? (8227c94, 2, 408d03e0, 827e990, 1, bfffcbc4) + 10\n0x40722db1: ???? (8, 0, 3, 0, bfffedc0, 0) + 2120\n0x406f4ebf: ???? (bfffedc0, 820ed10, 40737c30, 80606c8, 0, bfffebf8) + 1b0\n0x4073834f: ???? (820c5b0, 80b5868, 0, 820c5b0, 820c5b0, 8128cb0)\n0x08078375: ???? (820c5b0, 3b, 81e792c, 820c5b0, 0, 81e78e8) + 20\n0x08078980: ???? (820c5b0, 0, 4, 820c5b0, 81e78e8, 820c5b0)\n0x08069c6a: ???? (820c5b0, 4, 820c5b0, 808370c, 81e78e8, 81e7810) + 10\n0x0806512d: ???? (81e78e8, 81e7810, 2, 81e5890, 81e78e8, 8206560)\n0x080835c5: ???? (81e78e8, 81e7810, 81e7810, 18, 81e5848, 8206560) + 30\n0x08076974: ???? (18, 1, 1, 0, 1, 816f120) + 10\n0x08076ac7: ???? (80b4b78, 18, 40399c4, 40016ed8, 805957d, bffff074) + c0\n0x08076d59: ???? (80b00a8, bffff11c, bffff120, 80b00a8, 80b4b78, 809c495) + 40\n0x08077445: ???? (80b00a8, 80e6180, 80b4b78, 80b4b78, bffff194, 403651a8) + 40\n0x0807da8d: ???? (4, bffff234, bffff248, 0, 4048bf40, 40016540) + 40\n0x4036f974: ???? (807d3c0, 4, bffff234, 80948e0, 8094940, 4000c380) + 40000dd8\n\n\n// ***************************************************\n// STRACE\n// ***************************************************\nThe process outputs these calls, and it doesn't change when I try making a\nconnection to the httpd process\n\n# strace -p  5224        \nProcess 5224 attached - interrupt to quit\nselect(0, NULL, NULL, NULL, {0, 920000}) = 0 (Timeout)\nwaitpid(-1, 0xbffff090, WNOHANG|WUNTRACED) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwaitpid(-1, 0xbffff090, WNOHANG|WUNTRACED) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwaitpid(-1, 0xbffff090, WNOHANG|WUNTRACED) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwaitpid(-1, 0xbffff090, WNOHANG|WUNTRACED) = 0\nselect(0, NULL, NULL, NULL, {1, 0})     = 0 (Timeout)\nwaitpid(-1, 0xbffff090, WNOHANG|WUNTRACED) = 0\nselect(0, NULL, NULL, NULL, {1, 0} <unfinished ...>\nProcess 5224 detached\n\nChild seems to be more interesting. It looks like locked...\n# strace -p 5183          \nProcess 5183 attached - interrupt to quit\nflock(27, LOCK_EX\n\nMust I perform any other debug command?\n\nThanks in advance.", "id": 103479, "time": "2007-05-22T01:10:14Z", "bug_id": 42473, "creation_time": "2007-05-22T01:10:14Z", "is_private": false}, {"count": 4, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "text": "Without symbols it is nearly impossible to track this. Furthermore please use\ngdb to obtain a backtrace as described on\nhttp://httpd.apache.org/dev/debugging.html.\nYou only need to analyse the stuck non-root processes. The process running under\nroot is of no interest here.", "id": 103483, "time": "2007-05-22T02:04:25Z", "bug_id": 42473, "creation_time": "2007-05-22T02:04:25Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 42473, "is_private": false, "id": 103487, "attachment_id": null, "creator": "borja.pacheco@juntadeandalucia.es", "creation_time": "2007-05-22T02:25:55Z", "time": "2007-05-22T02:25:55Z", "text": "While I try to execute gdb, another detail...\n\nThis is the strace of a child process on a server which's at this moment working\nfine. Here there's not lock.\nIs this a clue? \n\n# strace -p 22084\nProcess 22084 attached - interrupt to quit\nsemop(622594, 0x4030e7ec, 1 <unfinished ...>\nProcess 22084 detached"}, {"count": 6, "tags": [], "bug_id": 42473, "is_private": false, "id": 103489, "attachment_id": null, "creator": "borja.pacheco@juntadeandalucia.es", "creation_time": "2007-05-22T02:34:30Z", "time": "2007-05-22T02:34:30Z", "text": "Questions about gdb:\n\n1. Should I recompile with symbols before using gdb?\n2. Because I can't follow some steps to make a fail, I suppose I should wait\nuntil all my child process get hanged (as at this moment) and then execute gdb\nagainst a child-pid, don't I?\n3. Once in debugging mode, which variables do we need to get?\n\n# gdb /usr/sbin/apache2 5183\nGNU gdb 6.3-debian\nCopyright 2004 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-linux\"...(no debugging symbols found)\nUsing host libthread_db library \"/lib/tls/libthread_db.so.1\".\n\nAttaching to program: /usr/sbin/apache2, process 5183\n(no debugging symbols found)\n`system-supplied DSO at 0xffffe000' has disappeared; keeping its symbols.\nReading symbols from /lib/tls/libdl.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libdl.so.2\nReading symbols from /lib/tls/libcrypt.so.1...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libcrypt.so.1\nReading symbols from /usr/lib/libpcre.so.3...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libpcre.so.3\nReading symbols from /usr/lib/libz.so.1...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libz.so.1\nReading symbols from /usr/lib/i686/cmov/libssl.so.0.9.7...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/i686/cmov/libssl.so.0.9.7\nReading symbols from /usr/lib/i686/cmov/libcrypto.so.0.9.7...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/i686/cmov/libcrypto.so.0.9.7\nReading symbols from /usr/lib/libaprutil-0.so.0...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/lib/libaprutil-0.so.0\nReading symbols from /usr/lib/libldap_r.so.2...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libldap_r.so.2\nReading symbols from /usr/lib/liblber.so.2...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/liblber.so.2\nReading symbols from /usr/lib/libdb-4.2.so...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libdb-4.2.so\nReading symbols from /usr/lib/libexpat.so.1...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libexpat.so.1\nReading symbols from /usr/lib/libapr-0.so.0...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libapr-0.so.0\nReading symbols from /lib/tls/librt.so.1...\n(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/librt.so.1\nReading symbols from /lib/tls/libm.so.6...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libm.so.6\nReading symbols from /lib/tls/libnsl.so.1...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libnsl.so.1\nReading symbols from /lib/tls/libpthread.so.0...(no debugging symbols found)...done.\n[Thread debugging using libthread_db enabled]\n[New Thread 1079503776 (LWP 5183)]\nLoaded symbols for /lib/tls/libpthread.so.0\nReading symbols from /lib/tls/libc.so.6...\n(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libc.so.6\nReading symbols from /lib/ld-linux.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/ld-linux.so.2\nReading symbols from /lib/tls/libresolv.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libresolv.so.2\nReading symbols from /usr/lib/libsasl2.so.2...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libsasl2.so.2\nReading symbols from /usr/lib/libgnutls.so.11...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libgnutls.so.11\nReading symbols from /usr/lib/libtasn1.so.2...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libtasn1.so.2\nReading symbols from /usr/lib/libgcrypt.so.11...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libgcrypt.so.11\nReading symbols from /usr/lib/libgpg-error.so.0...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/lib/libgpg-error.so.0\nReading symbols from /lib/tls/libnss_files.so.2...\n(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libnss_files.so.2\nReading symbols from /usr/lib/apache2/modules/mod_mime_magic.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_mime_magic.so\nReading symbols from /usr/lib/apache2/modules/mod_expires.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_expires.so\nReading symbols from /usr/lib/apache2/modules/mod_deflate.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_deflate.so\nReading symbols from /usr/lib/apache2/modules/mod_vhost_alias.so...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_vhost_alias.so\nReading symbols from /usr/lib/apache2/modules/mod_userdir.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_userdir.so\nReading symbols from /usr/lib/apache2/modules/mod_rewrite.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_rewrite.so\nReading symbols from /usr/lib/apache2/modules/mod_ssl.so...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_ssl.so\nReading symbols from /usr/lib/apache2/modules/libphp4.so...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/libphp4.so\nReading symbols from /usr/lib/libzzip-0.so.12...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libzzip-0.so.12\nReading symbols from /usr/lib/libbz2.so.1.0...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libbz2.so.1.0\nReading symbols from /usr/lib/libgssapi_krb5.so.2...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/lib/libgssapi_krb5.so.2\nReading symbols from /usr/lib/libkrb5.so.3...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libkrb5.so.3\nReading symbols from /usr/lib/libk5crypto.so.3...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/lib/libk5crypto.so.3\nReading symbols from /lib/libcom_err.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/libcom_err.so.2\nReading symbols from /usr/lib/apache2/modules/mod_unique_id.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_unique_id.so\nReading symbols from /usr/lib/php4/20020429/ldap.so...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/php4/20020429/ldap.so\nReading symbols from /usr/lib/php4/20020429/apc.so...done.\nLoaded symbols for /usr/lib/php4/20020429/apc.so\nReading symbols from /lib/tls/libnss_compat.so.2...done.\nLoaded symbols for /lib/tls/libnss_compat.so.2\nReading symbols from /lib/tls/libnss_nis.so.2...done.\nLoaded symbols for /lib/tls/libnss_nis.so.2\nReading symbols from /lib/libnss_ldap.so.2...done.\nLoaded symbols for /lib/libnss_ldap.so.2\nReading symbols from /usr/lib/sasl2/libsasldb.so.2...done.\nLoaded symbols for /usr/lib/sasl2/libsasldb.so.2\nReading symbols from /lib/tls/libnss_dns.so.2...done.\nLoaded symbols for /lib/tls/libnss_dns.so.2\n0x40424ca1 in flock () from /lib/tls/libc.so.6\n(gdb)"}, {"count": 7, "tags": [], "bug_id": 42473, "attachment_id": null, "text": "(In reply to comment #6)\n> Questions about gdb:\n> \n> 1. Should I recompile with symbols before using gdb?\n\nThat would be helpful, but is not strictly needed. You can make a first try with\nyour current binary.\n\n> 2. Because I can't follow some steps to make a fail, I suppose I should wait\n> until all my child process get hanged (as at this moment) and then execute gdb\n> against a child-pid, don't I?\n\nYes, attachg gdb to a hanging process (aka live backtrace). See\nhttp://httpd.apache.org/dev/debugging.html#backtrace\n\n> 3. Once in debugging mode, which variables do we need to get?\n\nJust do\n\nthread apply all bt full\n\nand we get everything that is there and that is needed for the start. If more is\nneeded it needs to be specified later.", "id": 103490, "time": "2007-05-22T02:42:00Z", "creator": "rpluem@apache.org", "creation_time": "2007-05-22T02:42:00Z", "is_private": false}, {"count": 8, "tags": [], "creator": "borja.pacheco@juntadeandalucia.es", "is_private": false, "id": 103495, "attachment_id": null, "bug_id": 42473, "creation_time": "2007-05-22T03:29:44Z", "time": "2007-05-22T03:29:44Z", "text": "Thanks a lot for your clarifications.\nHere it is...\n\n\n# gdb /usr/sbin/apache2 5183                       \nGNU gdb 6.3-debian\nCopyright 2004 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-linux\"...(no debugging symbols found)\nUsing host libthread_db library \"/lib/tls/libthread_db.so.1\".\n\nAttaching to program: /usr/sbin/apache2, process 5183\n(no debugging symbols found)\n`system-supplied DSO at 0xffffe000' has disappeared; keeping its symbols.\nReading symbols from /lib/tls/libdl.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libdl.so.2\nReading symbols from /lib/tls/libcrypt.so.1...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libcrypt.so.1\nReading symbols from /usr/lib/libpcre.so.3...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libpcre.so.3\nReading symbols from /usr/lib/libz.so.1...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libz.so.1\nReading symbols from /usr/lib/i686/cmov/libssl.so.0.9.7...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/i686/cmov/libssl.so.0.9.7\nReading symbols from /usr/lib/i686/cmov/libcrypto.so.0.9.7...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/i686/cmov/libcrypto.so.0.9.7\nReading symbols from /usr/lib/libaprutil-0.so.0...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/lib/libaprutil-0.so.0\nReading symbols from /usr/lib/libldap_r.so.2...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libldap_r.so.2\nReading symbols from /usr/lib/liblber.so.2...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/liblber.so.2\nReading symbols from /usr/lib/libdb-4.2.so...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libdb-4.2.so\nReading symbols from /usr/lib/libexpat.so.1...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libexpat.so.1\nReading symbols from /usr/lib/libapr-0.so.0...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libapr-0.so.0\nReading symbols from /lib/tls/librt.so.1...\n(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/librt.so.1\nReading symbols from /lib/tls/libm.so.6...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libm.so.6\nReading symbols from /lib/tls/libnsl.so.1...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libnsl.so.1\nReading symbols from /lib/tls/libpthread.so.0...(no debugging symbols found)...done.\n[Thread debugging using libthread_db enabled]\n[New Thread 1079503776 (LWP 5183)]\nLoaded symbols for /lib/tls/libpthread.so.0\nReading symbols from /lib/tls/libc.so.6...\n(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libc.so.6\nReading symbols from /lib/ld-linux.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/ld-linux.so.2\nReading symbols from /lib/tls/libresolv.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libresolv.so.2\nReading symbols from /usr/lib/libsasl2.so.2...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libsasl2.so.2\nReading symbols from /usr/lib/libgnutls.so.11...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libgnutls.so.11\nReading symbols from /usr/lib/libtasn1.so.2...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libtasn1.so.2\nReading symbols from /usr/lib/libgcrypt.so.11...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libgcrypt.so.11\nReading symbols from /usr/lib/libgpg-error.so.0...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/lib/libgpg-error.so.0\nReading symbols from /lib/tls/libnss_files.so.2...\n(no debugging symbols found)...done.\nLoaded symbols for /lib/tls/libnss_files.so.2\nReading symbols from /usr/lib/apache2/modules/mod_mime_magic.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_mime_magic.so\nReading symbols from /usr/lib/apache2/modules/mod_expires.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_expires.so\nReading symbols from /usr/lib/apache2/modules/mod_deflate.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_deflate.so\nReading symbols from /usr/lib/apache2/modules/mod_vhost_alias.so...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_vhost_alias.so\nReading symbols from /usr/lib/apache2/modules/mod_userdir.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_userdir.so\nReading symbols from /usr/lib/apache2/modules/mod_rewrite.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_rewrite.so\nReading symbols from /usr/lib/apache2/modules/mod_ssl.so...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_ssl.so\nReading symbols from /usr/lib/apache2/modules/libphp4.so...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/libphp4.so\nReading symbols from /usr/lib/libzzip-0.so.12...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libzzip-0.so.12\nReading symbols from /usr/lib/libbz2.so.1.0...(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libbz2.so.1.0\nReading symbols from /usr/lib/libgssapi_krb5.so.2...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/lib/libgssapi_krb5.so.2\nReading symbols from /usr/lib/libkrb5.so.3...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/libkrb5.so.3\nReading symbols from /usr/lib/libk5crypto.so.3...(no debugging symbols\nfound)...done.\nLoaded symbols for /usr/lib/libk5crypto.so.3\nReading symbols from /lib/libcom_err.so.2...(no debugging symbols found)...done.\nLoaded symbols for /lib/libcom_err.so.2\nReading symbols from /usr/lib/apache2/modules/mod_unique_id.so...(no debugging\nsymbols found)...done.\nLoaded symbols for /usr/lib/apache2/modules/mod_unique_id.so\nReading symbols from /usr/lib/php4/20020429/ldap.so...\n(no debugging symbols found)...done.\nLoaded symbols for /usr/lib/php4/20020429/ldap.so\nReading symbols from /usr/lib/php4/20020429/apc.so...done.\nLoaded symbols for /usr/lib/php4/20020429/apc.so\nReading symbols from /lib/tls/libnss_compat.so.2...done.\nLoaded symbols for /lib/tls/libnss_compat.so.2\nReading symbols from /lib/tls/libnss_nis.so.2...done.\nLoaded symbols for /lib/tls/libnss_nis.so.2\nReading symbols from /lib/libnss_ldap.so.2...done.\nLoaded symbols for /lib/libnss_ldap.so.2\nReading symbols from /usr/lib/sasl2/libsasldb.so.2...done.\nLoaded symbols for /usr/lib/sasl2/libsasldb.so.2\nReading symbols from /lib/tls/libnss_dns.so.2...done.\nLoaded symbols for /lib/tls/libnss_dns.so.2\n0x40424ca1 in flock () from /lib/tls/libc.so.6\n(gdb) where \n#0  0x40424ca1 in flock () from /lib/tls/libc.so.6\n#1  0x40670f87 in zm_info_session () from /usr/lib/apache2/modules/libphp4.so\n#2  0x406713eb in ps_read_files () from /usr/lib/apache2/modules/libphp4.so\n#3  0x4066d656 in php_session_create_id () from /usr/lib/apache2/modules/libphp4.so\n#4  0x4066ebe0 in php_session_start () from /usr/lib/apache2/modules/libphp4.so\n#5  0x40670660 in zif_session_start () from /usr/lib/apache2/modules/libphp4.so\n#6  0x407331c0 in execute () from /usr/lib/apache2/modules/libphp4.so\n#7  0x40732f25 in execute () from /usr/lib/apache2/modules/libphp4.so\n#8  0x40734614 in execute () from /usr/lib/apache2/modules/libphp4.so\n#9  0x40734614 in execute () from /usr/lib/apache2/modules/libphp4.so\n#10 0x40722db1 in zend_execute_scripts () from /usr/lib/apache2/modules/libphp4.so\n#11 0x406f4ebf in php_execute_script () from /usr/lib/apache2/modules/libphp4.so\n#12 0x4073834f in execute () from /usr/lib/apache2/modules/libphp4.so\n#13 0x08078375 in ap_run_handler ()\n#14 0x08078980 in ap_invoke_handler ()\n#15 0x08069c6a in ap_process_request ()\n#16 0x0806512d in _start ()\n#17 0x0820c5b0 in ?? ()\n#18 0x00000004 in ?? ()\n#19 0x0820c5b0 in ?? ()\n#20 0x0808370c in ap_run_pre_connection ()\n#21 0x080835c5 in ap_run_process_connection ()\n#22 0x08076974 in ap_graceful_stop_signalled ()\n#23 0x08076ac7 in ap_graceful_stop_signalled ()\n#24 0x08076d59 in ap_graceful_stop_signalled ()\n#25 0x08077445 in ap_mpm_run ()\n#26 0x0807da8d in main ()\n(gdb) thread apply all bt full\n\nThread 1 (Thread 1079503776 (LWP 5183)):\n#0  0x40424ca1 in flock () from /lib/tls/libc.so.6\nNo symbol table info available.\n#1  0x40670f87 in zm_info_session () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#2  0x406713eb in ps_read_files () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#3  0x4066d656 in php_session_create_id () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#4  0x4066ebe0 in php_session_start () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#5  0x40670660 in zif_session_start () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#6  0x407331c0 in execute () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#7  0x40732f25 in execute () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#8  0x40734614 in execute () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#9  0x40734614 in execute () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#10 0x40722db1 in zend_execute_scripts () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#11 0x406f4ebf in php_execute_script () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#12 0x4073834f in execute () from /usr/lib/apache2/modules/libphp4.so\nNo symbol table info available.\n#13 0x08078375 in ap_run_handler ()\nNo symbol table info available.\n#14 0x08078980 in ap_invoke_handler ()\nNo symbol table info available.\n#15 0x08069c6a in ap_process_request ()\nNo symbol table info available.\n#16 0x0806512d in _start ()\nNo symbol table info available.\n#17 0x0820c5b0 in ?? ()\nNo symbol table info available.\n#18 0x00000004 in ?? ()\nNo symbol table info available.\n---Type <return> to continue, or q <return> to quit---\n#19 0x0820c5b0 in ?? ()\nNo symbol table info available.\n#20 0x0808370c in ap_run_pre_connection ()\nNo symbol table info available.\n#21 0x080835c5 in ap_run_process_connection ()\nNo symbol table info available.\n#22 0x08076974 in ap_graceful_stop_signalled ()\nNo symbol table info available.\n#23 0x08076ac7 in ap_graceful_stop_signalled ()\nNo symbol table info available.\n#24 0x08076d59 in ap_graceful_stop_signalled ()\nNo symbol table info available.\n#25 0x08077445 in ap_mpm_run ()\nNo symbol table info available.\n#26 0x0807da8d in main ()\nNo symbol table info available.\n#0  0x40424ca1 in flock () from /lib/tls/libc.so.6\n(gdb) quit\nThe program is running.  Quit anyway (and detach it)? (y or n) y\nDetaching from program: /usr/sbin/apache2, process 5183"}, {"count": 9, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "text": "Thanks for the backtrace. First of all the backtrace proves my initial thoughts:\nYou are stuck in PHP land. This might be a bug in PHP, in your PHP configuration\nor in your PHP application. I don't know. So please try to report this to\nbugs.php.net or to squirrelmail to obtain further help.\nFrom a first glance I would guess that the problem is related to PHP's session\nmanagement via files and the needed locks during these operations. It might make\nsense for you to obtain backtraces from *any* child process in this situation to\nget a better impression\n\n1. if all processes are waiting for one specific process\n2. what the process holding the lock is actually doing.\n\nYou might be able to find the process that holds the lock via\nlsof | egrep \"[0-9][a-zA-Z][a-zA-Z] \"", "id": 103514, "time": "2007-05-22T12:17:56Z", "bug_id": 42473, "creation_time": "2007-05-22T12:17:56Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 42473, "attachment_id": null, "text": "Thanks a lot for your effort.\n\nRegards.", "id": 103537, "time": "2007-05-23T02:29:11Z", "creator": "borja.pacheco@juntadeandalucia.es", "creation_time": "2007-05-23T02:29:11Z", "is_private": false}]
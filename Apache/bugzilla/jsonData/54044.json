[{"count": 0, "text": "We are noticing old/stale date/times in out access logs. I copied (and scrubbed) the entries below from an access log from 2012-10-22.\n\n...,2012-10-15 18:00:56.705-0500,\"GET ...\n...,2012-10-22 10:29:01.801-0500,\"GET ...\n...,2012-10-22 10:29:01.802-0500,\"GET ...\n...,2012-10-22 10:29:01.803-0500,\"GET ...\n...,2012-10-22 10:29:01.804-0500,\"GET ...\n...,2012-10-15 18:00:56.804-0500,\"GET ...\n...,2012-10-15 18:00:56.857-0500,\"GET ...\n\nWe use using the SimpleDateFormat functionality and the beginTime prefix.  Our \"pattern\" is:\n\n%{X-Tomcat-Session}i,%S,%{X-Forwarded-For}i,%h,%u,%{begin:yyyy-MM-dd HH:mm:ss.SSSZ}t,&quot;%r&quot;,%s,%b,%p,%{Referer}i,&quot;%{User-Agent}i&quot;,%T\"\n\nIn the example above, jvm/tomcat instance was started on 2012-10-15 at 18:00:41 (a few seconds before the stuck time in the access log) so the  2012-10-15 18:00:56 times are likely related to some caching issues/problems.  We also occasionally see other log entries with incorrect (but not startup) dates/times.  For, example, we sometimes see yesterday's date in the access log.\n\nAlso, note that the millisecond times do appear to be correct in that they increase in a reasonable way and are unrelated to the date and second-truncated time.", "bug_id": 54044, "is_private": false, "id": 162901, "time": "2012-10-23T15:38:56Z", "creator": "clucas@e-miles.com", "creation_time": "2012-10-23T15:38:56Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 54044, "is_private": false, "text": "Note that begin times can be old if your request take a long time to finish.\n\nCan you please add %D to your pattern, which will output the request duration in milliseconds. This is to check, whether the old time stamps belong to requests that took very long in processing.\n\nI suggest:\n\n%{X-Tomcat-Session}i,%S,%{X-Forwarded-For}i,%h,%u,%{begin:yyyy-MM-dd HH:mm:ss.SSSZ}t,&quot;%r&quot;,%s,%b,%p,%{Referer}i,&quot;%{User-Agent}i&quot;,%T,%{begin},%{end},%{end:yyyy-MM-dd HH:mm:ss.SSSZ}t,%D\"\n\nduring this debugging so you can check the consistency of begin time, end time and duration as well as consistency with the CLF formatted begin and end time stamps which are formatted by a slightly different format cache.", "id": 162905, "time": "2012-10-23T21:24:44Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-10-23T21:24:44Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 54044, "attachment_id": null, "is_private": false, "id": 162906, "time": "2012-10-23T21:46:58Z", "creator": "clucas@e-miles.com", "creation_time": "2012-10-23T21:46:58Z", "text": "I restarted earlier today with an updated pattern trying to get some more useful information.  The format was not the one you recommended (since it was before your request) but I added:\n\n%I - thread - in case the problem is thread related\n%t\n%{sec}t\n\nFor a final pattern of:\n\n%{X-Tomcat-Session}i,%S,%{X-Forwarded-For}i,%h,%u,%I,%t,%{sec}t,%{begin:yyyy-MM-dd HH:mm:ss.SSSZ}t,&quot;%r&quot;,%s,%b,%p,%{Referer}i,&quot;%{User-Agent}i&quot;,%T\n\nThe actual time of capture was 23/Oct/2012:14:49:59. I left on the %T data which is small.  These were not long duration requests.  Note the 11:18:18 entries. 11:18:18 is a few seconds after the jvm was started. I thought this might be relavent because of the child/parent caching logic in AccessLogValve.\n\n ... ,tomcat-exec-20,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 14:49:59.341-0500,\"GET ... ,0.000\n ... ,tomcat-exec-5,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 14:49:59.337-0500,\"GET ... ,0.005\n ... ,tomcat-exec-18,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 14:49:58.833-0500,\"GET ... ,0.590\n ... ,tomcat-exec-20,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 14:49:59.424-0500,\"GET ... ,0.002\n ... ,tomcat-exec-5,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 14:49:59.424-0500,\"GET ... ,0.009\n ... ,tomcat-exec-18,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.433-0500,\"GET ... ,0.001\n ... ,tomcat-exec-20,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 14:49:59.431-0500,\"GET ... ,0.008\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.444-0500,\"GET ... ,0.007\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.545-0500,\"GET ... ,0.007\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.555-0500,\"GET ... ,0.009\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.645-0500,\"GET ... ,0.004\n ... ,tomcat-exec-18,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.645-0500,\"GET ... ,0.006\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.654-0500,\"GET ... ,0.001\n ... ,tomcat-exec-18,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.653-0500,\"GET ... ,0.012\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.665-0500,\"GET ... ,0.012\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.765-0500,\"GET ... ,0.006\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.855-0500,\"GET ... ,0.006\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.865-0500,\"GET ... ,0.008\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.885-0500,\"GET ... ,0.012\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.901-0500,\"GET ... ,0.007\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.911-0500,\"GET ... ,0.010\n ... ,tomcat-exec-25,[23/Oct/2012:14:49:59 -0500],1351021799,2012-10-23 11:18:18.925-0500,\"GET ... ,0.010\n ... ,tomcat-exec-25,[23/Oct/2012:14:50:00 -0500],1351021800,2012-10-23 11:18:18.976-0500,\"GET ... ,0.082\n ... ,tomcat-exec-5,[23/Oct/2012:14:50:00 -0500],1351021800,2012-10-23 14:50:00.075-0500,\"GET ... ,0.010\n ... ,tomcat-exec-5,[23/Oct/2012:14:50:00 -0500],1351021800,2012-10-23 14:50:00.146-0500,\"GET ... ,0.011\n ... ,tomcat-exec-5,[23/Oct/2012:14:50:00 -0500],1351021800,2012-10-23 14:50:00.161-0500,\"GET ... ,0.012\n\nI can update the pattern to be the one you requested but it may take some time to see the issue crop up again. In the mean time the above data may be useful."}, {"count": 3, "text": "I changed log format to the one requested (had to add a 't' to the after {begin} and {end}:\n\n%{X-Tomcat-Session}i,%S,%{X-Forwarded-For}i,%h,%u,%{begin:yyyy-MM-dd HH:mm:ss.SSSZ}t,&quot;%r&quot;,%s,%b,%p,%{Referer}i,&quot;%{User-Agent}i&quot;,%T,%{begin}t,%{end}t,%{end:yyyy-MM-dd HH:mm:ss.SSSZ}t,%D\n\nThe stuck/incorrect times in the data below are 10:00:04 and 10:05:40.  The actual timespan was between 11:01:59 and 11:02:01. You can see that these are not long duration requests (all less than a second.)\n\n\n... ,2012-10-24 11:01:59.288-0500,\"GET ... ,0.080,[24/Oct/2012:11:01:59 -0500],[24/Oct/2012:11:01:59 -0500],2012-10-24 11:01:59.368-0500,80\n... ,2012-10-24 11:01:59.568-0500,\"GET ... ,0.006,[24/Oct/2012:11:01:59 -0500],[24/Oct/2012:11:01:59 -0500],2012-10-24 11:01:59.574-0500,6\n... ,2012-10-24 11:01:59.755-0500,\"POST ... ,0.246,[24/Oct/2012:11:01:59 -0500],[24/Oct/2012:11:02:00 -0500],2012-10-24 11:02:00.001-0500,246\n... ,2012-10-24 10:05:40.932-0500,\"GET ... ,0.088,[24/Oct/2012:10:05:40 -0500],[24/Oct/2012:10:00:04 -0500],2012-10-24 10:00:04.020-0500,88\n... ,2012-10-24 10:00:04.020-0500,\"GET ... ,0.002,[24/Oct/2012:10:00:04 -0500],[24/Oct/2012:10:00:04 -0500],2012-10-24 10:00:04.022-0500,2\n... ,2012-10-24 11:01:59.753-0500,\"GET ... ,0.313,[24/Oct/2012:11:01:59 -0500],[24/Oct/2012:10:00:04 -0500],2012-10-24 10:00:04.066-0500,313\n... ,2012-10-24 10:00:04.072-0500,\"GET ... ,0.001,[24/Oct/2012:10:00:04 -0500],[24/Oct/2012:10:00:04 -0500],2012-10-24 10:00:04.073-0500,1\n... ,2012-10-24 10:05:40.813-0500,\"POST ... ,0.427,[24/Oct/2012:10:05:40 -0500],[24/Oct/2012:10:00:04 -0500],2012-10-24 10:00:04.240-0500,427\n... ,2012-10-24 10:00:04.227-0500,\"GET ... ,0.079,[24/Oct/2012:10:00:04 -0500],[24/Oct/2012:10:00:04 -0500],2012-10-24 10:00:04.306-0500,79\n... ,2012-10-24 11:02:00.370-0500,\"GET ... ,0.013,[24/Oct/2012:11:02:00 -0500],[24/Oct/2012:11:02:00 -0500],2012-10-24 11:02:00.383-0500,13\n... ,2012-10-24 11:02:00.398-0500,\"GET ... ,0.001,[24/Oct/2012:11:02:00 -0500],[24/Oct/2012:11:02:00 -0500],2012-10-24 11:02:00.399-0500,1\n... ,2012-10-24 11:02:00.684-0500,\"GET ... ,0.011,[24/Oct/2012:11:02:00 -0500],[24/Oct/2012:11:02:00 -0500],2012-10-24 11:02:00.695-0500,11\n... ,2012-10-24 10:00:04.379-0500,\"GET ... ,0.369,[24/Oct/2012:10:00:04 -0500],[24/Oct/2012:10:00:04 -0500],2012-10-24 10:00:04.748-0500,369\n... ,2012-10-24 10:00:04.363-0500,\"GET ... ,0.387,[24/Oct/2012:10:00:04 -0500],[24/Oct/2012:10:00:04 -0500],2012-10-24 10:00:04.750-0500,387\n... ,2012-10-24 10:00:04.922-0500,\"GET ... ,0.003,[24/Oct/2012:10:00:04 -0500],[24/Oct/2012:10:00:04 -0500],2012-10-24 10:00:04.925-0500,3\n... ,2012-10-24 10:00:04.972-0500,\"GET ... ,0.001,[24/Oct/2012:10:00:04 -0500],[24/Oct/2012:10:00:04 -0500],2012-10-24 10:00:04.973-0500,1\n... ,2012-10-24 11:02:01.089-0500,\"GET ... ,0.001,[24/Oct/2012:11:02:01 -0500],[24/Oct/2012:11:02:01 -0500],2012-10-24 11:02:01.090-0500,1\n... ,2012-10-24 11:02:01.088-0500,\"GET ... ,0.008,[24/Oct/2012:11:02:01 -0500],[24/Oct/2012:11:02:01 -0500],2012-10-24 11:02:01.096-0500,8", "bug_id": 54044, "is_private": false, "id": 162917, "time": "2012-10-24T19:09:58Z", "creator": "clucas@e-miles.com", "creation_time": "2012-10-24T19:09:58Z", "tags": [], "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 54044, "text": "Thanks for the detailed report. A code review suggests that AccessLogValve.DateFormatCache has some issues (e.g. offset is never set).\n\nI have started work on a unit test and that appears to have uncovered more issues but I need to check my unit test is correct. I am currently double-checking the unit test and will commit and along with any necessary fixes once that process is complete.", "id": 162965, "time": "2012-10-26T14:58:21Z", "creator": "markt@apache.org", "creation_time": "2012-10-26T14:58:21Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "text": "Found a couple of bugs that have been fixed in trunk and 7.0.x. The fix will be in 7.0.33 onwards.", "attachment_id": null, "bug_id": 54044, "id": 162969, "time": "2012-10-26T18:17:23Z", "creator": "markt@apache.org", "creation_time": "2012-10-26T18:17:23Z", "is_private": false}, {"count": 6, "text": "Re: r1402604\n\nThere is a copy of DateFormatCache class in JULI:\norg.apache.juli.DateFormatCache\n\nFrom a quick look at it, it also needs the same fix. I have not run the test against it though.\n\n(The original plan was to keep just one copy of this class,\nas was shortly discussed on dev@ on 2011-06-23,\nhttp://tomcat.markmail.org/thread/iucbedl7pnszytc6\n)", "bug_id": 54044, "is_private": false, "id": 162971, "time": "2012-10-26T18:33:02Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-10-26T18:33:02Z", "tags": [], "attachment_id": null}, {"count": 7, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Fixed. I haven't removed the copy since they are not identical.", "id": 162972, "time": "2012-10-26T19:28:51Z", "bug_id": 54044, "creation_time": "2012-10-26T19:28:51Z", "is_private": false}, {"count": 8, "text": "This issue affects the cache used by org.apache.juli.OneLineFormatter in Tomcat 6.\n\nThe AccessLogValve is not affected (it does not have such cache there).\nOther JULI components are not affected.\n\nI proposed the patch (r1408459) for Tomcat 6.", "bug_id": 54044, "is_private": false, "id": 163399, "time": "2012-11-12T21:15:27Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-11-12T21:15:27Z", "tags": [], "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 54044, "attachment_id": null, "is_private": false, "id": 166883, "time": "2013-04-27T13:29:45Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2013-04-27T13:29:45Z", "text": "Fixed in Tomcat 6 by r1476547 , will be in 6.0.37."}]
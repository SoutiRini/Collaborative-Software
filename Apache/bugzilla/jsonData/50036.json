[{"count": 0, "tags": [], "text": "Created attachment 26110\nProposed patch.\n\nI would like to suggest an extension to the xmlsec java API, namely to add a static method like unregisterDocument to org.apache.xml.security.utils.IdResolver to remove adocument from the static \"docMap\" WeakHashMap. Under long running high load test after some time we are experiencing a hangup with all the worker threads in the following state:\n\n\"HTTP Handler 10.20.32.55\" Id=185 in RUNNABLE\n at java.util.WeakHashMap.get(WeakHashMap.java:355)\n at org.apache.xml.security.utils.IdResolver.registerElementById(Unknown Source)\n at org.apache.xml.security.signature.XMLSignature.setId(Unknown Source)\n at org.apache.ws.security.message.WSSecSignature.prepare(WSSecSignature.java:360)\n at org.apache.rampart.builder.BindingBuilder.getSignatureBuider(BindingBuilder.java:387)\n at org.apache.rampart.builder.AsymmetricBindingBuilder.doSignature(AsymmetricBindingBuilder.java:716)\n at org.apache.rampart.builder.AsymmetricBindingBuilder.doSignBeforeEncrypt(AsymmetricBindingBuilder.java:433)\n at org.apache.rampart.builder.AsymmetricBindingBuilder.build(AsymmetricBindingBuilder.java:95)\n at org.apache.rampart.MessageBuilder.build(MessageBuilder.java:147)\n at org.apache.rampart.handler.RampartSender.invoke(RampartSender.java:79)\n at org.apache.axis2.engine.Phase.invoke(Phase.java:325)\n at org.apache.axis2.engine.AxisEngine.invoke(AxisEngine.java:264)\n at org.apache.axis2.engine.AxisEngine.send(AxisEngine.java:429)\n\nWith manual cleanup of the weak has map this situation is avoided.", "attachment_id": 26110, "id": 140359, "creator": "cheffo@gmail.com", "time": "2010-10-01T08:18:48Z", "bug_id": 50036, "creation_time": "2010-10-01T08:18:48Z", "is_private": false}, {"count": 1, "tags": [], "text": "Sorry for the delay :(", "attachment_id": null, "id": 140360, "creator": "cheffo@gmail.com", "time": "2010-10-01T08:19:56Z", "bug_id": 50036, "creation_time": "2010-10-01T08:19:56Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 50036, "attachment_id": null, "id": 140385, "time": "2010-10-02T09:18:55Z", "creator": "coheigea@apache.org", "creation_time": "2010-10-02T09:18:55Z", "is_private": false, "text": "\nPatch applied thanks (minus the annotations - the project is compatible with JDK 1.4):\n\nAuthor: coheigea\nDate: Sat Oct  2 13:17:40 2010\nNew Revision: 1003793\n\nURL: http://svn.apache.org/viewvc?rev=1003793&view=rev\nLog:\n[Bug 50036] IdResolver Java API extension.\n - Patch applied. Also merged a fix to get a test working with JDK 1.4.\n\nModified:\n   santuario/trunk/CHANGELOG.txt\n   santuario/trunk/src/org/apache/xml/security/utils/IdResolver.java\n   santuario/trunk/src_unitTests/org/apache/xml/security/test/keys/keyresolver/KeyResolverTest.java\n\nColm."}]
[{"count": 0, "text": "", "bug_id": 52188, "is_private": false, "id": 151522, "time": "2011-11-15T18:23:58Z", "creator": "award@ptc.com", "creation_time": "2011-11-15T18:23:58Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "creator": "award@ptc.com", "attachment_id": null, "id": 151523, "time": "2011-11-15T18:34:55Z", "bug_id": 52188, "creation_time": "2011-11-15T18:34:55Z", "is_private": false, "text": "We have a build target which runs several concurrent builds inside of a parallel block.  This target would intermittently through several NPE's and fail.  Long story short, I chased the NPE's back to the DirectoryScanner class.  In looking at the class it was clear that there several methods which modified the same member, and had no locking in place to prevent concurrent modification of that member.  \n\nSince applying the attached patch, we have not seen this error (several hundred builds later). Whereas without the patch, we see the failure in at least 1 out of every 10 builds."}, {"attachment_id": 27939, "tags": [], "bug_id": 52188, "text": "Created attachment 27939\npatch for DirectoryScanner.java", "count": 2, "id": 151524, "time": "2011-11-15T18:35:44Z", "creator": "award@ptc.com", "creation_time": "2011-11-15T18:35:44Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 52188, "is_private": false, "id": 151587, "attachment_id": null, "creator": "bodewig@apache.org", "creation_time": "2011-11-17T11:17:18Z", "time": "2011-11-17T11:17:18Z", "text": "Your patch synchronizes access to the default excludes - which may be a good thing to do in any case - which implies the tasks you are running in parallel are modifying the default excludes.  How can you ensure consistent results?\n\nAbout your patch, I probably wouldn't make defaultExcludes volatile but rather final (and rewrite the reset method to clear the set rather than create a new one) - in particular since you are synchronizing on it.\n\nDid you really have to make isExcluded and isSelected synchronized?  These instance methods shouldn't be used by multiple threads in your parallel scenario at all."}, {"count": 4, "tags": [], "bug_id": 52188, "is_private": false, "id": 151921, "attachment_id": null, "creator": "bodewig@apache.org", "creation_time": "2011-12-02T16:23:27Z", "time": "2011-12-02T16:23:27Z", "text": "While putting together an alternative patch I discovered a bug in\naddDefaultExcludes.  The array length may be wrong if default exlcudes\nare modified while this method executes.\n\nI'll attach my version of the fix here once Ant's test suite is through."}, {"count": 5, "tags": [], "bug_id": 52188, "is_private": false, "text": "Created attachment 28018\nAlternative fix for thread-safety issue of default excludes\n\n@Adam: it would be great if you could apply my proposed alterantive and see whether any multithreading problems occur.", "id": 151923, "time": "2011-12-02T16:45:46Z", "creator": "bodewig@apache.org", "creation_time": "2011-12-02T16:45:46Z", "attachment_id": 28018}, {"count": 6, "tags": [], "bug_id": 52188, "text": "> @Adam:\n\nThat should have been Alex, sorry.\n\nStefan", "id": 151924, "attachment_id": null, "creator": "bodewig@apache.org", "creation_time": "2011-12-02T16:46:56Z", "time": "2011-12-02T16:46:56Z", "is_private": false}, {"count": 7, "tags": [], "text": "Hi Stephan,\n\nSorry for the slow response; been very busy.  I will give your patch a shot as soon as I get some time to do it.  Hopefully sometime in the next couple of weeks. \n\nThanks for the help!", "attachment_id": null, "id": 152073, "creator": "award@ptc.com", "time": "2011-12-08T18:51:47Z", "bug_id": 52188, "creation_time": "2011-12-08T18:51:47Z", "is_private": false}, {"count": 8, "attachment_id": null, "creator": "award@ptc.com", "text": "... sorry, I meant to say @Stefan.  I guess it's contagious :-D", "id": 152081, "time": "2011-12-08T21:13:14Z", "bug_id": 52188, "creation_time": "2011-12-08T21:13:14Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "bug_id": 52188, "text": "Applied my version of the patch with svn revision 1234276\n\nPlease reopen this bug if the problem persists.", "id": 152991, "time": "2012-01-21T07:07:15Z", "creator": "bodewig@apache.org", "creation_time": "2012-01-21T07:07:15Z", "is_private": false, "attachment_id": null}]
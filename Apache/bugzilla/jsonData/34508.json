[{"count": 0, "tags": [], "bug_id": 34508, "attachment_id": null, "id": 73781, "time": "2005-04-19T00:12:39Z", "creator": "apache.bugzilla@abcdatos.com", "creation_time": "2005-04-19T00:12:39Z", "is_private": false, "text": "This is observed in 2.0.53 and 2.0.54 versions, prefork operated. The server use\nis medium (typically 100 to 200 simultaneous connections), no PHP, no mod_perl,\nonly cgi.\n\nEvery hour, I move (mv) the log to a new filename, send a graceful restart to\nensure using a new one, and wait 60 seconds (other values tested without\nchanges) to copy it to another host to process it (scp). Some minutes later, the\nold log is deleted.\n\nI see the server stops to accept new connections just after the graceful restart\nis requested, bandwidth measurements shows a clear down graphic, and time\nrequired to accept new ones vary from a few seconds (97% cases) to a few\nminutes, keeping the site unnecessarilly down. I expect graceful restart don't\ncauses to stop accepting new connections, as I understand this is the normal\nSIGUSR1 action required.\n\n A test adding a sleep of five seconds after moving log and before requesting\nthe graceful restart causes no effect.\n\nThese are the compiling options used:\n\nCC=\"gcc\" CFLAGS=\"-O2 -fomit-frame-pointer -fno-strict-aliasing -fno-common -pipe\n-mpreferred-stack-boundary=2 -march=i686\" ./configure\n--prefix=/usr/local/apache/apache_1 --enable-modules=\"deflate headers info cgi\nspeling rewrite\" --disable-so --disable-suexec --disable-cgid --disable-expires\n--disable-logio --disable-imap --disable-negotiation --disable-autoindex\n--disable-include --disable-userdir\n\nThere are two more Apache2 servers on the same host (using different IP/port\ncombinations, of course, and different PID files), one used for SSL connections\nand another one to serve PHP and mod_perl scripts, these others have no log\nprocessing, and no graceful restarts are requested for them.\n\nMay be interesting to show this configuration parts:\n\n<IfModule prefork.c>\nStartServers        64\nMinSpareServers     32\nMaxSpareServers     64\nMaxClients         250\nMaxRequestsPerChild  0\n</IfModule>\nTimeout 60\nKeepAlive On\nMaxKeepAliveRequests 100\nKeepAliveTimeout 10\n\nThere is almost no swap, I don't see LoadAverage or CPU% too high (<1.00, <30%),\nbut is difficult to catch it just at the exact 'failing time'. There is no local\ndatabases, SMTP servers or other functionalities wich suspected to cause load\nfor this host (P4 2,8 Ghz, 1GB RAM), is maintained only to host three Apache2\nservers.\n\nAlso note that if I use a restart instead of a graceful restart, the results are\njust the same: too much time to kill the server -not allways, only about 3%-,\nfrom 30 seconds to 8 minutes, and then the new connections accepted when all\nfinished and restarted.\n\nToo much time to shutdown childs and not accepting new connections when issuing\na graceful restart is the problem I see.\n\nThank to all the readers."}, {"count": 1, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "What's written to the error log?  How are you initiating the restart, using\n\"apachectl graceful\"?", "id": 79608, "time": "2005-09-08T03:38:08Z", "bug_id": 34508, "creation_time": "2005-09-08T03:38:08Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 34508, "attachment_id": null, "is_private": false, "id": 79629, "time": "2005-09-08T11:09:53Z", "creator": "apache.bugzilla@abcdatos.com", "creation_time": "2005-09-08T11:09:53Z", "text": "Now I'm using rotatelogs to bypass the problem, and fortunatelly it takes less \nload to the server than I expect.\n\nThe command used for graceful restart was 'apachectl graceful'.\n\nThe server logs don't show any abnormal messages, I only see the normal \nrestart messages (I can't see it directly now, sorry) at the real restart \ntime, wich is some times a few minutes after the graceful command is issued. \nPrior to the restart messages, there aren't any suspicious message logged, \nonly a unavailability to connect to it.\n"}, {"count": 3, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "This lacks enough information to reproduce; we'd need, for example, the output\nof running strace against the parent process to diagnose further.", "id": 80461, "time": "2005-09-25T23:19:26Z", "bug_id": 34508, "creation_time": "2005-09-25T23:19:26Z", "is_private": false}, {"count": 4, "tags": [], "creator": "arekm@maven.pl", "text": "Looks like #54852", "id": 166923, "attachment_id": null, "bug_id": 34508, "creation_time": "2013-04-29T06:57:47Z", "time": "2013-04-29T06:57:47Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 34508, "attachment_id": null, "id": 171933, "time": "2013-12-26T10:34:47Z", "creator": "jerald.johnson@cpanel.net", "creation_time": "2013-12-26T10:34:47Z", "is_private": false, "text": "I will work on getting you an strace, along with other information."}, {"count": 6, "tags": [], "creator": "jerald.johnson@cpanel.net", "attachment_id": 31158, "text": "Created attachment 31158\nDebug Files", "id": 171937, "time": "2013-12-26T11:11:37Z", "bug_id": 34508, "creation_time": "2013-12-26T11:11:37Z", "is_private": false}, {"count": 7, "tags": [], "creator": "jerald.johnson@cpanel.net", "is_private": false, "text": "Created attachment 31159\nDebug Files\n\nHere is a strace of the graceful issue, a count of defunct proccesses, a full `ps auxf', httpd -l, httpd -L, httpd -V, and httpd -v", "id": 171938, "time": "2013-12-26T11:12:05Z", "bug_id": 34508, "creation_time": "2013-12-26T11:12:05Z", "attachment_id": 31159}]
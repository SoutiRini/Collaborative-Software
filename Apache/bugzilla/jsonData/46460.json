[{"count": 0, "tags": [], "bug_id": 46460, "attachment_id": null, "id": 123673, "time": "2009-01-01T00:00:06Z", "creator": "lovelylovelyflora@ab.auone-net.jp", "creation_time": "2009-01-01T00:00:06Z", "is_private": false, "text": "Problem:\n\nYou get:  \n   [Fatal Error] msmincho.xml:1:171: Character reference \"&#0\" is an invalid XML character\n\nif you make font metrics files from msmincho.ttc and msgothic.ttc of Windows and use them.\n\nTo reproduce it, set up the attached file: fopdoc.zip as c:\\fopdoc, fop.xconf.xml(one of the zip)  as ${fop.home}/conf/fop.xconf.xml, and run ant as follows:\n\nc:\\fopdoc>ant\n\n\nFor your convenience, I included ant's error message as err.txt in the attached file: fopdoc.zip.\n\nSolution:\n\nI found something in \"public final String readTTFString(int len)\" of  org.apache.fop.fonts.truetype.FontFileReader.\n\nWhen I replaced the character encoding discerning heuristic:\n \n        final String encoding;\n        if ((tmp.length > 0) && (tmp[0] == 0)) {\n            encoding = \"UTF-16BE\";\n        } else {\n            encoding = \"ISO-8859-1\";\n        }\n\nwith the following:\n\n        String encoding = \"ISO-8859-1\";\n        for(int c: tmp) {\n            c &= 0xff;\n            if(c==0 || c >= 0x80) {\n                encoding = \"UTF-16BE\";\n                break;\n            }\n        }\n\neverything went fine."}, {"count": 1, "tags": [], "creator": "lovelylovelyflora@ab.auone-net.jp", "attachment_id": 23073, "text": "Created attachment 23073\nReproducing environment and error message", "id": 123719, "time": "2009-01-03T00:12:55Z", "bug_id": 46460, "creation_time": "2009-01-03T00:12:55Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 46460, "attachment_id": null, "id": 157380, "time": "2012-04-07T01:42:11Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:42:11Z", "is_private": false, "text": "resetting P2 open bugs to P3 pending further review"}, {"count": 3, "tags": [], "bug_id": 46460, "attachment_id": null, "id": 161680, "time": "2012-08-24T17:17:33Z", "creator": "ldd@lddubeau.com", "creation_time": "2012-08-24T17:17:33Z", "is_private": false, "text": "I've encountered the same problem with fop 0.95 but with the Chinese arphic fonts on Ubuntu.\n\nIf I take the submitter's example files, adapt them for Ubuntu and run them on Ubuntu with 0.95, I get the same error. (Note here that the \"adaptation\" does not change the font files used. I just had the build.xml file point to the Windows files on my Windows partition.)\n\nHowever, if I upgrade to 1.0 and run the same test, then I do not get the error reported by the submitter.\n\nI also do not get the error I experienced with the Chinese arphic fonts on Ubuntu. So it seems this error has been fixed in 1.0."}]
[{"count": 0, "tags": [], "bug_id": 6510, "attachment_id": null, "text": "If you specify multiple PatternSets within a FileSet, the patterns are mingled \ntogether rather than kept isolated. This results in all exclusions being \napplied to the results of all inclusions, which is incorrect behaviour.\n\nHere is a test case that recreates the problem. It is a build.xml file. When \nyou run it, it will create an \"a\" and \"b\" directory, create a set of files \nin \"a\", and attempt to copy them to \"b\". You can see that the only files that \nget copied are \"always.java\" and \"always.class\", despite what the patternsets \ndefine.\n\nThe solution appears to be to fix DirectoryScanner.java to accept a list of \nPatternSets rather than a list of include and exclude strings (or rather, for \nbackward compatibility, to accept PatternSets as an alternative). FileSet.java \nshould then pass the patterns into the scanner in setupDirectoryScanner().\n\nIf people agree that this is the way to go, let me know and I will write up a \npatch for it.\n\nI'm including the build.xml file both inline here and as an attachment, for \nease of access.\n\n* build.xml\n\n<project name=\"test-overlapping-patterns\" default=\"test\" basedir=\"./\" >\n\n  <target name=\"test\" depends=\"create-test-env\" description=\"Shows overlapping \npattern problem\" >\n    <copy todir=\"b\">\n      <fileset dir=\"a\">\n        <patternset>\n          <include name=\"*.java\" />\n          <exclude name=\"test*\" />\n        </patternset>\n        <patternset>\n          <include name=\"*.class\" />\n          <exclude name=\"old*\" />\n        </patternset>\n      </fileset>\n    </copy>\n  </target>\n\n  <target name=\"create-test-env\">\n    <delete dir=\"a\" />\n    <delete dir=\"b\" />\n    <mkdir dir=\"a\" />\n    <mkdir dir=\"b\" />\n    <touch file=\"a/testthis.java\" />\n    <touch file=\"a/testthis.class\" />\n    <touch file=\"a/testthat.java\" />\n    <touch file=\"a/testthat.class\" />\n    <touch file=\"a/oldthis.java\" />\n    <touch file=\"a/oldthis.class\" />\n    <touch file=\"a/oldthat.java\" />\n    <touch file=\"a/oldthat.class\" />\n    <touch file=\"a/always.java\" />\n    <touch file=\"a/always.class\" />\n  </target>\n\n</project>", "id": 10831, "time": "2002-02-17T21:52:03Z", "creator": "bruce@callenish.com", "creation_time": "2002-02-17T21:52:03Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 6510, "attachment_id": 1195, "id": 10832, "time": "2002-02-17T21:55:12Z", "creator": "bruce@callenish.com", "creation_time": "2002-02-17T21:55:12Z", "is_private": false, "text": "Created attachment 1195\nTest case that shows incorrect behaviour for overlapping patterns"}, {"count": 2, "tags": [], "bug_id": 6510, "attachment_id": null, "text": "This is actually the designed behavior.  A fileset only keeps one set of \nincludes and one set of excludes and does not isolate them into individually \nspecified <patternset> groups as you have mentioned.\n\nExcludes *always* win over includes, and so the behavior you have demonstrated \nis proper.", "id": 10833, "time": "2002-02-17T22:10:43Z", "creator": "jakarta@ehatchersolutions.com", "creation_time": "2002-02-17T22:10:43Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 6510, "attachment_id": null, "text": "The workaround is to provide multiple filesets in the copy command, each with \ntheir own patternset rather than a single fileset with multiple patternsets.", "id": 10834, "time": "2002-02-17T22:40:18Z", "creator": "conor@apache.org", "creation_time": "2002-02-17T22:40:18Z", "is_private": false}, {"count": 4, "tags": [], "text": "Whether there is a workaround is somewhat beside the point, since the issue to \nme is whether the current behaviour is correct.\n\nI've created a new thread (\"Multiple patternsets in a fileset\") on the \ndevelopers list to discuss this point. Once it is resolved, then depending on \nthe outcome I may reopen this bug.\n\nhttp://marc.theaimsgroup.com/?l=ant-dev&m=101398750304855&w=2\n", "is_private": false, "bug_id": 6510, "id": 10835, "time": "2002-02-17T23:17:35Z", "creator": "bruce@callenish.com", "creation_time": "2002-02-17T23:17:35Z", "attachment_id": null}]
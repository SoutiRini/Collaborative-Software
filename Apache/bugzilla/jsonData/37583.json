[{"count": 0, "tags": [], "bug_id": 37583, "attachment_id": null, "id": 82716, "time": "2005-11-21T23:58:44Z", "creator": "rob@roblisa.com", "creation_time": "2005-11-21T23:58:44Z", "is_private": false, "text": "The successors SQL query in StandardRDBMSAdapter.java appears to be wrong.  If\nyou perform a load of a store using this class than contains a branch , then try\nto make a new branch (ie. you have 1.0, 1.0.1.0, and 1.1 and you try to make\n1.0.2.0), you will get an Internal Server Error (500) as it will try to create\n1.0.1.0 again.\n\nThe issue is in the retrieveRevisionDescriptors() method, line 955\nThe query is \n\n\"select distinct pvh.REVISION_NO from VERSION_HISTORY vh, VERSION_HISTORY pvh,\nVERSION_PREDS vp, URI u where pvh.VERSION_ID = vp.VERSION_ID and vp.VERSION_ID =\nvh.VERSION_ID and vh.URI_ID = u.URI_ID and u.URI_STRING = ? and vh.REVISION_NO = ?\"\n\nbut this will only return the revision_no passed in.  It seems like it should be \n\n\"select distinct pvh.REVISION_NO from VERSION_HISTORY vh, VERSION_HISTORY pvh,\nVERSION_PREDS vp, URI u where pvh.VERSION_ID = vp.PREDECESSOR_ID and\nvp.VERSION_ID = vh.VERSION_ID and vh.URI_ID = u.URI_ID and u.URI_STRING = ? and\nvh.REVISION_NO = ?\"\n\n(ie vp.VERSION_ID becomes vp.PREDECESSOR_ID) and this seems to fix the issue.\n\nSteps to reproduce:\ncheckout file.txt\ncheckin file.txt\nupdate file.txt /store/history/1/1.0\ncheckout file.txt\ncheckin file.txt\n\n<restart slide>\n\nupdate file.txt /store/history/1/1.0\ncheckout file.txt\ncheckin file.txt\n<500 internal server error>"}]
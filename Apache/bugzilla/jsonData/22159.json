[{"count": 0, "tags": [], "creator": "rs_joshi@hotmail.com", "text": "When trying to run the following JSP with Tomcat I am getting the logical \nhandle error.\nThis error is not generated when I run the same code as a Java application.\nAlso I am able to run this jsp successfully with iPlanet servers.\nPlease change the oracle server, username,password in the jsp code below to \nvalues appropriate to your installations.\n\n\n<%@page language=\"java\" session=\"false\" %>\n<%@ page import=\"java.sql.CallableStatement\"%>\n<%@ page import=\"java.sql.Connection\"%>\n<%@ page import=\"java.sql.ResultSet\"%>\n<%@ page import=\"java.sql.ResultSetMetaData\"%>\n<%@ page import=\"java.sql.SQLException\"%>\n<%@ page import=\"java.sql.Statement\"%>\n<%@ page import=\"java.sql.Types\"%>\n<%@ page import=\"java.sql.Date\"%>\n\n<%@ page import=\"oracle.jdbc.pool.OracleConnectionCache\"%>\n<%@ page import=\"oracle.jdbc.pool.OracleConnectionCacheImpl\"%>\n<%@ page import=\"oracle.jdbc.pool.OracleConnectionPoolDataSource\"%>\n<%@ page import=\"oracle.sql.STRUCT\"%>\n<%@ page import=\"oracle.sql.StructDescriptor\"%>\n<%@ page import=\"oracle.sql.ARRAY\"%>\n<%@ page import=\"oracle.sql.ArrayDescriptor\"%>\n<%@ page import=\"java.util.StringTokenizer\"%>\n\n<html>\n<head><title>Connection test</title>\n</head>\n<body>\n<h1>Connection test</h1>\n\n<%!\n private static OracleConnectionCache connCache = null;\n\n private static Connection getConnFromCache (String url, String user, String \npasswd)\n  \tthrows SQLException\n {\n   Connection conn;\n   OracleConnectionPoolDataSource ocpds = null;\n   OracleConnectionCacheImpl conn_cache = null;\n\n   if (connCache == null)\n    {\n\t ocpds = new OracleConnectionPoolDataSource ();\n\n\t ocpds.setURL (url);\n\t ocpds.setUser (user);\n\t ocpds.setPassword (passwd);\n\n\t conn_cache = new OracleConnectionCacheImpl ();\n\t conn_cache.setConnectionPoolDataSource (ocpds);\n\t conn_cache.setURL (url);\n\t conn_cache.setUser (user);\n\t conn_cache.setPassword (passwd);\n\n\t conn_cache.setCacheScheme (OracleConnectionCacheImpl.DYNAMIC_SCHEME);\n\t conn_cache.setMaxLimit (10);\n\t conn_cache.setMinLimit (1);\n\n\t connCache = conn_cache;\n\t}\n\n   \tconn = connCache.getConnection (user, passwd);\n   \treturn conn;\n  }\n\n\n public static oracle.sql.STRUCT get_mystruct_instance (String sValue, Object[] \noaString, Float oFloat, String sDate, Connection oConn)\n  throws SQLException{\n\t StructDescriptor oStDesc = StructDescriptor.createDescriptor \n(\"EMP_REC1\", oConn);\n\t Object oaStructAttrs [] = new Object [4];\n\n\t ArrayDescriptor oArrDesc = ArrayDescriptor.createDescriptor\n(\"STRARRAY\", oConn);\n\t ARRAY oArray = new ARRAY (oArrDesc, oConn, oaString);\n\t \n\t oaStructAttrs[0] = sValue;\n\t oaStructAttrs[1] = oArray;\n\t oaStructAttrs[2] = oFloat;\n\t oaStructAttrs[3] = Date.valueOf (sDate);\n\n\t STRUCT mystruct_inst = new STRUCT (oStDesc, oConn, oaStructAttrs);\n\t return mystruct_inst;\n }\n\n public void main (String [] args) throws SQLException\n  {\n   \t if (args.length < 3){\n\t \tSystem.out.println (\"Usage: java MyApplication <DB url> <DB \nusername> <DB password>\");\n\t \tSystem.exit (1);\n\t }\n\n   \t Connection myConn = null;\n   \t Statement myStmt = null;\n   \t try{\n\t\t myConn = getConnFromCache (args [0], args [1], args [2]);\n\t\t myStmt = myConn.createStatement ();\n\t\t \n\t\t /* DB Schema Creation */\n\t\t try{\n\t\t \tmyStmt.executeUpdate(\"Drop table emp_list1\");\n\t\t \tmyStmt.executeUpdate (\"create or replace type strarray \nis array(10) of varchar2(30)\");\n\t\t \tmyStmt.executeUpdate (\"create or replace type emp_rec1 \nas object (empname varchar2(30), addr_list strarray,salary float,join_date \ndate)\");\n\t\t }catch(Exception e){;} // ignore if objects already exists\n\t\t \n\t\t myStmt.executeUpdate (\"create table emp_list1 (empno integer \nprimary key, emprec emp_rec1 )\");\n\t\t myStmt.executeUpdate (\"create or replace procedure \ninsert_emp_rec1(in1 in Integer, in2 in emp_rec1) as begin insert into emp_list1 \nvalues(in1, in2); end;\");\n\t\t myStmt.executeUpdate (\"create or replace procedure get_emp_rec1\n(in1 in Integer, in2 out emp_rec1) as begin select emprec into in2 from \nemp_list1 where empno = in1; end;\");\n\t\t myStmt.close ();\n\n\t\t /*Insert data into the emp_list1 table by calling the stored \nproc insert_emp_rec1*/\n\t\t Object oaString[] = new Object[2];\n\t\t oaString[0] = new String(\"196 Florence\");\n\t\t oaString[1] = new String(\"Arden Hills\");\n\t\t STRUCT mystruct_inst = get_mystruct_instance (\"Subhash\", \noaString, new Float(150000.50),\"1999-07-19\", myConn);\n\t\t CallableStatement myCstmt = myConn.prepareCall (\"{call \ninsert_emp_rec1(?, ?)}\");\n\t\t myCstmt.setObject (1, new Integer(1), Types.INTEGER);\n\t\t myCstmt.setObject (2, mystruct_inst, Types.STRUCT);\n\t\t myCstmt.execute ();\n\t\t myCstmt.close ();\n\t\t myConn.close ();\n\n\t\t /*Obtain a fresh connection and fetch the data inserted in the \nprevious execute statement.*/\n\t\t myConn = getConnFromCache (args [0], args [1], args [2]);\n\t\t CallableStatement stmt;\n\t\t stmt = myConn.prepareCall (\"{call get_emp_rec1(?, ?)}\");\n\t\t Object oObject = new Integer(1);\n\t\t stmt.setObject(1, oObject, Types.INTEGER);\n\t\t stmt.registerOutParameter (2, Types.STRUCT, \"EMP_REC1\");\n\t\t stmt.execute ();\n\n\t\t Object value = stmt.getObject(2);\n\t\t if ( value instanceof java.sql.Struct ) {\n\t\t\tObject[] values = (Object[])((java.sql.Struct)\nvalue).getAttributes ();\n\t\t\tfor (int j = 0; j < values.length; ++j)\n\t\t    System.out.println (\"values [\" + j + \"] = \" + values [j]);\n\t\t }\n\t\t stmt.close();\n\t\t myConn.close ();\n\t    }\n\t    catch (SQLException sqle){\n\t\t sqle.printStackTrace();\n\t\t System.out.println (\"Exception message: \" + sqle.getMessage \n());\n\t\t try{\n\t\t\tmyStmt.close ();myConn.close ();\n\t\t    }catch(Exception e){;}\n\t\t throw sqle;  \n\t    }\n\t}\n%>\n\n<%\n\tString[] arg = \n{\"jdbc:oracle:thin:@atharna:1521:wind62\",\"rajoshi\",\"rajoshi\"};\n\ttry{\n\t    main(arg);\n\t}catch(SQLException e){\n\t\tout.print(e);\n\t}\n%>\n</body>\n</html>", "id": 42229, "time": "2003-08-06T06:40:06Z", "bug_id": 22159, "creation_time": "2003-08-06T06:40:06Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 22159, "text": "*** Bug 22158 has been marked as a duplicate of this bug. ***", "count": 1, "id": 42232, "time": "2003-08-06T07:13:21Z", "creator": "remm@apache.org", "creation_time": "2003-08-06T07:13:21Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 22159, "attachment_id": null, "text": "I recommend you debug this further yourself, as all your code seems out of the\nTomcat scope, and the error seems SQL relqted. This will not be looked into at\nthis point.", "id": 42238, "time": "2003-08-06T09:57:06Z", "creator": "remm@apache.org", "creation_time": "2003-08-06T09:57:06Z", "is_private": false}]
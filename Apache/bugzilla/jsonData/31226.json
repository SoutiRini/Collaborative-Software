[{"count": 0, "tags": [], "bug_id": 31226, "attachment_id": null, "is_private": false, "id": 63540, "time": "2004-09-14T18:56:42Z", "creator": "fbregier@webmails.com", "creation_time": "2004-09-14T18:56:42Z", "text": "I use Apache 2.0 to have a reverse proxy web server that\ncompress with mod_deflate the web pages in direction of the users.\nApplications behind (on application \"proxified\" server) generate :\n- text/html document\n- application/pdf or others like jpg document \nboth using an url such as http://myreverseproxy/application/application.exe\nor application.php whatever like this.\n\nThe url is always the same for one application, only the context (session)\nimplies the answear (html or pdf document).\nWe want to compress document with type mime = text, but not those\nwith jpg or pdf type mime.\n\nBut here is the problem, with proxypass and proxypassreverse :\n\n1) using SetOutputFilter DEFLATE implies that everything is compressed\neven if the mime type is a pdf or jpg since the exclusion can be based \nonly on url, which is not possible here.\nWe can exclude files like http://myreverseproxy/application/image.jpg\nbut not the same jpg create dynamically by \nhttp://myreverseproxy/application/application.exe\n\n2) using AddOutputFilterByType DEFLATE text/html text/plain\ncompressed nothing at all, neither html neither pdf or jpg.\nAnd accordingly to the documentation and sources on the web,\nthis second solution should be the correct one.\nEvery mime types are defined and ok, the returned documents\nare using the correct mime type (text/html, application/pdf, ...).\n\nI found not much information on the web on a reverse proxy with\ncompression at the same time.\nIt is quite a big problem for us since we cannot use\nthe web compression in this conditions.\nHas someone have this problem too ?\nWhat can I do to correct this ?\n\nthank you for your help"}, {"count": 1, "tags": [], "creator": "nick@webthing.com", "text": "AddOutputFilterbyType is known to be broken.  Use mod_filter instead:\nhttp://httpd.apache.org/docs-2.1/mod/mod_filter.html\n", "id": 63573, "time": "2004-09-15T11:23:55Z", "bug_id": 31226, "creation_time": "2004-09-15T11:23:55Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "Thank you for your note on the broken AddOutputFilterByType.\nI read the manual page of mod_filter.\nFirst, it is only valid with Apache 2.1. \nIs it enough stable for this use (reverse proxy and deflate) for production ?\n\nSecond, I try to think what could be the syntax of the filter.\n\nFilterDeclare compressed Content-Type\nFilterProvider compressed deflate $text/html\n# is it deflate or mod_deflate ?\nFilterProvider compressed deflate $text/plain\nFilterProtocol compressed \"change=yes\"\n<Location /application>\nFilterChain compressed\n</Location> \n\nBut I miss a point. What about the proxy definition ?\nIs the proxy (proxypass and reverse) applied before this filter,\nor should I make another Filter with the final filterchain as\nFilterChain proxyfied compressed ?\nTherefore, how can I specify the directives for this filter \n(proxypass and reverse) ?\nWhat about special mod_deflate directives (deflatecompressionlevel for \ninstance) ?\n\nAlso there is the registering of the modules with ap_register_output_filter.\nIs is done with all standard modules and with what names ?\n(for mod_proxy, mod_deflate ?)\n\nI know now this module is new, so I can understand that the manual is not \ncompleted.\nThank you again", "attachment_id": null, "id": 63574, "creator": "fbregier@webmails.com", "time": "2004-09-15T12:22:05Z", "bug_id": 31226, "creation_time": "2004-09-15T12:22:05Z", "is_private": false}, {"count": 3, "tags": [], "creator": "nick@webthing.com", "text": "This is not really a support forum.  Please direct support questions somewhere\nmore appropriate, such as the apache-users mailinglist or a suitable webservers\nnewsgroup.\n\nBut in brief,\n (1) it works fine with 2.0\n (2) your filter syntax looks fine to me\n (3) It doesn't affect your proxy setup or your mod_deflate directives.  Stop\nlooking for complexity where there is none!", "id": 63577, "time": "2004-09-15T13:22:33Z", "bug_id": 31226, "creation_time": "2004-09-15T13:22:33Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 31226, "attachment_id": null, "is_private": false, "id": 63661, "time": "2004-09-16T12:11:44Z", "creator": "fbregier@webmails.com", "creation_time": "2004-09-16T12:11:44Z", "text": "Thank you for this help.\nFor everyone having the same problem and looking in this bug,\nI place the solution that works for me.\nWith standard proxy and deflate directives, I placed the following\n\nFilterDeclare compressed Content-Type\nFilterProvider compressed deflate $text/html\nFilterProvider compressed deflate $text/plain\nFilterProvider compressed deflate $text/css\n#FilterProtocol compressed deflate \"change=yes\"\nFilterChain compressed\n\nI had to download spcifically the mod_filter.c through\nyour web page, Nick (http://www.apache.org/~niq/)\nsince it is not in Apache sources (neither 2.0 or 2.1).\nI understand since the first release is of august 2004.\n\nI comment FilterProtocol since it produces an error\nin apache (\"FilterProtocol: No such filter\").\nI try with and without \"deflate\".\n\nWell, at this time, it seems to work as intended.\nSince it is a quite new module, I have to test it intensively\nsince it is for production later on.\n\nThank you ! Bug closed !\n\n"}, {"count": 5, "tags": [], "text": "*** Bug 14335 has been marked as a duplicate of this bug. ***", "attachment_id": null, "id": 81503, "creator": "nick@webthing.com", "time": "2005-10-21T10:28:35Z", "bug_id": 31226, "creation_time": "2005-10-21T10:28:35Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 31226, "attachment_id": null, "is_private": false, "id": 81508, "time": "2005-10-21T11:39:42Z", "creator": "rpluem@apache.org", "creation_time": "2005-10-21T11:39:42Z", "text": "(In reply to comment #1)\n> AddOutputFilterbyType is known to be broken.  Use mod_filter instead:\n\nThe question to me is: Why is it broken? While having a look a PR14335 I found\nout that the reason for this \"brokenness\" seems to be the following lines from\nap_add_output_filters_by_type in core.c:\n\n    /* We can't do anything with proxy requests, no content-types or if\n     * we don't have a filter configured.\n     */\n    if (r->proxyreq != PROXYREQ_NONE || !r->content_type ||\n        !conf->ct_output_filters) {\n        return;\n    }\n\nDoes anybody remember the reason why we cannot do anything on proxied resources?\nThis change had been made in r94028 about 3,5 years ago by Bill Stoddard.\n"}, {"count": 7, "tags": [], "bug_id": 31226, "is_private": false, "text": "(In reply to comment #4)\n\n[..cut..]\n\n> I had to download spcifically the mod_filter.c through\n> your web page, Nick (http://www.apache.org/~niq/)\n> since it is not in Apache sources (neither 2.0 or 2.1).\n\nIt is part of httpd 2.1 and was protmoted from its experimental state to be a\nregular module a while ago. The configure switch for mod_filter is --enable-filter.\n\n[..cut..]", "id": 81510, "time": "2005-10-21T11:46:29Z", "creator": "rpluem@apache.org", "creation_time": "2005-10-21T11:46:29Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 31226, "text": "I looked at that a while back and nobody could work out why the check is there\neither.  If the check was removed basic things seem to work fine.\n\nhttp://mail-archives.apache.org/mod_mbox/httpd-dev/200409.mbox/%3c20040916161122.GA16320@redhat.com%3e\n\nremoving it in 2.2/trunk and seeing what breaks seems reasonable.", "count": 8, "id": 81512, "time": "2005-10-21T12:35:04Z", "creator": "jorton@redhat.com", "creation_time": "2005-10-21T12:35:04Z", "is_private": false}, {"count": 9, "tags": [], "text": "I just committed Joe's patch to the trunk (r327179):\nhttp://svn.apache.org/viewcvs.cgi/httpd/httpd/trunk/server/core.c?rev=327179&r1=306495&r2=327179\nIt fixes the problem.", "is_private": false, "bug_id": 31226, "id": 81517, "time": "2005-10-21T15:52:19Z", "creator": "rpluem@apache.org", "creation_time": "2005-10-21T15:52:19Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 31226, "text": "Commited to 2.2.x branch (r327793):\nhttp://svn.apache.org/viewcvs.cgi/httpd/httpd/branches/2.2.x/server/core.c?rev=327793&r1=307031&r2=327793", "id": 81582, "time": "2005-10-23T16:21:27Z", "creator": "rpluem@apache.org", "creation_time": "2005-10-23T16:21:27Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "jorton@redhat.com", "text": "*** Bug 41146 has been marked as a duplicate of this bug. ***", "id": 96766, "time": "2006-12-11T07:45:32Z", "bug_id": 31226, "creation_time": "2006-12-11T07:45:32Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 31226, "attachment_id": 19243, "is_private": false, "id": 96771, "time": "2006-12-11T09:59:53Z", "creator": "bill+apache@bfccomputing.com", "creation_time": "2006-12-11T09:59:53Z", "text": "Created attachment 19243\npatch against 2.0.54\n\nadding patch here per Joe Orton on bug 41146.\n\nAs noted there, this patch has been applied to a production 2.0.54 server\n(fedora core 4) which has served about 14 million deflated pages through the\nproxy without problems."}, {"attachment_id": null, "tags": [], "bug_id": 31226, "text": "Am experiencing the same problem in 2.2.3 (RHEL5, Linux 2.6.18). The rule which hands this off to the internal proxy is:\n\n RewriteRule     ^/(.*\\.php)$    http://WWW.xxxxx.COM:80/$1    [P]\n\nand compression in particular set for CSS:\n\n AddOutputFilterByType DEFLATE text/css\n\n(I also tried the Filter module with similar results.) \n\nProxying is working fine, deflating is working fine... just not together. According to SVN, the CHANGE_LOG says this was fixed as of 2.2.2. Is it possible something still doesn't work correctly? Is it possible that the rewrite module and this module don't play together well??\n\n\n", "count": 13, "id": 123408, "time": "2008-12-18T17:09:48Z", "creator": "otheus+opensource@gmail.com", "creation_time": "2008-12-18T17:09:48Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 31226, "text": "1. 2.2.3 is a very old version.\n2. I rechecked the code and cannot find something suspicious.\n\nSo please post your complete configuration.", "count": 14, "id": 123409, "time": "2008-12-19T00:47:21Z", "creator": "rpluem@apache.org", "creation_time": "2008-12-19T00:47:21Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "poirier@pobox.com", "is_private": false, "count": 15, "id": 127288, "time": "2009-05-22T07:52:31Z", "bug_id": 31226, "creation_time": "2009-05-22T07:52:31Z", "text": "It appears the original problem has been fixed.  If it's seen again (on a current version), this can be reopened."}]
[{"count": 0, "tags": [], "text": "If a jsp page references a servlet after including some other content, and gets a ClassNotFoundException on that servlet, an IllegalStateException occurs during a buffer reset.\r\nThis error is very misleading, and doesn't point to the classpath or servlet setup in web.xml as the cause. It looks like it's an internal error in Tomcat\r\ninstead of a simple configuration error.\r\n\r\nStacktraces:\r\n\r\nLocation:/test/foobar.jsp\r\n\r\nInternal Servlet Error:\r\n\r\njavax.servlet.ServletException: can't reset buffer after writing to client\r\n        at org.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:448)\r\n        at _0002ffoobar_0002ejspfoobar_jsp_1._jspService(_0002ffoobar_0002ejspfoobar_jsp_1.java:75)\r\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:119)\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\r\n        at org.apache.jasper.servlet.JspServlet$JspServletWrapper.service(JspServlet.java:177)\r\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:309)\r\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:382)\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\r\n        at org.apache.tomcat.core.ServletWrapper.doService(ServletWrapper.java:387)\r\n        at org.apache.tomcat.core.Handler.service(Handler.java:263)\r\n        at org.apache.tomcat.core.ServletWrapper.service(ServletWrapper.java:371)\r\n        at org.apache.tomcat.core.ContextManager.internalService(ContextManager.java:749)\r\n        at org.apache.tomcat.core.ContextManager.service(ContextManager.java:695)\r\n        at org.apache.tomcat.service.http.HttpConnectionHandler.processConnection(HttpConnectionHandler.java:207)\r\n        at org.apache.tomcat.service.TcpWorkerThread.runIt(PoolTcpEndpoint.java:403)\r\n        at org.apache.tomcat.util.ThreadPool$ControlRunnable.run(ThreadPool.java:498)\r\n        at java.lang.Thread.run(Thread.java:475)\r\n\r\nRoot cause: \r\n\r\njava.lang.IllegalStateException: can't reset buffer after writing to client\r\n        at org.apache.tomcat.core.BufferedServletOutputStream.reset(BufferedServletOutputStream.java:296)\r\n        at org.apache.tomcat.core.ResponseImpl.resetBuffer(ResponseImpl.java:395)\r\n        at org.apache.tomcat.core.ContextManager.handleStatus(ContextManager.java:953)\r\n        at org.apache.tomcat.core.Handler.service(Handler.java:249)\r\n        at org.apache.tomcat.core.ServletWrapper.service(ServletWrapper.java:371)\r\n        at org.apache.tomcat.facade.RequestDispatcherImpl.include(RequestDispatcherImpl.java:308)\r\n        at org.apache.jasper.runtime.PageContextImpl.include(PageContextImpl.java:407)\r\n        at _0002ffoobar_0002ejspfoobar_jsp_1._jspService(_0002ffoobar_0002ejspfoobar_jsp_1.java:65)\r\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:119)\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\r\n        at org.apache.jasper.servlet.JspServlet$JspServletWrapper.service(JspServlet.java:177)\r\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:309)\r\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:382)\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\r\n        at org.apache.tomcat.core.ServletWrapper.doService(ServletWrapper.java:387)\r\n        at org.apache.tomcat.core.Handler.service(Handler.java:263)\r\n        at org.apache.tomcat.core.ServletWrapper.service(ServletWrapper.java:371)\r\n        at org.apache.tomcat.core.ContextManager.internalService(ContextManager.java:749)\r\n        at org.apache.tomcat.core.ContextManager.service(ContextManager.java:695)\r\n        at org.apache.tomcat.service.http.HttpConnectionHandler.processConnection(HttpConnectionHandler.java:207)\r\n        at org.apache.tomcat.service.TcpWorkerThread.runIt(PoolTcpEndpoint.java:403)\r\n        at org.apache.tomcat.util.ThreadPool$ControlRunnable.run(ThreadPool.java:498)\r\n        at java.lang.Thread.run(Thread.java:475)", "is_private": false, "bug_id": 117, "id": 97, "time": "2000-09-15T15:14:29Z", "creator": "dev@tomcat.apache.org", "creation_time": "2000-09-15T15:14:29Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 117, "is_private": false, "count": 1, "id": 5337, "time": "2001-09-10T19:35:10Z", "creator": "Larry.Isaacs@sas.com", "creation_time": "2001-09-10T19:35:10Z", "text": "This bug was originally logged against Tomcat 3.2b4. In Tomcat 3.2.3,\na 404 error occurs on the missing servlet.  In Tomcat 3.3, a stack trace occurs\nsimilar to the stack traces shown except that the top exception says\n\"Included servlet threw exception\" and the root exception is a\nClassNotFoundException exception naming the missing class."}]
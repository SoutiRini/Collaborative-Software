[{"count": 0, "tags": [], "creator": "icicimov@gmail.com", "attachment_id": null, "text": "Hi all,\n\nI've been trying to compile apache2.2.26 on two separate CentOS boxes, one with CentOS-5.6 and one with CentOS-5.10 final. The compile process failed on both of them with the following error message at the point of compiling the apache tools:\n\n/home/igorc/httpd-2.2.26/srclib/apr/libtool --silent --mode=link gcc -g -O2 -pthread     -L/usr/lib64  -L/opt/openssl/lib -o ab  ab.lo   -lm /home/igorc/httpd-2.2.26/srclib/pcre/libpcre.la /home/igorc/httpd-2.2.26/srclib/apr-util/libaprutil-1.la -lexpat /home/igorc/httpd-2.2.26/srclib/apr/libapr-1.la -luuid -lrt -lcrypt -lpthread -ldl -lssl -lcrypto\n.libs/ab.o: In function `main':\n/home/igorc/httpd-2.2.26/support/ab.c:2241: undefined reference to `TLSv1_2_client_method'\n/home/igorc/httpd-2.2.26/support/ab.c:2239: undefined reference to `TLSv1_1_client_method'\ncollect2: ld returned 1 exit status\nmake[2]: *** [ab] Error 1\nmake[2]: Leaving directory `/home/igorc/httpd-2.2.26/support'\nmake[1]: *** [all-recursive] Error 1\nmake[1]: Leaving directory `/home/igorc/httpd-2.2.26/support'\nmake: *** [all-recursive] Error 1\n\nThe exact config command I used is as follows:\n\n./configure LDFLAGS=\"-L/opt/openssl/lib\" --prefix=/usr/local/apache2-2.2.26 --with-mpm=worker --with-included-apr --enable-info --enable-proxy --enable-proxy-connect --enable-proxy-ftp --enable-proxy-http --enable-proxy-balancer --enable-rewrite --enable-headers --enable-cache --enable-mem-cache --enable-disk-cache --enable-expires --enable-dav --enable-deflate --enable-ssl --with-ssl=/opt/openssl --with-ldap=ldap --with-ldap-lib=/usr/lib64 --with-ldap-include=/usr/include --enable-ldap --enable-authnz-ldap --enable-mods-shared=\"all ldap authnz_ldap proxy proxy-http proxy-ftp proxy-balancer deflate info rewrite headers expires authn_alias cache mem_cache disk_cache file_cache charset_lite dav dav_lock ssl\"\n\npointing apache compiler to the appropriate custom install of openss-1.0.1e libraries under /opt/openssl. The config used for openssl compile was:\n\n./Configure --prefix=/opt/openssl enable-tlsext linux-x86_64 threads zlib enable-idea enable-rc5 enable-mdc2 enable-ec enable-ecdh enable-ecdsa shared\n\n$ ls -lR /opt/openssl/lib/\n/opt/openssl/lib/:\ntotal 7060\ndrwxr-xr-x 2 root root    4096 Dec  2 12:00 engines\n-rw-r--r-- 1 root root 3858364 Dec  2 12:00 libcrypto.a\nlrwxrwxrwx 1 root root      18 Dec  2 12:00 libcrypto.so -> libcrypto.so.1.0.0\n-r-xr-xr-x 1 root root 2145661 Dec  2 12:00 libcrypto.so.1.0.0\n-rw-r--r-- 1 root root  729410 Dec  2 12:00 libssl.a\nlrwxrwxrwx 1 root root      15 Dec  2 12:00 libssl.so -> libssl.so.1.0.0\n-r-xr-xr-x 1 root root  463549 Dec  2 12:00 libssl.so.1.0.0\ndrwxr-xr-x 2 root root    4096 Dec  2 12:00 pkgconfig\n\n/opt/openssl/lib/engines:\ntotal 352\n-r-xr-xr-x 1 root root  23714 Dec  2 12:00 lib4758cca.so\n-r-xr-xr-x 1 root root  25611 Dec  2 12:00 libaep.so\n-r-xr-xr-x 1 root root  18601 Dec  2 12:00 libatalla.so\n-r-xr-xr-x 1 root root   5866 Dec  2 12:00 libcapi.so\n-r-xr-xr-x 1 root root  32035 Dec  2 12:00 libchil.so\n-r-xr-xr-x 1 root root  26300 Dec  2 12:00 libcswift.so\n-r-xr-xr-x 1 root root   5865 Dec  2 12:00 libgmp.so\n-r-xr-xr-x 1 root root 115028 Dec  2 12:00 libgost.so\n-r-xr-xr-x 1 root root  16168 Dec  2 12:00 libnuron.so\n-r-xr-xr-x 1 root root   5869 Dec  2 12:00 libpadlock.so\n-r-xr-xr-x 1 root root  31966 Dec  2 12:00 libsureware.so\n-r-xr-xr-x 1 root root  26114 Dec  2 12:00 libubsec.so\n\n/opt/openssl/lib/pkgconfig:\ntotal 12\n-rw-r--r-- 1 root root 266 Dec  2 12:00 libcrypto.pc\n-rw-r--r-- 1 root root 281 Dec  2 12:00 libssl.pc\n-rw-r--r-- 1 root root 291 Dec  2 12:00 openssl.pc\n\n$ /opt/openssl/bin/openssl version\nOpenSSL 1.0.1e 11 Feb 2013\n\nAdditionally to this I have set my $PATH and $LD_LIBRARY_PATH to point to this location as well in the shell terminal I ran the compile from:\n\n$ export PATH=/opt/openssl/bin:$PATH\n$ export LD_LIBRARY_PATH=/opt/openssl/lib:$LD_LIBRARY_PATH\n\nand on top of that I've put /opt/openssl/lib in /etc/ld.so.conf file and ran ldconfig.\n\nMy guess the problem is that during the compile time the order of the libraries as given just before the error \"-L/usr/lib64  -L/opt/openssl/lib\" makes the compiler to pick up the wrong version of openssl.\n\nMy understanding is that apache should look for ssl libraries only in the path given by \"--with-ssl\" switch but that is not the case here.\n\n# lsb_release -a\nLSB Version:\t:core-4.0-amd64:core-4.0-ia32:core-4.0-noarch:graphics-4.0-amd64:graphics-4.0-ia32:graphics-4.0-noarch:printing-4.0-amd64:printing-4.0-ia32:printing-4.0-noarch\nDistributor ID:\tCentOS\nDescription:\tCentOS release 5.6 (Final)\nRelease:\t5.6\nCodename:\tFinal\n\n\n# gcc -v\nUsing built-in specs.\nTarget: x86_64-redhat-linux\nConfigured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-libgcj-multifile --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --disable-plugin --with-java-home=/usr/lib/jvm/java-1.4.2-gcj-1.4.2.0/jre --with-cpu=generic --host=x86_64-redhat-linux\nThread model: posix\ngcc version 4.1.2 20080704 (Red Hat 4.1.2-50)\n\n\nPlease let me know if any more info needed.\n\nThanks,\nIgor", "id": 171523, "time": "2013-12-02T01:43:05Z", "bug_id": 55834, "creation_time": "2013-12-02T01:43:05Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 55834, "attachment_id": null, "id": 171524, "time": "2013-12-02T02:04:37Z", "creator": "icicimov@gmail.com", "creation_time": "2013-12-02T02:04:37Z", "is_private": false, "text": "$ libtool --version\nltmain.sh (GNU libtool) 1.5.22 (1.1220.2.365 2005/12/18 22:14:06)\n\nCopyright (C) 2005  Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."}, {"count": 2, "tags": [], "text": "Ok, the problem was obviously with apache apr/libtoll which probably comes with some hard coded library paths in libtool.\n\nThe solution, omit the \"--with-included-apr\" from your configure options to by-pass the apache apr and use the system provided one. After that apache builds and installs fine. \n\nAdditionally, you need to include the openssl library path into $LD_LIBRARY_PATH of the user that is starting apache so for me I put:\n\nexport LD_LIBRARY_PATH=/opt/openssl/lib:$LD_LIBRARY_PATH\n\nin the /root/.bashrc for the root user.\n\n\nJust as confirmation, here it is up and running:\n\n[Mon Dec 02 15:08:27 2013] [warn] Init: Name-based SSL virtual hosts only work for clients with TLS server name indication support (RFC 4366)\n[Mon Dec 02 15:08:27 2013] [notice] Digest: generating secret for digest authentication ...\n[Mon Dec 02 15:08:27 2013] [notice] Digest: done\n[Mon Dec 02 15:08:28 2013] [warn] Init: Name-based SSL virtual hosts only work for clients with TLS server name indication support (RFC 4366)\n[Mon Dec 02 15:08:28 2013] [warn] pid file /usr/local/apache2-2.2.26/logs/httpd.pid overwritten -- Unclean shutdown of previous Apache run?\n[Mon Dec 02 15:08:28 2013] [notice] Apache/2.2.26 (Unix) DAV/2 mod_ssl/2.2.26 OpenSSL/1.0.1e configured -- resuming normal operations", "attachment_id": null, "id": 171525, "creator": "icicimov@gmail.com", "time": "2013-12-02T04:27:29Z", "bug_id": 55834, "creation_time": "2013-12-02T04:27:29Z", "is_private": false}]
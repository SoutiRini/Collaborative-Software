[{"count": 0, "tags": [], "creator": "tony@absolutejava.com", "attachment_id": null, "is_private": false, "id": 20944, "time": "2002-08-13T05:42:13Z", "bug_id": 11647, "creation_time": "2002-08-13T05:42:13Z", "text": "Hello,\n\nI'm using Tomcat v4.1.8 on Win 2k, SP3. My client (i.e., browswer) is running \non a separate Win 2k, SP3 machine. I've tested this issue with IE 6 and \nNavigator 6.2. I've also used the Wild Packets sniffer to see what bytes Tomcat \nwas sending.\n\nHere's the problem: If a servlet sets the charset within the \"Content-Type\" \nresponse header (e.g., \"text/html;charset=UTF-16\"), the response headers will \nbe encoded according to the specified encoding, rather than US-ASCII as \nspecified by RFC 2616 (http://www.cis.ohio-state.edu/cgi-bin/rfc/rfc2616.html).\n\nBelow is a simple servlet that shows the problem.\n\nThe servlet below specifies an encoding of UTF-16. The PrintWriter correctly \nencodes the response body as UTF-16. The problem is that the response *headers* \nare also being encoded as UTF-16, which violates the HTTP spec (see Section \n2.2). The headers should be encoded as US-ASCII (or US-ASCII \"compatible\").\n\nI know it's possible to use UTF-8 or some other US-ASCII \"compatible\" encoding \nwhere the first 127 characters are encoded the same as US-ASCII -- I realize \nthat's a possible \"work around\". IMHO, however, Tomcat should encode headers \naccording to the spec, regardless of how the response body is encoded.\n\nThis is the first time I've submitted a Tomcat bug. Can you tell me if there is \na way for me to check the status? Thanks.\n\n\nimport java.io.*;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\n\n\npublic class Tester extends HttpServlet {\n   public void doGet(HttpServletRequest request,\n                     HttpServletResponse response)\n                     throws ServletException, IOException {\n      response.setContentType(\"text/html;charset=UTF-16\");\n      PrintWriter pw = response.getWriter();\n\n      pw.println(\"<html><head><title>Test</title></head>\"  +\n                 \"<body><p>AAAA BBBB CCCC</p></body></html>\");\n   } // doGet()\n} // Tester"}, {"count": 1, "tags": [], "bug_id": 11647, "attachment_id": null, "id": 22098, "creation_time": "2002-09-02T02:24:31Z", "time": "2002-09-02T02:24:31Z", "creator": "william.barker@wilshire.com", "text": "Testing against the HEAD (which is basically the same at this point as 4.1.10), \nthis does, indeed work with the default CoyoteConnector.  \n\nI seem to recall that this was one of the problems with the old (and now \ndeprecated) HttpConnector.  You should check your server.xml to make certain \nthat you are using the newer connector.", "is_private": false}]
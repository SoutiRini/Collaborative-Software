[{"count": 0, "tags": [], "text": "I configured a simple JMS Topic with one Subscriber and one Publisher.  Subscriber sampler never seems to recieve all the messages published by the sampler.\n\nFor eg, when my jmeter test is configured to publish 10 messages and subscriber sampler recieving indefintely, the report shows as 10 messages published but subscriber shows only recieved as 4-9 messages recieved from various runs.\n\nTo make sure its a jmeter issue, I wrote simple subscriber code and ran the jmeter test, I recive all the 10 messages through my sample code where as jmeter subscriber recives only some of them.\n\nThis is a major blocker for us to do the load testing.\n\nIs this a known bug, please let me know the workaround if any.", "is_private": false, "bug_id": 47949, "id": 130910, "time": "2009-10-06T08:24:58Z", "creator": "hikiran@gmail.com", "creation_time": "2009-10-06T08:24:58Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "I've seen something similar, where the JMS SubscriberSampler will take multiple messages and combine them into a single message, which will make the counts lower then what you expect.    It's due to the while (this.count(0) < loop) { Thread.sleep } loops in the sampleWithListener() and SampleWithReceive() methods.  If multiple messages come in during the Thread.sleep() time periods, they will be aggregated into a single buffer, and returned as a single message.  In my case, it's causing some XPath Assertions to fail.\n\nI've debated re-writing these methods to use an array of buffers to received the messages, just haven't had the time yet to code and test it.", "is_private": false, "bug_id": 47949, "id": 131614, "time": "2009-11-03T05:49:18Z", "creator": "boby379@gmail.com", "creation_time": "2009-11-03T05:49:18Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 47949, "text": "The code always increments the counter when it appends a message to the buffer, and this is done in a synch. block.\n\nHowever, the code does not count (or store) empty messages; likewise it skips messages that are not instances of TextMessage.\n\nSo I don't see how the problems are occurring.\nThis assumes you are using JMeter 2.3.4.", "id": 131621, "time": "2009-11-03T07:01:37Z", "creator": "sebb@apache.org", "creation_time": "2009-11-03T07:01:37Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "boby379@gmail.com", "attachment_id": null, "id": 131634, "time": "2009-11-03T10:51:30Z", "bug_id": 47949, "creation_time": "2009-11-03T10:51:30Z", "is_private": false, "text": "(In reply to comment #2)\n> The code always increments the counter when it appends a message to the buffer,\n> and this is done in a synch. block.\n> However, the code does not count (or store) empty messages; likewise it skips\n> messages that are not instances of TextMessage.\n> So I don't see how the problems are occurring.\n> This assumes you are using JMeter 2.3.4.\n\nI am using JMeter 2.3.4.\nThe problem is if 2 messages come into onMessage() before the sleep() expires in sampleWithListener(), then onMessage() will put both messages into a single buffer, and then they're read off as a single message in the sampleWithListener().   I've seen this happen in my testing (it cost me quite a few hours trying to find this problem).\n\nA similar sequence of events can happen with sampleWithReceive() and the code in ReceiveSubscriber.java."}, {"count": 4, "tags": [], "bug_id": 47949, "attachment_id": null, "id": 131637, "time": "2009-11-03T11:51:58Z", "creator": "sebb@apache.org", "creation_time": "2009-11-03T11:51:58Z", "is_private": false, "text": "(In reply to comment #3)\n> The problem is if 2 messages come into onMessage() before the sleep() expires\n> in sampleWithListener(), then onMessage() will put both messages into a single\n> buffer, and then they're read off as a single message in the\n> sampleWithListener().   I've seen this happen in my testing (it cost me quite a\n> few hours trying to find this problem).\n> \n> A similar sequence of events can happen with sampleWithReceive() and the code\n> in ReceiveSubscriber.java.\n\nAgreed, more messages can appear in the buffer than requested, and the count can be lower than the actual.\n\nThis has been fixed in SVN:\n\nURL: http://svn.apache.org/viewvc?rev=832521&view=rev\nLog:\nBetter handling of received count\n\nThe sample count will now agree with the buffer contents, but may there may be more messages than requested."}, {"count": 5, "tags": [], "creator": "boby379@gmail.com", "attachment_id": null, "text": "Sebb;\n\nI've got an alternate implementation that I put together today (had a few spare hours at work), that uses a Queue so messages are kept separate and allows you to read only the number of messages requested.   I've modified both the withRecieve() and withListener() scenarios, do you want me to post it here?\n\n(In reply to comment #4)\n> Agreed, more messages can appear in the buffer than requested, and the count\n> can be lower than the actual.\n> This has been fixed in SVN:\n> URL: http://svn.apache.org/viewvc?rev=832521&view=rev\n> Log:\n> Better handling of received count\n> The sample count will now agree with the buffer contents, but may there may be\n> more messages than requested.", "id": 131638, "time": "2009-11-03T12:01:58Z", "bug_id": 47949, "creation_time": "2009-11-03T12:01:58Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 47949, "is_private": false, "id": 131639, "attachment_id": null, "creator": "sebb@apache.org", "creation_time": "2009-11-03T12:05:12Z", "time": "2009-11-03T12:05:12Z", "text": "(In reply to comment #5)\n> Sebb;\n> \n> I've got an alternate implementation that I put together today (had a few spare\n> hours at work), that uses a Queue so messages are kept separate and allows you\n> to read only the number of messages requested.   I've modified both the\n> withRecieve() and withListener() scenarios, do you want me to post it here?\n\nYes please, assuming that it will run on Java 1.5+."}, {"count": 7, "tags": [], "bug_id": 47949, "is_private": false, "id": 131711, "attachment_id": 24484, "creator": "boby379@gmail.com", "creation_time": "2009-11-04T17:52:48Z", "time": "2009-11-04T17:52:48Z", "text": "Created attachment 24484\nPatch to ReceiveSubscriber.java"}, {"count": 8, "tags": [], "bug_id": 47949, "text": "Created attachment 24485\nPatch to SubscriberSampler.java", "id": 131712, "time": "2009-11-04T17:53:18Z", "creator": "boby379@gmail.com", "creation_time": "2009-11-04T17:53:18Z", "is_private": false, "attachment_id": 24485}, {"count": 9, "tags": [], "bug_id": 47949, "is_private": false, "id": 131713, "attachment_id": null, "creator": "boby379@gmail.com", "creation_time": "2009-11-04T17:55:10Z", "time": "2009-11-04T17:55:10Z", "text": "I've attached patches to both SubscriberSampler.java and ReceiveSubscriber.java to use a queue rather then a single buffer, which should allow for receipt of all messages, and the correct count.   Also in the patch is a couple of hacks to display the JMS message properties, which was something I needed to do at work.\n\nThey're working reasonably well for me, and have solved my merged message problem."}, {"count": 10, "tags": [], "bug_id": 47949, "text": "Thanks for the patches, which have been applied with one minor change: if the samplers are interrupted, then the queues can be empty, so the message handlers need to allow for null message response.\n\n\nURL: http://svn.apache.org/viewvc?rev=940130&view=rev\nLog:\nBug 47949 - JMS Subscriber may not receive all the messages\n\nModified:\n   jakarta/jmeter/trunk/src/protocol/jms/org/apache/jmeter/protocol/jms/client/ReceiveSubscriber.java\n   jakarta/jmeter/trunk/src/protocol/jms/org/apache/jmeter/protocol/jms/sampler/SubscriberSampler.java\n   jakarta/jmeter/trunk/xdocs/changes.xml", "id": 136593, "time": "2010-05-01T21:27:28Z", "creator": "sebb@apache.org", "creation_time": "2010-05-01T21:27:28Z", "is_private": false, "attachment_id": null}]
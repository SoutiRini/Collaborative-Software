[{"count": 0, "attachment_id": null, "bug_id": 53368, "is_private": false, "id": 159735, "time": "2012-06-06T01:13:06Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-06-06T01:13:06Z", "tags": [], "text": "WebSocket examples fail to work if Tomcat 7 is run with SecurityManager enabled.\n\nThey start to work correctly with the following change the policy file:\n\nIndex: catalina.policy\n===================================================================\n--- catalina.policy     (revision 1346679)\n+++ catalina.policy     (working copy)\n@@ -188,6 +188,7 @@\n\n     // Applications using Comet need to be able to access this package\n     permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.comet\";\n+    permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.websocket\";\n };\n\n\nSteps to reproduce:\n1. Start \"catalina.bat start -security\"\n\n2. Go to \"Echo\" websocket example:\nhttp://localhost:8080/examples/websocket/echo.html\n\n3. Click \"(.) streams\", then click \"[Connect]\" button.\n\nExpected: The following message in \"console\" area:\nInfo: WebSocket connection opened.\n\nActual: The following message is printed:\nInfo: WebSocket connection closed.\n\n\nThe following exception is written to catalina*.log:\n[[[\n06.06.2012 4:54:20 org.apache.catalina.loader.WebappClassLoader findClass\nWARNING: WebappClassLoader.findClassInternal(websocket.echo.EchoStream) security exception: access denied (java.lang.RuntimePermission accessClassInPackage.org.apache.catalina.websocket)\njava.security.AccessControlException: access denied (java.lang.RuntimePermission accessClassInPackage.org.apache.catalina.websocket)\n\tat java.security.AccessControlContext.checkPermission(AccessControlContext.java:374)\n\tat java.security.AccessController.checkPermission(AccessController.java:546)\n\tat java.lang.SecurityManager.checkPermission(SecurityManager.java:532)\n\tat java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1512)\n\tat java.lang.ClassLoader$1.run(ClassLoader.java:330)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.lang.ClassLoader.checkPackageAccess(ClassLoader.java:328)\n\tat java.lang.ClassLoader.defineClass1(Native Method)\n\tat java.lang.ClassLoader.defineClassCond(ClassLoader.java:631)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:615)\n\tat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:141)\n\tat org.apache.catalina.loader.WebappClassLoader.findClassInternal(WebappClassLoader.java:2889)\n\tat org.apache.catalina.loader.WebappClassLoader.findClass(WebappClassLoader.java:1170)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1678)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1556)\n\tat org.apache.catalina.core.StandardWrapper.servletSecurityAnnotationScan(StandardWrapper.java:1215)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:461)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:927)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)\n\tat org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:999)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:573)\n\tat org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:310)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:662)\n]]]"}, {"count": 1, "attachment_id": null, "bug_id": 53368, "text": "Fixed in trunk and 7.0.x and will be included in 7.0.28 onwards.", "id": 159769, "time": "2012-06-06T18:47:13Z", "creator": "markt@apache.org", "creation_time": "2012-06-06T18:47:13Z", "tags": [], "is_private": false}]
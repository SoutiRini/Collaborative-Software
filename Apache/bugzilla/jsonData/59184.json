[{"count": 0, "tags": [], "creator": "erik.hermans@headbird.com", "text": "Tried to install mod_jk 1.2.41 on Red Hat Enterprise Linux Server release 6.7 (Santiago)\n\nInstallation was done as follow\n\n./configure --with-apxs=/usr/sbin/apxs\nLDFLAGS=-lc ./configure -with-apxs=/usr/sbin/apxs\nmake\nmake install\n\n\nWhen accessing the URL that should connect through mod_jk with tomcat\n\nmod_jk give Segmentation \n\nInspecting the core with gdb\n\nCore was generated by `/usr/sbin/httpd'.\nProgram terminated with signal 11, Segmentation fault.\n#0  0x00007f66b841ac1d in jk_shm_check_maintain (trigger=1458052643) at jk_shm.c:875\n875         int maintain_checking = JK_ATOMIC_INCREMENT(&(jk_shmem.hdr->h.data.maintain_checking));\nMissing separate debuginfos, use: debuginfo-install httpd-2.2.15-47.el6_7.1.x86_64\n\n\nThe hdr element ik jk_shmem is null\n\n(gdb) p jk_shmem.hdr\n$1 = (jk_shm_header_t *) 0x0\n\n\n(gdb) bt\n#0  0x00007f66b841ac1d in jk_shm_check_maintain (trigger=1458052643) at jk_shm.c:875\n#1  0x00007f66b8409a22 in wc_maintain (l=0x7f66c635b8f8) at jk_worker.c:348\n#2  0x00007f66b83fa36b in jk_handler (r=0x7f66c65a2c28) at mod_jk.c:2880\n#3  0x00007f66c54c4e50 in ap_run_handler ()\n#4  0x00007f66c54c870e in ap_invoke_handler ()\n#5  0x00007f66c54d3e00 in ap_process_request ()\n#6  0x00007f66c54d0c48 in ?? ()\n#7  0x00007f66c54cc958 in ap_run_process_connection ()\n#8  0x00007f66c54d8b97 in ?? ()\n#9  0x00007f66c54d8eaa in ?? ()\n#10 0x00007f66c54d91db in ap_mpm_run ()\n#11 0x00007f66c54b0a30 in main ()", "id": 189493, "time": "2016-03-15T15:07:02Z", "bug_id": 59184, "creation_time": "2016-03-15T15:07:02Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 189494, "time": "2016-03-15T16:34:17Z", "bug_id": 59184, "creation_time": "2016-03-15T16:34:17Z", "is_private": false, "text": "Hi,\n\nthanks for the report and looking at the core using the debugger.\n\nIs this reproducible? Are you starting under load or does it also happen when starting during an idle time? Any warnings or errors in the mod_jk log file during atartup or between startup and the crash?\n\nWould it be possible to reproduce with \"JkLogLevel debug\" and provide access to the logs and you config (Jk dircetives from httpd and workers.properties, plus info about vhost structure)? That will produce loads of log output though, so one would typically only do it on a test system.\n\nIf some of that info is not supposed to be available in the open, you might send that via private mail to me.\n\nRegards,\n\nRainer"}, {"count": 2, "tags": [], "bug_id": 59184, "attachment_id": 33676, "text": "Created attachment 33676\nerror_log", "id": 189495, "time": "2016-03-15T16:56:12Z", "creator": "erik.hermans@headbird.com", "creation_time": "2016-03-15T16:56:12Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 59184, "attachment_id": 33677, "text": "Created attachment 33677\nhttpd.conf", "id": 189496, "time": "2016-03-15T16:56:30Z", "creator": "erik.hermans@headbird.com", "creation_time": "2016-03-15T16:56:30Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 59184, "attachment_id": 33678, "text": "Created attachment 33678\njk.log", "id": 189497, "time": "2016-03-15T16:56:58Z", "creator": "erik.hermans@headbird.com", "creation_time": "2016-03-15T16:56:58Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 59184, "attachment_id": 33679, "is_private": false, "id": 189498, "time": "2016-03-15T16:57:30Z", "creator": "erik.hermans@headbird.com", "creation_time": "2016-03-15T16:57:30Z", "text": "Created attachment 33679\nmod_jk.conf"}, {"count": 6, "tags": [], "creator": "erik.hermans@headbird.com", "attachment_id": 33680, "id": 189499, "time": "2016-03-15T16:57:54Z", "bug_id": 59184, "creation_time": "2016-03-15T16:57:54Z", "is_private": false, "text": "Created attachment 33680\nworkers.properties"}, {"count": 7, "attachment_id": null, "bug_id": 59184, "text": "The problem is reproducable.\n\nIt also happens when starting during an idle time\n\nJkLogLevel debug was already set.\n\nYou will find conf files and logs attached", "id": 189500, "time": "2016-03-15T16:59:55Z", "creator": "erik.hermans@headbird.com", "creation_time": "2016-03-15T16:59:55Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 59184, "attachment_id": null, "text": "There's an error during initializing shm:\n\n[Tue Mar 15 15:38:00.076 2016] [11496:140079373203424] [error] init_jk::mod_jk.c (3574): Initializing shm:/etc/httpd/logs/jk-runtime-status.11496 errno=13. Load balancing workers will not function properly.\n\nerrno 13 on Red Hat is \"Permission denied\".\n\nSince you have not configure a JkShmFile, mod_jk had chosen a path, which in your case was a file in the directory /etc/httpd/logs/. Most likely /etc/httpd is your Apache ServerRoot. mod_jk appends \"logs\" and tries to open the shared memory in that directory. If that isn't what fits your installation, you should explicitely choose a JkShmFile.\n\nSee also http://tomcat.apache.org/connectors-doc/reference/apache.html.\n\nI'll keep that ticket open, because we should fail more gracefully than producing a core dump. But your solution would be to configure a correct JkShmFile.\n\nPlease let us know if that fixes your crashes.", "id": 189501, "time": "2016-03-15T18:13:05Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2016-03-15T18:13:05Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 59184, "attachment_id": null, "text": "I configured  JkShmFile as you suggested, and now it works.\n\nWould indeed be nice if mod_jk would fail more gracefully.", "id": 189542, "time": "2016-03-17T17:03:26Z", "creator": "erik.hermans@headbird.com", "creation_time": "2016-03-17T17:03:26Z", "is_private": false}, {"count": 10, "attachment_id": 33685, "bug_id": 59184, "text": "Created attachment 33685\nFall back to process local memory to avoid crash when shm init failed\n\nThis patch should prevent the crash, when shared memory initialization fails. Since IMHO it is not a good idea to use the module in this case, I wonder whether it would actually be better to fail during startup in this case and not let users proceed.\n\nCurrently the failure only affects setups using a load balancer worker. But this could change any time and even configs without farming should always add an lb worker above their ajp workers.\n\nAnyone having an opinion, please respond here. If I hear no objections, I will likely choose to let the module fail the web server startup if it can't init its shared memory (and not apply the patch).", "id": 189605, "time": "2016-03-20T11:20:34Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2016-03-20T11:20:34Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 59184, "attachment_id": null, "text": "+1 for fail early (with a proper error message, of course)", "id": 189606, "time": "2016-03-20T11:26:18Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2016-03-20T11:26:18Z", "is_private": false}, {"count": 12, "attachment_id": null, "bug_id": 59184, "is_private": false, "id": 193806, "time": "2016-09-19T10:24:17Z", "creator": "markt@apache.org", "creation_time": "2016-09-19T10:24:17Z", "tags": [], "text": "This has been fixed in trunk and will be included in 1.2.42 onwards."}]
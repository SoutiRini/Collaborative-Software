[{"count": 0, "tags": [], "creator": "1983-01-06@gmx.net", "attachment_id": null, "is_private": false, "id": 189704, "time": "2016-03-24T10:20:14Z", "bug_id": 59232, "creation_time": "2016-03-24T10:20:14Z", "text": "There are valid usecases where one must have access to the context name without having access to the servlet context or servlet request. E.g., at Spring configuration time or at Logback configuration time. The name is used to construct the logging file name.\n\nExample: \n<configuration>\n  <!-- Add this -->\n  <insertFromJNDI env-entry-name=\"java:comp/env/logback/contextName\" as=\"contextName\" />\n  <contextName>${contextName}</contextName>\n\n  <appender name=\"FILE\"\n    class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n    <!-- Use here -->\n    <file>${catalina.base}/logs/${CONTEXT_NAME}.log</file>\n    <rollingPolicy class=\"ch.qos.logback.core.rolling.TimeBasedRollingPolicy\">\n      <!-- or here -->\n      <fileNamePattern>${catalina.base}/logs/${CONTEXT_NAME}.log.%d.gz</fileNamePattern>\n      <maxHistory>30</maxHistory>\n    </rollingPolicy>\n    [\u2026]\n  </appender>\n\n  <root level=\"INFO\">\n    <appender-ref ref=\"FILE\" />\n  </root>\n[\u2026]\n</configuration>\n\nInitially, I wrote a listener (http://mo-tomcat-ext.sourceforge.net/xref/net/sf/michaelo/tomcat/extras/listeners/LogbackContextNameListener.html) for that which does it's job for Logback in Tomcat 6. Tomcat 7+ needs some refinements, different event type, parallel webapp version, nested context path, etc.\n\nI think, it is worthwhile having a generic approach to this and make it a listener ContextNameListener available in Tomcat 7+ directly. StandardContext, lines 6135+ has already some nice code how to properly convert all of this to a filesafe context name.\n\nI'd like to donate this code (https://sourceforge.net/p/mo-tomcat-ext/code/HEAD/tree/tags/1.1/src/main/java/net/sf/michaelo/tomcat/extras/listeners/LogbackContextNameListener.java?format=raw) to the project. It is already licensed under Apache License 2.0, and I am an ASF member happily contributing it."}, {"count": 1, "tags": [], "bug_id": 59232, "text": "I'd be happy to commit a patch along these lines with a few changes.\n\nRather than a logback specific solution, I'd prefer to see a more general solution along the following lines:\n- new StandardContext options \"addNameToJndi\"\n- locate it at java:comp/env/contextName", "id": 191186, "time": "2016-05-23T15:15:10Z", "creator": "markt@apache.org", "creation_time": "2016-05-23T15:15:10Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 59232, "text": "Hi (In reply to Mark Thomas from comment #1)\n> I'd be happy to commit a patch along these lines with a few changes.\n> \n> Rather than a logback specific solution, I'd prefer to see a more general\n> solution along the following lines:\n> - new StandardContext options \"addNameToJndi\"\n> - locate it at java:comp/env/contextName\n\nI am an sticking to Logback per se, this was just a real life example. In fact, I Am using the very same technique for Spring's beans.xml now.\n\nI am willing to provide a patch and I already have taken a look at StandardContext. The class is huge. I am not certain where to add best. startInternal() seems suitable. Probably somewhere between lines 5000 and 5145 by calling addApplicationParameter()?\n\nWhat about nested context path and parallel deployment? Shall we ignore them for now?\n\nThe attributes are fine are perfect.", "count": 2, "id": 191205, "time": "2016-05-23T21:06:31Z", "creator": "1983-01-06@gmx.net", "creation_time": "2016-05-23T21:06:31Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 59232, "is_private": false, "text": "(In reply to Mark Thomas from comment #1)\n> - new StandardContext options \"addNameToJndi\"\n\nWhy bother having an option for this? It's a one-time call to place a simple object into JNDI... why not do it unconditionally?", "id": 191298, "time": "2016-05-27T18:40:28Z", "creator": "chris@christopherschultz.net", "creation_time": "2016-05-27T18:40:28Z", "attachment_id": null}]
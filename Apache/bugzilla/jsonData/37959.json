[{"count": 0, "tags": [], "text": "If I try to search Ebay (using the little box at the upper right corner) through\nApache 2.2.0's proxy, I get a \"Bad Request\" error and the following line shows\nup in the error log:\n\n[Mon Dec 19 08:53:16 2005] [error] [client 127.0.0.1] Digest: uri mismatch -\n<//search/search.dll?from=R40&satitle=canon+ef+70-200> does not match\nrequest-uri\n<http://search.ebay.com//search/search.dll?from=R40&satitle=canon+ef+70-200>,\nreferer: http://www.ebay.com/\n[Mon Dec 19 09:16:36 2005] [error] [client 127.0.0.1] Digest: uri mismatch -\n<//search/search.dll?from=R40&satitle=canon+ef+70-200> does not match\nrequest-uri\n<http://search.ebay.com//search/search.dll?from=R40&satitle=canon+ef+70-200>,\nreferer: http://www.ebay.com/\n[Mon Dec 19 09:17:01 2005] [error] [client 127.0.0.1] Digest: uri mismatch -\n<//search/search.dll?from=R40&satitle=canon+ef+70-200> does not match\nrequest-uri\n<http://search.ebay.com//search/search.dll?from=R40&satitle=canon+ef+70-200>,\nreferer: http://www.ebay.com/", "is_private": false, "bug_id": 37959, "id": 83794, "time": "2005-12-19T18:28:33Z", "creator": "apache@bakerweb.biz", "creation_time": "2005-12-19T18:28:33Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 37959, "attachment_id": null, "id": 83797, "time": "2005-12-19T18:44:39Z", "creator": "chip@force-elite.com", "creation_time": "2005-12-19T18:44:39Z", "is_private": false, "text": "First question, are you using digest authentication?\n\nSecond, which browser?"}, {"count": 2, "tags": [], "text": "Consider adding:\n BrowserMatch \"MSIE\" AuthDigestEnableQueryStringHack=On\nTo your configuration.", "is_private": false, "bug_id": 37959, "id": 83798, "time": "2005-12-19T18:45:19Z", "creator": "chip@force-elite.com", "creation_time": "2005-12-19T18:45:19Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Yes, I am using digest authentication. I am using Firefox, and I already have\nthe query hack enabled.", "is_private": false, "id": 83799, "creator": "apache@bakerweb.biz", "time": "2005-12-19T18:51:20Z", "bug_id": 37959, "creation_time": "2005-12-19T18:51:20Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 37959, "text": "Here are the headers for the transaction:\n\n----------\nGET //search/search.dll?from=R40&satitle=canon+ef+70-200 HTTP/1.1\nHost: search.ebay.com\nUser-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv:1.9a1)\nGecko/20051219 Firefox/1.6a1\nAccept:\ntext/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\nAccept-Language: en-us,en;q=0.5\nAccept-Encoding: gzip,deflate\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\nKeep-Alive: 300\nProxy-Connection: keep-alive\nReferer: http://www.ebay.com/\nCookie: [REMOVED]\nProxy-Authorization: Digest [REMOVED]\n\nHTTP/1.x 400 Bad Request\nDate: Mon, 19 Dec 2005 18:06:58 GMT\nServer: Apache/2.2.0 (Win32) DAV/2 mod_ssl/2.2.0 OpenSSL/0.9.8a\nVary: accept-language,accept-charset,User-Agent\nAccept-Ranges: bytes\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\nContent-Language: en\n", "id": 83800, "time": "2005-12-19T19:12:44Z", "creator": "apache@bakerweb.biz", "creation_time": "2005-12-19T19:12:44Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "text": "Please post:\n\n1) the precise configuration being used\n2) a request trace without the relevant parts of the Proxy-Authorization header\nelided; remove the response=\"...\" field only if you must\n\nmod_auth_digest says that the request-URI received was:\n\n<http://search.ebay.com//search/search.dll?from=R40&satitle=canon+ef+70-200>,\n\nyet in your request trace, the request-URI was not an absoluteURI:\n\nGET //search/search.dll?from=R40&satitle=canon+ef+70-200 HTTP/1.1\n\nsomething is amiss here.  What is the browser really sending?", "is_private": false, "id": 83828, "creator": "jorton@redhat.com", "time": "2005-12-20T11:45:01Z", "bug_id": 37959, "creation_time": "2005-12-20T11:45:01Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 37959, "attachment_id": null, "id": 83848, "time": "2005-12-20T15:16:34Z", "creator": "apache@bakerweb.biz", "creation_time": "2005-12-20T15:16:34Z", "is_private": false, "text": "I'm not sure I know what you mean by \"precise configuration.\" I have Apache\n2.2.0 with proxy requests on and protected by digest authentication. That's it.\nThe relative URI is what the browser is sending. Those headers are a direct\nethereal capture of the traffic.\n\nThis is the entire conversation between the browser and the proxy. Nothing has\nbeen removed except for the cookie, user name, and realm. There is no missing\ncontent bodies or anything.\n\n====================\nGET //search/search.dll?from=R40&satitle=canon+ef+70-200 HTTP/1.1\nHost: search.ebay.com\nUser-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9a1)\nGecko/20051219 Firefox/1.6a1\nAccept:\ntext/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\nAccept-Language: en-us,en;q=0.5\nAccept-Encoding: gzip,deflate\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\nKeep-Alive: 300\nProxy-Connection: keep-alive\nReferer: http://www.ebay.com/\nCookie: [REMOVED]\nProxy-Authorization: Digest username=\"[USER]\", realm=\"[REALM]\",\nnonce=\"YOSSQlsIBAA=6a67edfc40e16f04043939b5ab5c4cabfb709e45\",\nuri=\"//search/search.dll?from=R40&satitle=canon+ef+70-200\", algorithm=MD5,\nresponse=\"5d51354aaf356f005561a4ec59cbeacb\", qop=auth, nc=0000003b,\ncnonce=\"e254120bbd066c67\"\n\nHTTP/1.x 400 Bad Request\nDate: Tue, 20 Dec 2005 14:13:57 GMT\nServer: Apache/2.2.0 (Win32) DAV/2 mod_ssl/2.2.0 OpenSSL/0.9.8a\nVary: accept-language,accept-charset,User-Agent\nAccept-Ranges: bytes\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\nContent-Language: en\n===================="}, {"count": 7, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "text": "OK.  I can reproduce this, it's something to do with the leading double slash in\nthe path. If you remove the double slash it works OK.", "id": 83852, "time": "2005-12-20T15:57:02Z", "bug_id": 37959, "creation_time": "2005-12-20T15:57:02Z", "attachment_id": null}, {"count": 8, "attachment_id": null, "bug_id": 37959, "is_private": false, "id": 83853, "time": "2005-12-20T16:09:02Z", "creator": "jorton@redhat.com", "creation_time": "2005-12-20T16:09:02Z", "tags": [], "text": "If the client is not sending an absoluteURI in the request-URI when using a\nproxy it is very broken, that is an RFC2616 MUST condition.  This is probably a\nFirefox 1.6a regression, it gets that much right in 1.5 at least for me; you\nshould file a bug against Firefox for that.\n\nIt should then also be sending the same absoluteURI in the digest-uri field of\nthe Proxy-Auth header, and if it did so this should work.  This probably\nrequires a separate bug against Firefox.\n\nAs it is, the URI parser will correctly treat:\n\n  //search/search.dll\n\nas a scheme-relative URI when comparing against the request-URI, hostinfo =\n\"search\", path = \"/search.dll\", etc; and then compare that against the\nabsoluteURI for the request.  There's not much that can be done about this on\nthe server side, it needs to be fixed client side.\n"}, {"count": 9, "tags": [], "creator": "nick@webthing.com", "is_private": false, "text": "(In reply to comment #6) \n \n> ==================== \n> GET //search/search.dll?from=R40&satitle=canon+ef+70-200 HTTP/1.1 \n \nThat is NOT a proxy request.  So there's something you haven't told us. \n \nBut bugzilla is not an appropriate forum in which to discuss it further. ", "id": 83855, "time": "2005-12-20T16:38:40Z", "bug_id": 37959, "creation_time": "2005-12-20T16:38:40Z", "attachment_id": null}, {"count": 10, "tags": [], "text": "> That is NOT a proxy request.  So there's something you haven't told us. \n\nYou are incorrect. There is not something I haven't told you. That is the\nrequest that the browser sent to the proxy. There's no conspiracy here.", "attachment_id": null, "id": 83856, "creator": "apache@bakerweb.biz", "time": "2005-12-20T16:42:32Z", "bug_id": 37959, "creation_time": "2005-12-20T16:42:32Z", "is_private": false}, {"count": 11, "attachment_id": null, "bug_id": 37959, "text": "\nIt looks to me as though the attempt to match the request uri value with the\nProxy-Authorization uri parameter value is flawed.  The log message says:\n\n[Mon Dec 19 08:53:16 2005] [error] [client 127.0.0.1] Digest: uri mismatch -\n<//search/search.dll?from=R40&satitle=canon+ef+70-200> does not match\nrequest-uri\n<http://search.ebay.com//search/search.dll?from=R40&satitle=canon+ef+70-200>,\nreferer: http://www.ebay.com/\n\nthe request-uri value above has been resolved by prepending the leading part\n'//search' with the fqdn (matching the Host header value) '//search.ebay.com',\nproducing different string.\n\nFirefox is clearly not constructing the request correctly because it used just\n'search' in the host part of the URL in the request line, but I don't see why a\nproxy would need to covert that value before comparing it for digest purposes.\n", "id": 91275, "time": "2006-07-13T15:29:02Z", "creator": "scott-apache@skrb.org", "creation_time": "2006-07-13T15:29:02Z", "tags": [], "is_private": false}, {"count": 12, "tags": [], "bug_id": 37959, "attachment_id": null, "id": 91279, "time": "2006-07-13T16:32:42Z", "creator": "jorton@redhat.com", "creation_time": "2006-07-13T16:32:42Z", "is_private": false, "text": "[added Scott to CC]\n\nThe request-uri logged in that error should be the raw, unparsed, unmanipulated\nRequest-URI as received in the request at the proxy."}]
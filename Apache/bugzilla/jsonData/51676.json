[{"count": 0, "tags": [], "bug_id": 51676, "text": "Created attachment 27403\nCorrupted file with comments\n\nI have a case where uncommenting the \"createCellComment()\" suddenly leads to the error message \"File error: data may have been lost\" when the file is opened in Excel 2010.\n\nThe code for adding comments is:\n\n\t    CreationHelper createHelper = cell.getSheet().getWorkbook().getCreationHelper();\n\t    Sheet sheet = cell.getSheet();\n\t    Drawing drawingPatriarch = drawingPatriarches.get(sheet);\n\t    if (drawingPatriarch == null) {\n\t        drawingPatriarch = sheet.createDrawingPatriarch();\n\t        drawingPatriarches.put(sheet, drawingPatriarch);\n\t    }\n\n\t\tClientAnchor anchor = createHelper.createClientAnchor();\n\t\tanchor.setCol1((short)4);\n\t\tanchor.setRow1(2);\n\t\tanchor.setCol2((short)10);\n\t\tanchor.setRow2(8);\n\t\tComment comment = drawingPatriarch.createCellComment(anchor);\n\t    comment.setString(createHelper.createRichTextString(text));\n\t    cell.setCellComment(comment);\n\n\nFunily it worked for a long time with the same code, but suddenly stopped working a few days ago with updated data.\n\nThis is similar to Bug 48803, but I think it may be different than this issue as it happens with different version and functionality involved.\n\nBug 50696 also talks about trouble with comments, but there it states that it happens when an existing file is changed, however here I am working on a new file each time.\n\nI will attach the file that works and the one that does not work. I can not easily extract a standalone testcase for this, let me know if you need one so I spend the time only if necessary.", "id": 148677, "time": "2011-08-18T11:19:24Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2011-08-18T11:19:24Z", "is_private": false, "attachment_id": 27403}, {"attachment_id": 27404, "tags": [], "creator": "dominik.stadler@gmx.at", "is_private": false, "count": 1, "id": 148678, "time": "2011-08-18T11:20:02Z", "bug_id": 51676, "creation_time": "2011-08-18T11:20:02Z", "text": "Created attachment 27404\nSame content without comments works fine"}, {"count": 2, "tags": [], "bug_id": 51676, "text": "FYI, the same thing happens when using POI 3.8 beta 3 with Excel 2007.", "id": 148764, "time": "2011-08-22T16:34:02Z", "creator": "bmckenzie@highlinefi.com", "creation_time": "2011-08-22T16:34:02Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 51676, "text": "Also, a previous version (3.5 beta 4) did not have this same issue.", "id": 148765, "time": "2011-08-22T16:36:12Z", "creator": "bmckenzie@highlinefi.com", "creation_time": "2011-08-22T16:36:12Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 51676, "text": "I just noticed another thing here: I have the application in use for half a year without this problem, but it did start to happen a few days ago without changes to the code. Therefore it seems that the latest Office Service Pack changed Excel so it runs additional checks which lead to the error now.", "count": 4, "id": 148774, "time": "2011-08-23T06:26:26Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2011-08-23T06:26:26Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "superrubiroyd@gmail.com", "is_private": false, "count": 5, "id": 161435, "time": "2012-08-15T20:21:18Z", "bug_id": 51676, "creation_time": "2012-08-15T20:21:18Z", "text": "This problem should be fixed in trunk.\n\nPlease try with a nightly build - see download links on http://poi.apache.org/\nor build yourself from SVN trunk, see http://poi.apache.org/subversion.html"}]
[{"count": 0, "tags": [], "text": "Seems to be an issue with requests coming in to fast for the filter and it \ncannot draw the frames properly or send the right information to the correct \nframe. \n\nWe found the same issue in TC 4.1.7 and 4.1.9\nWe were also using JRE 1.4.0_01\n\nHere is what I did to recreate/test the issue.  \n \n1. Found an example from Jakarta that uses frames.\n2. Decided on the admin pages (the admin site). \n3. Tested running on port 8080 without IIS\n\n--* Remember to add a user entry in the tomcat-users.xml file with the \"admin\"\n    role. Like the following:\n   <user username=\"admin\" password=\"admin\" roles=\"admin,manager\"/>\n\n4. Login to http://localhost:8080/admin \n   (using the user you added in tomcat-users.xml).\n\n\n5. on the index.jsp page press F5 rapidly to refresh the screen without \nallowing the page to complete refresh.  \n\nEverything works fine. Issue does not appear when accessing a \"Framed\" \napplication on TC using port 8080.\nThen...\n \n6. Setup Tomcat and IIS to use the ISAPI filter (isapi_redirector2.dll/coyote)\n--* Add an entry for the Tomcat Administrator App (For an example  \n    application) in workers2.properties\n\n7. Login to http://localhost/admin \n   \n\n8. on the index.jsp page press F5 rapidly to refresh the screen without \nallowing the page to complete refresh.  Within a few hit the FRAMES will be \nremoved and you will get a single instance of 1 of the pages (never the same \npage)...  \n\n9: Go back to port 8080 and everything is fine.  Something breaks between the \nISAPI filter and TOMCAT\n\nThe only error in the logs, that we see is:\nFound in jk2.log\n\nadmin/login.jsp;jsessionid=80D23B3999E9936ECEC2A7F72B5154C3 lb:lb\n[Thu Sep 05 16:43:19 2002] (debug ) [jk_isapi_plugin.c (325)]  HttpFilterProc \n[/admin/login.jsp;jsessionid=80D23B3999E9936ECEC2A7F72B5154C3] is a servlet \nurl - should redirect to lb:lb\n[Thu Sep 05 16:43:19 2002] (debug ) [jk_isapi_plugin.c (392)]  HttpFilterProc \ncheck if [/admin/login.jsp;jsessionid=80D23B3999E9936ECEC2A7F72B5154C3] is \npointing to the web-inf directory\n[Thu Sep 05 16:43:19 2002] (debug ) [jk_isapi_plugin.c (461)]  \nHttpExtensionProc started\n[Thu Sep 05 16:43:19 2002] (debug ) [jk_isapi_plugin.c (467)]  \nHttpExtensionProc got a worker for name lb:lb\n[Thu Sep 05 16:43:19 2002] (error ) [jk_worker_ajp13.c (339)]  ajp13.service() \nerror sending, reconnect channel.socket:localhost:8009 -1 0 No error\n\n\n\nAlmost looks like a threading issue.  Could it be that the ISAPI filter does \nnot know that the request is a FRAME and is sending back the request as soon as \nit gets one of the pages back? \n\nThis issue CANNOT be recreated in a non-Framed site\n\n\nIf more information is needed, please contact me at robert.priest@bentley.com", "attachment_id": null, "bug_id": 12346, "id": 22335, "time": "2002-09-05T21:10:13Z", "creator": "robert.priest@bentley.com", "creation_time": "2002-09-05T21:10:13Z", "is_private": false}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "A frame is a client request (ie, it's a HTML page, which then will cause the\nclient to issue simultaneous requests to other resources). If this cannot be\nreproduced without a frameset, then your bug report have issues. You *need* to\nbe able to reproduce the problem when using some kind of load, otherwise this is\ninvalid.\n\nThe problem, if it is real, may come from the C side. If you are using mod_jk2,\ntry with mod_jk1 (and vice versa). mod_jk2 is roughly beta quality at this point.", "id": 22352, "time": "2002-09-06T08:15:39Z", "bug_id": 12346, "creation_time": "2002-09-06T08:15:39Z", "is_private": false}, {"count": 2, "tags": [], "creator": "robert.priest@bentley.com", "attachment_id": null, "text": "We conducted a few more tests on a w2k server.\nWe used ab.exe (bundled with Apache2) for testing. \nThese results support our previous claims\nA collegue of mine and Ignacio were involved in these tests. \n\nTests 1 and 2 show a significant amount of failed requests when using the isapi \nfilter. Test 3 demonstrates that no errors occur if the isapi filter is not \nused. Test 3 uses port 8080 to exclude the filter.\n\n\nTest 1: \n - url=http://localhost/examples/jsp/index.html\n - machine w2k server/IIS 5.0\n\n------\nServer Software:        Microsoft-IIS/5.0\nServer Hostname:        localhost\nServer Port:            80\n\nDocument Path:          /examples/jsp/index.html\nDocument Length:        7487 bytes\n\nConcurrency Level:      1000\nTime taken for tests:   3.835516 seconds\nComplete requests:      1000\nFailed requests:        62\n   (Connect: 0, Length: 62, Exceptions: 0)\nWrite errors:           0\n\nTest 2:\n- url=http://localhost/examples/jsp/index.html\n- machine w2k server/IIS 5.0\n\n-------- \nServer Software:        Microsoft-IIS/5.0\nServer Hostname:        localhost\nServer Port:            80\n\nDocument Path:          /examples/jsp/index.html\nDocument Length:        1231 bytes\n\nConcurrency Level:      10000\nTime taken for tests:   3.605184 seconds\nComplete requests:      1000\nFailed requests:        999\n   (Connect: 0, Length: 999, Exceptions: 0)\nWrite errors:           0\nTotal transfe\n---------\nTest 3:\n- url=http://localhost:8080/examples/jsp/index.html\n- machine w2k server\n-------- \nServer Software:        Apache\nServer Hostname:        localhost\nServer Port:            8080\n\nDocument Path:          /examples/jsp/index.html\nDocument Length:        7487 bytes\n\nConcurrency Level:      1000\nTime taken for tests:   2.723917 seconds\nComplete requests:      1000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      7712000 bytes\nHTML transferred:       7487000\n\n\n\n", "id": 22376, "time": "2002-09-06T17:24:34Z", "bug_id": 12346, "creation_time": "2002-09-06T17:24:34Z", "is_private": false}, {"count": 3, "tags": [], "text": "I've seen this in my setup, with w2k professional using ab -c10 -n1000  for the \nsame url (http://localhost/examples/jsp/index.html) \n\nServer Software:        Microsoft-IIS/5.0\nServer Hostname:        localhost\nServer Port:            80\n\nDocument Path:          /examples/jsp/index.html\nDocument Length:        7487 bytes\n\nConcurrency Level:      10\nTime taken for tests:   112.531250 seconds\nComplete requests:      1000\nFailed requests:        3\n   (Connect: 0, Length: 3, Exceptions: 0)\nWrite errors:           0\nTotal transferred:      7667927 bytes\nHTML transferred:       7464539 bytes\nRequests per second:    8.89 [#/sec] (mean)\nTime per request:       1125.313 [ms] (mean)\nTime per request:       112.531 [ms] (mean, across all concurrent requests)\nTransfer rate:          66.54 [Kbytes/sec] received\n\n\n3 length failures...", "attachment_id": null, "id": 22381, "creator": "nacho@apache.org", "time": "2002-09-06T17:46:01Z", "bug_id": 12346, "creation_time": "2002-09-06T17:46:01Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 12346, "text": "Length failures are normally associated with the various dynamic data on the\npage, for instance jsessionid encoded within the page, JSESSIONID cookie or\nsimilar. ab normally expects all requests to result in the same length\nresponses, but it is unreasonable to expect that when pages are coming from Tomcat.\n\nOne way to check is to increase the verbosity and then read what's actually\ncoming back. Painful but helpful :-)\n\nBojan", "id": 22400, "time": "2002-09-07T02:32:34Z", "creator": "bojan@rexursive.com", "creation_time": "2002-09-07T02:32:34Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "nacho@apache.org", "attachment_id": null, "text": "Thanks Bojan for the comment, but this test was done against static html inside \ntc4.1.. Mladen suspects from the socket reuse code.. ", "id": 23215, "time": "2002-09-21T20:55:08Z", "bug_id": 12346, "creation_time": "2002-09-21T20:55:08Z", "is_private": false}, {"count": 6, "tags": [], "creator": "cmanolache@yahoo.com", "attachment_id": null, "text": "I've seen this before - most likely related to socket reuse or\nprotocol ( ajp13 ) framing errors. I'll try to reproduce it ( need to\nfind a win machine first ). Does it happens on unix as well ? ( it should, the\najp code is identical ) ", "id": 23243, "time": "2002-09-23T11:35:24Z", "bug_id": 12346, "creation_time": "2002-09-23T11:35:24Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 12346, "text": "We also have this bug. Our environment is W2K, IIS 5, JK 2, Tomcat 4.1.12\n\nOur application has one group of pages that use quite a few nested pages. It all\ngoes haywire after a while. I have tried increasing all the parameters in the\nconnector section of server.xml by an order of magnitude to no avail.\n\nIf anyone is working on this I will happily run a version of the code in a\ndebugging mode and report back as I can easily get the failure at the moment.\nHowever, I have zero C skills and no C compiler.\n\nThanks\n\nDave", "id": 23868, "time": "2002-10-03T22:09:56Z", "creator": "david@sundayta.com", "creation_time": "2002-10-03T22:09:56Z", "is_private": false, "attachment_id": null}, {"count": 8, "attachment_id": null, "bug_id": 12346, "text": "Mark as fixed. Latest CVS should have the fix.", "id": 23974, "time": "2002-10-04T23:22:47Z", "creator": "cmanolache@yahoo.com", "creation_time": "2002-10-04T23:22:47Z", "tags": [], "is_private": false}]
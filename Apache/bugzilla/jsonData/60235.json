[{"count": 0, "tags": [], "bug_id": 60235, "attachment_id": null, "id": 194313, "time": "2016-10-10T15:55:30Z", "creator": "asfbz@pnash.me.uk", "creation_time": "2016-10-10T15:55:30Z", "is_private": false, "text": "XSSF sheet with worksheet function whose arguments are overlapping intersecting ranges, for example =SUM(B3:C3 C3:C4), generates a FormulaParseException from the following code (stack trace below).\n\n    FileInputStream fileIn = new FileInputStream(new File(\"intersect.xlsx\"));\n    Workbook wb = WorkbookFactory.create(fileIn);\n    fileIn.close();\n\n    FormulaEvaluator eval = wb.getCreationHelper().createFormulaEvaluator();\n    eval.evaluateAll();\n\nSpeculation: A Possible Fix: In FormulaParser, in Arguments() method, replace call to temp.add(comparisonExpression()); with temp.add(intersectionExpression()); instead. This appears to fix it for me!\n\n-------------------------------------------------------\n\nException in thread \"main\" org.apache.poi.ss.formula.FormulaParseException: Parse error near char 10 'C' in specified formula 'SUM(B3:C3 C3:C4)'. Expected ',' or ')'\n\tat org.apache.poi.ss.formula.FormulaParser.expected(FormulaParser.java:262)\n\tat org.apache.poi.ss.formula.FormulaParser.Arguments(FormulaParser.java:1444)\n\tat org.apache.poi.ss.formula.FormulaParser.function(FormulaParser.java:1316)\n\tat org.apache.poi.ss.formula.FormulaParser.parseNonRange(FormulaParser.java:884)\n\tat org.apache.poi.ss.formula.FormulaParser.parseRangeable(FormulaParser.java:575)\n\tat org.apache.poi.ss.formula.FormulaParser.parseRangeExpression(FormulaParser.java:311)\n\tat org.apache.poi.ss.formula.FormulaParser.parseSimpleFactor(FormulaParser.java:1509)\n\tat org.apache.poi.ss.formula.FormulaParser.percentFactor(FormulaParser.java:1467)\n\tat org.apache.poi.ss.formula.FormulaParser.powerFactor(FormulaParser.java:1454)\n\tat org.apache.poi.ss.formula.FormulaParser.Term(FormulaParser.java:1827)\n\tat org.apache.poi.ss.formula.FormulaParser.additiveExpression(FormulaParser.java:1955)\n\tat org.apache.poi.ss.formula.FormulaParser.concatExpression(FormulaParser.java:1939)\n\tat org.apache.poi.ss.formula.FormulaParser.comparisonExpression(FormulaParser.java:1896)\n\tat org.apache.poi.ss.formula.FormulaParser.intersectionExpression(FormulaParser.java:1869)\n\tat org.apache.poi.ss.formula.FormulaParser.unionExpression(FormulaParser.java:1849)\n\tat org.apache.poi.ss.formula.FormulaParser.parse(FormulaParser.java:1997)\n\tat org.apache.poi.ss.formula.FormulaParser.parse(FormulaParser.java:170)\n\tat org.apache.poi.xssf.usermodel.XSSFEvaluationWorkbook.getFormulaTokens(XSSFEvaluationWorkbook.java:85)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:315)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:259)\n\tat org.apache.poi.xssf.usermodel.BaseXSSFFormulaEvaluator.evaluateFormulaCellValue(BaseXSSFFormulaEvaluator.java:65)\n\tat org.apache.poi.ss.formula.BaseFormulaEvaluator.evaluateFormulaCellEnum(BaseFormulaEvaluator.java:193)\n\tat org.apache.poi.ss.formula.BaseFormulaEvaluator.evaluateAllFormulaCells(BaseFormulaEvaluator.java:268)\n\tat org.apache.poi.xssf.usermodel.XSSFFormulaEvaluator.evaluateAll(XSSFFormulaEvaluator.java:92)\n\tat poi.POIDemo.main(POIDemo.java:20)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:483)\n\tat com.intellij.rt.execution.application.AppMain.main(AppMain.java:144)"}, {"attachment_id": null, "tags": [], "bug_id": 60235, "text": "Can you attach a sample file that allows to reproduce this? \n\nOr provide self-contained a unit-test which reproduces this?", "count": 1, "id": 194330, "time": "2016-10-11T14:37:22Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-10-11T14:37:22Z", "is_private": false}, {"count": 2, "tags": [], "creator": "asfbz@pnash.me.uk", "text": "Created attachment 34358\nsheet to reproduce bug 60235", "id": 194331, "time": "2016-10-11T15:25:21Z", "bug_id": 60235, "creation_time": "2016-10-11T15:25:21Z", "is_private": false, "attachment_id": 34358}, {"count": 3, "text": "This test could also be added to http://svn.apache.org/viewvc/poi/trunk/test-data/spreadsheet/FormulaEvalTestData.xls?view=log and http://svn.apache.org/viewvc/poi/trunk/test-data/spreadsheet/FormulaEvalTestData_Copy.xlsx?view=log", "bug_id": 60235, "is_private": false, "id": 194334, "time": "2016-10-11T16:17:53Z", "creator": "onealj@apache.org", "creation_time": "2016-10-11T16:17:53Z", "tags": [], "attachment_id": null}]
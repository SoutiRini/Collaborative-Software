[{"count": 0, "tags": [], "text": "------------------ cut here: test.cgi\n#!/bin/bash\necho \"Content-type: text/html\"\necho \"\"\necho \"in cgi\"\n------------------ cut here: static.html\nin static\n------------------ cut here: doesnt_works.html\n<!--#set var=\"xxx\" value=\"&#1078;&#1086;&#1087;&#1072;\" -->\nvariable content: <!--#echo var=\"xxx\" -->\n<hr>\ntrying to include cgi:\n<!--#include virtual=\"/cgi-bin/test.cgi\" -->\n<hr>\ntrying to include static:\n<!--#include virtual=\"static.html\" -->\n------------------ cut here: works.html\n<!--#set var=\"xxx\" value=\"jopa\" -->\nvariable content: <!--#echo var=\"xxx\" -->\n<hr>\ntrying to include cgi:\n<!--#include virtual=\"/cgi-bin/test.cgi\" -->\n<hr>\ntrying to include static:\n<!--#include virtual=\"static.html\" -->\n------------------ cut here: result with doesnt_works.html\nvariable content: &#1078;&#1086;&#1087;&#1072; \ntrying to include cgi: [an error occurred while processing this directive] \ntrying to include static: in static\n------------------ cut here: result with works.html\nvariable content: jopa \ntrying to include cgi: in cgi \ntrying to include static: in static\n------------------\nAs you can see difference is only non-latin1 characters in value of variable.\nThat is pretty bizzare.\nPlease dont tell me that using bash or cgi is bad/illegal/crazy/etc.\nPlease dont tell me that legacy codepages sux because it sux to write russian\nlanguage website for russians in &$XYZ;\nThis problem i observed on all apache 2 versions i saw.\n------------------ cut here: error_log\n(22)Invalid argument: utf8 to ucs2 conversion failed on this string:\nxxx=\\xe6\\xee\\xef\\xe0\n(22)Invalid argument: couldn't create child process: 22: test.cgi, referer:\ndoesnt_works.html\n(22)Invalid argument: couldn't spawn child process: D:/WWW/cgi/test.cgi,\nreferer: doesnt_works.html\nmod_include: Options +Includes (or IncludesNoExec) wasn't set, INCLUDES filter\nremoved, referer: doesnt_works.html\nunable to include \"/cgi-bin/test.cgi\" in parsed file\nD:/WWW/bug/doesnt_works.html, referer: doesnt_works.html\n------------------ cut here: apache -V\nServer version: Apache/2.0.55\nServer built:   Oct  9 2005 19:16:56\nServer's Module Magic Number: 20020903:11\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/winnt\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/apache\"\n -D SUEXEC_BIN=\"/apache/bin/suexec\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error.log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"", "is_private": false, "bug_id": 39105, "id": 87266, "time": "2006-03-25T19:48:59Z", "creator": "unr303@mail.ru", "creation_time": "2006-03-25T19:48:59Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "unr303@mail.ru", "attachment_id": 17981, "id": 87267, "time": "2006-03-25T19:52:13Z", "bug_id": 39105, "creation_time": "2006-03-25T19:52:13Z", "is_private": false, "text": "Created attachment 17981\ntest case with original letters (non &#XYZ;)"}, {"count": 2, "tags": [], "bug_id": 39105, "attachment_id": null, "id": 87269, "time": "2006-03-25T21:11:45Z", "creator": "nick@webthing.com", "creation_time": "2006-03-25T21:11:45Z", "is_private": false, "text": "Erm, your example uses /bin/bash, and looks unlikely to be tied to any \noperating system.  Why did you mark it \"windows 2000\"?  Are you using cygwin \nor other *X layer? "}, {"count": 3, "tags": [], "bug_id": 39105, "attachment_id": null, "id": 87274, "time": "2006-03-26T12:08:34Z", "creator": "rpluem@apache.org", "creation_time": "2006-03-26T12:08:34Z", "is_private": false, "text": "You guess you must encode your russian special characters as UTF-8 as httpd\nexpects the environment variables UTF-8 encoded. Using the windows notepad might\nbe an option as you can save files that you created in your local encoding as\nUTF8 files."}, {"count": 4, "tags": [], "text": "(In reply to comment #3)\n\n> expects the environment variables UTF-8 encoded. Using the windows notepad might\n\nThis was not exact: On Windows httpd expects the environment variables to be\nUTF-8 encoded.\nSo please save your attached file via notepad as UTF-8 file an try again.\n\n", "is_private": false, "bug_id": 39105, "id": 87276, "time": "2006-03-26T12:12:02Z", "creator": "rpluem@apache.org", "creation_time": "2006-03-26T12:12:02Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "unr303@mail.ru", "attachment_id": 17984, "is_private": false, "id": 87280, "time": "2006-03-26T13:30:57Z", "bug_id": 39105, "creation_time": "2006-03-26T13:30:57Z", "text": "Created attachment 17984\ntest case in utf8\n\nWriting file in unicode solves problem but one cant mix unicode and other\n1-byte charsets in file. And koi8-r and cp1251 are main charsets for russian\ninternet while uniode in uncommon.\nThere is nothing in\nhttp://httpd.apache.org/docs/2.0/env.html\nhttp://httpd.apache.org/docs/2.0/howto/ssi.html\nhttp://httpd.apache.org/docs/2.0/mod/mod_include.html\nabout utf8.\nEven if we close eyes on charsets and so then there is still strange behaviour\nof apache:\n- why httpd can include static html files while there are non latin1 symbols in\nnon utf8 in variables?\n- why httpd can successfully assign and print these variables?\n- why httpd talks about \"mod_include: Options +Includes (or IncludesNoExec)\nwasn't set, INCLUDES filter removed, referer: doesnt_works.html\" in log file?\ndoes it removes filter when it find attempt to include cgi while there are non\nlatin1 characters in non utf8 in enviroment variables?\n- why this happens in windows only? :) (at least in linux it does works with\nvariables in any charset)\n\nPS: it is nothing related to bash, same problem is with python also. httpd\ndoesnt even start cgi - that you can see by creating some file in that cgi so\nyou will see that no file will be created."}, {"count": 6, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 87283, "time": "2006-03-26T15:55:19Z", "bug_id": 39105, "creation_time": "2006-03-26T15:55:19Z", "is_private": false, "text": "(In reply to comment #5)\n> Created an attachment (id=17984) [edit]\n> test case in utf8\n> \n> Writing file in unicode solves problem but one cant mix unicode and other\n\nOk. At least my thoughs have been correct.\n\n> 1-byte charsets in file. And koi8-r and cp1251 are main charsets for russian\n> internet while uniode in uncommon.\n> There is nothing in\n> http://httpd.apache.org/docs/2.0/env.html\n> http://httpd.apache.org/docs/2.0/howto/ssi.html\n> http://httpd.apache.org/docs/2.0/mod/mod_include.html\n> about utf8.\n\nActually it would have to be in the documentation of mod_cgi. But I admit that\nit is not mentioned there.\n\n> Even if we close eyes on charsets and so then there is still strange behaviour\n> of apache:\n> - why httpd can include static html files while there are non latin1 symbols in\n> non utf8 in variables?\n> - why httpd can successfully assign and print these variables?\n> - why httpd talks about \"mod_include: Options +Includes (or IncludesNoExec)\n> wasn't set, INCLUDES filter removed, referer: doesnt_works.html\" in log file?\n> does it removes filter when it find attempt to include cgi while there are non\n> latin1 characters in non utf8 in enviroment variables?\n> - why this happens in windows only? :) (at least in linux it does works with\n> variables in any charset)\n\nThis is because you try to execute an cgi script. The variables set via\nmod_include get exported to the environment of the cgi script to be run by\nmod_cgi. On Windows the values of these environment variables are expected to be\nUTF-8 encoded and they will be reencoded to UCS2 before executing the script. As\nthis fails several error messages get written to the log file. I admit that they\nare confusing. The only relevant one is the first:\n\n(22)Invalid argument: utf8 to ucs2 conversion failed on this string:\nxxx=\\xe6\\xee\\xef\\xe0\n\nThe others get created up in the call stack, because apr_conv_utf8_to_ucs2\ncalled by apr_proc_create failed to convert the environment variables. This\ncauses apr_proc_create to fail and so on.\n\n> \n> PS: it is nothing related to bash, same problem is with python also. httpd\n> doesnt even start cgi - that you can see by creating some file in that cgi so\n> you will see that no file will be created.\n\nAbsolutely\n"}, {"count": 7, "tags": [], "bug_id": 39105, "attachment_id": null, "text": "(In reply to comment #5) \n \n> PS: it is nothing related to bash, same problem is with python also. httpd \n> doesnt even start cgi - that you can see by creating some file in that cgi \nso \n> you will see that no file will be created. \n \nYes, my question was because you'd said windows, but using bash under that \nseemed incongruous. \n \nThis could be fixed by making failure to encode a CGI variable a nonfatal \nerror.  Not sure how best to do that: it may have security implications \nthat'll need thinking through. ", "id": 87284, "time": "2006-03-26T16:22:08Z", "creator": "nick@webthing.com", "creation_time": "2006-03-26T16:22:08Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 39105, "attachment_id": null, "text": "Changing product to APR since this is a problem of apr_proc_create on Windows", "id": 87286, "time": "2006-03-26T18:39:57Z", "creator": "rpluem@apache.org", "creation_time": "2006-03-26T18:39:57Z", "is_private": false}, {"count": 9, "tags": [], "text": "Mass reassign the 44 open apr-bugs to apr bug list", "is_private": false, "bug_id": 39105, "id": 93827, "time": "2006-09-19T19:54:35Z", "creator": "wrowe@apache.org", "creation_time": "2006-09-19T19:54:35Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 39105, "attachment_id": null, "id": 96749, "creation_time": "2006-12-11T06:42:26Z", "time": "2006-12-11T06:42:26Z", "creator": "jorton@redhat.com", "text": "This looks like the same issue as ye olde bug 13029 - if someone wants to\nauthoritatively state that this needs to be fixed in APR not httpd, please go ahead.\n\n*** This bug has been marked as a duplicate of 13029 ***", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 54803, "text": "I seem to be running into a bug when I open a XLSX file (created in LibreOffice), add a drawing, and reopen the file.\n\nI've been able to recreate how the bug occurs, and here is a snippet of the code that causes the bug:\n\nFileInputStream file = new FileInputStream(\"file.xlsx\");\nXSSFWorkbook workbook = (XSSFWorkbook)WorkbookFactory.create(file);\nfile.close();\n\t\t\nXSSFSheet sheet = workbook.getSheetAt(0);\n\t\t\nXSSFDrawing drawing = sheet.createDrawingPatriarch();\n\t\t\nFileOutputStream fos = new FileOutputStream(\"newfile.xlsx\");\n\t\t\nworkbook.write(fos);\nfos.close();\n\t\t\ntry {\n\tWorkbookFactory.create(new FileInputStream(\"newfile.xlsx\"));\n\tSystem.out.println(\"Sucessful re-reading\");\n} catch (Exception e) {\n\te.printStackTrace();\n\tSystem.out.println(\"Error re - reading spreadsheet\" + e.getMessage());\n}\n\nThis is the exception that is caught:\n\norg.apache.poi.openxml4j.exceptions.InvalidFormatException: The part /xl/worksheets/_rels/sheet1.xml.rels does not have any content type ! Rule: Package require content types when retrieving a part from a package. [M.1.14]\n\n\tat org.apache.poi.openxml4j.opc.ZipPackage.getPartsImpl(ZipPackage.java:224)\n\tat org.apache.poi.openxml4j.opc.OPCPackage.getParts(OPCPackage.java:662)\n\tat org.apache.poi.openxml4j.opc.OPCPackage.open(OPCPackage.java:269)\n\tat org.apache.poi.ss.usermodel.WorkbookFactory.create(WorkbookFactory.java:73)", "id": 166406, "time": "2013-04-05T03:30:35Z", "creator": "jpmaglutac@gmail.com", "creation_time": "2013-04-05T03:30:35Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "text": "I tried this with a small sample input file, but could not reproduce the problem. \n\nCan you attach the test-input file that you are using?", "id": 167417, "time": "2013-05-25T16:00:53Z", "bug_id": 54803, "creation_time": "2013-05-25T16:00:53Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 54803, "text": "Created attachment 30338\nSample Input", "id": 167468, "time": "2013-05-29T03:10:37Z", "creator": "jpmaglutac@gmail.com", "creation_time": "2013-05-29T03:10:37Z", "is_private": false, "attachment_id": 30338}, {"attachment_id": null, "tags": [], "creator": "jpmaglutac@gmail.com", "text": "Attached a sample input that produces the bug on my machine", "count": 3, "id": 167469, "time": "2013-05-29T03:15:12Z", "bug_id": 54803, "creation_time": "2013-05-29T03:15:12Z", "is_private": false}, {"count": 4, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "text": "Thanks, that reproduces the bug nicely, however I took a look and I myself (currently) lack the knowledge with POI to dig into this further, hopefully somebody else can step in...", "id": 167511, "time": "2013-05-30T15:35:25Z", "bug_id": 54803, "creation_time": "2013-05-30T15:35:25Z", "is_private": false}]
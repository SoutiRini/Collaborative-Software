[{"count": 0, "tags": [], "bug_id": 8024, "text": "Entities with relative paths are not resolved in the web.xml. I.e.\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<!DOCTYPE web-app\n  PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n  \"http://java.sun.com/j2ee/dtds/web-app_2_3.dtd\"\n[\n<!ENTITY webinc PUBLIC \"webinc\" \"webinc.xml\">\n]\n>\n<web-app>\n &webinc;\n\nfails with \n\nException initializing TldLocationsCache: XML parsing error on file /WEB-\nINF/web.xml: (line 6, col -1): Relative URI \"webinc.xml\"; can not be resolved \nwithout a base URI.\n\nThe reason for this is that Digester.parse(File) is called in \no.a.c.startup.Catalina - this method does not set the system id of the \nInputSource, so relative paths can't be resolved.\n\nI suggest using Digester.parse(InputSource) where you'd set *BOTH* the stream \n*AND* the system ID (in form of \"file://\" + file.getAbsolutePath()) properties \nof the input source to solve the problem.", "id": 13394, "time": "2002-04-12T16:10:45Z", "creator": "szegedia@freemail.hu", "creation_time": "2002-04-12T16:10:45Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "szegedia@freemail.hu", "text": "Created attachment 1599\nThe patch that fixes the bug", "id": 13770, "time": "2002-04-16T14:35:16Z", "bug_id": 8024, "creation_time": "2002-04-16T14:35:16Z", "is_private": false, "attachment_id": 1599}, {"attachment_id": 1600, "tags": [], "bug_id": 8024, "text": "Created attachment 1600\nA *more correct* fix to the bug... ignore the previous, this is the right one.", "count": 2, "id": 13772, "time": "2002-04-16T14:37:11Z", "creator": "szegedia@freemail.hu", "creation_time": "2002-04-16T14:37:11Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 8024, "text": "The proposed patch only covers the parsing of the \"conf/server.xml\" file, so I\nextended this for the places in o.a.c.startup.ContextConfig that \"web.xml\" files\nare parsed as well.  This still doesn't cover TLDs (which are parsed in\nContextConfig to register listeners, and parsed in Jasper as part of\ncompilation), but I suspect the need for external entities in TLDs is a lot less\ncommon.\n\nFixed in nightly build 20020423.  Thanks for the patch!\n", "count": 3, "id": 14351, "time": "2002-04-22T19:05:44Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2002-04-22T19:05:44Z", "is_private": false}, {"count": 4, "tags": [], "text": "Having thought more about this, there's a better patch: rewriting the \nDigester.parse(File) method to use an input source with systemId set. That way, \nyou wouldn't have to hunt down all usages of it in the Tomcat code, not to \nspeak about the fact that other projects using the Digester would also benefit \ninstantly from the patch.", "is_private": false, "id": 14402, "creator": "szegedia@freemail.hu", "time": "2002-04-23T07:26:48Z", "bug_id": 8024, "creation_time": "2002-04-23T07:26:48Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Digester.parse() is an overloaded method -- you've got the choice to call it\nwith a File, an InputSource, an InputStream, a Reader, or a String (containing a\nURL).  In the InputStream or Reader cases, there is no way for Digester to\nderive what the appropriate System ID should have been, so constructing an\nInputSource around it will not help.\n\nSo, I modified Tomcat (which was using the InputStream argument) to calculate\nthe appropriate InputSource first, because it knows where the server.xml or\nweb.xml file is coming from so that it can calculate  a useful URL. \nInterestingly, it even works when web.xml is inside an unpacked WAR file,\nbecause the rules for resolving a relative URL against an absolute one still\nwork fine.\n", "is_private": false, "id": 14459, "creator": "craig.mcclanahan@sun.com", "time": "2002-04-23T15:27:01Z", "bug_id": 8024, "creation_time": "2002-04-23T15:27:01Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "szegedia@freemail.hu", "is_private": false, "text": "You are right, however I was talking about enhancing the Digester.parse(File) \nmethod. I have now submitted this as a separate Bug 8461 reported against the \nCommons/Digester/Nightly Build, together with a patch.\n", "id": 14617, "time": "2002-04-24T12:18:54Z", "bug_id": 8024, "creation_time": "2002-04-24T12:18:54Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "dmkarr@earthlink.net", "is_private": false, "text": "(Is there an easy way to tell exactly what changes went into a fix for a bug? I\ndon't see any way to do that, unless the fix comment informally states what was\nchanged.)\n\nAs I've built tomcat-4.0 from the latest CVS, I would expect I'm getting the\nrequired fix for this.  Unfortunately, it appears to have had no effect.\n\nWhen I precompile my JSP pages, it still complains about the file reference.\n\nIf I use this:\n\n<!ENTITY webinc PUBLIC \"webinc\" \"file:./webinc.xml\">\n\nI get:\n\nXML parsing error on file /WEB-INF/web.xml: java.io.FileNotFoundException:\n.\\webinc.xml (The system cannot find the file specified)\n\nI I use this:\n\nXML parsing error on file /WEB-INF/web.xml: (line 6, col -1): Relative URI\n\"webinc.xml\"; can not be resolved without a base URI.\n\nI've also tried \"./webinc.xml\" and \"file:webinc.xml\", but both give the previous\nerror.", "id": 15194, "time": "2002-04-30T21:00:55Z", "bug_id": 8024, "creation_time": "2002-04-30T21:00:55Z", "attachment_id": null}]
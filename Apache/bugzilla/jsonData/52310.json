[{"count": 0, "tags": [], "bug_id": 52310, "is_private": false, "text": "Created attachment 28057\nTest plan to reproduce the issue\n\nMy test plan using IP aliasing.\n\nIf a http request use \"Embedded Ressources\" and \"Concurrent Pool Size\" with IP Source defined as a variable, the sample failed with the following stack : \n\njava.net.UnknownHostException: ${IP_ADDR}\n        at java.net.Inet4AddressImpl.lookupAllHostAddr(Native Method)\n        at java.net.InetAddress$1.lookupAllHostAddr(InetAddress.java:849)\n        at java.net.InetAddress.getAddressFromNameService(InetAddress.java:\n1200)\n        at java.net.InetAddress.getAllByName0(InetAddress.java:1153)\n        at java.net.InetAddress.getAllByName(InetAddress.java:1083)\n        at java.net.InetAddress.getAllByName(InetAddress.java:1019)\n        at java.net.InetAddress.getByName(InetAddress.java:969)\n        at\norg.apache.jmeter.protocol.http.sampler.HTTPHC3Impl.setupConnection(HTTPHC3Impl.java:\n419)\n        at\norg.apache.jmeter.protocol.http.sampler.HTTPHC3Impl.sample(HTTPHC3Impl.java:\n237)\n        at\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:\n62)\n        at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase\n$ASyncSample.call(HTTPSamplerBase.java:1708)\n        at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase\n$ASyncSample.call(HTTPSamplerBase.java:1693)\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:138)\n        at java.util.concurrent.ThreadPoolExecutor\n$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor\n$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:619)", "id": 152094, "time": "2011-12-09T11:19:00Z", "creator": "patches@portaildulibre.fr", "creation_time": "2011-12-09T11:19:00Z", "attachment_id": 28057}, {"count": 1, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "is_private": false, "id": 152107, "time": "2011-12-09T21:06:59Z", "bug_id": 52310, "creation_time": "2011-12-09T21:06:59Z", "text": "Also on trunk"}, {"count": 2, "tags": [], "bug_id": 52310, "text": "The issue is due to the fact the property is cached in JMeterContext which is  thread local in Parent thread of Parallel Download threads.\nQuick fix would be to make ThreadLocal InheritableThreadLocal but as JMeterContext is not thread-safe it is not the right fix.\n\nCould Making JMeterContext cloneable a solution ? otherwise implement what sebb proposed on dev list to notify Executor threads of start/end.", "id": 152108, "time": "2011-12-09T21:44:31Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-12-09T21:44:31Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "is_private": false, "id": 152111, "time": "2011-12-10T01:00:19Z", "bug_id": 52310, "creation_time": "2011-12-10T01:00:19Z", "text": "(In reply to comment #2)\n> The issue is due to the fact the property is cached in JMeterContext which is \n> thread local in Parent thread of Parallel Download threads.\n> Quick fix would be to make ThreadLocal InheritableThreadLocal but as\n> JMeterContext is not thread-safe it is not the right fix.\n\nIf the context is not mutated, then it should be OK to share."}, {"count": 4, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "is_private": false, "id": 152112, "time": "2011-12-10T10:41:45Z", "bug_id": 52310, "creation_time": "2011-12-10T10:41:45Z", "text": "Date: Sat Dec 10 10:40:18 2011\nNew Revision: 1212764\n\nURL: http://svn.apache.org/viewvc?rev=1212764&view=rev\nLog:\nBug 52310 - variable in IPSource failed HTTP request if \"Concurrent Pool Size\" is enabled\n\nModified:\n   jmeter/trunk/src/core/org/apache/jmeter/threads/JMeterContextService.java\n   jmeter/trunk/xdocs/changes.xml"}, {"count": 5, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "is_private": false, "id": 152113, "time": "2011-12-10T12:43:42Z", "bug_id": 52310, "creation_time": "2011-12-10T12:43:42Z", "text": "Date: Sat Dec 10 12:06:23 2011\nNew Revision: 1212778\n\nURL: http://svn.apache.org/viewvc?rev=1212778&view=rev\nLog:\nBug 52310 - variable in IPSource failed HTTP request if \"Concurrent Pool Size\" is enabled\nROLLBACK\n\nModified:\n   jmeter/trunk/src/core/org/apache/jmeter/threads/JMeterContextService.java\n\nDate: Sat Dec 10 12:09:18 2011\nNew Revision: 1212779\n\nURL: http://svn.apache.org/viewvc?rev=1212779&view=rev\nLog:\nBug 52310 - variable in IPSource failed HTTP request if \"Concurrent Pool Size\" is enabled\nROLLBACK (Oups one modification passed)\n\nModified:\n   jmeter/trunk/src/core/org/apache/jmeter/threads/JMeterContextService.java\n\nLog:\nBug 52310 - variable in IPSource failed HTTP request if \"Concurrent Pool Size\" is enabled\nFix by making child get context of the parent.\n\nModified:\n   jmeter/trunk/src/core/org/apache/jmeter/threads/JMeterContextService.java\n   jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerBase.java"}]
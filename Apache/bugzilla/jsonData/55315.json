[{"count": 0, "tags": [], "bug_id": 55315, "attachment_id": null, "text": "Possible parsing regression in mod_proxy regarding interpolation of environment variables into URLs specified in ProxyPass and ProxyPassReverse directives.\n\nI have a virtual host which acts as a reverse proxy to an application \nrunning elsewhere which must preserve the protocol used by the incoming request (HTTP or HTTPS) when making the proxied request.\n\nThis was accomplished easily in httpd 2.2.21 with the following statements:\n\n     ProxyPassInterpolateEnv On\n     RewriteEngine On\n\n     RewriteCond %{HTTPS} =off\n     RewriteRule . - [E=protocol:http]\n     RewriteCond %{HTTPS} =on\n     RewriteRule . - [E=protocol:https]\n\n     ProxyPass /my_app/ ${protocol}://1.2.3.4/my_app/ interpolate\n     ProxyPassReverse /my_app/ ${protocol}://1.2.3.4/my_app/ interpolate\n\nWhen I upgraded to httpd 2.2.25, the server now chokes on parsing the \nURLs of the ProxyPass and ProxyPassReverse statements above.\nRemoving the ${protocol} from those URLs allows the server to start.\n\nI am using the official binary distribution of httpd available from:\nhttp://www.us.apache.org/dist//httpd/binaries/win32/httpd-2.2.25-win32-x86-openssl-0.9.8y.msi\n\nI just downgraded to the last official win32 binary for 2.2.22 and I can confirm that this problem does not exist there.", "id": 168831, "time": "2013-07-26T21:18:04Z", "creator": "jason.guild@alaska.gov", "creation_time": "2013-07-26T21:18:04Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 55315, "attachment_id": null, "id": 169332, "time": "2013-08-09T18:01:46Z", "creator": "mike.rumph@oracle.com", "creation_time": "2013-08-09T18:01:46Z", "is_private": false, "text": "My tests have confirmed that the same result occurs on Linux.\n\nRunning Apache httpd 2.2.22 with the described configuration successfully proxies over to the target server.\n\nRunning Apache httpd 2.2.25 fails to start.\n- $bin/apachectl -k start\n  - Syntax error of line n of .../conf/httpd.conf:\n  - ProxyPass Unable to parse URL\nAnd replacing the ${protocol} with http allows the server to start and successfully proxies over to the target server."}, {"count": 2, "tags": [], "creator": "mike.rumph@oracle.com", "attachment_id": 30727, "text": "Created attachment 30727\nA quick patch to allow mod_proxy interpolation characters through URI parsing\n\nThis bug is described as a regression in Apache httpd 2.2.25.\nBut it is actually a regression in Apache APR-util 1.5.2.\nThe regression occurs as result of the fix for APR-util bug 52479.\nThe apr_uri_parse function in apr-util/uri/apr_uri.c was no longer allowing the mod_proxy interpolation characters to pass through unaltered.\n\nI have attached a patch that allows the characters to pass through clean.\nThe listed directives will now work as the reporter expected.", "id": 169411, "time": "2013-08-13T20:02:54Z", "bug_id": 55315, "creation_time": "2013-08-13T20:02:54Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 55315, "text": "Created attachment 30777\nA patch to support interpolation within the scheme portion of a URL\n\nSince the URL validation in the apr_uri_parse function in util/apr_uri.c has become more strict in how the scheme portion is handled, I am submitting a patch to the mod_proxy code to handle the special case of interpolating a variable in the scheme portion of a URL.\n\nThis patch is against httpd trunk.", "id": 169779, "time": "2013-08-28T16:27:50Z", "creator": "mike.rumph@oracle.com", "creation_time": "2013-08-28T16:27:50Z", "is_private": false, "attachment_id": 30777}, {"count": 4, "tags": [], "creator": "mike.rumph@oracle.com", "attachment_id": 30799, "text": "Created attachment 30799\nAlternative patch that doesn't change the httpd API\n\nIt was pointed out on the httpd dev mailing list that the previous patch can not be applied to the branches, since it changes the API by adding a parameter.\n\nSo I've submitted an alternative patch that is applied directly against add_pass() in mod_proxy.c.", "id": 169908, "time": "2013-09-04T20:54:26Z", "bug_id": 55315, "creation_time": "2013-09-04T20:54:26Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 55315, "text": "Lack of support for interpolation within scheme will be a permanent limitation.  An alternate configuration mechanism for switching between http and https is now provided in the documentation, along with a statement for lack of support.\n\nTrunk: http://svn.apache.org/r1532816\n2.4.x branch: http://svn.apache.org/r1532824\n2.2.x branch:  http://svn.apache.org/r1532825", "id": 170640, "time": "2013-10-16T17:40:04Z", "creator": "trawick@apache.org", "creation_time": "2013-10-16T17:40:04Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "lexxsmith@gmail.com", "attachment_id": null, "text": "Hi, so that is not working in httpd-2.2.15-47.el6.centos.3.x86_64 as well.\nWith that being said\nhttp://svn.apache.org/viewvc/httpd/httpd/branches/2.2.x/docs/manual/mod/mod_proxy.xml?r1=1532825&r2=1532824&pathrev=1532825\n\nMeans that only way for making dynamic proxy for websockets in 2.2 is to patch mod_rewrite.\n\nhttps://bz.apache.org/bugzilla/show_bug.cgi?id=55598", "id": 188471, "time": "2016-02-16T14:53:42Z", "bug_id": 55315, "creation_time": "2016-02-16T14:53:42Z", "is_private": false}]
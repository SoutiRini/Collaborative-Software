[{"count": 0, "attachment_id": 29687, "creator": "xshao@ebay.com", "is_private": false, "id": 163826, "time": "2012-12-04T07:31:23Z", "bug_id": 54240, "creation_time": "2012-12-04T07:31:23Z", "tags": [], "text": "Created attachment 29687\nPatch for TagPluginManager.java\n\nCurrently, tagPlugins.xml can only be put in a WAR.\nHowever, if the configuration can be put into a web framework, so web application don't need to care about this."}, {"count": 1, "tags": [], "bug_id": 54240, "attachment_id": 29687, "text": "Comment on attachment 29687\nPatch for TagPluginManager.java\n\nNo objections in principle. \n\nSome comments on the proposed solution:\n1. I don't see a need for a system property here. Servlet context initialization parameters are a better choice.\n2. No documentation.\n3. Patch doesn't follow Tomcat coding standards.", "id": 163832, "time": "2012-12-04T08:42:30Z", "creator": "markt@apache.org", "creation_time": "2012-12-04T08:42:30Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 54240, "attachment_id": null, "text": "For this implementation to work, one would need to put the configuration file into classpath. I think that is not a good place for a configuration file.\n\n\nIf it were implemented via context initialization parameters or parameters of JspServlet, I wonder how it will behave during offline generation of JSPs (aka the jspc tool of Jasper). Some testing is needed.", "id": 163844, "time": "2012-12-04T13:03:35Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-12-04T13:03:35Z", "is_private": false}, {"count": 3, "tags": [], "creator": "xshao@ebay.com", "attachment_id": null, "id": 163848, "time": "2012-12-04T14:07:09Z", "bug_id": 54240, "creation_time": "2012-12-04T14:07:09Z", "is_private": false, "text": "TagPlugin is good for making tag libraris more efficently. The target for tag libraries is to share between multiple web applications. Same as TagPlugin.\n\nImagine that one enterprise has many web applications. It's better to share same tagPlugins & tagPlugins.xml for all applications. So that all applications can benifit from it. \n\nCurrently the solution is putting the tagPlugins.xml under WEB-INF.\nIt is not good for shareing this tagPlugins.xml with other applications.\n\nNow the solution still supports tagPlugins.xml under WEB-INF. Instead, it also supports an system level tagPlugins.xml. This tagPlugins.xml might be packaged with those implementations of TagPlugin.  \n\nI think TagPlugin implementations must provide such kind of configuration file. That's the idea of Zero-Configuration for web applications."}, {"count": 4, "tags": [], "bug_id": 54240, "attachment_id": null, "id": 163851, "time": "2012-12-04T14:38:15Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-12-04T14:38:15Z", "is_private": false, "text": "(In reply to comment #3)\n\nYour way goes to multiple tag libraries. If each one is self-contained, it could configure itself, without a global tagPlugin file.\n\nI do not know whether API is available in TagPluginManager, but there are already hooks to plug libraries in a container:\na) support for a Listener in Tag Library Descriptor (TLD) file\nb) ServletContainerInitializer in Servlet 3.0 specification"}, {"count": 5, "tags": [], "bug_id": 54240, "attachment_id": null, "text": "Yes. Maybe it needs separated tagPlugins.xml for every tld file.\n\nSo the solution can be like this,\n1. Check all resources in classpath with name \"META-INF/jasper/tagPlugins.xml\"\n2. Parse them one by one and put all the tagPlugins into tagPluginManager.\n3. Load tagPlugins configurations from \"WEB-INF/tagPlugins.xml\" if it existed.\n\nWith this new solution. TagPlugin declared in \"META-INF/jasper/tagPlugins.xml\" can be override by WebApp.  Tag library provider can also provide its own tagPlugins configurations for tag library.\n\nWhat's your opinion ?\n\n(In reply to comment #4)\n> (In reply to comment #3)", "id": 163875, "time": "2012-12-05T07:22:30Z", "creator": "xshao@ebay.com", "creation_time": "2012-12-05T07:22:30Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 54240, "attachment_id": 29737, "text": "Created attachment 29737\nPatch for TagPluginManager.java", "id": 164002, "time": "2012-12-10T08:00:42Z", "creator": "xshao@ebay.com", "creation_time": "2012-12-10T08:00:42Z", "is_private": false}, {"count": 7, "tags": [], "creator": "xshao@ebay.com", "text": "Created attachment 29738\nA TagPlugin for testing", "id": 164003, "time": "2012-12-10T08:01:32Z", "bug_id": 54240, "creation_time": "2012-12-10T08:01:32Z", "is_private": false, "attachment_id": 29738}, {"count": 8, "tags": [], "bug_id": 54240, "attachment_id": 29739, "id": 164004, "time": "2012-12-10T08:01:56Z", "creator": "xshao@ebay.com", "creation_time": "2012-12-10T08:01:56Z", "is_private": false, "text": "Created attachment 29739\nA tag for testing"}, {"count": 9, "tags": [], "bug_id": 54240, "attachment_id": 29740, "id": 164005, "time": "2012-12-10T08:02:23Z", "creator": "xshao@ebay.com", "creation_time": "2012-12-10T08:02:23Z", "is_private": false, "text": "Created attachment 29740\nTest case fo TagPluginManager"}, {"count": 10, "tags": [], "creator": "xshao@ebay.com", "text": "Hi Mark,\n\nI made a little changes for Konstantin's concern. And refined the code and uploaded the test case.\n\nPlease take a look.\n\nThanks,\n\nSheldon", "id": 164006, "time": "2012-12-10T08:04:48Z", "bug_id": 54240, "creation_time": "2012-12-10T08:04:48Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 54240, "text": "I like the idea of using the existing mechanisms (such as ServletContainerInitializer) but that would require other changes since:\n- TagPluginManager is not created at the point where the SCI runs\n- There is no mechanism to expose the TagPluginManager to the SCI\n\nGiven that changes would have to be made and that Tag plug-ins are a Tomcat specific extension, I don't have an issue with a Tomcat specific mechanism to configure these plug-ins. I like the META-INF/japser approach as it means a plug-in JAR can be dropped into CATALINA_BASE/lib and be used by all web applications on that instance.\n\nI'll be working on applying this patch for 7.0.35.", "id": 164554, "time": "2013-01-10T08:46:15Z", "creator": "markt@apache.org", "creation_time": "2013-01-10T08:46:15Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 54240, "attachment_id": null, "text": "Thanks for the patch and test case.\n\nThis has been applied to trunk and 7.0.x and will be included in 7.0.35 onwards.", "id": 164557, "time": "2013-01-10T09:33:36Z", "creator": "markt@apache.org", "creation_time": "2013-01-10T09:33:36Z", "is_private": false}]
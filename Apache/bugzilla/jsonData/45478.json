[{"count": 0, "tags": [], "bug_id": 45478, "text": "R flag in RewriteRule does not accept 400s and 500s error code.\n\nTo reproduce:\n\nRewriteEngine On\nRewriteCond %{THE_REQUEST} \"HTTP/1.[01]$\"\nRewriteRule .* - [R=400]", "id": 118993, "time": "2008-07-24T12:08:37Z", "creator": "anny.mak@springsource.com", "creation_time": "2008-07-24T12:08:37Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 45478, "is_private": false, "id": 118994, "creation_time": "2008-07-24T12:39:01Z", "time": "2008-07-24T12:39:01Z", "creator": "covener@gmail.com", "text": "AFAICT, Only 2.2 doc says you can supply a non-3xx status code. 2.2.x does what the manual says, returns the status and stops rewriting (and no redirect of course.\n", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 45478, "attachment_id": null, "is_private": false, "id": 118995, "time": "2008-07-24T12:48:30Z", "creator": "anny.mak@springsource.com", "creation_time": "2008-07-24T12:48:30Z", "text": "Perhaps the doc can be more explicit than saying:\n\n'redirect|R [=code]' (force redirect)\n...If you want to use other response codes in the range 300-400, simply specify the appropriate number or use one of the following symbolic names: temp (default), permanent, seeother...\n\nSomething like:\n\n'redirect|R [=code]' (force redirect)\n...If you want to use other response codes in the 300 range, simply specify the appropriate number or use one of the following symbolic names: temp (default), permanent, seeother. Please note that error codes other than those in the 300 range are not supported..."}, {"count": 3, "tags": [], "bug_id": 45478, "text": "No; 2.0 behaved correctly, at one point, and the documentation closes with\n\n\"While this is typically used for redirects, any valid status code can be given here. If the status code is outside the redirect range (300-399), then the Substitution string is dropped and rewriting is stopped as if the L flag was used.\"\n\noutside of 300-399, R=VAL must work as documented.\n\n", "id": 118996, "time": "2008-07-24T12:57:22Z", "creator": "wrowe@apache.org", "creation_time": "2008-07-24T12:57:22Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 118998, "time": "2008-07-24T14:25:54Z", "bug_id": 45478, "creation_time": "2008-07-24T14:25:54Z", "text": " (In reply to comment #3)\n\n> No; 2.0 behaved correctly, at one point, and the documentation closes with\n> \n> \"While this is typically used for redirects, any valid status code can be given\n> here. If the status code is outside the redirect range (300-399), then the\n> Substitution string is dropped and rewriting is stopped as if the L flag was\n> used.\"\n\n\nThis \"...typically...\" clause is only in 2.2 doc though, right?\n"}, {"count": 5, "attachment_id": null, "bug_id": 45478, "is_private": false, "id": 118999, "time": "2008-07-24T15:48:44Z", "creator": "wrowe@apache.org", "creation_time": "2008-07-24T15:48:44Z", "tags": [], "text": "Yes, though it's irrelevant as there is no other way to specify a custom\nresponse code and therefore this feature should not have been broken.\n\nI'm 99% certain it did work in 2.0, and perhaps as far back as 1.3.  I've\nused it in custom rules to cripple Host:'less requests (anonymous crawlers).\n\nIn the <300, >=400 cases, one can think of this as [R{esponse}=nnn} as\nopposed to [R{edirect}], and it really harms nothing to overload it."}, {"count": 6, "attachment_id": null, "creator": "wrowe@apache.org", "text": "Just validated your example config;\n\nRewriteEngine On\nRewriteCond %{THE_REQUEST} \"HTTP/1.[01]$\"\nRewriteRule .* - [R=400]\n\nThe only exception/disallowed values are those HTTPD does not issue, itself.\nSo for example, 499 would be invalid, but 400 or 500 for example are fine.\n\nIf you were simply testing for invalid HTTP values, are you sure you didn't\nomit the ! negation symbol?  e.g. the snippet below works for me;\n\nRewriteEngine On\nRewriteCond %{THE_REQUEST} \"! HTTP/1.[01]$\"\nRewriteRule .* - [R=400]\n\nand no errors are reported in the error log, it accepts the R=400 value.\n", "id": 119044, "time": "2008-07-27T13:18:52Z", "bug_id": 45478, "creation_time": "2008-07-27T13:18:52Z", "tags": [], "is_private": false}, {"count": 7, "attachment_id": null, "creator": "anny.mak@springsource.com", "is_private": false, "id": 119045, "time": "2008-07-27T13:28:49Z", "bug_id": 45478, "creation_time": "2008-07-27T13:28:49Z", "tags": [], "text": "I did that on purpose, just to provide a condition to satisfy the condition in order to trigger the RewriteRule, as I do not know how to provide an invalid protocol header.\n\nIn real life situation, yes, the negation, !, would have been added."}, {"count": 8, "tags": [], "bug_id": 45478, "text": "Can you provide the exact error.log result and httpd -v information for this?\nIt seems to be correct on the current 2.0 and 2.2 flavors, and I didn't dig\nmuch deeper than that.\n", "id": 119046, "time": "2008-07-27T14:46:45Z", "creator": "wrowe@apache.org", "creation_time": "2008-07-27T14:46:45Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 45478, "attachment_id": null, "is_private": false, "id": 119047, "time": "2008-07-27T14:48:05Z", "creator": "wrowe@apache.org", "creation_time": "2008-07-27T14:48:05Z", "text": "(Due to the nature of rewriting url's, please be sure to put the example you\nmentioned in a <Location /> block... I don't really have a clue what it would\nmean to try to put this in a global or virtual host section)"}, {"count": 10, "tags": [], "bug_id": 45478, "is_private": false, "id": 119053, "creation_time": "2008-07-27T21:38:22Z", "time": "2008-07-27T21:38:22Z", "creator": "anny.mak@springsource.com", "text": "Put the rewrite condition inside <Location /> still gets the same error:\n\nRewriteEngine On\nRewriteLog logs/rewrite.log\nRewriteLogLevel debug\n<Location />\nRewriteCond %{THE_REQUEST} \"HTTP/1.[01]$\"\nRewriteRule .* - [R=400]\n</Location>\n\nSince it fails during the start up phrase, the error.log file has not even been generated yet.  The error is printed to stdout:\n\nStarting Apache\nSyntax error on line 362 of /local0/anny/ers31/servers/20reqproctest/conf/httpsd.conf:\nRewriteRule: invalid HTTP response code for flag 'R'\nServer start FAILED\n\nThe \"httpd -v\" output is:\n\nServer version: Apache/2.0.59\nServer built:   Aug 31 2006 19:47:37", "attachment_id": null}]
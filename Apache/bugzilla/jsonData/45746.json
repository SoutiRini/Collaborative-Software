[{"count": 0, "attachment_id": null, "creator": "jiangjianbo@yahoo.com", "text": "my build.xml can not work properly, all attaches as below.\n\nif I remove attribute \"if\" , it works OK. and the output as below :\n-------\n      [sql] connecting to jdbc:oracle:thin:@192.168.1.22:1521:ORCL\n      [sql] Loading oracle.jdbc.driver.OracleDriver using AntClassLoader with classpath ........\n-------\n\nif I remain attribute \"if\", but add code at position (1) in build.xml, the ant not work, the output show same error.\n---inserted code ----\n\t\t<property name=\"local.dbinit.exist1\" value=\"true\" />\n\t\t<property name=\"local.dbinit.exist2\" value=\"true\" />\n\t\t<property name=\"local.dbinit.exist3\" value=\"true\" />\n\t\t<property name=\"local.dbinit.exist4\" value=\"true\" />\n\n--------\n\nthen I trace into ant's code, the last method code is below, and behavior == ADD, so if condition is false and fileset object ignored:\n        void store(Object parent, Object child)\n                throws InvocationTargetException, IllegalAccessException, InstantiationException {\n            if (behavior == ADD_CONFIGURED) { // real value of behavior is 1, jumped\n                istore(parent, child);\n            }\n        }\n\ncall stack is:\n=>IntrospectionHelper$AddNestedCreator.store#1293\n=>IntrospectionHelper$Creator.store#1201\n=>UnknownElement.java#570\n\n==========disk file tree (vista tree output)========\nD:\\work\\platform\\frrp\n\u2502  .project\n\u2502  .tomcatplugin\n\u2502  build-win.properties\n\u2502  build.properties\n\u2502  build.xml\n\u2502  hbm.properties\n\u2502      \n\u251c\u2500design\n\u2502      db-frrp-oracle.sql\n\u2502      init-frrp.sql\n\u2502                      \n\u2514\u2500work\n        tldCache.ser\n        \n\n\n======================= my build.xml =========================================\n\n\n\t<!-- =================================\n          target: dbinit\n         ================================= -->\n\t<target name=\"dbinit\" depends=\"_dbconfig\" description=\"==> init and load data\">\n\t\t<echo message=\"LOAD DATA USING: ${db.driver} ${db.connection.url}\" />\n<!-- position (0), add debug code here -->\n\t\t<available property=\"local.dbinit.exist1\"  file=\"${output.db.script.dir}/db-${project.name}-${db.server.type}-extra.sql\" />\n\t\t<available property=\"local.dbinit.exist2\" file=\"${output.db.script.dir}/db-${project.name}-extra.sql\" />\n\t\t<available property=\"local.dbinit.exist3\" file=\"${output.db.script.dir}/init-${project.name}-${db.server.type}.sql\" />\n\t\t<available property=\"local.dbinit.exist4\" file=\"${output.db.script.dir}/init-${project.name}.sql\" />\n\t\t<sql driver=\"${db.driver}\" url=\"${db.connection.url}\" userid=\"${db.user}\" password=\"${db.pass}\" onerror=\"continue\">\n\t\t\t<classpath refid=\"test-classpath\" />\n\t\t\t<fileset dir=\"${output.db.script.dir}\">\n\t\t\t\t<include name=\"db-${project.name}-${db.server.type}-extra.sql\" if=\"${local.dbinit.exist1}\" />\n\t\t\t\t<include name=\"db-${project.name}-extra.sql\" if=\"${local.dbinit.exist2}\" />\n\t\t\t\t<include name=\"init-${project.name}-${db.server.type}.sql\" if=\"${local.dbinit.exist3}\" />\n\t\t\t\t<include name=\"init-${project.name}.sql\" if=\"${local.dbinit.exist4}\" />\n\t\t\t</fileset>\n\t\t</sql>\n\t</target>\n\n<!-- _dbconfig only set some property value about jdbc and hibernate(it will auto check hibernate version) -->\n\t<target name=\"_dbconfig\" depends=\"__db_config,__init_hibernate\">\n\t</target>\n\n\t<target name=\"__init_hibernate\" depends=\"___check_hibernate,___init_hibernate2,___init_hibernate3\">\n\t\t<taskdef name=\"schemaexport\" classname=\"${db.hibernate.tool.package}.SchemaExportTask\"\n\t\t\t\tclasspathref=\"hibernate_classpath\" />\n\t\t<taskdef name=\"schemaupdate\" classname=\"${db.hibernate.tool.package}.SchemaUpdateTask\"\n\t\t        classpathref=\"hibernate_classpath\"/>\n\n\t\t<echo>use hibernate class:</echo>\n\t\t<echo>\tdb.hibernate.schemaexporttask=${db.hibernate.tool.package}.SchemaExportTask</echo>\n\t\t<echo>\tdb.hibernate.dialect=${db.hibernate.dialect}</echo>\n\t</target>\n\n    <target name=\"___check_hibernate\" depends=\"_init_classpath\">\n\t\t<available classname=\"net.sf.hibernate.tool.hbm2ddl.SchemaExportTask\" classpathref=\"classpath\"\n\t\t\tproperty=\"hibernate2_support\" />\n\t\t<available classname=\"org.hibernate.tool.hbm2ddl.SchemaExportTask\" classpathref=\"classpath\"\n\t\t\tproperty=\"hibernate3_support\" />\n\n\t\t<path id=\"hibernate_classpath\">\n\t\t\t<path refid=\"classpath\" />\n\t\t\t<path location=\"${output.main.java.dir}\" />\n\t\t\t<path location=\"${src.main.java.dir}\" />\n\t\t</path>\n    </target>\n\n    <target name=\"___init_hibernate2\" depends=\"___check_hibernate\" if=\"hibernate2_support\">\n\t\t<property name=\"db.hibernate.tool.package\" value=\"net.sf.hibernate.tool.hbm2ddl\" />\n    \t<property name=\"db.hibernate.dialect\" value=\"${db.hibernate2.dialect}\" />\n    </target>\n\n    <target name=\"___init_hibernate3\" depends=\"___check_hibernate\" if=\"hibernate3_support\">\n\t\t<property name=\"db.hibernate.schemaexporttask\" value=\"org.hibernate.tool.hbm2ddl.SchemaExportTask\" />\n    \t<property name=\"db.hibernate.dialect\" value=\"${db.hibernate3.dialect}\" />\n    </target>\n\n\t<target name=\"__db_config\" >\n\t    <macrodef name=\"_set_db_properties\">\n\t        <attribute name=\"prefix\" />\n\t        <sequential>\n\t\t\t\t<property name=\"db.server.address\" value=\"${@{prefix}.server.address}\"  />\n\t\t\t\t<property name=\"db.server.port\" value=\"${@{prefix}.server.port}\" />\n\t\t\t\t<property name=\"db.name\" value=\"${@{prefix}.name}\" />\n\t\t\t\t<property name=\"db.user\" value=\"${@{prefix}.user}\" />\n\t\t\t\t<property name=\"db.pass\" value=\"${@{prefix}.pass}\" />\n\t\t\t\t<property name=\"db.driver\" value=\"${@{prefix}.driver}\" />\n\t\t\t\t<property name=\"db.connection.url\" value=\"${@{prefix}.connection.url}\" />\n\t        \t<property name=\"db.hibernate2.dialect\" value=\"${@{prefix}.hibernate2.dialect}\" />\n\t        \t<property name=\"db.hibernate3.dialect\" value=\"${@{prefix}.hibernate2.dialect}\" />\n\t        </sequential>\n\t    </macrodef>\n\t\t<_set_db_properties prefix=\"${db.server.type}\" />\n\n\t\t<echo>use db configuration values:</echo>\n\t\t<echo>\tdb.server.address=${db.server.address}</echo>\n\t\t<echo>\tdb.server.port=${db.server.port}</echo>\n\t\t<echo>\tdb.name=${db.name}</echo>\n\t\t<echo>\tdb.user=${db.user}</echo>\n\t\t<echo>\tdb.pass=${db.pass}</echo>\n\t\t<echo>\tdb.driver=${db.driver}</echo>\n\t\t<echo>\tdb.connection.url=${db.connection.url}</echo>\n\t</target>\n\n================output with -v =================================\nApache Ant version 1.7.1 compiled on June 27 2008\nBuildfile: d:\\work\\platform\\frrp\\build.xml\nDetected Java version: 1.6 in: C:\\Program Files\\Java\\jdk1.6.0_05\\jre\nDetected OS: Windows Vista\nparsing buildfile d:\\work\\platform\\frrp\\build.xml with URI = file:/d:/work/platform/frrp/build.xml\nProject base dir set to: d:\\work\\platform\\frrp\n[antlib:org.apache.tools.ant] Could not load definitions from resource org/apache/tools/ant/antlib.xml. It could not be found.\n [property] Loading Environment env.\nProperty \"env.windir\" has not been set\n[available] Unable to find dir ${env.windir} to set property os\nProperty \"env.SHELL\" has not been set\n[available] Unable to find file ${env.SHELL} to set property os\n [property] Loading d:\\work\\platform\\frrp\\build-win.properties\n [property] Loading d:\\work\\platform\\build-win.properties\nOverride ignored for property \"SEAL_LIBRARY\"\nOverride ignored for property \"TOMCAT_HOME\"\nOverride ignored for property \"ANTLIB\"\nOverride ignored for property \"MAVEN_ANT_TASK_JAR\"\nOverride ignored for property \"COMMON_LIBRARY\"\nOverride ignored for property \"VSS_REPOSITORY_DIR\"\nOverride ignored for property \"DTD_DIR\"\nOverride ignored for property \"VSS_DIR\"\nOverride ignored for property \"PLATFORM_LIBRARY\"\n [property] Loading d:\\work\\platform\\frrp\\build.properties\nOverride ignored for property \"solution.dir\"\n [property] Loading d:\\work\\platform\\build.properties\nOverride ignored for property \"mysql.driver\"\nOverride ignored for property \"mysql.hibernate2.dialect\"\nOverride ignored for property \"oracle.server.port\"\nOverride ignored for property \"oracle.user\"\nOverride ignored for property \"cvs.pass\"\nOverride ignored for property \"svn.host\"\nOverride ignored for property \"oracle.hibernate3.dialect\"\nOverride ignored for property \"svn.protocol.port\"\nOverride ignored for property \"postgresql.driver\"\nOverride ignored for property \"sqlserver.user\"\nOverride ignored for property \"depoly.dir\"\nOverride ignored for property \"postgresql.server.address\"\nOverride ignored for property \"sqlserver.driver\"\nOverride ignored for property \"tomcat.manager.url\"\nOverride ignored for property \"svn.latest.url\"\nOverride ignored for property \"cvs.protocol.port\"\nOverride ignored for property \"tomcat.port\"\nOverride ignored for property \"sqlserver.connection.url\"\nOverride ignored for property \"oracle.name\"\nOverride ignored for property \"oracle.pass\"\nOverride ignored for property \"output.webapp.work.dir\"\nOverride ignored for property \"hsqldb.hibernate2.dialect\"\nOverride ignored for property \"src.main.webapp.webinf.dir\"\nOverride ignored for property \"sqlserver.name\"\nOverride ignored for property \"sqlserver.pass\"\nOverride ignored for property \"solution.platform.webapp.dir\"\nOverride ignored for property \"postgresql.hibernate2.dialect\"\nOverride ignored for property \"sqlserver.hibernate3.dialect\"\nOverride ignored for property \"svn.protocol.type\"\nOverride ignored for property \"output.checkstyle.dir\"\nOverride ignored for property \"src.test.config.dir\"\nOverride ignored for property \"solution.platform.dir\"\nOverride ignored for property \"output.db.script.dir\"\nOverride ignored for property \"cvs.root\"\nOverride ignored for property \"compile.optimize\"\nOverride ignored for property \"postgresql.user\"\nOverride ignored for property \"sqlserver.server.port\"\nOverride ignored for property \"vss.user\"\nOverride ignored for property \"vss.bin.dir\"\nOverride ignored for property \"vss.path\"\nOverride ignored for property \"tomcat.password\"\nOverride ignored for property \"cvs.protocol.type\"\nOverride ignored for property \"tomcat.context.dir\"\nOverride ignored for property \"cvs.host\"\nOverride ignored for property \"sqlserver.server.address\"\nOverride ignored for property \"src.main.webapp.dir\"\nOverride ignored for property \"output.webapp.dir\"\nOverride ignored for property \"solution.output.dir\"\nOverride ignored for property \"postgresql.name\"\nOverride ignored for property \"postgresql.pass\"\nOverride ignored for property \"vss.pass\"\nOverride ignored for property \"output.dir\"\nOverride ignored for property \"vss.database\"\nOverride ignored for property \"oracle.connection.url\"\nOverride ignored for property \"mysql.hibernate3.dialect\"\nOverride ignored for property \"hsqldb.user\"\nOverride ignored for property \"tomcat.server\"\nOverride ignored for property \"mysql.user\"\nOverride ignored for property \"tomcat.username\"\nOverride ignored for property \"mysql.connection.url\"\nOverride ignored for property \"hsqldb.connection.url\"\nOverride ignored for property \"svn.user\"\nOverride ignored for property \"output.webapp.webinf.dir\"\nOverride ignored for property \"oracle.hibernate2.dialect\"\nOverride ignored for property \"oracle.driver\"\nOverride ignored for property \"svn.repository\"\nOverride ignored for property \"src.main.java.dir\"\nOverride ignored for property \"src.main.resource.dir\"\nOverride ignored for property \"svn.this.url\"\nOverride ignored for property \"src.test.java.dir\"\nOverride ignored for property \"output.main.test.dir\"\nOverride ignored for property \"cvs.repository\"\nOverride ignored for property \"postgresql.server.port\"\nOverride ignored for property \"hsqldb.name\"\nOverride ignored for property \"hsqldb.pass\"\nOverride ignored for property \"mysql.name\"\nOverride ignored for property \"project.name\"\nOverride ignored for property \"mysql.pass\"\nOverride ignored for property \"hsqldb.hibernate3.dialect\"\nOverride ignored for property \"svn.this.version\"\nOverride ignored for property \"oracle.server.address\"\nOverride ignored for property \"solution.dir\"\nOverride ignored for property \"svn.pass\"\nOverride ignored for property \"compile.debug\"\nOverride ignored for property \"postgresql.hibernate3.dialect\"\nOverride ignored for property \"output.main.java.dir\"\nOverride ignored for property \"hsqldb.driver\"\nOverride ignored for property \"db.server.type\"\nOverride ignored for property \"mysql.server.address\"\nOverride ignored for property \"sqlserver.hibernate2.dialect\"\nOverride ignored for property \"hsqldb.server.address\"\nOverride ignored for property \"output.junit.dir\"\nOverride ignored for property \"src.site.dir\"\nOverride ignored for property \"toolkit.dir\"\nOverride ignored for property \"output.javadoc.dir\"\nOverride ignored for property \"src.main.config.dir\"\nOverride ignored for property \"solution.config.dir\"\nOverride ignored for property \"compile.deprecation\"\nOverride ignored for property \"hsqldb.server.port\"\nOverride ignored for property \"postgresql.connection.url\"\nOverride ignored for property \"cvs.user\"\nOverride ignored for property \"scm.type\"\nOverride ignored for property \"src.test.resource.dir\"\nOverride ignored for property \"output.webapp.classes.dir\"\nOverride ignored for property \"output.webapp.lib.dir\"\nOverride ignored for property \"project.dir\"\nOverride ignored for property \"mysql.server.port\"\n[available] Unable to find file pom.xml to set property maven_support\nBuild sequence for target(s) `dbinit' is [__db_config, __init_maven_task, __init_maven_1, __init_maven_2, _init_maven, _init_classpath, ___check_hibernate, ___init_hibernate2, ___init_hibernate3, __init_hibernate, _dbconfig, dbinit]\nComplete build sequence is [__db_config, __init_maven_task, __init_maven_1, __init_maven_2, _init_maven, _init_classpath, ___check_hibernate, ___init_hibernate2, ___init_hibernate3, __init_hibernate, _dbconfig, dbinit, init, compile, javadoc, build_webapp, copylib, _build_prop_jdbc, _init_dtd, _init_xmltask, _change_web_xml_names, _frrp_config_web_xml, _frrp_build_config, build_config, build, war, tomcat-install, checkstyle, tomcat-stop, tomcat-start, pressure, tomcat-list, __init_vss, _vss_checkin, __init_svn, compile_test, test, _hbm_prop_file, dbschema_all, dbdrop, manifest, dbcreate, tomcat-remove, _svn_checkin, tomcat-remove-context, _init_checkstyle, _svn_get, _vss_get, __init_cvs, _cvs_get, scm_get, _cvs_checkin, dbclean, native2ascii, obfuscate, depoly_ftp, tomcat-install-context, _init_scm, dbinit2, dbupdate, clean, copy_platform, dbschema, tomcat-reload, scm_checkin, _init_tomcat, jar, _init_javadoc, ]\n\n__db_config:\n [macrodef] creating macro  _set_db_properties\n     [echo] use db configuration values:\n     [echo] \tdb.server.address=192.168.1.22\n     [echo] \tdb.server.port=1521\n     [echo] \tdb.name=ORCL\n     [echo] \tdb.user=test001\n     [echo] \tdb.pass=test001\n     [echo] \tdb.driver=oracle.jdbc.driver.OracleDriver\n     [echo] \tdb.connection.url=jdbc:oracle:thin:@192.168.1.22:1521:ORCL\n\n__init_maven_task:\nparsing buildfile jar:file:/D:/tools/dev/maven/apache-maven-2.0.9/lib/maven-ant-tasks-2.0.9.jar!/org/apache/maven/artifact/ant/antlib.xml with URI = jar:file:/D:/tools/dev/maven/apache-maven-2.0.9/lib/maven-ant-tasks-2.0.9.jar!/org/apache/maven/artifact/ant/antlib.xml\nparsing buildfile jar:file:/D:/tools/dev/maven/apache-maven-2.0.9/lib/maven-ant-tasks-2.0.9.jar!/org/apache/maven/artifact/ant/antlib.xml with URI = jar:file:/D:/tools/dev/maven/apache-maven-2.0.9/lib/maven-ant-tasks-2.0.9.jar!/org/apache/maven/artifact/ant/antlib.xml\n\n__init_maven_1:\nSkipped because property 'maven_support' not set.\n\n__init_maven_2:\n     [echo] not found pom.xml, MAVEN2 ignored\n\n_init_maven:\n\n_init_classpath:\n\n___check_hibernate:\n[available] Unable to load class org.hibernate.tool.hbm2ddl.SchemaExportTask to set property hibernate3_support\n\n___init_hibernate2:\n\n___init_hibernate3:\nSkipped because property 'hibernate3_support' not set.\n\n__init_hibernate:\n     [echo] use hibernate class:\n     [echo] \tdb.hibernate.schemaexporttask=net.sf.hibernate.tool.hbm2ddl.SchemaExportTask\n     [echo] \tdb.hibernate.dialect=net.sf.hibernate.dialect.OracleDialect\n\n_dbconfig:\n\ndbinit:\n     [echo] LOAD DATA USING: oracle.jdbc.driver.OracleDriver jdbc:oracle:thin:@192.168.1.22:1521:ORCL\n[available] Unable to find design\\db-frrp-oracle-extra.sql to set property local.dbinit.exist1\n[available] Unable to find design\\db-frrp-extra.sql to set property local.dbinit.exist2\n[available] Unable to find design\\init-frrp-oracle.sql to set property local.dbinit.exist3\n[available] Found: design\\init-frrp.sql\nProperty \"local.dbinit.exist1\" has not been set\nProperty \"local.dbinit.exist2\" has not been set\nProperty \"local.dbinit.exist3\" has not been set\n\nBUILD FAILED\nd:\\work\\platform\\frrp\\build.xml:705: Source file or resource collection, transactions or sql statement must be set!\n\tat org.apache.tools.ant.taskdefs.SQLExec.execute(SQLExec.java:405)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\n\tat sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\n\tat org.apache.tools.ant.Target.execute(Target.java:357)\n\tat org.apache.tools.ant.Target.performTasks(Target.java:385)\n\tat org.apache.tools.ant.Project.executeSortedTargets(Project.java:1337)\n\tat org.apache.tools.ant.Project.executeTarget(Project.java:1306)\n\tat org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n\tat org.apache.tools.ant.Project.executeTargets(Project.java:1189)\n\tat org.apache.tools.ant.Main.runBuild(Main.java:758)\n\tat org.apache.tools.ant.Main.startAnt(Main.java:217)\n\tat org.apache.tools.ant.Main.start(Main.java:179)\n\tat org.apache.tools.ant.Main.main(Main.java:268)\n\nTotal time: 23 minutes 27 seconds", "id": 120364, "time": "2008-09-04T10:01:06Z", "bug_id": 45746, "creation_time": "2008-09-04T10:01:06Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 45746, "is_private": false, "id": 120376, "time": "2008-09-04T23:37:56Z", "creator": "bodewig@apache.org", "creation_time": "2008-09-04T23:37:56Z", "tags": [], "text": "the if attribute expects the name of the property to be tested, not its value.\n\nUse if=\"local.dbinit.exist1\" instead of if=\"${local.dbinit.exist1}\"."}]
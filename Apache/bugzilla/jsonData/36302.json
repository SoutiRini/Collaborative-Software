[{"attachment_id": null, "tags": [], "bug_id": 36302, "is_private": false, "count": 0, "id": 78813, "time": "2005-08-22T15:49:44Z", "creator": "Grzegorz_Kruk@o2.pl", "creation_time": "2005-08-22T15:49:44Z", "text": "ChannelExec as an output stream uses TeeOutputStream which is created using\ndirectly System.out. Finalization of this channel object closes System.out. \nThe effect is that there is no output from second and subsequent calls to the\nsshexec task."}, {"attachment_id": 16265, "tags": [], "bug_id": 36302, "is_private": false, "count": 1, "id": 79246, "time": "2005-08-31T19:58:51Z", "creator": "antoine@apache.org", "creation_time": "2005-08-31T19:58:51Z", "text": "Created attachment 16265\nfrom Atsuhiko Yamanaka - patch for TeeOuputStream\n\nAtsuhiko Yamanaka wrote :\nI think that this issue comes from that System.out will be closed in\n'close' method of TeeOutputStream[1].\nYou know that TeeOutputStream has been used in SSHExec[2].\n\nIt seems following modification for TeeOutputStream fixes this problem,"}, {"attachment_id": null, "tags": [], "bug_id": 36302, "is_private": false, "count": 2, "id": 79247, "time": "2005-08-31T20:37:05Z", "creator": "mbenson@apache.org", "creation_time": "2005-08-31T20:37:05Z", "text": "More generic would be the use of a KeepAliveOutputStream in the correct place; \ni.e. SSHExec's TeeOutputStream:\n\nnew TeeOutputStream(out, new KeepAliveOutputStream(System.out))\n\nI would question the use of System.out in the first place--within Ant it would \nprobably be more correct to use a LogOutputStream, but I suppose that's a \ndifferent issue."}, {"count": 3, "tags": [], "creator": "mbenson@apache.org", "is_private": false, "text": "My suggestion appears to fix this problem; committed to CVS HEAD.", "id": 79250, "time": "2005-08-31T21:41:54Z", "bug_id": 36302, "creation_time": "2005-08-31T21:41:54Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 36302, "is_private": false, "count": 4, "id": 86035, "time": "2006-02-21T20:47:11Z", "creator": "riznob@hotmail.com", "creation_time": "2006-02-21T20:47:11Z", "text": "*** Bug 38720 has been marked as a duplicate of this bug. ***"}, {"count": 5, "tags": [], "text": "*** Bug 39186 has been marked as a duplicate of this bug. ***", "is_private": false, "id": 87863, "creator": "bodewig@apache.org", "time": "2006-04-12T20:24:00Z", "bug_id": 36302, "creation_time": "2006-04-12T20:24:00Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 36302, "is_private": false, "count": 6, "id": 93117, "time": "2006-09-06T23:46:51Z", "creator": "psen@adomo.com", "creation_time": "2006-09-06T23:46:51Z", "text": "Has this really been fixed. I am using ant-1.6.5 and I still can't make\nsubsequenet calls to sshexec. \n\nThe second sshexec command results in \n==============================================================================\n[sshexec] Connecting to 10.10.0.220:22\n\nBUILD SUCCESSFUL\nTotal time: 57 seconds\n==============================================================================\n\nThe second sshexec commands are NOT executed. \n"}, {"count": 7, "tags": [], "creator": "antoine@apache.org", "text": "\nthis is fixed in Ant 1.7, but not in Ant 1.6.5.\nyou can download the Ant 1.7Beta1 from the ant.apache.org website to check.\n", "id": 93124, "time": "2006-09-07T02:07:25Z", "bug_id": 36302, "creation_time": "2006-09-07T02:07:25Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 36302, "attachment_id": null, "text": "*** Bug 41012 has been marked as a duplicate of this bug. ***", "id": 96057, "time": "2006-11-22T01:22:59Z", "creator": "peterreilly@apache.org", "creation_time": "2006-11-22T01:22:59Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 36302, "is_private": false, "count": 9, "id": 110304, "time": "2007-11-07T08:52:09Z", "creator": "ghertz@libero.it", "creation_time": "2007-11-07T08:52:09Z", "text": "I still have this problem with Ant 1.7\nAny suggestions?\nThanks in advance"}, {"count": 10, "tags": [], "bug_id": 36302, "attachment_id": null, "text": "1) can you provide an example *small* build.xml that shows the problem\n2) have you tried the SVN version of ant? - a number of bugs\n   have been fixed wrt ssh\n3) this bug specificly referres to TeeOutputStream closing System.out,\n   is this the problem you are seeing?", "id": 110305, "time": "2007-11-07T09:04:25Z", "creator": "peterreilly@apache.org", "creation_time": "2007-11-07T09:04:25Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 36302, "is_private": false, "count": 11, "id": 110316, "time": "2007-11-08T02:05:07Z", "creator": "ghertz@libero.it", "creation_time": "2007-11-08T02:05:07Z", "text": "This is the code in my build.xml (in the last target that it has to be \nexecuted):\n\n<sshexec host=\"${remote.host}\"\n         username=\"${remote.user}\"\n         password=\"${remote.password}\"\n         command=\"cd ${remote.commonshare};rm -rf ${codeline.dir}-OLD;mkdir -p \n${codeline.dir};mv ${codeline.dir} ${codeline.dir}-OLD;\"/>\n\n<scp file=\"${tmp.dir}/${zip.file}\" todir=\"${remote.user}:${remote.password}\n@${remote.host}:${remote.commonshare}\"/>\n\n<sshexec host=\"${remote.host}\"\n         username=\"${remote.user}\"\n         password=\"${remote.password}\"\n         command=\"cd ${remote.commonshare};unzip ${zip.file};rm -f \n${zip.file}\"/>\n\n\nThe result is the same as reported by Prapti Sen (comment #6): the first \nsshexec is executed successfully, the same thing with the scp command, but the \nresult of the second sshexec is like:\n\n\nThe second sshexec command results in \n==============================================================================\n[sshexec] Connecting to 10.10.0.220:22\n\nBUILD SUCCESSFUL\nTotal time: 57 seconds\n==============================================================================\n\n\nIt connects to the remote machine, but it doesn't make anything.\nHowever, the build doesn't fail.\n\nNow I've tested, and it seems working fine, an external library, doing the \nsame things.\nIf you want, consult this link:\n\nhttp://www.sshtools.com/showMaverickAntTask.do\n\n\n\n\n"}, {"attachment_id": null, "tags": [], "bug_id": 36302, "is_private": false, "count": 12, "id": 110317, "time": "2007-11-08T02:36:07Z", "creator": "stevel@apache.org", "creation_time": "2007-11-08T02:36:07Z", "text": "I do a truckload of sshexecs in my build, on ant 1.7.0 pure\n\n    <presetdef name=\"ssh-remote\">\n      <sshexec host=\"${ssh.server}\"\n          username=\"${ssh.user}\"\n          passphrase=\"${ssh.passphrase}\"\n          trust=\"${ssh.trust}\"\n          timeout=\"6000000\"\n          keyfile=\"${ssh.keyfile}\"\n          />\n    </presetdef>\n    <ssh-remote command=\"mkdir -p ${ssh.maven.dir}\"/>\n    <property name=\"ssh.maven.path\"\n        value=\"${ssh.user}@${ssh.server}:${ssh.maven.dir}\" />\n    <scp remoteToDir=\"${ssh.maven.path}\"\n        passphrase=\"${ssh.passphrase}\"\n        keyfile=\"${ssh.keyfile}\"\n        trust=\"${ssh.trust}\"\n        verbose=\"${ssh.verbose}\" >\n      <fileset file=\"${maven.zip}\" />\n    </scp>\n    <ssh-remote \n      command=\"unzip ${ssh.maven.dir}/${maven.zip.filename} -d ${ssh.maven.dir}\"/>\n    <ssh-remote command=\"rm ${ssh.maven.dir}/${maven.zip.filename}\"/>\n    <ssh-remote command=\"chmod a+r ${ssh.maven.dir}\"/>\n\nit works for me. \n\n1. What does ant -diagnostics print?\n2. which version of jsch are you using?"}, {"attachment_id": null, "tags": [], "bug_id": 36302, "is_private": false, "count": 13, "id": 110334, "time": "2007-11-08T08:58:21Z", "creator": "ghertz@libero.it", "creation_time": "2007-11-08T08:58:21Z", "text": "I've tested your suggestion and it works fine.Thanks\nHowever, every time ssh-remote is called:\n\n1) You have to specify the path (ie, you don't make somthing like this:\n<ssh-remote command=\"cd ${remote.dir}\"/>\n<ssh-remote command=\"touch foo.txt\"/>\n\nThe foo.txt will not create in the path ${remote.dir}\", but in the $HOME of \nthe remote user\nTo make this, I ve to do : <ssh-remote command=\"touch ${remote.dir}/foo.txt\"/>\nIf I have to do another operation in the same directory, I must specify the \npath again.\n\n2) makes a new connection with the remote machine, and I don't like this thing \ntoo much.\nInstead, importing in the lib folder maverick-ant.jar, and using this syntax, \nI make all operations I need with one connection.\n\n <taskdef name=\"ssh\" classname=\"com.sshtools.ant.Ssh\" \nclasspath=\"./lib/maverick-ant.jar\"/>\n \n       <ssh host=\"${remote.host}\"\n                username=\"${remote.user}\"\n                password=\"${remote.password}\">\n                <exec cmd=\"cd ${remote.commonshare}\"/>\n                <exec cmd=\"rm -rf ${codeline.dir}-OLD\"/>\n                <exec cmd=\"mv ${codeline.dir} ${codeline.dir}-OLD\"/>\n             <sftp action=\"put\"\n                   remotedir=\"${remote.commonshare}\"\n                   verbose=\"true\">\n                   <fileset dir=\"${tmp.dir}\">\n                        <include name=\"${zip.file}\"/>\n                   </fileset>\n             </sftp>\n                <exec cmd=\"cd ${remote.commonshare}\"/>\n                <exec cmd=\"unzip ${zip.file}\"/>\n                <exec cmd=\"rm -f ${zip.file}\"/>\n        </ssh>\n\nThanks everybody for your attention and suggestions"}]
[{"attachment_id": 28080, "tags": [], "bug_id": 52349, "is_private": false, "count": 0, "id": 152233, "time": "2011-12-16T22:30:10Z", "creator": "mdlandon@gmail.com", "creation_time": "2011-12-16T22:30:10Z", "text": "Created attachment 28080\nClass + xlsx file that demonstrates bug described above.\n\nIf you have a spreadsheet containing date formatting formulas such as:\n=TEXT(A1, \"mmddyyyy\")\nthe value displayed using a FormulaEvaluator will be different for the Month than what Excel and cell.getStringCellValue().  \n\nFor example, if you have \"12/16/2011\" in A1, the formula above will return \"00162011\" using a FormulaEvaluator while Excel and cell.getStringCellValue() will return \"12162011\".\n\nAttached is a simple class and example Excel file that demonstrates the issue.  Found under java version \"1.6.0_24\" and \"1.7.0\" using poi-3.8-beta4"}, {"count": 1, "tags": [], "bug_id": 52349, "attachment_id": null, "id": 152240, "time": "2011-12-17T08:40:20Z", "creator": "apache@gagravarr.org", "creation_time": "2011-12-17T08:40:20Z", "is_private": false, "text": "Are you able to try with a few other months? And also try for a cell which has a time in it?\n\n(I'm not sure if it's a december specific bug, or if there's confusion between Month and Minute, or something else)"}, {"count": 2, "tags": [], "creator": "mdlandon@gmail.com", "attachment_id": null, "is_private": false, "id": 152251, "time": "2011-12-17T15:28:56Z", "bug_id": 52349, "creation_time": "2011-12-17T15:28:56Z", "text": "Doesn't matter which month you pick, it does the same thing.  \n\nI originally tested both with and without a time component, but the time I used had 0 minutes (and I got the same response in both cases).  You are probably right about it being a mix-up between month & minute, because if you adjust the formula from:\n    =TEXT(A1, \"mmddyyyy\")\nto\n    =TEXT(A1, \"MMddyyyy\")\nthen the FormulaEvaluator works correctly.  Looking at Excel's help (under TEXT function - Guidelines for date and time formats):\n\nhttp://office.microsoft.com/en-us/excel-help/text-function-HP010062580.aspx?CTT=5&origin=HA010277524\n\nit appears that Excel does not use the same formatting as Java's SimpleDateFormat"}, {"attachment_id": null, "tags": [], "creator": "apache@gagravarr.org", "text": "Looks like we'll need to add some extra logic to handle the differences in cases for month vs minute\n\nAre you able to track down (possibly using a debugger) where the code in question is? (That'll speed up the process of fixing it quite a bit!)", "count": 3, "id": 152258, "time": "2011-12-18T03:49:42Z", "bug_id": 52349, "creation_time": "2011-12-18T03:49:42Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 52349, "attachment_id": null, "text": "I'll try and run it through the debugger sometime this week & post results...", "id": 152266, "time": "2011-12-18T23:04:34Z", "creator": "mdlandon@gmail.com", "creation_time": "2011-12-18T23:04:34Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 52349, "attachment_id": null, "text": "Looks like the issue is probably in:\n    org.apache.poi.ss.formula.functions.TextFunction.TEXT.evaluate()\n\nAs the javadoc indicates, it's just using SimpleDateFormat:\n    * An implementation of the TEXT function\n    * TEXT returns a number value formatted with the given\n    * number formatting string. This function is not a complete implementation of\n    * the Excel function.  This function implements decimal formatting\n    * with the Java class DecimalFormat.  For date formatting this function uses\n    * the SimpleDateFormat class.", "id": 152296, "time": "2011-12-19T16:49:32Z", "creator": "mdlandon@gmail.com", "creation_time": "2011-12-19T16:49:32Z", "is_private": false}, {"count": 6, "text": "As of r1221126, the TEXT function delegates the work to DataFormatter, which already has code in it to handle the date formatting rules\n\nAs part of this, the fraction support in the TEXT function has been pulled out to DataFormatter, which didn't previously support that", "bug_id": 52349, "is_private": false, "id": 152307, "time": "2011-12-20T07:21:38Z", "creator": "apache@gagravarr.org", "creation_time": "2011-12-20T07:21:38Z", "tags": [], "attachment_id": null}]
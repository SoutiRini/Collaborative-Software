[{"count": 0, "tags": [], "creator": "ezhilraj_d@infosys.com", "attachment_id": 22107, "id": 117543, "time": "2008-06-10T09:08:30Z", "bug_id": 45178, "creation_time": "2008-06-10T09:08:30Z", "is_private": false, "text": "Created attachment 22107\nhttpd file attached.\n\nWe are have configured apache web server as load balancer using mod_jk 1.2.26 over two tomcat 5.0.28 nodes. We have Java CIFS NTLM filter in our web application to negotiate the user credentials for authenticating user. But, negotiation is not successful, we are receiving 401 / 500 status code. \n\nwe tried setting KeepAlive On but doesn't seem to work. Authentication works well when we use mod_proxy for load balancing. \n\nPlease can you assist?"}, {"count": 1, "tags": [], "bug_id": 45178, "attachment_id": null, "id": 117549, "time": "2008-06-10T10:54:19Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-06-10T10:54:19Z", "is_private": false, "text": "I think I know people, who successfully use mod_jk in combination with jCIFS NTLM.\n\nCan you please also post your file I:/Apps/Apache/2.2/conf/workers.properties.\n\nIf you disable authentication, can you get your content from Tomcat via Apache, i.e. is your basic setup working and there is only an authentication problem?\n\nDo you have the same problem, if you do not load balance and only use one Tomcat backend (via mod_jk)?\n\nIf all questions are yes:\n\nIncrease KeepAliveTimeout. By default it is 5 seconds, so it is possible though unlikely, that it expires during authentication negotiation.\n\nCheck your Tomcat and application log files, especially because you sometimes get status 500. Do you know, when you get 401 and when 500?\n\nSniff TCP to port 80 (e.g. using Wireshark) when you are the only user and reproduce the problem. How many different TCP connections get used if you only try to get one URL? Only one? If more than one, post the packet dump.\n\nCan you set JkLogLevel to trace and do one fresh test, which fails. Please then post the (hige) log file and add information, which URL you tried to retrieve. Please use a test user, because your password might be in the log file (I'm not sure at the moment)."}, {"count": 2, "tags": [], "bug_id": 45178, "attachment_id": 22113, "id": 117594, "time": "2008-06-11T22:38:32Z", "creator": "ezhilraj_d@infosys.com", "creation_time": "2008-06-11T22:38:32Z", "is_private": false, "text": "Created attachment 22113\nworker.properties file"}, {"count": 3, "tags": [], "bug_id": 45178, "attachment_id": 22114, "text": "Created attachment 22114\nJK log file after setting JKLogLevel to Trace\n\nThis log file gives the following information :\n1. Start of Apache\n2. Initialization of mod_jk and workers\n3. Request and response, sent and received for the URL  http://localhost/webtop/component/main", "id": 117595, "time": "2008-06-11T22:42:09Z", "creator": "ezhilraj_d@infosys.com", "creation_time": "2008-06-11T22:42:09Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 45178, "attachment_id": null, "text": "Thanks for your reply.\n'Yes' is my answer for your questions.\n\nI have attached the worker.properties file.\n\nMy basic LB mod_jk configuration works fine, if I don't include the filter Java CIFS filter in my application. As I mentioned before, Java CIFS is working with mod_proxy. \n\nI have attached the worker.log file for one request and response received which failed with status code 401. \n\n\nI have attached required part of tomcat logs which give relevant information on request failure. I see tomcat referring to ..conf\\jk2.properties file in log, but I have never configured JK2.\n\nI have attached packet dump for mod_jk and mod_proxy:\nwireshark-with-mod_jk.pcap - packet dump with mod_jk and JCIFS filter \nwireshark-with-mod_proxy-requires-auth.pcap - packet dump of mod_proxy till I get popup for authentication.\nwireshark-with-mod_proxy-authenticated.pcap - packet dump of mod_proxy when negotiation happens.\n\nI m unable to figure out where the issue lies. I hope I have supplied most if the information you asked for. Please can you further assist?", "id": 117596, "time": "2008-06-11T23:23:08Z", "creator": "ezhilraj_d@infosys.com", "creation_time": "2008-06-11T23:23:08Z", "is_private": false}, {"attachment_id": 22115, "tags": [], "bug_id": 45178, "text": "Created attachment 22115\nmod_jk packet dump", "count": 5, "id": 117597, "time": "2008-06-11T23:23:55Z", "creator": "ezhilraj_d@infosys.com", "creation_time": "2008-06-11T23:23:55Z", "is_private": false}, {"count": 6, "tags": [], "creator": "ezhilraj_d@infosys.com", "attachment_id": 22116, "id": 117598, "time": "2008-06-11T23:24:21Z", "bug_id": 45178, "creation_time": "2008-06-11T23:24:21Z", "is_private": false, "text": "Created attachment 22116\nmod_proxy till auth poppu comes up"}, {"count": 7, "tags": [], "creator": "ezhilraj_d@infosys.com", "attachment_id": 22117, "id": 117599, "time": "2008-06-11T23:24:57Z", "bug_id": 45178, "creation_time": "2008-06-11T23:24:57Z", "is_private": false, "text": "Created attachment 22117\nmod_proxy packet dump during negotiation"}, {"count": 8, "tags": [], "bug_id": 45178, "attachment_id": null, "id": 120128, "time": "2008-08-26T23:31:53Z", "creator": "ezhilraj_d@infosys.com", "creation_time": "2008-08-26T23:31:53Z", "is_private": false, "text": "Hi,\nI finally got to know why this configuration was not working. For our application we had a JKOption directive +FlushPackets. It seems like this directive is flushing packets from apache buffer but not the header. We got ntlm authentication working once we commented out this entry from httpd.conf file or when we added JkOptions directive +FlushHeaders. \n\nNow, everything is working fine and ntlm authentication is happening as expected.\n\nMany thanks for you help in trouble shooting this issue. "}]
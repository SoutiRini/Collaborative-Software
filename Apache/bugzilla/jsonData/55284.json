[{"count": 0, "tags": [], "text": "Created attachment 30605\nhttpd config\n\ndiscovered in 2.2.23-1.fc17\nrepleatabe in apache-2.4.4 (compiled from source)\n\n\n#0  __strcmp_sse42 () at ../sysdeps/x86_64/multiarch/strcmp-sse42.S:164\nNo locals.\n#1  0x00007f70f6a55b04 in authenticate_digest_user (r=0x7f70dc006990) at mod_auth_digest.c:1837\n        conf = 0x7f70dc00bbe0\n        resp = 0x7f70dc007f40\n        mainreq = 0x7f70dc006990\n        t = 0x7f70dc003df8 \"Digest\"\n        res = 0\n        return_code = AUTH_DENIED\n#2  0x000000000044624c in ap_run_check_user_id (r=0x7f70dc006990) at request.c:79\n        pHook = 0x13da168\n        n = 2\n        rv = -1\n#3  0x000000000044752c in ap_process_request_internal (r=0x7f70dc006990) at request.c:233\n        file_req = 0\n        access_status = -1\n        d = 0x7f70dc00bf18\n#4  0x000000000046e3b8 in ap_process_async_request (r=0x7f70dc006990) at http_request.c:315\n        c = 0x7f70ec003250\n        access_status = -1\n#5  0x000000000046a8d9 in ap_process_http_async_connection (c=0x7f70ec003250) at http_core.c:143\n        r = 0x7f70dc006990\n        cs = 0x7f70ec003228\n#6  0x000000000046aac5 in ap_process_http_connection (c=0x7f70ec003250) at http_core.c:228\nNo locals.\n#7  0x000000000045fb75 in ap_run_process_connection (c=0x7f70ec003250) at connection.c:41\n        pHook = 0x13d9eb0\n        n = 1\n        rv = -1\n#8  0x0000000000478ac9 in process_socket (thd=0x137dff0, p=0x7f70ec002f58, sock=0x7f70ec002fd0, cs=0x7f70ec0031d8, my_child_num=1, \n    my_thread_num=1) at event.c:964\n        c = 0x7f70ec003250\n        conn_id = 65\n        rc = 32624\n        sbh = 0x7f70ec0038c8\n#9  0x000000000047b0b7 in worker_thread (thd=0x137dff0, dummy=0x7f70ec000a10) at event.c:1812\n        ti = 0x7f70ec000a10\n        process_slot = 1\n        thread_slot = 1\n        csd = 0x7f70ec002fd0\n        cs = 0x7f70ec0031d8\n        ptrans = 0x7f70ec002f58\n        rv = 0\n        is_idle = 0\n        te = 0x0\n#10 0x0000003d75207d14 in start_thread (arg=0x7f70f35b5700) at pthread_create.c:309\n        __res = <optimized out>\n        pd = 0x7f70f35b5700\n        now = <optimized out>\n        unwind_buf = {cancel_jmp_buf = {{jmp_buf = {140123095914240, -3354921391018301741, 0, 263947681792, 140123095914240, 0, \n                3427532282626221779, -3383884997834266925}, mask_was_saved = 0}}, priv = {pad = {0x0, 0x0, 0x0, 0x0}, data = {prev = 0x0, \n              cleanup = 0x0, canceltype = 0}}}\n        not_first_call = 0\n        pagesize_m1 = <optimized out>\n        sp = <optimized out>\n        freesize = <optimized out>\n#11 0x0000003d74af168d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:115\n\n\nTriggered with  wget --http-user='username' --http-password='password' -S  http://localhost:801/digest/qop_none -O /dev/nul", "is_private": false, "bug_id": 55284, "id": 168677, "time": "2013-07-20T11:14:31Z", "creator": "daniel.subs@internode.on.net", "creation_time": "2013-07-20T11:14:31Z", "attachment_id": 30605}, {"count": 1, "tags": [], "bug_id": 55284, "attachment_id": 30606, "text": "Created attachment 30606\n.htaccess files in webroot", "id": 168678, "time": "2013-07-20T11:15:10Z", "creator": "daniel.subs@internode.on.net", "creation_time": "2013-07-20T11:15:10Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 55284, "is_private": false, "id": 168684, "attachment_id": null, "creator": "daniel.subs@internode.on.net", "creation_time": "2013-07-21T10:39:04Z", "time": "2013-07-21T10:39:04Z", "text": "Also was able to generate a segv by having the following directory and file in the digest directory:\n\ndigest $ more nc/.htaccess \nAuthDigestNcCheck on\n\n\nwget --http-user='username' --http-password='password' -S http://localhost:801/digest/nc/index.html -O /dev/null\n\n==> /usr/local/apache2/logs/error_log <==\n[Sun Jul 21 20:34:21.542949 2013] [core:notice] [pid 5498:tid 140470958016384] AH00052: child pid 5499 exit signal Segmentation fault (11)\n[Sun Jul 21 20:34:22.544945 2013] [core:notice] [pid 5498:tid 140470958016384] AH00052: child pid 5501 exit signal Segmentation fault (11)\n[Sun Jul 21 20:34:24.547243 2013] [core:notice] [pid 5498:tid 140470958016384] AH00052: child pid 5500 exit signal Segmentation fault (11)"}, {"count": 3, "tags": [], "bug_id": 55284, "attachment_id": null, "id": 168866, "time": "2013-07-29T00:09:56Z", "creator": "daniel.subs@internode.on.net", "creation_time": "2013-07-29T00:09:56Z", "is_private": false, "text": "\nNext segfault: digest_onetime.tar and the script digest.py\n\nCore was generated by `/usr/local/apache2/bin/httpd -k start'.\nProgram terminated with signal 8, Arithmetic exception.\n#0  0x00007f3bfab91ad2 in add_client (key=9, info=0x7f3bf6ef2950, s=0x1f0c888) at mod_auth_digest.c:859\n859         bucket = key % client_list->tbl_len;\nMissing separate debuginfos, use: debuginfo-install apr-1.4.6-1.fc17.x86_64 apr-util-1.4.1-2.fc17.x86_64 db4-4.8.30-10.fc17.x86_64 expat-2.1.0-3.1.fc17.x86_64 libgcc-4.7.2-2.fc17.x86_64 libuuid-2.21.2-4.fc17.x86_64 nss-mdns-0.10-10.fc17.x86_64 nss-myhostname-0.3-2.fc17.x86_64 nss-softokn-freebl-3.14.3-1.fc17.x86_64 pcre-8.21-7.fc17.x86_64\n(gdb) bt\n#0  0x00007f3bfab91ad2 in add_client (key=9, info=0x7f3bf6ef2950, s=0x1f0c888) at mod_auth_digest.c:859\n#1  0x00007f3bfab929db in gen_client (r=0x7f3be000c9c0) at mod_auth_digest.c:1151\n#2  0x00007f3bfab92e13 in note_digest_auth_failure (r=0x7f3be000c9c0, conf=0x7f3be0004268, resp=0x7f3be000e4f0, stale=0) at mod_auth_digest.c:1298\n#3  0x00007f3bfab94c39 in authenticate_digest_user (r=0x7f3be000c9c0) at mod_auth_digest.c:1847\n#4  0x000000000044624c in ap_run_check_user_id (r=0x7f3be000c9c0) at request.c:79\n#5  0x000000000044752c in ap_process_request_internal (r=0x7f3be000c9c0) at request.c:233\n#6  0x000000000046e3b8 in ap_process_async_request (r=0x7f3be000c9c0) at http_request.c:315\n#7  0x000000000046a8d9 in ap_process_http_async_connection (c=0x7f3bf0003220) at http_core.c:143\n#8  0x000000000046aac5 in ap_process_http_connection (c=0x7f3bf0003220) at http_core.c:228\n#9  0x000000000045fb75 in ap_run_process_connection (c=0x7f3bf0003220) at connection.c:41\n#10 0x0000000000478ac9 in process_socket (thd=0x1eb1ba0, p=0x7f3bf0002f18, sock=0x7f3bf0002fa0, cs=0x7f3bf00031a8, my_child_num=3, my_thread_num=2)\n    at event.c:964\n#11 0x000000000047b0b7 in worker_thread (thd=0x1eb1ba0, dummy=0x7f3bf00008c0) at event.c:1812\n#12 0x0000003d75207d14 in start_thread (arg=0x7f3bf6ef3700) at pthread_create.c:309\n#13 0x0000003d74af168d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:115"}, {"count": 4, "tags": [], "bug_id": 55284, "text": "Created attachment 30638\nwebroot files - digest_onetime", "id": 168867, "time": "2013-07-29T00:10:39Z", "creator": "daniel.subs@internode.on.net", "creation_time": "2013-07-29T00:10:39Z", "is_private": false, "attachment_id": 30638}, {"count": 5, "tags": [], "creator": "daniel.subs@internode.on.net", "text": "Created attachment 30639\npython script for triggering faults - requires python-requests", "id": 168868, "time": "2013-07-29T00:11:53Z", "bug_id": 55284, "creation_time": "2013-07-29T00:11:53Z", "is_private": false, "attachment_id": 30639}, {"count": 6, "tags": [], "bug_id": 55284, "attachment_id": null, "id": 168871, "time": "2013-07-29T00:24:55Z", "creator": "daniel.subs@internode.on.net", "creation_time": "2013-07-29T00:24:55Z", "is_private": false, "text": "Changing AuthDigestNonceLifetime to 10 in the digest_onetime/.htaccess file generated the following seg fault (still apache-2.4.4).\n\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib64/libthread_db.so.1\".\nCore was generated by `/usr/local/apache2/bin/httpd -k start'.\nProgram terminated with signal 11, Segmentation fault.\n#0  0x00007f3bfab91d58 in add_client (key=6, info=0x7f3beaff4950, s=0x1ef32e8) at mod_auth_digest.c:887\n887         entry->next = client_list->table[bucket];\nMissing separate debuginfos, use: debuginfo-install apr-1.4.6-1.fc17.x86_64 apr-util-1.4.1-2.fc17.x86_64 db4-4.8.30-10.fc17.x86_64 expat-2.1.0-3.1.fc17.x86_64 libgcc-4.7.2-2.fc17.x86_64 libuuid-2.21.2-4.fc17.x86_64 nss-mdns-0.10-10.fc17.x86_64 nss-myhostname-0.3-2.fc17.x86_64 nss-softokn-freebl-3.14.3-1.fc17.x86_64 pcre-8.21-7.fc17.x86_64\n(gdb) bt\n#0  0x00007f3bfab91d58 in add_client (key=6, info=0x7f3beaff4950, s=0x1ef32e8) at mod_auth_digest.c:887\n#1  0x00007f3bfab929db in gen_client (r=0x7f3bd8002970) at mod_auth_digest.c:1151\n#2  0x00007f3bfab92e13 in note_digest_auth_failure (r=0x7f3bd8002970, conf=0x7f3bd80082f8, resp=0x7f3bd80044a0, stale=0) at mod_auth_digest.c:1298\n#3  0x00007f3bfab94c39 in authenticate_digest_user (r=0x7f3bd8002970) at mod_auth_digest.c:1847\n#4  0x000000000044624c in ap_run_check_user_id (r=0x7f3bd8002970) at request.c:79\n#5  0x000000000044752c in ap_process_request_internal (r=0x7f3bd8002970) at request.c:233\n#6  0x000000000046e3b8 in ap_process_async_request (r=0x7f3bd8002970) at http_request.c:315\n#7  0x000000000046a8d9 in ap_process_http_async_connection (c=0x7f3bf00054a0) at http_core.c:143\n#8  0x000000000046aac5 in ap_process_http_connection (c=0x7f3bf00054a0) at http_core.c:228\n#9  0x000000000045fb75 in ap_run_process_connection (c=0x7f3bf00054a0) at connection.c:41\n#10 0x0000000000478ac9 in process_socket (thd=0x1e7a470, p=0x7f3bf0005198, sock=0x7f3bf0005220, cs=0x7f3bf0005428, my_child_num=2, my_thread_num=17)\n    at event.c:964\n#11 0x000000000047b0b7 in worker_thread (thd=0x1e7a470, dummy=0x7f3bf00019b0) at event.c:1812\n#12 0x0000003d75207d14 in start_thread (arg=0x7f3beaff5700) at pthread_create.c:309\n#13 0x0000003d74af168d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:115"}, {"count": 7, "tags": [], "creator": "daniel.subs@internode.on.net", "text": "log message to previous:\n\n==> /usr/local/apache2/logs/error_log <==\n[Mon Jul 29 10:22:14.356396 2013] [auth_digest:error] [pid 1707:tid 139895322400512] [client 127.0.0.1:60007] AH01787: received invalid opaque - got `'\n[Mon Jul 29 10:22:14.561615 2013] [core:notice] [pid 7872:tid 139895619991424] AH00051: child pid 1707 exit signal Segmentation fault (11), possible coredump in /tmp", "id": 168872, "time": "2013-07-29T00:26:15Z", "bug_id": 55284, "creation_time": "2013-07-29T00:26:15Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 55284, "attachment_id": null, "id": 168917, "time": "2013-07-29T17:05:25Z", "creator": "minfrin@sharp.fm", "creation_time": "2013-07-29T17:05:25Z", "is_private": false, "text": "Can you try this patch and verify whether it works?\n\nIndex: modules/aaa/mod_auth_digest.c\n===================================================================\n--- modules/aaa/mod_auth_digest.c\t(revision 1506737)\n+++ modules/aaa/mod_auth_digest.c\t(working copy)\n@@ -1691,7 +1691,15 @@\n         return HTTP_UNAUTHORIZED;\n     }\n \n-    if (strcmp(resp->realm, conf->realm)) {\n+    if (!conf->realm) {\n+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r, APLOGNO(02486)\n+                      \"realm mismatch - got `%s' but no realm specified\",\n+                      resp->realm);\n+        note_digest_auth_failure(r, conf, resp, 0);\n+        return HTTP_UNAUTHORIZED;\n+    }\n+\n+    if (!resp->realm || strcmp(resp->realm, conf->realm)) {\n         ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r, APLOGNO(01788)\n                       \"realm mismatch - got `%s' but expected `%s'\",\n                       resp->realm, conf->realm);"}, {"count": 9, "tags": [], "bug_id": 55284, "is_private": false, "id": 168930, "attachment_id": null, "creator": "daniel.subs@internode.on.net", "creation_time": "2013-07-29T23:39:06Z", "time": "2013-07-29T23:39:06Z", "text": "(In reply to Graham Leggett from comment #8)\n> Can you try this patch and verify whether it works?\n> \n\nIt did fix  wget --http-user='username' --http-password='password' -S  http://localhost:801/digest/qop_none -O /dev/null\n\n\nUnfixed is (apache2.4.4 only):\n\nwget --http-user='username' --http-password='password' -S http://localhost:801/digest/nc/index.html -O /dev/null\n\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib64/libthread_db.so.1\".\nCore was generated by `/usr/local/apache2/bin/httpd -k start'.\nProgram terminated with signal 11, Segmentation fault.\n#0  __GI_____strtol_l_internal (nptr=0x0, endptr=0x7f9be6ff4a58, base=16, group=<optimized out>, loc=0x3d74db1020) at ../stdlib/strtol_l.c:298\n298       while (ISSPACE (*s))\nMissing separate debuginfos, use: debuginfo-install apr-1.4.6-1.fc17.x86_64 apr-util-1.4.1-2.fc17.x86_64 db4-4.8.30-10.fc17.x86_64 expat-2.1.0-3.1.fc17.x86_64 libgcc-4.7.2-2.fc17.x86_64 libuuid-2.21.2-4.fc17.x86_64 nss-mdns-0.10-10.fc17.x86_64 nss-myhostname-0.3-2.fc17.x86_64 nss-softokn-freebl-3.14.3-1.fc17.x86_64 pcre-8.21-7.fc17.x86_64\n(gdb) bt\n#0  __GI_____strtol_l_internal (nptr=0x0, endptr=0x7f9be6ff4a58, base=16, group=<optimized out>, loc=0x3d74db1020) at ../stdlib/strtol_l.c:298\n#1  0x00007f9bf3bfc47e in check_nc (r=0x7f9bd80089a0, resp=0x7f9bd8009f60, conf=0x7f9bd800be78) at mod_auth_digest.c:1495\n#2  0x00007f9bf3bfe362 in authenticate_digest_user (r=0x7f9bd80089a0) at mod_auth_digest.c:1949\n#3  0x000000000044624c in ap_run_check_user_id (r=0x7f9bd80089a0) at request.c:79\n#4  0x000000000044752c in ap_process_request_internal (r=0x7f9bd80089a0) at request.c:233\n#5  0x000000000046e3b8 in ap_process_async_request (r=0x7f9bd80089a0) at http_request.c:315\n#6  0x000000000046a8d9 in ap_process_http_async_connection (c=0x7f9bec003520) at http_core.c:143\n#7  0x000000000046aac5 in ap_process_http_connection (c=0x7f9bec003520) at http_core.c:228\n#8  0x000000000045fb75 in ap_run_process_connection (c=0x7f9bec003520) at connection.c:41\n#9  0x0000000000478ac9 in process_socket (thd=0x26ac1d0, p=0x7f9bec003218, sock=0x7f9bec0032a0, cs=0x7f9bec0034a8, my_child_num=0, my_thread_num=11)\n    at event.c:964\n#10 0x000000000047b0b7 in worker_thread (thd=0x26ac1d0, dummy=0x7f9bec001730) at event.c:1812\n#11 0x0000003d75207d14 in start_thread (arg=0x7f9be6ff5700) at pthread_create.c:309\n#12 0x0000003d74af168d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:115\n(gdb) up\n#1  0x00007f9bf3bfc47e in check_nc (r=0x7f9bd80089a0, resp=0x7f9bd8009f60, conf=0x7f9bd800be78) at mod_auth_digest.c:1495\n1495        nc = strtol(snc, &endptr, 16);\n(gdb) list\n1490            }\n1491            /* qop is none, cannot check nonce count */\n1492            return OK;\n1493        }\n1494\n1495        nc = strtol(snc, &endptr, 16);\n1496        if (endptr < (snc+strlen(snc)) && !apr_isspace(*endptr)) {\n1497            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r, APLOGNO(01773)\n1498                          \"invalid nc %s received - not a number\", snc);\n1499            return !OK;\n\n\n\nGET http://localhost:801/digest/\nwith the following headers failed {'Content-Length': '0', 'Authorization': '\\n        Digest username=\"username\",\\n        algorithm=\"MD5\",\\n        realm=\"digest private area\",\\n        uri=\"/digest/\",\\n        nonce=\"2mVN7K7iBAA=7b1dbe7c698f1691a19944afebef1c40b7e9e024\",\\n        cnonce=\"\",\\n        nc=\"\",\\n        qop=auth,\\n        response=\"b30e94d7c2a265c8db99ea33ec2de3b2\"\\n    '}\n\nThis occurred after editing /var/www/html/digest_onetime/.htaccess to:\nAuthType Digest\nAuthName \"digest private area\"\nAuthDigestDomain /digest_onetime/\nAuthBasicProvider file\nAuthUserFile /var/www/html/digest_onetime/.htpasswd\nAuthDigestNonceLifetime 10\nRequire valid-user\n\nIt looks like come configs here are more global or at least not cascaded right. I'll tar up the entire webroot just to be sure.\n\nwith the following core dump.\n\nCore was generated by `/usr/local/apache2/bin/httpd -k start'.\nProgram terminated with signal 11, Segmentation fault.\n#0  0x00007f9bf3bfad58 in add_client (key=6, info=0x7f9be77f5560, s=0x26a9508) at mod_auth_digest.c:887\n887         entry->next = client_list->table[bucket];\nMissing separate debuginfos, use: debuginfo-install apr-1.4.6-1.fc17.x86_64 apr-util-1.4.1-2.fc17.x86_64 db4-4.8.30-10.fc17.x86_64 expat-2.1.0-3.1.fc17.x86_64 libgcc-4.7.2-2.fc17.x86_64 libuuid-2.21.2-4.fc17.x86_64 nss-mdns-0.10-10.fc17.x86_64 nss-myhostname-0.3-2.fc17.x86_64 nss-softokn-freebl-3.14.3-1.fc17.x86_64 pcre-8.21-7.fc17.x86_64\n(gdb) list\n882\n883         /* now add the entry */\n884\n885         memcpy(entry, info, sizeof(client_entry));\n886         entry->key  = key;\n887         entry->next = client_list->table[bucket];\n888         client_list->table[bucket] = entry;\n889         client_list->num_created++;\n890         client_list->num_entries++;\n891\n(gdb) bt\n#0  0x00007f9bf3bfad58 in add_client (key=6, info=0x7f9be77f5560, s=0x26a9508) at mod_auth_digest.c:887\n#1  0x00007f9bf3bfb9db in gen_client (r=0x7f9bd4008990) at mod_auth_digest.c:1151\n#2  0x00007f9bf3bfbda3 in note_digest_auth_failure (r=0x7f9bd4008990, conf=0x7f9bd400be88, resp=0x7f9bd8008470, stale=0) at mod_auth_digest.c:1289\n#3  0x00007f9bf3bfe382 in authenticate_digest_user (r=0x7f9bd4008990) at mod_auth_digest.c:1950\n#4  0x000000000044624c in ap_run_check_user_id (r=0x7f9bd4008990) at request.c:79\n#5  0x000000000044752c in ap_process_request_internal (r=0x7f9bd4008990) at request.c:233\n#6  0x000000000044b602 in ap_sub_req_lookup_dirent (dirent=0x7f9be77f5a00, r=0x7f9bd8006990, subtype=0, next_filter=0x0) at request.c:2182\n#7  0x00007f9bf23c5990 in make_autoindex_entry (dirent=0x7f9be77f5a00, autoindex_opts=1048576, d=0x26fc4d8, r=0x7f9bd8006990, keyid=78 'N', \n    direction=65 'A', pattern=0x0) at mod_autoindex.c:1335\n#8  0x00007f9bf23c8757 in index_directory (r=0x7f9bd8006990, autoindex_conf=0x26fc4d8) at mod_autoindex.c:2238\n#9  0x00007f9bf23c89c7 in handle_autoindex (r=0x7f9bd8006990) at mod_autoindex.c:2308\n#10 0x000000000045299e in ap_run_handler (r=0x7f9bd8006990) at config.c:169\n#11 0x00000000004532ec in ap_invoke_handler (r=0x7f9bd8006990) at config.c:432\n#12 0x000000000046e3cd in ap_process_async_request (r=0x7f9bd8006990) at http_request.c:317\n#13 0x000000000046a8d9 in ap_process_http_async_connection (c=0x7f9bec003240) at http_core.c:143\n#14 0x000000000046aac5 in ap_process_http_connection (c=0x7f9bec003240) at http_core.c:228\n#15 0x000000000045fb75 in ap_run_process_connection (c=0x7f9bec003240) at connection.c:41\n#16 0x0000000000478ac9 in process_socket (thd=0x26ac1a0, p=0x7f9bec002f38, sock=0x7f9bec002fc0, cs=0x7f9bec0031c8, my_child_num=1, my_thread_num=10)\n    at event.c:964\n#17 0x000000000047b0b7 in worker_thread (thd=0x26ac1a0, dummy=0x7f9bec0008c0) at event.c:1812\n#18 0x0000003d75207d14 in start_thread (arg=0x7f9be77f6700) at pthread_create.c:309\n#19 0x0000003d74af168d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:115"}, {"count": 10, "tags": [], "bug_id": 55284, "text": "Created attachment 30648\nwebroot files (all)", "id": 168931, "time": "2013-07-29T23:40:10Z", "creator": "daniel.subs@internode.on.net", "creation_time": "2013-07-29T23:40:10Z", "is_private": false, "attachment_id": 30648}, {"count": 11, "tags": [], "bug_id": 55284, "attachment_id": null, "text": "note the last still failing case in comment 10 is very close to bug #55286", "id": 168932, "time": "2013-07-29T23:50:32Z", "creator": "daniel.subs@internode.on.net", "creation_time": "2013-07-29T23:50:32Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 26128, "text": "I have a chain of ant invocations in my project (cruisecontrol -> main build\nfile -> utility library), and I'm seeing property values change from one level\nto the next.  A simple example follows:\n\n---------------- 1.xml ----------------\n<project name=\"1\" basedir=\".\" default=\"test\">\n  <target name=\"test\" description=\"level 1\">\n    <ant antfile=\"2.xml\" dir=\".\" inheritall=\"true\">\n      <property name=\"test.property\" value=\"1\"/>\n    </ant>\n  </target>\n</project>\n\n---------------- 2.xml ----------------\n<project name=\"2\" basedir=\".\" default=\"test\">\n  <target name=\"test\" description=\"level 2\">\n    <echo message=\"level 2 test.property before = ${test.property}\"/>\n    <ant antfile=\"3.xml\" dir=\".\" inheritall=\"true\">\n      <property name=\"test.property\" value=\"2\"/>\n    </ant>\n  </target>\n</project>\n\n---------------- 3.xml ----------------\n<project name=\"3\" default=\"test\" basedir=\".\">\n  <target name=\"test\" description=\"level 3\">\n    <echo message=\"level 3 test.property before = ${test.property}\"/>\n    <property name=\"test.property\" value=\"3\"/>\n    <echo message=\"level 3 test.property after = ${test.property}\"/>\n  </target>\n</project>\n\nWhen I invoke:\nant -f 1.xml\nI get: level 3 test.property before = 2\n\nIf in 2.xml the property statement is not embedded in the <ant> task,\neverything works as expected, but I can't use this in my real project,\nsince I have multiple embedded invocations of the library task with different\nproperty values.  If options are passed from the command line, everything\nworks as well.\n\nSuggestions for work arounds are very welcome.  I can provide additional details\nas needed.\nThanks,\nDave", "id": 50546, "time": "2004-01-14T15:43:22Z", "creator": "daveg@permabit.com", "creation_time": "2004-01-14T15:43:22Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "peter.reilly@corvil.com", "attachment_id": null, "text": "This seems to be working exactly as designed/documented.\nThis is documented in the\nmanual entry for ant\nhttp://ant.apache.org/manual/CoreTasks/ant.html\n\nThe <property/> nested element in 2.xml is allowed to\noverride the \"test.property\" property unless the \"test.property\"\nproperty is a user property.", "id": 50548, "time": "2004-01-14T16:05:43Z", "bug_id": 26128, "creation_time": "2004-01-14T16:05:43Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 26128, "attachment_id": null, "id": 50549, "time": "2004-01-14T16:16:35Z", "creator": "daveg@permabit.com", "creation_time": "2004-01-14T16:16:35Z", "is_private": false, "text": "From looking at the code, I understand the design, although the documentation\nstill seems vague.  Given that there is no way for me to mark my properties\nas \"user\" properties from the equivalent of 1.xml, how can I accomplish what\nI need to do?"}, {"count": 3, "tags": [], "bug_id": 26128, "text": "The doc is a little vague for \"inherited\" properties.\nThe easiest way to solve the problem is to\nwrite a custom task to set userproperties:\n\n    package task;\n    import org.apache.tools.ant.taskdefs.Property;\n    public class UserProperty extends Property {\n       public UserProperty() {\n          super(true); // set this as a user property\n       }\n       // Property#addProperty is incorrect for user properties\n       public void addProperty(String n, String v) {\n          if (getProject().getUserProperty(n) == null) {\n             getProject().setUserProperty(n, v);\n          } else {\n             log(\"Override ignored for \" + n, Project.MSG_VERBOSE);\n          }\n       }\n    }\n\n<project name=\"1\" basedir=\".\" default=\"test\">\n  <taskdef name=\"userproperty\" classname=\"task.UserProperty\"/>\n  <userproperty name=\"test.property\" value=\"1\"/>\n  <target name=\"test\" description=\"level 1\">\n    <ant antfile=\"2.xml\" dir=\".\" inheritall=\"true\"/>\n  </target>\n</project>\n\n", "id": 50550, "time": "2004-01-14T16:37:35Z", "creator": "peter.reilly@corvil.com", "creation_time": "2004-01-14T16:37:35Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 26128, "text": "Thank you for your comments, they have been very\nhelpful.  I might suggest that a simpler mechanism\nbe added without resorting to custom tasks, but\nthis is certainly sufficient for now.  Would\nyou like to leave this as an enhancement request,\nor should I resolve the ticker?\n\nThanks again,\nDave", "id": 50559, "time": "2004-01-14T17:38:23Z", "creator": "daveg@permabit.com", "creation_time": "2004-01-14T17:38:23Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "peter.reilly@corvil.com", "attachment_id": null, "text": "I think that it should be resolved as wontfix, but\nyou can make it a enhancment if required.\nCheers, Peter", "id": 50588, "time": "2004-01-15T10:35:41Z", "bug_id": 26128, "creation_time": "2004-01-15T10:35:41Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 26128, "text": "Thanks,\nDave", "id": 50605, "time": "2004-01-15T17:19:06Z", "creator": "daveg@permabit.com", "creation_time": "2004-01-15T17:19:06Z", "is_private": false, "attachment_id": null}]
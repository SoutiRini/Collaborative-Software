[{"count": 0, "tags": [], "creator": "knu@iDaemons.org", "attachment_id": null, "id": 59424, "time": "2004-06-17T15:24:33Z", "bug_id": 29644, "creation_time": "2004-06-17T15:24:33Z", "is_private": false, "text": "mod_proxy keeps downloading from a target server even after the client\ndisconnects.  I can observe this with Apache 2.0.49 + mod_proxy (loaded as a\ndynamic module) both on FreeBSD 4.9-STABLE and on Debian GNU/Linux\ntesting/unstable as of 2004-06-17.\n\nThis is critical when the download is an endless audio/videa stream because it\nnever ends.\n\n\nHow to repeat:\n\n1. Set up Apache2 + mod_proxy as a forward proxy server:\n\nLoadModule proxy_module /usr/lib/apache2/modules/mod_proxy.so                   \nLoadModule proxy_http_module /usr/lib/apache2/modules/mod_proxy_http.so \n\n<IfModule mod_proxy.c>\n        ProxyRequests On\n        <Proxy *>\n                Order deny,allow\n                Deny from all\n                Allow from .localdomain.example.org\n        </Proxy>\n</IfModule>\n\n2. Start downloading a big file using the proxy server and interrupt the download:\n\n$ env http_proxy=http://dragon:80/ wget\nhttp://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.7.tar.gz \n--23:23:15--  http://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.7.tar.gz\n           => `linux-2.6.7.tar.gz.2'\nResolving dragon... 192.168.1.96\nConnecting to dragon[192.168.1.96]:80... connected.\nProxy request sent, awaiting response... 200 OK\nLength: 44,006,970 [application/x-gzip]\n\n 0% [                                                         ] 300,028     \n426.41K/s             \n^C\n$ \n\n3. See a zombie connection between apache and the target server still going on:\n\n$ netstat | fgrep kernel.org\ntcp        0      0 dragon.local.idaem:1078 zeus-pub.kernel.org:www ESTABLISHED\n$ \n\n(The above log was taken on a Debian host)"}, {"count": 1, "tags": [], "bug_id": 29644, "text": "On freebsd4.3, pc, \nwhen httpd-2.0.50 proxied large file, and client disconnects during download, \nApache still continue downloading file from source server. It always leads to \nCPU overloading, even if RLimitCPU in httpd.conf assigned.", "id": 62321, "attachment_id": null, "creator": "lexx@sb8586.irk.ru", "creation_time": "2004-08-23T02:01:40Z", "time": "2004-08-23T02:01:40Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 29644, "attachment_id": null, "text": "Just for the records. RLimitCPU isn't intended to affect apache processes, but\nforked CGIs.", "id": 62325, "time": "2004-08-23T05:17:43Z", "creator": "nd@perlig.de", "creation_time": "2004-08-23T05:17:43Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 29644, "text": "Patch for this bug can found from bug #32443.\n\n*** This bug has been marked as a duplicate of 32443 ***", "id": 69492, "attachment_id": null, "creator": "janne@cemron.com", "creation_time": "2005-01-10T17:13:12Z", "time": "2005-01-10T17:13:12Z", "is_private": false}, {"count": 4, "tags": [], "creator": "shravan.shashikant@gmail.com", "attachment_id": null, "id": 69858, "time": "2005-01-20T06:38:03Z", "bug_id": 29644, "creation_time": "2005-01-20T06:38:03Z", "is_private": false, "text": "(In reply to comment #3)\n> Patch for this bug can found from bug #32443.\n> \n> *** This bug has been marked as a duplicate of 32443 ***\n\nThanks Janne. Problem solved with compiled changes on httpd-2.0.52,mod_proxy on\nMDK 10(2.6.3-7).\n"}]
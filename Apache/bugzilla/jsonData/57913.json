[{"count": 0, "tags": [], "bug_id": 57913, "attachment_id": 32725, "is_private": false, "id": 182914, "time": "2015-05-10T19:08:38Z", "creator": "benoit.vatan@gmail.com", "creation_time": "2015-05-10T19:08:38Z", "text": "Created attachment 32725\nPatch for backing JMX file when saving\n\nAfter an OOME occured while saving my test plan, a significant part of it was lost and made the whole work unusable without \"handworking\" the XML. Given that no recent copy of my work was available to me anymore, I was really angry and in bad situatio, lesson learnt : don't ever forget backing up your work.\n\nI thus have brought some enhancement to the JMX save process so that it keeps a copy istory of the last saved JMX.\n\nWhat's more I am aware that this did happened to someone else so I come to the conclusion that sharing it might be usefull to someone else.\n\nThe attached patch adds logic to the JMX save process so that the last saved JMX file is copied with a timestamp suffix.\n\nuser.properties contains properties to control backup history :\n\n# Enable backup history, defaults to true\n# Set to false to return to the default behaviour\n#jmeter.gui.action.save.backup_when_saving=true\n\n# Set the max number of hours that existing backups are kept\n# older backups are delete when a save operation occurs\n# Default is keep backup for ever\n#jmeter.gui.action.save.keep_backup_max_hours=0\n\n# Set maximum number of backup to be kept\n# Default is 10, so while we set no max_hours we only keep at most 10 backups\n#jmeter.gui.action.save.keep_backup_max_count=10\n\nBackup files are created in a subdirectory of the main JMX file and is named from the JMX name suffixed with \".backups\"\n\nExample:\n\nWe are saving to an existing jmeter.jmx file in some /path/to directory , we'll then have :\n\n/path/to/jmeter.jmx\n/path/to/jmeter.jmx.backups\n\nwhere /path/to/jmeterx.jmx.backups will contains the backups history :\njmeter.jmx.20150502-180909\njmeter.jmx.20150502-180911\njmeter.jmx.20150502-180915\njmeter.jmx.20150502-180916\njmeter.jmx.20150502-180917\njmeter.jmx.20150502-180919\njmeter.jmx.20150502-180920\njmeter.jmx.20150502-180921\njmeter.jmx.20150502-180922\njmeter.jmx.20150502-180923\n\nThis would prevent anyone to lose work anymore...\n\nRegards.\nBenoit"}, {"count": 1, "tags": [], "creator": "felix.schumacher@internetallee.de", "is_private": false, "text": "I think the general idea is great. Nobody likes it, when their work vanishes while saving. Even when it saves correctly, one might have done something stupid and would like to have it back.\n\nI wonder, if it would be nicer to enumerate the backup files and keep the .jmx suffix. The time and date of the save operation, will most probably be available by looking at the file stats. And I don't know if I like the idea of a directory called after the file name.\n\nApart from that, a few nitpicks:\n\n* instead of backup_when_saving I would have chosen backup_on_save or backup_before_save\n* One comment is \"... everything when right...\" where it probably should be \"... everything went right ...\"\n* deleteMe variable could be renamed to expiredBackupFile or something alike\n* in javadoc shorten the code tag in line 249ff to enclose only code fragments, that way true and false could be tagged as code as well\n* The variable emptyList in line 265 could probably be inlined in line 270\n* line 297 \"expiry date\" or your \"cutoff date\" instead of \"oldest date\"?", "id": 182916, "time": "2015-05-10T19:52:58Z", "bug_id": 57913, "creation_time": "2015-05-10T19:52:58Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 57913, "text": "Hi,\nThanks for great contribution. As Felix I think it is very useful feature that I have seen requested many times.\nFew notes:\n1/I think properties should be in jmeter.properties:\n2/ Local variables that are initialized from JMeterUtils.getPropDefault should be static final constants\n\n\nRegards", "id": 182918, "time": "2015-05-10T20:27:02Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2015-05-10T20:27:02Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 57913, "text": "Creating a backup subdirectory after the JMX file does not smell good to me either. At first backups were stored directly in the same directory as the JMX file, but this quickly mess the directory up, hence the .backup subdir. \n\nWouldn't it be better to have some default backup directory, say in JMETER_HOME/backups or something ? This could be controlled by some jmeter.property with a default destination that could be user overridden in user.property ? This would then leave the JMX save directory as clean as possible. \n\nI will update the code and provide a patch after your above comments. \n\nThanks for your feedback.\n\nBenoit.", "id": 182919, "time": "2015-05-10T21:11:12Z", "creator": "benoit.vatan@gmail.com", "creation_time": "2015-05-10T21:11:12Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 57913, "attachment_id": 32730, "is_private": false, "id": 182946, "time": "2015-05-11T22:06:09Z", "creator": "benoit.vatan@gmail.com", "creation_time": "2015-05-11T22:06:09Z", "text": "Created attachment 32730\nauto-save patch update after first comments (v2)"}, {"count": 5, "tags": [], "bug_id": 57913, "attachment_id": null, "is_private": false, "id": 182947, "time": "2015-05-11T22:14:26Z", "creator": "benoit.vatan@gmail.com", "creation_time": "2015-05-11T22:14:26Z", "text": "Here it is,\n\nI think I have updated the patch to take all your remarks into account.\n\nBackup files are now stored by default in ${JMETER_HOME}/backups unless jmeter.gui.action.save.backup_directory is set to a different location.\n\njmeter.gui.action.save.backup_on_save has been renamed according to Felix's advice.\n\nBackup file names are now timestamp free, replaced by a version number auto-incremented from the highest version found in the already existing backup files.\n\nBackup extensions is now .jmx instead of a timestamp.\n\nI have rework the code to make it simpler and make use of commons-io filters. Reworked the javado, mistyped comments and renamed variable names as well according to your recommandations.\n\nProperties have been moved to system.properties with the default values.\n\nI have updated hints_and_tips documentation but I'm not sure of the format so it might have to be checked.\n\nRegards."}, {"count": 6, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "text": "Date: Tue May 12 21:03:51 2015\nNew Revision: 1679098\n\nURL: http://svn.apache.org/r1679098\nLog:\nBug 57913 - Automated backups of last saved JMX files\nBugzilla Id: 57913\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/gui/action/Save.java\n    jmeter/trunk/xdocs/changes.xml\n    jmeter/trunk/xdocs/usermanual/hints_and_tips.xml", "id": 182966, "time": "2015-05-12T21:04:37Z", "bug_id": 57913, "creation_time": "2015-05-12T21:04:37Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 57913, "attachment_id": null, "is_private": false, "id": 182967, "time": "2015-05-12T21:04:54Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2015-05-12T21:04:54Z", "text": "Thanks a lot for your contribution.\nRegards"}, {"count": 8, "tags": [], "bug_id": 57913, "text": "Date: Fri Jun  5 20:15:35 2015\nNew Revision: 1683855\n\nURL: http://svn.apache.org/r1683855\nLog:\nBug 57913 - Automated backups of last saved JMX files\nAdd related properties to jmeter.properties\nBugzilla Id: 57913\n\nModified:\n    jmeter/trunk/bin/jmeter.properties", "id": 183337, "time": "2015-06-05T20:16:26Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2015-06-05T20:16:26Z", "is_private": false, "attachment_id": null}, {"count": 9, "attachment_id": null, "bug_id": 57913, "text": "\n\nIf you save a new file (the first time), you have a error in jmeter.log:\n\n2015/06/07 09:24:09 INFO  - jmeter.services.FileServer: Default base='/home/milamber/W-workspaces/Workspaces-JMeter/Jmeter/bin' \n2015/06/07 09:24:09 INFO  - jmeter.services.FileServer: Set new base='/home/milamber/W-workspaces/Workspaces-JMeter/Jmeter/bin' \n2015/06/07 09:24:09 ERROR - jmeter.gui.action.Save: Failed to backup file :/home/milamber/W-workspaces/Workspaces-JMeter/Jmeter/bin/Thread Group.jmx java.io.FileNotFoundException: Source '/home/milamber/W-workspaces/Workspaces-JMeter/Jmeter/bin/Thread Group.jmx' does not exist\n\tat org.apache.commons.io.FileUtils.copyFile(FileUtils.java:1074)\n\tat org.apache.commons.io.FileUtils.copyFile(FileUtils.java:1038)\n\tat org.apache.jmeter.gui.action.Save.createBackupFile(Save.java:379)\n\tat org.apache.jmeter.gui.action.Save.doAction(Save.java:213)\n\tat org.apache.jmeter.gui.action.ActionRouter.performAction(ActionRouter.java:81)\n\tat org.apache.jmeter.gui.action.ActionRouter.access$0(ActionRouter.java:69)\n\tat org.apache.jmeter.gui.action.ActionRouter$1.run(ActionRouter.java:63)\n\tat java.awt.event.InvocationEvent.dispatch(InvocationEvent.java:312)\n\tat java.awt.EventQueue.dispatchEventImpl(EventQueue.java:733)\n\tat java.awt.EventQueue.access$200(EventQueue.java:103)\n\tat java.awt.EventQueue$3.run(EventQueue.java:694)\n\tat java.awt.EventQueue$3.run(EventQueue.java:692)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.security.ProtectionDomain$1.doIntersectionPrivilege(ProtectionDomain.java:76)\n\tat java.awt.EventQueue.dispatchEvent(EventQueue.java:703)\n\tat java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:242)\n\tat java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:161)\n\tat java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:150)\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:146)\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:138)\n\tat java.awt.EventDispatchThread.run(EventDispatchThread.java:91)\n\n\nI think a test condition must be adding before create the backup file (don't copy if that is the first save)", "id": 183342, "time": "2015-06-07T08:54:31Z", "creator": "milamber@apache.org", "creation_time": "2015-06-07T08:54:31Z", "tags": [], "is_private": false}, {"count": 10, "attachment_id": null, "bug_id": 57913, "text": "Date: Sun Jun  7 12:42:42 2015\nNew Revision: 1684029\n\nURL: http://svn.apache.org/r1684029\nLog:\nBug 57913 - Automated backups of last saved JMX files\nOnly backup file, if it exists (otherwise we get an exception on first save of a file).\n\nBugzilla Id: 57913\n\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/gui/action/Save.java", "id": 183344, "time": "2015-06-07T12:43:46Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2015-06-07T12:43:46Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 47119, "attachment_id": null, "text": "Reproducer:\n\n    <macrodef name=\"echotest\">\n      <attribute name=\"foo\" default=\"${foo}\" />\n      <attribute name=\"bar\" default=\"${@{foo}}\" />\n      <sequential>\n        <echo message=\"foo is [@{foo}]\" />\n        <echo message=\"bar is [@{bar}]\" />\n      </sequential>\n    </macrodef>\n\n    <property name=\"foo\" value=\"bar\" />\n    <property name=\"bar\" value=\"baz\" />\n\n    <echotest />\n\nOutput:\n\n     [echo] foo is [bar]\n     [echo] bar is [${${foo}}]           --> bug, expect 'bar is [baz]'", "id": 126628, "time": "2009-04-29T12:43:09Z", "creator": "vladimir_egorov@yahoo.com", "creation_time": "2009-04-29T12:43:09Z", "is_private": false}, {"count": 1, "attachment_id": null, "creator": "vladimir_egorov@yahoo.com", "text": "Suggested fix:\n\nadd the following line\n\n      value = getProject().replaceProperties(value);\n\nat line 343 org/apache/tools/ant/taskdefs/MacroInstance.java (the line number is from 1.6.5 source). The surrounding code looks like this:\n\n      ...\n      if (value == null) {\n        throw new BuildException(\"required attribute \" + attribute.getName()\n            + \" not set\");\n      }\n      value = getProject().replaceProperties(value);\n      localProperties.put(attribute.getName(), value);\n      copyKeys.remove(attribute.getName());\n      ...\n\nIf I can get permission, I can make the change and add tests.\n\n--Vladimir", "id": 126632, "time": "2009-04-29T15:55:47Z", "bug_id": 47119, "creation_time": "2009-04-29T15:55:47Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "text": "properties do get resolved;\n<project>\n  <property name=\"x\" value=\"this is x\"/>\n  <macrodef name=\"run\">\n    <attribute name=\"a\" default=\"${x}\"/>\n    <sequential>\n      <echo>a is @{a}</echo>\n    </sequential>\n  </macrodef>\n  <run/>\n</project>\n\ni.e. they get resolve at the time of macro declaration,\nbut not at the time of macro use.\n\nI am not sure that it is a good idea to resolve them\nagain at run time.", "is_private": false, "id": 126640, "creation_time": "2009-04-30T00:49:17Z", "time": "2009-04-30T00:49:17Z", "creator": "peterreilly@apache.org", "bug_id": 47119, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 47119, "attachment_id": null, "text": "Thanks for your review. Yes, properties do get replaced at macro declaration time. This request is to also replace them at macro call time.\n\nNote that currently, the behavior is inconsistent: property in foo attribute got replaced, but not in bar.\n\nI would think that expression like ${${foo}} is most likely not what user had intended. Is there any reason to want this?\n\nThis limitation keeps coming up in our framework. We like to use macrodef' feature of providing defaults for attributes in terms of previously defined attributes. But this breaks down, unexpectedly, when we try to use properties. Our users are telling us that we should fix this in the framework.", "id": 126659, "time": "2009-04-30T09:27:08Z", "creator": "vladimir_egorov@yahoo.com", "creation_time": "2009-04-30T09:27:08Z", "is_private": false}]
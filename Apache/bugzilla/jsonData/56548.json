[{"count": 0, "tags": [], "bug_id": 56548, "attachment_id": null, "text": "If a new CellStyle is created and the fillBackgroundColor and fillForegroundColor are set using the values from the column's default style, then both the foreground and background colors are set to 64 which is intended to represent AUTOMATIC. Microsoft's documentation, though, indicates that 64 is the system foreground color and 65 is the system background color.\n\nhttp://msdn.microsoft.com/en-us/library/documentformat.openxml.spreadsheet.indexedcolors%28v=office.14%29.aspx\n\nIn excel, everything looks fine until you edit the cell at which point, the cell becomes a black box (black foreground and background) while the cell is being edited.", "id": 175347, "time": "2014-05-20T12:54:04Z", "creator": "jerry.williamson@e2open.com", "creation_time": "2014-05-20T12:54:04Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 56548, "text": "Any chance you could use Excel to create a simple test file, which shows the 64 for the foreground but the 65 for the background? That could then be used towards a unit test for the problem", "id": 175348, "time": "2014-05-20T13:22:55Z", "creator": "apache@gagravarr.org", "creation_time": "2014-05-20T13:22:55Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "jerry.williamson@e2open.com", "text": "Not sure I can force a 65 from Excel directly. It appears to just leave the element unspecified which internally defaults. I can, though, create a test where an Excel file is created with both values and hopefully demonstrate the problem. I'll attach a couple of tests shortly", "id": 175349, "attachment_id": null, "bug_id": 56548, "creation_time": "2014-05-20T13:27:11Z", "time": "2014-05-20T13:27:11Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 56548, "attachment_id": 31639, "text": "Created attachment 31639\nTest case\n\ntest case that produces an xlsx file that demonstrates the problem.", "id": 175352, "time": "2014-05-20T14:03:21Z", "creator": "jerry.williamson@e2open.com", "creation_time": "2014-05-20T14:03:21Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 56548, "attachment_id": 31640, "id": 175353, "time": "2014-05-20T14:04:57Z", "creator": "jerry.williamson@e2open.com", "creation_time": "2014-05-20T14:04:57Z", "is_private": false, "text": "Created attachment 31640\nsample file produced by the test.\n\n\nediting the first cell causes black box while editing\nediting second cell which has background color set to 65 is fine"}, {"count": 5, "tags": [], "creator": "jerry.williamson@e2open.com", "text": "Added a testcase and a sample file that demonstrates the problem.\nThe test produces an XLSX file that has 2 cells. \nThe first cell has a cell style whose fillBackground is set from the column style (which is 64).\nThe second cell has a fillBackground explicitly set to 65.\n\nIf you open the spreadsheet in Excel and edit the first cell, you'll see that the cell turns to a black box while editing.\n\nI'm using Excel 2013 on Windows 7 (in case it matters)", "id": 175355, "attachment_id": null, "bug_id": 56548, "creation_time": "2014-05-20T14:19:31Z", "time": "2014-05-20T14:19:31Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 56548, "attachment_id": 31642, "id": 175357, "time": "2014-05-20T16:31:31Z", "creator": "jerry.williamson@e2open.com", "creation_time": "2014-05-20T16:31:31Z", "is_private": false, "text": "Created attachment 31642\nsecond sample.xlsx\n\nI believe I inadvertently saved the previous sample.xlsx in excel.\nExcel removed the <bgColor indexed=\"65\"/> element from the styles.xml when it saved.\n\nThis attachment is what is actually produced by the test"}, {"count": 7, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "text": "For HSSF there is some very strange back-and-forth conversion which seems to try to handle this transparently, i.e. conver to 64 and 65 as needed, see e.g. HSSFCellStyle.checkDefaultBackgroundFills(), however I'm not sure if this does what it should always and if it would make sense to do similar things on the XSSF side. Usually I'd rather remove this special handling in HSSF as well, however it might cause compatibility issues with previous versions of POI...", "id": 185231, "time": "2015-09-14T17:54:59Z", "bug_id": 56548, "creation_time": "2015-09-14T17:54:59Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 56548, "attachment_id": null, "text": "A user on the ML confirmed that setting backgroundfillcolor to 65 is a valid workaround for this.", "id": 185446, "time": "2015-09-22T19:26:27Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-09-22T19:26:27Z", "is_private": false}]
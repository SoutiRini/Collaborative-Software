[{"attachment_id": null, "tags": [], "creator": "rahul.bhoyar@diligenta.co.uk", "is_private": false, "count": 0, "id": 191924, "time": "2016-06-23T22:30:28Z", "bug_id": 59749, "creation_time": "2016-06-23T22:30:28Z", "text": "We are using apache http server 2.2.29 on Linux (2.6.32).We have observed that apache is generating many core dumps and getting crashed regularly. When it generates the core dump, below is being printed in the http\u2019s error log:\n\n[Mon Jun 20 01:28:09 2016] [notice] child pid 6520 exit signal Segmentation fault (11), possible coredump in /app/http_instance_name\n[Mon Jun 20 03:27:54 2016] [notice] child pid 6462 exit signal Segmentation fault (11), possible coredump in /app/http_instance_name\n\n Below is the output of the httpd -V\n\n./httpd -V\n Server version: Apache/2.2.29 (Unix)\n Server built:   Jan 13 2016 15:10:57\n Server's Module Magic Number: 20051115:36\n Server loaded:  APR 1.5.1, APR-Util 1.5.3\n Compiled using: APR 1.5.1, APR-Util 1.5.3\n Architecture:   64-bit\n Server MPM:     Worker\n threaded:     yes (fixed thread count)\n forked:     yes (variable process count)\n Server compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=128\n -D HTTPD_ROOT=\"/app/****\"\n -D SUEXEC_BIN=\"/app/****/bin/suexec\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\n\nBelow is the output of 'bt full' [ during the core analysis ]\n\n#0  0x0000003704a0e7dd in read () from /lib64/libpthread.so.0\n     No symbol table info available.\n    #1  0x000000000044f8b7 in ap_mpm_pod_check (pod=<value optimized out>)     at pod.c:54\n    c = <value optimized out>\n    fd = 6\n    rc = <value optimized out>\n   #2  0x000000000044de74 in child_main (child_num_arg=1) at worker.c:1259\n    threads = 0xc2bab0\n    rv = <value optimized out>\n    ts = 0xc079f8\n    thread_attr = 0xc07a18\n    start_thread_id = <value optimized out>\n  #3  0x000000000044e0dd in make_child (s=0xb44870, slot=1) at worker.c:1342\n    pid = 0\n   #4  0x000000000044efc0 in perform_idle_server_maintenance     (_pconf=<value             optimized out>, plog=<value optimized out>, s=<value optimized out>)\nat worker.c:1568\n    j = <value optimized out>\n    free_slots = {1, 5, 6, 7, 11817336, 0, 11784504, 0, -1236161560, 11137,   11817336, 0, 11800920, 0, 11815024, 0, 11784504, 0, -1361903789, 11137,\n      4337480, 0, -1238262800, 11137, 29, 0, 12768544, 0, 11815024, 0, 12489224, 0}\n    total_non_dead = <value optimized out>\n    active_thread_count = <value optimized out>\n    idle_thread_count = <value optimized out>\n    free_length = 1\n    i = <value optimized out>\n    ps = <value optimized out>\n    totally_free_length = <value optimized out>\n    last_non_dead = <value optimized out>\n      #5  server_main_loop (_pconf=<value optimized out>, plog=<value optimized out>, s=<value optimized out>) at worker.c:1680\n    status = 11\n    pid = {pid = -1, in = 0xb45178, out = 0xb41158, err = 0xb3d138}\n    i = <value optimized out>\n    child_slot = <value optimized out>\n    exitwhy = 6\n    processed_status = <value optimized out>\n    #6  ap_mpm_run (_pconf=<value optimized out>, plog=<value optimized out>,     s=<value optimized out>) at worker.c:1782\n    remaining_children_to_start = <value optimized out>\n    rv = <value optimized out>\n    #7  0x0000000000425e34 in main (argc=3, argv=0x7ffcafb44eb8) at main.c:753\n    c = 0 '\\000'\n    configtestonly = <value optimized out>\n    confname = 0x458a64 \"conf/httpd.conf\"\n    def_server_root = 0x458a4f \"/app/***\"\n    temp_error_log = 0x0\n    error = <value optimized out>\n    process = 0xb44870\n    server_conf = 0xb44870\n    pglobal = 0xb3b128\n    pconf = 0xb3d138\n    plog = 0xb45178\n    ptemp = 0xb41158\n    pcommands = 0xb3f148\n    opt = 0xb3f238\n    rv = <value optimized out>\n    mod = <value optimized out>\n    optarg = 0x0\n    signal_server = <value optimized out>'\n\nWe are using Mod_proxy as a balancer to the backend jboss application server.\n\nI have attached a core dump herewith."}, {"count": 1, "text": "Unable to add core dump due to size limit", "bug_id": 59749, "is_private": false, "id": 191925, "time": "2016-06-23T22:34:38Z", "creator": "rahul.bhoyar@diligenta.co.uk", "creation_time": "2016-06-23T22:34:38Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "covener@gmail.com", "is_private": false, "count": 2, "id": 191926, "time": "2016-06-23T22:43:10Z", "bug_id": 59749, "creation_time": "2016-06-23T22:43:10Z", "text": "\n> Below is the output of 'bt full' [ during the core analysis ]\n> \n> #0  0x0000003704a0e7dd in read () from /lib64/libpthread.so.0\n>      No symbol table info available.\n>     #1  0x000000000044f8b7 in ap_mpm_pod_check (pod=<value optimized out>)  \n> at pod.c:54\n>     c = <value optimized out>\n>     fd = 6\n>     rc = <value optimized out>\n>    #2  0x000000000044de74 in child_main (child_num_arg=1) at worker.c:1259\n>     threads = 0xc2bab0\n\nwrong thread, there's probably a more interesting one."}, {"count": 3, "tags": [], "text": "Below is the 'bt full' output of another core? Can this help?\n\n#0  0x0000003037f2b4d5 in __strcasecmp_l_sse42 () from /lib64/libc.so.6\nNo symbol table info available.\n#1  0x00002b9f1c7c67b4 in ap_proxy_determine_connection (p=0x2b9f3001d0a8, r=0x2b9f3001d120, conf=0x80fdb8, worker=0x7e13c8, conn=0x832ff8,\n    uri=<value optimized out>, url=0x2b9f213c3b48, proxyname=0x0, proxyport=0, server_portstr=0x2b9f213c3b50 \"\", server_portstr_size=32)\n    at proxy_util.c:2228\n        ssl_hostname = 0x2b9f3403cf00 \"rchvasp0037.rsrpmi.net\"\n        server_port = <value optimized out>\n        err = <value optimized out>\n        uerr = <value optimized out>\n#2  0x00002b9f1cddb26d in proxy_http_handler (r=0x2b9f3001d120, worker=0x7e13c8, conf=0x80fdb8, url=0x2b9f30020158 \"/CommonWeb/pages/common/jsp/login.jsp\",\n    proxyname=0x0, proxyport=0) at mod_proxy_http.c:2024\n        status = 0\n        server_portstr = \"\\000\\321\\001\\060\\237+\\000\\000\\370\\376\\200\", '\\000' <repeats 13 times>\"\\370, \\376\\200\\000\\000\\000\\000\"\n        scheme = <value optimized out>\n        proxy_function = 0x2b9f1cddd6ac \"HTTPS\"\n        u = <value optimized out>\n        backend = 0x832ff8\n        is_ssl = <value optimized out>\n        c = 0x2b9f2c000c48\n        p = 0x2b9f3001d0a8\n        uri = 0x2b9f30020068\n#3  0x00002b9f1c7bde62 in proxy_run_scheme_handler (r=0x2b9f3001d120, worker=0x7e13c8, conf=0x80fdb8,\n    url=0x2b9f30020018 \"https://rchvasp0037.rsrpmi.net:8443/CommonWeb/pages/common/jsp/login.jsp\", proxyhost=0x0, proxyport=0) at mod_proxy.c:2412\n        pHook = <value optimized out>\n        n = <value optimized out>\n        rv = -1\n#4  0x00002b9f1c7c2417 in proxy_handler (r=0x2b9f3001d120) at mod_proxy.c:1039\n        url = 0x2b9f30020018 \"https://rchvasp0037.rsrpmi.net:8443/CommonWeb/pages/common/jsp/login.jsp\"\n        uri = 0x2b9f3003bede \"balancer://paascluster/CommonWeb/pages/common/jsp/login.jsp\"\n        scheme = 0x2b9f3003bf78 \"balancer\"\n        p = 0x2b9f213c3d08 \"\\250\\323\\001\\060\\237+\"\n        p2 = <value optimized out>\n        sconf = <value optimized out>\n        conf = 0x80fdb8\n        proxies = 0x80fef8\n        ents = 0x80ff18\n        i = <value optimized out>\n        access_status = 0\n        direct_connect = <value optimized out>\n        str = <value optimized out>\n        maxfwd = <value optimized out>\n        balancer = 0x80cf78\n        worker = 0x7e13c8\n        attempts = 0\n        max_attempts = 1\n        list = <value optimized out>\n#5  0x00000000004399f0 in ap_run_handler (r=0x2b9f3001d120) at config.c:158\n        pHook = <value optimized out>\n        n = <value optimized out>\n        rv = -1\n#6  0x000000000043d01e in ap_invoke_handler (r=0x2b9f3001d120) at config.c:376\n        handler = <value optimized out>\n        p = <value optimized out>\n        result = 0\n        old_handler = 0x2b9f2055a457 \"proxy-server\"\n        ignore = <value optimized out>\n#7  0x0000000000447d60 in ap_process_request (r=0x2b9f3001d120) at http_request.c:282\n        access_status = <value optimized out>\n#8  0x0000000000444ce0 in ap_process_http_connection (c=0x2b9f2c000c48) at http_core.c:190", "is_private": false, "id": 191938, "creation_time": "2016-06-24T13:40:18Z", "time": "2016-06-24T13:40:18Z", "creator": "rahul.bhoyar@diligenta.co.uk", "bug_id": 59749, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 59749, "is_private": false, "text": "It seems that the proxy_conn_rec is corrupted (at least conn->ssl_hostname), but I don't see how this can happen.\n\nCould you please \"print *conn\" in ap_proxy_determine_connection (frame 1) and show the output?", "id": 191961, "time": "2016-06-27T06:21:49Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2016-06-27T06:21:49Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "rahul.bhoyar@diligenta.co.uk", "is_private": false, "count": 5, "id": 191964, "time": "2016-06-27T11:46:13Z", "bug_id": 59749, "creation_time": "2016-06-27T11:46:13Z", "text": "Could you please provide me the steps to perform this please?"}, {"count": 6, "tags": [], "text": "(In reply to Yann Ylavic from comment #4)\n> It seems that the proxy_conn_rec is corrupted (at least conn->ssl_hostname),\n> but I don't see how this can happen.\n> \n> Could you please \"print *conn\" in ap_proxy_determine_connection (frame 1)\n> and show the output?\n\nCould you please provide me the steps to perform this please?", "is_private": false, "bug_id": 59749, "id": 191965, "time": "2016-06-27T11:46:48Z", "creator": "rahul.bhoyar@diligenta.co.uk", "creation_time": "2016-06-27T11:46:48Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "(In reply to Rahul from comment #6)\n> (In reply to Yann Ylavic from comment #4)\n> > \n> > Could you please \"print *conn\" in ap_proxy_determine_connection (frame 1)\n> > and show the output?\n> \n> Could you please provide me the steps to perform this please?\n\nIn gdb, according to comment 3, you should be able to switch to function ap_proxy_determine_connection by typing (where \"(gdb)\" is the prompt):\n(gdb) frame 1\n\nand then simply enter:\n(gdb) print *conn", "is_private": false, "id": 191967, "creation_time": "2016-06-27T12:40:22Z", "time": "2016-06-27T12:40:22Z", "creator": "ylavic.dev@gmail.com", "bug_id": 59749, "attachment_id": null}, {"count": 8, "tags": [], "creator": "rahul.bhoyar@diligenta.co.uk", "attachment_id": null, "id": 191968, "time": "2016-06-27T13:22:47Z", "bug_id": 59749, "creation_time": "2016-06-27T13:22:47Z", "is_private": false, "text": "(In reply to Yann Ylavic from comment #7)\n> (In reply to Rahul from comment #6)\n> > (In reply to Yann Ylavic from comment #4)\n> > > \n> > > Could you please \"print *conn\" in ap_proxy_determine_connection (frame 1)\n> > > and show the output?\n> > \n> > Could you please provide me the steps to perform this please?\n> \n> In gdb, according to comment 3, you should be able to switch to function\n> ap_proxy_determine_connection by typing (where \"(gdb)\" is the prompt):\n> (gdb) frame 1\n> \n> and then simply enter:\n> (gdb) print *conn\n\nI have have taken the 'bt full' of a fresh core dump. The \"print *conn\" output for this core dump have also followed below.\n\nPlease note that \"xxxxx.xxxx.net\" is hostname of the bakcend jboss application server .\n\n(gdb) bt full\n#0  ap_pass_brigade (next=0x200000000, bb=0x2b9f3803e5c0) at util_filter.c:526\n        e = <value optimized out>\n#1  0x00002b9f1cdd99ca in pass_brigade (bucket_alloc=<value optimized out>, r=0x2b9f4402e220, conn=0x2b9f24027bb8, origin=0x2b9f44001e20,\n    bb=0x2b9f3803e5c0, flush=<value optimized out>) at mod_proxy_http.c:269\n        status = <value optimized out>\n        transferred = 1638\n#2  0x00002b9f1cddc017 in stream_reqbody_cl (r=0x2b9f4402e220, worker=<value optimized out>, conf=0x2b9f231d2bd8,\n    url=0x2b9f3803e4e0 \"/LoginWeb/ui/jsp/headerMenu.xhtml?isDbAbsent=null&siteName=null&homePage=Yes&type=login&userName=Dave%20Baker&lastLoginDetails=First%20Time%20LogIn&envName=PRDBANCS2&version=Client_12.01.00.01.169&onsit\"..., proxyname=0x2b9f3802d718 \"Xs\\001,\\237+\", proxyport=14016) at mod_proxy_http.c:537\n        rv = <value optimized out>\n        status = <value optimized out>\n        bucket_alloc = 0x2b9f3802d718\n        bb = 0x2b9f3803e5c0\n        e = <value optimized out>\n        bytes = 47963040834080\n        seen_eos = <value optimized out>\n        cl_val = 0\n        bytes_streamed = 0\n#3  ap_proxy_http_request (r=0x2b9f4402e220, worker=<value optimized out>, conf=0x2b9f231d2bd8,\n    url=0x2b9f3803e4e0 \"/LoginWeb/ui/jsp/headerMenu.xhtml?isDbAbsent=null&siteName=null&homePage=Yes&type=login&userName=Dave%20Baker&lastLoginDetails=First%20Time%20LogIn&envName=PRDBANCS2&version=Client_12.01.00.01.169&onsit\"..., proxyname=0x2b9f3802d718 \"Xs\\001,\\237+\", proxyport=14016) at mod_proxy_http.c:1143\n        bucket_alloc = 0x2b9f231d2bb8\n        e = <value optimized out>\n        headers_in_array = <value optimized out>\n        rv = <value optimized out>\n        temp_brigade = 0x2b9f4402a768\n        force10 = 589114312\n        headers_in_copy = <value optimized out>\n        c = 0x2b9f2c0175f8\n        header_brigade = 0x2b9f3803e5c0\n        input_brigade = 0x2b9f4402a728\n        buf = <value optimized out>\n        headers_in = 0x6736c0\n        status = <value optimized out>\n        bytes_read = <value optimized out>\n        bytes = 0\n        counter = 589114304\n        rb_method = <value optimized out>\n        old_cl_val = <value optimized out>\n        old_te_val = 0x2b9f3802d718 \"Xs\\001,\\237+\"\n#4  proxy_http_handler (r=0x2b9f4402e220, worker=<value optimized out>, conf=0x2b9f231d2bd8,\n    url=0x2b9f3803e4e0 \"/LoginWeb/ui/jsp/headerMenu.xhtml?isDbAbsent=null&siteName=null&homePage=Yes&type=login&userName=Dave%20Baker&lastLoginDetails=First%20Time%20LogIn&envName=PRDBANCS2&version=Client_12.01.00.01.169&onsit\"..., proxyname=0x2b9f3802d718 \"Xs\\001,\\237+\", proxyport=14016) at mod_proxy_http.c:2054\n        status = <value optimized out>\n        server_portstr = \"\\000\\342\\002D\\237+\\000\\000\\370\\376\\200\", '\\000' <repeats 13 times>\"\\370, \\376\\200\\000\\000\\000\\000\"\n        scheme = <value optimized out>\n        proxy_function = 0x2b9f1cddd6ac \"HTTPS\"\n        u = <value optimized out>\n        backend = 0x2b9f24027bb8\n        is_ssl = <value optimized out>\n        c = 0x2b9f2c0175f8\n        p = 0x2b9f4402e1a8\n        uri = <value optimized out>\n#5  0x00002b9f1c7bde62 in proxy_run_scheme_handler (r=0x2b9f4402e220, worker=0x7e14c8, conf=0x80fdb8,\n    url=0x2b9f3803e228 \"https://xxxxx.xxxx.net:8443/LoginWeb/ui/jsp/headerMenu.xhtml?isDbAbsent=null&siteName=null&homePage=Yes&type=login&userName=Dave%20Baker&lastLoginDetails=First%20Time%20LogIn&envName=PRDBANCS2\"..., proxyhost=0x0, proxyport=0) at mod_proxy.c:2412\n        pHook = <value optimized out>\n       n = <value optimized out>\n        rv = -1\n\n\n(gdb) frame 1\n#1  0x00002b9f1cdd99ca in pass_brigade (bucket_alloc=<value optimized out>, r=0x2b9f4402e220, conn=0x2b9f24027bb8, origin=0x2b9f44001e20,\n    bb=0x2b9f3803e5c0, flush=<value optimized out>) at mod_proxy_http.c:269\n269         status = ap_pass_brigade(origin->output_filters, bb);\n(gdb) print *conn\n$1 = {connection = 0x2b9f44001e20, hostname = 0x2b9f3400d9a0 \"xxxxx.xxxx.net\", port = 8443, is_ssl = 1, pool = 0x2b9f3400d928,\n  sock = 0x2b9f2403f2a8, addr = 0x2b9f240273c8, flags = 0, close = 0, close_on_recycle = 0, worker = 0x7e14c8, data = 0x0, inreslist = 0,\n  scpool = 0x2b9f2403f218, r = 0x0, need_flush = 0, forward = 0x0, ssl_hostname = 0x2b9f2403f290 \"xxxxx.xxxx.net\"}"}]
[{"count": 0, "tags": [], "bug_id": 52252, "attachment_id": null, "text": "luajit 2.0 uses headers and library with different names than normal lua. For example on Debian, headers are in /usr/include/luajit-2.0/ and the library is called libluajit-5.1.so.2.\n\nThe library/header detection code of mod_lua does not have a special case for luajit at all and does not look for the pathnames of luajit.\n\nAlso, if I fix the linking, httpd aborts with this message:\n\n[Sun Nov 27 20:37:19.619445 2011] [lua:debug] [pid 22767] mod_lua.c(206): [client 127.0.0.1:54230] request details scope:0, filename:/home/stf/apache/perl-framework/t/htdocs/modules/lua/translate.lua, function:translate_name\nPANIC: unprotected error in call to Lua API (attempt to index a string value)\n\n\nCommenting out the calls to luaopen_jit and loadjitmodule in lua_vmprep.c \"fixes\" this insofar as t/modules/lua.t runs without error.\n\nI don't have access to luajit 1.x, so I can't say if this is just an incompatibility with 2.0. But considering that the lua 5.1 manual says that \"The luaopen_* functions (to open libraries) cannot be called directly, like a regular C function. They must be called through Lua, like a Lua function.\" [1], I think calling luaopen_jit is always wrong.\n\n[1] http://www.lua.org/manual/5.1/manual.html#7.3", "id": 151818, "time": "2011-11-27T19:44:08Z", "creator": "sf@sfritsch.de", "creation_time": "2011-11-27T19:44:08Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 52252, "attachment_id": null, "id": 171583, "time": "2013-12-05T08:14:33Z", "creator": "zhaozg@gmail.com", "creation_time": "2013-12-05T08:14:33Z", "is_private": false, "text": "It also exist in 2.4.7,\n./configure --prefix=/usr/local --enable-lua --enable-luajit --with-lua=/usr/local --enable-dbd\nwill generate this bugs,\nbut \n./configure --prefix=/usr/local --enable-lua --with-lua=/usr/local --enable-dbd\n works ok"}]
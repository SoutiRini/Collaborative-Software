[{"count": 0, "tags": [], "bug_id": 35300, "text": "In our production environment, tomcat connector thread pool expands even when \nall the threads are not in use. We have configured server.xml with 150 threads.\n\n <!-- A HTTP/1.1 Connector on port 8080 -->\n      <Connector port=\"8080\" address=\"${jboss.bind.address}\"\n         maxThreads=\"300\" minSpareThreads=\"150\" maxSpareThreads=\"200\"\n         enableLookups=\"false\" redirectPort=\"8443\" acceptCount=\"100\"\n         connectionTimeout=\"60000\" disableUploadTimeout=\"true\"\n         bufferSize=\"8192\" />\n\nIs there any reason to increase threads in the pool when many of the threads \nare idle? Please see attached thread dump.\n\nThanks\nPurush", "id": 76239, "time": "2005-06-09T23:47:20Z", "creator": "p_rudrakshala@yahoo.com", "creation_time": "2005-06-09T23:47:20Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 35300, "text": "Created attachment 15360\nThread dump", "id": 76240, "time": "2005-06-09T23:48:49Z", "creator": "p_rudrakshala@yahoo.com", "creation_time": "2005-06-09T23:48:49Z", "is_private": false, "attachment_id": 15360}, {"count": 2, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "is_private": false, "id": 82331, "time": "2005-11-10T03:23:30Z", "bug_id": 35300, "creation_time": "2005-11-10T03:23:30Z", "text": "The thread dump shows a lot of threads: but I think you might be confusing the\nconnector thread pool limits with the overall JVM limits.  There will be more\nthreads than the ones configured for the connector: the JVM starts a few threads\nfor itself, and Tomcat at least one other thread."}, {"count": 3, "tags": [], "bug_id": 35300, "is_private": false, "text": "You've got 176 idle threads and 37 busy threads. These values do not contradict\nyour settings:\n\nmaxThreads=\"300\"\nminSpareThreads=\"150\"\nmaxSpareThreads=\"200\"\n\nThe values indicate, that some time since startup your pool should have been\nconnected to at least 62 clients. Don't confuse clients with parallel requests.\nIn case you use http keep-alive, there might be much more connections (keping\nthreads from getting into idle state) than requests in work.\n\nDetails from your thread dump. You've got:\n\n174 connector threads idle (they are in the following stack):\n\nat java.lang.Object.wait(Native Method)\nat java.lang.Object.wait(Object.java:429)\nat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:655)\n- locked <0xHEXADDR> (a org.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\nat java.lang.Thread.run(Thread.java:534)\n\nAnother 2 connector threads idle in a slightly different stack:\n\nat java.lang.Object.wait(Native Method)\n- waiting on <0xHEXADDR> (a\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\nat java.lang.Object.wait(Object.java:429)\nat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:655)\n- locked <0xHEXADDR> (a org.apache.tomcat.util.threads.ThreadPool$ControlRunnable)\nat java.lang.Thread.run(Thread.java:534)\n\n32 connector threads connected to some client, maybe waiting for a next request\nduring http keep-alive:\n\nat java.net.SocketInputStream.socketRead0(Native Method)\nat java.net.SocketInputStream.read(SocketInputStream.java:129)\nat org.apache.coyote.http11.InternalInputBuffer.fill(InternalInputBuffer.java:737)\nat\norg.apache.coyote.http11.InternalInputBuffer.parseRequestLine(InternalInputBuffer.java:398)\nat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:761)\nat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:705)\nat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:577)\n\nAnother 3 connector threads busy in a slightly different stack:\n\nat java.net.SocketInputStream.socketRead0(Native Method)\nat java.net.SocketInputStream.read(SocketInputStream.java:129)\nat java.io.BufferedInputStream.fill(BufferedInputStream.java:183)\nat java.io.BufferedInputStream.read1(BufferedInputStream.java:222)\nat java.io.BufferedInputStream.read(BufferedInputStream.java:277)\n- locked <0xHEXADDR> (a java.io.BufferedInputStream)\nat sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:756)\nat sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:711)\n\nand finally one more thread busy inside\n\nat java.net.SocketInputStream.socketRead0(Native Method)\nat java.net.SocketInputStream.read(SocketInputStream.java:129)\nat java.io.ObjectInputStream$PeekInputStream.read(ObjectInputStream.java:2150)\nat java.io.ObjectInputStream$PeekInputStream.readFully(ObjectInputStream.java:2163)\nat\njava.io.ObjectInputStream$BlockDataInputStream.readShort(ObjectInputStream.java:2631)\nat java.io.ObjectInputStream.readStreamHeader(ObjectInputStream.java:734)\nat java.io.ObjectInputStream.<init>(ObjectInputStream.java:253)\n\nThe last thread in the pool is doing accept, waiting for the next new http\nconnection:\n\nat java.net.PlainSocketImpl.socketAccept(Native Method)\nat java.net.PlainSocketImpl.accept(PlainSocketImpl.java:353)\n- locked <0xHEXADDR> (a java.net.PlainSocketImpl)\nat java.net.ServerSocket.implAccept(ServerSocket.java:448)\nat java.net.ServerSocket.accept(ServerSocket.java:419)\nat\norg.apache.tomcat.util.net.DefaultServerSocketFactory.acceptSocket(DefaultServerSocketFactory.java:60)\nat org.apache.tomcat.util.net.PoolTcpEndpoint.acceptSocket(PoolTcpEndpoint.java:368)\nat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:549)", "id": 82373, "time": "2005-11-11T00:27:04Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2005-11-11T00:27:04Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 35300, "text": "Connector configuration: minSpareThreads=\"150\" and maxThreads=\"300\"\n\nWhen the connector starts, it will start with 150 threads and when the load\nincreases it can go up to 300 threads. But, it seems that the thread pool\nexpanded from 150 to 300 even though only about ~37 threads were busy and\nremaining threads were idle.\n\nThis thread dump was taken immediately after noticing thread count increase.", "id": 82388, "time": "2005-11-11T09:41:31Z", "creator": "p_rudrakshala@yahoo.com", "creation_time": "2005-11-11T09:41:31Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 35300, "attachment_id": null, "text": "If you need to discuss further, please post to tomcat-user.", "id": 82401, "time": "2005-11-11T19:05:40Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2005-11-11T19:05:40Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "I was starting up the Tomcat 4.0 servlet engine, running against JDK 1.4 and \nreceived the following error when attempting to start the engine.  I'm willing \nto believe this is just a library issue on my part, but I'm not an idiot and \nhave been hunting it down for 2 days now.  I even rebuilt the XErces2 jar under \nmy running 1.4 environment (by downloading the source and running Ant against \nmy JAVA_HOME.  \n\nI have posted several questions to the tomcat users list with no reponses, and \nsearched through the archives for similar issues with no success.  This leads \nme to believe it may in fact be a bug.  Please contact for more info if \nnecessary.\n\nThe Stacktrace follows....\n\njavax.servlet.ServletException: Servlet.init() for servlet jsp threw exception\n\tat org.apache.catalina.core.StandardWrapper.load\n(StandardWrapper.java:871)\n\tat org.apache.catalina.core.StandardContext.loadOnStartup\n(StandardContext.java:3267)\n\tat org.apache.catalina.core.StandardContext.start\n(StandardContext.java:3384)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1123)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:612)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1123)\n\tat org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:307)\n\tat org.apache.catalina.core.StandardService.start\n(StandardService.java:388)\n\tat org.apache.catalina.core.StandardServer.start\n(StandardServer.java:505)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:776)\n\tat org.apache.catalina.startup.Catalina.execute(Catalina.java:681)\n\tat org.apache.catalina.startup.Catalina.process(Catalina.java:179)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:42)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:28)\n\tat java.lang.reflect.Method.invoke(Method.java:313)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:243)\n----- Root Cause -----\njava.lang.ClassCastException: org.apache.xerces.jaxp.DocumentBuilderFactoryImpl\n\tat javax.xml.parsers.DocumentBuilderFactory.newInstance\n(DocumentBuilderFactory.java:103)\n\tat org.apache.jasper.parser.ParserUtils.parseXMLDocument\n(ParserUtils.java:183)\n\tat org.apache.jasper.compiler.TldLocationsCache.processWebDotXml\n(TldLocationsCache.java:165)\n\tat org.apache.jasper.compiler.TldLocationsCache.<init>\n(TldLocationsCache.java:138)\n\tat org.apache.jasper.EmbededServletOptions.<init>\n(EmbededServletOptions.java:324)\n\tat org.apache.jasper.servlet.JspServlet.init(JspServlet.java:266)\n\tat org.apache.catalina.core.StandardWrapper.load\n(StandardWrapper.java:852)\n\tat org.apache.catalina.core.StandardContext.loadOnStartup\n(StandardContext.java:3267)\n\tat org.apache.catalina.core.StandardContext.start\n(StandardContext.java:3384)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1123)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:612)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1123)\n\tat org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:307)\n\tat org.apache.catalina.core.StandardService.start\n(StandardService.java:388)\n\tat org.apache.catalina.core.StandardServer.start\n(StandardServer.java:505)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:776)\n\tat org.apache.catalina.startup.Catalina.execute(Catalina.java:681)\n\tat org.apache.catalina.startup.Catalina.process(Catalina.java:179)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:42)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:28)\n\tat java.lang.reflect.Method.invoke(Method.java:313)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:243)", "is_private": false, "bug_id": 4330, "id": 6968, "time": "2001-10-22T05:43:18Z", "creator": "jworrall@commnav.com", "creation_time": "2001-10-22T05:43:18Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "kin-man.chung@sun.com", "attachment_id": null, "id": 7023, "time": "2001-10-22T14:45:46Z", "bug_id": 4330, "creation_time": "2001-10-22T14:45:46Z", "is_private": false, "text": "This is hardly a jasper problem.  xerces.jar is part of Tomcat 4.0.1 Final\ndistriubution; but make sure you don't have any incompatible XML parser that got\nloaded instead.  Does JDK 1.4 come with one?  Try using JDK 1.3 to see if it\nchange anything.\n\nIn any case, please give me a test case that I can run with JDK1.4.  Thanks."}, {"count": 2, "tags": [], "bug_id": 4330, "attachment_id": 707, "text": "Created attachment 707\nserver.xml of offending Tomcat install", "id": 7041, "time": "2001-10-23T04:18:03Z", "creator": "jworrall@commnav.com", "creation_time": "2001-10-23T04:18:03Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jworrall@commnav.com", "attachment_id": null, "is_private": false, "id": 7042, "time": "2001-10-23T04:23:18Z", "bug_id": 4330, "creation_time": "2001-10-23T04:23:18Z", "text": "I scanned the jars in my classpath and the only jar that has a \norg.apache.xerces.jaxp.DocumentBuilderFactoryImpl is the xerces.jar that I \nbuilt under my 1.4 environment.  And the only jar that has a \njavax.xml.parsers.DocumentBuilderFactory is the rt.jar under my 1.4 \nenvironment.  The engine is failing on startup, so there's no real test case \nexcept the following:\n\ninstall 4.0.1\nuse the server.xml I provided on the earlier post.\nwatch it fail\n\nI am happy to hear back that this is me being a dope, but please give me a clue \nwhy."}, {"count": 4, "tags": [], "text": "I ran Tomcat 4.0 with JDK 1.4.0 beta without any problem.  Your server.xml looks\nfine.  You don't need to build your own xerces to run tomcat.  You also don't\nnee to define CLASSPATH.", "is_private": false, "bug_id": 4330, "id": 7125, "time": "2001-10-24T18:51:37Z", "creator": "kin-man.chung@sun.com", "creation_time": "2001-10-24T18:51:37Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "mak-apache-bugzilla@greenhills.co.uk", "attachment_id": null, "id": 8420, "time": "2001-11-29T06:37:36Z", "bug_id": 4330, "creation_time": "2001-11-29T06:37:36Z", "is_private": false, "text": "I encountered the same problem today, when I set up a fresh build\nenvironment, including xerces-1_4_4. Using xerces 1_4_3 instead\nworked for me. In both cases I used the 1.3 JDK, not 1.4. The\nTomcat source tree was fresh from CVS today.\n\nJoel, were you using xerces-1_4_4 as well by any chance?\n\nI have not looked further into what the root cause or right fix is.\n"}, {"count": 6, "tags": [], "creator": "milind@nirgun.com", "attachment_id": 975, "is_private": false, "id": 9326, "time": "2002-01-03T13:30:29Z", "bug_id": 4330, "creation_time": "2002-01-03T13:30:29Z", "text": "Created attachment 975\nOffending Server.xml"}, {"count": 7, "tags": [], "creator": "milind@nirgun.com", "attachment_id": null, "is_private": false, "id": 9329, "time": "2002-01-03T13:34:24Z", "bug_id": 4330, "creation_time": "2002-01-03T13:34:24Z", "text": "I encountered the same problem with tomcat4.0.1/Win2k/jdk 1.4 beta-3 and after \n2 days of testing, I have found that whenever I add a new JSP page in any new \ncontext I created it throws up with the following exceptions. The same JSP \nworks if put in the \"examples\" context. I found that changing the jdk to 1.3 \nsolved the problem for me.\nI have also attached my server.xml file.\n\nStacktrace follows:\n\njavax.servlet.ServletException: Servlet.init() for servlet jsp threw exception\n\tat org.apache.catalina.core.StandardWrapper.load\n(StandardWrapper.java:871)\n\tat org.apache.catalina.core.StandardWrapper.allocate\n(StandardWrapper.java:615)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:214)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:201)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.valves.CertificatesValve.invoke\n(CertificatesValve.java:246)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2344)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:164)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:163)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.connector.http.HttpProcessor.process\n(HttpProcessor.java:1011)\n\tat org.apache.catalina.connector.http.HttpProcessor.run\n(HttpProcessor.java:1106)\n\tat java.lang.Thread.run(Thread.java:539)\nroot cause java.lang.ClassCastException: \norg.apache.xerces.jaxp.DocumentBuilderFactoryImpl\n\tat javax.xml.parsers.DocumentBuilderFactory.newInstance\n(DocumentBuilderFactory.java:103)\n\tat org.apache.jasper.parser.ParserUtils.parseXMLDocument\n(ParserUtils.java:183)\n\tat org.apache.jasper.compiler.TldLocationsCache.processWebDotXml\n(TldLocationsCache.java:165)\n\tat org.apache.jasper.compiler.TldLocationsCache.<init>\n(TldLocationsCache.java:138)\n\tat org.apache.jasper.EmbededServletOptions.<init>\n(EmbededServletOptions.java:324)\n\tat org.apache.jasper.servlet.JspServlet.init(JspServlet.java:266)\n\tat org.apache.catalina.core.StandardWrapper.load\n(StandardWrapper.java:852)\n\tat org.apache.catalina.core.StandardWrapper.allocate\n(StandardWrapper.java:615)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:214)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:201)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.valves.CertificatesValve.invoke\n(CertificatesValve.java:246)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2344)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:164)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:163)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.connector.http.HttpProcessor.process\n(HttpProcessor.java:1011)\n\tat org.apache.catalina.connector.http.HttpProcessor.run\n(HttpProcessor.java:1106)\n\tat java.lang.Thread.run(Thread.java:539)\n\n"}, {"count": 8, "tags": [], "creator": "kin-man.chung@sun.com", "attachment_id": null, "id": 9366, "time": "2002-01-04T18:26:50Z", "bug_id": 4330, "creation_time": "2002-01-04T18:26:50Z", "is_private": false, "text": "I routinely use j2sdk1.4.0 with tomcat and never run into this problem.  I am\nclosing this as WORKSFORME.  If you can attach a test case in the form of a .war\nthat I can drop into tomcat that shows this problem, please reopen this bug\nagain.  Thanks."}]
[{"text": "File: PostgresRDBMSAdapter.java\nMethod: public void revokePermission(Connection connection, Uri uri,\nNodePermission permission) throws ServiceAccessException\n\nThis method doesn't work. Query is wrong and is crashing on PostgreSQL 8.0.\nI changed query to:\n\n      try {\n                        NodeRevisionNumber revisionNumber =\npermission.getRevisionNumber();\n                        if (revisionNumber == null)\n                                statement = connection.prepareStatement(\n                                        \"delete from PERMISSIONS where\n(OBJECT_ID, SUBJECT_ID, ACTION_ID) IN ( SELECT ou.URI_ID, su.URI_ID, au.URI_ID\nFROM URI ou, URI su, URI au WHERE ou.URI_STRING = ? and su.URI_STRING = ? and\nau.URI_STRING = ?) and VERSION_NO IS NULL\");\n                        else\n                                statement = connection.prepareStatement(\n                                        \"delete from PERMISSIONS where\n(OBJECT_ID, SUBJECT_ID, ACTION_ID) IN ( SELECT ou.URI_ID, su.URI_ID, au.URI_ID\nFROM URI ou, URI su, URI au WHERE ou.URI_STRING = ? and su.URI_STRING = ? and\nau.URI_STRING = ?) and VERSION_NO = ?\");\n\n                        statement.setString(1, permission.getObjectUri());\n                        statement.setString(2, permission.getSubjectUri());\n                        statement.setString(3, permission.getActionUri());\n                        if (revisionNumber != null)\n                                statement.setString(4, revisionNumber.toString());\n                        statement.executeUpdate();\n\nThen it seems to work fine.", "tags": [], "bug_id": 34343, "attachment_id": null, "count": 0, "id": 73379, "time": "2005-04-07T08:47:30Z", "creator": "tomekem@poczta.fm", "creation_time": "2005-04-07T08:47:30Z", "is_private": false}, {"count": 1, "text": "Created attachment 14636\nPatch to fix SQL-statements as suggested.\n\nPatch to fix SQL-statements as suggested. Changed the two different statements\ninto a single reusable PreparedStatement and standard JDBC setNull(), instead\nof hardcoded \"IS NULL\" in SQL.", "bug_id": 34343, "attachment_id": 14636, "id": 73380, "time": "2005-04-07T10:02:36Z", "creator": "mkalen@apache.org", "creation_time": "2005-04-07T10:02:36Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 34343, "attachment_id": null, "is_private": false, "id": 75032, "time": "2005-05-18T19:36:45Z", "creator": "unico@hippo.nl", "creation_time": "2005-05-18T19:36:45Z", "text": "Patch applied. Please cross-check and close."}, {"count": 3, "tags": [], "creator": "mkalen@apache.org", "attachment_id": null, "is_private": false, "id": 75801, "time": "2005-06-02T16:26:49Z", "bug_id": 34343, "creation_time": "2005-06-02T16:26:49Z", "text": "The patch was incorrect for the case when revisionNumber==null. Previously I\nonly had a chance to verify this on Oracle and thought that PostgreSQL would\nbehave differently on the .setNull call. However, this is not the case and the\ndelete statement will not be able to remove permissions if revisionNumber==null.\nAttaching new patch, unified with the latest CommonRDBMSAdapter."}, {"count": 4, "text": "Created attachment 15270\nPatch to fix revokePermission for revisionNumber==null\n\nPatch to fix revokePermission for revisionNumber==null. Unified with\nCommonRDBMSAdapter rev 1.13. Created against CVS HEAD as of 2nd June 2005 17:00\nCET.", "bug_id": 34343, "attachment_id": 15270, "id": 75817, "time": "2005-06-02T19:59:17Z", "creator": "mkalen@apache.org", "creation_time": "2005-06-02T19:59:17Z", "tags": [], "is_private": false}, {"text": "applied to both branches. please cross check and close.", "tags": [], "bug_id": 34343, "attachment_id": null, "count": 5, "id": 76024, "time": "2005-06-04T15:32:51Z", "creator": "unico@apache.org", "creation_time": "2005-06-04T15:32:51Z", "is_private": false}, {"text": "Logic is now correct (verified with PG v8.0.1), however the statement is never \nprepared -- probably a messup by me. Attaching a new trivial patch to prepare \nthe statement before setting parameters and executing.", "tags": [], "bug_id": 34343, "attachment_id": null, "count": 6, "id": 76061, "time": "2005-06-06T12:32:27Z", "creator": "mkalen@apache.org", "creation_time": "2005-06-06T12:32:27Z", "is_private": false}, {"count": 7, "text": "Created attachment 15311\nPrepare statement before use\n\nTrivial unified patch to prepare statement before use. Created against CVS HEAD\nbut should apply to 2.1 branch as well.", "bug_id": 34343, "attachment_id": 15311, "id": 76062, "time": "2005-06-06T12:34:24Z", "creator": "mkalen@apache.org", "creation_time": "2005-06-06T12:34:24Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "creator": "unico@apache.org", "text": "Fixed now.", "id": 76339, "time": "2005-06-13T14:40:37Z", "bug_id": 34343, "creation_time": "2005-06-13T14:40:37Z", "is_private": false, "attachment_id": null}, {"count": 9, "text": "Verified with PG 8.0.1 on Windows.", "bug_id": 34343, "attachment_id": null, "id": 76499, "time": "2005-06-17T15:47:22Z", "creator": "mkalen@apache.org", "creation_time": "2005-06-17T15:47:22Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "text": "I posted this on the tomcat dev mailing list, but didn't get a response \nindicating if this is a bug or working as designed.  So I thought I'd try \nsubmitting it as a bug.\n\n\nEnvironment:\nTomcat 4.1.12\nApache 2.0.43\nWarp Connector \nStruts 1.1b2\n\nCalling getSession() on the request object (which in this environment is an\ninstance of HttpRequestFacade which wraps a WarpRequest) creates and returns\na new StandardSessionFacade object that actually wraps another\nStandardSessionFacade object which wraps the StandardSession object.  This\nmeans that every call to request.getSession() returns a different\nStandardSessionFacade object making it impossible to synchronize on the\nsession object.  \n\nIt looks like that the code in HttpRequestFacade.getSession() that wraps the\nsession in another StandardSessionFacade object is unneeded, possibly.  The\ncall it makes to StandardSession.getSession() already returns a session\nobject wrapped in a facade object.  \n\nThe Action.isTokenValid() method in Struts has a synchronized block on the\nsession object.  It looks like that this code would not work on Tomcat\nbecause of this scenario.\n\nI also quickly looked at Tomcat 4.1.18 and Struts 1.1rc1 and the code in the\nabove mentioned objects looks the same.  The CoyoteRequestFacade class used\nby the Coyote Connector does the same thing too.", "is_private": false, "bug_id": 17615, "id": 32358, "time": "2003-03-03T19:23:51Z", "creator": "jay-paulsen@uiowa.edu", "creation_time": "2003-03-03T19:23:51Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "funkman@joedog.org", "text": "You should not have direct access to the real session object, only to the facade\nwhich wraps the session. This is for security purposes so one does not get\nsneaky with respect to reflection and try to do something they shouldn't do. \n\n(I think) There was also a recent bug fix recently(?) with respect to this where\nthe actually session was passed. ", "id": 35492, "attachment_id": null, "bug_id": 17615, "creation_time": "2003-04-18T13:05:42Z", "time": "2003-04-18T13:05:42Z", "is_private": false}, {"count": 2, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "The issue here is that double facaing occurs (once facade is more than enough,\nobviously). I intend to fix the issue.", "id": 35520, "time": "2003-04-18T13:42:11Z", "bug_id": 17615, "creation_time": "2003-04-18T13:42:11Z", "is_private": false}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "Remy fixed this shortly after the bug was raised. See\nhttp://marc.theaimsgroup.com/?l=tomcat-dev&m=105165242608636&w=2\nand\nhttp://marc.theaimsgroup.com/?l=tomcat-dev&m=105165232808502&w=2", "id": 55607, "time": "2004-04-10T10:26:49Z", "bug_id": 17615, "creation_time": "2004-04-10T10:26:49Z", "is_private": false, "attachment_id": null}]
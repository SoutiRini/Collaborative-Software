[{"count": 0, "text": "I send this to dev list, but received no response:\n\nhttp://mail-archives.apache.org/mod_mbox/tomcat-dev/200809.mbox/<b61a4e530809081550u242eacaapd5fa7e37c9c3d222@mail.gmail.com>\n\nWhen mod_jk sends a 401, it is not sending an EOS (sends a FLUSH).  This causes a module that buffers the response (for example, the mod_security2 module which I maintain) to not realize the full page has been sent.  This causes httpd to issue the default 401 response, which does not include the WWW-Authenticate header and thus no prompt for credentials.\n\nI am able to work around this, but I am confused as to why mod_jk does not send an EOS.  Is it a bug?  If not, then why and how can a module know mod_jk is done sending data (other than looking at C-L header)?\n\nSome more info can be found in the ModSecurity issue tracker:\n\nhttps://www.modsecurity.org/tracker/browse/MODSEC-16\n\n-B", "bug_id": 45812, "attachment_id": null, "id": 120629, "time": "2008-09-15T11:25:09Z", "creator": "Brian.Rectanus@breach.com", "creation_time": "2008-09-15T11:25:09Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 45812, "attachment_id": null, "text": "Looking at reported issue on modsecurity.org site,\nit looks like you guys are trying 1.2.5 version of mod_jk.\nI suppose the same happening with latest mod_jk (1.2.26) ?\n\nWill you be able to test the current SVN build, cause I plan\nto add the call to ap_finalize_request_protocol on\nJK_AJP13_END_RESPONSE message. This API creates the EOS bucket\nI suspect you are pursuing.\n\n\n\n", "id": 120671, "time": "2008-09-16T03:54:10Z", "creator": "mturk@apache.org", "creation_time": "2008-09-16T03:54:10Z", "is_private": false}, {"count": 2, "text": "Sorry, that was a typo on my part on the modsec issue.  It was mod_jk version 1.2.25 (not 1.2.5).  That just happened to be the debian packaged version.  The problem was also reported on the tomcat-users list with 1.2.24, 1.2.25 and 1.2.26, so I did not test with 1.2.26 after duplicating with 1.2.25.  I will test with SVN version when you have a fix.  Thanks.\n\ntomcat-users list report:\n\nhttp://mail-archives.apache.org/mod_mbox/tomcat-users/200809.mbox/%3C215811.93737.qm@web55203.mail.re4.yahoo.com%3E\n", "bug_id": 45812, "is_private": false, "id": 120684, "time": "2008-09-16T08:56:05Z", "creator": "Brian.Rectanus@breach.com", "creation_time": "2008-09-16T08:56:05Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 45812, "attachment_id": null, "text": "Fix is already in the SVN.\nIt calls the ap_finalize_request_protocol on JK_AJP13_END_RESPONSE message,\nso please tell us if that resolves the issue.", "id": 120685, "time": "2008-09-16T09:03:47Z", "creator": "mturk@apache.org", "creation_time": "2008-09-16T09:03:47Z", "is_private": false}, {"count": 4, "text": "The SVN version does indeed fix this problem.  However, I noticed it now sends FLUSH followed by EOS.  In my bugzilla searches I came across Bug 26446 that is rather old, but not sure if that may be triggered by this change.\n\nAnd just FYI, apxs on my system was including the -Wl, prefix on the LDFLAGS query which caused the SVN version of configure to add it twice (ie -Wl,-Wl,foo).  I had to do this to get it to build:\n\nIndex: configure.in\n===================================================================\n--- configure.in\t(revision 695980)\n+++ configure.in\t(working copy)\n@@ -109,7 +109,7 @@\n                 dnl sed magic needed to prepend each token with \"-Wl,\" s.t. libtool\n                 dnl detects those arguments correctly as ld flags.\n                 dnl Double square brackets needed, because single ones will be removed by autoconf.\n-                APXSLDFLAGS=\"`$APXS -q LDFLAGS_SHLIB | $SED -e 's/\\([[^ ]]*\\)/-Wl,\\1/g'`\"\n+                APXSLDFLAGS=\"`$APXS -q LDFLAGS_SHLIB | $SED -e 's/\\(-Wl,\\)\\?\\([[^ ]]\\+\\)/-Wl,\\2/g'`\"\n             else\n                 WEBSERVER=\"apache-2.0\"\n                 APRINCLUDEDIR=\"\"\n@@ -124,7 +124,7 @@\n                 dnl sed magic needed to prepend each token with \"-Wl,\" s.t. libtool\n                 dnl detects those arguments correctly as ld flags.\n                 dnl Double square brackets needed, because single ones will be removed by autoconf.\n-                APXSLDFLAGS=\"`$APXS -q LDFLAGS | $SED -e 's/\\([[^ ]]*\\)/-Wl,\\1/g'`\"\n+                APXSLDFLAGS=\"`$APXS -q LDFLAGS | $SED -e 's/\\(-Wl,\\)\\?\\([[^ ]]\\+\\)/-Wl,\\2/g'`\"\n                 APACHE_CONFIG_VARS=\"`${APXS} -q exp_installbuilddir`/config_vars.mk\"\n                 LIBTOOL=`$APXS -q LIBTOOL`\n             fi\n@@ -534,7 +534,7 @@\n fi\n dnl the APXSLDFLAGS is given to the linker (for APRVARS).\n if ${TEST} -n \"${LDFLAGS}\" ; then\n-    TMPLDFLAGS=\"`${ECHO} ${LDFLAGS} | $SED -e 's/\\([[^ ]]*\\)/-Wl,\\1/g'`\"\n+    TMPLDFLAGS=\"`${ECHO} ${LDFLAGS} | $SED -e 's/\\(-Wl,\\)\\?\\([[^ ]]\\+\\)/-Wl,\\2/g'`\"\n     APXSLDFLAGS=\"${APXSLDFLAGS} ${TMPLDFLAGS}\"\n fi\n AC_SUBST(APXSCFLAGS)\n", "bug_id": 45812, "is_private": false, "id": 120687, "time": "2008-09-16T11:13:04Z", "creator": "Brian.Rectanus@breach.com", "creation_time": "2008-09-16T11:13:04Z", "tags": [], "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 45812, "text": "Concerning the unrelated configure problem: That should be fixed in SVN trunk now as well (revision 695003). I used a slightly different pattern though, to make sure we only respect -Wl, in front of a token. The pattern has been tested with Solaris, AIX and Linux sed, though I still need to check the autoconf generated configure.", "id": 120692, "time": "2008-09-16T13:08:42Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-09-16T13:08:42Z", "is_private": false, "attachment_id": null}, {"count": 6, "text": "OK. I have modified the code so that for last packet only the EOS\nis send instead flush+eos.\nThis should now behave like mod_proxy_ajp", "bug_id": 45812, "is_private": false, "id": 120732, "time": "2008-09-18T02:09:22Z", "creator": "mturk@apache.org", "creation_time": "2008-09-18T02:09:22Z", "tags": [], "attachment_id": null}]
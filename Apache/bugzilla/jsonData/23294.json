[{"count": 0, "tags": [], "bug_id": 23294, "attachment_id": null, "id": 44382, "time": "2003-09-20T18:07:18Z", "creator": "tagunov@motor.ru", "creation_time": "2003-09-20T18:07:18Z", "is_private": false, "text": "Chris Rolfe <spamproof@telus.net> reports that IE 6.0 uses\n  GET\n  user-agent: \ncontype\ninsteat of\n  HEAD\n\nHe correctly complains that this causes extraneous load on the \nserver and  bandwidth consumption. If his report is correct Tomcat could sumulate a HEAD request \n(although I'm in doubt what would be best to supply instead of user-agent in such a case: probably \nomit this header or, as we know it's a IE, probably generate smth?) if user-agent is \ncontype?\n\nHere's the original message by Chris Rolfe <spamproof@telus.net>\n\nHere's a \nfollowup to:\n>Subject: DefaultServlet throws a LOT of broken pipe exceptions on mp3s.\n\n-------\nI \nfound the cause of my java.io.IOException \"Broken pipe\" errors.\n\nIE 6 is sending two GET \nrequests for each .mp3 file. I haven't tested the\nbehavior on IE 5.x or other plugin-handled mime \ntypes.\n\nThe first GET sets the request header:\n\nuser-agent = contype\n\nand is a Microsoft \n(ie, non-standard) attempt at data-sniffing intended to\nget just the header information. \nTomcat 4.x starts sending the content data,\nbut IE resets/drops the connection after 30-50k \n(100-500 ms), generating a\n\"Broken pipe\" exception.\n\nIE then sends a second request for the \ncontent using:\n\nuser-agent=Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)\n\nwhich \ncompletes.\n\n[see Microsoft Knowledge Base Articles: KB 293792, KB 254337, KB \n310388.\nNote: KB 310388 describes a fix for multiple posts in IE 6 SP1 (service pack\n1). Tests \nfrom an IE 6 SP1 client however still demonstrate the multiple\nGETs.  \n\nI'm still trying to \ndetermine if the broken pipe GET is the cause of the\nunreliable caching behaving I'm seeing in IE \n6 (symptom: IE 6 clients are\ndownloading about 10x vs. Netscape/Safari clients; few if any \n304\nresponses). \n\n-------\n\nSo, two questions for the karmically kind:\n\n1) Any bright ideas on \na workaround for the user-agent: contype GET? At\npresent it's double-banging my server for 100-\n200k files. Is there a context\nlevel mechanism for filtering, ie, blocking, requests based on \nheaders?\n\n2) Is this more properly a development issue? I see workarounds in the\n4.1.27 and \n5.x source to ignore \"Broken pipe\" exceptions and the multiple\nGET is apparently  rooted in \nkludges from browser 4.x days -- but I got no\nhits for \"user-agent contype\" in a google of the tomcat \narchives.\n\nCheers,\nChris"}, {"count": 1, "tags": [], "bug_id": 23294, "attachment_id": null, "id": 44384, "time": "2003-09-20T18:20:50Z", "creator": "remm@apache.org", "creation_time": "2003-09-20T18:20:50Z", "is_private": false, "text": "No browser specific workarounds will be added.\n5.0.x should never log the IOException, and that's all that will be done to\naddress this issue."}, {"count": 2, "tags": [], "bug_id": 23294, "text": "I'm actually *not* requesting a mod in tomcat to accomodate IE. In fact, I'd argue against \nsuppressing IOExceptions. The frequent broken pipes alerted me (in this case) to an inefficient, \nnon-standard legacy behaviour (the contype multiple GET). \n\nI would in fact suggest that the suppression of broken pipe exceptions be configurable by the web \napp developer. It certainly shouldn't be a hard-coded default. Other aspects of the test  (like the \ndetection of detail messages -- what about localization?) also weigh-in against a hard-coded \noption. \n\nI'm afraid it leaves me, the webapp developer, to handle the remapping onto HEAD requests, but \nthat's not so onerous. ", "id": 44389, "time": "2003-09-20T22:39:51Z", "creator": "spamproof@telus.net", "creation_time": "2003-09-20T22:39:51Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 14335, "attachment_id": null, "id": 25849, "time": "2002-11-07T10:12:14Z", "creator": "tcastelle@generali.fr", "creation_time": "2002-11-07T10:12:14Z", "is_private": false, "text": "We have got a problem applying filters on proxy requests, especially mod_deflate. \n\nWe have an apache 2.0.43 working as a reverse proxy, and we would like him to\ncompress some files, but not everything (for instance, compress .html but not .gif)\n\nTo achieve this, we tried to use AddOutputFilter and AddOutputFilterByType, but\nthose directives don't work in proxy mode (by the way, can you explain why ? And\nis there a futur modification to this restriction ?). However, we tried with\nsomething like that :\n<Proxy *.html>\n  SetOutputFilter DEFLATE\n</Proxy>\n\nIt works fine, but we can't add every files we want to compress manually ! \n\nWhat we need is something like \"Compress all except...\". To do this, a directive\nlike \"UnsetOutputFilter\" or \"SetOutputFilter NONE\" should exist (or does it ?).\n\nFor the moment, our configuration is like that :\n\nSetOutputFilter DEFLATE\n<Proxy *.gif>\n  SetOutputFilter NONE\n</Proxy>\n\nIt works fine, but it's not very \"clean\" as we now have an error in the\nerror_log  for each request :\n[Thu Nov 07 11:04:35 2002] [error] an unknown filter was not added: NONE\n\nThanks in advance for any solution you can think of.\n\nThomas"}, {"count": 1, "tags": [], "creator": "trawick@apache.org", "text": "Please try\n\n<Proxy *.gif>\n  SetEnv no-gzip\n</Proxy>\n\nDEFLATE will still be in the chain of filters, but setting no-gzip \nwill tell it not to do anything.\n\nI'm changing this to an enhancement request since I'm sure your problem\ncan be solved with existing mechanisms.\n\nIf it can't be properly solved and you're left with the \n\"[error] an unknown filter was not added: NONE\"\nproblem, we'll change it back to a normal bug.\n", "id": 26185, "time": "2002-11-13T15:40:17Z", "bug_id": 14335, "creation_time": "2002-11-13T15:40:17Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 14335, "attachment_id": null, "text": "Thanks a lot for your answer.\n\nIt didn't work when I just put a SetEnv no-gzip directive (gif images still\ncompressed...) but it worked with a \"1\" :\n\n<Proxy *.gif>\n  SetEnv no-gzip 1\n</Proxy>\n\nI guess you just forgot it...\nAnyway, thanks a lot for that !\n\nFor my 2nd question, can you explain why AddOutputFilter, and especially\nAddOutputFilterByType, don't work with proxy requests ? We would also like to\nrely on the mime-type of the file when compressing... Maybe is there another\n(unknown to me) directive to do so ?\n\nBesides that last question, I think you can close this \"bug\".\n\nRegards,\n\nThomas.\n", "id": 26201, "time": "2002-11-13T16:58:03Z", "creator": "tcastelle@generali.fr", "creation_time": "2002-11-13T16:58:03Z", "is_private": false}, {"text": "Why doesn't AddOutputFilterByType work with proxy requests? Could it be made to,\nor is the a fundamental reason why it is impossible?", "tags": [], "creator": "rjmunro@arjam.net", "is_private": false, "count": 3, "id": 77348, "time": "2005-07-16T01:29:43Z", "bug_id": 14335, "creation_time": "2005-07-16T01:29:43Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "mguardiola@asp4all.nl", "attachment_id": null, "is_private": false, "id": 77619, "time": "2005-07-25T18:19:04Z", "bug_id": 14335, "creation_time": "2005-07-25T18:19:04Z", "text": "Very annoying bug indeed.. We're trying to use apache as an compression engine \nin front of some webservers. These webservers also host .pdf .ssmil and .ram \nfiles which can't be compressed, because not all browsers handle this \ncorrectly. Those files dont always have extensions, so we cant exclude them \nthat way. What they do have, are correct mimetypes. What we would like to do \nis :\n  AddOutputFilterByType DEFLATE text/html text/plain\n\nThis can't be done with mod_proxy, and I don't think there is another way to \naccomplish this. See example below:\n\n###############################################################\n# cat deflate.conf\n<Virtualhost *>\n  ServerName            direct.test.nl\n  DocumentRoot          /var/www/html\n  AddOutputFilterByType DEFLATE text/html text/plain\n</VirtualHost>\n\n<Virtualhost *>\n  ServerName            proxy.test.nl\n  ProxyPass             /       http://backend.test.nl/\n  ProxyPassReverse      /       http://backend.test.nl/\n  AddOutputFilterByType DEFLATE text/html text/plain\n</VirtualHost>\n\n<Virtualhost *>\n  ServerName            backend.test.nl\n  DocumentRoot          /var/www/html\n</VirtualHost>\n\n###############################################################\n# cat test.sh\n#!/bin/sh\nwget -q --header=\"Accept-Encoding: compress, gzip\" -sO directhtml       \ndirect.test.nl/test.html\nwget -q --header=\"Accept-Encoding: compress, gzip\" -sO directplain      \ndirect.test.nl/test.txt\nwget -q --header=\"Accept-Encoding: compress, gzip\" -sO directpdf        \ndirect.test.nl/test.pdf\nwget -q --header=\"Accept-Encoding: compress, gzip\" -sO proxyhtml        \nproxy.test.nl/test.html\nwget -q --header=\"Accept-Encoding: compress, gzip\" -sO proxyplain       \nproxy.test.nl/test.txt\nwget -q --header=\"Accept-Encoding: compress, gzip\" -sO proxypdf         \nproxy.test.nl/test.pdf\n\nfor i in directhtml directplain directpdf proxyhtml proxyplain proxypdf; do\n  echo -n \"$i: \"\n  compressed=`strings $i | grep Content-Encoding`\n  if [ \"$compressed\" == \"\" ]; then\n    echo \"Not compressed\"\n  else\n    echo $compressed\n  fi\ndone\n\n###############################################################\n# ./test.sh\ndirecthtml: Content-Encoding: gzip\ndirectplain: Content-Encoding: gzip\ndirectpdf: Not compressed\nproxyhtml: Not compressed\nproxyplain: Not compressed\nproxypdf: Not compressed\n\n###############################################################\n\nAs you see, nothing gets compressed using AddOutputFilterByType in combination \nwith mod_proxy. Without AddOutputFilterByType compression works fine, but not \nthe way we would like it to.\n\nRegards, \n\nMarc\n"}, {"count": 5, "tags": [], "creator": "ad@zorel.org", "text": "Hello.\n\nI've got exactly the same problem when proxying servlets responses (i.e. without\nextension).\n\nIs there a plan to fix that \"behaviour\"?\n\nThx. Regards.\nAur\u00e9lien", "id": 81501, "time": "2005-10-21T10:23:15Z", "bug_id": 14335, "creation_time": "2005-10-21T10:23:15Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 14335, "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of 31226 ***", "id": 81502, "time": "2005-10-21T10:28:33Z", "creator": "nick@webthing.com", "creation_time": "2005-10-21T10:28:33Z", "is_private": false}]
[{"count": 0, "text": "In Windows Vista and Windows 2008, many registry entries are now reg_expand_sz's which use environment variables substitution to resolve their actual path.  And example of this is the ADODB componets.  This means that cgi applications need to have the 'CommonProgramFiles' environment variable passed if they attempt to instantiate these components via COM.  This is common with PHP.\n\nHowever,on 64bit platforms one must also pass the 'CommonProgramFiles(x86)' environment variable if launching 32bit cgi programs. Apache's only allows alphanumerics in the name of environment variables passed and converts CommonProgramFiles(x86) to CommonProgramFiles_x86_  This means that the 32bit client does not have the correct environment setup and com can not expand the registry paths when attempting to instantiate components.\n\n( and ) should be allowed in environment variable names.", "bug_id": 46751, "attachment_id": null, "id": 125037, "time": "2009-02-21T13:01:21Z", "creator": "bsobel@symantec.com", "creation_time": "2009-02-21T13:01:21Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "id": 138185, "time": "2010-07-05T16:19:57Z", "bug_id": 46751, "creation_time": "2010-07-05T16:19:57Z", "is_private": false, "text": "AFAICT there's nothing in mod_env to preclude your choice of name if the platform is happy with it.  But I don't have a windows box to test on.\n\nAre you sure it isn't just a matter of needing to escape your brackets?"}, {"count": 2, "tags": [], "bug_id": 46751, "attachment_id": null, "text": "When I had traced the code, there was a loop that only allowed alphanumerics and changed anything else into the _ character causing the issue.  There did not appear to be any way to escaper the characters to prevent this code from modifying the string.", "id": 153410, "time": "2012-02-03T16:49:03Z", "creator": "bsobel@symantec.com", "creation_time": "2012-02-03T16:49:03Z", "is_private": false}, {"count": 3, "tags": [], "text": "Title:  Can't Set or Pass Environment Variables who's names contain special characters '(' or ')'. \n\nWhen I set the parameters in httpd.conf to pass Windows 7 x64 bit environment variables to CGI based applications, then as stated before, if they contain any special characters, then these characters are replaced with underscores \"_\".  This can cause CGI applications which are x32 based running on an x64 based OS to fail, as the underlying components cannot discern the correct x32 path to the necessary libraries. \n\n---------------------------------------------------------\nExample:  httpd.conf file with a virtual host settings to pass env. variables.\n\n<VirtualHost myserver.homesite.com:80>\n\nPassEnv ProgramFiles\nPassEnv ProgramFiles(x86)\nPassEnv CommonProgramFiles(x86)\nPassEnv CommonProgramFiles\nPassEnv CommonProgramFilesW6432\n\n</VirtualHost>\n\n\nDebug Output of passed Environment variables to the CGI app: \nNote the replacement of (x86) with _86_  in the Variable Names.\n----------------------\nProgramFiles=C:\\Program Files (x86)\nProgramFiles_x86_=C:\\Program Files (x86)\nCommonProgramFiles_x86_=C:\\Program Files (x86)\\Common Files\nCommonProgramFiles=C:\\Program Files (x86)\\Common Files\n\n\n---------------------------------------------------------\nAfter having our CGI apps. work flawlessly for years with Windows XP on Apache, the following errors were seen immediately after upgrade to Win 7 x64. \n\nThe following error was encountered at the point the CGI app. initiated a call for ADO to action (which then called the underlying OS component), which was not found at the location indicated by the incorrect env. variable.  \n\nError in the following Subroutine:  LogonToDatabase\nError Number = -2147024770  Automation error\nThe specified module could not be found. \n\nAfter much research, and code testing, I have confirmed and verified the cause of the problem is Apache's substitution in the Environment Variable names for the (x86) with _x86_ .\n\n---------------------------------------------------------\nAdditional info:  \nFor those affected, there is a work around to this problem to apply Env. Variables in the CGI app. when it launches, but it's a kludge.  \n\nThere is a large potential for affected users in the Windows environment, as this affects any legacy VB app that uses ADO (Database) components and possible other COM based features.   \n\nhttps://forums.embarcadero.com/thread.jspa?threadID=57551\n\nI hope it's a rather simple fix, as it would be a great benefit to address. Thanks. \n\n\n---------------------------------------------------------------------------\nNOTE:  SetEnv is also impacted by this bug on Windows x64. \nHttpd.conf:  \n\nSetEnv ProgramFiles \"C:\\Program Files\"\nSetEnv \"ProgramFiles(x86)\" \"C:\\Program Files (x86)\"\nSetEnv ProgramFilesW6432 \"C:\\Program Files\"\nSetEnv CommonProgramFiles \"C:\\Program Files\\Common Files\"\nSetEnv \"CommonProgramFiles(x86)\" \"C:\\Program Files (x86)\\Common Files\"\nSetEnv CommonProgramFilesW6432 \"C:\\Program Files\\Common Files\"\n\n\nResults in CGI Debug app:\n\nProgramFiles=C:\\Program Files\nProgramFiles_x86_=C:\\Program Files (x86)\nProgramFilesW6432=C:\\Program Files\nCommonProgramFiles=C:\\Program Files\\Common Files\nCommonProgramFiles_x86_=C:\\Program Files (x86)\\Common Files\nCommonProgramFilesW6432=C:\\Program Files\\Common Files\n\n\nKeywords:  PassEnv, SetEnv, Environment Variable, Windows 7 x64, CGI application, VB6, ADODB", "is_private": false, "bug_id": 46751, "id": 167039, "time": "2013-05-04T22:49:20Z", "creator": "sjp4@yahoo.com", "creation_time": "2013-05-04T22:49:20Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "john@leineweb.de", "attachment_id": null, "id": 175342, "time": "2014-05-20T11:43:28Z", "bug_id": 46751, "creation_time": "2014-05-20T11:43:28Z", "is_private": false, "text": "If you have a combination of windows x64, apache and a win32 cgi (exe) using ADODB you have the problem that the enviroment variable CommonProgramFiles(x86)is translated into CommonProgramFiles_x86_\n\nAdodb needs that env-variable to find the software, so it ends there.\n\n\nThe problem lies in util_script.c (2.4.9)\n\nAP_DECLARE(char **) ap_create_environment(apr_pool_t *p, apr_table_t *t)\n{\n...\n        while (*whack != '=') {\n            if (!apr_isalnum(*whack)) {\n                *whack = '_';\n            }\n            ++whack;\n        }\n...\n}\n\n\nI propose a Change into : \n\n        while (*whack != '=') {\n            if (!apr_isalnum(*whack) && *whack != '(' && *whack != ')') {\n                *whack = '_';\n            }\n            ++whack;\n        }\n\n\nYou also need the following in Httpd.conf:  \n\nSetEnv ProgramFiles \"C:\\Program Files\"\nSetEnv \"ProgramFiles(x86)\" \"C:\\Program Files (x86)\"\nSetEnv ProgramFilesW6432 \"C:\\Program Files\"\nSetEnv CommonProgramFiles \"C:\\Program Files\\Common Files\"\nSetEnv \"CommonProgramFiles(x86)\" \"C:\\Program Files (x86)\\Common Files\"\nSetEnv CommonProgramFilesW6432 \"C:\\Program Files\\Common Files\"\n\nI tested the proposal with httpd 2.2 and httpd 2.4.9. Works fine.\n\nSend me a message if you need the mod_cgi.so file\n\ncheers\n\nJohn"}, {"count": 5, "tags": [], "creator": "christophe.jaillet@wanadoo.fr", "attachment_id": null, "id": 187338, "time": "2016-01-03T14:27:45Z", "bug_id": 46751, "creation_time": "2016-01-03T14:27:45Z", "is_private": false, "text": "This has been fixed in trunk in r1705217"}, {"count": 6, "tags": [], "creator": "melezhik@gmail.com", "attachment_id": null, "id": 188101, "time": "2016-02-01T10:12:46Z", "bug_id": 46751, "creation_time": "2016-02-01T10:12:46Z", "is_private": false, "text": "Hi!\n\nConforming that this is issue is resolved ta my environment:\n\n( https://github.com/melezhik/apache-swat is easy way to verify some existed apache issues on your environment )\n\n\nvagrant@Debian-jessie-amd64-netboot:~/my/apache-swat$ swat  -t 46751/\n/home/vagrant/.swat/.cache/11186/prove/46751/data.shtml/00.GET.t ..\nok 1 - GET 127.0.0.1/46751/data.shtml succeeded\n# http headers saved to /home/vagrant/.swat/.cache/11186/prove/Vmn8B65NaI.hdr\n# body saved to /home/vagrant/.swat/.cache/11186/prove/Vmn8B65NaI\nok 2 - output match 'data 46751'\nok 3 - output match 'BAR(123)=123'\n1..3\nok\nAll tests successful.\nFiles=1, Tests=3,  0 wallclock secs ( 0.03 usr  0.00 sys +  0.05 cusr  0.00 csys =  0.08 CPU)\nResult: PASS\n\n\nApache compile info:\n\nvagrant@Debian-jessie-amd64-netboot:~/my/apache-swat$ sudo ~/apache/bin/apachectl -V\nServer version: Apache/2.4.18 (Unix)\nServer built:   Jan 30 2016 10:17:37\nServer's Module Magic Number: 20120211:52\nServer loaded:  APR 1.5.1, APR-UTIL 1.5.4\nCompiled using: APR 1.5.1, APR-UTIL 1.5.4\nArchitecture:   64-bit\nServer MPM:     event\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=256\n -D HTTPD_ROOT=\"/home/vagrant/apache/\"\n -D SUEXEC_BIN=\"/home/vagrant/apache//bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.type"}, {"count": 7, "tags": [], "creator": "ylavic.dev@gmail.com", "attachment_id": null, "id": 189887, "time": "2016-04-01T12:22:11Z", "bug_id": 46751, "creation_time": "2016-04-01T12:22:11Z", "is_private": false, "text": "Backported to 2.4.20 in r1737360."}, {"count": 8, "tags": [], "bug_id": 46751, "attachment_id": null, "text": "Thanks Yann", "id": 190071, "time": "2016-04-08T16:42:45Z", "creator": "gls@gknw.net", "creation_time": "2016-04-08T16:42:45Z", "is_private": false}]
[{"attachment_id": null, "tags": [], "bug_id": 8760, "text": "There seems to be an error in the handling of If-Modified-Since.\n\nSteps to reproduce:\n\n1. Send the following request to www.dawnorchid.com:\n\nGET / HTTP/1.1\nHost: www.dawnorchid.com\n\nResulting header is\n\nHTTP/1.1 200 OK\nDate: Sat, 04 May 2002 02:07:27 GMT\nServer: Apache/2.0.35 (Win32) PHP/4.2.0\nLast-Modified: Mon, 29 Apr 2002 07:58:14 GMT\n\n2. Send another request for the same page, using the above timestamp in an If-\nModified-Since field.\n\nGET / HTTP/1.1\nHost: www.dawnorchid.com\nIf-Modified-Since: Mon, 29 Apr 2002 07:58:14 GMT\n\nExpected result: a 304 Not Modified response.\nActual result: a 200 OK response with the full HTML page.\n\nIf I change the time in the If-Modified-Since field to one second later \n(07:58:15 instead of 07:58:14), the expected 304 Not Modified response is \nreturned.", "count": 0, "id": 15379, "time": "2002-05-03T02:53:36Z", "creator": "ericmao@stanford.edu", "creation_time": "2002-05-03T02:53:36Z", "is_private": false}, {"attachment_id": 1770, "tags": [], "bug_id": 8760, "text": "Created attachment 1770\nProposed patch", "count": 1, "id": 15387, "time": "2002-05-03T06:59:16Z", "creator": "jwoolley@apache.org", "creation_time": "2002-05-03T06:59:16Z", "is_private": false}, {"count": 2, "text": "This seems to be a problem with the modification time resolution being too high \non Win32.  The HTTP spec only gives us seconds, which we convert to APR's \ninternal time representation, apr_time_t (which is microseconds since the \nepoch).  We compare that to the mtime, also converted to an apr_time_t.  On \nUNIX, that's not a problem, because the mtime has only second resolution, so \nthe comparison works.  But on Win32, the resolution can be higher than that, so \nthe file modification time can be that second plus some number of microseconds, \nwhich is of course higher than the time specified in the HTTP header (which had \n0 microseconds).  Solution?  Always do the comparisons in seconds, not in \napr_time_t's (microseconds).\n\nSomething similar is most likely happening with If-Unmodified-Since, by the \nway.  Attached is a patch... please try it out and see if it fixes your problem.\n\n", "bug_id": 8760, "is_private": false, "id": 15388, "time": "2002-05-03T07:00:04Z", "creator": "jwoolley@apache.org", "creation_time": "2002-05-03T07:00:04Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 8760, "text": "Alright, well, I went ahead and committed this patch.  Verification would be \nnice, so if you could test this I'd really appreciate it.  It will be a part of \n2.0.37.\n\nThanks for using Apache!", "id": 15696, "time": "2002-05-08T02:18:28Z", "creator": "jwoolley@apache.org", "creation_time": "2002-05-08T02:18:28Z", "is_private": false, "attachment_id": null}]
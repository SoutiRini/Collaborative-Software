[{"count": 0, "tags": [], "bug_id": 50025, "attachment_id": null, "id": 140297, "time": "2010-09-29T09:48:26Z", "creator": "tcl6@cornell.edu", "creation_time": "2010-09-29T09:48:26Z", "is_private": false, "text": "See http://forum.springsource.org/showthread.php?t=95980 for a description of the problem."}, {"count": 1, "tags": [], "bug_id": 50025, "attachment_id": null, "id": 140928, "time": "2010-10-22T09:57:37Z", "creator": "bsnyder@apache.org", "creation_time": "2010-10-22T09:57:37Z", "is_private": false, "text": "Here's the description that I copy/pasted from the Spring forums: \n\nIn Websphere I was able to wire an interceptor around all of my controllers and set thread-bound DB credentials based on the path of the current request. In my tcServer Developer edition (2.3.3 M1) this no longer works. My datasource is wired as a\n\norg.springframework.jdbc.datasource.UserCredential sDataSourceAdapter\n\nI've verified that I'm calling the getConnection(String username, String password) method with the correct credentials. However, the connection that is returned is of type\n\nProxyConnection[PooledConnection[oracle.jdbc.driver.T4CConnection@6ab4a7]]\n\nwith the same default credentials as those defined in server.xml. Is there another way to set the database credentials at runtime?"}, {"count": 2, "tags": [], "bug_id": 50025, "attachment_id": null, "id": 140931, "time": "2010-10-22T10:25:43Z", "creator": "bsnyder@apache.org", "creation_time": "2010-10-22T10:25:43Z", "is_private": false, "text": "Do you have a code example to show how you receive this error? Or perhaps even a JUnit test?"}, {"count": 3, "tags": [], "bug_id": 50025, "attachment_id": null, "id": 140932, "time": "2010-10-22T10:29:26Z", "creator": "tcl6@cornell.edu", "creation_time": "2010-10-22T10:29:26Z", "is_private": false, "text": "(In reply to comment #2)\n> Do you have a code example to show how you receive this error? Or perhaps even\n> a JUnit test?\n\nTake a look at the source code for getConnection.  It was included in a reply to my original post in the forums (reproduced below).\n\n---\nThis is an issue with the new jdbc-pool implementation, it internally always uses the default configured username/password. I suggest raising a bug on the tomcat(jdbc-pool) issue tracker.\n\nThe actual code.\nCode:\npublic class DataSourceProxy implements PoolConfiguration {\n\n...\n   /**\n     * {@link javax.sql.DataSource#getConnection()}\n     */\n    public Connection getConnection(String username, String password) throws SQLException {\n        return getConnection();\n    }\n....\n\n}"}, {"count": 4, "tags": [], "creator": "fhanik@apache.org", "text": "hi Tim, this isn't really a bug, but how the pool operates.\nThis is a pool, meaning it caches connections with a predefined set of credentials as defined in the configuration.\n\nIf we allowed the username/password to be passed, the cache would have to be way more sophisticated, since it could mean that we would have to close a connection, and open a new one with the provided credentials. \n\nSo in the worst case scenario, you'd really not have a pool.\n\nI started working on a simple patch, that would simply reuse the existing cache, and see if the connection had the requested credentials already.\nThis way, the speed is not compromised on the cache, but could lead to unnecessary disconnect/reconnects.\n\nI can show you the patch, attached. (just needs some additional calls to complete it)\n\nBut my gut feel, is that this isn't really a bug. If implemented as a feature, it would need some serious though to not compromise the performance of the existing implementation.", "id": 142266, "attachment_id": null, "bug_id": 50025, "creation_time": "2010-12-01T15:10:14Z", "time": "2010-12-01T15:10:14Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 50025, "attachment_id": 26363, "id": 142267, "time": "2010-12-01T15:11:13Z", "creator": "fhanik@apache.org", "creation_time": "2010-12-01T15:11:13Z", "is_private": false, "text": "Created attachment 26363\nBeginning of a patch to handle DataSource.getConnection(username,password) for a pool"}, {"count": 6, "tags": [], "text": "Created attachment 26455\nPatch to allow the call DataSource.getConnection(username,password)\n\nHere is the patch for allowing DataSource.getConnection(username, password) to be used. In the case of a connection that is connected, is used with a different username, password it is reconnected.\nI'm hesitant to apply this patch at this time as it does slow down the pool doing the passwords checks every time a connection is requested.\n\nI will experiment with a flag to enable/disable the check", "attachment_id": 26455, "id": 143040, "creation_time": "2011-01-03T15:12:51Z", "time": "2011-01-03T15:12:51Z", "creator": "fhanik@apache.org", "bug_id": 50025, "is_private": false}, {"count": 7, "tags": [], "creator": "fhanik@apache.org", "attachment_id": null, "text": "Fixed in version 1.0.9.1\nhttp://people.apache.org/~fhanik/jdbc-pool/", "id": 143042, "time": "2011-01-03T18:36:22Z", "bug_id": 50025, "creation_time": "2011-01-03T18:36:22Z", "is_private": false}]
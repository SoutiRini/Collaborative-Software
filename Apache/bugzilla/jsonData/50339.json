[{"count": 0, "tags": [], "creator": "mueller@wave-computer.de", "text": "I built tomcat-connectors-1.2.31 for httpd-2.2.17, but mod_jk logged a lot of configuration errors, and only removing whitespaces from the beginning of all lines in workers.properties solved it.\n\n\nMy workers properties looked like this:\n\n### Templates ###\n  worker.tpl2.type=ajp13\n  worker.tpl2.lbfactor=100\n  worker.tpl2.fail_on_status=500,503\n  worker.tpl2.socket_timeout=0\n  worker.tpl2.connect_timeout=50000\n  worker.tpl2.connection_pool_size=4\n\nAnd the mod_jk.log said:\n[Thu Nov 25 16:02:54 2010] [8081:140330511210240] [debug] jk_map_read_property::jk_map.c (491): Adding property 'worker.tpl2.lbfactor' with value '000' to map.\n[Thu Nov 25 16:02:54 2010] [8081:140330511210240] [error] jk_map_validate_property::jk_map.c (404): The attribute 'worker.tpl2.socket_tioeout' is not supported - please check the documentation for the supported attributes.\n\nAs you can see the value for lbfactor should be \"100\", but \"000\" was logged, and \"socket_timeout\" is written correctly in the config file, but the log says \"socket_tioeout\"\nI commented out these lines just to see what happens, but that just made it complain about different values a few lines below.\n\nRemoving all whitespaces from the beginning of the lines solved it:\n[Thu Nov 25 16:27:36 2010] [8453:139761970366208] [debug] jk_map_read_property::jk_map.c (491): Adding property 'worker.tpl2.socket_timeout' with value '0' to map.\n\n\nThere also was an Ubuntu bug filed for that problem, but because I built the module myself and did not use distribution packages, it seems that the error is in mod_jk itself.\n\nCheers,\nFrank", "id": 142009, "time": "2010-11-25T11:17:51Z", "bug_id": 50339, "creation_time": "2010-11-25T11:17:51Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "mueller@wave-computer.de", "text": "Forgot the link to the Ubuntu Launchpad bug report:\nhttps://bugs.launchpad.net/ubuntu/+source/libapache-mod-jk/+bug/592576", "id": 142010, "time": "2010-11-25T11:21:28Z", "bug_id": 50339, "creation_time": "2010-11-25T11:21:28Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 50339, "is_private": false, "id": 142134, "time": "2010-11-29T12:07:58Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2010-11-29T12:07:58Z", "tags": [], "text": "Can you please try the following patch:\n\nIndex: common/jk_map.c\n===================================================================\n--- common/jk_map.c     (revision 1032021)\n+++ common/jk_map.c     (working copy)\n@@ -630,6 +630,7 @@\n static size_t trim(char *s)\n {\n     size_t i;\n+    size_t off;\n\n     /* check for empty strings */\n     if (!(i = strlen(s)))\n@@ -646,7 +647,10 @@\n          isspace((int)((unsigned char)s[i])); i++);\n\n     if (i > 0) {\n-        strcpy(s, &s[i]);\n+        for (off = i; '\\0' != s[i]; i++); {\n+            s[i - off] = s[i];\n+        }\n+        s[i - off] = s[i];\n     }\n\n     return strlen(s);\n\nThanks!\n\nRainer"}, {"count": 3, "tags": [], "creator": "mueller@wave-computer.de", "attachment_id": null, "id": 142184, "time": "2010-11-30T06:23:03Z", "bug_id": 50339, "creation_time": "2010-11-30T06:23:03Z", "is_private": false, "text": "(In reply to comment #2)\n\nHi,\n\nthanks for your answer, but I'm afraid the patch does not completely solve the problem.\nThe parser doesn't read any wrong values like \"socket_tioeout\" anymore, but it fails to read some values at all:\n\nworkers.properties looks like this:\n### Templates ###\n## Template 1\n  worker.tpl1.method=Busyness\n  worker.tpl1.sticky_session=True\n  worker.tpl1.recover_time=20\n\n## Template 2\n  worker.tpl2.type=ajp13\n  worker.tpl2.lbfactor=100\n  worker.tpl2.fail_on_status=500,503\n  worker.tpl2.socket_timeout=0\n  worker.tpl2.connect_timeout=50000\n  worker.tpl2.connection_pool_size=4\n\n### /Templates ###\n...\nworker.list=lb_www.domain.tld\nworker.lb_www.domain.tld.maintain=20\nworker.lb_www.domain.tld.type=lb\nworker.lb_www.domain.tld.balance_workers=worker1\nworker.lb_www.domain.tld.reference=worker.tpl1\n\n## Set properties for worker1 (ajp13)\nworker.worker1.reference=worker.tpl2\nworker.worker1.host=10.0.0.1\nworker.worker1.port=9001\nworker.worker1.route=123\n\nThe template entries are indented by 2 spaces, the worker entries are not!\nThat's a formatting error I made, and haven't discovered until yet (the file's got 939 lines ...).\nAll other worker entries are indented just like the templates.\n\nBut when the file looks like this, I get the error:\n[Tue Nov 30 12:13:50 2010] [28294:140392364185344] [debug] jk_map_resolve_references::jk_map.c (816): Copying values from worker.tpl1. to worker.lb_www.domain.tld.\n[Tue Nov 30 12:13:50 2010] [28294:140392364185344] [error] jk_map_inherit_properties::jk_map.c (882): Reference 'worker.tpl1.' not found\n\nSo, it can't read the line that references the template.\nWhen I indent the worker entries by 2 spaces too, everything is fine.\nAlso when I remove the spaces in front of the template lines, it works.\nBut if there is a mixed use of spaces and no spaces, the parser fails.\n\nIt's no problem to fix my config file at all, but it's really hard to find an error like that."}, {"count": 4, "tags": [], "text": "Fixed in r1042364.\n\nThe patch provided in comment #2 had a bug (superfluous semicolon prevented it from working). Please use the final fix which was applied.\n\nWill be part of 1.2.32.", "is_private": false, "id": 142386, "creator": "rainer.jung@kippdata.de", "time": "2010-12-05T09:47:51Z", "bug_id": 50339, "creation_time": "2010-12-05T09:47:51Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Yes, that seems to work.\nThanks a lot, guys!\n\nCheers,\nFrank", "attachment_id": null, "id": 142447, "creator": "mueller@wave-computer.de", "time": "2010-12-07T07:40:27Z", "bug_id": 50339, "creation_time": "2010-12-07T07:40:27Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 50339, "is_private": false, "id": 146809, "time": "2011-06-02T06:42:40Z", "creator": "lovetide@qq.com", "creation_time": "2011-06-02T06:42:40Z", "tags": [], "text": "Same error when parsing uriworkermap.properties (Fedora 15 x86_64, jk-1.2.31 x86_64).\n\n[2011-06-02 14:14:39.676 +0800 Thu] [3441:140715468376096] [debug] jk_map_read_property::jk_map.c (491): Adding property '/*' with value 'localhsst' to map.\n...\n[2011-06-02 14:14:39.680 +0800 Thu] [3441:140715468376096] [trace] uri_worker_map_ext::jk_uri_worker_map.c (497): enter\n[2011-06-02 14:14:39.680 +0800 Thu] [3441:140715468376096] [trace] wc_get_worker_for_name::jk_worker.c (106): enter\n[2011-06-02 14:14:39.680 +0800 Thu] [3441:140715468376096] [debug] wc_get_worker_for_name::jk_worker.c (116): did not find a worker localhsst\n[2011-06-02 14:14:39.680 +0800 Thu] [3441:140715468376096] [trace] wc_get_worker_for_name::jk_worker.c (118): exit\n[2011-06-02 14:14:39.680 +0800 Thu] [3441:140715468376096] [error] uri_worker_map_ext::jk_uri_worker_map.c (506): Could not find worker with name 'localhsst' in uri map post processing.\n\nThanks for fixup!"}]
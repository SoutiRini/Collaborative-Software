[{"count": 0, "tags": [], "bug_id": 60741, "text": "Currently, in NPOIFS (NPOIFSFileSystem + POIFSFileSystem, but not OPOIFSFileSystem), you can either load from a File or from a Stream. With a\nStream, everything gets buffered into memory\n\nWhen loading from a File, you can load read-write or read-only. In\nread-write mode, we use NIO to mmap the file so we can quickly + low memory\nread + write.\n\nThe other case, File + read-only, isn't so ideal. We need to support both\npeople doing true read-only cases, eg reading or text extraction, plus\npeople doing read-template + write or read-change-save-as cases. To support\nthat, we buffer into memory.\n\nInstead, if we changed the read-write state to an enum with 3 states, we could have:\n * Read/Write - unchanged\n * Read Only - mmap in read-only mode, text extraction etc only\n * Read as Template - mmap in private mode, changes buffered in memory, able to write out to a new file\n\nThat'd mean lower memory use, and more consistent code.\n\nNaming TBC", "id": 197117, "attachment_id": null, "creator": "apache@gagravarr.org", "creation_time": "2017-02-17T13:23:59Z", "time": "2017-02-17T13:23:59Z", "is_private": false}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "text": "Help needed with naming the enum and the enum values...", "id": 197118, "time": "2017-02-17T13:24:21Z", "bug_id": 60741, "creation_time": "2017-02-17T13:24:21Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 60741, "attachment_id": null, "text": "(In reply to Nick Burch from comment #1)\n> Help needed with naming the enum and the enum values...\n\nPerhaps\n\npublic enum WriteState {\n    READ_ONLY,\n    IN_PLACE,\n    BUFFERED,\n    ;\n}\n\nwith appropriate JavaDocs indicating restrictions, performance implications, and example use cases.  The Enum and API method JavaDocs would note that this only applies to paths that read from files, not streams.", "id": 197125, "time": "2017-02-17T17:42:54Z", "creator": "gwoolsey@apache.org", "creation_time": "2017-02-17T17:42:54Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 60741, "attachment_id": null, "text": "why invent something new, when there's already an enum [1]?\nI'm not saying, to exactly use FileChannel.MapMode, but something look-a-like. I think the term \"read_write\" is more intuitive - not so sure about \"private\" ... but \"buffered\" could be also associated with something else.\n\n\n[1] https://docs.oracle.com/javase/7/docs/api/java/nio/channels/FileChannel.MapMode.html", "id": 197136, "time": "2017-02-18T14:04:11Z", "creator": "kiwiwings@apache.org", "creation_time": "2017-02-18T14:04:11Z", "is_private": false}]
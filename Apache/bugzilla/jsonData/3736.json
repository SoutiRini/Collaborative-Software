[{"attachment_id": null, "tags": [], "bug_id": 3736, "is_private": false, "count": 0, "id": 5797, "time": "2001-09-19T21:10:29Z", "creator": "mrobinson@baltimore.com", "creation_time": "2001-09-19T21:10:29Z", "text": "consider two servlets, S3 and S4 (source below) where S3 includes S4, \ndetermining S4's name from the PathInfo, e.g. the chain is invoked as follows \nhttp://localhost/servlet/S3/servlet/S4\n\non the very first invocation S4 receives the incorrect ServletPath and PathInfo.  \nthe example output is as follows:\n\nServlet S3\nServlet Path: /servlet/S3\nPath Info: /servlet/S4\nServlet S4\nServlet Path: /servlet/S4\nPath Info: null\n\nnote that if S3 had forwarded to rather than included S4, S4's output would be \ncorrect.\n\non all subsequent invocations the correct info is received:\n\nServlet S3\nServlet Path: /servlet/S3\nPath Info: /servlet/S4\nServlet S4\nServlet Path: /servlet/S3\nPath Info: /servlet/S4\n\nthis works as expected with TC3.2.3\n\nS3.java:\n\npackage test;\n\nimport java.io.*;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\n\npublic final class S3\nextends HttpServlet\n{\n\tpublic void service(HttpServletRequest req, HttpServletResponse res)\n\tthrows ServletException, IOException\n\t{\n\t\tres.getWriter().println(\"Servlet S3\");\n\t\tres.getWriter().println(\"Servlet Path: \" + \nreq.getServletPath());\n\t\tres.getWriter().println(\"Path Info: \" + req.getPathInfo());\n\t\t\n\t\tgetServletContext().getRequestDispatcher(\nreq.getPathInfo()).include(req, res);\n\t} \t\n}\n\nS4.java:\n\npackage test;\n\nimport java.io.*;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\n\npublic final class S4\nextends HttpServlet\n{\n\tpublic void service(HttpServletRequest req, HttpServletResponse res)\n\tthrows ServletException, IOException\n\t{\n\t\tres.getWriter().println(\"Servlet S4\");\n\t\tres.getWriter().println(\"Servlet Path: \" + \nreq.getServletPath());\n\t\tres.getWriter().println(\"Path Info: \" + req.getPathInfo());\n\t} \t\n}"}, {"attachment_id": null, "tags": [], "bug_id": 3736, "text": "Your examples are using request URIs that utilize the Tomcat \"invoker\" servlet. \nBecause invoker service is *not* defined in the servlet specification, there are\nno requirements for how it is to behave.\n\nIn particular, in Tomcat, the invoker is mapped to \"/servlet/*\".  The very first\ntime a request for servlet S3 is processed (say \"/servlet/S3/path/info\"), the\ninvoker servlet will create a *new* servlet definition for this servlet\ndynamically, and map it to \"/servlet/S3/* for all future requests.\n\nHowever, at the moment your filter is called, this has not happened yet (because\nyour filter is called before the invoker servlet).  Therefore, your filter will\nsee the servlet path set to \"/servlet\" and extra path info set to\n\"/S3/path/info\" on the very first request.  This is exactly what the Servlet\nSpecification requires, and cannot be changed.\n\nIf you want consistent results even on the first request, you should explicitly\nmap your servlet to a particular mapping pattern.  That way, your filter will\nalways get consistent results (and your application will also be portable to\nother servlet containers, which it is not right now).\n", "count": 1, "id": 5844, "time": "2001-09-20T14:38:06Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-09-20T14:38:06Z", "is_private": false}, {"count": 2, "tags": [], "creator": "craig.mcclanahan@sun.com", "text": "Oops, ignore the previous comment -- it was intented for a very similar report\nthat was using a filter chain.  Let me do a little more looking -- I will reopen\nthis if needed.\n", "id": 5845, "time": "2001-09-20T14:42:52Z", "bug_id": 3736, "creation_time": "2001-09-20T14:42:52Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 3736, "is_private": false, "count": 3, "id": 5846, "time": "2001-09-20T14:43:52Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-09-20T14:43:52Z", "text": "Reopen during investigation so that this bug doesn't disappear.\n"}, {"attachment_id": null, "tags": [], "bug_id": 3736, "text": "I think it's fixed now (in the HEAD branch). We should add a test case for it.", "count": 4, "id": 5857, "time": "2001-09-20T16:42:23Z", "creator": "remm@apache.org", "creation_time": "2001-09-20T16:42:23Z", "is_private": false}]
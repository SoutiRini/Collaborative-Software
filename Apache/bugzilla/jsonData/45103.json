[{"count": 0, "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "text": "From\nhttp://httpd.apache.org/docs/2.2/programs/apachectl.html :\n\n\"This command automatically checks the configuration files as in configtest before initiating the restart to make sure Apache doesn't die. This is equivalent to apachectl -k graceful.\"\n\nBut apachectl doesn't do a config test. Either apachectl or the documentation should be changed.", "id": 117183, "time": "2008-05-30T10:03:55Z", "bug_id": 45103, "creation_time": "2008-05-30T10:03:55Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 45103, "text": "You specified Version as \"2.3-HEAD\", but the URL you wrote was 2.2 docs.\nYes, as I understand 2.2 apachectl doesn't do config test before graceful restart. So there is a bug.\nHow about trunk(2.3) ?", "id": 117185, "time": "2008-05-30T10:45:30Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-05-30T10:45:30Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "http://httpd.apache.org/docs/trunk/en/stopping.html\nWhen you issue a restart, a syntax check is first run, to ensure that there are no errors in the configuration files. If your configuration file has errors in it, you will get an error message about that syntax error, and the server will refuse to restart. This avoids the situation where the server halts and then cannot restart, leaving you with a non-functioning server.\n\n\nhttp://httpd.apache.org/docs/2.2/en/stopping.html\nIf your configuration file has errors in it when you issue a restart then your parent will not restart, it will exit with an error. In the case of graceful restarts it will also leave children running when it exits.", "attachment_id": null, "id": 117186, "creation_time": "2008-05-30T10:50:02Z", "time": "2008-05-30T10:50:02Z", "creator": "takashi.asfbugzilla@tks.st", "bug_id": 45103, "is_private": false}, {"count": 3, "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "text": "(In reply to comment #1)\n> You specified Version as \"2.3-HEAD\", but the URL you wrote was 2.2 docs.\n> Yes, as I understand 2.2 apachectl doesn't do config test before graceful\n> restart. So there is a bug.\n> How about trunk(2.3) ?\n> \n\nAs far as I can see, trunk's apachectl does no config test either. Therefore I chose 2.3-HEAD.\n", "id": 117188, "time": "2008-05-30T11:19:47Z", "bug_id": 45103, "creation_time": "2008-05-30T11:19:47Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 45103, "text": "The current trunk (2.3) documentation at http://httpd.apache.org/docs/trunk/en/stopping.html states:\n\n\"As with a graceful restart, a syntax check is run before the restart is attempted. If your configuration file has errors in it, the restart will not be attempted, and you will receive notification of the syntax error(s).\"\n\nAs far as I can see, support in apachectl for running a configtest before a restart was removed in r95307 ('simplified apachectl...'): http://svn.apache.org/viewvc/httpd/httpd/trunk/support/apachectl.in?r1=94653&r2=95307\n\nIs there any good reason for apachectl to not test the config before restarting?  Anyone used to the 1.3 behaviour could be very seriously affected by this regression - not least the contradictory documentation.", "id": 120290, "time": "2008-09-02T10:16:27Z", "creator": "matthew@mxtelecom.com", "creation_time": "2008-09-02T10:16:27Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "matthew@mxtelecom.com", "attachment_id": 22517, "text": "Created attachment 22517\nFixes behaviour of apachectl to run configtest before starting server, as per doc\n\nAttached is a patch against trunk to fix apachectl such that it runs configtest before restarting a running server.  This matches the behaviour described in the documentation, and the behaviour expected under Apache 1.3, and significantly reduces the chances of you being left without a running server after accidentally redeploying on a broken config.", "id": 120293, "time": "2008-09-02T11:53:34Z", "bug_id": 45103, "creation_time": "2008-09-02T11:53:34Z", "is_private": false}, {"count": 6, "tags": [], "creator": "matthew@mxtelecom.com", "attachment_id": 22518, "text": "Created attachment 22518\nPerform configtest in apachectl (only) before restarting the httpd\n\nActually, this refines the previous patch to only sanity-check the config before restarting the httpd - if you're starting a new one you obviously get a configtest for free without any disadvantages.", "id": 120301, "time": "2008-09-02T15:49:10Z", "bug_id": 45103, "creation_time": "2008-09-02T15:49:10Z", "is_private": false}]
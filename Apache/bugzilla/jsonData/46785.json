[{"count": 0, "tags": [], "bug_id": 46785, "attachment_id": null, "text": "Using Apache 2.2.3 acting as a proxy, renamed here as wap2d, i'm getting some process at 100% of CPU.\n\nSome times it crashes at apr_brigade_cleanup () and others at apr_bucket_destroy_noop () (see gdb backtrace bellow).\n\nOther times i get a segmentation fault but the core dump file says the same.\n\nI hope that someone can help.\n\nHere is the gdb backtrace:\n\nReading symbols from /usr/lib/httpd/modules/ptin_proxy_wap2_profiles.so...done.\nLoaded symbols for /etc/httpd/modules/ptin_proxy_wap2_profiles.so\nReading symbols from /usr/lib/httpd/modules/ptin_proxy_wap2_http.so...done.\nLoaded symbols for /etc/httpd/modules/ptin_proxy_wap2_http.so\nReading symbols from /usr/lib/httpd/modules/mod_proxy_connect.so...done.\nLoaded symbols for /etc/httpd/modules/mod_proxy_connect.so\nReading symbols from /usr/lib/httpd/modules/mod_charset_lite.so...done.\nLoaded symbols for /etc/httpd/modules/mod_charset_lite.so\nReading symbols from /usr/lib/httpd/modules/mod_substitute.so...done.\nLoaded symbols for /etc/httpd/modules/mod_substitute.so\nReading symbols from /lib/libnss_dns.so.2...done.\nLoaded symbols for /lib/libnss_dns.so.2\n0x00fe8140 in apr_bucket_destroy_noop ()\n   from /usr/lib/libaprutil-1.so.0\n(gdb) where\n#0  0x00fe8140 in apr_bucket_destroy_noop () from /usr/lib/libaprutil-1.so.0\n#1  0x00fe84ef in apr_brigade_cleanup () from /usr/lib/libaprutil-1.so.0\n#2  0x00fe852d in apr_brigade_cleanup () from /usr/lib/libaprutil-1.so.0\n#3  0x0033cc7d in apr_pool_cleanup_run () from /usr/lib/libapr-1.so.0\n#4  0x0033d5c7 in apr_pool_clear () from /usr/lib/libapr-1.so.0\n#5  0x00736714 in ap_graceful_stop_signalled () from /usr/sbin/wap2d\n#6  0x00736bf1 in ap_graceful_stop_signalled () from /usr/sbin/wap2d\n#7  0x00736cca in ap_graceful_stop_signalled () from /usr/sbin/wap2d\n#8  0x0073782b in ap_mpm_run () from /usr/sbin/wap2d\n#9  0x0070e127 in main () from /usr/sbin/wap2d\n(gdb) up\n#1  0x00fe84ef in apr_brigade_cleanup () from /usr/lib/libaprutil-1.so.0\n(gdb) up\n#2  0x00fe852d in apr_brigade_cleanup () from /usr/lib/libaprutil-1.so.0\n(gdb) up\n#3  0x0033cc7d in apr_pool_cleanup_run () from /usr/lib/libapr-1.so.0\n(gdb) up\n#4  0x0033d5c7 in apr_pool_clear () from /usr/lib/libapr-1.so.0\n(gdb) up\n#5  0x00736714 in ap_graceful_stop_signalled () from /usr/sbin/wap2d\n(gdb) up\n#6  0x00736bf1 in ap_graceful_stop_signalled () from /usr/sbin/wap2d\n(gdb) up\n#7  0x00736cca in ap_graceful_stop_signalled () from /usr/sbin/wap2d\n(gdb) up\n#8  0x0073782b in ap_mpm_run () from /usr/sbin/wap2d\n(gdb) up\n#9  0x0070e127 in main () from /usr/sbin/wap2d\n(gdb) up\n\n\n\n\nHere is my config:\n\nwap2d -M\nLoaded Modules:\n core_module (static)\n mpm_prefork_module (static)\n http_module (static)\n so_module (static)\n auth_basic_module (shared)\n auth_digest_module (shared)\n authn_file_module (shared)\n authn_alias_module (shared)\n authn_anon_module (shared)\n authn_dbm_module (shared)\n authn_default_module (shared)\n authz_host_module (shared)\n authz_user_module (shared)\n authz_owner_module (shared)\n authz_groupfile_module (shared)\n authz_dbm_module (shared)\n authz_default_module (shared)\n ldap_module (shared)\n authnz_ldap_module (shared)\n include_module (shared)\n log_config_module (shared)\n logio_module (shared)\n env_module (shared)\n ext_filter_module (shared)\n mime_magic_module (shared)\n expires_module (shared)\n deflate_module (shared)\n headers_module (shared)\n usertrack_module (shared)\n setenvif_module (shared)\n mime_module (shared)\n dav_module (shared)\n status_module (shared)\n autoindex_module (shared)\n info_module (shared)\n dav_fs_module (shared)\n vhost_alias_module (shared)\n negotiation_module (shared)\n dir_module (shared)\n actions_module (shared)\n speling_module (shared)\n userdir_module (shared)\n alias_module (shared)\n rewrite_module (shared)\n proxy_module (shared)\n proxy_balancer_module (shared)\n proxy_ftp_module (shared)\n proxy_http_module (shared)\n proxy_connect_module (shared)\n cache_module (shared)\n suexec_module (shared)\n disk_cache_module (shared)\n file_cache_module (shared)\n mem_cache_module (shared)\n cgi_module (shared)\n version_module (shared)\n proxy_ajp_module (shared)\n ssl_module (shared)\n\nRegards,\nCarlos Marinho", "id": 125243, "time": "2009-03-02T03:20:45Z", "creator": "migasgw@gmail.com", "creation_time": "2009-03-02T03:20:45Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 46785, "attachment_id": null, "text": "I suggest moving to the current release (2.2.11 at the moment).  If you still have problems, try commenting out all the modules you're not using.  If that doesn't help, you'll probably have to provide your exact configuration and detailed instructions for recreating the problem for someone to be able to help. \n\nAll I can tell from the stack trace is that something probably corrupted memory at some time in the past, and apache tripped over it when it tried to clean up during a normal shutdown.  So you might be able to catch the problem by building APR with malloc and pool debugging enabled.", "id": 125661, "time": "2009-03-20T10:18:05Z", "creator": "poirier@pobox.com", "creation_time": "2009-03-20T10:18:05Z", "is_private": false}]
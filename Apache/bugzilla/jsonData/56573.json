[{"count": 0, "tags": [], "bug_id": 56573, "attachment_id": null, "text": "The spec is unclear about it, but \n    \n    Session.getRequestURI();\n\ndoesn't return the full path, e.g for an enpoint, it returns\n\n   /atmosphere-chat\n\n\"instead\" of \n\n   ws://host:port/atmosphere-chat\n\nThe issue I'm facing is an application cannot rebuidl the full URL as the port is missing, and there are no way to find the port without the proper URI.", "id": 175535, "time": "2014-05-28T19:51:38Z", "creator": "jfarcand@apache.org", "creation_time": "2014-05-28T19:51:38Z", "is_private": false}, {"count": 1, "tags": [], "text": "One to raise with the EG for clarification.\n\nAs an aside, why does an application need to rebuild the full URL?", "attachment_id": null, "id": 175536, "creator": "markt@apache.org", "time": "2014-05-28T20:02:05Z", "bug_id": 56573, "creation_time": "2014-05-28T20:02:05Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 56573, "attachment_id": null, "is_private": false, "id": 175537, "time": "2014-05-28T20:05:40Z", "creator": "jfarcand@apache.org", "creation_time": "2014-05-28T20:05:40Z", "text": "For tracking purpose\n\nhttps://java.net/jira/browse/WEBSOCKET_SPEC-228\n\nAtmosphere can dispatch a WebSocket Message into a normal HttpServletRequest so an application transparently use WebSocket under the hood. This is the use case. For example, RestEasy is broken because of the \"issue\", but will workaround it."}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "I've switched this to the full uncoded path minus the query string (i.e. the result of HttpServletRequest.getRequestURL()) but with ws/wss as the scheme rather than http/https. Note that this might change again once/if the EG issues some clarification.\n\nThis has been fixed in 8.0.x for 8.0.9 onwards and in 7.0.x for 7.0.55", "id": 175668, "time": "2014-06-05T13:34:41Z", "bug_id": 56573, "creation_time": "2014-06-05T13:34:41Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "knst.kolinko@gmail.com", "is_private": false, "text": "HttpServletRequest.getRequestURI():\nhttp://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#getRequestURI%28%29\n\nSession.getRequestURI()\nhttp://docs.oracle.com/javaee/7/api/javax/websocket/Session.html#getRequestURI%28%29\n\nThe WebSocket method is clearly documented to include a query string (as opposed to HttpServletRequest method). It also returns an URI, not a String. These are different methods.\n\nPersonally, it is not clear to me from WebSocket documentation whether this method includes a contextPath, not saying about protocol, server name and port. It is also not clear whether it is \"decoded\" or non-decoded path (see Servlet API method), but as it is an URI maybe it does not matter.", "id": 175669, "time": "2014-06-05T13:45:34Z", "bug_id": 56573, "creation_time": "2014-06-05T13:45:34Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 56573, "attachment_id": null, "is_private": false, "id": 175670, "time": "2014-06-05T13:51:41Z", "creator": "markt@apache.org", "creation_time": "2014-06-05T13:51:41Z", "text": "(In reply to Konstantin Kolinko from comment #4)\n> The WebSocket method is clearly documented to include a query string\n\nI went looking for that and couldn't find it. I'll add the query string back in."}, {"count": 6, "text": "Done.", "bug_id": 56573, "attachment_id": null, "id": 175671, "time": "2014-06-05T13:58:53Z", "creator": "markt@apache.org", "creation_time": "2014-06-05T13:58:53Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 56573, "attachment_id": null, "text": "I've received reports that this change triggers a TCK failure. I'll therefore be reverting this change.", "id": 175708, "time": "2014-06-06T16:42:28Z", "creator": "markt@apache.org", "creation_time": "2014-06-06T16:42:28Z", "is_private": false}, {"count": 8, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "The current behavior is required by the TCK.", "id": 175710, "time": "2014-06-06T16:51:06Z", "bug_id": 56573, "creation_time": "2014-06-06T16:51:06Z", "attachment_id": null}]
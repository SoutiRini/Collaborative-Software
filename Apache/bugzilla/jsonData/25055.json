[{"count": 0, "tags": [], "bug_id": 25055, "attachment_id": null, "is_private": false, "id": 48257, "time": "2003-11-27T16:41:20Z", "creator": "stefos@msc.gr", "creation_time": "2003-11-27T16:41:20Z", "text": "this bug may be related to BUG 12196\nI have\nFedora Linux \napache 2.0.47\ntomcat 4.1.29\nmod_jk 1.2.5 downloaded from\nhttp://us.dl.sf.net/jpackage/direct_download/1.5/fedora-1/free/RPMS/mod_jk-ap20-1.2.5-2jpp.i386.rpm\napache + tomcat virtual host where some pages are protected with apache basic auth\n\nI have some pages protected by apache basic authentication with an .htaccess\nfile and inside the protected JSPSs the request.getRemoteUser() returns null.\nI have tried putting request.tomcatAuthentication=false into jk2.properties and\nin the connector declaration with no effect.\nAt the beginning I used the sample server.xml with the addition of my virtual\nhosts. Now I came up with this simple server.xml\n<Server port=\"8005\" shutdown=\"xxxxxxxxxxxxx\" debug=\"0\">\n\t<Service name=\"Tomcat-Apache\">\n\t\t<Connector className=\"org.apache.ajp.tomcat4.Ajp13Connector\"\n\t\t\taddress=\"MY_IP\" port=\"8009\" minProcessors=\"5\" maxProcessors=\"75\"\n\t\t\tenableLookups=\"false\" acceptCount=\"10\" debug=\"0\"/>\n\t\t\t\n\t\t<Engine name=\"your_engine\" debug=\"0\" defaultHost=\"hostname\">\n\t\t\t<Logger className=\"org.apache.catalina.logger.FileLogger\"\n\t\t\t\tdirectory=\"/var/log/tomcat\" prefix=\"catalina_log.\" suffix=\".txt\" \n\t\t\t\ttimestamp=\"true\"/>\n\t\t\t\t\n     <Host name=\"www.epe.org.gr\" debug=\"0\">\n           <Context path=\"\"\n                    docBase=\"/var/www/virtual/epe\" \n                    debug=\"0\" reloadable=\"true\"/>\n\n        <Logger className=\"org.apache.catalina.logger.FileLogger\" debug=\"0\" \n            directory=\"/var/log/tomcat\"  \n            prefix=\"loganame_log.\" \n            suffix=\".txt\" timestamp=\"true\" verbosity=\"1\"/>\n\t\t</Host>\n\t\t</Engine>\n\t</Service>\n</Server>\n\n\n\nmy worker.properties is\nworkers.tomcat_home=/opt/tomcat/\nworkers.java_home=/opt/java/\nps=/\nworker.list=ajp13\nworker.ajp13.type=ajp13\nworker.ajp13.host=139.91.200.22\nworker.ajp13.port=8009\nworker.ajp13.lbfactor=1\nworker.ajp13.cachesize=10\nworker.ajp13.cache_timeout=600\nworker.ajp13.socket_keepalive=1\nworker.ajp13.socket_timeout=300\n\n\nJudging from bug 12196 there have been made some changes recently to this issue,\nso I would appreciate if anyone could either confirm this bug or provide \"the\nstate of the art\" on how to make this work.\n\nThanks \nStefanos Karasavvidis"}, {"count": 1, "tags": [], "bug_id": 25055, "attachment_id": null, "is_private": false, "id": 48332, "time": "2003-12-01T10:28:22Z", "creator": "stefos@msc.gr", "creation_time": "2003-12-01T10:28:22Z", "text": "Does this work for everyone except me?\nCould _please_ anyone confirm or reject this bug?\n\nA RTFM would also be ok, but I doubt that there is anything there I haven't read\nyet... including list archives \n\nIf my bug description is not clear enough, I can try to clarify it"}, {"count": 2, "tags": [], "text": "I don't know. The connector you're using (org.apache.ajp.tomcat4.Ajp13Connector)\nis deprecated. Did you try the default connector for AJP ?\nBTW, tomcatAuthentication=false on the Connector element is needed for this\nfeature to work.", "is_private": false, "id": 48333, "creator": "remm@apache.org", "time": "2003-12-01T11:00:27Z", "bug_id": 25055, "creation_time": "2003-12-01T11:00:27Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 25055, "text": "Remy, thanks for the response.\n\nFirst to your comments\nI had tried the default connector at the beginning, and I also tried to put\ntomcatAuthentication=false inside the connector element. The same results.... \n\nBUT I just realised that the problem is much deeper and may be a result from a\nwrong interpretation from my part. As I just saw, a call to\nhttp://myhostname/myprotecteddir/\n_does_ correctly return the username, whereas\nhttp://myhostname/myprotecteddir/index.jsp\ndoes _not_ return the username and even _does_ _not_ ask for a login/password at\nall. I understand that in the second case apache sends the request to tomcat as\nit detects the *.jsp extension, without checking the existence of the .htaccess\nfile.\n\nThis is a different behaviour than I had with both tomcat 3.3 and 4.1.24 (both\non apache 1.3.. I now use apache 2)\nMy httpd.conf has a simple\n JkMount /*.jsp ajp13\n JkMount /servlet/* ajp13\n\nIt doesn't seem a \"LoadModule order\" issue, as I tried to reverse the order of\nmod_jk with mod_auth\n\nSo I'm stumped right now... is it supposed to work like this?? Then how can I\nprotect all pages below a directory using apache's basic auth mechanism? \n\nAlthough this turns out to be a tomcat-user issue, I would appreciate a short\nanswer if this is indeed the way it is supposed to work\n", "id": 48345, "time": "2003-12-01T16:23:24Z", "creator": "stefos@msc.gr", "creation_time": "2003-12-01T16:23:24Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "ok, I found a workaround to my problem by placing the <limit> tag directly into\nthe httpd.conf instead of a .htaccess file\n\nThis looks then like this\n<VirtualHost....\n  <Location /protecteddir>\n\t\tAuthUserFile /path_to_.htpasswd\n\t\tAuthGroupFile /dev/null\n\t\tAuthName \"Please enter username and password\"\n\t\tAuthType Basic\n\t\t<Limit GET POST>\n\t\trequire valid-user\n\t\t</Limit>\n  </Location> \n\nI remember from the 3.1 or 3.2 versions that this was the only way to use apache\nfor protecting jsp pages, but at least on 3.3 and 4.1.24 this worked also with\nsimple .htaccess files.\nI have looked at my old configuration of 4.1.24 and could not find anything that\nwould explain this, so I assume that this is indeed a bug or just a change in\nbehaviour of the connector.", "is_private": false, "id": 48370, "creator": "stefos@msc.gr", "time": "2003-12-02T07:43:12Z", "bug_id": 25055, "creation_time": "2003-12-02T07:43:12Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "ben_kelley@ubsw.com", "text": "I strongly suggest adding 'tomcatAuthentication=\"false\"' to your \n<Connector />. Yes - this is a change in the default behaviour from older \nversions (e.g. Tomcat 3). This should fix your problem.", "id": 48661, "time": "2003-12-08T06:13:04Z", "bug_id": 25055, "creation_time": "2003-12-08T06:13:04Z", "is_private": false, "attachment_id": null}, {"text": "Ben, I did this already. \nThe issue is that that using a .htaccess file does not protect tomcat served\nrequests (*.jsp). It bypasses apache and does not ask for a login/password.\n\nI see this in apache 2.047 + tomcat 4.1.29 (both windows and linux) whereas\napache 1.3.29 +  tomcat 4.1.24 worked fine\nI do not know if this a tomcat or an apache issue. I'm going to write an email\nto tomcat-user to see if anyone else experiences this problem.\n", "tags": [], "creator": "stefos@msc.gr", "is_private": false, "count": 6, "id": 48662, "time": "2003-12-08T08:28:55Z", "bug_id": 25055, "creation_time": "2003-12-08T08:28:55Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "stefos@msc.gr", "text": "I had 3 private emails the past week about this issue from people who have the\nsame problem. I refered them to my comment from \"2003-12-02 07:43\".\n\nAs this is a security issue, I think this bug is important enough to justify a\ncomment in the release notes of mod_jk... \n\nI'm also changing the summary to reflect the real problem in this bug report and\nnot the initial problem I had encountered", "id": 51579, "time": "2004-02-02T13:10:20Z", "bug_id": 25055, "creation_time": "2004-02-02T13:10:20Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 25055, "attachment_id": null, "id": 63302, "time": "2004-09-09T17:10:29Z", "creator": "alexis@bookmark.fr", "creation_time": "2004-09-09T17:10:29Z", "is_private": false, "text": "I posted this one in Apache 2.0 bug database.\nI think I found the problem but no soltution to it. \nI agree, this is a security issue.\n\n_______\n\nThere seems to be a difference between Apache 1.3 and 2.0 : they don't handle\nhtaccess files the same way. \n\nLet's say I have a site , protected with an authentification module (e.g\nmod_auth_pgsql)\nThe site is opened to eveyone, but some directories are dynamically group protected.\n\nIn this case, we have a httpd.conf with :\n\n                <Directory \"/var/www/html/mysite\">\n                        AuthName \"My Realm\"\n                        AuthType basic\n                        Auth_PG_host myhost.mydomain.org\n                        Auth_PG_port 5432\n                        Auth_PG_database users\n                        Auth_PG_encrypted off\n                        Auth_PG_user admin\n                        Auth_PG_pwd admin\n                         Auth_PG_pwd_table users\n                        Auth_PG_uid_field iduser\n                        Auth_PG_pwd_field passwd\n                        Auth_PG_grp_table group\n                        Auth_PG_grp_user_field iduser\n                        Auth_PG_grp_group_field group\n                        AllowOverride All\n               </Directory>\n\nand a .htaccess file in /var/www/html/mysite/secretdir that requires a\nparticular group\n\n             Require group secret\n\nThis works perfectly in both versions (1.3 and 2.0) with both mod_auth_pgsql\nadapted modules. All files within secretdir are protected.\n\nThe problem appears you're asking Apache to serve  JSP files, which are handled\nby  Tomcat through a mod_jk or mod_jk2 connector (same behavior, I tried it)\n\n- in Apache 1.3, the jsp files are protected like htm files : the .htaccess\ndirectives are taken into acount BEFORE tomcat handles jsp files\n- in Apache 2.0, the jsp is handled by tomcat WITHOUT looking to .htaccess (they\nare visible by everyone and I can't getRemoteUser - returns null)\n\nI tried to change the \"modules loading order\" without success.\nI have the same difference with mod_jk and mod_jk2, and with several\nBasic Authentication Modules.\n\nApache 2.0 works if the REQUIRE directive is set in httpd.conf, but this is not\ndynamical and therefore doesn't fit  my needs.\n\nI wonder if there is a magic trick to force Apache 2.0 to handle mod_jk like\nApache 1.3 does.\n\nConfiguration : (Apache 2.0.49 / Apache 1.3.27 + mod_jk / mod jk2 and tomcat 4.1.29)\n\nThanks for reading\n\nAlexis"}, {"count": 9, "tags": [], "creator": "markt@apache.org", "text": "*** Bug 25367 has been marked as a duplicate of this bug. ***", "id": 63309, "time": "2004-09-09T18:36:40Z", "bug_id": 25055, "creation_time": "2004-09-09T18:36:40Z", "is_private": false, "attachment_id": null}, {"text": "Can we have a link to the apache bug?  And shouldn't that status of this bug be\nchanged to ASSIGNED already?", "tags": [], "creator": "jks@iname.com", "is_private": false, "count": 10, "id": 63316, "time": "2004-09-09T21:19:15Z", "bug_id": 25055, "creation_time": "2004-09-09T21:19:15Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 25055, "attachment_id": null, "is_private": false, "id": 63352, "time": "2004-09-10T13:52:15Z", "creator": "alexis@bookmark.fr", "creation_time": "2004-09-10T13:52:15Z", "text": "The link to the same bug submitted in Apache 2 bugzilla. \n\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=29834\n\nIt can be reassigned, but I think  the problem might lay\n- either in the mod_jk/mod_jk2 implementation for Apache 2\n- or in the Apache 2 API ? \n\nSo, it can be useful to leave it in both databases as long as we don't know\nwhich one is concerned..."}, {"count": 12, "tags": [], "creator": "alexis@bookmark.fr", "text": "See the comment From nd@perlig.de in bug \nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=29834\n\n\"htaccess file handling did not change, but the connector module hooks\"\n\nSo, the problem seems to be closed on the Apache side. \n\nModule hooks is a major issue in Apache 2, particularly when we talk about\npriorities between modules. In our problem, mod_jk bypasses the htaccess\nauthentication in Apache 2. This could be an interesting way of investigation.\n\nI tried again to change the LoadModule order without success. \n\nAnyone's got an idea ?\n\n\n\n", "id": 63662, "time": "2004-09-16T13:26:29Z", "bug_id": 25055, "creation_time": "2004-09-16T13:26:29Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "creator": "alexis@bookmark.fr", "is_private": false, "text": "Since the problem seems to lay inside Apache hooks, I spent some time to explore\nhooks configuration in Apache 2 mod_jk2/mod_jk modules. \n\nThis is the piece of code involved\n\nstatic void jk2_register_hooks(apr_pool_t * p)\n{\n    ap_hook_handler(jk2_handler, NULL, NULL, APR_HOOK_MIDDLE);\n    ap_hook_post_config(jk2_post_config, NULL, NULL, APR_HOOK_MIDDLE);\n\n    /* Force the mpm to run before us and set the scoreboard image */\n    ap_hook_child_init(jk2_child_init, NULL, NULL, APR_HOOK_LAST);\n\n    ap_hook_translate_name(jk2_translate, NULL, NULL, APR_HOOK_MIDDLE);\n    ap_hook_map_to_storage(jk2_map_to_storage, NULL, NULL, APR_HOOK_MIDDLE);\n}\n\nI see nothing about authentication in this. Furthermore,  I don't see where\nhtaccess handling takes place inside Apache 2 request processing. If anyone has\nany idea on how to configure modjk for Apache2, please let us know.\n\n\n ", "id": 63903, "time": "2004-09-20T18:56:05Z", "bug_id": 25055, "creation_time": "2004-09-20T18:56:05Z", "attachment_id": null}, {"count": 14, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 68872, "time": "2004-12-22T23:09:21Z", "bug_id": 25055, "creation_time": "2004-12-22T23:09:21Z", "is_private": false, "text": "Quoting Bill Barker:\n\n<quote>\nEnhancement request at best (and not one that I like).  Security should be\ndone by Tomcat in this case.  mod_jk/Apache2 bypasses directory_walk, so\n'.htaccess' is never looked at.\n</quote>\n\nOn this basis I am marking this as WONTFIX."}, {"count": 15, "tags": [], "creator": "jks@iname.com", "text": "I don't consider this an enhancement, I consider this a bug.", "id": 68882, "time": "2004-12-22T23:56:07Z", "bug_id": 25055, "creation_time": "2004-12-22T23:56:07Z", "is_private": false, "attachment_id": null}]
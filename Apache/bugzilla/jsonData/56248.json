[{"count": 0, "text": "I was very happy to see the changes to automatic deployment, and that customized context.xml files in conf/Catalina/localhost/<appname>.xml are preserved when a war file is replaced on the server.\n\nHowever, when using the ant tasks that come with TCD (and I suspect when using the Tomcat manager, although I have not tested that), it appears that the webapp is deleted and then uploaded (as opposed to just being replaced), which is causing the customized context.xml file to be lost and replaced with a default version.\n\n=== Reply from Mark Thomas ===\n\nHmm. It looks like the update command does an undeployment followed by a\ndeploy rather than a replacement of the WAR file and a redeploy. You\naren't going to be able to fix that without code changes to Tomcat.\nChanging the behaviour seems reasonable here. I suggest you open a\nbugzilla issue for this.", "bug_id": 56248, "attachment_id": null, "id": 173768, "time": "2014-03-12T13:39:00Z", "creator": "jsb_apache@360works.com", "creation_time": "2014-03-12T13:39:00Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 56248, "attachment_id": null, "is_private": false, "id": 173798, "time": "2014-03-13T15:30:55Z", "creator": "markt@apache.org", "creation_time": "2014-03-13T15:30:55Z", "text": "This has been fixed in 8.0.x for 8.0.4 onwards and in 7.0.x for 5.0.53 onwards."}, {"count": 2, "tags": [], "bug_id": 56248, "attachment_id": null, "text": "Wow, thank you!!!", "id": 173799, "time": "2014-03-13T15:35:24Z", "creator": "jsb_apache@360works.com", "creation_time": "2014-03-13T15:35:24Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 56248, "is_private": false, "text": "Reviewing r1577199\n\nBesides two small issues that I mentioned in \"Re: r1577199\" thread on dev@, and bug 56273, one more high-level one:\n\nThe logic in update=true case in\n    protected synchronized void deploy\n        (PrintWriter writer, ContextName cn,\n         String tag, boolean update, HttpServletRequest request,\n         StringManager smClient) {\n\nis as follows:\n1. mark webapp as serviced\n2. delete old war\n3. upload new war,\n that means to read the body of a PUT request and save it as file\n4. trigger deployment, remove serviced mark\n\nIf step 3. fails due to aborted I/O, the old application will become undeployed, deleting its custom configuration if there is any.\n\nIt would be better to upload it to a temporary name and rename the file.\nA temporary name can be created with java.io.File.createTempFile(,,dir).", "id": 173859, "time": "2014-03-15T21:41:06Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-03-15T21:41:06Z", "attachment_id": null}, {"text": "I've fixed all of these issues for 8.0.x (8.0.4 onwards) and 7.0.x (7.0.53 onwards)", "tags": [], "bug_id": 56248, "is_private": false, "count": 4, "id": 173871, "time": "2014-03-17T12:17:27Z", "creator": "markt@apache.org", "creation_time": "2014-03-17T12:17:27Z", "attachment_id": null}]
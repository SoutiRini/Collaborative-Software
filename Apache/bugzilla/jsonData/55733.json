[{"count": 0, "tags": [], "bug_id": 55733, "attachment_id": 30990, "id": 170962, "time": "2013-11-01T17:11:02Z", "creator": "david.patrone@jhuapl.edu", "creation_time": "2013-11-01T17:11:02Z", "is_private": false, "text": "Created attachment 30990\nTwo Word test files without headers - one throws NullPointerException, one doesn't\n\nI was given a programmatically generated Word document that did not contain any headers. MS Word is able to open this, however I get a NullPointerException when attempting with XWPFWordExtractor.getText(). Specifically:\n\njava.lang.NullPointerException\n\tat org.apache.poi.xwpf.extractor.XWPFWordExtractor.extractHeaders(XWPFWordExtractor.java:162)\n\tat org.apache.poi.xwpf.extractor.XWPFWordExtractor.getText(XWPFWordExtractor.java:87)\n\tat Test.testPrintDoc(Test.java:16)\n\tat Test.main(Test.java:26)\n\nLooking at the code, it looks like hfPolicy is passed in as null to XWPFWordExtractor.extractHeaders() from XWPFWordExtractor.getText():\n\npublic String getText() {\n    StringBuffer text = new StringBuffer();\n    XWPFHeaderFooterPolicy hfPolicy = document.getHeaderFooterPolicy();\n    \n    // Start out with all headers\n    extractHeaders(text, hfPolicy);\n\nwhich says the headerFooterPolicy of the Document (from Document.getHeaderFooterPolicy()) is never set in Document, and is the source of the null propagated to cause the error.\n\nI'd chalk it up to an invalid Word document, however MS Word can open the file. If you open it in Word, don't make any changes but just re-save it out, it still reports it doesn't have headers, but the new file can be read by XWPFWordExtractor.getText() without the NullPointerException.\n\nExample word documents without a header that throw the error and don't throw it are attached. Here's the test code I used to print out what was in the file.\n\nimport java.io.FileInputStream;\n\nimport org.apache.poi.xwpf.extractor.XWPFWordExtractor;\nimport org.apache.poi.xwpf.usermodel.XWPFDocument;\n\npublic class Test {\n\n    public static void testPrintDoc(String file) throws Exception {\n        FileInputStream fis = new FileInputStream(file);\n        System.err.println(\"Reading \" + file);\n        try {\n            XWPFDocument doc = new XWPFDocument(fis);\n            XWPFWordExtractor textExtractor = new XWPFWordExtractor(doc);\n            System.err.println(textExtractor.getText());\n        } finally {\n            fis.close();\n        }\n    }    \n    \n    public static void main(String[] args) {\n        \n        try {\n            Test.testPrintDoc(\"noHeaders.docx\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        try {\n            Test.testPrintDoc(\"noHeaders_resaved.docx\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}"}, {"count": 1, "tags": [], "text": "Thanks for the test file. Fixed in r1538044.", "attachment_id": null, "id": 170965, "creator": "apache@gagravarr.org", "time": "2013-11-01T19:44:05Z", "bug_id": 55733, "creation_time": "2013-11-01T19:44:05Z", "is_private": false}]
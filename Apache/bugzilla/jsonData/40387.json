[{"count": 0, "tags": [], "bug_id": 40387, "text": "I think the summary is clear enough.\nTo solve the issues: \n1.) increase mark parameter of inStream.\n2.) set a correct buffersize when convert it to a BufferdInputStream\n\n\nHere is the patch that is API compatible with older versions.\n\nIndex: PFMFile.java\n===================================================================\n--- PFMFile.java\t(revision 439270)\n+++ PFMFile.java\t(working copy)\n@@ -70,18 +70,37 @@\n     protected Log log = LogFactory.getLog(PFMFile.class);\n \n     /**\n+     * Parses a PFM file.\n+     * It is the same as load(inStream, 0);\n+     *\n+     * @param  inStream The stream from which to read the PFM file.\n+     * @throws IOException In case of an I/O problem\n+     */\n+    public void load(InputStream inStream) throws IOException {\n+        load(inStream, 0);\n+    }\n+\n+    /**\n      * Parses a PFM file\n      *\n      * @param  inStream The stream from which to read the PFM file.\n+     * @param  bufferSize If inStream doesn't support marks and it is going to\nbe buffered, the size the bufferd stream must have.\n+     * Will be ignored if inStream supports marks. Should equal the full size\nof inStream.\n      * @throws IOException In case of an I/O problem\n      */\n-    public void load(InputStream inStream) throws IOException {\n+    public void load(InputStream inStream, int bufferSize) throws IOException {\n         InputStream bufin = inStream;\n         if (!bufin.markSupported()) {\n-            bufin = new BufferedInputStream(bufin);\n+            if (bufferSize > 0)\n+                bufin = new BufferedInputStream(bufin, bufferSize);\n+            else\n+                bufin = new BufferedInputStream(bufin);\n+\n         }\n         PFMInputStream in = new PFMInputStream(bufin);\n-        bufin.mark(16);\n+// increased buff.mark() four times to avoid errors when reading fontnames\nlarger than 16 characters.\n+//        bufin.mark(16);\n+        bufin.mark(64);\n         short sh1 = in.readByte();\n         short sh2 = in.readByte();\n         if (sh1 == 128 && sh2 == 1) {", "id": 92877, "time": "2006-09-01T11:54:18Z", "creator": "creator79@web.de", "creation_time": "2006-09-01T11:54:18Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 40387, "attachment_id": 18805, "is_private": false, "id": 92909, "time": "2006-09-01T17:56:50Z", "creator": "creator79@web.de", "creation_time": "2006-09-01T17:56:50Z", "text": "Created attachment 18805\nPatch for this issue"}, {"attachment_id": null, "tags": [], "bug_id": 40387, "is_private": false, "count": 2, "id": 93322, "time": "2006-09-11T06:40:19Z", "creator": "jeremias@apache.org", "creation_time": "2006-09-11T06:40:19Z", "text": "I've taken a look at your patch and the fix for the font name is clear enough.\nHowever, the buffer parameter for the BufferedInputStream puzzles me. You add a\nnew method signature with a buffer parameter but you didn't also make a change\nin PFMReader so that the official command-line tool profits from the change. It\nlooks more like you added this so you can work around the problem in your\nenvironment. I'd prefer a more general fix if possible. So, should we simply\nhard-code the buffer size to 16KB or something like that to avoid the seemingly\nrare problem you're experiencing?"}, {"count": 3, "tags": [], "bug_id": 40387, "is_private": false, "text": "I finally decided not to apply your patch and to use a more radical approach\n(buffering the whole file in memory). I still had problems with some PFMs even\nafter applying the proposed patch.\nhttp://svn.apache.org/viewvc?view=rev&rev=474410", "id": 95774, "time": "2006-11-13T09:45:43Z", "creator": "jeremias@apache.org", "creation_time": "2006-11-13T09:45:43Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "creator79@web.de", "attachment_id": null, "text": "Hi Jeremias, sorry for my late answer. I saw accidentally that mails from\nbugzilla have been filtered as junkmail, so I didn't know about your last comments.\n\nFor the rest, this was my first experience with projects like this, so please be\na little bit lenient toward me. But I'll keep your feedback in mind.\n\nRegarding the buffer size - I'm not sure why, but with a larger size than 64 I\nexperienced some other problems (too long ago to remember exactly). I think the\nerror causes by the BufferdInputStrem itself, but therefore my experience with\nJava is too short. But using a ByteArrayInputStream instead seems to be best\nagreement.", "id": 95823, "time": "2006-11-14T05:18:27Z", "bug_id": 40387, "creation_time": "2006-11-14T05:18:27Z", "is_private": false}, {"count": 5, "tags": [], "creator": "jeremias@apache.org", "text": "Thank you for your feedback, Patrick.\n\nHey, I'm glad for your patch even though I didn't apply it. It made me\ninvestigate the problem more closely. Don't let this scare you away please!!!\nDon't hesitate if have anything else to contribute at some point!", "id": 95841, "time": "2006-11-14T13:38:42Z", "bug_id": 40387, "creation_time": "2006-11-14T13:38:42Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "creator79@web.de", "attachment_id": null, "text": "(In reply to comment #5)\n> Thank you for your feedback, Patrick.\nYou are welcome.\n\n> Hey, I'm glad for your patch even though I didn't apply it. It made me\n> investigate the problem more closely. Don't let this scare you away please!!!\n> Don't hesitate if have anything else to contribute at some point!\n\nOh no, I'm not scared. That's for sure.\nMay be I have something else to contribute. Support for MAC fonts ie.\n\nCould I contact you directly by mail to arrange it with you?", "id": 95890, "time": "2006-11-16T02:07:50Z", "bug_id": 40387, "creation_time": "2006-11-16T02:07:50Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 40387, "attachment_id": null, "is_private": false, "id": 95912, "time": "2006-11-16T12:03:08Z", "creator": "jeremias@apache.org", "creation_time": "2006-11-16T12:03:08Z", "text": "(In reply to comment #6)\n> Oh no, I'm not scared. That's for sure.\n\nThat's good. \n\n> May be I have something else to contribute. Support for MAC fonts ie.\n> \n> Could I contact you directly by mail to arrange it with you?\n\nNo, please subscribe to the fop-dev mailing list and post there if there's\nanything development-specific. That way my colleagues can also help and\neverything is properly archived. I may not be always and immediately available.\nThanks!\n"}, {"count": 8, "tags": [], "bug_id": 40387, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed", "id": 155592, "time": "2012-04-01T06:29:39Z", "creator": "gadams@apache.org", "creation_time": "2012-04-01T06:29:39Z", "is_private": false, "attachment_id": null}]
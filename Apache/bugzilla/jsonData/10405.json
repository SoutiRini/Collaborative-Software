[{"count": 0, "tags": [], "bug_id": 10405, "attachment_id": null, "is_private": false, "id": 18845, "time": "2002-07-02T13:51:58Z", "creator": "toyokazu.tomatsu@sun.com", "creation_time": "2002-07-02T13:51:58Z", "text": "Here is a simple Servlet that reproduce the problem.\n-----------------------------------------------\nimport javax.servlet.*;\nimport javax.servlet.http.*;\nimport java.io.*;\n\npublic class Attr extends HttpServlet {\n    public void doGet(HttpServletRequest request,\n                      HttpServletResponse response)\n        throws IOException, ServletException\n    {\n\trequest.setAttribute(\"charset\", new Object());\n\trequest.getParameter(\"blah\");\n    }\n}\n\n--------------------------------------------\njava.lang.ClassCastException: java.lang.Object\n\tat\norg.apache.tomcat.modules.mappers.DecodeInterceptor.getInfo(DecodeInterceptor.java:581)\n\tat org.apache.tomcat.core.Request.getCharEncoding(Request.java:483)\n\tat org.apache.tomcat.core.Request.getCharacterEncoding(Request.java:470)\n\tat org.apache.tomcat.core.Request.handleQueryParameters(Request.java:451)\n\tat\norg.apache.tomcat.facade.HttpServletRequestFacade.getParameter(HttpServletRequestFacade.java:277)\n\tat Attr.doGet(Attr.java:12)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java)\n\tat org.apache.tomcat.facade.ServletHandler.doService(ServletHandler.java:574)\n\tat org.apache.tomcat.core.Handler.invoke(Handler.java:322)\n\tat org.apache.tomcat.core.Handler.service(Handler.java:235)\n\tat org.apache.tomcat.facade.ServletHandler.service(ServletHandler.java:485)\n\tat org.apache.tomcat.core.ContextManager.internalService(ContextManager.java:917)\n\tat org.apache.tomcat.core.ContextManager.service(ContextManager.java:833)\n\tat\norg.apache.tomcat.modules.server.Http10Interceptor.processConnection(Http10Interceptor.java:176)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:494)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:516)\n\tat java.lang.Thread.run(Thread.java:536)"}, {"count": 1, "tags": [], "bug_id": 10405, "attachment_id": null, "id": 18903, "time": "2002-07-02T23:12:23Z", "creator": "bojan@rexursive.com", "creation_time": "2002-07-02T23:12:23Z", "is_private": false, "text": "DecodeInterceptor expects charset to be a String. Why do need it to be an Object?\n\nBojan\n\nPS. Here is that line of code:\n--------------------------\ncharset=(String)req.getAttribute( charsetAttribute );\n--------------------------"}, {"count": 2, "text": "API doc says containers can use request attributes.  I did not know that.  I was\nworrying about the conflicts of the attribute names used by application and\ncontainer. \n\nSo, this is not a bug, but the API doc says that the attribute name should\nfollow the same conventions as package names; i.e. \"org.apache.XXXX.charset\".  ", "bug_id": 10405, "is_private": false, "id": 18912, "time": "2002-07-03T05:02:13Z", "creator": "toyokazu.tomatsu@sun.com", "creation_time": "2002-07-03T05:02:13Z", "tags": [], "attachment_id": null}, {"count": 3, "text": "I'm not sure if anything in Tomcat depends on this behaviour. Anyway, you can\nalways work around this by using your own unique attibute identifiers. Something\nlike:\n\n\"domain-name.package-name.app-name.charset\"\n\nThen it won't get in the way.\n\nBojan", "bug_id": 10405, "attachment_id": null, "id": 18913, "time": "2002-07-03T05:26:57Z", "creator": "bojan@rexursive.com", "creation_time": "2002-07-03T05:26:57Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 10405, "attachment_id": null, "id": 18914, "time": "2002-07-03T05:27:45Z", "creator": "william.barker@wilshire.com", "creation_time": "2002-07-03T05:27:45Z", "is_private": false, "text": "The \"charset\" attribute is documented at \n<http://jakarta.apache.org/tomcat/tomcat-3.3-\ndoc/serverxml.html#DecodeInterceptor>, where it also tells you how to change \nthe name if you want to use \"charset\" for yourself.\n\nGiven that this particular attribute is supposed to be set by the web-app \ndeveloper (it's the TC 3.3 version of the 2.3 setCharacterEncoding), I think \nthat having a simple name is justified."}]
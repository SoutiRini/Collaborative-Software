[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "1) If Tomcat 6 runs with autodeployment being enabled, and a web application deployment fails, Tomcat will repeat attempts to autodeploy the application every 10 seconds. So every 10 seconds an error message is printed into the error log.\n\nTo reproduce: place a broken context xml file (e.g. with a typo) into conf/Catalina/localhost.\n\n2) The input stream for the broken context xml file is not properly closed. When running on Windows the file cannot be deleted without stopping Tomcat.\n\n3) If a broken web application is deployed via Manager web application GUI, it fails to deploy and it is not displayed in the list of the applications. \n\nAs a consequence\n- It cannot be undeployed via GUI, as it is absent from the list. If one crafts the command URL manually, it fails with\n\"FAIL - No context exists for path /test\"\n- It cannot be replaced with a new correct version of the application, because if you try to upload a new war, it fails with\n\"FAIL - War file \"test.war\" already exists on server\"\n\n\nNote, that in Tomcat 7 the issue has already been fixed in 7.0.23", "id": 162760, "time": "2012-10-15T09:03:18Z", "bug_id": 54007, "creation_time": "2012-10-15T09:03:18Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 54007, "text": "Created attachment 29477\n2011-11-14_tc6_54007.patch\n\nPatch for Tomcat 6\n\nThe change in ContainerBase.addChild() is needed to display failed applications in the Manager webapp.", "id": 162761, "time": "2012-10-15T09:15:07Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-10-15T09:15:07Z", "is_private": false, "attachment_id": 29477}, {"count": 2, "tags": [], "bug_id": 54007, "text": "Concerns about the patch\n1) Messy. The new methods have to be documented better and to be made protected instead of private.\n\n2) Several concerns about getContextPathFromFileName() method:\n\n- It needs better API.\n\nIn the patch it combines context name calculation, canonicalization check and update of invalidWars map. Originally the check was supposed to be performed for war files only.\n\n- Typo in getContextPathFromFileName() JavaDoc:\n a Cyrillic char instead of trailing '.'\n\n- A bug:\nThe \"appbase\" argument is not used because of a typo.\nThe method calls validateContextPath(appBase,..) using this.appBase instead of \"appbase\" argument.\n\n- The validation check that uses canonicalization is expensive. It could be improved by reordering the checks. Reordering cannot be done if the check is encapsulated in this method. See\nhttp://svn.apache.org/viewvc?view=revision&revision=1380891\n\n3) HostConfig.invalidWars is a HashSet.\nI think it has to be made final and access to it has to be made synchonized.\n\n4) As noted by kfujino in STATUS.txt of Tomcat 6 where this patch was proposed:\n\n Question of if host.addChild(context) threw IllegalStateException.\n E.g. case of deployDirectory.\n If META-INF/context.xml exist in Directory, context.xml is copied to configBase.\n If host.addChild(context) threw IllegalStateException, only a directory is \n registered into redeployResources. Context.xml does not register into redeployResources.\n If manager app execute undeploy(or delete directory), directory is deleted \n but context.xml isn't deleted.\n Should (conf/Catalina/localhost/)context.xml be registered into redeployResources? \n Or need to delete context.xml manually?\n\nI think context.xml should be registered into redeployResources.\n\nA better patch is needed.\n\n\n5) Regarding the change to ContainerBase.addChild()\n\nIt seems too wide (concerns all containers), but I do not see a better solution here.\n\n\n(In reply to comment #0)\n> 2) The input stream for the broken context xml file is not properly closed.\n> When running on Windows the file cannot be deleted without stopping Tomcat.\n\nI do not have a solution for the locked context xml file issue. Tomcat 7 is affected as well. The issue seems to occur inside XmlReader created by Digester. We could patch out copy of Digester, but I do not see an API there to explicitly close the file.\n\nThe workaround is to force full GC (e.g. to press the \"Find Leaks\" button in the Manager). After that the file is unlocked.", "id": 162763, "time": "2012-10-15T11:21:36Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-10-15T11:21:36Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 54007, "text": "Note the leak has been identified and fixed in trunk and 7.0.x. See r1408163 and r1408166.", "id": 163365, "time": "2012-11-12T01:27:39Z", "creator": "markt@apache.org", "creation_time": "2012-11-12T01:27:39Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "text": "Marking as WONTFIX since 6.0.x has reached end of life.", "count": 4, "id": 195776, "time": "2017-01-01T11:15:23Z", "bug_id": 54007, "creation_time": "2017-01-01T11:15:23Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 1543, "text": "In the tar task you would normally expect to *either* use the \"basedir\" \nattribute (to tar an entire directory) or nested \"tarfileset\" elements to \nspecify a more complicated set of files. However, it turns out that the code \ndoes the wrong thing for tarfilesets; rather than using the \"dir\" parameter \nfrom each tarfileset it is using the \"basedir\" value as the root directory when \nsearching for files. \n\nFor example, take a simple case like this:\n\n<tar tarfile=\"outdir/myTar.tar\" >\n\t<tarfileset dir=\"sourcedir\" mode=\"755\" > \n\t\t<include name=\"aaa.csh\"/>\n\t\t<include name=\"bbb.csh\"/>\n\t\t<include name=\"ccc.csh\"/>\n\t</tarfileset>\n</tar>\n\nYou would like the 3 files in the tarfileset to come from \"sourcedir\", but \ninstead they come from the value of basedir (which is null) so they are \nsearched for in the current directory.\n\nHere's a workaround:\n\n<tar tarfile=\"outdir/myTar.tar\" basedir=\"sourcedir\" excludes=\"**\" >\n\t<tarfileset dir=\"sourcedir\" mode=\"755\" > \n\t\t<include name=\"aaa.csh\"/>\n\t\t<include name=\"bbb.csh\"/>\n\t\t<include name=\"ccc.csh\"/>\n\t</tarfileset>\n</tar>\n\nSetting basedir makes the tarfileset work; setting excludes=\"**\" makes sure \nthat *only* files mentioned in the tarfileset are included. (Otherwise you \nwould get *all* the files in sourcedir, plus a second copy of the three \nexplicit files.)\n\nI also believe I know where the bug is in the code and how to fix it. If you \nlook in org/apache/tools/ant/taskdefs/Tar.java at around line 216 (in the \nexecute() method) you will see a line of code that looks like this:\n\n   File f = new File(baseDir,files[i]);\n\nNote that the directory is set from baseDir; I believe it should actually look \nlike this:\n\n   File f = new File(fs.getDir(project),files[i]);\n\nWhen I made this change I got the result I expected; I didn't need the basedir \nor exclude attributes and only my 3 files ended up in the tar. (It looks like \nthis code is still the same in the current (4/25/2001) nightly builds.)", "id": 2122, "time": "2001-04-26T13:54:10Z", "creator": "bugzilla@apache.org", "creation_time": "2001-04-26T13:54:10Z", "is_private": false, "attachment_id": null}, {"text": "applied your fix for nightly build 2001-05-04", "tags": [], "bug_id": 1543, "attachment_id": null, "count": 1, "id": 2235, "time": "2001-05-03T06:12:42Z", "creator": "bodewig@apache.org", "creation_time": "2001-05-03T06:12:42Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 1543, "attachment_id": null, "id": 7537, "time": "2001-11-05T07:40:31Z", "creator": "bodewig@apache.org", "creation_time": "2001-11-05T07:40:31Z", "is_private": false, "text": "*** Bug 4494 has been marked as a duplicate of this bug. ***"}]
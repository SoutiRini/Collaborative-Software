[{"count": 0, "tags": [], "bug_id": 56239, "attachment_id": null, "text": "hi, when i using apache benchmark to test my tomcat instance, i got a NullPointerException \n\nthis is stacktrace:\n\n[2013-12-21 19:47:00][ERROR] [http-nio-5000-exec-6]2013-12-21 19:47:00: org.apache.coyote.http11.AbstractHttp11Processor.endRequest Error finishing response\n java.lang.NullPointerException\n        at org.apache.coyote.http11.InternalNioOutputBuffer.addToBB(InternalNioOutputBuffer.java:210)\n        at org.apache.coyote.http11.InternalNioOutputBuffer.commit(InternalNioOutputBuffer.java:202)\n        at org.apache.coyote.http11.AbstractHttp11Processor.action(AbstractHttp11Processor.java:765)\n        at org.apache.coyote.Response.action(Response.java:171)\n        at org.apache.coyote.http11.AbstractOutputBuffer.endRequest(AbstractOutputBuffer.java:302)\n        at org.apache.coyote.http11.InternalNioOutputBuffer.endRequest(InternalNioOutputBuffer.java:120)\n        at org.apache.coyote.http11.AbstractHttp11Processor.endRequest(AbstractHttp11Processor.java:1660)\n        at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1053)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589)\n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1686)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:744)\n\n[2013-12-21 19:46:58][ERROR] [http-nio-5000-exec-5]2013-12-21 19:46:58: org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process Error reading request, ignored\n java.lang.NullPointerException\n        at org.apache.coyote.http11.Http11NioProtocol$Http11ConnectionHandler.release(Http11NioProtocol.java:221)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:616)\n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1686)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:744)\n\nI am using \"org.apache.coyote.http11.Http11NioProtocol\" in server.xml like this:\n<Connector port=\"8080\" protocol=\"org.apache.coyote.http11.Http11NioProtocol\" ... />\n\nI have already test 2 cases: \n1) without Linux Traffic Control, my testcase was very ok!\n2) when i using linux tc to control the output network traffic. and tomcat gave me a NullPointerException above. that the tomcat instance still at running state,(some requests has failed)\nI test many times with tc, NullPointerException almost has been happened \nI was changed tomcat version at 7.0.52 with the same problem\nI have seen 7.0.39-7.0.52's changelog, and find nothing with something like this Exception. \n\nso please help ..", "id": 173721, "time": "2014-03-10T07:35:47Z", "creator": "liushangkun520@hotmail.com", "creation_time": "2014-03-10T07:35:47Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 56239, "attachment_id": null, "text": "No information on the configuration of traffic control.\n\nNo information on the load test being performed.\n\nNo information in the application being tested.\n\nIn short, no way anyone investigating this bug could possibly begin to try and reproduce it.\n\nPlease provide the above information and the errors (with stack traces) obtained when running on the latest stable 7.0.x release.", "id": 173724, "time": "2014-03-10T10:40:08Z", "creator": "markt@apache.org", "creation_time": "2014-03-10T10:40:08Z", "is_private": false}, {"count": 2, "tags": [], "creator": "liushangkun520@hotmail.com", "text": "Created attachment 31380\nstacktrace", "id": 173737, "time": "2014-03-11T07:51:26Z", "bug_id": 56239, "creation_time": "2014-03-11T07:51:26Z", "is_private": false, "attachment_id": 31380}, {"count": 3, "tags": [], "text": "hi Thomas, \n\nhere is my tc configuration: \n\n[root@aceZtomcatZ59099c87Ze182Z4f13Z ~]# tc qdisc show dev eth1: \nqdisc htb 1: root refcnt 2 r2q 10 default 10 direct_packets_stat 0\n\n[root@aceZtomcatZ59099c87Ze182Z4f13Z ~]# tc class show dev eth1\nclass htb 1:505 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \nclass htb 1:10 parent 1:1 prio 0 rate 10486Kbit ceil 94372Kbit burst 1597b cburst 1580b \nclass htb 1:504 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \nclass htb 1:507 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \nclass htb 1:506 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \nclass htb 1:500 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \nclass htb 1:503 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \nclass htb 1:502 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \nclass htb 1:509 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \nclass htb 1:508 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \nclass htb 1:1 root rate 104858Kbit ceil 104858Kbit burst 1585b cburst 1585b \nclass htb 1:510 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \nclass htb 1:511 parent 1:1 prio 0 rate 3146Kbit ceil 94372Kbit burst 1599b cburst 1580b \n\nI am running tomcat under \"admin\" account, uid is 500\n\n[root@aceZtomcatZ59099c87Ze182Z4f13Z ~]# id -u admin\n500\n\nPerformance Test command, on another machine :\n[root@aceZtestZ607c2b5bZ0bcbZ4768ZbZ ~]# ab -c 100 -n 50000 http://121.199.24.74:9527/tmall.com_files/T1oKF9Fo8gXXcR3qY4-200-320.png_q90.jpg\nThis is ApacheBench, Version 2.3 <$Revision: 655654 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 121.199.24.74 (be patient)\napr_socket_recv: Connection reset by peer (104)\nTotal of 3031 requests completed\n\n\nthe attarchment is stacktrace info.\n\nthanks a lot !", "attachment_id": null, "bug_id": 56239, "id": 173738, "time": "2014-03-11T07:53:47Z", "creator": "liushangkun520@hotmail.com", "creation_time": "2014-03-11T07:53:47Z", "is_private": false}, {"count": 4, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 173741, "time": "2014-03-11T09:44:25Z", "bug_id": 56239, "creation_time": "2014-03-11T09:44:25Z", "is_private": false, "text": "1. Fix your broken web application - you should not be bundling multiple versions of the Servlet API in your web application.\n\n2. Please provide a stack trace from the latest stable 7.0.x release. 7.0.39 in not the latest stable 7.0.x release."}, {"count": 5, "tags": [], "bug_id": 56239, "attachment_id": null, "text": "Well, I have fixed the second problme that you say (switch tomcat version to last_release_stable) and everything is okay ...\n\n\ni have been look around the all tomcat's changelog from 7.0.39 to 7.0.52 at this page: http://tomcat.apache.org/tomcat-7.0-doc/changelog.html  \nbut found nothing about with \"NIO Connector maybe thrown a NullPointerException in some case\" \n\nwhat is the difference between this two version 7.0.39-7.0.52 ?", "id": 173756, "time": "2014-03-12T06:34:09Z", "creator": "liushangkun520@hotmail.com", "creation_time": "2014-03-12T06:34:09Z", "is_private": false}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 173763, "time": "2014-03-12T12:54:46Z", "bug_id": 56239, "creation_time": "2014-03-12T12:54:46Z", "is_private": false, "text": "In the original description you stated that you changed Tomcat version to 7.0.52 and still observed the same problem.\n\nIn comment #5 you stated that you could not reproduce the problem when using 7.0.52.\n\nWhich of those statement is correct?"}, {"count": 7, "tags": [], "bug_id": 56239, "attachment_id": null, "id": 173764, "time": "2014-03-12T13:03:47Z", "creator": "markt@apache.org", "creation_time": "2014-03-12T13:03:47Z", "is_private": false, "text": "It is not immediately obvious that this is the same issue so yes, please create a new bugzilla issue and provide the necessary information to enable this to be reproduced."}, {"count": 8, "tags": [], "bug_id": 56239, "attachment_id": null, "id": 173765, "time": "2014-03-12T13:04:05Z", "creator": "markt@apache.org", "creation_time": "2014-03-12T13:04:05Z", "is_private": false, "text": "(In reply to Mark Thomas from comment #7)\n> It is not immediately obvious that this is the same issue so yes, please\n> create a new bugzilla issue and provide the necessary information to enable\n> this to be reproduced.\n\nIgnore this comment. Wrong bug."}, {"count": 9, "tags": [], "text": "(In reply to Mark Thomas from comment #6)\n> In the original description you stated that you changed Tomcat version to\n> 7.0.52 and still observed the same problem.\n> \n> In comment #5 you stated that you could not reproduce the problem when using\n> 7.0.52.\n> \n> Which of those statement is correct?\n\nI mean i changed tomcat version to 7.0.52 then, NullPointerException has gone ..\nand my testcases was right..\n\nbut i don't understand what is the difference between 7.0.39 and 7.0.52 ?", "attachment_id": null, "bug_id": 56239, "id": 173771, "time": "2014-03-12T16:15:53Z", "creator": "liushangkun520@hotmail.com", "creation_time": "2014-03-12T16:15:53Z", "is_private": false}, {"count": 10, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "id": 173774, "time": "2014-03-12T18:18:52Z", "bug_id": 56239, "creation_time": "2014-03-12T18:18:52Z", "is_private": false, "text": "You can read the changelog (as you have done) or you can view diffs in Subversion. Nobody is going to hunt-down the exact patch that fixes this particular issue for you.\n\nAs for the changelog, search for anything NIO-related. A lot of things have been modified in the connectors recently to make them more similar to each other and easier to maintain. It's possible that your edge-case was removed as a part of that effort, and so it doesn't appear as a particular bugfix, etc.\n\nIf you really want to track down exactly what fixed it, start with 7.0.40 and keep upgrading until you hit a release that does not reproduce the problem. Then you can look at diffs."}]
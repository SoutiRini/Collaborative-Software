[{"count": 0, "tags": [], "bug_id": 7175, "text": "Starting from Tomcat 4.0.2, it is not possible to bundle web applocation with \nthe XML parser of choice. If application ships with the parser in the WEB-\nINF/lib, following exception occurs:\n\n------------------8<-----------------\njava.lang.ClassCastException: \norg.apache.xerces.parsers.StandardParserConfiguration\n\tat org.xml.sax.helpers.XMLReaderFactory.createXMLReader(Unknown Source)\n\tat org.xml.sax.helpers.XMLReaderFactory.createXMLReader(Unknown Source)\n\tat org.apache.jsp.test$jsp._jspService(test$jsp.java:71)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:107)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.jasper.servlet.JspServlet$JspServletWrapper.service\n(JspServlet.java:202)\n...\n------------------8<-----------------\n\nHow to reproduce:\n1. Create empty webapp (or use existing, like ROOT)\n2. Drop xercesImpl-2.0.0.jar and xml-apis.jar into WEB-INF/lib.\n3. Create test.jsp (attached)\n4. Invoke test.jsp", "id": 11870, "time": "2002-03-16T21:57:17Z", "creator": "vgritsenko@apache.org", "creation_time": "2002-03-16T21:57:17Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 7175, "attachment_id": 1357, "id": 11871, "time": "2002-03-16T21:58:02Z", "creator": "vgritsenko@apache.org", "creation_time": "2002-03-16T21:58:02Z", "is_private": false, "text": "Created attachment 1357\ntest.jsp"}, {"count": 2, "tags": [], "creator": "vgritsenko@apache.org", "is_private": false, "text": "xml-apis.jar:\nhttp://cvs.apache.org/viewcvs.cgi/~checkout~/xml-cocoon2/lib/core/xml-apis.jar?\nrev=1.3&content-type=text/plain\n\nxercesImpl-2.0.0.jar:\nhttp://cvs.apache.org/viewcvs.cgi/~checkout~/xml-cocoon2/lib/core/xercesImpl-\n2.0.0.jar?rev=1.1&content-type=text/plain", "id": 11872, "time": "2002-03-16T22:02:49Z", "bug_id": 7175, "creation_time": "2002-03-16T22:02:49Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "I don't agree with this bug report, and I tried the test case just to be sure.\nThis does work for both the HEAD branch and 4.0.4-dev (which should be identical\nto 4.0.4-b1). 4.0.2 and 4.0.3 should also work fine (but I didn't try).\nIf you still have problems, I would recommend stopping to attempt to override\nthe XML parser altogether, as because of the CL delegation model used by the\nservlet API, this cannot be supported in a robust way.\nSo you get to choose between WORKSFORME or WONTFIX for the resolution of the bug.", "id": 11877, "time": "2002-03-16T23:12:53Z", "bug_id": 7175, "creation_time": "2002-03-16T23:12:53Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 7175, "text": "I agree with Remy that you should stop trying to override the default XML parser. \nWhile you *may* be able to override it when using JDK 1.3, you will absolutely \nnot be able to do it with JDK 1.4 as JDK 1.4 treats the XML parsing classes (also \nknown as \"endorsed\" classes) as system classes. Hence, once the JVM is started, \nJDK 1.4 will not all any class loader in the process load alternate XML parsing \nclasses that fall in any package names listed in the following URL:\n\n  http://java.sun.com/j2se/1.4/docs/guide/standards/index.html\n\nThe only way around this JDK 1.4 restriction for your webapp only is to create an \nXML parser with package names that are not listed in the above URL (i.e. a very \nnon-standard parser).\n\nThere is another way around this restriction. However, it will force all webapps \n(and the container itself) to use your XML parser. You can put your parser jar \nfiles in the common/lib directory (4.0.x) or in the common/endorsed directory \n(HEAD).\n", "id": 11878, "time": "2002-03-16T23:24:27Z", "creator": "patrick.luby@planamesa.com", "creation_time": "2002-03-16T23:24:27Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "vgritsenko@apache.org", "attachment_id": null, "text": "Let take this one step at a time.\n\nWhat do you mean under \"you should stop trying to override the default XML \nparser\"? If it is equivalent to the \"properties.put\n(\"org.xml.sax.driver\", \"org.apache.xerces.parsers.SAXParser\");\" in the \ntest.jsp, I would have anything against this if it would work.\n\nHowever, reality is worse than that, and if I remove the line, I end up with \nanother exception:\n--------------------8<---------------------\norg.xml.sax.SAXException: System property org.xml.sax.driver not specified\n\tat org.xml.sax.helpers.XMLReaderFactory.createXMLReader\n(XMLReaderFactory.java:90)\n\tat org.apache.jsp.test2$jsp._jspService(test2$jsp.java:65)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:107)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.jasper.servlet.JspServlet$JspServletWrapper.service\n(JspServlet.java:202)\n--------------------8<---------------------\n", "id": 11879, "time": "2002-03-16T23:34:37Z", "bug_id": 7175, "creation_time": "2002-03-16T23:34:37Z", "is_private": false}, {"count": 6, "tags": [], "creator": "vgritsenko@apache.org", "attachment_id": 1358, "text": "Created attachment 1358\ntest.jsp without \"properties.put\" line", "id": 11880, "time": "2002-03-16T23:35:32Z", "bug_id": 7175, "creation_time": "2002-03-16T23:35:32Z", "is_private": false}, {"count": 7, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "As I have said (did you actually read my reply ?), I tried the first JSP against\nboth TC braches, and it *did* work (both with JDK 1.3 and 1.4), and your test\ndisplayed \"Passed\".\nTC 4.0.4-dev; Xeces 1.4.4 in common/lib; Xerces 2.0.0 in\n/webapps/ROOT/WEB-INF/lib; test.jsp in /webapps/ROOT/test.jsp\n\nAs Patrick stated, overriding the XML parser can be considered unsupported\nfunctionality. So if it didn't work, there's nothing I can do to fix it, and\nthis is a WONTFIX. If you think you can fix it, I'm waiting for your patch (but\nthe catch is that it still must implement the delegation model specified by the\nservlet API) ;-)", "id": 11881, "time": "2002-03-16T23:48:37Z", "bug_id": 7175, "creation_time": "2002-03-16T23:48:37Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "vgritsenko@apache.org", "is_private": false, "text": "Yes, Remy, I have read your reply. And yes, the test case as I submitted - \nworks: I installed fresh Tomcat and found that it is working.\n\nThe things are becoming interesting (i.e. test case does not work) when \nxerces.jar is removed from the tomcat/commoon/lib, and instead of it two \nmentioned jars (xml-apis.jar and xerces.jar) are copied to the \ntomcat/common/lib.\n\nWhen Tomcat and webapp uses same libs, the issue I was describing arises. Could \nyou please give your comment on this? Thanks.\n", "id": 11882, "time": "2002-03-16T23:53:51Z", "bug_id": 7175, "creation_time": "2002-03-16T23:53:51Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 7175, "text": "I tried only with 4.0.4-dev (ran into another bug with HEAD and JDK 1.3).\nIf I replace Xerces 1.4.4 with Xerces 2.0.0 in common/lib, cleanup the work\ndirectory, it still does work on both JDK 1.3 and 1.4.\nI don't understand why it would fail.", "id": 11883, "time": "2002-03-17T00:15:02Z", "creator": "remm@apache.org", "creation_time": "2002-03-17T00:15:02Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 7175, "attachment_id": null, "id": 11895, "time": "2002-03-17T16:36:44Z", "creator": "vgritsenko@apache.org", "creation_time": "2002-03-17T16:36:44Z", "is_private": false, "text": "Remy,\nI will assume that something has changed between 4.0.4b1 and 4.0.4-dev.\nHow to get 4.0.4-dev? Binary nightly snapshot is just 45 bytes."}, {"count": 11, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "No, the CL code didn't change from 4.0.4-b1. You must be doing something wrong.", "id": 11898, "time": "2002-03-17T17:12:15Z", "bug_id": 7175, "creation_time": "2002-03-17T17:12:15Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 47833, "text": "Hello,\ni'm using cxf 2.2.2 and xmlsec-1.4.2 in BEA. \nMy Exception is:\nThe signature or decryption was invalid (Cannot setup signature data structure);\nnested exception is:\n        org.apache.xml.security.exceptions.XMLSecurityException: Cannot create a http://www.w3.org/2000/09/xmldsig#:Sign\nature from a http://www.w3.org/2000/09/xmldsig#:Signature element\n        at org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.createSoapFault(WSS4JInInterceptor.java:514)\n        at org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessage(WSS4JInInterceptor.java:277)\n        at org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessage(WSS4JInInterceptor.java:77)\n        at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:236)\n        at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:89)\n        at org.apache.cxf.transport.servlet.ServletDestination.invoke(ServletDestination.java:99)\n        at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:368)\n        at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:183)\n        at org.apache.cxf.transport.servlet.AbstractCXFServlet.invoke(AbstractCXFServlet.java:163)\n        at org.apache.cxf.transport.servlet.AbstractCXFServlet.doPost(AbstractCXFServlet.java:141)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:763)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n        at weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:225)\n        at weblogic.servlet.internal.StubSecurityHelper.invokeServlet(StubSecurityHelper.java:127)\n        at weblogic.servlet.internal.ServletStubImpl.execute(ServletStubImpl.java:283)\n        at weblogic.servlet.internal.ServletStubImpl.execute(ServletStubImpl.java:175)\n        at weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction.run(WebAppServletContext.java:3214)\n        at weblogic.security.acl.internal.AuthenticatedSubject.doAs(AuthenticatedSubject.java:321)\n        at weblogic.security.service.SecurityManager.runAs(SecurityManager.java:121)\n        at weblogic.servlet.internal.WebAppServletContext.securedExecute(WebAppServletContext.java:1983)\n        at weblogic.servlet.internal.WebAppServletContext.execute(WebAppServletContext.java:1890)\n        at weblogic.servlet.internal.ServletRequestImpl.run(ServletRequestImpl.java:1344)\n        at weblogic.work.ExecuteThread.execute(ExecuteThread.java:209)\n        at weblogic.work.ExecuteThread.run(ExecuteThread.java:181)\nCaused by: org.apache.ws.security.WSSecurityException: The signature or decryption was invalid (Cannot setup signature d\nata structure); nested exception is:\n        org.apache.xml.security.exceptions.XMLSecurityException: Cannot create a http://www.w3.org/2000/09/xmldsig#:Sign\nature from a http://www.w3.org/2000/09/xmldsig#:Signature element\n        at org.apache.ws.security.processor.SignatureProcessor.verifyXMLSignature(SignatureProcessor.java:163)\n        at org.apache.ws.security.processor.SignatureProcessor.handleToken(SignatureProcessor.java:85)\n        at org.apache.ws.security.WSSecurityEngine.processSecurityHeader(WSSecurityEngine.java:326)\n        at org.apache.ws.security.WSSecurityEngine.processSecurityHeader(WSSecurityEngine.java:243)\n        at org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessage(WSS4JInInterceptor.java:179)\n        ... 22 more\nCaused by: org.apache.xml.security.exceptions.XMLSecurityException: Cannot create a http://www.w3.org/2000/09/xmldsig#:S\nignature from a http://www.w3.org/2000/09/xmldsig#:Signature element\n        at org.apache.xml.security.utils.ElementCheckerImpl$InternedNsChecker.guaranteeThatElementInCorrectSpace(Unknown\n Source)\n        at org.apache.xml.security.utils.ElementProxy.guaranteeThatElementInCorrectSpace(Unknown Source)\n        at org.apache.xml.security.utils.ElementProxy.<init>(Unknown Source)\n        at org.apache.xml.security.utils.SignatureElementProxy.<init>(Unknown Source)\n        at org.apache.xml.security.signature.XMLSignature.<init>(Unknown Source)\n        at org.apache.ws.security.processor.SignatureProcessor.verifyXMLSignature(SignatureProcessor.java:161)\n---------------------------------\nInternedNsChecker:\n\n if ((str2 != str4) || (!(str1.equals(str3))))\n    {\n      Object[] arrayOfObject = { str4 + \":\" + str3, str2 + \":\" + str1 };\n      throw new XMLSecurityException(\"xml.WrongElement\", arrayOfObject);\n    }\n---------------------------------\nif I try my web application in cxf 2.2.2 and xmlsec-1.3.0\nthis exception is not thrown. If I see the source code is\n----------------------------------\nif ((!(str1.equals(str3))) || (!(str2.equals(str4))))\n    {\n      Object[] arrayOfObject = { str4 + \":\" + str3, str2 + \":\" + str1 };\n      throw new XMLSecurityException(\"xml.WrongElement\", arrayOfObject);\n    }\n  }\n\nThanks\n\nElisa", "id": 130365, "time": "2009-09-14T03:39:24Z", "creator": "elisa.laneri@consulenti.csi.it", "creation_time": "2009-09-14T03:39:24Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "sean.mullan@oracle.com", "text": "45637 should address this, by providing a configurable option for DOM implementations that don't intern namespaces. Therefore I am marking this as a duplicate.\n\n*** This bug has been marked as a duplicate of bug 45637 ***", "id": 130490, "time": "2009-09-17T12:38:28Z", "bug_id": 47833, "creation_time": "2009-09-17T12:38:28Z", "tags": [], "is_private": false}]
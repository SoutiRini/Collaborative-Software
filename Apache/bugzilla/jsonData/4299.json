[{"count": 0, "tags": [], "bug_id": 4299, "text": "When a webapp with a servlet is specified with context in server.xml and\nuses load-on-startup the servlet is loaded twice.\n\nCreate webapp \"test\" which has this servlet:\n\npublic class TestServlet extends HttpServlet\n{\n    public void init(ServletConfig config) throws ServletException\n    {\n        System.out.println(\"init\");\n    }\n}\n\nserver.xml:\n<Context path=\"/something\" docBase=\"test\" debug=\"0\"/> \n\nweb.xml:\n<!DOCTYPE web-app\n    PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n    \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n<web-app>\n    <servlet>\n        <servlet-name>test</servlet-name>\n        <servlet-class>TestServlet</servlet-class>\n       <load-on-startup>1</load-on-startup>\n    </servlet>\n</web-app>\n\nStarting the server results in:\n\ninit\ninit\n\non the console output.", "id": 6911, "time": "2001-10-19T14:12:15Z", "creator": "kristjan73@hotmail.com", "creation_time": "2001-10-19T14:12:15Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 4299, "is_private": false, "id": 6913, "creation_time": "2001-10-19T14:27:16Z", "time": "2001-10-19T14:27:16Z", "creator": "remm@apache.org", "text": "This happens because the servlet will be loaded once in the \"/something\" \ncontext, and once in the \"/test\" context.\nThere's no way to avoid the auto-deploy in 4.0.x, so you should name the \ndirectory \"something\" to avoid this.", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 4299, "text": "But what if I want to have the servlet as root and auto loading:\n\n<Context path=\"\" docBase=\"test\" debug=\"0\"/>\n\nthen I can't use the \"/test\" context.\n\nI find this behaviour to be highly inconsistent, with regards to other servlet \nengines. I have a servlet that must be loaded at startup and must be loaded \nonly once and must have root context, how can I acomplish this in Tomcat?\n", "id": 6915, "time": "2001-10-19T15:01:52Z", "creator": "kristjan73@hotmail.com", "creation_time": "2001-10-19T15:01:52Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 4299, "text": "All you need to do is understand how it works, and configure accordingly.\n\n* ALL directories in \"webapps\" are auto-deployed\n\n* All directories anywhere *other* than webapps are not auto-deployed.\n\n* If you put a directory in webpps *and* create a <Context> for it\n  (with a different context path) then you are going to get the\n  results you described, because you just asked for two webapps instead\n  of one.\n\nThe obvious answer is \"don't do that.\"\n\nIf you want your webapp to be in webapps, AND you want to have it declared in\nthe server.xml file (perhaps so you can customize the parameters), then it is\nyour responsibility to make sure the \"path\" attribute (minus the initial slash)\nmatches the directory name.  Otherwise, Tomcat assumes that you know what you\nare doing, and creates two webapps for you instead of one.\n\nMost people make one and only one choice from the following alternatives:\n* Put the webapp under \"webapps\" and do not declare it in server.xml\n* Put the webapp someplace else and declare it in server.xml (with a\n  \"docBase\" pointing at the absolute path to the directory or WAR file).\n\nI suggest you do one of these, and you will achieve the results you are after.\n\n", "id": 6920, "time": "2001-10-19T15:15:32Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-10-19T15:15:32Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 4299, "is_private": false, "count": 4, "id": 6922, "time": "2001-10-19T15:53:45Z", "creator": "kristjan73@hotmail.com", "creation_time": "2001-10-19T15:53:45Z", "text": "Ok, I misunderstood how the Context worked in server.xml, I assumed it was \nextra paths for the same servlet in the webapp.\n\nThanks for the information, and I should probably just RTFM :)\n"}, {"count": 5, "tags": [], "bug_id": 4299, "is_private": false, "id": 6953, "creation_time": "2001-10-21T18:24:02Z", "time": "2001-10-21T18:24:02Z", "creator": "remm@apache.org", "text": "*** Bug 4310 has been marked as a duplicate of this bug. ***", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 33049, "attachment_id": null, "text": "A small 16 byte file is first copied and then both copies archived with the same name. To test execute: \"ant j&zip -Tf aaa.zip\".\n\nVerified in: ANT nigthly 20050110 and JRE 1.5.0_01.", "id": 69538, "time": "2005-01-11T19:50:00Z", "creator": "alexeys@inventigo.com", "creation_time": "2005-01-11T19:50:00Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 33049, "text": "Created attachment 13974\ntest case", "id": 69539, "time": "2005-01-11T19:50:55Z", "creator": "alexeys@inventigo.com", "creation_time": "2005-01-11T19:50:55Z", "is_private": false, "attachment_id": 13974}, {"count": 2, "tags": [], "bug_id": 33049, "text": "If a \"broken archive\" is one that contains > 1 copy of a single file, but is\nstill a a valid zip file, then this bug is a duplicate of 30339.  Is this what\nwe are talking about?", "id": 69540, "time": "2005-01-11T20:00:20Z", "creator": "mbenson@apache.org", "creation_time": "2005-01-11T20:00:20Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 33049, "text": "test log:\n\nBuildfile: build.xml\n\nj:\n   [delete] Deleting: D:\\tmp\\apache-ant-1.7alpha\\test\\aaa.zip\n      [zip] Building zip: D:\\tmp\\apache-ant-1.7alpha\\test\\aaa.zip\n\nBUILD SUCCESSFUL\nTotal time: 1 second\n        zip warning: local and central headers differ for (null)\n        zip warning:  offset 6--local = 0c, central = ab\n        zip warning:  offset 7--local = 53, central = 55\n\nzip error: Zip file structure invalid (aaa.zip)", "id": 69541, "time": "2005-01-11T20:03:54Z", "creator": "alexeys@inventigo.com", "creation_time": "2005-01-11T20:03:54Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 33049, "is_private": false, "text": "The error could be reproduced on linux / jdk 1.4.2_06\n\nboth files could be extracted correctly with unzip, testing the archive with zip\ngives the following information. (The files packed on windows XP and linux give\nthe same error message when tested with the linux zip tool):\n\n        zip warning: local and central headers differ for (null)\n        zip warning:  offset 6--local = 0c, central = f4\n        zip warning:  offset 7--local = 53, central = 9e\n\nzip error: Zip file structure invalid (aaa.zip)", "id": 69542, "time": "2005-01-11T20:10:55Z", "creator": "jkf@apache.org", "creation_time": "2005-01-11T20:10:55Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 33049, "is_private": false, "text": "The fault is reproducible as long as two files have the same name in the archive.\nThe two files need not be the same, the two files need not be 16 bytes long.\n\nFor instance the file \n\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<project name=\"test\" default=\"j\">\n  <target name=\"j\">\n    <delete file=\"aaa.zip\"/>\n    <copy file=\"aaa\" tofile=\"bbb\"/>\n    <zip zipfile=\"aaa.zip\">\n      <zipfileset file=\"aaa\" fullpath=\"path/to/file\"/>\n      <zipfileset file=\"build.xml\" fullpath=\"path/to/file\"/>\n    </zip>\n  </target>\n</project>\n\ngives similar errors (but more).", "id": 69544, "time": "2005-01-11T20:25:30Z", "creator": "jkf@apache.org", "creation_time": "2005-01-11T20:25:30Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "alexeys@inventigo.com", "text": "What is more interesting that \n\n    <zip zipfile=\"aaa.zip\">\n      <zipfileset file=\"aaa\" fullpath=\"path/to/file\"/>\n      <zipfileset file=\"aaa\" fullpath=\"path/to/file\"/>\n    </zip>\n\n(the same file twice) works fine.", "count": 6, "id": 69545, "time": "2005-01-11T20:28:56Z", "bug_id": 33049, "creation_time": "2005-01-11T20:28:56Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 33049, "is_private": false, "text": "could this be an error in infozip?\n\nManual verification of the zip file shows that there are 2 local and 2 global\nheaders for path/to/file one with header ceaf2b32 and one with d3a52b32 in my\ncase for 2 empty files when zip. zip seems to complain about finding the \"first\"\nfile in the central archive while testing the latter one. Also unzip doesn't\ncomplain:\n\njkf@jkf ant $ unzip -t test/aaa.zip\nArchive:  test/aaa.zip\n    testing: path/                    OK\n    testing: path/to/                 OK\n    testing: path/to/file             OK\n    testing: path/to/file             OK\nNo errors detected in compressed data of test/aaa.zip.\njkf@jkf ant $ zip -Tf test/aaa.zip\n        zip warning: local and central headers differ for (null)\n        zip warning:  offset 6--local = d3, central = ce\n\nzip error: Zip file structure invalid (test/aaa.zip)\n", "id": 69548, "time": "2005-01-11T21:19:53Z", "creator": "jkf@apache.org", "creation_time": "2005-01-11T21:19:53Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 33049, "text": "(In reply to comment #6)\n\n> (the same file twice) works fine.\n\nIn that case both files get the same header.\n", "id": 69549, "time": "2005-01-11T21:20:51Z", "creator": "jkf@apache.org", "creation_time": "2005-01-11T21:20:51Z", "is_private": false, "attachment_id": null}, {"count": 9, "text": "In the real life a similar jar broke Install Anywhere build.", "bug_id": 33049, "is_private": false, "id": 69550, "time": "2005-01-11T21:21:26Z", "creator": "alexeys@inventigo.com", "creation_time": "2005-01-11T21:21:26Z", "tags": [], "attachment_id": null}, {"count": 10, "tags": [], "creator": "alexeys@inventigo.com", "attachment_id": null, "text": "The original problem was \"java.io.EOFException: Unexpected end of ZLIB input stream\" during Install AnyWhere build.\n\nIn the test a file is copied into another location and then both files are zipped with the same name and zip complains about it, but if one file is zipped twice - there is no problem. In both cases file content is the same. How those headers are calculated?", "id": 69551, "time": "2005-01-11T21:29:54Z", "bug_id": 33049, "creation_time": "2005-01-11T21:29:54Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "alexeys@inventigo.com", "is_private": false, "count": 11, "id": 69552, "time": "2005-01-11T21:30:40Z", "bug_id": 33049, "creation_time": "2005-01-11T21:30:40Z", "text": "The original problem was \"java.io.EOFException: Unexpected end of ZLIB input stream\" \nduring Install AnyWhere build.\n\nIn the test a file is copied into another location and then both files are zipped\nwith the same name and zip complains about it, but if one file is zipped twice - \nthere is no problem. In both cases file content is the same. How those headers are calculated?"}, {"count": 12, "tags": [], "creator": "alexeys@inventigo.com", "attachment_id": null, "is_private": false, "id": 69553, "time": "2005-01-11T21:38:25Z", "bug_id": 33049, "creation_time": "2005-01-11T21:38:25Z", "text": "... maybe different dates ..."}, {"count": 13, "tags": [], "bug_id": 33049, "is_private": false, "text": "A description of the zip file format is on\nhttp://www.pkware.com/company/standards/appnote/\nIn case of the empty files the different byte was the last modification timestamp.", "id": 69554, "time": "2005-01-11T21:38:40Z", "creator": "jkf@apache.org", "creation_time": "2005-01-11T21:38:40Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "jkf@apache.org", "is_private": false, "count": 14, "id": 69555, "time": "2005-01-11T21:51:15Z", "bug_id": 33049, "creation_time": "2005-01-11T21:51:15Z", "text": "While handling similar issues on jar files with duplicate file entries the\nmanual got updated to better describe the default behaviour of adding files\ntwice, and add warning about the duplicate files.\n\n*** This bug has been marked as a duplicate of 30339 ***"}, {"count": 15, "tags": [], "creator": "alexeys@inventigo.com", "is_private": false, "id": 69559, "attachment_id": null, "bug_id": 33049, "creation_time": "2005-01-11T22:07:31Z", "time": "2005-01-11T22:07:31Z", "text": "I hope you are right."}, {"count": 16, "tags": [], "bug_id": 33049, "text": "It started to happen after I updated ANT. So old ANT produced correct JAR files \n(even with duplicates) and new ANT produces broken archives. Are you sure there \nis nothing more involved?", "id": 69560, "time": "2005-01-11T22:09:31Z", "creator": "alexeys@inventigo.com", "creation_time": "2005-01-11T22:09:31Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "creator": "alexeys@inventigo.com", "is_private": false, "id": 69562, "attachment_id": null, "bug_id": 33049, "creation_time": "2005-01-11T22:11:55Z", "time": "2005-01-11T22:11:55Z", "text": "I hate to talk with myself....\n\nThis jar works fine \"Apache Ant version 1.6alpha compiled on September 9 2003\"."}, {"attachment_id": 13975, "tags": [], "bug_id": 33049, "text": "Created attachment 13975\ncorrect zip produced by 1.6 alpha", "count": 18, "id": 69563, "time": "2005-01-11T22:12:50Z", "creator": "alexeys@inventigo.com", "creation_time": "2005-01-11T22:12:50Z", "is_private": false}, {"count": 19, "tags": [], "creator": "alexeys@inventigo.com", "attachment_id": null, "is_private": false, "id": 69564, "time": "2005-01-11T22:13:27Z", "bug_id": 33049, "creation_time": "2005-01-11T22:13:27Z", "text": "I still think this is a bug..."}, {"count": 20, "tags": [], "bug_id": 33049, "is_private": false, "text": "I think you are right, between ant 162 and 170 alpha I can see one difference\napart from the time stamp. This difference is in the relative offset of local\nheader (4 bytes) While the offset differs in ant 162, the offset becomes the\nsame in 170 alpha, at the same time zip starts to complain.\n\nProblem is the handling of org.apache.tools.zip.ZipEntry. When an attempt was\ndone to optimize the zip code to have decent performance, an equals was added to\nZipEntry which is not correct.", "id": 69574, "time": "2005-01-12T00:09:49Z", "creator": "jkf@apache.org", "creation_time": "2005-01-12T00:09:49Z", "attachment_id": null}, {"count": 21, "tags": [], "bug_id": 33049, "text": "Fix applied.", "id": 69575, "time": "2005-01-12T00:10:54Z", "creator": "jkf@apache.org", "creation_time": "2005-01-12T00:10:54Z", "is_private": false, "attachment_id": null}, {"count": 22, "tags": [], "bug_id": 33049, "text": "The issue is fixed. Thank you.", "id": 69581, "time": "2005-01-12T03:13:31Z", "creator": "alexeys@inventigo.com", "creation_time": "2005-01-12T03:13:31Z", "is_private": false, "attachment_id": null}]
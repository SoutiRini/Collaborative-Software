[{"count": 0, "tags": [], "creator": "john.fauerbach@noaa.gov", "text": "This problem is in Redhat 8.0, Enterprise 3, and the latest httpd (2.0.49)\nsource code download from apache.org and compiled.  It is also reproducible in\nperl.  This script works fine from the command line or under Apache 1.3.x.  You\ncan substitute different commands for the cp.  I first found it under while\ntrying to ftp several, > 100 files, then I shortened the code and reproduced it\nusing cp and mv.  The original problem was when I built a ftp command file\ncontaining all the files to transfer and then it errored at > 50 files.\n\nSteps to Reproduce in Apache 2.0.49 under RH 8.0 and enterprise 3 that does not\nexist in Apache 1.3.x under RH 8.0, RH 7.3.  Below is the script to reproduce it:\n\njohn.cgi:\n\n#!/bin/bash\necho \"Content-type: text/html\"\necho \"\"\n\nvar0=0\n\nwhile [ \"$var0\" -lt 200 ]\ndo\necho \"$var0 \"\ncp /tmp/hh /tmp/hI have found a reproducible bug in Apache 2.0.49 under linux\nthat does not exist in Apache 1.3.x.  Below is the script to reproduce it:\n\njohn.cgi:\n\n#!/bin/bash\necho \"Content-type: text/html\"\necho \"\"\n\nvar0=0\n\nwhile [ \"$var0\" -lt 200 ]\ndo\necho \"$var0 \"\ncp /tmp/hh /tmp/h\ncp /tmp/h /tmp/hh\nvar0=`expr $var0 + 1`\ndone\necho \"It is done\\n<P>\"\n\nexit 0 \ncp /tmp/h /tmp/hh\nvar0=`expr $var0 + 1`\ndone\necho \"It is done\\n<P>\"\n\nexit 0 \n\n\nThis script locks up after 68 is prin.\n\nPlease help.", "id": 54821, "time": "2004-03-29T17:06:05Z", "bug_id": 28025, "creation_time": "2004-03-29T17:06:05Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "id": 54822, "time": "2004-03-29T17:27:11Z", "bug_id": 28025, "creation_time": "2004-03-29T17:27:11Z", "is_private": false, "text": "mod_cgi or mod_cgid?\n\nany messages written to stderr when the cgi script is run?\n\ncan you get an strace of the server processing one of these requests?\n"}, {"count": 2, "tags": [], "bug_id": 28025, "attachment_id": null, "text": "1) mod_cgi.c\n\n/usr/local/apache2/bin/apachectl -l\nCompiled in modules:\n  core.c\n  mod_access.c\n  mod_auth.c\n  mod_include.c\n  mod_log_config.c\n  mod_env.c\n  mod_setenvif.c\n  prefork.c\n  http_core.c\n  mod_mime.c\n  mod_status.c\n  mod_autoindex.c\n  mod_asis.c\n  mod_cgi.c\n  mod_negotiation.c\n  mod_dir.c\n  mod_imap.c\n  mod_actions.c\n  mod_userdir.c\n  mod_alias.c\n  mod_so.c\n\n2) how do I get messages written to stderr when the cgi script is run through a\nweb browser?\n\n3) Don't know how to do a strace.\n\n", "id": 54833, "time": "2004-03-29T19:59:32Z", "creator": "john.fauerbach@noaa.gov", "creation_time": "2004-03-29T19:59:32Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 28025, "attachment_id": null, "text": ">2) how do I get messages written to stderr when the cgi script is run through a\n>web browser?\n\nWhen a cgi script writes to stderr, the output goes to the web server error log.\n There is a problem currently where a cgi script which writes too much data to\nstderr will hang.\n\nCheck the web server error log and see if any messages from the cp commands have\nbeen written to the web server error log.\n\nIf they have, and the amount is approaching 4K bytes, this is a known problem\nand the work-around is to handle stderr somehow within the script.  E.g., if in\nyour example the cp command is failing (out of space?), invoke cp like this\nwithin the script to see if the hang is resolved:\n\ncp /tmp/hh /tmp/h 2>/dev/null\ncp /tmp/h /tmp/hh 2>/dev/null\n\n>3) Don't know how to do a strace.\n\nNote: the previous issue (stderr) is easier to check than this, so don't do this\nunless you determine that your script isn't writing a bunch of stuff to stderr.\n\nYou need to do this test with a server that isn't actively accessed except when\nyou are gathering doc for the cgi problem.\n\nPick a running httpd child process you see in the output of ps -ef.  (Let's\nassume this child has pid 12345.)\n\n# strace -o outfile -f -p 12345\n\nKeep issuing the CGI request until a bunch of stuff gets written to outfile.\n\nAttach the trace (outfile) to this PR.  Hopefully this will show why the hang is\noccurring.", "id": 54835, "time": "2004-03-29T20:09:26Z", "creator": "trawick@apache.org", "creation_time": "2004-03-29T20:09:26Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 28025, "attachment_id": null, "text": "The redirection of the output works for the example.  I am looking more into it\nto see if it solves the original problem.\n\nThanks", "id": 54888, "time": "2004-03-30T18:08:49Z", "creator": "john.fauerbach@noaa.gov", "creation_time": "2004-03-30T18:08:49Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 28025, "attachment_id": null, "text": "Since redirecting stderr fixes the issue, presuming this is the CGI stderr\nhandling bug as Jeff suggests.\n\n*** This bug has been marked as a duplicate of 22030 ***", "id": 58681, "time": "2004-06-03T22:34:01Z", "creator": "jorton@redhat.com", "creation_time": "2004-06-03T22:34:01Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 50539, "text": "Created attachment 26454\nVML file illustrating the problem\n\nIn the EvilUnclosedBRFixingInputStream.java file, it does not properly handle a case where there is a <br> in the overflow part of the buffer. It throws a NegativeArraySizeException.\n\nThe fixup function needs to not process <br> tags past the end of the shortened buffer, and when returning the spare bytes it needs to run fixup.\n\nYou can process the attached VML file through the EvilUnclosedBRFixingInputStream to reproduce the exception.", "id": 143038, "time": "2011-01-03T11:48:05Z", "creator": "jwalters@computer.org", "creation_time": "2011-01-03T11:48:05Z", "is_private": false, "attachment_id": 26454}, {"count": 1, "tags": [], "bug_id": 50539, "text": "Created attachment 26456\nPatch to resolve the issue and unit test the fix\n\nIncludes the changes to EvilUnclosedBRFixingInputStream and to its unit test to verify the problem is resolved.", "id": 143041, "time": "2011-01-03T16:13:19Z", "creator": "jwalters@computer.org", "creation_time": "2011-01-03T16:13:19Z", "is_private": false, "attachment_id": 26456}, {"count": 2, "tags": [], "bug_id": 50539, "text": "Thanks for the patch and unit test\n\nAfter some pondering, I decided to refactor the class and fix a bit to make it clearer what is going on. I tweaked the test to try a wide range of buffer sizes, to simulate all the different cases of the br in the overflow, and it now passes all of them.\n\nFix committed in r1067217.", "id": 143987, "time": "2011-02-04T11:44:00Z", "creator": "apache@gagravarr.org", "creation_time": "2011-02-04T11:44:00Z", "is_private": false, "attachment_id": null}]
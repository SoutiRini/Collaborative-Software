[{"count": 0, "tags": [], "bug_id": 42814, "attachment_id": null, "text": "The build.xml file below demonstrates a bug in ANT 1.7.0 that does not exist in\nANT 1.6.5. I am using <zipfileset> to determine the name of an included file in\na JAR file. This does not work under ANT 1.7.0.\n\nIMPORTANT! The file \"impl-bar.jar\" must also exist in the same directory and\nhave a file called \"config/bar/spring-inc-bar.xml\" within it. E.g.\n\n    prompt% jar -tf impl-bar.jar\n    config/bar/\n    config/bar/spring-inc-bar.xml\n\n\nTo test it, just run \"ant\".\n\nUnder ANT 1.6.5 I get:\n\n    Buildfile: build.xml\n\n    go:\n         [echo] Running test...\n         [echo] ...passed (must be ANT-1.6+)\n\n    BUILD SUCCESSFUL\n    Total time: 0 seconds\n\nUnder ANT 1.7.0 I get:\n\n    Buildfile: build.xml\n\n    go:\n         [echo] Running test...\n\n    BUILD FAILED\n    C:\\oliver\\work\\ant-bug\\build.xml:9: ...failed, got 'impl-bar.jar' instead of\n'config/bar/spring-inc-bar.xml'\n\n    Total time: 0 seconds\n\nThe build.xml follows:\n============================================================================\n<project name=\"fileset-bug\" default=\"go\">\n  <target name=\"go\">\n    <echo>Running test...</echo>\n    <zipfileset id=\"the.fileset\"\n                src=\"impl-bar.jar\"\n                includes=\"config/*/spring-inc-*.xml\"\n                />\n    <property name=\"theincs\" refid=\"the.fileset\" />\n    <fail message=\"...failed, got '${theincs}' instead of\n'config/bar/spring-inc-bar.xml'\">\n      <condition>\n        <not>\n          <equals arg1=\"${theincs}\" arg2=\"config/bar/spring-inc-bar.xml\"/>\n        </not>\n      </condition>\n    </fail>\n    <echo>...passed (must be ANT-1.6+)</echo>\n  </target>\n</project>\n============================================================================", "id": 105083, "time": "2007-07-05T02:33:29Z", "creator": "oliver@puppycrawl.com", "creation_time": "2007-07-05T02:33:29Z", "is_private": false}, {"count": 1, "tags": [], "text": "I see, you think the toString value of zipfileset has appeared to change. (you\ncan evaluate this with ${toString:the.fileset} \n\nThe answer is yes, it probably has changed as part of the migration to\nresources; we tried to give every resource a meaningful toString value, and\nperhaps here it doesnt include as much as before.\n\nQuestion is, is there a better way to achieve what you are trying to do in the\nnew world, given that the toString() value of all the built in datatypes is not\nsomething that's ever been viewed as part of the api to keep stable (no tests, etc).\n\nwhat does your main build file look like?", "attachment_id": null, "id": 105096, "creator": "stevel@apache.org", "time": "2007-07-05T07:49:48Z", "bug_id": 42814, "creation_time": "2007-07-05T07:49:48Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 42814, "attachment_id": null, "text": "A workaround. Replace:\n\n<property name=\"theincs\" refid=\"the.fileset\" />\n\nwith:\n\n<groovy>\nproperties.theincs = project.references['the.fileset'].iterator().next().name\n</groovy>\n\nor equivalent using your scripting language of choice using the script task.\n", "id": 106021, "time": "2007-07-29T01:22:58Z", "creator": "paulk@asert.com.au", "creation_time": "2007-07-29T01:22:58Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 42814, "attachment_id": null, "text": "The problem I am solving in my main build.xml file it so locate all the Spring\nconfiguration files in a set of JAR files and populate a ANT property with these\nnames. This is used then to set a value in a application configuration file (via\na  <filterset>) which is used to initialise the system.\n\nThanks to Paul's suggestion, below is what I ended up doing with Groovy that\nworks under ANT 1.6.5 and 1.7.0.\n\nI'll leave it up to you if you want to close out this bug.\n\n=======================================================\n    <groovy>\nimport java.util.jar.JarFile;\ntheincs = \"\"\n\ndef libdir = new File(\"${properties['local.target']}/lib\")\nlibdir.listFiles().grep(~/.*(dao|service)-.*jar$/).each() { it ->\n    new JarFile(it).entries().each() { entry ->\n        if (entry.name ==~ /^com\\/kazgroup\\/courtlink\\/.*\\/spring-inc-.*.xml$/) {\n            theincs = theincs + \" \" + entry.name\n        }\n    }\n}\nproperties[\"all-spring-incs\"] = theincs\n    </groovy>\n", "id": 106041, "time": "2007-07-29T21:07:14Z", "creator": "oliver@puppycrawl.com", "creation_time": "2007-07-29T21:07:14Z", "is_private": false}, {"count": 4, "tags": [], "text": "instead of\n\n<property name=\"theincs\" refid=\"the.fileset\" />\n\nuse\n\n<pathconvert property=\"theincs\" refid=\"the.fileset\" pathsep=\" \">\n  <map from=\"location-of-archive\" to=\"\"/>\n</pathconvert>\n\nthis should work without resorting to a scripting language.\n\nI think it is reasonable to expect that we won't fix it.", "is_private": false, "id": 124473, "creator": "bodewig@apache.org", "time": "2009-01-29T07:15:23Z", "bug_id": 42814, "creation_time": "2009-01-29T07:15:23Z", "attachment_id": null}]
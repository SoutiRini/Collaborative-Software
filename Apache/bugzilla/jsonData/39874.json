[{"count": 0, "tags": [], "bug_id": 39874, "attachment_id": null, "is_private": false, "id": 90511, "time": "2006-06-23T06:12:49Z", "creator": "kosh@koshua.org", "creation_time": "2006-06-23T06:12:49Z", "text": "1. Digest authentication (mod_auth_digest) authenticates not just the user, but\nthe whole request - including the URI which is included in the digest response hash.\n\n2. mod_cgi has an optimisation for response Location: headers that start with a\nleading '/' - rather than sending the reply to the client, it redirects it\ninternally as a GET of the new URI.\n\nObviously the new request must be authenticated; we can't just redirect anywhere\ninternally without checking that the user is authorized for the new location.\n\nHowever, Digest Authentication then fails because the URI is different, causing\na 401 to be sent to the client.\n\nIn summary: Digest Auth + CGI returning a \"Location: /path/to/elsewhere\" header\n= 401 response."}, {"count": 1, "tags": [], "bug_id": 39874, "attachment_id": null, "is_private": false, "id": 90515, "time": "2006-06-23T09:30:26Z", "creator": "nick@webthing.com", "creation_time": "2006-06-23T09:30:26Z", "text": "What are you expecting to be changed?  The CGI behaviour is mandated by the \nCGI spec, and changing it would break things.  To bypass security on an \ninternal redirect would indeed be a security hole.\n\nEither use an external redirect, or use some alternative means to authenticate \nyour destination.\n\nYour report is more a minor mismatch between two specifications - both of \nwhich Apache supports - than a bug.\n\nAlso bear in mind that in the days of apache 1.3, Digest authentication was \nscarcely used at all, not least due to nonexistent or broken client support in \nbrowsers including Microsoft, Netscape, Mozilla."}, {"count": 2, "tags": [], "bug_id": 39874, "attachment_id": null, "is_private": false, "id": 90601, "time": "2006-06-26T01:40:59Z", "creator": "kosh@koshua.org", "creation_time": "2006-06-26T01:40:59Z", "text": "(In reply to comment #1)\n> What are you expecting to be changed?\n\nA workaround could be good.  e.g. mod_cgi to have an option to slightly deviate\nfrom the rfc3875 section 6.2.2 and synthesise an external 302 Found (or better,\n303 See Other, which implies a client GET) instead.\n\nIf you like I can code this and submit it for 1.3 and 2.x.\n\n> Either use an external redirect, or use some alternative means to authenticate \n> your destination.\n\nWe're a hosting provider; telling our users \"you must change your source code\"\nis a last resort, after server-side workaround possibilities are exhausted.\n \n> Your report is more a minor mismatch between two specifications - both of \n> which Apache supports - than a bug.\n\nagreed\n\n> Also bear in mind that in the days of apache 1.3, Digest authentication was \n> scarcely used at all, not least due to nonexistent or broken client support in \n> browsers including Microsoft, Netscape, Mozilla.\n\nWe have the same problem in all versions, I think.\n\n- koshua\n\n"}]
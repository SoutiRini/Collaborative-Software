[{"count": 0, "text": "For the case of an exception error page the servlet specification 2.3 (pfd2)\nstates on page 65:\n\n\n> If no error-page dec-laration containing an exception-type fits\n> using the class-heirarchy match, and the exception thrown is a\n> ServletException or subclass thereof, the container extracts\n> the wrapped exception, as defined by the ServletException.getRootCause()\n> method. It makes a second pass over the error page declarations, again\n> attempting the match against the error page declarations, but using\n> the wrapped exception instead. \n\nTomcat 3.2.3 seems to skip the second round of matching an exception \ntowards an error page declaration.\n\nFor me, the following patch fixes this (this is against 3.2.3).\nI checked the CVS source, and I couldn't find the equivalent code to the patch\nin the main branch, so maybe a similar fix is required there as well.\n\n\n--- org/apache/tomcat/core/ContextManager.java  Wed Aug 22 21:00:15 2001\n+++ org/apache/tomcat/core/ContextManager.java.fixed    Wed Aug 22 21:00:10 2001\n@@ -1154,6 +1154,20 @@\n            clazz = clazz.getSuperclass();\n        }\n \n+       if (errorPath == null && t instanceof ServletException) {\n+           Throwable t2 = ((ServletException) t).getRootCause();\n+\n+           if (t2 != null) {\n+               clazz = t2.getClass();\n+               while (errorPath == null && clazz != null) {\n+                   String name = clazz.getName();\n+                   errorPath = ctx.getErrorPage(name);\n+                   clazz = clazz.getSuperclass();\n+               }\n+           }\n+           if (errorPath != null) t = t2;\n+       }\n+\n        if( errorPath != null ) {\n            errorServlet=getHandlerForPath( ctx, errorPath );", "creator": "ps@psncc.at", "attachment_id": null, "id": 4739, "time": "2001-08-22T12:02:56Z", "bug_id": 3233, "creation_time": "2001-08-22T12:02:56Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "Tomcat 3.X is aimed to implement Servlet spec 2.2, not 2.3..\n\n", "is_private": false, "id": 4881, "creation_time": "2001-08-26T12:06:56Z", "time": "2001-08-26T12:06:56Z", "creator": "nacho@apache.org", "bug_id": 3233, "attachment_id": null}, {"count": 2, "text": "hoBut the 2.3pfd2 specification makes sense for 2.2 too and implementing it \nmight not hurt 2.2 compliance. Glancing at the 2.2 specs, I cannot even find \nthe desired functionality explained. So I would implement the most useful \nsolution - which IMHO is what 2.3 indicates.\n\nThe 2.3 specs make much more sense than the current mode of operation\nwhich is somewhat ... surprising.\n\nI really would like to see this in 3.3 final.\n", "creator": "ps@psncc.at", "is_private": false, "id": 4897, "time": "2001-08-27T04:57:38Z", "bug_id": 3233, "creation_time": "2001-08-27T04:57:38Z", "tags": [], "attachment_id": null}, {"count": 3, "text": "*** Bug 3377 has been marked as a duplicate of this bug. ***", "creator": "Larry.Isaacs@sas.com", "is_private": false, "id": 5400, "time": "2001-09-11T21:17:51Z", "bug_id": 3233, "creation_time": "2001-09-11T21:17:51Z", "tags": [], "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 3233, "attachment_id": null, "text": "It makes sense, since the 2.2 spec leaves that undefined and 2.3 clarifies this,\nI believe it's better to follow the 2.3 behavior.\n\nThe fix for 3.3 is in modules/generators/ErrorHandler, your patch works without\nany change. ", "id": 5491, "time": "2001-09-13T15:35:57Z", "creator": "cmanolache@yahoo.com", "creation_time": "2001-09-13T15:35:57Z", "is_private": false}, {"count": 5, "tags": [], "text": "Any reason for not adding the workaround to 3.2.3 also?\nNote that the problem was reported independently by two\nusers of 3.2.3.", "is_private": false, "bug_id": 3233, "id": 5520, "time": "2001-09-14T01:04:14Z", "creator": "jochen.wiedmann@softwareag.com", "creation_time": "2001-09-14T01:04:14Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "bschneid@arsdigita.com", "attachment_id": null, "id": 5840, "time": "2001-09-20T14:16:21Z", "bug_id": 3233, "creation_time": "2001-09-20T14:16:21Z", "is_private": false, "text": "Make that three. :-) \n\nI'm using Tomcat 3.2.3 and found the same problem indepdently.  Resin 1.2 uses\nthe getRootCause() from servlet exceptions and Tomcat doesn't, and AFAIK both\nare servlet 2.2.  The servlet 2.2 spec is very inconclusive and so it's hard to\nsay that one server honors servlet 2.2 and one doesn't."}]
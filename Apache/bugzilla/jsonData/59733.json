[{"count": 0, "tags": [], "bug_id": 59733, "attachment_id": null, "is_private": false, "id": 191831, "time": "2016-06-20T10:17:27Z", "creator": "dattu.kv@gmail.com", "creation_time": "2016-06-20T10:17:27Z", "text": "Problem can be reproduced by following these steps.\n\n1] Shift Row2 to Row0\n2] Now try shifting Row3 to Row0 you get org.apache.xmlbeans.impl.values.XmlValueDisconnectedException\n\nHere is piece of code to reproduce issue. This issue happens with 3.15-beta as well.\n\nWorkbook workbook = new XSSFWorkbook();\n\t\tSheet sheet = workbook.createSheet(\"mySheet\");\n\t\tRow row = workbook.getSheet(\"mySheet\").createRow(0);\n\t\trow.createCell(0).setCellValue(1.0);\n\t\trow.createCell(1).setCellValue(2.0);\n\t\t//\n\t\trow = workbook.getSheet(\"mySheet\").createRow(1);\n\t\trow.createCell(0).setCellValue(3.0);\n\t\trow.createCell(1).setCellValue(4.0);\n\t\trow = workbook.getSheet(\"mySheet\").createRow(2);\n\t\trow.createCell(0).setCellValue(5.0);\n\t\trow.createCell(1).setCellValue(6.0);\n\t\trow = workbook.getSheet(\"mySheet\").createRow(3);\n\t\trow.createCell(0).setCellValue(7.0);\n\t\trow.createCell(1).setCellValue(8.0);\n\t\trow = workbook.getSheet(\"mySheet\").createRow(4);\n\t\trow.createCell(0).setCellValue(9.0);\n\t\trow.createCell(1).setCellValue(10.0);\n\n\t\tsheet.shiftRows(2, 2, -2);\n\t\tsheet.shiftRows(3, 3, -3);"}, {"count": 1, "tags": [], "creator": "onealj@apache.org", "is_private": false, "text": "Verified this affects the current trunk (pre-3.15-beta2). Added a disabled unit test in r1749295.\n\nXmlValueDisconnectedExceptions occur because the links between nodes in the DOM (XML tree) are broken. This can happen when a node is freed by one node but still weakly linked to by another node. This only causes problems when the second node tries to traverse the broken link.", "id": 191833, "time": "2016-06-20T10:44:57Z", "bug_id": 59733, "creation_time": "2016-06-20T10:44:57Z", "attachment_id": null}, {"count": 2, "text": "Probably a duplicate of bug 58221", "creator": "dominik.stadler@gmx.at", "is_private": false, "id": 191835, "time": "2016-06-20T10:52:21Z", "bug_id": 59733, "creation_time": "2016-06-20T10:52:21Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "creator": "onealj@apache.org", "is_private": false, "id": 191836, "creation_time": "2016-06-20T10:54:09Z", "time": "2016-06-20T10:54:09Z", "bug_id": 59733, "text": "I simplified this to creating empty rows, and the exception was still thrown by the second shiftRows call. r1749300.\nThis isolates the problem to the CTRows causing the disconnected XML value.\n\nWorkbook workbook = new XSSFWorkbook();\nSheet sheet = workbook.createSheet();\nfor (int r=0; r<=4; r++) {\n    sheet.createRow(r);\n}\n\n// Shift the 2nd row on top of the 0th row\nsheet.shiftRows(2, 2, -2);\nsheet.shiftRows(3, 3, -3);", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 59733, "text": "Will it be fixed in 3.15?", "id": 191837, "time": "2016-06-20T11:28:48Z", "creator": "dattu.kv@gmail.com", "creation_time": "2016-06-20T11:28:48Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 59733, "text": "(In reply to Dattathreya from comment #4)\n> Will it be fixed in 3.15?\nIt depends on if someone contributes a patch that fixes the bug. Those who are not affected by the bug are less likely to spend time fixing the bug.", "id": 191839, "time": "2016-06-20T11:34:08Z", "creator": "onealj@apache.org", "creation_time": "2016-06-20T11:34:08Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 59733, "attachment_id": null, "id": 191844, "time": "2016-06-20T14:04:06Z", "creator": "dattu.kv@gmail.com", "creation_time": "2016-06-20T14:04:06Z", "is_private": false, "text": "Is there any temporary workarounds available for this problem?"}, {"count": 7, "tags": [], "text": "In r1752996 I have narrowed down the testcase slightly, after the first shifting, only removing row 0 and then trying to access row 1 causes the exception.", "is_private": false, "id": 192424, "creator": "dominik.stadler@gmx.at", "time": "2016-07-16T20:53:30Z", "bug_id": 59733, "creation_time": "2016-07-16T20:53:30Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "By experiment I uncommented removeRow on the sheetData in XSSFSheets.shiftRows function. Because this decouples the original row from the xml. I now try and remove all cells instead when code decides to remove the row(s) to shift to.\n\n//worksheet.getSheetData().removeRow(idx);\nfor(Iterator<Cell> cit = row.cellIterator(); cit.hasNext();) {\n   row.removeCell(cit.next());\n}", "is_private": false, "id": 195161, "creator": "blommers80@gmail.com", "time": "2016-11-23T11:31:49Z", "bug_id": 59733, "creation_time": "2016-11-23T11:31:49Z", "attachment_id": null}]
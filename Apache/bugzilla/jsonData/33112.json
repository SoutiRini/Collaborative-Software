[{"count": 0, "tags": [], "creator": "apache@jth.net", "attachment_id": null, "text": "The query string is not preserved when returning the negotiated file causing CGI \nscripts to miss all request variables. Here is a fix:\n\n--- httpd-2.0.52/modules/mappers/mod_negotiation.c      2004-02-09 21:53:18.\n000000000 +0100\n+++ httpd-2.0.52j/modules/mappers/mod_negotiation.c     2005-01-15 13:47:20.\n095964578 +0100\n@@ -2938,7 +2938,7 @@\n     udir = ap_make_dirstr_parent(r->pool, r->uri);\n     udir = ap_escape_uri(r->pool, udir);\n     ap_internal_redirect(apr_pstrcat(r->pool, udir, best->file_name,\n-                                     r->path_info, NULL), r);\n+                                     r->path_info, \"?\", r->args, NULL), r);\n     return OK;\n }\n\n@@ -2991,6 +2991,7 @@\n             goto return_from_multi;\n         }\n     }\n+    if ((r->args != NULL) && ( sub_req->args == NULL)) sub_req->args = \napr_pstrdup(r->pool, r->args);    /* keep query_string */\n\n     /* now do a \"fast redirect\" ... promotes the sub_req into the main req */\n     ap_internal_fast_redirect(sub_req, r);", "id": 69724, "time": "2005-01-15T13:56:52Z", "bug_id": 33112, "creation_time": "2005-01-15T13:56:52Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 33112, "is_private": false, "id": 106737, "time": "2007-08-14T01:55:10Z", "creator": "per@computer.org", "creation_time": "2007-08-14T01:55:10Z", "tags": [], "text": "Also present in 2.2.4."}, {"count": 2, "tags": [], "bug_id": 33112, "text": "Fixed in trunk: http://svn.apache.org/viewvc?view=rev&revision=565671", "id": 106739, "time": "2007-08-14T02:23:20Z", "creator": "nick@webthing.com", "creation_time": "2007-08-14T02:23:20Z", "is_private": false, "attachment_id": null}, {"text": "It's probably irrelevant now, but I've applied and tested the patch in 2.2.4.\nWorks fine.", "tags": [], "creator": "per@computer.org", "is_private": false, "count": 3, "id": 106744, "time": "2007-08-14T03:46:24Z", "bug_id": 33112, "creation_time": "2007-08-14T03:46:24Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 33112, "is_private": false, "id": 107364, "time": "2007-08-28T16:43:29Z", "creator": "nick@webthing.com", "creation_time": "2007-08-28T16:43:29Z", "tags": [], "text": "Fixed for 2.2.6."}, {"count": 5, "tags": [], "bug_id": 33112, "text": "This part has disappeared from mod_negotiation.c\n \n+    if ((r->args != NULL) && ( sub_req->args == NULL)) sub_req->args = apr_pstrdup(r->pool, r->args);    /* keep query_string */\n\nPlease, enter it.\n\n", "id": 121211, "time": "2008-10-05T16:06:27Z", "creator": "apache@jth.net", "creation_time": "2008-10-05T16:06:27Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 33112, "text": "(In reply to comment #5)\n> This part has disappeared from mod_negotiation.c\n> \n> +    if ((r->args != NULL) && ( sub_req->args == NULL)) sub_req->args =\n> apr_pstrdup(r->pool, r->args);    /* keep query_string */\n> \n> Please, enter it.\n> \n\nIt was never in the code as the bug was fixed differently (see\nhttp://svn.apache.org/viewvc?view=rev&revision=565671 and http://svn.eu.apache.org/viewvc?view=rev&revision=570450) . Unless the problem still occurs for you please leave this bug closed.", "id": 121217, "time": "2008-10-06T00:55:29Z", "creator": "rpluem@apache.org", "creation_time": "2008-10-06T00:55:29Z", "is_private": false, "attachment_id": null}, {"count": 7, "attachment_id": null, "bug_id": 33112, "text": "Please, don't close bugs, you haven't tested !\nWhy do you think I have reopened this bug ?!\n\nI have added the missing line and now it is working.\nIt is not working as released in 2.2.9 \n", "id": 121220, "time": "2008-10-06T02:17:32Z", "creator": "apache@jth.net", "creation_time": "2008-10-06T02:17:32Z", "tags": [], "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 33112, "text": "I've just \"rediscovered\" the issue in 2.2.4. I upgraded to 2.2.11, and that solved problem for me.", "id": 125062, "time": "2009-02-22T08:23:28Z", "creator": "per@computer.org", "creation_time": "2009-02-22T08:23:28Z", "tags": [], "is_private": false}, {"text": "I also couldn't reproduce with recent 2.2.x, please provide a detailed report against 2.2.6 or later if re-opening.", "tags": [], "creator": "covener@gmail.com", "is_private": false, "count": 9, "id": 125069, "time": "2009-02-22T10:45:38Z", "bug_id": 33112, "creation_time": "2009-02-22T10:45:38Z", "attachment_id": null}, {"count": 10, "attachment_id": null, "bug_id": 33112, "text": "I have also checked 2.2.11 and the problem has been fixed.\n\nLooking at the fixed issues in 2.2.10 in 2.2.11 I suspect, that this somehow was the causing the problem i.e. same symptom, but in another module.\n\nBug 45247 - query string not preserved with [proxy, noescape]", "id": 125072, "time": "2009-02-22T13:29:41Z", "creator": "apache@jth.net", "creation_time": "2009-02-22T13:29:41Z", "tags": [], "is_private": false}, {"text": "Apparently this bug will not fully die.\nI still have to add this line in 2.2.13\n\n    if ((r->args != NULL) && ( sub_req->args == NULL)) sub_req->args = apr_pstrdup(r->pool, r->args);    /* keep query_string JTH */\n\nat line 3134 in mod_negotiation.c\n\nWithout this line this will not work (params not recognized)\n\nhttp://jth.net/index?scroll=yes&ramme=./domchange.da.php\n\n [QUERY_STRING] => \n [REQUEST_URI] => /index?scroll=yes&ramme=./domchange.da.php\n\nbut\n\nhttp://jth.net/index.var?scroll=yes&ramme=./domchange.da.php\n\n [QUERY_STRING] => scroll=yes&ramme=./domchange.da.php\n [REQUEST_URI] => /index?scroll=yes&ramme=./domchange.da.php\n [REDIRECT_URL_COUNT_DINDEX] => index1.php index.var index.da.php index.php index.html index.htm index.shtml index.cgi index.html.da index.html.en index\n \nwill.\n\nindex.var contains\n\nURI: index\n\nURI: index.da.php\nContent-type: text/html\n\nURI: index.en.php\nContent-type: text/html\nContent-language: en, de, fr\n\nURI: index.nl.php\nContent-type: text/html\nContent-language: nl\n\nURI: index.da.php\nContent-type: text/html\nContent-language: da, sv, no, fo, is", "tags": [], "creator": "apache@jth.net", "is_private": false, "count": 11, "id": 130424, "time": "2009-09-15T11:50:27Z", "bug_id": 33112, "creation_time": "2009-09-15T11:50:27Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "apache@jth.net", "attachment_id": null, "is_private": false, "id": 134778, "time": "2010-02-22T17:35:54Z", "bug_id": 33112, "creation_time": "2010-02-22T17:35:54Z", "text": "Still not solved in 2.2.14"}, {"count": 13, "attachment_id": null, "bug_id": 33112, "text": "OK, you have a scenario where mod_negotiation runs twice: first to resolve multiviews, then to resolve a type map.  I am able to reproduce what you describe in Comment 11.\n\nSo the conclusion is: the same bug appeared in both handlers.  I fixed one ( Comment 2 ) and thought from the comments (including Comment 10 from you) all was well - hence the confusion.\n\nLooks like your fix will do the job, and we can dispense with the copy so it's virtually overhead-free.  Applied now in r915407 .", "id": 134819, "time": "2010-02-23T16:16:54Z", "creator": "nick@webthing.com", "creation_time": "2010-02-23T16:16:54Z", "tags": [], "is_private": false}, {"id": 134827, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "count": 14, "text": "*** Bug 43550 has been marked as a duplicate of this bug. ***", "time": "2010-02-23T20:07:24Z", "bug_id": 33112, "creation_time": "2010-02-23T20:07:24Z", "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 33112, "text": "The patch in r915407 has been backported to 2.2 as r917017 and is part of the released version 2.2.15.", "id": 140260, "time": "2010-09-28T07:01:16Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2010-09-28T07:01:16Z", "is_private": false, "attachment_id": null}, {"count": 16, "attachment_id": null, "bug_id": 33112, "text": "The patch has also been backported to 2.0 as revision r1004972 and will be part of version 2.0.64 and beyond once it gets released.", "id": 140509, "time": "2010-10-06T07:57:05Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2010-10-06T07:57:05Z", "tags": [], "is_private": false}]
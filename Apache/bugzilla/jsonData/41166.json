[{"count": 0, "tags": [], "bug_id": 41166, "is_private": false, "id": 96858, "creation_time": "2006-12-13T00:18:02Z", "time": "2006-12-13T00:18:02Z", "creator": "Aray_CN@163.com", "text": "I try to test the Cluster function. I got a problem: something like following \napears in the $CATALINA_HOME/logs/catalina.out\n\nSEVERE: Unable to start ReplicatedContext\njava.lang.ClassCastException: org.apache.naming.resources.ProxyDirContext \ncannot be cast to java.io.Serializable\n        at \norg.apache.catalina.tribes.tipis.AbstractReplicatedMap$MapEntry.setValue\n(AbstractReplicatedMap.java:1060)\n\nI didn't change any file in $CATALINA_HOME except server.xml, the any thing I \nchanged in server.xml is uncomment the line: \n<Cluster className=\"org.apache.catalina.ha.tcp.SimpleTcpCluster\"/>. \n\nand I add a context configuration file test.xml to \n$CATALINA_HOME/conf/Catalina/localhost with the flolling content\n\n[Aray@BONC-01 conf]$ cat Catalina/localhost/test.xml\n<Context\n        className=\"org.apache.catalina.ha.context.ReplicatedContext\"\n        path=\"/test\" docBase=\"/var/www/ClusterTest\"\n        debug=\"0\" privileged=\"true\" reloadable=\"true\"\n>\n\nthe web.xml file in /var/www/ClusterTest has no <distributable/> element \n\n\nI am worrying about I can't explain the problem clearly with my poor English. \nSo I paste the stepes I do as following:\n\n[Aray@BONC-01 apache-tomcat-6.0.2]$ which java\n/usr/java/jdk1.6.0/bin/java\n[Aray@BONC-01 apache-tomcat-6.0.2]$ java -version\njava version \"1.6.0-rc\"\nJava(TM) SE Runtime Environment (build 1.6.0-rc-b104)\nJava HotSpot(TM) Client VM (build 1.6.0-rc-b104, mixed mode, sharing)\n[Aray@BONC-01 apache-tomcat-6.0.2]$ echo $JAVA_HOME\n/usr/java/jdk1.6.0\n[Aray@BONC-01 apache-tomcat-6.0.2]$ echo $CLASSPATH\n\n[Aray@BONC-01 apache-tomcat-6.0.2]$ uname -a\nLinux BONC-01 2.6.9-34.EL #1 Wed Mar 8 00:07:35 CST 2006 i686 i686 i386 \nGNU/Linux\n[root@BONC-01 local]# cat /etc/redhat-release\nCentOS release 4.3 (Final)\n[Aray@BONC-01 apache-tomcat-6.0.2]$ cd conf\n[Aray@BONC-01 conf]$ cat server.xml\n<!-- Note:  A \"Server\" is not itself a \"Container\", so you may not\n     define subcomponents such as \"Valves\" at this level.\n     Documentation at /docs/config/server.html\n -->\n<Server port=\"8005\" shutdown=\"SHUTDOWN\">\n\n  <!--APR library loader. Documentation at /docs/apr.html -->\n  <Listener className=\"org.apache.catalina.core.AprLifecycleListener\" \nSSLEngine=\"on\" />\n  <!--Initialize Jasper prior to webapps are loaded. Documentation \nat /docs/jasper-howto.html -->\n  <Listener className=\"org.apache.catalina.core.JasperListener\" />\n  <!-- JMX Support for the Tomcat server. Documentation at /docs/non-\nexistent.html -->\n  <Listener className=\"org.apache.catalina.mbeans.ServerLifecycleListener\" />\n  <Listener \nclassName=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" />\n\n  <!-- Global JNDI resources\n       Documentation at /docs/jndi-resources-howto.html\n  -->\n  <GlobalNamingResources>\n    <!-- Editable user database that can also be used by\n         UserDatabaseRealm to authenticate users\n    -->\n    <Resource name=\"UserDatabase\" auth=\"Container\"\n              type=\"org.apache.catalina.UserDatabase\"\n              description=\"User database that can be updated and saved\"\n              factory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\"\n              pathname=\"conf/tomcat-users.xml\" />\n  </GlobalNamingResources>\n\n  <!-- A \"Service\" is a collection of one or more \"Connectors\" that share\n       a single \"Container\" Note:  A \"Service\" is not itself a \"Container\",\n       so you may not define subcomponents such as \"Valves\" at this level.\n       Documentation at /docs/config/service.html\n   -->\n  <Service name=\"Catalina\">\n\n    <!-- A \"Connector\" represents an endpoint by which requests are received\n         and responses are returned. Documentation at :\n         Java HTTP Connector: /docs/config/http.html (blocking & non-blocking)\n         Java AJP  Connector: /docs/config/ajp.html\n         APR (HTTP/AJP) Connector: /docs/apr.html\n         Define a non-SSL HTTP/1.1 Connector on port 8080\n    -->\n    <Connector port=\"8080\" protocol=\"HTTP/1.1\"\n               maxThreads=\"150\" connectionTimeout=\"20000\"\n               redirectPort=\"8443\" />\n\n    <!-- Define a SSL HTTP/1.1 Connector on port 8443\n         This connector uses the JSSE configuration, when using APR, the\n         connector should be using the OpenSSL style configuration\n         described in the APR documentation -->\n    <!--\n    <Connector port=\"8443\" protocol=\"HTTP/1.1\"\n               maxThreads=\"150\" scheme=\"https\" secure=\"true\"\n               clientAuth=\"false\" sslProtocol=\"TLS\" />\n    -->\n\n    <!-- Define an AJP 1.3 Connector on port 8009 -->\n    <Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" />\n\n\n    <!-- An Engine represents the entry point (within Catalina) that processes\n         every request.  The Engine implementation for Tomcat stand alone\n         analyzes the HTTP headers included with the request, and passes them\n         on to the appropriate Host (virtual host).\n         Documentation at /docs/config/engine.html -->\n\n    <!-- You should set jvmRoute to support load-balancing via AJP ie :\n    <Engine name=\"Standalone\" defaultHost=\"localhost\" jvmRoute=\"jvm1\">\n    -->\n    <Engine name=\"Catalina\" defaultHost=\"localhost\">\n\n      <!--For clustering, please take a look at documentation at:\n          /docs/cluster-howto.html  (simple how to)\n          /docs/config/cluster.html (reference documentation) -->\n\n      <Cluster className=\"org.apache.catalina.ha.tcp.SimpleTcpCluster\"/>\n\n\n      <!-- The request dumper valve dumps useful debugging information about\n           the request and response data received and sent by Tomcat.\n           Documentation at: /docs/config/valve.html -->\n      <!--\n      <Valve className=\"org.apache.catalina.valves.RequestDumperValve\"/>\n      -->\n\n      <!-- This Realm uses the UserDatabase configured in the global JNDI\n           resources under the key \"UserDatabase\".  Any edits\n           that are performed against this UserDatabase are immediately\n           available for use by the Realm.  -->\n      <Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\"\n             resourceName=\"UserDatabase\"/>\n\n      <!-- Define the default virtual host\n           Note: XML Schema validation will not work with Xerces 2.2.\n       -->\n      <Host name=\"localhost\"  appBase=\"webapps\"\n            unpackWARs=\"true\" autoDeploy=\"true\"\n            xmlValidation=\"false\" xmlNamespaceAware=\"false\">\n\n        <!-- SingleSignOn valve, share authentication between web applications\n             Documentation at: /docs/config/valve.html -->\n        <!--\n        <Valve className=\"org.apache.catalina.authenticator.SingleSignOn\" />\n        -->\n\n        <!-- Access log processes all example.\n             Documentation at: /docs/config/valve.html -->\n        <!--\n        <Valve className=\"org.apache.catalina.valves.FastCommonAccessLogValve\" \ndirectory=\"logs\"\n               prefix=\"localhost_access_log.\" suffix=\".txt\" pattern=\"common\" \nresolveHosts=\"false\"/>\n        -->\n\n      </Host>\n    </Engine>\n  </Service>\n</Server>\n\n[Aray@BONC-01 conf]$ mkdir Catalina\n[Aray@BONC-01 conf]$ ln -s /usr/local/tomcatConf/localhost/ Catalina/localhost\n[Aray@BONC-01 conf]$ cat Catalina/localhost/test.xml\n<Context\n        className=\"org.apache.catalina.ha.context.ReplicatedContext\"\n        path=\"/test\" docBase=\"/var/www/ClusterTest\"\n        debug=\"0\" privileged=\"true\" reloadable=\"true\"\n>\n</Context>\n[Aray@BONC-01 conf]$ cd ..\n[Aray@BONC-01 apache-tomcat-6.0.2]$ ls\nbin  conf  lib  LICENSE  logs  NOTICE  RELEASE-NOTES  RUNNING.txt  temp  \nwebapps  work\n[Aray@BONC-01 apache-tomcat-6.0.2]$ rm logs/*\n[Aray@BONC-01 apache-tomcat-6.0.2]$ bin/catalina.sh version\nUsing CATALINA_BASE:   /home/Aray/download/apache-tomcat-6.0.2\nUsing CATALINA_HOME:   /home/Aray/download/apache-tomcat-6.0.2\nUsing CATALINA_TMPDIR: /home/Aray/download/apache-tomcat-6.0.2/temp\nUsing JRE_HOME:       /usr/java/jdk1.6.0\nServer version: Apache Tomcat/6.0.2\nServer built:   Nov 16 2006 12:31:06\nServer number:  6.0.2.0\nOS Name:        Linux\nOS Version:     2.6.9-34.EL\nArchitecture:   i386\nJVM Version:    1.6.0-rc-b104\nJVM Vendor:     Sun Microsystems Inc.\n[Aray@BONC-01 apache-tomcat-6.0.2]$ bin/startup.sh\nUsing CATALINA_BASE:   /home/Aray/download/apache-tomcat-6.0.2\nUsing CATALINA_HOME:   /home/Aray/download/apache-tomcat-6.0.2\nUsing CATALINA_TMPDIR: /home/Aray/download/apache-tomcat-6.0.2/temp\nUsing JRE_HOME:       /usr/java/jdk1.6.0\n[Aray@BONC-01 apache-tomcat-6.0.2]$ cat logs/catalina.out\nINFO: Initializing Coyote HTTP/1.1 on http-8080\nDec 13, 2006 4:07:39 PM org.apache.catalina.startup.Catalina load\nINFO: Initialization processed in 2532 ms\nDec 13, 2006 4:07:40 PM org.apache.catalina.core.StandardService start\nINFO: Starting service Catalina\nDec 13, 2006 4:07:40 PM org.apache.catalina.core.StandardEngine start\nINFO: Starting Servlet Engine: Apache Tomcat/6.0.2\nDec 13, 2006 4:07:40 PM org.apache.catalina.ha.tcp.SimpleTcpCluster start\nINFO: Cluster is about to start\nDec 13, 2006 4:07:40 PM org.apache.catalina.tribes.transport.ReceiverBase bind\nINFO: Receiver Server Socket bound to:/127.0.0.1:4000\nDec 13, 2006 4:07:40 PM org.apache.catalina.tribes.membership.McastServiceImpl \nsetupSocket\nINFO: Setting cluster mcast soTimeout to 500\nDec 13, 2006 4:07:40 PM org.apache.catalina.tribes.membership.McastServiceImpl \nwaitForMembers\nINFO: Sleeping for 1000 milliseconds to establish cluster membership, start \nlevel:4\nDec 13, 2006 4:07:41 PM org.apache.catalina.tribes.membership.McastServiceImpl \nwaitForMembers\nINFO: Done sleeping, membership established, start level:4\nDec 13, 2006 4:07:41 PM org.apache.catalina.tribes.membership.McastServiceImpl \nwaitForMembers\nINFO: Sleeping for 1000 milliseconds to establish cluster membership, start \nlevel:8\nDec 13, 2006 4:07:42 PM org.apache.catalina.tribes.membership.McastServiceImpl \nwaitForMembers\nINFO: Done sleeping, membership established, start level:8\nDec 13, 2006 4:07:42 PM org.apache.catalina.core.StandardHost start\nINFO: XML validation disabled\nDec 13, 2006 4:07:42 PM org.apache.catalina.tribes.tipis.AbstractReplicatedMap \ninit\nINFO: Initializing AbstractReplicatedMap with context name:/test\nDec 13, 2006 4:07:43 PM org.apache.catalina.ha.context.ReplicatedContext start\nSEVERE: Unable to start ReplicatedContext\njava.lang.ClassCastException: org.apache.naming.resources.ProxyDirContext \ncannot be cast to java.io.Serializable\n        at \norg.apache.catalina.tribes.tipis.AbstractReplicatedMap$MapEntry.setValue\n(AbstractReplicatedMap.java:1060)\n        at \norg.apache.catalina.tribes.tipis.AbstractReplicatedMap$MapEntry.<init>\n(AbstractReplicatedMap.java:1005)\n        at org.apache.catalina.tribes.tipis.AbstractReplicatedMap.put\n(AbstractReplicatedMap.java:859)\n        at org.apache.catalina.core.ApplicationContext.setAttribute\n(ApplicationContext.java:756)\n        at org.apache.catalina.core.ApplicationContextFacade.setAttribute\n(ApplicationContextFacade.java:334)\n        at org.apache.catalina.core.StandardContext.start\n(StandardContext.java:4296)\n        at org.apache.catalina.ha.context.ReplicatedContext.start\n(ReplicatedContext.java:55)\n        at org.apache.catalina.core.ContainerBase.addChildInternal\n(ContainerBase.java:760)\n        at org.apache.catalina.core.ContainerBase.addChild\n(ContainerBase.java:740)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:525)\n        at org.apache.catalina.startup.HostConfig.deployDescriptor\n(HostConfig.java:626)\n        at org.apache.catalina.startup.HostConfig.deployDescriptors\n(HostConfig.java:553)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:488)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1138)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:311)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:120)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1022)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:719)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1014)\n        at org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:443)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:451)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:710)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:552)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)\nDec 13, 2006 4:07:43 PM org.apache.catalina.core.ContainerBase addChildInternal\nSEVERE: ContainerBase.addChild: start:\nLifecycleException:  Failed to start ReplicatedContext:  \njava.lang.ClassCastException: org.apache.naming.resources.ProxyDirContext \ncannot be cast to java.io.Serializable\n        at org.apache.catalina.ha.context.ReplicatedContext.start\n(ReplicatedContext.java:58)", "attachment_id": null}, {"count": 1, "tags": [], "creator": "fhanik@apache.org", "attachment_id": null, "is_private": false, "id": 101005, "time": "2007-03-26T23:34:53Z", "bug_id": 41166, "creation_time": "2007-03-26T23:34:53Z", "text": "Thanks for the report"}]
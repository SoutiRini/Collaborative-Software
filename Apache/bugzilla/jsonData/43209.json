[{"count": 0, "tags": [], "text": "When using basic authentication, and a custom HTTP header is added to a request\n(e.g. with the modify headers Firefox plugin), then the first request in the\nsession will have a wrong return value of HTTPServletRequest.getHeader(String).\nIf the value was meant to be \"abc\", then \"abc, abc\" is returned instead.\nSubsequent requests in the session give correct behaviour.\n\nAn example is the following servlet, where the HTTP request has an \"xyz\" header\nfield. Firefox with the modify headers plugin was used.\n\n//---------------------------------------------------------------\n\n\nimport java.io.IOException;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\npublic class Xyz extends HttpServlet {\n\n    public void doGet(HttpServletRequest request, HttpServletResponse response)\nthrows ServletException {\n        try {\n            response.getWriter().println(\"xyz=\"+request.getHeader(\"xyz\"));\n        } catch (IOException e) {\n            throw new RuntimeException(\"IOException\",e);\n        }\n    }\n\n}", "attachment_id": null, "id": 107220, "creator": "morten@ange.dk", "time": "2007-08-24T04:12:57Z", "bug_id": 43209, "creation_time": "2007-08-24T04:12:57Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "john@sourcelabs.com", "is_private": false, "count": 1, "id": 109131, "time": "2007-10-08T10:17:27Z", "bug_id": 43209, "creation_time": "2007-10-08T10:17:27Z", "text": "This appears to be a problem with the Modify Headers extension:\nhttps://www.mozdev.org/bugs/show_bug.cgi?id=17504\n\nI've replicated this with tc6.0.x and ethereal appears to confirm the issue as\nclient-side:\nNo.     Time        Source                Destination           Protocol Info\n      8 18.350781   ::1                   ::1                   HTTP     GET\n/testHTTPHeadersCorruptedWithBasicAuthentication-BZ-43209-JIRA-14147/test HTTP/1.1\n\nFrame 8 (567 bytes on wire, 567 bytes captured)\nNull/Loopback\nInternet Protocol Version 6\nTransmission Control Protocol, Src Port: 52540 (52540), Dst Port: http-alt\n(8080), Seq: 1, Ack: 1, Len: 491\nHypertext Transfer Protocol\n    GET\n/testHTTPHeadersCorruptedWithBasicAuthentication-BZ-43209-JIRA-14147/test\nHTTP/1.1\\r\\n\n    Host: localhost:8080\\r\\n\n    User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X; en-US; rv:1.8.1.7)\nGecko/20070914 Firefox/2.0.0.7\\r\\n\n    Accept:\ntext/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\\r\\n\n    Accept-Language: en-us,en;q=0.5\\r\\n\n    Accept-Encoding: gzip,deflate\\r\\n\n    Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\\r\\n\n    Keep-Alive: 300\\r\\n\n    Connection: keep-alive\\r\\n\n    xyz: john\\r\\n\n    \\r\\n\n\nNo.     Time        Source                Destination           Protocol Info\n     10 18.352724   ::1                   ::1                   HTTP    \nHTTP/1.1 401 Unauthorized (text/html)\n\nFrame 10 (1340 bytes on wire, 1340 bytes captured)\nNull/Loopback\nInternet Protocol Version 6\nTransmission Control Protocol, Src Port: http-alt (8080), Dst Port: 52540\n(52540), Seq: 1, Ack: 492, Len: 1264\nHypertext Transfer Protocol\n    HTTP/1.1 401 Unauthorized\\r\\n\n    Server: Apache-Coyote/1.1\\r\\n\n    Pragma: No-cache\\r\\n\n    Cache-Control: no-cache\\r\\n\n    Expires: Wed, 31 Dec 1969 16:00:00 PST\\r\\n\n    WWW-Authenticate: Basic realm=\"Example Basic Authentication\"\\r\\n\n    Content-Type: text/html;charset=utf-8\\r\\n\n    Content-Length: 966\\r\\n\n    Date: Mon, 08 Oct 2007 17:02:28 GMT\\r\\n\n    \\r\\n\nLine-based text data: text/html\n\nNo.     Time        Source                Destination           Protocol Info\n     12 23.013460   ::1                   ::1                   HTTP     GET\n/testHTTPHeadersCorruptedWithBasicAuthentication-BZ-43209-JIRA-14147/test HTTP/1.1\n\nFrame 12 (608 bytes on wire, 608 bytes captured)\nNull/Loopback\nInternet Protocol Version 6\nTransmission Control Protocol, Src Port: 52540 (52540), Dst Port: http-alt\n(8080), Seq: 492, Ack: 1265, Len: 532\nHypertext Transfer Protocol\n    GET\n/testHTTPHeadersCorruptedWithBasicAuthentication-BZ-43209-JIRA-14147/test\nHTTP/1.1\\r\\n\n    Host: localhost:8080\\r\\n\n    User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X; en-US; rv:1.8.1.7)\nGecko/20070914 Firefox/2.0.0.7\\r\\n\n    Accept:\ntext/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5\\r\\n\n    Accept-Language: en-us,en;q=0.5\\r\\n\n    Accept-Encoding: gzip,deflate\\r\\n\n    Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\\r\\n\n    Keep-Alive: 300\\r\\n\n    Connection: keep-alive\\r\\n\n    xyz: john, john\\r\\n\n    Authorization: Basic dXNlcjpwYXNz\\r\\n\n        Credentials: user:pass\n    \\r\\n\n\nNo.     Time        Source                Destination           Protocol Info\n     14 23.014178   ::1                   ::1                   HTTP    \nHTTP/1.1 200 OK\n\nFrame 14 (278 bytes on wire, 278 bytes captured)\nNull/Loopback\nInternet Protocol Version 6\nTransmission Control Protocol, Src Port: http-alt (8080), Dst Port: 52540\n(52540), Seq: 1265, Ack: 1024, Len: 202\nHypertext Transfer Protocol\n    HTTP/1.1 200 OK\\r\\n\n    Server: Apache-Coyote/1.1\\r\\n\n    Pragma: No-cache\\r\\n\n    Cache-Control: no-cache\\r\\n\n    Expires: Wed, 31 Dec 1969 16:00:00 PST\\r\\n\n    Content-Length: 16\\r\\n\n    Date: Mon, 08 Oct 2007 17:02:33 GMT\\r\\n\n    \\r\\n\n    Data (16 bytes)\n\n0000  78 79 7a 3d 6a 6f 68 6e 2c 20 6a 6f 68 6e 0d 0a   xyz=john, john.."}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "is_private": false, "count": 2, "id": 109132, "time": "2007-10-08T10:39:09Z", "bug_id": 43209, "creation_time": "2007-10-08T10:39:09Z", "text": "Marking as invalid since the trace shows a client side issue, rather than a\nTomcat one.\n\nThanks for the ethereal trace."}]
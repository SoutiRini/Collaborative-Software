[{"count": 0, "tags": [], "bug_id": 49488, "attachment_id": null, "id": 137809, "time": "2010-06-22T07:24:50Z", "creator": "bratapfel81@gmx.de", "creation_time": "2010-06-22T07:24:50Z", "is_private": false, "text": "After switching from Tomcat 5.5 to Tomcat 6.0.24, every now and then Tomcat's WebappClassLoader throws StringIndexOutOfBoundsExceptions, which leads to various exceptions like NoDefClassFoundError. With Tomcat 5.5, everything went fine. The web application in which the exceptions occur remained untouched throughout the whole time. The error is also present in Tomcat 6.0.26.\n\nHere is a short stack trace from the Catalina log file:\n\njava.lang.StringIndexOutOfBoundsException: String index out of range: 95\n         at java.lang.String.substring(String.java:1934)\n         at org.apache.catalina.util.RequestUtil.normalize(RequestUtil.java:131)\n         at org.apache.naming.resources.FileDirContext.normalize(FileDirContext.java:771)\n         at org.apache.naming.resources.FileDirContext.file(FileDirContext.java:809)\n         at org.apache.naming.resources.FileDirContext.getAttributes(FileDirContext.java:429)\n         at org.apache.naming.resources.BaseDirContext.getAttributes(BaseDirContext.java:747)\n         at org.apache.naming.resources.ProxyDirContext.getAttributes(ProxyDirContext.java:840)\n         at org.apache.catalina.loader.WebappClassLoader.findResourceInternal(WebappClassLoader.java:2414)\n         at org.apache.catalina.loader.WebappClassLoader.findClassInternal(WebappClassLoader.java:2266)\n         at org.apache.catalina.loader.WebappClassLoader.findClass(WebappClassLoader.java:976)\n         at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1451)\n         at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1329)\n         at java.lang.Class.getDeclaredClasses0(Native Method)\n         at java.lang.Class.getDeclaredClasses(Class.java:1699)"}, {"text": "I may note that the exception occurs after tomcat start up has finished.", "tags": [], "bug_id": 49488, "is_private": false, "count": 1, "id": 137812, "time": "2010-06-22T07:31:52Z", "creator": "bratapfel81@gmx.de", "creation_time": "2010-06-22T07:31:52Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 49488, "attachment_id": null, "text": "It is very strange. The code in RequestUtil.normalize() is\n\n126      // Resolve occurrences of \"//\" in the normalized path\n127     while (true) {\n128         int index = normalized.indexOf(\"//\");\n129         if (index < 0)\n130             break;\n131         normalized = normalized.substring(0, index) +\n132             normalized.substring(index + 1);\n133     }\n\nI do not see how it can break.\n\n1. What exact version of Java are you using? Is it 32-bit, or 64-bit?\n2. What exact version of Tomcat 5.5.x were you using before?\n3. Is this error reproducible, or it happens randomly?\n\n4. Do you have any clue about what class it tried to load?\n\nNote, that it is possible to turn on debug logging in WebappClassLoader class, by adding the following line to conf/logging.properties:\n\norg.apache.catalina.loader.WebappClassLoader.level=FINE\n\n\nThe code that fails is triggered only if the class file path contains a '//'.  Having a double slash there is unusual. So maybe it is not Tomcat version change that triggers this, but how you web application is deployed.\n\nBy the way, Tomcat 6.0.27 is already available for testing. See a [VOTE] thread on dev@ list.", "id": 137820, "time": "2010-06-22T10:35:31Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-06-22T10:35:31Z", "is_private": false}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 137881, "time": "2010-06-25T04:00:34Z", "bug_id": 49488, "creation_time": "2010-06-25T04:00:34Z", "is_private": false, "text": "I've looked at this and this is looking very much like a JVM bug but even then I can't see how it is being triggered."}, {"count": 4, "tags": [], "bug_id": 49488, "attachment_id": null, "id": 138267, "time": "2010-07-07T23:16:49Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-07-07T23:16:49Z", "is_private": false, "text": "See thread \"Webapp reloading issue and intermittent 404 errors\" on users@.\n\nhttp://markmail.org/message/xsrc4ek3bhkhsxi4\nhttp://marc.info/?t=127773158900004&w=2"}]
[{"attachment_id": null, "tags": [], "bug_id": 22677, "text": "I and a few other users seem to have an issue with JNDI datasources defined in\nthe default context, or in the global resources. When defined in a specific\nContext there is no issue (except it defeats the ability to automatically\ndeploy), however if a JNDI resource is defined in DefaultContext or\nGlobalNamingResources we get a error.\n\nThere are two errors depending on where the resource-ref is. If there is a\nresource-ref in the web.xml you get a:\njava.sql.SQLException: Cannot load JDBC driver class 'null'\nIf you define the Resource in the server.xml you get \njavax.naming.NameNotFoundException: Name jdbc is not bound in this Context\n\n    *  Version - Tomcat 4.1.27 also reported in v5.0\n\n    * Tomcat component - Catalina\n\n    * Platform - Intel/PC\n\n    * OS - Mandrake 9.\n\n    * JVM - 1.4\n\n    * Web Server - none \n\n    * Configuration - \n\nserver.xml-->\n\n<DefaultContext>\n\n<ResourceParams name=\"jdbc/foo\">\n<parameter><name>username</name><value>foo</value></parameter>\n<parameter><name>password</name><value>foo</value></parameter>\n<parameter><name>driverClassName</name>\n\t<value>org.postgresql.Driver</value></parameter>\n<parameter><name>url</name>\n\t<value>jdbc:postgresql://localhost/foo</value></parameter>\n</ResourceParams>\n</DefaultContext>\n\nweb.xml-->\n\n  <resource-ref>\n      <description>Foo Database</description>\n      <res-ref-name>jdbc/foo</res-ref-name>\n      <res-type>javax.sql.DataSource</res-type>\n      <res-auth>Container</res-auth>\n  </resource-ref>\n\n\n    * Log file excerpts and Stack Traces \n\n\nDEBUG (LoginAction.java:36) - peter\nERROR (OfficeUserImpl.java:45) - SQL Exception : Cannot load JDBC driver class\n'null'\njava.sql.SQLException: Cannot load JDBC driver class 'null'\n        at\nnz.co.asterisk.arpt.dao.OfficeUserBase.getConnection(OfficeUserBase.java:301)\n        at\nnz.co.asterisk.arpt.dao.implementation.OfficeUserImpl.verifyUser(OfficeUserImpl.java:27)\n        at nz.co.asterisk.arpt.actions.LoginAction.perform(LoginAction.java:44)\n        at\norg.apache.struts.action.ActionServlet.processActionPerform(ActionServlet.java:1787)\n        at org.apache.struts.action.ActionServlet.process(ActionServlet.java:1586)\n        at org.apache.struts.action.ActionServlet.doPost(ActionServlet.java:510)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at\norg.apache.catalina.core.StandardContext.invoke(StandardContext.java:2416)\n        at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n        at\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:171)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n        at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n        at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n        at org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:223)\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:601)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:392)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:565)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:619)\n        at java.lang.Thread.run(Thread.java:536)\nDEBUG (LoginAction.java:60) - Failed Login", "count": 0, "id": 43205, "time": "2003-08-23T21:50:07Z", "creator": "peter.harrison@nothingbutnet.co.nz", "creation_time": "2003-08-23T21:50:07Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 22677, "is_private": false, "count": 1, "id": 45916, "time": "2003-10-20T11:10:40Z", "creator": "jarkkos@hotmail.com", "creation_time": "2003-10-20T11:10:40Z", "text": "I have been dealing with the same problem for a few days and managed to find \none solution for it.\nI'm using Tomcat 4.1.27 and Sybase database running on Win2K(also tried in XP \nand same assembly worked fine).\n\nIn my server.xml I have Context under <host> as follows:\n\n<Context path=\"/MyApp\" \n         docBase=\"MyApp\"\n         debug=\"5\" \n         reloadable=\"true\" \n         crossContext=\"true\">\t\t\n   <Resource name=\"jdbc/dbref\"\n             auth=\"Container\"\n             type=\"javax.sql.DataSource\"/>\t\n  <ResourceParams name=\"jdbc/dbref\">\n    <parameter>\n      <name>factory</name>\n      <value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n    </parameter>\n    <parameter>\n      <name>maxActive</name>\n      <value>10</value>\n    </parameter>\n    <parameter>\n      <name>maxIdle</name>\n      <value>2</value>\n    </parameter>\n    <parameter>\n      <name>maxWait</name>\n      <value>10000</value>\n    </parameter>\n    <parameter>\n     <name>username</name>\n     <value>report</value>\n    </parameter>\n    <parameter>\n     <name>password</name>\n     <value>report</value>\n    </parameter>\n    <parameter>\n       <name>driverClassName</name>\n       <value>com.sybase.jdbc2.jdbc.SybConnectionPoolDataSource</value>\n    </parameter>\t\n    <parameter>\n      <name>url</name>\n      <value>jdbc:sybase:Tds:xxx:5000/dbname</value>\n    </parameter>\t    \n    <parameter>\n      <name>removeAbandoned</name>\n      <value>true</value>\n          </parameter>\n          <parameter>\n      <name>removeAbandonedTimeout</name>\n      <value>60</value>\n    </parameter>\n  </ResourceParams>\n</Context>\t\n\nIn my web.xml I have:\n\n<resource-ref>\n   <description>Sybase Datasource</description>\n   <res-ref-name>jdbc/dbref</res-ref-name>\n   <res-type>javax.sql.DataSource</res-type>\n   <res-auth>Container</res-auth>\n</resource-ref>\n\n,and in Java:\nContext initContext = new InitialContext();\nContext envContext  = (Context)initContext.lookup(\"java:/comp/env\");\ndataSource = (javax.sql.DataSource)envContext.lookup(dataSourceName);\nConnection con = dataSource.getConnection();\n\nI installed Java 2 Runtime Environment 1.4.2_01 and modified system variables:\nJAVA_HOME = \"j2re 1.4.2_01 install dir\"\nCLASSPATH = \"3rd party database driver jar directory\"\nCATALINA_HOME = \"Tomcat install dir\"\n\nAlthough Jakarta Tomcat 4.1 \"JNDI Datasource HOW-TO\" docs adviced not to \ninstall 3rd party database drivers anywhere else than in \n$CATALINA_HOME/common/lib I tried adding jar into CLASSPATH and it worked fine.\nMake sure you have jre installed and JAVA_HOME set into that dir and it should \nwork fine.\n"}, {"count": 2, "attachment_id": null, "creator": "dcarter@waitaki.otago.ac.nz", "is_private": false, "id": 47769, "time": "2003-11-21T13:30:12Z", "bug_id": 22677, "creation_time": "2003-11-21T13:30:12Z", "tags": [], "text": "With regards to the \"solution\" from Jarkko S, this is defining the JNDI\ndatasource in the specific context, which as mentioned in the original bug\nreport works fine (but is a right pain in the ass because it breaks autodeploy\nand the JNDI definition gets deleted when you redeploy (remove and install) the\nlatest version of your webapp.\n\nThe bug as posted still stands, JNDI resources defined in the default context,\nor global resources are not accessable from webapps.\n\nWill there be a fix for this?  DefaultContexts, and GlobalResources are useless\nif they cannot be accessed from webapps.\n\nRegards,\ndan."}, {"count": 3, "text": "You can define your global pool in GlobalNamingResources:\n  <GlobalNamingResources>\n    .....\n    <Resource name=\"jdbc/GlobalEmployeeAppDb\" auth=\"SERVLET\"\ntype=\"javax.sql.DataSource\"/>\n    <ResourceParams name=\"jdbc/GlobalEmployeeAppDb\">\n        <parameter><name>username</name><value>sa</value></parameter>\n        <parameter><name>password</name><value></value></parameter>\n       \n<parameter><name>driverClassName</name><value>org.hsqldb.jdbcDriver</value></parameter>\n        <parameter><name>url</name><value>jdbc:hsqldb:database</value></parameter>\n    </ResourceParams>\n     ......\n  </GlobalNamingResources>\n\nAnd put a resource link in the context:\n<Context>\n   .....\n   <ResourceLink \n      name=\"jdbc/LinkEmployeeAppDb\" \n      global=\"jdbc/GlobalEmployeeAppDb\" \n      type=\"javax.sql.DataSource\"/>\n   .....\n</Context>\n\nIn your application you can lookup \"jdbc/LinkEmployeeAppDb\".", "bug_id": 22677, "is_private": false, "id": 52718, "time": "2004-02-21T14:15:59Z", "creator": "dirk.verbeeck@pandora.be", "creation_time": "2004-02-21T14:15:59Z", "tags": [], "attachment_id": null}]
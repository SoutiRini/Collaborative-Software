[{"count": 0, "tags": [], "text": "mod_proxy_ajp appears to not comply to the AJP 1.3 spec when sending over the\nSSL key size as an attribute in the AJP 1.3 Request.  Instead of sending the key\nsize as a string, it sends it as an integer.  Both the tomcat and mod_proxy_ajp\ndocumentation implies that it is a string:\n\nhttp://httpd.apache.org/docs/2.2/mod/mod_proxy_ajp.html#rpacetstruct\nhttp://tomcat.apache.org/connectors-doc-archive/jk2/common/AJPv13.html#Request%20Packet%20Structure\n\nThis bug ends up manifesting itself in Jetty 5.1.11 (latest stable) when a\nconnection comes in over SSL to Apache HTTP 2.2.2 and is tunneled to Jetty. \nUnlike Tomcat, their AJP implementation is not resilient against non-compliant\nbehavior.  It completely rejects the request.  \n\n\nThe 2.2.2 following patch includes my fix.  I have tested this against Tomcat\n5.0.24, Tomcat 5.5.9, and Jetty 5.1.11 over SSL.  All work for proxying the\nrequest, but I have not verified that the key size is available and present in\nthe respective servlet containers.\n\ndiff httpd-2.2.2/modules/proxy/ajp_header.c\nhttpd-2.2.2-css/modules/proxy/ajp_header.c\n392c392\n<                 || ajp_msg_append_uint16(msg, (unsigned short) atoi(envvar))) {\n---\n>                 || ajp_msg_append_string(msg, envvar)) {", "is_private": false, "id": 89473, "creator": "chetan.sabnis@epok.net", "time": "2006-05-25T11:36:47Z", "bug_id": 39658, "creation_time": "2006-05-25T11:36:47Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 39658, "text": "You are correct about the documentation of the protocol, but Tomcat, mod_jk and\nas noticed mod_proxy_ajp handle this as an integer. So its a bug in the\ndocumentation of the protocol and a bug in Jetty which implements this according\nto the buggy documentation. So please open up a bug report at Jetty.", "id": 89480, "time": "2006-05-25T13:08:41Z", "creator": "rpluem@apache.org", "creation_time": "2006-05-25T13:08:41Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "trawick@apache.org", "is_private": false, "count": 2, "id": 89490, "time": "2006-05-25T17:29:48Z", "bug_id": 39658, "creation_time": "2006-05-25T17:29:48Z", "text": "so we should keep this PR open to fix our doc, right?"}, {"count": 3, "tags": [], "text": "Yes of course. Pushed the wrong button :-).", "attachment_id": null, "bug_id": 39658, "id": 89492, "time": "2006-05-25T18:30:41Z", "creator": "rpluem@apache.org", "creation_time": "2006-05-25T18:30:41Z", "is_private": false}, {"count": 4, "tags": [], "text": "\nThanks for the quick feedback.  For anyone interested in following this on the\nJetty side of things I have submitted a bug and patch for Jetty here.\n\nhttps://sourceforge.net/tracker/index.php?func=detail&aid=1494939&group_id=7322&atid=107322", "attachment_id": null, "bug_id": 39658, "id": 89494, "time": "2006-05-25T19:04:17Z", "creator": "chetan.sabnis@epok.net", "creation_time": "2006-05-25T19:04:17Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 39658, "attachment_id": null, "text": "Committed to trunk as r409442 (http://svn.apache.org/viewvc?rev=409430&view=rev).", "id": 89497, "time": "2006-05-25T19:43:01Z", "creator": "rpluem@apache.org", "creation_time": "2006-05-25T19:43:01Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "ryan.fong@workday.com", "attachment_id": null, "id": 185854, "time": "2015-10-22T19:54:03Z", "bug_id": 58522, "creation_time": "2015-10-22T19:54:03Z", "is_private": false, "text": "We discovered a problem where calling ServletContext.getResourcePaths from a jsp may corrupt WARDirContext.Entry.children. The WARDirContext.list(Entry) method performs an Arrays.sort(children) call which is not thread-safe. Calling this from multiple request threads may result in the children array losing some entries and duplicating others.\n\nWhen entries representing directories in the war are lost, Tomcat cannot load resources from there. Static resource requests result in http error code 404 and jsp compliation can throw JasperException when included files are not found.\n\nWe have seen this on CentOS 6.5 (and newer versions) with Tomcat 7.0.52 and Java 1.7.0_51.\n\nThe following are attached in the zip:\n* Test case project which demonstrates this corruption. It usually requires multiple runs.\n* A stack trace illustrating the problematic flow.\n* A patch file for WARDirContext.java."}, {"count": 1, "tags": [], "bug_id": 58522, "is_private": false, "text": "Created attachment 33195\neverything", "id": 185857, "time": "2015-10-22T20:09:55Z", "creator": "ryan.fong@workday.com", "creation_time": "2015-10-22T20:09:55Z", "attachment_id": 33195}, {"count": 2, "tags": [], "creator": "violetagg@apache.org", "text": "Created attachment 33201\nProposal\n\nHi,\n\nCan you test the different approach that I have.\n\nI also do not like the idea that the original array is returned but I didn't tested the performance if I return a copy of the array.\n\nRegards,\nVioleta", "id": 185896, "time": "2015-10-23T15:07:07Z", "bug_id": 58522, "creation_time": "2015-10-23T15:07:07Z", "is_private": false, "attachment_id": 33201}, {"count": 3, "tags": [], "creator": "ryan.fong@workday.com", "attachment_id": null, "id": 185898, "time": "2015-10-23T15:52:03Z", "bug_id": 58522, "creation_time": "2015-10-23T15:52:03Z", "is_private": false, "text": "G'day, Violeta. Your proposal looks great. In fact, it will likely improve throughput since we only deploy the war once and your patch avoids unnecessary sorting on all subsequent calls. Thank you!"}, {"count": 4, "tags": [], "creator": "violetagg@apache.org", "attachment_id": null, "id": 185904, "time": "2015-10-23T18:40:47Z", "bug_id": 58522, "creation_time": "2015-10-23T18:40:47Z", "is_private": false, "text": "Hi,\n\nThe fix is provided in 7.0.x trunk and will be available in 7.0.66 onwards.\n\nRegards,\nVioleta"}]
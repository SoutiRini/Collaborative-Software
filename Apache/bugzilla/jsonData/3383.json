[{"count": 0, "text": "The compression filter in tomcat 4b7 seems to work fine when\nusing it against a simple servlet output, but I had some\ndifficulties to make it work with static files (served by the\nDefaultServlet) and Jsps.\n\n  In order to reproduce the problem, simply add the following\nfilter mapping to the examples webapp :\n\n    <filter-mapping>\n      <filter-name>Compression Filter</filter-name>\n      <url-pattern>*.html</url-pattern>\n    </filter-mapping>\n\n  When getting /examples/jsp/index.html, only 10 bytes are\nactually sent. The problem comes from the fact that a GZIPOutputStream\nmust be explicitly closed, a call to flush is not enough.\n\n  I solved this one by adding a call to close in\nDefaultServlet.copy(ResourceInfo resourceInfo,\n                    ServletOutputStream ostream) :\n\n        // Clean up the output stream\n        try {\n            ostream.close();\n        } catch (Throwable t) {\n            ;\n        }\n\nStrangely enough, the method comment says :\n\"and ensure that both streams are closed\" \nbut this is not implemented that way, is there a reason I have\nmissed ?\n\nThere seems to be the same problem with Jasper, but I didn't have\ntime to patch it.", "bug_id": 3383, "attachment_id": null, "id": 5062, "time": "2001-09-03T05:46:38Z", "creator": "mickael.guessant@fisystem.com", "creation_time": "2001-09-03T05:46:38Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 5070, "time": "2001-09-03T12:56:20Z", "bug_id": 3383, "creation_time": "2001-09-03T12:56:20Z", "text": "I may be wrong, but I think that has fixed in the CVS code. Could you try it \nwith the latest nightly and close the bug if it's indeed fixed ?"}, {"count": 2, "text": "  I tested it yesterday (2001-09-02) against the nightly build, and it\ndoesn't seem to be fixed.\n\n  I've just downloaded the new sources (no access to CVS from behind\nthe firewall). There is still no ostream.close() in the DefaultServlet.", "bug_id": 3383, "attachment_id": null, "id": 5080, "time": "2001-09-04T01:36:17Z", "creator": "mickael.guessant@fisystem.com", "creation_time": "2001-09-04T01:36:17Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 3383, "attachment_id": null, "text": "It is legal for a servlet not to close the output stream, so that won't be \nchanged.", "id": 5085, "time": "2001-09-04T07:50:21Z", "creator": "remm@apache.org", "creation_time": "2001-09-04T07:50:21Z", "is_private": false}, {"count": 4, "tags": [], "creator": "remm@apache.org", "text": "Improved the reliability of the compression filter.\n\nIt should now work with JSPs, servlets and static content in all situations, \nalthough it can still be improved in many ways.", "id": 5178, "time": "2001-09-06T16:10:35Z", "bug_id": 3383, "creation_time": "2001-09-06T16:10:35Z", "is_private": false, "attachment_id": null}]
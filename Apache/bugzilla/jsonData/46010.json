[{"count": 0, "attachment_id": null, "bug_id": 46010, "text": "I believe that prior to version 1.7.1 the resultant file could include\nheader and footer even if the no other files went into concat.\n\nWith 1.7.1, class :-\n\n   src/main/org/apache/tools/ant/taskdefs/Concat.java\n\nchecks for zero sources and returns.\n\nI would like to have a file produced if I specify a header or footer,\nbut I can see this might cause other people problems if they are\nexpecting no file at all to be produced in this situation, although this\nwas the result with 1.7.0.", "id": 121524, "time": "2008-10-15T01:24:32Z", "creator": "marksalter@talktalk.net", "creation_time": "2008-10-15T01:24:32Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "marksalter@talktalk.net", "text": "Created attachment 22734\nPatch for Concat.java and concat.html\n\nI have added a forceEmpty option to the concat task, to allow destinationfile creation even if the source resource list is empty.", "id": 121530, "time": "2008-10-15T03:53:15Z", "bug_id": 46010, "creation_time": "2008-10-15T03:53:15Z", "is_private": false, "attachment_id": 22734}, {"count": 2, "tags": [], "creator": "bodewig@apache.org", "text": "yes, with revision 536579 which went into 1.7.1 the behavior for \"no resources\nbut head or file has been specified\" changed.\n\nI'd argue (as I did on the user list ;-) that 1.7.1 is probably more desirable\nas the general case and would add a new attribute to control the behavior\n(making Ant 1.7.1's way the default).\n\n[edit: mid-flight collision of my commit and Mark's patch]", "id": 121531, "time": "2008-10-15T04:01:06Z", "bug_id": 46010, "creation_time": "2008-10-15T04:01:06Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 46010, "text": "patch looks good, I'm not too sure about the name of the attribute, though.\n\nA test would give you extra bonus points ;-)", "id": 121532, "time": "2008-10-15T04:02:34Z", "creator": "bodewig@apache.org", "creation_time": "2008-10-15T04:02:34Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 46010, "text": "I couldn't think of a name that encompassed the action meaning.  I initially went for generateEmpty, but this seemed too long when compared to the other attributes.\n\n", "id": 121533, "time": "2008-10-15T04:17:11Z", "creator": "marksalter@talktalk.net", "creation_time": "2008-10-15T04:17:11Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 46010, "text": "Yep, this was me.  Sorry for your trouble, Mark.  :(  I began this comment with the intention of weighing in on the attribute name issue (was thinking an enumeratedType might be more expressive), but actually, given the recent refactorings to <concat>, can't you accomplish header/footer stuff using nested resources?  The only thing I see that nested resources wouldn't do is bypass filtering.  Another way you could trick <concat> into giving you the header and/or footer might be to include an empty (e.g. <string value=\"\" />) resource.  My thinking here is that if we were to add an attribute that would re-enable the old behavior, you'd have to change your buildfile(s) anyway.  I wonder what anyone else thinks...", "id": 121541, "time": "2008-10-15T07:12:25Z", "creator": "mbenson@apache.org", "creation_time": "2008-10-15T07:12:25Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 46010, "attachment_id": 22737, "text": "Created attachment 22737\npatch to add tests for forceEmpty", "id": 121542, "time": "2008-10-15T07:45:55Z", "creator": "marksalter@talktalk.net", "creation_time": "2008-10-15T07:45:55Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 46010, "attachment_id": null, "text": "(In reply to comment #5)\n> Yep, this was me.  Sorry for your trouble, Mark.  :(\nNo worries, it has been enlightening 8)\n\n> can't you accomplish header/footer stuff using nested\n> resources?\nWe could, but this feels like we are then making header/footer in 'concat' redundant?  Perhaps this is desirable?\n\n>  My thinking here is that if we were to add an attribute that would re-enable\n> the old behavior, you'd have to change your buildfile(s) anyway.\n\nWe would, but it is a small change 8).\n\nWith the change in behaviour, it seems like the alternative is to add 'if' or 'condition' around the file creation, which looks like more changes.  I can't see how to do this (I am an ant newbie).  Perhaps I should ask this question again, or try harder to find an example I can understand.\n\n", "id": 121543, "time": "2008-10-15T07:56:48Z", "creator": "marksalter@talktalk.net", "creation_time": "2008-10-15T07:56:48Z", "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 46010, "text": "I didn't mean to blame you, Matt, just verified that this is indeed a regression, sorry.\n\nMark could probably be even more enlightened by changing the tests ti AntUnit tests ;-) - just kidding.\n\nMark, did you try Matt's suggested workaround of adding an empty string resource to the nested resources?", "id": 121546, "time": "2008-10-15T08:17:05Z", "creator": "bodewig@apache.org", "creation_time": "2008-10-15T08:17:05Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "creator": "marksalter@talktalk.net", "is_private": false, "text": "(In reply to comment #8)\n> Mark could probably be even more enlightened by changing the tests ti AntUnit\n> tests ;-) - just kidding.\n8)\n\n> \n> Mark, did you try Matt's suggested workaround of adding an empty string\n> resource to the nested resources?\n> \nI did and it works with 1.7.0 and 1.7.1 (the two version I have to hand)\n\nI made the string a comment (<string value=\"// avoid an empty file\" />).\n\n\n\n\n\n", "id": 121549, "time": "2008-10-15T08:36:25Z", "bug_id": 46010, "creation_time": "2008-10-15T08:36:25Z", "attachment_id": null}, {"count": 10, "tags": [], "creator": "mbenson@apache.org", "is_private": false, "text": "(In reply to comment #8)\n> I didn't mean to blame you, Matt, just verified that this is indeed a\n> regression, sorry.\n> \n\nI know you didn't, but hey--blame away!  After all, I did it!  :D\n\n> Mark could probably be even more enlightened by changing the tests ti AntUnit\n> tests ;-) - just kidding.\n\nActually there are some antunit tests for concat.\n\n> \n> Mark, did you try Matt's suggested workaround of adding an empty string\n> resource to the nested resources?\n> \n\n", "id": 121555, "time": "2008-10-15T10:20:08Z", "bug_id": 46010, "creation_time": "2008-10-15T10:20:08Z", "attachment_id": null}, {"count": 11, "tags": [], "creator": "bodewig@apache.org", "is_private": false, "text": "I've used ignoreEmpty with reversed meaning (and reversed default) and turned the JUnit tests into AntUnit tests with svn revision 705626.\n\nThanks!", "id": 121654, "time": "2008-10-17T07:16:42Z", "bug_id": 46010, "creation_time": "2008-10-17T07:16:42Z", "attachment_id": null}]
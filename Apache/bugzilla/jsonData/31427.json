[{"count": 0, "tags": [], "text": "When building 2.0.51 on FreeBSD 4.8, I get an error during make if I attempt to\ninclude the LDAP module as an SO. Here is my configure:\n\nexport CPPFLAGS=\"-I/usr/local/include\"\nexport LDFLAGS=\"-L/usr/local/lib\"\nexport CFLAGS=\"-DAP_UNSAFE_ERROR_LOG_UNESCAPED\"\n./configure \\\n --prefix=/usr/local/apache2  \\\n --with-mpm=worker \\\n --enable-dav \\\n --enable-dav-fs \\\n --enable-log-config \\\n --enable-authn-file \\\n --enable-authz-host \\\n --enable-authz-group \\\n --enable-authz-user \\\n --with-ldap \\\n --enable-ldap \\\n --enable-auth-ldap \\\n --enable-mods-shared=\"rewrite info worker proxy deflate mod_auth include ssl\nenv mime-magic auth_digest expires dav dav_fs ldap\"\n\nAnd here is the error:\n\n/apr-util/include -I/usr/local/include -I. -I/usr/local/src/httpd-2.0.51/os/unix\n-I/usr/local/src/httpd-2.0.51/server/mpm/prefork\n-I/usr/local/src/httpd-2.0.51/modules/http\n-I/usr/local/src/httpd-2.0.51/modules/filters\n-I/usr/local/src/httpd-2.0.51/modules/proxy\n-I/usr/local/src/httpd-2.0.51/include\n-I/usr/local/src/httpd-2.0.51/modules/generators -I/usr/include/openssl\n-I/usr/local/src/httpd-2.0.51/modules/dav/main -export-dynamic  \n-L/usr/local/lib -o httpd  modules.lo  modules/aaa/mod_access.la\nmodules/aaa/mod_auth.la modules/experimental/mod_auth_ldap.la\nmodules/loggers/mod_log_config.la modules/metadata/mod_setenvif.la\nmodules/http/mod_http.la modules/http/mod_mime.la\nmodules/generators/mod_status.la modules/generators/mod_autoindex.la\nmodules/generators/mod_asis.la modules/generators/mod_cgi.la\nmodules/mappers/mod_negotiation.la modules/mappers/mod_dir.la\nmodules/mappers/mod_imap.la modules/mappers/mod_actions.la\nmodules/mappers/mod_userdir.la modules/mappers/mod_alias.la\nmodules/mappers/mod_so.la  server/mpm/prefork/libprefork.la  server/libmain.la \nos/unix/libos.la -lz -lssl -lcrypto\n/usr/local/src/httpd-2.0.51/srclib/pcre/libpcre.la\n/usr/local/src/httpd-2.0.51/srclib/apr-util/libaprutil-0.la -lldap -llber -lgdbm\n-ldb-4.2 -lexpat -liconv /usr/local/src/httpd-2.0.51/srclib/apr/libapr-0.la -lm\n-lcrypt \nmodules/experimental/.libs/mod_auth_ldap.al(mod_auth_ldap.lo): In function\n`mod_auth_ldap_cleanup_connection_close':\nmod_auth_ldap.lo(.text+0x370): undefined reference to `util_ldap_connection_close'\nmodules/experimental/.libs/mod_auth_ldap.al(mod_auth_ldap.lo): In function\n`mod_auth_ldap_check_user_id':\nmod_auth_ldap.lo(.text+0x49d): undefined reference to `util_ldap_connection_find'\nmod_auth_ldap.lo(.text+0x58d): undefined reference to `util_ldap_connection_close'\nmod_auth_ldap.lo(.text+0x5e5): undefined reference to `util_ldap_connection_close'\nmod_auth_ldap.lo(.text+0x679): undefined reference to `util_ldap_cache_checkuserid'\nmod_auth_ldap.lo(.text+0x693): undefined reference to `util_ldap_connection_close'\nmodules/experimental/.libs/mod_auth_ldap.al(mod_auth_ldap.lo): In function\n`mod_auth_ldap_auth_checker':\nmod_auth_ldap.lo(.text+0xa17): undefined reference to `util_ldap_connection_find'\nmod_auth_ldap.lo(.text+0xcfc): undefined reference to `util_ldap_cache_compare'\nmod_auth_ldap.lo(.text+0xdda): undefined reference to `util_ldap_cache_compare'\nmod_auth_ldap.lo(.text+0xf20): undefined reference to `util_ldap_cache_comparedn'\nmod_auth_ldap.lo(.text+0x116c): undefined reference to `util_ldap_cache_compare'\n*** Error code 1\n\nStop in /usr/local/src/httpd-2.0.51.\n*** Error code 1\n\nStop in /usr/local/src/httpd-2.0.51.\n\nThis does not happen if I simply remove \"ldap\" from --enable-mods-shared and\notherwise configure exactly the same way as above.", "attachment_id": null, "bug_id": 31427, "id": 64234, "time": "2004-09-26T17:39:11Z", "creator": "david@kineticode.com", "creation_time": "2004-09-26T17:39:11Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 31427, "attachment_id": null, "text": "1) Using the Worker MPM on FreeBSD 4.X is not valid.\n\n2) That configuration will compile mod_auth_ldap staticly into Apache, but\ncompile mod_ldap as a DSO. If you want mod_ldap as a DSO, mod_auth_ldap must\nalso be compiled as a DSO.  If mod_ldap is staticly linked in, mod_authz_ldap\ncan be static *or* a DSO.\n\nSo, to fix your configuration, add auth_ldap to your --enable-mods-shared.\n\nThanks for using Apache,\n\n-Paul Querna", "id": 64355, "time": "2004-09-29T05:21:28Z", "creator": "chip@force-elite.com", "creation_time": "2004-09-29T05:21:28Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 31427, "attachment_id": null, "id": 64371, "time": "2004-09-29T17:39:50Z", "creator": "david@kineticode.com", "creation_time": "2004-09-29T17:39:50Z", "is_private": false, "text": "> 1) Using the Worker MPM on FreeBSD 4.X is not valid.\n\nYes, I know. This is my standard build script; I know that it will default to\nprefork even though I specify worker.\n\n> 2) That configuration will compile mod_auth_ldap staticly into Apache, but\n> compile mod_ldap as a DSO. If you want mod_ldap as a DSO, mod_auth_ldap must\n> also be compiled as a DSO.  If mod_ldap is staticly linked in, mod_authz_ldap\n> can be static *or* a DSO.\n>\n> So, to fix your configuration, add auth_ldap to your --enable-mods-shared.\n\nAh, of course! Thank you, I'll give that a try."}, {"count": 3, "tags": [], "bug_id": 31427, "attachment_id": null, "id": 64372, "time": "2004-09-29T17:44:44Z", "creator": "chip@force-elite.com", "creation_time": "2004-09-29T17:44:44Z", "is_private": false, "text": "No, it will try to use Worker MPM, and then some requests will fail.  If you did\nnot specify an MPM, it will default to Prefork, but since you said worker, it\nwill give you worker, even if it won't serve requests properly."}, {"count": 4, "tags": [], "bug_id": 31427, "attachment_id": null, "id": 64377, "time": "2004-09-29T18:29:28Z", "creator": "david@kineticode.com", "creation_time": "2004-09-29T18:29:28Z", "is_private": false, "text": "I only noticed a problem when I also specified --with-threads. httpd -l lists\nprefork, but not worker. I only listed worker when I passed --with-threads. This\nis consistent with the documentation in INSTALL:\n\n            * If you are building on FreeBSD, be aware that threads will\n              be disabled and the prefork MPM will be used by default,\n              as threads do not work well with Apache on FreeBSD.  If\n              you wish to try a threaded Apache on FreeBSD anyway, use\n              \"./configure --enable-threads\".\n"}]
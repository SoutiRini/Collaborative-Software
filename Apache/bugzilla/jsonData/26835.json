[{"count": 0, "attachment_id": null, "bug_id": 26835, "text": "This patch :\n-adds some readability enhancements.\n-On table display, it also adds simple ecmascript code (MSIE, Mozilla verified) for\nbrowser side table sorting.\n-status page is now valid HTML 4.01T\n\n\ndiff -u httpd-2.0.48/modules/generators/mod_status.c\nhttpd-2.0.48_perso/modules/generators/mod_status.c\n--- httpd-2.0.48/modules/generators/mod_status.c\t2003-02-03 18:31:40.000000000 +0100\n+++ httpd-2.0.48_perso/modules/generators/mod_status.c\t2004-02-10\n19:27:01.000000000 +0100\n@@ -94,6 +94,8 @@\n  *          extended STATUS is enabled) [George Burgyan/Jim J.]\n  * 10.8.98  Allow for extended status info at runtime (no more STATUS)\n  *          [Jim J.]\n+ * 10.2.04  Readibility Enhancements, now HTML 4.01T, table sorting\n+ *          [Francois Cartegnie]\n  */\n \n #define CORE_PRIVATE\n@@ -388,10 +390,78 @@\n                                ap_scoreboard_image->global->restart_time);\n \n     if (!short_report) {\n-        ap_rputs(DOCTYPE_HTML_3_2\n-                 \"<html><head>\\n<title>Apache Status</title>\\n</head><body>\\n\",\n-                 r);\n-        ap_rputs(\"<h1>Apache Server Status for \", r);\n+\tap_rputs(DOCTYPE_HTML_4_0T\n+\t\t \"<html><head>\\n<title>Apache Status for \", r);\n+\tap_rvputs(r, ap_get_server_name(r), \"</title>\\n\", NULL);\n+\t\n+\t    if (!no_table_report) {\n+\t\tap_rputs(\"<STYLE TYPE=\\\"text/css\\\"><!-- \\n\\\n+\t\t\tBODY,TD,TH,P{font-family: Verdana, Arial, Helvetica, sans-serif;font-size:\n10pt;}\\n\\\n+\t\t\tTD {background:#FFFFFF; padding:2px;}\\n\\\n+\t\t\tPRE {font-family: Courier, Courier New; letter-spacing:2pt;}\\n\\\n+\t\t\tTH.tab {text-align:center; text-decoration: underline; font-weight:\nbold;border:none;}\\n\\\n+\t\t\tTH.tab:hover {text-decoration: none; cursor:pointer;}\\n\\\n+\t\t\tTABLE.stats {background:#F0F0F0; text-decoration: none; width:100%;}\\n\\\n+\t\t\tTD.numeric {text-align:right;}\\n\\\n+\t\t\tTD.centered {text-align:center;}\\n\\\n+\t\t\t//--></STYLE>\\n\",r);\n+\t\t\t\n+\n+\t\t\tap_rputs(\"<script type=\\\"text/javascript\\\"><!--\\n\\\n+\t\t\tvar _lastHeader = null;\\n\\\n+\t\t\tfunction container(cells, htmlContent) {\\n\\\n+\t\t\t\tthis.cells = cells;\\n\\\n+\t\t\t\tthis.htmlContent = htmlContent;\\n\\\n+\t\t\t}\\n\\\n+\t\t\tfunction textSortFunction(a,b) {\\n\\\n+\t\t\t\tvar _toreturn;\\n\\\n+\t\t\t\tif (a.htmlContent.toUpperCase() < b.htmlContent.toUpperCase()) _toreturn =\n-1;\\n\\\n+\t\t\t\telse\\n\\\n+\t\t\t\tif (a.htmlContent.toUpperCase() > b.htmlContent.toUpperCase()) _toreturn =\n1;\\n\\\n+\t\t\t\telse\\n\\\n+\t\t\t\t_toreturn = 0;\\n\\\n+\t\t\t\t\\n\\\n+\t\t\t\tif (_reverse) return (_toreturn * -1);\\n\\\n+\t\t\t\telse return _toreturn;\\n\\\n+\t\t\t}\\n\\\n+\t\t\tfunction numericSortFunction(a,b) {\\n\\\n+\t\t\t\tvar _toreturn;\\n\\\n+\t\t\t\tif (parseFloat(a.htmlContent) < parseFloat(b.htmlContent)) _toreturn =  1;\\n\\\n+\t\t\t\telse\\n\\\n+\t\t\t\tif (parseFloat(a.htmlContent) > parseFloat(b.htmlContent)) _toreturn = -1;\\n\\\n+\t\t\t\telse\\n\\\n+\t\t\t\t_toreturn = 0;\\n\\\n+\t\t\t\t\\n\\\n+\t\t\t\tif (_reverse) return (_toreturn * -1);\\n\\\n+\t\t\t\telse return _toreturn;\\n\\\n+\t\t\t}\\n\\\n+\t\t\tfunction sortTable(target,sFunction) {\\n\\\n+\t\t\t\tvar _table = target.parentNode.parentNode;\\n\\\n+\t\t\t\tvar _containers = new Array(_table.rows.length-1);\\n\\\n+\t\t\t\tif (_lastHeader == target) _reverse = !( _reverse ); \\n\\\n+\t\t\t\telse {_reverse = false;}\\n\\\n+\t\t\t\tfor (var i=1; i<(_table.rows.length); i++)\\n\\\n+\t\t\t\t\t_containers[i-1] = new container(_table.rows.item(i).cloneNode(true),\\n\\\n+\t\t\t\t\t\t\t\t\t_table.rows.item(i).cells.item(target.cellIndex).innerHTML);\\n\\\n+\t\t\t\tif (_table.rows.length >= 1) _containers.sort(sFunction);\\n\\\n+\t\t\t\tfor (var i=0; i<(_table.rows.length-1); i++)\\n\\\n+\t\t\t\t\n_table.replaceChild(_containers[i].cells.cloneNode(true),_table.rows.item(i+1));\\n\\\n+\t\t\t\\n\\\n+\t\t\t}\\n\\\n+\t\t\tfunction numericSort(target) {\\n\\\t\t\n+\t\t\t\tsortTable(target,numericSortFunction);\\n\\\n+\t\t\t\t_lastHeader=target;\\n\\\t\n+\t\t\t\treturn 0;\\n\\\n+\t\t\t}\\n\\\n+\t\t\tfunction textSort(target) {\\n\\\n+\t\t\t\tsortTable(target,textSortFunction);\\n\\\t\t\t\t\n+\t\t\t\t_lastHeader=target;\\n\\\n+\t\t\t\treturn 0;\\n\\\n+\t\t\t}\\n\\\n+\t\t\t//--></script>\\n\", r);\n+\t    }\n+\t    \n+        ap_rputs(\"</head><body>\\n<h1>Apache Server Status for \", r);\n         ap_rvputs(r, ap_get_server_name(r), \"</h1>\\n\\n\", NULL);\n         ap_rvputs(r, \"<dl><dt>Server Version: \",\n                   ap_get_server_version(), \"</dt>\\n\", NULL);\n@@ -544,16 +614,16 @@\n         if (no_table_report)\n             ap_rputs(\"<hr /><h2>Server Details</h2>\\n\\n\", r);\n         else\n-            ap_rputs(\"\\n\\n<table border=\\\"0\\\"><tr>\"\n-                     \"<th>Srv</th><th>PID</th><th>Acc</th>\"\n-                     \"<th>M</th>\"\n-#ifdef HAVE_TIMES\n-                     \"<th>CPU\\n</th>\"\n-#endif\n-                     \"<th>SS</th><th>Req</th>\"\n-                     \"<th>Conn</th><th>Child</th><th>Slot</th>\"\n-                     \"<th>Client</th><th>VHost</th>\"\n-                     \"<th>Request</th></tr>\\n\\n\", r);\n+            ap_rputs(\"\\n\\n<table class=\\\"stats\\\" border=\\\"0\\\"><tr>\"\n+                     \"<th class=\\\"tab\\\" onClick=\\\"textSort(this);\\\">Srv</th><th\nclass=\\\"tab\\\" onClick=\\\"numericSort(this);\\\">PID</th><th class=\\\"tab\\\"\nonClick=\\\"textSort(this);\\\">Acc</th>\"\n+                     \"<th class=\\\"tab\\\" onClick=\\\"textSort(this);\\\">M</th>\"\n+#ifdef HAVE_TIMES\n+                     \"<th class=\\\"tab\\\" onClick=\\\"numericSort(this);\\\">CPU\\n</th>\"\n+#endif\n+                     \"<th class=\\\"tab\\\"\nonClick=\\\"numericSort(this);\\\">SS</th><th class=\\\"tab\\\"\nonClick=\\\"numericSort(this);\\\">Req</th>\"\n+                     \"<th class=\\\"tab\\\"\nonClick=\\\"numericSort(this);\\\">Conn</th><th class=\\\"tab\\\"\nonClick=\\\"numericSort(this);\\\">Child</th><th class=\\\"tab\\\"\nonClick=\\\"numericSort(this);\\\">Slot</th>\"\n+                     \"<th class=\\\"tab\\\"\nonClick=\\\"textSort(this);\\\">Client</th><th class=\\\"tab\\\"\nonClick=\\\"textSort(this);\\\">VHost</th>\"\n+                     \"<th class=\\\"tab\\\"\nonClick=\\\"textSort(this);\\\">Request</th></tr>\\n\\n\", r);\n \n         for (i = 0; i < server_limit; ++i) {\n             for (j = 0; j < thread_limit; ++j) {\n@@ -669,63 +739,63 @@\n                 else { /* !no_table_report */\n                     if (ws_record->status == SERVER_DEAD)\n                         ap_rprintf(r,\n-                                  \n\"<tr><td><b>%d-%d</b></td><td>-</td><td>%d/%lu/%lu\",\n+                                   \"<tr><td\nclass=\\\"numeric\\\"><b>%d-%d</b></td><td class=\\\"numeric\\\">-</td><td\nclass=\\\"numeric\\\">%d/%lu/%lu\",\n                                    i, (int)ps_record->generation,\n                                    (int)conn_lres, my_lres, lres);\n                     else\n                         ap_rprintf(r,\n-                                   \"<tr><td><b>%d-%d</b></td><td>%\"\n+                                   \"<tr><td\nclass=\\\"numeric\\\"><b>%d-%d</b></td><td class=\\\"numeric\\\">%\"\n                                    APR_PID_T_FMT\n-                                   \"</td><td>%d/%lu/%lu\",\n+                                   \"</td><td class=\\\"numeric\\\">%d/%lu/%lu\",\n                                    i, (int)ps_record->generation,\n                                    ps_record->pid, (int)conn_lres,\n                                    my_lres, lres);\n                     \n                     switch (ws_record->status) {\n                     case SERVER_READY:\n-                        ap_rputs(\"</td><td>_\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\">_\", r);\n                         break;\n                     case SERVER_STARTING:\n-                        ap_rputs(\"</td><td><b>S</b>\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\"><b>S</b>\", r);\n                         break;\n                     case SERVER_BUSY_READ:\n-                        ap_rputs(\"</td><td><b>R</b>\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\"><b>R</b>\", r);\n                         break;\n                     case SERVER_BUSY_WRITE:\n-                        ap_rputs(\"</td><td><b>W</b>\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\"><b>W</b>\", r);\n                         break;\n                     case SERVER_BUSY_KEEPALIVE:\n-                        ap_rputs(\"</td><td><b>K</b>\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\"><b>K</b>\", r);\n                         break;\n                     case SERVER_BUSY_LOG:\n-                        ap_rputs(\"</td><td><b>L</b>\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\"><b>L</b>\", r);\n                         break;\n                     case SERVER_BUSY_DNS:\n-                        ap_rputs(\"</td><td><b>D</b>\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\"><b>D</b>\", r);\n                         break;\n                     case SERVER_CLOSING:\n-                        ap_rputs(\"</td><td><b>C</b>\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\"><b>C</b>\", r);\n                         break;\n                     case SERVER_DEAD:\n-                        ap_rputs(\"</td><td>.\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\">.\", r);\n                         break;\n                     case SERVER_GRACEFUL:\n-                        ap_rputs(\"</td><td>G\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\">G\", r);\n                         break;\n                     case SERVER_IDLE_KILL:\n-                        ap_rputs(\"</td><td>I\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\">I\", r);\n                         break;\n                     default:\n-                        ap_rputs(\"</td><td>?\", r);\n+                        ap_rputs(\"</td><td class=\\\"centered\\\">?\", r);\n                         break;\n                     }\n                     \n                     ap_rprintf(r,\n                                \"\\n</td>\"\n #ifdef HAVE_TIMES\n-                               \"<td>%.2f</td>\"\n+                               \"<td class=\\\"numeric\\\">%.2f</td>\"\n #endif\n-                               \"<td>%ld</td><td>%ld\",\n+                               \"<td class=\\\"numeric\\\">%ld</td><td\nclass=\\\"numeric\\\">%ld\",\n #ifdef HAVE_TIMES\n                                (ws_record->times.tms_utime +\n                                 ws_record->times.tms_stime +\n@@ -736,16 +806,16 @@\n                                                   ws_record->last_used),\n                                (long)req_time);\n                     \n-                    ap_rprintf(r,\n\"</td><td>%-1.1f</td><td>%-2.2f</td><td>%-2.2f\\n\",\n+                    ap_rprintf(r, \"</td><td class=\\\"numeric\\\">%-1.1f</td><td\nclass=\\\"numeric\\\">%-2.2f</td><td class=\\\"numeric\\\">%-2.2f\\n\",\n                                (float)conn_bytes / KBYTE, (float) my_bytes / MBYTE,\n                                (float)bytes / MBYTE);\n                     \n                     if (ws_record->status == SERVER_BUSY_READ)\n                         ap_rprintf(r,\n-                                   \"</td><td>?</td><td nowrap>?</td><td\nnowrap>..reading.. </td></tr>\\n\\n\");\n+                                   \"</td><td class=\\\"centered\\\">?</td><td\nclass=\\\"centered\\\" nowrap>?</td><td nowrap>..reading.. </td></tr>\\n\\n\");\n                     else\n                         ap_rprintf(r,\n-                                   \"</td><td>%s</td><td nowrap>%s</td><td\nnowrap>%s</td></tr>\\n\\n\",\n+                                   \"</td><td class=\\\"centered\\\">%s</td><td\nclass=\\\"centered\\\" nowrap>%s</td><td nowrap>%s</td></tr>\\n\\n\",\n                                    ap_escape_html(r->pool,\n                                                   ws_record->client),\n                                    ap_escape_html(r->pool,", "id": 52072, "time": "2004-02-10T18:33:32Z", "creator": "bugzilla77@free.fr", "creation_time": "2004-02-10T18:33:32Z", "tags": [], "is_private": false}, {"count": 1, "text": "I don't like to embed CSS or JavaScript into C.  Perhaps it would be better if\nthe user could supply a directive to specify an external CSS or JavaScript file\nto include?", "bug_id": 26835, "is_private": false, "id": 59170, "time": "2004-06-14T06:54:05Z", "creator": "chip@force-elite.com", "creation_time": "2004-06-14T06:54:05Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 26835, "attachment_id": null, "is_private": false, "id": 59211, "time": "2004-06-15T09:08:49Z", "creator": "bugzilla77@free.fr", "creation_time": "2004-06-15T09:08:49Z", "text": "As server-status is an apache handler, it is not bound to any vhost.\nThe directive would be inclued in the handler section, which would cause\ntroubles with upgrades.\n\nIf we need to fix css or js, the user would need to upgrade manually in his vhost."}, {"count": 3, "tags": [], "bug_id": 26835, "attachment_id": 21752, "is_private": false, "id": 115189, "time": "2008-04-01T09:23:21Z", "creator": "grange@lemonde.fr", "creation_time": "2008-04-01T09:23:21Z", "text": "Created attachment 21752\nscreenshot"}, {"count": 4, "tags": [], "creator": "grange@lemonde.fr", "attachment_id": null, "id": 115190, "time": "2008-04-01T09:25:37Z", "bug_id": 26835, "creation_time": "2008-04-01T09:25:37Z", "is_private": false, "text": "I have such a patch if anyone is interested. \n\nIt adds support for ExtendedStatusCssUrl and ExtendedStatusJsUrl which both take an URL for .css or .js to include in extended status page.\n\nCSS allows for instance better highlighting of current requests.\n\nSee attached screenshot (running on my own Apache development server)."}, {"count": 5, "tags": [], "text": "I want to try your patch", "attachment_id": null, "bug_id": 26835, "id": 115201, "time": "2008-04-01T12:16:17Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-04-01T12:16:17Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 26835, "is_private": false, "id": 115226, "time": "2008-04-02T01:12:43Z", "creator": "grange@lemonde.fr", "creation_time": "2008-04-02T01:12:43Z", "tags": [], "text": "(In reply to comment #5)\n> I want to try your patch\n\nAgainst which branch?"}, {"count": 7, "tags": [], "bug_id": 26835, "attachment_id": null, "id": 115232, "time": "2008-04-02T01:45:18Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-04-02T01:45:18Z", "is_private": false, "text": "(In reply to comment #6)\n> Against which branch?\n\nI'm using 2.2"}, {"count": 8, "tags": [], "text": "Created attachment 21765\npatch adding ExtendedStatusCssUrl and ExtendedStatusJsUrl\n\nPatch:\n\n- adds ExtendedStatusCssUrl \n- adds ExtendedStatusJsUrl (I don't use it myself, but added it after reviewing this bug #)\n- makes page HTML 4.0 Transitional valid\n- corrects <title> to add server name (useful for bookmarks)\n\nQuirk: I had to correct <dl>'s use for more powerful styling, which made degraded mode (without any css) different to what extended status used to look like. If anyone is interested in commiting this patch, I'd correct this.", "is_private": false, "bug_id": 26835, "id": 115244, "time": "2008-04-02T04:26:24Z", "creator": "grange@lemonde.fr", "creation_time": "2008-04-02T04:26:24Z", "attachment_id": 21765}, {"count": 9, "tags": [], "bug_id": 26835, "attachment_id": 21766, "is_private": false, "id": 115245, "time": "2008-04-02T04:32:55Z", "creator": "grange@lemonde.fr", "creation_time": "2008-04-02T04:32:55Z", "text": "Created attachment 21766\nsample css for extended status page\n\nTo use, save into your document root and use :\n\nExtendedStatusCssUrl /server-status.css"}, {"count": 10, "tags": [], "text": "(In reply to comment #9)\n> Created an attachment (id=21766) [details]\n> sample css for extended status page\n> \n> To use, save into your document root and use :\n> \n> ExtendedStatusCssUrl /server-status.css\n> \n\n\nMight be interesting to merge both patchs.\nBut again, i'm not a fan of adding an external document call to an engine only function.", "is_private": false, "id": 115246, "creator": "bugzilla77@free.fr", "time": "2008-04-02T05:08:21Z", "bug_id": 26835, "creation_time": "2008-04-02T05:08:21Z", "attachment_id": null}, {"count": 11, "attachment_id": null, "bug_id": 26835, "text": "(In reply to comment #10)\n> But again, i'm not a fan of adding an external document call to an engine only\n> function.\n\nThere are precedents: DefaultIcon, AddIcon and AddIconByType.", "id": 115247, "time": "2008-04-02T05:35:23Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-04-02T05:35:23Z", "tags": [], "is_private": false}, {"count": 12, "tags": [], "bug_id": 26835, "text": "(In reply to comment #10)\n...\n> Might be interesting to merge both patchs.\n> But again, i'm not a fan of adding an external document call to an engine only\n> function.\n\nSeems like the easiest way for the administrator to tweak the page to fit his\nneeds though.", "id": 115248, "time": "2008-04-02T05:38:47Z", "creator": "grange@lemonde.fr", "creation_time": "2008-04-02T05:38:47Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "If the output of an external tool contains the string \"ERROR\" the build should \nfail. So the output is catched via <recorder> and evaluated with <loadfile> and \n<contains>. But <loadfile> couldnt load because the <recorder> hasnt flushed ...\n\nRunning with -debug shows that the taskFinished Event wasnt recieved.\n\nTested with \"Apache Ant version 1.7alpha compiled on July 15 2004\"\n\nDiscussion started at: http://marc.theaimsgroup.com/?l=ant-\nuser&m=109283506013782&w=2\n\nExample:\n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<project name=\"test\" basedir=\".\" default=\"myexec\">\n\n    <target name=\"myexec\">\n       <echo>Ant-Version: ${ant.version}</echo>\n       <record name=\"log.txt\" action=\"start\"/>\n       <echo message=\"ERROR\"/>\n       <record name=\"log.txt\" action=\"stop\"/>\n\n       <echo file=\"log.txt\" append=\"true\"> </echo>\n\n       <loadfile property=\"log.property\" srcfile=\"log.txt\"/>\n       <condition property=\"log.error\">\n          <contains string=\"${log.property}\" substring=\"ERROR\"/>\n       </condition>\n       <echo>File</echo>\n       <echo>============================================</echo>\n       <concat><fileset dir=\".\" includes=\"log.txt\"/></concat>\n       <echo>============================================</echo>\n       <echo>log.property = ${log.property}</echo>\n       <echo>log.error    = ${log.error}</echo>\n       <fail if=\"log.error\"/>\n    </target>\n\n</project>", "attachment_id": null, "id": 62132, "creation_time": "2004-08-18T13:59:46Z", "time": "2004-08-18T13:59:46Z", "creator": "jan@materne.de", "bug_id": 30728, "is_private": false}, {"count": 1, "tags": [], "creator": "mbenson@apache.org", "text": "Unfortunately this may be a Windows thing.  I reproduced the bug on Win2k but \nnot on Intel Solaris nor WinXP.  :(  The OS is probably behind because the \nunderlying FileOutputStream is still active.  Anyone know a good hack?", "id": 62137, "time": "2004-08-18T18:42:49Z", "bug_id": 30728, "creation_time": "2004-08-18T18:42:49Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 30728, "is_private": false, "text": "Have you tried to run in debug mode?\nThere should be the \"TASK FINISHED\" message, but I couldn't find that ...\nIf that event would be recieved all should be fine.\n\n\noata.td.RecorderEntry:0157:     public void taskFinished(BuildEvent event) {\noata.td.RecorderEntry:0158:         log(\"<<< TASK FINISHED -- \" + event.getTask\n(), Project.MSG_DEBUG);\noata.td.RecorderEntry:0159:         out.flush();\noata.td.RecorderEntry:0160:     }\n", "id": 62162, "time": "2004-08-19T05:22:38Z", "creator": "jan@materne.de", "creation_time": "2004-08-19T05:22:38Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "bodewig@apache.org", "text": "-debug doesn't affect <record>, you need to set the task's logLevel attribute.\n\nYou may be having the same problem that I stumbled upon.  <record>'s name is\nrelative to your current working directory, while <echo>, <concat> and <loadfile>\nuse the project's basedir.\n\nIn my first tests, the two have not been the same and thus <record> has been\nwriting to a different file than loadfile was reading back in.  Making sure\nboth directories are the same \"fixes\" the problem.", "id": 63956, "time": "2004-09-21T10:16:12Z", "bug_id": 30728, "creation_time": "2004-09-21T10:16:12Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 31370, "is_private": false, "id": 64063, "attachment_id": null, "creator": "sbodas@hns.com", "creation_time": "2004-09-22T16:54:13Z", "time": "2004-09-22T16:54:13Z", "text": "httpd writes following warnings to the error log:\n\n[Wed Sep 22 12:32:03 2004] [warn] (146)Connection refused: connect to listener\n[Wed Sep 22 12:32:04 2004] [warn] (146)Connection refused: connect to listener\n[Wed Sep 22 12:32:05 2004] [warn] (146)Connection refused: connect to listener\n[Wed Sep 22 12:32:06 2004] [warn] (146)Connection refused: connect to listener\n[Wed Sep 22 12:32:07 2004] [warn] (146)Connection refused: connect to listener\n[Wed Sep 22 12:32:08 2004] [warn] (146)Connection refused: connect to listener\n[Wed Sep 22 12:32:09 2004] [warn] (146)Connection refused: connect to listener\n[Wed Sep 22 12:32:10 2004] [warn] (146)Connection refused: connect to listener\n\nLooks like this happens only after a page has been served.\n\nDetails for my build are:\n\ngcc version 2.95.3 20010315 (release) on Solaris 9\n\nconfigure command:\n-----------------\n\n\"./configure\" \\\n\"--prefix=/opt/apache2ssl251\" \\\n\"--enable-so\" \\\n\"--with-ldap\" \\\n\"--enable-ssl=shared\" \\\n\"--enable-rewrite=shared\" \\\n\"--enable-auth-ldap=shared\" \\\n\"--with-ldap-sdk=netscape\" \\\n\"--with-ldap-include=/opt/ldapcsdk/lib/ldapcsdk/include/\" \\\n\"--with-ldap-lib=/opt/ldapcsdk/lib\" \\\n\"--with-ssl=/opt/openssl\" \\\n\"--disable-ipv6\" \\\n\"$@\"\n\nMPM info:\n---------\n# ./httpd -V\nServer version: Apache/2.0.51\nServer built:   Sep 22 2004 11:53:33\nServer's Module Magic Number: 20020903:9\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/prefork\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_USE_FCNTL_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/opt/apache2ssl251\"\n -D SUEXEC_BIN=\"/opt/apache2ssl251/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_LOCKFILE=\"logs/accept.lock\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\nThe website(s) works fine without any problems. I did see something in the\nChangelog for version 2.0.30 saying that this exact problem was fixed. I'm not\nusing any 3rd party modules."}, {"count": 1, "tags": [], "text": "Can you run \"truss -p\" on the parent for ~5-10 seconds and post the output here? ", "is_private": false, "id": 64065, "creator": "jorton@redhat.com", "time": "2004-09-22T19:40:51Z", "bug_id": 31370, "creation_time": "2004-09-22T19:40:51Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Here's the output of truss -p(I ran it while the error was being logged):\n\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwrite(7, \" !\", 1)                               = 1\nso_socket(PF_INET, SOCK_STREAM, IPPROTO_IP, \"\", 1) = 23\nfcntl(23, F_GETFL, 0x00000000)                  = 2\nfcntl(23, F_SETFL, 0x00000082)                  = 0\nconnect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\nwrite(8, \" [ W e d   S e p   2 2  \".., 79)      = 79\nclose(23)                                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwrite(7, \" !\", 1)                               = 1\nso_socket(PF_INET, SOCK_STREAM, IPPROTO_IP, \"\", 1) = 23\nfcntl(23, F_GETFL, 0x00000000)                  = 2\nfcntl(23, F_SETFL, 0x00000082)                  = 0\nconnect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\nwrite(8, \" [ W e d   S e p   2 2  \".., 79)      = 79\nclose(23)                                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwrite(7, \" !\", 1)                               = 1\nso_socket(PF_INET, SOCK_STREAM, IPPROTO_IP, \"\", 1) = 23\nfcntl(23, F_GETFL, 0x00000000)                  = 2\nfcntl(23, F_SETFL, 0x00000082)                  = 0\nconnect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\nwrite(8, \" [ W e d   S e p   2 2  \".., 79)      = 79\nclose(23)                                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwrite(7, \" !\", 1)                               = 1\nso_socket(PF_INET, SOCK_STREAM, IPPROTO_IP, \"\", 1) = 23\nfcntl(23, F_GETFL, 0x00000000)                  = 2\nfcntl(23, F_SETFL, 0x00000082)                  = 0\nconnect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\nwrite(8, \" [ W e d   S e p   2 2  \".., 79)      = 79\nclose(23)                                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0", "attachment_id": null, "bug_id": 31370, "id": 64067, "time": "2004-09-22T20:34:44Z", "creator": "sbodas@hns.com", "creation_time": "2004-09-22T20:34:44Z", "is_private": false}, {"count": 3, "tags": [], "text": "Sorry I forgot Solaris truss was not useful by default.  Can you do it again with:\n\n  truss -vall -p <pid>\n\nneed to work out what the parent is trying to connect() to.", "attachment_id": null, "bug_id": 31370, "id": 64069, "time": "2004-09-22T21:09:04Z", "creator": "jorton@redhat.com", "creation_time": "2004-09-22T21:09:04Z", "is_private": false}, {"count": 4, "tags": [], "text": "No problem. The new output is below. BTW, I should have mentioned this earlier,\nI'm also using the Solaris NCA module. Not sure if that would make a difference.\n\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwrite(7, \" !\", 1)                               = 1\nso_socket(PF_INET, SOCK_STREAM, IPPROTO_IP, \"\", 1) = 23\nfcntl(23, F_GETFL, 0x00000000)                  = 2\nfcntl(23, F_SETFL, 0x00000082)                  = 0\nconnect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\n        AF_INET  name = 0.0.0.0  port = 80\nwrite(8, \" [ W e d   S e p   2 2  \".., 79)      = 79\nclose(23)                                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\n      siginfo: SIGCLD CLD_EXITED pid=1372 status=0x0000\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\n      siginfo: SIG#0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwrite(7, \" !\", 1)                               = 1\nso_socket(PF_INET, SOCK_STREAM, IPPROTO_IP, \"\", 1) = 23\nfcntl(23, F_GETFL, 0x00000000)                  = 2\nfcntl(23, F_SETFL, 0x00000082)                  = 0\nconnect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\n        AF_INET  name = 0.0.0.0  port = 80\nwrite(8, \" [ W e d   S e p   2 2  \".., 79)      = 79\nclose(23)                                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\n      siginfo: SIG#0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwrite(7, \" !\", 1)                               = 1\nso_socket(PF_INET, SOCK_STREAM, IPPROTO_IP, \"\", 1) = 23\nfcntl(23, F_GETFL, 0x00000000)                  = 2\nfcntl(23, F_SETFL, 0x00000082)                  = 0\nconnect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\n        AF_INET  name = 0.0.0.0  port = 80\nwrite(8, \" [ W e d   S e p   2 2  \".., 79)      = 79\nclose(23)                                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\n      siginfo: SIG#0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwrite(7, \" !\", 1)                               = 1\nso_socket(PF_INET, SOCK_STREAM, IPPROTO_IP, \"\", 1) = 23\nfcntl(23, F_GETFL, 0x00000000)                  = 2\nfcntl(23, F_SETFL, 0x00000082)                  = 0\nconnect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\n        AF_INET  name = 0.0.0.0  port = 80\nwrite(8, \" [ W e d   S e p   2 2  \".., 79)      = 79\nclose(23)                                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\n      siginfo: SIG#0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwrite(7, \" !\", 1)                               = 1\nso_socket(PF_INET, SOCK_STREAM, IPPROTO_IP, \"\", 1) = 23\nfcntl(23, F_GETFL, 0x00000000)                  = 2\nfcntl(23, F_SETFL, 0x00000082)                  = 0\nconnect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\n        AF_INET  name = 0.0.0.0  port = 80\nwrite(8, \" [ W e d   S e p   2 2  \".., 79)      = 79\nclose(23)                                       = 0\nwaitid(P_ALL, 0, 0xFFBFF8D8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0\n      siginfo: SIG#0\npoll(0xFFBFF9C0, 0, 1000)                       = 0\nwrite(7, \" !\", 1)                               = 1\nso_socket(PF_INET, SOCK_STREAM, IPPROTO_IP, \"\", 1) = 23\nfcntl(23, F_GETFL, 0x00000000)                  = 2\nfcntl(23, F_SETFL, 0x00000082)                  = 0\nconnect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\n        AF_INET  name = 0.0.0.0  port = 80\nwrite(8, \" [ W e d   S e p   2 2  \".., 79)      = 79\nclose(23)", "is_private": false, "bug_id": 31370, "id": 64077, "time": "2004-09-22T22:13:48Z", "creator": "sbodas@hns.com", "creation_time": "2004-09-22T22:13:48Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "connect(23, 0x000DBFCC, 16, 1)                  Err#146 ECONNREFUSED\n        AF_INET  name = 0.0.0.0  port = 80\n\nOK, well a connect to 0.0.0.0 on port 80 is being refused.  What Listen\nstatements do you have?", "is_private": false, "bug_id": 31370, "id": 64091, "time": "2004-09-23T08:46:03Z", "creator": "jorton@redhat.com", "creation_time": "2004-09-23T08:46:03Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 31370, "text": "I have\n\nListen    80\n\nI also tried the IP address of the host - something like\n\nListen    x.x.x.x:80\n\nbut it didn't make a difference.", "id": 64112, "time": "2004-09-23T16:17:25Z", "creator": "sbodas@hns.com", "creation_time": "2004-09-23T16:17:25Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 31370, "attachment_id": null, "id": 64123, "time": "2004-09-23T19:35:52Z", "creator": "jorton@redhat.com", "creation_time": "2004-09-23T19:35:52Z", "is_private": false, "text": "Err, that NCA thing looks like an in-kernel HTTP accelerator.  Obvious question,\nbut if you turn it off, do the warnings stop?"}, {"count": 8, "tags": [], "text": "My bad, disabling NCA stopped the errors. Any guidelines?", "attachment_id": null, "id": 64137, "creator": "sbodas@hns.com", "time": "2004-09-23T22:22:24Z", "bug_id": 31370, "creation_time": "2004-09-23T22:22:24Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 31370, "text": "You need to work out how to configure NCA to not prevent connections to\n0.0.0.0:80 on the lo0 interface.  Or ask Sun...", "id": 64254, "attachment_id": null, "creator": "jorton@redhat.com", "creation_time": "2004-09-27T08:40:31Z", "time": "2004-09-27T08:40:31Z", "is_private": false}]
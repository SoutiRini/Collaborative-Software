[{"attachment_id": null, "tags": [], "creator": "wtff@freenet.de", "text": "I installed JDK 1.4 and tried out both versions of tomcat 4.0.2 final - the \nusual one and the one for jdk1.4\n\nEverything works fine. I can use the Manager webapp in its usual mode, but if I \nrun it using the HTMLManagerServlet then I get the following exception when I \ntry to access the webapp with my browser.\nWell, this could be a bug within the jdk, since the HTMLManager runs fine on \njdk1.3. Nonetheless I wanted to report this behaviour to you.\n\nUsing CATALINA_BASE:   C:\\java\\tomcat_jdk14\nUsing CATALINA_HOME:   C:\\java\\tomcat_jdk14\nUsing CATALINA_TMPDIR: C:\\java\\tomcat_jdk14\\temp\nUsing JAVA_HOME:       C:\\java\\jdk140\nStarting service Tomcat-Standalone\nApache Tomcat/4.0.2\njava.lang.IllegalStateException: Current state = FLUSHED, new state = CODING_END\n\n        at java.nio.charset.CharsetEncoder.throwIllegalStateException(CharsetEnc\noder.java:933)\n        at java.nio.charset.CharsetEncoder.encode(CharsetEncoder.java:529)\n        at sun.nio.cs.StreamEncoder$CharsetSE.flushLeftoverChar(StreamEncoder.ja\nva:356)\n        at sun.nio.cs.StreamEncoder$CharsetSE.implClose(StreamEncoder.java:413)\n        at sun.nio.cs.StreamEncoder.close(StreamEncoder.java:158)\n        at java.io.OutputStreamWriter.close(OutputStreamWriter.java:222)\n        at java.io.PrintWriter.close(PrintWriter.java:137)\n        at org.apache.catalina.connector.ResponseBase.finishResponse(ResponseBas\ne.java:482)\n        at org.apache.catalina.connector.HttpResponseBase.finishResponse(HttpRes\nponseBase.java:236)\n        at org.apache.catalina.connector.http.HttpResponseImpl.finishResponse(Ht\ntpResponseImpl.java:288)\n        at org.apache.catalina.connector.http.HttpProcessor.process(HttpProcesso\nr.java:1039)\n        at org.apache.catalina.connector.http.HttpProcessor.run(HttpProcessor.ja\nva:1107)\n        at java.lang.Thread.run(Thread.java:536)", "count": 0, "id": 10846, "time": "2002-02-18T09:51:32Z", "bug_id": 6519, "creation_time": "2002-02-18T09:51:32Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 6519, "text": "it seems there is a problem with the request.getWriter() and the \nrequest.sendRedirect() method.\nwhen accessing the manager via manager/list everything works fine.", "id": 10853, "time": "2002-02-18T12:31:33Z", "creator": "j.schwoerer@web.de", "creation_time": "2002-02-18T12:31:33Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 6519, "text": "This works for me, using the final release version of JDK 1.4.  Could you \nconfirm this is the version you were using?  Is there any chance that you have \ncharacters in your context paths that will not encode correctly in the \nISO-8859-1 character encoding?\n", "id": 10870, "time": "2002-02-19T02:42:53Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2002-02-19T02:42:53Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 6519, "attachment_id": null, "is_private": false, "id": 10873, "time": "2002-02-19T08:01:32Z", "creator": "j.schwoerer@web.de", "creation_time": "2002-02-19T08:01:32Z", "text": "I made a \"clean\" install of jdk1.4 final (meaning uninstalling the old jdk \nthen installing the new).\nIn my context paths are no special characters.\nThe problem is in my opinion that you get the PrintWriter of the response and \nafter that try to send a redirect, which does no longer work (for me) with \njdk1.4.\nIf you access the manager via manager/list there is no need for a redirect and \neverything is ok."}, {"count": 4, "tags": [], "creator": "remm@apache.org", "text": "As far as I am concerned, it is a JDK bug (and I suppose it only happens on\nWindows).", "id": 10874, "time": "2002-02-19T08:11:44Z", "bug_id": 6519, "creation_time": "2002-02-19T08:11:44Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "j.schwoerer@web.de", "text": "Workaround:\nI solved the problem with the following code change in method doGet():\n\nPrintWriter writer = null;\n\nif (command == null) {\n\tresponse.sendRedirect(request.getRequestURI()+\"/list\");\n}\nelse {\n\twriter = response.getWriter();\n\n\t// Process the requested command\n\tif (command == null) {\n\t\tresponse.sendRedirect(request.getRequestURI()+\"/list\");\n\t} else if (command.equals(\"/install\")) {\n\t\tinstall(writer, path, war);\n\t} else if (command.equals(\"/list\")) {\n\t\tlist(writer);\n\t} else if (command.equals(\"/reload\")) {\n\t\treload(writer, path);\n\t} else if (command.equals(\"/remove\")) {\n\t\tremove(writer, path);\n\t} else if (command.equals(\"/sessions\")) {\n\t\tsessions(writer, path);\n\t} else if (command.equals(\"/start\")) {\n\t\tstart(writer, path);\n\t} else if (command.equals(\"/stop\")) {\n\t\tstop(writer, path);\n\t} else {\n\t\twriter.println(sm.getString\n(\"managerServlet.unknownCommand\",command));\n\t}\n\n\t// Finish up the response\n\twriter.flush();\n\twriter.close();\n}\n", "id": 10875, "time": "2002-02-19T09:20:17Z", "bug_id": 6519, "creation_time": "2002-02-19T09:20:17Z", "tags": [], "is_private": false}, {"count": 6, "attachment_id": null, "creator": "remm@apache.org", "is_private": false, "id": 11059, "time": "2002-02-21T21:10:56Z", "bug_id": 6519, "creation_time": "2002-02-21T21:10:56Z", "tags": [], "text": "*** Bug 6623 has been marked as a duplicate of this bug. ***"}, {"count": 7, "tags": [], "bug_id": 6519, "text": "Reopening for additional investigation. The proposed fix (which I won't apply\nsince no workaround should be needed) could point out to the fact that the\nwriter may be incorrectly closed, although that won't explain why the \"fully\ncompatible\" JDK 1.4 doesn't behave like 1.3.", "id": 11061, "time": "2002-02-21T22:02:21Z", "creator": "remm@apache.org", "creation_time": "2002-02-21T22:02:21Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 6519, "is_private": false, "text": "This worked fine for me with Tomcat 4.0.1 and the JDK 1.4 Beta 3 on Linux 7.1. \nI upgraded to Tomcat 4.0.2 final and JDK 1.4.0 final at the same time, and then \nthe problem started. \n\nPerhaps this bug was introduced in the JDK 1.4 release candidate or the JDK \n1.4.0 final release.", "id": 11063, "time": "2002-02-21T22:12:56Z", "creator": "nvick@capcollege.bc.ca", "creation_time": "2002-02-21T22:12:56Z", "attachment_id": null}, {"count": 9, "tags": [], "creator": "remm@apache.org", "is_private": false, "id": 11069, "attachment_id": null, "bug_id": 6519, "creation_time": "2002-02-21T22:26:28Z", "time": "2002-02-21T22:26:28Z", "text": "I don't know yet, but you shouldn't use 1.4B3 with Tomcat 4.0 (don't know about\nother versions, but there could be similar problems). There are *lots* of very\ninsidious problems with it which have no workarounds (class loading, mostly) :-("}, {"count": 10, "tags": [], "bug_id": 6519, "text": "I'll mark it as fixed, as the new HTTP/1.1 connector fixes it, mostly by\nabstracting the output handling and using fake writers.", "id": 11616, "time": "2002-03-09T23:33:29Z", "creator": "remm@apache.org", "creation_time": "2002-03-09T23:33:29Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 6519, "is_private": false, "text": "*** Bug 7725 has been marked as a duplicate of this bug. ***", "id": 12825, "time": "2002-04-04T21:27:19Z", "creator": "remm@apache.org", "creation_time": "2002-04-04T21:27:19Z", "attachment_id": null}]
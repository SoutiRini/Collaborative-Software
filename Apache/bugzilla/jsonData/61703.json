[{"count": 0, "tags": [], "bug_id": 61703, "text": "Hi Team,\n\nAlthough the reproduction procedure is unknown, Excel export fails with the following exception being output. \n\n2017-10-27 21:23:21,867 Caesium-1-4 INFO ServiceRunner     [c.a.j.p.h.service.connect.InstallGlancesJobHandler] There is no link to HipChat, no need to install glances.\n2017-10-27 21:34:48,669 http-nio-8081-exec-17 ERROR      [o.a.c.c.C.[.[localhost].[/jira].[default]] Servlet.service() for servlet [default] in context with path [/jira] threw exception\norg.apache.poi.openxml4j.exceptions.OpenXML4JRuntimeException: Fail to save: an error occurs while saving the package : The part /docProps/core.xml fail to be saved in the stream with marshaller org.apache.poi.openxml4j.opc.internal.marshallers.ZipPackagePropertiesMarshaller@5c5d22d0\n        at org.apache.poi.openxml4j.opc.ZipPackage.saveImpl(ZipPackage.java:602)\n        at org.apache.poi.openxml4j.opc.OPCPackage.save(OPCPackage.java:1557)\n        at org.apache.poi.POIXMLDocument.write(POIXMLDocument.java:248)\n        at jp.ricksoft.plugins.wbsgantt_excel.xl.XLSXGenerator.writeTo(XLSXGenerator.kt:45)\n        at jp.ricksoft.plugins.wbsgantt.export.XLSXWriter.writeTo(XLSXWriter.kt:25)\n        at jp.ricksoft.plugins.wbsgantt.export.XLSXWriter.writeTo(XLSXWriter.kt:15)\n        at com.sun.jersey.spi.container.ContainerResponse.write(ContainerResponse.java:302)\n        ... 5 filtered\n        at com.atlassian.plugins.rest.module.RestDelegatingServletFilter$JerseyOsgiServletContainer.doFilter(RestDelegatingServletFilter.java:154)\n        ... 1 filtered\n        at com.atlassian.plugins.rest.module.RestDelegatingServletFilter.doFilter(RestDelegatingServletFilter.java:68)\n        ... 33 filtered\n        at com.atlassian.servicedesk.internal.web.OperationalStatusAwareHttpFilter.doFilter(OperationalStatusAwareHttpFilter.java:31)\n        ... 8 filtered\n        at com.atlassian.web.servlet.plugin.request.RedirectInterceptingFilter.doFilter(RedirectInterceptingFilter.java:21)\n        ... 53 filtered\n        at com.atlassian.jira.security.JiraSecurityFilter.lambda$doFilter$0(JiraSecurityFilter.java:76)\n        at com.atlassian.jira.security.JiraSecurityFilter$$Lambda$655/1940324629.doFilter(Unknown Source)\n        ... 1 filtered\n        at com.atlassian.jira.security.JiraSecurityFilter.doFilter(JiraSecurityFilter.java:74)\n        ... 16 filtered\n        at com.atlassian.plugins.rest.module.servlet.RestSeraphFilter.doFilter(RestSeraphFilter.java:37)\n        ... 20 filtered\n        at com.atlassian.jira.servermetrics.CorrelationIdPopulatorFilter.doFilter(CorrelationIdPopulatorFilter.java:30)\n        ... 5 filtered\n        at com.atlassian.servicedesk.internal.web.CustomerContextSettingFilter.lambda$invokeFilterChain$0(CustomerContextSettingFilter.java:181)\n        at com.atlassian.servicedesk.internal.web.CustomerContextSettingFilter$$Lambda$1021/1377745274.call(Unknown Source)\n        at com.atlassian.servicedesk.internal.utils.context.ReentrantThreadLocalBasedCodeContext.rteInvoke(ReentrantThreadLocalBasedCodeContext.java:142)\n        at com.atlassian.servicedesk.internal.utils.context.ReentrantThreadLocalBasedCodeContext.runOutOfContext(ReentrantThreadLocalBasedCodeContext.java:94)\n        at com.atlassian.servicedesk.internal.utils.context.CustomerContextServiceImpl.runOutOfCustomerContext(CustomerContextServiceImpl.java:64)\n        at com.atlassian.servicedesk.internal.web.CustomerContextSettingFilter.outOfCustomerContext(CustomerContextSettingFilter.java:174)\n        at com.atlassian.servicedesk.internal.web.CustomerContextSettingFilter.doFilterImpl(CustomerContextSettingFilter.java:130)\n        at com.atlassian.servicedesk.internal.web.CustomerContextSettingFilter.doFilter(CustomerContextSettingFilter.java:121)\n        ... 4 filtered\n        at com.atlassian.jwt.internal.servlet.JwtAuthFilter.doFilter(JwtAuthFilter.java:32)\n        ... 8 filtered\n        at com.atlassian.web.servlet.plugin.request.RedirectInterceptingFilter.doFilter(RedirectInterceptingFilter.java:21)\n        ... 4 filtered\n        at com.atlassian.web.servlet.plugin.LocationCleanerFilter.doFilter(LocationCleanerFilter.java:36)\n        ... 29 filtered\n        at com.atlassian.jira.servermetrics.MetricsCollectorFilter.doFilter(MetricsCollectorFilter.java:25)\n        ... 27 filtered\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.apache.poi.openxml4j.exceptions.OpenXML4JException: The part /docProps/core.xml fail to be saved in the stream with marshaller org.apache.poi.openxml4j.opc.internal.marshallers.ZipPackagePropertiesMarshaller@5c5d22d0\n        at org.apache.poi.openxml4j.opc.ZipPackage.saveImpl(ZipPackage.java:582)\n        ... 245 more\n2017-10-27 22:23:19,293 Caesium-1-3 INFO ServiceRunner     [c.a.j.p.h.service.ping.RefreshConnectionStatusJobHandler] Running RefreshConnectionStatusJobHandler...\n\n\nApache POI 3.15\nServer version: Apache Tomcat/8.0.38\nServer built:   Oct 6 2016 20:51:55 UTC\nServer number:  8.0.38.0\nOS Name:        Linux\nOS Version:     2.6.32-358.el6.x86_64\nArchitecture:   amd64\nJVM Version:    1.8.0_25-b17\nJVM Vendor:     Oracle Corporation\n\n\nI found the following bug report, but I do not know how to reproduce it in detail or how to handle it, so please let me know.\n\nhttp://apache-poi.1045710.n5.nabble.com/Fail-to-save-stream-td5723711.html\n\nBest regards,\nRyosuke Kumai", "id": 201814, "attachment_id": null, "creator": "kumai@ricksoft.jp", "creation_time": "2017-10-31T11:09:48Z", "time": "2017-10-31T11:09:48Z", "is_private": false}, {"count": 1, "tags": [], "creator": "onealj@apache.org", "text": "Relevant portions of the stack trace:\n> org.apache.poi.openxml4j.exceptions.OpenXML4JRuntimeException: Fail to save: an\n> error occurs while saving the package : The part /docProps/core.xml fail to be \n> saved in the stream with marshaller \n> org.apache.poi.openxml4j.opc.internal.marshallers.ZipPackagePropertiesMarshaller@5c5d22d0\n>         at org.apache.poi.openxml4j.opc.ZipPackage.saveImpl(ZipPackage.java:602)\n>         at org.apache.poi.openxml4j.opc.OPCPackage.save(OPCPackage.java:1557)\n>         at org.apache.poi.POIXMLDocument.write(POIXMLDocument.java:248)\n> \n> Caused by: org.apache.poi.openxml4j.exceptions.OpenXML4JException: The part\n> /docProps/core.xml fail to be saved in the stream with marshaller \n> org.apache.poi.openxml4j.opc.internal.marshallers.ZipPackagePropertiesMarshaller@5c5d22d0\n>         at org.apache.poi.openxml4j.opc.ZipPackage.saveImpl(ZipPackage.java:582)\n>         ... 245 more\n\nFrom the stack trace, this error occurred while saving an OOXML file.\n\n(In reply to Andrei Ivanov from POI Users mailing list)\n> I have a hunch that the http request just gets aborted/reset so the\n> output stream just gets closed. \n\n> I'll probably wait for the next release to include it in our next\n> release and then I'll follow the logs.\n\nHave you looked into either of these?\nAre you able to check if your output stream is getting closed before POI can finish writing to it?\nDo you have any logs to indicate what is happening on this platform?\nIs this repeatable?\nHow many times are you writing out the workbook?\nAre you able to write out the workbook to a ByteArrayOutputStream and then write that BAOS to the desired OutputStream? This would help you figure out if the problem is with POI or with the output stream getting closed unexpectedly.\n\nclass XLSXGenerator {\n    void writeTo(XSSFWorkbook workbook, OutputStream out) {\n        try (OutputStream baos = new ByteArrayOutputStream(8192)) {\n            try {\n                workbook.write(baos);\n            } finally {\n                workbook.close();\n            }\n            baos.writeTo(out);\n        }\n    }\n}", "id": 201816, "time": "2017-10-31T11:28:00Z", "bug_id": 61703, "creation_time": "2017-10-31T11:28:00Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 61703, "text": "Couldn't reproduce and no answer to questions for some time, thus closing this as WORKSFORME for now, please reopen with more information if this is still a problem for you.\n\nI also reviewed the code and did not see any exception swallowing taking place, so as far as I see the exception handling already provides everything that we can on the side of the library.", "id": 202936, "time": "2017-12-27T21:27:06Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2017-12-27T21:27:06Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "niall.pemberton@blueyonder.co.uk", "text": "I've had a couple of problems trying to use HSSFSheet.cloneSheet(int)\n\nI'll attach a patch if I can work out how to.\n\n1) Some of the formula Ptg records can have one of three different id's - this \nis done by setting the ptgClass. The clone() methods of the relevant classes do \nnot copy the ptgClass when cloning the object. I had problems with ReferencePtg \nand FuncVarPtg.\n\nFrom a quick scan the classes affected are Area3DPtg, AreaPtg, FuncPtg, \nFuncVarPtg, NamePtg, NameXPtg, Ref3DPtg and ReferencePtg (I'm ignoring \nMemErrPtg).\n\n2) PasswordRecord and ContinueRecord do not implement the clone() method.", "id": 39298, "time": "2003-06-23T19:55:16Z", "bug_id": 21027, "creation_time": "2003-06-23T19:55:16Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 21027, "attachment_id": 6944, "text": "Created attachment 6944\nPatch to correct cloning issues", "id": 39299, "time": "2003-06-23T19:56:49Z", "creator": "niall.pemberton@blueyonder.co.uk", "creation_time": "2003-06-23T19:56:49Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 21027, "attachment_id": 6981, "id": 39444, "time": "2003-06-25T22:34:14Z", "creator": "niall.pemberton@blueyonder.co.uk", "creation_time": "2003-06-25T22:34:14Z", "is_private": false, "text": "Created attachment 6981\nReplacement Patch with additional bug fix"}, {"count": 3, "text": "Thanks, will add them in soon", "creator": "avik@apache.org", "attachment_id": null, "id": 39446, "time": "2003-06-25T22:39:18Z", "bug_id": 21027, "creation_time": "2003-06-25T22:39:18Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "text": "I probably should have given a better description of the problems this caused.\n\nBecause these classes were not cloning the ptgClass attribute, when the \nspreadsheet is opened in Excel the cells with the affected functions have \n#VALUE! errors.\n\nI have also just uploaded another patch, which has all the original changes \nplus the following changes to the FunctionRecord class:\n\n1) data_value is not being copied in FunctionRecord.clone(). This causes a \nproblem when the result is a \"Empty\" cell - openning the file in Excel causes a \nmessage \"File Error: data may have been lost\" to be displayed. In actual fact \nNothing had been lost and saving the file sorted this out - doesn't look good \nto the users though.\n\n2) When the calculated value of a Formula is not a number the \nFormulaRecord.toString() just shows \"NaN\" - however the 8 bytes contain \nimportant information. When I used biffviewer, it took me a long time to work \nout the above problem because I couldn't see it. I have changed the toString() \nto display a hex dump if its not a number.\n\nI was just typing this in when you said your going to apply them - thanks much \nappreciated.\n\nNiall", "is_private": false, "bug_id": 21027, "id": 39450, "time": "2003-06-25T22:51:18Z", "creator": "niall.pemberton@blueyonder.co.uk", "creation_time": "2003-06-25T22:51:18Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 21027, "attachment_id": null, "id": 39751, "time": "2003-07-01T14:50:07Z", "creator": "avik@apache.org", "creation_time": "2003-07-01T14:50:07Z", "is_private": false, "text": "Whats functionrecord? do you mean formularecord? And why is that a problem with\nan empty cell? \n\nOther than that, the patch itself seems fine, so i am applying now!"}, {"count": 6, "tags": [], "creator": "niall.pemberton@blueyonder.co.uk", "text": "Sorry, yes it should have been \"FormulaRecord\" not \"FunctionRecord\".\n\nThe data_value contains the results of the formula which is either 1) a number \n2) an identifier for a String value (and a String record should follow) 3) a \nboolean value or 4) an identifier for an \"empty cell\".\n\nWhen the result of the formula is an \"empty cell\" and the indicator (which is \nin data_value) is not cloned I got the message \"File Error: data may have been \nlost\" when opening the file using excel.\n\nSo my patch (which was simply adding a line in the clone() method to copy the \ndata_value contents) sorted this out.\n\nThanks for applying the patch, much appreciated.\n\nNiall", "id": 39778, "time": "2003-07-01T16:39:46Z", "bug_id": 21027, "creation_time": "2003-07-01T16:39:46Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 21027, "is_private": false, "count": 7, "id": 39781, "time": "2003-07-01T18:27:14Z", "creator": "avik@apache.org", "creation_time": "2003-07-01T18:27:14Z", "text": "Thanks for the explanation... but \"empty cell\" as a formula result, can you give\nan example... will help me cook up a testcase for later!"}]
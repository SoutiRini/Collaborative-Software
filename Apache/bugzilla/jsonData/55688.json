[{"count": 0, "tags": [], "creator": "vickymcs@gmail.com", "attachment_id": 30951, "text": "Created attachment 30951\nSample war file which can help reproduce the issue.\n\nHi,\n\nI recently moved from Tomcat 7.0.32 to 7.0.42. One of my application logic has stopped working since the upgrade.\n\nThe problem seems to be with using response.sendRedirect and AsyncContext. Without the AsyncContext in picture \"sendRedirect\" seems to work fine.\n\nFollow the below steps to reproduce this,\n1. Copy the attached war in to 7.0.32/Webapps\n2. Hit \"localhost:8080/Sample/test\"\n3. In some time you should get redirected to http://www.google.com\n\nDo the same steps with 7.0.42, i don't see any error/exceptions, but the request just times out i guess. To see more details, when i put a proxy tool in between, the response i got was,\nHTTP/1.1 500 Internal Server Error\nServer: Apache-Coyote/1.1\nLocation: http://www.google.com/\nTransfer-Encoding: chunked\nDate: Tue, 22 Oct 2013 08:15:03 GMT\nConnection: close\n\n0\n\nNote - I did see issue no 51197, it talks about similar issue and is marked as resolved, but it seems that the fix was only relative to \"sendError\" and not \"sendRedirect\".", "id": 170740, "time": "2013-10-22T09:03:42Z", "bug_id": 55688, "creation_time": "2013-10-22T09:03:42Z", "is_private": false}, {"count": 1, "tags": [], "creator": "vickymcs@gmail.com", "attachment_id": null, "text": "Some more details, my sample servlet \"get\" code looks like this,\n\n@Override\n\tprotected void doGet(HttpServletRequest req, HttpServletResponse response)\n\t\t\tthrows ServletException, IOException {\n\t\treq.setAttribute(\"org.apache.catalina.ASYNC_SUPPORTED\", true);\n\t\t\n\t\tAsyncContext asyncContext = req.startAsync();\n\t\tasyncContext.setTimeout(10000);\n\t\t\n\t\tHttpServletResponse httpServletResponse = (HttpServletResponse)asyncContext.getResponse();\n\t\ttry {\n\t\t\thttpServletResponse.sendRedirect(\"http://www.google.com/\");\n\t\t} catch (IOException ex) {\n\t\t\tthrow new RuntimeException(ex);\n\t\t}\n\t}", "id": 170741, "time": "2013-10-22T09:06:06Z", "bug_id": 55688, "creation_time": "2013-10-22T09:06:06Z", "is_private": false}, {"count": 2, "tags": [], "text": "This is working as designed and is triggered by the fix for bug 54123 that was made in 7.0.33. The change is listed in the change log.", "attachment_id": null, "id": 170891, "creator": "markt@apache.org", "time": "2013-10-28T20:42:35Z", "bug_id": 55688, "creation_time": "2013-10-28T20:42:35Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 55688, "attachment_id": null, "id": 170906, "time": "2013-10-29T13:42:37Z", "creator": "vickymcs@gmail.com", "creation_time": "2013-10-29T13:42:37Z", "is_private": false, "text": "Ok thanks for the bug reference. The AsyncContext was not getting closed and hence timing out, resulting into an internal server error.\n\nMarking the async context completed helped solve the issue."}]
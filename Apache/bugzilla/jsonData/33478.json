[{"count": 0, "tags": [], "text": "Apache Version: 1.3.33\nOS: Fedora Core 2\nPlatform: x86_64\n\nroot@eventhorizon [/usr/local/apache]# uname -a\nLinux eventhorizon.cpanel.net 2.6.10-1.9_FC2 #1 Thu Jan 13 17:52:29 EST 2005\nx86_64 x86_64 x86_64 GNU/Linux\n\nIt has come to our attention that mod_rewrite, with very simple and basic rules,\nare casuing apache children to hang. This has been tested so far on several\nboxes, all of which are running Fedora Core 2. The problem is quite an enigma,\nsince very small and seemingly unrelated changes to one of the rewrite rules\nwill allow normal behavior. For instance, retrieving the following URL\n\nhttp://x86-64.n3t.net/lsof.txt\n\nwith a .htaccess that looks like the following, works:\n\nRewriteEngine on \nRewriteCond %{HTTP_REFERER} !^http://x86-64.n3t.net/.*$      [NC]\nRewriteCond %{HTTP_REFERER} !^http://x86-64.n3t.net$      [NC]\nRewriteRule .*\\.(jpg|jpeg|gif|bmp)$ - [F,NC]\n\nHowever, add a png type to it and it hangs:\n\nRewriteEngine on \nRewriteCond %{HTTP_REFERER} !^http://x86-64.n3t.net/.*$      [NC]\nRewriteCond %{HTTP_REFERER} !^http://x86-64.n3t.net$      [NC]\nRewriteRule .*\\.(jpg|jpeg|gif|png|bmp)$ - [F,NC]\n\nNow for the fun stuff. Keep png in there and remove jpeg:\n\nRewriteEngine on \nRewriteCond %{HTTP_REFERER} !^http://x86-64.n3t.net/.*$      [NC]\nRewriteCond %{HTTP_REFERER} !^http://x86-64.n3t.net$      [NC]\nRewriteRule .*\\.(jpg|png|gif|bmp)$ - [F,NC]\n\nand it works again.\nI've tested with random file extenstions, made up words, etc, there is no\npattern that I can see, but it always either works or either hangs with the same\ncombination, it is not random, and is reproducible every single time.\n\nCurrently I have this test domain set with the following in .htaccess:\nRewriteEngine on \nRewriteCond %{HTTP_REFERER} !^http://x86-64.n3t.net/.*$      [NC]\nRewriteCond %{HTTP_REFERER} !^http://x86-64.n3t.net$      [NC]\nRewriteRule .*\\.(jpg|png|testing|txt|gif|bmp)$ - [F,NC]\n\nI have copied information that should prove to be at least somewhat informative\ninto text files on the test domain.\n\nhttp://x86-64.n3t.net/lsof.txt\nhttp://x86-64.n3t.net/proc_pid_fd.txt\nhttp://x86-64.n3t.net/top.txt \nhttp://x86-64.n3t.net/strace0.txt (full apachectl startssl -> hang strace, GET\nrequest starts on line 4412)\n\nA few notes:\n-It does not matter if apache is start with SSL enabled or not.\n-This occurs using telnet domain.tld 80 and only giving the GET /request\nHTTP/1.1 and Host: x86-64.n3t.net\n-It does not matter what what the domain.tld is.\n-Setting RewriteEngine to \"off\" in .htaccess allows normal apache operation\n-access.conf and srm.conf can be empty, with no changes in this behavior.\n-There are no .htaccess files anywhere in the path before the last one we are\nworking with.\n-Only happens on boxes with x86_64 libraries, only verified on FC2 boxes (we\nhave no others to test with)\n-This does NOT hang apache entirely, only the children processes trying to\nhandle the GET request. Other GET,HEAD requests work just fine.\n\nIf a developer believes they can figure this out and it would help, I can most\nlikely grant root access to a live test server for debugging with everything in\nplace to reproduce the behavior.", "is_private": false, "id": 70717, "creation_time": "2005-02-09T23:55:01Z", "time": "2005-02-09T23:55:01Z", "creator": "darren@cpanel.net", "bug_id": 33478, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 33478, "attachment_id": null, "id": 70738, "time": "2005-02-10T10:24:21Z", "creator": "jorton@redhat.com", "creation_time": "2005-02-10T10:24:21Z", "is_private": false, "text": "Likely to be the regex issues from bug 31858; try the patch:\n\nhttp://issues.apache.org/bugzilla/attachment.cgi?id=13337\n\n*** This bug has been marked as a duplicate of 31858 ***"}, {"count": 2, "tags": [], "creator": "darren@cpanel.net", "attachment_id": null, "is_private": false, "id": 70752, "time": "2005-02-10T14:08:39Z", "bug_id": 33478, "creation_time": "2005-02-10T14:08:39Z", "text": "The suggested patch *does* appear to fix this problem for all tested servers so far.\nMany thanks and sorry I wasn't able to make the relation between what we were\nseeing and the original ticket."}]
[{"count": 0, "tags": [], "bug_id": 40156, "attachment_id": null, "id": 91777, "creation_time": "2006-08-01T19:20:37Z", "time": "2006-08-01T19:20:37Z", "creator": "dominikschadow@gmail.com", "text": "When canonicalizing German umlauts like \u00e4 (&auml; in html) in version 1.3 with\nJava 1.5 (probably with different Java versions too). This happens when calling\nthe Canonicalizer directly, like in the three samples provided\n(CanonDirect.java, CanonSubTree.java and CanonByTransform.java). \n\nThe exact exception is\n\nException in thread \"main\" org.xml.sax.SAXParseException: Invalid byte 2 of\n3-byte UTF-8 sequence.\nat org.apache.xerces.parsers.DOMParser.parse(Unknown Source)\nat org.apache.xerces.jaxp.DocumentBuilderImpl.parse(Unknown Source)\nat javax.xml.parsers.DocumentBuilder.parse(DocumentBuilder.java:98)\nat\norg.apache.xml.security.samples.canonicalization.CanonByTransform.main(Unknown\nSource)", "is_private": false}, {"count": 1, "tags": [], "bug_id": 40156, "attachment_id": null, "text": "Can you post a simple executable code that stress the problem?\nIt will help me a lot in fixing the bug.\n\n", "id": 91779, "time": "2006-08-01T19:25:51Z", "creator": "raul-info@r-bg.com", "creation_time": "2006-08-01T19:25:51Z", "is_private": false}, {"count": 2, "tags": [], "text": "Sample code based on CanonByTransform.java. The changed \u00e4\u00f6\u00fc causes the exception.\n\nimport java.io.ByteArrayInputStream;\n\nimport javax.xml.parsers.DocumentBuilder;\nimport javax.xml.parsers.DocumentBuilderFactory;\n\nimport org.apache.xml.security.signature.XMLSignatureInput;\nimport org.apache.xml.security.transforms.Transforms;\nimport org.w3c.dom.Document;\nimport org.w3c.dom.Node;\n\npublic class CanonByTransform {\n// The \u00e4\u00f6\u00fc in line 5 causes canonicalization to fail\n   static String input = \"\"\n      + \"<!DOCTYPE doc [<!ATTLIST e9 attr CDATA \\\"default\\\">]>\\n\"\n      + \"<!-- Comment 2 --><doc><!-- comment inside -->\\n\"\n      + \"   <e1   />\\n\"\n      + \"   <e2   ></e2>\\n\"\n      + \"   <e3    name = \\\"\u00e4\u00f6\u00fc\\\"   id=\\\"elem3\\\"    />\\n\"\n      + \"   <e4    name=\\\"elem4\\\"   id=\\\"elem4\\\"    ></e4>\\n\"\n      + \"   <e5 a:attr=\\\"out\\\" b:attr=\\\"sorted\\\" attr2=\\\"all\\\" attr=\\\"I'm\\\"\\n\"\n      + \"       xmlns:b=\\\"http://www.ietf.org\\\"\\n\"\n      + \"       xmlns:a=\\\"http://www.w3.org\\\"\\n\"\n      + \"       xmlns=\\\"http://example.org\\\"/>\\n\"\n      + \"   <e6 xmlns=\\\"\\\" xmlns:a=\\\"http://www.w3.org\\\">\\n\"\n      + \"       <e7 xmlns=\\\"http://www.ietf.org\\\">\\n\"\n      + \"           <e8 xmlns=\\\"\\\" xmlns:a=\\\"http://www.w3.org\\\">\\n\"\n      + \"               <e9 xmlns=\\\"\\\" xmlns:a=\\\"http://www.ietf.org\\\"/>\\n\"\n      + \"               <text>&#169;</text>\\n\"\n      + \"           </e8>\\n\"\n      + \"       </e7>\\n\"\n      + \"   </e6>\\n\"\n      + \"</doc><!-- Comment 3 -->\\n\"\n      ;\n\n   public static void main(String args[]) throws Exception {\n      org.apache.xml.security.Init.init();\n\n      DocumentBuilderFactory dfactory = DocumentBuilderFactory.newInstance();\n\n      dfactory.setNamespaceAware(true);\n      dfactory.setValidating(true);\n\n      DocumentBuilder documentBuilder = dfactory.newDocumentBuilder();\n\n      documentBuilder\n         .setErrorHandler(new org.apache.xml.security.utils\n            .IgnoreAllErrorHandler());\n\n      byte inputBytes[] = input.getBytes();\n      Document inputDoc =\n         documentBuilder.parse(new ByteArrayInputStream(inputBytes));\n\n      XMLSignatureInput signatureInput = new XMLSignatureInput((Node) inputDoc);\n      Document transformDoc = documentBuilder.newDocument();\n\n      Transforms c14nTrans = new Transforms(transformDoc);\n      transformDoc.appendChild(c14nTrans.getElement());\n     \nc14nTrans.addTransform(\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments\");\n      XMLSignatureInput c14nResult = c14nTrans.performTransforms(signatureInput);\n      byte outputBytes[] = c14nResult.getBytes();\n\n      System.out.println(new String(outputBytes));\n   }\n}", "attachment_id": null, "bug_id": 40156, "id": 91782, "time": "2006-08-01T19:35:48Z", "creator": "dominikschadow@gmail.com", "creation_time": "2006-08-01T19:35:48Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 40156, "attachment_id": null, "text": "You cannot print Umlaute to UTF-8 directly. They must be masked as two-byte \ncharacters. The exception is correct.", "id": 91825, "time": "2006-08-02T15:31:18Z", "creator": "bugzilla@thias.de", "creation_time": "2006-08-02T15:31:18Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 40156, "attachment_id": null, "id": 108389, "creation_time": "2007-09-19T12:11:03Z", "time": "2007-09-19T12:11:03Z", "creator": "sean.mullan@oracle.com", "text": "Closing old bugs.", "is_private": false}]
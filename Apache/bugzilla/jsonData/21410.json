[{"count": 0, "tags": [], "bug_id": 21410, "is_private": false, "id": 40181, "attachment_id": null, "creator": "apache@keithley.org", "creation_time": "2003-07-08T15:31:45Z", "time": "2003-07-08T15:31:45Z", "text": "The following patch is necessary to use ant with j2sdk1.4.2\n\nThis patch just punts the problem by using the \"oldjavah\" package instead of the\nNewAndImproved javah package. The dearth of documentation for the javah package\nmakes it difficult to know what the correct fix might actually be.\n\n***\napache-ant-1.5.3-1/src/main/org/apache/tools/ant/taskdefs/optional/Javah.java.orig\n Mon Jul  7 15:51:51 2003\n---\napache-ant-1.5.3-1/src/main/org/apache/tools/ant/taskdefs/optional/Javah.java  \n    Mon Jul  7 16:26:01 2003\n***************\n*** 347,355 ****\n              // dynamically. However, javah has a different interface and this\n              // makes it harder, so here's a simple alternative.\n              //------------------------------------------------------------------\n!             com.sun.tools.javah.Main main\n!                 = new com.sun.tools.javah.Main(cmd.getArguments());\n!             main.run();\n          } catch (Exception ex) {\n              if (ex instanceof BuildException) {\n                  throw (BuildException) ex;\n--- 347,374 ----\n              // dynamically. However, javah has a different interface and this\n              // makes it harder, so here's a simple alternative.\n              //------------------------------------------------------------------\n!             Class parameterTypes[] = new Class[1];\n!             parameterTypes[0] = new String[0].getClass();\n!             Class javahMain = Class.forName(\"com.sun.tools.javah.Main\");\n!             java.lang.reflect.Constructor ctor = null;\n!             try {\n!                 ctor = javahMain.getConstructor(parameterTypes);\n!             } catch (NoSuchMethodException nsme) {\n!                 javahMain = Class.forName(\"com.sun.tools.javah.oldjavah.Main\");\n!                 ctor = javahMain.getConstructor(parameterTypes);\n!             }\n!\n!             Object args[] = new Object[1];\n!             args[0] = cmd.getArguments();\n!\n!             // com.sun.tools.javah.Main main\n!                 // = new com.sun.tools.javah.Main(cmd.getArguments());\n!             Object main = ctor.newInstance(args);\n!\n!             // main.run();\n!             java.lang.reflect.Method run = javahMain.getMethod(\"run\", new\nClass[0]);\n!             run.invoke(main, new Object[0]);\n!\n          } catch (Exception ex) {\n              if (ex instanceof BuildException) {\n                  throw (BuildException) ex;"}, {"count": 1, "tags": [], "creator": "peter.reilly@corvil.com", "text": "\n\n*** This bug has been marked as a duplicate of 18667 ***", "id": 40183, "time": "2003-07-08T15:34:28Z", "bug_id": 21410, "creation_time": "2003-07-08T15:34:28Z", "is_private": false, "attachment_id": null}]
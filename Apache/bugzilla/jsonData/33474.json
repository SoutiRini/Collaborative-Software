[{"count": 0, "tags": [], "bug_id": 33474, "text": "Binding to port 0 is perfectly valid.  Any port will do, and in my case, \nmanaging a list of over 1000 vhosts' ports is not acceptable.  Some configured \nports may or may not be available.  It shouldn't matter what port is used for \nthe listener in most cases.  The current code returns the port that is \nconfigured in the server.xml.  If that port is 0, 0 will be sent to the \nMembershipService.  Obviously, that's not going to work.  If we configure port \n0, get the local port that we actually bound to.\n\nIndex: ReplicationListener.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\ncatalina/modules/cluster/src/share/org/apache/catalina/cluster/tcp/ReplicationLi\nstener.java,v\nretrieving revision 1.18\ndiff -u -r1.18 ReplicationListener.java\n--- ReplicationListener.java\t27 Dec 2004 09:30:36 -0000\t1.18\n+++ ReplicationListener.java\t9 Feb 2005 20:13:51 -0000\n@@ -101,6 +101,9 @@\n         selector = Selector.open();\n         // set the port the server channel will listen to\n         serverSocket.bind (new InetSocketAddress (bind,tcpListenPort));\n+        if (tcpListenPort == 0) {\n+        \ttcpListenPort = serverSocket.getLocalPort();\n+        }\n         // set non-blocking mode for the listening socket\n         serverChannel.configureBlocking (false);\n         // register the ServerSocketChannel with the Selector", "id": 70714, "time": "2005-02-09T21:24:29Z", "creator": "cstach-asf@ldsys.net", "creation_time": "2005-02-09T21:24:29Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "fhanik@apache.org", "is_private": false, "text": "running a cluster for over 1000 vhosts, isn't such a great idea.\nthe patch doesn't do anything, as there are other dependencies you haven't\nconsidered.\n I'll add this item to the todo list to allow 0 or \"auto\" in the config, setting\nthis bug to invalid, as it is a todo item.", "id": 70723, "time": "2005-02-10T01:28:32Z", "bug_id": 33474, "creation_time": "2005-02-10T01:28:32Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 33474, "attachment_id": null, "is_private": false, "id": 70765, "time": "2005-02-10T16:43:43Z", "creator": "cstach-asf@ldsys.net", "creation_time": "2005-02-10T16:43:43Z", "text": "I have to disagree with marking this as invalid.  It _is_ marked as an \nenhancement and it would be much easier to tell when or if it is implemented \nwith this for tracking.\n\nI couldn't find any other dependencies on the listener port.  The only other \nissue is making the bind happen in the calling thread inside of start() and not \nin the listener's thread.  I don't know why you would continue processing the \ncluster (or even starting another thread in this case) if you can't get a \nrequired resource, even if it may save a little time.  I didn't see anything \nrequired for the bind that could block for any long period of time, so putting \nit in the calling thread wouldn't do any harm.\n\nIf there are any \"dependencies\" outside of that, that's non-OO and bad news."}, {"count": 3, "attachment_id": 14258, "bug_id": 33474, "text": "Created attachment 14258\nHere's a better patch in case you haven't gotten to it yet", "id": 70870, "time": "2005-02-12T00:55:48Z", "creator": "cstach-asf@ldsys.net", "creation_time": "2005-02-12T00:55:48Z", "tags": [], "is_private": false}]
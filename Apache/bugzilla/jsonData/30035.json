[{"count": 0, "tags": [], "bug_id": 30035, "attachment_id": null, "text": "let me give you an example: a plain apache installation, with one sub directory\n(foo/) in the document root. foo should be access restricted, so there is an\nfoo/.htaccess:\n\nAuthType Basic\nRequire valid-user\nAuthName \"restricted directory\"\nAuthUserFile .htpasswd\n\nnow comes mod_rewrite into the game. I want to redirect http://thishost/foo/ to\nhttp://somewhereelse/foo/, so there is a /.htaccess:\n\nErrorDocument 403 error.html\n\nRewriteEngine on\nRewriteBase /\n\n# fancy RewriteConds\nRewriteCond %{REQUEST_URI} ^/foo/\nRewriteRule (.*) http://somewhereelse/$1 [R=301,L]\n\nthis configuration yields strange responses:\n\nGET /foo HTTP/1.0\n\nUser-Agent: w3m/0.5.1\n\nAccept: text/*, image/*\n\nAccept-Encoding: gzip, compress, bzip, bzip2, deflate\n\nAccept-Language: en;q=1.0\n\nHost: thishost\n\n\n\nHTTP/1.1 301 Moved Permanently\n\nDate: Sun, 11 Jul 2004 11:28:32 GMT\n\nServer: Apache/1.3.29 (Unix)\n\nWWW-Authenticate: Basic realm=\"restricted directory\"\n\nLocation: http://thishost/error.html\n\nConnection: close\n\nContent-Type: text/html; charset=iso-8859-1\n\n\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<HTML><HEAD>\n<TITLE>301 Moved Permanently</TITLE>\n</HEAD><BODY>\n<H1>Moved Permanently</H1>\nThe document has moved <A HREF=\"http://thishost/error.html\">here</A>.<P>\n</BODY></HTML>\n\nNow this response appears to be a mixture of the mod_rewrite result (html code\n301) and the auth stuff (location /error.html). I'm not sure whether that's a\nmod_rewrite bug, or something else, however, I expect either a correct\nredirection or a correct access denied response - this mixture is just wrong", "id": 60437, "time": "2004-07-11T11:36:46Z", "creator": "jochen.eisinger@gmx.de", "creation_time": "2004-07-11T11:36:46Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 30035, "attachment_id": null, "id": 60438, "time": "2004-07-11T12:03:07Z", "creator": "nd@perlig.de", "creation_time": "2004-07-11T12:03:07Z", "is_private": false, "text": "The server does what you're telling him. Just use another configuration. The\nfollowing should work better:\n\n# no rewritecond on request_uri!\nRewriteRule ^foo/ http://somewhereelse/$1 [R=301,L]"}, {"count": 2, "tags": [], "bug_id": 30035, "text": "RewriteRule ^foo/(.*) http://somewhereelse/$1 [R=301,L]\n                 ^^^^\nof course.", "id": 60439, "time": "2004-07-11T12:05:18Z", "creator": "nd@perlig.de", "creation_time": "2004-07-11T12:05:18Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 30035, "text": "[ I resolved this to invalid only to find nd had done the same while I was typing]\n\nIsn't that 301 response mod_dir redirecting from /foo to /foo/ ?\n\nThat is provoking your WWW-Authenticate, and also a 403 error (note - not 401\nwhich is what you get when you need to authenticate) from a screwup elsewhere in\nyour configuration.\n\nI expect you'd get exactly the same with RewriteEngine Off.  Reopen the bug if\nthat's wrong.  And fix your config in any case.\n", "count": 3, "id": 60440, "time": "2004-07-11T12:07:53Z", "creator": "nick@webthing.com", "creation_time": "2004-07-11T12:07:53Z", "is_private": false}, {"count": 4, "tags": [], "text": "Hi,\n\ni tried the rewriterule you suggested, Andr\u00e9, with no success (i.e. same\nresult). even a rule like\n\n# nothing else\nRewriteRule (.*) http://otherhost/$1 [R,L]\n\ndoesn't work (it works perfectly for other not-restricted directories thou)\n\nand Nick, no, if I request foo/ i get the same strange result, and if I turn\nmod_rewrite off, the request for http://thishost/foo/ will correctly return a\nrequest to authenticate myself.\n\nIf I include correct credentials into the initial request (with rewriteengine\non), I still will be referred to error.html, when requesting thishost/foo/. when\nrequesting otherhost/foo/\n\nnow for the last comment of yours: the \"rest\" of my configuration. I figured it\nwas best to reinstall the latest 1.3 apache on a dedicated box and try it there\nbefore I reopen this bug.", "is_private": false, "bug_id": 30035, "id": 60443, "time": "2004-07-11T12:48:01Z", "creator": "jochen.eisinger@gmx.de", "creation_time": "2004-07-11T12:48:01Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Please reopen the report, if you can supply more information.\n\nThanks.", "is_private": false, "id": 62217, "creator": "nd@perlig.de", "time": "2004-08-19T23:14:30Z", "bug_id": 30035, "creation_time": "2004-08-19T23:14:30Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "bseib@purdue.edu", "attachment_id": null, "id": 57056, "time": "2004-05-09T16:30:30Z", "bug_id": 28857, "creation_time": "2004-05-09T16:30:30Z", "is_private": false, "text": "I found org.apache.catalina.net.SSLServerSocketFactory useful for another\nproject of mine. However, my keystore is PKCS12 format, and\nKeystore.getInstance(\"PKCS12\") fails unless the security provider is loaded first.\n\nI am using java 1.3.1 and JSSE 1.0.3_03.\nHere's a patch to look at.\n-broc\n\n\nIndex: SSLServerSocketFactory.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-4.0/catalina/src/share/org/apache/catalin\na/net/SSLServerSocketFactory.java,v\nretrieving revision 1.10\ndiff -u -r1.10 SSLServerSocketFactory.java\n--- SSLServerSocketFactory.java\t30 Nov 2001 23:00:45 -0000\t1.10\n+++ SSLServerSocketFactory.java\t7 May 2004 17:06:54 -0000\n@@ -381,6 +381,7 @@\n            KeyManagementException\n     {\n \n+\t\tinitSecurityProvider();\n         initHandler();\n         initKeyStore();\n         initProxy();\n@@ -388,6 +389,20 @@\n     }\n \n \n+\t/**\n+     * Register JSSE security provider.\n+     */\n+    private void initSecurityProvider() {\n+\t\t// Register the JSSE security Provider (if it is not\nalready there)\n+        try {\n+            Security.addProvider((java.security.Provider)\n+\nClass.forName(\"com.sun.net.ssl.internal.ssl.Provider\").newInstance());\n+        } catch (Throwable t) {\n+            ;\n+        }\n+    }\n+\n+\n     /**\n      * Register our URLStreamHandler for the \"https:\" protocol.\n      */\n@@ -456,15 +471,6 @@\n     throws KeyStoreException, NoSuchAlgorithmException,\n            UnrecoverableKeyException, KeyManagementException\n     {\n-\n-        // Register the JSSE security Provider (if it is not already\nthere)\n-        try {\n-            Security.addProvider((java.security.Provider)\n- Class.forName(\"com.sun.net.ssl.internal.ssl.Provider\").newInstance());\n-        } catch (Throwable t) {\n-            ;\n-        }\n-\n         // Create an SSL context used to create an SSL socket factory\n         SSLContext context = SSLContext.getInstance(protocol);"}, {"count": 1, "tags": [], "creator": "markt@apache.org", "text": "This class is part of the deprectaed HTTP/1.1 connectors. Therefore, this patch\nwill not be applied.", "id": 69726, "time": "2005-01-15T14:47:33Z", "bug_id": 28857, "creation_time": "2005-01-15T14:47:33Z", "is_private": false, "attachment_id": null}]
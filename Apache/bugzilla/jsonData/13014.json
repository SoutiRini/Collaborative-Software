[{"count": 0, "attachment_id": null, "bug_id": 13014, "text": "On IBM OS/390 v2.10 / Unix System Services.\nGetting the following message in the log :\nStarting service Tomcat-Standalone\nApache Tomcat/4.1.10\nServerLifecycleListener: Process addValve[container=StandardEngine\n[Standalone].StandardHost[localhost],valve=ErrorReportValve[localhost]]\nServerLifecycleListener: Creating MBean for Valve ErrorReportValve[localhost]\nServerLifecycleListener: Process addValve[container=StandardEngine\n[Standalone].StandardHost[localhost],valve=ErrorDispatcherValve[localhost]]\nServerLifecycleListener: Creating MBean for Valve ErrorDispatcherValve\n[localhost]\nServerLifecycleListener: propertyChange[container=StandardEngine\n[Standalone].StandardHost[localhost].StandardContext[\u0007\u00c1\u00cc/_\u00f8%\n\u00c1\u00cb],propertyName=resources,oldValue=null,newValue=org.apache.naming.resources.Pr\noxyDirContext@11dbffd5]\nServerLifecycleListener: propertyChange[container=StandardEngine\n[Standalone].StandardHost[localhost].StandardContext[\u0007\u00c1\u00cc/_\u00f8%\n\u00c1\u00cb],propertyName=loader,oldValue=null,newValue=WebappLoader[\u0007\u00c1\u00cc/_\u00f8%\u00c1\u00cb]]\nServerLifecycleListener: Creating MBean for Loader WebappLoader[\u0007\u00c1\u00cc/_\u00f8%\u00c1\u00cb]\nServerLifecycleListener: propertyChange[container=StandardEngine\n[Standalone].StandardHost[localhost].StandardContext[\u0007\u00c1\u00cc/_\u00f8%\n\u00c1\u00cb],propertyName=manager,oldValue=null,newValue=org.apache.catalina.session.Stan\ndardManager@6127fd4]\nServerLifecycleListener: Creating MBean for Manager \norg.apache.catalina.session.StandardManager@6127fd4\nServerLifecycleListener: propertyChange[container=StandardEngine\n[Standalone].StandardHost[localhost].StandardContext[\u0007\u00c1\u00cc/_\u00f8%\n\u00c1\u00cb],propertyName=replaceWelcomeFiles,oldValue=false,newValue=true]\nServerLifecycleListener: propertyChange[container=StandardEngine\n[Standalone].StandardHost[localhost].StandardContext[\u0007\u00c1\u00cc/_\u00f8%\n\u00c1\u00cb],propertyName=publicId,oldValue=null,newValue=-//Sun Microsystems, Inc.//DTD \nWeb Application 2.3//EN]\nServerLifecycleListener: Process addChild[parent=StandardEngine\n[Standalone].StandardHost[localhost].StandardContext[\u0007\u00c1\u00cc/_\u00f8%\n\u00c1\u00cb],child=StandardEngine[Standalone].StandardHost[localhost].StandardContext\n[\u0007\u00c1\u00cc/_\u00f8%\u00c1\u00cb].StandardWrapper[default]]\nServerLifecycleListener: Process addChild[parent=StandardEngine\n[Standalone].StandardHost[localhost].StandardContext[\u0007\u00c1\u00cc/_\u00f8%\n\u00c1\u00cb],child=StandardEngine[Standalone].StandardHost[localhost].StandardContext\n[\u0007\u00c1\u00cc/_\u00f8%\u00c1\u00cb].StandardWrapper[invoker]]\nServerLifecycleListener: Process addChild[parent=StandardEngine\n[Standalone].StandardHost[localhost].StandardContext[\u0007\u00c1\u00cc/_\u00f8%\n\u00c1\u00cb],child=StandardEngine[Standalone].StandardHost[localhost].StandardContext\n[\u0007\u00c1\u00cc/_\u00f8%\u00c1\u00cb].StandardWrapper[jsp]]\njava.lang.reflect.InvocationTargetException: \njava.lang.IllegalArgumentException: Invalid <url-pattern> \u0007 in servlet mapping\n\nThat \u0007 is actually in ascii hex translated to the character '/' and is actually\npointed to the the '/' in conf/web.xml at the location\n <!-- The mapping for the default servlet -->\n    <servlet-mapping>\n        <servlet-name>default</servlet-name>\n        <url-pattern>/</url-pattern>\n    </servlet-mapping>\n\nThis \"Invalid <url-pattern>\" is repeated a number of times each followed by \na different url-pattern as defined in conf/web.xml\neg. the next one is /servlet/*\n\nOS/390's USS is an EBCDIc machine. I ftp the webapps directory to USS in binary \nto retain the ASCII value. \n\nJoseph Tan", "id": 23401, "time": "2002-09-26T05:00:54Z", "creator": "jjnfg@yahoo.com", "creation_time": "2002-09-26T05:00:54Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 13014, "is_private": false, "text": "I replaced the XML parser with xercesImpl.jar from Xerces-Java 2.1.0.\nThe problem remains.\n\nI installed v331 of tomcat today and it works after with the following files\nin EBCDIC :\nconf/tomcat.policy\nconf/jserv/tomcat.conf\nconf/jserv/tomcat.property", "id": 23579, "time": "2002-09-27T19:25:34Z", "creator": "jjnfg@yahoo.com", "creation_time": "2002-09-27T19:25:34Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 13014, "text": "10/7/02 Ned Gerhart, Software Engineer  nedge@attachmate.com\nI've had identical results to those reported originally by Joseph Tan. We have \nhad success with Tomcat 3.3.1 in the USS environment, but later versions have \nproblems as described here. Please let me know if there is anything Attachmate \nCorporation can do to help speed resolution of this bug...thanks.  ", "id": 24151, "time": "2002-10-08T18:33:37Z", "creator": "nedge@attachmate.com", "creation_time": "2002-10-08T18:33:37Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "jjnfg@yahoo.com", "attachment_id": null, "is_private": false, "id": 24180, "time": "2002-10-09T03:11:52Z", "bug_id": 13014, "creation_time": "2002-10-09T03:11:52Z", "text": "Ned, We can live with version 331 for the time being until it is fixed.\nHave you found the source of this bug ? If so, is there any work around ?\n\nThere was a discussion about support for running Tomcat on EBCDIC systems back \nin 28 Dec 1999 and then around 24 Mar 2000 in the tomcat-dev list.\n\nThen the subject was not heard of since then.\n\nCan anyone in the Development team comment on this subject ?\n\nWill there be any serious work on supporting Tomcat on EBCDIC systems such as\nIBM's USS ?"}, {"count": 4, "tags": [], "bug_id": 13014, "is_private": false, "text": "The idea is that maybe no member of the dev team has access to the appropriate\nmachine and can reproduce this.\n\nThe offending code looks like the StandardContext.validateURLPattern method (I\nhave no idea what is wrong with it, though):\n\n    private boolean validateURLPattern(String urlPattern) {\n\n        if (urlPattern == null)\n            return (false);\n        if (urlPattern.startsWith(\"*.\")) {\n            if (urlPattern.indexOf('/') < 0)\n                return (true);\n            else\n                return (false);\n        }\n        if (urlPattern.startsWith(\"/\"))\n            return (true);\n        else\n            return (false);\n\n    }\n", "id": 24185, "time": "2002-10-09T06:27:19Z", "creator": "remm@apache.org", "creation_time": "2002-10-09T06:27:19Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "jjnfg@yahoo.com", "attachment_id": null, "is_private": false, "id": 24186, "time": "2002-10-09T06:52:41Z", "bug_id": 13014, "creation_time": "2002-10-09T06:52:41Z", "text": "Remy,\nHow can I help in correcting this bug ?\nI am no Java programmer.\nIt is clumsy but can you give me instructions that I can\ncarry out at my end to correct it ?\nMy machine is currently running OS/390 v2.10 64 bit mode.\nand IBM SDK 1.3.1 going to 1.4 soon.\n\nJoseph"}, {"count": 6, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 24187, "time": "2002-10-09T07:13:02Z", "bug_id": 13014, "creation_time": "2002-10-09T07:13:02Z", "text": "I posted the apparently offending code to see if anyone would have an idea (I\ndon't). It would look like the test .startsWith(\"/\") is failing."}, {"count": 7, "tags": [], "text": "The USS environment is somewhat unusual...perhaps no one at apache.org has \nready access to such a system for testing and debugging this issue. Attachmate \nwould be happy to provide such access to anyone involved with Tomcat \ndevelopment at apache.org if it would help speed resolution. Please email me, \nand we can discuss details of this.  -Ned", "is_private": false, "id": 24208, "creator": "nedge@attachmate.com", "time": "2002-10-09T15:11:19Z", "bug_id": 13014, "creation_time": "2002-10-09T15:11:19Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "Hi everybody\n\nThe same problem you described exists on 4.0.6 ,so\nI fixed the bugs and now I have the TOMCAT 4.0.6 operating\nperfectly on OS/390 2.10 .\nIf you are interested in this version ,I can send you a binary package\nproduced for OS/390.\nOn TOMCAT 4.12 the problem exists too,and I could solve the ascii-ebcdic\nissues but  another problems appear with finding some class files.\n\n\nThanks \nAli Madani\nEmail : maddani@dpi2.dpi.net.ir", "is_private": false, "id": 25054, "creator": "maddani@dpi2.dpi.net.ir", "time": "2002-10-23T16:19:24Z", "bug_id": 13014, "creation_time": "2002-10-23T16:19:24Z", "attachment_id": null}, {"count": 9, "tags": [], "text": "Ali,\nWhat a great news ! Is it possible to ftp the binary directly from your web \nsite ?\n\nJoseph Tan", "is_private": false, "id": 25062, "creator": "jjnfg@yahoo.com", "time": "2002-10-23T17:57:00Z", "bug_id": 13014, "creation_time": "2002-10-23T17:57:00Z", "attachment_id": null}, {"count": 10, "tags": [], "creator": "jjnfg@yahoo.com", "attachment_id": null, "is_private": false, "id": 25094, "time": "2002-10-24T06:50:47Z", "bug_id": 13014, "creation_time": "2002-10-24T06:50:47Z", "text": "What is the procedure for distributing a fix as described by Seyed Ali Madani ?\nThe fix is for v4.0.6 but the problem is reported under v4.1.10.\n\nAnd shouldn't the fixed binary be distributed from Apache's web site instead \nof distributing it personnaly ?"}, {"count": 11, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 25095, "time": "2002-10-24T07:10:54Z", "bug_id": 13014, "creation_time": "2002-10-24T07:10:54Z", "text": "Usually, what happens is that someone contributes a patch."}, {"count": 12, "tags": [], "bug_id": 13014, "is_private": false, "text": "Created attachment 3596\nattachment file #1 for binary fix of bug 13014 on tomcat 4.0.6", "id": 25105, "time": "2002-10-24T09:48:55Z", "creator": "maddani@dpi2.dpi.net.ir", "creation_time": "2002-10-24T09:48:55Z", "attachment_id": 3596}, {"count": 13, "tags": [], "creator": "maddani@dpi2.dpi.net.ir", "attachment_id": 3597, "is_private": false, "id": 25106, "time": "2002-10-24T09:51:46Z", "bug_id": 13014, "creation_time": "2002-10-24T09:51:46Z", "text": "Created attachment 3597\nattachment file #2 for binary fix of bug 13014 on tomcat 4.0.6"}, {"count": 14, "tags": [], "creator": "maddani@dpi2.dpi.net.ir", "attachment_id": null, "is_private": false, "id": 25107, "time": "2002-10-24T10:02:40Z", "bug_id": 13014, "creation_time": "2002-10-24T10:02:40Z", "text": "Hi all\nI wrote the detailed instructions for using binary fixes for tomact 4.0.6\nin response to someone ask me in OE mailing list which appended below,and the \nattachments are also attached to bug 13014.\nand about the source of problem :\nIt is created by URLDecode method,i mean everywhere this method\nis called without specifying the 8859_1 encoding it assumes the defult\nencoding that on OS/390 is IBM-1047 so I searched the entire source\nand found that it must be changed to URLDecode(----,\"8859_1\") in the \nfollowing source files:\n\norg.apache.catalina.core.StandardContext.java\norg.apache.catalina.core.StandardContextMapper.java\norg.apache.catalina.authenticator.AuthenticatorBase.java \norg.apache.catalina.deploy.ErrorPage.java\norg.apache.catalina.deploy.SecurityCollection.java\norg.apache.catalina.deploy.FilterMap.java\norg.apache.catalina.deploy.LoginConfig.java\n\n\n>>>>>>>>>>>>>>>>Detailed instructions for binary fix >>>>>>>>>\n\n> 1.  Download and unpack the < jakarta-tomat-4.0.6.zip>  from :\n>\nhttp://jakarta.apache.org/builds/jakarta-tomcat-4.0/release/v4.0.6/bin/\n>     (The <jakarta-tomcat-4.0.6.tar.gz> is defective and should not be\n       used)\n> 2. You should have JAVA 1.3 or greater on your system installed and\n>     the <JAVA_HOME> environment variable point to its installation path.\n> 3. Using <oeditascii> utility (can get from IBM OS390 unix system services\n>     <tools and toys> home page) change the <server.xml> file in <conf>\n>     directory and set the port that tomcat listen for incomming requests\n      on it,if you do not change this port the default will be 8080.\n> 4. There are two attachments to this email ,you should ftp them to USS\n>     in binary format.\n> 5. Remove the <bin> directory in the path you have installed Tomcat,\n>     and then untar the first attachment file <bindir.tar> for example\n>     if i installed the tomcat in </home/jakarta-tomcat-4.0.6> directory\n>     and also have ftpied the <bindir.tar> attachment file to this directory,\n>     i should run the following commands in OMVS shell:\n>    > cd   /home/jakarta-tomcat-4.0.6\n>    > pwd\n>         (ensure that you are in your tomcat installation path,to not\n           delete system </bin> directory accidentally)\n>    > rm  -rf   bin\n>    > tar   xvf   bindir.tar\n> 6. Replace the <catalina.jar>  file with the second attachment file ,\n>     the <catalina.jar> file located in <server/lib> directory in your\n>     catalina installation path.\n>    (for example in /home/jakarta- tomcat-4.0.6/server/lib)\n> 7. Export the environment variable CATALINA_HOME pointing to\n>     your tomcat  installation directory .\n>    (for example:  > export CATALINA_HOME= /home/jakarta-tomcat-4.0.6)\n> 8. change current directory to <bin> and run <startup.sh> shell script.\n>     for example:\n>     >  cd   /home/jakarta-tomcat-4.0.6/bin\n>     > ./startup.sh\n> 9.  you can then check tomcat with entering the following url in your\n>     browser:\n>     http://<your- host- ip- address>:8080\n> 10. In the case of any problem refer to log files in logs directory in\n       your installation path.(for example : /home/jakarta-tomcat-4.0.6/logs)\n>\n> I hope it would be useful.\n> Thanks\n> Ali Madani\n>\n"}, {"count": 15, "tags": [], "bug_id": 13014, "text": "Remy Maucherat, \nwhat next ? How does it work ? Someone would pick up from Ali's\nsuggested fix and incorporate into the next distribution ? Who ?", "id": 25110, "time": "2002-10-24T10:15:07Z", "creator": "jjnfg@yahoo.com", "creation_time": "2002-10-24T10:15:07Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 25116, "time": "2002-10-24T10:35:54Z", "bug_id": 13014, "creation_time": "2002-10-24T10:35:54Z", "text": "There are obvious benefits to using the platform encoding to read the config\nfiles, so we'll have to consider if that kind of patch will be merged."}, {"count": 17, "tags": [], "bug_id": 13014, "text": "After applying the changes described by Seyed Ali Madani, and rebuilding \nTomcat, (and converting several script files, etc. to EBCDIC) I can confirm \nthat Tomcat 4.0.6 will work on USS systems. Thanks very much for this advice! \nAfter this all of the example servlets and jsp operate correctly. \n\nThere is one other change we found necessary, in order that error messages are \nproperly displayed...this involves the getReporter() function in \nResponseBase.java. I will attach the updated version of ResponseBase.java that \nwe are using in case anyone wants to see it. \n", "id": 27350, "time": "2002-12-03T19:33:47Z", "creator": "nedge@attachmate.com", "creation_time": "2002-12-03T19:33:47Z", "is_private": false, "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 13014, "is_private": false, "text": "Created attachment 4028\nRevisions to getReporter() so that encoding is observed", "id": 27351, "time": "2002-12-03T19:36:29Z", "creator": "nedge@attachmate.com", "creation_time": "2002-12-03T19:36:29Z", "attachment_id": 4028}, {"count": 19, "tags": [], "creator": "maddani@dpi2.dpi.net.ir", "attachment_id": null, "is_private": false, "id": 44141, "time": "2003-09-13T13:16:09Z", "bug_id": 13014, "creation_time": "2003-09-13T13:16:09Z", "text": "There is another patch that fixes some bugs observed in Tomcat-4.0.6 \noperating on OS/390 USS (like working with manager , basic authentication ,etc)\nthe fix is attached as binary fix #3 and includes < tomcat.jar > which must  \nreplaces the old version existing in  < ..../server/lib >  diretory."}, {"count": 20, "tags": [], "bug_id": 13014, "is_private": false, "text": "Created attachment 8197\nattachment file #3 for binary fix of bug 13014 on tomcat 4.0.6", "id": 44142, "time": "2003-09-13T13:48:29Z", "creator": "maddani@dpi2.dpi.net.ir", "creation_time": "2003-09-13T13:48:29Z", "attachment_id": 8197}, {"count": 21, "tags": [], "bug_id": 13014, "text": "Also in relation to TOMCAT-4.0.6 on OS/390 USS,\nthe combination of TOMCAT-4.0.6 and JBOSS-2.4.10 has been tested \non OS/390 USS (only preliminary tests).", "id": 44144, "time": "2003-09-13T14:13:56Z", "creator": "maddani@dpi2.dpi.net.ir", "creation_time": "2003-09-13T14:13:56Z", "is_private": false, "attachment_id": null}, {"count": 22, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 71734, "time": "2005-03-02T22:31:05Z", "bug_id": 13014, "creation_time": "2005-03-02T22:31:05Z", "text": "This is quite an old bug.\n\nHaving reviewed this bug I would make the following observations:\n1. Users of OS/390 should have migrated to z/OS but as far as I can tell this\nissue also applies to z/OS.\n2. Binary fixes cannot be applied to CVS. I know in theory they could be reverse\nengineered but I am not going own that road.\n3. The getReporter() issue is in the deprecated HTTP connector.\n4. A better fix may be to add a configuration option to o.a.c.util.RequestUtil \n\nI will leave this bug open for now but since AFAIAA none of the Tomcat\ndevelopers have access to a machine running z/OS this will be resolved as\nWONTFIX at some point in the future unless appropriate source code patches are\nprovided for review."}, {"count": 23, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 73206, "time": "2005-04-02T14:14:48Z", "bug_id": 13014, "creation_time": "2005-04-02T14:14:48Z", "text": "As per my previous comment, I am closing this as WONTFIX."}]
[{"count": 0, "tags": [], "creator": "mi+apache@aldan.algebra.com", "attachment_id": 29358, "id": 162086, "time": "2012-09-11T20:59:08Z", "bug_id": 53856, "creation_time": "2012-09-11T20:59:08Z", "is_private": false, "text": "Created attachment 29358\nIllustrating sample\n\nAs illustrated by the attached sample, the While-controller may enter the loop \"one last time\" even when the specified condition is false.\n\nIn my example, the loop goes through a CSV-file with three lines invoking a Debug Sampler. However, the Debug Sampler is shown in the results tree not three times, but four -- in the last, fourth, invocation all variables are set \"<EOF>\".\n\nThe work-around is to put an If-controller inside the loop and hang everything off of it. This should not be necessary."}, {"count": 1, "text": "Created attachment 29359\nSample CSV-file refered to by the sample test-plan", "bug_id": 53856, "is_private": false, "id": 162087, "time": "2012-09-11T20:59:56Z", "creator": "mi+apache@aldan.algebra.com", "creation_time": "2012-09-11T20:59:56Z", "tags": [], "attachment_id": 29359}, {"count": 2, "tags": [], "bug_id": 53856, "text": "The CSV dataset entry is only updated within the While Loop, so of course the debug sampler will show <EOF> before the loop exits.", "id": 162091, "time": "2012-09-12T00:23:50Z", "creator": "sebb@apache.org", "creation_time": "2012-09-12T00:23:50Z", "is_private": false, "attachment_id": null}, {"count": 3, "text": "I am sorry, but the current behavior makes no sense. What possible use-case is there for iterating through a CSV-file, that has N rows, N+1 times?\n\nAll this does is necessitates the use of an If-controller with the same condition repeated -- so as to skip the last iteration.\n\nI did some research before filing this bug-report. At least one other user -- a lot more seasoned with JMeter than myself -- sees no other way to use While-controller with the CSV Dataset. And that's a shame...", "bug_id": 53856, "is_private": false, "id": 162093, "time": "2012-09-12T01:24:30Z", "creator": "mi+apache@aldan.algebra.com", "creation_time": "2012-09-12T01:24:30Z", "tags": [], "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 53856, "text": "It's impossible to fix this, as the condition can only be checked after the CSV file entry has been read, and the CSV entry is only read if the loop is entered.\n\nNote that CSV DataSet has an option to stop the thread on reaching EOF.", "id": 162094, "time": "2012-09-12T02:05:36Z", "creator": "sebb@apache.org", "creation_time": "2012-09-12T02:05:36Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "mi+apache@aldan.algebra.com", "attachment_id": null, "id": 162095, "time": "2012-09-12T03:05:54Z", "bug_id": 53856, "creation_time": "2012-09-12T03:05:54Z", "is_private": false, "text": "(In reply to comment #4)\n> It's impossible to fix this, as the condition can only be checked after the\n> CSV file entry has been read, and the CSV entry is only read if the loop is\n> entered.\n\nWhat, then, happens the first time, the condition is evaluated? Before the CSV file is read at all?\n\n> Note that CSV DataSet has an option to stop the thread on reaching EOF.\n\nYes, but this is of no help, if one wants to nest While-controllers -- and does not wish an inner one to end the entire thread."}, {"count": 6, "tags": [], "bug_id": 53856, "attachment_id": 29361, "id": 162096, "creation_time": "2012-09-12T03:48:25Z", "time": "2012-09-12T03:48:25Z", "creator": "mi+apache@aldan.algebra.com", "text": "Created attachment 29361\nEnhance the logging output of WhiteController's endOfLoop() method (not for production use)\n\nOk, some deeper debugging -- after enhancing the log.debug messages inside WhileController.java a little -- reveal, that the controller's condition is checked twice per CSV-file row. The endOfLoop() method is invoked twice: first with the loopEnd-argument set to false, and then -- to true.\n\nAt the end, when the CSV Dataset sets all variables to \"<EOF>\", the function is called one more time -- with loopEnd set to false. For brevity, I removed the 3rd row from the sample.csv:\n\n2012/09/11 23:38:31 INFO  - jmeter.threads.JMeterThread: Thread started: Thread Group 1-1 \n2012/09/11 23:38:31 DEBUG - org.apache.commons.jexl.ScriptFactory: Parsing script: \"${greek}\" != \"<EOF>\"; \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition string at loop-end true. (Called from next) \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition value: false \n2012/09/11 23:38:31 INFO  - jmeter.services.FileServer: Stored: sample.csv \n2012/09/11 23:38:31 DEBUG - org.apache.commons.jexl.ScriptFactory: Parsing script: \"alpha\" != \"<EOF>\"; \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition string at loop-beginning true. (Called from nextIsNull) \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition value: false \n2012/09/11 23:38:31 DEBUG - org.apache.commons.jexl.ScriptFactory: Parsing script: \"alpha\" != \"<EOF>\"; \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition string at loop-end true. (Called from next) \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition value: false \n2012/09/11 23:38:31 DEBUG - org.apache.commons.jexl.ScriptFactory: Parsing script: \"beta\" != \"<EOF>\"; \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition string at loop-beginning true. (Called from nextIsNull) \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition value: false \n2012/09/11 23:38:31 DEBUG - org.apache.commons.jexl.ScriptFactory: Parsing script: \"beta\" != \"<EOF>\"; \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition string at loop-end true. (Called from next) \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition value: false \n2012/09/11 23:38:31 DEBUG - org.apache.commons.jexl.ScriptFactory: Parsing script: \"<EOF>\" != \"<EOF>\"; \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition string at loop-beginning false. (Called from nextIsNull) \n2012/09/11 23:38:31 DEBUG - jmeter.control.WhileController: Condition value: true \n2012/09/11 23:38:31 INFO  - jmeter.threads.JMeterThread: Thread finished: Thread Group 1-1 \n\nThe above output tells me:\n a. This bug report is not at all \"INVALID\"\n b. It is possible to fix the problem...", "is_private": false}]
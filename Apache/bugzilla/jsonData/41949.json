[{"count": 0, "attachment_id": null, "bug_id": 41949, "is_private": false, "id": 100970, "time": "2007-03-26T12:33:48Z", "creator": "glenn@apache.org", "creation_time": "2007-03-26T12:33:48Z", "tags": [], "text": "FreeBSD 6.0-RELEASE-p4\napache-2.0.59\nmod_jk 1.2.21\nTomcat 4.1.30\n\nWhen apache is configured with an output filter to post process HTML generated\nby a JSP page for SSI and the generated html has an SSI include virtual of\nanother JSP page and the original request was a POST mod_jk will hang while\nsending the POST headers during the sub request.\n\nTo reproduce add the following to the VirtualHost section to enable post\nprocessing of HTML generated from a JSP page for SSI:\n\n<LocationMatch \".*\\.(do|jsp)$\">\nOptions Includes\nAddOutputFilterByType INCLUDES text/html\n</LocationMatch>\n\nCreate a simple test.html page which does a POST:\n\n<p>\nmod_jk JSP Post Test\n</p>\n<form method=\"post\" action=\"/test/test1.jsp\">\n<input type=\"submit\" name=\"test\">\n</form>\n\nCreate a test1.jsp page as follows:\n\n<%@ page session=\"false\" %>\n\n<p>This is test1.jsp</p>\n\n<!--#include virtual=\"/test/test2.jsp\" -->\n\n\n\nFinally here is the test2.jsp page:\n\n<%@ page session=\"false\" %>\n<p>\nThis is test2.jsp\n</p>\n\nAll of the above works fine if test.html uses a GET but mod_jk hangs\nif test.html uses a POST. This problem doesn't exist in mod_jk 1.2.19."}, {"count": 1, "tags": [], "text": "Didn't check with 1.2.21, but it works with HEAD (mod_jk 1.2.22)", "is_private": false, "id": 101001, "creator": "mturk@apache.org", "time": "2007-03-26T22:11:26Z", "bug_id": 41949, "creation_time": "2007-03-26T22:11:26Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "glenn@apache.org", "text": "I checked out mod_jk HEAD from svn, built, installed and tested this bug.\n\nI can reproduce this bug using mod_jk HEAD from svn.\n\nFor me this is a big issue. We had to downgrade production servers\nback to version 1.2.19 which still contains the recent security\nvulnerability.", "id": 101038, "time": "2007-03-27T07:42:08Z", "bug_id": 41949, "creation_time": "2007-03-27T07:42:08Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 41949, "text": "Created attachment 19817\nmod_jk debug output\n\nDebug output from mod_jk exhibiting this bug. Not that mod_jk hangs,\nthe last line in the debug output is where it hangs. I have sanitized\nthe debug output to obfuscate hostnames and IP addresses.", "id": 101045, "attachment_id": 19817, "creator": "glenn@apache.org", "creation_time": "2007-03-27T08:46:23Z", "time": "2007-03-27T08:46:23Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 41949, "text": "It works for me. Please do not reopen the issue unless you give the\nreproducale case. I used your files, and it simply works!\n\nApacheRoot/test/html:\n<html>\n<head>\n<title>Test POST</title>\n</head>    \n<body>\n<p>\nmod_jk JSP Post Test\n</p>\n<form method=\"post\" action=\"/test1.jsp\">\n<input type=\"submit\" name=\"test\">\n</form>\n</body>\n</html>\n\n\n/ROOT/test1.jsp:\n<%@ page session=\"false\" %>\n<p>This is test1.jsp</p>\n<!--#include virtual=\"/test2.jsp\" -->\n\n/ROOT/test2.jsp\n<%@ page session=\"false\" %>\n<p>\nThis is test2.jsp\n</p>\n\n\nJkMount /*.jsp ajp13w\n\n\nMod_jk.log:\n\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (868): Connected\nsocket 740 to (127.0.0.1:8009)\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): sending to\najp13 pos=4 len=476 max=8192\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0000    12\n34 01 D8 02 02 00 08 49 4E 43 4C 55 44 45 44  - .4......INCLUDED\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0010    00\n00 0A 2F 74 65 73 74 32 2E 6A 73 70 00 00 09  - .../test2.jsp...\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0020    31\n32 37 2E 30 2E 30 2E 31 00 FF FF 00 09 6C 6F  - 127.0.0.1.....lo\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0030    63\n61 6C 68 6F 73 74 00 1F 90 00 00 0B A0 0B 00  - calhost.........\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0040    0E\n6C 6F 63 61 6C 68 6F 73 74 3A 38 30 30 30 00  - .localhost:8000.\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0050    A0\n0E 00 5A 4D 6F 7A 69 6C 6C 61 2F 35 2E 30 20  - ...ZMozilla/5.0.\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0060    28\n57 69 6E 64 6F 77 73 3B 20 55 3B 20 57 69 6E  - (Windows;.U;.Win\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0070    64\n6F 77 73 20 4E 54 20 35 2E 31 3B 20 65 6E 2D  - dows.NT.5.1;.en-\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0080    47\n42 3B 20 72 76 3A 31 2E 38 2E 31 2E 33 29 20  - GB;.rv:1.8.1.3).\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0090    47\n65 63 6B 6F 2F 32 30 30 37 30 33 30 39 20 46  - Gecko/20070309.F\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 00a0    69\n72 65 66 6F 78 2F 32 2E 30 2E 30 2E 33 00 A0  - irefox/2.0.0.3..\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 00b0    01\n00 63 74 65 78 74 2F 78 6D 6C 2C 61 70 70 6C  - ..ctext/xml,appl\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 00c0    69\n63 61 74 69 6F 6E 2F 78 6D 6C 2C 61 70 70 6C  - ication/xml,appl\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 00d0    69\n63 61 74 69 6F 6E 2F 78 68 74 6D 6C 2B 78 6D  - ication/xhtml+xm\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 00e0    6C\n2C 74 65 78 74 2F 68 74 6D 6C 3B 71 3D 30 2E  - l,text/html;q=0.\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 00f0    39\n2C 74 65 78 74 2F 70 6C 61 69 6E 3B 71 3D 30  - 9,text/plain;q=0\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0100    2E\n38 2C 69 6D 61 67 65 2F 70 6E 67 2C 2A 2F 2A  - .8,image/png,*/*\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0110    3B\n71 3D 30 2E 35 00 A0 04 00 0E 65 6E 2D 67 62  - ;q=0.5.....en-gb\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0120    2C\n65 6E 3B 71 3D 30 2E 35 00 A0 03 00 0C 67 7A  - ,en;q=0.5.....gz\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0130    69\n70 2C 64 65 66 6C 61 74 65 00 A0 02 00 1E 49  - ip,deflate.....I\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0140    53\n4F 2D 38 38 35 39 2D 31 2C 75 74 66 2D 38 3B  - SO-8859-1,utf-8;\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0150    71\n3D 30 2E 37 2C 2A 3B 71 3D 30 2E 37 00 00 0A  - q=0.7,*;q=0.7...\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0160    4B\n65 65 70 2D 41 6C 69 76 65 00 00 03 33 30 30  - Keep-Alive...300\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0170    00\nA0 06 00 0A 6B 65 65 70 2D 61 6C 69 76 65 00  - .....keep-alive.\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0180    A0\n0D 00 1F 68 74 74 70 3A 2F 2F 6C 6F 63 61 6C  - ....http://local\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 0190    68\n6F 73 74 3A 38 30 30 30 2F 74 65 73 74 2E 68  - host:8000/test.h\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 01a0    74\n6D 6C 00 A0 07 00 21 61 70 70 6C 69 63 61 74  - tml....!applicat\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 01b0    69\n6F 6E 2F 78 2D 77 77 77 2D 66 6F 72 6D 2D 75  - ion/x-www-form-u\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 01c0    72\n6C 65 6E 63 6F 64 65 64 00 A0 08 00 02 31 37  - rlencoded.....17\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (914): 01d0    00\n06 00 06 61 6A 70 31 33 77 00 FF 00 00 00 00  - ....ajp13w......\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1305): (ajp13w)\nrequest body to send 0 - request body to resend 0\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): received\nfrom ajp13 pos=0 len=78 max=8192\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): 0000   \n04 00 C8 00 02 4F 4B 00 00 02 00 0C 43 6F 6E 74  - .....OK.....Cont\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): 0010   \n65 6E 74 2D 54 79 70 65 00 00 1C 74 65 78 74 2F  - ent-Type...text/\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): 0020   \n68 74 6D 6C 3B 63 68 61 72 73 65 74 3D 49 53 4F  - html;charset=ISO\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): 0030   \n2D 38 38 35 39 2D 31 00 00 0E 43 6F 6E 74 65 6E  - -8859-1...Conten\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): 0040   \n74 2D 4C 65 6E 67 74 68 00 00 02 33 32 00 00 00  - t-Length...32...\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (620): status = 200\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (627): Number of\nheaders is = 2\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (683): Header[0]\n[Content-Type] = [text/html;charset=ISO-8859-1]\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (683): Header[1]\n[Content-Length] = [32]\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): received\nfrom ajp13 pos=0 len=36 max=8192\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): 0000   \n03 00 20 0D 0A 3C 70 3E 0D 0A 54 68 69 73 20 69  - .....<p>..This.i\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): 0010   \n73 20 74 65 73 74 32 2E 6A 73 70 0D 0A 3C 2F 70  - s.test2.jsp..</p\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): 0020   \n3E 0D 0A 00 00 00 00 00 00 00 00 00 00 00 00 00  - >...............\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] mod_jk.c (452): written 32 out of 32\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): received\nfrom ajp13 pos=0 len=2 max=8192\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1061): 0000   \n05 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00  - ................\n[Tue Mar 27 07:10:13 2007] [2404:3512] [debug] jk_ajp_common.c (1524): AJP13\nprotocol: Reuse is OK\n", "count": 4, "id": 101047, "time": "2007-03-27T08:55:20Z", "creator": "mturk@apache.org", "creation_time": "2007-03-27T08:55:20Z", "is_private": false}, {"count": 5, "tags": [], "creator": "glenn@apache.org", "is_private": false, "text": "Yes it works for you. But you do not even list what OS/apache/tomcat versions\nyou are using. Just because you have not been able to reproduce it yet does not\nmean that there is not a bug with mod_jk on the OS/apache/Tomcat I am using.\nClosing the bug as works for me seems a bit premature. You may recall that\nI was the release manager for mod_jk several years ago. I wouldn't have posted\nthis bug report unless I was really seeing a bug.\n\nThe reason I posted it was so that those who have been working on mod_jk since\nversion 1.2.19 might consider what changes they made which would cause this\nbug in 1.2.21.", "id": 101049, "time": "2007-03-27T09:30:13Z", "bug_id": 41949, "creation_time": "2007-03-27T09:30:13Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 41949, "text": "Well, you should then know as well that the pure fact that you said\n'it doesn't work' doesn't qualify as a legitimate bug.\n\nI tried, and it works (Apache 2.0.59, Tomcat 5.5.20),\nso you can turn on JkLogLevel to debug, hit the page and send the log\nfile. Without that it might be Tomcat 4.1, Apache, what ever...\n\nI won't mark again this as 'WORKFORSOME', but if you don't provide\na log files, how can anyone detect the problem?\n\nRegards.", "id": 101051, "attachment_id": null, "creator": "mturk@apache.org", "creation_time": "2007-03-27T10:12:56Z", "time": "2007-03-27T10:12:56Z", "is_private": false}, {"count": 7, "tags": [], "creator": "glenn@apache.org", "text": "The mod_jk log debug output was attached to this bug earlier today,\nsee comment #3 for this bug report. Here is a link to the debug output:\n\nSee http://issues.apache.org/bugzilla/attachment.cgi?id=19817\n\nThe first thing I listed in my initial bug report was the software versions\nbeing used. I will repost:\n\nFreeBSD 6.0-RELEASE-p4\napache-2.0.59\nmod_jk 1.2.21\nTomcat 4.1.30\n", "id": 101058, "time": "2007-03-27T11:16:55Z", "bug_id": 41949, "creation_time": "2007-03-27T11:16:55Z", "is_private": false, "attachment_id": null}, {"count": 8, "attachment_id": null, "bug_id": 41949, "is_private": false, "id": 101059, "time": "2007-03-27T11:32:08Z", "creator": "mturk@apache.org", "creation_time": "2007-03-27T11:32:08Z", "tags": [], "text": "What is the\n/test/dhetest.jsp\n\nYou explained that it's needed\ntest.html\ntest1.jsp\ntest2.jsp\n\nCan you attach all the test files for ROOT context?\n"}, {"count": 9, "tags": [], "text": "Created attachment 19819\nTest WAR file for JSP POST SSI bug\n\nHere is a simple war file which can be used to exhibit the bug.\nThis assumes the context is named \"test\".\n\nOne more note, in my config the webapp context is aliased into apache\nso apache can server static files, i.e. the test.shtml page. Only the\nJSP pages are forwarded to tomcat using mod_jk.", "is_private": false, "id": 101061, "creator": "glenn@apache.org", "time": "2007-03-27T12:04:00Z", "bug_id": 41949, "creation_time": "2007-03-27T12:04:00Z", "attachment_id": 19819}, {"count": 10, "tags": [], "bug_id": 41949, "text": "It breaks on Tomcat 4.1.30 on my side as well.\nHowever 5.5.x works as expected, so I suppose we have some\nprotocol error in mod_jk.", "id": 101066, "time": "2007-03-27T12:59:41Z", "creator": "mturk@apache.org", "creation_time": "2007-03-27T12:59:41Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 41949, "text": "Thanks for testing with 4.1.30 and verifying the bug.", "count": 11, "id": 101068, "time": "2007-03-27T14:13:28Z", "creator": "glenn@apache.org", "creation_time": "2007-03-27T14:13:28Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 41949, "text": "Hi,\n\nThis is a Tomcat 4.1.30 (and 4.1.31) bug\nMod_jk fix is here:\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=41610\nand the commit is here:\nhttp://svn.apache.org/viewvc/tomcat/connectors/trunk/jk/native/apache-2.0/mod_jk.c?r1=502560&r2=507923&diff_format=h\n\nSo mod_jk send Content-Length twice, once if present and other with\nContent-Length: 0. Since it was the later one that counted we always had\nContent-Length: 0.\n\nI have tested with 4.1.34 and it works like expected, so if you wish browse\nfor the fix on Java side.\n\nIf you need further discussion, address this @dev.\n", "count": 12, "id": 101082, "time": "2007-03-27T23:19:21Z", "creator": "mturk@apache.org", "creation_time": "2007-03-27T23:19:21Z", "is_private": false}, {"count": 13, "attachment_id": null, "bug_id": 41949, "is_private": false, "id": 101666, "time": "2007-04-13T09:23:11Z", "creator": "glenn@apache.org", "creation_time": "2007-04-13T09:23:11Z", "tags": [], "text": "Adding one more comment to bring this bug report to closure.\n\nThe mod_jk patch listed previously fixed another mod_jk bug but introduced this\nbug in the Ajp13Connector.\n\nBy reconfiguring your tomcat server.xml to use the CoyoteConnector with the\nJkCoyoteHandler instead of the Ajp13Connector fixes this bug on the Tomcat side."}]
[{"count": 0, "tags": [], "bug_id": 57585, "is_private": false, "text": "There must be cases were we want to Optionally include configuration files.\n\nIncludeOptional check for the folder to exists and then parses the configuration files found in it (if any) but return an error if the\ndirectory does not exists yet.\n\nAfter apr_dir_open() fails in process_resource_config_fnmatch and process_resource_config_nofnmatch, we can check for the \"optional\" arg\nand return error only if not optional.", "id": 181067, "time": "2015-02-13T20:37:46Z", "creator": "powerbsd@yahoo.com", "creation_time": "2015-02-13T20:37:46Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 57585, "attachment_id": 32472, "id": 181069, "time": "2015-02-13T20:46:25Z", "creator": "powerbsd@yahoo.com", "creation_time": "2015-02-13T20:46:25Z", "is_private": false, "text": "Created attachment 32472\nDont error when IncludeOptional refers to a non-existent directory"}, {"count": 2, "tags": [], "bug_id": 57585, "is_private": false, "text": "Created attachment 35467\nhttpd-trunk-core_include_optional_fix.patch\n\nHi Alberto,\n\nI have another version of the patch since I've tested it and stuff like the following seems not to be skipped:\n\nIncludeOptional notexisstent\n\nStill need to test it carefully but your review would surely help!\n\nLuca", "id": 201686, "time": "2017-10-26T11:10:20Z", "creator": "toscano.luca@gmail.com", "creation_time": "2017-10-26T11:10:20Z", "attachment_id": 35467}, {"count": 3, "tags": [], "bug_id": 57585, "is_private": false, "text": "So I just noticed that https://httpd.apache.org/docs/2.4/mod/core.html#includeoptional says:\n\n\"This directive allows inclusion of other configuration files from within the server configuration files. It works identically to the Include directive, with the exception that if wildcards do not match any file or directory, the IncludeOptional directive will be silently ignored instead of causing an error.\"\n\nI was brought to this task since there is an outstanding bug in Debian for mod_security in stretch:\n\nhttps://bugs.debian.org/cgi-bin/bugreport.cgi?bug=878920\n\nBasically the maintainer of libapache2-mod_security added the following:\n\n# Include OWASP ModSecurity CRS rules if installed\nIncludeOptional /usr/share/modsecurity-crs/owasp-crs.load\n\nThis causes an error but something like the following does not:\n\n# Include OWASP ModSecurity CRS rules if installed\nIncludeOptional /usr/share/modsecurity-crs/owasp-crs*.load\n\nI can see the value of this difference but is there any strong motivation to error out on the former and not on the latter?", "id": 201691, "time": "2017-10-26T13:03:43Z", "creator": "toscano.luca@gmail.com", "creation_time": "2017-10-26T13:03:43Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "powerbsd@yahoo.com", "text": "My patch has been working for almost 3 years in clearlinux\nhttps://github.com/clearlinux-pkgs/httpd/blob/master/0002-do-not-crash-when-IncludeOptional-dir-is-not-existent.patch\n\nI was new at the project so I just wrote and forget about it (my bad) I guess is time to chase the apache developers to review and include it in master.\n\nI currently do not know how to contact them (mailing list I guess) if you find the way CC me :)", "count": 4, "id": 201693, "time": "2017-10-26T14:20:18Z", "bug_id": 57585, "creation_time": "2017-10-26T14:20:18Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 57585, "is_private": false, "text": "(In reply to Alberto Murillo Silva from comment #4)\n> My patch has been working for almost 3 years in clearlinux\n> https://github.com/clearlinux-pkgs/httpd/blob/master/0002-do-not-crash-when-\n> IncludeOptional-dir-is-not-existent.patch\n> \n> I was new at the project so I just wrote and forget about it (my bad) I\n> guess is time to chase the apache developers to review and include it in\n> master.\n> \n> I currently do not know how to contact them (mailing list I guess) if you\n> find the way CC me :)\n\nWhat are the use cases that you tested to make sure that it was working? I am trying to understand an example that I can test and verify, not trying to discard your work :)\n\nYou can surely contact the dev using the https://httpd.apache.org/lists.html#http-dev mailing list, but I guess that bugzilla is fine since some of them are reading it daily (like me :).\n\nThe patch that I proposed work even if you include a non existent file, but it might be a big change in behavior that is not worth it.\n\nAnyhow, thanks for the work done!\n\nLuca", "id": 201694, "time": "2017-10-26T14:28:00Z", "creator": "toscano.luca@gmail.com", "creation_time": "2017-10-26T14:28:00Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 57585, "is_private": false, "text": "Luca you are right.\n\nIn ClearLinux:\nIncludeOptional /not/existing/dir/*.conf WORKS\nIncludeOptional /not/existing/file.conf  FAILS\n\nI guess both options should work.\n\nOur use case is:\n# Virtual hosts\nIncludeOptional /usr/share/defaults/httpd/conf.d/*.conf\nIncludeOptional /usr/share/defaults/httpd/conf.modules.d/*.conf\nIncludeOptional /etc/httpd/conf.d/*.conf\nIncludeOptional /etc/httpd/conf.modules.d/*.conf\n\nwhere /etc/httpd sometimes doesn't exist but the service successfully starts with the default page.", "id": 201695, "time": "2017-10-26T15:47:35Z", "creator": "powerbsd@yahoo.com", "creation_time": "2017-10-26T15:47:35Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 57585, "is_private": false, "text": "Hi Alberto,\n\nI just sent an email to the dev@ mailing list to see what the community thinks about this task. Let's see what are the answers :)\n\nIf you want to follow you can either register to dev@ (https://httpd.apache.org/lists.html#http-dev) or check https://lists.apache.org/list.html?dev@httpd.apache.org.\n\nLuca", "id": 201897, "time": "2017-11-04T12:17:37Z", "creator": "toscano.luca@gmail.com", "creation_time": "2017-11-04T12:17:37Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "toscano.luca@gmail.com", "attachment_id": null, "text": "Committed svn.apache.org/r1814968 to trunk, if the patch is accepted I'll also propose a backport to 2.4.x soon!", "id": 202063, "time": "2017-11-11T19:21:48Z", "bug_id": 57585, "creation_time": "2017-11-11T19:21:48Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "toscano.luca@gmail.com", "text": "Backported to 2.4.x with https://svn.apache.org/r1818964, it will be part of the next httpd release. Thanks Alberto for the help, please re-open if anything is missing!", "count": 9, "id": 202887, "time": "2017-12-21T19:37:17Z", "bug_id": 57585, "creation_time": "2017-12-21T19:37:17Z", "is_private": false}]
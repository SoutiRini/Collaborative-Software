[{"count": 0, "attachment_id": 22989, "bug_id": 46338, "is_private": false, "id": 123079, "time": "2008-12-04T06:24:56Z", "creator": "arjan.schaaf@luminis.nl", "creation_time": "2008-12-04T06:24:56Z", "tags": [], "text": "Created attachment 22989\nTest Java class\n\nWe are running into some problems after running a lot of integration tests in our build. After a lot of trail & error we ran into a situation with Ant. We suspect that this might cause our problems.\n\nWe created a simple test (see attachemts) to reproduce this problem.\nHow to test:\n1. Compile the class\n2. Run the ant script\n3. Connect to the ant process using JConsole\n\nWhat are the results?\n\n1. For each antcall to the target Blah a java process is forked.\n2. In JConsole we see at that moment that a couple of java threads are created (3 or 4)\n3. When the forked process is finished, the threads created disappear. Well, all disappear but one! For each forked process a thread remains in a blocked state.\n\nSo after many antcalls starting these forked processes the number of blocking threads starts to get out of hands.\n\nI would expect all threads associated in the ant process with the forked java process would be cleaned up after the forked process is done. It appears this is not the case.\n\nAs we suspect this being the cause of some of our nightly builds that just seem to hang after a while, we hope somebody has ideas on how to approach this subject!"}, {"count": 1, "tags": [], "creator": "arjan.schaaf@luminis.nl", "text": "Created attachment 22990\nBuild file to reproduce test", "id": 123080, "time": "2008-12-04T06:25:56Z", "bug_id": 46338, "creation_time": "2008-12-04T06:25:56Z", "is_private": false, "attachment_id": 22990}, {"count": 2, "attachment_id": null, "bug_id": 46338, "is_private": false, "id": 123090, "time": "2008-12-04T11:42:34Z", "creator": "bodewig@apache.org", "creation_time": "2008-12-04T11:42:34Z", "tags": [], "text": "Are you using the forked process' input stream in any way?  If not, can you add inputstring=\"\" to your <java> tasks and see whether it helps in any way?\n\nI suspect it is the Thread pumping input and setting inputstring to an empty string should terminate that thread immediately.\n"}, {"count": 3, "tags": [], "bug_id": 46338, "is_private": false, "text": "Thanks for the quick response. This change really helps in controlling the number of threads created.\nWouldn't it be a good idea to make this default behaviour?\n\nArjan", "id": 123235, "time": "2008-12-11T00:39:08Z", "creator": "arjan.schaaf@luminis.nl", "creation_time": "2008-12-11T00:39:08Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 46338, "is_private": false, "id": 123248, "time": "2008-12-11T20:55:39Z", "creator": "bodewig@apache.org", "creation_time": "2008-12-11T20:55:39Z", "tags": [], "text": "it would have been a good idea to make it the default behavior when we added input handling, now it would be too late (we'd break existing build files with a change).\n\n"}]
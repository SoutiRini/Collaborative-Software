[{"count": 0, "tags": [], "text": "Installed 2.0.40 using perchild on a RedHat 7.1. The config was:\n\n./configure --prefix=/usr/local/apache2 --enable-charset-lite --enable-cache\n--enable-mem-cache --enable-mime-magic \n--enable-expires --enable-headers --enable-usertrack --enable-unique-id\n--enable-proxy --enable-proxy-http --enable-ssl \n--enable-http --enable-cgi --enable-vhost-alias --enable-rewrite --enable-so\n--with-mpm=perchild\n\nAfter starting, I got httpd not responding. In error_log I got:\n[emerg] (13)Permission denied: apr_proc_mutex_unlock failed. \n\nAfter this I tried\nAcceptMutex fcntl \nin <IfModule perchild.c>\n\nNow there is no \"permission denied\", but apache is not answering. (After\ntelneting to port 80 and issuing a GET, there is just now answer, apache just\nwaits forewer.)\n\napachectl -V shows\nServer version: Apache/2.0.40\nServer built:   Aug 29 2002 23:23:57\nServer's Module Magic Number: 20020628:0\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/experimental/perchild\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/usr/local/apache2\"\n -D SUEXEC_BIN=\"/usr/local/apache2/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_LOCKFILE=\"logs/accept.lock\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\n\naccess_log is empty, error_log shows \n[Fri Aug 30 11:11:56 2002] [notice] caught SIGTERM, shutting down\n[Fri Aug 30 11:12:03 2002] [warn] Init: Session Cache is not configured [hint:\nSSLSessionCache]\n[Fri Aug 30 11:12:04 2002] [notice] Apache/2.0.40 (Unix) mod_ssl/2.0.40\nOpenSSL/0.9.6g configured -- resuming normal operations\n\nThere are quite a few httpd-s running when I issue a \"top\", but none of them is\nanswering...", "is_private": false, "id": 22021, "creation_time": "2002-08-30T09:34:27Z", "time": "2002-08-30T09:34:27Z", "creator": "concept@conceptonline.hu", "bug_id": 12187, "attachment_id": null}, {"count": 1, "tags": [], "text": "My original comment was misleading, sorry about that...\n\nApache actually LISTENS on the assigned port, and I can connect to that port, so\neverything looks all right - however, there is no output from the server after a\nGET:\n\n\n# telnet localhost 80\nTrying 127.0.0.1...\nConnected to concept.\nEscape character is '^]'.\nGET /\n\n\nAn it waits forewer. Same if I use a browser to connect (server contacted,\nwaiting for reply...)", "is_private": false, "id": 22023, "creation_time": "2002-08-30T10:58:11Z", "time": "2002-08-30T10:58:11Z", "creator": "concept@conceptonline.hu", "bug_id": 12187, "attachment_id": null}, {"count": 2, "tags": [], "text": "PerChild is not expected to work in 2.0.40.  There were some major\nchanges made after 2.0.40 that get it closer to being functional,\nbut unless you are interested in helping with the development,\nI would recommend staying away from this module for the time being.", "attachment_id": null, "bug_id": 12187, "id": 22028, "time": "2002-08-30T13:45:51Z", "creator": "slive@apache.org", "creation_time": "2002-08-30T13:45:51Z", "is_private": false}, {"count": 3, "tags": [], "text": "Bug still exists in 2.0.43,\nand I have additional info that may help.\n\nLinux Debian 2.4.18\n./configure --with-perchild\n\nStandart httpd.conf with changes below:\n---------------------------{\nAcceptMutex fcntl\nListenPort 8080\nLogLevel debug\nChildPerUserID #1001 #1001 1\nChildPerUserID #1002 #1002 1\nChildPerUserID #1003 #1003 1\nNameVirtualHost *\n<VirtualHost *>\n        ServerName test1.mydomain.ru\n        DocumentRoot \"/usr/local/apache2/htdocs\"\n        AssignUserID #1001 #1001\n</VirtualHost>\n<VirtualHost *>\n        ServerName test2.mydomain.ru\n        DocumentRoot \"/usr/local/apache2/htdocs\"\n        AssignUserID #1002 #1002\n</VirtualHost>\n<VirtualHost *>\n        ServerName test3.mydomain.ru\n        DocumentRoot \"/usr/local/apache2/htdocs\"\n        AssignUserID #1003 #1003\n</VirtualHost>\n-----------------------------------------}\n\nNow I start Apache and open log file:\n-----------------------{\nserver:/usr/local/apache2# bin/apachectl start\n[Fri Oct 11 15:17:43 2002] [debug] perchild.c(1994): filling out \nchild_info_table; UID: 1001, GID: 1001, SD: 4 4, OUTPUT: 5 5, Child Num: 0\n[Fri Oct 11 15:17:43 2002] [debug] perchild.c(1994): filling out \nchild_info_table; UID: 1002, GID: 1002, SD: 6 6, OUTPUT: 7 7, Child Num: 1\n[Fri Oct 11 15:17:43 2002] [debug] perchild.c(1994): filling out \nchild_info_table; UID: 1003, GID: 1003, SD: 8 8, OUTPUT: 9 9, Child Num: 2\nserver:/usr/local/apache2# tail -f logs/error_log \n[Fri Oct 11 15:17:43 2002] [notice] Apache/2.0.43 (Unix) configured -- resuming \nnormal operations\n[Fri Oct 11 15:17:43 2002] [info] Server built: Oct 11 2002 13:48:09\n[Fri Oct 11 15:17:43 2002] [debug] perchild.c(1405): AcceptMutex: fcntl \n(default: sysvsem)\n------------------------------------}\n\nnow I open url http://test1.mydomain.ru\nand browser stalls. error_log has news:\n------------------------{\n[Fri Oct 11 15:23:17 2002] [debug] perchild.c(1775): Determining if request \nshould be passed. Child Num: 1, SD: 11, sd from table: 13, hostname from server: \ntest1.mydomain.ru\n[Fri Oct 11 15:23:17 2002] [debug] perchild.c(1784): Passing request.\n[Fri Oct 11 15:23:17 2002] [debug] perchild.c(1639): passing request to another \nchild.  Vhost: test1.mydomain.ru:8080, child 1 12\n[Fri Oct 11 15:23:17 2002] [debug] perchild.c(1692): Writing message to 12, \npassing sd:  29\n[Fri Oct 11 15:23:17 2002] [debug] perchild.c(1702): Writing message succeeded \n47\n------------------}\nI try anotuer url http://test2.mydomain.ru\nand I'm lucky - browse several pages\n----------------{\n[Fri Oct 11 15:25:57 2002] [debug] perchild.c(1775): Determining if request \nshould be passed. Child Num: 1, SD: 13, sd from table: 13, hostname from server: \ntest2.mydomain.ru\n[Fri Oct 11 15:26:03 2002] [debug] perchild.c(1775): Determining if request \nshould be passed. Child Num: 1, SD: 13, sd from table: 13, hostname from server: \ntest2.mydomain.ru\n[Fri Oct 11 15:26:10 2002] [debug] perchild.c(1775): Determining if request \nshould be passed. Child Num: 1, SD: 13, sd from table: 13, hostname from server: \ntest2.mydomain.ru\n-------------------}\nthe third domain http://test3.mydomain.ru\nleads to stall again\n-------------------{\n[Fri Oct 11 15:27:46 2002] [debug] perchild.c(1775): Determining if request \nshould be passed. Child Num: 1, SD: 18, sd from table: 13, hostname from server: \ntest3.mydomain.ru\n[Fri Oct 11 15:27:46 2002] [debug] perchild.c(1784): Passing request.\n[Fri Oct 11 15:27:46 2002] [debug] perchild.c(1639): passing request to another \nchild.  Vhost: test3.mydomain.ru:8080, child 1 19\n[Fri Oct 11 15:27:46 2002] [debug] perchild.c(1692): Writing message to 19, \npassing sd:  29\n[Fri Oct 11 15:27:46 2002] [debug] perchild.c(1702): Writing message succeeded \n53\n---------------}\n\nIf I stop/start server I can be lucky with other domain.\n\nAlso there is a bug with cgi-scripts.\nI browse to http://test2.mydomain.ru/cgi-bin/printenv\nand see \"503 Service Temporarily Unavailable\" error.\nerror_log shows:\n---------------{\n[Fri Oct 11 15:32:04 2002] [error] [client 10.110.64.45] (13)Permission denied: \nunable to connect to cgi daemon after multiple tries: \n/usr/local/apache2/cgi-bin/printenv\n---------------}\n\nbut it works all right once I\nserver:/usr/local/apache2# chmod 777 logs/cgisock\n\nAlso if I try the shell script 'showid':\n---------{\n#!/bin/sh\necho \"Content-type: text/html\\n\\n\"\nid\n-------}\nas http://test2.mydomain.ru/cgi-bin/showid\nit says: \"uid=65534(nobody) gid=4294967295 groups=4294967295 \"\ni.e. default\nUser nobody\nGroup #-1\nBut I expect it to be \"uid=1002 gid=1002 groups=1002\" because of\nAssignUserID #1002 #1002\nin appropriate virtual section of apahce config.\nSo apache calls cgi-scripts under common user/group account.\nBut it opens html files under specific (from AssignUserID) account. I tested it \nby\n-------{\nserver:/usr/local/apache2/htdocs# cp index.html.en test2.htm\nserver:/usr/local/apache2/htdocs# chown 1002 test2.htm \nserver:/usr/local/apache2/htdocs# chmod 600 test2.htm \n-------}\nand it opens all right as\nhttp://test2.mydomain.ru/test2.htm\nwhile http://test2.mydomain.ru/test1.htm and http://test2.mydomain.ru/test3.htm \nfailed to open.\n\nWell, one more note regarding\nChildPerUserID user_id group_id child_id\ndirective.\nAccording to the docs (http://httpd.apache.org/docs-2.0/mod/perchild.html) \nchild_id means which one child is to be assigned to user_id and group_id.\nI.e.\nChildPerUserID user1 group1 4\nChildPerUserID user2 group2 5\nmeans that fourth child is assigned to user1 and fifth child is assigned to \nuser2. That doesn't correspond with practice. Abovementioned example with \nchildid 4 and childid 5 leads to \"Trying to use more child ID's than \nNumServers.\" error. childid 3 and 4 also fails, 2 and 3 work all right. As a \nsurprise 3 and 3 also work all right. So as I see the sum of all childid \nparameters in all ChildPerUserID should be <= (NumServers + 1). For the previous \nApache (2.0.40 and 2.0.36) it had to be <= NumServers.\n\nHope you could find a developers' time to have a look at these bugs. As I guess \nthe perchild is a much wanted module for small shared-hosting companies like \nmine. So I personally looking forward for it since 2.0.36\n\nIf you need more info about abovementioned bugs I'm more than pleased to help.\nThank you for Apache.", "attachment_id": null, "bug_id": 12187, "id": 24351, "time": "2002-10-11T12:28:03Z", "creator": "admin@3in1hosting.com", "creation_time": "2002-10-11T12:28:03Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 12187, "attachment_id": null, "text": "I have fixed the docs to represent what the directive does.  As for the\noccaisional hanging.  I have seen this, but I have been unable to find the\ncause.  I am continuing to look for it.", "id": 24358, "time": "2002-10-11T15:24:44Z", "creator": "rbb@apache.org", "creation_time": "2002-10-11T15:24:44Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "trawick@apache.org", "is_private": false, "count": 5, "id": 26876, "time": "2002-11-23T18:23:45Z", "bug_id": 12187, "creation_time": "2002-11-23T18:23:45Z", "text": "Please download the latest perchild.c from\n\nhttp://cvs.apache.org/viewcvs.cgi/httpd-2.0/server/mpm/experimental/perchild/perchild.c\n\nand try again.\n\nSome nasty bugs in perchild were fixed after 2.0.43.  It seems likely that this\nproblem is already fixed.\n"}, {"count": 6, "tags": [], "creator": "newton@aggressive.com", "attachment_id": null, "id": 27836, "time": "2002-12-14T19:39:07Z", "bug_id": 12187, "creation_time": "2002-12-14T19:39:07Z", "is_private": false, "text": "I am using latest perchild.c from CVS, and Apache still hangs. There is my \nvhost config:\nChildPerUserId mlj mlj 1\nNameVirtualHost 66.162.74.11:80\n<VirtualHost 66.162.74.11:80>\n        ServerName mydomain.com\n        ServerAlias www.mydomain.com mydomain.com\n        ServerAdmin webmaster@mydomain.com\n        DocumentRoot /home/mlj/public_html\n        ScriptAlias /cgi-bin/ /home/mlj/public_html/cgi-bin/\n        DirectoryIndex index.htm index.html index.n\n        CustomLog /home/mlj/logs/mydomain.com combined\n        ErrorLog /home/mlj/logs/mydomain.com-errors\n        ScriptLog /home/mlj/logs/mydomain.com-scripts\n        AddType application/x-httpd-php .n\n\tAssignUserID mlj mlj\n</VirtualHost>\nNameVirtualHost 66.162.74.11:443\n<VirtualHost 66.162.74.11:443>\n        ServerName mydomain.com\n        ServerAlias www.mydomain.com mydomain.com\n        ServerAdmin support@mydomain.com\n        DocumentRoot /home/mlj/public_html\n        <Directory /home/mlj/public_html/cgi-bin/>\n               Options ExecCGI\n        </Directory>\n        ScriptAlias /cgi-bin/ /home/mlj/public_html/cgi-bin/\n        AddType application/x-httpd-php .n\n        AssignUserID mlj mlj\n        DirectoryIndex index.htm index.html index.n\n        CustomLog /home/mlj/logs/mydomain.com-secure combined\n        ErrorLog /home/mlj/logs/mydomain.com-errors\n        SSLVerifyClient none\n        SSLEngine on\n        SSLOptions StdEnvVars\n        SSLCertificateFile /usr/local/etc/apache/ssl.crt/mydomain.com.crt\n        SSLCertificateKeyFile /usr/local/etc/apache/ssl.key/mydomain.com.key\n        ScriptLog /home/mlj/logs/mydomain.com-scripts\n        CustomLog /home/mlj/logs/mydomain.com-ssl \"%t %h %{SSL_PROTOCOL}x %\n{SSL_CIPHER}x \\\"%r\\\" %b\"\n</VirtualHost>\n\nWith this config, only SSL vhost is working dine, but first fails (80 port is \nconnecting, but client waitng for response forever). If I comment second vhost \nlines, it is also not working unless I also comment ChildPerUserId and \nAssignUserId directives. "}, {"count": 7, "tags": [], "creator": "pb@bieringer.de", "attachment_id": null, "id": 29973, "time": "2003-01-23T21:47:07Z", "bug_id": 12187, "creation_time": "2003-01-23T21:47:07Z", "is_private": false, "text": "Me to, trying 2.0.44 on Linux with proper mutex configured (see 11000).\nAfter some first requests after fresh start, Apache2 hangs, responding chars on telnetting, but give no answers anymore after 2x CR/LF.\n"}, {"count": 8, "tags": [], "creator": "kamil@666.afraid.org", "attachment_id": null, "id": 50515, "time": "2004-01-14T00:58:38Z", "bug_id": 12187, "creation_time": "2004-01-14T00:58:38Z", "is_private": false, "text": "I have this same problem with apache 2.0.48. "}, {"count": 9, "tags": [], "creator": "anthony@kilna.com", "attachment_id": null, "id": 54511, "time": "2004-03-23T22:03:00Z", "bug_id": 12187, "creation_time": "2004-03-23T22:03:00Z", "is_private": false, "text": "I have reproduced this on 2.0.49.  I have a lot of logging going on, and out of \ncuriousity I ran 'lsof' and it seems apache is opening all log files on all \nprocesses, regardless of AssignUserID in the VirtualHost directive.  The \nprocesses are running as the appropriate users, but they're all trying to open \neach other's log files in addition to their own.  I'm running this off a User \nMode Linux \"box\" on a virtual hosting provider, and they probably have my \navailable file descriptors down lower than the usual (though since every \nprocess is opening every log they get eaten up pretty quickly).  I tried using \nthe most recent perchild.c and mpm_common.h and mpm_common.c from cvs but it \nwon't compile and I'm not proficient enough to figure out why not.  But it \nlooks like the most recent ones address issues with FD_SETSIZE (but I don't \nknow if that does anything for the fact that its keeping the wrong files open \nin the first place)."}, {"count": 10, "tags": [], "bug_id": 12187, "attachment_id": null, "text": "I tried turning off logging for all of the VirtualHosts and the blocking problem \nstill happens.  lsof still shows all of the processes under the other users \nstill trying to get at the base server's logs.  So I went a step further, \ndisabling all logging whatsoever even seding the ErrorLog to /dev/null so there \nwere no open files for writing that weren't owned by the user that the processes \nwere supposed to run as, and it didn't help, the server still won't do anything \nupon connect.  However, in paring it down I noticed lsof entries like...\n\nhttpd     18998   user1   61w   REG       98,0       0     297966 \n/apache2/logs/accept.lock.18974 (deleted)\nhttpd     18996   user2   61w   REG       98,0       0     297966 \n/apache2/logs/accept.lock.18974 (deleted)\n\nFor all users which had AssignUserIDs.  I don't know if any of this information \nwill be helpful, I hope it will.  Perchild would be very good for my situation \nbut right now its not just experimental, its completely broken.  I'm willing to \ndo anything I can (testing, etc) to help but unfortunately my expertise isn't in \nthis area.  Thanks.\n", "id": 54517, "time": "2004-03-23T23:36:31Z", "creator": "anthony@kilna.com", "creation_time": "2004-03-23T23:36:31Z", "is_private": false}, {"count": 11, "tags": [], "creator": "chip@force-elite.com", "attachment_id": null, "id": 62744, "time": "2004-08-30T10:11:52Z", "bug_id": 12187, "creation_time": "2004-08-30T10:11:52Z", "is_private": false, "text": "The Perchild MPM is not supported, and it is not being futher developed."}]
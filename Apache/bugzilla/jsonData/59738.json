[{"count": 0, "tags": [], "creator": "adrodoc55@googlemail.com", "is_private": false, "id": 191861, "creation_time": "2016-06-21T11:42:36Z", "time": "2016-06-21T11:42:36Z", "bug_id": 59738, "text": "Created attachment 33969\nError in Excel\n\nExcel Files generated using XSSFWorkbook can't be opened using Ms-Excel or OpenOffice. POI can read those files.\n\nI used the official BusinessPlan example from the POI website: https://poi.apache.org/spreadsheet/examples.html#business-plan\n\nThe xls file generated by this example works fine in all versions, but the xlsx file can't be opened when using POI 3.11 or higher (including 3.14). POI 3.10.1 works fine.\n\nEven an empty worbook (with just one sheet) cannot be opened when using xssf, but works fine in hssf:\n\nString format = \"xlsx\";\nFile outputFile = new File(\"C:/temp/output.\" + format);\nWorkbook wb = new XSSFWorkbook();\nwb.createSheet();\ntry (FileOutputStream fileOutputStream = new FileOutputStream(outputFile);) {\n  wb.write(fileOutputStream);\n}", "attachment_id": 33969}, {"count": 1, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "is_private": false, "id": 191862, "time": "2016-06-21T13:04:32Z", "bug_id": 59738, "creation_time": "2016-06-21T13:04:32Z", "text": "Does it work if you specify a sheet-name in the call to createSheet()?"}, {"count": 2, "tags": [], "bug_id": 59738, "text": "(In reply to Dominik Stadler from comment #1)\n> Does it work if you specify a sheet-name in the call to createSheet()?\n\nNo it does not.\nI have tried many different variants, and multiple of the official examples and both Ms-Excel and OpenOffice can't open any xlsx files that were created by a poi version 3.11 or above.", "id": 191866, "time": "2016-06-21T15:16:48Z", "creator": "adrodoc55@googlemail.com", "creation_time": "2016-06-21T15:16:48Z", "is_private": false, "attachment_id": null}, {"count": 3, "text": "Are you using the same version of poi, poi-ooxml, and poi-ooxml-schemas?\n\nDoes wb.write throw an exception?", "bug_id": 59738, "attachment_id": null, "id": 191870, "time": "2016-06-21T16:37:27Z", "creator": "onealj@apache.org", "creation_time": "2016-06-21T16:37:27Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 59738, "text": "(In reply to Javen O'Neal from comment #3)\n> Are you using the same version of poi, poi-ooxml, and poi-ooxml-schemas?\n> \n> Does wb.write throw an exception?\n\nI am using v3.14 of poi-ooxml and v1.3 of ooxml-shemas. I use Gradle to resolve transitive dependencies. I also tried all major versions between 3.9 and 3.14, but only 3.9 and 3.10.1 are working.\nI don't get any Exceptions in Java, only Ms-Excel and OpenOffice are telling me that the generated xlsx files are corrupted. I don't think it is an issue with Ms-Excel or OpenOffice, because they can open other xlsx files.", "id": 191878, "time": "2016-06-21T19:12:44Z", "creator": "adrodoc55@googlemail.com", "creation_time": "2016-06-21T19:12:44Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 59738, "attachment_id": null, "id": 191881, "time": "2016-06-22T09:50:58Z", "creator": "kiwiwings@apache.org", "creation_time": "2016-06-22T09:50:58Z", "is_private": false, "text": "First of all, this sounded too fantastic, that all versions since 3.11 can't generate usual .xlsx files - ... and actually, I've just tried the businessplan with LO/Excel/ExcelViewer, just to be sure ...\n\nTo investigate this we could either look what's wrong with the gradle build or maybe we can find the error, if you attach your resulting businessplan .xlsx of POI 3.10 and 3.14.\n\nMy guess is, that there are either duplicates jars in the classpath / dependencies or the wrong ooxml-schemas (ooxml-schemas-1.3.jar for POI 3.14 or later, ooxml-schemas-1.1.jar for POI 3.7 up to POI 3.13).\n\nCan you package your example application and list the dependencies?\n\n(maybe we can spot something like a wrong version of xerces/saxon/xmlbeans/xmlbeans-xpath ..)"}, {"count": 6, "text": "(In reply to Andreas Beeker from comment #5)\n> First of all, this sounded too fantastic, that all versions since 3.11 can't\n> generate usual .xlsx files - ... and actually, I've just tried the\n> businessplan with LO/Excel/ExcelViewer, just to be sure ...\n> \n> To investigate this we could either look what's wrong with the gradle build\n> or maybe we can find the error, if you attach your resulting businessplan\n> .xlsx of POI 3.10 and 3.14.\n> \n> My guess is, that there are either duplicates jars in the classpath /\n> dependencies or the wrong ooxml-schemas (ooxml-schemas-1.3.jar for POI 3.14\n> or later, ooxml-schemas-1.1.jar for POI 3.7 up to POI 3.13).\n> \n> Can you package your example application and list the dependencies?\n> \n> (maybe we can spot something like a wrong version of\n> xerces/saxon/xmlbeans/xmlbeans-xpath ..)\n\nI can send you a full example project including gradle wrapper tomorrow. Did you not manage to reproduce my error?", "creator": "adrodoc55@googlemail.com", "is_private": false, "id": 191893, "time": "2016-06-22T18:55:27Z", "bug_id": 59738, "creation_time": "2016-06-22T18:55:27Z", "tags": [], "attachment_id": null}, {"count": 7, "tags": [], "creator": "adrodoc55@googlemail.com", "text": "(In reply to Andreas Beeker from comment #5)\n> First of all, this sounded too fantastic, that all versions since 3.11 can't\n> generate usual .xlsx files - ... and actually, I've just tried the\n> businessplan with LO/Excel/ExcelViewer, just to be sure ...\n> \n> To investigate this we could either look what's wrong with the gradle build\n> or maybe we can find the error, if you attach your resulting businessplan\n> .xlsx of POI 3.10 and 3.14.\n> \n> My guess is, that there are either duplicates jars in the classpath /\n> dependencies or the wrong ooxml-schemas (ooxml-schemas-1.3.jar for POI 3.14\n> or later, ooxml-schemas-1.1.jar for POI 3.7 up to POI 3.13).\n> \n> Can you package your example application and list the dependencies?\n> \n> (maybe we can spot something like a wrong version of\n> xerces/saxon/xmlbeans/xmlbeans-xpath ..)\n\nThanks, you were right :)\nI was able to track down the problem to my xalan library. I had 'xalan:xalan:2.4.0' in my classpath, because that is used in our application server. Luckily I don't actually need that dependency and can just remove it.\nI still created a git repository containing everything to create corrupted xlsx files, if you want to investigate. All you have to do is open a command line and run 'gradlew run' or './gradlew run' to create a new businessplan.xlsx.\nA corupted one is already checked into the repo aswell.\nPlease tell me when you no longer need the repo so I can delete it.", "id": 191906, "attachment_id": null, "bug_id": 59738, "creation_time": "2016-06-23T09:43:43Z", "time": "2016-06-23T09:43:43Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 59738, "text": "Where can the project be accessed? You can also zip it up and attach it here if you want.", "id": 191910, "time": "2016-06-23T12:09:13Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-06-23T12:09:13Z", "is_private": false, "attachment_id": null}, {"count": 9, "text": "(In reply to Dominik Stadler from comment #8)\n> Where can the project be accessed? You can also zip it up and attach it here\n> if you want.\n\nUps I forgot to post the link: https://github.com/Adrodoc55/poi-xalan-bug", "bug_id": 59738, "attachment_id": null, "id": 191917, "time": "2016-06-23T15:47:01Z", "creator": "adrodoc55@googlemail.com", "creation_time": "2016-06-23T15:47:01Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": 34061, "is_private": false, "id": 192573, "time": "2016-07-22T13:19:49Z", "bug_id": 59738, "creation_time": "2016-07-22T13:19:49Z", "text": "Created attachment 34061\nDifference that causes Excel to report the file as \"broken\"\n\nIt seems with Xalan you get some different XML parser as well and this way the namespace handling is broken, see the attached image."}, {"count": 11, "tags": [], "bug_id": 59738, "attachment_id": null, "id": 192615, "time": "2016-07-24T20:30:14Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-07-24T20:30:14Z", "is_private": false, "text": "I did some more investigation and it looks like in your case there was an old version of the Xml Parser pulled in which does not support namespaces.\n\nSee class DocumentHelper.createDocument(), where we use classes from javax.xml.parsers to create an DOM XML Document. \n\nI could not find an easy way to check or force the use of namespaces here, so for now I don't think we can do much inside POI here. \n\nTherefore I am closing this as WONTFIX for now, please reopen if you have an idea how we can at least fail with a better error message in such cases."}, {"count": 12, "tags": [], "bug_id": 59738, "text": "I am fine with this beeing closed as wontfix. Thanks to your help I was able to fix the classpath. Even if there was a way to check the namespace handling of the XML parser it's not really subject to the poi implementation to check whether the classpath is correct. I think something like notabug would be even more  appropriate than wontfix.", "id": 192616, "time": "2016-07-24T23:39:08Z", "creator": "adrodoc55@googlemail.com", "creation_time": "2016-07-24T23:39:08Z", "is_private": false, "attachment_id": null}]
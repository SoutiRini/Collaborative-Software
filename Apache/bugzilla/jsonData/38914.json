[{"count": 0, "tags": [], "bug_id": 38914, "attachment_id": null, "text": "OS: Cmd line prompt on Windows XP Home, SP1\n\nOther environment variables:\n\nANT_HOME=C:\\apache-ant-1.6.5\nJAVA_HOME=C:\\jdk1.5.0_04\nJBOSS_HOME=C:\\jboss-4.0.3SP1\nJBOSS_HOME_OLD=C:\\jboss-4.0.2\nJDK_HOME=C:\\jdk1.5.0_04\nPath=C:\\apache-ant-1.6.5\\bin;C:\\jdk1.5.0_04\\bin;C:\\Perl\\bin\\;c:\\My Program\nFiles\\mks\\mksnt;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\Program\nFiles\\Common Files\\Adaptec Shared\\System;c:\\My Program Files\\cwibin;\"C:\\Program\nFiles\\Norton SystemWorks\\Norton\nGhost\\\";C:\\apache-ant-1.6.5\\bin;C:\\jdk1.5.0_04\\bin;C:\\Perl\\bin\\;c:\\My Program\nFiles\\mks\\mksnt;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\Program\nFiles\\Common Files\\Adaptec Shared\\System;c:\\My Program Files\\cwibin;\"C:\\Program\nFiles\\Norton SystemWorks\\Norton Ghost\\\";C:\\apache-ant-1.6.5\\bin;.\n\nBuild.xml file:\n--------------- BEG build.xml ---------\n<project default=\"compile\">\n\n\t<target name=\"init\" description=\"initialization stuff\">\n\t\t<echo>FAKE init step</echo>\n\t</target>\n\t\n\t<target name=\"compile\" description=\"compile java stuff step\"\n\t\tdepends=\"init\">\n\t\t<echo>FAKE compile step</echo>\n\t</target>\n\n</project>\n--------------- END build.xml ---------\n\nRepeat by:\n\n1. \"ant -p\" WORKS\n\tset classpath=\"c:\\jdk1.5.0_04\\lib\\tools.jar\"  \n\tset classpath\nCLASSPATH=\"c:\\jdk1.5.0_04\\lib\\tools.jar\" \n\tant -p\n\t// works.. displays the 2 targets\n--------- BEG ANT OUTPUT -----------------\nBuildfile: build.xml\n\nMain targets:\n\n compile  compile java stuff step\n init     initialization stuff\nDefault target: compile\n--------- END ANT OUTPUT -----------------\n\n2. \"ant -p\" FAILS\n\n\tset classpath=\"\"\n\tset classpath\nCLASSPATH=\"\"\n\tant -p\n\t// fails.. actually runs the echo steps inside the ant file\n--------- BEG ANT OUTPUT -----------------\nBuildfile: build.xml\n\ninit:\n     [echo] FAKE init step\n\ncompile:\n     [echo] FAKE compile step\n\nBUILD SUCCESSFUL\nTotal time: 0 seconds\n--------- END ANT OUTPUT -----------------\n\n\t\n3. INTERESTING OBSERVATION.\n   (another ant option broken)\n   When CLASSPATH=\"\", then\n\tant -?\n   fails to display help usage, and behaves like I typed \"ant\"\n   to run a build. So when CLASSPATH=\"\", not only is \"ant -p\" flawed,\n   but so is \"ant -?\" command.\n\n\n4. MY QUESTION FOR THE ANT DEVELOPERS:\n\nSo maybe ant should look at the CLASSPATH env string manually\nto see if it looks reasonable ??\n\nOr do some API call that could indirectly tell if the tools.jar\nis in the classpath?  (The code in the commons logging API\nappears to do something like this.. but I am confused by it..it is too\nadvanced stuff for me ).\n\nI was reading on the web somewhere that ant requires the tools.jar\nfile in the classpath.. well, if this is the case.. why doesn't\nant complain when CLASSPATH=\"\" , since tools.jar is not there ???\nHmmm... strange ... indeed.\n\n5. PS: I checked the book:\n\t\"Ant - The definitive Guide\" 2nd edition of book (page 3),\n\tand they don't mention anything about setting the\n\tCLASSPATH enviroment variable ....", "id": 86656, "time": "2006-03-10T04:26:29Z", "creator": "dennis.bednar@comcast.net", "creation_time": "2006-03-10T04:26:29Z", "is_private": false}, {"count": 1, "tags": [], "creator": "kevin.jackson@it.fts-vn.com", "attachment_id": null, "text": "I've just confirmed this issue with the ant code base (trunk).\n\nIf you have no CLASSPATH variable at all, ant -p/-projecthelp works fine\nIf you set CLASSPATH=\"\", ant -p jsut executes the default target\nIf you set CLASSPATH to some meaningful value, ant -p/-projecthelp works fine\n\nI think this is to do with Windows not allowing you to easily 'unset' an\nenvironment variable.  Obviously with a CLASSPATH=\"\", something is going screwy\nwith Ant\n\nAs to the 'Ant must have tools.jar etc etc', Java5 (Java6rc and probably\nJava1.4) is tightly integrated into Windows (moreso than previously).  I've come\nacross this problem when wanting to have different versions of Java installed\nand testing against them - JAVA_HOME=d:\\java\\jdk1.4.1, but my machine still\nthinks that java -version = 1.6.0-rc1 - I think that there may be a registry\nissue here with the newer versions of Java looking in the registry (on Windows\nXP) instead of honouring the JAVA_HOME env veriable.  I've never had any problem\non Linux - just change JAVA_HOME and you are using a new/old Java - WindowsXP +\nJava5+ exhibit a very different behaviour in my experience\n\nDennis:\n\nTry with no CLASSPATH variable at all - you should be fine, setting CLASSPATH=\"\"\nin Windows is obviously not 'unsetting' the value and causing some ant\nstrangeness.  I'll try to track down the issue as I'm on XP here at work", "id": 86657, "time": "2006-03-10T05:09:19Z", "bug_id": 38914, "creation_time": "2006-03-10T05:09:19Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 38914, "text": "(In reply to comment #1)\n> I've just confirmed this issue with the ant code base (trunk).\n> \n> If you have no CLASSPATH variable at all, ant -p/-projecthelp works fine\n> If you set CLASSPATH=\"\", ant -p jsut executes the default target\n> If you set CLASSPATH to some meaningful value, ant -p/-projecthelp works fine\n> \n> I think this is to do with Windows not allowing you to easily 'unset' an\n> environment variable.  Obviously with a CLASSPATH=\"\", something is going screwy\n> with Ant\n> \n> As to the 'Ant must have tools.jar etc etc', Java5 (Java6rc and probably\n> Java1.4) is tightly integrated into Windows (moreso than previously).  I've come\n> across this problem when wanting to have different versions of Java installed\n> and testing against them - JAVA_HOME=d:\\java\\jdk1.4.1, but my machine still\n> thinks that java -version = 1.6.0-rc1 - I think that there may be a registry\n> issue here with the newer versions of Java looking in the registry (on Windows\n> XP) instead of honouring the JAVA_HOME env veriable.  I've never had any problem\n> on Linux - just change JAVA_HOME and you are using a new/old Java - WindowsXP +\n> Java5+ exhibit a very different behaviour in my experience\n> \n> Dennis:\n> \n> Try with no CLASSPATH variable at all - you should be fine, setting CLASSPATH=\"\"\n> in Windows is obviously not 'unsetting' the value and causing some ant\n> strangeness.  I'll try to track down the issue as I'm on XP here at work\n\n\nI have 3 comments:\n\n1. Since then I've discovered how to \"unset an enviroment variable in DOS CMD\n   window:\n      set classpath=\n   this will remove the classpath environment variable.\n\n2. Besides \"ant -p\" running the default target, so does \"ant -?\"\n   So it appears that the command line option is being ignored,\n   even though its really some quirk with the enviroment variable...\n   Weird.\n\n3. These 2 are different:\n    set classpath=\"foo\"\n    set classpath=foo\n   In unix (i think, don't have a Linux handy here to test it), unix\n   strips off the double quotes.. but Windows XP doesn't.  You can prove\n   this by typing\n     set classpath\n   to display the current value, the first case displays \"foo\" while the\n   second case displays foo\n\n   \n", "id": 86672, "time": "2006-03-10T11:59:53Z", "creator": "dennis.bednar@comcast.net", "creation_time": "2006-03-10T11:59:53Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 38914, "text": "Regarding the java version (remark from kev): Did you also set your PATH\naccordingly. the java executable is not selected via JAVA_HOME but via your\npath, and lacking that <some magic, maybe registry>.\n\n\nRegarding the reported issue:\nmaybe when specifying explicitly no classpath, the wrapper takes -p \n(or -?, or whatever comes first) as the classpath in your case?\n\nWhen I try to reproduce on XP home SP2 I get the following \nURISyntaxException : Illegal character in path at index 46:\nfile:/D:/data/eclipseworkspace/ant-trunk/dist/\"", "id": 86693, "time": "2006-03-10T19:57:09Z", "creator": "jkf@apache.org", "creation_time": "2006-03-10T19:57:09Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 38914, "text": "(In reply to comment #3)\n> Regarding the java version (remark from kev): Did you also set your PATH\n> accordingly. the java executable is not selected via JAVA_HOME but via your\n> path, and lacking that <some magic, maybe registry>.\n\nYes.. my PATH environment variable is set, so that javac and\njava can be found.\nLook at the very top of this message, where I showed my\nentire PATH environment variable.\nI have MKS tooklit installed, and I ran \"which javac\" (to find\nout which version of a file is being executed from the PATH)\nand got this:\n   C:\\jdk1.5.0_04\\bin/javac.exe\nand I ran \"which java\" and got this:\n   C:\\jdk1.5.0_04\\bin/java.exe\n\n\n> \n> \n> Regarding the reported issue:\n> maybe when specifying explicitly no classpath, the wrapper takes -p \n> (or -?, or whatever comes first) as the classpath in your case?\n> \n> When I try to reproduce on XP home SP2 I get the following \n> URISyntaxException : Illegal character in path at index 46:\n> file:/D:/data/eclipseworkspace/ant-trunk/dist/\"\n\nI'm still running XP Home SP1 and need to upgrade on this PC.\n(I tried to upgrade a year ago, and it messed up my pc, and I had\nto revert to SP1.)\nLets' be clear on what you were testing.. you were doing this, right? :\n  set classpath=\"\"\n  ant -p\n  ant -?\nAgain, in my case, I saw the output of a normal \"ant\" command\nwithout any options, ie, it ran instructions for the default target.\n\nFinally, I ran \"which ant\" and saw this:\n  C:\\apache-ant-1.6.5\\bin/ant.bat\nI wonder if its because its a BAT script and not an EXE file,\nthat may have something to do with the problem ?? (Just a wild thought.)\n\nI have another PC here that has SP2 installed.. and I plan to try it\nthere later today ... ", "id": 86737, "time": "2006-03-12T16:41:05Z", "creator": "dennis.bednar@comcast.net", "creation_time": "2006-03-12T16:41:05Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "(In reply to comment #1)\n> I've just confirmed this issue with the ant code base (trunk).\n> \n> \nI think its a bug in the ant.bat script (tested on XP Home SP1):\n\nI cd'ed into ANT_HOME_1.6.5\\bin\\ and copied ant.bat to antDebug.bat\nand then changed 1st line from\n   @echo off\nto\n   @echo on\nThen I ran\n    antDebug -p\nwith 2 cases (a = bad, b = good)\n   a) set classpath=\"\"\n   b) set classpath=\nin the bad case (a), there is a\n   -cp \"\"\"\"\"\nargument which looks odd to me..\n\n\nTest result a)\n--------------\n   set classpath=\"\"\n   antDebug -p\nand eventually I see this:\n \n--- BEG CLIPPED OUTPUT ----\nC:\\temp\\ant.bug>if not \"\"\"\" == \"\" goto runAntWithClasspath \n\nC:\\temp\\ant.bug>\"C:\\jdk1.5.0_04\\bin\\java.exe\"  -classpath\n\"C:\\apache-ant-1.6.5\\lib\\ant-launcher.jar\" \"-Dant.home=C:\\apache-ant-1.6.5\"\norg.apache.tools.ant.launch.Launcher  -cp \"\"\"\" -p \nBuildfile: build.xml\n\ninit:\n     [echo] FAKE init step\n\ncompile:\n     [echo] FAKE compile step\n     [echo] building Hello.jar\n\nBUILD SUCCESSFUL\nTotal time: 0 seconds\n\nC:\\temp\\ant.bug>goto end \n------------ END CLIPPED OUTPUT ---------\n\n\nTest case b)\n------------\nBut if I unset the classpath:\n  set classpath=\nand run\n  antDebug -p\nI see that the actual execution path is different (the -cp \"\"\"\"\" is left out):\n\n----------- BEG CLIPPED OUTPUT ------------\nC:\\temp\\ant.bug>if \"yes\" == \"no\" goto runAntNoClasspath \n\nC:\\temp\\ant.bug>if not \"\" == \"\" goto runAntWithClasspath \n\nC:\\temp\\ant.bug>\"C:\\jdk1.5.0_04\\bin\\java.exe\"  -classpath\n\"C:\\apache-ant-1.6.5\\lib\\ant-launcher.jar\" \"-Dant.home=C:\\apache-ant-1.6.5\"\norg.apache.tools.ant.launch.Launcher  -p \nBuildfile: build.xml\n\nMain targets:\n\n compile  compile java stuff step and builds ${jarfile}\n init     initialization stuff\nDefault target: compile\n\nC:\\temp\\ant.bug>goto end \n----------- END CLIPPED OUTPUT ------------", "attachment_id": null, "id": 86772, "creator": "dennis.bednar@comcast.net", "time": "2006-03-13T16:07:32Z", "bug_id": 38914, "creation_time": "2006-03-13T16:07:32Z", "is_private": false}, {"count": 6, "tags": [], "text": "Created attachment 17889\ndiff -u patch for ant.bat to fix classpath=\"\" problem\n\nThis is a patch that will work around the problem.  In the case that CLASSPATH\nis set to the value \"\" ant.bat will still use the AntNoClasspath option.", "attachment_id": 17889, "id": 86782, "creator": "BBurgess@tiaa-cref.org", "time": "2006-03-13T18:28:53Z", "bug_id": 38914, "creation_time": "2006-03-13T18:28:53Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 38914, "text": "Created attachment 17890\nAn already patched ant.bat file", "id": 86783, "time": "2006-03-13T18:36:48Z", "creator": "BBurgess@tiaa-cref.org", "creation_time": "2006-03-13T18:36:48Z", "is_private": false, "attachment_id": 17890}, {"count": 8, "tags": [], "bug_id": 38914, "text": "(In reply to comment #7)\n> Created an attachment (id=17890) [edit]\n> An already patched ant.bat file\n> \n\nThanks.. I put your complete ant.bat attachment into ANT_HOME_1.6.5\\bin\\ \nfolder, and confirmed that it DOES CORRECTLY Fix the problem\nthat I reported earlier (tested on XP Home SP1):\n  Set classpath=\"\"\n  ant -p\nnow prints the description of the targets like it should.\n\n\n", "id": 86784, "time": "2006-03-13T18:54:53Z", "creator": "dennis.bednar@comcast.net", "creation_time": "2006-03-13T18:54:53Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 38914, "attachment_id": null, "id": 86786, "time": "2006-03-13T19:51:41Z", "creator": "mbenson@apache.org", "creation_time": "2006-03-13T19:51:41Z", "is_private": false, "text": "That's great, but if you mark as resolved fixed before anyone commits the change\nit won't help you much.  ;)"}, {"count": 10, "tags": [], "bug_id": 38914, "attachment_id": null, "id": 86787, "time": "2006-03-13T20:32:27Z", "creator": "jkf@apache.org", "creation_time": "2006-03-13T20:32:27Z", "is_private": false, "text": "In windows the classpath MUST NOT be surrounded with \", several experiments on\nwindows and unix show that a classpath containing \" is either invalid (windows,\nbecause files containing \" are not allowed) or perfectly legal (*nix for instance)\n\nSo it seems the XP SP2 behaviour (throwing an exception) is not nice, but may be\nacceptable for paths containing a /surrounded by \".\n\na special case however is the special classpath \"\". java treats this the same as\nno classpath set or the classpath set to .\n\nI just committed a similar or equal solution as proposed in the patches.\n\nps 1: Please next time mark only as fixed AFTER the bug has been fixed in the\nrepository, else the bug will get lost and worst case similar reports will be\nignored because it is already fixed.\nps 2: The remark regarding the Path was meant for Kev, not for Dennis"}, {"count": 11, "tags": [], "creator": "kevin.jackson@it.fts-vn.com", "attachment_id": null, "text": "(In reply to comment #3)\n> Regarding the java version (remark from kev): Did you also set your PATH\n> accordingly. the java executable is not selected via JAVA_HOME but via your\n> path, and lacking that <some magic, maybe registry>.\n> \n\nI tracked this to the %SYSTEM% on the path - Java5+ installs java.exe into\nwindows/system32 - which completely took me by suprise.  Changing the order of\nthe PATH variable fixed it (put JAVA_HOME first), but Applets still use the\nregistry in some way and I have yet to work around that (though it's a *much*\nlower priority as I rarely use the Java web plugin)\n\nAnyway - just recording this in case people stumble on it from Google.", "id": 86789, "time": "2006-03-14T01:25:11Z", "bug_id": 38914, "creation_time": "2006-03-14T01:25:11Z", "is_private": false}]
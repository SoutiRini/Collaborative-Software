[{"count": 0, "tags": [], "creator": "alexeys@inventigo.com", "attachment_id": null, "is_private": false, "id": 70588, "time": "2005-02-07T22:39:31Z", "bug_id": 33433, "creation_time": "2005-02-07T22:39:31Z", "text": "<presetdef name=\"exec\">\n    <exec failonerror=\"true\"/>\n  </presetdef>\n\ncauses ClassCastException in <signjar>:\n\njava.lang.ClassCastException\n        at org.apache.tools.ant.ComponentHelper.createNewTask(ComponentHelper.java:462)\n        at org.apache.tools.ant.ComponentHelper.createTask(ComponentHelper.java:430)\n        at org.apache.tools.ant.Project.createTask(Project.java:1019)\n        at org.apache.tools.ant.taskdefs.SignJar.doOneJar(SignJar.java:255)\n        at org.apache.tools.ant.taskdefs.SignJar.execute(SignJar.java:221)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at sun.reflect.GeneratedMethodAccessor35.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:95)\n        at org.apache.tools.ant.Task.perform(Task.java:366)"}, {"count": 1, "tags": [], "bug_id": 33433, "text": "Do you have to invoke signjar before the exception is thrown, I assume?  Can you\nattach a small buildfile to demonstrate the error?", "id": 70589, "time": "2005-02-07T22:54:26Z", "creator": "mbenson@apache.org", "creation_time": "2005-02-07T22:54:26Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 33433, "text": "Nothing special there:\n\n  <target name=\"login-jar\" depends=\"compile\">\n    <mkdir dir=\"${lib-dir}-temp\" />\n    <mkdir dir=\"${lib-dir}\" />\n    <jar destfile=\"${lib-dir}-temp/Login.jar\">\n      <fileset dir=\"${classes}\"/>\n    </jar>\n    <signjar jar=\"${lib-dir}-temp/Login.jar\" signedjar=\"${lib-dir}/Login.jar\" alias=\"alias\" keystore=\"keystore\" storepass=\"pass\" />\n  </target>\n", "id": 70590, "time": "2005-02-07T23:01:36Z", "creator": "alexeys@inventigo.com", "creation_time": "2005-02-07T23:01:36Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 33433, "is_private": false, "text": "This doesnt surprise me; <signjar> gets Project to create an instance of exec()\nand then casts it to the Exec task.\n\nI think this shows why renaming existing tasks is a bad idea; you are breaking\nthe binary contract between task name and java interface that has historically\nexisted.\n\nIf we did something to fix signjar, every other task that uses exec will\nprobably break. Same if you made a change to java. \n\nAs an aside, signjar has another problem, which is that by execing the signing\nit puts your keystore password on the command line. Fix that and your symptom of\na bigger problem goes away, to come back the next time you run an exec'ing task.", "id": 70610, "time": "2005-02-08T10:55:07Z", "creator": "stevel@apache.org", "creation_time": "2005-02-08T10:55:07Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "mbenson@apache.org", "is_private": false, "id": 70627, "attachment_id": null, "bug_id": 33433, "creation_time": "2005-02-08T16:24:07Z", "time": "2005-02-08T16:24:07Z", "text": "What is the benefit of using Project.createTask(\"exec\")?  If we know we want an\nExecTask, why can we not simply instantiate it and call setProject()?"}, {"count": 5, "tags": [], "creator": "alexeys@inventigo.com", "is_private": false, "id": 70628, "attachment_id": null, "bug_id": 33433, "creation_time": "2005-02-08T16:30:47Z", "time": "2005-02-08T16:30:47Z", "text": "If they exect binary compatibility for <exec>, they should not use a generic way \nfor creating the task. Otherwise the tasks should use generic methods to access \nwhatever task object returned from Project.\n\nAnyway - isn't <presetdef> a recomended way to specify default parameters for tasks?"}, {"count": 6, "tags": [], "text": "its probably historical why some tasks create things that way. We could go\nthrough our codebase and eliminate it all (probably good as it reduces the\nrecurrence of this. But we have no control on all those other tasks out there\n\nAlexsys, yes, its a way of setting defaults. But repurposing existing tasks is\nnot something I'd encourage at the best of times, as its on a par with using\n#define in C++ to redefine core stuff. The fact that things break shows why its\nnot going to work.", "is_private": false, "id": 70633, "creator": "stevel@apache.org", "time": "2005-02-08T18:31:51Z", "bug_id": 33433, "creation_time": "2005-02-08T18:31:51Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 33433, "is_private": false, "text": "It is fixed. Thank you.", "id": 70852, "time": "2005-02-11T19:27:36Z", "creator": "alexeys@inventigo.com", "creation_time": "2005-02-11T19:27:36Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "Of course, forgot to update here.  Switched to a ExecTask constructor call in\nCVS HEAD.  Marking as 1.7 for now but as there is a security fix in there as\nwell it will probably go to 1.6.3 .", "is_private": false, "id": 70853, "creator": "mbenson@apache.org", "time": "2005-02-11T19:36:35Z", "bug_id": 33433, "creation_time": "2005-02-11T19:36:35Z", "attachment_id": null}, {"count": 9, "attachment_id": null, "creator": "stevel@apache.org", "text": "Note that I have gone through the rest of the codebase and fixed everywhere else\nwhere presedefing something like exec of java would cause the same problem. What \nwe can not do is guarantee that third party tasks will still work - I would be\nvery cautious about having a preset called exec or java.", "id": 71298, "time": "2005-02-21T10:59:08Z", "bug_id": 33433, "creation_time": "2005-02-21T10:59:08Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "text": "Thank you. Now I am thinking that <presetdef> could be implemented differently\n(it would also remove unnecessary redifinition warnings):\n\n// in pseudo code\nproject.setDefaults(name, attributes); // remember attribute values\nif (getClass(name)==null || !getClass(name).equals(getClass(oldName))) {\n  project.registerClass(name, getClass(oldName)); // use old class for redifinition\n}\n\n\nProject.createTask(...) { // creates new task and applies preset attributes\n\n  Task newTask=....;\n  setDefaultAttributes(newTask);\n  return newTask;\n}", "is_private": false, "id": 71316, "creator": "alexeys@inventigo.com", "time": "2005-02-21T18:03:59Z", "bug_id": 33433, "creation_time": "2005-02-21T18:03:59Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 33433, "text": "*** Bug 35987 has been marked as a duplicate of this bug. ***", "id": 77996, "time": "2005-08-03T11:26:31Z", "creator": "peterreilly@apache.org", "creation_time": "2005-08-03T11:26:31Z", "is_private": false, "attachment_id": null}]
[{"attachment_id": null, "tags": [], "bug_id": 54785, "text": "Almost every time I stop httpd server I get this kind of errors:\n\n# cat /var/log/httpd/error_log\n[Tue Apr 02 08:33:34.714313 2013] [mpm_prefork:notice] [pid 6720] AH00170: caught SIGWINCH, shutting down gracefully\n*** glibc detected *** /usr/sbin/httpd: free(): invalid pointer: 0x00007f6678624798 ***\n*** glibc detected *** /usr/sbin/httpd: free(): invalid pointer: 0x00007f6678624798 ***\n*** glibc detected *** /usr/sbin/httpd: free(): invalid pointer: 0x00007f6678624798 ***\n*** glibc detected *** /usr/sbin/httpd: free(): invalid pointer: 0x00007f6678624798 ***\n======= Backtrace: =========\n======= Backtrace: =========\n/lib64/libc.so.6(+0x7ca8e)[0x7f66782efa8e]\n======= Backtrace: =========\n======= Backtrace: =========\n/lib64/libapr-1.so.0(apr_pool_destroy+0x19c)[0x7f6678a6485c]\n/etc/httpd/modules/mod_mpm_prefork.so(+0x31be)[0x7f667312c1be]\n/lib64/libc.so.6(+0x7ca8e)[0x7f66782efa8e]\n/etc/httpd/modules/mod_mpm_prefork.so(+0x39cb)[0x7f667312c9cb]\n/lib64/libpthread.so.0(+0xf000)[0x7f667883e000]\n/lib64/libapr-1.so.0(apr_pool_destroy+0x19c)[0x7f6678a6485c]\n/lib64/ld-linux-x86-64.so.2(+0xf5f7)[0x7f66799215f7]\n/etc/httpd/modules/mod_mpm_prefork.so(+0x31be)[0x7f667312c1be]\n/lib64/libc.so.6(+0x38df1)[0x7f66782abdf1]\n/etc/httpd/modules/mod_mpm_prefork.so(+0x39cb)[0x7f667312c9cb]\n/lib64/libc.so.6(+0x38e75)[0x7f66782abe75]\n/lib64/libpthread.so.0(+0xf000)[0x7f667883e000]\n/etc/httpd/modules/mod_version.so(+0xa80)[0x7f6673534a80]\n======= Memory map: ========\n/etc/httpd/modules/mod_mpm_prefork.so(+0x31db)[0x7f667312c1db]\n/etc/httpd/modules/mod_mpm_prefork.so(+0x35f5)[0x7f667312c5f5]\n/etc/httpd/modules/mod_mpm_prefork.so(+0x394c)[0x7f667312c94c]\n/etc/httpd/modules/mod_mpm_prefork.so(+0x39a6)[0x7f667312c9a6]\n/etc/httpd/modules/mod_mpm_prefork.so(+0x4856)[0x7f667312d856]\n/usr/sbin/httpd(ap_run_mpm+0x4e)[0x7f6679b6e6de]\n....\n(see attached error_log file).\n\n# find /tmp -name core* \n/tmp/systemd-private-hjmsNN/core.6725\n/tmp/systemd-private-hjmsNN/core.6724\n/tmp/systemd-private-hjmsNN/core.6726\n/tmp/systemd-private-hjmsNN/core.6722\n\n# gdb httpd -c /tmp/systemd-private-hjmsNN/core.6722\nGNU gdb (GDB) Fedora (7.5.1-37.fc18)\nCopyright (C) 2012 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-redhat-linux-gnu\".\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>...\nReading symbols from /usr/sbin/httpd...Reading symbols from /usr/lib/debug/usr/sbin/httpd.debug...done.\ndone.\n[New LWP 6722]\n[Thread debugging using libthread_db enabled]\nUsing host libthread_db library \"/lib64/libthread_db.so.1\".\nCore was generated by `/usr/sbin/httpd'.\nProgram terminated with signal 6, Aborted.\n#0  0x00007f66782a8ba5 in __GI_raise (sig=sig@entry=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:63\n63        return INLINE_SYSCALL (tgkill, 3, pid, selftid, sig);\n(gdb) where\n#0  0x00007f66782a8ba5 in __GI_raise (sig=sig@entry=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:63\n#1  0x00007f66782aa358 in __GI_abort () at abort.c:90\n#2  0x00007f66782e859b in __libc_message (do_abort=do_abort@entry=2, \n    fmt=fmt@entry=0x7f66783ecba8 \"*** glibc detected *** %s: %s: 0x%s ***\\n\")\n    at ../sysdeps/unix/sysv/linux/libc_fatal.c:197\n#3  0x00007f66782efa8e in malloc_printerr (ptr=0x7f6678624798 <main_arena+88>, \n    str=0x7f66783eaa01 \"free(): invalid pointer\", action=3) at malloc.c:4969\n#4  _int_free (av=0x7f6678624740 <main_arena>, p=0x7f6678624788 <main_arena+72>, have_lock=0) at malloc.c:3826\n#5  0x00007f6678a6485c in allocator_free (node=0x7f6678624798 <main_arena+88>, allocator=0x7f667bf3b7d0)\n    at memory/unix/apr_pools.c:430\n#6  apr_pool_destroy (pool=0x7f667bf3b8c8) at memory/unix/apr_pools.c:856\n#7  0x00007f667312c1be in clean_child_exit (code=code@entry=0) at prefork.c:218\n#8  0x00007f667312c9cb in just_die (sig=<optimized out>) at prefork.c:344\n#9  <signal handler called>\n#10 0x00007f6673534a80 in __do_global_dtors_aux () from /etc/httpd/modules/mod_version.so\n#11 0x00007f66799215f7 in _dl_fini () at dl-fini.c:253\n#12 0x00007f66782abdf1 in __run_exit_handlers (status=status@entry=0, listp=0x7f66786246a8 <__exit_funcs>, \n    run_list_atexit=run_list_atexit@entry=true) at exit.c:77\n#13 0x00007f66782abe75 in __GI_exit (status=status@entry=0) at exit.c:99\n#14 0x00007f667312c1db in clean_child_exit (code=code@entry=0) at prefork.c:227\n#15 0x00007f667312c7c5 in child_main (child_num_arg=child_num_arg@entry=0) at prefork.c:629\n#16 0x00007f667312c94c in make_child (s=0x7f667bda0348, slot=slot@entry=0) at prefork.c:800\n#17 0x00007f667312c9a6 in startup_children (number_to_start=5) at prefork.c:818\n#18 0x00007f667312d856 in prefork_run (_pconf=<optimized out>, plog=0x7f667bdd24d8, s=0x7f667bda0348) at prefork.c:976\n#19 0x00007f6679b6e6de in ap_run_mpm (pconf=0x7f667bd75138, plog=0x7f667bdd24d8, s=0x7f667bda0348) at mpm_common.c:98\n#20 0x00007f6679b67d8a in main (argc=1, argv=0x7fff2a861578) at main.c:777\n(gdb) bt full\n#0  0x00007f66782a8ba5 in __GI_raise (sig=sig@entry=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:63\n        resultvar = 0\n        pid = 6722\n        selftid = 6722\n#1  0x00007f66782aa358 in __GI_abort () at abort.c:90\n        save_stage = 2\n        act = {__sigaction_handler = {sa_handler = 0x7f66783eabc1, sa_sigaction = 0x7f66783eabc1}, sa_mask = {__val = {\n              3, 140733906812557, 3, 140078080761236, 1, 140078080767934, 3, 140733906812532, 12, 140078080767938, 2, \n              140078080767938, 2, 140733906813344, 7, 140733906815104}}, sa_flags = 88, sa_restorer = 0x7}\n        sigs = {__val = {32, 0 <repeats 15 times>}}\n#2  0x00007f66782e859b in __libc_message (do_abort=do_abort@entry=2, \n    fmt=fmt@entry=0x7f66783ecba8 \"*** glibc detected *** %s: %s: 0x%s ***\\n\")\n    at ../sysdeps/unix/sysv/linux/libc_fatal.c:197\n        ap = {{gp_offset = 40, fp_offset = 48, overflow_arg_area = 0x7fff2a860890, reg_save_area = 0x7fff2a8607a0}}\n        ap_copy = {{gp_offset = 16, fp_offset = 48, overflow_arg_area = 0x7fff2a860890, \n            reg_save_area = 0x7fff2a8607a0}}\n        fd = 2\n        on_2 = <optimized out>\n        list = <optimized out>\n        nlist = <optimized out>\n        cp = <optimized out>\n        written = <optimized out>\n#3  0x00007f66782efa8e in malloc_printerr (ptr=0x7f6678624798 <main_arena+88>, \n    str=0x7f66783eaa01 \"free(): invalid pointer\", action=3) at malloc.c:4969\n        buf = \"00007f6678624798\"\n        cp = <optimized out>\n#4  _int_free (av=0x7f6678624740 <main_arena>, p=0x7f6678624788 <main_arena+72>, have_lock=0) at malloc.c:3826\n        size = <optimized out>\n        fb = <optimized out>\n        nextchunk = <optimized out>\n        nextsize = <optimized out>\n        nextinuse = <optimized out>\n        prevsize = <optimized out>\n        bck = <optimized out>\n        fwd = <optimized out>\n        errstr = 0x7f66783eaa01 \"free(): invalid pointer\"\n        locked = <optimized out>\n#5  0x00007f6678a6485c in allocator_free (node=0x7f6678624798 <main_arena+88>, allocator=0x7f667bf3b7d0)\n    at memory/unix/apr_pools.c:430\n        freelist = 0x0\n        max_index = <optimized out>\n        max_free_index = <optimized out>\n        next = <optimized out>\n        index = <optimized out>\n        current_free_index = <optimized out>\n#6  apr_pool_destroy (pool=0x7f667bf3b8c8) at memory/unix/apr_pools.c:856\n        active = <optimized out>\n        allocator = 0x7f667bf3b7d0\n#7  0x00007f667312c1be in clean_child_exit (code=code@entry=0) at prefork.c:218\nNo locals.\n#8  0x00007f667312c9cb in just_die (sig=<optimized out>) at prefork.c:344\nNo locals.\n#9  <signal handler called>\nNo locals.\n#10 0x00007f6673534a80 in __do_global_dtors_aux () from /etc/httpd/modules/mod_version.so\nNo symbol table info available.\n#11 0x00007f66799215f7 in _dl_fini () at dl-fini.c:253\n        array = 0x7f6673735cb8\n        i = 0\n        nmaps = 65\n        nloaded = <optimized out>\n        i = 44\n        l = 0x7f667bde12b0\n        ns = 0\n        maps = 0x7fff2a860de0\n        maps_size = 520\n        do_audit = 0\n#12 0x00007f66782abdf1 in __run_exit_handlers (status=status@entry=0, listp=0x7f66786246a8 <__exit_funcs>, \n    run_list_atexit=run_list_atexit@entry=true) at exit.c:77\n        atfct = <optimized out>\n        onfct = <optimized out>\n        cxafct = <optimized out>\n        f = <optimized out>\n#13 0x00007f66782abe75 in __GI_exit (status=status@entry=0) at exit.c:99\nNo locals.\n#14 0x00007f667312c1db in clean_child_exit (code=code@entry=0) at prefork.c:227\nNo locals.\n#15 0x00007f667312c7c5 in child_main (child_num_arg=child_num_arg@entry=0) at prefork.c:629\n        numdesc = 1\n        pdesc = 0x7f667bf3d950\n        current_conn = <optimized out>\n        csd = 0x7f667bf3d950\n        thd = 0x7f667bf3b940\n        osthd = 140078105122688\n        ptrans = 0x7f667bf3d8d8\n        allocator = 0x7f667bf3b7d0\n        status = <optimized out>\n        i = <optimized out>\n        lr = <optimized out>\n        pollset = 0x7f667bf3ba00\n        sbh = 0x7f667bf3b9f8\n        bucket_alloc = 0x7f667bf418f8\n        last_poll_idx = 1\n        lockfile = <optimized out>\n#16 0x00007f667312c94c in make_child (s=0x7f667bda0348, slot=slot@entry=0) at prefork.c:800\n        pid = 0\n#17 0x00007f667312c9a6 in startup_children (number_to_start=5) at prefork.c:818\n        i = 0\n#18 0x00007f667312d856 in prefork_run (_pconf=<optimized out>, plog=0x7f667bdd24d8, s=0x7f667bda0348) at prefork.c:976\n        index = <optimized out>\n        remaining_children_to_start = <optimized out>\n        rv = <optimized out>\n#19 0x00007f6679b6e6de in ap_run_mpm (pconf=0x7f667bd75138, plog=0x7f667bdd24d8, s=0x7f667bda0348) at mpm_common.c:98\n        pHook = 0x7f667be4a618\n        n = 0\n        rv = 1936940472\n#20 0x00007f6679b67d8a in main (argc=1, argv=0x7fff2a861578) at main.c:777\n        c = 0 '\\000'\n        showcompile = 0\n        showdirectives = 0\n        confname = 0x7f6679ba2baf \"conf/httpd.conf\"\n        def_server_root = 0x7f6679ba2ba4 \"/etc/httpd\"\n        temp_error_log = <optimized out>\n        error = <optimized out>\n        process = 0x7f667bd73218\n        pconf = 0x7f667bd75138\n        plog = 0x7f667bdd24d8\n        ptemp = 0x7f667bd9e2f8\n        pcommands = 0x7f667bd97248\n        opt = 0x7f667bd97338\n        rv = <optimized out>\n        mod = 0x7f6679dbf098 <ap_prelinked_modules+24>\n        opt_arg = 0x7f667bd73128 \"\\b\\361\\326{f\\177\"\n        signal_server = <optimized out>\n\nRunning Fedora 18.\n\n# uname -a\nLinux f18.vlasiu.net 3.8.1-201.fc18.x86_64 #1 SMP Thu Feb 28 19:23:08 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux\n\nDoes not matter if I use the httpd package from distribution or I compile httpd from sources. Same behaviour.\nAlso, module mod_systemd.so is not loaded!", "count": 0, "id": 166321, "time": "2013-04-02T12:48:51Z", "creator": "gabriel@vlasiu.net", "creation_time": "2013-04-02T12:48:51Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 54785, "attachment_id": 30134, "is_private": false, "id": 166322, "time": "2013-04-02T12:49:38Z", "creator": "gabriel@vlasiu.net", "creation_time": "2013-04-02T12:49:38Z", "text": "Created attachment 30134\nerror_log"}]
[{"count": 0, "text": "When attempting to use FORM based authentication from a web app running in \nTomcat 5.5.20 (JBoss 4.0.5GA), with JK 1.2.0 via ajp13 (localhost) and IIS 6, \nthe form submit via POST hangs.\n\nAll other content via the isapi_redirect.dll works just fine.  Also, if you \nchange the login.jsp to GET method, it works.  Seems to be problem with just \nPOST.\n\nredirect log reports:\n\n[Sat Feb 03 21:31:40 2007] [24540:19136] [error] jk_isapi_plugin.c (624): \nReadClient failed with 0000274c\n[Sat Feb 03 21:31:40 2007] [24540:19136] [info]  jk_ajp_common.c (1110): () \nreceiving data from client failed. Connection aborted or network problems\n[Sat Feb 03 21:31:40 2007] [24540:19136] [info]  jk_ajp_common.c (1893): \n(ajp13w) sending request to tomcat failed, because of client read error without \nrecovery in send loop attempt=0\n[Sat Feb 03 21:31:40 2007] [24540:19136] [debug] jk_isapi_plugin.c (1093): \nservice() returned OK\n[Sat Feb 03 21:31:40 2007] [24540:19136] [debug] jk_ajp_common.c (2229): will \nbe shutting down socket 1336 for worker ajp13w\n\n\n\nIncomplete POST gets to Tomcat, as Tomcat reports:\n\n2007-02-03 21:30:40,349 DEBUG [org.apache.catalina.connector.CoyoteAdapter]  \nRequested cookie session id is CEEA5F00E90E6F3A63C44E81609E6CBB\n2007-02-03 21:30:40,349 DEBUG \n[org.apache.catalina.authenticator.AuthenticatorBase] Security checking request \nPOST /iffl/tims/content/j_security_check\n2007-02-03 21:30:40,365 DEBUG [org.apache.jk.common.JkInputStream] doRead false \n0 0\n2007-02-03 21:30:40,365 DEBUG [org.apache.jk.common.ChannelSocket] receive() \n...\n2007-02-03 21:31:40,351 INFO  [org.apache.jk.common.JkInputStream] Receiving: \ngetting request body chunk -3 4\n2007-02-03 21:31:40,351 DEBUG \n[org.apache.catalina.authenticator.FormAuthenticator] Authenticating \nusername 'null'", "bug_id": 41535, "is_private": false, "id": 98944, "time": "2007-02-03T20:50:50Z", "creator": "jasona@blazetrail.ca", "creation_time": "2007-02-03T20:50:50Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 41535, "is_private": false, "text": "Created attachment 19505\nworker.properties", "id": 98945, "time": "2007-02-03T20:53:54Z", "creator": "jasona@blazetrail.ca", "creation_time": "2007-02-03T20:53:54Z", "attachment_id": 19505}, {"count": 2, "tags": [], "creator": "jasona@blazetrail.ca", "attachment_id": 19506, "id": 98946, "time": "2007-02-03T20:55:38Z", "bug_id": 41535, "creation_time": "2007-02-03T20:55:38Z", "is_private": false, "text": "Created attachment 19506\nrewrite.properties"}, {"count": 3, "tags": [], "bug_id": 41535, "attachment_id": 19507, "is_private": false, "id": 98947, "time": "2007-02-03T20:55:56Z", "creator": "jasona@blazetrail.ca", "creation_time": "2007-02-03T20:55:56Z", "text": "Created attachment 19507\nuriworkermap.properties"}, {"count": 4, "tags": [], "bug_id": 41535, "attachment_id": 19508, "id": 98948, "time": "2007-02-03T20:57:07Z", "creator": "jasona@blazetrail.ca", "creation_time": "2007-02-03T20:57:07Z", "is_private": false, "text": "Created attachment 19508\nlogin.jsp"}, {"count": 5, "tags": [], "bug_id": 41535, "is_private": false, "text": "Created attachment 19509\nisapi_redirect.log", "id": 98949, "time": "2007-02-03T21:02:01Z", "creator": "jasona@blazetrail.ca", "creation_time": "2007-02-03T21:02:01Z", "attachment_id": 19509}, {"count": 6, "tags": [], "bug_id": 41535, "attachment_id": 19510, "text": "Created attachment 19510\nrewrite.properties", "id": 98950, "time": "2007-02-03T21:02:36Z", "creator": "jasona@blazetrail.ca", "creation_time": "2007-02-03T21:02:36Z", "is_private": false}, {"count": 7, "text": "Created attachment 19511\nuriworkermap.properties", "bug_id": 41535, "is_private": false, "id": 98951, "time": "2007-02-03T21:03:13Z", "creator": "jasona@blazetrail.ca", "creation_time": "2007-02-03T21:03:13Z", "tags": [], "attachment_id": 19511}, {"count": 8, "tags": [], "creator": "Tim.Whittington@orionhealth.com", "attachment_id": null, "id": 98954, "time": "2007-02-04T13:45:11Z", "bug_id": 41535, "creation_time": "2007-02-04T13:45:11Z", "is_private": false, "text": "The error you're getting is a socket timeout - e.g. JK is timing out trying to\nread from the request stream.\nThis is probably due to a confusion between the user agent, IIS and JK about the\ncontent length available to read in the request.\nIn this case, the incoming request seems to be indicating that there are 45\nbytes to read, which JK is timing out on.\n\nCan you attach a trace of the HTTP traffic for the failed request - preferrably\na TCP level trace with Wireshark/Ethereal, but an HTTP trace from something like\nFiddler (http://www.fiddlertool.com/fiddler/) would help."}, {"count": 9, "tags": [], "bug_id": 41535, "attachment_id": 19531, "text": "Created attachment 19531\nNew set of logs with WireShark PCAP file", "id": 99023, "time": "2007-02-06T09:48:52Z", "creator": "jasona@blazetrail.ca", "creation_time": "2007-02-06T09:48:52Z", "is_private": false}, {"count": 10, "tags": [], "text": "I should note that POST via IIS -> redirect -> JK is now failing for *some* \nother forms.  One is another JSP login form and another is a standard \nsubmit/post form.\n\nIt doesn't seem that HTTP POST via the director is stable [in my environment].", "attachment_id": null, "id": 99024, "creator": "jasona@blazetrail.ca", "time": "2007-02-06T09:52:57Z", "bug_id": 41535, "creation_time": "2007-02-06T09:52:57Z", "is_private": false}, {"count": 11, "tags": [], "text": "Can you also attach a pcap file concerning the connection browser to IIS?", "is_private": false, "id": 99028, "creator": "charly41434@yahoo.de", "time": "2007-02-06T12:08:28Z", "bug_id": 41535, "creation_time": "2007-02-06T12:08:28Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 41535, "attachment_id": null, "text": "The conversations between browser (10.1.1.120) to IIS (10.1.1.103) to JK \n(10.1.1.10) are all in the same pcap. \n\n", "id": 99029, "time": "2007-02-06T12:14:00Z", "creator": "jasona@blazetrail.ca", "creation_time": "2007-02-06T12:14:00Z", "is_private": false}, {"count": 13, "tags": [], "creator": "Tim.Whittington@orionhealth.com", "attachment_id": 19533, "id": 99036, "time": "2007-02-06T22:23:00Z", "bug_id": 41535, "creation_time": "2007-02-06T22:23:00Z", "is_private": false, "text": "Created attachment 19533\nISAPI Redirector 1.2.20 with extended debugging\n\nMy reading of the pcap trace is that the HTTP is well formed, and that the 44\nbytes of form POST data are in the original request packet - i.e. they should\nalready be available to IIS and be accessible from the ECB without a ReadClient\ncall.\n\nThere's some strangeness in the logs (namely the \"() receiving data from client\nfailed...\"), which may point to something bad as the worker name isn't being\nprinted, although the code looks fine and the worker name is printed\nsuccessfully in the error handler later.\n\nI've attached a build of 1.2.20 that has extended debug statements around the\nISAPI ReadClient. This should give us an idea of whether this is a JK problem\nor an IIS problem.\nBasically if the ECB reports anything other than 44 total or < 44 available,\nthen it's an IIS issue.\nOtherwise something is broken in JK.\n\nCan you replicate the issue with this build and reattach the isapi_redirect.log"}, {"attachment_id": 19534, "tags": [], "creator": "jasona@blazetrail.ca", "is_private": false, "count": 14, "id": 99037, "time": "2007-02-06T22:43:23Z", "bug_id": 41535, "creation_time": "2007-02-06T22:43:23Z", "text": "Created attachment 19534\nisapi_redirect.log with debug version of .dll"}, {"attachment_id": null, "tags": [], "creator": "jasona@blazetrail.ca", "is_private": false, "count": 15, "id": 99039, "time": "2007-02-06T23:24:52Z", "bug_id": 41535, "creation_time": "2007-02-06T23:24:52Z", "text": "It appears to be working now at least on W2K3 servers.  I tried it initially on \nW2K3 server \"A\" with the new debug .dll and it failed.\n\nI then tried another W2K3 server \"B\" which IIS had clean config+redirector and \nit worked.   I compared configs, and the only difference was that on the  \nserver \"A\" HTTP compression had been turned on at one point (supposedly it was \nturned off again - was off in IISAdmin, but metabase still had some \ndifferences).  So I re-turned it off to be sure.  And that's when POST started \nworking again on both A and B.\n\nOr it could just be late (past midnight MST) or phase of moon.\n\nHowever, POST still hangs on Windows XP.   If that's the only environment, then \nI can probably work around as it is only used for developer testing and not \nproduction.  XP doesn't do HTTP compression."}, {"attachment_id": null, "tags": [], "creator": "Tim.Whittington@orionhealth.com", "is_private": false, "count": 16, "id": 99071, "time": "2007-02-07T12:04:03Z", "bug_id": 41535, "creation_time": "2007-02-07T12:04:03Z", "text": "The logs attached indicate that IIS is at fault here - it's reporting 44 bytes\ntotal (which is correct), but none available (which isn't correct).\nEither the 44 bytes should be in the ECB, or the ReadClient should succeed."}]
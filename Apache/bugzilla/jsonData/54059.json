[{"count": 0, "tags": [], "text": "Transcoder allows to pass a user style sheet uri an a hint.\nPassing an data uri, such as \"data:text/css;charset=UTF-8, .g { display:none;}\" works as expected. But as soon, as the data (style sheet) contains a #-character, the style sheet can not be parsed correctly any more. \nThe reason for this is in the ParsedULR class (or a class used by it - ParsedURLDataProtocolHandler:parseURL(String urlStr)) because the  # character is interpreted as a URL fragment separator, not considering the used URI schema at all. As far as i know is the syntax for data URI's \"data:<mediatype>[;base64],<data>\". Because of this, the part after the first #-character is taken as URI fragment and is no longer part of the style sheet, resulting in an exception like this:\n\norg.w3c.dom.DOMException: data:text/css;charset=UTF-8,#RestrictedAreas { display:none;}:\nInvalid CSS document.\njava.lang.NullPointerException\n\tat org.apache.batik.css.engine.CSSEngine.parseStyleSheet(CSSEngine.java:1184)\n\tat org.apache.batik.css.engine.CSSEngine.parseStyleSheet(CSSEngine.java:1125)\n\tat org.apache.batik.bridge.BridgeContext.initializeDocument(BridgeContext.java:386)\n\tat org.apache.batik.bridge.GVTBuilder.build(GVTBuilder.java:55)\n\tat org.apache.batik.transcoder.SVGAbstractTranscoder.transcode(SVGAbstractTranscoder.java:208)\n\tat org.apache.batik.transcoder.image.ImageTranscoder.transcode(ImageTranscoder.java:92)\n\tat org.apache.batik.transcoder.XMLAbstractTranscoder.transcode(XMLAbstractTranscoder.java:142)\n\tat org.apache.batik.transcoder.SVGAbstractTranscoder.transcode(SVGAbstractTranscoder.java:156)\n\nReproduce:\nPassing an URI as \"data:text/css;charset=UTF-8,#RestrictedAreas { display:none;}\" as a user-stylsheet-uri to the transcoder hints.\n\nWorkaround: \na) Use a file instead of encoding data directly in the URL \nb) Encode style sheet data using based64\n\nString stylesheet = \"#RestrictedAreas { display:none;}\"\nCharset charset = Charset.forName(\"UTF-8\");\nbyte[] styleSheetBytes = Base64.encodeBase64(charset.encode(stylesheet).array());\nCharBuffer styleSheet  = charset.decode(ByteBuffer.wrap(styleSheetBytes));\nString dataURL = \"data:text/css;base64,\"+styleSheet;\nhints.put(ImageTranscoder.KEY_USER_STYLESHEET_URI, dataURL);\n\nregards", "attachment_id": null, "bug_id": 54059, "id": 163003, "time": "2012-10-28T16:26:02Z", "creator": "gerber@slf.ch", "creation_time": "2012-10-28T16:26:02Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 55806, "is_private": false, "text": "Created attachment 31062\nthe server.xml file\n\nI switched my site to https and i found that all the images get truncated,\nin firebug i see that the request ends with 200 response but the content is 0 bytes.\nif i put the HTTP/1.1 protocol everything goes back to normality,\nthis is my configuration of the connector : \n\n  <Connector port=\"8443\" protocol=\"org.apache.coyote.http11.Http11NioProtocol\" SSLEnabled=\"true\"\n       connectionTimeout=\"20000\"\n               maxThreads=\"2000\" scheme=\"https\" secure=\"true\"\n               clientAuth=\"false\" sslProtocol=\"TLS\"           \n               keystoreFile=\"emc_tomcat.bin\"   disableUploadTimeout=\"true\"\n\t\t\t   keystorePass=\"password\"\n             maxHeaderCount=\"1000\"   \n             acceptCount=\"1000\"\n             keepAliveTimeout=\"-1\"/>", "id": 171370, "time": "2013-11-21T10:49:31Z", "creator": "geniodella@gmail.com", "creation_time": "2013-11-21T10:49:31Z", "attachment_id": 31062}, {"count": 1, "tags": [], "bug_id": 55806, "attachment_id": null, "id": 171373, "time": "2013-11-21T12:04:50Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2013-11-21T12:04:50Z", "is_private": false, "text": "> Created attachment 31062 [details]\n> the server.xml file\n\nYou are attaching working configuration?\n(protocol=\"HTTP/1.1\").\n\n\n> I see that the request ends with 200 response but the content is 0 bytes.\n\n1. What connector name is reported in Tomcat startup log when it works and when it does not? E.g. \"http-bio-8443\".\n\nThe protocol=\"HTTP/1.1\" setting can select two different connector implementations, depending on a presence of tcnative library.\n\n2. Does it happen with small files or with big ones?\n\nIf this behaviour is caused by sendfile, there will be a threshold at 48 Kb.\n\nIf it is a sendfile issue you should be able to work around it by specifying useSendfile=\"false\" on your connector.\n\n3. What are your operating system and java versions?\n\n4. Is it reproducible with 7.0.47?\n\n\n(There have been an issue with APR connector in trunk, but you are reporting that you have a problem with NIO connector, so yours should be a different one.\n\nImplementations of sendfile in NIO and APR are substantially different. The APR one cannot be used with HTTPS.\n\nFor reference,\nhttps://svn.apache.org/viewvc?view=revision&revision=1531659\nhttp://tomcat.markmail.org/thread/em7lemcr7667ad4d\n\nThat improvement/fix has not been ported to TC7 yet.\n)"}, {"count": 2, "tags": [], "creator": "geniodella@gmail.com", "attachment_id": null, "text": "I was attaching the working configuration,\ni attached it only for sake of completeness.\n\nhere the answers  :\n\n1. Informazioni: Starting ProtocolHandler [\"http-nio-8443\"]\n\n\n2.\nok i set this parameter : useSendfile=\"false\"\nand it seems that now it is working well,\nwhat is this parameter for and why it has to be set\nonly on ssl?\n\n3. i deployed it on windows 7 and on CentOS linux\nand i get the same error (in windows with the usesendfile to false\nit is working, didn't try yet on linux),\n\n\n4. i didn't try with tomcat 7.0.47", "id": 171374, "time": "2013-11-21T12:19:01Z", "bug_id": 55806, "creation_time": "2013-11-21T12:19:01Z", "is_private": false}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "This works for me with 7.0.48-dev (current 7.0.x/trunk) a 2MB image, the NIO connector, https and sendfile enabled.", "id": 171472, "time": "2013-11-27T20:54:30Z", "bug_id": 55806, "creation_time": "2013-11-27T20:54:30Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 56857, "text": "Multiple subsequent Thread dumps were exhibiting lots of threads hanging in HashMap.get() while in RUNNABLE status, and consuming high CPU - a typical indicator of a thread safety issue with these non-threadsafe Maps.\nThread stacks all as below.\n\nApplicationContextFacade implements ServletContext, these objects are singletons per webapp, and get passed around among multiple threads. Their private member \"objectCache\" is a HashMap, i.e. not thread safe, but gets accessed AND modified without any synchronization in invokeMethod().\n\nSuggested remedy: change to a ConcurrentHashMap, which is thread-safe, and performs much better than synchronizing on every access.\n\n\"connector-93: userId=_101_1, sessionId=C9EC1C59DD2244557BC6231A5476000E\" daemon prio=10 tid=0x00007fb1e40cf800 nid=0x7b90 runnable [0x00007fb1e82c3000]\n   java.lang.Thread.State: RUNNABLE\n\tat java.util.HashMap.get(HashMap.java:326)\n\tat org.apache.catalina.core.ApplicationContextFacade.invokeMethod(ApplicationContextFacade.java:789)\n\tat org.apache.catalina.core.ApplicationContextFacade.doPrivileged(ApplicationContextFacade.java:767)\n\tat org.apache.catalina.core.ApplicationContextFacade.getContextPath(ApplicationContextFacade.java:428)\n\tat blackboard.portal.servlet.ModuleCustomizationServlet.service(ModuleCustomizationServlet.java:88)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:728)\n...", "id": 177175, "time": "2014-08-14T21:42:28Z", "creator": "vkleinschmidt@blackboard.com", "creation_time": "2014-08-14T21:42:28Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "As is common with thread safety issues, I have no strict replication steps. Issue occurs sporadically, however this particular method call (getContextPath) seems to trigger it fairly often.", "attachment_id": null, "id": 177176, "creation_time": "2014-08-14T21:44:04Z", "time": "2014-08-14T21:44:04Z", "creator": "vkleinschmidt@blackboard.com", "bug_id": 56857, "is_private": false}, {"count": 2, "attachment_id": null, "creator": "markt@apache.org", "text": "Fixed in 8.0.x for 8.0.11 onwards.", "id": 177184, "time": "2014-08-15T12:54:46Z", "bug_id": 56857, "creation_time": "2014-08-15T12:54:46Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "vkleinschmidt@blackboard.com", "attachment_id": null, "text": "Thanks for the quick follow-up. Any chance this could get backported to 7.x?", "id": 177506, "time": "2014-09-02T18:45:04Z", "bug_id": 56857, "creation_time": "2014-09-02T18:45:04Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 56857, "text": "The fix is downported in 7.0.x for 7.0.56 onwards.", "id": 177508, "time": "2014-09-03T10:45:27Z", "creator": "violetagg@apache.org", "creation_time": "2014-09-03T10:45:27Z", "is_private": false, "attachment_id": null}, {"count": 5, "text": "Great news, thank you.", "creator": "vkleinschmidt@blackboard.com", "attachment_id": null, "id": 177509, "time": "2014-09-03T11:06:32Z", "bug_id": 56857, "creation_time": "2014-09-03T11:06:32Z", "tags": [], "is_private": false}]
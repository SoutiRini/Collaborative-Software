[{"count": 0, "tags": [], "bug_id": 40288, "is_private": false, "id": 92349, "attachment_id": null, "creator": "lucenebugs2006@danielnaber.de", "creation_time": "2006-08-18T20:01:12Z", "time": "2006-08-18T20:01:12Z", "text": "A file:// url in the <base> element in fopconfig.xml must end with a slash on \nLinux. If it does not, images (specified by \"url(foo)\" where foo is a relative \nfile name) won't be found and will thus not be added to the PDF. FOP should \nprobably either accept both ways to specify the url or display an ERROR that \nrefers to this setting. This would make it much easier to debug this problem."}, {"count": 1, "text": "(In reply to comment #0)\n> A file:// url in the <base> element in fopconfig.xml must end with a slash on \n> Linux. If it does not, images (specified by \"url(foo)\" where foo is a relative \n> file name) won't be found and will thus not be added to the PDF. FOP should \n> probably either accept both ways to specify the url or display an ERROR that \n> refers to this setting. This would make it much easier to debug this problem.\n\nWell, this is the normal behavior of URLs (and more generally URIs). When\nresolving a relative reference against a base URI, all the characters of the\nbase URI which are to the right of the rightmost slash are removed, and replaced\nby the relative path:\nfile://path/to/images + myImage.png -> file://path/to/myImage.png\nfile://path/to/images/ + myImage.png -> file://path/to/images/myImage.png\nSo the ending slash is important!\n\nThe best Fop can do IMO is display the full resolved URI in the error message,\nso that the user immediately sees that there is something wrong with URI resolution.", "bug_id": 40288, "is_private": false, "id": 92356, "time": "2006-08-19T07:50:46Z", "creator": "vhennebert@gmail.com", "creation_time": "2006-08-19T07:50:46Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 40288, "attachment_id": null, "text": "Hey, I didn't want to change the severity of this bug! Sorry :-\\", "id": 92357, "time": "2006-08-19T07:54:43Z", "creator": "vhennebert@gmail.com", "creation_time": "2006-08-19T07:54:43Z", "is_private": false}, {"count": 3, "text": "Displaying the full URL in the error message sounds like a good solution to \nme. ", "creator": "lucenebugs2006@danielnaber.de", "attachment_id": null, "id": 92362, "time": "2006-08-20T20:57:41Z", "bug_id": 40288, "creation_time": "2006-08-20T20:57:41Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "fop-dev@cumiskey.com", "attachment_id": null, "id": 98870, "time": "2007-02-01T07:38:38Z", "bug_id": 40288, "creation_time": "2007-02-01T07:38:38Z", "is_private": false, "text": "This bug should be fixed/addressed by [PATCH]\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=41514"}, {"count": 5, "tags": [], "bug_id": 40288, "is_private": false, "id": 99381, "attachment_id": null, "creator": "vhennebert@gmail.com", "creation_time": "2007-02-14T06:31:32Z", "time": "2007-02-14T06:31:32Z", "text": "The full URL isn't yet displayed when the resolution of a resource failed."}, {"count": 6, "tags": [], "bug_id": 40288, "is_private": false, "id": 99476, "attachment_id": 19603, "creator": "fop-dev@cumiskey.com", "creation_time": "2007-02-16T04:12:21Z", "time": "2007-02-16T04:12:21Z", "text": "Created attachment 19603\nlogs full url - not just relative part if there is a failed resolution"}, {"count": 7, "tags": [], "creator": "fop-dev@cumiskey.com", "attachment_id": 19603, "id": 99477, "time": "2007-02-16T04:22:43Z", "bug_id": 40288, "creation_time": "2007-02-16T04:22:43Z", "is_private": false, "text": "Comment on attachment 19603\nlogs full url - not just relative part if there is a failed resolution\n\nIndex: C:/workspace/fop/src/java/org/apache/fop/apps/FOURIResolver.java\n===================================================================\n--- C:/workspace/fop/src/java/org/apache/fop/apps/FOURIResolver.java   \n(revision 507572)\n+++ C:/workspace/fop/src/java/org/apache/fop/apps/FOURIResolver.java   \n(working copy)\n@@ -155,7 +155,7 @@\n\t     //Note: This is on \"debug\" level since the caller is supposed to\nhandle this\n\t     log.debug(\"File not found: \" + effURL);\n\t } catch (java.io.IOException ioe) {\n-\t     log.error(\"Error with opening URL '\" + href + \"': \" +\nioe.getMessage());\n+\t     log.error(\"Error with opening URL '\" + effURL + \"': \" +\nioe.getMessage());\n\t }\n\t return null;\n     }\n@@ -202,6 +202,9 @@\n      * @returns the base URL as java.net.URL\n      */\n     private URL toBaseURL(String baseURL) {\n+\t if (!baseURL.endsWith(\"/\")) {\n+\t     log.warn(\"Base url does not end with a '/'.  This could cause\nresolution problems\");\n+\t }\n\t try {\n\t     return new URL(baseURL == null \n\t\t\t     ? new java.io.File(\"\").toURL().toExternalForm()"}, {"count": 8, "tags": [], "bug_id": 40288, "text": "Created attachment 19604\nlogs full url - not just relative part if there is a failed resolution\n\nnot warns about base urls not ending with '/' chars", "id": 99478, "attachment_id": 19604, "creator": "fop-dev@cumiskey.com", "creation_time": "2007-02-16T04:24:35Z", "time": "2007-02-16T04:24:35Z", "is_private": false}, {"count": 9, "tags": [], "creator": "manuel@apache.org", "text": "Not sure I like the warning. There is no requirement for a base URL to end with a /.", "id": 99479, "time": "2007-02-16T04:38:49Z", "bug_id": 40288, "creation_time": "2007-02-16T04:38:49Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 40288, "is_private": false, "text": "Created attachment 19607\nlogs full url - not just relative part if there is a failed resolution\n\nAmmends base url as necessary with trailing '/'.  I can't think of any\nreason/instance when you would want to lose the end part of your base url\nbecause you neglected to append a trailing slash.", "id": 99488, "time": "2007-02-16T06:44:36Z", "creator": "fop-dev@cumiskey.com", "creation_time": "2007-02-16T06:44:36Z", "attachment_id": 19607}, {"count": 11, "tags": [], "creator": "vhennebert@gmail.com", "attachment_id": null, "id": 99840, "time": "2007-02-27T01:31:29Z", "bug_id": 40288, "creation_time": "2007-02-27T01:31:29Z", "is_private": false, "text": "(In reply to comment #10)\n> Created an attachment (id=19607) [edit]\n> logs full url - not just relative part if there is a failed resolution\n> \n> Ammends base url as necessary with trailing '/'.  I can't think of any\n> reason/instance when you would want to lose the end part of your base url\n> because you neglected to append a trailing slash.\n\nPatch applied with some modifications. Thanks Adrian!\n\nPlease leave bugs open when submitting patches. We will close them when applying\nthe patches.\nI re-open this bug because the problem isn't entirely solved yet. The full URL\ndoesn't appear in strict user config validation mode. Also, when I specify a\nwrong base-font URL (pointing to a non-existing directory), this throws a\ncatched FileNotFoundException (FOURIResolver.java, l.159), and null is returned.\nThus FontSetup displays an error message (or throws a ConfigurationException)\nwith the relative URL (FontSetup.java, l.291).\n\nVincent"}, {"count": 12, "tags": [], "bug_id": 40288, "attachment_id": null, "text": "Isn't a full URL, that is a URL pointing to a file resource a legal base URL\nwhich will now fail? For example if I set the base URL to the file I am\nprocessing, lets say 'file:///home/mm/test.xml' the previous version would\naccept that and resolve references relative to that while now we are appending a\n/ and it will fail.", "id": 99842, "time": "2007-02-27T02:58:09Z", "creator": "manuel@apache.org", "creation_time": "2007-02-27T02:58:09Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 40288, "text": "(In reply to comment #12)\n> Isn't a full URL, that is a URL pointing to a file resource a legal base URL\n> which will now fail? For example if I set the base URL to the file I am\n> processing, lets say 'file:///home/mm/test.xml' the previous version would\n> accept that and resolve references relative to that while now we are appending a\n> / and it will fail.\n\nIndeed, and I was also concerned by that at the beginning. But that code is used\nonly to handle the <base> and <font-base> elements in the user config file,\nwhere it would be really unusual to see URLs pointing to files instead of\ndirectories. And anyway such cases would happen with power users having a good\nunderstanding of relative URL resolution. If they have the full URL in the error\nmessage, they will understand that they have to remove the last part of it to\nmake the thing work. So this change looks safe to me.\nNow if a majority of the developers have concerns about that I can revert it. We\ncan also move that piece of code to the place where base/font-base are retrieved.\n\nWDYT?\nVincent", "id": 99845, "attachment_id": null, "creator": "vhennebert@gmail.com", "creation_time": "2007-02-27T05:07:44Z", "time": "2007-02-27T05:07:44Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 40288, "text": "Admittedly I haven't looked at the code in detail but wouldn't the same logic\napply when setting the base URL programatically. I can easily envisage an\nenvironment where the XML/FO to process comes from some source whose location\nvaries and the programmer dynamically sets the base URL to the input file in\nquestion. It boils down to that a base URL is something different than a base\ndirectory or base file system path.\n\nI would prefer to strengthen our documentation, add appropriate comments to our\nsample config file and may be add a hint as part of the error message compared\nto making a FOP base URL meaning something different than in the rest of the URL\nresolution world.\n\nBut in the end its really a very minor issue and I be happy to go with whatever\nthe FOP committer majority prefers.", "id": 99848, "attachment_id": null, "creator": "manuel@apache.org", "creation_time": "2007-02-27T05:39:54Z", "time": "2007-02-27T05:39:54Z", "is_private": false}, {"count": 15, "tags": [], "creator": "gadams@apache.org", "attachment_id": null, "id": 157516, "time": "2012-04-07T01:44:07Z", "bug_id": 40288, "creation_time": "2012-04-07T01:44:07Z", "is_private": false, "text": "resetting P2 open bugs to P3 pending further review"}]
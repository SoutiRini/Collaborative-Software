[{"count": 0, "tags": [], "bug_id": 50525, "attachment_id": null, "text": "mod_header documentation and internet discussion seemed to indicate that I could fix a mistaken Location: header using the Header directive. However, this did not seem to work in the two cases that I tried.\n\n1. ProxyPass:\n\nProxyPass / http://google.com/\n# which of course gets a 301 to www.google.com\nHeader always edit Location: goo gar\n# so we should go to www.gargle.com\nHeader always add X-Foo: bar\n# just put that in to make sure Header was working at all\n\nThe response in this case includes these headers:\nX-Foo: bar\nLocation: http://www.google.com/\n\nSo, Location was unaffected.\n\n2. RewriteRule\n\nRewriteEngine on\nRewriteRule ^.* http://www.foo.com/ [R]\n# so everything is redirected to www.foo.com\nHeader always edit Location: foo bar\n# which should modify it to www.bar.com\nHeader always add X-Foo: bar\n\nThe response then includes:\nX-Foo: bar\nLocation: http://www.foo.com/\n\nAgain, Location was unaffected.\n\nIf the Location header is added with Header, then a later edit does work. But I can't get it to affect proxied responses, which is what I really wanted. The docs don't indicate any reason why this should fail. So either the docs or mod_headers should be fixed.", "id": 142973, "time": "2010-12-28T15:37:15Z", "creator": "lmeyer@vmware.com", "creation_time": "2010-12-28T15:37:15Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 50525, "text": "A workaround is to duplicate your rule and use the same rule with always and onsuccess.", "id": 142977, "time": "2010-12-28T17:33:30Z", "creator": "covener@gmail.com", "creation_time": "2010-12-28T17:33:30Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 50525, "attachment_id": null, "id": 142978, "time": "2010-12-28T18:03:29Z", "creator": "covener@gmail.com", "creation_time": "2010-12-28T18:03:29Z", "is_private": false, "text": "This is quite broken on a number of levels, but maybe can be made better.\n\nApache uses two locations to store output headers, and currently mod_headers treats one of them as \"onsuccess\" and another as \"always\" but this is not how apache modules use them. mod_headers needs to try harder to treat \"always\" (or some new cop-out option) as \"modify both carefully\".\n\nWhen mod_headers is asked to...\n  append [always], it still might not choose so well. \n  add/remove [always], it should be able to figure out the right thing\n  edit [always], it should try to edit both"}, {"count": 3, "tags": [], "bug_id": 50525, "attachment_id": null, "text": "I've tried to explain this in a doc update:\n\nhttp://svn.apache.org/viewvc?view=revision&revision=1053523\n\nBut we should keep the bug as a non-doc bug since this stuff is so difficult to use.  I struck out trying to fix mod_headers to really try to interpet \"always\" with respect to edit/merge/set/add.", "id": 142979, "time": "2010-12-28T22:35:37Z", "creator": "covener@gmail.com", "creation_time": "2010-12-28T22:35:37Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 50525, "text": "(In reply to comment #1)\n> A workaround is to duplicate your rule and use the same rule with always and\n> onsuccess.\n\nThis does modify the Location header from ProxyPass, so hopefully my problem is solved. Interestingly, it doesn't modify the header if it's from RewriteRule.\n\nThanks a lot for the explanation about headers being stored in multiple ways. That makes some sense; of course it would be nice if these directives all operated as expected... but I see it's complicated.", "id": 142983, "time": "2010-12-29T08:55:29Z", "creator": "lmeyer@vmware.com", "creation_time": "2010-12-29T08:55:29Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "I've configured tomcat in my web.xml to use SSL Client Authentication.\n\n  <security-constraint>\n    <web-resource-collection>\n      <web-resource-name>Administration</web-resource-name>\n      <url-pattern>/x.jsp</url-pattern>\n      <http-method>GET</http-method>\n      <http-method>POST</http-method>\n    </web-resource-collection>\n    <auth-constraint>\n      <role-name>admin</role-name>\n    </auth-constraint>\n  </security-constraint>\n\n  <login-config>\n    <auth-method>CLIENT-CERT</auth-method>\n    <realm-name>Administration Area</realm-name>\n  </login-config>\n\n  <security-role>\n    <role-name>admin</role-name>\n  </security-role>\n\nWhen i try to access the page x.jsp, the server do not asks the client for an \nClient-Certificate. The debug messages in my webapp log file are:\n\n2003-05-12 21:59:53 Authenticator[]: Security checking request GET /x.jsp\n2003-05-12 21:59:53 Authenticator[]:   Checking constraint 'SecurityConstraint\n[Administration]' against GET /x.jsp --> true\n2003-05-12 21:59:53 Authenticator[]:  Subject to constraint SecurityConstraint\n[Administration]\n2003-05-12 21:59:53 Authenticator[]:  Calling checkUserData()\n2003-05-12 21:59:53 Authenticator[]:   User data constraint has no restrictions\n2003-05-12 21:59:53 Authenticator[]:  Calling authenticate()\n2003-05-12 21:59:53 Authenticator[]:  Looking up certificates\n2003-05-12 21:59:53 Authenticator[]:   No certificates included with this \nrequest\n2003-05-12 21:59:53 Authenticator[]:  Failed authenticate() test\n\nDebugging the source code of the SSL Authentication Module and the \nCertificatesValve.class i noticed, that the \"Request\" Object in the \"verifiy\" \nMethod doesn't have an Socket-Object set. So there is no SSL Socket and the \nCertificateValve could not ask the Client-Browser to send the certificates.", "is_private": false, "id": 37091, "creator": "desked@yahoo.de", "time": "2003-05-12T20:31:09Z", "bug_id": 19867, "creation_time": "2003-05-12T20:31:09Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "CLIENT-CERT only works over SSL. You need to add the following after </auth-\nconstraint> and before </security-constraint>\n\n<user-data-constraint>\n  <transport-guarantee>CONFIDENTIAL</transport-guarantee> \n</user-data-constraint>\n\nI believe the servlet spec could be clearer about this. Currently it is \nperfectly valid to specify CLIENT-CERT without specifying a transport-\nguarantee. I have followed this up with the servlet spec team. If the spec \nchanges, this will be incorporated into Tomcat. Currently, Tomcat's behaviour \nis valid.", "attachment_id": null, "id": 42615, "creator": "medthomas@ntlworld.com", "time": "2003-08-12T11:52:52Z", "bug_id": 19867, "creation_time": "2003-08-12T11:52:52Z", "is_private": false}]
[{"count": 0, "attachment_id": null, "creator": "pbelau1@yahoo.com", "is_private": false, "id": 108784, "time": "2007-09-28T18:30:07Z", "bug_id": 43512, "creation_time": "2007-09-28T18:30:07Z", "tags": [], "text": "Inflation fails for certain websites. Appears to be caused by lack of validaton\nbytes where they are expected. Commenting out validation bytes checking in\nmod_deflate.c does not fix the problem. Size of compressed data is reported as 1\nbyte in ctx->stream.total_in, uncompressed is 0. Condition can be provoked by\nrequesting:\n\nwww.cnn.com\nwww.ebay.com\n\nProbably others as well"}, {"count": 1, "tags": [], "bug_id": 43512, "is_private": false, "text": "Can you please provide the changes that made it work for you as a patch. Even if\nthis is not the solution is would be helpful for analysis of the problem.", "id": 108792, "time": "2007-09-29T02:38:14Z", "creator": "rpluem@apache.org", "creation_time": "2007-09-29T02:38:14Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "id": 108794, "time": "2007-09-29T03:07:40Z", "bug_id": 43512, "creation_time": "2007-09-29T03:07:40Z", "is_private": false, "text": "I just tested both www.cnn.com and www.ebay.com (using my apache as forward\nproxy and commandline telnet to request uncompressed output), and got the\ncorrectly-uncompressed output.\n\nYou've been confusing yourself and scaring the rest of us on IRC for rather a\nlong time.  Perhaps it would be a good idea to revert to a clean 2.2.6 install,\nand work from there."}, {"count": 3, "tags": [], "text": "Nick,\n\nIn order to duplicate this bug, you need to be using Apache with mod_proxy\nenabled and mod_deflate in the filter chain set to INFLATE gzip-ed content.\nI'll be attached an httpd.conf for Apache 2.2.6 that  provokes the buggy behavior.", "attachment_id": null, "id": 108795, "creation_time": "2007-09-29T03:15:28Z", "time": "2007-09-29T03:15:28Z", "creator": "pbelau1@yahoo.com", "bug_id": 43512, "is_private": false}, {"count": 4, "tags": [], "creator": "pbelau1@yahoo.com", "attachment_id": 20897, "is_private": false, "id": 108796, "time": "2007-09-29T03:16:40Z", "bug_id": 43512, "creation_time": "2007-09-29T03:16:40Z", "text": "Created attachment 20897\nhttpd config for  provoking mod_deflate bug"}, {"count": 5, "attachment_id": null, "creator": "pbelau1@yahoo.com", "is_private": false, "id": 108797, "time": "2007-09-29T03:18:30Z", "bug_id": 43512, "creation_time": "2007-09-29T03:18:30Z", "tags": [], "text": "Also, forgot to mention two things:\n\n1. Setting VALIDATON_SIZE to 0 fixes the problem when it pops up\n2. Both cnn.com and ebay.com do occasionally send all 8 validation bytes. Please\ntry making the request a few times before you conclude that there's nothing broken  "}, {"count": 6, "tags": [], "text": "Please set up a testcase for the alleged bug, so I can reproduce it.\nYou can use mod_asis to set exact headers, as well as the gzipped data.", "attachment_id": null, "bug_id": 43512, "id": 108798, "time": "2007-09-29T03:38:33Z", "creator": "nick@webthing.com", "creation_time": "2007-09-29T03:38:33Z", "is_private": false}, {"count": 7, "tags": [], "text": "I'm working on a test case for you, but the bug is really not at all hard to\nreproduce. It shows up both with 2.2.6 and TRUNK. Both cnn.com and ebay.com\nroutinely fail more than 50% of the time with both Firefox 1.5 and 2.0.", "attachment_id": null, "bug_id": 43512, "id": 108799, "time": "2007-09-29T04:31:02Z", "creator": "pbelau1@yahoo.com", "creation_time": "2007-09-29T04:31:02Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 43512, "is_private": false, "text": "I have been so far unable to reproduce this bug by copying the responses\ngeneated by  by perl IO::Socket to .asis files. In such cases, the files are\nrendered perfectly through INFLATE. I will continue my attempts at creating a\nbetter test case but I'm quite exhausted at this point.\n\nPlease note that this really is a bug and not a configuration issue. I would be\nglad to give someone access to my server if it allows him/her to more\nexpediently identify that this is indeed a bug and not a figment of my imagination.\n\nHopefully someone can take a look at this thing in earnest; I have not been\nhaving a pleasant time trying to fix it myself.", "id": 108801, "time": "2007-09-29T05:11:46Z", "creator": "pbelau1@yahoo.com", "creation_time": "2007-09-29T05:11:46Z", "attachment_id": null}, {"count": 9, "tags": [], "text": "Another bit of information:\n\nThe log output in error_log is Zlib: Validation bytes not present", "attachment_id": null, "bug_id": 43512, "id": 108803, "time": "2007-09-29T05:20:31Z", "creator": "pbelau1@yahoo.com", "creation_time": "2007-09-29T05:20:31Z", "is_private": false}, {"count": 10, "attachment_id": null, "creator": "covener@gmail.com", "is_private": false, "id": 108805, "time": "2007-09-29T07:23:26Z", "bug_id": 43512, "creation_time": "2007-09-29T07:23:26Z", "tags": [], "text": "I was able to reproduce this intermittently (2 requests fail w/ 0 length body,\nthen a success) with:\n\nLoadModule proxy_module modules/mod_proxy.so\nLoadModule proxy_http_module modules/mod_proxy_http.so\nLoadModule deflate_module modules/mod_deflate.so\n\nProxyPass /proxy/  http://www.cnn.com/\nLoadModule ext_filter_module modules/mod_ext_filter.so\nExtFilterDefine foo mode=output cmd=\"/usr/bin/perl -p -e 's/^/|/g'\" ftype=21\n<location /proxy/>\nExtFilterOptions debuglevel=999\nSetoutputfilter INFLATE;foo;DEFLATE\n</location>\n\nI sent a request with wget and --header=\"Accept-Encoding: gzip\""}, {"count": 11, "tags": [], "bug_id": 43512, "is_private": false, "text": "Fixed in trunk - r580598.  I expect you'll report back whether this fixes it for\nyou.\n\nComments:\n(1) Easy once I could reproduce the problem.\n(2) This is a problem that has affected many filters that worked fine in 2.0\nwhen moving to 2.2.\n(3) Sorry about my initial scepticism!", "id": 108808, "time": "2007-09-29T08:47:06Z", "creator": "nick@webthing.com", "creation_time": "2007-09-29T08:47:06Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "pbelau1@yahoo.com", "attachment_id": null, "is_private": false, "id": 108813, "time": "2007-09-29T11:21:36Z", "bug_id": 43512, "creation_time": "2007-09-29T11:21:36Z", "text": "Looking good ! I'll do some more testing and try to wrap my head around what you\ndid later (seems like a two line fix, but I didn't immediately understand why it\nworks...)\n\nGood night for now; hope to close out the ticket later. Thanks again.\n"}, {"count": 13, "tags": [], "creator": "takashi.asfbugzilla@tks.st", "attachment_id": null, "id": 113009, "time": "2008-01-19T09:23:47Z", "bug_id": 43512, "creation_time": "2008-01-19T09:23:47Z", "is_private": false, "text": "2.2 r580916\nhttp://svn.apache.org/viewvc?view=rev&revision=580916"}]
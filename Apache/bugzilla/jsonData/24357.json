[{"count": 0, "attachment_id": null, "bug_id": 24357, "is_private": false, "id": 46679, "time": "2003-11-03T15:40:40Z", "creator": "pwalendziak@yahoo.com", "creation_time": "2003-11-03T15:40:40Z", "tags": [], "text": "Hi!\n\nI did some examples on more granular access rights in slide.\nHere is my Domain.xml:\n\n<?xml version=\"1.0\"?>\n<slide logger=\"org.apache.slide.util.logger.SimpleLogger\" logger-level=\"6\" \ndefault=\"slide\">\n\t<!--\n    logger\n    ~~~~~~\n    org.apache.slide.util.logger.SimpleLogger\n       default logger with 1 log level\n    log4j.Log4jLogger\n       logger with fine granularity\n       see http://jakarta.apache.org/log4j/\n\n    logger-level\n    ~~~~~~~~~~~~\n    0 EMERGENCY\n    1 CRITICAL\n    2 ERROR\n    4 WARNING\n    6 INFO\n    7 DEBUG\n    -->\n\t<namespace name=\"slide\">\n\t\t<!-- ### Memory Configuration ###\n        The following memory configuration uses the MemoryDescriptorsStore for\n        node, security, locks and revisions. For content the FileContentStore\n        is used. Content is reset before start.\n        -->\n\t\t<!-- definition>\n\t\t\t<store name=\"memory\">\n\t\t\t\t<nodestore classname=\"slidestore.reference.\nMemoryDescriptorsStore\"/>\n\t\t\t\t<securitystore>\n\t\t\t\t\t<reference store=\"nodestore\"/>\n\t\t\t\t</securitystore>\n\t\t\t\t<lockstore>\n\t\t\t\t\t<reference store=\"nodestore\"/>\n\t\t\t\t</lockstore>\n\t\t\t\t<revisiondescriptorsstore>\n\t\t\t\t\t<reference store=\"nodestore\"/>\n\t\t\t\t</revisiondescriptorsstore>\n\t\t\t\t<revisiondescriptorstore>\n\t\t\t\t\t<reference store=\"nodestore\"/>\n\t\t\t\t</revisiondescriptorstore>\n\t\t\t\t<contentstore classname=\"slidestore.reference.FileContentStore\">\n\t\t\t\t\t<parameter name=\"rootpath\">contentstore</parameter>\n\t\t\t\t\t<parameter name=\"version\">false</parameter>\n\t\t\t\t\t<parameter name=\"resetBeforeStarting\">true</parameter>\n\t\t\t\t</contentstore>\n\t\t\t</store>\n\t\t\t<scope match=\"/\" store=\"memory\"/>\n\t\t</definition -->\n\n<definition>\n\t<store name=\"draft\">\n        <nodestore classname=\"pl.com.bull.slide.JDBCDescriptorsStore\">\n         <parameter name=\"driver\">oracle.jdbc.driver.OracleDriver</parameter>\n\t <parameter name=\"url\">jdbc:oracle:oci8:@d2</parameter>\n\t <parameter name=\"user\">pwalen_5</parameter><parameter \nname=\"password\">pwalen_5</parameter>\n        </nodestore>\n        <securitystore>\n          <reference store=\"nodestore\" />\n        </securitystore>\n        <lockstore>\n          <reference store=\"nodestore\" />\n        </lockstore>\n        <revisiondescriptorsstore>\n          <reference store=\"nodestore\" />\n        </revisiondescriptorsstore>\n        <revisiondescriptorstore>\n          <reference store=\"nodestore\" />\n        </revisiondescriptorstore>\n        <contentstore classname=\"pl.com.bull.slide.OracleContentStore\">\n         <parameter name=\"driver\">oracle.jdbc.driver.OracleDriver</parameter>\n\t <parameter name=\"url\">jdbc:oracle:oci8:@d2</parameter>\n\t <parameter name=\"user\">pwalen_5</parameter><parameter \nname=\"password\">pwalen_5</parameter>\n        </contentstore>                        \n\t</store>\n\n\t<store name=\"web\">\n        <nodestore classname=\"pl.com.bull.slide.JDBCDescriptorsStore\">\n         <parameter name=\"driver\">oracle.jdbc.driver.OracleDriver</parameter>\n\t <parameter name=\"url\">jdbc:oracle:oci8:@d2</parameter>\n\t <parameter name=\"user\">pwalen_7</parameter><parameter \nname=\"password\">pwalen_7</parameter>\n        </nodestore>\n        <securitystore>\n          <reference store=\"nodestore\" />\n        </securitystore>\n        <lockstore>\n          <reference store=\"nodestore\" />\n        </lockstore>\n        <revisiondescriptorsstore>\n          <reference store=\"nodestore\" />\n        </revisiondescriptorsstore>\n        <revisiondescriptorstore>\n          <reference store=\"nodestore\" />\n        </revisiondescriptorstore>\n\t<contentstore classname=\"pl.com.bull.slide.OracleContentStore\">\n         <parameter name=\"driver\">oracle.jdbc.driver.OracleDriver</parameter>\n\t <parameter name=\"url\">jdbc:oracle:oci8:@d2</parameter>\n\t <parameter name=\"user\">pwalen_7</parameter><parameter \nname=\"password\">pwalen_7</parameter>\n        </contentstore>\n      </store>\n      <scope match=\"/\" store=\"draft\"/>\n\t\t<scope match=\"/files/repository/web\" store=\"web\" />\n</definition>\n\t\t\n\t\t<!-- ### JDBC Configuration ###\n        The following jdbc sample configuration uses the hsql Database Engine\n        a relational database engine written in Java, for more info:\n        http://hsqldb.sourceforge.net/\n        -->\n\t\t<!--\n        <definition>\n            <store name=\"jdbc\">\n            <nodestore classname=\"slidestore.reference.JDBCDescriptorsStore\">\n                <parameter name=\"driver\">org.hsqldb.jdbcDriver</parameter>\n                <parameter name=\"url\">jdbc:hsqldb:slidestructure</parameter>\n                <parameter name=\"user\">sa</parameter>\n                <parameter name=\"password\"></parameter>\n            </nodestore>\n            <securitystore>\n                <reference store=\"nodestore\" />\n            </securitystore>\n            <lockstore>\n                <reference store=\"nodestore\" />\n            </lockstore>\n            <revisiondescriptorsstore>\n                <reference store=\"nodestore\" />\n            </revisiondescriptorsstore>\n            <revisiondescriptorstore>\n                <reference store=\"nodestore\" />\n            </revisiondescriptorstore>\n            <contentstore classname=\"slidestore.reference.JDBCContentStore\">\n                <parameter name=\"driver\">org.hsqldb.jdbcDriver</parameter>\n                <parameter name=\"url\">jdbc:hsqldb:slidecontent</parameter>\n                <parameter name=\"user\">sa</parameter>\n                <parameter name=\"password\"></parameter>\n            </contentstore>\n            </store>\n            <scope match=\"/\" store=\"jdbc\" />\n        </definition>\n        -->\n\t\t<!-- ### Mixed JDBC - Filesystem ###\n        stores: slidestore.reference.JDBCDescriptorsStore\n                slidestore.reference.FileContentStore\n        !!! set resetBeforeStarting parameter for FileContentStore to false !!!\n        -->\n\t\t<!-- ### Cloudscape configuration (embedded database) ###\n        stores: slidestore.cloudscape.CloudscapeDescriptorsStore\n                slidestore.cloudscape.CloudscapeContentStore\n        driver: COM.cloudscape.core.JDBCDriver\n        url:    jdbc:cloudscape:slidestructure;create=true\n                jdbc:cloudscape:slidecontent;create=true\n        -->\n\t\t<!-- ### Oracle configuration (thin driver) ###\n        stores: slidestore.reference.JDBCDescriptorsStore\n                slidestore.oracle.OracleContentStore\n        driver: oracle.jdbc.OracleDriver\n        url:    jdbc:oracle:thin:@localhost:1521:slide\n        -->\n\t\t<configuration>\n\t\t\t<!-- Actions mapping -->\n\t\t\t<read-object>/actions/read/readobject</read-object>\n\t\t\t<create-object>/actions/write/createobject</create-object>\n\t\t\t<remove-object>/actions/write/removeobject</remove-object>\n\t\t\t<grant-permission>/actions/manage/grantpermission</grant-permission>\n\t\t\t<revoke-permission>/actions/manage/revokepermission</revoke-permissio\nn>\n\t\t\t<read-permissions>/actions/manage/readpermission</read-permissions>\n\t\t\t<lock-object>/actions/write/lockobject</lock-object>\n\t\t\t<kill-lock>/actions/manage/killlock</kill-lock>\n\t\t\t<read-locks>/actions/read/readlocks</read-locks>\n\t\t\t<read-revision-metadata>/actions/read/readrevisionmetadata</read-revi\nsion-metadata>\n\t\t\t<create-revision-metadata>/actions/write/createrevisionmetadata</crea\nte-revision-metadata>\n\t\t\t<modify-revision-metadata>/actions/write/modifyrevisionmetadata</modi\nfy-revision-metadata>\n\t\t\t<remove-revision-metadata>/actions/write/removerevisionmetadata</remo\nve-revision-metadata>\n\t\t\t<read-revision-content>/actions/read/revisioncontent</read-revision-c\nontent>\n\t\t\t<create-revision-content>/actions/write/createrevisioncontent</create\n-revision-content>\n\t\t\t<modify-revision-content>/actions/write/modifyrevisioncontent</modify\n-revision-content>\n\t\t\t<remove-revision-content>/actions/write/removerevisioncontent</remove\n-revision-content>\n\t\t\t<bind-member>/actions/write/bindmember</bind-member>\n\t\t\t<unbind-member>/actions/write/unbindmember</unbind-member>\n\t\t\t<!-- Paths configuration -->\n\t\t\t<userspath>/users</userspath>\n\t\t\t<guestpath>guest</guestpath>\n\t\t\t<filespath>/files</filespath>\n\n            <actionspath>/actions</actionspath>\n\t\t\t<parameter name=\"dav\">true</parameter>\n\n\t\t\t<parameter name=\"standalone\">true</parameter>\n\t\t\t<!-- Roles definition -->\n\t\t\t<role name=\"root\">slideroles.basic.RootRole</role>\n\t\t\t<role name=\"user\">slideroles.basic.UserRole</role>\n\t\t\t<role name=\"guest\">slideroles.basic.GuestRole</role>\n\t\t\t<!-- Users management -->\n\t\t\t<auto-create-users>true</auto-create-users>\n\t\t\t<!-- Default properties mapping -->\n\t\t\t<default-property namespace=\"http://jakarta.apache.org/slide/\" \nname=\"password\" value=\"\" role=\"user\"/>\n\t\t</configuration>\n\t\t<data>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.SubjectNode\" \nuri=\"/\">\n\t\t\t\t<!-- Subject can be:\n                self  \"~\"\n                all   \"nobody\"\n                user  \"/users/john\"\n                group \"+/users/groupA\"\n                role  \"root\"\n                -->\n\t\t\t\t<!-- Uncomment the following line to give all permissions to\n                principals have the root role\n                -->\n\t\t\t\t<permission action=\"/actions\" subject=\"root\"/>\n\t\t\t\t<permission action=\"/actions/read\" subject=\"user\" \ninheritable=\"false\"/>\n\t\t\t\t<!-- /users -->\n\t\t\t\t<objectnode classname=\"org.apache.slide.structure.SubjectNode\" \nuri=\"/users\" />\n\t\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions\">\n\t\t\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/read\"/>\n\t\t\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write\"/>\n\t\t\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/manage\"/>\n\t\t\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/read/readobject\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/createobject\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/removeobject\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/manage/grantpermission\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/manage/revokepermission\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/manage/readpermission\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/lockobject\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/manage/killlock\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/read/readlocks\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/read/readrevisionmetadata\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/createrevisionmetadata\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/modifyrevisionmetadata\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/removerevisionmetadata\"/>\n\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/read/revisioncontent\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/createrevisioncontent\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/modifyrevisioncontent\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/removerevisioncontent\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/bindmember\"/>\n\t\t\t<objectnode classname=\"org.apache.slide.structure.ActionNode\" \nuri=\"/actions/write/unbindmember\"/>\n\t\t\t\t</objectnode>\n\t\t\t\t<objectnode classname=\"org.apache.slide.structure.SubjectNode\" \nuri=\"/files\">\n\t\t\t\t\t<!-- ### Give read/write/manage permission to guest ###\n                    Uncomment the following line to give permission to do all\n                    actions on /files to guest (unauthenticated users) -->\n\t\t\t\t\t<!--\n                    <permission action=\"/actions\" subject=\"/users/guest\"/>\n\t\t    -->\n\t\t    \t\t\t<permission action=\"/actions/read\" subject=\"user\"/>\n\t\t    \t\t\t<permission action=\"/actions/write\" subject=\"user\"/>\n\t\t\t\t</objectnode>\n\t\t\t\t<!-- DeltaV: default history and workspace paths -->\n\t\t\t\t<objectnode classname=\"org.apache.slide.structure.SubjectNode\" \nuri=\"/history\">\n\t\t\t\t\t<permission action=\"/actions/read\" subject=\"user\"/>\n\t\t\t\t\t<permission action=\"/actions/write\" subject=\"user\"/>\n\t\t\t\t\t<permission action=\"/actions/write/removeobject\" subject=\"user\" \nnegative=\"true\" />\n\t\t\t\t</objectnode>\n\t\t\t\t<objectnode classname=\"org.apache.slide.structure.SubjectNode\" \nuri=\"/workspace\"/>\n\t\t\t\t<objectnode classname=\"org.apache.slide.structure.SubjectNode\" \nuri=\"/workingresource\"/>\n\t\t\t</objectnode>\n\t\t</data>\n\t</namespace>\n\t<!--\n    DeltaV global parameters\n    ========================\n    * historypath (mandatory=no, default=\"/history\"):\n    Specifies a Slide path which determines the location where this DeltaV\n    server stores history data.\n\n    * workspacepath (mandatory=no, default=\"/workspace\"):\n    Specifies a Slide path which determines the location where this DeltaV\n    server allows workspaces to reside.\n\n    * workingresourcepath (mandatory=no, default=\"/workingresource\"):\n    Specifies a Slide path which determines the location where this DeltaV\n    server stores working resources.\n\n    * auto-version (mandatory=no, default=\"checkout-checkin\"):\n    Controls the DeltaV auto-version behaviour.\n\n    * auto-version-control (mandatory=no, default=\"false\"):\n    Indicates if a resource just created by a PUT should be set under\n    version-control.\n\n   * versioncontrol-exclude (mandatory=no, default=\"\"):\n   Specifies a Slide path which determines resources which are excluded from \nversion-control.\n   The default value \"\" makes no path being excluded.\n\n    * checkout-fork (mandatory=no, default=\"forbidden\"):\n    Controls the DeltaV check-out behaviour when a version is already\n    checked-out or has a successor.\n\n    * checkin-fork (mandatory=no, default=\"forbidden\"):\n    Controls the DeltaV check-out behaviour when a version has already a\n    successor.\n\n    * standardLivePropertiesClass (mandatory=no,\n    default=\"org.apache.slide.webdav.util.resourcekind.AbstractResourceKind\"):\n    Determines the \"agent\" knowing about what the standard live properties are.\n    It should be a loadable class containing the following static methods:\n    - boolean isLiveProperty(String propName)\n    - boolean isProtectedProperty(String propName)\n    - boolean isComputedProperty(String propName)\n    - Set getAllLiveProperties()\n    - Set getAllProtectedProperties()\n    - Set getAllComputedProperties()\n\n    * uriRedirectorClass (mandatory=no,\n    default=\"org.apache.slide.webdav.util.DeltavUriRedirector\"):\n    Determines the URI redirector class. The DeltaV URI redirector is in\n    charge of the following redirections:\n    - version URI to history URI, e.g. /history/2/1.4 to /history/2\n    - latest revision number for history resource to 0.0\n    - latest revision number for version resource to last URI token,\n    e.g. /history/2/1.4 to 1.4\n    It should be a loadable class containing the following static methods:\n    - String redirectUri(String uri)\n    - NodeRevisionNumber redirectLatestRevisionNumber(String uri)\n    -->\n\t<parameter name=\"historypath\">/history</parameter>\n\t<parameter name=\"workspacepath\">/workspace</parameter>\n\t<parameter name=\"workingresourcepath\">/workingresource</parameter>\n\t<!--parameter name=\"auto-version\">locked-checkout</parameter-->\n\t<parameter name=\"auto-version\">checkout-checkin</parameter>\n\t<!--parameter name=\"auto-version-control\">false</parameter-->\n\t<parameter name=\"auto-version-control\">true</parameter>\n\t<parameter \nname=\"versioncontrol-exclude\">/files/repository/books</parameter>\n\t<parameter name=\"checkout-fork\">forbidden</parameter>\n\t<parameter name=\"checkin-fork\">forbidden</parameter>\n</slide>\n\n\nI used it to limit possibility of removing something from history.\nFrom the document (http://jakarta.apache.org/slide/security.html) that describes \naccess rights in slide I read that those should work in such way:\n\n/files , /actions/write , /users/john \n- granted all actions under /actions/write\n\n/files/a , /actions/write/removeobject, negative, /users/john \n- denied /actions/write/removeobject action, so I can create but can not remove \n(check access definition for the history)\n\n/files/a/b , /actions/write, /users/john\n- granted again all actions under /actions/write\n\n/files/a , /actions/write, /users/john\n/files/a/c , /actions/write, negative, /users/john\n- granted again all actions under /actions/write\n- denied again all actions under /actions/write\n\nSo summarizing:\n-john can create and remove in /files and /files/a/b\n-john can create but not remove in /files/a\n-john can not create nor remove in /files/a/c\n\nHere is a path to have this working:\n\norg/apache/slide/security/SecurityImpl.java:\n508c508\n<         while (!granted && !denied && !rootObjectReached) {\n---\n>         while (!denied && !(granted && !denied) && !rootObjectReached) {\n\norg/apache/slide/security/SecurityImplAllGrant.java\n140c140\n<         while (!granted && !denied && !rootObjectReached) {\n---\n>         while (!denied && !(granted && !denied) && !rootObjectReached) {\n146c146\n<             while (!granted && !denied && permissions.hasMoreElements()) {\n---\n>             while (permissions.hasMoreElements()) {\n\n\nBye"}, {"attachment_id": null, "tags": [], "bug_id": 24357, "text": "To me it seems you changed the semantics of the security check algorithm. Is\nthat right?", "count": 1, "id": 64539, "time": "2004-10-04T07:27:41Z", "creator": "ozeigermann@apache.org", "creation_time": "2004-10-04T07:27:41Z", "is_private": false}]
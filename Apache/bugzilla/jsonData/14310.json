[{"count": 0, "tags": [], "bug_id": 14310, "text": "Basically the code tries to create a FileInputStream from the array of strings\nnamed input, which only contains null references. I expect that an npe might\neven be thrown if only one invalid file is passed in. This probably has not been\nrun into before because that rarely happens with filesets. \n\nI guess the fact that this hasn't come up before shows how (in)frequently file\nlists are used with this task :) \n\nReproduction:\n\nThe following build file will create an npe\n\n<?xml version=\"1.0\"?>\n<project name=\"concat-test\" basedir=\".\" default=\"all\">\n\n<target name=\"all\">\n   <concat destfile=\"TESTDEST\" append=\"true\">\n      <filelist dir=\".\" files=\"thisfiledoesnotexist\"/>\n   </concat>\n</target>\n\n</project>\n\nThis is the npe output:\n\n[gus@draco gus]$ ~/projects/jakarta-ant/dist/bin/ant -buildfile test.xml\nBuildfile: test.xml\n\nall:\n   [concat] File /home/gus/thisfiledoesnotexist does not exist.\n\nBUILD FAILED\njava.lang.NullPointerException\n        at java.io.File.<init>(File.java:180)\n        at java.io.FileInputStream.<init>(FileInputStream.java:66)\n        at org.apache.tools.ant.taskdefs.Concat.catFiles(Concat.java:350)\n        at org.apache.tools.ant.taskdefs.Concat.execute(Concat.java:268)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:336)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1331)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1275)\n        at org.apache.tools.ant.Main.runBuild(Main.java:614)\n        at org.apache.tools.ant.Main.start(Main.java:197)\n        at org.apache.tools.ant.Main.main(Main.java:235)\n\nTotal time: 1 second\njava.lang.NullPointerException\n        at java.io.File.<init>(File.java:180)\n        at java.io.FileInputStream.<init>(FileInputStream.java:66)\n        at org.apache.tools.ant.taskdefs.Concat.catFiles(Concat.java:350)\n        at org.apache.tools.ant.taskdefs.Concat.execute(Concat.java:268)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:336)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1331)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1275)\n        at org.apache.tools.ant.Main.runBuild(Main.java:614)\n        at org.apache.tools.ant.Main.start(Main.java:197)\n        at org.apache.tools.ant.Main.main(Main.java:235)", "id": 25815, "time": "2002-11-06T20:00:52Z", "creator": "gus.heck@olin.edu", "creation_time": "2002-11-06T20:00:52Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 14310, "text": "I fogot to mention, I have fixed this and will be attaching a patch soon...", "id": 25816, "time": "2002-11-06T20:02:03Z", "creator": "gus.heck@olin.edu", "creation_time": "2002-11-06T20:02:03Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "gus.heck@olin.edu", "text": "Created attachment 3759\nPatch with test case failing the old code, and new code passing the test case.", "id": 25819, "time": "2002-11-06T20:18:48Z", "bug_id": 14310, "creation_time": "2002-11-06T20:18:48Z", "is_private": false, "attachment_id": 3759}, {"count": 3, "attachment_id": null, "bug_id": 14310, "text": "Bug is fixed, but I've used a different approach.  Making the build fail is\nwrong IMHO as we don't fail for empty filesets either.\n\n", "id": 25921, "time": "2002-11-08T13:11:27Z", "creator": "bodewig@apache.org", "creation_time": "2002-11-08T13:11:27Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 14310, "is_private": false, "id": 25957, "time": "2002-11-08T16:49:05Z", "creator": "gus.heck@olin.edu", "creation_time": "2002-11-08T16:49:05Z", "tags": [], "text": "Ok consistancy seems reasonable, but it looks like there is a bit of odd\nbehavior going on as well if you don't throw the exception, an empty file gets\ncreated when there is nothing to concatenate. Perhaps we could throw in a check\nfor 0 files that causes the method to return?\n\nI'm not wild about nothing + nothing = empty file. \n\nI'd like to see nothing + nothing = nothing. \n\nThe first case means you can't checkup on the success of your concat with and\navailable task.\n\nOr even better a failonerror setting? I don't like silently swallowing a\ncondition where the only files specified turn out not to exist. Imagine how much\nfun FileInputStream would be if it did that :)."}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "text": "OK, I'll take care of it next week or so.\n\nI'd say we print a WARN message in case there really is nothing to add at all\nand don't open the file if there is nothing to print to it.", "id": 25959, "time": "2002-11-08T16:57:54Z", "bug_id": 14310, "creation_time": "2002-11-08T16:57:54Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 14310, "text": "That sounds good except for the part about next week :) So how about if I do it\nfor you?\n\nHere's a patch that does just what you asks and tests for it too :)", "id": 25968, "time": "2002-11-08T18:45:12Z", "creator": "gus.heck@olin.edu", "creation_time": "2002-11-08T18:45:12Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "gus.heck@olin.edu", "text": "Created attachment 3782\nPatch to not create empty file and warn about noexistant files", "id": 25969, "time": "2002-11-08T18:46:40Z", "bug_id": 14310, "creation_time": "2002-11-08T18:46:40Z", "is_private": false, "attachment_id": 3782}, {"count": 8, "attachment_id": null, "bug_id": 14310, "is_private": false, "id": 26129, "time": "2002-11-12T12:02:39Z", "creator": "bodewig@apache.org", "creation_time": "2002-11-12T12:02:39Z", "tags": [], "text": "patch applied, thanks."}]
[{"count": 0, "tags": [], "bug_id": 60041, "attachment_id": null, "id": 193318, "time": "2016-08-25T07:36:41Z", "creator": "gehill_cn@sina.com", "creation_time": "2016-08-25T07:36:41Z", "is_private": false, "text": "After deploy war in tomcat, delete the jar in WEB-INF/lib/, then it may throws NullPointerException when load class\n\n\nThe reason as follow:\n\nWebappClassLoaderBase (between line 3093 and 3110 in method openJARs())\n\n    protected boolean openJARs() {\n        if (started && (jarFiles.length > 0)) {\n            lastJarAccessed = System.currentTimeMillis();\n            if (jarFiles[0] == null) {\n                for (int i = 0; i < jarFiles.length; i++) {\n                    try {\n                        jarFiles[i] = new JarFile(jarRealFiles[i]);\n                    } catch (IOException e) {\n                        if (log.isDebugEnabled()) {\n                            log.debug(\"Failed to open JAR\", e);\n                        }\n                        return false;\n                    }\n                }\n            }\n        }\n        return true;\n    }\n\n\nIf IOException is thrown in line 3099, the jarFiles will be [file1,file2,NULL,NULL,...]. after that, it will return true when invoke openJARs(), beacuse jarFiles[0] != null. \n\n\nWebappClassLoaderBase (between line 3271 and 3285 in method openJARs())\n\n            if (openJARs()) {\n                for (int i = 0; i < jarFiles.length; i++) {\n\n                    jarEntry = jarFiles[i].getJarEntry(jarEntryPath);\n\n                    if (jarEntry != null) {\n                        try {\n                            entry.manifest = jarFiles[i].getManifest();\n                        } catch (IOException ioe) {\n                            // Ignore\n                        }\n                        break;\n                    }\n                 }\n             }\n\n\n\nbeacuse jarFiles=[file1,file2,NULL,NULL,...], so jarFiles[i] may be null, This will cause NullPointerException in line 3274. In this case, it is difficult to judge what went wrong.\n\nI attached a patch that fixes it"}, {"count": 1, "tags": [], "creator": "gehill_cn@sina.com", "attachment_id": 34171, "text": "Created attachment 34171\npatch", "id": 193319, "time": "2016-08-25T07:39:45Z", "bug_id": 60041, "creation_time": "2016-08-25T07:39:45Z", "is_private": false}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Thanks. I applied a variation that used i18n. Note deleting a JAR like this is expected to break things. This has been fixed in 7.0.x for 7.0.71 onwards.", "id": 193336, "time": "2016-08-25T21:00:40Z", "bug_id": 60041, "creation_time": "2016-08-25T21:00:40Z", "is_private": false}]
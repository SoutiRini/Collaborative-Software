[{"count": 0, "tags": [], "bug_id": 4948, "text": "In classes loaded by the webapp class loader, the getPackage() method of \njava.lang.Class returns null. I could not reproduce this behavior in Tomcat 3.2 \nor 4.0.1.  The last version of Tomcat 3.3 that worked correctly in this regard \nwas the m4 version.  I have found that I can work around this bug by copying \nall the jars in my webapp to Tomcat's lib/apps directory but of course that's \nnot the right way to fix this problem.  \n\n  I've been able to reproduce this bug on multiple systems ( RedHat Linux 6.2, \nAIX 4.3.3, WinNT 4.0 SP4, Win2k SP2 ) and with both the IBM and Sun JVM \nimplementations on each platform where both are available.  I reproduced the \nproblem with a simple servlet that had a single line of code: response.getWriter\n().println(getClass().getPackage())\n\n  As I understand the code in DependClassLoader.java, \"parent\" is the immediate \nparent of the DependClassLoader instance and \"parent2\" is the immediate parent \nof that \"parent\".  This separation of parent vs. parent2 seems to have been \nimplemented in revision 1.5 of DependClassLoader.java in response to a class \nreloading bug reported by Ovidiu Predescu.  In trying to debug this problem \nmyself, I found that modifying the class loader to delegate to \"parent\" instead \nof \"parent2\" ( line 174 ) fixed the getPackage() == null problem.  In searching \nthe mailing lists and bug reports I was unable to find any description of that \nproblem so I have no idea if reverting this part of that patch will have any \nnegative repercussions on class reloading.  All I can say for certain is that \nit \"works for me\" and in a quick sanity test of class reloading I saw no odd \nbehavior.", "id": 8055, "time": "2001-11-19T05:55:13Z", "creator": "j.d.bartley@verizon.net", "creation_time": "2001-11-19T05:55:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "text": "The \"problem\" is that by loading from parent rather than parent2, Tomcat will \nno longer do an automatic reload if you make changes in WEB-INF/classes.  Of \ncourse, you can still cause a reload by \"touching\" web.xml after you update the \nclasses.  If this \"works for you\", by all means continue with the change backed \nout.  ", "id": 8081, "time": "2001-11-19T22:42:02Z", "bug_id": 4948, "creation_time": "2001-11-19T22:42:02Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 4948, "text": "  Thanks for the clarification of what the class reloading problem was.  You're \nright about the way I was testing it ( touching web.xml ) and I agree that \nthat's not good enough.  So, I spent some more time now digging in to \nDependClassLoader.java, trying to understand how it could possibly fail to \ndefine packages.  It turns out that the problem was much simpler than I had \nimagined it to be.  The root of the problem is that DependClassLoader12 is \nnever calling definePackage.  Apparently, this must be a not-very-often used \nfeature because everything still runs just fine regardless ( until you \nencounter some code that wants to call Class.getPackage() and it gets null ).  \nI've modified my copy of DependClassLoader12.java to call definePackage \nappropriately and will attach a patch containing those changes.  Thanks for \nyour attention.", "id": 8099, "time": "2001-11-20T08:09:09Z", "creator": "j.d.bartley@verizon.net", "creation_time": "2001-11-20T08:09:09Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "j.d.bartley@verizon.net", "attachment_id": 807, "text": "Created attachment 807\nTeaches the DependClassLoader how to define packages for Java2", "id": 8100, "time": "2001-11-20T08:09:50Z", "bug_id": 4948, "creation_time": "2001-11-20T08:09:50Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 4948, "attachment_id": null, "id": 8125, "time": "2001-11-20T19:19:20Z", "creator": "william.barker@wilshire.com", "creation_time": "2001-11-20T19:19:20Z", "is_private": false, "text": "I've checked your patch into the CVS.\nThank you for your contribution!"}, {"count": 5, "tags": [], "bug_id": 4948, "attachment_id": null, "id": 9757, "time": "2002-01-21T03:39:08Z", "creator": "olaf.jahn@zamioculcas.net", "creation_time": "2002-01-21T03:39:08Z", "is_private": false, "text": "FYI: This bug is still present in 3.3a from 14-Jan-2002.\n"}, {"count": 6, "tags": [], "text": "This bug is definitely still live in Tomcat 3.3.\n\n-Eric", "attachment_id": null, "id": 17131, "creation_time": "2002-06-04T02:49:50Z", "time": "2002-06-04T02:49:50Z", "creator": "bloch@clearwellsystems.com", "bug_id": 4948, "is_private": false}, {"count": 7, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "text": "Largely because it does against 3.3.1.\n\nYou'll need to submit a test-case to show that there are still problems with \nthe ClassLoader.", "id": 17156, "time": "2002-06-05T04:34:54Z", "bug_id": 4948, "creation_time": "2002-06-05T04:34:54Z", "is_private": false}]
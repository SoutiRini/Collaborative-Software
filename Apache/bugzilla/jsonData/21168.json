[{"count": 0, "tags": [], "bug_id": 21168, "text": "One of the new features of Jasper in Tomcat 5 is that it attaches a \"Source\nMap\" attribute to class files to describe the file name and line number\nmapping from a JSP source file to the generated Java source file.\n\nThe SMAP that I see in the class files generated by Jasper (5.0.3 alpha)\nhas a couple of small problems:\n\n1. The second line of the SMAP, according to JSR-45, is the name of the\n   generated source file.  This name should be without path information,\n   but path information appears in the version generated by Jasper.\n\n2. In the \"*F\" section, there's a pair of lines that defines the JSP file.\n   The second line is the source path for the JSP file.  The path created\n   by Jasper contains a leading slash, making it an absolute path.  It\n   should be relative; the leading slash should not appear.", "id": 39583, "time": "2003-06-29T01:22:29Z", "creator": "jph@us.ibm.com", "creation_time": "2003-06-29T01:22:29Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "ecarmich@alumni.rice.edu", "attachment_id": null, "is_private": false, "id": 41135, "time": "2003-07-22T08:40:24Z", "bug_id": 21168, "creation_time": "2003-07-22T08:40:24Z", "text": "The second line of the SMAP contains path information on Windows machines \nbecause SmapUtil.java's generateSmap() method calls unqualify() to remove the \npath information, and unqualify() only works on pathname strings with \"/\" as \nthe name-separator character.  I fixed this by rewriting unqualify().\n\nThe leading slash in the source path in the \"*F\" section originates deep \nwithin Tomcat (for instance, in a call to HttpServletRequest.getServletPath() \nwhen the request is first touched), so I chose to remove the leading slash \njust before writing the source path to the SMAP.\n\nI will attach a patch containing these fixes."}, {"count": 2, "attachment_id": 7441, "creator": "ecarmich@alumni.rice.edu", "is_private": false, "id": 41136, "time": "2003-07-22T08:41:29Z", "bug_id": 21168, "creation_time": "2003-07-22T08:41:29Z", "tags": [], "text": "Created attachment 7441\nProposed patch"}, {"count": 3, "tags": [], "bug_id": 21168, "text": "Applied patch with slight modification:\n\nInstead of (as suggested in the patch):\n\n  private static String unqualify(String path) {\n    File f = new File(path);\n    return f.getName();\n  }\n\nthe impl now does this:\n\n  private static String unqualify(String path) {\n    return path.substring(path.lastIndexOf(File.separator) + 1);\n  }\n\nwhich avoids generation of a File object.\n\n", "id": 42123, "time": "2003-08-05T01:17:54Z", "creator": "jan.luehe@sun.com", "creation_time": "2003-08-05T01:17:54Z", "is_private": false, "attachment_id": null}]
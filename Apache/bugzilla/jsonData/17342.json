[{"count": 0, "tags": [], "bug_id": 17342, "attachment_id": null, "id": 31871, "time": "2003-02-24T16:55:21Z", "creator": "Dave@Staffplanner.co.uk", "creation_time": "2003-02-24T16:55:21Z", "is_private": false, "text": "With Tomcat JK2 connectionTimeout set, mod_jk is retries three times while the \nconnections are being reset. On a very fast machine mod_jk retries before a \nnew connection is available and returns an error 500 to the end user. The \nworkaround is to set connectionTimeout to -1 to stop connection refreshes.\n\nThere now follows an EMail conversation between myself and Costin on this \nproblem:\n\nI think:\n\nFrom winsock.h:\n#define WSABASEERR              10000\n#define WSAECONNABORTED         (WSABASEERR+53)\n\nFrom VC.NET help files:\nWSAECONNABORTED=The virtual circuit was terminated due to a time-out or other \nfailure. The application should close the socket as it is no longer usable.\n\nDave.\n\n> Thanks Dave.\n>\n> Now if someone has windows and can grep what errno \"53\" means...\n>\n>\n> Costin\n>\n> Oxley, David wrote:\n>\n>> Costin,\n>>\n>> Here is the log produced with mod_jk HEAD:\n>> [Mon Feb 17 17:23:26 2003]  [jk_ajp_common.c (681)]: ERROR: can't \n>> receive the response message from tomcat, network problems or tomcat \n>> is down. err=-53\n>> [Mon Feb 17 17:23:26 2003]  [jk_ajp_common.c (1051)]: Error reading\n>> reply\n>> from tomcat. Tomcat is down or network problems.\n>> [Mon Feb 17 17:23:26 2003]  [jk_ajp_common.c (1188)]: ERROR: Receiving\n>> [from\n>> tomcat failed, recoverable operation. err=0\n>> [Mon Feb 17 17:23:26 2003]  [jk_ajp_common.c (681)]: ERROR: can't\n>> receive\n>> the response message from tomcat, network problems or tomcat is down.\n>> err=-1\n>> [Mon Feb 17 17:23:26 2003]  [jk_ajp_common.c (1051)]: Error reading\n>> reply\n>> from tomcat. Tomcat is down or network problems.\n>> [Mon Feb 17 17:23:26 2003]  [jk_ajp_common.c (1188)]: ERROR: Receiving\n>> [from\n>> tomcat failed, recoverable operation. err=1\n>> [Mon Feb 17 17:23:26 2003]  [jk_ajp_common.c (681)]: ERROR: can't\n>> receive\n>> the response message from tomcat, network problems or tomcat is down.\n>> err=-1\n>> [Mon Feb 17 17:23:26 2003]  [jk_ajp_common.c (1051)]: Error reading\n>> reply\n>> from tomcat. Tomcat is down or network problems.\n>> [Mon Feb 17 17:23:26 2003]  [jk_ajp_common.c (1188)]: ERROR: Receiving\n>> [from\n>> tomcat failed, recoverable operation. err=2\n>> [Mon Feb 17 17:23:26 2003]  [jk_ajp_common.c (1199)]: Error connecting\n>> to\n>> tomcat. Tomcat is probably not started or is listenning on the wrong\n>> port.\n>> Failed errno = 53\n>>\n>> Cheers.\n>> Dave.\n>>\n>>> -----Original Message-----\n>>> From: Oxley, David [mailto:David.Oxley@workplace-systems.plc.uk]\n>>> Sent: 17 February 2003 17:00\n>>> To: 'Tomcat Developers List'\n>>> Subject: RE: mod_jk and Apache timeouts?\n>>>\n>>> Costin,\n>>>\n>>> I will rebuild from HEAD now and give it a try.\n>>> But I think I may have sorted found the problem. I have changed the \n>>> Connector timeout to -1 in server.xml, and error 500's is no longer \n>>> returned. Therefore on this box, mod_jk is too quick for Tomcat (I \n>>> think). mod_jk tries to connect and fails 3 times (before TC has \n>>> restarted its Connector threads) and returns an error 500 to the \n>>> client.\n>>>\n>>> Dave.\n>>>\n>>> > -----Original Message-----\n>>> > From: Costin Manolache [mailto:cmanolache@yahoo.com]\n>>> > Sent: 17 February 2003 17:02\n>>> > To: tomcat-dev@jakarta.apache.org\n>>> > Subject: Re: mod_jk and Apache timeouts?\n>>> >\n>>> > I suspect it's a windows specific return code from recv().\n>>> >\n>>> > The code in question calls socket_recvfull - which in turn calls\n>>> recv()\n>>> > to fill a buffer. It handles EAGAIN - but knowing windows, it may \n>>> > be something else.\n>>> >\n>>> > If you can do a checkout from HEAD and built again - you should \n>>> > see the errno at the end of the message, so we can figure out what\n>>> happens.\n>>> >\n>>> > The first error is the one that matters - the others are just jk\n>>> doing\n>>> > a retry. The message is bad - err=0,1,2 should be \"retry=0,1,2\"\n>>> >\n>>> >\n>>> >\n>>> > Costin\n>>> >\n>>> >\n>>> > Oxley, David wrote:\n>>> >\n>>> > > I have some strange error messages in mod_jk.log that I cannot\n>>> explain,\n>>> > > and that I need to resolve urgently.\n>>> > >\n>>> > > Server:\n>>> > > Dual Xeon 2.5Ghz server.\n>>> > > Windows 2000 Professional SP3\n>>> > > Apache 2.0.44\n>>> > > Tomcat 4.1.18\n>>> > > Mod_jk 1.2.2\n>>> > >\n>>> > > [Mon Feb 17 14:49:38 2003]  [jk_ajp_common.c (681)]: ERROR: \n>>> > > can't\n>>> > receive\n>>> > > the response message from tomcat, network problems or tomcat is\n>>> down.\n>>> > > [Mon Feb 17 14:49:38 2003]  [jk_ajp_common.c (1050)]: Error \n>>> > > reading\n>>> > reply\n>>> > > from tomcat. Tomcat is down or network problems.\n>>> > > [Mon Feb 17 14:49:38 2003]  [jk_ajp_common.c (1187)]: ERROR: \n>>> > > [Receiving from tomcat failed, recoverable operation. err=0\n>>> > > [Mon Feb 17 14:49:38 2003]  [jk_ajp_common.c (681)]: ERROR: can't\n>>> > receive\n>>> > > the response message from tomcat, network problems or tomcat is\n>>> down.\n>>> > > [Mon Feb 17 14:49:38 2003]  [jk_ajp_common.c (1050)]: Error \n>>> > > reading\n>>> > reply\n>>> > > from tomcat. Tomcat is down or network problems.\n>>> > > [Mon Feb 17 14:49:38 2003]  [jk_ajp_common.c (1187)]: ERROR: \n>>> > > [Receiving from tomcat failed, recoverable operation. err=1\n>>> > > [Mon Feb 17 14:49:38 2003]  [jk_ajp_common.c (681)]: ERROR: can't\n>>> > receive\n>>> > > the response message from tomcat, network problems or tomcat is\n>>> down.\n>>> > > [Mon Feb 17 14:49:38 2003]  [jk_ajp_common.c (1050)]: Error \n>>> > > reading\n>>> > reply\n>>> > > from tomcat. Tomcat is down or network problems.\n>>> > > [Mon Feb 17 14:49:38 2003]  [jk_ajp_common.c (1187)]: ERROR: \n>>> > > [Receiving from tomcat failed, recoverable operation. err=2\n>>> > > [Mon Feb 17 14:49:38 2003]  [jk_ajp_common.c (1198)]: Error\n>>> > > [connecting\n>>> > to\n>>> > > tomcat. Tomcat is probably not started or is listenning on the\n>>> wrong\n>>> > port.\n>>> > > Failed errno = 0\n>>> > >\n>>> > >\n>>> > >\n>>> > > The line 'ERROR: Receiving from tomcat failed, recoverable\n>>> operation.\n>>> > > err=0' happens all the time but when the above happens i.e. \n>>> > > err=0\n>>> ->\n>>> > err=1\n>>> > > -> err=2 the browser is returned an error 500. I have a much \n>>> > > -> slower\n>>> box\n>>> > > (P4 1.7Ghz) that gets the err=0 line all the time but never gets\n>>> the\n>>> > err=1\n>>> > > and err=2 lines and therefore never responds with an error 500.\n>>> > >\n>>> > > I have a feeling that there is a retry that is happening but the\n>>> box\n>>> is\n>>> > so\n>>> > > quick the threads on the Tomcat side aren't refreshed before \n>>> > > Apache\n>>> > gives\n>>> > > up. If this can be fixed by changing the config files then I \n>>> > > think\n>>> this\n>>> > > should be noted in the docs otherwise this is a bug!?!?\n>>> > >\n>>> > >\n>>> > >\n>>> > > Here is the relevant parts of the config.\n>>> > >\n>>> > > Server.xml:\n>>> > >\n>>> > >     <Connector\n>>> className=\"org.apache.coyote.tomcat4.CoyoteConnector\"\n>>> > >\n>>> > >                port=\"8009\" minProcessors=\"5\" maxProcessors=\"75\"\n>>> > >\n>>> > >                enableLookups=\"true\" redirectPort=\"443\"\n>>> > >\n>>> > >                acceptCount=\"10\" debug=\"0\" \n>>> > > connectionTimeout=\"20000\"\n>>> > >\n>>> > >                useURIValidationHack=\"false\"\n>>> > >\n>>> > >\n>>> > > protocolHandlerClassName=\"org.apache.jk.server.JkCoyoteHandler\"/\n>>> > > >\n>>> > >\n>>> > > workers.properties:\n>>> > >\n>>> > > worker.ajp13.port=8009\n>>> > >\n>>> > > worker.ajp13.host=localhost\n>>> > >\n>>> > > worker.ajp13.type=ajp13\n>>> > >\n>>> > > worker.ajp13.lbfactor=1\n>>> > >\n>>> > > worker.ajp13.cachesize=10\n>>> > >\n>>> > > worker.ajp13.cache_timeout=600\n>>> > >\n>>> > >\n>>> > >\n>>> > > Thanks for your help.\n>>> > >\n>>> > >\n>>> > >\n>>> > > Dave Oxley\n>>> > > Development Team Leader\n>>> > >\n>>> > > Workplace Systems Plc\n>>> > > * +44 (0)118 9515 755\n>>> > > *  <mailto:david.oxley@workplace-systems.plc.uk>\n>>> > > david.oxley@workplace-systems.plc.uk\n>>> > > *  <http://www.workplace-systems.plc.uk/>\n>>> > > http://www.workplace-systems.plc.uk\n>>> > >\n>>> > >\n>>> > >\n>>> > > There was once a young man who, in his youth, professed his \n>>> > > desire\n>>> to\n>>> > > become a great writer.\n>>> > > When asked to define great, he said, \"I want to write stuff that\n>>> the\n>>> > whole\n>>> > > world will read, stuff that people will react to on a truly\n>>> emotional\n>>> > > level, stuff that will make them scream, cry, howl in pain and \n>>> > > anger!\" He now works for Microsoft writing error messages.\n>>> > >\n>>> > >\n>>> > >\n>>> > > Workplace Systems plc, Precedent Drive, Rooksley, Milton Keynes,\n>>> MK13\n>>> > 8PP.\n>>> > > Registered in England No. 2016236\n>>> > >\n>>> > > Unless expressly stated the views expressed in this email may \n>>> > > not\n>>> be\n>>> the\n>>> > > views of Workplace Systems plc and the company, its directors,\n>>> officers\n>>> > or\n>>> > > employees accept no liability for its contents. Unless expressly\n>>> stated\n>>> > no\n>>> > > contracts may be concluded on behalf of Workplace Systems plc by \n>>> > > means\n>>> > of\n>>> > > e-mail communication.\n>>> > >\n>>> > > This e-mail, and any attachments are strictly confidential and\n>>> intended\n>>> > > for the addressee(s) only. If they have come to you in error you\n>>> must\n>>> > take\n>>> > > no action based on the contents, nor may you copy or show them \n>>> > > to\n>>> > anyone.\n>>> > > Please notify the sender of the error by return email. Please\n>>> ensure\n>>> you\n>>> > > have adequate virus protection before you open or detach any \n>>> > > documents from this transmission. Workplace Systems plc does not \n>>> > > accept any liability for viruses.\n>>> > >\n>>> > >\n>>> > >\n>>> > >\n>>> > >\n>>> > >\n>>> ____________________________________________________________________\n>>> ____\n>>> > > This e-mail has been scanned for all viruses by Star Internet. \n>>> > > The service is powered by MessageLabs. For more information on a \n>>> > > proactive anti-virus service working around the clock, around \n>>> > > the globe, visit: http://www.star.net.uk\n>>> > >\n>>> ____________________________________________________________________\n>>> ____\n>>> >\n>>> >\n>>> >\n>>> > ------------------------------------------------------------------\n>>> > ---\n>>> > To unsubscribe, e-mail: tomcat-dev-unsubscribe@jakarta.apache.org\n>>> > For additional commands, e-mail: tomcat-dev-help@jakarta.apache.org\n>>> >\n>>> >\n>>> >\n> ______________________________________________________________________\n> __\n>>> > This e-mail has been scanned for all viruses by Star Internet. The \n>>> > service is powered by MessageLabs. For more information on a\n>>> proactive\n>>> > anti-virus service working around the clock, around the globe, \n>>> > visit: http://www.star.net.uk\n>>> >\n> ______________________________________________________________________\n> __\n>>>\n>>>\n>>> ____________________________________________________________________\n>>> ____\n>>> This e-mail has been scanned for all viruses by Star Internet. The\n>>> service is powered by MessageLabs. For more information on a proactive\n>>> anti-virus service working around the clock, around the globe, visit:\n>>> http://www.star.net.uk\n>>> ________________________________________________________________________\n>>\n>>\n>> _____________________________________________________________________\n>> ___\n>> This e-mail has been scanned for all viruses by Star Internet. The\n>> service is powered by MessageLabs. For more information on a proactive\n>> anti-virus service working around the clock, around the globe, visit:\n>> http://www.star.net.uk\n>> ________________________________________________________________________\n>\n>\n>\n> ---------------------------------------------------------------------\n> To unsubscribe, e-mail: tomcat-dev-unsubscribe@jakarta.apache.org\n> For additional commands, e-mail: tomcat-dev-help@jakarta.apache.org\n>\n>\n> ______________________________________________________________________\n> __\n> This e-mail has been scanned for all viruses by Star Internet. The\n> service is powered by MessageLabs. For more information on a proactive\n> anti-virus service working around the clock, around the globe, visit:\n> http://www.star.net.uk\n> ________________________________________________________________________\n>\n\n\n________________________________________________________________________\nThis e-mail has been scanned for all viruses by Star Internet. The service is \npowered by MessageLabs. For more information on a proactive anti-virus service \nworking around the clock, around the globe, visit: http://www.star.net.uk \n________________________________________________________________________\n\n---------------------------------------------------------------------\nTo unsubscribe, e-mail: tomcat-dev-unsubscribe@jakarta.apache.org\nFor additional commands, e-mail: tomcat-dev-help@jakarta.apache.org"}, {"count": 1, "tags": [], "bug_id": 17342, "is_private": false, "id": 67675, "creation_time": "2004-12-01T02:56:42Z", "time": "2004-12-01T02:56:42Z", "creator": "funkman@joedog.org", "text": "As of November 15, 2004, JK2 is no longer supported. All bugs related to JK2 \nwill be marked as WONTFIX. In its place, some of its features have been \nbackported to jk1. Most of those features will be seen in 1.2.7, which is \nslated for release on November 30th, 2004.\n\nAnother alternative is the ajp addition to mod_proxy which will be part of \napache 2.\n\nFor more information on the Tomat connectors docs at\nhttp://jakarta.apache.org/tomcat/connectors-doc/\n\n[Actually this looks like a JK1 issue. But 1.2.7 will be released soon so please\nconfirm if the issue still exists with that release.]", "attachment_id": null}]
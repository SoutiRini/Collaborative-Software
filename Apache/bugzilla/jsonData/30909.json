[{"attachment_id": null, "tags": [], "bug_id": 30909, "is_private": false, "count": 0, "id": 62617, "time": "2004-08-28T00:42:25Z", "creator": "wes@sagesecure.com", "creation_time": "2004-08-28T00:42:25Z", "text": "Starting in 1.3.29, and affecting all current versions (including 2.x), Apache\nsegfaults sporadically. My best guess after some experimenting is that the bug\nis related to the security fix done to mod rewrite in that version (the regexp\nfix). The bug happens when apache suddenly is hit with a large number of page\nrequests that all require mod rewrite to do its thing. \n\nI notice this because I heavily use mod-rewrite to make dynamic script requests\nappear to be static page urls.\n\nThe following rules cause the segfaults:\n\nRewriteEngine on\nRewriteCond %{REQUEST_URI} !/$\nRewriteCond %{REQUEST_FILENAME}/script.php -f\nRewriteRule ^.*$ %{REQUEST_URI}/ [R,L]\nRewriteRule !^/*static|forums|cgi-bin(.*) script.php$1 [T=application/x-httpd-php]\n\n\nI have had no problems prior to 1.3.29. This problem also affects the 2.0\nseries, which leads me to belive that it is the result of a security fix applied\nto both builds... the problem also does not occur when mod-rewrite is not being\nused (meaning, the problem is unrelated to PHP or my PHP app).\n\nFurther notes:\n\nThis bug is platform independent (has been reproduced on Linux and OpenBSD)\nusing Apache built with PHP versions 4.3.4 and 4.3.8. The bug can be reproduced\nin Apache 2.0.50 and 1.3.29, 30, 31."}, {"count": 1, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "is_private": false, "id": 62627, "time": "2004-08-28T10:22:47Z", "bug_id": 30909, "creation_time": "2004-08-28T10:22:47Z", "text": "The best would be to get a backtrace from a coredump. Without it we can only\nguess. This module from Jeff Trawick:\n\nhttp://www.apache.org/~trawick/mod_prctl.c\n\nwill help you to get one on linux with 1.3.*. Load this module, set\nCoreDumpDirectory to a server writable one and attach the gdb backtrace here.\n\nThanks."}, {"count": 2, "tags": [], "text": "The following are additional error details using mod_backtrace and mod_whatkilledus:\n\n[Sat Aug 28 16:24:44 2004] [notice] Apache/1.3.31 (Unix) PHP/4.3.8 configured --\nresuming normal operations\n[Sat Aug 28 16:24:44 2004] [notice] Accept mutex: sysvsem (Default: sysvsem)\n[Sat Aug 28 16:25:06 2004] pid 21700 mod_backtrace backtrace for signal 11\n[Sat Aug 28 16:25:06 2004] pid 21700 mod_backtrace main() is at 8186dd8\n/usr/local/apache/libexec/mod_backtrace.so[0x40019c90]\n/usr/local/apache/libexec/mod_backtrace.so[0x40019d36]\n/usr/local/apache/bin/httpd[0x818480e]\n/usr/local/apache/bin/httpd[0x818484e]\n/lib/tls/libc.so.6[0x420276f8]\n/usr/local/apache/bin/httpd[0x815e396]\n/usr/local/apache/bin/httpd[0x815dbb0]\n/usr/local/apache/bin/httpd[0x815d2cd]\n/usr/local/apache/bin/httpd[0x8179b5d]\n/usr/local/apache/bin/httpd(ap_run_fixups+0x19)[0x8179c1a]\n/usr/local/apache/bin/httpd[0x818ed8f]\n/usr/local/apache/bin/httpd(ap_process_request+0x30)[0x818ee18]\n/usr/local/apache/bin/httpd[0x8185f85]\n/usr/local/apache/bin/httpd[0x81861e5]\n/usr/local/apache/bin/httpd[0x818628b]\n/usr/local/apache/bin/httpd[0x8186942]\n/usr/local/apache/bin/httpd(main+0x388)[0x8187160]\n/lib/tls/libc.so.6(__libc_start_main+0xe4)[0x420156a4]\n/usr/local/apache/bin/httpd(png_read_end+0x31)[0x806b1cd]\n[Sat Aug 28 16:25:06 2004] pid 21700 mod_backtrace end of report\n[Sat Aug 28 16:25:06 2004] pid 21700 mod_whatkilledus sig 11 crash\n[Sat Aug 28 16:25:06 2004] pid 21700 mod_whatkilledus active connection:\n127.0.0.1:35312->127.0.0.1:80\n[Sat Aug 28 16:25:06 2004] pid 21700 mod_whatkilledus active request:\nGET /nsi/themeimage/spacer.gif\nHTTP/1.1|Accept:image/png,*/*;q=0.5|Accept-Charset:ISO-8859-1,utf-8;q=0.7,*;q=0.7|Accept-Encoding:gzip,deflate|Accept-Language:en-us,en;q=0.5\n|Connection:keep-alive|Cookie:SQMSESSID=744ffe370f65b3fd58d01b4cec52b6cb|Host:localhost%3a8000|Keep-Alive:300|Referer:http%3a//localhost%3a8000/nsi/|User-Agent:Mozilla/5.0\n\n(Windows; U; Windows NT 5.0; en-US; rv%3a1.7) Gecko/20040707 Firefox/0.9.2\n[Sat Aug 28 16:25:06 2004] pid 21700 mod_whatkilledus end of report\n[Sat Aug 28 16:25:07 2004] [notice] child pid 21700 exit signal Segmentation\nfault (11)\n[Sat Aug 28 16:25:08 2004] [error] [client 127.0.0.1] File does not exist:\n/usr/local/apache/htdocs/favicon.ico\n[Sat Aug 28 16:25:08 2004] pid 21699 mod_backtrace backtrace for signal 11\n[Sat Aug 28 16:25:08 2004] pid 21699 mod_backtrace main() is at 8186dd8\n/usr/local/apache/libexec/mod_backtrace.so[0x40019c90]\n/usr/local/apache/libexec/mod_backtrace.so[0x40019d36]\n/usr/local/apache/bin/httpd[0x818480e]\n/usr/local/apache/bin/httpd[0x818484e]\n/lib/tls/libc.so.6[0x420276f8]\n/usr/local/apache/bin/httpd[0x815e396]\n/usr/local/apache/bin/httpd[0x815dbb0]\n/usr/local/apache/bin/httpd[0x815d2cd]\n/usr/local/apache/bin/httpd[0x8179b5d]\n/usr/local/apache/bin/httpd(ap_run_fixups+0x19)[0x8179c1a]\n/usr/local/apache/bin/httpd[0x818ed8f]\n/usr/local/apache/bin/httpd(ap_process_request+0x30)[0x818ee18]\n/usr/local/apache/bin/httpd[0x8185f85]\n/usr/local/apache/bin/httpd[0x81861e5]\n/usr/local/apache/bin/httpd[0x818628b]\n/usr/local/apache/bin/httpd[0x8186942]\n/usr/local/apache/bin/httpd(main+0x388)[0x8187160]\n/lib/tls/libc.so.6(__libc_start_main+0xe4)[0x420156a4]\n/usr/local/apache/bin/httpd(png_read_end+0x31)[0x806b1cd]\n[Sat Aug 28 16:25:08 2004] pid 21699 mod_backtrace end of report\n[Sat Aug 28 16:25:08 2004] pid 21699 mod_whatkilledus sig 11 crash\n[Sat Aug 28 16:25:08 2004] pid 21699 mod_whatkilledus active connection:\n127.0.0.1:35316->127.0.0.1:80\n[Sat Aug 28 16:25:08 2004] pid 21699 mod_whatkilledus active request:\nGET /nsi/script/default.js\nHTTP/1.1|Accept:*/*|Accept-Charset:ISO-8859-1,utf-8;q=0.7,*;q=0.7|Accept-Encoding:gzip,deflate|Accept-Language:en-us,en;q=0.5|Cache-Control:no-ca\nche|Connection:keep-alive|Cookie:SQMSESSID=744ffe370f65b3fd58d01b4cec52b6cb|Host:localhost%3a8000|Keep-Alive:300|Pragma:no-cache|Referer:http%3a//localhost%3a8000/nsi/|User\n-Agent:Mozilla/5.0 (Windows; U; Windows NT 5.0; en-US; rv%3a1.7) Gecko/20040707\nFirefox/0.9.2\n[Sat Aug 28 16:25:08 2004] pid 21699 mod_whatkilledus end of report", "attachment_id": null, "bug_id": 30909, "id": 62654, "time": "2004-08-28T20:35:00Z", "creator": "wes@sagesecure.com", "creation_time": "2004-08-28T20:35:00Z", "is_private": false}, {"count": 3, "tags": [], "creator": "wes@sagesecure.com", "attachment_id": null, "id": 62657, "time": "2004-08-28T23:25:55Z", "bug_id": 30909, "creation_time": "2004-08-28T23:25:55Z", "is_private": false, "text": "Here's another backtrace, since I can't get it to core dump.\n\n-----------------------------------\n\n[Sat Aug 28 18:20:40 2004] [notice] SIGHUP received.  Attempting to restart\n[Sat Aug 28 18:20:40 2004] [warn] module mod_backtrace.c is already added, skipping\n[Sat Aug 28 18:20:40 2004] [warn] module mod_prctl.c is already added, skipping\n[Sat Aug 28 18:20:40 2004] [warn] module mod_whatkilledus.c is already added,\nskipping\n[Sat Aug 28 18:20:41 2004] [notice] Apache/1.3.31 (Unix) PHP/4.3.8 configured --\nresuming normal operations\n[Sat Aug 28 18:20:41 2004] [notice] Accept mutex: sysvsem (Default: sysvsem)\n[Sat Aug 28 18:21:10 2004] pid 21932 mod_backtrace backtrace for signal 11\n[Sat Aug 28 18:21:10 2004] pid 21932 mod_backtrace main() is at 8186dd8\n/usr/local/apache/libexec/mod_backtrace.so[0x40019c90]\n/usr/local/apache/libexec/mod_backtrace.so[0x40019d36]\n/usr/local/apache/bin/httpd[0x818480e]\n/usr/local/apache/bin/httpd[0x818484e]\n/lib/tls/libc.so.6[0x420276f8]\n/usr/local/apache/bin/httpd[0x815e396]\n/usr/local/apache/bin/httpd[0x815dbb0]\n/usr/local/apache/bin/httpd[0x815d2cd]\n/usr/local/apache/bin/httpd[0x8179b5d]\n/usr/local/apache/bin/httpd(ap_run_fixups+0x19)[0x8179c1a]\n/usr/local/apache/bin/httpd[0x818ed8f]\n/usr/local/apache/bin/httpd(ap_internal_redirect+0x2b)[0x818f202]\n/usr/local/apache/bin/httpd[0x815d9ce]\n/usr/local/apache/bin/httpd(ap_invoke_handler+0x102)[0x8179f7b]\n/usr/local/apache/bin/httpd[0x818edb9]\n/usr/local/apache/bin/httpd(ap_process_request+0x30)[0x818ee18]\n/usr/local/apache/bin/httpd[0x8185f85]\n/usr/local/apache/bin/httpd[0x81861e5]\n/usr/local/apache/bin/httpd[0x818628b]\n/usr/local/apache/bin/httpd[0x8186942]\n[Sat Aug 28 18:21:10 2004] pid 21932 mod_backtrace end of report\n[Sat Aug 28 18:21:10 2004] pid 21932 mod_whatkilledus sig 11 crash\n[Sat Aug 28 18:21:10 2004] pid 21932 mod_whatkilledus active connection:\n127.0.0.1:35412->127.0.0.1:80\n[Sat Aug 28 18:21:10 2004] pid 21932 mod_whatkilledus active request:\nGET /nsi/script/common.js\nHTTP/1.1|Accept:*/*|Accept-Charset:ISO-8859-1,utf-8;q=0.7,*;q=0.7|Accept-Encoding:gzip,deflate|Accept-Language:en-us,en;q=0.5|Connection:keep-aliv\ne|Cookie:SQMSESSID=744ffe370f65b3fd58d01b4cec52b6cb|Host:localhost%3a8000|Keep-Alive:300|Referer:http%3a//localhost%3a8000/nsi/|User-Agent:Mozilla/5.0\n(Windows; U; Windows \nNT 5.0; en-US; rv%3a1.7) Gecko/20040707 Firefox/0.9.2\n[Sat Aug 28 18:21:10 2004] pid 21932 mod_whatkilledus end of report\n[Sat Aug 28 18:21:11 2004] [notice] child pid 21932 exit signal Segmentation\nfault (11)\n"}, {"count": 4, "tags": [], "creator": "mss@apache.org", "is_private": false, "text": "Apache HTTP Server 1.3.x is not supported anymore and no bugs will be fixed in the old codebase (cf. <http://mail-archives.apache.org/mod_mbox/httpd-announce/201002.mbox/%3C20100203000334.GA19021@infiltrator.stdlib.net%3E>). Since this bug seems to affect only 1.3.x, I'm closing it as WONTFIX.\n\nIf this bug still affects you in a recent version (version 2.2.x or the upcoming version 2.4), please open a new bug.\n\nThank you for reporting the bug.", "id": 145153, "time": "2011-03-21T11:00:40Z", "bug_id": 30909, "creation_time": "2011-03-21T11:00:40Z", "attachment_id": null}]
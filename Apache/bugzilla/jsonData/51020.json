[{"count": 0, "tags": [], "bug_id": 51020, "attachment_id": 26854, "id": 145553, "time": "2011-04-04T22:19:50Z", "creator": "thangaraj@gmail.com", "creation_time": "2011-04-04T22:19:50Z", "is_private": false, "text": "Created attachment 26854\nPatch for Apache/mod_Fcgid.so startup issue in complex Active Directory Domain environment\n\nProblem:\n\nmod_fcgid.so tries to gather CGI process filestat during startup using apr_stat () call and fails to fetch all ACLs from Active Directory Domain environment (having complex groups spanning across multiple domains)\n\nRoot Cause:\napr_stat() using APR_FINFO_NORM ends up calling GetEffectiveRightsFromACL Win32API to proble ACLs for cgi process file object's owner and group trustee accounts, and per MS this GetEffectiveRightsFromACL API is likely to fail in complex AD environment. MS KB: http://support.microsoft.com/kb/2018746\n\n\nSolution:\nmod_fcgid.so apr_stat() call is made to use APR_FINFO_IDENT and thereby avoiding the unnecessary ACL lookup during Apache startup, however if there is a real ACL issue, mod_fcgid.so will return error during runtime."}, {"count": 1, "tags": [], "bug_id": 51020, "attachment_id": null, "is_private": false, "id": 148177, "time": "2011-07-26T13:18:56Z", "creator": "dave.apache@yougeezer.co.uk", "creation_time": "2011-07-26T13:18:56Z", "text": "I've experience the same issue with mod_fcgid failing on startup.  I'm also in an extremely large Active Directory implementation which explains why I'm suffering.\n\nHave tried the patch and it works perfectly."}, {"count": 2, "tags": [], "creator": "info@apachelounge.com", "text": "Please attention to this issue, quite some reports on this.", "id": 148178, "time": "2011-07-26T13:50:24Z", "bug_id": 51020, "creation_time": "2011-07-26T13:50:24Z", "is_private": false, "attachment_id": null}, {"count": 3, "text": "A workaround is available, but it's not suitable for all implementations.\n\nChange permissions on the fastcgi wrapper (e.g. php-cgi.exe) to remove any Active Directory user or group.  Also remove any local groups that contain Active Directory users or groups.  I was left with just the local administrator account and system.  The Apache service will then start correctly as it doesn't bother accessing Active Directory to check the ACL.", "bug_id": 51020, "is_private": false, "id": 148179, "time": "2011-07-26T14:17:57Z", "creator": "dave.apache@yougeezer.co.uk", "creation_time": "2011-07-26T14:17:57Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "dave.apache@yougeezer.co.uk", "is_private": false, "count": 4, "id": 148201, "time": "2011-07-27T07:58:52Z", "bug_id": 51020, "creation_time": "2011-07-27T07:58:52Z", "text": "I've logged bug 51560 with Apache APR about the underlying issue caused by using GetEffectiveRightsFromACL.  It'd be ideal if they could provide a fix at that level as it'd fix other modules that suffer from the same problem.  Like mod_xsendfile https://github.com/nmaier/mod_xsendfile/issues/8"}, {"count": 5, "tags": [], "creator": "wrowe@apache.org", "text": "David, that's a very interesting workaround, and thanks for filing the APR bug.\n\nThangaraj, looked at your proposed solution and went with that philosophy,\nvetting all of the cases where we were requesting far more apr_file_stat fields\nthan were used.  Fixed for mod_fcgid 2.3.7.  Thank you for proposing that fix.", "id": 152939, "time": "2012-01-19T16:07:03Z", "bug_id": 51020, "creation_time": "2012-01-19T16:07:03Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 51020, "attachment_id": null, "is_private": false, "id": 163949, "time": "2012-12-07T10:18:59Z", "creator": "st@cabag.ch", "creation_time": "2012-12-07T10:18:59Z", "text": "I'm currently experiencing the issue on some Windows 2008 R2 with AD and as I understand the error that's given me by the Apache Configuration check, it definitely relates to this issue.\n\nTherefore I'd say, the bug is still open.\n\nDoes anybody still experience this issue with Apache 2.2.22 and mod_fcgid 2.3.7."}, {"count": 7, "tags": [], "creator": "pbluapb@gmail.com", "text": "Created attachment 29777\nrebuild_for_mod_fcgid-2.3.7-crlf\n\nJust replace your mod_fcgid.so \nBuild, what's updated:\nline :866 comented \"/*  return missing_file_msg(cmd->pool, \"Wrapper\", path, rv); */\"\n\nAD+Apache + mod_fcgid + PHP = (70008)Partial results\n\nused links :\nhttp://support.microsoft.com/kb/2018746\nhttps://www.apachelounge.com/viewtopic.php?p=18440\nhttp://remotehelp.pp.ua/index.php?option=com_content&view=article&id=73:kompilyacziya-modfcgid-v-visual-studio-2005-visual-c-2005-pod-apache-2222-dlya-windows-xp", "id": 164142, "time": "2012-12-19T07:55:08Z", "bug_id": 51020, "creation_time": "2012-12-19T07:55:08Z", "is_private": false, "attachment_id": 29777}, {"count": 8, "text": "How does commenting out line 866 fix the issue? Is it just prohibiting the AD lookups all together?", "bug_id": 51020, "is_private": false, "id": 164992, "time": "2013-02-01T20:43:37Z", "creator": "jmealins@gmail.com", "creation_time": "2013-02-01T20:43:37Z", "tags": [], "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "tjw@omnigroup.com", "attachment_id": null, "text": "Sending a If or If-Match header with an invalid ETag doesn't result in a 412 Precondition Failed.\n\n<http://www.webdav.org/specs/rfc4918.html#METHOD_COPY> has an example specifically calling out preconditions on COPY (10.4.9), for example, but I'm just doing a simple If-Match.\n\nThis patch (vs our local clone of 2.4.3) resolves the issue for me, but I'm wondering if there is some case this would break.\n\nThanks!\n\n-tim\n\nIndex: modules/dav/main/mod_dav.c\n===================================================================\n--- modules/dav/main/mod_dav.c\t(revision 180376)\n+++ modules/dav/main/mod_dav.c\t(revision 180377)\n@@ -2761,10 +2761,10 @@\n    }\n\n    /*\n-     * Check If-Headers and existing locks for each resource in the source\n-     * if we are performing a MOVE. We will return a 424 response with a\n-     * DAV:multistatus body. The multistatus responses will contain the\n-     * information about any resource that fails the validation.\n+     * Check If-Headers and existing locks for each resource in the source.\n+     * We will return a 424 response with a DAV:multistatus body.\n+     * The multistatus responses will contain the information about any\n+     * resource that fails the validation.\n     *\n     * We check the parent resource, too, since this is a MOVE. Moving the\n     * resource effectively removes it from the parent collection, so we\n@@ -2773,17 +2773,17 @@\n     * If a problem occurs with the Request-URI itself, then a plain error\n     * (rather than a multistatus) will be returned.\n     */\n-    if (is_move\n-        && (err = dav_validate_request(r, resource, depth, NULL,\n+    if ((err = dav_validate_request(r, resource, depth, NULL,\n                                       &multi_response,\n                                       DAV_VALIDATE_PARENT\n                                       | DAV_VALIDATE_USE_424,\n                                       NULL)) != NULL) {\n        err = dav_push_error(r->pool, err->status, 0,\n                             apr_psprintf(r->pool,\n-                                          \"Could not MOVE %s due to a failed \"\n+                                          \"Could not %s %s due to a failed \"\n                                          \"precondition on the source \"\n                                          \"(e.g. locks).\",\n+                                          is_move ? \"MOVE\" : \"COPY\",\n                                          ap_escape_html(r->pool, r->uri)),\n                             err);\n        return dav_handle_err(r, err, multi_response);", "id": 165485, "time": "2013-02-26T04:09:30Z", "bug_id": 54610, "creation_time": "2013-02-26T04:09:30Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 54610, "attachment_id": null, "is_private": false, "id": 166774, "time": "2013-04-23T01:45:17Z", "creator": "wiml@omnigroup.com", "creation_time": "2013-04-23T01:45:17Z", "text": "This bug still exists in 2.4.4, and this patch still fixes it there.\n\nThis bug still exists in trunk/2.5 r1470737, and this patch still fixes it there (although you have to apply it with -l because indentation has changed in that file)."}, {"count": 2, "tags": [], "creator": "minfrin@sharp.fm", "attachment_id": null, "id": 166885, "time": "2013-04-27T15:40:40Z", "bug_id": 54610, "creation_time": "2013-04-27T15:40:40Z", "is_private": false, "text": "Fix on trunk in r1476604."}, {"count": 3, "tags": [], "text": "Proposed for backport to v2.4 and v2.2.", "attachment_id": null, "id": 167376, "creator": "minfrin@sharp.fm", "time": "2013-05-23T13:18:49Z", "bug_id": 54610, "creation_time": "2013-05-23T13:18:49Z", "is_private": false}, {"count": 4, "tags": [], "creator": "minfrin@sharp.fm", "is_private": false, "text": "Backported to v2.4.5.", "id": 167425, "time": "2013-05-26T19:50:29Z", "bug_id": 54610, "creation_time": "2013-05-26T19:50:29Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Marking as fixed since this has been released in 2.2.25 and 2.4.6.\n\nNote that the change for this actually spawned two addition issues PR 55304 and PR 55306, which have not been included in a released version yet.  I'd encourage people interested in this issue to investigate the changes made in response to those issues to make sure that they didn't break something else.", "attachment_id": null, "bug_id": 54610, "id": 170402, "time": "2013-10-03T05:38:18Z", "creator": "ben@reser.org", "creation_time": "2013-10-03T05:38:18Z", "is_private": false}]
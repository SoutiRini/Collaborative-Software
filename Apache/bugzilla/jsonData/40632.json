[{"count": 0, "text": "Under Windows, a process inherits handles even when spawned using the Exec task\nwith the spawn attribute. This makes an Exec task that calls another Exec task\nwith the spawn attribute to block until the spawned process exits.\n\nThe source of the problem may be in the JVM where a spawned process may be\ncreated using the Win32 API CreateProcess with the bInheritHandles attribute set\nto TRUE, while it should be FALSE for spawned processes.\n\nA workaround can be to insert a process that will spawn the original process\nwith the bInheritHandles attribute set to FALSE.\n\nSee attached Ant script demonstrating the environment, the problem and the\nworkaround.", "creator": "Georges.Zwing@att.net", "attachment_id": null, "id": 94240, "time": "2006-09-28T17:23:06Z", "bug_id": 40632, "creation_time": "2006-09-28T17:23:06Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 40632, "attachment_id": 18934, "is_private": false, "id": 94241, "time": "2006-09-28T17:25:11Z", "creator": "Georges.Zwing@att.net", "creation_time": "2006-09-28T17:25:11Z", "text": "Created attachment 18934\nAnt script demonstrating the environment, the problem and the"}, {"count": 2, "tags": [], "text": "Thanks for the report.\nI think that this is the same probles\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=5003\nexcept that you set the spawn attribute and still\nsee the problem", "is_private": false, "id": 94242, "creator": "peterreilly@apache.org", "time": "2006-09-28T17:30:27Z", "bug_id": 40632, "creation_time": "2006-09-28T17:30:27Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 40632, "text": "But what could we do in Ant to get around the original problem?", "id": 94243, "attachment_id": null, "creator": "mbenson@apache.org", "creation_time": "2006-09-28T17:42:45Z", "time": "2006-09-28T17:42:45Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 40632, "is_private": false, "id": 94260, "attachment_id": null, "creator": "antoine@apache.org", "creation_time": "2006-09-29T08:03:59Z", "time": "2006-09-29T08:03:59Z", "text": "Hello Matt,\n\nwe could make a slightly modified version of this CreateDetachedProcess.cpp\nwhich would just create a really detached process without inherited handles, and\nship Ant with CreateDetachedProcess.exe in the bin directory, and wrap spawning\nunder Win32 with this CreateDetachedProcess.exe.\n\nThe CreateDetachedProcess.cpp in the attached zip file has this line :\n\n  LPTSTR lpCommandLine = \"Notepad\";\n\n\nif instead we write the Microsoft VC++ equivalent of :\n\nLPTSTR lpCommandLine = join(argv, \" \"); // do not know which idiom we could use here\n\nthen we would have something.\n\nThe other thing we can do is have a look whether Sun has done some work on this\nissue in JDK 1.6. Else one of us could write in the BugParade, so that the issue\ngets addressed.\n\nRegards,\n\nAntoine"}, {"count": 5, "tags": [], "bug_id": 40632, "attachment_id": null, "id": 94261, "time": "2006-09-29T08:52:42Z", "creator": "stevel@apache.org", "creation_time": "2006-09-29T08:52:42Z", "is_private": false, "text": "I'd rather push this towards Sun and Harmony. I dont want to get into the\nproblem of rewriting the java process API. Actually, I do, but not now; not in Ant.\n\nThere's lots of things in ::CreateProcess() that Java hides, just as there's\nsome options in ::LoadLibrary() that I'd have but which Sun dont expose in the\nJNI library loading."}, {"count": 6, "tags": [], "creator": "mbenson@apache.org", "is_private": false, "text": "Yes, I thought we had had discussion in the past that steered towards the\ndecision of whether to include C (or Cpp or whatever) code in Ant, and usually\nthose were met with general reluctance.  ;)", "id": 94264, "time": "2006-09-29T14:14:29Z", "bug_id": 40632, "creation_time": "2006-09-29T14:14:29Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 40632, "attachment_id": null, "id": 94269, "time": "2006-09-29T15:42:57Z", "creator": "Georges.Zwing@att.net", "creation_time": "2006-09-29T15:42:57Z", "is_private": false, "text": "I reproduced the problem with Java 1.6 Beta2 and I started the thread\nhttp://forum.java.sun.com/thread.jspa?threadID=772669 titled \"Spawned process\nblocks grand parent\" regarding this issue with a Java only example."}, {"count": 8, "text": "I submitted the problem reported in the thread\nhttp://forum.java.sun.com/thread.jspa?threadID=772669 titled \"Spawned process\nblocks grand parent\" as a bug on the Java Bug Database at http://bugs.sun.com. \nIt has been accepted as a new bug and entered the bug into the internal bug \ntracking system under Bug Id: 6481278. You can vote for the bug at \nhttp://bugs.sun.com/bugdatabase/addVote.do?bug_id=6481278.", "creator": "Georges.Zwing@att.net", "is_private": false, "id": 94805, "time": "2006-10-13T06:25:41Z", "bug_id": 40632, "creation_time": "2006-10-13T06:25:41Z", "tags": [], "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 40632, "attachment_id": null, "id": 94899, "time": "2006-10-17T11:09:05Z", "creator": "andreas.krueger@famsik.de", "creation_time": "2006-10-17T11:09:05Z", "is_private": false, "text": "For the record: Peter Reilly seems to think that there is a connection between\nthis and bug 5003 and bug 37787."}, {"count": 10, "tags": [], "bug_id": 40632, "text": "Created attachment 19022\nRuns arguments with bIneheritHandle to FALSE\n\nAllows to test if setting the bInheritHandles to FALSE will fix problem related\nto this. To use it, replace the executable in the exec task with this program\nand insert the old executable as first argument.\nEg:\n<exec executable=\"notepad\">\n  <arg file=\"test.txt\"/>\n</exec>\nwould become:\n<exec executable=\"SpawnDetachedProcess\">\n  <arg value=\"notepad\"/>\n  <arg file=\"test.txt\"/>\n</exec>", "id": 94937, "attachment_id": 19022, "creator": "Georges.Zwing@att.net", "creation_time": "2006-10-18T10:04:57Z", "time": "2006-10-18T10:04:57Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 40632, "text": "You can use the forget task from ant-contrib to emulate this.\nThe forget task simply a <sequential> that\nexecutes its tasks in a new thread, the daemon\nattribute of which is true.\n\n<ac:forget xmlns:ac=\"antlib:net.sf.antcontrib\">\n  <exec executable=\"notepad.exe\" spawn=\"true\"/>\n</ac:forget>\n\n\n", "id": 95005, "time": "2006-10-20T04:38:52Z", "creator": "peterreilly@apache.org", "creation_time": "2006-10-20T04:38:52Z", "is_private": false, "attachment_id": null}]
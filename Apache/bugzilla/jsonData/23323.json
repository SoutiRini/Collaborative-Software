[{"count": 0, "tags": [], "creator": "chienbd@fsoft.com.vn", "text": "I have a SSDIR environment variable. And when I perform VSS task, VSS task uses \nSSDIR environment variable instead of serverPath parameter. I saw \norg.apache.tools.ant.taskdefs.optional.vss.MSVSS.java and found some command in \nrun method:\n    protected int run(Commandline cmd) {\n        try {\n            Execute exe = new Execute(new LogStreamHandler(this,\n                                                           Project.MSG_INFO,\n                                                           Project.MSG_WARN));\n\n            // If location of ss.ini is specified we need to set the\n            // environment-variable SSDIR to this value\n            if (m_serverPath != null) {\n                String[] env = exe.getEnvironment();\n                if (env == null) {\n                    env = new String[0];\n                }\n                String[] newEnv = new String[env.length + 1];\n*************************\n------->        for (int i = 0; i < env.length ; i++) {\n------->            newEnv[i] = env[i];\n------->        }\n------->        newEnv[env.length] = \"SSDIR=\" + m_serverPath;\nI think should change to\n                for (int i = 0; i < env.length ; i++) {\n                    newEnv[i + 1] = env[i];\n                }\n                newEnv[0] = \"SSDIR=\" + m_serverPath;\n\n***************************\n                exe.setEnvironment(newEnv);\n            }\n\n            exe.setAntRun(project);\n            exe.setWorkingDirectory(project.getBaseDir());\n            exe.setCommandline(cmd.getCommandline());\n            return exe.execute();\n        } catch (java.io.IOException e) {\n            throw new BuildException(e, location);\n        }\n    }", "id": 44433, "time": "2003-09-22T10:26:06Z", "bug_id": 23323, "creation_time": "2003-09-22T10:26:06Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 23323, "attachment_id": null, "text": "I changed run method to below and it work\n    protected int run(Commandline cmd) {\n        try {\n            Execute exe = new Execute(new LogStreamHandler(this,\n                                                           Project.MSG_INFO,\n                                                           Project.MSG_WARN));\n\n            //exe.setAntRun(project);\n            // If location of ss.ini is specified we need to set the\n            // environment-variable SSDIR to this value\n            if (m_serverPath != null) {\n                String[] env = exe.getEnvironment();\n                if (env == null) {\n                    env = new String[0];\n                }\n                String[] newEnv = new String[env.length + 1];\n                //for (int i = 0; i < env.length ; i++) {\n                //    newEnv[i] = env[i];\n                //}\n                //newEnv[env.length] = \"SSDIR=\" + m_serverPath;\n                boolean bMatch = false;\n                for (int i = 0; i < env.length ; i++) {\n                    if ((env[i] != null) && (env[i].toUpperCase().startsWith\n(\"SSDIR=\"))) {\n                        env[i] = \"SSDIR=\" + m_serverPath;\n                        bMatch = true;\n                        break;\n                    }\n                    newEnv[i] = env[i];\n                }\n                if (bMatch) {\n                    exe.setEnvironment(env);\n                } else {\n                    newEnv[env.length] = \"SSDIR=\" + m_serverPath;\n                    exe.setEnvironment(newEnv);\n                }\n            }\n\n            exe.setAntRun(project);\n\n            exe.setNewenvironment(true);\n\n            exe.setWorkingDirectory(project.getBaseDir());\n            exe.setCommandline(cmd.getCommandline());\n            return exe.execute();\n        } catch (java.io.IOException e) {\n            throw new BuildException(e, location);\n        }\n    }\nI think it need exe.setNewenvironment(true);\nBy the way, I can not get any value for env variable. I dont know why.\n", "id": 44445, "time": "2003-09-22T12:35:54Z", "creator": "chienbd@fsoft.com.vn", "creation_time": "2003-09-22T12:35:54Z", "is_private": false}, {"count": 2, "attachment_id": null, "creator": "kevin.jackson@it.fts-vn.com", "is_private": false, "id": 88457, "time": "2006-04-25T07:23:03Z", "bug_id": 23323, "creation_time": "2006-04-25T07:23:03Z", "tags": [], "text": "I don't think that the change you are suggesting is correct.  It looks to me\nthat you are ignoring all other environment variables when you make this change.\n In the current code, if the SSDIR is set, it is added to the last position of\nthe String[] and that is used to define the environment.\n\nThe way the task determines if the SSDIR is set is if the property 'serverpath'\nis declared in the task\n\nie\n\n<vssget localPath=\"C:\\mysrc\\myproject\"\n        recursive=\"true\"\n        label=\"Release1\"\n        login=\"me,mypassword\"\n        vsspath=\"$/source/aProject\"\n        serverpath=\"C:\\temp\\server\" <-- where the ss.ini file is located\n        writable=\"true\"/>\n\nI'm closing this as invalid - please reopen if you have more information/you\ndisagree with my assessment."}]
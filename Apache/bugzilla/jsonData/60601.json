[{"count": 0, "tags": [], "bug_id": 60601, "text": "If a workbook is loaded that contains hyperlinks, and all hyperlinks are removed via cell.removeHyperlink(), the written workbook still contains all hyperlinks.\n\n\nThe following change in XSSFSheet fixes this issue:\n\n        // Now re-generate our CTHyperlinks, if needed\n        if(hyperlinks.size() > 0) \n        {\n            if(worksheet.getHyperlinks() == null) {\n                worksheet.addNewHyperlinks();\n            }\n            CTHyperlink[] ctHls = new CTHyperlink[hyperlinks.size()];\n            for(int i=0; i<ctHls.length; i++) {\n                // If our sheet has hyperlinks, have them add\n                //  any relationships that they might need\n                XSSFHyperlink hyperlink = hyperlinks.get(i);\n                hyperlink.generateRelationIfNeeded(getPackagePart());\n                // Now grab their underling object\n                ctHls[i] = hyperlink.getCTHyperlink();\n            }\n            worksheet.getHyperlinks().setHyperlinkArray(ctHls);\n        }\n        else                                  // line added\n          worksheet.unsetHyperlinks();        // line added", "id": 196147, "time": "2017-01-18T15:05:27Z", "creator": "pik@uniquare.com", "creation_time": "2017-01-18T15:05:27Z", "is_private": false, "attachment_id": null}, {"count": 1, "text": "Thanks for finding this edge case.\n\nFixed on trunk in r1779426. This will be fixed in the next beta release, 3.16 beta 2, and subsequent releases.", "creator": "onealj@apache.org", "attachment_id": null, "id": 196182, "time": "2017-01-19T07:46:28Z", "bug_id": 60601, "creation_time": "2017-01-19T07:46:28Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 60601, "text": "The proposed fix broke several other unit tests.\n\nI changed the code to remove the hyperlinks from the hyperlink array one at a time. r1779429", "id": 196186, "time": "2017-01-19T08:10:22Z", "creator": "onealj@apache.org", "creation_time": "2017-01-19T08:10:22Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "pik@uniquare.com", "text": "Your fix causes Excel 2013 to produce the following error on open:\n\n\"We found a problem with some content in '...'. Do you want us to try to recover as much as we can? If you trust the soruce of this workbook, click Yes.", "count": 3, "id": 196188, "time": "2017-01-19T08:29:10Z", "bug_id": 60601, "creation_time": "2017-01-19T08:29:10Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 60601, "text": "Looks like removing the hyperlinks one by one then unsetting the hyperlink array after there are no hyperlinks left passes the current POI unit tests.\n\nCould you please check this with Excel 2013 to see if the code no longer produces corrupt Excel files?\n\nr1779437.", "id": 196191, "time": "2017-01-19T09:02:55Z", "creator": "onealj@apache.org", "creation_time": "2017-01-19T09:02:55Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "bug_id": 60601, "text": "This fix works now. Thanks.", "id": 196192, "time": "2017-01-19T09:09:37Z", "creator": "pik@uniquare.com", "creation_time": "2017-01-19T09:09:37Z", "tags": [], "is_private": false}, {"count": 6, "attachment_id": null, "creator": "pik@uniquare.com", "is_private": false, "id": 196897, "time": "2017-02-10T07:41:50Z", "bug_id": 60601, "creation_time": "2017-02-10T07:41:50Z", "tags": [], "text": "In WildFly 9 the following Exception is thrown:\n\njava.lang.IndexOutOfBoundsException\n at org.apache.xmlbeans.impl.store.Xobj.removeElement(Xobj.java:2206)\n at org.apache.xmlbeans.impl.store.Xobj.remove_element(Xobj.java:2236)\n at org.openxmlformats.schemas.spreadsheetml.x2006.main.impl.CTWorksheetImpl.unsetHyperlinks(Unknown Source)\n ...\n\nBut not in WildFly 10!?\n\nHowever i fixed it by applying an empty try/catch as a hotfix:\n\n            try\n            {\n              worksheet.unsetHyperlinks();\n            }\n            catch (Exception ex)\n            {\n            }"}, {"count": 7, "attachment_id": null, "bug_id": 60601, "text": "I don't like the idea of suppressing exceptions, as they may catch an exception that we didn't intend to check.\n\nDoes\n\nif (worksheet.isSetHyperlinks()) {\n    worksheet.unsetHylerlinks();\n}\n\nFix the problem on WildFly 9 and 10?", "id": 196907, "time": "2017-02-10T13:43:47Z", "creator": "onealj@apache.org", "creation_time": "2017-02-10T13:43:47Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "creator": "pik@uniquare.com", "attachment_id": null, "text": "We have replaces WF 9 with WF 10 meanwhile and can't reproduce the exception.", "id": 197060, "time": "2017-02-16T09:42:35Z", "bug_id": 60601, "creation_time": "2017-02-16T09:42:35Z", "is_private": false}, {"count": 9, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "text": "Mostly fixed as far as I could read from the comments, please report another bug if you still see issues with the isSet/unset-combination.", "id": 197148, "time": "2017-02-18T21:42:29Z", "bug_id": 60601, "creation_time": "2017-02-18T21:42:29Z", "is_private": false}]
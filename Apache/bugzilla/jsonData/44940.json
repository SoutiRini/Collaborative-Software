[{"count": 0, "tags": [], "creator": "cunningham.c@gmail.com", "attachment_id": null, "id": 116288, "time": "2008-05-06T02:24:53Z", "bug_id": 44940, "creation_time": "2008-05-06T02:24:53Z", "is_private": false, "text": "Httpd is configured to accept client certificates, which have been signed by my internal certificate chain:\n\nSSLCACertificateFile  /etc/pki/internal_certificates/caCertificateList.pem\nSSLVerifyClient optional\nSSLVerifyDepth  3\n\ncaCertificateList contains the chain of certificates for the client certificates, with a self-signed root certificate.\n\nThis setup works fine in the general case; there is no problem verifying certificates. This suggests that it is not a problem with configuration. The problem occurs after the server has been in use for a few days, having served some tens of thousands of requests - certificate verification suddenly starts failing with:\n\nCertificate Verification: Error (2): unable to get issuer certificate\n\nThis begins happening for all client certificates, including those that were previously accepted. Nothing further useful is logged, even with SSL debug. I cannot find a trigger for it; it doesn't seem to be after a particular time form startup or anything like that.\n\nReloading httpd fixes the problem, for another few days."}, {"count": 1, "tags": [], "bug_id": 44940, "attachment_id": null, "text": "Which version of openssl are you using?\nDoes the same happen with httpd 2.2.8?", "id": 116292, "time": "2008-05-06T04:42:45Z", "creator": "rpluem@apache.org", "creation_time": "2008-05-06T04:42:45Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 44940, "attachment_id": null, "text": "We're still seeing this problem with Apache 2.2.12, openssl 0.9.8b.\n\nIt appears to happen (occasionally) after doing a reload. Doing a restart clears the problem.", "id": 139502, "time": "2010-08-26T12:00:28Z", "creator": "cunningham.c@gmail.com", "creation_time": "2010-08-26T12:00:28Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 44940, "attachment_id": null, "id": 139518, "time": "2010-08-27T07:44:25Z", "creator": "cunningham.c@gmail.com", "creation_time": "2010-08-27T07:44:25Z", "is_private": false, "text": "On further investigation, these appear to happen after a crash in httpd-worker in libperl (it's a mod_perl application). It would seem that after recovering from the crash, apache is in some kind of stuck state where it cannot read the ca certificate?\n\n I can paste the full log output if it's useful, but it starts off:\n\n*** glibc detected *** /usr/sbin/httpd.worker: double free or corruption (fasttop): 0x00007f90e7133d90 ***\n======= Backtrace: =========\n/lib64/libc.so.6[0x7f90e20bccec]\n/lib64/libc.so.6(cfree+0x8c)[0x7f90e20c090c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_newCONSTSUB+0x14c)[0x7f90dd263ae3]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_pp_anoncode+0x6d)[0x7f90dd2b94f5]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_runops_debug+0x141)[0x7f90dd2833cd]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_call_sv+0x7dc)[0x7f90dd23d0cb]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_call_list+0x2e8)[0x7f90dd23d632]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_newATTRSUB+0xf6e)[0x7f90dd26f09c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_utilize+0x24a)[0x7f90dd26d66c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_yyparse+0x1026)[0x7f90dd2609b6]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so[0x7f90dd2d051c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_pp_require+0xb8b)[0x7f90dd2d6c0d]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_runops_debug+0x141)[0x7f90dd2833cd]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_call_sv+0x7dc)[0x7f90dd23d0cb]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_call_list+0x2e8)[0x7f90dd23d632]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_newATTRSUB+0xf6e)[0x7f90dd26f09c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_utilize+0x24a)[0x7f90dd26d66c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_yyparse+0x1026)[0x7f90dd2609b6]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so[0x7f90dd2d051c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_pp_require+0xb8b)[0x7f90dd2d6c0d]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_runops_debug+0x141)[0x7f90dd2833cd]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_call_sv+0x7dc)[0x7f90dd23d0cb]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_call_list+0x2e8)[0x7f90dd23d632]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_newATTRSUB+0xf6e)[0x7f90dd26f09c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_utilize+0x24a)[0x7f90dd26d66c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_yyparse+0x1026)[0x7f90dd2609b6]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so[0x7f90dd2d051c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_pp_require+0xb8b)[0x7f90dd2d6c0d]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_runops_debug+0x141)[0x7f90dd2833cd]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_call_sv+0x7dc)[0x7f90dd23d0cb]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_call_list+0x2e8)[0x7f90dd23d632]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_newATTRSUB+0xf6e)[0x7f90dd26f09c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_utilize+0x24a)[0x7f90dd26d66c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_yyparse+0x1026)[0x7f90dd2609b6]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so[0x7f90dd2d051c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_pp_require+0xb8b)[0x7f90dd2d6c0d]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_runops_debug+0x141)[0x7f90dd2833cd]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_call_sv+0x7dc)[0x7f90dd23d0cb]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_call_list+0x2e8)[0x7f90dd23d632]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_newATTRSUB+0xf6e)[0x7f90dd26f09c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_utilize+0x24a)[0x7f90dd26d66c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_yyparse+0x1026)[0x7f90dd2609b6]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so[0x7f90dd2d051c]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_pp_require+0xb8b)[0x7f90dd2d6c0d]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_runops_debug+0x141)[0x7f90dd2833cd]\n/usr/lib64/perl5/5.8.6/x86_64-linux-thread-multi/CORE/libperl.so(Perl_eval_sv+0x344)[0x7f90dd23ba21]\n/etc/httpd/modules/mod_perl.so(modperl_require_module+0x1b0)[0x7f90dd471009]\n/etc/httpd/modules/mod_perl.so(modperl_mgv_resolve+0x50b)[0x7f90dd475b41]\n/etc/httpd/modules/mod_perl.so(modperl_handler_resolve+0x5a)[0x7f90dd46ed79]\n/etc/httpd/modules/mod_perl.so(modperl_callback+0x4e)[0x7f90dd46d6ae]\n/etc/httpd/modules/mod_perl.so(modperl_callback_run_handlers+0x2ac)[0x7f90dd46df11]\n/etc/httpd/modules/mod_perl.so(modperl_callback_per_dir+0x2f)[0x7f90dd46e42e]\n/etc/httpd/modules/mod_perl.so[0x7f90dd468b28]\n/etc/httpd/modules/mod_perl.so(modperl_response_handler+0x90)[0x7f90dd468eba]\n/usr/sbin/httpd.worker(ap_run_handler+0x7a)[0x7f90e4063a6a]\n/usr/sbin/httpd.worker(ap_invoke_handler+0x7c)[0x7f90e4066dcc]\n/usr/sbin/httpd.worker(ap_process_request+0x1a8)[0x7f90e4071798]\n/usr/sbin/httpd.worker[0x7f90e406e990]\n/usr/sbin/httpd.worker(ap_run_process_connection+0x72)[0x7f90e406ad52]\n/usr/sbin/httpd.worker[0x7f90e4076395]\n/lib64/libpthread.so.0[0x7f90e25ab367]\n/lib64/libc.so.6(clone+0x6d)[0x7f90e211e09d]"}]
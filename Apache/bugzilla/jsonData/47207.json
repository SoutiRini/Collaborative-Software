[{"count": 0, "tags": [], "creator": "Bjorn.Wiberg@uadm.uu.se", "attachment_id": null, "id": 127064, "creation_time": "2009-05-17T06:33:40Z", "time": "2009-05-17T06:33:40Z", "bug_id": 47207, "text": "500 Internal Server Errors reported by backend server get forwarded to client; the balancer does not flag the failing balancer member with the \"Err\" flag but instead continues to try to use it leaving it at \"Ok\" status. Should this really be so?\n\n500 errors show up in both frontend and backend Apache logs.\n\n\nTopology is:\n\nFRONTEND: Apache + mod_proxy + mod_proxy_balancer + mod_proxy_http --> BACKEND: Apache + mod_proxy + mod_proxy_http --> BACKEND: Tomcat Coyote --> the application\n\n\nConfiguration is (FRONTEND):\n\n      ProxyPass /infoglueCMS balancer://admin_cluster/infoglueCMS stickysession=JSESSIONID\n      ProxyPass /infoglueDeliverWorking balancer://admin_cluster/infoglueDeliverWorking stickysession=JSESSIONID\n      ProxyPass /infoglueDeliverPreview balancer://admin_cluster/infoglueDeliverPreview stickysession=JSESSIONID\n      <Proxy balancer://admin_cluster>\n        BalancerMember http://10.0.1.11 keepalive=on route=admin1_1\n\n        # For monitoring/administrative purposes ONLY\n        # redirect parameter *should* be enough to redirect all new sessions to the desired worker, but is not (bug?), so we add lbset > 0 (default) as well\n        BalancerMember http://10.0.2.11 keepalive=on route=admin2_1 redirect=admin1_1 lbset=1\n      </Proxy>\n\nConfiguration is (BACKEND):\n\n      ProxyPass / http://127.0.0.1:8080/ keepalive=on\n      ProxyPassReverse / http://127.0.0.1:8080/", "is_private": false}, {"count": 1, "tags": [], "bug_id": 47207, "is_private": false, "id": 127065, "creation_time": "2009-05-17T06:34:16Z", "time": "2009-05-17T06:34:16Z", "creator": "Bjorn.Wiberg@uadm.uu.se", "text": "Added myself to Cc.", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 47207, "attachment_id": null, "id": 127066, "time": "2009-05-17T06:35:15Z", "creator": "Bjorn.Wiberg@uadm.uu.se", "creation_time": "2009-05-17T06:35:15Z", "is_private": false, "text": "Using 2.2.3 bundled with RHEL5.3 Server x86_64. If you know that this has changed in any newer versions, please let me know. Thanks."}, {"count": 3, "tags": [], "creator": "Bjorn.Wiberg@uadm.uu.se", "attachment_id": null, "id": 127067, "time": "2009-05-17T06:36:14Z", "bug_id": 47207, "creation_time": "2009-05-17T06:36:14Z", "is_private": false, "text": "The question appears to have been raised on the httpd-users mailing list a couple of years ago, but I could not find any answer.\n\nhttp://mail-archives.apache.org/mod_mbox/httpd-users/200709.mbox/%3C29FB0BFB91D3104A9415ABC902354492049C8230@MBIXCHG2.moody.edu%3E"}, {"count": 4, "tags": [], "bug_id": 47207, "attachment_id": null, "id": 127069, "time": "2009-05-17T07:58:29Z", "creator": "nick@webthing.com", "creation_time": "2009-05-17T07:58:29Z", "is_private": false, "text": "Any HTTP response means a a backend that's up-and-running.  500 might mean, for example, you're testing some newly-installed script and it bombed out.\n\nWhat exactly are you asking for?"}, {"count": 5, "tags": [], "bug_id": 47207, "attachment_id": null, "id": 127074, "time": "2009-05-17T10:52:09Z", "creator": "Bjorn.Wiberg@uadm.uu.se", "creation_time": "2009-05-17T10:52:09Z", "is_private": false, "text": "If possible, I would like mod_proxy_balancer to consider any 50x status code from the backend (here, an HTTP backend via mod_proxy_http) an error, such that the BalancerMember gets the Err status. (Retry attempts and intervals can already be configured.) Perhaps a configuration directive for status codes that should be considered errors by the balancer manager?\n\nThis leads to a question -- does mod_proxy_balancer + mod_proxy_http consider anything but a connection failure (connection refused or closed in the middle of the request) an error such that the Err flag gets set? What about a 503 response from the backend?\n\n(If it does consider 503 as a severe enough error that it raises the Err flag, then perhaps I could compose a work-around transforming 500 to 503 using mod_rewrite on the backend -- although I do admit that this is not a clean or appealing work-around, that its use is limited, and that 500 usually does fill a much valid purpose -- to tell what went wrong, although it seldom does.)"}, {"count": 6, "tags": [], "bug_id": 47207, "attachment_id": null, "id": 127147, "time": "2009-05-19T04:56:47Z", "creator": "Bjorn.Wiberg@uadm.uu.se", "creation_time": "2009-05-19T04:56:47Z", "is_private": false, "text": "Answering one of my own questions -- no, mod_proxy_balancer does not seem to consider neither 500 nor 503 a severe enough error that the backend gets the \"Err\" flag set.\n\nOnly a connection failure (backend HTTP server not listening), and possibly a somehow interrupted connection, results in the Err flag."}, {"count": 7, "tags": [], "creator": "edward.quick@igindex.co.uk", "text": "I have run into this problem myself.\n\nhttp://osdir.com/ml/users/2010-03/msg03537.html", "id": 135240, "time": "2010-03-10T15:58:03Z", "bug_id": 47207, "creation_time": "2010-03-10T15:58:03Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 47207, "attachment_id": null, "text": "Hello;\n   While this does not exactly match what you are describing, I have created a patch that does similar things but is directly controlled by the ServerAdmin:\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=48939\n\n   Please try it out and let me know if it is useful to you. Consider posting any test cases you have in that patch.\n\nAfter patching, add this to your balancers (I use ProxySet) to force all 500 errors to be an error:\nErrorOnStatus=500,501,502,503,504,505", "id": 135794, "time": "2010-03-30T18:50:53Z", "creator": "DRuggeri@primary.net", "creation_time": "2010-03-30T18:50:53Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 47207, "attachment_id": null, "text": "(In reply to comment #8)\n> Hello;\n>    While this does not exactly match what you are describing, I have created a\n> patch that does similar things but is directly controlled by the ServerAdmin:\n> https://issues.apache.org/bugzilla/show_bug.cgi?id=48939\n> \n>    Please try it out and let me know if it is useful to you. Consider posting\n> any test cases you have in that patch.\n> \n> After patching, add this to your balancers (I use ProxySet) to force all 500\n> errors to be an error:\n> ErrorOnStatus=500,501,502,503,504,505\n\nThank you Daniel. This sounds just like what I was looking for.\n\nI'm currently bound to the RHEL5 Apache 2.2 releases but would very much like to see this in future Apache releases (which eventually will propagate to RHEL).", "id": 135823, "time": "2010-03-31T15:31:38Z", "creator": "Bjorn.Wiberg@uadm.uu.se", "creation_time": "2010-03-31T15:31:38Z", "is_private": false}, {"count": 10, "tags": [], "creator": "nick@webthing.com", "text": "\n\n*** This bug has been marked as a duplicate of bug 48939 ***", "id": 135844, "time": "2010-04-01T22:52:46Z", "bug_id": 47207, "creation_time": "2010-04-01T22:52:46Z", "is_private": false, "attachment_id": null}]
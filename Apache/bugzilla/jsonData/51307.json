[{"count": 0, "tags": [], "bug_id": 51307, "text": "Created attachment 27100\nPatch for apr_ldap_rebind.c\n\nI run into this while upgrading ports on some FreeBSD 7.3 instances running apache with the APR. The former port compiled without problems: apr-nothr-devrandom-gdbm-db42-ldap24-1.4.2.1.3.10 (apr-utils 1.3.10)\n\nThe build options look like this:\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Options for apr-nothr-devrandom-gdbm-db42-ldap24 1.4.5.1.3.12     \u2502  \n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \n\u2502 \u2502     [ ] THREADS    Enable Threads in apr                       \u2502 \u2502  \n\u2502 \u2502     [ ] IPV6       Enable IPV6 Support in apr                  \u2502 \u2502  \n\u2502 \u2502     [X] BDB        Enable Berkley BDB support in apr-util      \u2502 \u2502  \n\u2502 \u2502     [X] GDBM       Enable GNU dbm support in apr-util          \u2502 \u2502  \n\u2502 \u2502     [X] LDAP       Enable LDAP support in apr-util             \u2502 \u2502  \n\u2502 \u2502     [ ] MYSQL      Enable MySQL suport in apr-util             \u2502 \u2502  \n\u2502 \u2502     [ ] NDBM       Enable NDBM support in apr-util             \u2502 \u2502  \n\u2502 \u2502     [ ] PGSQL      Enable Postgresql suport in apr-util        \u2502 \u2502  \n\u2502 \u2502     [ ] SQLITE     Enable SQLite3 support in apr-util          \u2502 \u2502  \n\u2502 \u2502     [X] DEVRANDOM  Use /dev/random or compatible in apr        \u2502 \u2502  \n\u2502 \u2502                                                                \u2502 \u2502  \n\u2502 \u2502                                                                \u2502 \u2502  \n\u2502 \u2502                                                                \u2502 \u2502  \n\u2502 \u2502                                                                \u2502 \u2502  \n\u2502 \u2502                                                                \u2502 \u2502  \n\u251c\u2500\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2500\u2524  \n\u2502                       [  OK  ]       Cancel                        \u2502  \n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nNow, building the port stops with following error:\n...\nldap/apr_ldap_rebind.c: In function 'apr__ldap_rebind_init':\nldap/apr_ldap_rebind.c:85: error: 'apr_ldap_xref_lock' undeclared (first use in this function)\nldap/apr_ldap_rebind.c:85: error: (Each undeclared identifier is reported only once\nldap/apr_ldap_rebind.c:85: error: for each function it appears in.)\n...\n\n\nI found this patch to be useful to me: (same in the attachment)\n\n\n--- apr_ldap_rebind.c\t2011-06-01 15:36:20.000000000 +0200\n+++ apr_ldap_rebind.c.original\t2011-05-10 23:34:43.000000000 +0200\n@@ -81,12 +81,11 @@\n     get_apd\n #endif\n \n-#if APR_HAS_THREADS\n     /* run after apr_thread_mutex_create cleanup */\n     apr_pool_cleanup_register(pool, &apr_ldap_xref_lock, apr_ldap_pool_cleanup_set_null,\n                               apr_pool_cleanup_null);\n \n-\n+#if APR_HAS_THREADS\n     if (apr_ldap_xref_lock == NULL) {\n         retcode = apr_thread_mutex_create(&apr_ldap_xref_lock, APR_THREAD_MUTEX_DEFAULT, pool);\n     }\n\n\nI built this on one machine and it is running without apparent problems so far. I've checked sources for apr-utils 1.4.2 too and I see the same potential error.\n\nThank you for your great work! Cheers,\nPhilipp", "id": 146793, "time": "2011-06-01T13:57:27Z", "creator": "pippo@deo.li", "creation_time": "2011-06-01T13:57:27Z", "is_private": false, "attachment_id": 27100}, {"count": 1, "tags": [], "bug_id": 51307, "is_private": false, "id": 146796, "attachment_id": null, "creator": "covener@gmail.com", "creation_time": "2011-06-01T15:12:05Z", "time": "2011-06-01T15:12:05Z", "text": "thanks for report, working on this now (including httpd trunk where the code was recently moved)"}, {"count": 2, "tags": [], "bug_id": 51307, "is_private": false, "text": "Eric has commited the fix to the apr-util 1.[345] branches.", "id": 148100, "time": "2011-07-23T17:57:59Z", "creator": "sf@sfritsch.de", "creation_time": "2011-07-23T17:57:59Z", "attachment_id": null}]
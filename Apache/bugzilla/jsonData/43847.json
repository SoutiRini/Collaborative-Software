[{"count": 0, "tags": [], "creator": "x00000000@freenet.de", "is_private": false, "text": "The indexed option of the PNG export in the SVG viewer has no effect.\nThis is because KEY_INDEXED is set to 256 while it seems to be expected\nto be 8 if the number of palette entries should be 256 = 2^8.\nA value of 256 will be ignored in\nsources/org/apache/batik/ext/awt/image/codec/png/PNGTranscoderInternalCodecWriteAdapter.java\n\nI'll post a simple patch, but the indexed option is still quite unusable\nbecause it dithers a white background, even if only one other color is used.", "id": 110444, "time": "2007-11-12T11:41:42Z", "bug_id": 43847, "creation_time": "2007-11-12T11:41:42Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 43847, "attachment_id": 21117, "text": "Created attachment 21117\npatch", "id": 110445, "time": "2007-11-12T11:42:22Z", "creator": "x00000000@freenet.de", "creation_time": "2007-11-12T11:42:22Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 43847, "text": "Created attachment 21118\nreduced testcase", "id": 110446, "time": "2007-11-12T11:44:01Z", "creator": "x00000000@freenet.de", "creation_time": "2007-11-12T11:44:01Z", "is_private": false, "attachment_id": 21118}, {"count": 3, "tags": [], "text": "Created attachment 21119\nexported testcase (indexed PNG with patch applied)", "is_private": false, "id": 110447, "creator": "x00000000@freenet.de", "time": "2007-11-12T11:45:02Z", "bug_id": 43847, "creation_time": "2007-11-12T11:45:02Z", "attachment_id": 21119}, {"count": 4, "tags": [], "creator": "x00000000@freenet.de", "is_private": false, "text": "Created attachment 21120\nreal world example (PNG; background is a <rect/> as in the testcase)", "id": 110448, "time": "2007-11-12T11:48:49Z", "bug_id": 43847, "creation_time": "2007-11-12T11:48:49Z", "attachment_id": 21120}, {"count": 5, "tags": [], "text": "The dithering of the white background seems to be a Java bug:\nhttp://bugs.sun.com/view_bug.do?bug_id=4258700\n\nI tried to turn dithering off in\nsources/org/apache/batik/ext/awt/image/rendered/IndexImage.java , but that\nhas no effect because of another Java bug:\nhttp://bugs.sun.com/view_bug.do?bug_id=6357416\n\n~ $ java -version\njava version \"1.6.0\"\nJava(TM) SE Runtime Environment (build 1.6.0-b105)\nJava HotSpot(TM) 64-Bit Server VM (build 1.6.0-b105, mixed mode)\n", "is_private": false, "id": 110462, "creator": "x00000000@freenet.de", "time": "2007-11-12T17:39:58Z", "bug_id": 43847, "creation_time": "2007-11-12T17:39:58Z", "attachment_id": null}, {"attachment_id": 23423, "tags": [], "bug_id": 43847, "text": "Created attachment 23423\nPatch v2\n\n(In reply to comment #0)\n> This is because KEY_INDEXED is set to 256 while it seems to be expected\n> to be 8 if the number of palette entries should be 256 = 2^8.\n> A value of 256 will be ignored in\n> sources/org/apache/batik/ext/awt/image/codec/png/PNGTranscoderInternalCodecWriteAdapter.java\n\nI've (also) confirmed this in the source code (org.apache.batik.transcoder.image.PNGTranscoder.WriteAdapter#writeImage). The attachment is very similar to the current one, but additionally fixes a few indenting issues and removes some weird \"By Jun Inamori\" statements (which apparently shouldn't be there) and also some extraneous line breaks.\n\n\n> I'll post a simple patch, but the indexed option is still quite unusable\n> because it dithers a white background, even if only one other color is used.\n\nI haven't tried to improve this behavior...", "count": 6, "id": 125854, "time": "2009-03-27T10:28:56Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2009-03-27T10:28:56Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 43847, "attachment_id": null, "is_private": false, "id": 125868, "time": "2009-03-30T03:19:31Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2009-03-30T03:19:31Z", "text": "(In reply to comment #6)\n> Created an attachment (id=23423) [details]\n> Patch v2\n\nI haven't stated it but IMO it's ready for review. The changes are tiny and it should be quite safe to apply: it just limits to fix the bug.\n\nNevertheless, it would also be interesting to center the dialog confirming the PNG indexed enabled (although not important in order for this to work).\n\nChanging platform to \"All\" and Batik version to 1.8, as I was able to reproduce in Windows XP SP3 with the trunk version."}, {"count": 8, "tags": [], "text": "I've committed a slightly modified version of the available patch in revision 907280.\n\nAs stated in comment 6, the (somehow unexpected) dithering with a white background isn't addressed, it just fixes the indexed color option not being functional. FWIW, by taking a look at the documentation [1] and source code [2], it seems like that's the expected behavior...\n\nAlso, given it's a user interface visible thing, I've added a small note in the CHANGES file. :-)\n\n[1] http://xmlgraphics.apache.org/batik/javadoc/org/apache/batik/transcoder/image/ImageTranscoder.html#KEY_FORCE_TRANSPARENT_WHITE\n[2] http://svn.apache.org/viewvc/xmlgraphics/batik/trunk/sources/org/apache/batik/transcoder/image/PNGTranscoder.java?view=annotate#l98", "is_private": false, "id": 134269, "creator": "helder.magalhaes@gmail.com", "time": "2010-02-06T11:18:19Z", "bug_id": 43847, "creation_time": "2010-02-06T11:18:19Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 43847, "attachment_id": null, "is_private": false, "id": 139142, "time": "2010-08-17T09:39:55Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-08-17T09:39:55Z", "text": "(In reply to comment #8)\n> Also, given it's a user interface visible thing, I've added a small note in the\n> CHANGES file. :-)\n\nRemoving \"NeedsReleaseNote\" keyword as the changes were made visible in the commit."}]
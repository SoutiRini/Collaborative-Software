[{"id": 72342, "tags": [], "bug_id": 34004, "attachment_id": null, "count": 0, "text": "The class org.apache.jasper.JspCompilationContext contains the following\nsynchronized block:\n----\n    static Object outputDirLock = new Object();\n\n    private void makeOutputDir() {\n        synchronized(outputDirLock) {\n            File outDirFile = new File(outputDir);\n            outDirFile.mkdirs();\n        }\n    }\n----\n\nThis block is executed each time a JSP is executed. This cause a serialization\nof the JSP execution.\n\nA lot of synchronization can be avoided if the code is changed to the following:\n\n----\n            private void makeOutputDir()\n            {\n                File outDirFile = new File(outputDir);\n                if (!outDirFile.exists())\n                {\n                    synchronized(outputDirLock)\n                    {   \n                        outDirFile.mkdirs();\n                    }\n                }\n            }\n----\nThe synchronized block is entered if the requested directory does not exists.\nThe JSP are executed in parallel otherwise.", "time": "2005-03-14T11:21:07Z", "creator": "klmuell@web.de", "creation_time": "2005-03-14T11:21:07Z", "is_private": false}, {"id": 72344, "tags": [], "bug_id": 34004, "is_private": false, "count": 1, "text": "In production, please set development to false, as detailed in the documentation.\nIn 5.5.x, compilation checks are also not done on every access by default.", "time": "2005-03-14T11:29:02Z", "creator": "remm@apache.org", "creation_time": "2005-03-14T11:29:02Z", "attachment_id": null}, {"id": 72368, "tags": [], "bug_id": 34004, "attachment_id": null, "count": 2, "text": "(In reply to comment #1)\n> In production, please set development to false, as detailed in the documentation.\n\nI do not follow on this.\n1. The development mode should be as close as possible to the production mode.\nAs result the synchronization should be avoided if possible. Testing in\ndevelopment mode may hide problems which can occur in production because of the\ndifferent thread handling.\n\n2. The tested CMS app creates and/or changes JSP files on the fly. These changes\nneed to be visible for the app user immediately (uncached recompile, execute).\nThis failed if the development mode is disabled.", "time": "2005-03-14T13:29:30Z", "creator": "klmuell@web.de", "creation_time": "2005-03-14T13:29:30Z", "is_private": false}, {"id": 72369, "tags": [], "bug_id": 34004, "is_private": false, "count": 3, "text": "1. Not possible. As I said in the previous reply which you did not read, 5.5.x\ndoes not do the checks on every access.\n\n2. That's called a bad decision, as JSP was never designed to allow doing this.\nJSP is not an interpreted template language, and must be compiled. This\ncompilation time is long, and as a result, your software will not run well.\n\n-> WONTFIX", "time": "2005-03-14T13:37:00Z", "creator": "remm@apache.org", "creation_time": "2005-03-14T13:37:00Z", "attachment_id": null}]
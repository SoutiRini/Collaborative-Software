[{"count": 0, "tags": [], "bug_id": 50507, "text": "It looks like Ant 1.8.1 (also verified with future 1.8.2 from CI https://hudson.apache.org/hudson/view/A-F/view/Ant/job/Ant_Nightly/187/artifact/) can mix stderr and stdout stream output while logging it. The following example can easily help to reproduce the issue:\n<?xml version=\"1.0\">\n<project>\n    <target name=\"demo\">\n        <exec executable=\"${ant.home}/bin/ant.bat\">\n            <arg value=\"-f\" />\n            <arg file=\"${ant.file}\" />\n            <arg value=\"generate-output\" />\n        </exec>\n    </target>\n\n    <target name=\"generate-output\">\n        <echo>${ant.version}</echo>\n        <echo message=\"some blablablablablablablablablablablabla error message\" level=\"error\" />\n        <echo message=\"some blablablablablablablablablablablabla info message\" level=\"info\" />\n        <echo message=\"some blablablablablablablablablablablabla error message\" level=\"error\" />\n        <echo message=\"some blablablablablablablablablablablabla info message\" level=\"info\" />\n        <echo message=\"some blablablablablablablablablablablabla error message\" level=\"error\" />\n        <echo message=\"some blablablablablablablablablablablabla info message\" level=\"info\" />\n        <echo message=\"some blablablablablablablablablablablabla error message\" level=\"error\" />\n        <echo message=\"some blablablablablablablablablablablabla info message\" level=\"info\" />\n        <echo message=\"some blablablablablablablablablablablabla error message\" level=\"error\" />\n        <echo message=\"some blablablablablablablablablablablabla info message\" level=\"info\" />\n    </target>\n</project>\n\nExecuted with Ant 1.8.1, a message on stderr can be printed in the middle of an another message coming from stdout:\n\nC:\\...>ant demo\nBuildfile: C:\\apps\\test\\build.xml\n\ndemo:\n     [exec] Buildfile: C:\\apps\\test\\build.xml\n     [exec]\n     [exec] generate-output:\n     [exec]      [echo] Apache Ant version 1.8.1 compiled on April 30 2010\n     [exec]      [echo] some blablablablablablablablablablablabla info message\n     [exec]      [echo] some blablablablablablablablablablablabla info message\n     [exec]      [echo] some blablablablablablablablablablablabla in     [echo]\nsome blablablablablablablablablablablabla error message\n     [exec]      [echo] some blablablablablablablablablablablabla error message\n     [exec]      [echo] some blablablablablablablablablablablabla error message\n     [exec]      [echo] some blablablablablablablablablablablabla error message\n     [exec]      [echo] some blablablablablablablablablablablabla error message\n     [exec] fo message\n     [exec]      [echo] some blablablablablablablablablablablabla info message\n     [exec]      [echo] some blablablablablablablablablablablabla info message\n     [exec]\n     [exec] BUILD SUCCESSFUL\n     [exec] Total time: 0 seconds\n\nBUILD SUCCESSFUL\nTotal time: 1 second\n\nSame script executed with Ant 1.7.0 will log the output of each stream correctly (line by line):\n\nC:\\apps\\test>ant demo\nBuildfile: build.xml\n\ndemo:\n     [exec] Buildfile: C:\\apps\\test\\build.xml\n     [exec]\n     [exec] generate-output:\n     [exec]      [echo] Apache Ant version 1.7.0 compiled on December 13 2006\n     [exec]      [echo] some blablablablablablablablablablablabla error message\n     [exec]      [echo] some blablablablablablablablablablablabla error message\n     [exec]      [echo] some blablablablablablablablablablablabla error message\n     [exec]      [echo] some blablablablablablablablablablablabla info message\n     [exec]      [echo] some blablablablablablablablablablablabla info message\n     [exec]      [echo] some blablablablablablablablablablablabla info message\n     [exec]      [echo] some blablablablablablablablablablablabla info message\n     [exec]      [echo] some blablablablablablablablablablablabla info message\n     [exec]      [echo] some blablablablablablablablablablablabla error message\n     [exec]      [echo] some blablablablablablablablablablablabla error message\n     [exec]\n     [exec] BUILD SUCCESSFUL\n     [exec] Total time: 0 seconds", "id": 142890, "time": "2010-12-21T13:57:02Z", "creator": "william.bernardet@gmail.com", "creation_time": "2010-12-21T13:57:02Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "antoine@apache.org", "is_private": false, "text": "I can reproduce this on Windows. It is not a systematic bug.\nIt is similar or the same bug like 48746", "id": 142893, "time": "2010-12-21T15:21:59Z", "bug_id": 50507, "creation_time": "2010-12-21T15:21:59Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "william.bernardet@gmail.com", "text": "Do you think this issue will be addressed in 1.8.2?", "id": 142906, "attachment_id": null, "bug_id": 50507, "creation_time": "2010-12-22T02:33:40Z", "time": "2010-12-22T02:33:40Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 50507, "text": "Created attachment 26439\nMerging the streams on a line basis", "id": 142908, "time": "2010-12-22T05:31:55Z", "creator": "william.bernardet@gmail.com", "creation_time": "2010-12-22T05:31:55Z", "is_private": false, "attachment_id": 26439}, {"count": 4, "tags": [], "bug_id": 50507, "text": "(In reply to comment #3)\n> Created an attachment (id=26439) [details]\n> Merging the streams on a line basis\n\nActually the issue is coming from the merging of stdout and stderr by the OutputStreamFunneler class without having any consideration about line ending.", "id": 142909, "attachment_id": null, "creator": "william.bernardet@gmail.com", "creation_time": "2010-12-22T05:34:44Z", "time": "2010-12-22T05:34:44Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 50507, "text": "William thanks very much for the patch. A release candidate for 1.8.2 is already built and should be released officially on 12/27. Your patch can make it into 1.8.3 if it passes the tests and no one sees architectural or performance problems with it. Do not worry, we can build 1.8.3 relatively fast after 1.8.2.", "id": 142912, "time": "2010-12-22T10:47:22Z", "creator": "antoine@apache.org", "creation_time": "2010-12-22T10:47:22Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "antoine@apache.org", "text": "Patch committed. Thanks.\n\nAdditionally, I have made flush a no op in LineOrientedOutputStream.", "id": 145930, "attachment_id": null, "bug_id": 50507, "creation_time": "2011-04-21T10:58:58Z", "time": "2011-04-21T10:58:58Z", "is_private": false}, {"count": 7, "tags": [], "creator": "antoine@apache.org", "attachment_id": null, "text": "changes done in SVN so far :\nhttp://svn.apache.org/viewvc?view=revision&revision=1095736\nhttp://svn.apache.org/viewvc?view=revision&revision=1095768", "id": 145935, "time": "2011-04-21T12:33:17Z", "bug_id": 50507, "creation_time": "2011-04-21T12:33:17Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 50507, "text": "and svn revision 1210088 - see bug 52283", "id": 151957, "time": "2011-12-04T10:46:27Z", "creator": "bodewig@apache.org", "creation_time": "2011-12-04T10:46:27Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 50507, "is_private": false, "text": "This test fails in trunk using JDK 5u22 or 6u31 or 7u3 on Ubuntu:\n\nsrc/etc/testcases/taskdefs/exec/exec.xml:60: output indicates a mixup of out and err\n\tat org.apache.tools.ant.taskdefs.Exit.execute(Exit.java:164)\n...\n\tat org.apache.tools.ant.taskdefs.ExecTaskTest.testOutAndErr(ExecTaskTest.java:108)\n\nSometimes it passes, but usually it fails. I made the test better report the failure, showing the following output:\n\ndoit:\nblabla:\nblabla:\n     [exec] some blablablablablablablablablablablabla info message outsome blablablablablablablablablablablabla error message err\n     [exec] \n     [exec] some blablablablablablablablablablablabla info message outsome blablablablablablablablablablablabla error message err\n     [exec] \nblabla:\n     [exec] some blablablablablablablablablablablabla error message errsome blablablablablablablablablablablabla info message out\n     [exec] \nblabla:\nblabla:\nblabla:\nblabla:\n     [exec] some blablablablablablablablablablablabla error message errsome blablablablablablablablablablablabla info message out\n     [exec] \nblabla:\nblabla:\nblabla:", "id": 154081, "time": "2012-02-23T19:41:21Z", "creator": "jglick@apache.org", "creation_time": "2012-02-23T19:41:21Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 50507, "text": "Committed revision 1297113 to disable the test since it consistently fails for me on Ubuntu, and according to [1] on the CI builder as well.\n\n[1] https://builds.apache.org/job/Ant_JDK_1.5_Test/452/testReport/org.apache.tools.ant.taskdefs/ExecTaskTest/testOutAndErr/", "id": 154541, "time": "2012-03-05T16:10:44Z", "creator": "jglick@apache.org", "creation_time": "2012-03-05T16:10:44Z", "is_private": false, "attachment_id": null}]
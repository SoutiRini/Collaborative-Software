[{"count": 0, "tags": [], "creator": "henrik.sorensen@balcab.ch", "attachment_id": null, "text": "The FTP.java class has two local methods used to check is a file entry is really\na file or a directory. The problem with the current implementation is it is not\ntaking into account that the entries can be unknown, and the current logic\nfurther assumes that isFile==!isDirectory.\n\nThe two methods are\nisFunctioningAsFile \nand\nisFunctioningAsDirectory\n\nI have tested the following changes to the functions:\n\n   private boolean isFunctioningAsDirectory(FTPClient ftp, String dir, FTPFile \nfile) {\n        boolean result = false;\n        String currentWorkingDir = null;\n        if (file.isDirectory()) {\n            return true;\n        } else if (file.isFile()) {\n            return false;\n        } \n<b> else if (file.isUnknown()) {\n                return false;\n        }\n</b>\n ...\n}\n\n    private boolean isFunctioningAsFile(FTPClient ftp, String dir, FTPFile \nfile) {\n        if (file.isDirectory()) {\n            return false;\n        } else if (file.isFile()) {\n            return true;\n        }<b> else if (file.isUnknown()) {\n                return false;\n       }</b>\n        \n        return !isFunctioningAsDirectory(ftp, dir, file);\n    }\n\nHenrik", "id": 87290, "time": "2006-03-26T20:56:36Z", "bug_id": 39108, "creation_time": "2006-03-26T20:56:36Z", "is_private": false}, {"count": 1, "tags": [], "creator": "jkf@apache.org", "text": "I think the original idea was that everything not functioning as a directory is\nassumed to be functioning as a file, as to be able to compare / download as much\nas possible.\n\nAlso, something which is of type unknown may still be functioning as file or\ndirectory, so to return false right away doesn't seem to be the right decision\nfor those checks.\n\nFor example fifo's are neither files nor directories, yet they will function as\nfile when read from / written to.\n\nMaybe unknown is also used for FTP servers that do not propagate any obvious\ndifference between file entries and directory entries.\n\nTherefore, it is not clear to me what would be the benefit of always having\nisFunctioningAsDirectory and isFunctioningAsFile returning false if the type is\nunknown.", "id": 87340, "time": "2006-03-27T22:44:45Z", "bug_id": 39108, "creation_time": "2006-03-27T22:44:45Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "henrik.sorensen@balcab.ch", "attachment_id": null, "text": ">Also, something which is of type unknown may still be functioning as file or\n>directory\nbut if that is the case what is the point of setting the type to unknown ?", "id": 87368, "time": "2006-03-28T20:56:08Z", "bug_id": 39108, "creation_time": "2006-03-28T20:56:08Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jkf@apache.org", "attachment_id": null, "text": "The type is probably set to unknown unless the commons FTP library is able to\ndetermine the type by parsing the listing, which may not be the case (or\nimplemented) for all listings.", "id": 87369, "time": "2006-03-28T21:00:08Z", "bug_id": 39108, "creation_time": "2006-03-28T21:00:08Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 39108, "attachment_id": null, "id": 87370, "time": "2006-03-28T21:17:33Z", "creator": "henrik.sorensen@balcab.ch", "creation_time": "2006-03-28T21:17:33Z", "is_private": false, "text": "My question still remain. \nAnd further, would you blindly trust a rmdir, let alone read or write on an file\ntype unknown ?\n\nOnce you have determined if you can read or write to the file, why not just set\nthe type accordingly ?\n\nFrankly I do not follow you line of argument here."}, {"count": 5, "tags": [], "bug_id": 39108, "text": "Sorry, but I do not understand the issue, what would be the benefit of not\ntrying to determine the behaviour of an unknown entry?\n\nAnt does not set the type to unknown.\nCommons does set the type to unknown when it can not -for whatever reason-\ndetermine what an entry is by inspecting the listing. Commons will not try to\ndetermine if something unknown proves to be a file or a directory. \nAnt does try to determine whether it acts as a directory or a file. \nAnt does not try to determine this by inspecting the entry of a listing.\nFor unix ftp listings commons will treat block and character devices as file,\nbut will treat fifo's as unknown. Fifo's for instance will act like files.\n\nAnt does not change the entry it has received from the commons FTP library, I am\nnot familiar enough with the ftp library of commons to see if it could do any\nharm to change this, but again, what would be the benefit?\n\nSo please indicate what is wrong on a functional level.", "id": 87374, "time": "2006-03-28T23:39:25Z", "creator": "jkf@apache.org", "creation_time": "2006-03-28T23:39:25Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 39108, "text": "Hello Henrik,\n\nI did not look at your bug report before.\n\nAre you closing it as WONTFIX because you believe that there is no one in the\nAnt community who wants to process this bug report ?\n\nI think that your bug report makes a valid point. Actually, I am the one who\nwrote these methods isFunctioningAsFile and isFunctioningAsDirectory. Yes, I did\nnot have in mind directory entries which are neither files nor directories. Yes\nit might be a good idea to avoid doing anything with these directory entries FTP\nwise.\n\nI am reopening the report.\n\nAntoine", "id": 95213, "time": "2006-10-30T15:02:22Z", "creator": "antoine@apache.org", "creation_time": "2006-10-30T15:02:22Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "henrik.sorensen@balcab.ch", "attachment_id": null, "id": 95270, "time": "2006-10-31T14:41:21Z", "bug_id": 39108, "creation_time": "2006-10-31T14:41:21Z", "is_private": false, "text": "(In reply to comment #6)\n> Are you closing it as WONTFIX because you believe that there is no one in the\n> Ant community who wants to process this bug report ?\nyes, that is a pretty accurate description. \nBut I understand you have a lot to do, and my solution works for me.\n\n> I think that your bug report makes a valid point. Actually, I am the one who\n> wrote these methods isFunctioningAsFile and isFunctioningAsDirectory. Yes, I did\n> not have in mind directory entries which are neither files nor directories. Yes\n> it might be a good idea to avoid doing anything with these directory entries FTP\n> wise.\nyes.\nI had to patch Ant locally to avoid the problem when the\ncommons.net.MVSFTPEntryParser returns filetype unknown.\n> \n> I am reopening the report.\nthanks.\nBasically, if filetype is unknown both methods isFile and isDir should return false."}]
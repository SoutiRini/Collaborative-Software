[{"count": 0, "tags": [], "text": "", "is_private": false, "id": 138507, "creator": "v2@iki.fi", "time": "2010-07-19T06:23:09Z", "bug_id": 49613, "creation_time": "2010-07-19T06:23:09Z", "attachment_id": null}, {"count": 1, "attachment_id": 25782, "bug_id": 49613, "text": "Created attachment 25782\nProfiler screenshot\n\nThis is a screenshot from a profiler. It shows how a JSF application calls getAttributeNames() 1222 times for a single page render.", "id": 138508, "time": "2010-07-19T06:28:59Z", "creator": "v2@iki.fi", "creation_time": "2010-07-19T06:28:59Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 49613, "attachment_id": null, "id": 138509, "time": "2010-07-19T06:41:28Z", "creator": "v2@iki.fi", "creation_time": "2010-07-19T06:41:28Z", "is_private": false, "text": "Application frameworks like MyFaces use attributes while rendering a page. Tomcat reads all SSL connector attributes for every call to getAttributeNames(). This creates a large number of calls to getAttributeNames(). The current 6.0.x implementation is very slow as it does not recognize it has already read the SSL specific attributes. \n\nI will attach a patch which uses an object boolean field to determine whether the SSL attributes have already been read or not. The speedup to the profiled application is 10x."}, {"count": 3, "tags": [], "bug_id": 49613, "attachment_id": 25783, "is_private": false, "id": 138510, "time": "2010-07-19T06:44:20Z", "creator": "v2@iki.fi", "creation_time": "2010-07-19T06:44:20Z", "text": "Created attachment 25783\nProposed patch to specified issue"}, {"count": 4, "tags": [], "bug_id": 49613, "text": "Looking at your patch, you apparently did not understand the code. But I can see you might incur a performance problem if SSL is enabled and there's no certificate chain (at least if it is null). Maybe. However, using getAttributesNames repeatedly (if at all) is ... disturbing.", "id": 138511, "time": "2010-07-19T07:51:06Z", "creator": "remm@apache.org", "creation_time": "2010-07-19T07:51:06Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "Can you abbreviate on how I did not understand the code correctly? \n\nThis is how I understood it:\n\n'getAttributes(Globals.CERTIFICATES_ATTR)' is called when a secure connection is made. This call is made to make sure the 'if( isSSLAttribute(name) )' branch is activated. This branch then fills out the attributes Map with the SSL attributes.\n\nThe only change I did was to use an object variable (sslAttributesRead) to make sure the 'if( isSSLAttribute(name) )' branch is executed only once per request.\n\nSo this fixes the assumption the current code has, which is that once the SSL attributes are read, the 'getAttributes(Globals.CERTIFICATES_ATTR)' call terminates as it finds a value for the attribute.\n\nI don't see a problem with my logic. Can you explain what I got wrong?\n\n\nRe: disturbing...\n\nYou are very correct that this is a bit disturbing. But given the complexity and generic nature of web application frameworks, such use is inevitable. And, the performance hit the application takes is unacceptable (response time of 40 seconds instead of 4 in one case) especially since this is easily solvable.", "is_private": false, "id": 138512, "creator": "v2@iki.fi", "time": "2010-07-19T08:18:52Z", "bug_id": 49613, "creation_time": "2010-07-19T08:18:52Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 49613, "attachment_id": null, "is_private": false, "id": 138568, "time": "2010-07-20T10:20:44Z", "creator": "remm@apache.org", "creation_time": "2010-07-20T10:20:44Z", "text": "Actually, the patch is appropriate for TC 6. I thought it should be in getAttribute, but this would interfere with the SSLAuthenticator."}, {"count": 7, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Thanks for the patch.\n\nIt has been applied to 7.0.x and will be in 7.0.1 onwards.\n\nIt has been proposed for 6.0.x.", "id": 138634, "time": "2010-07-22T10:38:43Z", "bug_id": 49613, "creation_time": "2010-07-22T10:38:43Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 49613, "attachment_id": null, "id": 139742, "time": "2010-09-07T11:56:25Z", "creator": "markt@apache.org", "creation_time": "2010-09-07T11:56:25Z", "is_private": false, "text": "The patch has been applied to 6.0.x and will be included in 6.0.30 onwards."}]
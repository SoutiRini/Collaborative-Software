[{"count": 0, "tags": [], "creator": "andrei.ivanov@gmail.com", "attachment_id": null, "is_private": false, "id": 195409, "time": "2016-12-08T15:44:58Z", "bug_id": 60456, "creation_time": "2016-12-08T15:44:58Z", "text": "Hello,\nTrying to implement mutual authentication with IP matching, I noticed that mod_ssl doesn't export the client SAN IP.\n\nhttp://svn.apache.org/viewvc/httpd/httpd/trunk/modules/ssl/ssl_engine_vars.c?revision=1750840&view=markup#l1076\n\nPlease add SSL_CLIENT_SAN_IPaddr.\n\nThank you"}, {"count": 1, "tags": [], "creator": "andrei.ivanov@gmail.com", "attachment_id": null, "is_private": false, "id": 195571, "time": "2016-12-20T08:50:07Z", "bug_id": 60456, "creation_time": "2016-12-20T08:50:07Z", "text": "An even better fix would be to (also) have SSL_CLIENT_SAN_IPaddrs (note the plural) as a list, to allow an expression like this:\n\n\"%{REMOTE_ADDR} in %{SSL_CLIENT_SAN_IPaddrs}\"\n\nWithout the list, I don't see how an expression like this can be properly written.\n\nThis is inspired from PeerExtList:\nSSLRequire \"foobar\" in PeerExtList(\"1.2.3.4.5.6\")"}, {"count": 2, "tags": [], "bug_id": 60456, "text": "Any thoughts?", "id": 196032, "time": "2017-01-12T14:55:03Z", "creator": "andrei.ivanov@gmail.com", "creation_time": "2017-01-12T14:55:03Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "andrei.ivanov@gmail.com", "attachment_id": null, "is_private": false, "id": 196902, "time": "2017-02-10T10:50:34Z", "bug_id": 60456, "creation_time": "2017-02-10T10:50:34Z", "text": "Anybody? :-("}, {"count": 4, "tags": [], "bug_id": 60456, "text": "Another user requesting this.  If devs are looking for justification then I create certificates for my machines with SAN with both DNS and IPAddr for my internal machines.  I use an internal private CA for both servers and clients.\n\nI use the DNS for testing tools like postman, curl, etc... but we use the IPAddr for most other configurations and tools.  We would like the SAN IPAddr exposed so that we may verify it in the SSLRequire against the REMOTE_ADDR.  I would like to verify that the certificate is from that remote host and not another host as an additional check that the certificate was not somehow copied from the server and moved to another server like vm cloned accidentally or maliciously.\n\nHostnames are not available on our servers to verify so DNS is not useful at this layer.  While everything is spoofable this is just another mitigation.   Also since we are using apache as a proxy much of the SSL information is not forwarded to the application for additional verification.\n\nI'd be happy with just SSL_CLIENT_SAN_IPADDR_# or similar but the list would also be nice.", "id": 197512, "time": "2017-03-07T17:55:05Z", "creator": "abbotttodd@netscape.net", "creation_time": "2017-03-07T17:55:05Z", "is_private": false, "attachment_id": null}, {"count": 5, "text": "Created attachment 35204\nProposed Patch for SAN IP\n\nProposed Patch for getting ipaddr from SSL client cert\n\nProxy config might look like:\nSSLRequire ( %{REMOTE_ADDR} in { %{SSL_CLIENT_SAN_IP_0}, %{SSL_CLIENT_SAN_IP_1}, %{SSL_CLIENT_SAN_IP_2} } )\n\nIt basically clones the ip address print statement from openssl slightly altered as I could not see how to get openssl to do the formatting.  It generates IPv6 with lower case which is in line with what I saw with REMOTE_ADDR.", "bug_id": 60456, "is_private": false, "id": 200226, "time": "2017-08-07T21:26:28Z", "creator": "abbotttodd@netscape.net", "creation_time": "2017-08-07T21:26:28Z", "tags": [], "attachment_id": 35204}, {"attachment_id": null, "tags": [], "creator": "andrei.ivanov@gmail.com", "text": "Btw, my main problem, the filtering, was solved with the help of a patch from Yann Ylavic, pending inclusion:\n\nhttp://mail-archives.apache.org/mod_mbox/httpd-dev/201707.mbox/%3CCAKQ1sVMZeDOLh62hE%2Bsrb92EgEWANjaoFkhOx5bD%3Dy4sG91wRg%40mail.gmail.com%3E\n\nI still think it would be nice to have the SAN IP exposed as the rest of the variables.", "count": 6, "id": 200232, "time": "2017-08-08T06:54:06Z", "bug_id": 60456, "creation_time": "2017-08-08T06:54:06Z", "is_private": false}]
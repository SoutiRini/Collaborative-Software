[{"count": 0, "tags": [], "text": "The interface in org.apache.catalina.util.Base64 is not symmetrical. Base64  always returns a valid string from encoding and bytes when decoding. So it should look like this:\n\nString encode(byte[])\nbyte[] decode(String)\n\nsimilarly, if you need chunks\n\nvoid encode(ByteChunk, CharChunk)\nvoid decode(CharChunk, ByteChunk)\n\nYou can write this interface with the current code:\n\n\tpublic static String encode(byte[] value) {\n\t\treturn new String(encode(value));\n\t}\n\t\n\tprivate byte[] decode(String value) throws IOException {\n\t\tByteChunk encoded = new ByteChunk();\n\t\tencoded.append(value.getBytes(), 0, value.length());\n\t\tCharChunk decoded = new CharChunk(); \t\t\n\t\tdecode(encoded, decoded);\n\t\tbyte[] result = new byte[decoded.getLength()];\n\t\tfor(int i = 0; i < decoded.getLength(); i++) {\n\t\t\tresult[i] = (byte) decoded.getBuffer()[i];\n\t\t}\n\t\treturn result;\n\t}\n\n(see how nasty decode looks now)\n\nBetter, refactor the class to have the interface I suggest.\n\nAttached is an implementation that is much more elegant, although it's probably less efficient (now how many times do we really do base64 encode/decode - 1-2 per request).", "is_private": false, "id": 136978, "creator": "dblock@dblock.org", "time": "2010-05-20T07:37:43Z", "bug_id": 49317, "creation_time": "2010-05-20T07:37:43Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Looks like you forgot to provide your attachment.\n\nThe current implementation isn't symmetrical because that isn't what Tomcat needs (keeping in mind this class is primarily for use by Tomcat internals). That said, every method that calls encode then converts to String so that can change to clean the code up a little. I'll make that change shortly.\n\nThis gets called frequently enough that I'd at least want to check performance of old implementation against any new one.", "is_private": false, "id": 136980, "creator": "markt@apache.org", "time": "2010-05-20T07:58:15Z", "bug_id": 49317, "creation_time": "2010-05-20T07:58:15Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Since this is internal for tomcat only - I am marking as WONTFIX since it is change without any functional need.\n\nIf a webapp needs a Base64 util class, there are many other public implementations.", "attachment_id": null, "id": 141319, "creator": "funkman@apache.org", "time": "2010-11-01T17:34:00Z", "bug_id": 49317, "creation_time": "2010-11-01T17:34:00Z", "is_private": false}]
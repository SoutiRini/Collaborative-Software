[{"count": 0, "tags": [], "text": "Hi all.\nI have an Ant target which deploys WAR file to Tomcat7 instance using taskdef for DeployTask class.\nWAR file is passed as URL - http://\nI'm executing this on Windows 7 64bit with JDK 1.7\n\nSample part of failing target:\n<tomcat-deploy url=\"http://localhost:8080/manager/text\" path=\"/testdeploy\" war=\"http://server.pl/app.war\"\n\t\t\tusername=\"user\" password=\"pass\"\n\t\t\tfailOnError=\"true\" logerror=\"true\"/>\n\nThis execution fails and exception is thrown (sorry for Polish message):\n\ntest_deploy.xml:37: java.io.FileNotFoundException: http:\\server.pl\\app.war (Nazwa pliku, nazwa katalogu lub skladnia etykiety woluminu jest niepoprawna)\n        at java.io.FileInputStream.open(Native Method)\n        at java.io.FileInputStream.<init>(FileInputStream.java:146)\n        at java.io.FileInputStream.<init>(FileInputStream.java:101)\n        at org.apache.catalina.ant.DeployTask.execute(DeployTask.java:155)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:292)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:435)\n        at org.apache.tools.ant.Target.performTasks(Target.java:456)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1393)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1364)\n        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1248)\n        at org.apache.tools.ant.Main.runBuild(Main.java:851)\n        at org.apache.tools.ant.Main.startAnt(Main.java:235)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:280)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:109)\n\n== Question ==\nDoes implementation of DeployTask is incorrect?\n\nI think there is error in content of this \"if\" - I think it should be replaced with \"else\" code:\nhttps://github.com/apache/tomcat/blob/trunk/java/org/apache/catalina/ant/DeployTask.java#L143\n\nOr I am using this task the wrong way?", "attachment_id": null, "bug_id": 58086, "id": 183812, "time": "2015-06-30T20:48:45Z", "creator": "ljaderdev@gmail.com", "creation_time": "2015-06-30T20:48:45Z", "is_private": false}, {"count": 1, "tags": [], "text": "Hi,\n\nFix was made available in trunk, in 8.0.x for 8.0.24 and in 7.0.x for 7.0.64 onwards.\n\nRegards,\nVioleta", "attachment_id": null, "bug_id": 58086, "id": 183826, "time": "2015-07-01T07:25:21Z", "creator": "violetagg@apache.org", "creation_time": "2015-07-01T07:25:21Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 58086, "attachment_id": null, "id": 183911, "time": "2015-07-06T17:38:24Z", "creator": "ljaderdev@gmail.com", "creation_time": "2015-07-06T17:38:24Z", "is_private": false, "text": "@Violeta Georgieva\n\nI'm searching a little bit more about this and I found out, \nthat this is much more complicated issue - sorry for misleading you.\n\nPrevious implementation worked for all kind of local filesystem files, because when:\na) war=\"C:/Users/john/app.war\"\n  was loaded using FileInputStream\nb) war=\"file:/C:/Users/john/app.war\"\n  was loaded using URL and URLConnection (effectively FileURLConnection)\n\nBut it does not worked other protocols (ex. \"http\", \"https\"), \nsince it tried to load them using \"FileInputStream\".\n\n\nCurrent implementation (AFTER FIX) does NOT WORK for any of local filesystem files, because when:\na) war=\"C:/Users/john/app.war\"\n  was loaded using URL and URLConnection - and the exception is thrown java.net.MalformedURLException: no protocol\nb) war=\"file:/C:/Users/john/app.war\"\n  was is loaded using FileInputStream, which in constructor uses java.io.File, \n  which incorrectly handles files URIs in different situations:\n    https://weblogs.java.net/blog/kohsuke/archive/2007/04/how_to_convert.html\n    http://bugs.java.com/view_bug.do?bug_id=5086147\n\thttps://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/FileUtils.html#toFile%28java.net.URL%29\n\n\nI don't see any quick solution to this fix :(.\nI think the best way would be reverting previous commit and figuring out\nhow to implement this.\n\nFor my own needs I've dirty fixed this problem to:\nif (war.startsWith(\"file:\") || war.startsWith(\"http:\") || war.startsWith(\"https:\")) {\n  //execute the URL code\n} else {\n  //execute the File code as fallback\n}"}, {"count": 3, "tags": [], "bug_id": 58086, "attachment_id": null, "id": 183958, "time": "2015-07-08T12:02:57Z", "creator": "violetagg@apache.org", "creation_time": "2015-07-08T12:02:57Z", "is_private": false, "text": "Hi,\n\nThanks for the testing.\n\nThe new fix was made available in trunk, in 8.0.x for 8.0.25 and in 7.0.x for 7.0.64 onwards.\n\nRegards,\nVioleta"}]
[{"count": 0, "tags": [], "bug_id": 54993, "text": "We are getting lots of strange error messages from Apache 2.4 with the event mpm under load.\n \n[mpm_event:crit] [pid 9685:tid 28] (81)File descriptor in bad state: apr_pollset_poll failed. Attempting to shutdown process gracefully\n\nIt appears to come from these lines in /httpd/tags/2.4.4/server/mpm/event/event.c\n\n1455\t rc = apr_pollset_poll(event_pollset, timeout_interval, &num, &out_pfd); \n1456\t if (rc != APR_SUCCESS) { \n1457\t if (APR_STATUS_IS_EINTR(rc)) { \n1458\t continue; \n1459\t } \n1460\t if (!APR_STATUS_IS_TIMEUP(rc)) { \n1461\t ap_log_error(APLOG_MARK, APLOG_CRIT, rc, ap_server_conf, \n1462\t \"apr_pollset_poll failed. Attempting to \" \n1463\t \"shutdown process gracefully\"); \n1464\t signal_threads(ST_GRACEFUL); \n1465\t } \n1466\t } \n1467\n\nIf I understand correctly, apr_pollset_poll() is returning EBADFD in this code (specific to pollsets using solaris event ports): /apr/tags/1.4.6/poll/unix/port.c\n\n372\t ret = port_associate(pollset->p->port_fd, PORT_SOURCE_FD, \n373\t fd, get_event(ep->pfd.reqevents), ep); \n374\t if (ret < 0) { \n375\t rv = apr_get_netos_error(); \n376\t APR_RING_INSERT_TAIL(&(pollset->p->free_ring), ep, pfd_elem_t, link); \n377\t break; \n378\t }\n\nAccording to the man page for port_associate:\n\nEBADFD The source argument is of type PORT_SOURCE_FD and the object argument is not a valid file descriptor.\n\nWe are running SmartOS, a variant of OpenSolaris/Illumos", "id": 167307, "time": "2013-05-20T14:13:52Z", "creator": "apache@yonahruss.com", "creation_time": "2013-05-20T14:13:52Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 54993, "text": "We're also seeing this problem on Apache 2.4.9 on Solaris 10_u11; under load we're seeing apr_pollset_poll failed messages and the server is very slow to respond. After 30 seconds or so it recovers.\n\nWe use log_server_status to log the server status to a file, and when this happens we can actually see requests to /server-status failing:\n\n110500:90:185:136912038:.722062\n110600:93:182:136920497:.722775\n110700:71:204:136926275:.723272\n110800:105:170:136933289:.723871\n110900:101:174:136941124:.724506\n111000:-1:-1:-1:-1:IO::Socket::INET: connect: Connection timed out\n111100:-1:-1:-1:-1:IO::Socket::INET: connect: Connection timed out\n111200:43:207:136954348:.726364\n111300:293:207:136960240:.725304\n111400:87:213:136967664:.497808\n111500:99:201:136974792:.49857", "id": 180316, "attachment_id": null, "creator": "m.mannion@warwick.ac.uk", "creation_time": "2015-01-16T11:28:46Z", "time": "2015-01-16T11:28:46Z", "is_private": false}]
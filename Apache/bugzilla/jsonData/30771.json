[{"count": 0, "tags": [], "bug_id": 30771, "attachment_id": null, "id": 62231, "time": "2004-08-20T11:28:56Z", "creator": "al@starfishzone.com", "creation_time": "2004-08-20T11:28:56Z", "is_private": false, "text": "The attached server.xml has 5 <service> defined, each with its own Connector,\nEngine and Host.  I get a ConcurrentModificationException fault when starting\nTomcat that breaks the context registration.\n\nThe stack trace is shown in the attached cataline.out.  My feeling is that this\nissue only occurs on a fast machine which is registering a whole series of\nservices and there is unthread-safe code somewhere in the CoyoteConnector code\nor the underlying MBean system.\n\nI used the server-minimal.xml model to originate my server.xml (e.g. having \n<Connector port=\"8013\" />) but I found that including more attributes to that\nConnector entity (the standard attributes suggested in the default server.xml)\ncaused the Error registering contexts fault to go away.  This workaround does\nnot work on the reproducible case I have prepared; my hunch is that this fault\nis highly time dependent - as I think it must a threading issues.\n\nMy environment:\nFreeBSD 5.2.1\nJDK 1.4.2 (patched for FreeBSD)\nTomcat 5.0.27\nHardware: AMD Athlon XP 2800+, RAM 447MB\n\nReproducible Case\nDo these things on a clean tomcat install:\n1. cd <CATALINA_HOME>\n2. mkdir -p testsite1/htdocs/WEB-INF\n3. cp <a clean web.xml> testsite1/htdocs/WEB-INF\n4. cp -r testsite1 testsite2\n5. cp -r testsite1 testsite3\n6. cp -r testsite1 testsite4\n7. cp -r testsite1 testsite5\n8. Replace conf/server.xml with the one I have attached to this case.\n9. Start Tomcat\n10. Inspect the catalina.out\n\nThe symptom others may find this fault with (if you don't spot the \"Error\nregistering contexts\" in catalina.out) is that the site that fails will return\nthis HTTP header (which is a consequence of that site not being initialised\nproperly):\n# curl -I http://localhost:8013/test.jsp\nHTTP/1.1 400 No Host matches server name localhost\nTransfer-Encoding: chunked\nDate: Fri, 20 Aug 2004 11:22:50 GMT\nServer: Apache-Coyote/1.1\nConnection: close"}, {"count": 1, "tags": [], "creator": "al@starfishzone.com", "text": "Created attachment 12497\ncatalina.out showing stack trace", "id": 62232, "time": "2004-08-20T11:29:39Z", "bug_id": 30771, "creation_time": "2004-08-20T11:29:39Z", "is_private": false, "attachment_id": 12497}, {"count": 2, "tags": [], "bug_id": 30771, "text": "Created attachment 12498\nserver.xml for the reproducible case", "id": 62233, "time": "2004-08-20T11:30:40Z", "creator": "al@starfishzone.com", "creation_time": "2004-08-20T11:30:40Z", "is_private": false, "attachment_id": 12498}, {"count": 3, "tags": [], "bug_id": 30771, "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of 29671 ***", "id": 62247, "time": "2004-08-20T18:28:23Z", "creator": "william.barker@wilshire.com", "creation_time": "2004-08-20T18:28:23Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "peter.reilly@corvil.com", "is_private": false, "id": 33743, "attachment_id": null, "bug_id": 18312, "creation_time": "2003-03-25T11:18:27Z", "time": "2003-03-25T11:18:27Z", "text": "This filter tokenizes the input stream\nand embeds tokenhandlers to filter/modify the stream.\n\nsome examples\n<filterchain>\n   <tokenfilter>\n      <replaceregex pattern=\"([^/s]+)\" replace=\"[\\1]\" flags=\"g\"/>\n    </tokenfiter>\n</filterchain>\n\nOther examples are given in the html doc update to filterchain."}, {"count": 1, "tags": [], "bug_id": 18312, "attachment_id": 5493, "id": 33744, "time": "2003-03-25T11:20:09Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-03-25T11:20:09Z", "is_private": false, "text": "Created attachment 5493\nThe tokenfilter class (with embedded interfaces and classes)"}, {"count": 2, "tags": [], "bug_id": 18312, "attachment_id": 5494, "is_private": false, "id": 33745, "time": "2003-03-25T11:22:23Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-03-25T11:22:23Z", "text": "Created attachment 5494\nPatchs to current ant source to enable tokenfilter"}, {"count": 3, "tags": [], "creator": "peter.reilly@corvil.com", "text": "I have provided the implementation file in the first patch.\nThe second patch is generated as a result of cvs diff -u [named files]\nat ant's top level directory.\n\nThree files are patched:\n  src/main/org/apache/tools/ant/UnknownElement.java\n     call set project on child classes if they have the method\n  src/main/org/apache/tools/ant/types/FilterChain.java\n     add tokenFilter to filterchain\n  docs/manual/CoreTypes/filterchain.html\n     update manual for tokenfilter\n\nOutstanding:\n  unittests.\n\n", "id": 33746, "time": "2003-03-25T11:26:00Z", "bug_id": 18312, "creation_time": "2003-03-25T11:26:00Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "Changed severity to Enhancement.\nAlso original example should be\npattern=\"([^\\s]+)\"", "attachment_id": null, "bug_id": 18312, "id": 33747, "time": "2003-03-25T11:33:14Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-03-25T11:33:14Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 18312, "attachment_id": 5517, "is_private": false, "id": 33848, "time": "2003-03-26T18:55:00Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-03-26T18:55:00Z", "text": "Created attachment 5517\nsource for org.apache.tools.ant.types.optional.ScriptFilter"}, {"count": 6, "tags": [], "creator": "peter.reilly@corvil.com", "is_private": false, "id": 33849, "attachment_id": 5518, "bug_id": 18312, "creation_time": "2003-03-26T18:56:37Z", "time": "2003-03-26T18:56:37Z", "text": "Created attachment 5518\nnew cvs diff -u for affected ant core files"}, {"count": 7, "tags": [], "bug_id": 18312, "text": "Updated patch:\n\nbuild.xml : conditionally compile scriptfilter.java\nsrc/main/org/apache/tools/ant/types/defaults.properties : add scriptfilter\ndocs/manual/CoreTypes/filterchain.html : update html page\n   - add scriptfilter\n   - change tokenhandler to string filter\n", "id": 33850, "attachment_id": null, "creator": "peter.reilly@corvil.com", "creation_time": "2003-03-26T18:58:46Z", "time": "2003-03-26T18:58:46Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 18312, "text": "Peter, \nPatch 5494 alone is obsolete, right?  Please list the patches that are \nrelevant, for clarity's sake.  Please also supply unit tests and I will\ncommit it.  Thanks for the patch.  It addresses an enhancement that has been\nrequested often.\n", "id": 33852, "attachment_id": null, "creator": "umagesh@apache.org", "creation_time": "2003-03-26T19:08:52Z", "time": "2003-03-26T19:08:52Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 18312, "attachment_id": null, "id": 33855, "time": "2003-03-26T19:33:19Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-03-26T19:33:19Z", "is_private": false, "text": "Yikes!\n\nForgot to say that.\n\nyes 5494 is obsolete\n\nThe patches/files needed are 5493, 5517 and 5518\n\n5493 contains the implementation of TokenFilter.\n     It may need to be split into a number of files as\n     I just put all the classes and interfaces in as static inner\n     to keep the number of files down. It also needs a little\n     more comments.\n\n5517 contains the implementation of ScriptFilter\n     After using jedit for a while, i liked the idea of using\n     beanshell in scripts. (This file is definitely not required\n     but it is kind of neat).\n\n5518 contains the mods to core ant files.\n     build.xml and src/main/org/apache/tools/ant/types/defaults.properties\n     for the optional script filter\n\nI will have a go at doing some unit tests to night.\n\nThanks for the feedback.\n\n\n(if possible) I would like to add dynamic configuration to FilterChain.\nThis will allow custom filters to look like built in filters.\n\nThe relavent changes are:\n\nimport org.apache.tools.ant.DynamicConfigurator;\n..\n.\n\npublic final class FilterChain extends DataType \n   implements Cloneable, DynamicConfigurator {\n\n.\n.\n.\n\n    /**\n     * create the named datatype and check if it\n     * is a filter.\n     *\n     * @throws BuildException if unknown datatype or incorrect datatype\n     * @since Ant 1.6 (...)\n     */\n    \n    public Object createDynamicElement(String name)\n    {\n        if (getProject() == null)\n            throw new BuildException(\"Unable to get the project\");\n\n        Object obj = getProject().createDataType(name);\n        if (obj == null)\n            throw new BuildException(\"Unknown type \" + name);\n        if (! (obj instanceof FilterReader))\n            throw new BuildException(\n                \"type \" + name + \" is not a filterreader\");\n        filterReaders.addElement(obj);\n        return obj;\n    }\n\n    /**\n     * Needed for dynamic element support.\n     *\n     * @throws BuildException always\n     */\n    \n    public void setDynamicAttribute(String name, String value) {\n        throw new BuildException(\"Unknown attribute \" + name);\n    }\n"}, {"count": 10, "tags": [], "bug_id": 18312, "attachment_id": null, "is_private": false, "id": 33863, "time": "2003-03-26T20:09:58Z", "creator": "umagesh@apache.org", "creation_time": "2003-03-26T20:09:58Z", "text": "Shouldn't be an issue adding DynamicConfigurator functionailty - the class was \nmarked final thereby preventing anybody from extending it.  The reason why\nDynConf didn't make it in the first cut was that DynConf wasn't approved till\njust before the release.  Please submit a patch for that also."}, {"count": 11, "tags": [], "bug_id": 18312, "attachment_id": null, "text": "IMHO some of the filters should not be subelements but filterreaders on their\nown right.  Trim is such a case, deletechars and ignoreblanks as well.  I haven't\nlooked close enough at translate.\n\nWhat do the contains* filters provide that the existing <linecontains*> readers\ndon't?\n\n", "id": 33898, "time": "2003-03-27T08:22:04Z", "creator": "bodewig@apache.org", "creation_time": "2003-03-27T08:22:04Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 18312, "attachment_id": null, "text": "*** Bug 18290 has been marked as a duplicate of this bug. ***", "id": 33901, "time": "2003-03-27T08:28:13Z", "creator": "bodewig@apache.org", "creation_time": "2003-03-27T08:28:13Z", "is_private": false}, {"count": 13, "tags": [], "creator": "peter.reilly@corvil.com", "is_private": false, "text": ">> DynConf didn't make it in the first cut was that DynConf wasn't approved till\n>>    just before the release.  Please submit a patch for that also.\n   Ok, I will include this in the next update. (note there is a patch\n   already for this - 17199)\n>> IMHO some of the filters should not be subelements but filterreaders on their\n>> own right.  Trim is such a case, deletechars and ignoreblanks as well.\n   These should be filterreaders as well, but trim and ignoreblanks opererate\n   on the token level. The tokens depend on the tokenizer used and the position\n   in the token handler chain.\n>>  looked close enough at translate.\n   translate is a half baked attempt to provide some of the functionality\n   of \"tr\", but since it does not handle character ranges, it is\n   completely useless, I will drop it in the next update.\n>>  What do the contains* filters provide that the existing\n    containsregex provides optional substitution as well.\n    both operate at the token level and not just at a line level, so\n    for example containsstring could be used to filter words that\n    contain bug\n    <tokenfilter delimoutput=\"#\">\n        <stringtokenizer/>\n        <containsstring contains=\"bug\">\n    </tokenfilter>\n    would convert:\n      this is a line containing bugs\n      that I reported to bugzilla.\n    to:\n       bugs#bugzilla.#\n\n Also the token filters can be chained for whatever need that\nusers can think of: for example\n    <concat>\n      sun moon and stars\n      <filterchain>\n        <tokenfilter>\n          <trim/>\n          <replaceregex pattern=\"moon\" replace=\"world\"/>\n          <containsstring contains=\"world and stars\"/>\n          <deletechars chars=\"o\"/>\n          <replacestring from=\"wrld\" to=\"earth\"/>\n        </tokenfilter>\n      </filterchain>\n    </concat>\n\nprints out\n   sun earth and stars\n\ngranted that is a lame example, but one can see the potential...\n\nFor the next update I will provide the patch and the new\nfiles (unittests + some fixes) in a tared gzip file \n(unless there are objections)\n\nThanks for taking a look at this\n\nPeter.", "id": 33905, "time": "2003-03-27T10:16:58Z", "bug_id": 18312, "creation_time": "2003-03-27T10:16:58Z", "attachment_id": null}, {"count": 14, "tags": [], "text": "Created attachment 5543\ntokenfilter.tar.gz - gziped tar file containing patches and new files", "attachment_id": 5543, "bug_id": 18312, "id": 33967, "time": "2003-03-27T18:20:37Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-03-27T18:20:37Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 18312, "attachment_id": null, "id": 33970, "time": "2003-03-27T18:32:44Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-03-27T18:32:44Z", "is_private": false, "text": "Updated the patch.\n\nAll the files are now in patch 5543\nThe files are relative to the top level ant directory\nThis contains the following:\ntokendiff.diffs:\n    this contains the cvs diff -c on the following files\n\n  build.xml\n    : conditionally compile scriptfilter.java\n  src/main/org/apache/tools/ant/types/defaults.properties\n    : add scriptfilter\n  src/main/org/apache/tools/ant/UnknownElement.java\n    : call set project on child classes if they have the method\n  src/main/org/apache/tools/ant/types/FilterChain.java\n    : add tokenFilter to filterchain\n  docs/manual/CoreTypes/filterchain.html\n    : update manual for tokenfilter\n\nThe new files are:\n  src/etc/testcases/filters/dynamicfilter.xml\n    : test build file for dynamic element\n  src/etc/testcases/filters/tokenfilter.xml \n    : test build file for token filer\n  src/main/org/apache/tools/ant/filters/TokenFilter.java\n    : the tokenfilter implementation\n  src/main/org/apache/tools/ant/types/optional/ScriptFilter.java\n    : the scriptFilter implementation\n  src/testcases/org/apache/tools/ant/filters/DynamicFilterTest.java\n    : The dymamic filter test\n  src/testcases/org/apache/tools/ant/filters/TokenFilterTest.java\n    : the token filter tests\n\nChanges since last.\n\n   removed translate\n   added test cases\n   added comments to tokenfilter\n\nTwo of the tests are disabled, currently copy with filterchain\nmodifies line endings. I have a fix, but as it affects copy's\nbehaviour, it needs to be cycled seperately.\n\nPeter.\n\n\n     "}, {"count": 16, "tags": [], "bug_id": 18312, "text": "Created attachment 5659\npatch.tokenfilter.tar.gz - updated gziped tar file", "id": 34579, "time": "2003-04-06T00:40:39Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-04-06T00:40:39Z", "is_private": false, "attachment_id": 5659}, {"count": 17, "tags": [], "bug_id": 18312, "attachment_id": null, "text": "I have updated the patch and new files - attachment 5659\nThe patch obsoletes the previous patches\nChanges are:\n\n* the setproject modifications have been placed in a separate buzilla report\n  - bugzilla 18513, it is necessary to use the patch from 18513 to enable\n  this patch\n* it turns out that the createDynamicElement method in FilterChain was incorrect.\n  it was checking to see if the datatype extended java.io.FilterReader, but it\n  was impossible to use this as is in a filterchain. I not use ChainableReader.\n* I have implemented a chainablereader wrapper for tokenfilter.filter. This\n  allows replaceregex, containsregex, replacestring, trim, ignoreblank and\n  scriptfilter to be used at as chainable filters. By default they operate\n  on a perline base, but may set set to work on a complete input stream\n  basis\n* deletechars has been renamed deletcharaters and there is an implementation\n  as a chainable filter and as a token filter.\n\nPeter.", "id": 34580, "time": "2003-04-06T00:56:37Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-04-06T00:56:37Z", "is_private": false}, {"count": 18, "tags": [], "text": "Peter,\nPR 18513 states \"Weblogic deployment does not work properly\".\nWhere is the pre-requisite patch that you mention?\n", "attachment_id": null, "bug_id": 18312, "id": 35121, "time": "2003-04-14T15:56:07Z", "creator": "umagesh@apache.org", "creation_time": "2003-04-14T15:56:07Z", "is_private": false}, {"count": 19, "tags": [], "text": "Sorry about the bug number, it should be 18613\n:- but I see that you have found it\nCheers, Peter", "attachment_id": null, "bug_id": 18312, "id": 35149, "time": "2003-04-14T23:55:20Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-04-14T23:55:20Z", "is_private": false}, {"count": 20, "tags": [], "bug_id": 18312, "is_private": false, "id": 37976, "attachment_id": null, "creator": "peter.reilly@corvil.com", "creation_time": "2003-05-29T13:50:36Z", "time": "2003-05-29T13:50:36Z", "text": "Closing this as the patch is in ant cvs HEAD\n"}]
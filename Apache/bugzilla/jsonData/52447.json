[{"count": 0, "tags": [], "creator": "David.Stone@windstream.com", "text": "I have a fairly simple workbook that I have successfully opened using POI. However, when trying a similar file with hyperlinks saved within, POI is unable to read it. This is the stacktrace I got on repeated attempts:\n\njava.lang.RuntimeException: Unexpected record type (org.apache.poi.hssf.record.HyperlinkRecord)\n\tat org.apache.poi.hssf.record.aggregates.RowRecordsAggregate.<init>(RowRecordsAggregate.java:107)\n\tat org.apache.poi.hssf.model.InternalSheet.<init>(InternalSheet.java:208)\n\tat org.apache.poi.hssf.model.InternalSheet.createSheet(InternalSheet.java:163)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:298)\n\tat org.apache.poi.ss.usermodel.WorkbookFactory.create(WorkbookFactory.java:82)\n\tat excelproc.util.ExcelFileWrapper.<init>(ExcelFileWrapper.java:42)\n\tat excelproc.exec.InvoiceComparisonIndexBuilder.main(InvoiceComparisonIndexBuilder.java:46)\n\nThe hyperlinks are internet URLs, if that makes a difference. Let me know if more info is needed. Thanks!", "id": 152667, "time": "2012-01-10T22:46:12Z", "bug_id": 52447, "creation_time": "2012-01-10T22:46:12Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "David.Stone@windstream.com", "is_private": false, "count": 1, "id": 152668, "time": "2012-01-10T22:47:42Z", "bug_id": 52447, "creation_time": "2012-01-10T22:47:42Z", "text": "This is the code I'm using to attempt to open the workbook:\n\n\tpublic ExcelFileWrapper(String filename, Timestamp endDate) {\n\t\tthis.filename = filename;\n\t\tthis.endDate = endDate;\n\t\tfinal File f = new File(filename);\n\t\ttry {\n\t\t\texcelFile = WorkbookFactory.create(f);\n\t\t} catch (Exception e) {\n\t\t\tlog.error(\"Could not open Excel workbook for updating.\", e);\n\t\t}\n\t}"}, {"count": 2, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "is_private": false, "id": 152689, "time": "2012-01-11T15:07:17Z", "bug_id": 52447, "creation_time": "2012-01-11T15:07:17Z", "text": "Any chance you could supply the problem file?\n\nIt looks like POI thinks the hyperlink applies to several rows, which isn't currently supported. We'll need the file to investigate why that is (to see the options on the hyperlink records, where they live in your file etc)"}, {"count": 3, "tags": [], "bug_id": 52447, "is_private": false, "text": "I tried manually creating each hyperlink separately in a reduced form of the target spreadsheet, and POI was able to operate on it successfully. I don't know exactly what the process is upstream; the developer generating the Excel file I receive may be doing something when creating her hyperlinks that POI doesn't like. I'd attach the spreadsheet, but it contains business data that probably shouldn't be shared. If there was a quick way to change the URLs in the hyperlinks without messing with whatever structure they're currently in, that would be sufficient to remove sensitive data and share the workbook.\n\nThanks!", "id": 152724, "time": "2012-01-12T16:16:15Z", "creator": "David.Stone@windstream.com", "creation_time": "2012-01-12T16:16:15Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "apache@gagravarr.org", "is_private": false, "count": 4, "id": 152750, "time": "2012-01-13T11:03:26Z", "bug_id": 52447, "creation_time": "2012-01-13T11:03:26Z", "text": "You could maybe go at it with a Hex Editor - you should be able to search for the hyperlink URL and text (assuming neither use accented or non-English characters they'll show up normally). Then, change those in the hex editor to something dummy but with the same size, and finally check in Excel that it can still open the files and sees the dummy text instead"}, {"count": 5, "tags": [], "bug_id": 52447, "text": "Created attachment 29400\nfile with hyperlink that repro's the exception", "id": 162289, "time": "2012-09-19T17:55:15Z", "creator": "404erorr@gmail.com", "creation_time": "2012-09-19T17:55:15Z", "is_private": false, "attachment_id": 29400}, {"count": 6, "tags": [], "bug_id": 52447, "text": "Hello, I am getting the same exception with Apache POI 3.8 and the file attached.\n\nException:\njava.lang.RuntimeException: Unexpected record type (org.apache.poi.hssf.record.HyperlinkRecord)\n\tat org.apache.poi.hssf.record.aggregates.RowRecordsAggregate.<init>(RowRecordsAggregate.java:107)\n\tat org.apache.poi.hssf.model.InternalSheet.<init>(InternalSheet.java:208)\n\tat org.apache.poi.hssf.model.InternalSheet.createSheet(InternalSheet.java:163)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:296)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:248)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:192)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:327)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:308)\n\tat org.apache.poi.ss.usermodel.WorkbookFactory.create(WorkbookFactory.java:70)\n\tat com....MiscUnitTests.testExcelReader(MiscUnitTests.java:693)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47)\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:231)\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:50)\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:300)\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:157)\n\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:76)\n\tat com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:195)\n\tat com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:63)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat com.intellij.rt.execution.application.AppMain.main(AppMain.java:120)\n\nUnit test:\n    @Test\n    public void testExcelReader() throws IOException, InvalidFormatException\n    {\n        InputStream stream = null;\n        try\n        {\n            stream = this.getClass().getResourceAsStream(\"/sample_with_hyperlinks.xls\");\n            WorkbookFactory.create(stream);\n        } finally\n        {\n            stream.close();\n        }\n    }\n\nI have not been able to create a simpler file that produces the exception. Thanks in advance.", "id": 162290, "time": "2012-09-19T18:01:29Z", "creator": "404erorr@gmail.com", "creation_time": "2012-09-19T18:01:29Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "deepeshdrk@gmail.com", "text": "Hi,\n\nI am currently facing the similar kind of issue will loading a file from this link: https://www.jse.co.za/_layouts/15/DownloadHandler.ashx?FileName=/Safex/All%20Contract%20Details.xls.\n\nIf I open the file and enable editing,it size becomes almost double and it loads properly.But due to some restriction i cant done these changes in code.\n\nThanks and Regards,\nDeepesh Ramrakhyani.", "id": 175150, "time": "2014-05-12T06:46:55Z", "bug_id": 52447, "creation_time": "2014-05-12T06:46:55Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "is_private": false, "id": 181893, "time": "2015-03-18T20:55:05Z", "bug_id": 52447, "creation_time": "2015-03-18T20:55:05Z", "text": "This is similar to the error reported in bug 57669"}, {"count": 9, "tags": [], "bug_id": 52447, "attachment_id": null, "text": "Seems to be caused by slightly corrupted Excel files, see bug 50426 and bug 53984 for similar issues where we could work around the problem somehow, although in this case it does not seem to be that easy as a simple fix similar to the previous bugs does not make it work...", "id": 182794, "time": "2015-05-01T20:47:38Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-05-01T20:47:38Z", "is_private": false}]
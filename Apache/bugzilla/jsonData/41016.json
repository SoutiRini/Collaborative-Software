[{"count": 0, "tags": [], "creator": "elliott.murray@greencathedral.com", "attachment_id": null, "text": "I am trying to set up multiple contexts in Tomcat 5.5 but have a problem in\nlogging in. I have them both up and running. They both use realms for login\nfunctionality. I wanted to originally use my own custom data source realm\n(limitations in the use of the Catalina one) This was working fine for App A but\nas soon as I put up App B using the same code but a different configuration\n(different tables, jdbc connections etc) I had some strange results. I would get\nthe login page for App A turning up in App B and vice versa on what seemed\nrandom conditions. Login would only work on one App at a time in best case\nscenario. I then regressed back to using the DataSourceRealm but have the same\nresults. If I use one of each it seems to work in that the correct login pages\nappear and I can log into one of the sites (though due to my sql requirements\ncan only actually log into one app as the DataSourceRealm isn't quite flexible\nenough for either of my apps) \n\nOther notes. They are both FORM login types in web.xml. Example context config\nbelow:\n\n<Context\n    docBase=\"C:/webapps/app1\"\n    reloadable=\"true\"\n    workDir=\"C:\\Java\\Tomcat5.5\\work\">    \n  \n  <Realm className=\"org.apache.catalina.realm.DataSourceRealm\" debug=\"99\"\n        dataSourceName=\"jdbc/App1MySQLDB\"\n           userTable=\"member\" userNameCol=\"email\" userCredCol=\"password\"\n      userRoleTable=\"schemes\" roleNameCol=\"name\"/>\n  \n  <Resource\n    auth=\"Container\"\n    name=\"jdbc/App1MySQLDB\"\n    type=\"javax.sql.DataSource\"\n    password=\"xxx\"\n    driverClassName=\"com.mysql.jdbc.Driver\"\n    maxIdle=\"5\"\n    maxWait=\"10000\"\n    removeAbandoned=\"true\"\n    logAbandoned=\"true\"\n    username=\"user\"\n    url=\"jdbc:mysql://a-url\"\n    removeAbandonedTimeout=\"60\"\n    factory=\"org.apache.commons.dbcp.BasicDataSourceFactory\"\n    maxActive=\"20\"/>\n</Context>\n\nThe workaround I have found (with help from mailing list) was to add the parameter\n\nlocalDataSource=\"true\"\n\nto the resource (default is false). There are no GlobalNamingResources\nparameters in server xml. A strong suspicion that there is a jndi issue here: \nhttp://svn.apache.org/repos/asf/tomcat/container/tc5.5.x/catalina/src/share/org/apache/catalina/realm/DataSourceRealm.java\n in the connection open() method.", "id": 96071, "time": "2006-11-22T06:10:44Z", "bug_id": 41016, "creation_time": "2006-11-22T06:10:44Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 41016, "is_private": false, "id": 96073, "time": "2006-11-22T06:27:18Z", "creator": "markt@apache.org", "creation_time": "2006-11-22T06:27:18Z", "tags": [], "text": "Please provide the realm config for appB to confirm this is not a configuration\nissue."}, {"count": 2, "tags": [], "bug_id": 41016, "is_private": false, "text": "Before you spend time investigating this \"issue\", you might want to consider the\n\"workaround\" was to add localDataSource=\"true\" to the Resource element (not the\nrealm element).", "id": 96077, "time": "2006-11-22T06:53:25Z", "creator": "remm@apache.org", "creation_time": "2006-11-22T06:53:25Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 41016, "attachment_id": null, "id": 96166, "time": "2006-11-25T09:18:57Z", "creator": "olivier@orcades.net", "creation_time": "2006-11-25T09:18:57Z", "is_private": false, "text": "Hi\n Not so sure, when we spotted the \"issues\". I told elliot to add the\n\"localDatasource\" attribute to \"true\" in the *realm* (\nhttp://mail-archives.apache.org/mod_mbox/tomcat-users/200611.mbox/%3c2e851c270611220409uebc780agbcc875440d1f9361@mail.gmail.com%3e\n)\nPerhaps it a bug in the bugreport :-)"}, {"count": 4, "attachment_id": null, "creator": "elliott.murray@greencathedral.com", "text": "(In reply to comment #3)\n> Hi\n>  Not so sure, when we spotted the \"issues\". I told elliot to add the\n> \"localDatasource\" attribute to \"true\" in the *realm* (\n>\nhttp://mail-archives.apache.org/mod_mbox/tomcat-users/200611.mbox/%3c2e851c270611220409uebc780agbcc875440d1f9361@mail.gmail.com%3e\n> )\n> Perhaps it a bug in the bugreport :-)\n\nApologies and correct. I did add \"localDataSource\" to the realm - my bug report\ndoes in fact have a bug in it! But App A and App B context's are exactly the\nsame but for the names/paths. I also do not believe there is a problem with them\nas either runs independantly or both sort of work with the localDataSource fix.\nI have noticed since I tried this \"fix\" that sometimes on tomcat start up it\ndoesn't seem to work and takes a redeploy to resolve the issue. This may be an\nerror my side (that I am looking at) but is part of some strange behaviour\ngenerally. \n", "id": 96260, "time": "2006-11-28T01:44:27Z", "bug_id": 41016, "creation_time": "2006-11-28T01:44:27Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 41016, "is_private": false, "id": 96598, "time": "2006-12-07T03:40:22Z", "creator": "elliott.murray@greencathedral.com", "creation_time": "2006-12-07T03:40:22Z", "tags": [], "text": "I have investigated this a little further. It seems on startup one of the\napplications still has this problem (but not both?!) until I do a reload of the\nbroken app. A touch on the context xml is all I do. The reload fixes the\nproblem. I have seen similar behaviour on Windows and Linux on Tomcat 5.5.x."}, {"count": 6, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "If a DataSourceRealm is specified at the Context level and the DataSource\nresource is also specified at the Context level (rather than as a global\nresource) the localDataSource=\"true\" must be used as per the documentation. Any\nunusual behaviour with this configuration when localDataSource=\"true\" is not\nspecified is irrelevant since the configuration is invalid.\n\nI have created two identical contexts (with just index, login and error JSPs),\nboth using a DataSourceRealm defined at the context level and both with local\nDataSources and both contexts are accessible on Tomcat startup. The report also\nmentions the login form for one context being displayed for a second context. I\nhave also not been able to reproduce this.\n\nI suspect a configuration or possibly an application issue is at the heart of this.\n\nI suggest you try to reproduce this with the simplest possible test WAR rather\nthan your entire application to rule out any application issues. If you do\nreproduce it with a simple test WAR please re-open this report and I'll take\nanother look.", "id": 96695, "time": "2006-12-09T20:48:14Z", "bug_id": 41016, "creation_time": "2006-12-09T20:48:14Z", "attachment_id": null}]
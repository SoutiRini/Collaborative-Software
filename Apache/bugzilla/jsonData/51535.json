[{"count": 0, "tags": [], "bug_id": 51535, "attachment_id": 27303, "text": "Created attachment 27303\nA test document and a junit test case which exposes the issue\n\nWhen I have a document with data in rows with a high number (say 65535) I get array index exceptions because row numbers are negative. For instance in ValueRecordsAggregate in line\n\nCellValueRecordInterface[] rowCells = records[row];\n\nrow is -32768\n\nmoreover in HSSFSheet\n\nwhile (row != null) {\n  createRowFromRecord(row);\n  row = sheet.getNextRow();\n}\n\nThere are cases where row.getRowNumber returns a negative int. I tried to manufacture an example file. It seems that NPOIFS somewhere parses the row number as a signed number, while it has to be unsigned. I don't know enough POI to fix this myself but my test case seems to show the problem.\n\nIt didn't occur with older POIFS.", "id": 148040, "time": "2011-07-20T16:26:31Z", "creator": "antoni.mylka@aduna-software.com", "creation_time": "2011-07-20T16:26:31Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 51535, "attachment_id": null, "text": "I've added a slightly tweaked version of your unit test in r1149181. It's currently disabled as the test fails as described", "id": 148065, "time": "2011-07-21T13:56:50Z", "creator": "apache@gagravarr.org", "creation_time": "2011-07-21T13:56:50Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 51535, "attachment_id": 27373, "id": 148556, "time": "2011-08-11T10:46:15Z", "creator": "antoni.mylka@aduna-software.com", "creation_time": "2011-08-11T10:46:15Z", "is_private": false, "text": "Created attachment 27373\nA patch which seems to fix the issue\n\nNDocumentInputStream.readUShort() method would delegate to LittleIndian.getShort(). I changed this to LittleIndian.getUShort(). Nothing else broke, so the lack of 'U' must have been a typo."}, {"count": 3, "tags": [], "bug_id": 51535, "attachment_id": null, "id": 148558, "time": "2011-08-11T11:13:14Z", "creator": "apache@gagravarr.org", "creation_time": "2011-08-11T11:13:14Z", "is_private": false, "text": "Ah, good spot!\n\nFixed, and test re-enabled in r1156573, thanks"}]
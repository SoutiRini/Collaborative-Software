[{"count": 0, "tags": [], "creator": "gregor@apache.org", "attachment_id": null, "text": "Hi All,\nDon't know if it is worth contributing, but it seems to be working out good\nfor my needs.  My clients already use an NT domain to login to their\ncomputers so I wanted them to be able to use their domain userid and\npassword.  I used the jcifs jar to do the authentication and simply extended\nthe FileUser class.  I was also able to use jcifs to authenticate against a\nsmb share.\n\nFor now I just create the user with lenya, then edit the\nconfig/ac/passwd/id.iml file to use org.apache.lenya.ac.cifs.CIFSUser\ninstead of org.apache.lenya.ac.file.FileUser.  I would love to have the\noption in lenya when I create the user though! It would also be cool to be\nable to specify a server to authenticate against.\n\npackage org.apache.lenya.ac.cifs;\n\nimport java.io.File;\n\nimport org.apache.lenya.ac.file.*;\nimport org.apache.lenya.ac.AccessControlException;\nimport org.apache.lenya.ac.Password;\n\nimport org.apache.log4j.Category;\n\nimport jcifs.smb.*;\nimport jcifs.UniAddress;\nimport java.net.UnknownHostException;\n\n/**\n *\n * @author doug\n */\npublic class CIFSUser extends FileUser {\n    /**\n    * Creates a new CIFSUser object.\n    */\n    public CIFSUser() {\n    }\n\n    /**\n    * Create a CIFSUser\n    */\n    public CIFSUser(File configurationDirectory, String id, String fullName,\nString email,\n        String password) {\n        super(configurationDirectory, id, fullName, email, password);\n    }\n\n\n\n    /**\n     * Authenticate a user. This is done by NTDomain Authentication\n     *  using jcifs\n     *\n     * @param password to authenticate with\n     * @return true if the given password matches the password for this user\n     */\n    public boolean authenticate(String password) {\n        //Don't want to log Domain passwords!!!!\n        //log.debug(\"Password: \" + password);\n        //log.debug(\"pw encypted: \" + Password.encrypt(password));\n        //log.debug(\"orig encrypted pw: \" + this.encryptedPassword);\n\n        System.setProperty(\n\"jcifs.smb.client.disablePlainTextPasswords\",\"false\" );\n        try {\n            UniAddress mydomaincontroller = UniAddress.getByName(\n\"primarydomainserver.whatever\" );\n            NtlmPasswordAuthentication mycreds = new\nNtlmPasswordAuthentication( \"WORKGROUP\", super.getId(), password);\n            SmbSession.logon( mydomaincontroller, mycreds );\n            // SUCCESS\n            return true;\n        } catch( SmbAuthException sae ) {\n            // AUTHENTICATION FAILURE\n            return false;\n        } catch( SmbException se ) {\n            // NETWORK PROBLEMS?\n            //se.printStackTrace();\n            return false;\n        } catch( UnknownHostException unho) {\n            return false;\n        }\n\n    }\n\n}", "id": 53104, "time": "2004-02-27T09:23:10Z", "bug_id": 27289, "creation_time": "2004-02-27T09:23:10Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 27289, "attachment_id": null, "text": "contribution by doug chestnut", "id": 53105, "time": "2004-02-27T09:23:53Z", "creator": "gregor@apache.org", "creation_time": "2004-02-27T09:23:53Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 27289, "attachment_id": null, "text": "The first comment contains a patch.\n\nMaybe this should be applied before 1.2 is released.", "id": 57191, "time": "2004-05-11T10:46:04Z", "creator": "A.Kuckartz@ping.de", "creation_time": "2004-05-11T10:46:04Z", "is_private": false}, {"count": 3, "tags": [], "creator": "gregor@apache.org", "attachment_id": null, "text": "needs a mock class", "id": 57194, "time": "2004-05-11T12:06:40Z", "bug_id": 27289, "creation_time": "2004-05-11T12:06:40Z", "is_private": false}, {"count": 4, "tags": [], "creator": "ps@nomensa.com", "attachment_id": null, "id": 65941, "time": "2004-10-28T21:18:05Z", "bug_id": 27289, "creation_time": "2004-10-28T21:18:05Z", "is_private": false, "text": "What's the difference between using this to authenticate against a domain\ncontroller and using LDAP ?"}, {"count": 5, "tags": [], "bug_id": 27289, "attachment_id": null, "text": "from what i understand, CIFS is basically SMB. this would be useful to connect\nto a pre-Active Directory windows domain.", "id": 65942, "time": "2004-10-28T21:27:00Z", "creator": "gregor@apache.org", "creation_time": "2004-10-28T21:27:00Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 27289, "attachment_id": null, "text": "Ahh...of course.\n\nand if it was not a true windows domain but a linux samba implementation. Could\nthis authenticate against that do you know ?", "id": 65944, "time": "2004-10-28T21:36:04Z", "creator": "ps@nomensa.com", "creation_time": "2004-10-28T21:36:04Z", "is_private": false}, {"count": 7, "tags": [], "creator": "gregor@apache.org", "attachment_id": null, "id": 65946, "time": "2004-10-28T21:44:40Z", "bug_id": 27289, "creation_time": "2004-10-28T21:44:40Z", "is_private": false, "text": "one would assume that the answer would be yes given that this is a pretty basic\nthing for samba to support, but i am only assuming."}, {"count": 8, "tags": [], "bug_id": 27289, "attachment_id": null, "text": "peter,\n\ninterested in enhancing this patch so that it compiles without external\ndependencies?", "id": 66002, "time": "2004-10-29T03:11:21Z", "creator": "gregor@apache.org", "creation_time": "2004-10-29T03:11:21Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 27289, "attachment_id": null, "text": "I have had a look at this and assuming its OK to go with the jcifs library then\nthe following does indeed work quite nicely. A lot easier than LDAP ;) Thanks Doug.\n\nI have updated the CIFSUser.java to read from a cifs.properties file so that it\nis easier to update but also more inline with LDAPUser.\n\nAttachments include:\n - JCIFS library to be dropped in top level $LENYA_HOME/lib (get it here\nhttp://jcifs.samba.org/src/jcifs-1.1.0.jar)\n - Updated CIFSUser.java\n - Sample cifs.properties to be put in $PUBLICATION_HOME/config/ac/passwd\ndirectory (like ldap.properties)", "id": 66169, "time": "2004-10-30T15:31:11Z", "creator": "ps@nomensa.com", "creation_time": "2004-10-30T15:31:11Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 27289, "attachment_id": 13277, "text": "Created attachment 13277\nEnhanced CIFSUser.java", "id": 66170, "time": "2004-10-30T15:31:44Z", "creator": "ps@nomensa.com", "creation_time": "2004-10-30T15:31:44Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 27289, "attachment_id": 13278, "text": "Created attachment 13278\nSample properties needed by CIFSUser.java", "id": 66171, "time": "2004-10-30T15:32:12Z", "creator": "ps@nomensa.com", "creation_time": "2004-10-30T15:32:12Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 27289, "attachment_id": null, "text": "great,\n\nthanks peter!\n\nunfortunately JCIFS is licensed under the LGPL and can therefore not be\ndistributed with Lenya, and without it i suppose lenya would not compile. (hence\nthe idea with the mock classes). best to point to this zilla entry from the wiki.", "id": 66186, "time": "2004-10-31T00:07:35Z", "creator": "gregor@apache.org", "creation_time": "2004-10-31T00:07:35Z", "is_private": false}, {"count": 13, "attachment_id": null, "bug_id": 27289, "text": "So is the currently suggested solution for lenya distribution to mimic the JCIFS\nlibrary in its entirety (or all should I say that is minimally required) so it\ncan be shipped with lenya but obviously not actually work. Are there any other\nimplementations to consider ?\n\nI can have a go with the mock classes and produce a jar to distribute if thats\nwhat's needed.", "id": 66189, "time": "2004-10-31T00:23:38Z", "creator": "ps@nomensa.com", "creation_time": "2004-10-31T00:23:38Z", "tags": [], "is_private": false}, {"count": 14, "tags": [], "bug_id": 27289, "attachment_id": 13310, "text": "Created attachment 13310\nJCIFS mock library (including sources) as java archive", "id": 66305, "time": "2004-11-02T19:21:35Z", "creator": "ps@nomensa.com", "creation_time": "2004-11-02T19:21:35Z", "is_private": false}, {"count": 15, "tags": [], "creator": "ps@nomensa.com", "attachment_id": null, "text": "I have uploaded a jar file and set its mime-type to what I believe it should be.\nI don't think bugzilla handles these attachments particularly well.\n\nDownload the jcifs-mock jar and rename it to jcifs-mock.jar or something.\n\nIf you want I will upload the source files individually but this was supposed to\nbe easier and save time :(\n\nLenya-1.2 now compiles with CIFSUser.java and the mock jcifs classes.", "id": 66307, "time": "2004-11-02T19:25:10Z", "bug_id": 27289, "creation_time": "2004-11-02T19:25:10Z", "is_private": false}, {"count": 16, "tags": [], "bug_id": 27289, "attachment_id": 13311, "text": "Created attachment 13311\nUniAddress.java mock class", "id": 66308, "time": "2004-11-02T19:31:32Z", "creator": "ps@nomensa.com", "creation_time": "2004-11-02T19:31:32Z", "is_private": false}, {"count": 17, "tags": [], "creator": "ps@nomensa.com", "attachment_id": 13312, "is_private": false, "id": 66309, "time": "2004-11-02T19:32:01Z", "bug_id": 27289, "creation_time": "2004-11-02T19:32:01Z", "text": "Created attachment 13312\nNtlmPasswordAuthentication.java mock class"}, {"count": 18, "tags": [], "bug_id": 27289, "attachment_id": 13313, "text": "Created attachment 13313\nSmbAuthException.java mock class", "id": 66310, "time": "2004-11-02T19:32:20Z", "creator": "ps@nomensa.com", "creation_time": "2004-11-02T19:32:20Z", "is_private": false}, {"count": 19, "tags": [], "creator": "ps@nomensa.com", "is_private": false, "text": "Created attachment 13314\nSmbException.java mock class", "id": 66311, "time": "2004-11-02T19:32:43Z", "bug_id": 27289, "creation_time": "2004-11-02T19:32:43Z", "attachment_id": 13314}, {"count": 20, "tags": [], "creator": "ps@nomensa.com", "attachment_id": 13315, "is_private": false, "id": 66312, "time": "2004-11-02T19:33:00Z", "bug_id": 27289, "creation_time": "2004-11-02T19:33:00Z", "text": "Created attachment 13315\nSmbSession.java mock class"}, {"count": 21, "tags": [], "creator": "gregor@apache.org", "attachment_id": null, "id": 74599, "time": "2005-05-09T00:03:29Z", "bug_id": 27289, "creation_time": "2005-05-09T00:03:29Z", "is_private": false, "text": "this has been commited, but needs a good documentation home. i will create a new\nissue to allow selecting the user type (file,ldap,cifs etc) in the user creation\nscreen."}]
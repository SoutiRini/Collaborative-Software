[{"count": 0, "tags": [], "bug_id": 41436, "text": "I have been fighting with a problem of people sometimes not being able to save\nwith error messages saying that they do not have permission to edit the file,\nwhen in reality they do. Unfortunately, this error does not fire consistantly,\nwhich is hampering debugging efforts. I have managed to figure this much out. \n\nThe belongsTo() function in org.apache.lenya.ac.Identity is where the problem is\nfiring. Inside of the loop, user is being set correctly to my current user.\notherUser is actually null. The following check then is false and permission is\nrejected. No exceptions are being thrown, so manager, and manager.getUserManager\naren't null.", "id": 98370, "time": "2007-01-22T11:59:35Z", "creator": "rfrovarp@apache.org", "creation_time": "2007-01-22T11:59:35Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 41436, "is_private": false, "count": 1, "id": 98393, "time": "2007-01-23T05:28:13Z", "creator": "andreas@apache.org", "creation_time": "2007-01-23T05:28:13Z", "text": "I simplified Identity.belongTo(), maybe this helps debugging."}, {"count": 2, "tags": [], "bug_id": 41436, "attachment_id": null, "is_private": false, "id": 98394, "time": "2007-01-23T05:29:19Z", "creator": "andreas@apache.org", "creation_time": "2007-01-23T05:29:19Z", "text": "I guess that the problem relates to the browser's session handling, maybe some\nclient-side JavaScript issue. Is it reproducable with different browsers?"}, {"count": 3, "tags": [], "creator": "rfrovarp@apache.org", "attachment_id": null, "text": "The session values stored in the cookies and sent through to Lenya appear to be\nconsistent. One of my problems is that it is quite rare that this problem is\noccurring at the moment. It may have something to do with the number of\ndebugging statements being sent to screen, which is slowing processing down. I\ndo have an older build that is very consistent in having this problem. Using\nthat build I am having trouble with this under FF 2.0/Linux and IE 6/XP.\nHowever, Opera 9/Linux isn't having an issue. That browser of course doesn't\nload FCKedit, so it may be a Javascript problem. If I disable Javascript after\nloading the edit page with FF2.0, it does not fix the problem.", "id": 98397, "time": "2007-01-23T07:14:06Z", "bug_id": 41436, "creation_time": "2007-01-23T07:14:06Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 41436, "is_private": false, "count": 4, "id": 98400, "time": "2007-01-23T08:13:37Z", "creator": "rfrovarp@apache.org", "creation_time": "2007-01-23T08:13:37Z", "text": "I'm getting a weird problem now. This appears to happen only with FF with FCK.\nUsing the new code, I end up with these three values if I login to the default\npublication, logout, and go to my test publication:\n\nbelongsTo = ref\nthisId = \n/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/edutechhigh/config/ac/passwd\notherId =\n/home/rfrovarp/lenya-1.4.x/build/lenya/webapp/lenya/pubs/default/config/ac/passwd\n\nI have no clue as to why it is pulling from the default pub."}, {"count": 5, "tags": [], "creator": "rfrovarp@apache.org", "attachment_id": null, "is_private": false, "id": 98401, "time": "2007-01-23T08:19:12Z", "bug_id": 41436, "creation_time": "2007-01-23T08:19:12Z", "text": "I spoke too soon. I got the problem to trip without logging into the default\npublication. I closed the browser down and only logged into the one publication.\nIt still at one point tried to grab from the default publication, after several\nsuccessful runs. "}, {"attachment_id": null, "tags": [], "bug_id": 41436, "is_private": false, "count": 6, "id": 98873, "time": "2007-02-01T09:33:10Z", "creator": "rfrovarp@apache.org", "creation_time": "2007-02-01T09:33:10Z", "text": "I have found part of the issue, at least the reason why it doesn't happen all of\nthe time. The simplification of the belongsTo code did help. \n\nCheck out\norg.apache.lenya.ac.file.FileAccreditableManager.getId(FileAccreditableManager.java:197)\n\nThat Assert is failing some of the time. When it fails, everything works for me.\nWhen it doesn't fail, I am having my trouble. this.configurationDirectory is\nonly not null when getConfigurationDirectory has been ran successfully at least\nonce. Since this isn't called from the constructor, there are no guarantees. \n\nHere's the stack trace:\n\njava.lang.RuntimeException: The parameter [configuration directory] must not be\nnull!\n        at org.apache.lenya.util.Assert.notNull(Assert.java:32)\n        at\norg.apache.lenya.ac.file.FileAccreditableManager.getId(FileAccreditableManager.java:197)\n        at org.apache.lenya.ac.Identity.belongsTo(Identity.java:150)\n        at\norg.apache.lenya.ac.impl.DefaultAccessController.ownsIdenity(DefaultAccessController.java:372)\n        at\norg.apache.lenya.ac.impl.DefaultAccessController.hasValidIdentity(DefaultAccessController.java:421)\n        at\norg.apache.lenya.ac.impl.DefaultAccessController.setupIdentity(DefaultAccessController.java:380)\n        at\norg.apache.lenya.cms.cocoon.acting.AccessControlAction.act(AccessControlAction.java:86)\n        at\norg.apache.lenya.cms.cocoon.acting.DelegatingAuthorizerAction.act(DelegatingAuthorizerAction.java:51)\n        at\norg.apache.cocoon.components.treeprocessor.sitemap.ActTypeNode.invoke(ActTypeNode.java:125)\n        at\norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)\n        at\norg.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)\n        at\norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)\n        at\norg.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)\n        at\norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)\n        at\norg.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)\n        at\norg.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)\n        at\norg.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)\n        at\norg.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:253)\n        at org.apache.cocoon.Cocoon.process(Cocoon.java:699)\n        at org.apache.cocoon.servlet.CocoonServlet.service(CocoonServlet.java:1154)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:689)\n        at org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:427)\n        at\norg.mortbay.jetty.servlet.WebApplicationHandler.dispatch(WebApplicationHandler.java:475)\n        at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:567)\n        at org.mortbay.http.HttpContext.handle(HttpContext.java:1565)\n        at\norg.mortbay.jetty.servlet.WebApplicationContext.handle(WebApplicationContext.java:635)\n        at org.mortbay.http.HttpContext.handle(HttpContext.java:1517)\n        at\norg.mortbay.jetty.plus.PlusWebAppContext.handle(PlusWebAppContext.java:158)\n        at org.mortbay.http.HttpServer.service(HttpServer.java:954)\n        at org.mortbay.http.HttpConnection.service(HttpConnection.java:814)\n        at org.mortbay.http.HttpConnection.handleNext(HttpConnection.java:981)\n        at org.mortbay.http.HttpConnection.handle(HttpConnection.java:831)\n        at org.mortbay.http.SocketListener.handleConnection(SocketListener.java:244)\n        at org.mortbay.util.ThreadedServer.handle(ThreadedServer.java:357)\n        at org.mortbay.util.ThreadPool$PoolThread.run(ThreadPool.java:534)\n\nI believe that when it isn't null, it is for the default publication. Since I'm\nnot logged into the default publication, this is where the error is. I am unsure\nas to what is requesting permission to the default publication."}, {"count": 7, "tags": [], "creator": "rfrovarp@apache.org", "attachment_id": 19499, "text": "Created attachment 19499\nFixes permission problem when not using default publication\n\nI've removed the CSS import. This is a nice thing to have in theory, however if\nthe publication in use is not the default publication, or doesn't use the\ndefault publication's authentication, errors occur. This could be changed to\nlive. However, if the current publication uses different CSS, it wouldn't be\nimporting the correct one anyway.", "id": 98907, "time": "2007-02-02T08:49:52Z", "bug_id": 41436, "creation_time": "2007-02-02T08:49:52Z", "is_private": false}, {"count": 8, "attachment_id": 19500, "bug_id": 41436, "text": "Created attachment 19500\nFixes null pointer problem\n\nThis is one possible fix for the issue. When the function is entered, there is\nno guarantee that the value isn't null (except for the Assert), as\ngetConfigurationDirectory() may not have been called yet. This causes\ninconsistent problems with permissions and should be fixed. Perhaps the better\nfix would be to set the value in the constructor. The fact it is null after\nleaving the constructor does cause FindBugs to flag it as a potential problem.", "id": 98908, "time": "2007-02-02T08:56:57Z", "creator": "rfrovarp@apache.org", "creation_time": "2007-02-02T08:56:57Z", "tags": [], "is_private": false}, {"count": 9, "attachment_id": null, "creator": "rfrovarp@apache.org", "is_private": false, "id": 98909, "time": "2007-02-02T08:59:25Z", "bug_id": 41436, "creation_time": "2007-02-02T08:59:25Z", "tags": [], "text": "The FCKeditor patch needs to be applied and should be good as it is. The patch\nfor FileAccreditableManager is just a suggestion and other possible solutions do\nexist. These two patches combined do fix my problem."}, {"count": 10, "tags": [], "bug_id": 41436, "is_private": false, "text": "I applied both patches, but I didn't test it yet, therefore I'm leaving the bug\nopen.\n\nPlease test! :)", "id": 99437, "time": "2007-02-15T10:05:03Z", "creator": "andreas@apache.org", "creation_time": "2007-02-15T10:05:03Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 41436, "text": "Renaming Lenya 1.4 to 2.0", "id": 105493, "time": "2007-07-16T01:58:51Z", "creator": "thorsten@apache.org", "creation_time": "2007-07-16T01:58:51Z", "is_private": false, "attachment_id": null}]
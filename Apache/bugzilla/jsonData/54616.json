[{"count": 0, "tags": [], "creator": "phpfpm1@gmail.com", "text": "Hello,\n\nIn http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypassmatch it is said:\nContext:\tserver config, virtual host, directory\n\nHowever, it's not allowed to be used in directory, the following error is thrown:\nProxyPassMatch cannot occur within <Directory> section\n\nIs it a bug in documentation or Apache?", "id": 165521, "time": "2013-02-27T23:11:10Z", "bug_id": 54616, "creation_time": "2013-02-27T23:11:10Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 54616, "is_private": false, "text": "Could this bug please be fixed? Thank you. :)", "id": 166092, "time": "2013-03-22T13:41:59Z", "creator": "frank@frankmayer.net", "creation_time": "2013-03-22T13:41:59Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "r.gusar@fair-computer.de", "text": "Hello,\n\nwe have really big problem: we are using ProxyPass and <IF> - statements and since 2.4.4 that no longer works! Error message:\nProxyPass cannot occur within <IF> section\n\nI think, my problem has the same reason, so, please - fix this bug as soon as possible!\n\nThanks in advance!\n\nP.S.: In 2.4.3 always worked fine ...", "id": 166113, "time": "2013-03-23T20:34:01Z", "bug_id": 54616, "creation_time": "2013-03-23T20:34:01Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 54616, "attachment_id": null, "is_private": false, "id": 166114, "time": "2013-03-23T20:51:32Z", "creator": "covener@gmail.com", "creation_time": "2013-03-23T20:51:32Z", "text": "(In reply to comment #2)\n> Hello,\n> \n> we have really big problem: we are using ProxyPass and <IF> - statements and\n> since 2.4.4 that no longer works! Error message:\n> ProxyPass cannot occur within <IF> section\n> \n> I think, my problem has the same reason, so, please - fix this bug as soon\n> as possible!\n> \n> Thanks in advance!\n> \n> P.S.: In 2.4.3 always worked fine ...\n\nIf your problem only started in 2.4.4, I think you need a separate bug.  I think this bug has been this way for the life of 2.4.x"}, {"count": 4, "tags": [], "creator": "ubunciak@gmail.com", "text": "Guys, it's critical to use with php-fpm, it's not safe now, it's very important!", "id": 166179, "time": "2013-03-27T13:42:11Z", "bug_id": 54616, "creation_time": "2013-03-27T13:42:11Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 54616, "attachment_id": null, "is_private": false, "id": 166806, "time": "2013-04-24T09:08:37Z", "creator": "support@linuworx.com", "creation_time": "2013-04-24T09:08:37Z", "text": "any news? we have a lot of trouble with this issue"}, {"count": 6, "tags": [], "bug_id": 54616, "is_private": false, "text": "(In reply to comment #5)\n> any news? we have a lot of trouble with this issue\n\nCan you elaborate on what your configuration is and when it broke?", "id": 166815, "time": "2013-04-24T12:18:49Z", "creator": "covener@gmail.com", "creation_time": "2013-04-24T12:18:49Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 54616, "text": "Password protected directories, index pages (if it should load .html firstly, not the .php file) and some other things do not work correctly when ProxyPassMatch is outside the Directory block. \n\nFor example, the following works:\nProxyPassMatch ^/(.*\\.php(/.*)?)$ \nfcgi://127.0.0.1:9000/var/www/html/mysite.com/public_htm/$1 \n<Directory /var/www/html/mysite.com/public_html>\nOptions +Indexes +FollowSymLinks +Includes +MultiViews \n</Directory>\n\nAnd the following does not work:\n<Directory /var/www/html/mysite.com/public_html>\nOptions +Indexes +FollowSymLinks +Includes +MultiViews \nProxyPassMatch ^/(.*\\.php(/.*)?)$ \nfcgi://127.0.0.1:9000/var/www/html/mysite.com/public_htm/$1 \n</Directory>\n\nHowever, according to documentation (http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypassmatch), it should work there, however, it throws errors:\nProxyPassMatch cannot occur within <Directory> section\n\nAnother way (workaround) is to use rewrite rules, however, we use https://issues.apache.org/bugzilla/show_bug.cgi?id=54101 and for some reason RewriteRule acts differently in Directory block than outside it. If we provide:\nRewriteRule ^/(.*\\.php(/.*)?)$ fcgi://socket=\\%2fusr\\%2flocal\\%2fsockets\\%2fmysite.sock|DOCROOT|/$1 [P,E=HTTP_AUTHORIZATION:%{HTTP:Authorization},L]\n\nPlaced outside \"Directory\" it works correctly, path to the socket is /usr/local/sockets/mysite.sock\n\nIf placed in \"Directory\" block it does not work, because it thinks that the socket is placed here (that's the full path it converts to and it's incorrect, of course):\nfusrflocalfsocketsfmysite.sock\n\nSo, it's another bug of wrong RewriteRule behaviour.", "count": 7, "id": 166845, "time": "2013-04-25T10:18:10Z", "creator": "phpfpm1@gmail.com", "creation_time": "2013-04-25T10:18:10Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 54616, "text": "> However, according to documentation\n> (http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypassmatch), it\n> should work there, however, it throws errors:\n> ProxyPassMatch cannot occur within <Directory> section\n> \n\nWhen did this last work and do what you expected (accepted in directory context and successfully proxied)?  It's probably blocked from that context because it didn't work in that context when it was accepted.", "count": 8, "id": 166848, "time": "2013-04-25T11:04:56Z", "creator": "covener@gmail.com", "creation_time": "2013-04-25T11:04:56Z", "is_private": false}, {"count": 9, "tags": [], "creator": "phpfpm1@gmail.com", "attachment_id": null, "id": 166858, "time": "2013-04-25T14:12:56Z", "bug_id": 54616, "creation_time": "2013-04-25T14:12:56Z", "is_private": false, "text": "It did not work when we first tried it (about 3months ago), so I think \"directory\" should be removed from http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypassmatch, or support for it added, because now documentation is misleading. Without it, the only way to run php-fpm with unix sockets (https://issues.apache.org/bugzilla/show_bug.cgi?id=54101) would be using RewriteRule, but it doesn't work correctly too (in the previous comment it was explained), so, for now the following are true:\n* It is impossible to run PHP-FPM correctly with apache using unix domain sockets (https://issues.apache.org/bugzilla/show_bug.cgi?id=54101)\n* It is impossible to run PHP-FPM using port number correctly, unless using RewriteRule in \"Directory\" block (http://wiki.apache.org/httpd/PHP-FPM does not work, if placed in \"Directory\"\n\nPossible solutions:\n* Drop https://issues.apache.org/bugzilla/show_bug.cgi?id=54101 from apache trunk or fix the RewriteRule behavior in \"Directory\"\n* Remove \"directory\" from http://httpd.apache.org/docs/2.4/mod/mod_proxy.html#proxypassmatch, or add support for it in apache code"}, {"count": 10, "tags": [], "creator": "covener@gmail.com", "text": "The original report is resolved by making the documentation match the restriction in the code.\n\nIf anyone is interested in using ProxyPassMatch in <Directory> context,  try removing the restriction  against coding it that way in the configuration (mod_proxy.c:1390) and report back under what configurations it succeeds to actually proxy\n\n* if it works, open a new bug report\n* If it doesn't work (my suspicon) , open an enhancement ticket in bugzilla", "id": 166859, "time": "2013-04-25T14:37:06Z", "bug_id": 54616, "creation_time": "2013-04-25T14:37:06Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "text": "Created attachment 30283\nFixes RewriteRule in Directory context.", "attachment_id": 30283, "bug_id": 54616, "id": 167192, "time": "2013-05-14T10:38:48Z", "creator": "phpfpm1@gmail.com", "creation_time": "2013-05-14T10:38:48Z", "is_private": false}, {"count": 12, "tags": [], "creator": "mike.rumph@oracle.com", "attachment_id": null, "id": 167314, "time": "2013-05-21T00:57:28Z", "bug_id": 54616, "creation_time": "2013-05-21T00:57:28Z", "is_private": false, "text": "*** Bug 54965 has been marked as a duplicate of this bug. ***"}]
[{"count": 0, "attachment_id": null, "bug_id": 3132, "is_private": false, "id": 4578, "time": "2001-08-15T07:21:26Z", "creator": "carnold@houston.rr.com", "creation_time": "2001-08-15T07:21:26Z", "tags": [], "text": "When using Xalan to process the <style> command and the source file for the \ntransform contains an external entity, the build will successfully complete \nwhen Xerces.jar is in the classpath.  However if only Crimson.jar is in the \nclasspath, the build will fail with an file not found exception.  Since \nprevious versions of Ant have not distributed xerces.jar, this bug does occur \nin most deployments.\n\nDriving Xalan from the command line works successfully with either parser.\n\nThe fix to this problem will probably have to occur in the Crimson code base, \nbut I can only get it to happen within Ant so I'm reporting it here.\n\nhttp://home.houston.rr.com/curta/antcrimbug.ZIP contains examples files to \ndemonstrate the problem which also appear later in the messsage.  The problem \nis not specific to any relatively recent build of ant, crimson, xerces, or \nxalan and still occurs with the current CVS versions of each.\n\nRunning the example without Xerces.jar on the classpath:\n\nBuildfile: build.xml\n\ndom1-interfaces:\n     [echo] Xerces is available: false\n     [echo] Crimson is available: true\n    [style] Processing D:\\antcrimbug2\\wd-dom.xml to D:\\antcrimbug2\\dom1-\ninterfac\nes.xml\n    [style] Loading stylesheet D:\\antcrimbug2\\extract.xsl\n    [style] Failed to process D:\\antcrimbug2\\wd-dom.xml\n\nBUILD FAILED\n\njavax.xml.transform.TransformerException: java.io.FileNotFoundException: \\link-\ne\nntities.xml (The system cannot find the file specified)\n\n---------------\n\nRunning the example with Xerces (and Crimson) on the classpath\n\nBuildfile: build.xml\n\ndom1-interfaces:\n     [echo] Xerces is available: true\n     [echo] Crimson is available: true\n    [style] Processing D:\\antcrimbug\\wd-dom.xml to D:\\antcrimbug\\dom1-\ninterfaces\n.xml\n    [style] Loading stylesheet D:\\antcrimbug\\extract.xsl\n   [delete] Deleting: D:\\antcrimbug\\dom1-interfaces.xml\n\nBUILD SUCCESSFUL\n\n-----------------\n\nextract.xsl\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\n\t<xsl:output method=\"xml\" indent=\"yes\"/>\n\t<xsl:template match=\"/\"/>\n</xsl:stylesheet>\n\n\n----------------\n\nwd-dom.xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE spec  [\n\n<!ENTITY % links SYSTEM \"link-entities.xml\">\n%links;\n\n]>\n\n<spec/>\n\n\n--------------\n\nlink-entities.xml\n\n<!ENTITY javaidl      \"http://java.sun.com/products/jdk/preview/docs/ext/idl/\">\n<!ENTITY omg          \"http://www.omg.org/\">\n<!ENTITY msidl        \"http://premium.microsoft.com/msdn/library/sdkdoc/mi-\nlaref_49v0.htm\">\n<!ENTITY html-3.2     \"http://www.w3.org/TR/REC-html32\">\n<!ENTITY html-4.0     \"http://www.w3.org/TR/REC-html40\">\n<!ENTITY ecma-262     \"http://www.ecma.ch/stand/ecma-262.htm\">\n<!ENTITY \njavascript   \"http://developer.netscape.com/one/javascript/resources.html\">\n<!ENTITY xml-spec     \"http://www.w3.org/TR/REC-xml\">\n<!ENTITY corba        \"http://www.omg.org/corba/corbiiop.htm\">\n\n\n-----------\n\n\nbuild.xml\n\n<?xml version=\"1.0\"?>\n<project default=\"dom1-interfaces\" basedir=\".\">\n\n\n<target name=\"dom1-interfaces\">\n    <property name=\"hasXerces\" value=\"false\"/>\n    <available classname=\"org.apache.xerces.parsers.SAXParser\" \nproperty=\"hasXerces\"/>\n    <echo message=\"Xerces is available: ${hasXerces}\"/>\n    <property name=\"hasCrimson\" value=\"false\"/>\n    <available classname=\"org.apache.crimson.parser.XmlReader\" \nproperty=\"hasCrimson\"/>\n    <echo message=\"Crimson is available: ${hasCrimson}\"/>\n\t<style basedir=\".\"\n\t       in=\"wd-dom.xml\"\n\t       out=\"dom1-interfaces.xml\"\n\t       style=\"extract.xsl\"/>\n    <delete file=\"dom1-interfaces.xml\"/>\n</target>\n\n\n</project>"}, {"count": 1, "tags": [], "creator": "sbailliez@apache.org", "attachment_id": null, "id": 4596, "time": "2001-08-16T00:43:00Z", "bug_id": 3132, "creation_time": "2001-08-16T00:43:00Z", "is_private": false, "text": "First, thanks for the detailed description and testcase !\n\nI recently added a similar testcase due to the latest modifications on liaison \nbut it was not failing because I had xerces in the classpath...\n\nUnfortunately it seems as you mentionned to be a crimson issue. It does not \nwork either with the latest crimson in cvs.\n\nI'm able to make it work when using file:./ in the entity, ie:\n\n<!ENTITY % links SYSTEM \"file:./link-entities.xml\">\n\nWorks with both xerces and crimson.\n\nI will see with the main developer on crimson to see how to track down this one."}, {"count": 2, "tags": [], "text": "I quickly looked at the crimson source code and found the problem.\nIt does not handle \\'ed paths and expects only /'ed path which is not abnormal \nanyway. It is getting the base uri by doing a systemid.lastIndexOf('/'), thus \nwith Windows path, it was getting only \"file:///\" of course failed to find the \nfile.\n\nI fixed the problem in Ant so that systemids are always /'ed and notified \ncrimson dev about this.\n\nThe fix should hopefully be in Ant 1.4beta2 to be built today, otherwise the \nfix is in CVS (ANT_14_BRANCH)", "attachment_id": null, "id": 4599, "creator": "sbailliez@apache.org", "time": "2001-08-16T03:01:16Z", "bug_id": 3132, "creation_time": "2001-08-16T03:01:16Z", "is_private": false}]
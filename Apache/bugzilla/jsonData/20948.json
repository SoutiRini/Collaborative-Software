[{"count": 0, "tags": [], "text": "Hi folks,\n\nI revealed a smart bug in the parsing strategy of JSP. I'm using\nTomcat 4.1.12 on Windows ME environment.\nThere is a problem when using a Java comment \"//\" followed by \"%>\",\nthe end token of Java embedded JSP.\n\n\t<%\n\tif (...)\n\t{\n\t\t...\n\t} // endif %>\n\t</TABLE></FORM></BODY></HTML>\n\nThis would result in the JSP' servlet code:\n\n\t} // endif      out.write(\"\\n\\t</TABLE></FORM></BODY></HTML>\");\n\nThe servlet execution result is, that the complete out.write() is not executed.\nThus, all the HTML tags are missing.\nThe Java line comment has to be overruled by the JSP end token\nso that the Java line comment ends there!\nOtherwise everything which is combined together in the following out.write()\nstatement remains comment (so substantial Java code is likely to disappear).\n\n\nMore detailed Example:\nJSP (it is indeed dynamic JavaScript):\n\n   function FieldPageBack()\n   {\n      FieldOffset = FieldOffset - 1;\n      <%= (AdmList.getPageType() == AdmList.c_ListDelEntry)?\n         \"setAttrClassReadOnlyValues(FieldOffset);\" : \"setAttrClassSelectIndex\n(FieldOffset);\" %>\n   <% for (int i = 0; i < AdmList.c_FieldsToDisplay; i++) { %>\n         FieldNo[<%= i %>].innerHTML = (FieldOffset + <%= i %>) + \".\";\n   <% } // endfor %>\n   }\n   function FieldPageForward()\n   {\n      FieldOffset = FieldOffset + 1;\n      <%= (AdmList.getPageType() == AdmList.c_ListDelEntry)?\n         \"setAttrClassReadOnlyValues(FieldOffset);\" : \"setAttrClassSelectIndex\n(FieldOffset);\" %>\n   <% for (int i = 0; i < AdmList.c_FieldsToDisplay; i++) { %>\n         FieldNo[<%= i %>].innerHTML = (FieldOffset + <%= i %>) + \".\";\n   <% } // endfor %>\n   }\n\nJSP-generated Servlet:\n\n      out.write(\"\\nfunction FieldPageBack()\\n{\\n\\tFieldOffset = FieldOffset - \n1;\\n\\t\");\n      out.print( (AdmList.getPageType() == AdmList.c_ListDelEntry)?\n\t\t\"setAttrClassReadOnlyValues\n(FieldOffset);\" : \"setAttrClassSelectIndex(FieldOffset);\" );\n      out.write(\"\\n\");\n for (int i = 0; i < AdmList.c_FieldsToDisplay; i++) {       out.write\n(\"\\n\\tFieldNo[\");\n      out.print( i );\n      out.write(\"].innerHTML = (FieldOffset + \");\n      out.print( i );\n      out.write(\") + \\\".\\\";\\n\");\n } // endfor       out.write(\"\\n}\\nfunction FieldPageForward()\\n\n{\\n\\tFieldOffset = FieldOffset - 1;\\n\\t\");\n      out.print( (AdmList.getPageType() == AdmList.c_ListDelEntry)?\n\t\t\"setAttrClassReadOnlyValues\n(FieldOffset);\" : \"setAttrClassSelectIndex(FieldOffset);\" );\n      out.write(\"\\n\");\n for (int i = 0; i < AdmList.c_FieldsToDisplay; i++) {       out.write\n(\"\\n\\tFieldNo[\");\n      out.print( i );\n      out.write(\"].innerHTML = (FieldOffset + \");\n      out.print( i );\n      out.write(\") + \\\".\\\";\\n\");\n } // endfor       out.write(\"\\n}\\n\");\n\n\nBest regards,\nJohannes", "attachment_id": null, "bug_id": 20948, "id": 39157, "time": "2003-06-20T11:52:09Z", "creator": "JBStonehenge@aol.com", "creation_time": "2003-06-20T11:52:09Z", "is_private": false}, {"count": 1, "tags": [], "creator": "funkman@joedog.org", "is_private": false, "id": 39158, "attachment_id": null, "bug_id": 20948, "creation_time": "2003-06-20T12:00:58Z", "time": "2003-06-20T12:00:58Z", "text": "Similar to http://nagoya.apache.org/bugzilla/show_bug.cgi?id=6552\n\"The parser does not know about java comments.\"\n\nUsing // comments in a jsp is dangerous. As are \"if\" statements without {}"}]
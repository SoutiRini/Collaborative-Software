[{"count": 0, "attachment_id": null, "bug_id": 41505, "text": "Under extreme concurrent load, we encounter a strange behavior for the date\nformatting using Log4J.\nWhen we stress our application, date formatting corruption occurs randomly (very\nfew in fact regarding the number of logs we generate). For the same thread, it\nsometimes happens that a log statement has a timestamp shift of exactly 1 second.\n\nFor example, here are 3 ordered statements for the same thread. The one in the\nmiddle has a date corruption :\n[Servlet.Engine.Transports : 1115|2006-12-12 07:09:55,874|...\n[Servlet.Engine.Transports : 1115|2006-12-12 07:09:56,874|...\n[Servlet.Engine.Transports : 1115|2006-12-12 07:09:55,874|...\n\nThe pattern layout user for this file appender is : %p|%t|%d|%m%n\n\nThe problem seems to come from the class\norg.apache.log4j.helpers.ISO8601DateFormat which is used by default with this\ndate pattern (%d). It contains an algorithm which tries to optimize the\ntimestamp generation based on a per second time frame in its method format(Date,\nStringBuffer, FieldPosition).\n\nWe managed to find a workaround for this bug by forcing log4j to use another\ndate formatter (SimpleDateFormat from the JDK), by changing the pattern layout\nof our appender : %p|%t|%d{yyyy-MM-dd HH:mm:ss,SSS}|%m%n\n\nBy the way, I also saw that the ISO8601DateFormat has been discarded from the\nnext version of Log4J v1.3, replaced by SimpleDateFormat... But as the v1.3 is\nstill in beta, we could not use it in production.\n\n-\n\nLog4j v1.2.14\nJDK IBM 1.4.2 - IBM Websphere Application Server 5.1.1 (cf.12)\nWindows Server 2003", "id": 98825, "time": "2007-01-31T01:30:11Z", "creator": "gifsec-java@yahoo.fr", "creation_time": "2007-01-31T01:30:11Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "carnold@apache.org", "text": "The log4j 1.3 PatternLayout has been backported for use with log4j 1.2 in the extras companion as \norg.apache.log4j.EnhancedPatternLayout.  I believe that the problem you are seeing is resolved in it.  It \nshould be released shortly and would appreciate any feedback.", "id": 106992, "time": "2007-08-21T15:13:23Z", "bug_id": 41505, "creation_time": "2007-08-21T15:13:23Z", "is_private": false, "attachment_id": null}]
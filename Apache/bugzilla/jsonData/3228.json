[{"count": 0, "tags": [], "bug_id": 3228, "attachment_id": null, "text": "When attempting to validate the following simple xml document using the \nSAXParser object:\n\n<?xml version = \"1.0\" encoding = \"UTF-8\"?>\n<Voice xmlns = \"http://adwuk007/XMLSchema/Test\"\n\t   xmlns:xsi = \"http://www.w3.org/2001/XMLSchema-instance\" \n       xsi:schemaLocation = \"http://adwuk007/XMLSchema/Test \nhttp://adwuk007/XMLSchema/Test.xsd\"\n       countryCode = \"44\" areaCode = \"0118\" number = \"9387028\"/>\n\nUsing this simple schema:\n\n<?xml version = \"1.0\" encoding = \"UTF-8\"?>\n<xsd:schema xmlns = \"http://adwuk007/XMLSchema/Test\"\n\t    xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\n\t    targetNamespace = \"http://adwuk007/XMLSchema/Test\"\n\t    version = \"5.0\"\n\t    elementFormDefault = \"unqualified\"\n\t    attributeFormDefault = \"unqualified\">\n\t<xsd:attribute name = \"countryCode\" type = \"xsd:nonNegativeInteger\"/>\n\t<xsd:attribute name = \"areaCode\" type = \"xsd:nonNegativeInteger\"/>\n\t<xsd:attribute name = \"number\" type = \"xsd:nonNegativeInteger\"/>\n\n\t<xsd:attributeGroup name = \"PhoneNumber\">\n\t\t<xsd:attribute ref = \"countryCode\" use = \"required\"/>\n\t\t<xsd:attribute ref = \"areaCode\" use = \"required\"/>\n\t\t<xsd:attribute ref = \"number\" use = \"required\"/>\n\t</xsd:attributeGroup>\n\t<xsd:element name = \"Voice\">\n\t\t<xsd:complexType>\n\t\t\t<xsd:attributeGroup ref = \"PhoneNumber\"/>\n\t\t\t<xsd:attribute name = \"leaveMessage\" type \n= \"xsd:boolean\" default = \"false\"/>\n\t\t</xsd:complexType>\n\t</xsd:element>\n</xsd:schema>\n\nThe following errors are reported (using my own ErrorHandler):\n\n------------------------------------------------------------\n\nERROR\t: Attribute \"countryCode\" is required and must be specified for element \ntype \"Voice\".\n\nLINE\t: 5\n\nCOLUMN\t: 65\n\n------------------------------------------------------------\n\nERROR\t: Attribute \"areaCode\" is required and must be specified for element \ntype \"Voice\".\n\nLINE\t: 5\n\nCOLUMN\t: 65\n\n------------------------------------------------------------\n\nERROR\t: Attribute \"number\" is required and must be specified for element \ntype \"Voice\".\n\nLINE\t: 5\n\nCOLUMN\t: 65\n\n------------------------------------------------------------\n\nERROR\t: Attribute \"countryCode\" must be declared for element type \"Voice\".\n\nLINE\t: 5\n\nCOLUMN\t: 65\n\n------------------------------------------------------------\n\nERROR\t: Attribute \"areaCode\" must be declared for element type \"Voice\".\n\nLINE\t: 5\n\nCOLUMN\t: 65\n\n------------------------------------------------------------\n\nERROR\t: Attribute \"number\" must be declared for element type \"Voice\".\n\nLINE\t: 5\n\nCOLUMN\t: 65\n\nI've checked the schema using IBMs schema quality checking utility and it finds \nno errors. I've also loaded the schema into TIBCOs XML Authority without \nproblems. I'm using the TogetherSofts Together product to compile and execute \nthe routine. Here's the source code I'm using:\n\nimport org.apache.xerces.parsers.SAXParser;\n\nimport org.xml.sax.InputSource;\nimport org.xml.sax.SAXParseException;\nimport org.xml.sax.SAXException;\nimport org.xml.sax.SAXNotRecognizedException;\n\nimport java.io.IOException;\nimport java.lang.Exception;\n\n\n/**\n * Title:        XMLValidator.java\n * Description:  SAX Schema Validation\n * Date: \t\t 20 August 2001\n * Copyright:    Copyright (c) 2001\n * Company:      Adeptra\n * @author       James Kavanagh/Dan Macfarlane\n * @version      1.0\n */\n\npublic class XMLValidator {\n\n\tpublic static void main(String [] args){\n\n    String     file     = args[0];\n\n    System.out.println(\"Attempting to parse document : \" + args[0].toString());\n\n    try {\n\t\tSAXParser parser  = new SAXParser();\n        parser.setFeature(\"http://xml.org/sax/features/validation\", true);\n        parser.setFeature(\"http://apache.org/xml/features/validation/schema\", \ntrue);\n\t\tparser.setFeature\n(\"http://apache.org/xml/features/validation/schema-full-checking\", true);\n        parser.setFeature(\"http://apache.org/xml/features/validation/warn-on-\nundeclared-elemdef\", true);\n\n        parser.setErrorHandler(new MySaxErrorHandler());\n\n      \tInputSource in2 =  new InputSource(args[0]);\n\n      \tparser.parse(in2);\n\n        System.out.println(\"XML Parsed successfully\");\n\n    }\n    catch (SAXNotRecognizedException snre) {\n      System.out.println(\"SaxNotRecognizedException : \" + snre.getMessage());\n    }\n    catch (SAXParseException spe) {\n      System.out.println(\"SaxParseException : \" + spe.getMessage());\n    }\n\t catch (SAXException se) {\n      System.out.println(\"IOException : \" + se.getMessage());\n\t }\n\t catch (IOException ioe) {\n      System.out.println(\"IOException : \" + ioe.getMessage());\n\t }\n\n  }\n\n}\n\nRegards,\nJames Kavanagh", "id": 4731, "time": "2001-08-22T08:16:54Z", "creator": "jkavanagh@adeptra.com", "creation_time": "2001-08-22T08:16:54Z", "is_private": false}, {"count": 1, "tags": [], "creator": "irr@decisionsoft.com", "attachment_id": null, "id": 4732, "time": "2001-08-22T09:27:12Z", "bug_id": 3228, "creation_time": "2001-08-22T09:27:12Z", "is_private": false, "text": "Your schema declares the attributes into the http://adwuk007/XMLSchema/Test\nnamespace, but your instance document has them in no namespace.  If you change\nthe document to use a prefix for the http://adwuk007/XMLSchema/Test namespace\nand prefix the attributes then the document will validate.\n"}, {"count": 2, "attachment_id": null, "creator": "jkavanagh@adeptra.com", "text": "Thanks for your swift response.\nI've reviewed your comments and proposed resolution however the schema includes \nthe attributeFormDefault attribute in the schema which is set to \"unqualified\". \nThis means I shouldn't have to prefix attributes. I have to declare a non-\nprefixed namespace in the schema otherwise the schema is invalid.\n\nIf I change the schema to the following, removing the reusable attribute group, \nthen the document validates. I think this clearly shows that re-usable \nattribute groups are not being evaluated correctly.\n\n\n<?xml version = \"1.0\" encoding = \"UTF-8\"?>\n<xsd:schema xmlns = \"http://adwuk007/XMLSchema/Test\" \n\t    xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\n\t    targetNamespace = \"http://adwuk007/XMLSchema/Test\"\n\t    version = \"5.0\"\n\t    elementFormDefault = \"unqualified\"\n\t    attributeFormDefault = \"unqualified\">\n\n\n\t<xsd:element name = \"Voice\">\n\t\t<xsd:complexType>\n\t\t\t<xsd:attribute name = \"countryCode\" type \n= \"xsd:nonNegativeInteger\" use = \"required\"/>\n\t\t\t<xsd:attribute name = \"areaCode\" type \n= \"xsd:nonNegativeInteger\" use = \"required\"/>\n\t\t\t<xsd:attribute name = \"number\" type \n= \"xsd:nonNegativeInteger\" use = \"required\"/>\n\t\t\t<xsd:attribute name = \"leaveMessage\" type \n= \"xsd:boolean\" default = \"false\"/>\n\t\t</xsd:complexType>\n\t</xsd:element>\n</xsd:schema>\n", "id": 4767, "time": "2001-08-23T01:50:46Z", "bug_id": 3228, "creation_time": "2001-08-23T01:50:46Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "sandygao@ca.ibm.com", "attachment_id": null, "id": 4770, "time": "2001-08-23T07:44:00Z", "bug_id": 3228, "creation_time": "2001-08-23T07:44:00Z", "is_private": false, "text": "Hi. \"attributeFormDefault\" only affects locally declared attributs. Globally \ndeclared attributes are always qualified, that is, they are always declared in \nthe target namespace."}, {"count": 4, "tags": [], "bug_id": 3228, "attachment_id": null, "text": "James, please visit http://www.w3.org/TR/xmlschema-0/#QualLocals\n\nIt says \"Attributes that must be qualified, either because they are declared\nglobally or because the attributeFormDefault attribute is set to qualified\"\n\nYour XSD is declaring global attributes with attributeFormDefault=\"unqualified\",\nwhich means globally declare attibutes has to qualify namespace.It is true for\nelementFormDefault also.\n\nHope this help.", "id": 4771, "time": "2001-08-23T07:50:51Z", "creator": "gopal.sharma@sun.com", "creation_time": "2001-08-23T07:50:51Z", "is_private": false}]
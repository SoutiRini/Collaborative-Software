[{"count": 0, "tags": [], "bug_id": 11903, "text": "PROBLEM DESCRIPTION:\n====================\n    Performing two occurances of the ant core task \"jar\" results in an \n    exception at the end of the second jar task/target:\n        java.lang.NullPointerException\n\t  at org.apache.tools.zip.ZipOutputStream.finish\n            (ZipOutputStream.java(Compiled Code))\n\t  at java.util.zip.DeflaterOutputStream.close\n            (DeflaterOutputStream.java:139)\n\t  at org.apache.tools.ant.taskdefs.Zip.execute\n            (Zip.java:402)\n\t  at org.apache.tools.ant.Task.perform\n            (Task.java:317)\n\t  at org.apache.tools.ant.Target.execute\n            (Target.java:309)\n\t  at org.apache.tools.ant.Target.performTasks\n            (Target.java:334)\n\t  at org.apache.tools.ant.Project.executeTarget\n            (Project.java:1306)\n\t  at org.apache.tools.ant.Project.executeTargets\n            (Project.java:1250)\n\t  at org.apache.tools.ant.Main.runBuild\n            (Main.java:610)\n\t  at org.apache.tools.ant.Main.start\n            (Main.java:196)\n\t  at org.apache.tools.ant.Main.main\n            (Main.java:235)\n\nNOTES:\n=============\n    o This problem can be reproduced with ant 1.5 (July 9, 2002) and \n      ant 1.6 (August 19, 2002).\n\n    o This problem does not occur with ant 1.4 (September 3, 2001).\n\n    o  This problem does not occur if the jar task is performed only once.\n\n    o This problem also occurs when calling the \"zip\" target multiple times.\n\nSTEPS TO REPRODUCE:\n===================\n\n    Test Preparation:\n    1. Install ant 1.5.\n    2. Create a directory named \"antstuff\".\n    3. Copy the build.xml sample below into a file named \"antstuff\\build.xml\".\n    4. Copy the ant.properties sample below to a file named\n       \"antstuff\\ant.properties\"\n    5. Create a directory named \"antstuff\\jars\"\n    6. Copy in to the \"antstuff\\jars\" directory several jar files.\n\n    Test Run:\n    Failure:\n    1. Open an MS-DOS command window.\n    2. \"cd\" to the \"antstuff\" directory.\n    3. Type the following into the MS-DOS command window:\n       ant -debug -logfile antlog1.5_debug.log <enter>\n    4. Allow the command to complete.\n    5. Open the \"antlog1.5_debug.log\" file and note that the end of the file\n       contains the exception.\n    Success(1):\n    6. Edit the antstuff\\build.xml file and remove one of the dependent \n       targets in the \"exceptions\" target.\n    7. Save this change.\n    8. Repeat steps 1-4 above substituting \"ant1.5a_debug.log\" for the \n       logfile name. \n    9. Open the \"antlog1.5a_debug.log\" file and note that the script \n       ran successfully to completion.\n    Success(2):\n    10. Uninstall ant 1.5.\n    11. Install ant 1.4.\n    12. Restore the build.xml \"exeception\" target's depends list\n        to \"combine_jars,create_new_jar\".\n    13. Save this change.\n    12. Repeat steps 1-4 above substituting \"ant1.4_debug.log\" for the \n        logfile name. \n    9. Open the \"antlog1.4_debug.log\" file and note that the script \n       ran successfully to completion.\n\nSAMPLE TEST FILES:\n==================\n\nbuild.xml:\n----------\n\n<project name=\"zip_jar_test\" default=\"exceptions\" basedir=\".\">\n  <property file=\"C:\\antstuff\\ant.properties\"/>\n  <target name=\"combine_jars\">\n    <!-- Create a temporary directory -->\n    <mkdir dir=\"\\temp\\combined_jars\"/>\n\n    <!-- Unjar the specified jar files into the temporary directory:       -->\n    <unjar src=\"${xmlapis}\" dest=\"\\temp\\combined_jars\"/>\n    <unjar src=\"${optional}\" dest=\"\\temp\\combined_jars\"/>\n    <unjar src=\"${xercesimpl}\" dest=\"\\temp\\combined_jars\"/>\n    <unjar src=\"${ant}\" dest=\"\\temp\\combined_jars\"/>\n\n    <!-- delete the manifest, stubs and ties files from the temp directory -->\n    <delete dir=\"\\temp\\combined_jars\\META-INF\"/>\n\n    <!-- Create the combined jar file of all files in the temp directory   -->\n    <jar jarfile=\"jar1.jar\" basedir=\"\\temp\\combined_jars\"/>\n  </target>\n\n  <target name=\"create_new_jar\">\n    <mkdir dir=\"D:\\junk\"/>\n    <delete dir=\"D:\\junk\"/>\n    <jar jarfile=\"jar2.jar\" basedir=\"d:\\temp\"/>\n  </target>\n\n  <target name=\"exceptions\" depends=\"combine_jars,create_new_jar\"/>\n\n</project>\n\n\n\n\n\n\n\nant.properties\n--------------\njar.dir=C:\nxmlapis=${jar.dir}\\\\antstuff\\\\jars\\\\xml-apis.jar\noptional=${jar.dir}\\\\antstuff\\\\jars\\\\optional.jar\nxercesimpl=${jar.dir}\\\\antstuff\\\\jars\\\\xercesImpl.jar\nant=${jar.dir}\\\\antstuff\\\\jars\\\\ant.jar", "id": 21488, "time": "2002-08-21T16:42:26Z", "creator": "dschiff@us.ibm.com", "creation_time": "2002-08-21T16:42:26Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 11903, "text": "I encountered the NullPointerException on ZipOutputStream.finish when using the \nzip-task and in some cases (when using zipfilesets) the jar-task in Ant 1.5 (did \nnot happen in 1.4.1 with the same buildfile). Strangely it only appeared on \nLinux (RH 7.2) using IBM JSDK 1.3.0 but not on Windows 98 SE (using Sun JSDK \n1.3.0). Like said I never encountered this issue in 1.4.1.\n\nExample output for Linux:\n\n      [zip] Building zip: \n/home/just/build/cvs/xbook/justobjects/versions/xbook/xbook-1.1.13.zip\n\nBUILD FAILED\njava.lang.NullPointerException\n        at \norg.apache.tools.zip.ZipOutputStream.finish(ZipOutputStream.java(Compiled Code))\n        at \njava.util.zip.DeflaterOutputStream.close(DeflaterOutputStream.java:139)\n        at org.apache.tools.ant.taskdefs.Zip.execute(Zip.java:402)\n        at org.apache.tools.ant.Task.perform(Task.java:317)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:334)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1306)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1250)\n        at org.apache.tools.ant.Main.runBuild(Main.java:610)\n        at org.apache.tools.ant.Main.start(Main.java:196)\n        at org.apache.tools.ant.Main.main(Main.java:235)", "count": 1, "id": 21600, "time": "2002-08-23T13:53:18Z", "creator": "just@justobjects.nl", "creation_time": "2002-08-23T13:53:18Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 11903, "text": "Seems there is a bug in IBM's jit or a bug in ant exposed by IBM's jit\n\nI can reproduce it reliably wih ant 1.5 & IBM's latest 1.3.0 jvm on Red Hat 7.3,\nbut *not* so far without the jit (JAVA_COMPILER=NONE)\n\nant 1.4 is fine", "id": 21797, "time": "2002-08-27T13:44:08Z", "creator": "nicolas.mailhot@one2team.com", "creation_time": "2002-08-27T13:44:08Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 11903, "is_private": false, "text": "*** Bug 11550 has been marked as a duplicate of this bug. ***", "id": 21799, "time": "2002-08-27T13:55:55Z", "creator": "nicolas.mailhot@one2team.com", "creation_time": "2002-08-27T13:55:55Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "dzrobok@ca.ibm.com", "is_private": false, "count": 4, "id": 21805, "time": "2002-08-27T14:28:59Z", "bug_id": 11903, "creation_time": "2002-08-27T14:28:59Z", "text": "I had this problem yesterday and while discussing it with my collegue, \nwe remembered that IBM JDK 1.3.0 had the exact same problem of throwing\nNPE's when dealing with Zips. \n\nWhen I checked my JAVA_HOME, sure enough it was pointing to 1.3.0. Once\nthe JDK was upgraded to 1.3.1, then the problem and the zip files are\ncreated successfully.\n\nI don't know if this defect should remain open (since it is being reported that\nant 1.4.1 worked) but a successful workaround is to upgrade IBM JDK's to \n1.3.1 \n\n"}, {"count": 5, "tags": [], "bug_id": 11903, "text": "David, can you confirm your JDK please ?", "id": 21863, "time": "2002-08-27T23:01:11Z", "creator": "sbailliez@apache.org", "creation_time": "2002-08-27T23:01:11Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "dschiff@us.ibm.com", "attachment_id": null, "text": "The JDK that is being used is IBM's JDK - 1.2.2 (cn122-20001026b).  The machine \nwill be updated to IBM's JDK 1.3.1 within the week and the test re-performed.  \nThe results of the test will be noted here.", "id": 21884, "time": "2002-08-28T10:10:47Z", "bug_id": 11903, "creation_time": "2002-08-28T10:10:47Z", "is_private": false}, {"count": 7, "tags": [], "text": "I think all the reports here as well as those on the mailing lists indicate it\nis a bug in IBM's JIT that has been fixed in IBM's JDK 1.3.1 - and that is\ntriggered by Ant in some way.\n\nNot an Ant bug, workaround is to upgrade the JDK or turn of the JIT.", "is_private": false, "bug_id": 11903, "id": 23372, "time": "2002-09-25T16:39:38Z", "creator": "bodewig@apache.org", "creation_time": "2002-09-25T16:39:38Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "is_private": false, "id": 26370, "time": "2002-11-15T13:34:14Z", "bug_id": 11903, "creation_time": "2002-11-15T13:34:14Z", "text": "*** Bug 13348 has been marked as a duplicate of this bug. ***"}, {"count": 9, "tags": [], "bug_id": 11903, "text": "*** Bug 15325 has been marked as a duplicate of this bug. ***", "id": 27835, "time": "2002-12-14T19:07:57Z", "creator": "bill.stamp@eds.com", "creation_time": "2002-12-14T19:07:57Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "antoine@apache.org", "is_private": false, "id": 44313, "attachment_id": null, "bug_id": 11903, "creation_time": "2003-09-18T19:26:57Z", "time": "2003-09-18T19:26:57Z", "text": "*** Bug 23257 has been marked as a duplicate of this bug. ***"}]
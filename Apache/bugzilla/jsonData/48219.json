[{"text": "It appears that when mod_proxy_balancer is retrying to sent a request to the same worker it drops the POST data and adds itself again to the relevant x-forwarded headers:\n\n\nfirst request (has been modified for security reasons):\n[18 Nov 2009 12:16:30,683]\nPOST /integration-server/terminals/2/103/transactions HTTP/1.0\nHost: a.tyro.com\nUser-Agent: changed\nAccept: */*\nContent-Type: application/x-www-form-urlencoded\nExpect: 100-continue\nX-Forwarded-For: A.B.C.D\nX-Forwarded-Host: a.tyro.com\nX-Forwarded-Server: a.tyro.com\nContent-Length: 154\n\n\nsecond request (has been modified for security reasons):\n[18 Nov 2009 12:16:30,690]\nPOST /integration-server/terminals/2/103/transactions HTTP/1.0\nHost: a.tyro.com\nUser-Agent: changed\nAccept: */*\nContent-Type: application/x-www-form-urlencoded\nExpect: 100-continue\nX-Forwarded-For: 59.167.235.179, 59.167.235.179\nX-Forwarded-Host: a.tyro.com, a.tyro.com\nX-Forwarded-Server: a.tyro.com, a.tyro.com\nContent-Length: 0\n\nThis is a reproducible behaviour. Does that make sense to anyone who knows the code? \n\nAlso just to confuse me a little bit more: Our application servers responded with a 503 and it looked like the balancer is retrying the connection instead of passing this on to the client? I did some reading and thought that the balancer only considers a connection problem to the worker a failover reason?\n\nOur configuration is:\n[...] \n  SetEnv          force-proxy-request-1.0        1\n        SetEnv          proxy-nokeepalive              1\n        <Proxy balancer://integrationwebapp>\n                BalancerMember http://webapp-1:8008 retry=60\n                BalancerMember http://webapp-2:8008 status=+H\n                ProxySet lbmethod=bytraffic\n        </Proxy> \n[...]\n\n//sascha", "tags": [], "bug_id": 48219, "is_private": false, "count": 0, "id": 132073, "time": "2009-11-17T22:05:32Z", "creator": "ops@tyro.com", "creation_time": "2009-11-17T22:05:32Z", "attachment_id": null}]
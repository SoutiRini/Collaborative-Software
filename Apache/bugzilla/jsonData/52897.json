[{"count": 0, "tags": [], "bug_id": 52897, "text": "Created attachment 28459\nPatched HTTPHC4Impl.java to workaround NullPointerException in content-encoding.\n\nMy service accepts an HTTP PUT request with file contents as the body and returns a 201: created when the file upload is successful. Here is how I test it with cURL:\n\ncurl -u testuser:testpass \"http://localhost:8080/photo\" -T photo.jpg -H \"content-type:image/jpeg\"\n\nAccording to the documentation I should be able to do this by specifying a file path with no name and no other parameters. It seems like the content encoding is retrieved in this situation, but not set (even if it's available), resulting in a NullPointerException: \n\njava.lang.NullPointerException: charsetName at java.lang.String.<init>(Unknown Source) at java.lang.String.<init>(Unknown Source) at org.apache.jmeter.protocol.http.sampler.HTTPHC4Impl.sendPutData(HTTPHC4Impl.java:1067) at org.apache.jmeter.protocol.http.sampler.HTTPHC4Impl.sample(HTTPHC4Impl.java:274) at org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:62) at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1054) at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1043) at org.apache.jmeter.threads.JMeterThread.process_sampler(JMeterThread.java:416) at org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:271) at java.lang.Thread.run(Unknown Source)\n\nI checked out the code and did some digging. To work around this I specified the content-encoding if it's available (copy/pasted from where truncated parameter bodies are handled) and set the encoding in my test. Attached is a patch of what I did.\n\nI'm not sure if this is a fix or a workaround though. The real issue *might* be that it's always expecting a content encoding for all HTTP PUT (and POST as far as I can see) requests. I leave that for you to decide.\n\nThanks for your consideration,\n\nJoe", "id": 154873, "time": "2012-03-13T14:19:34Z", "creator": "joemcc@ll86.net", "creation_time": "2012-03-13T14:19:34Z", "is_private": false, "attachment_id": 28459}, {"count": 1, "tags": [], "bug_id": 52897, "text": "Hello,\nCan you attach your test plan please ?\n\nThanks\nRegards\nPhilippe", "id": 154888, "time": "2012-03-13T22:05:32Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-03-13T22:05:32Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 52897, "text": "Created attachment 28463\nTest plan to reproduce issue", "id": 154889, "time": "2012-03-13T22:35:28Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-03-13T22:35:28Z", "is_private": false, "attachment_id": 28463}, {"count": 3, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "Date: Tue Mar 13 22:34:59 2012\nNew Revision: 1300387\n\nURL: http://svn.apache.org/viewvc?rev=1300387&view=rev\nLog:\nBug 52897 - HTTPSampler : Using PUT method with HTTPClient4 and empty Content Encoding and sending files leads to NullPointerException\n\nModified:\n   jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n   jmeter/trunk/xdocs/changes.xml", "id": 154890, "time": "2012-03-13T22:36:22Z", "bug_id": 52897, "creation_time": "2012-03-13T22:36:22Z", "is_private": false}, {"count": 4, "tags": [], "text": "Thanks for report and patch although it was not fully applied.", "attachment_id": null, "id": 154891, "creator": "p.mouawad@ubik-ingenierie.com", "time": "2012-03-13T22:37:06Z", "bug_id": 52897, "creation_time": "2012-03-13T22:37:06Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "http://tomcat.apache.org/tomcat-5.5-doc/monitoring.html states:\n\n  Note:The JSR 160 JMX-Adaptor opens a second data protocol port. That is a\nproblem when you have installed a local firewall.\n\nThis can be fixed by using a custom JMXConnectorServer to control both\nports thus allowing firewall access.\n\nEg. This is a GLP I threw together to try it out:\n\npublic class JMXPortServer extends HttpServlet {\n  static JMXConnectorServer cs;\n  static String jmxHost;\n  static {\n    try {\n      final InetAddress host = InetAddress.getLocalHost();\n      jmxHost = host.getHostName();\n      final int jmxPort =\nInteger.parseInt(System.getProperty(\"org.jasig.portal.jmxPort\"));\n      final int jmxPort2 = jmxPort + 1;\n\n      LocateRegistry.createRegistry(jmxPort);\n      System.err.println(\"getPlatformMBeanServer()\");\n      MBeanServer mbs = ManagementFactory.getPlatformMBeanServer();\n\n      HashMap env = new HashMap();\n      final String sslProperty = \"com.sun.management.jmxremote.ssl\";\n      String value = System.getProperty(sslProperty);\n      if (Boolean.getBoolean(value)) {\n        SslRMIClientSocketFactory csf = new SslRMIClientSocketFactory();\n        SslRMIServerSocketFactory ssf = new SslRMIServerSocketFactory();\n        env.put(RMIConnectorServer.RMI_CLIENT_SOCKET_FACTORY_ATTRIBUTE, csf);\n        env.put(RMIConnectorServer.RMI_SERVER_SOCKET_FACTORY_ATTRIBUTE, ssf);\n      }\n\n      final String passwordFileProperty =\n\"com.sun.management.jmxremote.password.file\";\n      value = System.getProperty(passwordFileProperty);\n      if (value != null) {\n        env.put(\"jmx.remote.x.password.file\", value);\n      }\n\n      final String jmxUrl = \"service:jmx:rmi://\" + jmxHost + \":\" + jmxPort2\n+\"/jndi/rmi://\" + jmxHost + \":\" + jmxPort + \"/server\";\n      final JMXServiceURL url = new JMXServiceURL(jmxUrl);\n      cs = JMXConnectorServerFactory.newJMXConnectorServer(\n          url, env, mbs);\n\n      try {\n        cs.start();\n        LogService.log(LogService.INFO, \"JMXPrtServer started on \" + jmxUrl);\n      } catch (IOException ex) {\n        LogService.log(LogService.ERROR, ex);\n      }\n    } catch (Exception ex) {\n      System.err.println(ex);\n    }\n  }\n}\n\nI tell tomcat to load the servlet through web.xml and start the\nJVM with:\n\n-Dcom.sun.management.jmxremote -Dorg.jasig.portal.jmxPort=7087\n-Dcom.sun.management.jmxremote.authenticate=true\n-Dcom.sun.management.jmxremote.ssl=false\n-Dcom.sun.management.jmxremote.password.file=/usr/local/src/myUBC2/conf/jmxremote.password\n\n\nI then run jconsole on my desktop with:\n\n  jconsole service:jmx:rmi://host:7088/jndi/rmi://host:7087/server\n\nand, bingo, JMX access.\n\nIt would be be better if this was built into Tomcat as a configuration\noption, rather than having to do it as part of every Tomcat instance.\n\nI haven't tried out the ssl connection code (I got this code from\nhttp://forum.java.sun.com/thread.jspa?forumID=58&threadID=703567)", "is_private": false, "id": 87088, "creator": "George.Lindholm@ubc.ca", "time": "2006-03-21T23:06:10Z", "bug_id": 39057, "creation_time": "2006-03-21T23:06:10Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 39057, "text": "Not sure how I managed to create a second instance of this\n\n*** This bug has been marked as a duplicate of 39055 ***", "id": 87341, "time": "2006-03-27T23:46:21Z", "creator": "George.Lindholm@ubc.ca", "creation_time": "2006-03-27T23:46:21Z", "is_private": false, "attachment_id": null}]
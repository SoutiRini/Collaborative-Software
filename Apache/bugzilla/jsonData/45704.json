[{"count": 0, "tags": [], "bug_id": 45704, "is_private": false, "text": "Due to changes in resource loader in JRE 1.5.0_16 and 1.6.0_7 (http://sunsolve.sun.com/search/document.do?assetkey=1-66-238628-1) log4j failed to load logging.xml file from jar (Webstart only). Problem happens if custom resource loader is used. Can you help?\n\nlog4j:ERROR Could not parse url [jar:logging.xml].\njava.net.MalformedURLException: no !/ in spec\nat java.net.URL.<init>(Unknown Source)\nat java.net.URL.<init>(Unknown Source)\nat java.net.URL.<init>(Unknown Source)\nat com.sun.org.apache.xerces.internal.impl.XMLEntityManager.setupCurrentEntity(Unknown Source)\nat com.sun.org.apache.xerces.internal.impl.XMLVersionDetector.determineDocVersion(Unknown Source)\nat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(Unknown Source)\nat com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(Unknown Source)\nat com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(Unknown Source)\nat com.sun.org.apache.xerces.internal.parsers.DOMParser.parse(Unknown Source)\nat com.sun.org.apache.xerces.internal.jaxp.DocumentBuilderImpl.parse(Unknown Source)\nat javax.xml.parsers.DocumentBuilder.parse(Unknown Source)\nat org.apache.log4j.xml.DOMConfigurator$2.parse(DOMConfigurator.java:612)\nat org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:711)\nat org.apache.log4j.xml.DOMConfigurator.doConfigure(DOMConfigurator.java:618)\nat org.apache.log4j.helpers.OptionConverter.selectAndConfigure(OptionConverter.java:468)\nat org.apache.log4j.LogManager.<clinit>(LogManager.java:122)\nat org.apache.log4j.Logger.getLogger(Logger.java:117)\nat myapp.Main.<clinit>(Main.java:94)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat com.sun.javaws.Launcher.executeApplication(Unknown Source)\nat com.sun.javaws.Launcher.executeMainClass(Unknown Source)\nat com.sun.javaws.Launcher.continueLaunch(Unknown Source)\nat com.sun.javaws.Launcher.handleApplicationDesc(Unknown Source)\nat com.sun.javaws.Launcher.handleLaunchFile(Unknown Source)\nat com.sun.javaws.Launcher.run(Unknown Source)\nat java.lang.Thread.run(Unknown Source)\nlog4j:WARN No appenders could be found for logger (com.btec.cds.Main).\nlog4j:WARN Please initialize the log4j system properly.", "id": 120169, "time": "2008-08-28T04:45:59Z", "creator": "andrejs.dembovskis@gmail.com", "creation_time": "2008-08-28T04:45:59Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "nick@ebbutt.net", "text": "I think this can be solved just by modifying line 762 in DOMConfigurator, in the method public void doConfigure(final URL url, LoggerRepository repository)\n\nInstead of parser.parse(url.toString()) it seems to work OK if we use parser.parse(url.openConnection().getInputStream()).\n\nThe reason is that the url obtained via URL.toString() was broken for webstart apps in a jdk security patch for 1.5.0_16 and 1.6_07, to obscure the path to jar files in the webstart cache. openConnection still works\n\nI built a patch with this fix and it seemed to work OK for our webstart apps\nSee my blog for more details, http://www.objectdefinitions.com/odblog/2008/fix-for-log4j-bug-45704-failed-to-load-loggingxml-for-jre-150_16-and-webstart/\n\nNick", "count": 1, "id": 121031, "time": "2008-09-26T13:43:12Z", "bug_id": 45704, "creation_time": "2008-09-26T13:43:12Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "carnold@apache.org", "text": "Passing the stream instead of the URL would result in relative URL's in entity references not properly resolving.  That is if you had a configuration file that looked like:\n\n<!DOCTYPE log4j:configuration [\n<!ENTITY A1 SYSTEM A1.xml>\n]>\n<log4j:configuration>\n&A1;\n</log4j:configuration>\n\nif you only passed the stream, the parser would not know where to locate A1.xml.  If you passed a URL or a InputSource, then the parser would know how the resolve A1.xml.\n\nWill have to look through the code, but it would seem the answer would be to pass the URL down through the stack instead of trying to convert the URL to a string and then back.", "count": 2, "id": 121032, "time": "2008-09-26T16:45:04Z", "bug_id": 45704, "creation_time": "2008-09-26T16:45:04Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 45704, "is_private": false, "text": "Good observation, I didn't spot that. \n\nIt looks like it will make this bug a fair bit more difficult to fix. There is no convenient method on DocumentBuilder to pass a URL instance in directly. I wonder if creating a relative URL based on the URL instance you get under webstart would even work, given how broken the webstart URL instance seems.\n\nThe fix I suggested does at least appear to make things work if there is a self-contained config.xml, which I am guessing is probably the majority of cases, but it would be good to find a perfect solution to this. Right now the best workaround I can think of is to take the xml config out of the jar, and make it available via http so it can be downloaded from the web app codebase. This could have advantages anyway, since that way to change the logging config you don't have to rebuild the jars, just change the log.xml on the server. I guess a fair few apps might do it this way already\n\n", "id": 121055, "time": "2008-09-29T02:26:46Z", "creator": "nick@ebbutt.net", "creation_time": "2008-09-29T02:26:46Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "nick@ebbutt.net", "attachment_id": null, "is_private": false, "id": 121117, "time": "2008-10-01T07:16:31Z", "bug_id": 45704, "creation_time": "2008-10-01T07:16:31Z", "text": "There is now a bug report relating to this issue on Sun's site\nhttp://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6753651"}, {"count": 5, "tags": [], "bug_id": 45704, "is_private": false, "text": "The previous bug has been marked as a duplicate of:\n\nhttp://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6746185\n\n\nFrom the notation it appears to be fixed in 1.5.0_17.\n\nCommitted workaround in log4j 1.2 in rev 734483, extras in rev 734485.", "id": 124040, "time": "2009-01-14T11:03:02Z", "creator": "carnold@apache.org", "creation_time": "2009-01-14T11:03:02Z", "attachment_id": null}]
[{"attachment_id": 26662, "tags": [], "creator": "gilles.harloux@gmail.com", "is_private": false, "count": 0, "id": 144321, "time": "2011-02-15T12:09:28Z", "bug_id": 50789, "creation_time": "2011-02-15T12:09:28Z", "text": "Created attachment 26662\ntest case\n\nI can't seem to use CDI/weld in custom error pages.\n\nA testcase is attached. Build with \"mvn install\", deploy. \"index.html\" links to \"404.jsf\". If you visit this url, the page is displayed correctly. If you go somewhere else, thereby provoking a 404, it should display the same. Instead, I see tomcat's generic 404 page and this stacktrace:\n\nFeb 15, 2011 6:04:43 PM org.apache.catalina.core.ApplicationDispatcher invoke\nSEVERE: Servlet.service() for servlet Faces Servlet threw exception\njava.lang.IllegalStateException: Must call associate() before calling activate()\n        at org.jboss.weld.context.AbstractConversationContext.activate(AbstractConversationContext.java:273)\n        at org.jboss.weld.jsf.WeldPhaseListener.activateConversations(WeldPhaseListener.java:110)\n        at org.jboss.weld.jsf.WeldPhaseListener.beforePhase(WeldPhaseListener.java:84)\n        at com.sun.faces.lifecycle.Phase.handleBeforePhase(Phase.java:224)\n        at com.sun.faces.lifecycle.Phase.doPhase(Phase.java:95)\n        at com.sun.faces.lifecycle.RestoreViewPhase.doPhase(RestoreViewPhase.java:107)\n        at com.sun.faces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:114)\n        at javax.faces.webapp.FacesServlet.service(FacesServlet.java:308)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:306)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n        at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:672)\n        at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:465)\n        at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:402)\n        at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:329)\n        at org.apache.catalina.core.StandardHostValve.custom(StandardHostValve.java:466)\n        at org.apache.catalina.core.StandardHostValve.status(StandardHostValve.java:387)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:181)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100)\n        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:541)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:383)\n        at org.apache.coyote.http11.Http11AprProcessor.process(Http11AprProcessor.java:284)\n        at org.apache.coyote.http11.Http11AprProtocol$Http11ConnectionHandler.process(Http11AprProtocol.java:322)\n        at org.apache.tomcat.util.net.AprEndpoint$SocketProcessor.run(AprEndpoint.java:1684)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:662)\nFeb 15, 2011 6:04:43 PM org.apache.catalina.core.StandardHostValve custom\nSEVERE: Exception Processing ErrorPage[errorCode=404, location=/404.jsf]\njavax.servlet.ServletException: Must call associate() before calling activate()\n        at javax.faces.webapp.FacesServlet.service(FacesServlet.java:321)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:306)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n        at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:672)\n        at org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:465)\n        at org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:402)\n        at org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:329)\n        at org.apache.catalina.core.StandardHostValve.custom(StandardHostValve.java:466)\n        at org.apache.catalina.core.StandardHostValve.status(StandardHostValve.java:387)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:181)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100)\n        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:541)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:383)\n        at org.apache.coyote.http11.Http11AprProcessor.process(Http11AprProcessor.java:284)\n        at org.apache.coyote.http11.Http11AprProtocol$Http11ConnectionHandler.process(Http11AprProtocol.java:322)\n        at org.apache.tomcat.util.net.AprEndpoint$SocketProcessor.run(AprEndpoint.java:1684)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.IllegalStateException: Must call associate() before calling activate()\n        at org.jboss.weld.context.AbstractConversationContext.activate(AbstractConversationContext.java:273)\n        at org.jboss.weld.jsf.WeldPhaseListener.activateConversations(WeldPhaseListener.java:110)\n        at org.jboss.weld.jsf.WeldPhaseListener.beforePhase(WeldPhaseListener.java:84)\n        at com.sun.faces.lifecycle.Phase.handleBeforePhase(Phase.java:224)\n        at com.sun.faces.lifecycle.Phase.doPhase(Phase.java:95)\n        at com.sun.faces.lifecycle.RestoreViewPhase.doPhase(RestoreViewPhase.java:107)\n        at com.sun.faces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:114)\n        at javax.faces.webapp.FacesServlet.service(FacesServlet.java:308)\n        ... 19 more\n\ntomcat 7.0.8, java 1.6.0_23, windows XP SP3.\n\nThis issue reminds me of https://issues.apache.org/bugzilla/show_bug.cgi?id=49991, that was on the issue of using CDI/weld in the login/login failed pages used when doing form authentication."}, {"count": 1, "tags": [], "text": "I have added a new option to the Context that enabled ServletRequestListeners to be fired on Forwards. This is in 7.0.x and will be included in 7.0.9 onwards.", "is_private": false, "bug_id": 50789, "id": 144373, "time": "2011-02-17T05:32:54Z", "creator": "markt@apache.org", "creation_time": "2011-02-17T05:32:54Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "gilles.harloux@gmail.com", "attachment_id": null, "is_private": false, "id": 144402, "time": "2011-02-18T08:32:00Z", "bug_id": 50789, "creation_time": "2011-02-18T08:32:00Z", "text": "Tested, it works now. Thanks!"}, {"count": 3, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 152574, "time": "2012-01-05T01:00:50Z", "bug_id": 50789, "creation_time": "2012-01-05T01:00:50Z", "is_private": false, "text": "*** Bug 52423 has been marked as a duplicate of this bug. ***"}, {"count": 4, "tags": [], "bug_id": 50789, "attachment_id": null, "text": "Re: bug 52423\n\t\nIf you want to backport this to Tomcat 6, then I would suggest you to prepare a patch, attach it here and reopen the issue. There is no need to create a new bug report for the same problem.\n\nFrom the archives the commit that implemented this enhancement in Tomcat 7 was\nhttp://svn.apache.org/viewvc?view=revision&revision=1071565", "id": 152576, "time": "2012-01-05T01:18:05Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-01-05T01:18:05Z", "is_private": false}]
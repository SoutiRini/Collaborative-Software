[{"count": 0, "tags": [], "bug_id": 27676, "text": "I ran into this bug on Tomcat 4.1.18, but from inspecting the code it looks \nlike it's still in the most recent release.\n\nI subclassed FormAuthenticator to provide single sign-on type functionality \nfor my webapp.  My authenticator's authenticate() looks for an authToken in a \nrequest parameter and, if it's not there, defers to the superclass \nimplementation (FormAuthentication).\n\nMy call to request.getParameter() triggers code in \nHttpRequestBase.parseParameters() which sets the 'parsed' flag in the request \nobject to true.\n\nLater, in the implementation of FormAuthenticator.authenticate(), \nFormAuthenticator.restoreRequest() is called to restore the original request \nafter successful login.  In that method, the parameters get blown away and the \nqueryString is reset, but the parsed flag is not cleared.  So, every \nsubsequent call to request.getParameter() returns null.  It doesn't know that \nit needs to reparse the queryString.\n\nI'm not sure if this is a semantic problem in FormAuthenticator or in \nHttpRequestBase.  I would imagine that it's the former, since it looks an \nHttpRequestBase is not really intended to be reused.  Maybe FormAuthenticator \nshould recycle the request object prior to restoring it.  Either way, the \nstate of the request becomes inconsistent.", "id": 54023, "time": "2004-03-15T18:03:21Z", "creator": "justinp@motive.com", "creation_time": "2004-03-15T18:03:21Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 27676, "attachment_id": null, "id": 60411, "time": "2004-07-10T22:29:10Z", "creator": "markt@apache.org", "creation_time": "2004-07-10T22:29:10Z", "is_private": false, "text": "There is now an SSO implementation provided with the latest TC4 release \n(4.1.30). If you still need to develop your own SSO implementation then I'd \nsuggest using the built-in one as a basis."}, {"count": 2, "tags": [], "text": "Can you please elaborate on how you fix this?  I see the SingleSignOn class.  \nI think it was there before.  Regardless, it's a Valve and has nothing to do \nwith the Authenticator.\n\nI need to pass a SingleSignOn authentication token from another web site to \nthis one.  Right now, I'm looking for the request parameter in my custom \nAuthenticator.  Is there a more appropriate way to do it through the \nSingleSignOn Valve?\n\nIt sounds like there is a different way to handle my situation that you're \nthinking of.\n\nThanks for your help.", "attachment_id": null, "id": 60641, "creator": "justinp@motive.com", "time": "2004-07-15T14:40:50Z", "bug_id": 27676, "creation_time": "2004-07-15T14:40:50Z", "is_private": false}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Ah. It wasn't clear that your SSO token was from another website - ie external \nto tomcat. I'll have another look at this.", "id": 60650, "time": "2004-07-15T18:15:17Z", "bug_id": 27676, "creation_time": "2004-07-15T18:15:17Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 27676, "text": "If you use the CoyoteConnector rather than the deprecated http connector the \nclearParameters() method won't have any effect.\n\nGiven the direction this bug report is going, I think it would be better to \ncontinue this on the tomcat-user mailing list. If the conclusion from further \ndiscussion is that there is a bug that needs fixing, we can always re-open \nthis report.\n\nFor now I am changing this back to WONTFIX.", "count": 4, "id": 60655, "time": "2004-07-15T20:29:58Z", "creator": "markt@apache.org", "creation_time": "2004-07-15T20:29:58Z", "is_private": false}]
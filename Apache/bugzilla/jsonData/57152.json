[{"count": 0, "tags": [], "bug_id": 57152, "attachment_id": null, "text": "The bug is easy to reproduce: just download Tomcat and start it using\n./catalina.bat -security  \nor\n./catalina.sh -security\n\n\nThe Tomcat Manager web application throws an exception. I checked a few versions and it looks like it works correctly (Tomcat Manager starts with security manager enabled) in versions below 7.0.50 and it doesn't work in 7.0.50 and later. \n\nI checked in on windows as well as in linux. We use RMI in our webapp and we need the security manager to run it. \n\nGiving all permissions in security policy doesn't seem to help:\ngrant {\n  permission java.security.AllPermission;\n};\n\n\nStack trace:\nINFO: Deploying web application directory C:\\Users\\joegreen\\Desktop\\apache-tomcat-7.0.50\\webapps\\host-manager\npa\u017a 27, 2014 4:34:57 PM org.apache.catalina.startup.HostConfig deployDirectory\nSEVERE: The web application with context path [/host-manager] was not deployed because it contained a deployment descriptor [C:\\Users\\joegreen\\Desktop\\apache-tomcat-7.0.50\\webapps\\host-manager\\META-INF\\context.xml] which may include configuration necessary for the secure deployment of the application but processing of deployment descriptors is prevented by the deployXML setting of this host. An appropriate descriptor should be created at [C:\\Users\\joegreen\\Desktop\\apache-tomcat-7.0.50\\conf\\Catalina\\localhost\\host-manager.xml] to deploy this application.\npa\u017a 27, 2014 4:34:57 PM org.apache.catalina.core.ContainerBase addChildInternal\nSEVERE: ContainerBase.addChild: start: \norg.apache.catalina.LifecycleException: Failed to start component [/host-manager]\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:154)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:901)\n\tat org.apache.catalina.core.ContainerBase.access$000(ContainerBase.java:133)\n\tat org.apache.catalina.core.ContainerBase$PrivilegedAddChild.run(ContainerBase.java:156)\n\tat org.apache.catalina.core.ContainerBase$PrivilegedAddChild.run(ContainerBase.java:145)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:875)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:634)\n\tat org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:1230)\n\tat org.apache.catalina.startup.HostConfig$DeployDirectory.run(HostConfig.java:1876)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:724)\nCaused by: org.apache.catalina.LifecycleException: Failed to process either the global, per-host or context-specific context.xml file therefore the [/host-manager] Context cannot be started.\n\tat org.apache.catalina.startup.FailedContext.startInternal(FailedContext.java:158)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\t... 14 more\n\npa\u017a 27, 2014 4:34:57 PM org.apache.catalina.startup.HostConfig deployDirectory\nSEVERE: Error deploying web application directory C:\\Users\\joegreen\\Desktop\\apache-tomcat-7.0.50\\webapps\\host-manager\njava.lang.IllegalStateException: ContainerBase.addChild: start: org.apache.catalina.LifecycleException: Failed to start component [/host-manager]\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:904)\n\tat org.apache.catalina.core.ContainerBase.access$000(ContainerBase.java:133)\n\tat org.apache.catalina.core.ContainerBase$PrivilegedAddChild.run(ContainerBase.java:156)\n\tat org.apache.catalina.core.ContainerBase$PrivilegedAddChild.run(ContainerBase.java:145)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:875)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:634)\n\tat org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:1230)\n\tat org.apache.catalina.startup.HostConfig$DeployDirectory.run(HostConfig.java:1876)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:724)\n\npa\u017a 27, 2014 4:34:57 PM org.apache.catalina.startup.HostConfig deployDirectory\nINFO: Deploying web application directory C:\\Users\\joegreen\\Desktop\\apache-tomcat-7.0.50\\webapps\\manager\npa\u017a 27, 2014 4:34:57 PM org.apache.catalina.startup.HostConfig deployDirectory\nSEVERE: The web application with context path [/manager] was not deployed because it contained a deployment descriptor [C:\\Users\\joegreen\\Desktop\\apache-tomcat-7.0.50\\webapps\\manager\\META-INF\\context.xml] which may include configuration necessary for the secure deployment of the application but processing of deployment descriptors is prevented by the deployXML setting of this host. An appropriate descriptor should be created at [C:\\Users\\joegreen\\Desktop\\apache-tomcat-7.0.50\\conf\\Catalina\\localhost\\manager.xml] to deploy this application.\npa\u017a 27, 2014 4:34:57 PM org.apache.catalina.core.ContainerBase addChildInternal\nSEVERE: ContainerBase.addChild: start: \norg.apache.catalina.LifecycleException: Failed to start component [/manager]\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:154)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:901)\n\tat org.apache.catalina.core.ContainerBase.access$000(ContainerBase.java:133)\n\tat org.apache.catalina.core.ContainerBase$PrivilegedAddChild.run(ContainerBase.java:156)\n\tat org.apache.catalina.core.ContainerBase$PrivilegedAddChild.run(ContainerBase.java:145)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:875)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:634)\n\tat org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:1230)\n\tat org.apache.catalina.startup.HostConfig$DeployDirectory.run(HostConfig.java:1876)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:724)\nCaused by: org.apache.catalina.LifecycleException: Failed to process either the global, per-host or context-specific context.xml file therefore the [/manager] Context cannot be started.\n\tat org.apache.catalina.startup.FailedContext.startInternal(FailedContext.java:158)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\t... 14 more\n\npa\u017a 27, 2014 4:34:57 PM org.apache.catalina.startup.HostConfig deployDirectory\nSEVERE: Error deploying web application directory C:\\Users\\joegreen\\Desktop\\apache-tomcat-7.0.50\\webapps\\manager\njava.lang.IllegalStateException: ContainerBase.addChild: start: org.apache.catalina.LifecycleException: Failed to start component [/manager]\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:904)\n\tat org.apache.catalina.core.ContainerBase.access$000(ContainerBase.java:133)\n\tat org.apache.catalina.core.ContainerBase$PrivilegedAddChild.run(ContainerBase.java:156)\n\tat org.apache.catalina.core.ContainerBase$PrivilegedAddChild.run(ContainerBase.java:145)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:875)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:634)\n\tat org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:1230)\n\tat org.apache.catalina.startup.HostConfig$DeployDirectory.run(HostConfig.java:1876)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:724)\n\npa\u017a 27, 2014 4:34:57 PM org.apache.catalina.startup.HostConfig deployDirectory\nINFO: Deploying web application directory C:\\Users\\joegreen\\Desktop\\apache-tomcat-7.0.50\\webapps\\ROOT\npa\u017a 27, 2014 4:34:58 PM org.apache.coyote.AbstractProtocol start\nINFO: Starting ProtocolHandler [\"http-apr-8080\"]\npa\u017a 27, 2014 4:34:58 PM org.apache.coyote.AbstractProtocol start\nINFO: Starting ProtocolHandler [\"ajp-apr-8009\"]\npa\u017a 27, 2014 4:34:58 PM org.apache.catalina.startup.Catalina start\nINFO: Server startup in 1591 ms", "id": 178773, "time": "2014-10-27T15:52:42Z", "creator": "joegreen+bugzilla@joegreen.pl", "creation_time": "2014-10-27T15:52:42Z", "is_private": false}, {"count": 1, "tags": [], "creator": "chris@christopherschultz.net", "text": "Between 7.0.50 and 7.0.56 (current as of this writing), there have been 4 bugs identified and fixed that involve the manager webapp and security manager.\n\nPlease re-test with 7.0.56.", "id": 178775, "time": "2014-10-27T17:08:42Z", "bug_id": 57152, "creation_time": "2014-10-27T17:08:42Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 57152, "attachment_id": null, "text": "I haven't stated it clearly but of course I have also verified this behavior in the newest 7.0.56 version of Tomcat. I have just done it again to be sure and yes, it also happens in 7.0.56.", "id": 178776, "time": "2014-10-27T17:16:17Z", "creator": "joegreen+bugzilla@joegreen.pl", "creation_time": "2014-10-27T17:16:17Z", "is_private": false}, {"count": 3, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "This behaviour is by design.\n\nAs mentioned in changelog (7.0.48):\n\n        If a Host is configured with a value of <code>false</code> for\n        <code>deployXML</code>, a web application has an embedded\n        descriptor at <code>META-INF/context.xml</code> and no explicit\n        descriptor has been defined for this application, do not allow the\n        application to start. The reason for this is that the embedded\n        descriptor may contain configuration necessary for secure operation\n        such as a <code>RemoteAddrValve</code>.", "id": 178777, "time": "2014-10-27T17:41:38Z", "bug_id": 57152, "creation_time": "2014-10-27T17:41:38Z", "is_private": false, "attachment_id": null}]
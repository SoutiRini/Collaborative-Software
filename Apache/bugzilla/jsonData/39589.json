[{"attachment_id": null, "tags": [], "bug_id": 39589, "text": "ENV:\nJDK 1.5.0_05\nTomcat 5.5.12\nJAMonapi ( jamonapi.sf.net ) 020106\nLinux or Windows\n\nI am using JAMonapi war file as a simple example test case, however I expect the\nproblem to occur with any webapp deployed in the same way.\n\nAccording to Tomcat 5.5. documentation:\nhttp://tomcat.apache.org/tomcat-5.5-doc/appdev/deployment.html - Shared Library\nFiles\nhttp://tomcat.apache.org/tomcat-5.5-doc/class-loader-howto.html\n\"Shared - This class loader is the place to put classes and resources that you\nwish to share across ALL  web applications (unless Tomcat internal classes also\nneed access, in which case you should put them in the Common  class loader\ninstead). All unpacked classes and resources in $CATALINA_BASE/shared/classes,\nas well as classes and resources in JAR files under $CATALINA_BASE/shared/lib,\nare made visible through this class loader. If multiple Tomcat instances are run\nfrom the same binary using the $CATALINA_BASE environment variable, then this\nclassloader repositories are relative to $CATALINA_BASE rather than $CATALINA_HOME.\"\n\nBasic Test Setup - the steps below are for reference. See the attached zip files\nfor the complete test CATALINA_BASE files for four test cases. TWO PASS, TWO FAIL.\n\n1. Install tomcat 5.5.12 and add env. variable CATALINA_HOME to point to the\ndirectory of the installation.\n2. Create a CATALINA_BASE directory with all the prerequisite directories:\nconf/\nlogs/\nshared/lib\ntemp/\nwebapps/\nwork/\n\n3. Add an CATALINA_BASE env variable to point to the base directory made in step 2\n\n4. Add a shared library to the $CATALINA_BASE/shared/lib dir. In this case it\nwill be JAMon-020106.jar.\n\n5. Install simple config files to $CATALINA_BASE/conf - server.xml, web.xml,\ntomcat-users.xml ( see zip files )\n\n6. Create a standard context file called JAMon.xml and install to \n$CATALINA_BASE/conf/<enginename>/<hostname>/JAMon.xml\n($CATALINA_BASE/conf/test-engine/localhost/JAMon.xml in the tests)\n\n7. Edit the following files as required with the correct paths in the failing\ntest cases:\n   Correct the docBase in $CATALINA_BASE/conf/test-engine/localhost/JAMon.xml\nto point to either the JAMon.war file or the expanded webapp in a directory.\n\nAccording to the tomcat documentation I expect the test cases which fail to pass.\n\nTo run the tests I used 'catalina.sh start' and 'catalina.bat start'. Examine\nthe contents of catalina.out in CATALINA_BASE/logs dir for the\nClassNotFoundException after starting the container. IN the failing tests if the\n shared jar file contents are placed in $CATALINA_BASE/shared/classes it also\nresults in ClassNotFoundException.\n\nIt should look like this:\n\n\n$ cat ./logs/catalina.out \n15-May-2006 8:57:53 PM org.apache.coyote.http11.Http11BaseProtocol init\nINFO: Initializing Coyote HTTP/1.1 on http-7082\n15-May-2006 8:57:53 PM org.apache.catalina.startup.Catalina load\nINFO: Initialization processed in 1094 ms\n15-May-2006 8:57:54 PM org.apache.catalina.core.StandardService start\nINFO: Starting service test\n15-May-2006 8:57:54 PM org.apache.catalina.core.StandardEngine start\nINFO: Starting Servlet Engine: Apache Tomcat/5.5.12\n15-May-2006 8:57:54 PM org.apache.catalina.core.StandardHost start\nINFO: XML validation disabled\n15-May-2006 8:57:54 PM org.apache.catalina.startup.ContextConfig\napplicationWebConfig\nINFO: Missing application web.xml, using defaults only\nStandardEngine[test-engine].StandardHost[localhost].StandardContext[]\n15-May-2006 8:57:54 PM org.apache.catalina.core.StandardContext filterStart\nSEVERE: Exception starting filter JAMonFilter\njava.lang.ClassNotFoundException: com.jamonapi.JAMonFilter\n        at\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1338)\n        at\norg.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1187)\n        at\norg.apache.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:211)\n        at\norg.apache.catalina.core.ApplicationFilterConfig.setFilterDef(ApplicationFilterConfig.java:308)\n        at\norg.apache.catalina.core.ApplicationFilterConfig.<init>(ApplicationFilterConfig.java:79)\n        at\norg.apache.catalina.core.StandardContext.filterStart(StandardContext.java:3563)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4133)\n        at\norg.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524)\n        at\norg.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:603)\n        at\norg.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:535)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:470)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1118)\n        at\norg.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:310)\n        at\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1020)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:718)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1012)\n        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:442)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:450)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:680)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:536)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:585)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:275)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)\n15-May-2006 8:57:54 PM org.apache.catalina.core.StandardContext start\nSEVERE: Error filterStart\n15-May-2006 8:57:54 PM org.apache.catalina.core.StandardContext start\nSEVERE: Context [/JAMon] startup failed due to previous errors\n15-May-2006 8:57:55 PM org.apache.coyote.http11.Http11BaseProtocol start\nINFO: Starting Coyote HTTP/1.1 on http-7082\n15-May-2006 8:57:55 PM org.apache.catalina.storeconfig.StoreLoader load\nINFO: Find registry server-registry.xml at classpath resource\n15-May-2006 8:57:55 PM org.apache.catalina.startup.Catalina start\nINFO: Server startup in 1249 ms", "count": 0, "id": 89150, "time": "2006-05-16T00:00:41Z", "creator": "plynch@apache.org", "creation_time": "2006-05-16T00:00:41Z", "is_private": false}, {"count": 1, "attachment_id": 18292, "bug_id": 39589, "is_private": false, "id": 89151, "time": "2006-05-16T00:06:31Z", "creator": "plynch@apache.org", "creation_time": "2006-05-16T00:06:31Z", "tags": [], "text": "Created attachment 18292\ntestcases 2 passing\n\nsee the README.txt in each test case dir for info"}, {"count": 2, "tags": [], "bug_id": 39589, "text": "Created attachment 18293\ntestcases 2 failing\n\nsee the README.txt in each test dir", "id": 89152, "time": "2006-05-16T00:07:21Z", "creator": "plynch@apache.org", "creation_time": "2006-05-16T00:07:21Z", "is_private": false, "attachment_id": 18293}, {"attachment_id": null, "tags": [], "bug_id": 39589, "text": "clarify summary", "count": 3, "id": 89154, "time": "2006-05-16T00:16:56Z", "creator": "plynch@apache.org", "creation_time": "2006-05-16T00:16:56Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 39589, "text": "Wondering why this issue is not being looked at?", "id": 95933, "attachment_id": null, "creator": "plynch@apache.org", "creation_time": "2006-11-17T08:10:03Z", "time": "2006-11-17T08:10:03Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 39589, "text": "Peter, issues can be ignored for many reasons.  We appreciate your bug reports,\nand as you can see no one has questioned its contents.  However, no one appears\nto care enough to comment, vote, or provide a patch.  Please remember that most\nof us are volunteers, we don't get paid to fix a specific bug.  That's why the\nbest chance for a speedy fix of this issue is if you provide a working patch as\nan attachment to this Bugzilla item.\n\nI'm also downgrading the severity of this issue, because there's an easy\nworkaround of putting the relevant class(es) or jar(s) in the webapp-specific\nclassloader repositories.", "count": 5, "id": 100871, "time": "2007-03-25T08:05:58Z", "creator": "yoavs@computer.org", "creation_time": "2007-03-25T08:05:58Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 39589, "text": "Shapira,\n\nTo add to what Peter Lynch had experienced, what if theres exists a need for a \nset of classes to be shared across all the contexts. In this case, the ideal  \nplace is shared/lib, though the shared classes can be placed in tomcat/common \ntoo. When we place the required jar in common/lib, the classes reffered within \nthe shared classes that are not actually shared across contexts also need to be \nplaced there.\n\nAm I correct ?\n", "id": 108694, "time": "2007-09-26T23:16:13Z", "creator": "Jain.Mamta@in.standardchartered.com", "creation_time": "2007-09-26T23:16:13Z", "tags": [], "is_private": false}, {"count": 7, "attachment_id": null, "creator": "knst.kolinko@gmail.com", "text": "Jain,\n\n/shared/lib and /shared/classes do work in Tomcat 5.5.23. The problem\nthat Peter was experiencing is due to a specific advanced configuration,\nwhere the webapp is being deployed by using a context.xml file.\n\nWhen the app is deployed into webapps folder, as is the usual way,\neverything is fine.\n\nI have not tested and do not know if and why Peter's deployment\nusing context xml file behaves differently.\n\n\nAs far as I understand, the existence of /shared/lib is a requirement of\nServlet Spec. E.g. in Servlet Spec. 2.4 chapter SRV.9.7.1 we may read\n\n\"When a number of applications make use of the same code or resources, \nthey will typically be installed as library files in the container.\n(...)\nThe container must provide a directory for these libraries. The files\nplaced within this directory must be available across all Web applications.\nThe location of this directory is container-specific.\"\n\nKonstantin.", "id": 109187, "time": "2007-10-10T05:07:22Z", "bug_id": 39589, "creation_time": "2007-10-10T05:07:22Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 39589, "attachment_id": null, "is_private": false, "id": 123729, "time": "2009-01-03T14:53:43Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2009-01-03T14:53:43Z", "text": "Found the cause:\nThe context files of those applications that are failing have privileged=\"true\" on their <Context> element.\n\n\nIf privileged flag is set, the Webapp classloader of the application uses the Server (aka Catalina) classloader instead of the Shared one as its parent.\n\nThat is by design and WONTFIX.\n\nThough that is not mentioned in class-loader-howto.html, it is mentioned in the description of the privileged attribute of Context here:\nhttp://tomcat.apache.org/tomcat-5.5-doc/config/context.html\n\n\n*** This bug has been marked as a duplicate of bug 44094 ***"}]
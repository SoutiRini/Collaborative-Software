[{"count": 0, "tags": [], "bug_id": 34607, "attachment_id": null, "is_private": false, "id": 74096, "time": "2005-04-25T22:01:05Z", "creator": "chip@force-elite.com", "creation_time": "2005-04-25T22:01:05Z", "text": "This is a tracking bug for supporting 'Server Name Indication' in mod_ssl, as\nspecified in RFC 3546.\n\nThis is currently blocking on OpenSSL supporting the required bits upstream."}, {"count": 1, "tags": [], "bug_id": 34607, "attachment_id": null, "id": 81585, "time": "2005-10-23T19:24:49Z", "creator": "chip@force-elite.com", "creation_time": "2005-10-23T19:24:49Z", "is_private": false, "text": "IE 7, Beta 2 includes support for TLS Server Name Indication:\nhttp://blogs.msdn.com/ie/archive/2005/10/22/483795.aspx\n\n"}, {"count": 2, "tags": [], "bug_id": 34607, "attachment_id": null, "is_private": false, "id": 84302, "time": "2006-01-06T10:38:56Z", "creator": "jorton@redhat.com", "creation_time": "2006-01-06T10:38:56Z", "text": "Looks like the OpenSSL side of this is being done for 0.9.9!"}, {"count": 3, "tags": [], "text": "What do you think of this patch?\n\n   http://www.edelweb.fr/EdelKey/files/apache-2.2.0+0.9.9+servername.patch\n\nI'm using a slightly modified version of this patch on my\nApache-2.2.0-plus-mod_ssl-linked-against-openssl-SNAP SNI test server, which is\navailable at\n\n   https://sni.velox.ch\n   https://alice.sni.velox.ch\n   https://carol.sni.velox.ch\n   https://bob.sni.velox.ch\n   https://dave.sni.velox.ch\n   https://mallory.sni.velox.ch\n   https://www.sni.velox.ch\n   https://test.sni.velox.ch\n   (and so on)\n\nI'm aware of mod_gnutls, written by the original reporter of this bug - but\nnevertheless I think it would be useful to have SNI support in mod_ssl, too... ;-)", "attachment_id": null, "id": 88324, "creator": "asfbugz@velox.ch", "time": "2006-04-20T16:12:17Z", "bug_id": 34607, "creation_time": "2006-04-20T16:12:17Z", "is_private": false}, {"count": 4, "tags": [], "creator": "wrowe@apache.org", "attachment_id": null, "id": 91396, "time": "2006-07-18T18:57:54Z", "bug_id": 34607, "creation_time": "2006-07-18T18:57:54Z", "is_private": false, "text": "FYI...\n\npatches outside of the 'asf' domain are under any arbitrary license the author\ndesignates. Patches submitted (attached to the bug database, emailed to dev@httpd\nmailing list, etc) by the original author are submitted (by the ASL 2.0) under\nthe terms of the Apache Software License 2.0 - which would be required for the\npatch to be considered for incorporation into the httpd code base.\n\nIf you want to attach your patch to this incident under ASL 2 we would be happy\nto consider it.  Obviously, OpenSSL support is still a gating factor."}, {"count": 5, "tags": [], "bug_id": 34607, "attachment_id": null, "is_private": false, "id": 100089, "time": "2007-03-06T08:12:34Z", "creator": "yusufg@gmail.com", "creation_time": "2007-03-06T08:12:34Z", "text": "As per comment #4, the author of the patch indicated in #3 has emailed it to\ndev@httpd which can be seen from this link to an archive\n\nhttp://marc.theaimsgroup.com/?l=apache-httpd-dev&m=117311733932367&w=2\n\nWould request that this patch be now considered for review"}, {"count": 6, "tags": [], "bug_id": 34607, "attachment_id": 19676, "is_private": false, "id": 100122, "time": "2007-03-07T02:27:34Z", "creator": "asfbugz@velox.ch", "creation_time": "2007-03-07T02:27:34Z", "text": "Created attachment 19676\nPatch for SNI support in Apache 2.2 or later\n\nFor the sake of completeness, I'm attaching the modified version of Peter's\npatch, which I have been using on the test site mentioned above since April\n2006.\n\nHere is a short overview of my modifications:\n\n1) in set_ssl_vhost(), I've added checks for the ServerAlias directive, so that\ncertificates with multiple dNSName entries in the subjectAltName extension can\nbe used, too (these checks are reusing code from matches_aliases() in vhost.c);\n\n\n2) #ifdef'd the warning \"You should not use name-based virtual hosts in\nconjunction with SSL!!\" - i.e. suppress this message if SNI support is compiled\nin;\n\n3) in ssl_hook_Access(), limited the change of the SSL_CTX to the case where\ntlsext_hostname isn't set yet (in all other cases, leave it at the default\nVirtualHost - we no longer have to return HTTP_FORBIDDEN);\n\n4) in ssl_hook_Fixup(), inserted an additional environment variable (TLS_SNI)\nwhich can be used later on to determine if (and what) SNI extension the client\nsent (e.g. in CGI scripts, or when using CustomLog);\n\n5) adapted indentation (spaces instead of tabs).\n\nThe diff is against 2.2.x, but applies cleanly against (and seems to work ok\nwith) trunk, too."}, {"count": 7, "tags": [], "creator": "steve@openssl.org", "attachment_id": null, "id": 107403, "time": "2007-08-29T09:39:40Z", "bug_id": 34607, "creation_time": "2007-08-29T09:39:40Z", "is_private": false, "text": "Note that SNI support has been backported to OpenSSL 0.9.8 but not official\nrelease contains it yet, 0.9.8f will be the first. \n\nTLS extension support is disabled by default in OpenSSL 0.9.8 and must be\nexplicitly enabled at compile time using \"enable-tlsext\"."}, {"count": 8, "tags": [], "text": "OpenSSL 0.9.8f got released recently.\n\nThe changelog confirms inclusion of the needed extension:\n\n  *) Add initial support for TLS extensions, specifically for the server_name\n     extension so far.  The SSL_SESSION, SSL_CTX, and SSL data structures now\n     have new members for a host name.  The SSL data structure has an\n     additional member SSL_CTX *initial_ctx so that new sessions can be\n     stored in that context to allow for session resumption, even after the\n     SSL has been switched to a new SSL_CTX in reaction to a client's\n     server_name extension.\n\n     New functions (subject to change):\n\n         SSL_get_servername()\n         SSL_get_servername_type()\n         SSL_set_SSL_CTX()\n\n     New CTRL codes and macros (subject to change):\n\n         SSL_CTRL_SET_TLSEXT_SERVERNAME_CB\n                                 - SSL_CTX_set_tlsext_servername_callback()\n         SSL_CTRL_SET_TLSEXT_SERVERNAME_ARG\n                                      - SSL_CTX_set_tlsext_servername_arg()\n         SSL_CTRL_SET_TLSEXT_HOSTNAME           - SSL_set_tlsext_host_name()\n\n     openssl s_client has a new '-servername ...' option.\n\n     openssl s_server has new options '-servername_host ...', '-cert2 ...',\n     '-key2 ...', '-servername_fatal' (subject to change).  This allows\n     testing the HostName extension for a specific single host name ('-cert'\n     and '-key' remain fallbacks for handshakes without HostName\n     negotiation).  If the unrecogninzed_name alert has to be sent, this by\n     default is a warning; it becomes fatal with the '-servername_fatal'\n     option.\n\n     [Peter Sylvester,  Remy Allais, Christophe Renou, Steve Henson]\n", "attachment_id": null, "id": 109332, "creator": "rainer.jung@kippdata.de", "time": "2007-10-14T07:03:52Z", "bug_id": 34607, "creation_time": "2007-10-14T07:03:52Z", "is_private": false}, {"count": 9, "tags": [], "creator": "steve@openssl.org", "attachment_id": null, "text": "Note that it is possible to reliably check if TLS extension support is in\nOpenSSL at compile time by seeing if the version number is 0.9.8f or later and\nthat OPENSSL_NO_TLSEXT is *not* defined.", "id": 109493, "time": "2007-10-19T06:00:37Z", "bug_id": 34607, "creation_time": "2007-10-19T06:00:37Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 34607, "attachment_id": null, "id": 110660, "time": "2007-11-16T16:24:06Z", "creator": "steve@openssl.org", "creation_time": "2007-11-16T16:24:06Z", "is_private": false, "text": "(In reply to comment #9)\n> Note that it is possible to reliably check if TLS extension support is in\n> OpenSSL at compile time by seeing if the version number is 0.9.8f or later and\n> that OPENSSL_NO_TLSEXT is *not* defined.\n\nThe logic used in the patch:\n\n#ifndef OPENSSL_NO_TLSEXT\n#ifndef SSL_CTRL_SET_TLSEXT_HOSTNAME\n#define OPENSSL_NO_TLSEXT\n#endif\n#endif\n\nis also fine for detecting extension support in OpenSSL. The result being that\nsupport will only be included if compiled against a version of OpenSSL\nsupporting TLS extensions.\n"}, {"count": 11, "tags": [], "creator": "eflash@gmx.net", "attachment_id": null, "id": 111989, "time": "2007-12-21T07:41:16Z", "bug_id": 34607, "creation_time": "2007-12-21T07:41:16Z", "is_private": false, "text": "committed slightly modified (env var prefixed with 'SSL_') to trunk now:\nhttp://svn.apache.org/viewvc?rev=606190&view=rev\n\nalso I've created a patch for the httpd 2.0.x line:\nhttp://people.apache.org/~fuankg/diffs/httpd-2.0.x-sni.diff\nperhaps useful for those who might need it (as a customer asked me for).\n\n"}, {"count": 12, "tags": [], "text": "Since SSL Upgrade wasn't accepted for backport to 2.0, I'm guessing we won't\nrally the support for backporting this either, although it's most kind of you\nto post this for users who are interested, Guenter.\n\nWe can try getting folks behind backporting this to 2.2 sometime in the near\nfuture (although preferably not in the immediately pending release).\n", "attachment_id": null, "id": 112595, "creator": "wrowe@apache.org", "time": "2008-01-07T10:32:25Z", "bug_id": 34607, "creation_time": "2008-01-07T10:32:25Z", "is_private": false}, {"count": 13, "tags": [], "text": "Created attachment 21365\nPatch against SNI code as currently available in trunk\n\n(In reply to comment #12)\n> We can try getting folks behind backporting this to 2.2 sometime in the near\n> future (although preferably not in the immediately pending release).\n\nWhat are the chances of getting it into 2.2.8, nevertheless? I'm attaching a\ndiff against the current trunk version (committed by Guenter on\n2007-12-21/2007-12-29), which basically reflects the version I posted to\nhttpd-dev (see\nhttp://mail-archives.apache.org/mod_mbox/httpd-dev/200801.mbox/%3c477BBD86.9020600@velox.ch%3e).\nIt also includes a fix for an issue with SSLVerifyClient in the version posted\nto httpd-dev on 2008-01-02 I discovered in the meantime (per-directory\nrestrictions were no longer working properly).\n\nA backport of this latest version of the code for 2.2.x is available at\nhttp://sni.velox.ch/httpd-2.2.x-sni.diff\n(Guenter, feel free to copy this to people.apache.org)", "is_private": false, "bug_id": 34607, "id": 112686, "time": "2008-01-09T03:44:07Z", "creator": "asfbugz@velox.ch", "creation_time": "2008-01-09T03:44:07Z", "attachment_id": 21365}, {"count": 14, "tags": [], "bug_id": 34607, "attachment_id": null, "is_private": false, "id": 112776, "time": "2008-01-11T17:04:27Z", "creator": "eflash@gmx.net", "creation_time": "2008-01-11T17:04:27Z", "text": "(In reply to comment #13)\n> Created an attachment (id=21365) [edit]\n> Patch against SNI code as currently available in trunk\ncommited:\nhttp://svn.apache.org/viewvc?rev=611216&view=rev\n\n> A backport of this latest version of the code for 2.2.x is available at\n> http://sni.velox.ch/httpd-2.2.x-sni.diff\n> (Guenter, feel free to copy this to people.apache.org)\nthanks, did that so that the backport proposal points now to the fixed diff:\nhttp://people.apache.org/~fuankg/diffs/httpd-2.2.x-sni.diff\n\nalso I've created a new patch for the httpd 2.0.x line:\nhttp://people.apache.org/~fuankg/diffs/httpd-2.0.x-sni.diff\nthis depends also on this patch:\nhttp://people.apache.org/~fuankg/diffs/httpd-2.0.x-ap_vhost_iterate_given_conn.diff\nperhaps useful for those who might need it (as a customer asked me for).\n\n"}, {"count": 15, "tags": [], "text": "(In reply to comment #12)\n> Since SSL Upgrade wasn't accepted for backport to 2.0, I'm guessing we won't\n> rally the support for backporting this either,\nwell, sure I'm all after getting folks to use latest. Unfortunately that is not\nalways possible. There are many many users out who are bound to a specific\nApache line, f.e. many Oracle users are still stick with the 1.3.x line; on\nNetWare we have the issue that we have a couple of non-opensource modules which\nwe have only for 2.0.x line available, and this situation will never change I\nguess; f.e. we have an iPrint module running on 2.0.x line, and we cant users\njust force to upgrade to later 2.2.x since they would loose iPrint\nfunctionality. Same goes for at least 4 other modules too; so this might be a\nreason why Brad suggested backporting SSL Upgrade. I think that such situations\nwith commercial Apache modules happen to a lot of users on other platforms too,\nand we should probably discuss this again from this point of view. Currently I\nsee no good reason why we should force those users to either go without these\nenhancements, or to patch self / use unofficial builds.\n\nG\u00fcn.\n", "attachment_id": null, "id": 112777, "creator": "eflash@gmx.net", "time": "2008-01-11T17:18:55Z", "bug_id": 34607, "creation_time": "2008-01-11T17:18:55Z", "is_private": false}, {"count": 16, "tags": [], "creator": "asfbugz@velox.ch", "attachment_id": 21365, "text": "Comment on attachment 21365\nPatch against SNI code as currently available in trunk\n\nThis patch is more than obsolete, actually. Since January 2008, a lot of improvements have been checked into trunk (e.g. R\u00fcdiger's recent work on storing the server_rec in the proper place [http://svn.apache.org/viewvc?view=rev&revision=757463]).", "id": 126094, "time": "2009-04-08T09:11:53Z", "bug_id": 34607, "creation_time": "2009-04-08T09:11:53Z", "is_private": false}, {"count": 17, "tags": [], "text": "(In reply to comment #16)\n> (From update of attachment 21365 [details])\n> This patch is more than obsolete, actually. Since January 2008, a lot of\n> improvements have been checked into trunk (e.g. R\u00fcdiger's recent work on\n> storing the server_rec in the proper place\n> [http://svn.apache.org/viewvc?view=rev&revision=757463]).\n\nSo there's any chance that we'll see a back-port of the changes related to SNI to Apache 2.2?\n\nDiego", "is_private": false, "id": 126361, "creation_time": "2009-04-19T07:03:00Z", "time": "2009-04-19T07:03:00Z", "creator": "diego@caravana.to", "bug_id": 34607, "attachment_id": null}, {"count": 18, "tags": [], "creator": "asfbugz@velox.ch", "attachment_id": null, "text": "Backport committed to 2.2.x: r776281", "id": 127322, "time": "2009-05-23T00:34:53Z", "bug_id": 34607, "creation_time": "2009-05-23T00:34:53Z", "is_private": false}]
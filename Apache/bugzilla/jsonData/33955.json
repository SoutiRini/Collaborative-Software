[{"count": 0, "attachment_id": null, "bug_id": 33955, "is_private": false, "id": 72160, "time": "2005-03-11T02:02:53Z", "creator": "wlovins@interland.com", "creation_time": "2005-03-11T02:02:53Z", "tags": [], "text": "If a prefix is used in the tar task to prepend the file path and the username\nfield is used, the username is not carried over into the prefix entries.\n\nFor example:\n<tar destfile=\"/usr/src/test.tar.gz\" longfile=\"gnu\" compression=\"gzip\">\n  <tarfileset dir=\"/etc\" uid=\"500\" gid=\"500\" mode=\"444\" \n            dirmode=\"755\" prefix=\"my/testing/directory\">\n    <include name=\"**\"/>\n  </tarfileset>\n</tar>\n\nwould create a tar file containing \"my/testing/directory/etc\"\nwhich is correct, and etc would have the permissions I've set, but the\ndirectories my, testing, and directory are owned by root and not uid 500, as\nthey should be. This breaks with both username and uid (as well as group/gid)."}, {"count": 1, "tags": [], "text": "Additional information:\nThis has been confirmed on: \nRedHat Enterprise Server 3.0 - ant-1.6.2-2jpp.rpm - JDK 1.4.2_06-b03\nFedora Core 3/Rawhide - ant-1.6.2-3jpp_2fc.rpm - JDK 1.5.0_01-b08", "is_private": false, "id": 72161, "creation_time": "2005-03-11T02:07:59Z", "time": "2005-03-11T02:07:59Z", "creator": "wlovins@interland.com", "bug_id": 33955, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 33955, "attachment_id": null, "id": 53142, "time": "2005-03-21T09:54:22Z", "creator": "kevin.jackson@it.fts-vn.com", "creation_time": "2005-03-21T09:54:22Z", "is_private": false, "text": "I think the problem is in the tarFile method of the Tar task.  I think it has to\ndo with the fact that the prefix is simply a string (in the code) and is only\nconstructed at runtime, so inspecting the TarFileSet for the info simply\nproduces (0) for UID/GID for the directories specced in the prefix, whereas as\nsoon as the 'real' file is reached, the TarFileSet actually contains the correct\ninfo.\n\n   TarEntry te = new TarEntry(vPath); <- includes prefix as String, sets GID/UID\nto 0\n            te.setModTime(file.lastModified());\n            if (!file.isDirectory()) {\n                te.setSize(file.length());\n                te.setMode(tarFileSet.getMode());\n            } else {\n                te.setMode(tarFileSet.getDirMode());\n            }\n            te.setUserName(tarFileSet.getUserName()); <- these will be blank if\nthe directories don't exist in the initial tarFileSet passed in\n            te.setGroupName(tarFileSet.getGroup());\n            te.setUserId(tarFileSet.getUid());\n            te.setGroupId(tarFileSet.getGid());\n\nThe way to fix it is eluding me right now, but it'll probably involve managing\nthe TarFileSet/vPath in some way so that the UID/GID of the files at the leaf of\nthe tree are used to set the UID/GID of the dirs.  Just not sure how to do this\nafter scanning the code :)\n\nKev"}, {"count": 3, "text": "No the issue is that the tar file does not\nstore the directories, so the unix tar command\nhas to create the directories without information\non the directories.\n\nThis issue also exists with the standard unix tar command.\n\nif one does >tar cf test.tar test/*.xml\nthe tar file test.tar will contain\ntest/x.xml\ntest/build.xml\netc\ni.e. no entry for the \"test\" directory.\n\nI was thinking of fixing this by adding a new attribute\n - adddirectores (or something similar) to the tarfileset element.\n\nMissing this makes using uid and gid in combination with\nprefix attribute not too useful.\n\n", "bug_id": 33955, "is_private": false, "id": 53135, "time": "2005-03-21T10:30:46Z", "creator": "peterreilly@apache.org", "creation_time": "2005-03-21T10:30:46Z", "tags": [], "attachment_id": null}, {"count": 4, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "filesonly would be consistent with <zip> (but the default had to be different).\n\nThe logic inside of the <zip> task keeps track of all directories that have been\nadded and applies the same mode (extend to username ...) to the directories that\nare part of the prefix, that would apply to the directories that are part of\nthe fileset - unless the dir is already part of the archive.\n\nIn this case, my, my/testing and my/testing/directory would get uid 500 unless\nany other fileset created them before.", "id": 52392, "time": "2005-03-21T11:31:51Z", "bug_id": 33955, "creation_time": "2005-03-21T11:31:51Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 33955, "attachment_id": null, "id": 141040, "time": "2010-10-26T06:19:17Z", "creator": "bodewig@apache.org", "creation_time": "2010-10-26T06:19:17Z", "is_private": false, "text": "if filesonly is false this should work as expected with the <tar> task of the Compress Antlib."}]
[{"count": 0, "tags": [], "bug_id": 42995, "text": "ap_hook_auth_checker(check_user_access, aszPre, NULL, APR_HOOK_MIDDLE);", "id": 106036, "time": "2007-07-29T19:19:26Z", "creator": "nick@cpanel.net", "creation_time": "2007-07-29T19:19:26Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 42995, "is_private": false, "id": 106037, "creation_time": "2007-07-29T19:38:33Z", "time": "2007-07-29T19:38:33Z", "creator": "nick@cpanel.net", "text": "\n\n0x004a40da in strcmp () from /lib/tls/libc.so.6(gdb) back\n#0  0x004a40da in strcmp () from /lib/tls/libc.so.6\n#1  0x08081386 in check_user_access (r=0x9bc7820) at mod_authz_groupfile.c:134\n#2  0x0807405a in ap_run_auth_checker (r=0x9bc7820) at request.c:78\n#3  0x08075cb8 in ap_process_request_internal (r=0x9bc7820) at request.c:226\n#4  0x080b1609 in ap_process_request (r=0x9bc7820) at http_request.c:256\n#5  0x080af2b1 in ap_process_http_connection (c=0x9bbd678) at http_core.c:184\n#6  0x0807d6be in ap_run_process_connection (c=0x9bbd678) at connection.c:43\n#7  0x080c8b63 in child_main (child_num_arg=Variable \"child_num_arg\" is not\navailable.) at prefork.c:640\n#8  0x080c8d9a in make_child (s=Variable \"s\" is not available.) at prefork.c:736\n#9  0x080c8e28 in startup_children (number_to_start=2) at prefork.c:754\n#10 0x080c9673 in ap_mpm_run (_pconf=0x99c00a8, plog=0x9a0c1d8, s=0x99c7ce8) at\nprefork.c:975\n#11 0x080683d4 in main (argc=2, argv=0xbfe31674) at main.c:717(gdb)", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 42995, "is_private": false, "text": "Should this be a ap_hook_check_user_id instead of ap_hook_auth_checker.. \n\nBased on the comment on line 309 on mod_authz_host.c I'd say it does but I'm\nreally not sure when it comes to apache guts:\n    /* This can be access checker since we don't require r->user to be set. */\n\n\n", "id": 106038, "time": "2007-07-29T19:40:46Z", "creator": "nick@cpanel.net", "creation_time": "2007-07-29T19:40:46Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 42995, "text": "(In reply to comment #2)\n> Should this be a ap_hook_check_user_id instead of ap_hook_auth_checker.. \n\nNo. The check_user_id hook is for authentication. mod_authz_groupfile performs\nauthorization. Therefore it needs to be in the auth_checker hook.\nFurthermore it can only do its job in a meaningful manner if r->user is set\n(that does not mean that it should crash if r->user is NULL).\n\nCould you please provide the configuration that causes this crash?\nThis could be helpful for reproducing the crash.\n", "id": 106068, "time": "2007-07-30T12:34:05Z", "creator": "rpluem@apache.org", "creation_time": "2007-07-30T12:34:05Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": 20567, "creator": "nick@cpanel.net", "is_private": false, "id": 106069, "time": "2007-07-30T13:10:00Z", "bug_id": 42995, "creation_time": "2007-07-30T13:10:00Z", "tags": [], "text": "Created attachment 20567\nSample .htaccess file"}, {"count": 5, "tags": [], "bug_id": 42995, "is_private": false, "text": "Created attachment 20568\nsample module that make condition apparent.", "id": 106070, "time": "2007-07-30T13:11:00Z", "creator": "nick@cpanel.net", "creation_time": "2007-07-30T13:11:00Z", "attachment_id": 20568}, {"count": 6, "tags": [], "bug_id": 42995, "is_private": false, "id": 106071, "creation_time": "2007-07-30T13:12:53Z", "time": "2007-07-30T13:12:53Z", "creator": "nick@cpanel.net", "text": "The module has been stripped down the the bare minimum needed to make the\ncondition happen.\n\nTo reproduce\n\n/usr/local/apache/bin/apxs -c mod_bug.c\n/usr/local/apache/bin/apxs -i -a -n bug mod_bug.la \n\nVisit site with .htaccess (attached) installed ... make sure you have a group\nfile with anything it in.\n\n[Mon Jul 30 15:08:35 2007] [error] [client 198.66.78.2] wait for it\n[Mon Jul 30 15:08:35 2007] [notice] child pid 18505 exit signal Segmentation\nfault (11)", "attachment_id": null}, {"count": 7, "attachment_id": null, "creator": "rpluem@apache.org", "text": "Please provide a configuration that makes this problem reproducible with a\nvanilla apache. If this only occurs with third party modules it is a bug in the\nthird party module even if mod_authz_group should not seg fault. An\nauthentication module should set r->user.", "id": 106073, "time": "2007-07-30T13:51:49Z", "bug_id": 42995, "creation_time": "2007-07-30T13:51:49Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "text": "Its pretty easy to work around by setting r->user but in this case I'm just\nmaking up a value to keep it from crashing.  (r->user = \"********\")  It really\nwould be nice to not have this hack though.", "is_private": false, "bug_id": 42995, "id": 106074, "time": "2007-07-30T13:55:35Z", "creator": "nick@cpanel.net", "creation_time": "2007-07-30T13:55:35Z", "attachment_id": null}, {"count": 9, "attachment_id": null, "creator": "nick@webthing.com", "is_private": false, "id": 138535, "time": "2010-07-19T21:37:18Z", "bug_id": 42995, "creation_time": "2010-07-19T21:37:18Z", "tags": [], "text": "I've just added an extra check in trunk - if your authn returns OK without setting r->user it'll log an error and return 500.\n\nWon't propose this for backport to 2.2."}]
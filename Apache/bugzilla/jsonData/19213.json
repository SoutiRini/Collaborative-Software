[{"count": 0, "attachment_id": null, "creator": "mpo@apache.org", "is_private": false, "id": 35760, "time": "2003-04-22T09:34:56Z", "bug_id": 19213, "creation_time": "2003-04-22T09:34:56Z", "tags": [], "text": "Introduction of the o.a.t.a.util.ClasspathUtils opened the opportunity for some\nmore refactoring and enhancements.\n(see bug 18906\n see http://marc.theaimsgroup.com/?l=ant-dev&m=105066678101704&w=2)\n\nWill add a patch for ClasspathUtils and Definer...\n-marc="}, {"count": 1, "tags": [], "bug_id": 19213, "is_private": false, "text": "Created attachment 5941\ndiff file for o.a.t.a.taskdefs Definer and o.a.t.a.util.ClasspathUtils", "id": 35761, "time": "2003-04-22T09:37:08Z", "creator": "mpo@apache.org", "creation_time": "2003-04-22T09:37:08Z", "attachment_id": 5941}, {"count": 2, "tags": [], "creator": "bodewig@apache.org", "text": "I've left the public methods in (which also forced me to add some methods to\nthe new inner class of ClasspathUtils) for backwards compatibility reasons.\n\nWith a slightly modifed version I get this here when running the test\n\n    [junit] Testcase:\ntestCustomFilter(org.apache.tools.ant.filters.DynamicFilterTest):\tCaused an ERROR\n    [junit] null\n    [junit] java.lang.NullPointerException\n    [junit] \tat java.util.Hashtable.get(Hashtable.java:315)\n    [junit] \tat org.apache.tools.ant.Project$AntRefTable.getReal(Project.java:2194)\n    [junit] \tat org.apache.tools.ant.Project.addReference(Project.java:1869)\n    [junit] \tat\norg.apache.tools.ant.util.ClasspathUtils.getClassLoaderForPath(ClasspathUtils.java:198)\n    [junit] \tat\norg.apache.tools.ant.util.ClasspathUtils$Delegate.getClassLoader(ClasspathUtils.java:405)\n    [junit] \tat org.apache.tools.ant.taskdefs.Definer.createLoader(Definer.java:263)\n    [junit] \tat org.apache.tools.ant.taskdefs.Definer.execute(Definer.java:166)\n    [junit] \tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:231)\n    [junit] \tat org.apache.tools.ant.Task.perform(Task.java:399)\n    [junit] \tat org.apache.tools.ant.Target.execute(Target.java:309)\n    [junit] \tat org.apache.tools.ant.Target.performTasks(Target.java:336)\n    [junit] \tat org.apache.tools.ant.Project.executeTarget(Project.java:1404)  \n [junit] \tat\norg.apache.tools.ant.BuildFileTest.executeTarget(BuildFileTest.java:265)\n    [junit] \tat\norg.apache.tools.ant.filters.DynamicFilterTest.expectFileContains(DynamicFilterTest.java:137)\n    [junit] \tat\norg.apache.tools.ant.filters.DynamicFilterTest.testCustomFilter(DynamicFilterTest.java:84)\n", "id": 35893, "time": "2003-04-23T13:50:30Z", "bug_id": 19213, "creation_time": "2003-04-23T13:50:30Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 19213, "is_private": false, "id": 35895, "attachment_id": null, "creator": "bodewig@apache.org", "creation_time": "2003-04-23T14:14:34Z", "time": "2003-04-23T14:14:34Z", "text": "OK, I think I've fixed two thing:\n\n(1) loaderId may be null, so we better don't try to store it in project if it is.\n\n(2) getUniqueClassLoaderForPath didn't return the classloader it just created but\nnull.\n\nStill more problems, now it doesn't find the classes that are supposed to be on the\nclasspath.  More research to come, I guess.\n\n    [junit] Testcase: testCustomFilter took 0,235 sec\n    [junit] \tCaused an ERROR\n    [junit] typedef class\norg.apache.tools.ant.filters.DynamicFilterTest$CustomFilter cannot be found\n    [junit]\n/home/bodewig/ASF/jakarta/jakarta-ant/src/etc/testcases/filters/dynamicfilter.xml:19:\ntypedef class org.apache.tools.ant.filters.DynamicFilterTest$CustomFilter cannot\nbe found\n    [junit] \tat\norg.apache.tools.ant.taskdefs.Definer.addDefinition(Definer.java:251)\n\nThis class is supposed to be available in the classloader running the unit tests\nas well as the path defined as nested element in the <typedef>."}, {"count": 4, "attachment_id": null, "creator": "bodewig@apache.org", "text": "OK, getUniqueClassLoaderForPath doesn't even try to use the path it gets as\nargument.  So after all, things are looking more and more different from your\noriginal patch.\n\nAnd then there is LoaderRefTest which insists on the instanceof check you\nskipped 8-)  This same test also showed that <*def>'s loaderref attribute was\nsuddenly ignored in absence of the magic property.\n\nWhat I've committed now passes the tests and looks a little bit more robust than\nyour original submission - could you please check that I didn't break anything?\n", "id": 35901, "time": "2003-04-23T15:05:09Z", "bug_id": 19213, "creation_time": "2003-04-23T15:05:09Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 19213, "text": "Sorry for all the bugs, will investigate some time in why tests are misbehaving\non my pltaform before adding more of these patches for you to debug :-S\n\nHave checked your changes in code, will slide them under my new task and\ntypedefs this evening.  Since I changed some of the semantics myself between\nboth patches I will need to do some changing in my project in any case.\n\nThx a lot for debugging and applying.", "count": 5, "id": 35905, "time": "2003-04-23T15:35:16Z", "creator": "mpo@apache.org", "creation_time": "2003-04-23T15:35:16Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 15287, "is_private": false, "text": "I am using following code to pass in the system property. It hung when the  test\nclass run. When I comment out the <sysproperty>, the test class works fine.        \n\n        <junit printsummary=\"yes\" haltonfailure=\"no\">\n              <classpath refid=\"run.classpath\" />\n              <sysproperty key=\"CHOST\" value=\"${Conscious.host}\"/>\n              <sysproperty key=\"THOME\" value=\"${tester.home}\"/> \n              <formatter type=\"brief\" usefile=\"false\" />\n              <formatter type=\"xml\"/>\n              <batchtest fork=\"yes\" todir=\"${junit.home}\">\n                    <fileset dir=\"${build.home}/classes/\">\n                      <include name=\"**/ZcoreTest.class\"/>\n                      <exclude name=\"**/*_Test.class\"/>\n                    </fileset>\n              </batchtest>      \n        </junit>", "id": 27685, "time": "2002-12-11T20:46:46Z", "creator": "fzhu@zvolve.com", "creation_time": "2002-12-11T20:46:46Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 15287, "attachment_id": null, "is_private": false, "id": 27686, "time": "2002-12-11T20:57:11Z", "creator": "ddevienne@lgc.com", "creation_time": "2002-12-11T20:57:11Z", "text": "Your conclusions from the fact seems a bit hasty ;-)\n\nI'd say myself that setting these two Java System properties makes your code \nhang... Same fact, different conclusion that can be verified by running your \ntest outside of Ant with/without the two properties in question.\n\n--DD"}, {"count": 2, "tags": [], "bug_id": 15287, "attachment_id": null, "text": "I just ran the program using a command line and the properties appear, e.g.,\n\n  [bancroft@res:~/src/regression]$ java -classpath\n/usr/java1.3/jre/rt.jar:/usr/local/lib/junit3.7/junit.jar:/opt/zvolve/lib/zcore.jar:/usr/local/src/java/jdbc/mm.mysql-2.0.2/mysql.jar:build/classes\n-DCHOST=zbeta -DTHOME=/home/hzhu com.zvolve.ztest.common.ZcoreTest", "id": 27687, "time": "2002-12-11T21:44:49Z", "creator": "fzhu@zvolve.com", "creation_time": "2002-12-11T21:44:49Z", "is_private": false}, {"count": 3, "tags": [], "creator": "ddevienne@lgc.com", "attachment_id": null, "text": "I'm assuming you're saying it runs fine with the properties on the command line?\n\nNow try adding fork=\"true\" to your <junit>, and run it with -debug on the \ncommand line. Look at the end of the output for the command Ant will execute. \nIt should be similar to the one you just posted.\n\nIf the test still hangs when run from Ant, as your bug report states, take that \ncommand from the debug output, and run it by itself on the command line. If it \nruns, it's likely a problem with Ant... If it doesn't, then it's your test.\n\n--DD", "id": 27688, "time": "2002-12-11T21:49:56Z", "bug_id": 15287, "creation_time": "2002-12-11T21:49:56Z", "is_private": false}, {"text": "We tried repeating the test with fork=\"true\" and -debug with not change in the\nbehavior.  When run from ant, it appears to be poll'ing for something that never\nhappens.  Given a truss of the java process as called from ant, we can see :\n\n[bancroft@res:~]$ ps -aef | grep 470\nbancroft   470   444  0 16:50:04 pts/7    0:06\n/usr/local/j2sdk1_3_0/jre/bin/../bin/sparc/native_threads/java -DCHOST=zbeta.zl\n[bancroft@res:~]$ sudo truss -p 470  \nPassword:\npoll(0xFEC07A40, 0, 10)\t\t\t\t= 0\n\n  (repeats 48 times)\n\n    Received signal #14, SIGALRM, in lwp_sema_wait() [caught]\nlwp_sema_wait(0xFF37FA10)\n\t\tErr#91 ERESTART\nsigprocmask(SIG_SETMASK, 0xFED09DE4, 0x00000000) = 0\nlwp_sema_post(0xFEE0BE30)\n\t\t= 0\nsigprocmask(SIG_SETMASK, 0xFF38AD70, 0x00000000) = 0\nlwp_sema_wait(0xFEE0BE30)\n\t\t= 0\nsetcontext(0xFED096C8)\nsigprocmask(SIG_BLOCK, 0xFF37FA00, 0x00000000)\t= 0\nsigprocmask(SIG_UNBLOCK, 0xFF37FA00, 0x00000000) = 0\nlwp_sema_post(0xFF37FA10)\n\t\t= 0\nlwp_sema_wait(0xFF37FA10)\n\t\t= 0\nsigprocmask(SIG_BLOCK, 0xFF37FA00, 0x00000000)\t= 0\nsetitimer(ITIMER_REAL, 0xFED09C68, 0x00000000)\t= 0\nsigprocmask(SIG_UNBLOCK, 0xFF37FA00, 0x00000000) = 0\npoll(0xFEC07A40, 0, 10)\t\t\t\t= 0\n\n  (repeats 48 times)\n\n    Received signal #14, SIGALRM, in lwp_sema_wait() [caught]\nlwp_sema_wait(0xFF37FA10)\n\t\tErr#91 ERESTART\npoll(0xFEC07A40, 0, 10)\t\t\t\t= 0\nsigprocmask(SIG_SETMASK, 0xFED09DE4, 0x00000000) = 0\nlwp_sema_post(0xFEE0BE30)\n\t\t= 0\nsigprocmask(SIG_SETMASK, 0xFF38AD70, 0x00000000) = 0\nlwp_sema_wait(0xFEE0BE30)\n\t\t= 0\nsetcontext(0xFED096C8)\nsigprocmask(SIG_BLOCK, 0xFF37FA00, 0x00000000)\t= 0\nsigprocmask(SIG_UNBLOCK, 0xFF37FA00, 0x00000000) = 0\nlwp_sema_post(0xFF37FA10)\n\t\t= 0\nlwp_sema_wait(0xFF37FA10)\n\t\t= 0\nsigprocmask(SIG_BLOCK, 0xFF37FA00, 0x00000000)\t= 0\nsetitimer(ITIMER_REAL, 0xFED09C68, 0x00000000)\t= 0\nsigprocmask(SIG_UNBLOCK, 0xFF37FA00, 0x00000000) = 0\n\n(and so on until the process is terminated)\n", "tags": [], "bug_id": 15287, "is_private": false, "count": 4, "id": 27691, "time": "2002-12-11T22:11:56Z", "creator": "fzhu@zvolve.com", "creation_time": "2002-12-11T22:11:56Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 15287, "is_private": false, "text": "Sorry then... This is out of my league, and someone more knowlegeable than me \nshould take over troubleshoot this one. Any chance you could try the same test \non Windows or Linux to see if it's Solaris specific? --DD", "id": 27692, "time": "2002-12-11T22:20:31Z", "creator": "ddevienne@lgc.com", "creation_time": "2002-12-11T22:20:31Z", "attachment_id": null}, {"text": "We found out that it IS my code which is at fault. I have a more than one thread\nrunning and <junit> is waiting for all the threads to die before gives any\nfeedback information, the behavior is documented in the junit documentation.\nThat explains the hung part of my test. \n\nThanks for the help. Next time I will check if I had plugged in before asking\nfor help..:)", "tags": [], "bug_id": 15287, "attachment_id": null, "count": 6, "id": 27699, "time": "2002-12-12T00:01:43Z", "creator": "fzhu@zvolve.com", "creation_time": "2002-12-12T00:01:43Z", "is_private": false}, {"text": "BTW, if using junit tasks to test threaded libraries, the following helped find\nthe threads that would not die!\n\n        <junit printsummary=\"withOutAndErr\" fork=\"true\" \n               timeout=\"1000\" showoutput=\"yes\">\n              <classpath refid=\"run.classpath\" />\n              <sysproperty key=\"CHOST\" value=\"${Conscious.host}\"/>\n              <sysproperty key=\"THOME\" value=\"${tester.home}\"/> \n              <formatter type=\"brief\" usefile=\"false\" />\n              <formatter type=\"xml\"/>\n              <batchtest fork=\"yes\" todir=\"${junit.home}\">\n                    <fileset dir=\"${build.home}/classes/\">\n                      <include name=\"**/ZcoreTest.class\"/>\n                      <exclude name=\"**/*_Test.class\"/>\n                    </fileset>\n              </batchtest>      \n        </junit>       \n", "tags": [], "creator": "fzhu@zvolve.com", "attachment_id": null, "count": 7, "id": 27741, "time": "2002-12-12T15:11:13Z", "bug_id": 15287, "creation_time": "2002-12-12T15:11:13Z", "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 15287, "is_private": false, "id": 27813, "time": "2002-12-13T16:55:26Z", "creator": "fzhu@zvolve.com", "creation_time": "2002-12-13T16:55:26Z", "tags": [], "text": "When I initial an object which uses JDBC and spawns a new thread for event\nlistening on another server, the <junit> hung. I am using Ant 1.5.1, and junit\n3.8.1 on java 1.3.\n\nI had confirmed it may be an Ant issue by successfully tested the same code\nusing junit from command line. \n\nsnip:\n\n    public void testZoneManagerCreate() {\n        System.out.println(\"testZoneManagerCreate\");\n        \n        if (_testADB == null ) {\n            try {     \n                _testADB = new ADatabase(\"org.gjt.mm.mysql.Driver\",\n\"jdbc:mysql://\"+host+\":3306/zmts02\", \"hzhu\", \"password\", host);\n            }catch (Exception ex) {}\n        }\n        // Add your test code below by replacing the default call to fail.\n        //fail(\"The test case is empty.\");\n    }\n\n======\nThe output snip:\n\n[junit] Implicitly adding\n/usr/local/jakarta-ant-1.5.1/lib/junit.jar:/usr/local/jakarta-ant-1.5.1/lib/ant.jar:/usr/local/jakarta-ant-1.5.1/lib/optional.jar\nto CLASSPATH\n    [junit] Running com.zvolve.ztest.common.ZcoreTest\n    [junit] Executing '/usr/local/j2sdk1_3_0/jre/bin/java' with arguments:\n    [junit] '-DCHOST=zbeta.zlab.zvolve.net'\n    [junit] '-DTHOME=/home/hzhu'\n    [junit] '-classpath'\n    [junit]\n'/usr/local/lib/javamail-1.2/mail.jar:/usr/local/lib/junit3.7/junit.jar:/usr/local/lib/jaf-1.0.1/activation.jar:/usr/local/lib/jdbc2_0-stdext/jdbc2_0-stdext.jar:/usr/local/lib/jakarta-servletapi-4/lib/servlet.jar:/usr/local/lib/mm.mysql-2.0.10/mm.mysql-2.0.10-bin.jar:/usr/local/lib/jaxp-1.1/jaxp.jar:/usr/local/lib/jaxp-1.1/crimson.jar:/usr/local/lib/xerces-1_4_3/xerces.jar:/home/hzhu/src/regression/lib/zcore.jar:/home/hzhu/src/regression/build/classes:/usr/local/jakarta-ant-1.5.1/lib/junit.jar:/usr/local/jakarta-ant-1.5.1/lib/ant.jar:/usr/local/jakarta-ant-1.5.1/lib/optional.jar'\n    [junit] 'org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner'\n    [junit] 'com.zvolve.ztest.common.ZcoreTest'\n    [junit] 'filtertrace=true'\n    [junit] 'haltOnError=false'\n    [junit] 'haltOnFailure=false'\n    [junit]\n'formatter=org.apache.tools.ant.taskdefs.optional.junit.SummaryJUnitResultFormatter'\n    [junit] 'showoutput=false'\n    [junit]\n'formatter=org.apache.tools.ant.taskdefs.optional.junit.BriefJUnitResultFormatter'\n    [junit]\n'formatter=org.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter,/home/hzhu/src/regression/build/junit/TEST-com.zvolve.ztest.common.ZcoreTest.xml'\n    [junit] 'propsfile=/home/hzhu/src/regression/junit706228581.properties'\n    [junit] \n    [junit] The ' characters around the executable and arguments are\n    [junit] not part of the command.\nExecute:Java13CommandLauncher: Executing '/usr/local/j2sdk1_3_0/jre/bin/java'\nwith arguments:\n'-DCHOST=zbeta.zlab.zvolve.net'\n'-DTHOME=/home/hzhu'\n'-classpath'\n'/usr/local/lib/javamail-1.2/mail.jar:/usr/local/lib/junit3.7/junit.jar:/usr/local/lib/jaf-1.0.1/activation.jar:/usr/local/lib/jdbc2_0-stdext/jdbc2_0-stdext.jar:/usr/local/lib/jakarta-servletapi-4/lib/servlet.jar:/usr/local/lib/mm.mysql-2.0.10/mm.mysql-2.0.10-bin.jar:/usr/local/lib/jaxp-1.1/jaxp.jar:/usr/local/lib/jaxp-1.1/crimson.jar:/usr/local/lib/xerces-1_4_3/xerces.jar:/home/hzhu/src/regression/lib/zcore.jar:/home/hzhu/src/regression/build/classes:/usr/local/jakarta-ant-1.5.1/lib/junit.jar:/usr/local/jakarta-ant-1.5.1/lib/ant.jar:/usr/local/jakarta-ant-1.5.1/lib/optional.jar'\n'org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner'\n'com.zvolve.ztest.common.ZcoreTest'\n'filtertrace=true'\n'haltOnError=false'\n'haltOnFailure=false'\n'formatter=org.apache.tools.ant.taskdefs.optional.junit.SummaryJUnitResultFormatter'\n'showoutput=false'\n'formatter=org.apache.tools.ant.taskdefs.optional.junit.BriefJUnitResultFormatter'\n'formatter=org.apache.tools.ant.taskdefs.optional.junit.XMLJUnitResultFormatter,/home/hzhu/src/regression/build/junit/TEST-com.zvolve.ztest.common.ZcoreTest.xml'\n'propsfile=/home/hzhu/src/regression/junit706228581.properties'\n\nThe ' characters around the executable and arguments are\nnot part of the command.\n\n    [junit] Exception in thread \"main\" \n    [junit] TEST com.zvolve.ztest.common.ZcoreTest FAILED"}, {"count": 9, "tags": [], "bug_id": 15287, "is_private": false, "id": 34070, "attachment_id": null, "creator": "bodewig@apache.org", "creation_time": "2003-03-28T15:21:31Z", "time": "2003-03-28T15:21:31Z", "text": "With the comments from 2002-12-12, I think we can close this."}]
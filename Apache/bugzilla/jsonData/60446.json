[{"count": 0, "tags": [], "bug_id": 60446, "attachment_id": 34502, "id": 195369, "time": "2016-12-06T12:27:42Z", "creator": "jadedcyborg@gmail.com", "creation_time": "2016-12-06T12:27:42Z", "is_private": false, "text": "Created attachment 34502\nPatch\n\nSecretKeyCredentialHandler does not take into account the key length of the stored credentials when matching against provided credentials, which results in a failed authentication unless the key lenght is statically defined in XML to be the same as the stored credentials. A patch that is tested with the 9.0, 8.5 and 8.0 trunks is provided with this bug report. The patch includes updated unit tests.\n\n*** Steps to Reproduce ***\n\n1) In conf/server.xml put\n\n<CredentialHandler\n  className=\"org.apache.catalina.realm.SecretKeyCredentialHandler\"\n  algorithm=\"PBKDF2WithHmacSHA512\" />\n\ninside the UserDatabaseRealm element.\n\n2) generate a password digest with\n\nbin/digest.sh -a \"PBKDF2WithHmacSHA512\" -i 10000 -s 8 -k 128 -h \"org.apache.catalina.realm.SecretKeyCredentialHandler\" \"YOUR_PASSWORD\"\n\nand put inside the password attribute in conf/tomcat-users.xml for an appropiate user.\n\n3) Launch tomcat (bin/startup.sh) and go to http://localhost:8080/manager/html\n\n4) Provide the username of the user and the password YOUR_PASSWORD\n\n\n*** Actual Results ***\n\n- The user is unable to authenticate and get a 401 error\n\n\n*** Expected Results ***\n\n- The user authenticates and gain access to the management app\n\n\n*** Additional Builds and Platforms ***\n\nThe bug affects all builds since the introduction of SecretKeyCredentialHandler\n\n\n*** Additional Information ***\nPutting\n\n<CredentialHandler\n  className=\"org.apache.catalina.realm.SecretKeyCredentialHandler\"\n  algorithm=\"PBKDF2WithHmacSHA512\"\n  keyLength=\"128\" />\n\ninside conf/server.xml instead would enable the user to authenticate again, but then all users must use the same key lenght."}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Thanks for the report and the patch.\n\nA modified version of the patch was applied. The key changes were:\n- return a value indicating failure rather than throw an exception\n- correct the use of Tomcat's i18n support rather than remove it\n- formatting tweaks to better align with existing formatting conventions\n\nFixed in:\n- trunk for 9.0.0.M16 onwards\n- 8.5.x for 8.5.10 onwards\n- 8.0.x for 8.0.40 onwards", "id": 195453, "time": "2016-12-12T10:43:02Z", "bug_id": 60446, "creation_time": "2016-12-12T10:43:02Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 2875, "text": "Since I didn't get any response on this in the mailinglist on where to look \nfurther, let's make it a bit more formal... Hope I can get some extra info this \nway.. This is a copy & paste of my mail message. :\n\nThe following happens : \nWhen I do a specific scenario of servlet access then replace a servlet and \nstart-up our login servlet I get the 503 error. The servlet has status 0 and \nshould have status 3 (according to my \"debugging\". All the other servlets are \nstill working (to a certain point, because most of them depend on the servlet I \nam calling after the context is reloaded). I've been turning on debugging, \nadded my own logging etc,etc.. But still I cannot find where the actual status \nof Request is set for that specific servlet, after the reloading that is. Can \nsomeone please help me in where to exactly look for this, because I cannot find \nit anymore. Didn't see anyone complain about this problem yet, so I like to fix \nit ;-)). I'm using tc33 from cvs btw To bad my debugger is horrible else it \nwould be a little bit easier. Every\nThe problem doesn't occur when : I call servlet A go to B goto C replace B and \ngoto A again. (reloading is ok)\nThe problem occurs when : I call servlet A go to B goto C goto D replace B and \ngoto A again. (these are just my servlets, didn't test another scenario yet, I \nfirst wanted to find the problem ;-) \nHope you guys can help to help me fix the bug and learn more about the \ninternals of tomcat.. \nTIA..\n\nHere is some logging of the reloading (the strange logging is mine ;-). \n\n2001-07-27 12:08:38 - ReloadInterceptor: MVDB : after removeing context\n2001-07-27 12:08:38 - Ctx() : XXXXXXXXXXXXXXXXX CALLING CONTEXT SETSATE XXXXXXXX\nXXXXXXXXXX 0\n2001-07-27 12:08:38 - Ctx() : XXXXXXXXXXXXXXXXX LEAVING SETCONTEXT XXXXXXXXXXXXX\nXXXX0\n2001-07-27 12:08:38 - ContextManager: MVDB state ; 3 state_NEW 0\n2001-07-27 12:08:38 - LogEvents: addContext DEFAULT:/ROOT\n2001-07-27 12:08:38 - ReloadInterceptor: ADDCONTEXT in ReloadInterceptorDEFAULT:\n/ROOT\n2001-07-27 12:08:38 - Ctx() : XXXXXXXXXXXXXXXXX CALLING CONTEXT SETSATE XXXXXXXX\nXXXXXXXXXX 0\n2001-07-27 12:08:38 - Ctx() : XXXXXXXXXXXXXXXXX LEAVING SETCONTEXT XXXXXXXXXXXXX\nXXXX0\n2001-07-27 12:08:38 - ContextManager: Adding context DEFAULT:/ROOT\n2001-07-27 12:08:38 - ContextManager: after adding context the state is  : 1\n2001-07-27 12:08:38 - ReloadInterceptor: MVDB: state after adding context..3\n2001-07-27 12:08:38 - LogEvents: contextInit DEFAULT:/ROOT\n2001-07-27 12:08:38 - SimpleMapper1: SM: extension map /*.jsp Ct (*.jsp  )\nDependManager: Added /usr/local/tomcat33dev/webapps/cubic/WEB-INF/web.xml web.xm\nl\n2001-07-27 12:08:38 - Ctx() : XXXXXXXXXXXXXXXXX CALLING CONTEXT SETSATE XXXXXXXX\nXXXXXXXXXX 1\n2001-07-27 12:08:38 - Ctx() : XXXXXXXXXXXXXXXXX LEAVING SETCONTEXT XXXXXXXXXXXXX\nXXXX1\n2001-07-27 12:08:38 - ReloadInterceptor: MVDB : status of contextmap : 0 class :\n org.apache.tomcat.modules.config.PathSetter\n2001-07-27 12:08:38 - ReloadInterceptor: MVDB : status of contextmap : 0 class :\n org.apache.tomcat.modules.config.ServerXmlReader\n2001-07-27 12:08:38 - LogEvents: contextMap R(  + /servlet/cubic.adm.login + nul\nl)\n2001-07-27 12:08:38 - ReloadInterceptor: MVDB : status of contextmap : 0 class :\n org.apache.tomcat.modules.loggers.LogEvents\n2001-07-27 12:08:38 - ContextManager: Host = swami.mvdb.com\n2001-07-27 12:08:38 - ContextManager: SM: Prefix match /servlet/cubic.adm.login\n-> /servlet/cubic.adm.login/* ServletH cubic.adm.login(SW (null CN=cubic.adm.log\nin)) null\n2001-07-27 12:08:38 - SimpleMapper1: Adjust for prefix map /servlet/cubic.adm.lo\ngin\n2001-07-27 12:08:38 - SimpleMapper1: SM: After mapping R(  + /servlet/cubic.adm.\nlogin + null) ServletH cubic.adm.login(SW (null CN=cubic.adm.login))\n2001-07-27 12:08:38 - ReloadInterceptor: MVDB : status of contextmap : 0 class :\n org.apache.tomcat.modules.mappers.SimpleMapper1\n2001-07-27 12:08:38 - ContextManager: MVDB : showing servlet error", "id": 4105, "time": "2001-07-29T04:58:46Z", "creator": "mvdb@mvdb.com", "creation_time": "2001-07-29T04:58:46Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "cmanolache@yahoo.com", "text": "Looks like a very strange reloading scenario. I can't reproduce it ( a simple\nself-contained war would help, but I don't have too much time right now ).\nI would add some printlns() in ServletHandler, see what's actually happening.\n\nWhen a change is detected, the \"correct\" behavior is:\n- remove the context ( that should destroy() all servlets that were inited) \n- reload the context, in the same way as a new context.\n( with an additional \"save/restore\" session data done in ReloadIntereptor ).\n\nLet me know if you get more data, thanks for investigating this ( and I hope\nwe'll have an expert in reloading to ask for simpler problems :-)", "id": 4244, "time": "2001-08-02T13:32:38Z", "bug_id": 2875, "creation_time": "2001-08-02T13:32:38Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 2875, "text": "Changed the priority, mark it as later. This is a very special case, there are \nbigger issues to solve. If we get a fix we should add it, of course.", "id": 4246, "attachment_id": null, "creator": "cmanolache@yahoo.com", "creation_time": "2001-08-02T15:19:24Z", "time": "2001-08-02T15:19:24Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 2875, "attachment_id": null, "id": 7974, "time": "2001-11-16T00:53:02Z", "creator": "martin@isallineed.org", "creation_time": "2001-11-16T00:53:02Z", "is_private": false, "text": "Switching status.."}, {"count": 4, "tags": [], "bug_id": 2875, "attachment_id": null, "id": 7975, "time": "2001-11-16T00:54:32Z", "creator": "martin@isallineed.org", "creation_time": "2001-11-16T00:54:32Z", "is_private": false, "text": "I verified the changes you made to SimpleMapper1 (at least a commit you did a \nwhile ago) which was not releasing all the loaded servlet. The problem because \nof this fix, is not there anymore and I am a very happy person ;))"}]
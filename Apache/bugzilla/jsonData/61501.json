[{"count": 0, "tags": [], "text": "I've setup a reverse proxy that's protected using OpenAM and using mod_ssl, mod_proxy_html and mod_openam.so (Source code: https://stash.forgerock.org/projects/OPENAM/repos/web-agents-public/browse) \n\nWhen you go to this site it correctly redirects to the OpenAM login page and redirects back to the site upon successful logon - that page then refuses to load\n\nIt will timeout based on the ProxyPass timeout values and chrome will show a \u201cERR_CONTENT_LENGTH_MISMATCH\u201d (with Chrome < 61) or a blank page on other browsers\n\nIf I restart apache (sometimes several times) it will start working and remain working until its restarted\n\nWhen it's in a broken state and I do a wget on an unprotected URL it receives a 200 response but doesn't download anything:\n\nwget https://proxysite.example.com:443/master-pages/css/buttons.css\n--2017-09-07 11:36:44--  https://proxysite.example.com:443/master-pages/css/buttons.css\nResolving proxysite.example.com (proxysite.example.com)... 1.2.3.4\nConnecting to proxysite.example.com (proxysite.example.com)|1.2.3.4|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 60150 (59K) [text/css]\nSaving to: \u2018buttons.css\u2019\n\n 0% [                                                                                                                                                                                                 ] 0           --.-K/s   in 4.8s\n\n2017-09-07 11:36:49 (0.00 B/s) - Connection closed at byte 0. Retrying.\n\n \n\nI've found someone else with the same issue: https://serverfault.com/questions/870185/apache-restart-cause-proxy-httperror-pid-120502-70008partial-results-are\n\nI'm including my configs and the working and broken logs with trace6 enabled", "is_private": false, "id": 200723, "creation_time": "2017-09-07T10:38:41Z", "time": "2017-09-07T10:38:41Z", "creator": "mike@fireburn.co.uk", "bug_id": 61501, "attachment_id": null}, {"count": 1, "tags": [], "creator": "mike@fireburn.co.uk", "attachment_id": 35304, "id": 200724, "time": "2017-09-07T10:39:07Z", "bug_id": 61501, "creation_time": "2017-09-07T10:39:07Z", "is_private": false, "text": "Created attachment 35304\nhttpd.conf"}, {"attachment_id": 35305, "tags": [], "bug_id": 61501, "text": "Created attachment 35305\nssl.conf", "count": 2, "id": 200725, "time": "2017-09-07T10:39:26Z", "creator": "mike@fireburn.co.uk", "creation_time": "2017-09-07T10:39:26Z", "is_private": false}, {"count": 3, "attachment_id": 35306, "bug_id": 61501, "text": "Created attachment 35306\nssosite.conf", "id": 200726, "time": "2017-09-07T10:39:49Z", "creator": "mike@fireburn.co.uk", "creation_time": "2017-09-07T10:39:49Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 61501, "attachment_id": 35307, "id": 200727, "time": "2017-09-07T10:40:08Z", "creator": "mike@fireburn.co.uk", "creation_time": "2017-09-07T10:40:08Z", "is_private": false, "text": "Created attachment 35307\nproxysite.conf"}, {"attachment_id": 35308, "tags": [], "bug_id": 61501, "is_private": false, "count": 5, "id": 200728, "time": "2017-09-07T10:41:52Z", "creator": "mike@fireburn.co.uk", "creation_time": "2017-09-07T10:41:52Z", "text": "Created attachment 35308\nLog with issue (trace6)"}, {"count": 6, "tags": [], "text": "Created attachment 35309\nLog without issue (trace6)", "attachment_id": 35309, "id": 200729, "creator": "mike@fireburn.co.uk", "time": "2017-09-07T10:42:15Z", "bug_id": 61501, "creation_time": "2017-09-07T10:42:15Z", "is_private": false}, {"count": 7, "tags": [], "creator": "mike@fireburn.co.uk", "attachment_id": null, "text": "My first comment should read mod_http not mod_html\n\nIf there's any other info required of tracing option I can enable to help pinpoint this issue please let me know", "id": 200730, "time": "2017-09-07T10:45:36Z", "bug_id": 61501, "creation_time": "2017-09-07T10:45:36Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 61501, "attachment_id": null, "id": 200731, "time": "2017-09-07T12:23:29Z", "creator": "rpluem@apache.org", "creation_time": "2017-09-07T12:23:29Z", "is_private": false, "text": "Your backend does not deliver the content:\n\n[Wed Sep 06 14:08:21.317841 2017] [ssl:trace4] [pid 20072:tid 139774713394944] ssl_engine_io.c(2211): [remote 4.3.2.1:443] OpenSSL: I/O error, 5 bytes expected to read on BIO#7f1f80009740 [mem: 7f1f8000f573]\n\nTry to do a network sniff between reverse proxy and backend to see what happens on TCP layer."}, {"count": 9, "tags": [], "creator": "mike@fireburn.co.uk", "attachment_id": null, "text": "That seems logical, however I'm still able to go to the site that I'm proxying directly, and only a stopping and starting the apache reverse proxy fixes the issue.  I'd expect a problem with the backend to show when communicating directly or at least be fixed by doing a refresh on the browser, not a restart of the apache reverse proxy\n\nI'll need  to get root access of the server to try and get a tcpdump. I'll attach it when I've got that done\n\nIs there any other debugging options I can use to get more information out?", "id": 200732, "time": "2017-09-07T12:43:25Z", "bug_id": 61501, "creation_time": "2017-09-07T12:43:25Z", "is_private": false}, {"count": 10, "tags": [], "creator": "mike@fireburn.co.uk", "attachment_id": null, "id": 200802, "time": "2017-09-11T10:49:28Z", "bug_id": 61501, "creation_time": "2017-09-11T10:49:28Z", "is_private": false, "text": "The issue was introduced in the web agent module when HEAD was added in https://github.com/apache/httpd/commit/1485d64698ef816f1586e2d772c58cb9b78c788d\n\nThe bug is listed here https://bugster.forgerock.org/jira/browse/AMAGENTS-349\n\nTheir fix hasn't been open sourced yet but should be if they release the binaries as they use the CDDL licence\n\nI've got a fix for the agent here:\n\nhttps://github.com/FireBurn/web-agents-public/commit/67b27d8a77ce28ad5bee95842136050bb52577ae\n\nI imagine other uses of ap_method_name_of might fall foul of this"}, {"count": 11, "tags": [], "bug_id": 61501, "attachment_id": null, "id": 200810, "time": "2017-09-11T23:47:50Z", "creator": "mike@fireburn.co.uk", "creation_time": "2017-09-11T23:47:50Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of bug 60706 ***"}]
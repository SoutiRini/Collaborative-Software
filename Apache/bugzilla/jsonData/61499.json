[{"count": 0, "tags": [], "bug_id": 61499, "text": "TCP based healthchecks that functioned in 2.4.25 are failing as of 2.4.27\n\nConfiguration example:\n<Proxy balancer://default>\n  ProxyHCTemplate tcpvarnish hcmethod=tcp hcinterval=2 hcpasses=3 hcinterval=2\n  BalancerMember http://172.28.211.254:6081 loadfactor=95 hctemplate=tcpvarnish\n  BalancerMember http://172.28.212.107:6081 loadfactor=5 hctemplate=tcpvarnish\n</Proxy>\n\nProxyPass \"/balancer-manager\" !\nProxyPass \"/\" \"balancer://default/\"\nProxyPassReverse \"/\" \"balancer://default/\"\nProxyPreserveHost on\n\n<Location '/balancer-manager'>\n    SetHandler balancer-manager\n    Require all denied\n    Require ip 172.16.0.0/12\n</Location>\n\nConfig worked perfectly in 2.4.25 and prior.  After updating to 2.4.27, the balancer manager shows \"Init HcFl\" for both balancer members.  I do not see the TCP health checks actually attempting to run if I examine via tcpdump.  Reverting to 2.4.25 fixes issue.\n\nHappens in amzn-linux build as well as a build from source.\n\ntcpdump on the host that should be receiving the check is showing no activity.\n\nDebug logs show the following:\n[Wed Sep 06 17:40:51.549378 2017] [proxy:debug] [pid 4058:tid 140411104278272] proxy_util.c(2156): AH00942: HCTCP: has acquired connection for (172.28.211.254)\n[Wed Sep 06 17:40:51.549380 2017] [proxy:debug] [pid 4058:tid 140411028743936] proxy_util.c(2156): AH00942: HCTCP: has acquired connection for (172.28.212.107)\n[Wed Sep 06 17:40:51.549382 2017] [proxy:debug] [pid 4058:tid 140411104278272] proxy_util.c(2171): AH00943: HCTCP: has released connection for (172.28.211.254)\n[Wed Sep 06 17:40:51.549384 2017] [proxy:debug] [pid 4058:tid 140411028743936] proxy_util.c(2171): AH00943: HCTCP: has released connection for (172.28.212.107)\n[Wed Sep 06 17:40:51.549396 2017] [proxy_hcheck:debug] [pid 4058:tid 140411104278272] mod_proxy_hcheck.c(561): AH03251: Health check TCP Status (-1) for 562e10aa0f40.\n[Wed Sep 06 17:40:51.549399 2017] [proxy_hcheck:debug] [pid 4058:tid 140411028743936] mod_proxy_hcheck.c(561): AH03251: Health check TCP Status (-1) for 562e10aa1520.\n\nroot@172.28.211.167 (testwaf) [httpd]# nmap -p 6081 172.28.212.107\n\nStarting Nmap 6.40 ( http://nmap.org ) at 2017-09-06 17:55 UTC\nNmap scan report for ip-172-28-212-107.ec2.internal (172.28.212.107)\nHost is up (0.0013s latency).\nPORT     STATE SERVICE\n6081/tcp open  unknown", "id": 200714, "time": "2017-09-06T18:26:11Z", "creator": "michael.c.jackson@gmail.com", "creation_time": "2017-09-06T18:26:11Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 61499, "is_private": false, "text": "Hi,\n\nit might be due to https://github.com/apache/httpd/commit/77ebb516535eecd90b458c52647b08a4da82e84e\n\nAny chance that you could try the 'no-proxy' variable via SetEnvIf?", "id": 201773, "time": "2017-10-29T21:32:17Z", "creator": "toscano.luca@gmail.com", "creation_time": "2017-10-29T21:32:17Z", "attachment_id": null}]
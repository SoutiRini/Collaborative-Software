[{"count": 0, "attachment_id": null, "bug_id": 54030, "is_private": false, "id": 162835, "time": "2012-10-19T21:40:42Z", "creator": "michael@weiser.dinsnail.net", "creation_time": "2012-10-19T21:40:42Z", "tags": [], "text": "A reverse proxy with SSLProxyCheckPeerCN turned on does not support certificates with subjectAltName:DNS extensions as of 2.4.3 and latest trunk. The attached patches seem to make that work for 2.4.2 and trunk. trunk already has some limited wildcard matching which is superseded by this patch. There is some mild code duplication since the logic is stolen from modules/ssl/ssl_engine_init.c:ssl_check_public_cert()."}, {"count": 1, "tags": [], "bug_id": 54030, "attachment_id": 29499, "id": 162836, "time": "2012-10-19T21:41:18Z", "creator": "michael@weiser.dinsnail.net", "creation_time": "2012-10-19T21:41:18Z", "is_private": false, "text": "Created attachment 29499\nsubjectAltName support for httpd-2.4.2"}, {"count": 2, "tags": [], "bug_id": 54030, "attachment_id": 29500, "id": 162837, "time": "2012-10-19T21:41:49Z", "creator": "michael@weiser.dinsnail.net", "creation_time": "2012-10-19T21:41:49Z", "is_private": false, "text": "Created attachment 29500\nsubjectAltName support for httpd-trunk-20121019"}, {"attachment_id": null, "tags": [], "bug_id": 54030, "is_private": false, "count": 3, "id": 163074, "time": "2012-10-31T07:33:09Z", "creator": "asfbugz@velox.ch", "creation_time": "2012-10-31T07:33:09Z", "text": "See also bug 53006.\n\nSome preliminary comments about the patch: we really want to avoid duplicating code from ssl_check_public_cert() - there should be a single check_ID(...) function instead (i.e. the code should be factored out to ssl_util_ssl.c, ideally).\n\nIn the following two log messages, there's a misconception about what a \"DN\" really is in the context of an X.509 certificate:\n\n+                ap_log_cerror(APLOG_MARK, APLOG_INFO, 0, c, APLOGNO()\n+                              \"SSL Proxy: Failure to extract DNs from\"\n+                              \" peer certificate.\"\n+                              \" Requested hostname: %s\", \n\n\n                 ap_log_cerror(APLOG_MARK, APLOG_INFO, 0, c, APLOGNO(02005)\n                               \"SSL Proxy: Peer certificate CN mismatch:\"\n-                              \" Certificate CN: %s Requested hostname: %s\",\n-                              hostname, hostname_note);\n+                              \" Requested hostname: %s.\"\n+                              \" Last DN checked: %s.\",\n+                              hostname_note, id[i-1]);\n\n\nDN is short for \"distinguished name\" (not \"domain name\"), and a certificate only has a single subject DN and a single issuer DN (for host name checks, the former is relevant).\n\nRight now the name of the directive is \"SSLProxyCheckPeerCN\", so the code is currently doing what the documentation states (\"Whether to check the remote server certificates CN field\"). I agree that checking against subjectAltName entries is highly desirable (in the spirit of RFC 6125), but we might want to introduce a separate directive for this purpose (and deprecate SSLProxyCheckPeerCN)."}, {"count": 4, "tags": [], "text": "Complete agreement. To be clear: Are you inclinded (and have the time) to implement those changes yourself or are you challenging me to update the patch? If the latter: I can certainly try the refactoring and terminology cleanup but feel ill equipped to add a config option because of all the further infrastructure knowledge required for that.", "attachment_id": null, "bug_id": 54030, "id": 163099, "time": "2012-10-31T18:22:37Z", "creator": "michael@weiser.dinsnail.net", "creation_time": "2012-10-31T18:22:37Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 54030, "is_private": false, "count": 5, "id": 163171, "time": "2012-11-05T06:28:48Z", "creator": "asfbugz@velox.ch", "creation_time": "2012-11-05T06:28:48Z", "text": "(In reply to comment #4)\n> Are you inclinded (and have the time) to implement those changes yourself\n\nNot within a short-term timeframe (say, this month), but mid-term, yes."}, {"count": 6, "tags": [], "creator": "asfbugz@velox.ch", "attachment_id": null, "is_private": false, "id": 164245, "time": "2012-12-26T11:01:13Z", "bug_id": 54030, "creation_time": "2012-12-26T11:01:13Z", "text": "I have implemented this in trunk with r1425874 - testing would be appreciated."}, {"count": 7, "tags": [], "creator": "michael@weiser.dinsnail.net", "attachment_id": null, "text": "Sorry for the sluggish response. I've tested and it seems to work nicely with current head. Thanks!\n\nCan this be backported to 2.4?", "id": 164528, "time": "2013-01-09T16:06:15Z", "bug_id": 54030, "creation_time": "2013-01-09T16:06:15Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 54030, "attachment_id": null, "id": 164655, "time": "2013-01-16T06:44:58Z", "creator": "asfbugz@velox.ch", "creation_time": "2013-01-16T06:44:58Z", "is_private": false, "text": "(In reply to comment #7)\n> Can this be backported to 2.4?\n\nYes, proposed for 2.4 with r1433834."}, {"count": 9, "tags": [], "creator": "ylavic.dev@gmail.com", "attachment_id": null, "text": "Backported to 2.4.5 in r1485667.", "id": 189514, "time": "2016-03-16T20:15:33Z", "bug_id": 54030, "creation_time": "2016-03-16T20:15:33Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 45199, "attachment_id": 22122, "id": 117655, "time": "2008-06-13T01:22:12Z", "creator": "achim.westermann@gmx.de", "creation_time": "2008-06-13T01:22:12Z", "is_private": false, "text": "Created attachment 22122\nscreenshot of recorded samples\n\nSetup: \n\nVersion: 2.3.1 started with proxy settings via command line. \nOS:  XP\nJava :  1.6.0_06-b02 \nBrowser:  Firefox 2.0.0.14\nBrowser:  Internet Explorer 6.0.29xxx \nWebsites: http://www.k-plus-s.com, http://jakarta.apache.org/jmeter/\n\nC:\\java\\jakarta-jmeter-2.3.1\\bin>jmeter.bat -H http-proxy-xxxxx.net -P 8080 -N localhost\n\n\nActions: \n\nA proxy on port 9090 was set up with an inclusion of '.*' and started. Both browswers were tested. Every character that was recorded was filled prefixed by ${} like shown in the screenshot. \n\nResult: \nThe jmeter.log looks OK: \n\n2008/06/13 10:04:14 INFO  - jmeter.protocol.http.proxy.Daemon: Creating Daemon Socket... on port 9090 \n2008/06/13 10:04:14 INFO  - jmeter.protocol.http.proxy.Daemon: Proxy up and running! \n\n\nThe following stacktrace is shown on the console: \n\nException in thread \"Thread-7\" java.lang.OutOfMemoryError: Java heap space\n        at java.util.Arrays.copyOf(Unknown Source)\n        at java.lang.AbstractStringBuilder.expandCapacity(Unknown Source)\n        at java.lang.AbstractStringBuilder.append(Unknown Source)\n        at java.lang.StringBuffer.append(Unknown Source)\n        at org.apache.jmeter.util.StringUtilities.substitute(StringUtilities.java:47)\n        at org.apache.jmeter.engine.util.ReplaceFunctionsWithStrings.transformValue(ReplaceFunctionsWithStrings.java:92)\n        at org.apache.jmeter.engine.util.ValueReplacer.replaceValues(ValueReplacer.java:121)\n        at org.apache.jmeter.engine.util.ValueReplacer.reverseReplace(ValueReplacer.java:85)\n        at org.apache.jmeter.protocol.http.proxy.ProxyControl.replaceValues(ProxyControl.java:867)\n        at org.apache.jmeter.protocol.http.proxy.ProxyControl.deliverSampler(ProxyControl.java:385)\n        at org.apache.jmeter.protocol.http.proxy.Proxy.run(Proxy.java:241)\nException in thread \"Thread-22\" java.lang.OutOfMemoryError: Java heap space\n        at java.util.Arrays.copyOf(Unknown Source)\n        at java.lang.AbstractStringBuilder.expandCapacity(Unknown Source)\n        at java.lang.AbstractStringBuilder.append(Unknown Source)\n        at java.lang.StringBuffer.append(Unknown Source)\n        at org.apache.jmeter.util.StringUtilities.substitute(StringUtilities.java:47)\n        at org.apache.jmeter.engine.util.ReplaceFunctionsWithStrings.transformValue(ReplaceFunctionsWithStrings.java:92)\n        at org.apache.jmeter.engine.util.ValueReplacer.replaceValues(ValueReplacer.java:121)\n        at org.apache.jmeter.engine.util.ValueReplacer.reverseReplace(ValueReplacer.java:85)\n        at org.apache.jmeter.protocol.http.proxy.ProxyControl.replaceValues(ProxyControl.java:867)\n        at org.apache.jmeter.protocol.http.proxy.ProxyControl.deliverSampler(ProxyControl.java:385)\n        at org.apache.jmeter.protocol.http.proxy.Proxy.run(Proxy.java:241)\nException in thread \"Thread-24\" java.lang.OutOfMemoryError: Java heap space\n        at java.util.Arrays.copyOf(Unknown Source)\n        at java.lang.AbstractStringBuilder.expandCapacity(Unknown Source)\n        at java.lang.AbstractStringBuilder.append(Unknown Source)\n        at java.lang.StringBuffer.append(Unknown Source)\n        at org.apache.jmeter.util.StringUtilities.substitute(StringUtilities.java:47)\n        at org.apache.jmeter.engine.util.ReplaceFunctionsWithStrings.transformValue(ReplaceFunctionsWithStrings.java:92)\n        at org.apache.jmeter.engine.util.ValueReplacer.replaceValues(ValueReplacer.java:121)\n        at org.apache.jmeter.engine.util.ValueReplacer.reverseReplace(ValueReplacer.java:85)\n        at org.apache.jmeter.protocol.http.proxy.ProxyControl.replaceValues(ProxyControl.java:867)\n        at org.apache.jmeter.protocol.http.proxy.ProxyControl.deliverSampler(ProxyControl.java:385)\n        at org.apache.jmeter.protocol.http.proxy.Proxy.run(Proxy.java:241)\nException in thread \"Thread-23\" java.lang.OutOfMemoryError: Java heap space\n        at java.util.Arrays.copyOf(Unknown Source)\n        at java.lang.AbstractStringBuilder.expandCapacity(Unknown Source)\n        at java.lang.AbstractStringBuilder.append(Unknown Source)\n        at java.lang.StringBuffer.append(Unknown Source)\n        at org.apache.jmeter.util.StringUtilities.substitute(StringUtilities.java:47)\n        at org.apache.jmeter.engine.util.ReplaceFunctionsWithStrings.transformValue(ReplaceFunctionsWithStrings.java:92)\n        at org.apache.jmeter.engine.util.ValueReplacer.replaceValues(ValueReplacer.java:121)\n        at org.apache.jmeter.engine.util.ValueReplacer.reverseReplace(ValueReplacer.java:85)\n        at org.apache.jmeter.protocol.http.proxy.ProxyControl.replaceValues(ProxyControl.java:867)\n        at org.apache.jmeter.protocol.http.proxy.ProxyControl.deliverSampler(ProxyControl.java:385)\n        at org.apache.jmeter.protocol.http.proxy.Proxy.run(Proxy.java:241)\nException in thread \"Thread-21\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-20\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-19\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-18\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-17\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-16\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-15\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-14\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-12\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-13\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-11\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-8\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-10\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-9\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-69\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-67\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-68\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-66\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-65\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-64\" java.lang.OutOfMemoryError: Java heap space\nException in thread \"Thread-63\" java.lang.OutOfMemoryError: Java heap space"}, {"count": 1, "tags": [], "creator": "achim.westermann@gmx.de", "attachment_id": null, "text": "The comman \"set HEAP=-Xms256m -Xmx1024m\" in jmeter.bat shows the same result. The java process takes up to 1 GB. \n\nIn the proxy settings of JMeter the checkbox \"regex matching\" had to be checked or nothing would be recored, even if the browser used the JMeter proxy (stopping it would cause the browser to fail getting a response). ", "id": 117656, "time": "2008-06-13T01:41:21Z", "bug_id": 45199, "creation_time": "2008-06-13T01:41:21Z", "is_private": false}, {"count": 2, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "Regex matching has nothing to do with the proxy recording itself.\n\nIt only affects how the requests are processed when replacing variables.\n\nHave you defined any variables on the Test Plan?\n\nIt looks like the variable replacer has been confused by something.", "id": 117657, "time": "2008-06-13T02:18:59Z", "bug_id": 45199, "creation_time": "2008-06-13T02:18:59Z", "is_private": false}, {"count": 3, "tags": [], "creator": "achim.westermann@gmx.de", "is_private": false, "id": 117658, "creation_time": "2008-06-13T02:43:52Z", "time": "2008-06-13T02:43:52Z", "bug_id": 45199, "text": "Hi Sebb, \n\nI narrowed it down a bit. \nI did not define any variables. \n\nI found out that this happens when my Thread Group has a \"View Result Tree\" Listener attached while recording. If I remove it, recording works fine. \n\nSo: \n\n- Add a Thread Group\n- Add a Proxy to the workplace. Change nothing but port to 9090 (should not matter) and select the Target Controller \"testplanname -> Thread Group. \n- Add a Listener of type \"View Result Tree\". \n\n- Start the proxy. \n- Point your browser to localhost:9090 in proxy settings. \n\n-> After clicking the first link, cpu load rises and after approx. 20 seconds on a core 2 duo 2GHZ, 2GB RAM the 1 GB limit is reached and you should get the exception. \n\nkind regards, \n\nAchim", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 45199, "attachment_id": null, "is_private": false, "id": 117659, "time": "2008-06-13T03:00:02Z", "creator": "sebb@apache.org", "creation_time": "2008-06-13T03:00:02Z", "text": "Just tried that, and it works fine for me when testing against www.apache.org, Google and BBC news.\n\nDoes it happen to you for these sites?\nOr only some sites?\n\nAre you still using the JMeter command-line proxy settings?\n\nIf so, can you try it without?\n\n\nBTW, if you want to see the pages as they are recorded by the proxy, add the listener to the proxy server."}, {"count": 5, "tags": [], "bug_id": 45199, "attachment_id": null, "is_private": false, "id": 117660, "time": "2008-06-13T03:39:52Z", "creator": "achim.westermann@gmx.de", "creation_time": "2008-06-13T03:39:52Z", "text": "Thanks for your patience. \n\nThis time I took more time to isolate the error. It seems to be as you said in first place.\n\n- Just click the add button in the top - level test plan. A user defined var is created. Leave it empty. \n\n- Now start the proxy session. Record to a Thread group. \n\n--> The error should occur. \n\n- This happens also when starting JMeter without proxy settings (had to test with localhost tomcat). \n\n\nkind regards, \n\nAchim\n"}, {"count": 6, "tags": [], "creator": "geoboy88@yahoo.com", "attachment_id": null, "text": "I just spent a long and frustrating day debugging my script to find this bug: ${} insertion and \"out of memory\" error. Please fix this bug!", "id": 117686, "time": "2008-06-13T16:31:43Z", "bug_id": 45199, "creation_time": "2008-06-13T16:31:43Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 45199, "attachment_id": null, "id": 117687, "time": "2008-06-13T18:36:22Z", "creator": "sebb@apache.org", "creation_time": "2008-06-13T18:36:22Z", "is_private": false, "text": "Fixed in SVN r66718"}, {"count": 8, "tags": [], "creator": "achim.westermann@gmx.de", "attachment_id": null, "text": "Thanks a lot!", "id": 117691, "time": "2008-06-14T07:34:45Z", "bug_id": 45199, "creation_time": "2008-06-14T07:34:45Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "When using Tomcat and the default pub, uploading and then inserting an image in\nBXE fails to display the image (only the Caption shows).  However, once the page\nhas been saved the image is rendered correctly, even when it is opened again in BXE.\n\nAfter inserting the image and looking at the html source, the object tag's data\npath is missing the contextPath (i.e. /default/authoring/.. instead of\n/lenya/default/authoring/..).  I've attached a couple of screenshots.", "attachment_id": null, "id": 98767, "creator": "jonathan.addison@wyona.com", "time": "2007-01-30T10:15:21Z", "bug_id": 41499, "creation_time": "2007-01-30T10:15:21Z", "is_private": false}, {"count": 1, "tags": [], "creator": "jonathan.addison@wyona.com", "is_private": false, "text": "Created attachment 19485\njpg", "id": 98769, "time": "2007-01-30T10:15:59Z", "bug_id": 41499, "creation_time": "2007-01-30T10:15:59Z", "attachment_id": 19485}, {"count": 2, "tags": [], "creator": "jonathan.addison@wyona.com", "attachment_id": 19486, "text": "Created attachment 19486\njpg2", "id": 98770, "time": "2007-01-30T10:16:25Z", "bug_id": 41499, "creation_time": "2007-01-30T10:16:25Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 41499, "text": "Has anyone been able to confirm this?", "id": 99138, "attachment_id": null, "creator": "jonathan.addison@wyona.com", "creation_time": "2007-02-08T14:42:23Z", "time": "2007-02-08T14:42:23Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 41499, "attachment_id": null, "is_private": false, "id": 99424, "time": "2007-02-15T08:53:51Z", "creator": "andreas@apache.org", "creation_time": "2007-02-15T08:53:51Z", "text": "I can confirm the problem."}, {"count": 5, "tags": [], "creator": "jonathan.addison@wyona.com", "attachment_id": null, "text": "Thanks Andreas, I'm actually almost finished with a patch.\n\nIt turns out it affects more than just inserting the images, but also how the\nobject tag is translated in general when passing through Lenya.", "id": 99425, "time": "2007-02-15T08:56:53Z", "bug_id": 41499, "creation_time": "2007-02-15T08:56:53Z", "is_private": false}, {"count": 6, "tags": [], "creator": "jonathan.addison@wyona.com", "is_private": false, "text": "Created attachment 19600\nfix for image path problems when running Lenya in Tomcat\n\n* reenables change-object-path.xsl and change-object-path-back.xsl, which were\nno longer being used in the WebDAV sitemaps.\n* change-object-path.xsl adds contextPath to the path of images when viewing a\nfile or loading it in BXE, and change-object-path-back.xsl removes the\ncontextPath upon saving the document.  This keeps the object's @data path\n\"contextPath free\" so that it works on both Jetty and Tomcat.\n* passes contextPath to the relevant XSLT files in the xhtml module.\n* updates kupu module sitemap and content2edit.xsl with the same changes as\nBXE.", "id": 99426, "time": "2007-02-15T09:28:38Z", "bug_id": 41499, "creation_time": "2007-02-15T09:28:38Z", "attachment_id": 19600}, {"count": 7, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "text": "I'm currently changing the LinkConverter:\n\n    /**\n     * Converts all URL-based links to UUID-based links.\n     * @param doc The document to convert.\n     * @param useContextPath If the request's context path should be considered.\n     */\n    public void convertUrlsToUuids(Document doc, boolean useContextPath) {\n\nI hope this helps ...", "id": 99427, "time": "2007-02-15T09:33:05Z", "bug_id": 41499, "creation_time": "2007-02-15T09:33:05Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 41499, "text": "I should also mention that the image2svg.xsl stylesheet in the default pub\nsitemap is causing problems with images from /resources/shared/images.\n\nIf I comment out this line..\n<!--<map:transform src=\"fallback://lenya/modules/svg/xslt/image2svg.xsl\"/>-->\n\n..the images appear correctly.\n\nI can open a new bug if anyone else can confirm this.", "id": 99428, "time": "2007-02-15T09:34:52Z", "creator": "jonathan.addison@wyona.com", "creation_time": "2007-02-15T09:34:52Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 41499, "text": "Hi Andreas,\n\nIIUC, fixing the link converter may help for some images (those that have been\nuploaded), but it won't work for those in /resources/shared/images/.", "id": 99429, "time": "2007-02-15T09:36:26Z", "creator": "jonathan.addison@wyona.com", "creation_time": "2007-02-15T09:36:26Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "text": "Also, won't adding the contextPath in the LinkConverter create a @data path\nwhich contains the contextPath.\n\nThis would make those object tags incompatible with Jetty right?\n\nI thought the goal was for the xml content to not need any contextPath\ninformation.  Or maybe I've misunderstood something.", "is_private": false, "id": 99431, "creator": "jonathan.addison@wyona.com", "time": "2007-02-15T09:38:37Z", "bug_id": 41499, "creation_time": "2007-02-15T09:38:37Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 41499, "attachment_id": null, "text": "Sorry that I didn't apply the patch - IMO the LinkConverter approach is the most\ngeneric one, since it is used for all content which contains URL-based links and\ndoesn't require any XSLT. I'd like your opinion, though, so I don't close the\nbug yet.\n\nPlease test! :)", "id": 99432, "time": "2007-02-15T09:45:43Z", "creator": "andreas@apache.org", "creation_time": "2007-02-15T09:45:43Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 41499, "is_private": false, "id": 99433, "attachment_id": null, "creator": "andreas@apache.org", "creation_time": "2007-02-15T09:51:06Z", "time": "2007-02-15T09:51:06Z", "text": "(In reply to comment #9)\n> Hi Andreas,\n> \n> IIUC, fixing the link converter may help for some images (those that have been\n> uploaded), but it won't work for those in /resources/shared/images/.\n\nIMO these shouldn't be referenced by URLs in documents. For these static images,\nI'd rather use a special syntax (e.g., <mynamespace:image id=\"logo\"/>)."}, {"count": 13, "tags": [], "bug_id": 41499, "text": "(In reply to comment #10)\n> Also, won't adding the contextPath in the LinkConverter create a @data path\n> which contains the contextPath.\n> \n> This would make those object tags incompatible with Jetty right?\n> \n> I thought the goal was for the xml content to not need any contextPath\n> information.  Or maybe I've misunderstood something.\n\nThe URL is generated on the fly when the document is delivered to BXE, the XML\nsource contains only UUID-based links. So it shouldn't be a problem to deliver\nthe same content with Jetty or Tomcat (actually my Tomcat points to\n$LENYA_HOME/build/lenya/webapp, so I can test if the same content works with\nboth of them).", "id": 99434, "time": "2007-02-15T09:53:30Z", "creator": "andreas@apache.org", "creation_time": "2007-02-15T09:53:30Z", "is_private": false, "attachment_id": null}, {"count": 14, "tags": [], "bug_id": 41499, "attachment_id": null, "text": "(In reply to comment #12)\n> (In reply to comment #9)\n> > Hi Andreas,\n> > \n> > IIUC, fixing the link converter may help for some images (those that have been\n> > uploaded), but it won't work for those in /resources/shared/images/.\n> \n> IMO these shouldn't be referenced by URLs in documents. For these static images,\n> I'd rather use a special syntax (e.g., <mynamespace:image id=\"logo\"/>).\n\n\nOk, but this special syntax does not exist ;).\n\nUp until now it was possible to reference images within\n/resources/shared/images/ within the content, and there are still many\npublications that make use of this.  So I think it should be fixed first, and\nthen once it is working we can discuss replacing it with something better.", "id": 99445, "time": "2007-02-15T11:11:02Z", "creator": "jonathan.addison@wyona.com", "creation_time": "2007-02-15T11:11:02Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 41499, "text": "(In reply to comment #14)\n\n> Up until now it was possible to reference images within\n> /resources/shared/images/ within the content, and there are still many\n> publications that make use of this.  So I think it should be fixed first, and\n> then once it is working we can discuss replacing it with something better.\n\nWell, that's true. I'll take a look at the patch. Thanks a lot!", "id": 99447, "time": "2007-02-15T13:19:54Z", "creator": "andreas@apache.org", "creation_time": "2007-02-15T13:19:54Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 41499, "text": "(In reply to comment #9)\n> Hi Andreas,\n> \n> IIUC, fixing the link converter may help for some images (those that have been\n> uploaded), but it won't work for those in /resources/shared/images/.\n\nThe UuidToUrlTransformer does now transform\n\n  /<pub-id>/<area/...\n\ninto\n\n  <context-path>/<pub-id>/<area>/...\n\nand the UrlToUuidTransformer does it vice versa.\n\nI added a note to the code.\n\nPlease test!", "id": 99554, "time": "2007-02-19T06:59:48Z", "creator": "andreas@apache.org", "creation_time": "2007-02-19T06:59:48Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "bug_id": 41499, "text": "(In reply to comment #16)\n> (In reply to comment #9)\n> > Hi Andreas,\n> > \n> > IIUC, fixing the link converter may help for some images (those that have been\n> > uploaded), but it won't work for those in /resources/shared/images/.\n> \n> The UuidToUrlTransformer does now transform\n> \n>   /<pub-id>/<area/...\n> \n> into\n> \n>   <context-path>/<pub-id>/<area>/...\n> \n> and the UrlToUuidTransformer does it vice versa.\n> \n> I added a note to the code.\n> \n> Please test!\n\n\nThanks for this fix!\n\nMy test image in /resources/shared/images is now displaying correctly in BXE,\nhowever in the authoring view the image is not displayed.  But I think this has\nto do with the svg module.\n\n/lenya/default/authoring/images/test.jpg?lenya.module=svg&height=86&width=440\n\nAfter removing everything after ?, the image displays correctly.", "id": 99584, "time": "2007-02-20T15:16:22Z", "creator": "jonathan.addison@wyona.com", "creation_time": "2007-02-20T15:16:22Z", "is_private": false, "attachment_id": null}, {"count": 18, "tags": [], "text": "There was a strange URL reference in the SVG sitemap. Would you mind trying it\nagain now?", "attachment_id": null, "id": 99600, "creator": "andreas@apache.org", "time": "2007-02-21T00:47:55Z", "bug_id": 41499, "creation_time": "2007-02-21T00:47:55Z", "is_private": false}, {"count": 19, "tags": [], "bug_id": 41499, "text": "(In reply to comment #18)\n> There was a strange URL reference in the SVG sitemap. Would you mind trying it\n> again now?\n\nYes it's working now, thanks alot for the fix!", "id": 99625, "time": "2007-02-21T07:51:32Z", "creator": "jonathan.addison@wyona.com", "creation_time": "2007-02-21T07:51:32Z", "is_private": false, "attachment_id": null}, {"count": 20, "tags": [], "text": "Thanks for testing!\n\nCan we close this bug?", "is_private": false, "id": 99628, "creator": "andreas@apache.org", "time": "2007-02-21T08:06:12Z", "bug_id": 41499, "creation_time": "2007-02-21T08:06:12Z", "attachment_id": null}, {"count": 21, "tags": [], "bug_id": 41499, "text": "Renaming Lenya 1.4 to 2.0", "id": 105445, "time": "2007-07-16T01:58:32Z", "creator": "thorsten@apache.org", "creation_time": "2007-07-16T01:58:32Z", "is_private": false, "attachment_id": null}]
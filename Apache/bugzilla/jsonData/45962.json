[{"count": 0, "tags": [], "bug_id": 45962, "attachment_id": null, "text": "I'm using httpd 2.2.9 to host our subversion repositories. I want to authenticate our users against our Active Directory server. I have built and installed apr 1.3.3, openldap 2.4.11, apr-util 1.3.4, httpd 2.2.9 and subversion 1.5.2\n\nImmediately after a server startup, I get these strange errors saying \"LDAP: Could not set the connection timeout\" when I try to authenticate myself. The weird thing is, after a couple of attempts at accessing the subversion content (5 or 6 times), I'm eventually authenticated without error. Then it will work for a while, then those same errors will come back. I have tried using a 2.3 version of openldap, same problems.\n\nBy the way, the server is a Solaris 10 (running as a virtual server) on sparc hardware.\n\nHere is what the interesting part of my configuration looks like :\n\n<Location /svn>\n\n  DAV svn\n  SVNParentPath /usr/svn\n  AuthzLDAPAuthoritative on\n  AuthType Basic\n  AuthBasicProvider ldap\n  AuthUserFile /dev/null\n  Require valid-user\n  AuthName \"my.domain.com\"\n  AuthLDAPBindDN \"CN=user,CN=Users,DC=my,DC=domain,DC=com\"\n  AuthLDAPBindPassword \"password\"\n  AuthLDAPURL \"ldap://my.domain.com/DC=my,DC=domain,DC=com?sAMAccountName?sub?(objectClass=user)\"\n</Location>\n\nand the messages I get in my log file :\n\n[Mon Sep 29 16:38:21 2008] [error] LDAP: Could not set the connection timeout\n[Mon Sep 29 16:38:21 2008] [warn] [client 192.168.67.103] [6236] auth_ldap authenticate: user test authentication failed; URI /svn/test [(null)][Unknown error]\n\nBTW, I ran the same setup on a linux machine without any problems.", "id": 121278, "time": "2008-10-07T10:56:56Z", "creator": "essiambl@gmail.com", "creation_time": "2008-10-07T10:56:56Z", "is_private": false}, {"count": 1, "tags": [], "text": "I assume that you may build against a different ldap library on Solaris then you are running against on Solaris. Please provide your configure settings on Solaris and an ldd of\n\nbin/httpd\nlib/apr-util-1/apr_ldap.so\n\nPlease execute ldd as the same user that you use to execute apachectl (most likely root)", "attachment_id": null, "bug_id": 45962, "id": 121279, "time": "2008-10-07T11:45:57Z", "creator": "rpluem@apache.org", "creation_time": "2008-10-07T11:45:57Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 45962, "attachment_id": 22679, "text": "Created attachment 22679\nldd of apr_ldap.so", "id": 121281, "time": "2008-10-07T12:34:03Z", "creator": "essiambl@gmail.com", "creation_time": "2008-10-07T12:34:03Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 45962, "attachment_id": 22680, "text": "Created attachment 22680\nconfig.log of apr-util", "id": 121282, "time": "2008-10-07T12:35:29Z", "creator": "essiambl@gmail.com", "creation_time": "2008-10-07T12:35:29Z", "is_private": false}, {"count": 4, "tags": [], "creator": "essiambl@gmail.com", "attachment_id": 22681, "id": 121283, "time": "2008-10-07T12:35:51Z", "bug_id": 45962, "creation_time": "2008-10-07T12:35:51Z", "is_private": false, "text": "Created attachment 22681\nldd of httpd"}, {"count": 5, "tags": [], "bug_id": 45962, "attachment_id": 22682, "text": "Created attachment 22682\nconfig log of httpd", "id": 121284, "time": "2008-10-07T12:36:15Z", "creator": "essiambl@gmail.com", "creation_time": "2008-10-07T12:36:15Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 45962, "attachment_id": null, "text": "As I thought you compiled against your LDAP SDK installed in /usr/local/ and you are running against the LDAP SDK installed at /usr/lib. As you are using different SDK's for compiling (openldap) and running (SUN LDAP SDK) it is quite clear that problems like this are going to happen as all LDAP SDK's are different and theses differences have to be taken into account during compile time.\nPlease add --with-ldap-lib=/usr/local/lib to your apr-util configure call and recompile apr-util and httpd. This should ensure that the correct LDAP library is used during runtime.\n\n", "id": 121292, "time": "2008-10-07T14:29:59Z", "creator": "rpluem@apache.org", "creation_time": "2008-10-07T14:29:59Z", "is_private": false}, {"count": 7, "tags": [], "creator": "essiambl@gmail.com", "attachment_id": 22709, "id": 121402, "time": "2008-10-10T06:16:53Z", "bug_id": 45962, "creation_time": "2008-10-10T06:16:53Z", "is_private": false, "text": "Created attachment 22709\nnew ldd of httpd"}, {"count": 8, "tags": [], "creator": "essiambl@gmail.com", "text": "Created attachment 22710\nstack", "id": 121403, "time": "2008-10-10T06:17:23Z", "bug_id": 45962, "creation_time": "2008-10-10T06:17:23Z", "is_private": false, "attachment_id": 22710}, {"count": 9, "tags": [], "creator": "essiambl@gmail.com", "text": "Created attachment 22711\nldd of mod_authnz_ldap.so", "id": 121404, "time": "2008-10-10T06:18:17Z", "bug_id": 45962, "creation_time": "2008-10-10T06:18:17Z", "is_private": false, "attachment_id": 22711}, {"count": 10, "tags": [], "creator": "essiambl@gmail.com", "attachment_id": 22712, "id": 121405, "time": "2008-10-10T06:18:57Z", "bug_id": 45962, "creation_time": "2008-10-10T06:18:57Z", "is_private": false, "text": "Created attachment 22712\nldd of mod_ldap.so"}, {"count": 11, "tags": [], "creator": "essiambl@gmail.com", "text": "I've added the --with-ldap-lib option to my apr-util configuration and recompiled everything as you suggested. apr-util and httpd are now correctly linked to my openldap libs in /usr/local/bin.\n\nBut now when I start the httpd server, I get endless errors and core dumps. These errors look like :\n\nchild pid 8623 exit signal Bus error (10), possible coredump in /tmp\n\nI've noticed that while httpd is linked against my openldap libs, mod_ldap.so and mod_authnz_ldap.so are still linked to Sun's default ldap libs. I've tried adding the --with-ldap-lib option to my httpd configure command but it doesn't appear to be a valid option. \n\nI've included all relevant information in the latest attachments. \n\nThank you for your time.", "id": 121406, "time": "2008-10-10T06:27:03Z", "bug_id": 45962, "creation_time": "2008-10-10T06:27:03Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 121407, "time": "2008-10-10T07:45:56Z", "bug_id": 45962, "creation_time": "2008-10-10T07:45:56Z", "is_private": false, "text": "Try using\nexport LD_LIBRARY_PATH=\"/usr/local/lib:$LD_LIBRARY_PATH\" before calling apachectl start."}, {"count": 13, "attachment_id": null, "creator": "essiambl@gmail.com", "text": "Setting the LD_LIBRARY_PATH variable to /usr/local/lib seems to have no effect. I'm still getting those same core dumps as before. I've tried building mod_ldap and mod_authnz_ldap as shared modules and loading them from httpd.conf with the same results. httpd will core dump whenever either module is enabled, even without any ldap configuration.", "id": 121504, "time": "2008-10-14T09:02:37Z", "bug_id": 45962, "creation_time": "2008-10-14T09:02:37Z", "tags": [], "is_private": false}, {"count": 14, "attachment_id": null, "creator": "essiambl@gmail.com", "text": "I finally gave up trying to get OpenLDAP to work and was able to compile the LDAP modules with the default LDAP libs from Solaris. I had some issues while configuring Apache though. The configure script would detect the libs as being OpenLDAP even while linking to Sun's libs. I had to completely removed OpenLDAP before the libs were correctly identified as Solaris'.", "id": 121825, "time": "2008-10-23T06:06:59Z", "bug_id": 45962, "creation_time": "2008-10-23T06:06:59Z", "tags": [], "is_private": false}]
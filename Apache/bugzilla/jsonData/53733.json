[{"count": 0, "tags": [], "creator": "nagarajanchinnasamy@gmail.com", "attachment_id": null, "text": "To count number of rows in a table, one should not need keyfield to be specified. However, the count method calls a method that checks for the presence of many of the options including keyfield and fails if not specified.\n\nCode:\n\n   method count {args} {\n\ttable_check $args\n\treturn [string \"select count(*) from $myTable\"]\n    }\n\nTest Case:\n\t::tcltest::test exec02-01.01 {\n\t\tTest exec command by executing various sql statements\n\t} -setup {\n\t\t::DIO::handle $interface dbcmd -db $testdb\n\t\tdbcmd exec {drop table if exists t1; create table t1(a int primary key, b text)}\n\t\tdbcmd table t1\n\t} -body {\n\t\tdbcmd exec {insert into t1 (a, b) values ('1', 'hello')}\n\t\tdbcmd count\n\t} -cleanup {\n\t\tdbcmd destroy\n\t} -result {1}\n\nResult:\n\n==== exec02-01.01 Test exec command by executing various sql statements FAILED\n==== Contents of test case:\n\n\t\tdbcmd exec {insert into t1 (a, b) values ('1', 'hello')}\n\t\tdbcmd count\n\t\n---- Test generated error; Return code was: 1\n---- Return code should have been one of: 0 2\n---- errorInfo: -keyfield not specified in DIO object\n    while executing\n\"table_check $args\"\n    (object \"::dbcmd\" method \"::DIO::Database::count\" body line 2)\n    invoked from within\n\"dbcmd count\"\n    (\"uplevel\" body line 3)\n    invoked from within\n\"uplevel 1 $script\"\n---- errorCode: NONE\n==== exec02-01.01 FAILED", "id": 161475, "time": "2012-08-16T22:01:13Z", "bug_id": 53733, "creation_time": "2012-08-16T22:01:13Z", "is_private": false}, {"count": 1, "tags": [], "text": "thanks for reporting it.", "is_private": false, "bug_id": 53733, "id": 162049, "time": "2012-09-10T10:46:24Z", "creator": "mxmanghi@apache.org", "creation_time": "2012-09-10T10:46:24Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Created attachment 29390\nproposed patch to fixing count method\n\nthis patch lets method check_table return with -errorcode. The caller can check the errorcode trapped in a catch and so it does count. If the code is not missing_table we keep going. Also method 'string' was probably broken", "attachment_id": 29390, "bug_id": 53733, "id": 162263, "time": "2012-09-18T22:39:26Z", "creator": "mxmanghi@apache.org", "creation_time": "2012-09-18T22:39:26Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 53733, "is_private": false, "count": 3, "id": 162348, "time": "2012-09-22T23:07:16Z", "creator": "mxmanghi@apache.org", "creation_time": "2012-09-22T23:07:16Z", "text": "fix committed in both 'trunk' and 'branches/2.0'. Thank you for reporting this bug"}]
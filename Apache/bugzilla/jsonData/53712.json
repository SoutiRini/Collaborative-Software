[{"count": 0, "attachment_id": null, "creator": "apache@macallister.net", "is_private": false, "id": 161349, "time": "2012-08-13T19:51:22Z", "bug_id": 53712, "creation_time": "2012-08-13T19:51:22Z", "tags": [], "text": "When reading a large jsp file, get the error shown at bottom. It seems this was an error that occurred in a past iteration (was it 5.5.22?) but had been subsequently fixed.\n\nLocalVariableTable has wrong length in class file org/apache/jsp/cbs/views/eventb/form_jsp\njava.lang.ClassFormatError: LocalVariableTable has wrong length in class file org/apache/jsp/cbs/views/eventb/form_jsp\nat java.lang.ClassLoader.defineClass1(Native Method)\nat java.lang.ClassLoader.defineClass(ClassLoader.java:621)\nat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124)\nat java.net.URLClassLoader.defineClass(URLClassLoader.java:260)\nat java.net.URLClassLoader.access$100(URLClassLoader.java:56)\nat java.net.URLClassLoader$1.run(URLClassLoader.java:195)\nat java.security.AccessController.doPrivileged(Native Method)\nat java.net.URLClassLoader.findClass(URLClassLoader.java:188)\nat org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:131)\nat org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:63)\nat org.apache.jasper.JspCompilationContext.load(JspCompilationContext.java:597)\nat org.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrapper.java:143)\nat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:323)\nat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:308)\nat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:259)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:269)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)\nat org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:659)\nat org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:565)\nat org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:493)\nat com.runtime.rtsb.controllers.BaseController.executeView(BaseController.java:588)\nat com.runtime.rtsb.controllers.BaseController.doMicrodispatchProcessing(BaseController.java:343)\nat com.runtime.rtsb.controllers.BaseController.doMicrodispatch(BaseController.java:282)\nat com.runtime.rtsb.controllers.BaseController.doGet(BaseController.java:166)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:627)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:269)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)\nat org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:659)\nat org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:565)\nat org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:493)\nat com.runtime.rtsb.core.RTFactory.includeController(RTFactory.java:248)\nat com.runtime.rtsb.core.RTFactory.execute(RTFactory.java:209)\nat com.runtime.rtsb.tags.TagRegion.doEndTag(TagRegion.java:262)\nat org.apache.jsp.cbs.layouts.cbs_005ffull_jsp._jspx_meth_rt_005fregion_005f8(cbs_005ffull_jsp.java:1302)\nat org.apache.jsp.cbs.layouts.cbs_005ffull_jsp._jspService(cbs_005ffull_jsp.java:866)\nat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:98)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\nat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:371)\nat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:308)\nat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:259)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:269)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)\nat org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:659)\nat org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:565)\nat org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:493)\nat com.runtime.rtsb.core.RTFactory.execute(RTFactory.java:204)\nat com.runtime.rtsb.core.RTFactory.execute(RTFactory.java:105)\nat com.runtime.rtsb.core.Dispatcher.processRequest(Dispatcher.java:677)\nat com.runtime.rtsb.core.Dispatcher.doGet(Dispatcher.java:389)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:627)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:269)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)\nat com.runtime.rtsb.security.XSSFilter.doFilter(XSSFilter.java:47)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)\nat edu.columbia.gsb.security.CASFilter.doFilter(CASFilter.java:118)\nat edu.columbia.gsb.security.CASFilter.doFilter(CASFilter.java:73)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)\nat com.runtime.rtsb.core.upload.RTMultipartFilter.doFilter(RTMultipartFilter.java:138)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:215)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)\nat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)\nat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:172)\nat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\nat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:117)\nat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:108)\nat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:174)\nat org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:200)\nat org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)\nat org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:775)\nat org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:704)\nat org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:897)\nat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:689)\nat java.lang.Thread.run(Thread.java:595)"}, {"count": 1, "tags": [], "bug_id": 53712, "text": "(In reply to comment #0) I should note I'm running Tomcat 5.5.35.\n\n> When reading a large jsp file, get the error shown at bottom. It seems this\n> was an error that occurred in a past iteration (was it 5.5.22?) but had been\n> subsequently fixed.\n> \n> LocalVariableTable has wrong length in class file\n> org/apache/jsp/cbs/views/eventb/form_jsp\n> java.lang.ClassFormatError: LocalVariableTable has wrong length in class\n> file org/apache/jsp/cbs/views/eventb/form_jsp\n> at java.lang.ClassLoader.defineClass1(Native Method)\n> at java.lang.ClassLoader.defineClass(ClassLoader.java:621)\n> at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124)\n> at java.net.URLClassLoader.defineClass(URLClassLoader.java:260)\n> at java.net.URLClassLoader.access$100(URLClassLoader.java:56)\n> at java.net.URLClassLoader$1.run(URLClassLoader.java:195)\n> at java.security.AccessController.doPrivileged(Native Method)\n> at java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n> at org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:131)\n> at org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:63)\n> at\n> org.apache.jasper.JspCompilationContext.load(JspCompilationContext.java:597)\n> at\n> org.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrapper.\n> java:143)\n> at\n> org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:\n> 323)\n> at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:308)\n> at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:259)\n> at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> internalDoFilter(ApplicationFilterChain.java:269)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> doFilter(ApplicationFilterChain.java:188)\n> at\n> org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.\n> java:659)\n> at\n> org.apache.catalina.core.ApplicationDispatcher.\n> doInclude(ApplicationDispatcher.java:565)\n> at\n> org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.\n> java:493)\n> at\n> com.runtime.rtsb.controllers.BaseController.executeView(BaseController.java:\n> 588)\n> at\n> com.runtime.rtsb.controllers.BaseController.\n> doMicrodispatchProcessing(BaseController.java:343)\n> at\n> com.runtime.rtsb.controllers.BaseController.doMicrodispatch(BaseController.\n> java:282)\n> at com.runtime.rtsb.controllers.BaseController.doGet(BaseController.java:166)\n> at javax.servlet.http.HttpServlet.service(HttpServlet.java:627)\n> at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> internalDoFilter(ApplicationFilterChain.java:269)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> doFilter(ApplicationFilterChain.java:188)\n> at\n> org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.\n> java:659)\n> at\n> org.apache.catalina.core.ApplicationDispatcher.\n> doInclude(ApplicationDispatcher.java:565)\n> at\n> org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.\n> java:493)\n> at com.runtime.rtsb.core.RTFactory.includeController(RTFactory.java:248)\n> at com.runtime.rtsb.core.RTFactory.execute(RTFactory.java:209)\n> at com.runtime.rtsb.tags.TagRegion.doEndTag(TagRegion.java:262)\n> at\n> org.apache.jsp.cbs.layouts.cbs_005ffull_jsp.\n> _jspx_meth_rt_005fregion_005f8(cbs_005ffull_jsp.java:1302)\n> at\n> org.apache.jsp.cbs.layouts.cbs_005ffull_jsp._jspService(cbs_005ffull_jsp.\n> java:866)\n> at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:98)\n> at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n> at\n> org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:\n> 371)\n> at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:308)\n> at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:259)\n> at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> internalDoFilter(ApplicationFilterChain.java:269)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> doFilter(ApplicationFilterChain.java:188)\n> at\n> org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.\n> java:659)\n> at\n> org.apache.catalina.core.ApplicationDispatcher.\n> doInclude(ApplicationDispatcher.java:565)\n> at\n> org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.\n> java:493)\n> at com.runtime.rtsb.core.RTFactory.execute(RTFactory.java:204)\n> at com.runtime.rtsb.core.RTFactory.execute(RTFactory.java:105)\n> at com.runtime.rtsb.core.Dispatcher.processRequest(Dispatcher.java:677)\n> at com.runtime.rtsb.core.Dispatcher.doGet(Dispatcher.java:389)\n> at javax.servlet.http.HttpServlet.service(HttpServlet.java:627)\n> at javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> internalDoFilter(ApplicationFilterChain.java:269)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> doFilter(ApplicationFilterChain.java:188)\n> at com.runtime.rtsb.security.XSSFilter.doFilter(XSSFilter.java:47)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> internalDoFilter(ApplicationFilterChain.java:215)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> doFilter(ApplicationFilterChain.java:188)\n> at edu.columbia.gsb.security.CASFilter.doFilter(CASFilter.java:118)\n> at edu.columbia.gsb.security.CASFilter.doFilter(CASFilter.java:73)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> internalDoFilter(ApplicationFilterChain.java:215)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> doFilter(ApplicationFilterChain.java:188)\n> at\n> com.runtime.rtsb.core.upload.RTMultipartFilter.doFilter(RTMultipartFilter.\n> java:138)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> internalDoFilter(ApplicationFilterChain.java:215)\n> at\n> org.apache.catalina.core.ApplicationFilterChain.\n> doFilter(ApplicationFilterChain.java:188)\n> at\n> org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.\n> java:213)\n> at\n> org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.\n> java:172)\n> at\n> org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\n> at\n> org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:117)\n> at\n> org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:\n> 108)\n> at\n> org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:174)\n> at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:200)\n> at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:291)\n> at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:775)\n> at\n> org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:704)\n> at\n> org.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:\n> 897)\n> at\n> org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.\n> java:689)\n> at java.lang.Thread.run(Thread.java:595)", "id": 161350, "time": "2012-08-13T19:56:53Z", "creator": "apache@macallister.net", "creation_time": "2012-08-13T19:56:53Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "1. \n> org/apache/jsp/cbs/views/eventb/form_jsp\n> java.lang.ClassFormatError: LocalVariableTable has wrong length in class\n> file org/apache/jsp/cbs/views/eventb/form_jsp\n> at java.lang.ClassLoader.defineClass1(Native Method)\n\nSo your class file is broken. Tomcat is only responsible for generating the source java text for a JSP file.  Compiling it into a class file is done by Java compiler, which is a 3rd-party component.\n\nUsually you would be using Eclipse ECJ compiler. If it generates a broken file from a valid java file, it is their bug.\n\nNote, that\n1). It is possible to configure Jasper to use another compiler (e.g. Oracle's javac), or\n2). You can try replacing ecj-NNN.jar with a newer version.\n\nThe ECJ jar is redistributed as is, so it should be a drop-in replacement, though it is up to you to test it. -> See bug 52805 for a download link.\n\n\nHave you tried to search bugzilla at eclipse.org? Is it a known issue?\n\nIf it is known what version of ECJ fixes the issue, it is easier to persuade people to do an upgrade.\n\nMaybe you do have a sample JSP that can reproduce the issue on a clean Tomcat install?\n\n\n2. There are certain JVM limits which can be hit if your page is too big. Nothing can be done for that by Tomcat.  There are some options that control the style of generated code and you may try to tweak those.\n\nSearch the mailing list archives for some tips / inspiration. Ask on the users mailing list if further help on Tomcat configuration is needed.", "id": 161352, "time": "2012-08-13T20:51:49Z", "bug_id": 53712, "creation_time": "2012-08-13T20:51:49Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 53712, "text": "I've upgraded the ecj compiler past the point where it would work at all anymore. The last \"successful\" build -- successful in that it would render most pages -- was ecj-3.7.2 for tomcat 5.5. (Version 4 of the libraries didn't work at all.) But this still exhibited the localvariabletable length bug.\n\nSo I removed all ecj's from the common/lib directory and replaced it, according to instructions, with the latest ant.jar and ant-launcher.jar. These showed the exact same localvariabletable length error that ecj had -- same wording and everything -- and more important, the same error trace. So maybe ecj wasn't the culprit?\n\nLocalVariableTable has wrong length in class file org/apache/jsp/cbs/views/eventb/form_jsp\njava.lang.ClassFormatError: LocalVariableTable has wrong length in class file org/apache/jsp/cbs/views/eventb/form_jsp\nat java.lang.ClassLoader.defineClass1(Native Method)\nat java.lang.ClassLoader.defineClass(ClassLoader.java:621)\nat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124)\nat java.net.URLClassLoader.defineClass(URLClassLoader.java:260)\nat java.net.URLClassLoader.access$100(URLClassLoader.java:56)\nat java.net.URLClassLoader$1.run(URLClassLoader.java:195)\nat java.security.AccessController.doPrivileged(Native Method)\nat java.net.URLClassLoader.findClass(URLClassLoader.java:188)\nat org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:131)\n...", "id": 161382, "time": "2012-08-14T16:25:05Z", "creator": "apache@macallister.net", "creation_time": "2012-08-14T16:25:05Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 53712, "text": "The first hit in a Google search for that error message turned up this:\nhttp://forum.springsource.org/showthread.php?54619-LocalVariableTable-has-wrong-length-in-class-file\n\nThe short version is that a method is more than 64KB.", "id": 161821, "time": "2012-08-29T21:03:09Z", "creator": "markt@apache.org", "creation_time": "2012-08-29T21:03:09Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 53712, "is_private": false, "id": 161824, "creation_time": "2012-08-30T00:07:19Z", "time": "2012-08-30T00:07:19Z", "creator": "apache@macallister.net", "text": "I'm just furthering this discussion in the interest of helping future developers.\n\nThanks for the snarky rtfm comment, but (1) there is no method larger than 64k, unless an entire jsp is compiled to one java method, and (2) even if there is, I did not change my code one bit, just upgraded to the latest stable tomcat 5.5 build. It was working before. But at a point in the distant past--a few versions ago--it didn't work.", "attachment_id": null}, {"count": 6, "tags": [], "text": "(In reply to comment #5)\n\n> Thanks for the snarky rtfm comment, \n\nNot snarky, just based on the limited information provided. You did say the JSP was large.\n\n> but (1) there is no method larger than 64k, unless an entire jsp is compiled to one java method,\n\nDepending on what is in the JSP that is possible although unlikely given the widespread use of tags etc (tags result in extra methods being generated).\n\n> and (2) even if there is, I did not change my code one bit, just upgraded to the latest\n> stable tomcat 5.5 build. It was working before. But at at a point in the\n> distant past--a few versions ago--it didn't work.\n\nTomcat sometimes changes how java classes are generated from JSPs. It is possible for a method that was just below the 64k limit on one Tomcat version to be just above it on another.\n\nUntil such time as you provide a test JSP that demonstrates the issue that does not result in a class file with a method >64k, this issue is going to remain in the invalid state.", "is_private": false, "bug_id": 53712, "id": 161830, "time": "2012-08-30T08:22:54Z", "creator": "markt@apache.org", "creation_time": "2012-08-30T08:22:54Z", "attachment_id": null}]
[{"count": 0, "tags": [], "text": "The HttpServletRequest.getReader doesn't correctly read large entity and returns more data than expected.\nThis happens only with version 8.5.8 (working fine on 8.5.6).\nI was able to reproduce this with a really simple web app where the issue is occurring for entity larger that 12288 characters.\n\n@Override\nprotected void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException{\n\tStringBuilder builder = new StringBuilder();\n\ttry(BufferedReader reader = req.getReader()){\n\t\tString line;\n\t\twhile((line = reader.readLine()) != null){\n\t\t\tbuilder.append(line);\n\t\t}\n\t}\n\tresp.getWriter().println(req.getContentLength() + \" \" + builder.length());\n\tresp.getWriter().println(builder);\n}\n\nThen I use this command and I'm able to compare input and parsed data:\ncat /dev/urandom | tr -dc 'a-zA-Z0-9' | head -c 12289 > input && curl -X POST http://localhost:8080/example -d @input > output", "attachment_id": null, "bug_id": 60400, "id": 195132, "time": "2016-11-21T22:28:11Z", "creator": "clement@guillaume.bzh", "creation_time": "2016-11-21T22:28:11Z", "is_private": false}, {"count": 1, "tags": [], "creator": "violetagg@apache.org", "attachment_id": null, "is_private": false, "id": 195137, "time": "2016-11-22T08:03:38Z", "bug_id": 60400, "creation_time": "2016-11-22T08:03:38Z", "text": "Hi,\n\nI was not able to reproduce the issue with the provided example.\nI received:\n- input with size 12289\n- output with size 12302. The output contains two rows:\n  - the first one contains information for the input and output size: 12289 12289\n  - the second one contains the input that was sent.\n\nIf I remove the first line then the both files are identical.\n\nRegards,\nVioleta"}, {"text": "Created attachment 34466\nserver configuration\n\nHere is what I get:\n\n-rw-r--r-- 1 cguillaume cguillaume 12289 Nov 22 10:30 input\n-rw-r--r-- 1 cguillaume cguillaume 21302 Nov 22 10:30 output\n\nFirst line: 12289 21289\n\nIt seems to happen only when using the apr connector. I attached my server.xml.\nThe apr version I'm using is:\nINFO: Loaded APR based Apache Tomcat Native library 1.2.10 using APR version 1.5.2.", "tags": [], "bug_id": 60400, "is_private": false, "count": 2, "id": 195149, "time": "2016-11-22T19:17:33Z", "creator": "clement@guillaume.bzh", "creation_time": "2016-11-22T19:17:33Z", "attachment_id": 34466}, {"text": "Thanks,\n\nI reproduced the issue.\nI'll update the issue with my findings later.\n\nRegards,\nVioleta", "tags": [], "bug_id": 60400, "is_private": false, "count": 3, "id": 195206, "time": "2016-11-25T11:27:17Z", "creator": "violetagg@apache.org", "creation_time": "2016-11-25T11:27:17Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Hi,\n\nThe issue was the following:\nIn some cases the buffer used for the request data needs to be expanded. The read position after the expansion was not returned to the correct one.\n\nThis has been fixed in\n- 9.0.x for 9.0.0.M14 onwards and\n- 8.5.x for 8.5.9 onwards\n\nRegard,\nVioleta", "attachment_id": null, "bug_id": 60400, "id": 195211, "time": "2016-11-25T14:29:13Z", "creator": "violetagg@apache.org", "creation_time": "2016-11-25T14:29:13Z", "is_private": false}]
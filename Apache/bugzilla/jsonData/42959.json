[{"count": 0, "tags": [], "creator": "pleaseprivacy@yahoo.com", "text": "CONTEXT:\n\nI'm running Mac OS X 10.4.10.  I've enabled file sharing, and I've successfully configured the built-in \napache server to serve HTML and PHP files.  I have successfully installed apache-tomcat-6.0.13.\n\nPROBLEM:\n\nI would like to install the Tomcat Connectors (mod_jk) but no macosx binaries exist in the download \nrepository:  http://tomcat.apache.org/download-connectors.cgi\n\nWhen I attempt to compile my own binaries, the compilation fails with fatal errors:\n\njk_util.c:364: error: static declaration of 'vsnprintf' follows non-static declaration\njk_util.c:384: error: static declaration of 'snprintf' follows non-static declaration\njk_status.c:329: error: static declaration of 'vsnprintf' follows non-static declaration\n\nHOW TO REPRODUCE:\n\n1. Download a fresh version of the source code for \"tomcat-connectors-1.2.23-src\"\nURL:  http://www.ip97.com/apache.org/tomcat/tomcat-connectors/jk/source/jk-1.2.23/tomcat-\nconnectors-1.2.23-src.zip\n\n2. After downloading and extracting the source folder, follow the apache instructions in BUILD.txt:\n$> cd native\n$> ./configure --with-apxs=/usr/sbin/apxs\n\n3. NOTE: At this point, the build fails immediately with the error:\n\": bad interpreter: No such file or directory\"\n\n4. To compile the \"configure\" file in Mac OS X 10.4.10 using gcc, the line endings need to be converted \nto unix line endings:\n$> perl -pi -e 's/\\r\\n?/\\n/g' configure\n\n5. With the configure is run again, the script halts at the first file with Macintosh line endings:\n$> ./configure --with-apxs=/usr/sbin/apxs\nconfigure: error: cannot run /bin/sh scripts/build/unix/config.sub\n\n6. Continue by converting every file in the directory \"scripts/build/unix\" to the unix line endings:\n$> perl -pi -e 's/\\r\\n?/\\n/g' config.sub\netc...\n\n7. Now the \"configure\" script runs to completion:\n$> ./configure --with-apxs=/usr/sbin/apxs\nchecking build system type... powerpc-apple-darwin8.10.0\nchecking host system type... powerpc-apple-darwin8.10.0\nchecking target system type... powerpc-apple-darwin8.10.0\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\n...\nconfig.status: creating common/Makefile\nconfig.status: creating common/list.mk\nconfig.status: creating common/jk_types.h\nconfig.status: creating jni/Makefile\nconfig.status: creating common/portable.h\nconfig.status: executing depfiles commands\n\n8. Continue following the apache instructions in BUILD.txt:\n$> make\nMaking all in common\n/bin/sh ../libtool --mode=compile gcc -I/usr/include/httpd -g -O2 -DDARWIN -DUSE_HSREGEX -\nDUSE_EXPAT -I../lib/expat-lite -g -Os -pipe -DHARD_SERVER_LIMIT=2048 -DEAPI -DJK_PREFORK -g -\nO2  -I /System/Library/Frameworks/JavaVM.framework/Home/include -I /System/Library/Frameworks/\nJavaVM.framework/Home/include/ -c jk_ajp12_worker.c -o jk_ajp12_worker.lo\nmkdir .libs\n...\ngcc -I/usr/include/httpd -g -O2 -DDARWIN -DUSE_HSREGEX -DUSE_EXPAT -I../lib/expat-lite -g -Os -\npipe -DHARD_SERVER_LIMIT=2048 -DEAPI -DJK_PREFORK -g -O2 -I /System/Library/Frameworks/\nJavaVM.framework/Home/include -I /System/Library/Frameworks/JavaVM.framework/Home/include/ -\nc jk_util.c  -fno-common -DPIC -o .libs/jk_util.o\njk_util.c:364: error: static declaration of 'vsnprintf' follows non-static declaration\njk_util.c:384: error: static declaration of 'snprintf' follows non-static declaration\nmake[1]: *** [jk_util.lo] Error 1\nmake: *** [all-recursive] Error 1\n\n9. The compilation halts at the last two errors:\njk_util.c:364: error: static declaration of 'vsnprintf' follows non-static declaration\njk_util.c:384: error: static declaration of 'snprintf' follows non-static declaration\n\n10. The source file appears to be: \"native/common/jk_util.c\"  Here is a code snippet from line 364:\n#if !defined(HAVE_VSNPRINTF) && !defined(HAVE_APR)\nstatic FILE *f = NULL;\nstatic int vsnprintf(char *str, size_t n, const char *fmt, va_list ap)\n{\n...\n\n11.  After renaming the two offending functions, I encountered a similar problem in \"jk_status.c\":\njk_status.c:329: error: static declaration of 'vsnprintf' follows non-static declaration\n\n12.  I renamed the offending function here as well (I changed each instance of \"vsnprintf\" to \n\"staticvsnprintf\") and tried the make again:\n$> make clean\n$> make\n\n12. The script now fails after generating \"scripts/build/instdso.sh\"  The line endings need to be \nconverted to unix line endings:\n$> perl -pi -e 's/\\r\\n?/\\n/g' scripts/build/instdso.sh\n\n13. Finally, the \"make\" script runs to completion:\n$> make clean\n$> make\nMaking all in common\n/bin/sh ../libtool --mode=compile gcc -I/usr/include/httpd -g -O2 -DDARWIN -DUSE_HSREGEX -\nDUSE_EXPAT -I../lib/expat-lite -g -Os -pipe -DHARD_SERVER_LIMIT=2048 -DEAPI -DJK_PREFORK -g -\nO2  -I /System/Library/Frameworks/JavaVM.framework/Home/include -I /System/Library/Frameworks/\nJavaVM.framework/Home/include/ -c jk_ajp12_worker.c -o jk_ajp12_worker.lo\nmkdir .libs\n...\ncp .libs/mod_jk.lai /Users/spencerm/Desktop/Fresh/tomcat-connectors-1.2.23-src/native/\napache-1.3/mod_jk.la\ncp .libs/mod_jk.a /Users/spencerm/Desktop/Fresh/tomcat-connectors-1.2.23-src/native/apache-1.3/\nmod_jk.a\nchmod 644 /Users/spencerm/Desktop/Fresh/tomcat-connectors-1.2.23-src/native/apache-1.3/\nmod_jk.a\nranlib /Users/spencerm/Desktop/Fresh/tomcat-connectors-1.2.23-src/native/apache-1.3/mod_jk.a\nlibtool: install: warning: remember to run `libtool --finish /usr/libexec'\n\n14. Whew!  It finally compiled.  Hopefully one of the *real* developers can fix this permanently.", "id": 105861, "time": "2007-07-23T13:53:53Z", "bug_id": 42959, "creation_time": "2007-07-23T13:53:53Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 105873, "time": "2007-07-23T23:38:51Z", "bug_id": 42959, "creation_time": "2007-07-23T23:38:51Z", "is_private": false, "text": "Please download the *.tar.gz file for unix like systems. The tarball contains\ncorrect line endings for these platforms.\n\nUsing the zip file will lead to various compilation errors on *nix.\n\nPlease retry with the .tar.gz and let us know your findings. If the compilation\nproblem persists, we will investigate.\n"}, {"count": 2, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 105876, "time": "2007-07-23T23:50:51Z", "bug_id": 42959, "creation_time": "2007-07-23T23:50:51Z", "is_private": false, "text": "I assume your major problem doesn't go away by using the .tar.gz, although it\nwould be nice if you could confirm that.\n\nWe'll have a release candidate for 1.2.24 this week, and it looks like your\nproblem is already fixed there. It would be very good, if you could also test\nthe compilation of this 1.2.24 pre release, after we make it available for\ndownload. We will send a note to the tomcat-dev list about availability of this\npre release tarball.\n\nCould you please tell us, which compiler you are using?\n"}, {"count": 3, "tags": [], "text": "FOLLOW UP:\n\nOkay, I downloaded the .tar.gz package (tomcat-connectors-1.2.23-src.tar.gz):\nhttp://apache.mirrors.tds.net/tomcat/tomcat-connectors/jk/source/jk-1.2.23/tomcat-\nconnectors-1.2.23-src.tar.gz\n\nAs prophesized, the line-endings were linux compatible.\n\nThe ./configure step successfully ran to completion.\nThe resulting Makefile also ran to a successful completion.\n\nFor the record, my compiler was the honorable:  powerpc-apple-darwin8-gcc-4.0.1\n\nSo the conclusion seems to be: use the intended set of source files.  The *.zip file is not an equivalent \nalternative on Mac OS X.\n\nIf someone were so inclined, it could be helpful to add the target operating system to the main \ndownloads page:\nhttp://tomcat.apache.org/download-connectors.cgi\n\n* Source:\n * JK 1.2.23 Source Release tar.gz  (Linux, Macintosh)\n * JK 1.2.23 Source Release zip  (Windows)\n\nAs a guide for people who aren't sure which source package they ought to be using.  (This is probably \nmore important for the Macintosh users, who might go either way, than it is for Linux or Windows \nusers.)\n\nI'm not on the tomcat-dev list, but if you were to write a one-line follow up to this bug report when the \ncandidate for 1.2.24 is pre-released, I would be happy to download it and compile it for the Mac.  I can \nalso provide a PowerPC binary for Mac OS X if necessary.", "is_private": false, "bug_id": 42959, "id": 105919, "time": "2007-07-24T18:20:33Z", "creator": "pleaseprivacy@yahoo.com", "creation_time": "2007-07-24T18:20:33Z", "attachment_id": null}, {"count": 4, "text": "Thanks for testing and reporting.\nI added a small note to the download page, but I'm not sure if it is strong\nenough. It'll take some minutes before the site synchronizes the new content.\n\nThe snapshot tarball 1.2.24-dev will be available later today, or tomorrow. We\nwill announce on tomcat-users and -dev. The download location will be\n\nhttp://people.apache.org/~rjung/mod_jk-dev/\n\nAfter a short public testing we will tag the release and make the new 1.2.24\ntarball available under\n\nhttp://tomcat.apache.org/dev/dist/tomcat-connectors/jk/\n\nThis will then be votes as an official release.\n", "bug_id": 42959, "attachment_id": null, "id": 105925, "time": "2007-07-25T01:49:30Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-07-25T01:49:30Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "creator": "pleaseprivacy@yahoo.com", "attachment_id": null, "id": 105981, "time": "2007-07-26T14:24:19Z", "bug_id": 42959, "creation_time": "2007-07-26T14:24:19Z", "is_private": false, "text": "Okay, I downloaded and compiled the new tarball as promised:\ntomcat-connectors-1.2.24-dev-559730-src.tar.gz\n\nAnd I can report that there were no problems compiling the source with the\npowerpc-apple-darwin8-gcc-4.0.1 compiler on Mac OS 10.4.10.\n\nThe website looks good."}, {"count": 6, "text": "Move a couple of fixed JK issues from resolved to closed.", "bug_id": 42959, "is_private": false, "id": 112386, "time": "2008-01-01T16:32:28Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-01-01T16:32:28Z", "tags": [], "attachment_id": null}]
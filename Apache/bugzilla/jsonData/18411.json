[{"count": 0, "tags": [], "bug_id": 18411, "is_private": false, "id": 33929, "attachment_id": null, "creator": "matthias.bauer@livinglogic.de", "creation_time": "2003-03-27T15:15:33Z", "time": "2003-03-27T15:15:33Z", "text": "Depending on how an application is deployed, i. e.\na) throwing it into the webapps directory\nb) configuring the context in server.xml\nthe classloader behaves differently:\nIn (a) the directory $CATLINA_HOME/shared/lib/ is searched for *.jar files in\ncase (b) it is not.\n\nI observed this behaviour during application development and tried to track it\ndown as far as possible. The following description is only a method how to\neasily reproduce this behviour and is artificially constructed. The real-world\nimplication is that I cannot use the directory $CATLINA_HOME/shared/lib/ for my\nshared libraries, but have to use $CATLINA_HOME/common/lib/ until this bug is fixed.\n\nNow here is a very easy way to prove that class loading behaves different\ndepending on how an application is deployed: \n1.Create a sample file test.jsp with the following line of code:\n<% Object o = new NonExistingClass(); %>\nCompiling this JSP file will always fail, because NonExistingClass does not exist.\n2.Deploy this file in a subdirectory of webapps and access it via a browser. The\nfile logs/localhost_log.2003-03-27.txt will show a compile error like the one\nthat is attached (Attachment 1) below. In the trace the jar files from\n$CATALINA_HOME/shared/lib/ are listed in the classpath\n3. Deploy the same file in a different directory, configure a context in\nserver.xml and access it via a browser: Now the file\nlogs/localhost_log.2003-03-27.txt will show an error trace like the one that is\nattached as the second listing: Here the jars from $CATALINA_HOME/shared/lib/ do\nnot appear in the classpath instead all jars from $CATALINA_HOME/server/lib/ are\nlisted.\n\n\n\n\n===== Attachement 1: Begin ===========\n\n2003-03-27 15:45:50 Error compiling file:\n/home/hias/tomcat4/work/Standalone/localhost/test/test_jsp.java     [javac]\nSince fork is true, ignoring compiler setting.\n    [javac] Compiling 1 source file\n    [javac] Since fork is true, ignoring compiler setting.\n    [javac] /home/hias/tomcat4/work/Standalone/localhost/test/test_jsp.java:41:\ncannot resolve symbol\n    [javac] symbol  : class NonExistingClass \n    [javac] location: class org.apache.jsp.test_jsp\n    [javac]  Object o = new NonExistingClass(); \n    [javac]                 ^\n    [javac] 1 error\n\n\n2003-03-27 15:45:50 Info: Compile:\njavaFileName=/home/hias/tomcat4/work/Standalone/localhost/test/test_jsp.java\n   \nclasspath=/opt/jakarta-tomcat-4.1.24-LE-jdk14/shared/classes/:/opt/jakarta-tomcat-4.1.24-LE-jdk14/shared/lib/xerces.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/shared/lib/activation.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/shared/lib/jdbc2_0-stdext.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/shared/lib/mail.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/classes/:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/commons-collections.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/servlet.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/jasper-compiler.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-factory.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/jasper-runtime.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-resources.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/ant.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/commons-logging-api.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-common.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/shared/classes\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/shared/lib/xerces.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/shared/lib/activation.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/shared/lib/jdbc2_0-stdext.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/shared/lib/mail.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/classes\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/commons-collections.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/servlet.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/jasper-compiler.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-factory.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/jasper-runtime.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-resources.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/ant.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/commons-logging-api.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-common.jar\n     work dir=/home/hias/tomcat4/work/Standalone/localhost/test\n    srcDir=/home/hias/tomcat4/work/Standalone/localhost/test\n    include=test_jsp.java\nException compiling Compile failed; see the compiler error output for details.\n\n2003-03-27 15:45:50 Exception: \nCompile failed; see the compiler error output for details.\n        at org.apache.tools.ant.taskdefs.Javac.compile(Javac.java:842)\n        at org.apache.tools.ant.taskdefs.Javac.execute(Javac.java:682)\n        at org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:317)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:370)\n        at\norg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:473)\n        at\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:190)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n        ...\n\n\n===== Attachement 1: End ===========\n\n\n\n===== Attachement 2: Begin ===========\n\n2003-03-27 16:02:45 Error compiling file:\n/home/hias/tomcat4/work/Standalone/localhost/~hias_test1/test_jsp.java    \n[javac] Since fork is true, ignoring compiler setting.\n    [javac] Compiling 1 source file\n    [javac] Since fork is true, ignoring compiler setting.\n    [javac]\n/home/hias/tomcat4/work/Standalone/localhost/~hias_test1/test_jsp.java:41:\ncannot resolve symbol\n    [javac] symbol  : class NonExistingClass \n    [javac] location: class org.apache.jsp.test_jsp\n    [javac]  Object o = new NonExistingClass(); \n    [javac]                 ^\n    [javac] 1 error\n\n\n2003-03-27 16:02:45 Info: Compile:\njavaFileName=/home/hias/tomcat4/work/Standalone/localhost/~hias_test1/test_jsp.java\n   \nclasspath=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/classes/:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/catalina-ant.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-jk2.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-coyote.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-util.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-http11.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/servlets-common.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/servlets-invoker.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/commons-logging.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/mx4j-jmx.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/commons-digester.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/catalina.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/commons-fileupload-1.0-beta-1.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/servlets-default.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/servlets-manager.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/jakarta-regexp-1.2.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-warp.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/commons-modeler.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-jk.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/commons-beanutils.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/servlets-webdav.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/classes/:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/commons-collections.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/servlet.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/jasper-compiler.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-factory.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/jasper-runtime.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-resources.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/ant.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/commons-logging-api.jar:/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-common.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/classes\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/catalina-ant.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-jk2.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-coyote.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-util.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-http11.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/servlets-common.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/servlets-invoker.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/commons-logging.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/mx4j-jmx.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/commons-digester.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/catalina.jar\n    \ncp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/commons-fileupload-1.0-beta-1.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/servlets-default.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/servlets-manager.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/jakarta-regexp-1.2.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-warp.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/commons-modeler.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/tomcat-jk.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/commons-beanutils.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/server/lib/servlets-webdav.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/classes\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/commons-collections.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/servlet.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/jasper-compiler.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-factory.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/jasper-runtime.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-resources.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/ant.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/commons-logging-api.jar\n     cp=/opt/jakarta-tomcat-4.1.24-LE-jdk14/common/lib/naming-common.jar\n     work dir=/home/hias/tomcat4/work/Standalone/localhost/~hias_test1\n    srcDir=/home/hias/tomcat4/work/Standalone/localhost/~hias_test1\n    include=test_jsp.java\nException compiling Compile failed; see the compiler error output for details.\n\n2003-03-27 16:02:45 Exception: \nCompile failed; see the compiler error output for details.\n        at org.apache.tools.ant.taskdefs.Javac.compile(Javac.java:842)\n        at org.apache.tools.ant.taskdefs.Javac.execute(Javac.java:682)\n        at org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:317)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:370)\n        at\norg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:473)\n        at\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:190)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n        ...\n\n===== Attachement 2: End ==========="}, {"count": 1, "tags": [], "bug_id": 18411, "attachment_id": null, "text": "I have just followed the steps you describe and I do not see this issue.", "id": 54350, "time": "2004-03-21T21:32:09Z", "creator": "markt@apache.org", "creation_time": "2004-03-21T21:32:09Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "vamsi.kvv@gmail.com", "attachment_id": 30765, "id": 169719, "time": "2013-08-26T18:27:29Z", "bug_id": 55485, "creation_time": "2013-08-26T18:27:29Z", "is_private": false, "text": "Created attachment 30765\ntop output and trace of system calls(tusc)\n\nOur customer runs Apache 2.2.15 with worker module on HP Itanium server. also they use 3rd party module \"Oracle webgate\"(Please find the attached configuration files httpd.conf and httpd-mpm.conf)\n\nOnce in a while, they observe ~100% CPU consumption by the httpd processes.\nPlease find the attached files:\n1. stack trace : bt_all\n2. top and syscall trace (top_syscall_trace) \n3. Mapping between stack trace, source code and itanium assembly code(trace_srccode_assemblyCode)\n\nsyscall trace shows that main thread waits for the use space thread that run ap_core_input_filter()\n\ntrace:\nThread 22 (system thread 1947121):\n#0  0x40000000000977f0:2 in ap_core_input_filter () at core_filters.c:136\n#1  0x40000000000c3f50:0 in ap_get_brigade () at util_filter.c:489\n#2  0xc000000000ac76c0:0 in logio_in_filter () at mod_logio.c:129\n#3  0x40000000000c3f50:0 in ap_get_brigade () at util_filter.c:489\n#4  0x4000000000074980:0 in ap_rgetline_core () at protocol.c:231\n#5  0xc000000004a33580:0 in ap_proxygetline () at mod_proxy_http.c:1658\n#6  0xc000000004a338c0:0 in ap_proxy_http_process_response () at mod_proxy_http.c:1733\n#7  0xc000000004a35ee0:0 in proxy_http_handler () at mod_proxy_http.c:2434\n#8  0xc000000004929a10:0 in proxy_run_scheme_handler () at mod_proxy.c:2675\n#9  0xc000000004928b60:0 in proxy_handler () at mod_proxy.c:1024\n#10 0x400000000009d2d0:0 in ap_run_handler ()\n#11 0x400000000009e9e0:0 in ap_invoke_handler () at config.c:381\n#12 0x40000000000cdec0:0 in ap_process_request () at http_request.c:282\n#13 0x40000000000c5a40:0 in ap_process_http_connection () at http_core.c:190\n#14 0x40000000000b8d20:0 in ap_process_connection () at connection.c:189\n#15 0x40000000000de4c0:0 in process_socket () at worker.c:590\n#16 0x40000000000df860:0 in worker_thread () at worker.c:974\n#17 0xc000000006f95200:0 in dummy_worker () at threadproc/unix/thread.c:160\n#18 0xc00000000013fb20:0 in __pthread_bound_body () at /ux/core/libs/threadslibs/src/common/pthreads/pthread.c:4875\n\nEventhough it shows Line:136, actual loop happens @ line 141:\n   140      /* ### This is bad. */\n   141      BRIGADE_NORMALIZE(ctx->b);\n\nDue to compiler optimzation and macro @ line 141, this line no is not shown in trace.\n\n\nAs shown in trace_srccode_assemblyCode attachment, linked list has become circular because address and content of (ctx->b)->list))->next are same\n\n(gdb) info register r44\n   gr44: 0x6000000000777de8\n\n(gdb) x/gx0x6000000000777de8\n0x6000000000777de8:     0x6000000000777de8\n\nPrev\u2019s value also contains the same.\n(gdb) x/gx 0x6000000000774508\n0x6000000000774508:     0x6000000000777de8\n\nI think we need to add appropriate checks to prevent this issue. \n\nPlease help to resolve this."}, {"count": 1, "tags": [], "bug_id": 55485, "attachment_id": 30766, "id": 169720, "time": "2013-08-26T18:28:12Z", "creator": "vamsi.kvv@gmail.com", "creation_time": "2013-08-26T18:28:12Z", "is_private": false, "text": "Created attachment 30766\nstack trace"}, {"count": 2, "tags": [], "bug_id": 55485, "text": "Created attachment 30767\nmapping between stack trace, source code and assembly code", "id": 169721, "time": "2013-08-26T18:28:59Z", "creator": "vamsi.kvv@gmail.com", "creation_time": "2013-08-26T18:28:59Z", "is_private": false, "attachment_id": 30767}, {"count": 3, "attachment_id": 30765, "bug_id": 55485, "is_private": false, "id": 169825, "time": "2013-08-30T04:53:54Z", "creator": "vamsi.kvv@gmail.com", "creation_time": "2013-08-30T04:53:54Z", "tags": [], "text": "Comment on attachment 30765\ntop output and trace of system calls(tusc)\n\nDEtails will be added later due to some reason"}, {"count": 4, "tags": [], "creator": "vamsi.kvv@gmail.com", "attachment_id": 30766, "id": 169826, "creation_time": "2013-08-30T04:55:17Z", "time": "2013-08-30T04:55:17Z", "bug_id": 55485, "text": "Comment on attachment 30766\nstack trace\n\nNA", "is_private": false}, {"count": 5, "tags": [], "bug_id": 55485, "text": "Created attachment 30787\ntop output and trace of system calls(tusc)", "id": 169827, "time": "2013-08-30T06:21:58Z", "creator": "vamsi.kvv@gmail.com", "creation_time": "2013-08-30T06:21:58Z", "is_private": false, "attachment_id": 30787}, {"count": 6, "tags": [], "creator": "vamsi.kvv@gmail.com", "attachment_id": 30765, "text": "Comment on attachment 30765\ntop output and trace of system calls(tusc)\n\nLogs attached", "id": 169828, "time": "2013-08-30T06:35:30Z", "bug_id": 55485, "creation_time": "2013-08-30T06:35:30Z", "is_private": false}, {"count": 7, "tags": [], "text": "Hi, Details provided here are not complete. I will provide details later. Please remove all the attachments and if possible, this bug itself.\n\nApologies for inconvenience caused\n\nThanks.", "is_private": false, "bug_id": 55485, "id": 169833, "time": "2013-08-30T08:01:55Z", "creator": "vamsi.kvv@gmail.com", "creation_time": "2013-08-30T08:01:55Z", "attachment_id": null}]
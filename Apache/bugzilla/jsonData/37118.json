[{"count": 0, "tags": [], "creator": "asmorgrav@yahoo.no", "attachment_id": null, "is_private": false, "id": 81243, "time": "2005-10-17T15:31:45Z", "bug_id": 37118, "creation_time": "2005-10-17T15:31:45Z", "text": "The HTTP server runs on a lightly loaded sun4u/Solaris 8 (30% CPU utilisation)\nand frequently takes several seconds to serve a small static HTML file.\n\nThe following test was done locally on the server - no network connection. The\nname renno-05 is in /etc/hosts and the resolve order is files first, then dns.\n\n/u01/apache05/conf> /u01/opt/apache2/bin/ab -n 50 http://renno-05/supervision.html\nThis is ApacheBench, Version 2.0.41-dev <$Revision: 1.121.2.12 $> apache-2.0\nCopyright (c) 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nCopyright (c) 1998-2002 The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking renno-05 (be patient).....done\n\n\nServer Software:        Apache\nServer Hostname:        renno-05\nServer Port:            80\n\nDocument Path:          /supervision.html\nDocument Length:        479 bytes\n\nConcurrency Level:      1\nTime taken for tests:   3.741981 seconds\nComplete requests:      50\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      36550 bytes\nHTML transferred:       23950 bytes\nRequests per second:    13.36 [#/sec] (mean)\nTime per request:       74.840 [ms] (mean)\nTime per request:       74.840 [ms] (mean, across all concurrent requests)\nTransfer rate:          9.35 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.3      0       2\nProcessing:     1   74 491.5      1    3479\nWaiting:        0   73 491.6      1    3479\nTotal:          1   74 491.5      1    3479\n\nPercentage of the requests served within a certain time (ms)\n  50%      1\n  66%      2\n  75%      2\n  80%      3\n  90%     13\n  95%     35\n  98%   3479\n  99%   3479\n 100%   3479 (longest request)\n/u01/apache05/conf> \n\n\nWhat I notice in the attached trace output is that a thread may get suspended in\nthe middle of processing a request, after having done an lstat() on the file to\nserve and the directory in which the file is contained, and before writing to\nthe error log.\n\nIn the attached trace, thread #57 is put to sleep at 5.4249 s (relative to the\nstart of the trace), and resumes at 13.7153 s, almost 8 seconds later. Thread\n#103 is the listener thread.\n\nThe access logs corresponding to the time during which the trace was active\nshows that one of the requests took 8 s to complete :\n\n150.175.212.105 - - [17/Oct/2005:13:36:04 +0200] \"GET /supervision.html\nHTTP/1.0\" 200 479 \"-\" \"ApacheBench/2.0.41-dev\" (21090/57) 0s\n150.175.212.105 - - [17/Oct/2005:13:36:05 +0200] \"GET /supervision.html\nHTTP/1.0\" 200 479 \"-\" \"ApacheBench/2.0.41-dev\" (21090/57) 8s\n150.175.212.105 - - [17/Oct/2005:13:36:15 +0200] \"GET /supervision.html\nHTTP/1.0\" 200 479 \"-\" \"ApacheBench/2.0.41-dev\" (21090/57) 1s\n\n\nWe use a pretty high number of threads per child (100), but we do not expect\nthat this is the reason.\n\nThe environment is production. We have not been able to reproduce the problem in\nour benchmark environment. We have not been able to pin-point any differences in\npatchlevel etc. between the two environments."}, {"count": 1, "tags": [], "creator": "asmorgrav@yahoo.no", "attachment_id": 16717, "is_private": false, "id": 81244, "time": "2005-10-17T15:36:40Z", "bug_id": 37118, "creation_time": "2005-10-17T15:36:40Z", "text": "Created attachment 16717\nThis is a partial trace of one child process\n\nThis is a partial trace of one child process edited so that only the listener\nand one worker thread appear. The second HTTP request handled by worker #57 is\ninterrupted during 8 seconds."}, {"count": 2, "tags": [], "creator": "asmorgrav@yahoo.no", "attachment_id": 16718, "id": 81245, "time": "2005-10-17T15:38:57Z", "bug_id": 37118, "creation_time": "2005-10-17T15:38:57Z", "is_private": false, "text": "Created attachment 16718\nFull trace of child process"}, {"count": 3, "tags": [], "creator": "asmorgrav@yahoo.no", "attachment_id": 16718, "id": 81246, "time": "2005-10-17T15:39:55Z", "bug_id": 37118, "creation_time": "2005-10-17T15:39:55Z", "is_private": false, "text": "Comment on attachment 16718\nFull trace of child process\n\nThis file is gzip'ed"}, {"count": 4, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "id": 81322, "time": "2005-10-18T15:14:50Z", "bug_id": 37118, "creation_time": "2005-10-18T15:14:50Z", "is_private": false, "text": "There is no point debugging problems in 2.0.41-dev.  Try with the latest version\nand see if there is a problem."}, {"count": 5, "text": "Ah, it's probably just ab that is 2.0.41-dev.  Sorry.", "bug_id": 37118, "is_private": false, "id": 81324, "time": "2005-10-18T15:32:48Z", "creator": "slive@apache.org", "creation_time": "2005-10-18T15:32:48Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "creator": "asmorgrav@yahoo.no", "attachment_id": null, "is_private": false, "id": 81342, "time": "2005-10-18T19:49:31Z", "bug_id": 37118, "creation_time": "2005-10-18T19:49:31Z", "text": "Correct. The Apache used is 2.0.54 as indicated in the header.\n\nThe server (a dual-processor USparc IIIi) appears to be very lightly loaded\n(vmstat output below).\n\n procs     memory            page            disk          faults      cpu\n r b w   swap  free  si  so pi po fr de sr m0 m1 m2 m3   in   sy   cs us sy id\n 0 0 0 14192736 6676888 0 0 18  2  2  0  0  0  0  0  0  434 2052  749  3  3 94\n 0 0 0 13926984 6297968 0 0  0  0  0  0  0  0  0  0  0  560 3771 1243  6  4 90\n 4 0 0 13926984 6297832 0 0  0  8  8  0  0  0  0  0  0 1126 8035 2157 13  9 78\n 0 0 0 13926984 6297728 0 0  0  0  0  0  0  0  0  0  0  873 6631 1966 10  5 86\n 0 0 0 13926984 6297592 0 0  0  0  0  0  0  0  0  0  0 1110 5554 1760 10 12 78\n 0 0 0 13926984 6297520 0 0  0  0  0  0  0  0  0  0  0  807 3668 1397  5 10 85\n 0 0 0 13926984 6297480 0 0  0  0  0  0  0  0  0  0  0  617 3079 1220  5  2 93\n 1 0 0 13925352 6293552 0 0  0  4  4  0  0  0  0  0  0  707 6147 1332  8  6 86\n 0 0 0 13925664 6293792 0 0  0  0  0  0  0  0  0  0  0 1067 8028 2173 17  7 76\n 0 0 0 13926608 6296824 0 0  0 92 76  0  0  0  0  0  0 1540 10980 1977 12 12 76\n 0 0 0 13925944 6295888 0 0  0  4  4  0  0  0  0  0  0 1532 15132 1963 14 10 76\n 0 1 0 13925952 6295920 0 0  0  0  0  0  0  0  0  0  0  848 9263 1127  3  5 92\n 0 0 0 13926608 6296624 0 0  0  0  0  0  0  0  0  0  0 1404 2692 1247  6  5 89\n 0 0 0 13926608 6296528 0 0  0  0  0  0  0  0  0  0  0 1410 5101 1634  8  4 88\n 3 0 0 13926600 6296376 0 0  0  4  4  0  0  0  0  0  0 1500 12413 3115 18 11 71\n 0 0 0 13926568 6296184 0 0  0  0  0  0  0  0  0  0  0 1031 5763 1917  8  6 86\n 2 0 0 13924352 6295632 0 0  0  0  0  0  0  0  0  0  0 1164 9517 2321 23  6 70\n 0 0 0 13924048 6294960 0 0  0  4  4  0  0  0  0  0  0 2436 15093 3567 24 14 62\n 0 0 0 13924240 6294808 0 0  0  0  0  0  0  0  0  0  0 1559 13327 3065 25 12 62\n "}, {"count": 7, "tags": [], "creator": "asmorgrav@yahoo.no", "attachment_id": null, "id": 81701, "time": "2005-10-25T13:58:22Z", "bug_id": 37118, "creation_time": "2005-10-25T13:58:22Z", "is_private": false, "text": "We ended up upgrading a third party component that has been working flawlessly\nfor over a year. This appears to have resolved the problem although we never\nwere able to reproduce it in a test environment. We currently assume that the 3p\nmodule may not be entirely thread-safe."}, {"id": 82415, "tags": [], "bug_id": 37118, "attachment_id": null, "count": 8, "text": "The problem ended up not being in the third party module but in a external \ncomponent that the third-party module communicates with and in which there was \nresource contention.", "time": "2005-11-12T15:50:52Z", "creator": "asmorgrav@yahoo.no", "creation_time": "2005-11-12T15:50:52Z", "is_private": false}]
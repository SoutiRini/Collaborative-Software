[{"count": 0, "attachment_id": null, "bug_id": 24380, "text": "The problem seems is a header encoding proglem. Tomcat 4.1.29 always return \nheaders encoded in UTF8 irrespective of content type and any other settings. \nThis casued browser(MSIE) cannot download file with correct non-ISO characters \nfilename. There is no such problem found in 4.0.6 which outputs the filename in \nheaders with ISO encoding.\n\nHave tried charset=Big5, ISO8859-1, ..., all failed.\n\nExample:\n\n// filename obtained from file system in ISO format and convert to correct xxx \nencoding\nfilename=new String(filename.getBytes(\"ISO8859-1\"), \"xxx\");\nresponse.setContentType(\"application/x-download;charset=xxx\"); \nresponse.setHeader(\"Content-Disposition\", \"filename=\"+filename);\nServletOutputStream out = response.getOutputStream();\n// ... read the file from disk and write to user\nout.close();", "id": 46743, "time": "2003-11-04T11:17:05Z", "creator": "kenneth.y.kwan@pccw.com", "creation_time": "2003-11-04T11:17:05Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 24380, "text": "There's nothing in any spec which states the encoding that must be used for\nheaders. content-type specifies the entity body encoding only.", "id": 46754, "time": "2003-11-04T14:36:16Z", "creator": "remm@apache.org", "creation_time": "2003-11-04T14:36:16Z", "tags": [], "is_private": false}, {"count": 2, "attachment_id": null, "creator": "kenneth.y.kwan@pccw.com", "is_private": false, "id": 46834, "time": "2003-11-05T01:50:49Z", "bug_id": 24380, "creation_time": "2003-11-05T01:50:49Z", "tags": [], "text": "This spec grey area caused Tomcat cannot support non-ISO filename file download \nsince 4.1.2x. I think it needs to define clearly somewhere or better to leave \nheader encoding as ISO8859-1 as in 4.0.x version rather than UTF8 that most \nbrowsers, e.g. IE, do not understand."}, {"count": 3, "attachment_id": null, "bug_id": 24380, "is_private": false, "id": 47094, "time": "2003-11-10T08:11:31Z", "creator": "kenneth.y.kwan@pccw.com", "creation_time": "2003-11-10T08:11:31Z", "tags": [], "text": "Just further found it is a \"bug\" in Coyote/JK2 AJP 1.3 connector which comes \nwith Tomcat 4.1.2x.\n\nI have tested the old org.apache.ajp.tomcat4.Ajp13Connector with Tocmat 4.1.2x \nand found everything backs to normal, i.e. Headers are encoded in ISO8859-1 \nrather than UTF8"}, {"count": 4, "attachment_id": null, "bug_id": 24380, "text": "I agree with Remy on this.  However, I'll have to look into why mod_jk is \nencoding headers at all.  It is unlikely to be fixed in mod_jk, but hopefully \nmod_jk2 will support sending bytes in the headers.", "id": 47102, "time": "2003-11-10T09:52:37Z", "creator": "william.barker@wilshire.com", "creation_time": "2003-11-10T09:52:37Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 24380, "text": "After searching the sources, I found that in around line 333 of \nJkCoyoteHandler.java specifies the use of UTF8. Is it the problem area which \nalways encode the headers in UTF8?\n\nprivate void appendHead(org.apache.coyote.Response res)\n        throws IOException\n    {\n        ....\n        C2BConverter c2b=(C2BConverter)res.getNote( utfC2bNote );\n        if( c2b==null ) {\n            c2b=new C2BConverter(  \"UTF8\" ); <====== the problem line?\n            res.setNote( utfC2bNote, c2b );\n        }\n        ....", "id": 47334, "time": "2003-11-14T09:18:24Z", "creator": "kenneth.y.kwan@pccw.com", "creation_time": "2003-11-14T09:18:24Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "text": "\n\n*** This bug has been marked as a duplicate of 27796 ***", "attachment_id": null, "bug_id": 24380, "id": 68859, "time": "2004-12-22T21:55:57Z", "creator": "markt@apache.org", "creation_time": "2004-12-22T21:55:57Z", "is_private": false}]
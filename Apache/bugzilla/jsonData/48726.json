[{"count": 0, "tags": [], "bug_id": 48726, "attachment_id": 24967, "is_private": false, "id": 134411, "time": "2010-02-10T22:46:18Z", "creator": "adam@fixflyer.com", "creation_time": "2010-02-10T22:46:18Z", "text": "Created attachment 24967\npatch (diffed from org/apache/catalina/ant)\n\nI consistently get OutOfMemory errors when attempting to deploy a 70 mb WAR file to Tomcat using the Deploy ant task:\n\njava.lang.OutOfMemoryError: Java heap space\n        at org.apache.catalina.ant.AbstractCatalinaTask.execute(AbstractCatalinaTask.java:262)\n        at org.apache.catalina.ant.DeployTask.execute(DeployTask.java:201)\n        at com.flyer.izpack.webapp.Deploy.run(Deploy.java:68)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n        at java.lang.reflect.Method.invoke(Unknown Source)\n        at com.izforge.izpack.installer.ProcessPanelWorker$ExecutableClass.run(Unknown Source)\n        at com.izforge.izpack.installer.ProcessPanelWorker$ProcessingJob.run(Unknown Source)\n        at com.izforge.izpack.installer.ProcessPanelWorker.run(Unknown Source)\n        at java.lang.Thread.run(Unknown Source)\nCaused by: java.lang.OutOfMemoryError: Java heap space\n        at java.util.Arrays.copyOf(Unknown Source)\n        at java.io.ByteArrayOutputStream.write(Unknown Source)\n        at sun.net.www.http.PosterOutputStream.write(Unknown Source)\n        at java.io.BufferedOutputStream.write(Unknown Source)\n        at org.apache.catalina.ant.AbstractCatalinaTask.execute(AbstractCatalinaTask.java:215)\n        ... 10 more\n--- Nested Exception ---\njava.lang.OutOfMemoryError: Java heap space\n        at java.util.Arrays.copyOf(Unknown Source)\n        at java.io.ByteArrayOutputStream.write(Unknown Source)\n        at sun.net.www.http.PosterOutputStream.write(Unknown Source)\n        at java.io.BufferedOutputStream.write(Unknown Source)\n        at org.apache.catalina.ant.AbstractCatalinaTask.execute(AbstractCatalinaTask.java:215)\n        at org.apache.catalina.ant.DeployTask.execute(DeployTask.java:201)\n        at com.flyer.izpack.webapp.Deploy.run(Deploy.java:68)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n        at java.lang.reflect.Method.invoke(Unknown Source)\n        at com.izforge.izpack.installer.ProcessPanelWorker$ExecutableClass.run(Unknown Source)\n        at com.izforge.izpack.installer.ProcessPanelWorker$ProcessingJob.run(Unknown Source)\n        at com.izforge.izpack.installer.ProcessPanelWorker.run(Unknown Source)\n        at java.lang.Thread.run(Unknown Source)\n\nI've tracked the issue to the use of java.net.HttpURLConnection without setting the contentLength (in some cases) and not using 'fixed length streaming mode' when contentLength is available.\n\nI'm attaching a patch that works for me with the DeployTask. I know that org.apache.catalina.ant.AbstractCatalinaTask is subclassed by many tasks, but I haven't tested all of those.\n\nI can probably provide some code to reproduce if needed.\n\nSee also: https://issues.apache.org/bugzilla/show_bug.cgi?id=47660"}, {"count": 1, "attachment_id": null, "bug_id": 48726, "is_private": false, "id": 134417, "time": "2010-02-10T23:49:59Z", "creator": "markt@apache.org", "creation_time": "2010-02-10T23:49:59Z", "tags": [], "text": "Thanks for the patch. I've applied it to trunk and proposed it for 6.0.x"}, {"count": 2, "tags": [], "bug_id": 48726, "is_private": false, "text": "This may be completely irrelevant in this case, but just in case, the Javadoc for HttpURLConnection has the following comment:\n\n\"When output streaming is enabled, authentication and redirection cannot be handled automatically.\"\n\n[This was suggested as a solution for preventing OOM in JMeter file uploads. Not used it yet, as it would need to be optional.]", "id": 134419, "time": "2010-02-11T01:14:02Z", "creator": "sebb@apache.org", "creation_time": "2010-02-11T01:14:02Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "This has been fixed in 6.0.x and will be included in 6.0.25 onwards. Thanks again for the patch.", "id": 134792, "time": "2010-02-22T21:11:27Z", "bug_id": 48726, "creation_time": "2010-02-22T21:11:27Z", "is_private": false}]
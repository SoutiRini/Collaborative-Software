[{"count": 0, "tags": [], "text": "CorsFilter does not allow requests with the Origin header set to string \"null\". It treats such requests as invalid CORS requests. The current implementation seems too restrictive and prevents some common use cases: The Origin header is set to \"null\" when the browser cannot determine the origin of a request. This is the case when opening local files in the browser. Common uses cases are local development with remote services and testing hybrid mobile applications. To support such use cases, a new configuration option could be introduced where administrators could explicitly allow CORS requests with \"null\" origins.", "attachment_id": null, "bug_id": 57178, "id": 178925, "time": "2014-11-03T20:12:22Z", "creator": "gzurowski@apache.org", "creation_time": "2014-11-03T20:12:22Z", "is_private": false}, {"count": 1, "attachment_id": 32185, "bug_id": 57178, "is_private": false, "id": 178926, "time": "2014-11-03T20:17:31Z", "creator": "gzurowski@apache.org", "creation_time": "2014-11-03T20:17:31Z", "tags": [], "text": "Created attachment 32185\nPatch file for Bug #57178\n\nThe attached patch adds a new CorsFilter configuration option to explicitly allow \"null\" origins:\n\n<filter>\n   <filter-name>CorsFilter</filter-name>\n   <filter-class>org.apache.catalina.filters.CorsFilter</filter-class>\n   <init-param>\n      <param-name>cors.allow.nullorigin</param-name>\n      <param-value>true</param-value>\t\t\n   </init-param>\n</filter>\n\nWhen enabled, requests with \"null\" origins are processed as valid CORS requests. (The option is disabled by default.)"}, {"count": 2, "attachment_id": 32185, "bug_id": 57178, "is_private": false, "id": 180339, "time": "2015-01-17T16:28:18Z", "creator": "markt@apache.org", "creation_time": "2015-01-17T16:28:18Z", "tags": [], "text": "Comment on attachment 32185\nPatch file for Bug #57178\n\nPing. Reminder to me to look at this next week. Quick scan of the patch looks OK but I need to look at it in the context of the whole code."}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 180375, "time": "2015-01-19T12:18:47Z", "bug_id": 57178, "creation_time": "2015-01-19T12:18:47Z", "text": "Having had a closer look at this, I'm wondering why another configation option is needed. Why not just add \"null\" to the list of allowed origins? (This would still requires a small patch so null is accepted as a valid origin.)"}, {"count": 4, "tags": [], "bug_id": 57178, "attachment_id": null, "text": "No, is not needed, but I initially thought of a separate configuration option for making the decision of whether to allow the null origin more explicit. This also allows to control whether the default value \"*\" (any origin) of the existing configuration option 'cors.allowed.origins' includes or excludes the null origin. The proposed patch does not alter the current default behavior: if 'cors.allowed.origins' is set to \"*\", then the null origin is not allowed. It must be explicitly enabled by setting the new configuration option 'cors.allowed.nullorigins' to true, which might be useful for specific configuration needs.", "id": 180405, "time": "2015-01-19T23:52:41Z", "creator": "gzurowski@apache.org", "creation_time": "2015-01-19T23:52:41Z", "is_private": false}, {"text": "What is the use case for excluding the null origin but allowing all others? I've been reading through the CORS spec and related documents and haven't seen anything that suggests a use case. What I have read suggests that null should always be included in *.", "tags": [], "bug_id": 57178, "attachment_id": null, "count": 5, "id": 180410, "time": "2015-01-20T08:23:42Z", "creator": "markt@apache.org", "creation_time": "2015-01-20T08:23:42Z", "is_private": false}, {"count": 6, "tags": [], "text": "That is correct, the only use case would be really just supporting the current behavior. I would also prefer considering this behavior a bug and handle \"null\" as a valid origin (for both the default \"*\" case and when explicitly configured with \"null\" using the cors.allowed.origins parameter). I will follow up with a simplified patch without any new configuration options shortly.", "is_private": false, "id": 180460, "creator": "gzurowski@apache.org", "time": "2015-01-22T02:54:37Z", "bug_id": 57178, "creation_time": "2015-01-22T02:54:37Z", "attachment_id": null}, {"count": 7, "attachment_id": 32389, "bug_id": 57178, "is_private": false, "id": 180461, "time": "2015-01-22T03:04:57Z", "creator": "gzurowski@apache.org", "creation_time": "2015-01-22T03:04:57Z", "tags": [], "text": "Created attachment 32389\nSimplified patch for Bug#57178\n\nSimplified patch to handle \"null\" as a valid origin."}, {"count": 8, "tags": [], "text": "Thanks for the updated patch.\n\nThe fix has been applied to trunk, 8.0.x (for 8.0.18 onwards) and 7.0.x (for 7.0.58 onwards).", "is_private": false, "id": 180468, "creator": "markt@apache.org", "time": "2015-01-22T10:10:52Z", "bug_id": 57178, "creation_time": "2015-01-22T10:10:52Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 41749, "attachment_id": null, "id": 99978, "time": "2007-03-02T09:39:59Z", "creator": "jkessinger@awarepoint.com", "creation_time": "2007-03-02T09:39:59Z", "is_private": false, "text": "I have a problem about once a week with a server which primarily serves HTTPS.\nThe server continues to respond, but it pegs the CPU. The only remedy is to\nrestart tomcat. \n\nThe configuration is:\n\nRedhat EL 4.\nDual AMD Operteron Processors.\n1GB.\n2.6.9-42.0.2.ELsmp\nopenssl-0.9.7a-43.14\napr 1.2.8\ntomcat-native 1.1.8\ntomcat 5.5.20\nthawte issued certificate.\n\nHere's the stacktrace for the only two threads which are doing any work. All\nother threads are waiting.\n\n\"http-8443-14\" daemon prio=1 tid=0x090c0630 nid=0x1cdc runnable\n[0x883fe000..0x883feeb0]\n\tat org.apache.tomcat.jni.Socket.recvbb(Native Method)\n\tat\norg.apache.coyote.http11.InternalAprInputBuffer.fill(InternalAprInputBuffer.java:817)\n\tat\norg.apache.coyote.http11.InternalAprInputBuffer$SocketInputBuffer.doRead(InternalAprInputBuffer.java:852)\n\tat\norg.apache.coyote.http11.filters.IdentityInputFilter.doRead(IdentityInputFilter.java:115)\n\tat\norg.apache.coyote.http11.InternalAprInputBuffer.doRead(InternalAprInputBuffer.java:771)\n\tat org.apache.coyote.Request.doRead(Request.java:418)\n\tat org.apache.catalina.connector.InputBuffer.realReadBytes(InputBuffer.java:284)\n\tat org.apache.tomcat.util.buf.ByteChunk.substract(ByteChunk.java:404)\n\tat org.apache.catalina.connector.InputBuffer.read(InputBuffer.java:299)\n\tat org.apache.catalina.connector.CoyoteInputStream.read(CoyoteInputStream.java:192)\n\tat sun.nio.cs.StreamDecoder$CharsetSD.readBytes(Unknown Source)\n\tat sun.nio.cs.StreamDecoder$CharsetSD.implRead(Unknown Source)\n\tat sun.nio.cs.StreamDecoder.read(Unknown Source)\n\t- locked <0xa22ee680> (a java.io.InputStreamReader)\n\tat java.io.InputStreamReader.read(Unknown Source)\n\tat org.apache.xerces.readers.CharReader.fillCurrentChunk(CharReader.java:167)\n\tat org.apache.xerces.readers.CharReader.<init>(CharReader.java:85)\n\tat\norg.apache.xerces.readers.DefaultReaderFactory.createCharReader(DefaultReaderFactory.java:186)\n\tat\norg.apache.xerces.readers.DefaultReaderFactory.createReader(DefaultReaderFactory.java:140)\n\tat\norg.apache.xerces.readers.DefaultEntityHandler.startReadingFromDocument(DefaultEntityHandler.java:493)\n\tat org.apache.xerces.framework.XMLParser.parseSomeSetup(XMLParser.java:314)\n\tat org.apache.xerces.framework.XMLParser.parse(XMLParser.java:1097)\n\tat javax.xml.parsers.SAXParser.parse(Unknown Source)\n\tat\norg.apache.axis.encoding.DeserializationContext.parse(DeserializationContext.java:227)\n\tat org.apache.axis.SOAPPart.getAsSOAPEnvelope(SOAPPart.java:696)\n\tat org.apache.axis.Message.getSOAPEnvelope(Message.java:435)\n\tat org.apache.axis.server.AxisServer.initSOAPConstants(AxisServer.java:345)\n\tat org.apache.axis.server.AxisServer.invoke(AxisServer.java:279)\n\tat org.apache.axis.transport.http.AxisServlet.doPost(AxisServlet.java:699)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:709)\n\tat org.apache.axis.transport.http.AxisServletBase.service(AxisServletBase.java:327)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)\n\tat\norg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:524)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)\n\tat org.apache.coyote.http11.Http11AprProcessor.process(Http11AprProcessor.java:833)\n\tat\norg.apache.coyote.http11.Http11AprProtocol$Http11ConnectionHandler.process(Http11AprProtocol.java:639)\n\tat org.apache.tomcat.util.net.AprEndpoint$Worker.run(AprEndpoint.java:1285)\n\tat java.lang.Thread.run(Unknown Source)\n\n\"http-8443-10\" daemon prio=1 tid=0x084fac80 nid=0x8d8 runnable\n[0x8867d000..0x8867e130]\n\tat org.apache.tomcat.jni.Socket.recvbb(Native Method)\n\tat\norg.apache.coyote.http11.InternalAprInputBuffer.fill(InternalAprInputBuffer.java:817)\n\tat\norg.apache.coyote.http11.InternalAprInputBuffer$SocketInputBuffer.doRead(InternalAprInputBuffer.java:852)\n\tat\norg.apache.coyote.http11.filters.IdentityInputFilter.doRead(IdentityInputFilter.java:115)\n\tat\norg.apache.coyote.http11.InternalAprInputBuffer.doRead(InternalAprInputBuffer.java:771)\n\tat org.apache.coyote.Request.doRead(Request.java:418)\n\tat org.apache.catalina.connector.InputBuffer.realReadBytes(InputBuffer.java:284)\n\tat org.apache.tomcat.util.buf.ByteChunk.substract(ByteChunk.java:404)\n\tat org.apache.catalina.connector.InputBuffer.read(InputBuffer.java:299)\n\tat org.apache.catalina.connector.CoyoteInputStream.read(CoyoteInputStream.java:192)\n\tat sun.nio.cs.StreamDecoder$CharsetSD.readBytes(Unknown Source)\n\tat sun.nio.cs.StreamDecoder$CharsetSD.implRead(Unknown Source)\n\tat sun.nio.cs.StreamDecoder.read(Unknown Source)\n\t- locked <0x91572498> (a java.io.InputStreamReader)\n\tat java.io.InputStreamReader.read(Unknown Source)\n\tat org.apache.xerces.readers.CharReader.fillCurrentChunk(CharReader.java:167)\n\tat org.apache.xerces.readers.CharReader.<init>(CharReader.java:85)\n\tat\norg.apache.xerces.readers.DefaultReaderFactory.createCharReader(DefaultReaderFactory.java:186)\n\tat\norg.apache.xerces.readers.DefaultReaderFactory.createReader(DefaultReaderFactory.java:140)\n\tat\norg.apache.xerces.readers.DefaultEntityHandler.startReadingFromDocument(DefaultEntityHandler.java:493)\n\tat org.apache.xerces.framework.XMLParser.parseSomeSetup(XMLParser.java:314)\n\tat org.apache.xerces.framework.XMLParser.parse(XMLParser.java:1097)\n\tat javax.xml.parsers.SAXParser.parse(Unknown Source)\n\tat\norg.apache.axis.encoding.DeserializationContext.parse(DeserializationContext.java:227)\n\tat org.apache.axis.SOAPPart.getAsSOAPEnvelope(SOAPPart.java:696)\n\tat org.apache.axis.Message.getSOAPEnvelope(Message.java:435)\n\tat org.apache.axis.server.AxisServer.initSOAPConstants(AxisServer.java:345)\n\tat org.apache.axis.server.AxisServer.invoke(AxisServer.java:279)\n\tat org.apache.axis.transport.http.AxisServlet.doPost(AxisServlet.java:699)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:709)\n\tat org.apache.axis.transport.http.AxisServletBase.service(AxisServletBase.java:327)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)\n\tat\norg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:524)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)\n\tat org.apache.coyote.http11.Http11AprProcessor.process(Http11AprProcessor.java:833)\n\tat\norg.apache.coyote.http11.Http11AprProtocol$Http11ConnectionHandler.process(Http11AprProtocol.java:639)\n\tat org.apache.tomcat.util.net.AprEndpoint$Worker.run(AprEndpoint.java:1285)\n\tat java.lang.Thread.run(Unknown Source)\n\nUnfortunately I do not have a core yet to see where we are down on the native side. \n\nI moved to tomcat-native 1.1.8 only after experiencing this problem with 1.1.3.\nOriginally I had this same issue with tomcat-5.5.17 and whatever tcnative\nshipped with 5.5.17"}, {"count": 1, "tags": [], "bug_id": 41749, "attachment_id": null, "id": 100803, "time": "2007-03-22T12:07:28Z", "creator": "jkessinger@awarepoint.com", "creation_time": "2007-03-22T12:07:28Z", "is_private": false, "text": "I have managed to get gdb attached once or twice now. The loop appears to be in\nthe error condition in ssl_socket_recv . EAGAIN is being returned, and a tight\nloop occurs when data never arrives. \n\nI'm not certain who makes the socket non-blocking, but ssl_socket_recv does not\nappear to check for any sort of timeout conditions.\n\nThis seems to occur on large multi-packet POSTed SOAP requests. It looks like\nonly part of the SOAP request has been read. I'm not sure if there's some sort\nof packet dropping going on in my network."}, {"attachment_id": null, "tags": [], "bug_id": 41749, "is_private": false, "count": 2, "id": 103192, "time": "2007-05-14T09:29:18Z", "creator": "dshort@san.rr.com", "creation_time": "2007-05-14T09:29:18Z", "text": "Problem:\n\nI'm having an issue with Tomcat consuming 100% CPU when called from Apache via\najp13.  If I run my .jsp and servlet files through Tomcat directly (port 8084)\nall is well.  However, if Apache redirects my .jsp and servlet files to Tomcat\nvia ajp13, Tomcat starts consuming CPU and after a few seconds consumes all 100%\nand must be restarted to release CPU.  Non-SSL environment.\n\n\nSolution/Work Around:\n\nModify port 8009 (AJP/1.3) startup parameters to match Tomcat HTTP port startup\nparameters (in this case 8084), as follows:\n\n******* Working HTTP configuration - port 8084 *******\n\n<Connector acceptCount=\"100\" connectionTimeout=\"20000\"\ndisableUploadTimeout=\"true\" enableLookups=\"false\" maxHttpHeaderSize=\"8192\"\nmaxSpareThreads=\"75\" maxThreads=\"150\" \nminSpareThreads=\"25\" port=\"8084\" redirectPort=\"8443\"/>\n\n******* Working AJP 1.3 configuration - port 8009 *******\n\n<Connector acceptCount=\"100\" connectionTimeout=\"20000\"\ndisableUploadTimeout=\"true\" enableLookups=\"false\" maxHttpHeaderSize=\"8192\"\nmaxSpareThreads=\"75\" maxThreads=\"150\" \nminSpareThreads=\"25\" port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\"/>\n\n******* Non-Working AJP 1.3 configuration \u2013 port 8009 *******\n\n<Connector enableLookups=\"false\" port=\"8009\" protocol=\"AJP/1.3\"\nredirectPort=\"8443\"/>\n\n\nEnvironment:\n\nPentium 4 (3.4 Mhz)\n2 GB memory\nWindows XP Pro SP2\nMySQL 5.1\nApache 2.2.4\nMod_jk 2.2.4\nAJP 1.3 (port 8009)\nTomcat 5.5.23 (port 8084)\nJava 1.5.0_11-b03\n\n\nworkers.properties\n\nworkers.tomcat_home=C:\\Tomcat5\nworkers.java_home=C:\\Program Files\\Java\\jre1.5.0_11 \nps=\\\nworker.list=ajp13\nworker.ajp13.port=8009\nworker.ajp13.host=localhost\nworker.ajp13.type=ajp13"}, {"count": 3, "tags": [], "bug_id": 41749, "attachment_id": null, "is_private": false, "id": 103588, "time": "2007-05-23T23:40:37Z", "creator": "Thomas.Hoffmann@speed4trade.com", "creation_time": "2007-05-23T23:40:37Z", "text": "I have the same problem. i am using IIS6 with Tomcat 5.5.23 and JDK 1.5.0_11\nWin2003 Server x64\nWhen i debug the server remote i see ajp-polling-threads. one of them\nis utilizing 100% CPU\nwhen i suspend this polling-thread cpu-usage drops immediatelly.\ni dont use ssl. bug seems to be in the poll-method of the ajp-connector."}, {"count": 4, "tags": [], "bug_id": 41749, "attachment_id": null, "id": 103849, "time": "2007-05-30T18:47:12Z", "creator": "markt@apache.org", "creation_time": "2007-05-30T18:47:12Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of 42090 ***"}]
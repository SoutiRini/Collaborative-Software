[{"count": 0, "tags": [], "bug_id": 15088, "text": "As I know, JspServlet is responsible for checking if jsp should be reloaded or\nnot, etc.\n\nI found that JspServlet is checking it by opening the jsp file input stream.\nIn the loadJSP() method of JspServlet,\n\n\t// First check if the requested JSP page exists, to avoid creating\n\t// unnecessary directories and files.\n\tif (context.getResourceAsStream(jspUri) == null)\n\t    throw new FileNotFoundException(jspUri);\n\ncontext.getResourceAsStream() returns a InputStream object for the jsp file.\nI think this routine would call `org.apache.catalina.core.ApplicationContext''s\ngetResourceAsStream() method, and then call\n`org.apache.naming.resources.FileDirContext''s `streamContent()' method, which\nwould return a FileInputStream object.\n\nIf my inference is true, then `if (context.getResourceAsStream(jspUri) == null)'\ncode has a problem. Because this code doesn't close the FileInputStream object\nexplicitly, the file handle might be monitored only by garbage collector.\nThis can be a problem in case that the limit count of open files is set on a\nsystem. Every request can open a jsp stream, so the open file count increases.\n\nI don't think it's efficient to open the stream to check whether the jsp should\nbe reloaded or not.\n\nThanks. (My opinion could be based on misunderstandings.)", "id": 27443, "time": "2002-12-04T22:41:02Z", "creator": "martink@handysoft.com", "creation_time": "2002-12-04T22:41:02Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 15088, "text": "If the JSP file is more than 32K, then ProxyDirContext will not cache it and the \nFileDirContext.FileResource will not have its binaryContent set. Thus, when streamContent() is \ncalled, it returns a new FileInputStream, which JspServlet never closes. At that point, open files \ndefinitely become an issue.", "id": 37131, "time": "2003-05-13T16:54:39Z", "creator": "nick@digivis.com", "creation_time": "2003-05-13T16:54:39Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "This has been fixed in later versions (4.1.13 onwards) of Tomcat.", "attachment_id": null, "id": 55984, "creator": "markt@apache.org", "time": "2004-04-18T17:19:16Z", "bug_id": 15088, "creation_time": "2004-04-18T17:19:16Z", "is_private": false}]
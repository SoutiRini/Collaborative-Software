[{"count": 0, "tags": [], "bug_id": 56313, "attachment_id": 31435, "text": "Created attachment 31435\nthe log from the crash\n\nTomcat 8 crashed when ~1000 users were browsing a website (JSP front-end, Struts-2 backend with Java Persistence API, Hibernate, c3p0, MySQL).\n\nNo crashes are observed when using JAVA NIO (not tested with JAVA BIO).\n\nThe attached file is from the crash.", "id": 174076, "time": "2014-03-25T19:07:06Z", "creator": "ti_mo_n@poczta.fm", "creation_time": "2014-03-25T19:07:06Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 56313, "attachment_id": 31436, "text": "Created attachment 31436\nanother log - same issue", "id": 174077, "time": "2014-03-25T19:09:41Z", "creator": "ti_mo_n@poczta.fm", "creation_time": "2014-03-25T19:09:41Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 56313, "attachment_id": null, "text": "APR version is 1.5. OpenSSL 1.0.1f.", "id": 174078, "time": "2014-03-25T19:15:54Z", "creator": "ti_mo_n@poczta.fm", "creation_time": "2014-03-25T19:15:54Z", "is_private": false}, {"count": 3, "tags": [], "creator": "ti_mo_n@poczta.fm", "attachment_id": 31437, "id": 174079, "time": "2014-03-25T19:40:24Z", "bug_id": 56313, "creation_time": "2014-03-25T19:40:24Z", "is_private": false, "text": "Created attachment 31437\nthird one - same issue. Just to show that this is a recurring thing."}, {"count": 4, "tags": [], "bug_id": 56313, "attachment_id": null, "id": 174080, "creation_time": "2014-03-25T19:45:26Z", "time": "2014-03-25T19:45:26Z", "creator": "knst.kolinko@gmail.com", "text": "> Tomcat 8 crashed\n\nWhat exactly version of Tomcat 8.0.x ?", "is_private": false}, {"count": 5, "tags": [], "bug_id": 56313, "attachment_id": null, "id": 174081, "time": "2014-03-25T19:47:27Z", "creator": "ti_mo_n@poczta.fm", "creation_time": "2014-03-25T19:47:27Z", "is_private": false, "text": "8.0.3 - currently the latest one, AFAIK."}, {"count": 6, "tags": [], "bug_id": 56313, "attachment_id": null, "text": "Does high-load appear to be a required factor?", "id": 174082, "time": "2014-03-25T19:51:55Z", "creator": "chris@christopherschultz.net", "creation_time": "2014-03-25T19:51:55Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 56313, "attachment_id": null, "text": "Apaprently - yes. I wasn't able to reproduce it with low number of concurrent users. But it's hard to say if it would never crash or it's just that it would crash -- only much later.\n\nI used JMeter to simulate high load.\n\nThe whole server works flawlessly (including very low request-response latency) until the very end when it crashes. Nothing exceptional happens in the system: no unusual disk activity, no other CPU- or RAM-hungry processes. It just crashes suddenly for no obvious reason.", "id": 174083, "time": "2014-03-25T19:59:22Z", "creator": "ti_mo_n@poczta.fm", "creation_time": "2014-03-25T19:59:22Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 56313, "attachment_id": null, "text": "With 4000 users, it crashes in less than a minute (Used JMeter to test).", "id": 174084, "time": "2014-03-25T20:02:45Z", "creator": "ti_mo_n@poczta.fm", "creation_time": "2014-03-25T20:02:45Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 56313, "attachment_id": null, "id": 174108, "creation_time": "2014-03-26T17:02:27Z", "time": "2014-03-26T17:02:27Z", "creator": "chris@christopherschultz.net", "text": "Could you provide a JMeter test case? I'm sure that would be helpful. I'm not win32 dev, but I'm sure something that can reproduce the issue would be helpful to whoever looks at this.", "is_private": false}, {"count": 10, "tags": [], "text": "Created attachment 31441\nJMeter test plan", "attachment_id": 31441, "bug_id": 56313, "id": 174110, "time": "2014-03-26T17:31:53Z", "creator": "ti_mo_n@poczta.fm", "creation_time": "2014-03-26T17:31:53Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 56313, "text": "I used a debugger to locate the crash address in the source code. It looks like the crash occurs inside the function \"Java_org_apache_tomcat_jni_Poll_poll\", specifically inside the following block:\n\nfor (i = 0; i < num; i++) {\n    tcn_socket_t *s = (tcn_socket_t *)fd->client_data;\n    p->set[i*2+0] = (jlong)(fd->rtnevents);\n    p->set[i*2+1] = P2J(s);\n    if (remove) {\n        apr_pollset_remove(p->pollset, fd);\n        APR_RING_REMOVE(s->pe, link);\n        APR_RING_INSERT_TAIL(&p->dead_ring, s->pe, tcn_pfde_t, link);\n        s->pe = NULL;\n        p->nelts--;\n#ifdef TCN_DO_STATISTICS\n        p->sp_removed++;\n#endif\n    }\n    else {\n        /* Update last active with the current time\n        * after the poll call.\n        */\n        s->last_active = now;\n    }\n    fd ++;\n}\n\nThe crash address suggests that a read of the \"s->pe\" variable inside the \"if(remove)\" block fails (the variable is null).", "id": 174114, "time": "2014-03-26T19:03:09Z", "creator": "ti_mo_n@poczta.fm", "creation_time": "2014-03-26T19:03:09Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 56313, "text": "What I meant is that the s->pe is NULL, so a read from that address crashes the application.", "id": 174115, "time": "2014-03-26T19:04:54Z", "creator": "ti_mo_n@poczta.fm", "creation_time": "2014-03-26T19:04:54Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 56313, "text": "A quick workaround would be to check for NULL before doing the read. However, if the library is designed so that there shouldn't be any NULLs at this point in the code, such patch would only mask the underlying bug (a race condition maybe?).", "id": 174116, "time": "2014-03-26T19:07:10Z", "creator": "ti_mo_n@poczta.fm", "creation_time": "2014-03-26T19:07:10Z", "is_private": false, "attachment_id": null}, {"count": 14, "tags": [], "bug_id": 56313, "attachment_id": null, "text": "Same issue here, tried using the latest tomcat 7/8 but getting the same error and tomcat crashes.\n\nAny updates on this? (currently the only solution is to switch to NIO)", "id": 181774, "time": "2015-03-15T09:59:23Z", "creator": "pavel.rekun@gmail.com", "creation_time": "2015-03-15T09:59:23Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 56313, "text": "\n\n*** This bug has been marked as a duplicate of bug 57653 ***", "id": 181792, "time": "2015-03-15T23:48:39Z", "creator": "markt@apache.org", "creation_time": "2015-03-15T23:48:39Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "creator": "markt@apache.org", "text": "*** Bug 55797 has been marked as a duplicate of this bug. ***", "id": 200430, "time": "2017-08-23T21:52:37Z", "bug_id": 56313, "creation_time": "2017-08-23T21:52:37Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "bug_id": 56313, "attachment_id": null, "text": "*** Bug 56415 has been marked as a duplicate of this bug. ***", "id": 200432, "time": "2017-08-23T21:56:32Z", "creator": "markt@apache.org", "creation_time": "2017-08-23T21:56:32Z", "is_private": false}, {"count": 18, "tags": [], "bug_id": 56313, "attachment_id": null, "id": 200434, "creation_time": "2017-08-23T21:57:18Z", "time": "2017-08-23T21:57:18Z", "creator": "markt@apache.org", "text": "*** Bug 57140 has been marked as a duplicate of this bug. ***", "is_private": false}]
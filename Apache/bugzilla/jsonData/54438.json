[{"count": 0, "tags": [], "bug_id": 54438, "attachment_id": null, "id": 164681, "time": "2013-01-16T21:14:31Z", "creator": "bruce@iris.washington.edu", "creation_time": "2013-01-16T21:14:31Z", "is_private": false, "text": "The fix to bug 52953 introduces a NullPointerException at line 409\nin RealBase.java\n\nFor example compare:\nhttp://svn.apache.org/repos/asf/tomcat/tc7.0.x/tags/TOMCAT_7_0_26/java/org/apache/catalina/realm/RealmBase.java\n\nand \nhttp://svn.apache.org/repos/asf/tomcat/tc7.0.x/tags/TOMCAT_7_0_27/java/org/apache/catalina/realm/RealmBase.java\n\n\nString md5a1 = getDigest(username, realm);\nwas changed to\nString md5a1 = getDigest(username, realm).toLowerCase(Locale.ENGLISH);\n\nIf getDigest(username,realm) returns null if the user is not found\nand as a result you get a NPE when toLowerCase() is invoked on the null.\n\nI looked in the trunk, and the code hasn't changed.\n\nSeems like there should already be a bug posted on this as it makes digest\nauthentication useless, but I can't find one!"}, {"count": 1, "tags": [], "text": "There's also an issue with logging and this bug as the NullPointerException\nis not logged in any of the standard log file (catalina.out etc).\n\nFor example, this is what is returned in a web browser, but no mention of this \nis found in any of the log files.\n\nHTTP Status 500 -\n\ntype Exception report\n\nmessage\n\ndescription The server encountered an internal error that prevented it from fulfilling this request.\n\nexception\n\njava.lang.NullPointerException\n\torg.apache.catalina.realm.RealmBase.authenticate(RealmBase.java:409)\n\torg.apache.catalina.realm.CombinedRealm.authenticate(CombinedRealm.java:111)\n\torg.apache.catalina.realm.LockOutRealm.authenticate(LockOutRealm.java:150)\n\torg.apache.catalina.authenticator.DigestAuthenticator$DigestInfo.authenticate(DigestAuthenticator.java:720)\n\torg.apache.catalina.authenticator.DigestAuthenticator.authenticate(DigestAuthenticator.java:294)\n\torg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:544)\n\torg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99)\n\torg.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:936)\n\torg.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)\n\torg.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1004)\n\torg.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589)\n\torg.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:312)\n\tjava.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tjava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tjava.lang.Thread.run(Thread.java:680)\nnote The full stack trace of the root cause is available in the Apache Tomcat/7.0.34 logs.", "attachment_id": null, "bug_id": 54438, "id": 164682, "time": "2013-01-16T21:18:49Z", "creator": "bruce@iris.washington.edu", "creation_time": "2013-01-16T21:18:49Z", "is_private": false}, {"count": 2, "tags": [], "creator": "markt@apache.org", "text": "Thanks for the report. This has been fixed in trunk and 7.0.x and will be included in 7.0.36 onwards.", "id": 164698, "time": "2013-01-17T14:33:50Z", "bug_id": 54438, "creation_time": "2013-01-17T14:33:50Z", "is_private": false, "attachment_id": null}]
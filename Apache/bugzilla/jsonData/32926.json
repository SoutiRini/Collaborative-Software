[{"count": 0, "tags": [], "bug_id": 32926, "is_private": false, "text": "I suggest that you include in the Tomcat distribution a valve to filter HTTP\nrequests by method.  \n\nI have seen a few requests on how to disable PUT and DELETE methods.  Disabling\nthese methods is a common requirement for Tomcat in standalone mode at sites\nthat run the NESSUS security scanner.  \n\nI have written such a valve (it's a slight modification of RemoteAddrValve), and\noffer it to you with no restrictions.  The valve would be configured in\nserver.xml like this:\n\n<Engine ...>  <!-- or <Host> -->\n   <Valve className=\"org.apache.catalina.valves.HttpMethodValve\"\n               deny=\"PUT,DELETE\"/>\n\nHere is the code that I wrote for my server (I changed the package name to match\nwhat you would use):\n-------\npackage org.apache.catalina.valves;\n\nimport java.io.IOException;\nimport javax.servlet.ServletException;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.http.HttpServletRequest;\nimport org.apache.catalina.Request;\nimport org.apache.catalina.Response;\nimport org.apache.catalina.ValveContext;\n\n\n/**\n * Concrete implementation of <code>RequestFilterValve</code> that filters\n * HTTP requests based upon the string representation of the request method.\n *\n * in server.xml:\n * <Valve className=\"org.apache.catalina.valves.HttpMethodValve\"\n *        allow=\"comma-separated-string\" deny=\"comma-separated-string\" />\n *\n * where comma-separated-string is a list of HTTP methods (uppercase) separated\nby commas.\n *\n * Example: To disable PUT and DELETE methods on a standalone Tomcat 5 server,\n *\n * <Engine ...>  <!-- or <Host> -->\n *    <Valve className=\"org.apache.catalina.valves.HttpMethodValve\"\n *           deny=\"PUT,DELETE\" />\n * </Engine>\n *\n * @author Mark Anderson\n * @version $Revision: 1.0 $ $Date: 2004/12/27 13:56:21 $\n */\n\npublic final class HttpMethodValve\n    extends RequestFilterValve {\n\n\n    // ----------------------------------------------------- Instance Variables\n\n\n    /**\n     * The descriptive information related to this implementation.\n     */\n    private static final String info =\n        \"org.apache.catalina.valves.HttpMethodValve/1.0\";\n\n\n    // ------------------------------------------------------------- Properties\n\n\n    /**\n     * Return descriptive information about this Valve implementation.\n     */\n    public String getInfo() {\n\n        return (info);\n\n    }\n\n\n    // --------------------------------------------------------- Public Methods\n\n\n    /**\n     * Extract the desired request property, and pass it (along with the\n     * specified request and response objects) to the protected\n     * <code>process()</code> method to perform the actual filtering.\n     * This method must be implemented by a concrete subclass.\n     *\n     * @param request The servlet request to be processed\n     * @param response The servlet response to be created\n     * @param context The valve context used to invoke the next valve\n     *  in the current processing pipeline\n     *\n     * @exception IOException if an input/output error occurs\n     * @exception ServletException if a servlet error occurs\n     */\n    public void invoke(Request request, Response response,\n                       ValveContext context)\n        throws IOException, ServletException {\n\n\t\tServletRequest sreq = request.getRequest();\n\t\tif (sreq instanceof HttpServletRequest) {\n\t\t\tHttpServletRequest hreq = (HttpServletRequest) sreq;\n     \t\tprocess(hreq.getMethod(), request, response, context);\n\t\t}\n\n\t}\n\n\n}", "id": 69186, "time": "2005-01-03T20:32:41Z", "creator": "anderson@mitre.org", "creation_time": "2005-01-03T20:32:41Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "\nIs default servlet not doing the same at moment?\n\nhttp://jakarta.apache.org/tomcat/tomcat-5.5-doc/default-servlet.html#change\n\nsee ReadOnly property\n", "is_private": false, "bug_id": 32926, "id": 69204, "time": "2005-01-04T11:24:55Z", "creator": "tfohrer@t-online.de", "creation_time": "2005-01-04T11:24:55Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 32926, "attachment_id": null, "text": "We're not likely to accept Valves whose functionality can be easily done with \na Filter: portability is preferable.  Thanks for your submission offer: we do \nappreciate it.  ", "id": 69754, "time": "2005-01-17T03:21:15Z", "creator": "yoavs@computer.org", "creation_time": "2005-01-17T03:21:15Z", "is_private": false}, {"count": 3, "attachment_id": null, "creator": "patrickyccheng@gmail.com", "text": "readOnly flag affects doPut and doDelete, but does not affect doOptions.", "id": 136839, "time": "2010-05-13T13:30:20Z", "bug_id": 32926, "creation_time": "2010-05-13T13:30:20Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 32926, "attachment_id": null, "text": "actually, probably shouldn't reopen the issue. I created a separate issue for the patch to handle OPTIONS method.\n\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=49286", "id": 136841, "time": "2010-05-13T13:38:42Z", "creator": "patrickyccheng@gmail.com", "creation_time": "2010-05-13T13:38:42Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 53672, "is_private": false, "id": 161151, "creation_time": "2012-08-07T15:54:15Z", "time": "2012-08-07T15:54:15Z", "creator": "pedro.t.garcia@gmail.com", "text": "I have an excel file (I don't know how was generated) which contains cells missing the R value (I guess the R stands for reference).\nThis document has a cell reference only for the first cell in every row. Something like this:\n  <row>\n    <c r=\"A1\"><v>France</v></c>\n    <c><v>93</v></c>\n    <c><v>0.1957</v></c>\n    <c><v>2012/01/01</v></c>\n  </row>\n  <row>\n    <c r=\"A2\"><v>Italy</v></c>\n    <c><v>93</v></c>\n    <c><v>0.1957</v></c>\n    <c><v>2012/01/01</v></c>\n  </row>\nLibreOffice cannot process this file correctly and displays only the first cell for every row (omits cells without reference).\nXSSFRow cannot process this file correctly and displays only the last cell for every row (every cell is added to a map using the columnIndex as a key, and columnIndex is zero for every cell, so it overwrites every cell with the next one added).\nExcel displays this file correctly, but if you save a copy of it, the reference is updated for every cell with the right value.\nxlsx4j seems to process this file correctly.\n\nI have implemented a workaround (two in fact), but since my knowledge of the open document format is not very deep, I would like to know if it is right or there is a better way to do it, and if a fix for this could be added for a future release.\n\nHere are my workarounds:\n\nThe first one makes sure every cell is added to the _cells map even if _cellNum in XSSFCell is wrong.\npublic class XSSFRow implements Row, Comparable<XSSFRow> {\n    protected XSSFRow(CTRow row, XSSFSheet sheet) {\n        _row = row;\n        _sheet = sheet;\n        _cells = new TreeMap<Integer, XSSFCell>();\n        int columnIndex = -1;\n        for (CTCell c : row.getCArray()) {\n            XSSFCell cell = new XSSFCell(this, c);\n// Begin modification\n            if (c.getR() != null) {\n            \tcolumnIndex = cell.getColumnIndex();\n            } else {\n            \tcolumnIndex++;\n            }\n//          _cells.put(cell.getColumnIndex(), cell);\n            _cells.put(columnIndex, cell);\n// End modification\n            sheet.onReadCell(cell);\n        }\n    }\n}\n\nThe second one sets the R value when it's missing and thus adding the cell to the _cells map \"correctly\":\npublic class XSSFRow implements Row, Comparable<XSSFRow> {\n    protected XSSFRow(CTRow row, XSSFSheet sheet) {\n        _row = row;\n        _sheet = sheet;\n        _cells = new TreeMap<Integer, XSSFCell>();\n        int columnIndex = -1;\n        for (CTCell c : row.getCArray()) {\n// Begin modification\n            if (c.getR() != null) {\n            \tcolumnIndex = cell.getColumnIndex();\n            } else {\n            \tcolumnIndex++;\n            \tc.setR(CellReference.convertNumToColString(columnIndex));\n            }\n// End modification\n            XSSFCell cell = new XSSFCell(this, c);\n            _cells.put(cell.getColumnIndex(), cell);\n            sheet.onReadCell(cell);\n        }\n    }\n}\n\nThank you very much.", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 53672, "is_private": false, "text": "Well, in fact the second workaround has some mistakes. \nI copied the wrong lines. It should be like this (hope it's ok now I have edited it here):\npublic class XSSFRow implements Row, Comparable<XSSFRow> {\n    protected XSSFRow(CTRow row, XSSFSheet sheet) {\n        _row = row;\n        _sheet = sheet;\n        _cells = new TreeMap<Integer, XSSFCell>();\n        int columnIndex = -1;\n        for (CTCell c : row.getCArray()) {\n// Begin modification\n            if (c.getR() == null) {\n            \tcolumnIndex++;\n            \tc.setR(CellReference.convertNumToColString(columnIndex)+this.getRowNum());\n            }\n// End modification\n            XSSFCell cell = new XSSFCell(this, c);\n            columnIndex = cell.getColumnIndex();\n            _cells.put(cell.getColumnIndex(), cell);\n            sheet.onReadCell(cell);\n        }\n    }\n}", "id": 161152, "time": "2012-08-07T16:03:01Z", "creator": "pedro.t.garcia@gmail.com", "creation_time": "2012-08-07T16:03:01Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "yegor@dinom.ru", "text": "Fixed in r r1417379", "id": 163885, "time": "2012-12-05T12:24:23Z", "bug_id": 53672, "creation_time": "2012-12-05T12:24:23Z", "is_private": false, "attachment_id": null}]
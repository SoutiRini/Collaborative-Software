[{"count": 0, "tags": [], "bug_id": 46421, "text": "When the query returns multiple groups, the function authz_dbd_group_query() returns the array containing pointers to the right number of groups, but all point the same string, the last group (entry) returned.\n\nW/in the for loop I changed the if statement to this:\n\nif (rv == 0) {\n   group = apr_array_push(groups);\n   *tstring = apr_dbd_get_entry(dbd->driver, row, 0);\n   *group = apr_pcalloc(r->pool, strlen(*srwstring) + 1);\n   strcpy(*group, *srwstring);\n   *group = apr_dbd_get_entry(dbd->driver, row, 0);\n}\n\nNow the returned array (groups) contains an array of strings, each of which are at a newly allocated address.  This solved the problem in my usage with apache 2.2.10.  The function authz_dbd-group_query() didn't change in this area in the latest trunk copy in svn (to date).\n\nThanks much,\n   -Steve", "id": 123435, "time": "2008-12-19T14:28:16Z", "creator": "steven.whitson@gmail.com", "creation_time": "2008-12-19T14:28:16Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 46421, "attachment_id": null, "is_private": false, "id": 123436, "time": "2008-12-19T14:30:34Z", "creator": "steven.whitson@gmail.com", "creation_time": "2008-12-19T14:30:34Z", "text": "I see a couple typos in my submission.  The code should read:\n\nif (rv == 0) {\n   group = apr_array_push(groups);\n   *tstring = apr_dbd_get_entry(dbd->driver, row, 0);\n   *group = apr_pcalloc(r->pool, strlen(*tstring) + 1);\n   strcpy(*group, *tstring);\n   *group = apr_dbd_get_entry(dbd->driver, row, 0);\n}\n"}, {"count": 2, "tags": [], "bug_id": 46421, "text": "Which dbd driver are you using?\n\nLooking at current practice, most of them allocate memory in apr_dbd_get_entry and won't (or shouldn't) exhibit this bug.  We need to ensure consistent practice there before patching httpd.", "id": 123450, "time": "2008-12-20T14:08:01Z", "creator": "nick@webthing.com", "creation_time": "2008-12-20T14:08:01Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 46421, "attachment_id": null, "text": "Ok, what I finally ended up with (after applying this change directly to the original modules) is this:\n\nchar *tstring;\n\n            if (rv == 0) {\n                group = apr_array_push(groups);\n                tstring = apr_dbd_get_entry(dbd->driver, row, 0);\n                *group = apr_pcalloc(r->pool, strlen(tstring) + 1);\n                strcpy(*group, tstring);\n            }\n\nI'm using the mysql driver and have not tried this against any other.\n\n\nInteresting that the mysql driver might be reusing the same location to return each group but others are not.", "id": 123484, "time": "2008-12-22T08:06:59Z", "creator": "steven.whitson@gmail.com", "creation_time": "2008-12-22T08:06:59Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 46421, "text": "This is confusing: the mysql driver returns memory from what appears to be an array returned by mysql, so doesn't look as if it should need copying.  Anyway, I've just fixed mysql trunk to copy it.  If noone shouts I can backport.", "id": 138528, "time": "2010-07-19T20:12:08Z", "creator": "nick@webthing.com", "creation_time": "2010-07-19T20:12:08Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "ylavic.dev@gmail.com", "attachment_id": null, "is_private": false, "id": 182973, "time": "2015-05-13T11:49:28Z", "bug_id": 46421, "creation_time": "2015-05-13T11:49:28Z", "text": "Extended patch committed in r1663647 + r1679181 + r1679182.\nBackport to 2.4.x proposed in r1679183.\n\n(See https://www.mail-archive.com/dev@httpd.apache.org/msg61895.html for details)."}, {"count": 6, "tags": [], "bug_id": 46421, "text": "mod_authz_dbd is 2.4.x only...", "id": 182974, "time": "2015-05-13T12:21:09Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2015-05-13T12:21:09Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 46421, "is_private": false, "text": "This is part of the (unreleased) 2.4.13\nbackport in r1681107", "id": 183774, "time": "2015-06-27T07:14:37Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2015-06-27T07:14:37Z", "attachment_id": null}, {"count": 8, "text": "*** Bug 58246 has been marked as a duplicate of this bug. ***", "bug_id": 46421, "is_private": false, "id": 184593, "time": "2015-08-17T10:13:21Z", "creator": "john@voipsupport.it", "creation_time": "2015-08-17T10:13:21Z", "tags": [], "attachment_id": null}]
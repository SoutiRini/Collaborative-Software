[{"count": 0, "tags": [], "bug_id": 42940, "is_private": false, "text": "org.apache.tools.zip.ExtraFieldsUtils.parse hardcodes the ExtraField header size\nas 4 bytes. The spec \".ZIP File Format Specification\" (currently 6.3.1 -\n11/04/2007) states that compressed files \"should\" use a header size of 4 bytes.\n\nTools such as \"Beyond Compare\" use an ExtraField header size of 2 bytes, in the\nFirst Local Header. Tools such as 7-Zip, WinZip, Total Commander and FilZip\nsupport this 2 byte format. The Apache Zip implementation does not and throws\nthe exception:\n\njava.lang.RuntimeException: data starting at 0 is in unknown format\n\tat org.apache.tools.zip.ZipEntry.setExtra(ZipEntry.java:299)", "id": 105776, "time": "2007-07-19T04:58:35Z", "creator": "dave.bloodworth@googlemail.com", "creation_time": "2007-07-19T04:58:35Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "text": "Well, Ant doesn't implement the full ZIP specification, and certainly not the latest version of it.  When I wrote ZipOutputStream, I used the 970311 appnote which is referenced from java.util.zip's Javadocs.\n\nEven there there only is a note saying headers should follow a given format, but not a must.  I'll open a separate enhancement request to make Ant use more of the newer specs (like Unicode flags and ZIP64 support) and make this one depend on it.\n\nWill these other tools use the full format (ID + two bytes of size) in the central directory entry?  I wonder how - parsing the LFH - one will know whether the two bytes following the header id are a length or the next extra field header.", "id": 118790, "attachment_id": null, "bug_id": 42940, "creation_time": "2008-07-18T01:25:43Z", "time": "2008-07-18T01:25:43Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 42940, "is_private": false, "text": "could you provide a sample ZIP that fails to extract with Ant?  I don't have any tools around that would create extra fields with a header size other than four bytes.\n\nIs \"beyond compare\" this one\nhttp:// www.scootersoftware.com /compare-zip-files.php ?\n", "id": 121943, "time": "2008-10-28T04:19:48Z", "creator": "bodewig@apache.org", "creation_time": "2008-10-28T04:19:48Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 42940, "is_private": false, "id": 123593, "creation_time": "2008-12-29T14:05:13Z", "time": "2008-12-29T14:05:13Z", "creator": "suchko.pm@mellon.com", "text": "Created attachment 23056\nJAR file exported from Eclipse 3.3 (RAD 7.0.0.7) which ANT cannot unzip", "attachment_id": 23056}, {"count": 4, "tags": [], "bug_id": 42940, "text": "Created attachment 23057\nANT script to run to reproduce bug", "id": 123594, "time": "2008-12-29T14:07:06Z", "creator": "suchko.pm@mellon.com", "creation_time": "2008-12-29T14:07:06Z", "is_private": false, "attachment_id": 23057}, {"count": 5, "tags": [], "bug_id": 42940, "text": "Thanks.  This is what InfoZIP says:\n\n$ zip -Tv foo.zip\n        zip info: local extra (2 bytes) != central extra (4 bytes): META-INF/\nArchive:  foo.zip\n    testing: META-INF/                OK\n    testing: META-INF/MANIFEST.MF     OK\n    testing: SQLJAntScripts/          OK\n    testing: com/                     OK\n    testing: com/ibm/                 OK\n    testing: com/ibm/etools/          OK\n    testing: com/ibm/etools/xmlschema/   OK\n    testing: com/ibm/etools/xmlschema/beans/   OK\n    testing: com/mellon/              OK\n    testing: com/mellon/ccp/          OK\n    testing: com/mellon/ccp/beans/    OK\n    testing: com/mellon/ccp/exceptions/   OK\n    testing: com/mellon/ccp/nostro/   OK\n    testing: com/mellon/ccp/transactions/   OK\n    testing: com/mellon/ccp/util/     OK\n    testing: com/mellon/ccp/util/db/   OK\n    testing: com/mellon/ccp/xml/      OK\n    testing: com/mellon/ccp/xml/cicsccp/   OK\n    testing: com/mellon/cms/          OK\n    testing: com/mellon/cms/constants/   OK\n    testing: com/mellon/cms/databasecontrol/   OK\n    testing: com/mellon/cms/databasecontrol/exceptions/   OK\n    testing: com/mellon/cms/exceptions/   OK\n    testing: com/mellon/cms/service/   OK\n    testing: com/mellon/cms/util/     OK\n    testing: com/mellon/cms/util/beans/   OK\n    testing: com/mellon/gst/          OK\n    testing: com/mellon/gst/sas/      OK\n    testing: com/mellon/gst/sas/availability/   OK\n    testing: com/mellon/gst/sas/cache/   OK\n    testing: org/                     OK\n    testing: org/apache/              OK\n    testing: org/apache/commons/      OK\n    testing: org/apache/commons/beanutils/   OK\n    testing: org/apache/commons/beanutils/converters/   OK\n    testing: org/apache/commons/beanutils/locale/   OK\n    testing: org/apache/commons/beanutils/locale/converters/   OK\n    testing: org/apache/commons/collections/   OK\n    testing: org/apache/commons/collections/bag/   OK\n    testing: org/apache/commons/collections/bidimap/   OK\n    testing: org/apache/commons/collections/buffer/   OK\n    testing: org/apache/commons/collections/collection/   OK\n    testing: org/apache/commons/collections/comparators/   OK\n    testing: org/apache/commons/collections/functors/   OK\n    testing: org/apache/commons/collections/iterators/   OK\n    testing: org/apache/commons/collections/keyvalue/   OK\n    testing: org/apache/commons/collections/list/   OK\n    testing: org/apache/commons/collections/map/   OK\n    testing: org/apache/commons/collections/set/   OK\n    testing: org/apache/commons/digester/   OK\n    testing: org/apache/commons/digester/parser/   OK\n    testing: org/apache/commons/digester/plugins/   OK\n    testing: org/apache/commons/digester/plugins/strategies/   OK\n    testing: org/apache/commons/digester/substitution/   OK\n    testing: org/apache/commons/digester/xmlrules/   OK\n    testing: org/apache/log4j/        OK\n    testing: org/apache/log4j/chainsaw/   OK\n    testing: org/apache/log4j/chainsaw/doc-files/   OK\n    testing: org/apache/log4j/config/   OK\n    testing: org/apache/log4j/helpers/   OK\n    testing: org/apache/log4j/jdbc/   OK\n    testing: org/apache/log4j/lf5/    OK\n    testing: org/apache/log4j/lf5/config/   OK\n    testing: org/apache/log4j/lf5/util/   OK\n    testing: org/apache/log4j/lf5/viewer/   OK\n    testing: org/apache/log4j/lf5/viewer/categoryexplorer/   OK\n    testing: org/apache/log4j/lf5/viewer/configure/   OK\n    testing: org/apache/log4j/lf5/viewer/images/   OK\n    testing: org/apache/log4j/net/    OK\n    testing: org/apache/log4j/net/test/   OK\n    testing: org/apache/log4j/nt/     OK\n    testing: org/apache/log4j/or/     OK\n    testing: org/apache/log4j/or/jms/   OK\n    testing: org/apache/log4j/or/sax/   OK\n    testing: org/apache/log4j/performance/   OK\n    testing: org/apache/log4j/performance/history/   OK\n    testing: org/apache/log4j/performance/xml/   OK\n    testing: org/apache/log4j/spi/    OK\n    testing: org/apache/log4j/varia/   OK\n    testing: org/apache/log4j/varia/test/   OK\n    testing: org/apache/log4j/xml/    OK\n    testing: org/apache/log4j/xml/examples/   OK\n    testing: org/apache/log4j/xml/test/   OK\nNo errors detected in compressed data of foo.zip.\ntest of foo.zip OK\n\nI.e. a whole bunch of directories, a warning for the extra field on META-INF and a single file MANIFEST.MF - is this correct or should I expect more?", "id": 124443, "time": "2009-01-28T08:57:29Z", "creator": "bodewig@apache.org", "creation_time": "2009-01-28T08:57:29Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 42940, "is_private": false, "id": 124445, "creation_time": "2009-01-28T10:14:28Z", "time": "2009-01-28T10:14:28Z", "creator": "suchko.pm@mellon.com", "text": "Yes.  That is correct.\n\nI removed everything from the file except what was needed to reproduce the problem in ANT.\n\n", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 42940, "text": "Looking through the source code of InfoZIP's unzip the extra field parsing code will simply skip any extra fields shorter than four bytes as long as they are at the end of the extra field.\n\nI've modified Ant's zip package to do the same with svn revision 739300", "id": 124527, "time": "2009-01-30T07:00:43Z", "creator": "bodewig@apache.org", "creation_time": "2009-01-30T07:00:43Z", "is_private": false, "attachment_id": null}]
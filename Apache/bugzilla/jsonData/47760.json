[{"count": 0, "tags": [], "bug_id": 47760, "attachment_id": null, "id": 130029, "time": "2009-08-28T07:46:37Z", "creator": "cmohandas@1sync.org", "creation_time": "2009-08-28T07:46:37Z", "is_private": false, "text": "I am trying to deploy a war into a remote tomcat instance. I am using the ant task DeployTask. \nThe undeploy woks just fine. It deletes the exploaded war directory under the webapps and also the context descriptor under $CATALINA_BASE/conf/Catalina/localhost/pr.xml\nWhen the deploy task executes, it tries to deploy the webapp, however the context xml descriptor pr.xml does not get copied over.\n\nIf I have the context xml fragment in server.xml, then I cannot use Undeploy or Deploy tasks.\n\nWe need this feature to deploy the webapps to all our environments.\n\n\n <target name=\"install\" description=\"Install application in Tomcat\">\n\t  <available property=\"present\"\n               file=\"build/pr.xml\"\n               />\n\t<echo>present:${present}</echo>\n        <deploy url=\"${tomcat.manager.url}\"\n            username=\"${tomcat.username}\"\n            password=\"${tomcat.password}\"\n            path=\"/${webapp.name}\"\n\t    config=\"build/pr.xml\"\n            war=\"../${dist.dir}/lib/${app.name}.war\"/>\n   </target>\n\nregds,\nChiths"}, {"count": 1, "tags": [], "bug_id": 47760, "attachment_id": 24186, "id": 130030, "time": "2009-08-28T08:16:54Z", "creator": "cmohandas@1sync.org", "creation_time": "2009-08-28T08:16:54Z", "is_private": false, "text": "Created attachment 24186\nContext xml fragment of webapp\n\nThis xml contains the xml fragment for the webapp"}, {"count": 2, "tags": [], "bug_id": 47760, "attachment_id": null, "id": 130485, "time": "2009-09-17T08:53:26Z", "creator": "uwe@cscc.de", "creation_time": "2009-09-17T08:53:26Z", "is_private": false, "text": "I did a bit of investigation in this one.:\n\n1) It seems to me this isn't a bug.\n2) It seems to me you are mixing up two different deployment methods. \n\nBut let me explain it:\n\nFrom my point of view there is \n\n\ta) a local  deployment functionality and\n\tb) a remote deployment functionality  \n\t\nIn a) you can deploy a war file or a webapp directory to a local installed tomcat with or without a context fragment. Note: You have here a hard precondition: All files are local to the tomcat you want to deploy to.\n\nIn this case your ant target should look like this:\n\n  <target name=\"install\" description=\"Install application in Tomcat\">\n    <available property=\"present\" file=\"build/pr.xml\" />\n    <echo>present:${present}</echo>\n    <deploy url=\"${tomcat.manager.url}\"\n            username=\"${tomcat.username}\"\n            password=\"${tomcat.password}\"\n            path=\"/${webapp.name}\"\n            localWar=\"../${dist.dir}/lib/${app.name}.war\"\n            config=\"build/pr.xml\"/>\n  </target>\n\n\nIn b) you can only deploy a war file via HTTP PUT to your remote tomcat installation via the manager servlet. In this case you have to put your context fragment (pr.xml in your case) in META-INF/context.xml in your *.war file. You have to do this because it is not possible to upload a config file (context fragment aka context.xml) to a remote server via the  manager webapp which gets used by the deploy task.\n\nIn this case your ant target should look like this:\n\n  <target name=\"install\" description=\"Install application in Tomcat\">\n    <available property=\"present\" file=\"build/pr.xml\" />\n    <echo>present:${present}</echo>\n    <deploy url=\"${tomcat.manager.url}\"\n            username=\"${tomcat.username}\"\n            password=\"${tomcat.password}\"\n            path=\"/${webapp.name}\"\n            war=\"../${dist.dir}/lib/${app.name}.war\"/>\n  </target>\n\n\nNote: In b) Your context fragment from build/pr.xml has to be in ${app.name}.war!/META-INF/context.xml. While the deployment it gets copied to $CATALINA_BASE/conf/[engine]/[host]/[context].xml. In your case this would be $CATALINA_BASE/conf/Catalina/localhost/pr.xml.\n\n\nFor more information you can consult the following two links:\n\n<http://tomcat.apache.org/tomcat-6.0-doc/manager-howto.html#Supported Manager Commands>\n<http://tomcat.apache.org/tomcat-6.0-doc/manager-howto.html#Deploy A New Application Remotely>\n<http://tomcat.apache.org/tomcat-6.0-doc/manager-howto.html#Deploy A New Application from a Local Path>\n<http://mail-archives.apache.org/mod_mbox/tomcat-users/200312.mbox/%3C3FDE1EBB.5010002@yahoo.com%3E>\n\n\nIf you lock in the execute methode of the AntDeploy Task your observations become really obvious:\n\n// line 182\nif ((war == null) && (config != null)) {\n    sb.append(\"&config=\");\n    sb.append(URLEncoder.encode(config, getCharset()));\n}\nif ((war == null) && (localWar != null)) {\n    sb.append(\"&war=\");\n    sb.append(URLEncoder.encode(localWar, getCharset()));\n}\n// to 189\n\n\n-- \nKind Regards\nUwe G\u00fcnther"}]
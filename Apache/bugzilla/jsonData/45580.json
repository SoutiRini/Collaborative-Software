[{"count": 0, "tags": [], "creator": "friendpadma@gmail.com", "text": "Description of the scenario:\n\nConsider a client using web Messaging service with NIOConnector configured. Suppose if the client is closed by the time server writes the response to the socket, it throws a NPE. It appears that there is no check for the null socket condition. I think the addition of a null check will correct this.\n\nThe stack trace of the exception is: \n\n[ActiveMQMessageConsumer] Exception while processing message: java.lang.NullPointerException\njava.lang.NullPointerException\n\tat org.apache.coyote.http11.InternalNioOutputBuffer.addToBB(InternalNioOutputBuffer.java:607)\n\tat org.apache.coyote.http11.InternalNioOutputBuffer.commit(InternalNioOutputBuffer.java:600)\n\tat org.apache.coyote.http11.Http11NioProcessor.action(Http11NioProcessor.java:1034)\n\tat org.apache.coyote.Response.action(Response.java:183)\n\tat org.apache.coyote.Response.sendHeaders(Response.java:379)\n\tat org.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:305)\n\tat org.apache.catalina.connector.OutputBuffer.close(OutputBuffer.java:273)\n\tat org.apache.catalina.connector.CoyoteOutputStream.close(CoyoteOutputStream.java:104)", "id": 119490, "time": "2008-08-06T05:52:25Z", "bug_id": 45580, "creation_time": "2008-08-06T05:52:25Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "fhanik@apache.org", "text": "The NPE is only because of an incorrectly used response object. if you are trying to write to a response that has been closed, in a different thread, it is better for you to fix the application that is doing that. \n\nThere are simply too many NPE checks to do to catch all such scenarios, and they essentially don't do anything, they would just convert the NPE to a IOException.\n\nIf you believe the error comes from correct usage of the response, then please elaborate a little bit on how this happens, and we can apply a correct fix.\n\nbest\nFilip", "id": 119524, "time": "2008-08-06T13:54:23Z", "bug_id": 45580, "creation_time": "2008-08-06T13:54:23Z", "is_private": false, "attachment_id": null}]
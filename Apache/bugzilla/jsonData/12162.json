[{"count": 0, "tags": [], "creator": "aklimuk@iba.by", "text": "When ISAPI extension result code is 200 (OK), Apache correctly sends to client \nall content generated by ISAPI extension, but Apache always appends this \ncontent by error message (about internal server error).\n\nE.g. ISAPI extension generates following response:\n=========\n<html><body>Hello</body></html>\n=========\n\nThen Apache actually sends to client following:\n=========\n<html><body>Hello</body></html><!DOCTYPE ...>\n<html><head>\n<title>200 OK</title>\n</head><body>\n<h1>OK</h1>\n<p>The server encountered an internal error or\nmisconfiguration and was unable to complete\nyour request.</p>\n...\n=========\n\nThis occurs for any ISAPI extension module. The same extensions work fine under \nApache 1.3.12, 1.3.23, 2.0.32b.\n\nI made an investigation and found the cause of this bug.\nBriefly, problem occurs because \"isapi_handler()\" function returns HTTP status \ncode instead of OK.\nSee details below.\n\nISAPI handler is called from \"ap_invoke_handler()\" function (config.c module, \nline 400):\n    result = ap_run_handler(r);\n\"ap_invoke_handler\" is called from \"ap_process_request()\" function \n(http_request.c module, line 257):\n    access_status = ap_invoke_handler(r);\nFunction \"ap_process_request()\" expects that value of \"access_status\" is one of \nfollowing: OK (0), DECLINED (-1), or DONE (-2).\nBut actually \"access_status\" has value 200, therefore \"ap_die\" is called \n(http_request.c module, line 270), and error is reported. Furthermore, error \nmessage is appended to normal content, generated by ISAPI extension.\n\"access_status\" has value 200 because \"ap_invoke_handler()\" returns it. And \nthis occurs because \"isapi_handler()\" (mod_isapi.c module) returns 200.\nSee line 1537 in mod_isapi.c:\n    return cid->r->status;\nWe should replace it by following one:\n    return OK;\nThen problem disappears.\nCompare this string to one from 2.0.32b:\n    return OK;\t\t/* NOT r->status, even if it has changed. */\n\nThis is a fix for \"normal\" response from ISAPI extension when it returns 200. \nAll other \"return\" entries in \"isapi_handler()\" function seem to be correct.\n\n\nBest regards,\nAlexander Klimuk\n\n\n\n\nisapi_handler function returns HTTP status code instead of OK", "id": 21971, "time": "2002-08-29T14:42:42Z", "bug_id": 12162, "creation_time": "2002-08-29T14:42:42Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 12162, "text": "  \"This is a fix for \"normal\" response from ISAPI extension when it returns 200. \n   All other \"return\" entries in \"isapi_handler()\" function seem to be correct.\"\n\nWouldn't this also be correct if the 'error' was completely served by the ISAPI\nhandler?  Seems we need to distinguish the body-sent case [e.g. the error-body\nwas generated by the ISAPI handler] from the note-error-and-die case.\n", "id": 22227, "time": "2002-09-04T04:16:45Z", "creator": "wrowe@apache.org", "creation_time": "2002-09-04T04:16:45Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "wrowe@apache.org", "text": "\n  This is now fixed in CVS and will be included in the 2.0.44 release whenever\n  that version is announced.\n", "id": 26009, "time": "2002-11-09T17:51:55Z", "bug_id": 12162, "creation_time": "2002-11-09T17:51:55Z", "is_private": false, "attachment_id": null}]
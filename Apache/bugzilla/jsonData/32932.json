[{"count": 0, "tags": [], "bug_id": 32932, "is_private": false, "text": "Using a datasource defined in conf/Catalina/localhost/[context].xml don't work\nin tomcat 5.5.4 - 5.5.6a. The same setup worked with no problems in 5.0.28. \n\nI have tested with 5.5.4 and 5.5.6a. Both fail (regression from 5.0.28). \n\nHere is the stacktrace:\n\norg.apache.tomcat.dbcp.dbcp.SQLNestedException: Cannot create JDBC driver of\nclass '' for connect URL 'null'\n\tat\norg.apache.tomcat.dbcp.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:780)\n\tat\norg.apache.tomcat.dbcp.dbcp.BasicDataSource.getConnection(BasicDataSource.java:540)\n\tat my.package.dao.informix.InformixPollDAO.retrievePoll(Unknown Source)\n\tat my.package.actions.RetrievePollAction.execute(Unknown Source)\n\tat\norg.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:484)\n\tat org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:274)\n\tat org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\tat org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:507)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:689)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:674)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:465)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:400)\n\tat\norg.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:303)\n\tat my.package..WorkaroundURLsFilter.doFilter(Unknown Source)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:214)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)\n\tat\norg.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:407)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:825)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:738)\n\tat\norg.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:526)\n\tat\norg.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)\n\tat java.lang.Thread.run(Thread.java:595)\nCaused by: java.lang.NullPointerException\n\tat com.informix.jdbc.IfxDriver.checkURL(IfxDriver.java:454)\n\tat com.informix.jdbc.IfxDriver.acceptsURL(IfxDriver.java:278)\n\tat java.sql.DriverManager.getDriver(DriverManager.java:232)\n\tat\norg.apache.tomcat.dbcp.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:773)\n\t... 31 more\n\nWith the following [context].xml\n\n<Context path=\"/test\" docBase=\"test\"\n        debug=\"5\" reloadable=\"true\" >\n\n  <!-- Set up the datasource to be used throughout the application.  -->\n  <Resource name=\"jdbc/MyTestInformixDatasource\"\n            auth=\"Container\"\n            type=\"javax.sql.DataSource\">\n  </Resource>\n\n  <ResourceParams name=\"jdbc/MyTestInformixDatasource\">\n    <parameter>\n      <name>factory</name>\n      <value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n    </parameter>\n\n    <parameter>\n      <name>ifxHOST</name>\n      <value>xx.xx.com</value>\n    </parameter>\n\n    <parameter>\n      <name>portNumber</name>\n      <value>1526</value>\n    </parameter>\n\n    <parameter>\n      <name>datbaseName</name>\n      <value>MyTest</value>\n    </parameter>\n\n    <!-- Informix DB username and password for DB connections  -->\n    <parameter>\n     <name>user</name>\n     <value>test</value>\n    </parameter>\n    <parameter>\n     <name>password</name>\n     <value>test</value>\n    </parameter>\n\n    <parameter>\n     <name>serverName</name>\n     <value>ol_xxx</value>\n    </parameter>\n\n    <!-- Class name for Informix JDBC driver -->\n    <parameter>\n       <name>driverClassName</name>\n       <value>com.informix.jdbc.IfxDriver</value>\n    </parameter>\n\n    <!-- The JDBC connection url for connecting to the Informix DB. -->\n    <parameter>\n      <name>url</name>\n     \n<value>jdbc:informix-sqli://xx.xx.com:1526/MyTest:INFORMIXSERVER=ol_xxx;user=test;password=test</value>\n    </parameter>\n    \n  </ResourceParams>\n</Context>\n\n\nThe code to get the connection:\n\n    protected static DataSource getDataSource() throws PollDAOSysException {\n        DataSource ds = null;\n        try {\n            Context ctx = new InitialContext();\n            if (ctx == null) {\n                if (log.isErrorEnabled()) {\n                    log.error(\"No context!\");\n                }\n\n                throw new PollDAOSysException(\"No context!\");\n            }\n            ds = (DataSource) ctx.lookup(JNDIConstants.INFORMIX_RESOURCE);\n        }\n        catch (Exception e) {\n            if (log.isErrorEnabled()) {\n                log.error(\n                    \"Looking up datasource \" + JNDIConstants.INFORMIX_RESOURCE,\n                    e);\n            }\n            throw new PollDAOSysException(\n                \"Error looking up datasource \" + JNDIConstants.INFORMIX_RESOURCE);\n        }\n\n        return ds;\n    }", "id": 69196, "time": "2005-01-04T10:18:03Z", "creator": "mkmelin+apache@iki.fi", "creation_time": "2005-01-04T10:18:03Z", "attachment_id": null}, {"count": 1, "text": "Please read the documentation\n(http://jakarta.apache.org/tomcat/tomcat-5.5-doc/jndi-datasource-examples-howto.html)\nor post on tomcat-user.", "bug_id": 32932, "is_private": false, "id": 69198, "time": "2005-01-04T10:28:43Z", "creator": "remm@apache.org", "creation_time": "2005-01-04T10:28:43Z", "tags": [], "attachment_id": null}, {"count": 2, "text": "DataSource configuration changed between 5.0 and 5.5 series. Consult the JNDI \nDataSource documentation for 5.5 to help you make changes.", "bug_id": 32932, "is_private": false, "id": 69201, "time": "2005-01-04T10:50:44Z", "creator": "allistair.crossley@qas.com", "creation_time": "2005-01-04T10:50:44Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 32932, "is_private": false, "text": "Thanks, got it working. \nWould be good if this was mentioned somewhere (visible). ", "id": 69202, "time": "2005-01-04T10:57:53Z", "creator": "mkmelin+apache@iki.fi", "creation_time": "2005-01-04T10:57:53Z", "attachment_id": null}]
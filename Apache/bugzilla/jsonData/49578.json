[{"count": 0, "attachment_id": null, "bug_id": 49578, "is_private": false, "id": 138310, "time": "2010-07-09T15:11:47Z", "creator": "jboynes@apache.org", "creation_time": "2010-07-09T15:11:47Z", "tags": [], "text": "The XPath union expression \"$src/root/x | $src/root/y\" is not handled correctly as only the first set of nodes is returned. For example, the JSP\n<%@ taglib prefix=\"x\" uri=\"http://java.sun.com/jsp/jstl/xml\" %>\n<x:parse var=\"src\">\n    <root>\n        <x>one</x>\n        <x>two</x>\n        <x>three</x>\n        <y>a</y>\n        <y>b</y>\n    </root>\n</x:parse>\n<x:forEach select=\"$src/root/x | $src/root/y\">\n    <x:out select=\".\"/>\n</x:forEach>\n\nonly displays the \"x\" elements. Swapping the arms of the union operator returns the \"y\" elements."}, {"attachment_id": null, "tags": [], "bug_id": 49578, "is_private": false, "count": 1, "id": 138311, "time": "2010-07-09T15:20:59Z", "creator": "jboynes@apache.org", "creation_time": "2010-07-09T15:20:59Z", "text": "This appears to be because of the transformation of the expression performed in XPathUtil#adaptParamsForXalan which takes a variable reference at the start of the expression and maps to a context node. The documentation implies this is because:\n     * Given all of this, if no context node is set for the evaluation\n     * of the XPath expression, one must be set so Xalan \n     * can successfully evaluate a JSTL XPath expression.\n     * (it will not work if the context node is given as a varialbe\n     * at the beginning of the expression)\n \nHowever, Xalan is able to handle variable references like this through its VariableStack API (or as a XPathVariableResolver when called via the JAXP API)."}, {"attachment_id": null, "tags": [], "bug_id": 49578, "is_private": false, "count": 2, "id": 143019, "time": "2010-12-31T18:19:44Z", "creator": "jboynes@apache.org", "creation_time": "2010-12-31T18:19:44Z", "text": "Fixed with refactoring of XPath support in r1054175"}]
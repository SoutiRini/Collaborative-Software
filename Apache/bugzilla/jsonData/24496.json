[{"count": 0, "tags": [], "creator": "rony@groupturbo.com", "is_private": false, "text": "I've a sample application based on MVC-model. A servlet that make a session an \nmanager a database connection. I've developped with Jdeveloper, everything \nworks fine. Now I've deployed to tomcat4.1.24, when i go to oher jsp page the \nsession is null. Your help we'll be very useful\n.\nRony Auguste\nTurboSystem\nAnalyst-programmer.\n---------------------------------------\nhere's the servlet source :\n---------------------------------------\npackage pop;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\nimport java.io.PrintWriter;\nimport java.io.IOException;\nimport java.io.*;\nimport java.util.Properties;\nimport java.sql.*;\n\npublic class login extends HttpServlet implements java.io.Serializable\n{\n\n  private final String CONTENT_TYPE = \"text/html; charset=windows-1252\";\n  public  Connection con;\n\n  public void init(ServletConfig config) throws ServletException\n  {\n    super.init(config);\n\n  }\n\npublic void doPost(HttpServletRequest request, HttpServletResponse response) \nthrows ServletExce$\n           {\n            Properties conValues = Utilities.loadParams(\"/confile.properties\" );\n                String host   = (String)conValues.get( \"HOST\" );\n                String sid    = (String)conValues.get( \"SID\" );\n                String port   = (String)conValues.get( \"PORT\" );\n\n               //set the database url\n               String dburl = \"jdbc:oracle:thin:@\"+host+\":\"+port+\":\"+sid;\n               String user   = request.getParameter(\"username\") ;\n              String pass   = request.getParameter(\"password\") ;\n\n              //declaration des variables de connection\n              ResultSet rs   = null;\n              Statement stmt =null;\n               try\n                    {\n                       String driverName = \"oracle.jdbc.driver.OracleDriver\" ;\n                       Class.forName(driverName);\n                    }\n             catch (ClassNotFoundException e)\n                        {\n                                System.out.println(\"Unable to load driver \nclass : \");\n                                 System.out.println(e.getMessage());\n                     }\n             // connecting to the database\n             try {\n                con = DriverManager.getConnection(dburl,user,pass);\n stmt= con.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE,   \nResultSet.CONCUR_REA$\n                String querry=\"select a.AGENT_ID  from TRSF.AGENT a, \nTRSF.USER_AGENT u \"+\n                              \"where a.AGENT_ID = u.AGENT_ID    and u.USER_ID  \n= user\";\n                rs=stmt.executeQuery(querry) ;\n              if (rs.next()) {\n                  HttpSession session = request.getSession(true);\n                   synchronized(session) {\n                     session.setAttribute(\"uname\",user);\n                     session.setAttribute(\"agence\",rs.getString(1));\n                     session.setAttribute(\"con\",con);\n                    }\n                 request.setAttribute(\"db\",sid);\n\n                 ServletContext context = getServletContext();\n                 RequestDispatcher dispatcher=\n                 context.getRequestDispatcher(\"/jsp/main.jsp\");\n                 dispatcher.forward(request,response);\n\n              }\n              } //end try connecting to the database\n\n           catch(SQLException ex){\n              response.setContentType(CONTENT_TYPE);\n            PrintWriter out = response.getWriter();\n            out.println(\"Message :\"+ex.getMessage());\n           out.println(\"Etat :\"+ex.getSQLState());\n          out.println(\"Code erreur:\"+ex.getErrorCode()+\"\\n\");\n/*get catch\n\nfin get catch*/\n           }\n        } //end  dopost\n\n     }\n} // end class\n\n----------------------------------------\nI could retrieve the session on the main.jsp forward by the servlet, but  for \nthe other jsp nothing\n---------------------------\nex:\n<%@ page errorPage=\"error.jsp\" %>\n<%@ page session=\"true\" %>\n<%@ page import=\"java.sql.*\" %>\n<%@ page import = \"java.io.*\"  %>\n<%\n   HttpSession popsession = request.getSession(true);\n   Connection con= null ;\n   con = (Connection)popsession.getAttribute(\"con\");\n  if(con!=null){\n      Statement stmt         = null;\n      Statement stmt_date = null;\n      ResultSet rset         = null;\n      ResultSet rset_date = null;\n      try {\n             stmt = con.createStatement ();\n             stmt_date = con.createStatement ();\n             rset_date = stmt_date.executeQuery(\"select to_char\n(sysdate,'dd/mm/rrrr') from dual\")$\n             rset =stmt.executeQuery(\"select ua.USER_ID||',',ua.NAME \nname,ua.AGENT_ID\"+\n            \" from trsf.user_agent ua, trsf.agent ag where \nua.agent_id=ag.agent_id and\"+\n            \" ua.agent_id=trsf_agence.get_agence(user) order by 2\");\n            if (rset.next()) {\n            rset_date.next() ;\n   %>\n.....\n-----------\nIt returns null.", "id": 46992, "time": "2003-11-07T14:42:37Z", "bug_id": 24496, "creation_time": "2003-11-07T14:42:37Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "rony@groupturbo.com", "attachment_id": 8976, "is_private": false, "id": 46993, "time": "2003-11-07T14:45:07Z", "bug_id": 24496, "creation_time": "2003-11-07T14:45:07Z", "text": "Created attachment 8976\nservlet"}, {"count": 2, "tags": [], "bug_id": 24496, "attachment_id": null, "id": 46994, "time": "2003-11-07T14:49:24Z", "creator": "funkman@joedog.org", "creation_time": "2003-11-07T14:49:24Z", "is_private": false, "text": "Please use tomcat-user list to debug. Bugzilla is not for general support. It is\nfor filing bugs in tomcat."}]
[{"count": 0, "tags": [], "creator": "konrad.mrozek@tietoenator.com", "text": "Created attachment 22330\nPatch\n\nYou cannot set source of dropdown in List Data Validation type. To reproduce it:\n\n1. create excel with named area NAMEDAREA.\n2. load it using POI.\n3. create HSSFDataValidation object.\n4. set validation type to DATA_TYPE_LIST.\n5. set first formula to \"NAMEDAREA\".\n6. save workbook to file.\n7. open excel.\n8. try to type anything to cell. (result: excel crashes).\n9. try to expand list for cell. (it cannot be expaned).\n\nThe reason for this bug is wrong formula class of NAME token. It should be reference, not value. I attached patch, which solves the problem.", "id": 119118, "time": "2008-07-30T05:18:48Z", "bug_id": 45504, "creation_time": "2008-07-30T05:18:48Z", "is_private": false, "attachment_id": 22330}, {"count": 1, "tags": [], "bug_id": 45504, "text": "Fixed with bug 44953.\nThe junit (TestDataValidation) was augmented to include some tests for named ranges.\n\nYour patch works for this particular case (a formula with a single named range), however updating RVA (operand class) settings is rather complex (rules are applied via the tree structure, not to isolated tokens).  What was required was to set the operand type of the tree root node.  There are different rules for determining the RVA values of nodes elsewhere in the tree.\n\nNote - the API was changed a little bit .  The following code should now do what you described:\n\nHSSFWorkbook wb = new HSSFWorkbook();\nHSSFSheet sheet = wb.createSheet(\"Sheet1\");\nHSSFName namedRange = wb.createName();\nnamedRange.setNameName(\"NAMEDAREA\");\nnamedRange.setReference(\"Sheet1!$A$2:$A$7\");\n\n// add list data to cells A1:A9\nfor (int i = 0; i < 10; i++) {\n\tsheet.createRow(i + 0).createCell((short) 0).setCellValue(new HSSFRichTextString(\"Data \" + i));\n}\n\n// Add data validation to cell C1\nDVConstraint dc = DVConstraint.createFormulaListConstraint(\"NAMEDAREA\");\nCellRangeAddressList cral = new CellRangeAddressList(0, 0, 2, 2); // cell \"C1\"\nHSSFDataValidation dv = new HSSFDataValidation(cral, dc);\ndv.setEmptyCellAllowed(false);\ndv.setErrorStyle(HSSFDataValidation.ErrorStyle.STOP);\ndv.setShowErrorBox(true);\ndv.createErrorBox(\"Error\", \"invalid entry\");\ndv.setSuppressDropDownArrow(false);\nsheet.addValidationData(dv);\n\ntry {\n\tOutputStream os = new FileOutputStream(\"c:/temp/testDV-namedRange.xls\");\n\twb.write(os);\n\tos.close();\n} catch (IOException e) {\n\tthrow new RuntimeException(e);\n}\n", "id": 119330, "time": "2008-08-03T16:29:05Z", "creator": "josh@apache.org", "creation_time": "2008-08-03T16:29:05Z", "is_private": false, "attachment_id": null}]
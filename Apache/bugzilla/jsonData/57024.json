[{"count": 0, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "text": "We have observed that z/OS uniquely does not return IPv4 results to a getaddrinfo call with a family of AF_UNSPEC when there are 1 or more IPv6 results and the AI_ALL hint is not provided.\n\nhttp://pic.dhe.ibm.com/infocenter/zos/v1r11/index.jsp?topic=/com.ibm.zos.r11.bpxbd00/getaddrinfo.htm\n\n\"\"\"\nWhen the AF field has a value of AF_UNSPEC when the system supports IPv6 and AI_ALL is set, the caller accepts IPv6 addresses and either IPv4 (if AI_V4MAPPED is not set) or IPv4-mapped IPv6 (if AI_V4MAPPED is set) addresses.\n\"\"\"\n\nThe specs are clear that we should get both sets of addresses without any hints, and that AI_V4MAPPED is n/a to AF_UNSPEC _and_ that AI_ALL is n/a w/o AI_V4MAPPED.   \n\nBut this is all long-standing z/os behavior that they won't break for portability/compliance (we asked).\n\nI was thinking of something like this in APR to make it look like every other platform:\n\n===================================================================\n--- srclib/apr/network_io/unix/sockaddr.c       (revision 44260)\n+++ srclib/apr/network_io/unix/sockaddr.c       (working copy)\n@@ -325,6 +325,14 @@\n         hints.ai_flags = AI_ADDRCONFIG;\n     }\n #endif\n+#ifdef __MVS__\n+    /* z/OS will not return IPv4 address under AF_UNSPEC if any IPv6 results \n+     * are returned, unless AI_ALL is set.  \n+     */\n+    if (family == APR_UNSPEC) { \n+       hints.ai_flags |= AI_ALL        \n+    }\n+#endif\n     if(hostname == NULL) {\n #ifdef AI_PASSIVE \n         /* If hostname is NULL, assume we are trying to bind to all", "id": 178132, "time": "2014-09-26T17:42:16Z", "bug_id": 57024, "creation_time": "2014-09-26T17:42:16Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 57024, "text": "Seems reasonable Eric, lots of other platform-specific hacks in there already.", "id": 178939, "time": "2014-11-04T09:27:42Z", "creator": "jorton@redhat.com", "creation_time": "2014-11-04T09:27:42Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "When using javaagent in catalina.bat file Tomcat is giving ClassCircularityError. My application is using implementation of SecurityManager.\nI'm  trying to integrate newrelic with my application and since after installing newrelic I'm  getting  this error. While installing newrelic it adds javaagent in catalina.bat file.\n\nI'm working with Java 7 and Apache Tomcat 7.0.26\n\nFollowing is the stack trace.\nlog4j:ERROR Failed to append logging event to rolling file.\njava.lang.ClassCircularityError: java/lang/String\n\tat net.nicholaswilliams.java.licensing.LicenseSecurityManager.checkPermission(LicenseSecurityManager.java:259)\n\tat java.lang.reflect.AccessibleObject.setAccessible(AccessibleObject.java:128)\n\tat java.lang.Class$1.run(Class.java:351)\n\tat java.lang.Class$1.run(Class.java:349)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.lang.Class.newInstance0(Class.java:348)\n\tat java.lang.Class.newInstance(Class.java:325)\n\tat sun.reflect.MethodAccessorGenerator$1.run(MethodAccessorGenerator.java:399)\n\tat sun.reflect.MethodAccessorGenerator$1.run(MethodAccessorGenerator.java:396)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat sun.reflect.MethodAccessorGenerator.generate(MethodAccessorGenerator.java:395)\n\tat sun.reflect.MethodAccessorGenerator.generateMethod(MethodAccessorGenerator.java:77)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:46)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:601)\n\tat org.apache.log4j.spi.LocationInfo.<init>(LocationInfo.java:142)\n\tat org.apache.log4j.spi.LoggingEvent.getLocationInformation(LoggingEvent.java:253)\n\tat org.apache.log4j.helpers.PatternParser$ClassNamePatternConverter.getFullyQualifiedName(PatternParser.java:555)\n\tat org.apache.log4j.helpers.PatternParser$NamedPatternConverter.convert(PatternParser.java:528)\n\tat org.apache.log4j.helpers.PatternConverter.format(PatternConverter.java:65)\n\tat org.apache.log4j.PatternLayout.format(PatternLayout.java:506)\n\tat com.puresafety.logging.OhmRollingFileAppender.append(OhmRollingFileAppender.java:238)\n\tat org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:251)\n\tat org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:66)\n\tat org.apache.log4j.Category.callAppenders(Category.java:206)\n\tat org.apache.log4j.Category.forcedLog(Category.java:391)\n\tat org.apache.log4j.Category.log(Category.java:856)\n\tat org.apache.commons.logging.impl.Log4JLogger.warn(Log4JLogger.java:197)\n\tat org.springframework.beans.factory.support.DisposableBeanAdapter.destroy(DisposableBeanAdapter.java:247)\n\tat org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroyBean(DefaultSingletonBeanRegistry.java:510)\n\tat org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingleton(DefaultSingletonBeanRegistry.java:486)\n\tat org.springframework.beans.factory.support.DefaultListableBeanFactory.destroySingleton(DefaultListableBeanFactory.java:740)\n\tat org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingletons(DefaultSingletonBeanRegistry.java:455)\n\tat org.springframework.context.support.AbstractApplicationContext.destroyBeans(AbstractApplicationContext.java:1090)\n\tat org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:487)\n\tat org.springframework.web.context.ContextLoader.configureAndRefreshWebApplicationContext(ContextLoader.java:389)\n\tat org.springframework.web.context.ContextLoader.initWebApplicationContext(ContextLoader.java:294)\n\tat org.springframework.web.context.ContextLoaderListener.contextInitialized(ContextLoaderListener.java:112)\n\tat org.apache.catalina.core.StandardContext.listenerStart(StandardContext.java:4779)\n\tat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5273)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:895)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:871)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:615)\n\tat org.apache.catalina.startup.HostConfig.manageApp(HostConfig.java:1497)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:601)\n\tat org.apache.tomcat.util.modeler.BaseModelMBean.invoke(BaseModelMBean.java:301)\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:819)\n\tat com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:791)\n\tat org.apache.catalina.mbeans.MBeanFactory.createStandardContext(MBeanFactory.java:619)\n\tat org.apache.catalina.mbeans.MBeanFactory.createStandardContext(MBeanFactory.java:566)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:601)\n\tat org.apache.tomcat.util.modeler.BaseModelMBean.invoke(BaseModelMBean.java:301)\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:819)\n\tat com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:791)\n\tat javax.management.remote.rmi.RMIConnectionImpl.doOperation(RMIConnectionImpl.java:1447)\n\tat javax.management.remote.rmi.RMIConnectionImpl.access$200(RMIConnectionImpl.java:89)\n\tat javax.management.remote.rmi.RMIConnectionImpl$PrivilegedOperation.run(RMIConnectionImpl.java:1292)\n\tat javax.management.remote.rmi.RMIConnectionImpl.doPrivilegedOperation(RMIConnectionImpl.java:1380)\n\tat javax.management.remote.rmi.RMIConnectionImpl.invoke(RMIConnectionImpl.java:812)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:601)\n\tat sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:322)\n\tat sun.rmi.transport.Transport$1.run(Transport.java:177)\n\tat sun.rmi.transport.Transport$1.run(Transport.java:174)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat sun.rmi.transport.Transport.serviceCall(Transport.java:173)\n\tat sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:553)\n\tat sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:808)\n\tat sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:667)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\n\tat java.lang.Thread.run(Thread.java:722)", "is_private": false, "id": 191737, "creator": "dipankar.datta@ul.com", "time": "2016-06-17T09:52:45Z", "bug_id": 59715, "creation_time": "2016-06-17T09:52:45Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 59715, "attachment_id": null, "text": "Hi,\n\n(In reply to Dipankar Datta from comment #0)\n> When using javaagent in catalina.bat file Tomcat is giving\n> ClassCircularityError. My application is using implementation of\n> SecurityManager.\n> I'm  trying to integrate newrelic with my application and since after\n> installing newrelic I'm  getting  this error. While installing newrelic it\n> adds javaagent in catalina.bat file.\n> \n> I'm working with Java 7 and Apache Tomcat 7.0.26\n\nTomcat 7.0.26 is pretty old (more than 4 years old).\n\nCan you test your scenario with the most recent Tomcat 7 version (7.0.69)?\n\nRegards,\nVioleta", "id": 191743, "time": "2016-06-17T10:33:51Z", "creator": "violetagg@apache.org", "creation_time": "2016-06-17T10:33:51Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 59715, "attachment_id": null, "text": "I have upgraded Tomcat from 7.0.26 to 7.0.69 but still the issue exists.", "id": 191858, "time": "2016-06-21T08:37:18Z", "creator": "dipankar.datta@ul.com", "creation_time": "2016-06-21T08:37:18Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 59715, "attachment_id": null, "text": "I'm certain this isn't a Tomcat issue.\n\nIf java.lang.String requires java.lang.String to load itself, then something is wrong with the JVM itself, or with the custom SecurityManager that may be damaging the ClassLoader hierarchy.", "id": 191872, "time": "2016-06-21T17:02:15Z", "creator": "chris@christopherschultz.net", "creation_time": "2016-06-21T17:02:15Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 59715, "text": "Just have been informed it was New Relic issue, which has been fixed in their latest release. Thank you for your efforts.", "id": 192014, "time": "2016-06-29T14:07:28Z", "creator": "dipankar.datta@ul.com", "creation_time": "2016-06-29T14:07:28Z", "is_private": false, "attachment_id": null}]
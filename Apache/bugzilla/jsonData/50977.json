[{"count": 0, "tags": [], "bug_id": 50977, "attachment_id": null, "text": "OVERVIEW\n\nWhichever TCP Sampler Timeout value comes first in the Test Plan is enforced for all samples despite setting differing values for later TCP Samplers.\n\nSTEPS TO REPRODUCE\n\n1. Create a Test Plan with a single thread, Loop Count of 1 and two TCP Samplers.\n2. Set the IP Address and TCP Port in both TCP Samplers to point at a server (say TELNET)\n3. Put nothing in the Text to send box\n4. Set a Timeout in the first TCP Sampler to 1000ms and the second 3000ms\n5. Add View Results in Table listener\n6. Run the test\n7. Review the Sample Time(ms) values in the listener\n\nACTUAL RESULTS\n\nBoth sampler timeout in 1000ms\n\nEXPECTED RESULTS\n\nThe second sampler should timeout in 3000ms\n\nBUILD PLATFORM\n\nWindows 7 Professional - 32 bit\njava version \"1.6.0_22\"\nJava(TM) SE Runtime Environment (build 1.6.0_22-b04)\nJava HotSpot(TM) Client VM (build 17.1-b03, mixed mode, sharing)\nJMeter 2.4 r961953 \n\nADDITIONAL INFORMATION\n\nThe cause appears to be in TCPSampler.java and due to the fact that the read timeout is set is on creating the socket only.\n\nFurther details can be found at http://jmeter.512774.n5.nabble.com/TCPSampler-Timeout-Can-t-set-on-sample-basis-td3890878.html", "id": 145291, "time": "2011-03-26T12:49:49Z", "creator": "paul.offord@advance7.com", "creation_time": "2011-03-26T12:49:49Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 50977, "is_private": false, "text": "I fixed the problem by adding a single line of code to TCPSampler.java as follows:\n\n    public SampleResult sample(Entry e)// Entry tends to be ignored ...\n    {\n.\n.\n.\n            } else {\n                InputStream is = sock.getInputStream();\n                OutputStream os = sock.getOutputStream();\n               \n                // *** FIXED BY ADDING THE FOLLOWING LINE\n                sock.setSoTimeout(getTimeout());\n               \n                String req = getRequestData();\n                // TODO handle filenames\n                res.setSamplerData(req);\n                protocolHandler.write(os, req);\n                String in = protocolHandler.read(is);\n                res.setResponseData(in, null);\n                res.setDataType(SampleResult.TEXT);\n                res.setResponseCodeOK();\n                res.setResponseMessage(\"OK\"); //$NON-NLS-1$\n                isSuccessful = true;\n.\n.\n.\n\nThis seems to fix the problem and I'm not getting any adverse effects.\n\nSoory this isn't written like a patch but I don't know how to do it", "id": 145292, "time": "2011-03-26T12:55:54Z", "creator": "paul.offord@advance7.com", "creation_time": "2011-03-26T12:55:54Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "milamber@apache.org", "text": "Thanks. Finally, I've put the setSoTimeout() in getSocket() because this place is better for do this. I've also sets Nodelay option for each sampler.\n\nURL: http://svn.apache.org/viewvc?rev=1086424&view=rev\nLog:\nBug 50977 - Unable to set TCP Sampler for individual samples\n\nModified:\n    jakarta/jmeter/trunk/src/protocol/tcp/org/apache/jmeter/protocol/tcp/sampler/TCPSampler.java\n    jakarta/jmeter/trunk/xdocs/changes.xml", "id": 145368, "time": "2011-03-28T18:26:53Z", "bug_id": 50977, "creation_time": "2011-03-28T18:26:53Z", "is_private": false, "attachment_id": null}]
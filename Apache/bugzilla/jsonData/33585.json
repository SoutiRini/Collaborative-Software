[{"count": 0, "tags": [], "text": "I'm running Ant 1.6.1 on Windows XP under Sun's 1.4.2 JDK.  \n\nI've written a build.xml that automatically runs JUnit tests and generates XML \nreports using the JUnitReport task.  It's been successful for me in the past \nwith Ant 1.5.\n\nNow when I run it under Ant 1.6 I get a ClassNotFoundException for my TestCase.\n\nI know that means CLASSPATH problems.  I've set build.sysclasspath=ignore in my \nproperties file and set the CLASSPATH inside the build.xml.  When I click on \nProperties in the XML report I can see the class that can't be found in \njava.class.path, so I believe it's set correctly.\n\nI can't for the life of me figure out why the class loader can't find the \nTestCases.  \n\nHere are the properties I've used:\n\n# Project specific items that change each time\nproject=oe-rtf\nmajor=1\nminor=0\nversion=${major}.${minor}\njar.name=${project}\nversiondate=${TODAY}\n\n# Tells Ant to ignore the system CLASSPATH and use only the\n# internally-set CLASSPATH.  Depend on the build.xml author\n# to get the CLASSPATH right.\nbuild.sysclasspath=ignore\n\n\n\n# Everything under source should come out of a repository\nsource=source\nsource.java=${source}/java\nsource.lib=${source}/lib\nsource.bin=${source}/bin\nsource.xml=${source}/rtf\nsource.xml=${source}/xml\nsource.xsl=${source}/xsl\n\n\n\n\n# These are created and deleted by Ant each time\nbuild=build\nbuild.classes=${build}/classes\nbuild.manifest=${build}/manifest\nbuild.lib=${build}/lib\nbuild.javadocs=${build}/javadocs\nbuild.reports=${build}/reports\n\ndeploy=deploy\n \nHere is the complete build.xml:\n\n<project name=\"Standard Ant Build XML\" default=\"javadocs\" basedir=\".\">\n\n\n\n\n    <target name=\"init-props\" description=\"initialize properties\">\n\n        <tstamp>\n            <format property=\"touch.time\" pattern=\"MM/dd/yyyy hh:mm aa\"/>\n        </tstamp>\n        \n        <filterset id=\"ant.filters\">\n            <filter token=\"DATE\" value=\"${TODAY}\"/>\n            <filter token=\"TIME\" value=\"${TSTAMP}\"/>\n        </filterset>\n\n        <!-- Load in all the settings in the properties file -->\n        <property file=\"build.properties\"/>\n\n    </target>\n\n\n\n\n    <target name=\"prepare\" depends=\"init-props\" description=\"create all the \nnecessary directories\">\n        <mkdir dir=\"${build}\"/>\n        <mkdir dir=\"${build.javadocs}\"/>\n        <mkdir dir=\"${build.classes}\"/>\n        <mkdir dir=\"${build.manifest}\"/>\n        <mkdir dir=\"${build.reports}\"/>\n        <mkdir dir=\"${deploy}\"/>\n    </target>\n\n\n\n\n    <target name=\"clean\" depends=\"init-props\" description=\"clean up the output \ndirectories\">\n        <delete dir=\"${build.javadocs}\"/>\n        <delete dir=\"${build.javadocs}\"/>\n        <delete dir=\"${build.classes}\"/>\n        <delete dir=\"${build.manifest}\"/>\n        <delete dir=\"${build.reports}\"/>\n        <delete dir=\"${deploy}\"/>\n    </target>\n\n\n\n\n    <!-- Set the project class path for all targets -->\n    <target name=\"set-classpath\" depends=\"prepare\" description=\"set the project \nclasspath\">\n\n        <path id=\"project.class.path\">\n            <fileset dir=\"${source.lib}\">\n                <patternset>\n                    <include name=\"**/*.jar\"/>\n                </patternset>\n            </fileset>\n\n            <fileset dir=\"${build.classes}\">\n                <patternset>\n                    <include name=\"**/*.class\"/>\n                </patternset>\n            </fileset>\n        </path>\n\n    </target>\n\n\n\n\n    <target name=\"echo-classpath\" depends=\"set-classpath\" description=\"echo the \nclasspath\">\n        <pathconvert dirsep=\";\" pathsep=\"/\" property=\"converted.class.path\">\n            <path refid=\"project.class.path\"/>\n        </pathconvert>\n        <echo message=\"${converted.class.path}\"/>\n    </target>\n\n\n\n\n    <target name=\"compile\" depends=\"set-classpath\" description=\"compile all \njava\">\n        <javac srcdir=\"${source.java}\"\n               destdir=\"${build.classes}\"\n               deprecation=\"on\"\n               debug=\"on\">\n            <classpath refid=\"project.class.path\"/>\n            <include name=\"**/*.java\"/>\n        </javac>\n    </target>\n\n\n\n\n    <target name=\"test\" depends=\"compile\" description=\"run all unit tests\">\n        <pathconvert dirsep=\"/\" pathsep=\";\" property=\"converted.class.path\">\n            <path refid=\"project.class.path\"/>\n        </pathconvert>\n        <echo message=\"${converted.class.path}\"/>\n        <junit>\n            <classpath refid=\"project.class.path\"/>\n            <formatter type=\"xml\"/>\n            <batchtest fork=\"yes\" todir=\"${build.reports}\">\n                <fileset dir=\"${build.classes}\">\n                    <include name=\"**/*TestCase.class\"/>\n                </fileset>\n            </batchtest>\n        </junit>\n    </target>\n\n\n\n\n    <target name=\"report\" depends=\"test\" description=\"create HTML report for \nJUnit test results\">\n        <junitreport todir=\"${build.reports}\">\n            <fileset dir=\"${build.reports}\">\n                <include name=\"TEST-*.xml\"/>\n            </fileset>\n            <report format=\"frames\" todir=\"${build.reports}\"/>\n        </junitreport>\n    </target>\n\n\n\n    <target name=\"deploy\" depends=\"report\" description=\"deploy the application\">\n\n        <buildnumber/>\n\n        <manifest file=\"${build.manifest}/manifest.mf\">\n            <attribute name=\"Implementation-Title\"      value=\"${project}\"/>\n            <attribute name=\"Built-By\"                  value=\"${user.name}\"/>\n            <attribute name=\"Build-Date\"                value=\"${TODAY}\"/>\n            <attribute name=\"Major-Version\"             value=\"${major}\"/>\n            <attribute name=\"Minor-Version\"             value=\"${minor}\"/>\n            <attribute name=\"Build-Number\"              \nvalue=\"${build.number}\"/>\n        </manifest>\n\n        <jar jarfile=\"${deploy}/${project}.jar\" \n             manifest=\"${build.manifest}/manifest.mf\">\n            <fileset dir=\"${build.classes}\" excludes=\"**/*TestCase*.class, \n**/*TestSuite*.class\"/>\n        </jar>\n\n        <jar jarfile=\"${deploy}/${project}-tests.jar\"\n             manifest=\"${build.manifest}/manifest.mf\">\n            <fileset dir=\"${build.classes}\" includes=\"**/*TestCase*.class, \n**/*TestSuite*.class\"/>\n        </jar>\n\n        <copy todir=\"${deploy}\">\n            <fileset dir=\"${source.lib}\"/>\n        </copy>\n\n    </target>\n\n\n\n\n    <target name=\"javadocs\" depends=\"deploy\" description=\"generate complete \njavadocs\">\n        <javadoc sourcepath=\"${source.java}\"\n                 destdir=\"${build.javadocs}\"\n                 overview=\"${source.java}/overview.html\">\n            <classpath refid=\"project.class.path\"/>\n            <packageset dir=\"${source.java}\"/>\n        </javadoc>\n    </target>\n\n</project>\n\nI'll apologize in advance if it's a boneheaded thing on my part.  Thanks - %", "is_private": false, "bug_id": 33585, "id": 70999, "time": "2005-02-15T15:21:48Z", "creator": "duffymo@yahoo.com", "creation_time": "2005-02-15T15:21:48Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "is_private": false, "id": 71163, "time": "2005-02-18T12:25:41Z", "bug_id": 33585, "creation_time": "2005-02-18T12:25:41Z", "text": "In the set-classpath target you add your class files to the classpath, which is\nnot what you want.  The definiion should read\n\n        <path id=\"project.class.path\">\n            <fileset dir=\"${source.lib}\">\n                <patternset>\n                    <include name=\"**/*.jar\"/>\n                </patternset>\n            </fileset>\n            <pathelement location=\"${build.classes}\"/>\n        </path>\n\ninstead."}, {"count": 2, "text": "please reopen if the problem persists after applying the proposed change to your\nbuildfile.", "creator": "bodewig@apache.org", "attachment_id": null, "id": 72204, "time": "2005-03-11T16:13:02Z", "bug_id": 33585, "creation_time": "2005-03-11T16:13:02Z", "tags": [], "is_private": false}]
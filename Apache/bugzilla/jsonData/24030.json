[{"count": 0, "tags": [], "text": "When firing a request, the reverse proxy child process segfaults.\nThe segfault occurs in the ssl_callback_proxy_cert() function\n(ssl_engine_kernel.c) when calling the modssl_set_cert_info() macro.\nThis macro is defined as follows:\n\n   #define modssl_set_cert_info(info, cert, pkey) \\\n       *cert = info->x509; \\\n       X509_reference_inc(*cert); \\\n       *pkey = info->x_pkey->dec_pkey; \\\n       EVP_PKEY_reference_inc(*pkey)\n\nWhen tracing trough the code with gdb the following values are\npresent in the local variables:\n\n   (gdb) p info\n   $4 = (struct X509_info_st *) 0x8236688\n   (gdb) p cert\n   No symbol \"cert\" in current context.\n   (gdb) p pkey\n   $5 = (struct evp_pkey_st **) 0xbffff26c\n   (gdb) p *info\n   $6 = {x509 = 0x8236bf0, crl = 0x0, x_pkey = 0x0, enc_cipher = {cipher = 0x0,\n       iv = \"\u00fa\\024/KJh\\207\u00a7\"}, enc_len = 0, enc_data = 0x0, references = 1}\n   (gdb) c\n   Continuing.\n   Program received signal SIGSEGV, Segmentation fault.\n   0x08095b9d in ssl_callback_proxy_cert (ssl=0x0, x509=0xbffff268,\n       pkey=0xbffff26c) at ssl_engine_kernel.c:1592\n   1592                    modssl_set_cert_info(info, x509, pkey);\n\nThe problem is that the x_pkey field in the info structure is NULL\n(the third line in the macro tries to access a field in this x_pkey\nstructure).\n\nMod_proxy/mod_ssl should ensure that there is a private key for every\ncertificate in SSLProxyMachineCertificateFile (and vice versa).\n\n(See also the following thread:\nhttp://marc.theaimsgroup.com/?l=apache-httpd-dev&m=106629032008685&w=2)\n\n(Related to bug 24029)", "is_private": false, "bug_id": 24030, "id": 46106, "time": "2003-10-23T06:30:28Z", "creator": "kris.verbeeck@advalvas.be", "creation_time": "2003-10-23T06:30:28Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 24030, "attachment_id": null, "id": 48113, "time": "2003-11-25T21:16:36Z", "creator": "jorton@redhat.com", "creation_time": "2003-11-25T21:16:36Z", "is_private": false, "text": "Thanks very much for tracking this down: with HEAD, the server will fail to\nstart up if any configured client cert is missing a cert or private key.  This\nwill be proposed for backport:\n\nhttp://cvs.apache.org/viewcvs/httpd-2.0/modules/ssl/ssl_engine_init.c.diff?r1=1.118&r2=1.119"}, {"count": 2, "tags": [], "text": "*** Bug 31633 has been marked as a duplicate of this bug. ***", "is_private": false, "bug_id": 24030, "id": 64940, "time": "2004-10-11T15:56:47Z", "creator": "jorton@redhat.com", "creation_time": "2004-10-11T15:56:47Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 24030, "is_private": false, "text": "*** Bug 31856 has been marked as a duplicate of this bug. ***", "id": 65615, "time": "2004-10-24T12:56:12Z", "creator": "jorton@redhat.com", "creation_time": "2004-10-24T12:56:12Z", "attachment_id": null}]
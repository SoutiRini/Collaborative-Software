[{"count": 0, "attachment_id": null, "bug_id": 24798, "text": "I have a patch here to speed up the BZip2 task (50-90%). At the same time this \npatch achieves lower memory usage (35%). \nIt's well tested. \n \nPlease note this is the first time I'm trying to contribute a patch to \napache...hoping I can create an attachment on the next page. \nIf not, I will send the patch to Keiron Liddle (keiron@aftexsw.com), the \nauthor of the current version.", "id": 47575, "time": "2003-11-18T21:13:58Z", "creator": "joerg.wassmer@web.de", "creation_time": "2003-11-18T21:13:58Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "joerg.wassmer@web.de", "attachment_id": 9184, "id": 47576, "time": "2003-11-18T21:15:43Z", "bug_id": 24798, "creation_time": "2003-11-18T21:15:43Z", "is_private": false, "text": "Created attachment 9184\nPatch for package org.apache.tools.bzip2 to enhance performance"}, {"count": 2, "tags": [], "bug_id": 24798, "is_private": false, "text": "Unfortunately I have a couple of problems with this patch.\n\nFirst and most important, if I make them apply, the Ant tasks no longer work.\n\n(1) The patch to Input makes <bunzip> fail because the class now expects the\nstream to start with the BZip magic BZ - which the old didn't.  The tasks strips\nthe first two bytes from the stream and so the task now fails.  I certainly\ncould change the task as well, but there may be other clients that rely on the\nold code.  This will lead me to problem number (3) below.\n\n(2) The patch to Output causes an ArrayIndexOOBException in write0 when I run\n<bzip2> - I haven't investigated further.\n\n(3) is the time I had to spend on making the patch apply.  You've changed the\npublished API of the classes, which we can't do.  In particular we can't turn\nBZip2Constants into a class, rename the constants of that interface or turn\nprotected methods/attributes into private ones.\n\nIn addition the diff is much larger than needed since you moved methods around,\nchanged the indentation and removed braces from one-line blocks.\n\nI don't know whether you are still interested in getting this into Ant, given\nthat your patch is almost eighteen months old.  Part of the reason that I haven't\ntouched this earlier was (3) above since it looked like way to much work to\nget the patch applied (and it took me sevaral hours yesterday, I should have\nrun my tests before I changed the coding style to Ant's).\n\nI should have said so sooner and I'm sorry about this.\n\nIf you are no longer interested, then let us close this bug and keep in mind\nthat our BZip2 streams are probably slower than they could be.", "id": 72772, "time": "2005-03-24T09:48:26Z", "creator": "bodewig@apache.org", "creation_time": "2005-03-24T09:48:26Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 24798, "attachment_id": 14564, "id": 72870, "time": "2005-03-25T21:21:41Z", "creator": "joerg.wassmer@web.de", "creation_time": "2005-03-25T21:21:41Z", "is_private": false, "text": "Created attachment 14564\npath against Ant CVS as of 2005-03-25\n\nNew patch, tested against Ant CVS 2005-03-25"}, {"count": 4, "tags": [], "bug_id": 24798, "attachment_id": null, "text": "Just created an attachment with a new patch. \nA change in the testcase org.apache.tools.ant.taskdefs.BZip2Test was also \nneccessary. The previous version did compare the compressed bytes. This may \nproduce false errors. Different BZip2 implementations may produce different \nbut valid compressed output.  \nThe new code compares the decompressed bytes. ", "id": 72871, "time": "2005-03-25T21:27:32Z", "creator": "joerg.wassmer@web.de", "creation_time": "2005-03-25T21:27:32Z", "is_private": false}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 73052, "time": "2005-03-30T09:11:56Z", "bug_id": 24798, "creation_time": "2005-03-30T09:11:56Z", "is_private": false, "text": "Thanks for the new patch, J\u00f6rg.  I'll try to free up some time this week to look\ninto it."}, {"count": 6, "attachment_id": null, "bug_id": 24798, "text": "I've moved around some code, fixed indentation and brace placement and removed\nsome trailing spaces - apart from that your newer patch has gone into Ant's CVS\nHEAD.\n\nI can confirm the speed has improved (in my limited tests the improvement for bzip2\nwas around 50% while the bunzip2 case was less impressive, but still there).  At\nleast for my tests Ant consumed slightly more memory than before, but not enough\nto worry about.\n\nThanks.", "id": 73636, "time": "2005-04-14T11:31:41Z", "creator": "bodewig@apache.org", "creation_time": "2005-04-14T11:31:41Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 24798, "attachment_id": null, "text": "I have to put this optimization as there are cases\nwhere corrupt bz2 files are created.\nSee: http://issues.apache.org/bugzilla/show_bug.cgi?id=41596\n", "id": 103808, "time": "2007-05-30T04:11:51Z", "creator": "peterreilly@apache.org", "creation_time": "2007-05-30T04:11:51Z", "is_private": false}, {"count": 8, "tags": [], "creator": "peterreilly@apache.org", "text": "I left in CBZip2InputStream as there as been no reports of problems\nin reading bzip2 files.\n", "id": 103810, "time": "2007-05-30T06:26:54Z", "bug_id": 24798, "creation_time": "2007-05-30T06:26:54Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 24798, "attachment_id": null, "id": 118536, "time": "2008-07-10T23:45:11Z", "creator": "bodewig@apache.org", "creation_time": "2008-07-10T23:45:11Z", "is_private": false, "text": "given that we don't have a patch for the output case that doesn't create corrupt archives, I'm closing this."}, {"count": 10, "tags": [], "creator": "zshao9@gmail.com", "attachment_id": null, "id": 125138, "time": "2009-02-25T01:41:35Z", "bug_id": 24798, "creation_time": "2009-02-25T01:41:35Z", "is_private": false, "text": "So there is no update on this?\n\nThe speedup and reduced memory usage seems very very impressive."}, {"text": "The problem is that some generated bzip files were corrupt and so the change had to be removed. The code is complex (both the original and the patched version) and hard to understand with no unit tests.", "tags": [], "bug_id": 24798, "attachment_id": null, "count": 11, "id": 125140, "time": "2009-02-25T02:19:36Z", "creator": "peterreilly@apache.org", "creation_time": "2009-02-25T02:19:36Z", "is_private": false}, {"count": 12, "tags": [], "creator": "peterreilly@apache.org", "text": "correction, there are some unit tests..", "id": 125141, "time": "2009-02-25T02:27:33Z", "bug_id": 24798, "creation_time": "2009-02-25T02:27:33Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 24798, "text": "The buggy code was being used in Hadoop and we came across the same file corruption issues. I have debugged the code, found, and corrected the problem:\n\nhttps://issues.apache.org/jira/browse/HADOOP-5326\n\nAfter extensive testing on hadoop, I'm quite confident the bug was removed.\n\nMaybe it's time we reopened this.", "id": 125497, "time": "2009-03-11T14:48:06Z", "creator": "rschmidt@facebook.com", "creation_time": "2009-03-11T14:48:06Z", "is_private": false, "attachment_id": null}, {"count": 14, "attachment_id": 23382, "bug_id": 24798, "text": "Created attachment 23382\nSVN patch with the corrected version of CBZip2OutputStream.java\n\nI checked the other files in the bzip2 package and they are all okay. The change to the old (buggy) version CBZip2OutputStream file is just a +1 that was forgotten during a series of optimizations.", "id": 125556, "time": "2009-03-13T18:20:58Z", "creator": "rschmidt@facebook.com", "creation_time": "2009-03-13T18:20:58Z", "tags": [], "is_private": false}, {"count": 15, "tags": [], "bug_id": 24798, "text": "The performance improvement of the new BZip2 code is very significant (as Described by Joerg Wassmer in 2003).\n\nSince Rodrigo has found, fixed the bug, and verified the result, we should commit this whenever possible. This will give a big performance improvement to the BZip2 tasks.", "id": 125639, "time": "2009-03-19T18:38:06Z", "creator": "zshao9@gmail.com", "creation_time": "2009-03-19T18:38:06Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 24798, "text": "will be looking into merging it into Ant trunk as well as commons-compress soon.", "id": 125838, "time": "2009-03-27T03:20:56Z", "creator": "bodewig@apache.org", "creation_time": "2009-03-27T03:20:56Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "bug_id": 24798, "is_private": false, "text": "svn revision 759138\n\nI'll also merge the changes to the \"now proper\" compress component in Apache\nCommons which is bound to have 1.0 release pretty soon.\n\nhttps://issues.apache.org/jira/browse/COMPRESS-58\n\nMany, many thanks!", "id": 125844, "time": "2009-03-27T06:50:21Z", "creator": "bodewig@apache.org", "creation_time": "2009-03-27T06:50:21Z", "attachment_id": null}]
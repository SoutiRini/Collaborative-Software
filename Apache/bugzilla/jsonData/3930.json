[{"count": 0, "tags": [], "bug_id": 3930, "attachment_id": null, "is_private": false, "id": 6289, "time": "2001-10-02T14:00:37Z", "creator": "jiantao.pan@labbook.com", "creation_time": "2001-10-02T14:00:37Z", "text": "I am using nightly build of slide and using JDBCDescriptorsStore and mysql. The \nattached is my Domain.xml.  Everytime I startup the server, A new entry get \ninserted into the permissions table with object ='/', subject = '/' and action \n= '/'. Which means everybody can do any action on anything. \n\n Thanks.\nJiantao\n\n\n<?xml version=\"1.0\"?>\n\n<slide logger=\"org.apache.slide.util.logger.SimpleLogger\" logger-level=\"6\" \ndefault=\"slide\">\n\n<!--\nlogger\n~~~~~~\norg.apache.slide.util.logger.SimpleLogger \n   default logger with 1 log level\nlog4j.Log4jLogger \n   logger with fine granularity\n   see http://jakarta.apache.org/log4j/\n\nlogger-level \n~~~~~~~~~~~~\n0 EMERGENCY\n1 CRITICAL\n2 ERROR\n4 WARNING\n6 INFO\n7 DEBUG\n-->\n\n  <namespace name=\"slide\">\n<!-- ### Memory Configuration ###\n     The following memory configuration uses the MemoryDescriptorsStore\n     for node,security,locks and revisions. For content the FileContentStore\n     is used. Content is reset before start.\n-->\n    <definition>\n      <store name=\"jdbc\">\n        <nodestore classname=\"slidestore.reference.JDBCDescriptorsStore\">\n         <parameter name=\"driver\">org.gjt.mm.mysql.Driver</parameter>\n         <parameter name=\"url\">mysql://test01:3306/slide</parameter>\n         <parameter name=\"user\">username</parameter>\n         <parameter name=\"password\">password</parameter>\n        </nodestore>\n        <securitystore>\n          <reference store=\"nodestore\" />\n        </securitystore>\n        <lockstore>\n          <reference store=\"nodestore\" />\n        </lockstore>\n        <revisiondescriptorsstore>\n          <reference store=\"nodestore\" />\n        </revisiondescriptorsstore>\n        <revisiondescriptorstore>\n          <reference store=\"nodestore\" />\n        </revisiondescriptorstore>\n        <!--contentstore classname=\"slidestore.reference.JDBCContentStore\">\n         <parameter name=\"driver\">org.hsql.jdbcDriver</parameter>\n         <parameter name=\"url\">HypersonicSQL:slidecontent</parameter>\n         <parameter name=\"user\">sa</parameter>\n         <parameter name=\"password\"></parameter>\n        </contentstore-->\n        <contentstore classname=\"slidestore.reference.FileContentStore\">\n          <parameter name=\"rootpath\">files</parameter>\n        </contentstore>\n      </store>\n      <scope match=\"/\" store=\"jdbc\" />\n    </definition>\n\n\n<!-- ### JDBC Configuration ###\n     The following jdbc sample configuration uses the hsql Database Engine\n     a relational database engine written in Java, for more info: \n     http://hsqldb.sourceforge.net/ \n-->\n<!--\n    <definition>\n      <store name=\"jdbc\">\n        <nodestore classname=\"slidestore.reference.JDBCDescriptorsStore\">\n         <parameter name=\"driver\">org.hsqldb.jdbcDriver</parameter>\n         <parameter name=\"url\">jdbc:hsqldb:slidestructure</parameter>\n         <parameter name=\"user\">sa</parameter>\n         <parameter name=\"password\"></parameter>\n        </nodestore>\n        <securitystore>\n          <reference store=\"nodestore\" />\n        </securitystore>\n        <lockstore>\n          <reference store=\"nodestore\" />\n        </lockstore>\n        <revisiondescriptorsstore>\n          <reference store=\"nodestore\" />\n        </revisiondescriptorsstore>\n        <revisiondescriptorstore>\n          <reference store=\"nodestore\" />\n        </revisiondescriptorstore>\n        <contentstore classname=\"slidestore.reference.JDBCContentStore\">\n         <parameter name=\"driver\">org.hsqldb.jdbcDriver</parameter>\n         <parameter name=\"url\">jdbc:hsqldb:slidecontent</parameter>\n         <parameter name=\"user\">sa</parameter>\n         <parameter name=\"password\"></parameter>\n        </contentstore>\n      </store>\n      <scope match=\"/\" store=\"jdbc\" />\n    </definition>\n-->\n\n\n    <configuration>\n\n      <!-- Actions mapping -->\n      <default-action>/actions</default-action>\n      <read-object>/actions/read</read-object>\n      <create-object>/actions/write</create-object>\n      <remove-object>/actions/write</remove-object>\n      <grant-permission>/actions/manage</grant-permission>\n      <revoke-permission>/actions/manage</revoke-permission>\n      <read-permissions>/actions/manage</read-permissions>\n      <lock-object>/actions/write</lock-object>\n      <kill-lock>/actions/manage</kill-lock>\n      <read-locks>/actions/read</read-locks>\n      <read-revision-metadata>/actions/read</read-revision-metadata>\n      <create-revision-metadata>/actions/write</create-revision-metadata>\n      <modify-revision-metadata>/actions/write</modify-revision-metadata>\n      <remove-revision-metadata>/actions/write</remove-revision-metadata>\n      <read-revision-content>/actions/read</read-revision-content>\n      <create-revision-content>/actions/write</create-revision-content>\n      <modify-revision-content>/actions/write</modify-revision-content>\n      <remove-revision-content>/actions/write</remove-revision-content>\n\n      <!-- Paths configuration -->\n      <userspath>/users</userspath>\n      <guestpath>guest</guestpath>\n      <filespath>/files</filespath>\n      <parameter name=\"dav\">true</parameter>\n      <parameter name=\"standalone\">true</parameter>\n\n      <!-- Roles definition -->\n      <role name=\"root\">slideroles.basic.RootRole</role>\n      <role name=\"user\">slideroles.basic.UserRole</role>\n      <role name=\"guest\">slideroles.basic.GuestRole</role>\n\n      <!-- Users management -->\n      <auto-create-users>true</auto-create-users>\n\n      <!-- Default properties mapping -->\n      <default-property name=\"foo\" namespace=\"nsfoo/\" value=\"bar\"\n       role=\"user\"/>\n      <default-property name=\"password\" namespace=\"slide/\" value=\"\"\n       role=\"user\"/>\n\n    </configuration>\n    \n    <data>\n      \n      \n      <objectnode classname=\"org.apache.slide.structure.SubjectNode\" uri=\"/\">\n        \n        <permission action=\"/actions\" subject=\"root\"/>\n        <permission action=\"/actions/read\" subject=\"user\"\n         inheritable=\"false\"/>\n        <permission action=\"/actions/read\" subject=\"nobody\"\n         inheritable=\"false\"/>\n        \n        <!-- /users represents the unauthenticated user -->\n        \n        <objectnode classname=\"org.apache.slide.structure.SubjectNode\" \n         uri=\"/users\">\n          \n          <permission action=\"/actions\" subject=\"~\"/>\n          <permission action=\"/actions\" subject=\"guest\"\n           inheritable=\"true\" negative=\"true\"/>\n          <permission action=\"/actions/read\" subject=\"user\"\n           inheritable=\"false\"/>\n\n          <!-- Permission group example -->\n          \n          <objectnode classname=\"org.apache.slide.structure.GroupNode\" \n            uri=\"/users/groupA\">\n             <objectnode classname=\"org.apache.slide.structure.LinkNode\" \n                uri=\"/users/groupA/john\" linkedUri=\"/users/john\" />\n             <objectnode classname=\"org.apache.slide.structure.LinkNode\" \n                uri=\"/users/groupA/root\" linkedUri=\"/users/root\" />\n             <objectnode classname=\"org.apache.slide.structure.SubjectNode\" \n               uri=\"/users/groupA/singleGroupMember\"  />\n          </objectnode>\n\n          <!-- /users/root represents the administrator -->\n          \n          <objectnode classname=\"slideroles.basic.RootRoleImpl\" \n           uri=\"/users/root\">\n            <revision>\n              <property name=\"password\">root</property>\n            </revision>\n          </objectnode>\n          \n          <!-- /users/john represents an authenticated user -->\n          \n          <objectnode classname=\"slideroles.basic.UserRoleImpl\" \n           uri=\"/users/john\">\n            <revision>\n              <property name=\"password\">john</property>\n            </revision>\n          </objectnode>\n          \n          <!-- /users/guest represents an authenticated or unauthenticated \n               guest user -->\n          \n          <objectnode classname=\"slideroles.basic.GuestRoleImpl\" \n           uri=\"/users/guest\">\n            <revision>\n              <property name=\"password\"></property>\n            </revision>\n          </objectnode>\n          \n        </objectnode>\n        \n        <objectnode classname=\"org.apache.slide.structure.ActionNode\" \n         uri=\"/actions\">\n          \n          <objectnode classname=\"org.apache.slide.structure.ActionNode\" \n           uri=\"/actions/read\"/>\n          \n          <objectnode classname=\"org.apache.slide.structure.ActionNode\" \n           uri=\"/actions/write\"/>\n          \n          <objectnode classname=\"org.apache.slide.structure.ActionNode\" \n           uri=\"/actions/manage\"/>\n          \n        </objectnode>\n        \n        <objectnode classname=\"org.apache.slide.structure.SubjectNode\" \n         uri=\"/files\">\n\n          <!-- ### Give read/write/manage permission to guest ### \n               Uncomment the following line to give permission to do\n               all actions on /files to guest (unauthenticated users) -->\n          <!-- <permission action=\"/actions\" subject=\"/users/guest\"/> -->\n\n          <permission action=\"/actions/manage\" subject=\"/users/john\"/>\n          <permission action=\"/actions/write\" subject=\"+/users/groupA\"/>\n          <permission action=\"/actions/read\" subject=\"nobody\"/>\n          \n        </objectnode>\n        \n      </objectnode>\n     \n    </data>\n    \n  </namespace>\n  \n</slide>"}, {"count": 1, "tags": [], "text": "Jiantao tracked down the problem. It seems the problem resided in the \nslidestore.refererence.JDBCDescriptorsStore.java, in the revokePermission \nmethod. Because the quote around  \"ACTION\" the condition never met, so no\nrow got deleted when revoke was called.\nHe removed the quote, and it worked for mysql.\nThis quote was needed for Cloudscape where action is a reserved word and must be \nquoted.\n\nFIX: revert the changes in the general case and put the specific code in \nCloudscapeDescriptorsStore.\n", "is_private": false, "id": 6453, "creator": "dirk.verbeeck@pandora.be", "time": "2001-10-07T12:33:45Z", "bug_id": 3930, "creation_time": "2001-10-07T12:33:45Z", "attachment_id": null}]
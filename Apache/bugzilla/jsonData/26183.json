[{"count": 0, "tags": [], "bug_id": 26183, "is_private": false, "text": "The following problem was encountered.\nI was wondering if this behavior is specification.\n\n1)I set \"true\" as value of 'cookeis' attribute of 'context' tag in server.xml.\n(default)\n2)I called following JSP in the web application.\n--------------------------\n.....\n<%\nsession.invalidate();\nsession=request.getSession();\nsession.setAttribute(\"SessionData\",\"dummy\");\nresponse.reset();\n%>\n.....\n--------------------------\n3)I found that 'session.getAttribute(\"SessionData\")' returned null at the next \nrequest from the same browser.\nIt seems that the session was lost.\nOriginally, 'session' and 'reset() method' should not be related but they seem \nto be related.\n\n\nI think that this problem originates in the following operation.\norg.apache.coyote.tomcat4.CoyoteRequest.java doGetSession() method\n----------------------------\n.....\n((HttpServletResponse) response).addCookie(cookie);\n.....\n----------------------------\nThis code set 'Set-Cookie' header to the response.\nNext the 'Set-Cookie' header has been cleared by the reset() method.\nThen session maintenance went wrong at the next request.\n\nIn fact, this has generated on the error page and evasion is difficult.\n(I don't use reset() method directly but exception occurred after create new \nsession.\nreset() method is called indirectly to handle this exception from tomcat.)\nThis problem occurred also on tomcat5 but happened neither on weblogic8 nor \nWebSphere5.\n\nIs this behavior specification ?\nIf this is not as an intention, could I have the correction of tomcat(maybe \ncoyote) ?\n\nregards,\nNaru Hayashi from Japan", "id": 50633, "time": "2004-01-16T05:04:15Z", "creator": "hayashin@ist.fujitsu.com", "creation_time": "2004-01-16T05:04:15Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 26183, "text": "There can only be one session per request. If you invalidate the session, that\nsession is still bound to the request and a new one (session) cannot be made.  \n", "id": 50644, "time": "2004-01-16T11:52:50Z", "creator": "funkman@joedog.org", "creation_time": "2004-01-16T11:52:50Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 26183, "is_private": false, "text": "Hello,\nThank you for response and I'm sorry for Reopen bug.\n\nMy point is 'response.reset()', not 'session.invalidate()'.\nThis problem occur when 'response.reset()' method call after create new session.\nThis happen also when the first access to session, access to session after \nsession timeout ...\nSo for other example, the first request, call following JSP(JSP only for easy).\n------------\n....\n<%\nsession.setAttribute(\"SessionData\",\"dummy\");\nresponse.reset();\n%>\n....\n------------\nAnd the next request, 'session.getAttribute(\"SessionData\")' return null.\n\nThe reason is as having explained last time.\n\nIs this behavior specification ?\n\nregards,\nNaru Hayashi from Japan\n", "id": 50708, "time": "2004-01-19T02:53:43Z", "creator": "hayashin@ist.fujitsu.com", "creation_time": "2004-01-19T02:53:43Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 26183, "text": "Aha! I see now. So quickie summary\n\nIn a single request ...\n1) Create a session  (which is done by jsp's)\n2) Call response.reset()\n3) Then the SessionId cookie is not sent to the client (because of the\nresponse.reset() (This is the bad part)\n\nSince the Session cookie is the responsibility of the container, (I think) it\nshould place the cookie back into the list of headers sent back to the client.\n\n\nA quickie demo: \nI created a JSP with the content, per previous message. Of this content ...\n<%\nsession.setAttribute(\"SessionData\",\"dummy\");\nresponse.reset();\n%>\n\nThen telneted to port 8080 (from a older HEAD build but newer than 4.1.27) and\ngave this:\nGET /cowbell.jsp HTTP/1.1\nHost: localhost:8080\nConnection: close\n\nAnd here was my response:\nHTTP/1.1 200 OK\nContent-Length: 2\nDate: Mon, 19 Jan 2004 12:30:47 GMT\nServer: Apache-Coyote/1.1\nConnection: close\n\nThere was no Set-Cookie directive made. \n\nI also get the same behavior in 5.\n\nI'm swamped with work, but I might be able to look for at a patch tomorrow\nnight. (If this is agreed this is a bug)\n\n\n", "id": 50730, "time": "2004-01-19T12:36:45Z", "creator": "funkman@joedog.org", "creation_time": "2004-01-19T12:36:45Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 26183, "is_private": false, "text": "I don't agree with this analysis. reset resets the response, including all the\ncookies, headers, etc. This should not be fixed.", "id": 50731, "time": "2004-01-19T12:41:25Z", "creator": "remm@apache.org", "creation_time": "2004-01-19T12:41:25Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "funkman@joedog.org", "attachment_id": null, "is_private": false, "id": 50733, "time": "2004-01-19T12:51:07Z", "bug_id": 26183, "creation_time": "2004-01-19T12:51:07Z", "text": "I am wishy washy on this one. Should I email the spec group for clarification?\nMy problem is: what happens if someone implemented a container that (detected\nthat the session was new and) added the session cookie during the initial flush\nto the client? They would be immune to this this bug since the cookie was never\nadded to the response until flush time. (I'm *not* proposing that as a solution)"}, {"count": 6, "tags": [], "bug_id": 26183, "attachment_id": null, "is_private": false, "id": 50772, "time": "2004-01-19T20:29:14Z", "creator": "funkman@joedog.org", "creation_time": "2004-01-19T20:29:14Z", "text": "I sent an email to the spec group for clarification. I'll wait for their\nresponse before doing anything. [I'm indifferent since its a very special case.]"}, {"count": 7, "tags": [], "bug_id": 26183, "is_private": false, "text": "Thank you for you help.\n\nI think this is not special case, because error page is generally used and\nit's call 'reset' method.\n\nI'd like to know what behavior is specification as soon as possible.\nCan you inquire for it to spec-team, again?\n\nRegards,\nNaru Hayashi from Japan\n", "id": 51566, "time": "2004-02-02T02:50:20Z", "creator": "hayashin@ist.fujitsu.com", "creation_time": "2004-02-02T02:50:20Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 26183, "attachment_id": null, "is_private": false, "id": 59578, "time": "2004-06-19T12:24:21Z", "creator": "markt@apache.org", "creation_time": "2004-06-19T12:24:21Z", "text": "This bug report has been transferred to Tomcat 5 because TC4 and TC5 share the \nconnectors and TC5 is now the focus of development effort"}, {"count": 9, "tags": [], "bug_id": 26183, "text": "Any news from the spec team on this?", "id": 59592, "time": "2004-06-19T15:38:56Z", "creator": "markt@apache.org", "creation_time": "2004-06-19T15:38:56Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 26183, "attachment_id": null, "is_private": false, "id": 61204, "time": "2004-07-28T00:28:40Z", "creator": "funkman@joedog.org", "creation_time": "2004-07-28T00:28:40Z", "text": "In case one is curious .. No news from the spec team yet."}, {"count": 11, "attachment_id": null, "creator": "yoavs@computer.org", "text": "Because it's not a general case (I disagree with the original poster on this: \nif this were widespread we'd have heard more about it on the mailing lists and \nother forums), and no resopnse has been given since January when this issue was \noriginally deferred, I'm closing this issue.  Please don't reopen unless \nthere's concrete new information (such as from the Spec/Expert Group).  Thanks.", "id": 66132, "time": "2004-10-29T18:45:32Z", "bug_id": 26183, "creation_time": "2004-10-29T18:45:32Z", "tags": [], "is_private": false}, {"count": 12, "attachment_id": null, "creator": "funkman@joedog.org", "text": "*** Bug 36023 has been marked as a duplicate of this bug. ***", "id": 78099, "time": "2005-08-04T13:23:02Z", "bug_id": 26183, "creation_time": "2005-08-04T13:23:02Z", "tags": [], "is_private": false}, {"count": 13, "tags": [], "bug_id": 26183, "attachment_id": null, "is_private": false, "id": 78100, "time": "2005-08-04T13:40:25Z", "creator": "sven.koehler@gmail.com", "creation_time": "2005-08-04T13:40:25Z", "text": "Why is this bug closed?\n\nIf the specification doesn't say anything about it, do what is most convenient\nfor the users/developers. Other servletcontains add the session-cookie - even if\nreset() was called. So perhaps Tomcat should do that too."}]
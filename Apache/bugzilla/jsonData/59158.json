[{"count": 0, "tags": [], "creator": "limesdevelopment@gmail.com", "attachment_id": null, "text": "I got the message : Exception in thread \"main\" org.apache.poi.openxml4j.exceptions.OpenXML4JRuntimeException: Rule M2.4 exception : this error should NEVER happen! Please raise a bug at https://bz.apache.org/bugzilla/enter_bug.cgi?product=POI and attach a file that triggers it, thanks!\n\tat org.apache.poi.openxml4j.opc.internal.ContentTypeManager.getContentType(ContentTypeManager.java:343)\n\tat org.apache.poi.openxml4j.opc.internal.ContentTypeManager.removeContentType(ContentTypeManager.java:256)\n\tat org.apache.poi.openxml4j.opc.OPCPackage.removePart(OPCPackage.java:943)\n\tat org.apache.poi.openxml4j.opc.PackagePart.getOutputStream(PackagePart.java:522)\n\tat org.apache.poi.xssf.usermodel.XSSFWorkbook.commit(XSSFWorkbook.java:1678)\n\tat org.apache.poi.POIXMLDocumentPart.onSave(POIXMLDocumentPart.java:341)\n\tat org.apache.poi.POIXMLDocument.write(POIXMLDocument.java:206)\n\nSince the file that triggers it is fairly big I'm attaching the code that triggers it.\nThis code is the very beginning, the only lines before it are declarations and initializations. Written in Java 8 u 74. Good luck ! :)\n\nfor(String folder : godine){\n            XSSFWorkbook wbTemp = new XSSFWorkbook();\n            wbTemp.createSheet();\n            FileOutputStream fo = new FileOutputStream(lokacijaResursa+\"\\\\statistika-\"+folder+\".xlsx\");\n            HashMap<String,Integer> pozicija = new HashMap<>();\n            napraviCelije(wbTemp,100,200);\n            for(int i=1;i<=12;i++) {\n                try {\n                    XSSFWorkbook mjesec = new XSSFWorkbook(new FileInputStream(new File(lokacijaResursa + \"\\\\\" + folder + \"\\\\\" + i + \".xlsx\")));\n                    XSSFSheet sheetMjesec = mjesec.getSheetAt(0);\n                    popuni(wbTemp, mjesec, pozicija, i);\n                }\n                catch (Exception ex){}\n            }\n            wbTemp.write(fo);\n            fo.close();\n            XSSFWorkbook wb = new XSSFWorkbook(new FileInputStream(lokacijaResursa+\"\\\\statistika-\"+folder+\".xlsx\"));\n            int numOfCells = 0;\n            try{\n                for(int i=3;;i++){\n                    Row r = wb.getSheetAt(0).getRow(1);\n                    Cell c = r.getCell(i,Row.CREATE_NULL_AS_BLANK);\n                    if(c.getCellType() == Cell.CELL_TYPE_BLANK)\n                        break;\n                    numOfCells++;\n                }\n                for(int i=2;;i++){\n                    Row r = wb.getSheetAt(0).getRow(i);\n                    if(r.getCell(0,Row.CREATE_NULL_AS_BLANK).getCellType() == Cell.CELL_TYPE_BLANK)\n                        break;\n                    for(int j=3;j<numOfCells;j++){\n                        Cell c = r.getCell(j,Row.CREATE_NULL_AS_BLANK);\n                        if(c.getCellType() == Cell.CELL_TYPE_BLANK)\n                            break;\n                        else c.setCellValue(0);\n                    }\n                }\n            }\n            catch (NullPointerException ex){\n                System.out.println(\"Nema fajlova\");\n                System.exit(0);\n            }\n            wb.close();\n            fo = new FileOutputStream(new File(lokacijaResursa+\"\\\\statistika-\"+folder+\".xlsx\"));\n            wb.write(fo);\n            fo.close();\n        }", "id": 189332, "time": "2016-03-10T00:57:35Z", "bug_id": 59158, "creation_time": "2016-03-10T00:57:35Z", "is_private": false}, {"count": 1, "tags": [], "text": "What about the \"and attach a file that triggers it\" in the error message? Without a sample file that triggers the error, it is hard to say if the file is simply malformed or POI does not read the format correctly here.", "is_private": false, "bug_id": 59158, "id": 189386, "time": "2016-03-11T22:32:39Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-03-11T22:32:39Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 59158, "attachment_id": null, "id": 189387, "creation_time": "2016-03-11T22:34:02Z", "time": "2016-03-11T22:34:02Z", "creator": "dominik.stadler@gmx.at", "text": "Oops, sorry, just saw the additional part in the description.", "is_private": false}, {"count": 3, "tags": [], "bug_id": 59158, "attachment_id": null, "id": 189389, "time": "2016-03-11T22:36:21Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-03-11T22:36:21Z", "is_private": false, "text": "*** Bug 59159 has been marked as a duplicate of this bug. ***"}, {"count": 4, "tags": [], "bug_id": 59158, "attachment_id": null, "is_private": false, "id": 189769, "time": "2016-03-28T20:49:56Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-03-28T20:49:56Z", "text": "I did a short review of this report, the provided code still depends on the actual input-files, so we cannot really reproduce this without some sample files and preferably a self-sufficient unit-test which reproduces the problem more easily. \n\nThis will make it much easier for others to reproduce and actually take a look at the problem."}, {"count": 5, "text": "> wb.close();\n> fo = new FileOutputStream(new File(lokacijaResursa+\"\\\\statistika-\"+folder+\".xlsx\"));\n> wb.write(fo);\n\nYou cannot use a workbook after it has been closed.\nClose your workbook after wb.write and your error should go away.", "bug_id": 59158, "attachment_id": null, "id": 194725, "time": "2016-10-29T21:08:59Z", "creator": "onealj@apache.org", "creation_time": "2016-10-29T21:08:59Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 59158, "attachment_id": null, "is_private": false, "id": 199782, "time": "2017-07-14T00:12:31Z", "creator": "onealj@apache.org", "creation_time": "2017-07-14T00:12:31Z", "text": "*** Bug 61297 has been marked as a duplicate of this bug. ***"}]
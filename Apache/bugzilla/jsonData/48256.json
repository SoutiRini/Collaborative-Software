[{"count": 0, "tags": [], "bug_id": 48256, "attachment_id": 24577, "id": 132188, "time": "2009-11-20T20:28:16Z", "creator": "asf-bugzilla@barillari.org", "creation_time": "2009-11-20T20:28:16Z", "is_private": false, "text": "Created attachment 24577\nScreenshot of Excel Viewer with the incorrect formula results\n\nI have noticed what I think might be a bug in HSSF: Microsoft Excel Viewer won't do the calculations specified in the formulas in the POI-created document: all of them show zeroes. \n\nInterestingly, if I open the document in OpenOffice and re-save it, the formulas *do* display properly. \n\nSteps to reproduce:\n\n0. Download and install Microsoft Excel Viewer 2003.\nhttp://www.microsoft.com/downloads/details.aspx?FamilyID=c8378bf4-996c-4569-b547-75edbd03aaf0&displaylang=EN\n\n1. Download and compile TimesheetDemo\nhttp://svn.apache.org/repos/asf/poi/trunk/src/examples/src/org/apache/poi/ss/examples/TimesheetDemo.java\n\n2. Run TimesheetDemo -xls\n\n3. Launch Microsoft Excel Viewer and open the generated timesheet.xls. Note that all of the sums are \"0.00\", even though they should be non-zero. See the attached screenshot, xlview.png.\n\n4. To fix the problem, open timesheet.xls in OpenOffice. Note that the calculations are correct -- the column sums are no longer all zero. Make a trivial change, save the document, and close it. Reopen it in Excel Viewer, and note that the results are correct.\n\nI haven't confirmed this, but I have a hunch that there is some sort of caching of formula results that Excel Viewer relies upon, that OpenOffice does, but that HSSF doesn't do. (The Python xls generation library, xlwt, has the exact same issue.) This may be beyond the scope of POI, but I thought you would want to know about it."}, {"count": 1, "tags": [], "creator": "asf-bugzilla@barillari.org", "attachment_id": 24578, "id": 132189, "time": "2009-11-20T20:29:24Z", "bug_id": 48256, "creation_time": "2009-11-20T20:29:24Z", "is_private": false, "text": "Created attachment 24578\nExample of an .xls file that displays incorrectly in Excel Viewer"}, {"count": 2, "tags": [], "bug_id": 48256, "attachment_id": null, "id": 147488, "time": "2011-06-25T12:35:57Z", "creator": "yegor@dinom.ru", "creation_time": "2011-06-25T12:35:57Z", "is_private": false, "text": "Excel Viewer displays cached formula results, i.e. the results previously calculated by Excel or OpenOffice. \n\nPOI doesn't pre-calculate formulas for you, you need to manually pass your workbook to the formula evaluator.\n\nAdd the following line in the end of your code and you will be good:\n   workbook.getCreationHelper().createFormulaEvaluator().evaluateAll();\n\nit should work for both .xls and .xlsx formats.\n\nMore about evaluation of formulas:\nhttp://poi.apache.org/spreadsheet/eval.html\n\nYegor"}]
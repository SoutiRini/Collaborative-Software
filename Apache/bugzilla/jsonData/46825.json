[{"count": 0, "tags": [], "bug_id": 46825, "text": "I try to convert an SVG image to PNG.\n\nI use two images : one which does not contain linearGradient and the other one which does. When I try to convert the one with linearGradient I get an error.\n\nHere is the SGV code for the image :\n\n\t<g>\n\t\t<g id=\"texte_ecolo_4_\">\n\t\t\t<text transform=\"matrix(1 0 0 1 27.9604 151.0898)\" fill=\"#75AF43\" font-family=\"'Tahoma'\" font-size=\"6\">S.V.P., pensez \u00e0 l\u2019environnement avant d\u2019imprimer ce message.</text>\n\t\t</g>\n\t\t<g id=\"logo_ecolo_4_\">\n\t\t\t<linearGradient id=\"SVGID_1_\" gradientUnits=\"userSpaceOnUse\" x1=\"2.1069\" y1=\"149.5684\" x2=\"23.0229\" y2=\"149.5684\">\n\t\t\t\t<stop  offset=\"0\" style=\"stop-color:#145A2D\"/>\n\t\t\t\t<stop  offset=\"0.0763\" style=\"stop-color:#346E34\"/>\n\t\t\t\t<stop  offset=\"0.1923\" style=\"stop-color:#55893A\"/>\n\t\t\t\t<stop  offset=\"0.3165\" style=\"stop-color:#6FA03E\"/>\n\t\t\t\t<stop  offset=\"0.4511\" style=\"stop-color:#82B340\"/>\n\t\t\t\t<stop  offset=\"0.6038\" style=\"stop-color:#8FC041\"/>\n\t\t\t\t<stop  offset=\"0.8132\" style=\"stop-color:#94C641\"/>\n\t\t\t\t<stop  offset=\"1\" style=\"stop-color:#75AF43\"/>\n\t\t\t</linearGradient>\n\t\t\t<path fill=\"url(#SVGID_1_)\" d=\"M2.107,148.518c0.837-0.387,2.13-1.053,2.709-1.053c0,0,0.258,9.715,18.207,7.912\n\t\t\t\tc0,0-3.896-1.82-5.469-6.561c-1.855-5.598-9.123-6.65-11.26-3.604l-1.735,0.771c0,0,4.538-1.516,7.978,1.285\n\t\t\t\tc2.674,2.178,3.495,4.383,5.77,6.463c-1.747-1.332-2.386-2.219-4.715-4.688c-2.331-2.469-5.942-4.033-11.349-1.387L2.107,148.518\n\t\t\t\tz\"/>\n\t\t\t<linearGradient id=\"SVGID_2_\" gradientUnits=\"userSpaceOnUse\" x1=\"6.0151\" y1=\"151.4512\" x2=\"19.9136\" y2=\"151.4512\">\n\t\t\t\t<stop  offset=\"0\" style=\"stop-color:#AAD26B\"/>\n\t\t\t\t<stop  offset=\"0.1703\" style=\"stop-color:#FFFFFF\"/>\n\t\t\t\t<stop  offset=\"1\" style=\"stop-color:#AAD26B\"/>\n\t\t\t</linearGradient>\n\t\t\t<path fill=\"url(#SVGID_2_)\" d=\"M6.015,147.75c0.798,6.477,8.751,7.879,13.898,7.273C19.914,155.023,8.071,155.459,6.015,147.75z\"\n\t\t\t\t/>\n\t\t\t<linearGradient id=\"SVGID_3_\" gradientUnits=\"userSpaceOnUse\" x1=\"6.9106\" y1=\"147.6875\" x2=\"17.7378\" y2=\"147.6875\">\n\t\t\t\t<stop  offset=\"0\" style=\"stop-color:#AAD26B\"/>\n\t\t\t\t<stop  offset=\"0.3297\" style=\"stop-color:#FFFFFF\"/>\n\t\t\t\t<stop  offset=\"1\" style=\"stop-color:#AAD26B\"/>\n\t\t\t</linearGradient>\n\t\t\t<path fill=\"url(#SVGID_3_)\" d=\"M6.911,145.139c4.108-2.297,8.507-0.605,10.827,6.066c0,0-1.909-4.326-5.124-5.922\n\t\t\t\tC10.172,144.07,6.911,145.139,6.911,145.139z\"/>\n\t\t</g>\n\t</g>\n\nAnd this is the error I get:\n\norg.apache.batik.bridge.BridgeContext.getReferencedNode(BridgeContext.java:780)\n\tat org.apache.batik.bridge.BridgeContext.getReferencedElement(BridgeContext.java:796)\n\tat org.apache.batik.bridge.PaintServer.convertURIPaint(PaintServer.java:351)\n\tat org.apache.batik.bridge.PaintServer.convertPaint(PaintServer.java:259)\n\tat org.apache.batik.bridge.PaintServer.convertFillPaint(PaintServer.java:228)\n\tat org.apache.batik.bridge.PaintServer.convertFillAndStroke(PaintServer.java:146)\n\tat org.apache.batik.bridge.SVGShapeElementBridge.createShapePainter(SVGShapeElementBridge.java:117)\n\tat org.apache.batik.bridge.SVGDecoratedShapeElementBridge.createFillStrokePainter(SVGDecoratedShapeElementBridge.java:58)\n\tat org.apache.batik.bridge.SVGDecoratedShapeElementBridge.createShapePainter(SVGDecoratedShapeElementBridge.java:84)\n\tat org.apache.batik.bridge.SVGShapeElementBridge.buildGraphicsNode(SVGShapeElementBridge.java:91)\n\tat org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:224)\n\tat org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n\tat org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:219)\n\tat org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n\tat org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:219)\n\tat org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n\tat org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:219)\n\tat org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n\tat org.apache.batik.bridge.GVTBuilder.build(GVTBuilder.java:82)\n\nSince the same code work in the same situation with another SVG file, I assume there is a problem in the Batik code that should be fixed.\n\nIf you need more information do not hesitate.\n\nThanks,\n\nS\u00e9bastien", "id": 125439, "time": "2009-03-09T10:32:46Z", "creator": "shamel@optinf.ca", "creation_time": "2009-03-09T10:32:46Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 46825, "text": "Created attachment 23361\nTest case adapted from comment 0", "id": 125442, "time": "2009-03-09T10:54:07Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2009-03-09T10:54:07Z", "is_private": false, "attachment_id": 23361}, {"count": 2, "tags": [], "creator": "helder.magalhaes@gmail.com", "text": "(In reply to comment #0)\n> When I try to convert the one with linearGradient I get an error.\n\nI was not able to reproduce the issue. I tried Batik Squiggle 1.7 and current development version 1.8pre (revision 751775), JDK 1.6.0_12 and Windows XP SP3. I'm aware that Batik Squiggle isn't quite the same as the converter/transcoder but should be able to reproduce most issues. ;-)\n\n\n> Since the same code work in the same situation with another SVG file, I assume\n> there is a problem in the Batik code that should be fixed.\n\nAs the test case was incomplete and I had to guess the missing information, as I was unable to reproduce the issue, my current guess goes to a missing 'xmlns:xlink=\"http://www.w3.org/1999/xlink\"' in the top level SVG element (see the attachment for a sample).\n\n\n> If you need more information do not hesitate.\n\nYes, I believe more information is needed here. If the issue was caused by a missing XLink namespace, please confirm so. If that wasn't the case, please attach a complete test case and provide more details such as:\n * Command-line used to perform the conversion;\n * Batik version (or revision if you are working with the development version);\n * Java environment;\n * Operating system.\n\n\nHope this helps,\n Helder Magalh\u00e3es", "id": 125444, "attachment_id": null, "bug_id": 46825, "creation_time": "2009-03-09T11:06:47Z", "time": "2009-03-09T11:06:47Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 46825, "is_private": false, "text": "Hi,\n\nThe problem is not caused by a missing xlink, the xlink info is in the SVG file to convert. \n\nThe code to get the problem is the following:\n\n\tprivate static GraphicsNode getRootNode(SVGDocument document) {\n\t\t// Build the tree and get the document dimensions\n\t\tUserAgentAdapter userAgentAdapter = new UserAgentAdapter();\n\t\tBridgeContext bridgeContext = new BridgeContext(userAgentAdapter);\n\t\tGVTBuilder builder = new GVTBuilder();\n\n\t\treturn builder.build(bridgeContext, document);\n\t}\n\nThe last line cause the problem, it not yet the conversion to png... Sorry for this wrong information. \n\nBatik version (or revision if you are working with the development version) :\n\nI used version 1.7 first, but I've been able to reproduce it using 1.8pre ( latest from SVN repository).\n\nJava environment : jdk1.5.0_11\n\n\nOperating system : Windows XP Pro Version 2002 Sevice Pack 3", "id": 125447, "time": "2009-03-09T11:36:30Z", "creator": "shamel@optinf.ca", "creation_time": "2009-03-09T11:36:30Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "helder.magalhaes@gmail.com", "text": "(In reply to comment #3)\n> The problem is not caused by a missing xlink\n\nCorrect, I should have confirmed this before posting. ;-)\n\n\n> The code to get the problem is the following:\n[...]\n> The last line cause the problem, it not yet the conversion to png...\n\nHumm, the code snippet is a bit different from the recommended steps to boot SVG and CSS DOM [1]. In particular, I notice the missing \"loader\" -- may this be the root of your particular issue? I'd suggest the mailing list for this sort of troubleshooting, as the test case runs as expected in a usual JSVGCanvas (Squiggle, for example).\n\n\n> Sorry for this wrong information. \n\nNo problem! ;-)\n\n\nHope this helps,\n Helder Magalh\u00e3es\n\n\n[1] http://wiki.apache.org/xmlgraphics-batik/BootSvgAndCssDom", "id": 125460, "attachment_id": null, "bug_id": 46825, "creation_time": "2009-03-10T02:32:32Z", "time": "2009-03-10T02:32:32Z", "is_private": false}, {"count": 5, "tags": [], "creator": "shamel@optinf.ca", "text": "I still think there is a problem with the library...\n\nI reviewed the suggested steps to load a SVG and here are the ones that I'm using, they correspond to what is suggested in the wiki:\n\nString parser = XMLResourceDescriptor.getXMLParserClassName();\nSAXSVGDocumentFactory factory = new SAXSVGDocumentFactory(parser);\nSVGDocument svgDocument = (SVGDocument) factory.createDocument(uri.toString());\nGraphicsNode rootSvgNode = getRootNode(svgDocument);\n\nUserAgent      userAgent = new UserAgentAdapter();\nDocumentLoader loader    = new DocumentLoader(userAgent);\n\n        \nBridgeContext  ctx       = new BridgeContext(userAgent, loader);\nctx.setDynamicState(BridgeContext.DYNAMIC);\nGVTBuilder     builder   = new GVTBuilder();\nreturn builder.build(ctx, svgDoc);\n\nThe last line is causing the problem:\n\n\tat org.apache.batik.bridge.BridgeContext.getReferencedNode(BridgeContext.java:780)\n\tat org.apache.batik.bridge.BridgeContext.getReferencedElement(BridgeContext.java:796)\n\tat org.apache.batik.bridge.PaintServer.convertURIPaint(PaintServer.java:351)\n\tat org.apache.batik.bridge.PaintServer.convertPaint(PaintServer.java:259)\n\tat org.apache.batik.bridge.PaintServer.convertFillPaint(PaintServer.java:228)\n\tat org.apache.batik.bridge.PaintServer.convertFillAndStroke(PaintServer.java:146)\n\tat org.apache.batik.bridge.SVGShapeElementBridge.createShapePainter(SVGShapeElementBridge.java:117)\n\tat org.apache.batik.bridge.SVGDecoratedShapeElementBridge.createFillStrokePainter(SVGDecoratedShapeElementBridge.java:58)\n\tat org.apache.batik.bridge.SVGDecoratedShapeElementBridge.createShapePainter(SVGDecoratedShapeElementBridge.java:84)\n\tat org.apache.batik.bridge.SVGShapeElementBridge.buildGraphicsNode(SVGShapeElementBridge.java:91)\n\tat org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:224)\n\tat org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n\tat org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:219)\n\tat org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n\tat org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:219)\n\tat org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n\tat org.apache.batik.bridge.GVTBuilder.build(GVTBuilder.java:82)\n\nIf you could try those steps and tell if it's working for you with the SVG document attached, it would be greatly appreciated.\n\nThanks,\n\nS\u00e9bastien", "id": 125465, "attachment_id": null, "bug_id": 46825, "creation_time": "2009-03-10T08:54:09Z", "time": "2009-03-10T08:54:09Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 46825, "is_private": false, "text": "Hi,\n\nDoes anybody work on this? Just to know...\n\nThanks,\n\nS\u00e9bastien", "id": 125521, "time": "2009-03-12T09:20:04Z", "creator": "shamel@optinf.ca", "creation_time": "2009-03-12T09:20:04Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 46825, "attachment_id": null, "is_private": false, "id": 125522, "time": "2009-03-12T10:39:57Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2009-03-12T10:39:57Z", "text": "(In reply to comment #6)\nHi S\u00e9bastien,\n\n> Does anybody work on this? Just to know...\n\nPlease be patient [1]. The Batik development team is generally quite busy and response times can sometimes grow big (up to weeks or even months). It's user base (which can be reached through the mailing lists [2]) is larger and, sometimes, more responsive.\n\nAs we're at it, my personal opinion is that you are doing something wrong or not assuring the proper dependencies (Jar files missing in Classpath, maybe?). This feeling comes from the fact that opening the file in a JSVGCanvas (Squiggle) works as expected. But, as I didn't confirm this, I'd suggest crawling through the mailing list archives for answers: you might prefer using Nabble's interface [3], which is a bit more user friendly then Apache's in my opinion.\n\nIf you find no answers nor anyone contributes with a more interesting response here within a few days, I suggest trying again using the mailing lists (\"batik-users\" seems more appropriate for this). In that case, please provide a pointer to this bug report [4] in your message so readers can have some kind of background and/or update this bug's status whenever applicable.\n\nHope this helps,\n Helder Magalh\u00e3es\n\n[1] http://www.catb.org/~esr/faqs/smart-questions.html#id308182\n[2] http://xmlgraphics.apache.org/batik/mailing-lists.html\n[3] http://www.nabble.com/Batik-f308.html\n[4] https://issues.apache.org/bugzilla/show_bug.cgi?id=46825"}, {"count": 8, "tags": [], "bug_id": 46825, "attachment_id": null, "is_private": false, "id": 125978, "time": "2009-04-03T08:56:21Z", "creator": "shamel@optinf.ca", "creation_time": "2009-04-03T08:56:21Z", "text": "Hi,\n\nI found the problem with this. I know how to work around it but there is still a bug in the application. \n\nThe problem was with the URI of the SVG document to transcode. As Helder told me:\n\n>I'd suggest the mailing list for this\n>sort of troubleshooting, as the test case runs as expected in a usual\n>JSVGCanvas (Squiggle, for example).\n\nHe was right, the test case run in JSVGCanvas because JSVGCanvas does some sort of transformation in the URI of the SVGDocument which makes it \"transcodable\" by the transcoder. So, I tryed, as Helder Magalh\u00e3es did to transcode a document passing by JSVGCanvas and everything worked as supposed, document transcoded, but as soon as I tryed the trancoding without passing by the JSVGCanvas I always got the same error:\n\norg.apache.batik.bridge.BridgeException: c:\\images\\c:\\images\\signatureVideBonne.svg (Syntaxe du nom de fichier, de r\u00e9pertoire ou de volume incorrecte)\n\tat org.apache.batik.bridge.BridgeContext.getReferencedNode(BridgeContext.java:780)\n\nWhat as to be noticed here is the URI of the document:\nc:\\images\\c:\\images\\signatureVideBonne.svg\n\nIn fact, the URI passed was \"file:c:\\images\\signatureVideBonne.svg\".\n\nSo, it's been modified. When passing by JSVGCanvas this problem does not occur because the URI is transformed before trying to transcode, and the result in the SVGDocument is: documentURI\t\"file:/C:/images/signatureVideBonne.svg\" which cause the transcoding to occur without problem.\n\nI just changed the value of the document URI to file:/C:/images/signatureVideBonne.svg in my transcoding without passing by JSVGCanvas to get it done properly without errors.\n\nSince the URI \"file:c:\\images\\signatureVideBonne.svg\" is a well formed URI the transcoder should support it. \n\nThanks,\n\nS\u00e9bastien"}, {"count": 9, "tags": [], "bug_id": 46825, "attachment_id": null, "is_private": false, "id": 125980, "time": "2009-04-03T09:43:25Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2009-04-03T09:43:25Z", "text": "(In reply to comment #8)\n> Since the URI \"file:c:\\images\\signatureVideBonne.svg\" is a well formed URI the\n> transcoder should support it. \n\nI must disagree with this. The file URI scheme [1] doesn't take left slashes and should take a double right slash after \"file:\". Although I didn't tested myself, I inclusively find it somehow hard to work like that. In your sample, you'd want something like \"file:///c:/images/signatureVideBonne.svg\" (the third right slash means the file system root).\n\nAlso, not having tested, I'd say that providing a relative path (such as \"../images/signatureVideBonne.svg\") probably works and is generally a better practice.\n\n@Batik developers also:\nWould a patch replacing all uses of \".toURL()\" for \".toURI().toURL()\" help? You may also try this and see if it helps working you particular use case. Note that you never provided the command-line used to run the rasterizer (asked for in comment 2) so I'm assuming you are wrapping the rasterizer functionality in some class, case where this may help (didn't test for this particular use case, though).\n\nI'd vote for marking this fixed (invalid) unless something interesting is added to this report...\n\nHope this helps,\n Helder Magalh\u00e3es\n\n[1] http://en.wikipedia.org/wiki/File_URI_scheme"}, {"count": 10, "tags": [], "bug_id": 46825, "attachment_id": null, "is_private": false, "id": 125981, "time": "2009-04-03T10:09:24Z", "creator": "shamel@optinf.ca", "creation_time": "2009-04-03T10:09:24Z", "text": "\n> I must disagree with this. The file URI scheme [1] doesn't take left slashes\n> and should take a double right slash after \"file:\". Although I didn't tested\n> myself, I inclusively find it somehow hard to work like that. In your sample,\n> you'd want something like \"file:///c:/images/signatureVideBonne.svg\" (the third\n\nYou're right. The main point is basically the erratic behavior which cause one transcoding flow to work with the wrong URI and the other flow to not work. At my opinion it should either work in both situations or the opposite. \n\nOn the other side, this issue could be closed since using a well formed URI will work in all cases."}]
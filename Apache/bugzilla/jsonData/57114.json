[{"count": 0, "tags": [], "text": "As per Ubik Load Pack report:\n-----------------------------------------------------------------------------\nReviewing code of Functions in JMeter we don't understand why Functions that only have values as instance variable (so Beanshell or StringFromFile or IterationCounter (which could be improved to avoid it) are not concerned) synchronize on execute.\n\nIt appears \"values\" instance variable is initialized within StandardJMeterEngine thread and then only accessed in read mode by JMeterThread\n\nBut it is true that if synchronized is removed then CompoundVariable is accessed by multi threads but it seems it uses thread related data so it should be OK.\n\n\n-----------------------------------------------------------------------------\n\nAnd as per dev mailing list :\nhttp://mail-archives.apache.org/mod_mbox/jmeter-dev/201410.mbox/%3CCAB%3DJe-Gy4tp%3DMPih292oG1XpH7D1X0%2BUR%2BUa_rnLyXaUH-fePA%40mail.gmail.com%3E", "is_private": false, "bug_id": 57114, "id": 178581, "time": "2014-10-18T12:28:20Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-10-18T12:28:20Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 57114, "text": "Created attachment 32124\nAvoid synchronization where it is not required\n\nI went through sub-classes of AbstractFunction and removed synchronization where it is not required.\nBasically, if a function does not modify state and if it accesses thread-safe objects only, then synchronization is not required.\n\nPlease find the attached patch on top of e9228ccf / trunk@1632410.\n\nNotes:\n0) The patch contains just synchronization removal + some corrections to CV. All the tests pass except testPropfile(org.apache.jmeter.save.TestSaveService)junit.framework.AssertionFailedError: Property File Version mismatch, ensure you update SaveService#FILEVERSION field with revision id of saveservice.properties.\n\ntestPropfile fails without patch as well, so I did not investigate that.\n\n1) I have no idea what to do with BeanShell function. bsh.Interpreter is thread safe, however bshInterpreter.set(\"vars\",...) should not be accessed concurrently as that will just overwrite the value.\nI think it makes sense to wrap bsh interpreter in a ThreadLocal, so synchronization can be removed from BeanShell.execute", "id": 178586, "time": "2014-10-18T14:16:46Z", "creator": "sitnikov.vladimir@gmail.com", "creation_time": "2014-10-18T14:16:46Z", "is_private": false, "attachment_id": 32124}, {"count": 2, "tags": [], "bug_id": 57114, "text": "Date: Sun Oct 19 19:53:07 2014\nNew Revision: 1632983\n\nURL: http://svn.apache.org/r1632983\nLog:\nBug 57114 - Performance : Functions that only have values as instance variable should not synchronize execute\nBugzilla Id: 57114\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/engine/util/CompoundVariable.java\n    jmeter/trunk/src/core/org/apache/jmeter/functions/AbstractFunction.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/AbstractHostIPName.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/CSVRead.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/CharFunction.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/EscapeHtml.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/EscapeOroRegexpChars.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/EvalFunction.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/EvalVarFunction.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/FileToString.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/IntSum.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/IterationCounter.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/JavaScript.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/Jexl2Function.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/JexlFunction.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/LogFunction.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/LogFunction2.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/LongSum.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/Property.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/Property2.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/Random.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/RandomString.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/RegexFunction.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/SamplerName.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/SetProperty.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/SplitFunction.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/TestPlanName.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/TimeFunction.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/UnEscape.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/UnEscapeHtml.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/UrlDecode.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/UrlEncode.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/Variable.java\n    jmeter/trunk/xdocs/changes.xml", "id": 178607, "time": "2014-10-19T19:57:12Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-10-19T19:57:12Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "Date: Mon Oct 27 13:41:47 2014\nNew Revision: 1634535\n\nURL: http://svn.apache.org/r1634535\nLog:\nBug 57114 - Performance : Functions that only have values as instance variable should not synchronize execute\nRemove synchronized on setParameters\nBugzilla Id: 57114\n\nModified:\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/EscapeOroRegexpChars.java\n\n\nDate: Mon Oct 27 13:43:01 2014\nNew Revision: 1634537\n\nURL: http://svn.apache.org/r1634537\nLog:\nBug 57114 - Performance : Functions that only have values as instance variable should not synchronize execute\nRemove old TODO\nBugzilla Id: 57114\n\nModified:\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/SamplerName.java\n\n\nDate: Mon Oct 27 13:42:36 2014\nNew Revision: 1634536\n\nURL: http://svn.apache.org/r1634536\nLog:\nBug 57114 - Performance : Functions that only have values as instance variable should not synchronize execute\nKeep synchronized where it is needed\nBugzilla Id: 57114\n\nModified:\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/LogFunction.java\n    jmeter/trunk/src/functions/org/apache/jmeter/functions/LogFunction2.java", "id": 178772, "time": "2014-10-27T13:44:22Z", "bug_id": 57114, "creation_time": "2014-10-27T13:44:22Z", "is_private": false}]
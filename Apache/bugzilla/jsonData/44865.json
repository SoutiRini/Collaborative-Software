[{"count": 0, "tags": [], "creator": "oremj@mozilla.com", "text": "I am seeing the following errors in my apache logs:\n\n[Wed Apr 23 09:58:33 2008] [error] [client 10.2.80.101] Could not LOCK /user/27afdfe55a109f3c9bd486328c548e5c10f14ae2/ due to a failed precondition (e.g. other locks).  [500, #0]\n[Wed Apr 23 09:58:33 2008] [error] [client 10.2.80.101] The locks could not be queried for verification against a possible \"If:\" header.  [500, #0]\n[Wed Apr 23 09:58:33 2008] [error] [client 10.2.80.101] (2)No such file or directory: The lock database was found to be corrupt. An indirect lock's direct lock could not be found.  [500, #402]\n\nThis typically happens about 5 - 20 min after deleting the lock database.\n\nThe server is \"high volume\" running a max of about 24 dav req/s and averages about 4.11 dav req/s.\n\nThe lock database is sitting on a ext3 partition.", "id": 115813, "time": "2008-04-23T10:19:27Z", "bug_id": 44865, "creation_time": "2008-04-23T10:19:27Z", "is_private": false, "attachment_id": null}, {"text": "To be clear, you are manually (and deliberately) deleting the lock database?\n\nThis seems like expected behaviour, if so.\n\nA request has been submitted with a LOCK which references a previously-existing lock (e.g. on /user/).  mod_dav will do a R/O attempt to open the lock database, to verify the status of that lock.  That fails since the lock database has gone.", "tags": [], "bug_id": 44865, "is_private": false, "count": 1, "id": 115829, "time": "2008-04-24T02:57:43Z", "creator": "jorton@redhat.com", "creation_time": "2008-04-24T02:57:43Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "oremj@mozilla.com", "text": "(In reply to comment #1)\n> To be clear, you are manually (and deliberately) deleting the lock database?\n\nSorry I wasn't very clear there.  By deleting the lock database I meant:\n\n* See corruption in logs\n* Stop apache\n* Delete lock database\n* Start apache\n", "id": 115846, "time": "2008-04-24T11:06:34Z", "bug_id": 44865, "creation_time": "2008-04-24T11:06:34Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 44865, "is_private": false, "text": "OK, so what are the \"corruption\" errors which are being logged which lead you to delete the lock database in the first place?", "id": 115865, "time": "2008-04-25T03:08:33Z", "creator": "jorton@redhat.com", "creation_time": "2008-04-25T03:08:33Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "oremj@mozilla.com", "attachment_id": null, "id": 115880, "time": "2008-04-25T09:16:19Z", "bug_id": 44865, "creation_time": "2008-04-25T09:16:19Z", "is_private": false, "text": "The errors I pasted are the errors that cause me to delete the lock database. \n\nMore examples: \n\ncat /var/log/httpd/error_log | grep corrupt  |tail -n 4\n[Fri Apr 25 09:13:00 2008] [error] [client 10.2.80.101] (2)No such file or directory: The lock database was found to be corrupt. An indirect lock's direct lock could not be found.  [500, #402]\n[Fri Apr 25 09:13:41 2008] [error] [client 10.2.80.101] (2)No such file or directory: The lock database was found to be corrupt. An indirect lock's direct lock could not be found.  [500, #402]\n[Fri Apr 25 09:14:10 2008] [error] [client 10.2.80.101] The lock database was found to be corrupt. An indirect lock's direct lock could not be found.  [500, #402]\n[Fri Apr 25 09:14:11 2008] [error] [client 10.2.80.101] The lock database was found to be corrupt. An indirect lock's direct lock could not be found.  [500, #402]\n\n\nNote that I haven't deleted the lock database since around Apr 15."}, {"count": 5, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "Has the lock database been re-created on disk at the point these errors are logged?", "id": 115883, "time": "2008-04-25T09:33:52Z", "bug_id": 44865, "creation_time": "2008-04-25T09:33:52Z", "is_private": false}, {"count": 6, "tags": [], "creator": "oremj@mozilla.com", "attachment_id": null, "id": 115885, "time": "2008-04-25T10:25:00Z", "bug_id": 44865, "creation_time": "2008-04-25T10:25:00Z", "is_private": false, "text": "It doesn't look like the lock database is being recreated.  I watched the lock directory for about a minute with inotify.  Results:\n\n     43 lockdb.dir IN_CLOSE_WRITE\n     43 lockdb.dir IN_OPEN\n     46 lockdb.dir IN_ACCESS\n     46 lockdb.pag IN_CLOSE_WRITE\n     46 lockdb.pag IN_OPEN\n    187 lockdb.pag IN_MODIFY\n    243 lockdb.pag IN_ACCESS\n\nI was able to trigger\n\n[Fri Apr 25 10:24:16 2008] [error] [client 10.2.80.101] (2)No such file or directory: The lock database was found to be corrupt. An indirect lock's direct lock could not be found.  [500, #402]\n\nseveral times while watching.  \n\nThe strange thing is that it seems to only become corrupt for certain directories.  For example even though locking /user/05c3d5e2202a7f92edddfb4753c5fa771758daeb/ causes 500 errors I can lock a different directory with no problems."}, {"count": 7, "tags": [], "creator": "oremj@mozilla.com", "attachment_id": null, "text": "Anything else I can do to assist here?", "id": 116439, "time": "2008-05-09T17:28:51Z", "bug_id": 44865, "creation_time": "2008-05-09T17:28:51Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 44865, "attachment_id": null, "text": "I am seeing identical or very similar corruption (2.2.15 on MacOSX). In my case I think that bug #50773 might the specific cause.", "id": 145876, "time": "2011-04-19T20:56:24Z", "creator": "wiml@omnigroup.com", "creation_time": "2011-04-19T20:56:24Z", "is_private": false}, {"text": "I can confirm this bug exists in 2.2.22 and I am constantly hitting it. Any fixes in sight?", "tags": [], "bug_id": 44865, "is_private": false, "count": 9, "id": 162229, "time": "2012-09-17T09:39:19Z", "creator": "werner_schalk@gmx.de", "creation_time": "2012-09-17T09:39:19Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 48806, "attachment_id": 25049, "text": "Created attachment 25049\nSample FO file that triggers the bug\n\nI am using FOP 0.95 (latest stable at the time of writing) and attached FO\nfile.\n\nI convert it to PDF with\n\nfop -fo exception.fo sample.PDF\n\nExpected output:\nA PDF file\n\nActual output\n\nThe following exception:\n\njava.lang.ClassCastException: org.apache.fop.layoutmgr.LeafPosition cannot be cast to org.apache.fop.layoutmgr.NonLeafPosition\n        at org.apache.fop.cli.InputHandler.transformTo(InputHandler.java:217)\n        at org.apache.fop.cli.InputHandler.renderTo(InputHandler.java:125)\n        at org.apache.fop.cli.Main.startFOP(Main.java:166)\n        at org.apache.fop.cli.Main.main(Main.java:197)\n\nIf I remove either the inline elements or the text-align attribute the exception goes away", "id": 134851, "time": "2010-02-24T09:44:23Z", "creator": "kkapelon@freemail.gr", "creation_time": "2010-02-24T09:44:23Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 48806, "attachment_id": null, "id": 134852, "time": "2010-02-24T10:40:49Z", "creator": "vanukuri.venkat@googlemail.com", "creation_time": "2010-02-24T10:40:49Z", "is_private": false, "text": "I have tried to reproduce the problem, I haven't got the same exception, but a NullpointerException...\n\nListening for transport dt_socket at address: 5005\n24-Feb-2010 10:39:35 org.apache.fop.apps.FopFactoryConfigurator configure\nINFO: Default page-height set to: 11in\n24-Feb-2010 10:39:35 org.apache.fop.apps.FopFactoryConfigurator configure\nINFO: Default page-width set to: 8.26in\n24-Feb-2010 10:39:35 org.apache.fop.events.LoggingEventListener processEvent\nWARNING: The following feature isn't implemented by Apache FOP, yet: table-layout=\"auto\" (on fo:table) (See position 18:15)\n24-Feb-2010 10:39:35 org.apache.fop.events.LoggingEventListener processEvent\nWARNING: The following feature isn't implemented by Apache FOP, yet: table-layout=\"auto\" (on fo:table) (See position 25:21)\n24-Feb-2010 10:39:35 org.apache.fop.cli.Main startFOP\nSEVERE: Exception\njava.lang.NullPointerException\n        at org.apache.fop.cli.InputHandler.transformTo(InputHandler.java:302)\n        at org.apache.fop.cli.InputHandler.renderTo(InputHandler.java:130)\n        at org.apache.fop.cli.Main.startFOP(Main.java:174)\n        at org.apache.fop.cli.Main.main(Main.java:205)\n\n---------\n\njava.lang.NullPointerException\n        at org.apache.fop.layoutmgr.inline.TextLayoutManager.addALetterSpaceTo(TextLayoutManager.java:793)\n        at org.apache.fop.layoutmgr.inline.InlineStackingLayoutManager.addALetterSpaceTo(InlineStackingLayoutManager.java:226)\n        at org.apache.fop.layoutmgr.inline.InlineStackingLayoutManager.addALetterSpaceTo(InlineStackingLayoutManager.java:226)\n        at org.apache.fop.layoutmgr.InlineKnuthSequence.addALetterSpace(InlineKnuthSequence.java:133)\n        at org.apache.fop.layoutmgr.InlineKnuthSequence.appendSequence(InlineKnuthSequence.java:76)\n        at org.apache.fop.layoutmgr.KnuthSequence.appendSequenceOrClose(KnuthSequence.java:93)\n        at org.apache.fop.layoutmgr.inline.InlineLayoutManager.getNextKnuthElements(InlineLayoutManager.java:328)\n        at org.apache.fop.layoutmgr.inline.InlineLayoutManager.getNextKnuthElements(InlineLayoutManager.java:309)\n        at org.apache.fop.layoutmgr.inline.InlineLayoutManager.getNextKnuthElements(InlineLayoutManager.java:309)\n        at org.apache.fop.layoutmgr.inline.LineLayoutManager.collectInlineKnuthElements(LineLayoutManager.java:639)\n        at org.apache.fop.layoutmgr.inline.LineLayoutManager.getNextKnuthElements(LineLayoutManager.java:579)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextChildElements(BlockStackingLayoutManager.java:571)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextChildElements(BlockStackingLayoutManager.java:552)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextKnuthElements(BlockStackingLayoutManager.java:280)\n        at org.apache.fop.layoutmgr.BlockLayoutManager.getNextKnuthElements(BlockLayoutManager.java:123)\n        at org.apache.fop.layoutmgr.BlockLayoutManager.getNextKnuthElements(BlockLayoutManager.java:115)\n        at org.apache.fop.layoutmgr.table.TableCellLayoutManager.getNextKnuthElements(TableCellLayoutManager.java:154)\n        at org.apache.fop.layoutmgr.table.RowGroupLayoutManager.createElementsForRowGroup(RowGroupLayoutManager.java:118)\n        at org.apache.fop.layoutmgr.table.RowGroupLayoutManager.getNextKnuthElements(RowGroupLayoutManager.java:61)\n        at org.apache.fop.layoutmgr.table.TableContentLayoutManager.getKnuthElementsForRowIterator(TableContentLayoutManager.java:220)\n        at org.apache.fop.layoutmgr.table.TableContentLayoutManager.getNextKnuthElements(TableContentLayoutManager.java:173)\n        at org.apache.fop.layoutmgr.table.TableLayoutManager.getNextKnuthElements(TableLayoutManager.java:249)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextChildElements(BlockStackingLayoutManager.java:571)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextChildElements(BlockStackingLayoutManager.java:552)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextKnuthElements(BlockStackingLayoutManager.java:280)\n        at org.apache.fop.layoutmgr.BlockLayoutManager.getNextKnuthElements(BlockLayoutManager.java:123)\n        at org.apache.fop.layoutmgr.BlockLayoutManager.getNextKnuthElements(BlockLayoutManager.java:115)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextChildElements(BlockStackingLayoutManager.java:571)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextChildElements(BlockStackingLayoutManager.java:552)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextKnuthElements(BlockStackingLayoutManager.java:280)\n        at org.apache.fop.layoutmgr.BlockLayoutManager.getNextKnuthElements(BlockLayoutManager.java:123)\n        at org.apache.fop.layoutmgr.BlockLayoutManager.getNextKnuthElements(BlockLayoutManager.java:115)\n        at org.apache.fop.layoutmgr.table.TableCellLayoutManager.getNextKnuthElements(TableCellLayoutManager.java:154)\n        at org.apache.fop.layoutmgr.table.RowGroupLayoutManager.createElementsForRowGroup(RowGroupLayoutManager.java:118)\n        at org.apache.fop.layoutmgr.table.RowGroupLayoutManager.getNextKnuthElements(RowGroupLayoutManager.java:61)\n        at org.apache.fop.layoutmgr.table.TableContentLayoutManager.getKnuthElementsForRowIterator(TableContentLayoutManager.java:220)\n        at org.apache.fop.layoutmgr.table.TableContentLayoutManager.getNextKnuthElements(TableContentLayoutManager.java:173)\n        at org.apache.fop.layoutmgr.table.TableLayoutManager.getNextKnuthElements(TableLayoutManager.java:249)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextChildElements(BlockStackingLayoutManager.java:571)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextChildElements(BlockStackingLayoutManager.java:552)\n        at org.apache.fop.layoutmgr.BlockStackingLayoutManager.getNextKnuthElements(BlockStackingLayoutManager.java:280)\n        at org.apache.fop.layoutmgr.BlockLayoutManager.getNextKnuthElements(BlockLayoutManager.java:123)\n        at org.apache.fop.layoutmgr.BlockLayoutManager.getNextKnuthElements(BlockLayoutManager.java:115)\n        at org.apache.fop.layoutmgr.FlowLayoutManager.getNextChildElements(FlowLayoutManager.java:199)\n        at org.apache.fop.layoutmgr.FlowLayoutManager.addChildElements(FlowLayoutManager.java:140)\n        at org.apache.fop.layoutmgr.FlowLayoutManager.addChildElements(FlowLayoutManager.java:129)\n        at org.apache.fop.layoutmgr.FlowLayoutManager.getNextKnuthElements(FlowLayoutManager.java:70)\n        at org.apache.fop.layoutmgr.PageBreaker.getNextKnuthElements(PageBreaker.java:216)\n        at org.apache.fop.layoutmgr.AbstractBreaker.getNextBlockList(AbstractBreaker.java:692)\n        at org.apache.fop.layoutmgr.PageBreaker.getNextBlockList(PageBreaker.java:149)\n        at org.apache.fop.layoutmgr.PageBreaker.getNextBlockList(PageBreaker.java:132)\n        at org.apache.fop.layoutmgr.AbstractBreaker.doLayout(AbstractBreaker.java:337)\n        at org.apache.fop.layoutmgr.PageBreaker.doLayout(PageBreaker.java:85)\n        at org.apache.fop.layoutmgr.PageSequenceLayoutManager.activateLayout(PageSequenceLayoutManager.java:107)\n        at org.apache.fop.area.AreaTreeHandler.endPageSequence(AreaTreeHandler.java:238)\n        at org.apache.fop.fo.pagination.PageSequence.endOfNode(PageSequence.java:120)\n        at org.apache.fop.fo.FOTreeBuilder$MainFOHandler.endElement(FOTreeBuilder.java:349)\n        at org.apache.fop.fo.FOTreeBuilder.endElement(FOTreeBuilder.java:177)\n        at org.apache.xalan.transformer.TransformerIdentityImpl.endElement(TransformerIdentityImpl.java:1101)\n        at org.apache.xerces.parsers.AbstractSAXParser.endElement(Unknown Source)\n        at org.apache.xerces.xinclude.XIncludeHandler.endElement(Unknown Source)\n        at org.apache.xerces.impl.XMLNSDocumentScannerImpl.scanEndElement(Unknown Source)\n        at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)\n        at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\n        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n        at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\n        at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\n        at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\n        at org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source)\n        at org.apache.xalan.transformer.TransformerIdentityImpl.transform(TransformerIdentityImpl.java:484)\n        at org.apache.fop.cli.InputHandler.transformTo(InputHandler.java:299)\n        at org.apache.fop.cli.InputHandler.renderTo(InputHandler.java:130)\n        at org.apache.fop.cli.Main.startFOP(Main.java:174)\n        at org.apache.fop.cli.Main.main(Main.java:205)"}, {"count": 2, "tags": [], "bug_id": 48806, "attachment_id": null, "text": "I have used Fop Trunk version to get that above NullpointerException", "id": 134853, "time": "2010-02-24T10:41:55Z", "creator": "vanukuri.venkat@googlemail.com", "creation_time": "2010-02-24T10:41:55Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 48806, "attachment_id": null, "id": 134854, "time": "2010-02-24T11:08:12Z", "creator": "peter.hancock@gmail.com", "creation_time": "2010-02-24T11:08:12Z", "is_private": false, "text": "The bug seems to be caused by the no-break space (u+a0) between the first fo:inline elemet of\n<fo:inline> </fo:inline>World</fo:inline></fo:inline>\n\nchanging it to a regular space (u+20) resulted in a successful render.\n\nReplace <fo:inline> </fo:inline> by\n<fo:inline>&#xa0;</fo:inline> \nand \n<fo:inline>&#x20;</fo:inline>\nto demonstrate this.\n\nHowever,this should still be recognised as a bug in fop.\n\nI can verify that this bug still exists in the trunk, with a different exception stack\n...\nCaused by: java.lang.NullPointerException\n\tat org.apache.fop.layoutmgr.inline.TextLayoutManager.addALetterSpaceTo(TextLayoutManager.java:851)\n\tat org.apache.fop.layoutmgr.inline.InlineStackingLayoutManager.addALetterSpaceTo(InlineStackingLayoutManager.java:224)\n\tat org.apache.fop.layoutmgr.inline.InlineStackingLayoutManager.addALetterSpaceTo(InlineStackingLayoutManager.java:224)\n\tat org.apache.fop.layoutmgr.InlineKnuthSequence.addALetterSpace(InlineKnuthSequence.java:133)\n\tat org.apache.fop.layoutmgr.InlineKnuthSequence.appendSequence(InlineKnuthSequence.java:76)\n\tat org.apache.fop.layoutmgr.KnuthSequence.appendSequenceOrClose(KnuthSequence.java:93)\n\tat org.apache.fop.layoutmgr.inline.InlineLayoutManager.getNextKnuthElements(InlineLayoutManager.java:330)\n..."}, {"count": 4, "tags": [], "bug_id": 48806, "text": "Thank you very much for you quick reply!\n\nI have to add however that with FOP 0.95 the exception goes away \n\n1. if text-align attribute is removed OR\n2. if the non-breakspace is replaced with a space (as Peter Hancock said) OR\n3. if the inline element that contains the non-breaking space is removed but the non-breaking space itself stays OR\n4. If a word is inserted before the non-breaking space OR\n5. If a word is inserted after the non-breaking space\n\nSo it seems to me that the combination of span + contents of non-breaking space and nothing else is the problem. As for text-align I have no clue!", "id": 134858, "time": "2010-02-24T13:22:47Z", "creator": "kkapelon@freemail.gr", "creation_time": "2010-02-24T13:22:47Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 48806, "attachment_id": 25051, "text": "Created attachment 25051\nA cut down example", "id": 134859, "time": "2010-02-24T14:13:20Z", "creator": "peter.hancock@gmail.com", "creation_time": "2010-02-24T14:13:20Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 48806, "text": "resetting P2 open bugs to P3 pending further review", "id": 157586, "time": "2012-04-07T01:44:55Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:44:55Z", "is_private": false, "attachment_id": null}]
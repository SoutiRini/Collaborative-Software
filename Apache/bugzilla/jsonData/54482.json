[{"count": 0, "tags": [], "bug_id": 54482, "attachment_id": null, "id": 164875, "time": "2013-01-24T21:24:33Z", "creator": "shmulikk@gmail.com", "creation_time": "2013-01-24T21:24:33Z", "is_private": false, "text": "When using HTTPClient and a response is redirecting to a url with special characters like [], the followed sample is failing with: Non HTTP response code: java.net.URISyntaxException\n\nThis doesn't occur with Java HTTP sampler."}, {"count": 1, "attachment_id": 29894, "bug_id": 54482, "is_private": false, "id": 164876, "time": "2013-01-24T21:25:39Z", "creator": "shmulikk@gmail.com", "creation_time": "2013-01-24T21:25:39Z", "tags": [], "text": "Created attachment 29894\njmeter script"}, {"count": 2, "tags": [], "text": "Created attachment 29895\nexample jsp to reproduce problem", "is_private": false, "id": 164877, "creator": "shmulikk@gmail.com", "time": "2013-01-24T21:26:17Z", "bug_id": 54482, "creation_time": "2013-01-24T21:26:17Z", "attachment_id": 29895}, {"count": 3, "attachment_id": null, "bug_id": 54482, "text": "This seems regular from what I understand reading :\n- http://www.ietf.org/rfc/rfc3986.txt\n\n   A host identified by an Internet Protocol literal address, version 6\n   [RFC3513] or later, is distinguished by enclosing the IP literal\n   within square brackets (\"[\" and \"]\").  This is the only place where\n   square bracket characters are allowed in the URI syntax.  In\n   anticipation of future, as-yet-undefined IP literal address formats,\n   an implementation may use an optional version flag to indicate such a\n   format explicitly rather than rely on heuristic determination.\n\n\n\nhttp://www.ietf.org/rfc/rfc1738.txt\n\n    Unsafe:\n\n    Characters can be unsafe for a number of reasons. The space character is unsafe because significant spaces may disappear and insignificant spaces may be introduced when URLs are transcribed or typeset or subjected to the treatment of word-processing programs. The characters \"<\" and \">\" are unsafe because they are used as the delimiters around URLs in free text; the quote mark (\"\"\") is used to delimit URLs in some systems. The character \"#\" is unsafe and should always be encoded because it is used in World Wide Web and in other systems to delimit a URL from a fragment/anchor identifier that might follow it. The character \"%\" is unsafe because it is used for encodings of other characters. Other characters are unsafe because gateways and other transport agents are known to sometimes modify such characters. These characters are \"{\", \"}\", \"|\", \"\\\", \"^\", \"~\", \"[\", \"]\", and \"`\".\n\n    All unsafe characters must always be encoded within a URL. For example, the character \"#\" must be encoded within URLs even in systems that do not normally deal with fragment or anchor identifiers, so that if the URL is copied into another system that does use them, it will not be necessary to change the URL encoding.\n\n\n\nHC4 accepts this kind of URLs:\n- http://stackoverflow.com/search?q=square+brackets+[url]\n\nBut not one where brackets are before '?'", "id": 165034, "time": "2013-02-02T23:12:40Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-02-02T23:12:40Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 54482, "text": "Hi Philippe,\nI think you misread the text (or I am).\n\nThe first link describes IPv6 while I think we still commonly use IPv4.\n\nThe second link explicitly says: \"All unsafe characters must always be encoded within a URL\".\n\nThird point is that Java implementation encode these characters (as you see from the example testplan).\n\nThanks for looking into that.", "id": 165036, "time": "2013-02-03T08:24:56Z", "creator": "shmulikk@gmail.com", "creation_time": "2013-02-03T08:24:56Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 54482, "attachment_id": null, "is_private": false, "id": 165040, "time": "2013-02-03T21:06:38Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-02-03T21:06:38Z", "text": "Issue similar to 54142"}, {"count": 6, "tags": [], "bug_id": 54482, "attachment_id": null, "id": 165041, "time": "2013-02-03T22:26:20Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-02-03T22:26:20Z", "is_private": false, "text": "Date: Sun Feb  3 22:24:08 2013\nNew Revision: 1441978\n\nURL: http://svn.apache.org/viewvc?rev=1441978&view=rev\nLog:\nBug 54482 - HC fails to follow redirects with non-encoded chars\nBugzilla Id: 54482\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n    jmeter/trunk/xdocs/changes.xml"}, {"count": 7, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "Date: Mon Feb  4 20:19:36 2013\nNew Revision: 1442330\n\nURL: http://svn.apache.org/viewvc?rev=1442330&view=rev\nLog:\nBug 54482 - HC fails to follow redirects with non-encoded chars\nApply fix to HTTPHC3Impl\nFactor out sanitize code in ConversionUtils\nBugzilla Id: 54482\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC3Impl.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/util/ConversionUtils.java", "id": 166532, "time": "2013-04-11T20:07:10Z", "bug_id": 54482, "creation_time": "2013-04-11T20:07:10Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 54482, "text": "Fix introduces regressions on this kind of URLs\nhttp://XXX.XXXX.com/toto_titi_tata/CatalogData/ItemImages\\IJ\\Items_1152\\07_06_015_Na_0_0_0_Aucune_0_Na_Na_Batik_s.jpg", "id": 166533, "time": "2013-04-11T20:17:33Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-04-11T20:17:33Z", "is_private": false, "attachment_id": null}, {"count": 9, "attachment_id": null, "bug_id": 54482, "text": "Date: Thu Apr 11 20:24:48 2013\nNew Revision: 1467074\n\nURL: http://svn.apache.org/r1467074\nLog:\nRollback to fix of bugs:\n54482- HC fails to follow redirects with non-encoded chars\n54293- JMeter rejects html tags '&lt;' in query params as invalid when they are accepted by the browser\n54142- HTTP Proxy Server throws an exception when path contains \"|\" character\n\nBugzilla Id: 54482,54293,54142\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC3Impl.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n    jmeter/trunk/xdocs/changes.xml", "id": 166536, "time": "2013-04-11T20:25:49Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-04-11T20:25:49Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "text": "It should work now with Nightly build and HttpClient 4.\n\nCould you give it a try ?\nThanks", "id": 169081, "time": "2013-08-03T23:11:17Z", "bug_id": 54482, "creation_time": "2013-08-03T23:11:17Z", "attachment_id": null}, {"text": "Hi,\nUsing r1509934, I still get this error with either HC3.1 and HC4.\nHC3.1 shows:\nResponse code: Non HTTP response code: java.lang.IllegalArgumentException\nResponse message: Non HTTP response message: Invalid uri 'http://localhost:8080/?[]!@#$%^&*()': Invalid query\n\n\nHC4 shows:\nResponse code: Non HTTP response code: java.net.URISyntaxException\nResponse message: Non HTTP response message: Malformed escape pair at index 29: http://localhost:8080/?[]!@#$%^&*()\n\nJava works.", "tags": [], "creator": "shmulikk@gmail.com", "attachment_id": null, "count": 11, "id": 169083, "time": "2013-08-04T08:00:46Z", "bug_id": 54482, "creation_time": "2013-08-04T08:00:46Z", "is_private": false}, {"count": 12, "attachment_id": null, "bug_id": 54482, "is_private": false, "id": 169208, "time": "2013-08-06T21:31:38Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-08-06T21:31:38Z", "tags": [], "text": "Date: Tue Aug  6 21:30:55 2013\nNew Revision: 1511125\n\nURL: http://svn.apache.org/r1511125\nLog:\nBug 54482 - HC fails to follow redirects with non-encoded chars\nBugzilla Id: 54482\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC3Impl.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n    jmeter/trunk/xdocs/changes.xml"}, {"count": 13, "tags": [], "bug_id": 54482, "attachment_id": null, "is_private": false, "id": 169210, "time": "2013-08-06T22:42:26Z", "creator": "sebb@apache.org", "creation_time": "2013-08-06T22:42:26Z", "text": "ConversionUtils.sanitizeUrl() only works properly for URLs that are not currently encoded.\n\nEncoded URLs - i.e. ones that contain %xx - are re-encoded to %25xx.\nThis is obviously wrong.\n\nIf a browser encodes some characters and not others, then either one has to unencode and re-encode, or one has to just encode the special characters."}, {"count": 14, "attachment_id": null, "bug_id": 54482, "is_private": false, "id": 169234, "time": "2013-08-07T13:47:01Z", "creator": "sebb@apache.org", "creation_time": "2013-08-07T13:47:01Z", "tags": [], "text": "(In reply to Sebb from comment #13)\n> ConversionUtils.sanitizeUrl() only works properly for URLs that are not\n> currently encoded.\n>\n> Encoded URLs - i.e. ones that contain %xx - are re-encoded to %25xx.\n> This is obviously wrong.\n\nNote: % is allowed to occur in a query, so does not double-encoded if present in the query string.\n \n> If a browser encodes some characters and not others, then either one has to\n> unencode and re-encode, or one has to just encode the special characters."}, {"count": 15, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "is_private": false, "id": 169277, "time": "2013-08-07T21:16:57Z", "bug_id": 54482, "creation_time": "2013-08-07T21:16:57Z", "text": "Date: Wed Aug  7 21:05:29 2013\nNew Revision: 1511488\n\nURL: http://svn.apache.org/r1511488\nLog:\nBug 54482 - HC fails to follow redirects with non-encoded chars\nFix as per sebb comment\nBugzilla Id: 54482\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/util/ConversionUtils.java\n\nDate: Wed Aug  7 21:14:42 2013\nNew Revision: 1511500\n\nURL: http://svn.apache.org/r1511500\nLog:\nBug 54482 - HC fails to follow redirects with non-encoded chars\nOups take into account new exceptions\nMake error message more complete\nBugzilla Id: 54482\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC3Impl.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java"}, {"text": "Reading my comment from 2013-02-02 23:12:40 UTC, I wonder why I started working on this issue :-) \n\nBecause:\n'All unsafe characters must always be encoded within a URL' states that the kind of URLs to which you are redirecting is wrong according to RFC.\n\n\nAnyway, @Shmulikk , could you give it a try now ? \n\n@Sebb, should we add a property to enable this URL fixing and make old behaviour the default ? I am afraid of side effects.", "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "count": 16, "id": 169278, "time": "2013-08-07T21:19:52Z", "bug_id": 54482, "creation_time": "2013-08-07T21:19:52Z", "is_private": false}, {"count": 17, "tags": [], "text": "Date: Wed Aug  7 21:30:54 2013\nNew Revision: 1511504\n\nURL: http://svn.apache.org/r1511504\nLog:\nBug 54482 - HC fails to follow redirects with non-encoded chars\nCheck for null path\nBugzilla Id: 54482\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/util/ConversionUtils.java", "attachment_id": null, "id": 169283, "creator": "p.mouawad@ubik-ingenierie.com", "time": "2013-08-07T21:31:47Z", "bug_id": 54482, "creation_time": "2013-08-07T21:31:47Z", "is_private": false}, {"count": 18, "tags": [], "bug_id": 54482, "attachment_id": null, "text": "Date: Wed Aug  7 21:32:41 2013\nNew Revision: 1511506\n\nURL: http://svn.apache.org/r1511506\nLog:\nBug 54482 - HC fails to follow redirects with non-encoded chars\nAdd some tests\nBugzilla Id: 54482\n\nModified:\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/util/TestHTTPUtils.java", "id": 169284, "time": "2013-08-07T21:33:38Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-08-07T21:33:38Z", "is_private": false}, {"count": 19, "tags": [], "bug_id": 54482, "attachment_id": null, "id": 169292, "time": "2013-08-08T05:55:17Z", "creator": "shmulikk@gmail.com", "creation_time": "2013-08-08T05:55:17Z", "is_private": false, "text": "Philippe, you should read the comment I made on 2013-02-03 08:24:56 UTC.\nBasically the case here is that sometimes applications do not follow the rules/specifications.\nTo support such applications (I think JMeter should support broken applications too, as sometimes the testers will be stuck with such applications), we talked about the need to simply encoded re-direct URLs in case the need to be encoded according to the rules.\n\nRegarding the fix, I have tested and it works now.\nIt behaves a bit differently than the JAVA HTTP Sampler but it is ok now.\nI have attached another screenshot showing that on HC the url is encoded as expected while on JAVA (I assume) the URL is encoded but on the GUI it shows the decoded string."}, {"count": 20, "tags": [], "bug_id": 54482, "text": "Created attachment 30714\nScreenshot of issue fixed (errors are due to HTTP 404 which is fine)", "id": 169293, "time": "2013-08-08T05:57:52Z", "creator": "shmulikk@gmail.com", "creation_time": "2013-08-08T05:57:52Z", "is_private": false, "attachment_id": 30714}, {"count": 21, "tags": [], "bug_id": 54482, "text": "Sorry, my bad - I think this issue is not fixed yet.\nAs you can see the encoded string is broken.\nIt should be: \"?%5B%5D!%40%23%24%25%5E%26*()\"\nBut it is: \"?%5B%5D%21%40\"", "id": 169294, "time": "2013-08-08T06:01:04Z", "creator": "shmulikk@gmail.com", "creation_time": "2013-08-08T06:01:04Z", "is_private": false, "attachment_id": null}, {"count": 22, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "is_private": false, "id": 169295, "time": "2013-08-08T06:56:55Z", "bug_id": 54482, "creation_time": "2013-08-08T06:56:55Z", "text": "Do yoy have the same results with HC31 and HC4 ?"}, {"count": 23, "tags": [], "bug_id": 54482, "attachment_id": null, "is_private": false, "id": 169296, "time": "2013-08-08T06:59:28Z", "creator": "shmulikk@gmail.com", "creation_time": "2013-08-08T06:59:28Z", "text": "Yes, as shown in the attached screenshot."}, {"count": 24, "tags": [], "bug_id": 54482, "attachment_id": null, "text": "Hello,\nIn fact it is a feature, remember this bug you submitted:\n- https://issues.apache.org/bugzilla/show_bug.cgi?id=54351\n\n# is a fragment so everything after it is stripped, this is OK for JMeter as the URL will be called without fragment which is only used on client side by browser to scroll to identifier.", "id": 169300, "time": "2013-08-08T09:37:30Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-08-08T09:37:30Z", "is_private": false}, {"count": 25, "tags": [], "bug_id": 54482, "attachment_id": null, "id": 169301, "time": "2013-08-08T09:42:39Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-08-08T09:42:39Z", "is_private": false, "text": "Date: Thu Aug  8 09:41:51 2013\nNew Revision: 1511654\n\nURL: http://svn.apache.org/r1511654\nLog:\nBug 54482 - HC fails to follow redirects with non-encoded chars\nClarify javadocs\nBugzilla Id: 54482\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jme"}, {"count": 26, "attachment_id": null, "bug_id": 54482, "text": "Correct. Cool!\nThanks.", "id": 169306, "time": "2013-08-08T11:59:08Z", "creator": "shmulikk@gmail.com", "creation_time": "2013-08-08T11:59:08Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "text": "Why the hell? I can't limit access to my VHost, only to a directory? What if I don't use directories, only locations? If it's a completely virtual server?", "attachment_id": null, "id": 192062, "creator": "anrdaemon@yandex.ru", "time": "2016-07-03T11:49:23Z", "bug_id": 59785, "creation_time": "2016-07-03T11:49:23Z", "is_private": false}, {"count": 1, "tags": [], "text": "You can use Location.\nhttps://httpd.apache.org/docs/trunk/mod/directive-dict.html#Context\n\nI'm not sure what complications would arise from allowing them in server context directly, but it's not free.", "is_private": false, "bug_id": 59785, "id": 192063, "time": "2016-07-03T11:57:12Z", "creator": "covener@gmail.com", "creation_time": "2016-07-03T11:57:12Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "anrdaemon@yandex.ru", "attachment_id": null, "text": "I can't seem to use anything, it claims that I have included my directives in \"RequireAny\" which I definitely did not.\nNo matter how I read the documentation, the results doesn't change.\n\nServer version: Apache/2.4.20 (Ubuntu)\nServer built:   2016-05-05T00:00:00\n\nOutput of config test was:\nAH00526: Syntax error on line 14 of /etc/apache2/sites-enabled/ccenter.msk.ru.conf:\nnegative Require directive has no effect in <RequireAny> directive\nAction 'configtest' failed.\nThe Apache error log may have more information.\n\n<VirtualHost *:80>\n    ServerName example.com\n\n    DocumentRoot /home/ccenter/htdocs\n\n    <Directory /home/ccenter/htdocs>\n        DirectoryIndex /index.html /index.php\n\n        <Files ~ \"\\.php$\">\n            SetHandler \"proxy:fcgi://127.8.0.1:1001/\"\n        </Files>\n\n        # Deny abusive crawlers.\n        Require not ip 198.27.101.168\n        Require not ip 95.27.49.224\n\n    </Directory>\n\n    <Location \"/\">\n        SetHandler \"proxy:fcgi://127.8.0.1:1001/home/ccenter/htdocs/index.php\"\n    </Location>\n\n    <Directory /home/ccenter/htdocs/content/handmade>\n        Require all denied\n    </Directory>\n\n    <Directory /home/ccenter/htdocs/tpl>\n        Require all denied\n    </Directory>\n\n    <Directory /home/ccenter/htdocs/upload>\n        <Files ~ \"\\.php$\">\n            Require all denied\n        </Files>\n    </Directory>\n\n</VirtualHost>\n\n# grep -vRP \"^\\s*#\" /etc/apache2/*.conf /etc/apache2/*-enabled/ | grep -iC 3 \"require\"\n/etc/apache2/apache2.conf:<Directory />\n/etc/apache2/apache2.conf:\tOptions FollowSymLinks\n/etc/apache2/apache2.conf:\tAllowOverride None\n/etc/apache2/apache2.conf:\tRequire all denied\n/etc/apache2/apache2.conf:</Directory>\n/etc/apache2/apache2.conf:\n/etc/apache2/apache2.conf:<Directory /usr/share>\n/etc/apache2/apache2.conf:\tAllowOverride None\n/etc/apache2/apache2.conf:\tRequire all granted\n/etc/apache2/apache2.conf:</Directory>\n/etc/apache2/apache2.conf:\n/etc/apache2/apache2.conf:<Directory /var/www/>\n/etc/apache2/apache2.conf:\tOptions Indexes FollowSymLinks\n/etc/apache2/apache2.conf:\tAllowOverride None\n/etc/apache2/apache2.conf:\tRequire all granted\n/etc/apache2/apache2.conf:</Directory>\n/etc/apache2/apache2.conf:\n/etc/apache2/apache2.conf:\n--\n/etc/apache2/apache2.conf:AccessFileName .htaccess\n/etc/apache2/apache2.conf:\n/etc/apache2/apache2.conf:<FilesMatch \"^\\.ht\">\n/etc/apache2/apache2.conf:\tRequire all denied\n/etc/apache2/apache2.conf:</FilesMatch>\n/etc/apache2/apache2.conf:\n/etc/apache2/apache2.conf:\n--\n/etc/apache2/conf-enabled/serve-cgi-bin.conf:\t\t<Directory \"/usr/lib/cgi-bin\">\n/etc/apache2/conf-enabled/serve-cgi-bin.conf:\t\t\tAllowOverride None\n/etc/apache2/conf-enabled/serve-cgi-bin.conf:\t\t\tOptions +ExecCGI -MultiViews +SymLinksIfOwnerMatch\n/etc/apache2/conf-enabled/serve-cgi-bin.conf:\t\t\tRequire all granted\n/etc/apache2/conf-enabled/serve-cgi-bin.conf:\t\t</Directory>\n/etc/apache2/conf-enabled/serve-cgi-bin.conf:\t</IfDefine>\n/etc/apache2/conf-enabled/serve-cgi-bin.conf:</IfModule>\n--\n/etc/apache2/mods-enabled/alias.conf:\t<Directory \"/usr/share/apache2/icons\">\n/etc/apache2/mods-enabled/alias.conf:\t\tOptions FollowSymlinks\n/etc/apache2/mods-enabled/alias.conf:\t\tAllowOverride None\n/etc/apache2/mods-enabled/alias.conf:\t\tRequire all granted\n/etc/apache2/mods-enabled/alias.conf:\t</Directory>\n/etc/apache2/mods-enabled/alias.conf:\n/etc/apache2/mods-enabled/alias.conf:</IfModule>\n--\n/etc/apache2/mods-enabled/status.conf:\n/etc/apache2/mods-enabled/status.conf:\t<Location /server-status>\n/etc/apache2/mods-enabled/status.conf:\t\tSetHandler server-status\n/etc/apache2/mods-enabled/status.conf:\t\tRequire local\n/etc/apache2/mods-enabled/status.conf:\t</Location>\n/etc/apache2/mods-enabled/status.conf:\n/etc/apache2/mods-enabled/status.conf:\tExtendedStatus On", "id": 192067, "time": "2016-07-03T12:33:38Z", "bug_id": 59785, "creation_time": "2016-07-03T12:33:38Z", "is_private": false}, {"count": 3, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "id": 192068, "time": "2016-07-03T12:40:02Z", "bug_id": 59785, "creation_time": "2016-07-03T12:40:02Z", "is_private": false, "text": "You'll need to find another way to phrase your require directives:\n\n1) requireany is implicit:\n\nWhen multiple Require directives are used in a single configuration section and are not contained in another authorization directive like <RequireAll>, they are implicitly contained within a <RequireAny> directive. Thus the first one to authorize a user authorizes the entire request, and subsequent Require directives are ignored.\n\n2) \"not\" has special limitations:\n\nThe result of the Require directive may be negated through the use of the not option. As with the other negated authorization directive <RequireNone>, when the Require directive is negated it can only fail or return a neutral result, and therefore may never independently authorize a request.\n\nMaybe as simple as \n<requireall>\n  require all granted\n  require not ...\n  require not ..\n</requireall>"}, {"count": 4, "tags": [], "text": "???????\nAs a system administrator, I fully expect RequireAll to be the default.", "is_private": false, "bug_id": 59785, "id": 192071, "time": "2016-07-03T13:52:55Z", "creator": "anrdaemon@yandex.ru", "creation_time": "2016-07-03T13:52:55Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "id": 192073, "time": "2016-07-03T14:04:16Z", "bug_id": 59785, "creation_time": "2016-07-03T14:04:16Z", "is_private": false, "text": "(In reply to AR from comment #4)\n> ???????\n> As a system administrator, I fully expect RequireAll to be the default.\n\nBugzilla is for bug reports.  2.2 and 2.0 acted the same way was RequireAny.   More discussion at users@httpd.apache.org."}, {"count": 6, "tags": [], "creator": "anrdaemon@yandex.ru", "attachment_id": null, "id": 192078, "time": "2016-07-03T16:32:22Z", "bug_id": 59785, "creation_time": "2016-07-03T16:32:22Z", "is_private": false, "text": "They acted similarly, may be, but the treatment of the resulting configuration was much more in favor of the user in the 2.2.\nI'm porting a current 2.2 configuration over to 2.4, and hitting issues like this one on every turn.\nSanity checks, that refer to obscure defaults; documentation, that fails to make important points clear.\nIt took me a handful of attempts and a creative idea to get past this problem.\nThe small footnote in the http://httpd.apache.org/docs/2.4/mod/mod_authz_core.html#require that \"<RequireAny>\" is implied, if none is specified, must be an explicit statement at the top of the page."}]
[{"count": 0, "tags": [], "text": "After setting contentType to hebrew encoding in a JSP page, static text in the\npage is correctly displayed according to the specified encoding, but\ndynamically-generated text (<%= %> expression) does NOT get encoded to hebrew\nand it appears as a sequence of question marks on the browser.\n\nJSP is dispatched from a servlet that handles the request prior to generating\nthe response to the client.\n\nReproduced on both with IE-6 SP-1 and Firefox 1.0.\n\nI attached is a JSP page to reproduce the problem (but it requires that a\ndatabase with hebrew content will be on the other hand, and that a servlet will\nassign a value to the variable before dispatching the call to the attached JSP).", "attachment_id": null, "id": 67822, "creation_time": "2004-12-02T22:00:00Z", "time": "2004-12-02T22:00:00Z", "creator": "ranlevy@yahoo.com", "bug_id": 32500, "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 13628\nJSP page to demonstrate the bug", "is_private": false, "id": 67823, "creation_time": "2004-12-02T22:02:04Z", "time": "2004-12-02T22:02:04Z", "creator": "ranlevy@yahoo.com", "bug_id": 32500, "attachment_id": 13628}, {"count": 2, "tags": [], "creator": "ranlevy@yahoo.com", "attachment_id": 13632, "id": 67831, "time": "2004-12-02T23:18:36Z", "bug_id": 32500, "creation_time": "2004-12-02T23:18:36Z", "is_private": false, "text": "Created attachment 13632\nAttachment fixed - JSP pave that demonstrates the bug"}, {"count": 3, "tags": [], "creator": "allistair.crossley@qas.com", "is_private": false, "text": "have just tested your attachment in 5.5.4 (having installed the Windows 2000 \nHebrew language pack) and this works perfectly well. Will send an attachment of \nmy JSP. \n\nHowever, was not able to test your bean. So I created a String variable and \nused <%= s %> and this works, disproving your theory that <%= causes the \nproblem.\n\nI suspect however you are encoding/loading values in your bean is causing the \nissue. Is this from a database by any chance?\n\nTested and confirmed that changing contentType directive between windows-1252 \nand windows-1255 scrambles and then fixes respectively.", "id": 67872, "time": "2004-12-03T14:00:05Z", "bug_id": 32500, "creation_time": "2004-12-03T14:00:05Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "allistair.crossley@qas.com", "is_private": false, "text": "Created attachment 13638\nthis code works and shows <%= is not causing an encoding issue", "id": 67873, "time": "2004-12-03T14:01:13Z", "bug_id": 32500, "creation_time": "2004-12-03T14:01:13Z", "attachment_id": 13638}, {"count": 5, "tags": [], "bug_id": 32500, "attachment_id": null, "id": 67874, "time": "2004-12-03T14:46:50Z", "creator": "ranlevy@yahoo.com", "creation_time": "2004-12-03T14:46:50Z", "is_private": false, "text": "> However, was not able to test your bean. So I created a String variable and \n> used <%= s %> and this works, disproving your theory that <%= causes the \n> problem.\n\nIf you use a String that is defined WITHIN the JSP page itself, than you are\nusing what I called \"static\" text - a text that is encoded as part of the JSP\npage itself. If this is what you did, than you are not testing the problem I\ndescribed, because ALL hebrew text withing the JSP page is encoded\nand displayed correctly anyway.\n\nThe problem is with strings that are not static == not part of the compiled\nJSP page, but (rather) imported from a calling servlet.\n"}, {"count": 6, "tags": [], "text": "ok how are you populating your bean's values?", "attachment_id": null, "id": 67875, "creation_time": "2004-12-03T14:50:25Z", "time": "2004-12-03T14:50:25Z", "creator": "allistair.crossley@qas.com", "bug_id": 32500, "is_private": false}, {"count": 7, "tags": [], "bug_id": 32500, "attachment_id": null, "id": 67876, "time": "2004-12-03T14:56:36Z", "creator": "ranlevy@yahoo.com", "creation_time": "2004-12-03T14:56:36Z", "is_private": false, "text": "(In reply to comment #6)\n> ok how are you populating your bean's values?\n\nNot a bean.\nA servlet that received a HTTP get/post request, does some work, than\ntakes a text stored in MySQL database and passes it to the JSP page. For\nthe example file I uploaded before:\n\n   News news = createNewsObjectWithStringTakenFromDatabaseWithSelectSQLCall ();\n   request.setAttribute (\"news\", news);\n   RequestDispatcher dispatcher = ctx.getNamedDispatcher (\"JSPBugPage\");\n   dispatcher.forward (request, response);\n\n"}, {"count": 8, "tags": [], "creator": "allistair.crossley@qas.com", "attachment_id": null, "text": "I think it is more like this ..\n\nNews news = \ncreateNewsObjectWithStringTakenFromDatabaseWithSelectSQLCallAndBadDatabaseEncodi\nng ();\nrequest.setAttribute (\"news\", news);\nRequestDispatcher dispatcher = ctx.getNamedDispatcher (\"JSPPageWithNoBug\");\ndispatcher.forward (request, response);\n\nThis is a common mistake. You need to check your database connectivity and the \ncharset used to communicate with your database (and also the database encoding).\n", "id": 67879, "time": "2004-12-03T15:50:22Z", "bug_id": 32500, "creation_time": "2004-12-03T15:50:22Z", "is_private": false}, {"count": 9, "tags": [], "text": "(In reply to comment #8)\n\nWell, I had to install and configure a new version of the database to check\nthe bad-database-encoding-theory (it did not resolve anything, of course).\n\nIgnore the database: same problem persists even in a code that does not\ninvolve database operation:\n\n   News news = new News ();\n   news.setContent (\"\u00e8\u00f7\u00f1\u00e8 \u00e1\u00f2\u00e1\u00f8\u00e9\u00fa\"); // some hebrew text string\n   request.setAttribute (\"news\", news);\n   RequestDispatcher dispatcher = ctx.getNamedDispatcher (\"JSPBugPage\");\n   dispatcher.forward (request, response);\n\nThe issue is that I according to what you're saying, I must use:\n\n   news.setContent (new String (new String (\"\u00e8\u00f7\u00f1\u00e8 \u00e1\u00f2\u00e1\u00f8\u00e9\u00fa\")).getBytes \n(), \"windows-1255\"); // some hebrew text string there between the double-quotes\n\nOr in other words - do the conversion manually for each and every string\nvariable I need to pass to the JSP page, instead of having the JSP page\nconvert them automatically.\n", "attachment_id": null, "id": 67910, "creation_time": "2004-12-03T22:50:00Z", "time": "2004-12-03T22:50:00Z", "creator": "ranlevy@yahoo.com", "bug_id": 32500, "is_private": false}, {"count": 10, "tags": [], "bug_id": 32500, "attachment_id": null, "id": 67913, "time": "2004-12-03T23:39:05Z", "creator": "allistair.crossley@qas.com", "creation_time": "2004-12-03T23:39:05Z", "is_private": false, "text": "i will try this again tomorrow with your suggestion. i am certain that the \nproblem is not tomcat as i have battled with similar issues myself and \nrealised it was my mistake. there is no \"of course\" about the fact your \ndatabase is not the problem. the fact remains many people mis-configure their \ndatabase character set.\n\ni will be back with more tomorrow."}, {"count": 11, "tags": [], "text": "Thanks.\n\nNotice that for JSP pages we can state explicitly what encoding should be used\nfor character strings they contain (by setting the appropriate value in\n<%@ page contentType =...>\n\nHowever, we cannot assign such encoding to servlet code (although if it is\ntyped-in in the same environment and same text-editor as its associated JSP\npages). So characters strings that originate in servlet code and transferred\nto a JSP page will not be encoded correctly, unless the servlet explicitly\ndoes the conversion. The risk is that instead of focusing on servlet logic,\nservlet code will be cluttered with encoding conversions over and over again.\n\nIn my opinion this is an anomally (I do not think that the spec relate to this).\nThanks a lot.\n", "attachment_id": null, "bug_id": 32500, "id": 67935, "time": "2004-12-04T21:40:44Z", "creator": "ranlevy@yahoo.com", "creation_time": "2004-12-04T21:40:44Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 32500, "attachment_id": null, "id": 67938, "time": "2004-12-04T22:05:42Z", "creator": "remm@apache.org", "creation_time": "2004-12-04T22:05:42Z", "is_private": false, "text": "The report is invalid. Please do not reopen it.\nIf you have funky encoding in your source, you will need to configure the\ncompiler you're using (which is set to UTF-8 by default)."}, {"count": 13, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "Forget it, the encoding of the compiler is not the problem here (I tried the\nexample, which works fine). Sorry for the trouble.\n\nIMO the problem is that your String in your news object is retrieved from bytes\n(on your db), but is created with the wrong encoding. Anyway, please don't\nreopen the report, as there's no Tomcat issue to fix here.", "id": 67939, "time": "2004-12-04T22:22:49Z", "bug_id": 32500, "creation_time": "2004-12-04T22:22:49Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 32500, "is_private": false, "count": 14, "id": 67940, "time": "2004-12-04T22:35:54Z", "creator": "ranlevy@yahoo.com", "creation_time": "2004-12-04T22:35:54Z", "text": "And if there is no DB involved?\nInstead of writing\n  s = new String (\"\u00e8\u00f7\u00f1\u00e8\");\nIt would be written from now on:\n  s = new String (new String (\"\u00e8\u00f7\u00f1\u00e8\").getBytes (), \"windows-1255\");\n\nI'm Sorry to hear about your conclusion. IMO it passes the work to the code \nwhich becomes much more cluttered now...\n"}, {"attachment_id": null, "tags": [], "bug_id": 32500, "is_private": false, "count": 15, "id": 67941, "time": "2004-12-04T22:54:49Z", "creator": "allistair.crossley@qas.com", "creation_time": "2004-12-04T22:54:49Z", "text": "ok, i have tested this fully now. the reason your app is not working from the \nservlet side, regardless of database or no database, is because you O/S's \nlocale/regional settings will be set such that the JVM Tomcat is using is \ndefaulting character encoding for String creation (and other java.lang/java.io \nobjects) to non-Hebrew support. Therefore you must either change your O/S \nlocale so that the JVM defaults to Hebrew, OR you must convert your strings in \nthe way you already found works, i.e new String(\"hebrew\", \"windows-1255\");\n\nHere is the reference:\n\n\"Every instance of the Java virtual machine has a default charset, which may \nor may not be one of the standard charsets. The default charset is determined \nduring virtual-machine startup and typically depends upon the locale and \ncharset being used by the underlying operating system.\"\n\nhttp://java.sun.com/j2se/1.5.0/docs/api/java/nio/charset/Charset.html\n\nThis is not an anomaly of Tomcat nor the Java language.\n\nCheers, hope this helps. Allistair."}, {"count": 16, "tags": [], "text": "Created attachment 13648\nfyi: web app that demonstrates this report both for jsp and servlet,\n\nthis is a web app that demonstrates this issue. it is provided for completeness\nfor others reading this or experiencing the same issue without understanding\nwhy.\n\nnote that this is not a tomcat or java bug, read why in the previous post.", "attachment_id": 13648, "bug_id": 32500, "id": 67942, "time": "2004-12-04T22:58:25Z", "creator": "allistair.crossley@qas.com", "creation_time": "2004-12-04T22:58:25Z", "is_private": false}, {"count": 17, "tags": [], "text": "also, read up on locales here :\n\nhttp://www.joconner.com/javai18n/articles/Locale.html\n\n", "is_private": false, "bug_id": 32500, "id": 67943, "time": "2004-12-04T23:10:01Z", "creator": "allistair.crossley@qas.com", "creation_time": "2004-12-04T23:10:01Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 32500, "is_private": false, "count": 18, "id": 67989, "time": "2004-12-06T20:04:47Z", "creator": "ranlevy@yahoo.com", "creation_time": "2004-12-06T20:04:47Z", "text": "OK, comprehensive reply :-)\nNow it all makes sense together.\nThanks a lot.\n\nCan I upload here (when I finish my work) short guidelines for how to put things\nto work together (MySQL, tomcat, java I18N) as help for other people?"}, {"count": 19, "tags": [], "text": "Hi\n\nSure you can, i was planning on having an i18n section on some new tomcat \ndocumentation that i have been writing, so if you don't mind, I can use it on \nthat page too.\n\nsend it when you've figured it out :)\n\nAllistair.", "attachment_id": null, "id": 68033, "creation_time": "2004-12-07T09:56:47Z", "time": "2004-12-07T09:56:47Z", "creator": "allistair.crossley@qas.com", "bug_id": 32500, "is_private": false}, {"count": 20, "tags": [], "bug_id": 32500, "attachment_id": null, "id": 68063, "time": "2004-12-07T19:17:43Z", "creator": "wenxue_2004@yahoo.com", "creation_time": "2004-12-07T19:17:43Z", "is_private": false, "text": "Hi,\n   I may have the similar problem as discussed here.  I need to use jsp to \ndisplay some data in Japanese character from MS \nSQL server database.  I have already set the encoding in jsp to be:\n \n<%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" %> \n \nIf I use tomcat version 5.0.18, then the japanese character is \ndisplayed correctly.  However, if I use 5.0.28 or 5.5.4, the characters are \nsomething like \"???\".  If I right click the html page generated from jsp \non the above versions, I can see the encoding to be Western instead of \n\"UTF-8\" like what happened with 5.0.18.  Does anyone know what cause \nthis problem and if any configuration of Tomcat needs to be made.  Thank \nyou very much for your help.\n   Someone here that could not get the correct character set may want to test \ntomcat version 5.0.18.\n\n(In reply to comment #0)\n> After setting contentType to hebrew encoding in a JSP page, static text in the\n> page is correctly displayed according to the specified encoding, but\n> dynamically-generated text (<%= %> expression) does NOT get encoded to hebrew\n> and it appears as a sequence of question marks on the browser.\n> JSP is dispatched from a servlet that handles the request prior to generating\n> the response to the client.\n> Reproduced on both with IE-6 SP-1 and Firefox 1.0.\n> I attached is a JSP page to reproduce the problem (but it requires that a\n> database with hebrew content will be on the other hand, and that a servlet \nwill\n> assign a value to the variable before dispatching the call to the attached \nJSP).\n\n"}, {"count": 21, "tags": [], "creator": "allistair.crossley@qas.com", "attachment_id": null, "text": "have you checked that your database driver URL has the correct charset? is \nyour database encoding correct? which driver are you using?", "id": 68066, "time": "2004-12-07T19:43:15Z", "bug_id": 32500, "creation_time": "2004-12-07T19:43:15Z", "is_private": false}]
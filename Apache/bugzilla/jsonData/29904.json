[{"count": 0, "tags": [], "bug_id": 29904, "text": "Given the following pair of build files:\n\nbuild.xml\n<?xml version=\"1.0\"?>\n<project name=\"jasper problem\" default=\"jasper\">\n    <property name=\"tomcat\" location=\"jakarta-tomcat-5.0.25\"/>\n    <property name=\"tomcat.bin\" location=\"${tomcat}/bin\"/>\n    <property name=\"tomcat.lib\" location=\"${tomcat}/common/lib\"/>\n    <path id=\"jasper.path\">\n        <fileset dir=\"${tomcat.lib}\">\n            <include name=\"*.jar\"/>\n        </fileset>\n        <fileset dir=\"${tomcat.bin}\">\n            <include name=\"*.jar\"/>\n        </fileset>\n    </path>\n    <target name=\"jasper\">\n        <taskdef classname=\"org.apache.jasper.JspC\" name=\"jasper2\">\n            <classpath refid=\"jasper.path\"/>\n        </taskdef>\n        <jasper2 uriroot=\"war\" outputDir=\"build\" />\n    </target>\n</project>\n\nbuildall.xml\n<?xml version=\"1.0\"?>\n<project name=\"master build\" default=\"jasper\">\n    <target name=\"jasper\">\n        <ant dir=\".\" target=\"jasper\" antfile=\"build.xml\"/>\n        <ant dir=\".\" target=\"jasper\" antfile=\"build.xml\"/>\n    </target>\n</project>\n\n\n\"ant -f build.xml\" succeeds, but \"ant -f buildall.xml\" fails, reporting\nbuildall.xml:5: The following error occurred while executing this line:\njava.lang.ExceptionInInitializerError\n\nIt is possible to work around this by 1. defining the taskdef in\nthe buildall.xml file and specifying a loaderref, 2. passing the\ncreated reference in the <ant> tasks, and 3. using the same reference\nas the loaderref in the build.xml file.  It's a bit obtuse, though.\n\nThe problem exists also with ant 1.6.1 and jasper 5.0.19, and does\nnot appear to be particular to OSX as I can reproduce it on Solaris.\n\nThe failure, with the -v options follows:\n$ ant -v -f buildall.xml\nApache Ant version 1.6.2beta1 compiled on July 2 2004\nBuildfile: buildall.xml\nDetected Java version: 1.4 in:\n/System/Library/Frameworks/JavaVM.framework/Versions/1.4.2/Home\nDetected OS: Mac OS X\nparsing buildfile /Users/andy/work/bugs/ant-tomcat/buildall.xml with URI =\nfile:///Users/andy/work/bugs/ant-tomcat/buildall.xml\nProject base dir set to: /Users/andy/work/bugs/ant-tomcat\nBuild sequence for target `jasper' is [jasper]\nComplete build sequence is [jasper, ]\n\njasper:\nProject base dir set to: /Users/andy/work/bugs/ant-tomcat\n      [ant] calling target jasper in build file\n/Users/andy/work/bugs/ant-tomcat/build.xml\nparsing buildfile /Users/andy/work/bugs/ant-tomcat/build.xml with URI =\nfile:///Users/andy/work/bugs/ant-tomcat/build.xml\nProject base dir set to: /Users/andy/work/bugs/ant-tomcat\n      [ant] Entering /Users/andy/work/bugs/ant-tomcat/build.xml...\nBuild sequence for target `jasper' is [jasper]\nComplete build sequence is [jasper, ]\n\njasper:\n      [ant] Exiting /Users/andy/work/bugs/ant-tomcat/build.xml.\nProject base dir set to: /Users/andy/work/bugs/ant-tomcat\n      [ant] calling target jasper in build file\n/Users/andy/work/bugs/ant-tomcat/build.xml\nparsing buildfile /Users/andy/work/bugs/ant-tomcat/build.xml with URI =\nfile:///Users/andy/work/bugs/ant-tomcat/build.xml\nProject base dir set to: /Users/andy/work/bugs/ant-tomcat\n      [ant] Entering /Users/andy/work/bugs/ant-tomcat/build.xml...\nBuild sequence for target `jasper' is [jasper]\nComplete build sequence is [jasper, ]\n\njasper:\n      [ant] Exiting /Users/andy/work/bugs/ant-tomcat/build.xml.\n\nBUILD FAILED\n/Users/andy/work/bugs/ant-tomcat/buildall.xml:5: The following error occurred\nwhile executing this line:\njava.lang.ExceptionInInitializerError\n        at\norg.apache.tools.ant.ProjectHelper.addLocationToBuildException(ProjectHelper.java:539)\n        at org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:388)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at org.apache.tools.ant.Task.perform(Task.java:364)\n        at org.apache.tools.ant.Target.execute(Target.java:341)\n        at org.apache.tools.ant.Target.performTasks(Target.java:369)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1062)\n        at org.apache.tools.ant.Main.runBuild(Main.java:673)\n        at org.apache.tools.ant.Main.startAnt(Main.java:188)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:196)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:55)\nCaused by: java.lang.ExceptionInInitializerError\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1223)\n        at org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:386)\n        ... 10 more\nCaused by: java.lang.ExceptionInInitializerError\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Class.java:219)\n        at org.apache.tools.ant.taskdefs.Definer.addDefinition(Definer.java:457)\n        at org.apache.tools.ant.taskdefs.Definer.execute(Definer.java:183)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at org.apache.tools.ant.Task.perform(Task.java:364)\n        at org.apache.tools.ant.Target.execute(Target.java:341)\n        at org.apache.tools.ant.Target.performTasks(Target.java:369)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n        ... 11 more\nCaused by: org.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException: Class\norg.apache.commons.logging.impl.Jdk14Logger does not implement Log\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactoryImpl.java:532)\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactoryImpl.java:272)\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactoryImpl.java:246)\n        at org.apache.commons.logging.LogFactory.getLog(LogFactory.java:395)\n        at org.apache.jasper.JspC.<clinit>(JspC.java:90)\n        ... 20 more\nCaused by: org.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException: Class\norg.apache.commons.logging.impl.Jdk14Logger does not implement Log\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor(LogFactoryImpl.java:416)\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactoryImpl.java:525)\n        ... 24 more\nCaused by: org.apache.commons.logging.LogConfigurationException: Class\norg.apache.commons.logging.impl.Jdk14Logger does not implement Log\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor(LogFactoryImpl.java:412)\n        ... 25 more\n--- Nested Exception ---\njava.lang.ExceptionInInitializerError\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1223)\n        at org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:386)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at org.apache.tools.ant.Task.perform(Task.java:364)\n        at org.apache.tools.ant.Target.execute(Target.java:341)\n        at org.apache.tools.ant.Target.performTasks(Target.java:369)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1062)\n        at org.apache.tools.ant.Main.runBuild(Main.java:673)\n        at org.apache.tools.ant.Main.startAnt(Main.java:188)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:196)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:55)\nCaused by: java.lang.ExceptionInInitializerError\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Class.java:219)\n        at org.apache.tools.ant.taskdefs.Definer.addDefinition(Definer.java:457)\n        at org.apache.tools.ant.taskdefs.Definer.execute(Definer.java:183)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at org.apache.tools.ant.Task.perform(Task.java:364)\n        at org.apache.tools.ant.Target.execute(Target.java:341)\n        at org.apache.tools.ant.Target.performTasks(Target.java:369)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n        ... 11 more\nCaused by: org.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException: Class\norg.apache.commons.logging.impl.Jdk14Logger does not implement Log\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactoryImpl.java:532)\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactoryImpl.java:272)\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactoryImpl.java:246)\n        at org.apache.commons.logging.LogFactory.getLog(LogFactory.java:395)\n        at org.apache.jasper.JspC.<clinit>(JspC.java:90)\n        ... 20 more\nCaused by: org.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException: Class\norg.apache.commons.logging.impl.Jdk14Logger does not implement Log\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor(LogFactoryImpl.java:416)\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactoryImpl.java:525)\n        ... 24 more\nCaused by: org.apache.commons.logging.LogConfigurationException: Class\norg.apache.commons.logging.impl.Jdk14Logger does not implement Log\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor(LogFactoryImpl.java:412)\n        ... 25 more\n--- Nested Exception ---\njava.lang.ExceptionInInitializerError\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Class.java:219)\n        at org.apache.tools.ant.taskdefs.Definer.addDefinition(Definer.java:457)\n        at org.apache.tools.ant.taskdefs.Definer.execute(Definer.java:183)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at org.apache.tools.ant.Task.perform(Task.java:364)\n        at org.apache.tools.ant.Target.execute(Target.java:341)\n        at org.apache.tools.ant.Target.performTasks(Target.java:369)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n        at org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:386)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at org.apache.tools.ant.Task.perform(Task.java:364)\n        at org.apache.tools.ant.Target.execute(Target.java:341)\n        at org.apache.tools.ant.Target.performTasks(Target.java:369)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1062)\n        at org.apache.tools.ant.Main.runBuild(Main.java:673)\n        at org.apache.tools.ant.Main.startAnt(Main.java:188)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:196)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:55)\nCaused by: org.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException: Class\norg.apache.commons.logging.impl.Jdk14Logger does not implement Log\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactoryImpl.java:532)\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactoryImpl.java:272)\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactoryImpl.java:246)\n        at org.apache.commons.logging.LogFactory.getLog(LogFactory.java:395)\n        at org.apache.jasper.JspC.<clinit>(JspC.java:90)\n        ... 20 more\nCaused by: org.apache.commons.logging.LogConfigurationException:\norg.apache.commons.logging.LogConfigurationException: Class\norg.apache.commons.logging.impl.Jdk14Logger does not implement Log\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor(LogFactoryImpl.java:416)\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactoryImpl.java:525)\n        ... 24 more\nCaused by: org.apache.commons.logging.LogConfigurationException: Class\norg.apache.commons.logging.impl.Jdk14Logger does not implement Log\n        at\norg.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor(LogFactoryImpl.java:412)\n        ... 25 more\n\nTotal time: 4 seconds", "id": 60122, "time": "2004-07-03T23:40:52Z", "creator": "apache@afyfe.com", "creation_time": "2004-07-03T23:40:52Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 29904, "text": "Can you provide an example of the workaround?", "id": 60635, "time": "2004-07-15T11:49:44Z", "creator": "matt.youill@betfair.com", "creation_time": "2004-07-15T11:49:44Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 29904, "attachment_id": 12133, "text": "Created attachment 12133\nan example of a work around", "id": 60728, "time": "2004-07-17T00:21:21Z", "creator": "apache@afyfe.com", "creation_time": "2004-07-17T00:21:21Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 29904, "attachment_id": null, "text": "Hello Andy,\nwhat you are saying boils down to :\n\"the use of the loaderRef attribute is compulsory in order to be able to use the\ntomcat jasper task multiple times in one run of ant.\"\n\n<taskdef classname=\"org.apache.jasper.JspC\" name=\"jasper2\" loaderRef=\"jasper\">\n            <classpath refid=\"jasper.path\"/>\n</taskdef>\n", "id": 60732, "time": "2004-07-17T06:45:50Z", "creator": "antoine@apache.org", "creation_time": "2004-07-17T06:45:50Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 29904, "attachment_id": null, "text": "I am saying a more than that.  Not only is the loaderRef compulsory, but all must refer to the _same_ \nloader reference.  In the zip'd example, if you change the \"bad\" target in buildall.xml to:\n    <target name=\"bad\">\n        <ant dir=\".\" target=\"good\" antfile=\"build.xml\"/>\n        <ant dir=\".\" target=\"good\" antfile=\"build.xml\"/>\n    </target>\n\"ant -f buildall.xml bad\" will still fail, even though the tomcat taskdef uses loaderRef.\n\nSharing a single loader reference among a hierarchy of build.xml files that call one another is at best \nawkward.", "id": 60757, "time": "2004-07-17T21:37:48Z", "creator": "apache@afyfe.com", "creation_time": "2004-07-17T21:37:48Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 29904, "text": "I tried ant 1.6.2 and tomcat 5.0.27.  The behaviour is still the same, but the \"caused by\" error message  \nin the \"ant -v\" output is now different:\n\nCaused by: org.apache.commons.logging.LogConfigurationException: Invalid class loader hierarchy.  \nYou have more than one version of 'org.apache.commons.logging.Log' visible, which is not allowed.\n", "id": 60758, "time": "2004-07-17T22:02:23Z", "creator": "apache@afyfe.com", "creation_time": "2004-07-17T22:02:23Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 29904, "text": "Updating version to 5.0.27 and changing OS to All.\n\nSo what do you suggest as the fix?  Have Jasper not use Commons-Logging?  Or \nperhaps this is a Commons-Logging bug?", "id": 63978, "time": "2004-09-21T13:59:12Z", "creator": "yoavs@computer.org", "creation_time": "2004-09-21T13:59:12Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "text": "*Do* you have more than one version of org.apache.commons.logging.Log on the \nclasspath?", "id": 64634, "time": "2004-10-05T16:11:18Z", "bug_id": 29904, "creation_time": "2004-10-05T16:11:18Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 29904, "text": "No, I don't believe there is more than one copy of Log in the classpath.  I have no global classpath.  The \nclass does not appear to be part of ant.  I modified the build file to list only the required jasper jar files. \nThey are, from common/lib, jasper-compiler, jasper-runtime, servlet-api, jsp-api, commons-el and \nfrom bin, commons-logging-api.  Only the last contains the Log class, and without it, the build fails \nbecause org.apache.commons.logging.LogFactory is missing.  The behavior isn't changed by \nexplicitly including the 6 jar files in the build.xml file, rather than including \"*.jar\".", "id": 64638, "time": "2004-10-05T18:47:06Z", "creator": "apache@afyfe.com", "creation_time": "2004-10-05T18:47:06Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 29904, "attachment_id": null, "id": 67343, "time": "2004-11-22T15:55:30Z", "creator": "yoavs@computer.org", "creation_time": "2004-11-22T15:55:30Z", "is_private": false, "text": "I believe we've got this now ;)\n\n*** This bug has been marked as a duplicate of 32330 ***"}]
[{"attachment_id": null, "tags": [], "bug_id": 17780, "text": "Below is the build file:\n\n<?xml version=\"1.0\"?>\n\n<project name=\"Test updating jar files\" basedir=\".\" default=\"jar.test\">\n\n    <!-- This target jars up *.class files in current directory into test.jar -->\n    <target name=\"jar.test\">\n        <jar destfile=\"test.jar\" basedir=\".\"\n             includes=\"*.class\"\n        />\n        <!-- Update JAR manifest to include dependency libraries -->\n        <jar destfile=\"test.jar\" update=\"true\">\n            <manifest>\n               <attribute name=\"Class-Path\" value=\"Some jar files\"/>\n            </manifest>\n        </jar>\n    </target>\n\n</project>\n\nI tested this build file with both 1.5.1 and 1.5.2.  1.5.1 worked perfect, the\ntest.jar contains the class files along with the manifest file.  However, when\nbuilt with 1.5.2, the test.jar contains only the manifest file.  It seems the\nsecond task overrides the file even though the attribute \"update\" is set to true.", "count": 0, "id": 32677, "time": "2003-03-07T17:43:45Z", "creator": "junlify@yahoo.com", "creation_time": "2003-03-07T17:43:45Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "How do you verify that the jar does not contain the class files?\n\nIf you used WinZIP, please try \"jar tf test.jar\" instead.  If things work, you can\nmark this bug as duplicate of bug 17648.", "id": 32784, "time": "2003-03-10T08:02:09Z", "bug_id": 17780, "creation_time": "2003-03-10T08:02:09Z", "is_private": false}, {"count": 2, "tags": [], "creator": "bjenkins@dynamicsoft.com", "text": "I'm seeing this problem as well.\n\nMy application cannot access the missing files, so I do not think its a WinZip \nissue.", "id": 32875, "time": "2003-03-10T20:26:41Z", "bug_id": 17780, "creation_time": "2003-03-10T20:26:41Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 17780, "attachment_id": null, "text": "I used \"tar tf test.jar\" to check the existence of the files.  It was nothing to\ndo with zip.\n\nThe tests were run on Red Hat Linux 7.3 on i386 using Sun's JDK 1.3.1_05.", "id": 32876, "time": "2003-03-10T20:55:12Z", "creator": "junlify@yahoo.com", "creation_time": "2003-03-10T20:55:12Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 17780, "text": "I believe these lines should be removed from Zip.java#executeMain\n\n\n            // quick exit if the target is up to date\n\n\n            // can also handle empty archives\n\n\n            if (isEmpty(addThem)) {\n\n\n                return;\n\n\n            }\n\n\nThis quick exit prevents the old zip entries from being copied from the old \narchive to the new when one is in update mode and that there is no file to add.\n", "id": 32882, "time": "2003-03-10T21:16:04Z", "creator": "levylambert@tiscali-dsl.de", "creation_time": "2003-03-10T21:16:04Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 17780, "text": "Nope, that doesn't fix it.\n\nI added some debug to my local src copy of 1.5.2 and I see zipFile(InputStream) \nbeing called for all of the files that were in the original jar (see below).  \nIt looks like the original files *should* be getting jar'd up, but I can't \nfigure out where the problem is.\n\n      [jar] found original file META-INF/MYALIAS.DSA\n      [jar] found original file META-INF/MYALIAS.SF\n      [jar] found original file license.txt\n      [jar] found original file version_info\n      [jar] Adding original files\n      [jar] Entering addResources()\n      [jar] prefix=\"\"\n      [jar] dealingWithFiles=false\n      [jar] name=META-INF/MYALIAS.DSA\n      [jar] Entering addParentDirs()\n      [jar] Leaving addParentDirs()\n      [jar] ze=META-INF/MYALIAS.DSA\n      [jar] Entering zipFile(java.util.zip.ZipFile$1@76e8a7, \norg.apache.tools.zip.ZipOutputStream@1aed5f9, META-INF/MYALIAS.DSA, \n1047331542000, C:\\dynamicsoft\\re\\lib\\dynamicsoft\\zip803692068.tmp, 16877)\n      [jar] adding entry META-INF/MYALIAS.DSA\n      [jar] Leaving zipFile()\n      [jar] name=META-INF/MYALIAS.SF\n      [jar] Entering addParentDirs()\n      [jar] Leaving addParentDirs()\n      [jar] ze=META-INF/MYALIAS.SF\n      [jar] Entering zipFile(java.util.zip.ZipFile$1@a45536, \norg.apache.tools.zip.ZipOutputStream@1aed5f9, META-INF/MYALIAS.SF, \n1047331542000, C:\\dynamicsoft\\re\\lib\\dynamicsoft\\zip803692068.tmp, 16877)\n      [jar] adding entry META-INF/MYALIAS.SF\n      [jar] Leaving zipFile()\n      [jar] name=license.txt\n      [jar] Entering addParentDirs()\n      [jar] Leaving addParentDirs()\n      [jar] ze=license.txt\n      [jar] Entering zipFile(java.util.zip.ZipFile$1@d66426, \norg.apache.tools.zip.ZipOutputStream@1aed5f9, license.txt, 1045261202000, \nC:\\dynamicsoft\\re\\lib\\dynamicsoft\\zip803692068.tmp, 16877)\n      [jar] adding entry license.txt\n      [jar] Leaving zipFile()\n      [jar] name=version_info\n      [jar] Entering addParentDirs()\n      [jar] Leaving addParentDirs()\n      [jar] ze=version_info\n      [jar] Entering zipFile(java.util.zip.ZipFile$1@1490eb5, \norg.apache.tools.zip.ZipOutputStream@1aed5f9, version_info, 1047331542000, \nC:\\dynamicsoft\\re\\lib\\dynamicsoft\\zip803692068.tmp, 16877)\n      [jar] adding entry version_info\n      [jar] Leaving zipFile()\n      [jar] Leaving addResources()\n      [jar] Entering finalizeZipOutputStream()\n      [jar] Leaving finalizeZipOutputStream()\n      [jar] Leaving execute()", "id": 32885, "time": "2003-03-10T21:55:14Z", "creator": "bjenkins@dynamicsoft.com", "creation_time": "2003-03-10T21:55:14Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 17780, "attachment_id": 5269, "text": "Created attachment 5269\npatch text file plus new java source", "id": 32972, "time": "2003-03-11T17:17:01Z", "creator": "levylambert@tiscali-dsl.de", "creation_time": "2003-03-11T17:17:01Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "bodewig@apache.org", "text": "Ben, I'm quite sure that your case is a duplicate of bug 17648.\n\nAnyway, both bugs are supposed to be fixed now.  Could you please replace ant.jar\nfrom Ant 1.5.2 with this one <http://cvs.apache.org/~bodewig/ant.jar> and\nverify that it fixes all problems you have encountered?\n", "count": 7, "id": 33020, "time": "2003-03-12T11:31:59Z", "bug_id": 17780, "creation_time": "2003-03-12T11:31:59Z", "is_private": false}, {"count": 8, "tags": [], "creator": "bjenkins@dynamicsoft.com", "text": "Stefan,\n\nThe new ant.jar you provided fixes all my problems.\n\nThank you for your quick response!", "id": 33034, "time": "2003-03-12T14:11:07Z", "bug_id": 17780, "creation_time": "2003-03-12T14:11:07Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 17780, "attachment_id": null, "text": "*** Bug 18207 has been marked as a duplicate of this bug. ***", "id": 33590, "time": "2003-03-21T07:11:35Z", "creator": "bodewig@apache.org", "creation_time": "2003-03-21T07:11:35Z", "is_private": false}, {"count": 10, "attachment_id": null, "bug_id": 17780, "text": "What is the point of changing the severity of a \"fixed\" bug?", "id": 34244, "time": "2003-04-01T14:48:45Z", "creator": "bodewig@apache.org", "creation_time": "2003-04-01T14:48:45Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "text": "I'm trying to implement a mix of CGI and servlet technology, and two of the\nCGI's I need to use output PNG's.  The problem is, when they are served through\nthe CgiServlet, the images come through corrupted on all the browsers that I\nhave tried (mozilla, explorer, etc).  On the other hand, if I run the cgi by\nhand and trim off the HTTP header, I can view the PNGs just fine.  CGI output vs\ncommand line output differs by CGI output being 1 byte longer, and many of the\nnon ascii characters seem to be escaped differently, but that may just be due to\nHTTP encoding?  I can email examples of the raw vs CGI output to anyone who\nwants to see it.  Is there another viable way to implement CGI's under Tomcat? \nI don't want to serve them via Apache directly as I need them to be restricted\nby session.  Thanks,\n  Lucas.", "attachment_id": null, "id": 9377, "creator": "ladamski@yahoo.com", "time": "2002-01-05T15:21:05Z", "bug_id": 5704, "creation_time": "2002-01-05T15:21:05Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 5704, "attachment_id": null, "id": 9427, "time": "2002-01-07T13:07:15Z", "creator": "amyroh@apache.org", "creation_time": "2002-01-07T13:07:15Z", "is_private": false, "text": "Can you send me your CGI examples that generate this image corruption problem?  \nI can't seem to duplicate the problem.  Thanks."}, {"count": 2, "tags": [], "bug_id": 5704, "text": "I think this is due to the Reader that the CGIServlet uses- on big-endian\nmachines (SPARC specifically is where I was this problem) it might be peforming\nsome sort of translation on the input that screws up binary data like jpegs. \nWhen I wrote a standalone CGIServlet, I instead used:\n\nBufferedInputStream input = new BufferedInputStream(p.getInputStream());\n\nand it worked fine.  My 2 cents.", "id": 26339, "time": "2002-11-15T04:22:41Z", "creator": "ladamski@yahoo.com", "creation_time": "2002-11-15T04:22:41Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 5704, "attachment_id": null, "text": "I experience the same problem when serving pdfs. When I run the cgi standalone I\nget a valid viewable pdf (after stripping the headers), when it is served by the\nCGIServlet, *some* bytes in the output are replaced by question marks. Only\nbytes in the range [128; 160[ seem to be affected. Coincidentally, this is the\nundefined range of the iso-8859-? charsets.\n\nAs the CGIServlet uses InputStreamReaders and OutputStreamWriters to handle the\ncontent, character conversions take place that replace any untranslateable\ncharacters into question marks.\n\nThis \"feature\" is a major annoyance because it effectively prevents me from\nserving arbitrary binary content over cgis.", "id": 33611, "time": "2003-03-21T17:39:07Z", "creator": "leo.savernik@vai.at", "creation_time": "2003-03-21T17:39:07Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 5704, "attachment_id": 5476, "text": "Created attachment 5476\nProposed fix", "id": 33675, "time": "2003-03-24T09:39:32Z", "creator": "leo.savernik@vai.at", "creation_time": "2003-03-24T09:39:32Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 5704, "attachment_id": null, "id": 33676, "time": "2003-03-24T09:47:17Z", "creator": "leo.savernik@vai.at", "creation_time": "2003-03-24T09:47:17Z", "is_private": false, "text": "As I needed this bug fixed very urgently, I fixed it myself. See attachment 5476.\n\nIts changes are quite simple. They merely replace the InputStreamReader and\nOutputStreamWriter with a custom reader and writer that do absolutely *no*\nconversion on input and output streams.\n\nI hope that this patch will be included in later versions of tomcat, or that at\nleast this bug is fixed in another sane way.\n\nThe attached diff is created against tomcat 4.1.18\n"}, {"count": 6, "tags": [], "text": "*** Bug 19704 has been marked as a duplicate of this bug. ***", "is_private": false, "id": 51971, "creation_time": "2004-02-09T01:53:02Z", "time": "2004-02-09T01:53:02Z", "creator": "funkman@joedog.org", "bug_id": 5704, "attachment_id": null}, {"count": 7, "tags": [], "text": "This bug has recently been fixed (in a slightly different manner) for both TC4 \nand TC5.", "attachment_id": null, "id": 59261, "creator": "markt@apache.org", "time": "2004-06-15T23:39:59Z", "bug_id": 5704, "creation_time": "2004-06-15T23:39:59Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 5704, "text": "(In reply to comment #7)\n> This bug has recently been fixed (in a slightly different manner) for both TC4 \n> and TC5.\n\nI am running into this problem with tomcat 4.1.31. Did the bug fix make this\nrelease or am I doing something wrong, e.g. init parameter not set?", "id": 67549, "time": "2004-11-29T19:01:00Z", "creator": "robert.berman@peregrine.com", "creation_time": "2004-11-29T19:01:00Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 5704, "text": "The fix was included in the TC4.1.31 release (and I am updating the version to \nreflect this).\n\nYou will need to make sure your cgi script sets the content-type header \ncorrectly. The test is that there must be a content-type header that does not \nstart with \"text\" for the content to be treated as binary.\n\nUntil we are sure this is a bug, please continue this discussion on the tomcat-\nuser mailing list.", "id": 67572, "time": "2004-11-29T20:50:42Z", "creator": "markt@apache.org", "creation_time": "2004-11-29T20:50:42Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 39401, "attachment_id": null, "id": 88469, "time": "2006-04-25T12:26:43Z", "creator": "bugzilla@amadis.freeserve.co.uk", "creation_time": "2006-04-25T12:26:43Z", "is_private": false, "text": "True 16-bit COM files aren't being executed properly in 2.0.55/Win32 in\n/CGI-BIN/  Even with stub batch file wrappers.  Platform=XP Home 2002/SP2\nVersion 5.1.2600\n\nStub batch wrappers for the same set of COM test files works just fine on the\n1.3.x (latest release)\n\nThe stub executes and any ECHO statments in the stub are honoured but no COM\noutput (stdout) appears on 2.0.55. This differs on 1.3.x where the same COM file\nwill be executed OK via stub. Log files show it is not being spawned and fails\nwith O/S error 5. The COM files are being identified as CGI by the looks of it\nan an attempt is made to spawn but this fails. This has been replicated on a\nwide variety of COM files.  The same COM files tested OK over a wide range of\nother webserver software e.g. Abyss, Xitami etc. Some execute COMs directly\nothers require BAT wrappers.\n\nApache 2.0.55 is running in XP as a service (local system account) and 1.3.34 as\nan application via a CMD shell\n\n=============== 2.0.55 Log abstract (com file wrapped in stub BAT wrapper) ==\n[Tue Apr 25 12:33:22 2006] [error] [client 127.0.0.1] (OS 5)Access is denied.  :\ncouldn't create child process: 720005: 23473032.COM\n[Tue Apr 25 12:33:23 2006] [error] [client 127.0.0.1] (OS 5)Access is denied.  :\ncouldn't spawn child process: C:/Program Files/Apache\nGroup/Apache2/cgi-bin/23473032.COM\n============\nBatch stub file:\n- - - - SNIP - - - -\n@echo off\nECHO running com file\nxxxxxx.com\nECHO done\n- - - - SNIP - - - -\n\nExecuting the COM file directly in /CGI-BIN/ even if it outputs the correct text\nheaders to stdout produces a 500 error with the same log entries in error.log\n\n=== Executing COM file directly from /CGI-BIN/ (2.0.55) ======\n[Tue Apr 25 12:52:09 2006] [error] [client 127.0.0.1] (OS 5)Access is denied.  :\ncouldn't create child process: 720005: 23473032.COM\n[Tue Apr 25 12:52:10 2006] [error] [client 127.0.0.1] (OS 5)Access is denied.  :\ncouldn't spawn child process: C:/Program Files/Apache\nGroup/Apache2/cgi-bin/23473032.COM\n===\n\nCOM files may be interpreted as plain text/html on user-downloading from non-CGI\nwebsite area (these files have such a content header within the first 3 bytes of\nthe start of file following a JMP instruction. I guess this may be a browser\nfault (Mozilla) but it could be that Apache is attempting a \"magic byte\"\nsignature ID which is upset by short executable byte count with following HTML\nheader content. I mention it in case it is of relevance in how the files are\ndetected and what method of spawning is chosen for them\n- - - SNIP - - -\n\u00e9=FContent-type: text/html\n\n<!-- \nConverted from M:\\BIN\\SRC\\03132657.txt\nBy HTML2BAT v1.03a (c) M Shaw - 25th April 2006\n- - - SNIP - - -\n\nExample bytes of sample COM file\n000000  E9 3D 46 43 6F 6E 74 65 - 6E 74 2D 74 79 70 65 3A  \u00da=FContent-type:\n000010  20 74 65 78 74 2F 68 74 - 6D 6C 0D 0A 0D 0A 3C 21   text/html&#9668;&#9496;&#9668;&#9496;<!\n000020  2D 2D 20 0A 43 6F 6E 76 - 65 72 74 65 64 20 66 72  -- &#9496;Converted fr\n000030  6F 6D 20 4D 3A 5C 42 49 - 4E 5C 53 52 43 5C 30 33  om M:\\BIN\\SRC\\03\n000040  31 33 32 36 35 37 2E 74 - 78 74 0D 0A 42 79 20 48  132657.txt&#9668;&#9496;By H\n000050  54 4D 4C 32 42 41 54 20 - 76 31 2E 30 33 61 20 28  TML2BAT v1.03a (\n000060  63 29 20 4D 20 53 68 61 - 77 20 2D 20 32 35 74 68  c) M Shaw - 25th\n000070  20 41 70 72 69 6C 20 32 - 30 30 36 0D 0A 57 65 62   April 2006&#9668;&#9496;Web\n\nDisassembled shows 3 byte JMP 4740 past the program's text contents.\n0D4E:0100 E93D46        JMP     4740\n0D4E:0103 43            INC     BX   <- data start (HTML header in this case)\n0D4E:0104 6F            DB      6F\n0D4E:0105 6E            DB      6E\n0D4E:0106 7465          JZ      016D\n0D4E:0108 6E            DB      6E\n0D4E:0109 742D          JZ      0138\n0D4E:010B 7479          JZ      0186\n0D4E:010D 7065          JO      0174\n\nAlthough this example is a custom generated COM file it appears to apply to COM\nfiles from other sources and some 16-bit EXE files (which appear to be COM files\nin reality) generated by certain compilers. Can produce examples on request.\n\nI've had a quick scan through the source code and in the Bugzilla reports as\nwell as searching in Google and I'm still stumped. There are a number of similar\nreports in Google to error 720005 (OS5).\n\nIt looks like the strategy for spawning COM files differs in Apache 2.0.x to\n1.3.x but 1.3.x works OK.\n\nSuitable/simple COM test files can be generated free by pasting text or HTML\ninto an online compiler at http://compiler.amadis.sytes.net and choosing the\n\"text compiler\". Alternatively early compilers such as Turbo Pascal or some\nassemblers."}, {"count": 1, "tags": [], "bug_id": 39401, "attachment_id": null, "id": 88470, "time": "2006-04-25T12:29:15Z", "creator": "bugzilla@amadis.freeserve.co.uk", "creation_time": "2006-04-25T12:29:15Z", "is_private": false, "text": "Oops. The stub bat ought to have been pasted in. I forgot the debug content\nheader. It was actually...\n- - - SNIP - - - \n@echo off\necho Content-type: text/html\necho.\necho Running xxxxx.com in Apache...\nxxxxx.com\necho.\necho DONE\n- - - SNIP - - - \n:)"}, {"count": 2, "tags": [], "text": "Can also confirm that the same fault diagnosis when running Apache 2.0.55 in\nApp- mode as Administrator(rather than service-mode) in XP home. The error\nindicates a rights issue but probably isn't due to the user account or method of\nrunning apache.", "is_private": false, "id": 88471, "creation_time": "2006-04-25T12:38:07Z", "time": "2006-04-25T12:38:07Z", "creator": "bugzilla@amadis.freeserve.co.uk", "bug_id": 39401, "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 39401, "is_private": false, "id": 112027, "time": "2007-12-21T21:06:46Z", "creator": "wrowe@apache.org", "creation_time": "2007-12-21T21:06:46Z", "tags": [], "text": "\n\n*** This bug has been marked as a duplicate of 32121 ***"}]
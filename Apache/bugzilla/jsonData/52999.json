[{"count": 0, "tags": [], "bug_id": 52999, "is_private": false, "id": 155354, "creation_time": "2012-03-28T21:31:42Z", "time": "2012-03-28T21:31:42Z", "creator": "knst.kolinko@gmail.com", "text": "This was reported on dev list [1]:\n\n> 2) org.apache.catalina.core.ContainerBase.fireContainerEvent;\n> That method contains critical section:\n>  synchronized (listeners) {\n>        list = listeners.toArray(list);\n> }\n>\n> Is is called pretty often with every put operation into request or\n> session map. That code in tomcat looks like a candidate for\n> CopyOnWriteArrayList\n>\n\nI confirm that I see fireContainerEvent() calls in many places in StandardSession.\n\nMoreover those are two nested loops:  a loop in StandardSession over array\nof context.getApplicationEventListeners(); x copying the list of container listeners inside into array in context.fireContainerEvent().\n\nI cannot confirm reported problem with request attributes - I do not see anything in the code that would send events from that access.\n\nIs it possible to solve it with a ReadWriteLock?\nOr it would be better to have a helper class that avoids copying the array over on every access (the said copy-on-write one)?\n\nI classify this as an enhancement request.\n\n[1] Thread \"Two performance problems (found during myfaces testing)\" on dev list, starting on 2012-03-08,\n- http://tomcat.markmail.org/thread/7bbvzmkvyvryvn44\n- http://marc.info/?t=133124021200002&r=1&w=2", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 52999, "is_private": false, "id": 159919, "creation_time": "2012-06-12T12:40:15Z", "time": "2012-06-12T12:40:15Z", "creator": "markt@apache.org", "text": "The OP may have meant context attributes rather than request attributes.\n\nI'm tempted to remove those container events for performance reasons.\n\nI'm in favour of the ReadWriteLock since there is less copying and therefore fewer objects and hence less GC.\n\nFixed in trunk and 7.0.x and will be included in 7.0.28 onwards.", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "kanobe@gmail.com", "attachment_id": null, "id": 110040, "time": "2007-10-31T07:51:41Z", "bug_id": 43751, "creation_time": "2007-10-31T07:51:41Z", "is_private": false, "text": "The HSSFSheet.autoSizeColumn method doesn't handle rotated text well. When a\ntext value is entered into a column cell and the cell style is set to rotate the\ntext 90 degrees, the width of the generated cell is still sized to the unrotated\nwidth of the text string. \n\nAdditionally, the HSSFSheet.autoSizeColumn method doesn't handle numeric values\nwith more than 3 fractional decimal digits properly (for example the value\n3.45334). For such values the generated cell is too narrow. It seems that for\nExcel numeric values using the General format the method formats the number\nusing a java DecimalFormat object with the default constructor, which seems to\ndefault to a pattern that only outputs three fractional digits (so 3.45334 would\nbe output as 3.453)."}, {"count": 1, "tags": [], "text": "Created attachment 21066\nJava program that demonstrates the issues\n\nThis is a Java program that demonstrates the issues described in the bug\nreport. It outputs a series of cells in a single row, text then numbers, each\nrotated. The output file is named 'rotated_columns.xls'.", "is_private": false, "bug_id": 43751, "id": 110041, "time": "2007-10-31T07:53:55Z", "creator": "kanobe@gmail.com", "creation_time": "2007-10-31T07:53:55Z", "attachment_id": 21066}, {"count": 2, "tags": [], "creator": "kanobe@gmail.com", "text": "Created attachment 21067\nProposed fix to solve the two issues in the bug report\n\nHere is an updated version of HSSFSheet.java (org.apache.poi.hssf.usermodel)\nthat fixes the two issues. If you would like a patch instead, let me know. \n\nThe implemented fix solves the rotated text problem by performing some\ntransformations on the text before determining it's width:\n\n1. First, the text is scaled vertically by a multiple of the font \"leading\"\nvalue so that text rotated close to 90 degrees will have some whitespace around\nit in the final output\n\n2. Second, the text is rotated by the rotation specified in the cell layout\n\nAfter these transformations the new width is determined from the text bounding\nbox.\n\nThe fix solves the numerical value problem by no longer using DecimalFormat to\nformat numerical cells that have the Excel \"General\" format, but instead using\na simple string conversion.", "id": 110044, "time": "2007-10-31T08:02:00Z", "bug_id": 43751, "creation_time": "2007-10-31T08:02:00Z", "is_private": false, "attachment_id": 21067}, {"count": 3, "tags": [], "creator": "kanobe@gmail.com", "attachment_id": 21068, "text": "Created attachment 21068\nautoSizeColumn before fix\n\nThis is the output of the AutosizeRotatedTextColumns program BEFORE the\nproposed fix.", "id": 110045, "time": "2007-10-31T08:04:04Z", "bug_id": 43751, "creation_time": "2007-10-31T08:04:04Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 43751, "attachment_id": 21069, "id": 110046, "time": "2007-10-31T08:05:01Z", "creator": "kanobe@gmail.com", "creation_time": "2007-10-31T08:05:01Z", "is_private": false, "text": "Created attachment 21069\nSample output after implementing the fix\n\nThis is the output of the AutosizeRotatedTextColumns program AFTER the proposed\nfix."}, {"count": 5, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "text": "Very cool. Thanks for the patch.\nI wrote autoSizeColumn without text rotation in mind but your fix extends it in\na very elegant way. \n\nYegor", "id": 110105, "time": "2007-11-01T04:24:04Z", "bug_id": 43751, "creation_time": "2007-11-01T04:24:04Z", "is_private": false}, {"count": 6, "tags": [], "creator": "yegor@dinom.ru", "text": "patch applied.\n\nThanks,\nYegor", "id": 110216, "time": "2007-11-03T12:39:57Z", "bug_id": 43751, "creation_time": "2007-11-03T12:39:57Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "mike.t.gallagher@supervalu.com", "text": "The uptodate task now assumes that the path specified by the mapper\n\"to\" attribute is relative to the uptodate \"srcfiles\" attribute. This\nbug has been introduced in version 1.4, 1.3 did not have this\nproblem. This makes it impossible to use an absolute path for the\nmapper \"to\" attribute. A workaround may be possible by specifying the\npath for the \"to\" attribute in terms of the \"srcfiles\" attribute path.\nThis workaround would be non-elegant to put it mildly.\n\nIn order to reproduce the problem, copy the build.xml file (below) to\na temporary directory (I used c:\\tmp). Then create 2 files in the temp\ndirectory (uptodateTest.src, uptodateTest.mapto).  \nThen run 'ant -version'.\n\nBelow is a short build.xml file followed by a transcript of how I\nreproduced the problem. My shell environment is Cygwin under NT, but\nis should be easy enough to reproduce under any environment.\n\nThe code containing the bug is in the scanDir method (line 185) in \norg.apache.tools.ant.taskdefs.UpToDate.java \n\n-- mike g.\n\n<!-- begin build.xml -->\n\n<project name=\"mapper-test\" default=\"uptodateTest\">\n\n<property name=\"tmp\" value=\"c:/tmp\"/>\n\n<target name=\"uptodateTest\">\n  <uptodate property=\"isUpToDate\">\n    <srcfiles dir=\"${tmp}\" includes=\"uptodateTest.src\"/>\n    <mapper type=\"merge\" to=\"${tmp}/uptodateTest.mapto\"/>\n  </uptodate>\n  <echo message=\"isUpToDate = ${isUpToDate}\"/>\n</target>\n\n</project>\n\n<!-- begin end.xml -->\n\n<!-- begin transcript of how to reproduce -->\n\n% pwd\n/tmp\n% touch uptodateTest.src\n% touch uptodateTest.mapto\n% cp ~/ant/build.xml .\n% ant -verbose\nAnt version 1.4 compiled on September 3 2001\nBuildfile: build.xml\nDetected Java version: 1.2 in: c:\\jdk1.2.2\\jre\nDetected OS: Windows NT\nparsing buildfile c:\\tmp\\build.xml with URI = file:c:/tmp/build.xml\nProject base dir set to: C:\\tmp\nBuild sequence for target `uptodateTest' is [uptodateTest]\nComplete build sequence is [uptodateTest]\n\nuptodateTest:\n [uptodate] uptodateTest.src added as C:\\tmp\\c:\\tmp\\uptodateTest.mapto doesn't e\nxist.\nProperty ${isUpToDate} has not been set\n     [echo] isUpToDate = ${isUpToDate}\n\nBUILD SUCCESSFUL\n\n<!-- end transcript of how to reproduce -->", "id": 5420, "time": "2001-09-12T08:17:23Z", "bug_id": 3568, "creation_time": "2001-09-12T08:17:23Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 3568, "attachment_id": null, "text": "This seems to be intended.  Stefan, one of our commiters had made the change \nafter 1.3 was released to address a bug (http://marc.theaimsgroup.com/?l=ant-\ndev&m=99082305114430&w=2).  The fix that was provided is at \nhttp://marc.theaimsgroup.com/?l=ant-dev&m=99493415229813&w=2\n\nStefan, please comment on this issue and close it if it isn't gonna be fixed or \nelse please accept it as an issue so that one of us can take a look at it.  \n\nThanks,\nMagesh\n", "id": 5498, "time": "2001-09-13T17:13:57Z", "creator": "umagesh@rediffmail.com", "creation_time": "2001-09-13T17:13:57Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 3568, "text": "I see what you mean.\n\nWe have two different use cases here:\n\n(1) Target files must be specified by relative paths to the source files - we\nwill probably have multiple target-directories, on per <srcfiles>.  This is \nwhat has been \"solved\" by the patch I applied.\n\n(2) Target files must be specified by absolute paths - this has been destroyed.\n\nDo you have an idea of how to solve both cases at the same time?\n\nMaybe we could introduce a new targetdir attribute and apply the normal Ant\nmagic to it (i.e. it is either an absolute path or a path relative to basedir).\nIn case (1) above, this would be ommitted in case (2) your mapper's to pattern\nwould generate paths relative to a given absolute targetdir.\n\nWould that work for you?", "id": 5515, "time": "2001-09-13T22:42:51Z", "creator": "bodewig@apache.org", "creation_time": "2001-09-13T22:42:51Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "umagesh@rediffmail.com", "attachment_id": null, "text": "Stefan:\nThere is no need to introduce a new attribute.  The problem actually lies in \nSourceFileScanner as evidenced by the line \n\n[uptodate] uptodateTest.src added as C:\\tmp\\c:\\tmp\\uptodateTest.mapto doesn't \nexist.\n\nThe path is prepended even if the target already contains the canonical (or \nabsolute) path.\n\nI will submit a patch in a few seconds that resolves this 'real' issue, thus \naddressing this bug too.\n\nThanks,\nMagesh", "id": 5543, "time": "2001-09-14T07:34:26Z", "bug_id": 3568, "creation_time": "2001-09-14T07:34:26Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 3568, "attachment_id": 538, "text": "Created attachment 538\n[PATCH] Target File checked to see if it already represents an absolute path", "id": 5544, "time": "2001-09-14T07:35:59Z", "creator": "umagesh@rediffmail.com", "creation_time": "2001-09-14T07:35:59Z", "is_private": false}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 6089, "time": "2001-09-27T03:12:00Z", "bug_id": 3568, "creation_time": "2001-09-27T03:12:00Z", "is_private": false, "text": "fixed for Ant 1.4.1"}]
[{"count": 0, "tags": [], "bug_id": 60556, "attachment_id": 34596, "is_private": false, "id": 195880, "time": "2017-01-05T16:32:45Z", "creator": "ismaelgomezs@gmail.com", "creation_time": "2017-01-05T16:32:45Z", "text": "Created attachment 34596\nFile which the code fails\n\nI'm extracting the text from a WordExtractor class (apache POI), but I have an error for some .doc files. Here the code:\n\n\"\nimport org.apache.poi.xwpf.extractor.XWPFWordExtractor;\nimport org.apache.poi.xwpf.usermodel.XWPFDocument;\nimport org.apache.poi.hwpf.HWPFDocument;\nimport org.apache.poi.hwpf.extractor.WordExtractor;\nimport org.apache.poi.poifs.filesystem.OfficeXmlFileException;\n\npublic class [class name] \n{ \n\tpublic static void main(String... args) throws FileNotFoundException, IOException, NullPointerException, OfficeXmlFileException {\n\t   \n\t\tFile[] files = new File(\"[input path]\").listFiles();    \n\t\tshowFiles(files);\n\t}\n\t\n\tpublic static void showFiles(File[] files) throws FileNotFoundException, IOException, NullPointerException, OfficeXmlFileException {\n\t\t\n\t\tFile log = new File(\"[output name]/out.tsv\");\n\t\t\n\t    for (File file : files) {\n\t       \tif (file.isDirectory()) {\n\t           \t//System.out.println(\"Directory/\" + file.getName());\n\t           \tshowFiles(file.listFiles()); // Calls same method again.\n\t        } else {\n\t        \t    String N = file.getName();  \n\t        \t    \n\t        \t    // caso .docx\n\t        \t\tif (N.toLowerCase().endsWith(\".docx\") && !N.toLowerCase().startsWith(\"~\"))\n\t        \t\t{\t\n\t        \t\t\tSystem.out.println(file.getAbsolutePath());\n\t        \t\t\tXWPFDocument docx = new XWPFDocument(new FileInputStream(file));\n\t        \t\t\tXWPFWordExtractor we = new XWPFWordExtractor(docx);\n        \t\t\t\tString T = we.getText().replaceAll(\"\\\\n\", \" \").replaceAll(\"\\\\r\", \" \");\n        \t\t\t\t\n            \t\t\t// PARA ESCRIBIR EL ARCHIVO\n            \t\t\ttry{\n//            \t\t\t\tif(!log.exists()){\n//            \t\t\t\t\tSystem.out.println(\"We had to make a new file.\");\n//            \t\t\t\t\tlog.createNewFile();\n//            \t\t\t\t}\n\n            \t\t\t\tFileWriter fileWriter = new FileWriter(log, true);\n            \t\t\t\tBufferedWriter bufferedWriter = new BufferedWriter(fileWriter);\n            \t\t\t\tbufferedWriter.write(file.getAbsolutePath()+\"\\t\"+T+\"\\n\");\n            \t\t\t\tbufferedWriter.close();\n\n            \t\t\t} catch (IOException e) {\n            \t            System.err.println(\"Problem writing .DOCX to the file out.txt \" + e.getMessage());\n            \t        }\n\t        \t\t} \n\t        \t\telse {\n\t        \t\t\n\t        \t\t\tif (N.toLowerCase().endsWith(\".doc\") && !N.toLowerCase().startsWith(\"~\"))\n\t        \t\t\t{\n\t        \t\t\t\tSystem.out.println(file.getAbsolutePath());\n\t        \t\t\t\n\t        \t\t\t\tHWPFDocument doc = new HWPFDocument(new FileInputStream(file));\n\t        \t\t\t\tWordExtractor we = new WordExtractor(doc);\n\t\t        \t\t\t//WordExtractor we = new WordExtractor(new FileInputStream(file));\n\t        \t\t\t\tString T = we.getText().replaceAll(\"\\\\n\", \" \").replaceAll(\"\\\\r\", \" \");\n        \t\t\t\t\n\t        \t\t\t\t// PARA ESCRIBIR EL ARCHIVO\n\t        \t\t\t\ttry{\n//\t        \t\t\t\t\tif(!log.exists()){\n//\t        \t\t\t\t\t\tlog.createNewFile();\n//\t        \t\t\t\t\t}\n\t        \t\t\t\t\t\n\t        \t\t\t\t\tFileWriter fileWriter = new FileWriter(log, true);\n\t        \t\t\t\t\tBufferedWriter bufferedWriter = new BufferedWriter(fileWriter);\n\t        \t\t\t\t\tbufferedWriter.write(file.getAbsolutePath()+\"\\t\"+T+\"\\n\");\n\t        \t\t\t\t\tbufferedWriter.close();\n\n\t        \t\t\t\t} catch (IOException e) {\n\t        \t\t\t\t\tSystem.err.println(\"Problem writing .DOC to the file out.txt \" + e.getMessage());\n\t        \t\t\t\t\t}\n\t        \t\t\t}\n\t        \t\t}\t\n\t       \t\t}\n\t    \t}\n\t}\n}\n\"\n\nFor most .docx and .doc files it's work fine.\n\nThe error message is:\n\nException in thread \"main\" java.lang.RuntimeException: \njava.lang.IllegalArgumentException: The end (4958) must not be before the start (4990)\n\nHow can I fix it?"}, {"count": 1, "attachment_id": null, "creator": "ps26oct@gmail.com", "is_private": false, "id": 196249, "time": "2017-01-20T14:39:00Z", "bug_id": 60556, "creation_time": "2017-01-20T14:39:00Z", "tags": [], "text": "The problem seems to be with the document and not the code and specifically with the hidden bookmark with the name: \"_Toc263095067\". Apparently poi is inferring the end of the bookmark to be located before the start. Deleting that particular hidden bookmark makes everything work fine. \n\nLet me know of any other corrective measures or any actual problem in the poi code this highlights, if any."}, {"attachment_id": null, "tags": [], "creator": "ismaelgomezs@gmail.com", "is_private": false, "count": 2, "id": 196609, "time": "2017-01-31T15:29:54Z", "bug_id": 60556, "creation_time": "2017-01-31T15:29:54Z", "text": "Thank you very much. That was the problem. Now it works fine!\nRegards."}, {"attachment_id": null, "tags": [], "creator": "dominik.stadler@gmx.at", "is_private": false, "count": 3, "id": 196610, "time": "2017-01-31T16:27:12Z", "bug_id": 60556, "creation_time": "2017-01-31T16:27:12Z", "text": "Seems to have been caused by a slightly broken document."}]
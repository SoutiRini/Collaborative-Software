[{"count": 0, "tags": [], "bug_id": 46379, "attachment_id": null, "text": "Description:\nThis bug is a apache-thread related php excution bug.\n\nThis bug is repeatable and clear.\n\n1. System setting.\n a. apache-2.2.10 : mpm=worker and using shared modules.\n-=-=-= httpd.conf =-=-=-\nfor simple test, values are low.\n<IfModule worker.c>\nStartServers        1\nMinSpareThreads     2\nMaxSpareThreads     4\nThreadsPerChild     2   # <- this is important.\nMaxRequestsPerChild 5   # <- this is important.\n</IfModule>\n\n b. PHP-5.2.8 : using apxs2 and enable-maintainer-zts for threadsafe\n(no external cache like APC or XCache)\n\n\nReproduce code:\n-=-= code of 1.php =-=-\n<?php\n echo '1<br>';\n\n echo date(\"H:i:s\").'<br>';\nsleep(10);\n echo date(\"H:i:s\").'<br>';\n?>\n\n-=-= code of 2.php =-=-\n<?php\n echo '2<br>';\n\n echo date(\"H:i:s\").'<br>';\n echo date(\"H:i:s\").'<br>';\n?>\n\nExpected result:\n<bug scenario>\n\n (a) browse 1.php and 2.php <concurrently ONCE>. result are not problem.\n-=-= result page of 1.php =-=-\n1\n11:04:29\n11:04:39\n-=-= result page of 2.php =-=-\n2\n11:04:30\n11:04:30\n\n (b) I expected ...\n  - browse 1.php and 2.php\n  - refresh 2.php over 10 times very fast within 10 sec. (yes, using F5)\n  - I expected below normal resuluts.\n-=-= result page of 1.php =-=-\n1\n11:12:47\n11:12:57\n-=-= result page of 2.php =-=-\n2\n11:12:57\n11:12:57\n\n\nActual result:\n-=-= result page of 1.php =-=-\n1\n11:49:00\n11:49:02\n-=-= result page of 2.php =-=-\n2\n11:49:02\n11:49:02\n<ANALYSIS>\n\n (a) initial apache process is here\nShell> ps ax | grep httpd\n 5697 ?        Ss     0:00 /skcomms/apache/bin/httpd -k restart\n 5964 ?        Sl     0:00 /skcomms/apache/bin/httpd -k restart\n  - becuase below apache setting\n<IfModule worker.c>\nStartServers        1\nMinSpareThreads     2\nThreadsPerChild     2\n...\n</IfModule>\n\n (b) suppose\n  - in (a) action, two connection is established with process 5964\n  - in (b) action, new 1.php is sleeping in 5964 and 2.php is excuted in other new process because below reason.\n<IfModule worker.c>\n...\nThreadsPerChild     2\nMaxRequestsPerChild 5\n</IfModule>\n\n (c) expected in 1.php excution time (within 10 sec)\n 5697 ?        Ss     0:00 /skcomms/apache/bin/httpd -k restart\n 5964 ?        Sl     0:00 /skcomms/apache/bin/httpd -k restart (1.php is sleeping here)\n 597x ?        Sl     0:00 /skcomms/apache/bin/httpd -k restart (2.php is browsed here)\n\n (d) but actually 5964 is terminated early in 2 seconds.\n 5697 ?        Ss     0:00 /skcomms/apache/bin/httpd -k restart\n 5991 ?        Sl     0:00 /skcomms/apache/bin/httpd -k restart", "id": 123233, "time": "2008-12-10T22:40:25Z", "creator": "ncross42@cyworld.com", "creation_time": "2008-12-10T22:40:25Z", "is_private": false}, {"count": 1, "tags": [], "text": "The php manual has comments saying sleep() wakes up when you receive any signal (like the traditional C library call documents, man 3 sleep)\n\nTermination due to MaxRequestsPerchild is implemented via a signal. \n\n\n", "attachment_id": null, "id": 123234, "creator": "covener@gmail.com", "time": "2008-12-11T00:14:20Z", "bug_id": 46379, "creation_time": "2008-12-11T00:14:20Z", "is_private": false}]
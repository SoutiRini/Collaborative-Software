[{"count": 0, "tags": [], "creator": "brad.newman@gmail.com", "text": "When using a CGI as an ErrorDocument, together with mod_deflate to compress the response body, the CRC32 in the gzip footer may be null when the request also contained a request body.\n\nI'll attach a simple httpd.conf and Bash CGI script that I've reproduced the issue with.  The issue is not unique to curl or Bash; it was originally encountered with a Perl CGI and Java client code.\n\nA hex dump of the response bodies shows that the second to last 32-bit word - the CRC32 in the gzip footer - is null.  The responses are otherwise identical.\n\n# Not working as expected - CRC is null\n$ curl -s -HAccept-Encoding:gzip -XPOST -dbody http://localhost/cgi-bin/404 | xxd\n0000000: 1f8b 0800 0000 0000 0003 3dcb 310e 8020  ..........=.1..\n0000010: 1044 d1de 538c 950d f134 5e40 7102 24c2  .D..S....4^@q.$.\n0000020: 1a76 8972 7b8d 85c9 2fdf 5f62 52bc a964  .v.r{.../._bR..d\n0000030: a224 4f18 6f83 09bc e4b3 52d5 a1af 7d04  .$O.o.....R...}.\n0000040: 96c8 4ae4 a686 8d60 9116 e287 1d78 2891  ..J....`.....x(.\n0000050: 0c97 94c9 1068 ffcc 7d1e 1e00 0000 0063  .....h..}......c\n0000060: 0000 00                                  ...\n\n# Working as expected\n$ curl -s -HAccept-Encoding:gzip -XPOST -dbody http://localhost/cgi-bin/test.cgi | xxd\n0000000: 1f8b 0800 0000 0000 0003 3dcb 310e 8020  ..........=.1..\n0000010: 1044 d1de 538c 950d f134 5e40 7102 24c2  .D..S....4^@q.$.\n0000020: 1a76 8972 7b8d 85c9 2fdf 5f62 52bc a964  .v.r{.../._bR..d\n0000030: a224 4f18 6f83 09bc e4b3 52d5 a1af 7d04  .$O.o.....R...}.\n0000040: 96c8 4ae4 a686 8d60 9116 e287 1d78 2891  ..J....`.....x(.\n0000050: 0c97 94c9 1068 ffcc 7d1e 1ee6 6eff 6b63  .....h..}...n.kc\n0000060: 0000 00                                  ...\n\n\nOddly, in addition to the other conditions, the CRC is only null if the 404 occurs within the the cgi-bin directory (make-requests.sh will also be attached):\n\n$ bash ~/make-requests.sh\ndirect to CGI, with request body:\nvia 404 in cgi-bin, with request body:\n\ngzip: stdin: invalid compressed data--crc error\nvia 404 outside cgi-bin, with request body:\nvia 404 in cgi-bin, without request body:", "id": 175507, "time": "2014-05-27T21:53:09Z", "bug_id": 56569, "creation_time": "2014-05-27T21:53:09Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "brad.newman@gmail.com", "text": "Created attachment 31668\nSimple CGI script to reproduce", "id": 175508, "time": "2014-05-27T21:53:40Z", "bug_id": 56569, "creation_time": "2014-05-27T21:53:40Z", "is_private": false, "attachment_id": 31668}, {"count": 2, "tags": [], "bug_id": 56569, "is_private": false, "text": "Created attachment 31669\nSimple httpd configuration to reproduce", "id": 175509, "time": "2014-05-27T21:54:31Z", "creator": "brad.newman@gmail.com", "creation_time": "2014-05-27T21:54:31Z", "attachment_id": 31669}, {"count": 3, "attachment_id": 31670, "bug_id": 56569, "is_private": false, "id": 175510, "time": "2014-05-27T21:54:56Z", "creator": "brad.newman@gmail.com", "creation_time": "2014-05-27T21:54:56Z", "tags": [], "text": "Created attachment 31670\nSimple client script to reproduce"}, {"count": 4, "tags": [], "bug_id": 56569, "attachment_id": null, "is_private": false, "id": 175709, "time": "2014-06-06T16:44:57Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2014-06-06T16:44:57Z", "text": "Thanks Brad for reporting.\n\nThis is already fixed in trunk as part of bug 46146, and proposed for backport in 2.4.x.\n\nPatch http://svn.apache.org/r1572671 works for 2.4.x if you can't wait."}]
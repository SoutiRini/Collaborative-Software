[{"count": 0, "attachment_id": null, "bug_id": 51732, "is_private": false, "id": 148867, "time": "2011-08-29T01:04:13Z", "creator": "ding.yuan.90@hotmail.com", "creation_time": "2011-08-29T01:04:13Z", "tags": [], "text": "Hi all,\nGreetings!I am a student doing research on improving the quality of error messages to enhance the diagnosability of the software. Recently I run a static checker on httpd-2.2.19 and found that some inconsistencies in log messages' verbosity levels in similar situations. While we suspect some of them should be fixed, we are not 100% sure since we do not have domain expertise in httpd code. \n\nThank,\n============== Case 1 ===============================\nThe two snippets are similar. But the log message in the first snippet (line\n292) has APLOG_ERR level, while the one in the 2nd snippet (line 1008) has\nAPLOG_DEBUG level! Maybe the 2nd log message should be changed to APLOG_ERR \nlevel?\n---------------- modules/cache/mod_cache.c ---------------------\n@@ line: 283 @@  \n283:        request_rec *r = f->r;\n284:        cache_request_rec *cache;\n285:    \n286:        cache = (cache_request_rec *) ap_get_module_config(r->request_config,\n287:                                                           &cache_module);\n288:    \n289:        if (!cache) {\n290:            /* user likely configured CACHE_OUT manually; they should use mod_cache\n291:             * configuration to do that */\n292:            ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,\n293:                         \"CACHE_OUT enabled unexpectedly\");\n294:            ap_remove_output_filter(f);\n295:            return ap_pass_brigade(f->next, bb);\n---------------- modules/cache/mod_cache.c ---------------------\n@@ line: 996 @@\n996:        request_rec *r = f->r;\n997:        cache_request_rec *cache;\n998:    \n999:        /* Setup cache_request_rec */\n1000:       cache = (cache_request_rec *) f->ctx;\n1001:    \n1002:       if (!cache) {\n1003:           /* user likely configured CACHE_REMOVE_URL manually; they should really\n1004:            * use mod_cache configuration to do that. So:\n1005:            * 1. Remove ourselves\n1006:            * 2. Do nothing and bail out\n1007:            */\n1008:           ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,\n1009:                        \"cache: CACHE_REMOVE_URL enabled unexpectedly\");\n1010:           ap_remove_output_filter(f);\n1011:           return ap_pass_brigade(f->next, in);\n        \n=============== Case 2 ==============================\nThe two snippets are similar. But the log message in the first snippet (line\n432) has APLOG_WARNING level, while the one in the 2nd snippet (line 482) has\nAPLOG_DEBUG level! Maybe the 2nd log message should be changed to APLOG_ERR \nlevel?\nPattern: 1943\n---------------- modules/mappers/mod_alias.c ---------------------\n@@ line: 426 @@\n426: if ((ret = try_alias_list(r, serverconf->redirects, 1, &status)) != NULL) {\n427:        if (ap_is_HTTP_REDIRECT(status)) {\n428:            char *orig_target = ret;\n429:            if (ret[0] == '/') {\n430:        \n431:                    ret = ap_construct_url(r->pool, ret, r);\n432:                    ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,\n433:                                  \"incomplete redirection target of '%s' for \"\n434:                                  \"URI '%s' modified to '%s'\",\n435:                                  orig_target, r->uri, ret);\n---------------- modules/mappers/mod_alias.c ---------------------\n@@ line: 465 @@\n476:    if ((ret = try_alias_list(r, dirconf->redirects, 1, &status)) != NULL) {\n477:        if (ap_is_HTTP_REDIRECT(status)) {\n478:            if (ret[0] == '/') {\n479:                char *orig_target = ret;\n480: \n481:                    ret = ap_construct_url(r->pool, ret, r);\n482:                    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,\n483:                                  \"incomplete redirection target of '%s' for \"\n484:                                  \"URI '%s' modified to '%s'\",\n485:                                  orig_target, r->uri, ret);\n\n\n================ Case 3 =============================\nThe log message at line 56 has verbosity level APLOG_ERR, while the one at line\n88 has an APLOG_WARNING. Should they be consistent?\nPattern: 2395\n---------------- modules/ssl/ssl_engine_mutex.c ---------------------\n@@ line: 51 @@ \n51:             if (mc->szMutexFile)\n52:                 ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,\n53:                              \"Cannot create SSLMutex with file `%s'\",\n54:                              mc->szMutexFile);\n55:             else    \n56:                 ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,\n57:                              \"Cannot create SSLMutex\"); \n58:             return FALSE;         \n---------------- modules/ssl/ssl_engine_mutex.c ---------------------\n@@ line: 83 @@\n83:             if (mc->szMutexFile)\n84:                 ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,\n85:                              \"Cannot reinit SSLMutex with file `%s'\",\n86:                              mc->szMutexFile);\n87:             else\n88:                 ap_log_error(APLOG_MARK, APLOG_WARNING, rv, s,\n89:                              \"Cannot reinit SSLMutex\");\n90:             return FALSE;"}, {"count": 1, "tags": [], "bug_id": 51732, "attachment_id": null, "text": "Hi, \nI am wondering if there is any comments?\n\nThanks,", "id": 149002, "time": "2011-09-02T18:05:49Z", "creator": "ding.yuan.90@hotmail.com", "creation_time": "2011-09-02T18:05:49Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 51732, "attachment_id": null, "text": "Case 1 : no more an issue on trunk\n\nCase 2 : this has been fixed in version 2.21\n\nCase 3 : no more an issue on trunk\n\n\nAnyway, I think that error message quality is important.\n\nAre you still working on this project ?\nDoes any tool/checker has been developped ?\n\nIf yes, I would be interesting in knowing more about it.", "id": 162468, "time": "2012-09-30T06:56:43Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2012-09-30T06:56:43Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 51732, "attachment_id": null, "text": "Glad to know. Thanks for the confirmation. In fact I have some more such cases to report (I will dig the data out and follow up soon). \n\nI am working on log qualities. If you are interested, we recently published several papers on log qualities:\nhttp://opera.ucsd.edu/paper/osdi12-errlog.pdf\nhttp://opera.ucsd.edu/paper/log_icse12.pdf\nhttp://opera.ucsd.edu/paper/logenhancer-tocs.pdf\n\nThe 1st paper talks about the problem of missing to log obvious errors. 2nd paper talks about verbosity level and other issues with existing logging code (and describes the tool we used to report these cases in Section IX). 3rd paper discusses how to make each existing log message more informative. \n\nDing", "id": 162469, "time": "2012-09-30T07:48:21Z", "creator": "ding.yuan.90@hotmail.com", "creation_time": "2012-09-30T07:48:21Z", "is_private": false}]
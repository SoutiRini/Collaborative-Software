[{"count": 0, "attachment_id": null, "creator": "mestrade@apache.org", "text": "Hello,\n\nI've found something strange in the mod_proxy (httpd 2.0.63 and 2.2.8) setup:\nThe following directive says:\n\nhttp://httpd.apache.org/docs/2.0/mod/mod_proxy.html#proxyiobuffersize\n\nThe |ProxyIOBufferSize| directive adjusts the size of the internal buffer, which is used as a scratchpad for the data between input and output. The size must be less or equal |8192|.\n\n\nLESS or EQUAL 8192...\n\nAnd the code in mod_proxy.c is:\n\nlong s = atol(arg);\n\npsf->io_buffer_size = ((s > AP_IOBUFSIZE) ? s : AP_IOBUFSIZE);\npsf->io_buffer_size_set = 1;\n\n\nshould be\n\npsf->io_buffer_size = ((s < AP_IOBUFSIZE) ? s : AP_IOBUFSIZE);\n\n\nIt's the same in 2.2.x:\n\nelse if (!strcasecmp(key, \"iobuffersize\")) {\n       long s = atol(val);\n       worker->io_buffer_size = ((s > AP_IOBUFSIZE) ? s : AP_IOBUFSIZE);\n       worker->io_buffer_size_set = 1;\n}\n\nI actually need this directive to work better with some stream data. Can somebody confirm the modification must be done in the code and not in the documentation ?", "id": 114480, "time": "2008-03-11T03:33:22Z", "bug_id": 44574, "creation_time": "2008-03-11T03:33:22Z", "tags": [], "is_private": false}, {"text": "Created attachment 21649\nPatch for 2.0.63", "tags": [], "bug_id": 44574, "attachment_id": 21649, "count": 1, "id": 114481, "time": "2008-03-11T03:34:04Z", "creator": "mestrade@apache.org", "creation_time": "2008-03-11T03:34:04Z", "is_private": false}, {"attachment_id": 21650, "tags": [], "creator": "mestrade@apache.org", "is_private": false, "count": 2, "id": 114482, "time": "2008-03-11T03:34:30Z", "bug_id": 44574, "creation_time": "2008-03-11T03:34:30Z", "text": "Created attachment 21650\nPatch for 2.2.8"}, {"count": 3, "tags": [], "text": "In 2.2.x both proxy_server_conf's and proxy_worker's io_buffer_size need to be fixed, don't they?\n\n\n--- mod_proxy.c.orig\n+++ mod_proxy.c\n@@ -148,7 +148,7 @@\n     }\n     else if (!strcasecmp(key, \"iobuffersize\")) {\n         long s = atol(val);\n-        worker->io_buffer_size = ((s > AP_IOBUFSIZE) ? s : AP_IOBUFSIZE);\n+        worker->io_buffer_size = ((s < AP_IOBUFSIZE) ? s : AP_IOBUFSIZE);\n         worker->io_buffer_size_set = 1;\n     }\n     else if (!strcasecmp(key, \"receivebuffersize\")) {\n@@ -1467,7 +1467,7 @@\n     ap_get_module_config(parms->server->module_config, &proxy_module);\n     long s = atol(arg);\n \n-    psf->io_buffer_size = ((s > AP_IOBUFSIZE) ? s : AP_IOBUFSIZE);\n+    psf->io_buffer_size = ((s < AP_IOBUFSIZE) ? s : AP_IOBUFSIZE);\n     psf->io_buffer_size_set = 1;\n     return NULL;\n }\n", "is_private": false, "id": 114627, "creator": "takashi.asfbugzilla@tks.st", "time": "2008-03-14T08:46:00Z", "bug_id": 44574, "creation_time": "2008-03-14T08:46:00Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Does Limitting ProxyIOBufferSize make sense?", "attachment_id": null, "id": 114837, "creator": "takashi.asfbugzilla@tks.st", "time": "2008-03-20T20:51:43Z", "bug_id": 44574, "creation_time": "2008-03-20T20:51:43Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 44574, "attachment_id": null, "text": "io_buffer_size is used by mod_proxy_ajp, mod_proxy_http and mod_proxy_ftp.\n\nmod_proxy_http and mod_proxy_ftp just uses io_buffer_size directly.\nmod_proxy_http.c line 1637:\n\nrv = ap_get_brigade(rp->input_filters, bb,\n    AP_MODE_READBYTES, mode,\n    conf->io_buffer_size);\n\n\nUnlike them, mod_proxy_ajp has own limits.\nmod_proxy_ajp.c line 171:\n\napr_size_t maxsize = AJP_MSG_BUFFER_SZ;\n\nif (psf->io_buffer_size_set)\n   maxsize = psf->io_buffer_size;\nif (maxsize > AJP_MAX_BUFFER_SZ)\n   maxsize = AJP_MAX_BUFFER_SZ;\nelse if (maxsize < AJP_MSG_BUFFER_SZ)\n   maxsize = AJP_MSG_BUFFER_SZ;\nmaxsize = APR_ALIGN(maxsize, 1024);\n\najp.h line 134:\n\n#define AJP_MSG_BUFFER_SZ           8192\n#define AJP_MAX_BUFFER_SZ           65536", "id": 114838, "time": "2008-03-20T21:32:45Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-03-20T21:32:45Z", "is_private": false}, {"attachment_id": 21697, "tags": [], "creator": "takashi.asfbugzilla@tks.st", "is_private": false, "count": 6, "id": 114839, "time": "2008-03-20T21:56:21Z", "bug_id": 44574, "creation_time": "2008-03-20T21:56:21Z", "text": "Created attachment 21697\nRemove limit ProxyIOBufferSize (trunk)\n\nThere's no reason limitting ProxyIOBufferSize in mod_proxy.\nIf needed, protocol providers should."}, {"count": 7, "tags": [], "bug_id": 44574, "is_private": false, "text": "2.2 doc still says \"The size must be less or equal 8192.\"\nThe 2.2 code says ProxyIOBufferSize must be greater than or equal to 8192.\n2.4 doc says \"The size must be at least 512.\"\n\n2.2 doc should be wrong.", "id": 166642, "time": "2013-04-16T04:21:01Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2013-04-16T04:21:01Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 44574, "text": "found similar discussion:\nhttp://www.mail-archive.com/dev@httpd.apache.org/msg41850.html", "id": 166643, "time": "2013-04-16T04:43:21Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2013-04-16T04:43:21Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "minfrin@sharp.fm", "is_private": false, "count": 9, "id": 166893, "time": "2013-04-27T18:32:35Z", "bug_id": 44574, "creation_time": "2013-04-27T18:32:35Z", "text": "Docs updated in trunk: http://svn.apache.org/r1476652\nIn v2.4: http://svn.apache.org/r1476653\nIn v2.2: http://svn.apache.org/r1476655"}]
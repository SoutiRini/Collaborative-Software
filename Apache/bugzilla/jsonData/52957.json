[{"count": 0, "tags": [], "bug_id": 52957, "text": "Created attachment 28490\nPatch proposal\n\nHello,\n\nThe exception below is thrown when StandardPipeline.removeValve() is invoked:\n\nCaused by: java.lang.ClassCastException: test.MyValve cannot be cast to org.apache.catalina.Lifecycle\n\tat org.apache.catalina.core.StandardPipeline.removeValve(StandardPipeline.java:461)\n\tat org.apache.catalina.core.StandardPipeline.destroyInternal(StandardPipeline.java:222)\n\tat org.apache.catalina.util.LifecycleBase.destroy(LifecycleBase.java:304)\n\n\ntest.MyValve implements only Valve\n\nI'm attaching a patch made against 7.0.x. Please review it and comment it.\n\nThanks in advance.\nRegards\nVioleta Georgieva", "id": 155174, "time": "2012-03-21T12:47:49Z", "creator": "violetagg@apache.org", "creation_time": "2012-03-21T12:47:49Z", "is_private": false, "attachment_id": 28490}, {"count": 1, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "One of changes done is Tomcat 7 is that implementing Lifecycle is mandatory in  most components. I do not see a reason why a Valve should be an exception. I would suggest you to extends the ValveBase class.\n\nhttp://tomcat.apache.org/migration-7.html#Internal_APIs", "id": 155175, "time": "2012-03-21T12:59:40Z", "bug_id": 52957, "creation_time": "2012-03-21T12:59:40Z", "is_private": false}, {"count": 2, "tags": [], "text": "If we wanted Valve to extend Lifecycle that then is what we should have done but we didn't. (We did for Container).\n\nI'm not against taking a further look at this but I'd want to look more widely at where else we make the assumption Valve implements Lifecycle and the conclusion may well be to change Valve to extend Lifecycle at least in Tomcat 8 if not in 7.", "is_private": false, "bug_id": 52957, "id": 155176, "time": "2012-03-21T13:09:33Z", "creator": "markt@apache.org", "creation_time": "2012-03-21T13:09:33Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "Fixed in trunk and 7.0.x and will be included in 7.0.27 onwards.\n\nI went with a marginally more efficient patch.\n\nI did look more widely at where Lifecycle is used and it is essentially optional for a wide range of Components (Valve, Realm, Pipeline, Manager, Loader, etc.) I'm not against making it mandatory (neither am I strongly for it) but that is certainly a Tomcat 8 decision. If folks feel strongly about this, the dev list is the place to start the discussion.", "id": 155229, "attachment_id": null, "bug_id": 52957, "creation_time": "2012-03-22T14:40:07Z", "time": "2012-03-22T14:40:07Z", "is_private": false}, {"count": 4, "tags": [], "text": "Thanks", "is_private": false, "bug_id": 52957, "id": 155243, "time": "2012-03-22T19:10:57Z", "creator": "violetagg@apache.org", "creation_time": "2012-03-22T19:10:57Z", "attachment_id": null}]
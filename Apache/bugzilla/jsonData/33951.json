[{"attachment_id": null, "tags": [], "creator": "jeh@fernbach.com", "text": "We decided to create this new bug, although we found bug 31114 and bug 33082\nwhich describe similar problems.\n\n\nOn execution of the following code snippet:\n\nPOIFSFileSystem fs = new POIFSFileSystem(request.getServletContext\n().getResourceAsStream(\"WEB-INF/workbook.xls\"));\nHSSFWorkbook wb = new HSSFWorkbook (fs);\n\n...\nwe get an InvocationTargetException for the createRecord method-call (else\nblock: retval = new UnknownRecord(rectype, size, data);)  in class\norg.apache.poi.hssf.record.RecordFactory.\n\nOn analysing this call, we found an IndexOutOfBoundsException. The Exception is\nthrown on execution of System.arraycopy().\n\nWhile remote-debugging this scenario: Starting at constructor call till\nexecution of the arraycopy statement, there was nothing abnormal. \n\n\nBut on execution of the arraycopy statement, we found the following:\n\npublic static void arraycopy( byte[] src, int src_position, byte[] dst, int\ndst_position, int length)\n\n- The parameter length did'nt match the available size of parameter src. By\npatching the parameter length to: length=Math.min (length,\nMath.min(src.length-src_position, dst.length-dst_position)); - we were able to\nload the workbook. \n\nWe don't know why in this case these parameters are inconsitent to each other,\nbut we want to request for help. In the attachment you'll find our patching\nclass as an proposal solution. \n\nthx for your help!", "count": 0, "id": 72118, "time": "2005-03-10T13:55:46Z", "bug_id": 33951, "creation_time": "2005-03-10T13:55:46Z", "is_private": false}, {"count": 1, "tags": [], "creator": "jeh@fernbach.com", "text": "Created attachment 14455\nPOI 2.0 patched origin src\n\nAdded SystemArrayCopyHelper.arraycopy(thedata, 0, data, 4 + offset,\nthedata.length);", "id": 72119, "time": "2005-03-10T13:58:15Z", "bug_id": 33951, "creation_time": "2005-03-10T13:58:15Z", "is_private": false, "attachment_id": 14455}, {"count": 2, "tags": [], "bug_id": 33951, "attachment_id": 14456, "is_private": false, "id": 72121, "time": "2005-03-10T14:00:25Z", "creator": "jeh@fernbach.com", "creation_time": "2005-03-10T14:00:25Z", "text": "Created attachment 14456\nProposal Solution SystemArrayCopyHelper\n\nHelper manipulation copy length for arraycopy call."}, {"attachment_id": null, "tags": [], "bug_id": 33951, "text": "Could you possible attach the files that originally caused your problem. This\nchange may have global effects, so I want some testcases before I check this in. ", "count": 3, "id": 73971, "time": "2005-04-22T13:30:38Z", "creator": "avik@apache.org", "creation_time": "2005-04-22T13:30:38Z", "is_private": false}, {"count": 4, "tags": [], "text": "bug 31114 & bug 33082 are now fixed.\n\nOnly reading what is left of a record is a bad thing, usually means that our\nimplementation is wrong and you dont want to hide these types of bugs because\nthey will never get fixed.\n\nGiven that the referenced bug are fixed, and that there is no attached file to\ntry, i am going to close this bug.\n\nJason", "is_private": false, "id": 77812, "creator": "jheight@apache.org", "time": "2005-07-29T04:45:42Z", "bug_id": 33951, "creation_time": "2005-07-29T04:45:42Z", "attachment_id": null}]
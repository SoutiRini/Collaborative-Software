[{"count": 0, "attachment_id": null, "creator": "PhiLho@GMX.net", "text": "When I want to delete a sheet that's not the last one in a workbook with several sheets, I get an exception.\n\nException in thread \"main\" java.lang.NullPointerException\n\tat org.apache.poi.hssf.model.InternalWorkbook.removeSheet(InternalWorkbook.java:780)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.removeSheetAt(HSSFWorkbook.java:924)\n\nI open the file with:\n\ntry (InputStream in = new BufferedInputStream(new FileInputStream(new File(fileName))))\n{\n  return WorkbookFactory.create(in);\n}\n\nthen I call workbook.removeSheetAt(0);\n\nApparently, the linkTable field is null.\n\nMy use case is to load a template with several sheets, delete them all but one to clone it to the number of sheets needed.\nAs a workaround, I move the wanted sheet at first position with:\n\nworkbook.setSheetOrder(workbook.getSheetName(sheetIndex), 0);\n\nthen I delete all the others in reverse order...", "id": 178822, "time": "2014-10-29T11:57:14Z", "bug_id": 57163, "creation_time": "2014-10-29T11:57:14Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 57163, "is_private": false, "count": 1, "id": 178823, "time": "2014-10-29T12:07:42Z", "creator": "apache@gagravarr.org", "creation_time": "2014-10-29T12:07:42Z", "text": "Can you attach a small file that shows this problem?"}, {"count": 2, "tags": [], "text": "Created attachment 32172\nThe Excel file used in the test", "attachment_id": 32172, "bug_id": 57163, "id": 178860, "time": "2014-10-31T11:28:27Z", "creator": "PhiLho@GMX.net", "creation_time": "2014-10-31T11:28:27Z", "is_private": false}, {"attachment_id": 32173, "tags": [], "bug_id": 57163, "is_private": false, "count": 3, "id": 178861, "time": "2014-10-31T11:29:28Z", "creator": "PhiLho@GMX.net", "creation_time": "2014-10-31T11:29:28Z", "text": "Created attachment 32173\nShow bugs"}, {"count": 4, "tags": [], "creator": "PhiLho@GMX.net", "attachment_id": null, "id": 178866, "time": "2014-10-31T11:33:37Z", "bug_id": 57163, "creation_time": "2014-10-31T11:33:37Z", "is_private": false, "text": "Added a standalone class that loads the sample Excel file and reproduce the bugs (three bugs are shown, I numbered them with the Bugzilla id).\nYou might need to adjust the path to the sample."}, {"count": 5, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": 32198, "id": 179013, "time": "2014-11-09T22:20:33Z", "bug_id": 57163, "creation_time": "2014-11-09T22:20:33Z", "is_private": false, "text": "Created attachment 32198\nProposed fix which adjusts the active sheet in setSheetOrder() and removeSheet()\n\nFYI, I have a proposed fix for this and bug 57171, but would like to postpone checkin until after release 3.11 as it runs a slight risk of breaking stuff."}, {"attachment_id": null, "tags": [], "bug_id": 57163, "is_private": false, "count": 6, "id": 179932, "time": "2014-12-22T09:01:02Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2014-12-22T09:01:02Z", "text": "Fixed this and Bug 57163 via r1647264"}, {"attachment_id": null, "tags": [], "bug_id": 57163, "is_private": false, "count": 7, "id": 182260, "time": "2015-04-06T13:27:32Z", "creator": "vlelikov@gmail.com", "creation_time": "2015-04-06T13:27:32Z", "text": "This bug is still occurs for XLS (HSSFWorkbook) in release POI 3.12 beta 1.\nProblem in org.apache.poi.hssf.model.InternalWorkbook:780\n\npublic void removeSheet(int sheetIndex) {\n    ....\n\n    // also tell the LinkTable about the removed sheet\n    // +1 because we already removed it from the count of sheets!\n    for(int i = sheetIndex+1;i < getNumSheets()+1;i++) {\n        // also update the link-table as otherwise references might point at invalid sheets\n        linkTable.removeSheet(i);\n    }\n}\n\nIt is allowed linkTable field to be null!!!"}, {"count": 8, "tags": [], "creator": "vlelikov@gmail.com", "attachment_id": 32633, "id": 182261, "time": "2015-04-06T13:28:17Z", "bug_id": 57163, "creation_time": "2015-04-06T13:28:17Z", "is_private": false, "text": "Created attachment 32633\nJava file to test"}, {"count": 9, "tags": [], "creator": "vlelikov@gmail.com", "attachment_id": 32634, "id": 182262, "time": "2015-04-06T13:28:41Z", "bug_id": 57163, "creation_time": "2015-04-06T13:28:41Z", "is_private": false, "text": "Created attachment 32634\nExcel sheet to test"}, {"attachment_id": null, "tags": [], "bug_id": 57163, "is_private": false, "count": 10, "id": 182263, "time": "2015-04-06T13:32:36Z", "creator": "vlelikov@gmail.com", "creation_time": "2015-04-06T13:32:36Z", "text": "Proposed fix (add check for linkTable):\n\npublic void removeSheet(int sheetIndex) {\n    ....\n    \n\n    if (linkTable != null) {\n        // also tell the LinkTable about the removed sheet\n        // +1 because we already removed it from the count of sheets!\n        for(int i = sheetIndex+1;i < getNumSheets()+1;i++) {\n            // also update the link-table as otherwise references might point at invalid sheets\n            linkTable.removeSheet(i);\n        }\n    }\n}"}, {"count": 11, "tags": [], "bug_id": 57163, "attachment_id": null, "is_private": false, "id": 186004, "time": "2015-10-27T09:13:42Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-10-27T09:13:42Z", "text": "This is actually fixed already since some time via r1673168, it seems we just missed to close this issue."}]
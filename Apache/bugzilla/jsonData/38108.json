[{"count": 0, "tags": [], "creator": "scott@abcoa.com", "text": "When compiling and installing PHP with the Apache's DSO module, I ran into\ncompile failure when using \"make install\".  After some troubleshooting, it all\nboiled down to this apache's instdso.sh file.  So, I simplify this testcase here...\n\n--snip--\n#!/bin/sh\n\n#DLNAME=`sed -n \"/^dlname=/{s/.*='\\([^']*\\)'/\\1/;p}\"\n$TARGETDIR/$DSOARCHIVE_BASENAME`\nDLNAME=`sed -n \"/^dlname=/{s/.*='\\([^']*\\)'/\\1/;p}\"\n/usr/local/apache2/modules/libphp5.la`\n#LIBRARY_NAMES=`sed -n \"/^library_names/{s/library_names='\\([^']*\\)'/\\1/;p}\"\n$TARGETDIR/$DSOARCHIVE_BASENAME`\nLIBRARY_NAMES=`sed -n \"/^library_names/{s/library_names='\\([^']*\\)'/\\1/;p}\"\n/usr/local/apache2/modules/libphp5.la`\nLIBRARY_NAMES=`echo $LIBRARY_NAMES | sed -e \"s/ *$DLNAME//g\"`\n \nif test -z \"$DLNAME\"\nthen\n#  echo \"Warning!  dlname not found in $TARGETDIR/$DSOARCHIVE_BASENAME.\"\n  echo \"Warning!  dlname not found in /usr/local/apache2/modules/libphp5.la.\"\n  echo \"Assuming installing a .so rather than a libtool archive.\"\n  exit 0\nfi\n--snip--\n\nwhere I get this error...\n\n--snip--\nsed: 0602-404 Function /^dlname=/{s/.*='\\([^']*\\)'/\\1/;p} cannot be parsed.\nsed: 0602-404 Function /^library_names/{s/library_names='\\([^']*\\)'/\\1/;p}\ncannot be parsed.\nWarning!  dlname not found in /usr/local/apache2/modules/libphp5.la.\nAssuming installing a .so rather than a libtool archive.\n--snip--\n\nThe original result when trying to install PHP source code was...\n\n--snip--\n-=[root@netgate]\n-=[/usr/local/src/php-5.1.1]==>make install\n        echo '\\\n\\\nInstalling PHP SAPI module:       apache2handler\n/usr/local/apache2/build/instdso.sh\nSH_LIBTOOL='/usr/local/apache2/build/libtool' libphp5.la /usr/local/apache2/modules\nrm -f /usr/local/apache2/modules/libphp5.so\n/usr/local/apache2/build/libtool --mode=install cp libphp5.la\n/usr/local/apache2/modules/\ncp .libs/libphp5.a /usr/local/apache2/modules/libphp5.a\ncp .libs/libphp5.lai /usr/local/apache2/modules/libphp5.la\nlibtool: install: warning: remember to run `libtool --finish\n/usr/local/src/php-5.1.1/libs'\nsed: 0602-404 Function /^dlname=/{s/.*='\\([^']*\\)'/\\1/;p} cannot be parsed.\nsed: 0602-404 Function /^library_names/{s/library_names='\\([^']*\\)'/\\1/;p}\ncannot be parsed.\nWarning!  dlname not found in /usr/local/apache2/modules/libphp5.la.\nAssuming installing a .so rather than a libtool archive.\nchmod 755 /usr/local/apache2/modules/libphp5.so\nchmod: /usr/local/apache2/modules/libphp5.so: A file or directory in the path\nname does not exist.\napxs:Error: Command failed with rc=65536\n.\nmake: 1254-004 The error code from the last command is 1.\n\nStop.\n-=[root@netgate]\n-=[/usr/local/src/php-5.1.1]==>\n--snip--\n\nI don't see any existing bug in this Apache's bugzilla but I did see one bug\nthat is unrelated to this one...  Bug #29599  Whatever happen, I'm unable to\ninstall PHP.  However, back then, Apache was configured, compiled and installed\nwithout a problem...", "id": 84171, "time": "2006-01-03T19:25:10Z", "bug_id": 38108, "creation_time": "2006-01-03T19:25:10Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "Do you have LANG set?  Google says this can happen because of an AIX bug with\nLANG set.", "id": 84178, "time": "2006-01-03T21:18:58Z", "bug_id": 38108, "creation_time": "2006-01-03T21:18:58Z", "is_private": false}, {"count": 2, "tags": [], "text": "*** Bug 38111 has been marked as a duplicate of this bug. ***", "attachment_id": null, "bug_id": 38108, "id": 84182, "time": "2006-01-03T21:24:21Z", "creator": "scott@abcoa.com", "creation_time": "2006-01-03T21:24:21Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 38108, "text": "*** Bug 38112 has been marked as a duplicate of this bug. ***", "id": 84184, "attachment_id": null, "creator": "scott@abcoa.com", "creation_time": "2006-01-03T21:24:43Z", "time": "2006-01-03T21:24:43Z", "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 38108, "is_private": false, "id": 84188, "time": "2006-01-03T22:05:32Z", "creator": "rpluem@apache.org", "creation_time": "2006-01-03T22:05:32Z", "tags": [], "text": "*** Bug 38110 has been marked as a duplicate of this bug. ***"}, {"count": 5, "tags": [], "creator": "scott@abcoa.com", "text": "That's interesting.  I don't get it on why does the LANGUAGE have to do with this.\n\nI did \"echo $LANG\" and got the \"en_US\" response so I did this, \"export LANG=''\"\nand did the \"echo $LANG\" and got the blank response.\n\nSo, tried running this command manually, \"/usr/local/apache2/build/instdso.sh\nSH_LIBTOOL='/usr/local/apache2/build/libtool' libphp5.la\n/usr/local/apache2/modules\" and still get this sed error message.  The same\nthing for \"make install\" in the /usr/local/src/php5.1.1 directory.  I did the\nmake clean  and double check to make sure.", "id": 84189, "time": "2006-01-03T22:21:04Z", "bug_id": 38108, "creation_time": "2006-01-03T22:21:04Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "scott@abcoa.com", "is_private": false, "text": "The output of the cat command of the libphp5.la in the\n/usr/local/apache/modules/libphp5.la result in ..\n\n--snip--\n# libphp5.la - a libtool library file\n# Generated by ltmain.sh - GNU libtool 1.5.18 (1.1220.2.245 2005/05/16 08:55:27)\n#\n# Please DO NOT delete this file!\n# It is necessary for linking the library.\n\n# The name that we can dlopen(3).\ndlname='libphp5.so'\n\n# Names of this library.\nlibrary_names='libphp5.a libphp5.a'\n\n# The name of the static archive.\nold_library=''\n\n# Libraries that this one depends upon.\ndependency_libs=' -lssl -lcrypto -lssl -lcrypto -lssl -lcrypto\n-L/usr/local/ssl/lib -L/usr/local/lib -lssl -lcrypto -lssl -lcrypto -lm\n/usr/local/lib/libcurl.la -lssl -lcrypto -lssl -lcrypto\n/usr/local/lib/libodbc.la -ldl -liconv -lthread'\n\n# Version information for libphp5.\ncurrent=0\nage=0\nrevision=0\n\n# Is this an already installed library?\ninstalled=yes\n\n# Should we warn about portability when linking against -modules?\nshouldnotlink=yes\n\n# Files to dlopen/dlpreopen\ndlopen=''\ndlpreopen=''\n\n# Directory that this library needs to be installed in:\nlibdir='/usr/local/src/php-5.1.1/libs'\n--snip--\n\nif that can be of a further help here..", "id": 84194, "time": "2006-01-03T22:44:16Z", "bug_id": 38108, "creation_time": "2006-01-03T22:44:16Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Can you try adding at the top of build/instdso.sh:\n\nLANG=C\nLC_ALL=C\nLANGUAGE=C\nexport LANG LC_ALL LANGUAGE\n\n(and then \"make install\" from httpd, then try installing PHP again)", "attachment_id": null, "id": 84431, "creation_time": "2006-01-10T14:16:09Z", "time": "2006-01-10T14:16:09Z", "creator": "jorton@redhat.com", "bug_id": 38108, "is_private": false}, {"count": 8, "tags": [], "creator": "scott@abcoa.com", "attachment_id": null, "text": "Still get the same error but it look a little better...  The old error was \n\n--snip--\nsed: 0602-404 Function /^dlname=/{s/.*='\\([^']*\\)'/\\1/;p} cannot be parsed.\nsed: 0602-404 Function /^library_names/{s/library_names='\\([^']*\\)'/\\1/;p}\ncannot be parsed.\nWarning!  dlname not found in /usr/local/apache2/modules/libphp5.la.\nAssuming installing a .so rather than a libtool archive.\n--snip--\n\nwhile the new error is\n\n--snip--\nsed: Function /^dlname=/{s/.*='\\([^']*\\)'/\\1/;p} cannot be parsed.\nsed: Function /^library_names/{s/library_names='\\([^']*\\)'/\\1/;p} cannot be parsed.\nWarning!  dlname not found in /usr/local/apache2/modules/libphp5.la.\nAssuming installing a .so rather than a libtool archive.\n--snip--\n\nNoticed that the \"0602-404\" is no longer there in the new error message.  I'm\nnot sure if the AIX's native sed is that compatible with that sed script or not.", "id": 84443, "time": "2006-01-10T18:44:04Z", "bug_id": 38108, "creation_time": "2006-01-10T18:44:04Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 38108, "is_private": false, "id": 86386, "attachment_id": 17816, "creator": "masaoki@techfirm.co.jp", "creation_time": "2006-03-02T10:36:22Z", "time": "2006-03-02T10:36:22Z", "text": "Created attachment 17816\nPatch file to avoid sed errors on installing apache 2.2"}, {"count": 10, "tags": [], "text": "I believe the patch file I attached will eliminate sed error.\nIt has been affected to all environments so that the ${prefix}/modules \ndirectory contains \".a\" and \".la\" files because of this error.", "attachment_id": null, "id": 86387, "creation_time": "2006-03-02T10:45:30Z", "time": "2006-03-02T10:45:30Z", "creator": "masaoki@techfirm.co.jp", "bug_id": 38108, "is_private": false}, {"count": 11, "tags": [], "creator": "sfletcher@abcoa.com", "text": ">LANG=C\n>LC_ALL=C\n>LANGUAGE=C\n>export LANG LC_ALL LANGUAGE\n\nThe sed error you were referring to, I found out it only apply to AIX 4.3, not\nAIX 5.2.\n\nTrying your patch that eliminate the sed error and it seem to work pretty well\nwith no sed error but I get further compile error.  Here's what I got...\n\n--snip--\nInstalling PHP SAPI module:       apache2handler\n/usr/local/apache2/build/instdso.sh\nSH_LIBTOOL='/usr/local/apache2/build/libtool' libphp5.la /usr/local/apache2/modules\nrm -f /usr/local/apache2/modules/libphp5.so\n/usr/local/apache2/build/libtool --mode=install cp libphp5.la\n/usr/local/apache2/modules/\ncp .libs/libphp5.a /usr/local/apache2/modules/libphp5.a\ncp .libs/libphp5.lai /usr/local/apache2/modules/libphp5.la\nlibtool: install: warning: remember to run `libtool --finish\n/usr/local/src/php-5.1.2/libs'\nchmod 755 /usr/local/apache2/modules/libphp5.so\nchmod: /usr/local/apache2/modules/libphp5.so: A file or directory in the path\nname does not exist.\napxs:Error: Command failed with rc=65536\n--snip--\n\nSo, I check the /usr/local/apache2/module directory and found there is no\nlibphp5.so file.  So, with further studying and tracing to the instdso.sh script\nI noticed that \n\n--snip--\nrm -f /usr/local/apache2/modules/libphp5.so\n--snip-- \n\nis removed first as to remove the older or obselote file.  Then the next part\nget executed..\n\n--snip--\n/usr/local/apache2/build/libtool --mode=install cp libphp5.la\n/usr/local/apache2/modules/\n--snip--\n\nwhich does in fact copy both files, libphp5.a and libphp5.la files, not the\nlibphp5.so file.  So, hte next few part of the script which use sed.  With some\ntracing and execution of a shell script.  I get\n\n--snip--\nlibphp5.so\n\n\nlibphp5.a libphp5.a\n\n\nlibphp5.a libphp5.a\n--snip--\n\nand no sed error.  So, we the patch is working as it fix this bug.  Then further\nbelow in the script is a \"rm -f ....\" script that remove those libphp5.a files\nso it explained why there's no libphp5.* files in that directory.  Which lead us\nto the next part of the script that caused the \n\n--snip--\nWarning!  dlname not found in /usr/local/apache2/modules/libphp5.la.\n--snip--\n\nto appear.  Then the next part of the script here\n\n--snip--\nif test \"$DLNAME\" != \"$TARGET_NAME\"\nthen\n    mv $TARGETDIR/$DLNAME $TARGETDIR/$TARGET_NAME\nfi\n--snip--\n\nwhere the \"if test\" script produced a result..\n\n--snip--\nif test \"libphp5.so\" != \"libphp5.so\"\nthen \n    mv /usr/local/apache2/modules/libphp5.so /usr/local/apache2/modules/\nfi\n--snip--\n\nSo, this part of the script is correct and there's still no libphp5.so in that\ndirectory at all.  The next part of the script just removed everything.  So, no\nwonder why I get the apxs errors and chmod error.  The libphp5.so is never\ncopied over in the first place.\n\nI'm looking forward to a further patch fix that would allow the libphp5.so to be\nput into the /usr/local/apache2/module directory...  It is just a bad script.\n\nSo, go ahead and check in that patch fix as it fix this AIX sed problem....", "id": 86411, "time": "2006-03-02T17:12:50Z", "bug_id": 38108, "creation_time": "2006-03-02T17:12:50Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "text": "Nice work Masaoki, was that patch to fix the issue with the AIX sed too?  We've\nhad a report of a similar error on Solaris too (bug 38696) so I've asked whether\nthis fix works there too.", "attachment_id": null, "bug_id": 38108, "id": 86444, "time": "2006-03-03T12:11:48Z", "creator": "jorton@redhat.com", "creation_time": "2006-03-03T12:11:48Z", "is_private": false}, {"count": 13, "tags": [], "creator": "jorton@redhat.com", "text": "this time, adding CC:\n\nNice work Masaoki, was that patch to fix the issue with the AIX sed too?  We've\nhad a report of a similar error on Solaris too (bug 38696) so I've asked whether\nthis fix works there too.", "id": 86445, "time": "2006-03-03T12:13:15Z", "bug_id": 38108, "creation_time": "2006-03-03T12:13:15Z", "is_private": false, "attachment_id": null}, {"count": 14, "tags": [], "bug_id": 38108, "attachment_id": null, "text": "> was that patch to fix the issue with the AIX sed too?\nYea, for the AIX sed?", "id": 86456, "time": "2006-03-03T15:21:55Z", "creator": "scott@abcoa.com", "creation_time": "2006-03-03T15:21:55Z", "is_private": false}, {"count": 15, "tags": [], "creator": "masaoki@techfirm.co.jp", "attachment_id": null, "is_private": false, "id": 86502, "time": "2006-03-06T03:31:38Z", "bug_id": 38108, "creation_time": "2006-03-06T03:31:38Z", "text": "Actually I don't have AIX environment.  This was not the right place to post the\npatch.  However, I guess, this should be common problem as just sed script\nstring was wrong.  I confirmed my pacth works on RedHat 7.3 x86 and Solaris 10 x86."}, {"count": 16, "tags": [], "bug_id": 38108, "is_private": false, "id": 86510, "attachment_id": null, "creator": "jorton@redhat.com", "creation_time": "2006-03-06T09:57:27Z", "time": "2006-03-06T09:57:27Z", "text": "*** Bug 38696 has been marked as a duplicate of this bug. ***"}, {"count": 17, "attachment_id": null, "bug_id": 38108, "is_private": false, "id": 86518, "time": "2006-03-06T15:00:12Z", "creator": "sfletcher@abcoa.com", "creation_time": "2006-03-06T15:00:12Z", "tags": [], "text": "I meant to say this patch fix for AIX's sed now work without a problem.  So, \nit's a good thing you posted here.  Since you mentioned Red Hat too.  (Along \nwith Sun)\n\nOS --> All\n\nLet us know the patch had been check into the branch.\n\nThe newer problem I have is not a sed bug (with the patch fix) so I'll file a \nnew bug later (cleaner bug report) on this week or next week as soon as I \nfinish rebuilting AIX from scratch.  (Well PHP folks said I need GNU Linker \nwhich doesn't solve the problem.  Also later learned that GNU Linker doesn't \nwork too well with AIX as it's incompactible with AIX and IBM's web site said \nwe only need to use the AIX's native sed instead of the GNU linker.  A sign of \nfurther messed up.)"}, {"count": 18, "tags": [], "creator": "masaoki@techfirm.co.jp", "attachment_id": null, "text": "The original sed script works fine on GNU sed 4.1.2, while it does not on GNU \nsed 3.1 or Solaris sed.\nThe patched script works fine on all of above.", "id": 86556, "time": "2006-03-07T07:34:20Z", "bug_id": 38108, "creation_time": "2006-03-07T07:34:20Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 38108, "text": "Filed bug #39099 for the php module that doesn't work in Apache 2.2.0.  Any\nchance of anyone testing this patch any further or checking it in to the branch\nwithout breaking it before the next Apache release?  I thought I did see\nsomewhere in the Apache file that specify the minimum GNU Sed version somewhere\nbut I couldn't find it.\n\nIs the reason for this bug being unchanged due to not assigning the bug to\nbugs@httpd.apache.org instead of leaving it as new?  This bugzilla is a little\nconfusing as I'm so used to the Mozilla's bugzilla.  Sorry for the spam if I\nmisunderstood.", "count": 19, "id": 87232, "time": "2006-03-24T20:36:47Z", "creator": "scott@abcoa.com", "creation_time": "2006-03-24T20:36:47Z", "is_private": false}, {"count": 20, "tags": [], "bug_id": 38108, "attachment_id": null, "id": 87395, "time": "2006-03-29T15:13:58Z", "creator": "jorton@redhat.com", "creation_time": "2006-03-29T15:13:58Z", "is_private": false, "text": "No, just lazy engineers lacking round tuits.  This is now committed to the\ntrunk, and proposed for inclusion in 2.2.x.\n\nhttp://svn.apache.org/viewcvs?rev=389797&view=rev\n\nThanks again for the patch, Masaoki."}]
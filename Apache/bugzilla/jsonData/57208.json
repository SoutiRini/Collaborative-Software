[{"count": 0, "text": "When JNDIRealm does a \"getUserBySearch\", and no results are found, a null object is returned.  This causes a NPE in the next few lines where it tries to create a user.\n\n       if (userPatternFormatArray != null && curUserPattern >= 0) {\n            user = getUserByPattern(context, username, credentials, attrIds, curUserPattern);\n        } else {\n            user = getUserBySearch(context, username, attrIds);\n        }\n\n        if (userPassword == null && credentials != null) {\n            // The password is available. Insert it since it may be required for\n            // role searches.\n            return new User(user.getUserName(), user.getDN(), credentials,\n                    user.getRoles(), user.getUserRoleId());\n        }\n\n\nShould probably be changed to:\n\n       if (userPatternFormatArray != null && curUserPattern >= 0) {\n            user = getUserByPattern(context, username, credentials, attrIds, curUserPattern);\n            containerLog.debug(\"Found user by pattern (\" + user + \")\");\n        } else {\n            user = getUserBySearch(context, username, attrIds);\n            containerLog.debug(\"Found user by search (\" + user + \")\");\n        }\n\n        if (userPassword == null && credentials != null && user != null) {\n            // The password is available. Insert it since it may be required for\n            // role searches.\n            return new User(user.getUserName(), user.getDN(), credentials,\n                    user.getRoles(), user.getUserRoleId());\n        }", "bug_id": 57208, "attachment_id": null, "id": 179087, "time": "2014-11-13T17:16:12Z", "creator": "jasonmcintosh@carfax.com", "creation_time": "2014-11-13T17:16:12Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 57208, "attachment_id": null, "id": 179089, "creation_time": "2014-11-13T18:44:43Z", "time": "2014-11-13T18:44:43Z", "creator": "knst.kolinko@gmail.com", "text": "Regression from r1628538/r1628524.\n\nTomcat 6 does not have that code and is not affected. (It does not have roleSearchAsUser options, an issue with which was fixed by that r1628538).", "is_private": false}, {"count": 2, "text": "Hi,\n\nThanks for the report and patch.\nThis is fixed in 7.0.x and 8.0.x and will be available in 7.0.58 and 8.0.16 onwards.\n\nRegards,\nVioletag", "bug_id": 57208, "attachment_id": null, "id": 179103, "time": "2014-11-14T17:17:57Z", "creator": "violetagg@apache.org", "creation_time": "2014-11-14T17:17:57Z", "tags": [], "is_private": false}]
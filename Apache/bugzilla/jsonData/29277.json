[{"count": 0, "tags": [], "bug_id": 29277, "text": "I've recently upgraded my apache+ssl server from version 2.0.48 toapache+ssl\n2.0.49 using mod_worker. \nI use Solaris Sparc as my operating system. After the upgrade my apache server\nbecame really unstable, sometimes it stops responding and only return after a\nrestart.  \nI did a truss atchild and parent process and I found this :\nChild Process... \n17512:  lwp_sema_wait(0xFD109E78)       (sleeping...)\n17512:  lwp_sema_wait(0xFD007E78)       (sleeping...)\n17512:  lwp_sema_wait(0xFDA03E78)       (sleeping...)\n17512:  lwp_sema_wait(0xFBA0BE78)       (sleeping...)\n17512:  lwp_sema_wait(0xFC407E78)       (sleeping...)\n17512:  lwp_sema_wait(0xFC203E78)       (sleeping...)\n17512:  lwp_sema_wait(0xFBC0FE78)       (sleeping...)\n17512:  lwp_sema_wait(0xFCD01E78)       (sleeping...)\n17512:  lwp_sema_wait(0xFC509E78)       (sleeping...)\n17512:  lwp_sema_wait(0xFC101E78)       (sleeping...)\n17512:  lwp_sema_wait(0xFD40FE78)       (sleeping...)\n\nParent Process... \n17104:  poll(0xFFBEF920, 0, 1000)                       = 0\n17104:  write(9, \" !\", 1)                               = 1\n17104:  waitid(P_ALL, 0, 0xFFBEF8D0, WEXITED|WTRAPPED|WSTOPPED|WNOHANG)= 0\n17104:  poll(0xFFBEF920, 0, 1000)                       = 0\n17104:  write(9, \" !\", 1)                               = 1\n17104:  waitid(P_ALL, 0, 0xFFBEF8D0, WEXITED|WTRAPPED|WSTOPPED|WNOHANG)= 0\n\nIt seems that all child process get locked, and the parent stay in loop waiting\nfor a change at it's child status. \nMy errorlog file shows a Segmentation Fault at a child process exactly at the\nmoment of the \"not responding\" apache. \n\n[Fri May 21 14:41:03 2004] [notice] child pid 17483 exit signal Segmentation\nfault (11)\n\nDoes anyone has a clue about it?", "id": 58314, "time": "2004-05-28T14:10:31Z", "creator": "guilhermeassad@uol.com.br", "creation_time": "2004-05-28T14:10:31Z", "is_private": false, "attachment_id": null}, {"count": 1, "text": "Best doc for a web server hang condition is to run pstack against each web\nserver process and post the results.\n\nThere are two known issues which you may be suffering from:\n\n1) ssl-related child process crash introduced in 2.0.49\n\nSee PR27945.  Here is the fix for that problem:\n\nhttp://cvs.apache.org/viewcvs.cgi/httpd-2.0/modules/ssl/ssl_engine_io.c?r1=1.121&r2=1.122\n\n2) hang after crash when using pthread accept mutex (the default on Solaris)\n\n(this is not at all obvious from your truss, but pstack of all children when in\nthis hung state should give more definitive info)\n\nVery possibly the child process crash (segmentation fault) resulted in screwing\nup the accept mutex, which in turn hung the server.\n\nTry switching to non-default accept mutex type, by adding this to httpd.conf:\n\nAcceptMutex fcntl\n\nThis has nothing to do with the child process crash, but it should resolve web\nserver hangs that occur after a crash due to loss of accept mutex.\n", "creator": "trawick@apache.org", "attachment_id": null, "id": 58325, "time": "2004-05-28T15:08:18Z", "bug_id": 29277, "creation_time": "2004-05-28T15:08:18Z", "tags": [], "is_private": false}, {"count": 2, "text": "Presuming this was a duplicate of bug 27945.  The \"segfaults can hang a threaded\nserver\" issue was fixed in 2.0.50ish as well.\n\n*** This bug has been marked as a duplicate of 27945 ***", "creator": "jorton@redhat.com", "attachment_id": null, "id": 72131, "time": "2005-03-10T14:44:27Z", "bug_id": 29277, "creation_time": "2005-03-10T14:44:27Z", "tags": [], "is_private": false}]
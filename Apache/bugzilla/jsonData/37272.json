[{"attachment_id": null, "tags": [], "bug_id": 37272, "is_private": false, "count": 0, "id": 81830, "time": "2005-10-27T17:34:52Z", "creator": "simeon.greene@gmail.com", "creation_time": "2005-10-27T17:34:52Z", "text": "I wrote a custom ant task that collects the JSR-181 annotations in a specified\nclass and performs some proprietary functions.  (I know that there is an apt\ntask that does something similar but we are not using that in our product). \nThere appears to be some class loading issues when I try to do annotation\nprocessing from my task.  For example if the following class was provided to the\ntask:\n\n@WebService(name=\"myService)\npublic class MyWebService{\n   public String doSomething(){return \"something\";}\n}\n\nWhen this class is loaded using:\n\n  endpointClass = class.forName(MyWebService,classLoaderFromUserClasspath)\n\nI cannot get the @WebService annotation which is clearly in the class.  For\nexample when I call endpointClass.getAnnotation(WebService.class) it returns\nnull.  Oddly enough, if my task uses Java to invoke a separate process that does\nthe annotation processing the same code works."}, {"count": 1, "tags": [], "bug_id": 37272, "attachment_id": null, "text": "This is just bizarre. I wonder if Ant's own classloader is interfering with\nannotation enumeration. But how?", "id": 91236, "time": "2006-07-12T21:58:03Z", "creator": "stevel@apache.org", "creation_time": "2006-07-12T21:58:03Z", "is_private": false}, {"count": 2, "tags": [], "creator": "peterreilly@apache.org", "text": "Hi I have a little look at this and cannot get the\nproblem to occur:\nbuild.xml\n<project default=\"build\">\n  <target name=\"build.other\">\n    <mkdir dir=\"build/other/classes\"/>\n    <javac srcdir=\"other\" destdir=\"build/other/classes\" debug=\"yes\"/>\n  </target>\n  <target name=\"build\" depends=\"build.other\">\n    <mkdir dir=\"build/classes\"/>\n    <javac srcdir=\"src\" destdir=\"build/classes\" debug=\"yes\"/>\n    <taskdef name=\"webtest\" classname=\"test.Test\"\n             classpath=\"build/classes\"/>\n    <webtest classname=\"other.Other\">\n      <path path=\"build/other/classes\"/>\n    </webtest>\n  </target>\n  <target name=\"clean\">\n    <delete quiet=\"yes\" dir=\"build\"/>\n  </target>\n</project>\n\nTest.java:\npackage test;\nimport org.apache.tools.ant.*;\nimport org.apache.tools.ant.types.*;\nimport javax.xml.ws.WebServiceProvider;\n\npublic class Test extends Task {\n    private String classname;\n    private Path   path;\n\n    public void add(Path path) {\n        if (this.path != null) {\n            throw new BuildException(\"Only one path allowed\");\n        }\n        this.path = path;\n    }\n    \n    public void setClassname(String classname) {\n        this.classname = classname;\n    }\n    public void execute() {\n        if (path == null) {\n            throw new BuildException(\"Need to specify a path\");\n        }\n        if (classname == null) {\n            throw new BuildException(\"Need to specify a classname\");\n        }\n        ClassLoader loader = getProject().createClassLoader(\n            path);\n        try {\n            Class endpointClass = Class.forName(\n                classname, true, loader);\n            System.out.println(endpointClass.getAnnotation(\n                                   WebServiceProvider.class));\n        } catch (Throwable t) {\n            throw new BuildException(t);\n        }\n    }\n}\n\nOther.java\npackage other;\n\n\nimport javax.xml.ws.WebServiceProvider;\n\n@WebServiceProvider(serviceName=\"myService\")\npublic class Other{\n   public String doSomething(){return \"something\";}\n}\n\nlayout:\n   build.xml\n   src/test/Test.java\n   other/other/Other.java\n\nrunning output:\nNote: C:\\cygwin\\home\\peter\\learning\\web\\src\\test\\Test.java uses unchecked or\nunsafe operations.\n\nNote: Recompile with -Xlint:unchecked for details.\n\n@javax.xml.ws.WebServiceProvider(wsdlLocation=, targetNamespace=, portName=,\nserviceName=myService)\n\n\n\nBUILD SUCCESSFUL\n\n--\nI suspect that you have a classloading problem\nthe @WebService class in your task is loaded from\na different classloader than the @WebService class\nthat the MyWebService class sees.\n\nCan you provide an example tar/zip file containing\nthe problem?", "id": 94318, "time": "2006-09-30T14:38:07Z", "bug_id": 37272, "creation_time": "2006-09-30T14:38:07Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "peterreilly@apache.org", "text": "Created attachment 18943\nA tar file containing the build file and java source files", "id": 94319, "time": "2006-09-30T14:40:01Z", "bug_id": 37272, "creation_time": "2006-09-30T14:40:01Z", "is_private": false, "attachment_id": 18943}, {"count": 4, "tags": [], "text": "The example I gave uses jdk6.\n", "is_private": false, "id": 94321, "creator": "peterreilly@apache.org", "time": "2006-09-30T15:00:41Z", "bug_id": 37272, "creation_time": "2006-09-30T15:00:41Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 37272, "text": "Marking as WORKSFORME as I am nearly certain that\nthat is a case of the inverted Y classloader scenario.\n\n       c.jar\n      /    \\\n     /      \\\n    /        \\\n   |          \\\n   181.jar   181.jar\n   |            |\n   |            |\n   annotated    |\n   class        task\n\n  ", "count": 5, "id": 94830, "time": "2006-10-13T15:58:43Z", "creator": "peterreilly@apache.org", "creation_time": "2006-10-13T15:58:43Z", "is_private": false}]
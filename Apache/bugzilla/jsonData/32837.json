[{"count": 0, "tags": [], "creator": "tom@tbee.org", "attachment_id": null, "text": "The situation is somewhat complex:\n\n- There is a webapp using JDBCRealm\n- In the webapp there is a Java Web Start application.\n  The JNLP URL is not part of the realm because of an IE cache bug.\n- There is a Hessian service that is used from the JWS application.\n  (Hessian is a binary protocol via HTTP for remote method invocation.)\n  The Hessian service (servlet) is part of the realm otherwise\n  the principal might not be set (there is a bug # about this).\n\nThe Hessian servlet needs to know the logged in user for its DB access. This \nmeans it has to execute getUserPrincipal and therefor needs to be part of the \nsame session as was authenicated. \n\nHowever a JWS app does not inherit the cookies of its browser. To solve this, \nthe URL accessing the Hessian servlet has a \";jsessionid=\" set (the sessionid \nis passed via de dynamically generated JNLP file).\n\nWhat happens the first time the application is started:\n- Open index.html: login dialog appears\n- Login is succesful\n- Click on JNLP file\n- JNLP is generated with current sessionid inside\n- JWS application is downloaded\n- JWS constructs the URL with \";jsessionid=\" attached\n- Login dialog appears (by JWS)\n- Hessian service is access within same session.\n\nSo the solution works, but there is a second login by the JWS enviroment. If \nthe browser is stopped and restarted, there is no second login. \n\nSince the need for the login is determined by the webapp server (Tomcat) I must \nplace the cause for this behaviour at Tomcat. This happens with 4.1.29 and \n5.5.4. \n\nSpecifying the session id via \";jsessionid=\" is a valid way to attach to a \nsession, so it currently is my opinion this behaviour is not correct.", "id": 68954, "time": "2004-12-24T10:22:44Z", "bug_id": 32837, "creation_time": "2004-12-24T10:22:44Z", "is_private": false}, {"count": 1, "tags": [], "creator": "tfohrer@t-online.de", "attachment_id": null, "is_private": false, "id": 69002, "time": "2004-12-26T21:13:14Z", "bug_id": 32837, "creation_time": "2004-12-26T21:13:14Z", "text": "I tried the same within a application that uses form-login and 2 different\nbrowsers: Mozilla and Konqueror.\n\n  1. Disable cookies for site in mozilla\n  2. Login with Mozilla\n  3. Take \";jsessionid=xxxx\" url\n  4. Try to access a protected page with konqueror by simply\n     add \";jsessionid=xxxx\" to url\n  5. Tomcat returns the page, without additional login.\n\nSo it's work for me, with url rewriting."}, {"count": 2, "tags": [], "bug_id": 32837, "attachment_id": null, "text": "The first login is done using cookies, the second occurs when the session id is \npassed via URL rewriting. Your test does not emulate that part of the \nbehaviour, maybe it is associated with this aspect. I'm going to create a \nsimplified application for reproduction purposes... next year ;-)", "id": 69090, "time": "2004-12-30T18:16:12Z", "creator": "tom@tbee.org", "creation_time": "2004-12-30T18:16:12Z", "is_private": false}, {"count": 3, "text": "I tried what Torsten tried, with cookies, using the admin webapp (login with\nfirefox, retrieve cookie using the cookie viewer, open IE and access\nhttp://127.0.0.1:8080/admin/frameset.jsp;jsessionid=xxxxxxxxxx). It works fine.\nIf I remove the ;jsessionid a new session is created and I have to login again.", "bug_id": 32837, "attachment_id": null, "id": 69359, "time": "2005-01-07T15:58:02Z", "creator": "remm@apache.org", "creation_time": "2005-01-07T15:58:02Z", "tags": [], "is_private": false}, {"attachment_id": 13933, "tags": [], "creator": "tom@tbee.org", "text": "Created attachment 13933\nbug test code without libs\n\nThis file contains a webapp to demonstrate the bug", "count": 4, "id": 69406, "time": "2005-01-07T23:24:20Z", "bug_id": 32837, "creation_time": "2005-01-07T23:24:20Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 32837, "attachment_id": 13934, "id": 69407, "time": "2005-01-07T23:25:09Z", "creator": "tom@tbee.org", "creation_time": "2005-01-07T23:25:09Z", "is_private": false, "text": "Created attachment 13934\nthe libs without OracleJDBC"}, {"count": 6, "tags": [], "bug_id": 32837, "text": "I've attached a demonstration application showing the behaviour. Accessing the \nindex page requires a login due to the realm (see below).\n\n        <Context path=\"/dhtest\" docBase=\"C:\\Documents and Settings\\tom\\My \nDocuments\\kp\\llflex\\llflex\\container\\dhtest\\_build\" debug=\"0\" reloadable=\"true\">\n\t      <Realm  className=\"org.apache.catalina.realm.JDBCRealm\" debug=\"99\"\n\t             driverName=\"oracle.jdbc.driver.OracleDriver\"\n\t          connectionURL=\"jdbc:oracle:thin:@localhost:1521:ORCL\"\n\t         connectionName=\"usr\" connectionPassword=\"pwd\"\n\t              userTable=\"P_PERSON\" userNameCol=\"init\" \nuserCredCol=\"CPASSWORD\"\n\t          userRoleTable=\"P_PERSON\" roleNameCol=\"CUSERROLE\" />\n        </Context>\n\nThen starting the webapp version of the application works ok, but when it \naccesses the Hessian URL (with the ;jsessionid) you must login again.\n", "id": 69408, "time": "2005-01-07T23:27:00Z", "creator": "tom@tbee.org", "creation_time": "2005-01-07T23:27:00Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "remm@apache.org", "text": "I'm not going to test this, sorry. I recommend you look into it further if\nyou're having a specific issue.", "count": 7, "id": 69411, "time": "2005-01-07T23:48:32Z", "bug_id": 32837, "creation_time": "2005-01-07T23:48:32Z", "is_private": false}, {"count": 8, "text": "Too bad, although I do not understand the \"specific issue\" remark. Can I get \nmore specific than having a fully testable example of the bug?\n\nThe problem is straight forward:\n- get a resource from a realmed context requires a login (cookies)\n- the downloaded resource connects to the same context WITHOUT cookies but \nusing the jsessionid and requires another login\n\nNow, I appriciate you tried to mimick this, but you probably know as well as I \ndo that there is often this one typical thing that causes a bug to occur.\n\nI understand the provided code may appear rather complex, but it is a lot less \nthan me having to dig into the depths of Tomcat! So one final attempt to get \nsome help, it isn't much work, really! :-) \n- Extract the two RARs into a directory, \n- define a context in server.xml, you can use any realm for the context \n  (that is why I left out the Oracle JDBC jar),\n- open a webbrowser, \n- goto the index, \n- login, \n- click \"webapp\", \n- login again. \n\nDoesn't seem more complex than any other bug to me...", "bug_id": 32837, "attachment_id": null, "id": 69420, "time": "2005-01-08T08:00:16Z", "creator": "tom@tbee.org", "creation_time": "2005-01-08T08:00:16Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "creator": "tom@tbee.org", "attachment_id": null, "text": "Oh, the downloaded webapp requires Java1.5", "id": 69421, "time": "2005-01-08T08:13:31Z", "bug_id": 32837, "creation_time": "2005-01-08T08:13:31Z", "is_private": false}, {"count": 10, "text": "I do not believe in looking at someones code and finding what's broken, that's\nthe issue.\nI should be able to duplicate this with my own, identical, procedure.\n\nI recommend you investigate your problem more.", "bug_id": 32837, "attachment_id": null, "id": 69422, "time": "2005-01-08T08:15:08Z", "creator": "remm@apache.org", "creation_time": "2005-01-08T08:15:08Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 32837, "attachment_id": null, "id": 69443, "time": "2005-01-08T21:21:32Z", "creator": "tom@tbee.org", "creation_time": "2005-01-08T21:21:32Z", "is_private": false, "text": "I believe there is no need to examine my code, you only need to determine what \nrequest arrive at the server and why the server issues a basic auth on the \nsecond request. \n\nHowever I do not understand think you can reproduce a bug without following the \nexact sequence of actions that result in the bug. The description only talks \nabout the symptoms, not the cause, so by doing something that could give the \nsame symptoms, one is not reproducing the bug. Both a cold and a infection can \ncause fever. You can't diagnose an infection by putting someone outdoors in a \nboxershort. \n\nBut I'm probably mistaken, so I'll download the sources. Thanks for the effort."}, {"count": 12, "tags": [], "creator": "tom@tbee.org", "attachment_id": null, "text": "It's late, forgive the typo's.", "id": 69444, "time": "2005-01-08T21:23:54Z", "bug_id": 32837, "creation_time": "2005-01-08T21:23:54Z", "is_private": false}, {"count": 13, "text": "Since I also had problems with relogin and the session data getting lost, and \nwith JNLP files having no-cache settings under IE, I decided to leave the \nTomcat authentication and write a security filter (doing both BASIC and FORM \nlogin).\n\nDuring development I noticed that even though Java Web Start can mimick a \nsession (using \";jsessionid=xxxx\"), the load-the-jar routines work outside this \nconnection and the downloads cause the authentication popup.\n\nSo there indeed is no error in Tomcat and the solution should be searched in \nfine tuning the secured domain or convincing JWS to use the established session.\n", "bug_id": 32837, "attachment_id": null, "id": 71873, "time": "2005-03-06T10:24:27Z", "creator": "tom@tbee.org", "creation_time": "2005-03-06T10:24:27Z", "tags": [], "is_private": false}]
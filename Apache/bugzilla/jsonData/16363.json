[{"count": 0, "tags": [], "creator": "rob@relicore.com", "attachment_id": null, "id": 29936, "time": "2003-01-23T14:35:38Z", "bug_id": 16363, "creation_time": "2003-01-23T14:35:38Z", "is_private": false, "text": "We're running a standalone Tomcat 3.2.4 installation (yes, I know I marked this \nas 3.2.3 Final, but there's no option for 3.2.4 Final) under Sun JDK 1.4.1 \n(Win2K or Solaris 2.8), with the jar files containing our code having been \ncompiled under Sun JDK 1.3.1.  Hitting a certain page will invariably cause a \nStack Overflow.  I was able to capture one in-progress:\n\n\"Thread-28\" prio=5 tid=0x24C65070 nid=0x698 runnable [2bb4c000..2bb4fd8c]\n\tat java.lang.Class.getName(Native Method)\n\tat org.apache.tomcat.core.ContextManager.handleError\n(ContextManager.java:1146)\n\tat org.apache.tomcat.core.Handler.service(Handler.java:312)\n\tat org.apache.tomcat.core.ServletWrapper.service\n(ServletWrapper.java:372)\n\tat org.apache.tomcat.core.ContextManager.handleError\n(ContextManager.java:1177)\n\t...\n\tat org.apache.tomcat.core.Handler.service(Handler.java:312)\n\tat org.apache.tomcat.core.ServletWrapper.service\n(ServletWrapper.java:372)\n\tat org.apache.tomcat.core.ContextManager.handleError\n(ContextManager.java:1177)\n\tat org.apache.tomcat.core.Handler.service(Handler.java:312)\n\tat org.apache.tomcat.core.ServletWrapper.service\n(ServletWrapper.java:372)\n\tat org.apache.tomcat.core.ContextManager.handleError\n(ContextManager.java:1177)\n\tat org.apache.tomcat.core.ContextManager.service\n(ContextManager.java:759)\n\tat \norg.apache.tomcat.service.http.HttpConnectionHandler.processConnection\n(HttpConnectionHandler.java:213)\n\tat org.apache.tomcat.service.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:416)\n\tat org.apache.tomcat.util.ThreadPool$ControlRunnable.run\n(ThreadPool.java:501)\n\tat java.lang.Thread.run(Thread.java:536)\n\nThe \"...\" is mine - the trace was 250 lines long when I nabbed it.\n\nThe page that seems to trigger it has the following general structure:\n\n=====================\n<%@ page language=\"java\" contentType=\"text/html\"%>\n<%@ page import blah blah blah%>\n<%@ include file=\"newToolbarSetup.jsp\"%>\n<%\njava code\n%>\n\n<HTML>\n<HEAD>\nblah blah blah\n</HEAD>\n\n<%@ include file=\"newToolbar.jsp\"%>\n</HTML>\n=====================\nnewToolbarSetup.jsp is as follows:\n\n<%@ page errorPage=\"badstate.jsp?debug=log\" %>\n<%\nvarious Java code setting attrs on request and response and\ndoing some calculation and variable definition\n%>\n=====================\nnewToolbar.jsp is as follows:\n<%\njava code\n%>\n<BODY>\nstuff\n</BODY>\n=====================\nbadstate.jsp is as follows:\n<%@ page language=\"java\" contentType=\"text/html\" %>\n<%@ page import blah blah blah%>\n<%@ page isErrorPage=\"true\" %>\n<%\njava code\n%>\n<HTML>\n<HEAD>\nstuff\n</HEAD>\n<BODY>\nstuff\n</BODY>\n</HTML>\n=====================\n\n\n\nThis worked fine under Tomcat 3.2.4 and JDK 1.3.1, and broke immediately when \nwe switched to JDK 1.4.1.  As an experiment, I subbed JDK 1.3.1 back in, \ndeleted all of the files in my work directory, and verified that it still works \nunder 1.3.1.  Then, if I delete the work files again and sub 1.4.1 back in, it \nbreaks again.  So it looks like a Tomcat 3.2.4/JDK 1.4.1 incompatibility.  But \nI've been unable to find anything documented."}, {"count": 1, "tags": [], "creator": "rob@relicore.com", "text": "We've been investigating this one a bit more, and have the following to add:\n\n1. The problem seems to be triggered when the browser breaks a connection to an \ncompiled-by-Tomcat page unexpectedly.  The following lines invariably show up \nin the tc.log file (if I turn up logging):\n\nCtx( /emx ): IOException in: R( /emx + SOME_JSP_FILE + null) Software caused \nconnection abort: socket write error\nCtx( /emx ): IllegalStateException in: R( /emx + SOME_JSP_FILE + null) Current \nstate = FLUSHED, new state = CODING_END\nCtx( /emx ): Error: exception inside exception servlet null class \njava.net.SocketException\nCtx( /emx ): IllegalStateException in: R( /emx + SOME_JSP_FILE + null) Current \nstate = FLUSHED, new state = CODING\nCtx( /emx ): Error: exception inside exception servlet null class \njava.lang.IllegalStateException\nCtx( /emx ): IllegalStateException in: R( /emx + SOME_JSP_FILE + null) Current \nstate = FLUSHED, new state = CODING\nCtx( /emx ): Error: exception inside exception servlet null class \njava.lang.IllegalStateException\nrepeat ad naseaum and ad out-of-memoriam\n\n\n\n2. Notice that I said that Tomcat had to compile the page.  If we pre-compile \nthe JSPs into servlets and create explicit servlet mappings, the problem goes \naway.  This implies to me that this bug is in Jasper, so I've changed \nthe \"Component\" for this bug report.\n\n\n\n3. We've tried the following combinations.  The first three lines indicate what \nversion of the JDK the code in question was compiled under.  \"P\" in the JSPs \nline indicates pre-compiled JSPs as I describe above; lack of \"P\" indicates \nJasper-compiled JSPs.  I've abbreviate for brevity - 1.3 is 1.3.1_04 and 1.4 is \n1.4.1_01\n\nTomcat 3.2.4  1.3  1.3  1.4  1.3  1.4  1.3  1.4  1.3\nJSPs          1.4  1.3P 1.4  1.3P 1.4  1.4  1.4P 1.4P\nOur Code      1.3  1.3  1.3  1.3  1.4  1.4  1.4  1.4\nRuntime       1.4  1.3  1.4  1.4  1.4  1.4  1.4  1.4\nResult        FAIL OK   FAIL OK   FAIL FAIL ???  ???\n\nWe decided not to test the last two cases because they don't help us much - we \nneed a combination that will let us run without pre-compiling the JSPs.  \nHowever, if whoever picks up this bug feels it'll be helpful, we can run them \nfairly quickly.\n\n\n4. No clue whether this happens in later versions of Tomcat.  We were going to \nconvert to 4.x but ran into problems (not me, so I don't know the details) and \nwe dropped it.  Now that this is happening, we're going to try to tackle it \nagain to see what happens.  I'll update this bug when we know.", "id": 30007, "time": "2003-01-24T13:59:30Z", "bug_id": 16363, "creation_time": "2003-01-24T13:59:30Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "markt@apache.org", "text": "Tomcat 3 is no longer the focus of development.\n\nIt is almost certain there will be no development work on versions prior to 3.3.x and it is highly unlikely that further development will take place on 3.3.x\n\nAll open Tomcat 3 bugs are therefore being closed as WONTFIX.\n\nIf any of these issues is still a problem for you, please test the latest stable release of a supported version (http://wiki.apache.org/tomcat/TomcatVersions). If you still have the issue with the latest stable release of a supported version, please re-open this bug and change the version to the one you tested.", "id": 114113, "time": "2008-02-28T11:46:17Z", "bug_id": 16363, "creation_time": "2008-02-28T11:46:17Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 38085, "attachment_id": null, "is_private": false, "id": 84102, "time": "2006-01-01T02:14:32Z", "creator": "rdevenezia@wildblue.net", "creation_time": "2006-01-01T02:14:32Z", "text": "This information was also posted to Apache-Tomcat listserv.\n\nThe sample perl program demonstrates the issue.\n\nWhen a form has enctype=\"multipart/form-data\" the data on cgi's STDIN (as passed\nfrom cgiservlet) contains the QUERY_STRING in line 1 -- This is wrong.  \n\nIf using CGM.pm, it will error with a \"Malformed multipart POST\" because the\nSTDIN data and the CONTENT_LENGTH are out of sync. [The content being delivered\non STDIN is now longer than that reported by CONTENT_LENGTH ]\n\nAn untested work around (for perlers) is to tweak the perl script:\nset content_length = content_length + length(query_string) + 2, iff\nx_tomcat_script_path ne \"\" && content_type =~ #multipart/form-data#\n\n#!c:\\usr\\bin\\perl\n##\n##  printenv -- demo CGI program which just prints its environment\n##\n\nprint <<HTML;\nStatus: 200\nContent-type: text/html\n\n<html><body>\n<form\naction=\"?ARG1=FOO&ARG2=BAR\"\nmethod=\"post\"\nenctype=\"multipart/form-data\"\nstyle=\"float:left\"\n\n<input type=text name=A value=123><br>\n<input type=text name=B value=456><br>\n<input type=text name=C value=789><br>\n<input type=text name=D value=314><br>\n<input type=text name=E value=123><br>\n<input type=text name=F value=456><br>\n<input type=text name=G value=789><br>\n<input type=text name=H value=314159><br>\n<input type=submit>\n</form>\nHTML\n\nprint \"<PRE>\";\nforeach $var (sort(keys(%ENV))) {\n    $val = $ENV{$var};\n    $val =~ s|\\n|\\\\n|g;\n    $val =~ s|\"|\\\\\"|g;\n    print \"${var}=\\\"${val}\\\"\\n\";\n}\n\nprint \"</PRE>\";\n\nif ($ENV{'REQUEST_METHOD'} eq \"POST\") {\n    CORE::binmode(STDIN); # good ole dos\n    read (STDIN, $post, $ENV{'CONTENT_LENGTH'});\n    print \"<HR><PRE>!\" . $post . \"!!! THAT'S ALL FOLKS!</PRE>\";\n\n}\n\nprint \"\\n</html></body>\";\n\nresults in\n...\nQUERY_STRING=\"ARG1=FOO&ARG2=BAR\"\n...\n!ARG1=FOO&ARG2=BAR\n\n-----------------------------33251965624481\n\nContent-Disposition: form-data; name=\"A\"\n\n123\n\n-----------------------------33251965624481\ndot dot dot\n-----------------------------33251965624481\n\nContent-Disposition: form-data; name=\"H\"\n\n314159\n\n-----------------------------3!!! THAT'S ALL FOLKS!\n\nthe content delivered to the cgi ends at 3 and 3251965624481<crlf><crlf> has\ngone missing, which in turn makes CGI.pm error.\n\n\"3251965624481<cr><lf><cr><lf>\" is the same length as\n\"ARG1=FOO&ARG2=BAR\""}, {"attachment_id": null, "tags": [], "bug_id": 38085, "is_private": false, "count": 1, "id": 84118, "time": "2006-01-02T08:51:13Z", "creator": "rdevenezia@wildblue.net", "creation_time": "2006-01-02T08:51:13Z", "text": "This appears to be the same as 37285"}, {"count": 2, "tags": [], "bug_id": 38085, "is_private": false, "text": "Indeed it is.\n\n*** This bug has been marked as a duplicate of 37285 ***", "id": 84125, "time": "2006-01-02T14:54:02Z", "creator": "markt@apache.org", "creation_time": "2006-01-02T14:54:02Z", "attachment_id": null}]
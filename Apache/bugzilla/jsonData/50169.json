[{"count": 0, "tags": [], "creator": "mashmk02@gmail.com", "attachment_id": 26220, "text": "Created attachment 26220\npatch for StandardContext and StandardWrapper\n\nWhen I used \"Host start operation\" via JMX, I got error messages.\n\n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWrapper\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWrapper\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWrapper\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWrapper\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWrapper\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWrapper\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWelcomeFile\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWelcomeFile\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWelcomeFile\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWelcomeFile\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWelcomeFile\nSEVERE: No context found: \n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWelcomeFile\nSEVERE: No context found: \n\nAt first StandardHost starts /manager context.\n(1) LifecycleState is STARTING_PREP now. Wrapper is not registered because host has not been registered. \n\tMapper.addWrapper(String, String, String, Object, boolean) line: 331\t\n\tMapperListener.containerEvent(ContainerEvent) line: 169\t\n\tStandardWrapper(ContainerBase).fireContainerEvent(String, Object) line: 1253\t\n\tStandardWrapper.addMapping(String) line: 740\t\n\tStandardContext.addServletMapping(String, String, boolean) line: 2921\t\n\tStandardContext.addServletMapping(String, String) line: 2881\t\n\tWebXml.configureContext(Context) line: 1274\t\n\tContextConfig.webConfig() line: 1283\t\n\tContextConfig.configureStart() line: 881\t\n\tContextConfig.lifecycleEvent(LifecycleEvent) line: 315\t\n\tLifecycleSupport.fireLifecycleEvent(String, Object) line: 119\t\n\tStandardContext(LifecycleBase).fireLifecycleEvent(String, Object) line: 89\t\n\tStandardContext.startInternal() line: 4834\t\n\tStandardContext(LifecycleBase).start() line: 140\t\n\tStandardHost(ContainerBase).startInternal() line: 1027\t\n\tStandardHost.startInternal() line: 788\t\n\tStandardHost(LifecycleBase).start() line: 140\t\n\n(2) Set LifecycleState to STARTED. Register context and host on Mapper.\n\tMapper.addHost(String, String[], Object) line: 96\t\n\tMapper.addContext(String, Object, String, Object, String[], Context) line: 226\t\n\tMapperListener.registerContext(Context) line: 339\t\n\tMapperListener.lifecycleEvent(LifecycleEvent) line: 411\t\n\tLifecycleSupport.fireLifecycleEvent(String, Object) line: 119\t\n\tStandardContext(LifecycleBase).fireLifecycleEvent(String, Object) line: 89\t\n\tStandardContext(LifecycleBase).setState(LifecycleState, Object) line: 325\t\n\tStandardContext(LifecycleBase).setState(LifecycleState) line: 305\t\n\tStandardContext(LifecycleBase).start() line: 156\t\n\tStandardHost(ContainerBase).startInternal() line: 1027\t\n\tStandardHost.startInternal() line: 788\t\n\tStandardHost(LifecycleBase).start() line: 140\t\n\n(3) Register wrapper again. It succeeds because context has been registered on Mapper.\n\tMapper.addWrapper(String, String, String, Object, boolean) line: 328\t\n\tMapperListener.registerWrapper(Wrapper) line: 394\t\n\tMapperListener.registerContext(Context) line: 343\t\n\tMapperListener.lifecycleEvent(LifecycleEvent) line: 411\t\n\tLifecycleSupport.fireLifecycleEvent(String, Object) line: 119\t\n\tStandardContext(LifecycleBase).fireLifecycleEvent(String, Object) line: 89\t\n\tStandardContext(LifecycleBase).setState(LifecycleState, Object) line: 325\t\n\tStandardContext(LifecycleBase).setState(LifecycleState) line: 305\t\n\tStandardContext(LifecycleBase).start() line: 156\t\n\tStandardHost(ContainerBase).startInternal() line: 1027\t\n\tStandardHost.startInternal() line: 788\t\n\tStandardHost(LifecycleBase).start() line: 140\t\n\nNext, StandardHost starts ROOT context.\n(4) Register wrapper. Then, gets error as follows because context has not been registered.\n2010/10/28 11:04:10 org.apache.tomcat.util.http.mapper.Mapper addWrapper\nSEVERE: No context found: \n\n\tMapper.addWrapper(String, String, String, Object, boolean) line: 338\t\n\tMapperListener.containerEvent(ContainerEvent) line: 169\t\n\tStandardWrapper(ContainerBase).fireContainerEvent(String, Object) line: 1253\t\n\tStandardWrapper.addMapping(String) line: 740\t\n\tStandardContext.addServletMapping(String, String, boolean) line: 2921\t\n\tStandardContext.addServletMapping(String, String) line: 2881\t\n\tWebXml.configureContext(Context) line: 1274\t\n\tContextConfig.webConfig() line: 1283\t\n\tContextConfig.configureStart() line: 881\t\n\tContextConfig.lifecycleEvent(LifecycleEvent) line: 315\t\n\tLifecycleSupport.fireLifecycleEvent(String, Object) line: 119\t\n\tStandardContext(LifecycleBase).fireLifecycleEvent(String, Object) line: 89\t\n\tStandardContext.startInternal() line: 4834\t\n\tStandardContext(LifecycleBase).start() line: 140\t\n\tStandardHost(ContainerBase).startInternal() line: 1027\t\n\tStandardHost.startInternal() line: 788\t\n\tStandardHost(LifecycleBase).start() line: 140\t\n\n(5) Set LifecycleState to STARTED, and register context.\n\tMapper.addContext(String, Object, String, Object, String[], Context) line: 223\t\n\tMapperListener.registerContext(Context) line: 339\t\n\tMapperListener.lifecycleEvent(LifecycleEvent) line: 411\t\n\tLifecycleSupport.fireLifecycleEvent(String, Object) line: 119\t\n\tStandardContext(LifecycleBase).fireLifecycleEvent(String, Object) line: 89\t\n\tStandardContext(LifecycleBase).setState(LifecycleState, Object) line: 325\t\n\tStandardContext(LifecycleBase).setState(LifecycleState) line: 305\t\n\tStandardContext(LifecycleBase).start() line: 156\t\n\tStandardHost(ContainerBase).startInternal() line: 1027\t\n\tStandardHost.startInternal() line: 788\t\n\tStandardHost(LifecycleBase).start() line: 140\t\n\n(6) Register wrapper.  It succeeds because context has been registered on Mapper.\n\tMapper.addWrapper(String, String, String, Object, boolean) line: 328\t\n\tMapperListener.registerWrapper(Wrapper) line: 394\t\n\tMapperListener.registerContext(Context) line: 343\t\n\tMapperListener.lifecycleEvent(LifecycleEvent) line: 411\t\n\tLifecycleSupport.fireLifecycleEvent(String, Object) line: 119\t\n\tStandardContext(LifecycleBase).fireLifecycleEvent(String, Object) line: 89\t\n\tStandardContext(LifecycleBase).setState(LifecycleState, Object) line: 325\t\n\tStandardContext(LifecycleBase).setState(LifecycleState) line: 305\t\n\tStandardContext(LifecycleBase).start() line: 156\t\n\tStandardHost(ContainerBase).startInternal() line: 1027\t\n\tStandardHost.startInternal() line: 788\t\n\tStandardHost(LifecycleBase).start() line: 140\t\n\nI think that addWrapper() is unnecessary until LifecycleState for StandardContext become STARTED.\naddWelcomeFile() is also similar.\n\nI attached the patch that prevent this error message.\n\nBest regards.", "id": 141119, "time": "2010-10-28T03:21:29Z", "bug_id": 50169, "creation_time": "2010-10-28T03:21:29Z", "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "text": "Many thanks for the patch. It has been applied to 7.0.x and will be included in 7.0.5 onwards.", "id": 141622, "attachment_id": null, "bug_id": 50169, "creation_time": "2010-11-11T07:30:49Z", "time": "2010-11-11T07:30:49Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 37716, "attachment_id": null, "id": 83009, "time": "2005-11-30T14:25:19Z", "creator": "a_cogito@yahoo.fr", "creation_time": "2005-11-30T14:25:19Z", "is_private": false, "text": "When using the JMmeter proxy (to record pages) on a multipart/form-data whith an\nupload file field, if the filename is not specified, an invalid request is send\nto the server.\n\nMy actual webapp (with cocoon) and the form are too complex to be put as an\nattachment, but I'll provide the stacktrace.\n\nI recreated the same problem using a simple form with ruby on rails, I'll put\nthe webrick stacktrace too.\n\nI think I've spoted the problem in PostWriter.java, I'll provide a patch (as\nsoon as I'll have checkout sources from svn)."}, {"count": 1, "tags": [], "bug_id": 37716, "attachment_id": 17084, "text": "Created attachment 17084\nCocoon stacktrace", "id": 83010, "time": "2005-11-30T14:26:35Z", "creator": "a_cogito@yahoo.fr", "creation_time": "2005-11-30T14:26:35Z", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 17086\nsimple multipart form\n\nThe simple html page I used in ruby on rails to reproduce the problem with the\njmeter proxy.", "attachment_id": 17086, "id": 83011, "creation_time": "2005-11-30T14:30:42Z", "time": "2005-11-30T14:30:42Z", "creator": "a_cogito@yahoo.fr", "bug_id": 37716, "is_private": false}, {"count": 3, "tags": [], "bug_id": 37716, "attachment_id": 17087, "id": 83012, "time": "2005-11-30T14:31:45Z", "creator": "a_cogito@yahoo.fr", "creation_time": "2005-11-30T14:31:45Z", "is_private": false, "text": "Created attachment 17087\nwebrick - ruby on rails - stacktrace\n\nThe stacktrace I get when using jmeter proxy with the simple form with no\nfilename specified."}, {"count": 4, "tags": [], "bug_id": 37716, "text": "I spotted the problem in org.apache.jmeter.protocol.http.sampler.PostWriter.java\n\nIn sendPostData(), the filename is tested with those lines:\nString filename = sampler.getFilename();\nif ((filename != null) && (filename.trim().length() > 0)) {\n\nBut in setHeaders(), the filename is not use:\nString filename = sampler.getFileField();\nif ((filename != null) && (filename.trim().length() > 0)) {\n\nWhere sampler.getFileField() is the \"name\" attribut of the html input (\"upload\"\nin my simple multipart form attachment file), therefore wrong headers a used.\n\nSee patch-bug-37716.txt", "id": 83013, "time": "2005-11-30T14:37:50Z", "creator": "a_cogito@yahoo.fr", "creation_time": "2005-11-30T14:37:50Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "a_cogito@yahoo.fr", "text": "Created attachment 17088\nreplace sampler.getFileField() with sampler.getFilename()", "id": 83014, "attachment_id": 17088, "bug_id": 37716, "creation_time": "2005-11-30T14:38:46Z", "time": "2005-11-30T14:38:46Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 37716, "attachment_id": 17089, "text": "Created attachment 17089\njunit test case for PostWriter\n\nTest all public methodes of PostWriter.\nPlace it under:\n[jmeter-workspace]/test/src/org/apache/jmeter/protocol/http/sampler\n\nDone under windows XP and eclipse 3.1.\n\nLaunch from eclipse: green bar.\nLaunch from ant: green bar.", "id": 83020, "time": "2005-11-30T17:37:47Z", "creator": "a_cogito@yahoo.fr", "creation_time": "2005-11-30T17:37:47Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 37716, "text": "Thanks very much - it's particularly useful to have the JUnit testcase.\n\nI've applied the patch to the 2.1 branch.\n\nBTW, PostWriter.CRLF and PostWriterTest.CRLF need to remain private - final\narrays are mutable (unless they have zero entries), so it's not completely safe\nto share them.", "id": 83043, "time": "2005-12-01T00:10:45Z", "creator": "sebb@apache.org", "creation_time": "2005-12-01T00:10:45Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "text": "solve with the latest svn sources :)", "attachment_id": null, "id": 83130, "creation_time": "2005-12-02T10:33:47Z", "time": "2005-12-02T10:33:47Z", "creator": "a_cogito@yahoo.fr", "bug_id": 37716, "is_private": false}]
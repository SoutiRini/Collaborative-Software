[{"count": 0, "tags": [], "bug_id": 57294, "attachment_id": null, "id": 179438, "time": "2014-12-02T10:45:08Z", "creator": "y-konishi@tsrweb.co.jp", "creation_time": "2014-12-02T10:45:08Z", "is_private": false, "text": "I have used SXSSF to output Excel files (xlsx).\nWhen I tried to write RichTextString in SXSSFCell, it was converted to normal text in output file,\n(just reflected one cell style to whole cell),\nbecause it seems that SheetDataWriter.java does not support RichTextString.\n\nThen, I tried to change method SheetDataWriter#writeCell according to the rules of OOXML, \nand it worked well in my environment.\n\nHere is my code:\n-----------------------------------------\nSheetDataWriter.java\n\npublic void writeCell(int columnIndex, Cell, cell) throws IOException {\n    int celltype = cell.getCellType();\n    switch(celltype){\n    case Cell.CELL_TYPE_STRING:\n        // get RichTextString info\n        XSSFRichTextString richText = (XSSFRichTextString) cell.getRichStringCellValue();\n        List<CTRElt> listElt = richText.getCTRst().getRList();\n\n        // write cell info to sheet.xml\n        String ref = new CellReferec(this._rownum, columnIndex).formatAsString();\n        this._output.write(\"<c r=\\\"\" + ref + \"\\\"\");\n        CellStyle cellStyle = cell.getCellStyle();\n        if(cellStyle.getIndex() != 0) {\n            this._output.write(\" s=\\\"\" + cellStyle.getIndex() + \"\\\"\");\n        }  \n\n        this._output.write(\" t=\\\"inlineStr\\\">\");\n        this._output.write(\"<is>\");\n        \n        for(int i = 0; i < listElt.size(); i++) {\n            CTRElt elt = listElt.get(i);\n            if(elt.isSetRPr()) {\n                // the case of having font styles\n                this._output.write(\"<r>\");\n                this._output.write(\"<rPr>\");\n                // write rpr infomation, which CTRElt has (*)\n                this._output.write(\"</rPr>\");\n                this._output.write(\"<t\");\n                if(hasLeadingTrailingSpaces(elt.getT())) {\n                    this._output.write(\" xml:space=\\\"preserve\\\"\");\n                }\n                this._output.write(\">\");\n                outputQuotedString(elt.getT());\n                this._output.write(\"</t>\");\n                this._output.write(\"</r>\");\n            }\n        }\n\n        this._output.write(\"</is>\");\n        this._output.write(\"</c>\");\n\n    }\n}\n\n\n(Sorry, some parts(*) are ommitted.)\n-----------------------------------------\n\nIs there any problems in my code?\nIf possible, I hope it would be reflected in next version.\n\nThanks,"}, {"count": 1, "tags": [], "creator": "dominik.stadler@gmx.at", "text": "I tried to work on this, but there was support for SharedStringTables added via bug 53130, which is breaking your suggested implementation.\n\nAny chance you can come up with an up-to-date patch here? Preferably in patch-format, see http://poi.apache.org/guidelines.html#SubmittingPatches for how this can be done.", "id": 180152, "time": "2015-01-05T11:34:49Z", "bug_id": 57294, "creation_time": "2015-01-05T11:34:49Z", "is_private": false, "attachment_id": null}]
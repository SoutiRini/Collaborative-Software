[{"count": 0, "tags": [], "creator": "steve_l@iseran.com", "text": "so you have this directory tree for the web site, each directory having an \nindex.jsp page set up to act as the default. And you want to use <jspc> to \nprevalidate or precompile your pages. So you run <jspc> over the tree using an \nincludes=\"**/*.jsp\" pattern :-\n\n <jspc\n  destdir=\"${dir.build}/jspc/java\" srcdir=\"${wardir}\"\n  uriroot=\"${wardir}\" verbose=\"3\">\n  <include name=\"**/*.jsp\"/>\n</jspc>\n\nOnly, the task flattens the tree so that all pages get output in the same \ndestination directory: only the last index.java file generated is left around \nfor <javac> to play with.\n\nFixes\n -documentation; you must use jspc for each directory. ugly but easy\n -modify the task to replicate the directory heirarchy during the compile phase\n\nMy preference is for the latter;", "id": 7700, "time": "2001-11-08T11:02:07Z", "bug_id": 4750, "creation_time": "2001-11-08T11:02:07Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "mpichler@hyperwave.com", "text": "This seems to be a jasper feature(bug?) and not an ant problem because\nwe observed the same on calling <java classname=\"org.apache.jasper.JspC\">\nwith ant 1.4.\n\nWe found the behavior caused by getBaseClassName of\norg.apache.jasper.compiler.CommandLineCompiler\nSuggested fix:\n\n[...]\n\tif (className == null) {\n            // String jspname = jsp.getName();  // original (last name part)\n            String jspname = ctxt.getJspFile();  // context relative path\n            if (jspname.endsWith(\".jsp\"))\n                className = jspname.substring(0, jspname.length() - 4);\n            else\n                className = jspname;\n        }\n[...]\n        StringBuffer modifiedClassName = new StringBuffer();\n        for (int i = 0; i < className.length(); i++) {\n            char chi = className.charAt(i);\n            if (chi == File.separatorChar)  // convert '/' resp. '\\' to \"__\"\n                modifiedClassName.append(\"__\");\n            else if (Character.isLetterOrDigit(chi))\n                modifiedClassName.append(chi);\n            else  // _ in class names get mangled to _0005f\n                modifiedClassName.append(mangleChar(className.charAt(i)));\n        }\n[...]", "id": 11784, "time": "2002-03-14T10:15:46Z", "bug_id": 4750, "creation_time": "2002-03-14T10:15:46Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "luis.reis@netcabo.pt", "text": "I've been having this problem with Tomcat 4.0.1, but it seems to be gone on 4.0.3.\n\nCan anybody verify ? I can't find any changelog or cvs log reporting this.\n\nSorry for the spam.", "id": 16969, "time": "2002-05-30T22:35:18Z", "bug_id": 4750, "creation_time": "2002-05-30T22:35:18Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 4750, "attachment_id": null, "is_private": false, "id": 16971, "time": "2002-05-31T00:03:02Z", "creator": "stevel@apache.org", "creation_time": "2002-05-31T00:03:02Z", "text": "I will have a look at this. If they have fixed it in jasper, we need to pull the\nfix back into jspc's dependency checking. "}, {"count": 4, "tags": [], "text": "Resolving according to the comments.\n\nI recently did some work on Jasper 2 with JspC. It now generated the exact same\ndirectory structure the servlet would have when using the \"-webapp\" option.", "is_private": false, "id": 17240, "creator": "remm@apache.org", "time": "2002-06-05T23:32:40Z", "bug_id": 4750, "creation_time": "2002-06-05T23:32:40Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "stevel@apache.org", "text": "thanks for the pointer; I am re-opening this and reassinging to ant to remind me\nto pull the changes out of tomcat and duplicate them in the jspc task where it\ndoes the up-to-date checks to decide which files to hand down to jspc.\n\nwe could of course hand them all down to you and let you work out the\ndependencies yourself, maybe even handling <jsp:include> tags, eh?", "id": 17268, "time": "2002-06-06T05:01:28Z", "bug_id": 4750, "creation_time": "2002-06-06T05:01:28Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "joern@stampehl.de", "text": "With the new Jasper 2 of Tomcat 4.1 now the following error occurs:\n\nIf you have an index.jsp in every directory the jspc will work fine but if you\ntry to compile them it crashes:\n\n    [javac] M:\\ZIF\\jspc\\board\\index_jsp.java:13: duplicate class:\norg.apache.jsp.index_jsp\n    [javac] public class index_jsp extends HttpJspBase {\n    [javac]        ^\n    [javac] M:\\ZIF\\jspc\\cms\\index_jsp.java:12: duplicate class:\norg.apache.jsp.index_jsp\n    [javac] public class index_jsp extends HttpJspBase {\n    [javac]        ^\n    [javac] M:\\ZIF\\jspc\\images\\index_jsp.java:8: duplicate class:\norg.apache.jsp.index_jsp\n    [javac] public class index_jsp extends HttpJspBase {\n\nI assume that the problem is not ant but Jasper...", "id": 25779, "time": "2002-11-06T13:45:29Z", "bug_id": 4750, "creation_time": "2002-11-06T13:45:29Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 4750, "is_private": false, "id": 29582, "attachment_id": null, "creator": "conor@apache.org", "creation_time": "2003-01-17T02:26:14Z", "time": "2003-01-17T02:26:14Z", "text": "Steve, where is this up to?"}, {"count": 8, "tags": [], "creator": "stevel@apache.org", "is_private": false, "text": "not done anything on it yet; I need to pull down the new jasper code and work\nthis and the name mapping", "id": 29624, "time": "2003-01-17T17:54:55Z", "bug_id": 4750, "creation_time": "2003-01-17T17:54:55Z", "attachment_id": null}, {"count": 9, "tags": [], "text": "I have just had a look at this issue.\n\nI have tested with Apache Tomcat/4.1.12-LE-jdk14\n\nFirst to run the test, you need the following 3 jar files from \n$CATALINA_HOME/common/lib in your CLASSPATH :\n\n - jasper-compiler.jar\n - jasper-runtime.jar\n - servlet.jar\n\nConclusion : the directory hierarchy is not flattened any more.\n\nThe other point is that ant does not do any dependency checking in the jspc \ntask, everything gets recompiled every time.\n\nI am closing the bug, and suggesting that if someone wants the dependency \nchecking in jspc improved, he or she opens a new bug report with the dependency \nchecking rules to be implemented in it.", "is_private": false, "bug_id": 4750, "id": 41840, "time": "2003-07-31T10:22:53Z", "creator": "antoine@apache.org", "creation_time": "2003-07-31T10:22:53Z", "attachment_id": null}, {"count": 10, "tags": [], "creator": "j.smith@ardeo.com", "is_private": false, "text": "This doesn not seem to be fixed at all.\nThe java files generated all have the same package name, \"org.apache.jsp\". This \nmeans that when compiled they will all end up in the same directory.\n\nTested using TOmcat 4.1.18, ant 1.5 ", "id": 41841, "time": "2003-07-31T11:39:36Z", "bug_id": 4750, "creation_time": "2003-07-31T11:39:36Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 4750, "attachment_id": null, "is_private": false, "id": 41842, "time": "2003-07-31T11:44:22Z", "creator": "antoine@apache.org", "creation_time": "2003-07-31T11:44:22Z", "text": "OK, this was a misunderstanding on my side, I thought that the problem was all \njava files were output to the same directory, which is not the case.\nI can confirm that all the files have org.apache.jsp as package name."}, {"count": 12, "tags": [], "creator": "antoine@apache.org", "is_private": false, "text": "I have just done a quick hack to see whether Tomcat behaves differently \nconcerning the package name of the generated java. I created a subdirectory in a \nsmall dummy web application, and copied a jsp which was present in the parent \ndirectory.\nso we have\nparameters.jsp\n|\n|\n--------subdir  parameters.jsp\n\nIn the work/Standalone/localhost/testapp directory, I have\n\nparameters_jsp.java\n|\n|\n--------subdir  parameters_jsp.java\n\nboth files have the package org.apache.jsp\n\nBut in this case, Tomcat, not ant, did the jspc operation.\n\nSo this package name is a Tomcat feature.\n\nYour issue should be titled : package structure of the generated java files does \nnot follow the directory hierarchy of the webapp.\n\nIf you have indeed a problem with this, then you should discuss this on the \ntomcat-user list, and do a search in bugzilla in the tomcat/jasper bugs to see \nif other people have an issue there.\n\nBut I do not think this is an ant issue, so I am closing this report again.\n", "id": 41845, "time": "2003-07-31T12:08:09Z", "bug_id": 4750, "creation_time": "2003-07-31T12:08:09Z", "attachment_id": null}, {"count": 13, "tags": [], "creator": "stevel@apache.org", "is_private": false, "text": "The exact misbehavior depends on tomcat versions. Anything less than Tomcat \n4.1.24 is trouble...everyone who wants to file bugreps on this *must* be using\nthe latest version of tomcat before we can handle the problems.\n\nWhen I opened this bug back in '01, with TC4.04, jasperc was definitely\nflattening all files. Now it looks like it is working but it is packaging\neverything into the same package. Which has the same effect :(", "id": 41882, "time": "2003-07-31T18:25:19Z", "bug_id": 4750, "creation_time": "2003-07-31T18:25:19Z", "attachment_id": null}]
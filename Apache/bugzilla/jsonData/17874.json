[{"count": 0, "tags": [], "creator": "tcastelle@generali.fr", "is_private": false, "id": 32949, "attachment_id": null, "bug_id": 17874, "creation_time": "2003-03-11T13:43:00Z", "time": "2003-03-11T13:43:00Z", "text": "Hi there !\n\nI wanted to test the latest cvs snapshots against the bug 16333, but I got a\nsegmentation fault problem...\n\nUsing the latest cvs snapshots (2003/03/10 05:12:56), compiled on Sun Solaris 8\nwith :\n\nCFLAGS=\"-m64\" ./configure --prefix=/usr/local/www/proto-test --enable-ssl\n--with-ssl=/usr/local/ssl\n\nWhen I start it with ssl enabled, I get a beautiful : \"Segmentation Fault - core\ndumped\"\n\nWithout SSL => no problem\nWith 32-bit build + SSL => no problem\nWith http-2.0.44 64-bit build + SSL => no problem\n\nCan you tell me what's wrong ? Do you need the core file ?\n\nThanks in advance !\n\nThomas."}, {"count": 1, "tags": [], "text": "Can you post the stack trace ?. It'll be pretty helpful.\n\n-Madhu", "attachment_id": null, "id": 33008, "creation_time": "2003-03-12T06:54:34Z", "time": "2003-03-12T06:54:34Z", "creator": "madhusudan_mathihalli@hp.com", "bug_id": 17874, "is_private": false}, {"count": 2, "tags": [], "bug_id": 17874, "attachment_id": null, "id": 33010, "time": "2003-03-12T08:38:42Z", "creator": "tcastelle@generali.fr", "creation_time": "2003-03-12T08:38:42Z", "is_private": false, "text": "I attach the core file. By the way, I wasn't able to read it with gdb... is it\nbecause of the 64-bit build ?\n\nThanks for looking,\n\nThomas."}, {"count": 3, "tags": [], "creator": "trawick@apache.org", "is_private": false, "id": 33014, "attachment_id": null, "bug_id": 17874, "creation_time": "2003-03-12T10:05:35Z", "time": "2003-03-12T10:05:35Z", "text": "Did you forget to attach the backtrace?\n\nIf you are having trouble getting it from gdb, use the Solaris pstack command.\n"}, {"count": 4, "tags": [], "creator": "tcastelle@generali.fr", "is_private": false, "id": 33021, "attachment_id": null, "bug_id": 17874, "creation_time": "2003-03-12T11:51:39Z", "time": "2003-03-12T11:51:39Z", "text": "Sorry, I can't attach the file ! It doesn't work, I don't know why... Maybe\nbecause of a bug on the security gateways we use here... Is there a limitation\non the size ? I'll try to compress it...\n\nAnyway, here is a pstack of my core file :\n\ncore 'core' of 27310:   /usr/local/www/proto-test/bin/httpd -k start\n-----------------  lwp# 1 / thread# 1  --------------------\n ffffffff7cd0fa14 sema_wait (7c900000, ffffffff7ce22000, ffffffff7f725c60, 0, 1,\nffffffff7f7237e0) + 4\n ffffffff7cd0fe5c _libthread_sema_wait (7c900000, 0, ffffffff7e506000,\nffffffff7e824c58, ffffffff7ec00b50, 1004a0) + 48\n ffffffff7e405ab0 sem_wait (7c900000, ffffffff7e8067a1, ffffffff7f725c60,\nffffffff7e824768, ffffffff7ec00b50, ffffffff7f7237e0) + 24\n ffffffff7e824c58 proc_mutex_posix_acquire (10029d4c0, ffffffff7e824c40, 0,\nffffffff7e824768, ffffffff7f500438, ffffffff7f7237e0) + 18\n ffffffff7e8258c0 apr_proc_mutex_lock (10029d4c0, 1001ec338, 0, 100046698, 0, 0)\n+ 18\n ffffffff7e824768 apr_global_mutex_lock (10029d4a8, 60, 100219620, 0, 0, 0) + 58\n 0000000100046698 ssl_mutex_on (100219620, 60, 100219620, 0, 0, 0) + 70\n 0000000100052a98 ssl_scache_dbm_init (100219620, 10020a9d8, 100219620, 0, 0, 0)\n+ ac\n 0000000100052338 ssl_scache_init (100219620, 10020a9d8, 1, 1000d7b20, d7800,\nff00) + d0\n 000000010003a9f4 ssl_init_Module (10020a9d8, 100246bb8, 100248bc8, 100219620,\n10003a764, 67) + 290\n 000000010008fce8 ap_run_post_config (10020a9d8, 100246bb8, 100248bc8,\n100219620, 1f4000, 0) + d8\n 000000010009ab4c main (3, ffffffff7ffffb68, ffffffff7ffffb88, 1001f9a80,\n100000000, 0) + b8c\n 00000001000217d4 _start (0, 0, 0, 0, 0, 0) + 7c\n-----------------  lwp# 2 / thread# 2  --------------------\n ffffffff7d5a6e74 _signotifywait (ffffffff7ce22000, ffffffff7f7231e0,\nffffffff7e100d70, 0, ffffffff7f723038, 0) + 8\n ffffffff7cd15124 thr_yield (0, 0, 0, 0, 0, 0) + 8c\n-----------------  lwp# 3  --------------------------------\n ffffffff7d5a4ee8 _door_return (ffffffff7cb09c10, 3, ffffffff7ce24bf8, 3,\nffffffff7ce22000, 1) + 10\n ffffffff7cd0d4d4 _lwp_start (ffffffff7cb09c10, ffffffff7d0000e8,\nffffffff7cd11b98, ffffffff7ce22000, 0, 0) + 18\n ffffffff7cd15124 thr_yield (0, 0, 0, 0, 0, 0) + 8c\n--------------------------  thread# 3  --------------------\n ffffffff7cd10c28 _reap_wait (ffffffff7ce28130, ffffffff7ce22000, 0, 0, 0, 0) + 38\n ffffffff7cd10978 _reaper (ffffffff7ce23d48, ffffffff7ce28130, 0,\nffffffff7ce23d20, 0, 1000) + 38\n ffffffff7cd1f344 _thread_start (0, 0, 0, 0, 0, 0) + 40\n\nThanks again for looking !\n\nThomas.\n"}, {"count": 5, "tags": [], "bug_id": 17874, "text": "Created attachment 5288\nCore file", "id": 33022, "time": "2003-03-12T11:52:30Z", "creator": "tcastelle@generali.fr", "creation_time": "2003-03-12T11:52:30Z", "is_private": false, "attachment_id": 5288}, {"count": 6, "tags": [], "creator": "tcastelle@generali.fr", "attachment_id": null, "is_private": false, "id": 33023, "time": "2003-03-12T11:52:51Z", "bug_id": 17874, "creation_time": "2003-03-12T11:52:51Z", "text": "Ok, now it worked... ;-)\n\n"}, {"count": 7, "tags": [], "creator": "madhusudan_mathihalli@hp.com", "attachment_id": null, "is_private": false, "id": 33198, "time": "2003-03-14T16:28:24Z", "bug_id": 17874, "creation_time": "2003-03-14T16:28:24Z", "text": "Based onthe stack trace posted, it's likely the child segv'd in a different \nthread. (and I don't have a solaris box to do the test myself).\n\nCan you please post the trace for the faulting thread ?.\n[IN gdb, you should be able todo a \"t a a list\" to give you all the threads, \nand then type \"# 5\" to listthe trace for the 5th thread, and so on till you \nfind the faulting thread]\n\nQuestion (trying to identify the area where the dump may be happening)\n- AFAICS, you're using the worker model - did you try using the prefork model, \nand get the same behaviour ?\n- Can you try using other SSL session caching models - shmht, shmcb ?\n\nThanks\n-Madhu"}, {"count": 8, "tags": [], "bug_id": 17874, "text": "Hi Madhu,\n\nAs you told me, I changed the SSL session caching model and it works now. Both\nshmht and shmcb are OK. I didn't try with the prefork MPM as it seems to come\nfrom the session caching models. Do you need me to try anyway ?\n\nI wasn't able to use this damn gdb on my solaris box. With version 5.0, I got a\n\"Dwarf error...\" or something like, so I upgraded to gdb 5.3. No more errors,\nbut when I do \"r -X\" I got this response :\n\nThis GDB was configured as \"sparc-sun-solaris2.8\"...\n(gdb) r -X\nStarting program: /usr/local/www/proto-test/bin/httpd -X\nprocfs:4235 -- process not stopped.\nprocfs: ...giving up...\n(gdb)\n\nSo, I made a \"truss -f -l -d -vall ./httpd -X\". Hope it can help you... I attach\nit to this message. \n\nBy the way, what is the difference between shmht and shmcb, and what is the\nperformance/security recommandation between the 3 models (dbm, shmcd and shmht) ?\n\nThanks for all, and thanks for Apache !\n\nThomas.\n", "id": 33282, "time": "2003-03-17T09:26:34Z", "creator": "tcastelle@generali.fr", "creation_time": "2003-03-17T09:26:34Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "text": "Created attachment 5366\nTruss trace of the httpd process", "attachment_id": 5366, "id": 33283, "creation_time": "2003-03-17T09:27:16Z", "time": "2003-03-17T09:27:16Z", "creator": "tcastelle@generali.fr", "bug_id": 17874, "is_private": false}, {"count": 10, "tags": [], "bug_id": 17874, "text": "The backtrace indicates that you hit a problem in APR's posix sem \nsupport.  Unfortunately, APR's posix sem support has been busted for 64-bit\nbuilds.  Currently posix sems are disabled at configure time on systems with\n64-bit pointers.\n\nCurrent APR, or the APR bundled with Apache 2.0.45, will keep you out of\nthis path.", "id": 34624, "time": "2003-04-07T15:21:11Z", "creator": "trawick@apache.org", "creation_time": "2003-04-07T15:21:11Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "jagadesh.munta@sun.com", "attachment_id": null, "id": 128299, "time": "2009-06-25T18:11:39Z", "bug_id": 47433, "creation_time": "2009-06-25T18:11:39Z", "is_private": false, "text": "Email thread sent to the dev@ant.apache.org alias.\nJagadesh Babu Munta wrote:\n> Changes again as highlighted (missed couple of lines in earlier email):-\n>  \n>           int responseCode = httpConnection.getResponseCode();\n>             log(\"Response Code=\"+responseCode, logLevel);\n>             // test for 401 result (HTTP only)\n>             if (responseCode == HttpURLConnection.HTTP_UNAUTHORIZED)  {\n>                 String message = \"HTTP Authorization failure\";\n>                 if (ignoreErrors) {\n>                     log(message, logLevel);\n>                     return false;\n>                 } else {\n>                     throw new BuildException(message);\n>                 }\n>             } else if ((responseCode == HttpURLConnection.HTTP_MOVED_PERM) ||\n>                     (responseCode == HttpURLConnection.HTTP_MOVED_TEMP)) {\n>                 String newLocation = httpConnection.getHeaderField(\"Location\");\n>                 String message = \"HTTP URL Moved to \"+newLocation;\n>                 log(message, logLevel);\n>                 setSrc(new URL(newLocation));\n>                 execute();\n>             }\n>\n>         }\n>\n>\n> Jagadesh Babu Munta wrote:\n>> Hi,\n>>\n>> I am trying use ANT task \"get\" to download a redirectored or moved URL \"http://hudson-ci.org/latest/hudson.war\"\n>> But it doesn't work. It simply get the moved HTML page than the actual redirected URL. Verified with 1.7.1/1.6.5 versions.\n>>\n>> I wonder if any workaround?\n>>\n>> In fact, I looked at the Get.java taskdef source code and found that code is not taking care of 301/302 HTTP response code.\n>>\n>> I have added a simple code (highlighted) in Get.java  and worked fine.\n>>\n>> Can some one help me getting the fix into the ant code (or) fixed already (or) if any workaround in the latest (1.7.1) or 1.6.5 ANT bits?\n>> (I joined Today only to this list. Sorry if any one has already discussed the issue.\n>>\n>>             if (responseCode == HttpURLConnection.HTTP_UNAUTHORIZED)  {\n>>                 String message = \"HTTP Authorization failure\";\n>>                 if (ignoreErrors) {\n>>                     log(message, logLevel);\n>>                     return false;\n>>                 } else {\n>>                     throw new BuildException(message);\n>>                 }\n>>             } else if ((responseCode == HttpURLConnection.HTTP_MOVED_PERM) ||\n>>                     (responseCode == HttpURLConnection.HTTP_MOVED_TEMP)) {\n>>                 String newLocation = httpConnection.getHeaderField(\"Location\");\n>>                 String message = \"HTTP URL Moved to \"+newLocation;\n>>                 log(message, logLevel);\n>>                 setSrc(new URL(newLocation));\n>>                 execute();\n>>             }\n>>\n>>         }\n>>\n>>\n>>\n>>\n>> Snapshot (problematic):-\n>> ------------\n>>\n>>\n>>      [get] Getting: http://hudson-ci.org/latest/hudson.war\n>>       [get] To: /Users/munta/runtests/v3/appserver-sqe/build/pe/i386_dhcp-usca14-133-126.SFBay.Sun.COM_Darwin/hudson/archive/hudson.war\n>>       [get] ..\n>>       [get] last modified = Wed Dec 31 16:00:00 PST 1969 - using current time instead\n>>\n>> BUILD SUCCESSFUL\n>> Total time: 2 seconds\n>> [dhcp-usca14-133-126:v3/appserver-sqe/hudson] munta% cat /Users/munta/runtests/v3/appserver-sqe/build/pe/i386_dhcp-usca14-133-126.SFBay.Sun.COM_Darwin/hudson/archive/hudson.war\n>> <!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n>> <HTML><HEAD>\n>> <TITLE>302 Found</TITLE>\n>> </HEAD><BODY>\n>> <H1>Found</H1>\n>> The document has moved <A HREF=\"https://hudson.dev.java.net/files/documents/2402/137470/hudson.war\">here</A>.<P>\n>> <HR>\n>> <ADDRESS>Apache/1.3.33 Server at hudson-ci.org Port 80</ADDRESS>\n>> </BODY></HTML>\n>> [dhcp-usca14-133-126:v3/appserver-sqe/hudson] munta%\n>>\n>> ---\n>>\n>>\n>> Snapshot (worked fine with above code change)\n>> ---------\n>>\n>>       [get] Getting: http://hudson-ci.org/latest/hudson.war\n>>       [get] To: /Users/munta/runtests/v3/appserver-sqe/build/pe/i386_dhcp-usca14-133-126.SFBay.Sun.COM_Darwin/hudson/archive/hudson.war\n>>       [get] Response Code=302\n>>       [get] HTTP URL Moved to https://hudson.dev.java.net/files/documents/2402/137470/hudson.war\n>>       [get] Getting: https://hudson.dev.java.net/files/documents/2402/137470/hudson.war\n>>       [get] To: /Users/munta/runtests/v3/appserver-sqe/build/pe/i386_dhcp-usca14-133-126.SFBay.Sun.COM_Darwin/hudson/archive/hudson.war\n>>       [get] Response Code=200\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] ....................................................\n>>       [get] .............................\n>>       [get] last modified = Tue Jun 23 13:57:19 PDT 2009\n>>       [get] ..\n>>       [get] last modified = Wed Dec 31 16:00:00 PST 1969 - using current time instead\n>>\n>> BUILD SUCCESSFUL\n>> Total time: 39 seconds\n>>\n>>\n>> Thanks for your time and help.\n>> -- Jagadesh"}, {"count": 1, "tags": [], "creator": "jagadesh.munta@sun.com", "attachment_id": null, "id": 128332, "time": "2009-06-26T18:39:10Z", "bug_id": 47433, "creation_time": "2009-06-26T18:39:10Z", "is_private": false, "text": "Earlier code (calling execute after setting new URL) had issue on Linux and modified to call doGet() method.\n\nBelow is the latest code (last line changed).\n\n            int responseCode = httpConnection.getResponseCode();\n            log(\"Response Code=\"+responseCode, logLevel);\n            // test for 401 result (HTTP only)\n            if (responseCode == HttpURLConnection.HTTP_UNAUTHORIZED)  {\n                String message = \"HTTP Authorization failure\";\n                if (ignoreErrors) {\n                    log(message, logLevel);\n                    return false;\n                } else {\n                    throw new BuildException(message);\n                }\n            } else if ((responseCode == HttpURLConnection.HTTP_MOVED_PERM) ||\n                    (responseCode == HttpURLConnection.HTTP_MOVED_TEMP)) {\n                String newLocation = httpConnection.getHeaderField(\"Location\");\n                String message = \"HTTP URL Moved to \"+newLocation;\n                log(message, logLevel);\n                setSrc(new URL(newLocation));\n                return doGet(logLevel, progress);\n            }"}, {"count": 2, "text": "I have adapted the patch to avoid redirect loops etc, furthermore I refactored the code to reach a cleaner solution.\n\nTest show however that redirects are followed by default. This is also the default setting of the HttpURLConnection.\n\nWhen researching why the redirect does not work for the hudson download I found that the HttpURLConnection does not switch protocols. The Sun Java Networking Engineers reached the conclusion it would be unsafe to switch protocols, this has been listed in:\nhttp://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4620571\n\nBefore I progress applying the changes, I would like to pose the question whether we would want this behavior in ant, even if the Sun Networking Engineers concluded this would be unsafe. \n\nFor this reason, personally I would tend to say no to the patch with the protocol change. If Sun deems this change to be safe, this change should be applied in the HttpURLConnection, I could imagine that a switch from http to https could be allowed, while a change in the other direction is not. Switches to yet other protocols pose completely new questions.\nIf such change is deemed safe, the change should probably be made in the HttpURLConnection.", "creator": "jkf@apache.org", "is_private": false, "id": 128342, "time": "2009-06-27T04:53:51Z", "bug_id": 47433, "creation_time": "2009-06-27T04:53:51Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 47433, "attachment_id": null, "id": 128377, "time": "2009-06-29T02:44:34Z", "creator": "bodewig@apache.org", "creation_time": "2009-06-29T02:44:34Z", "is_private": false, "text": "I agree with Martijn.\n\nIf <get> followed redirect that Java wouldn't follow on its own it shouldn't do so without the user explicitly asking for it (i.e. with a new attribute to enable it)."}, {"count": 4, "tags": [], "bug_id": 47433, "attachment_id": null, "is_private": false, "id": 128402, "time": "2009-06-29T11:05:24Z", "creator": "jagadesh.munta@sun.com", "creation_time": "2009-06-29T11:05:24Z", "text": "\nThanks Martin and Stefan for quickly looking into this.\n\nI looked at the jdk bug, \"http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4620571\"\nand it says at the end \"Check response code and Location header field value for redirect information. It's the application's responsibility to follow the redirect.\"\n\nI think we should take care of the same in the ANT for the above issue because it is an application. Because having a solution to the problem is better than nothing! \n\nI agree that it is better to have an optional attribute to have this new behavior so that by default it simply follows HttpURLConnection and on demand (when no security issue) user can use this new attribute."}, {"count": 5, "tags": [], "bug_id": 47433, "is_private": false, "text": "If it is not safe in the platform, it is not safe in an application that cannot, and will not pop up an indication >>>are you sure<<< (and probably not even when it would pop up an indication it would still not be safe)\n\nIt does not get any safer by doing this from an application, instead of from the java platform, it just becomes the responsibility of the application if it does follow the redirect. \n\nIf it is unsafe to switch protocols from a redirect, we should not be doing this unless we do understand the implications.", "id": 128404, "time": "2009-06-29T13:15:56Z", "creator": "jkf@apache.org", "creation_time": "2009-06-29T13:15:56Z", "attachment_id": null}, {"count": 6, "text": "Created attachment 23901\nget task that seizes control of redirection itself allowing a redirect from HTTP to HTTPS", "creator": "jkf@apache.org", "attachment_id": 23901, "id": 128405, "time": "2009-06-29T13:57:23Z", "bug_id": 47433, "creation_time": "2009-06-29T13:57:23Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 47433, "attachment_id": null, "text": "D:\\data\\eclipseworkspace\\ant-trunk\\testje>..\\dist\\bin\\ant -file testget.xml\nBuildfile: D:\\data\\eclipseworkspace\\ant-trunk\\testje\\testget.xml\n\nbug:\n      [get] Getting: http://hudson-ci.org/latest/hudson.war\n      [get] To: D:\\data\\eclipseworkspace\\ant-trunk\\testje\\dl2.html\n      [get] http://hudson-ci.org/latest/hudson.war moved to https://hudson.dev.java.net/files/documents/2402/137602/hudson.war\n      [get] Getting: http://kruithof.xs4all.nl/uuid/uuidgen\n      [get] To: D:\\data\\eclipseworkspace\\ant-trunk\\testje\\dl.html\n      [get] http://kruithof.xs4all.nl/uuid/uuidgen permanently moved to http://www.famkruithof.net/uuid/uuidgen\n\nIs there any way we can set up redirects on our webserver to allow official testcases?", "id": 128406, "time": "2009-06-29T14:03:08Z", "creator": "jkf@apache.org", "creation_time": "2009-06-29T14:03:08Z", "is_private": false}, {"count": 8, "text": "Not sure who is the administrator on ant.apache.org. I don't know the location of tests too;)\nIf you are looking for information on how to do the same, see at\nhttp://httpd.apache.org/docs/1.3/mod/mod_alias.html\nThere is forum question as sample - \nhttp://www.webmasterworld.com/forum92/151.htm", "bug_id": 47433, "is_private": false, "id": 128411, "time": "2009-06-29T15:32:50Z", "creator": "jagadesh.munta@sun.com", "creation_time": "2009-06-29T15:32:50Z", "tags": [], "attachment_id": null}, {"count": 9, "text": "Jagadesh,\n\ncould you inquire within Sun why it has been chosen not to allow a redirect between protocols in the HttpURLConnection in general, and why not from http to https (in that direction) in particular?\n\nBecause still if it is not safe we should not do it.\nAnd if it is safe, why shouldn't it be done in the HttpURLConnection instead of within ant?", "bug_id": 47433, "attachment_id": null, "id": 128415, "time": "2009-06-29T21:00:43Z", "creator": "jkf@apache.org", "creation_time": "2009-06-29T21:00:43Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "text": "Martijn,\nOk. I will inquire about HttpURLConnection and update once I get the details.\n\nAbout the ANT, I still think it is an application w.r.t Java (platform) and also the usage for ANT is different than Java, where in java secured applications might be developed. With ANT I think, the usage is under control with the users.\n\nThanks.", "attachment_id": null, "id": 128418, "creator": "jagadesh.munta@sun.com", "time": "2009-06-29T22:24:50Z", "bug_id": 47433, "creation_time": "2009-06-29T22:24:50Z", "is_private": false}, {"count": 11, "tags": [], "creator": "jagadesh.munta@sun.com", "text": "Martijn,\n\nThe following are the responses that I got from JDK folks:- \n\n--- \n\nMichael McMahon wrote:\n> Another problem is the API itself.\n>\n> HttpsURLConnection is a sub-class of HttpURLConnection and when you open\n> a URL, you get one or the other depending on the original URL type. But you can't change\n> the object's type, after a redirect.\n>\n> So, the only way to do redirection between http and https is to disable automatic handling\n> and do it manually in the application.\n>\n> - Michael.\n>\n> Jean-Christophe Collet wrote:\n>> From the top of my head (it was a long time ago), the HTTP specs used for HttpURLConnection at the specified that automatic redirection should only occur when the protocol stayed the same.  i.e. from http to http, or https to https.\n>> This is pretty obvious in the case of forbidding https to http redirection, a bit less the other way around.\n>> Basically that kind of change should not be transparent to the user or/and application.\n>> So the decision to allow this or not had to be differed to the application.\n>>\n>> After that, it's a matter of backward compatibility.\n\n-----", "id": 128599, "time": "2009-07-07T11:15:45Z", "bug_id": 47433, "creation_time": "2009-07-07T11:15:45Z", "is_private": false, "attachment_id": null}, {"count": 12, "text": "I have created and applied a patch to allow a redirect from http to https, but no other protocol switches.", "bug_id": 47433, "attachment_id": null, "id": 128734, "time": "2009-07-10T10:38:10Z", "creator": "jkf@apache.org", "creation_time": "2009-07-10T10:38:10Z", "tags": [], "is_private": false}, {"count": 13, "tags": [], "bug_id": 47433, "attachment_id": null, "id": 128735, "time": "2009-07-10T10:38:55Z", "creator": "jkf@apache.org", "creation_time": "2009-07-10T10:38:55Z", "is_private": false, "text": "svn revision: http://svn.apache.org/viewvc?rev=793048&view=rev"}, {"count": 14, "tags": [], "bug_id": 47433, "is_private": false, "text": "Seeing this problem on 1.8.2\n\nGot a redirect and the file was not downloaded - instead this error message is stored in the file\n\nIf you are not automatically redirected use this url: https://repository.sonatype.org/service/local/repositories/central-proxy/content/org/apache/ivy/ivy/2.3.0/ivy-2.3.0.jar", "id": 169612, "time": "2013-08-20T18:58:28Z", "creator": "john.mcquillan@openjawtech.com", "creation_time": "2013-08-20T18:58:28Z", "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 47433, "attachment_id": null, "is_private": false, "id": 172109, "time": "2014-01-06T15:11:52Z", "creator": "bodewig@apache.org", "creation_time": "2014-01-06T15:11:52Z", "text": "John, could this be bug 54374 rather than this one?  Any chance you could give 1.9.x a try?"}]
[{"text": "According to the 2.3 spec, setLocale() should set the Content-Type header's\ncharset attribute, but this sample returns just \"Content-Type: text/html\":\n\npublic class LocaleServlet extends HttpServlet {\n    public void doGet(HttpServletRequest req, HttpServletResponse res)\n\tthrows IOException, ServletException {\n\tres.setContentType(\"text/html\");\n\tres.setLocale(Locale.JAPANESE);\n\tPrintWriter out = res.getWriter();\n\tout.println(\"Hello!\");\n    }\n}", "tags": [], "bug_id": 6569, "is_private": false, "count": 0, "id": 10946, "time": "2002-02-20T08:03:49Z", "creator": "hans@gefionsoftware.com", "creation_time": "2002-02-20T08:03:49Z", "attachment_id": null}, {"text": "Fixed in 02/20 nightly.", "tags": [], "bug_id": 6569, "is_private": false, "count": 1, "id": 10947, "time": "2002-02-20T08:33:00Z", "creator": "remm@apache.org", "creation_time": "2002-02-20T08:33:00Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "hans@gefionsoftware.com", "attachment_id": null, "id": 10976, "time": "2002-02-20T22:42:31Z", "bug_id": 6569, "creation_time": "2002-02-20T22:42:31Z", "is_private": false, "text": "Thanks for the speedy fix. Unfortunately, it doesn't look like it's solving the\nproblem correctly. The new version of setLocale() looks like this:\n\n    public void setLocale(Locale locale) {\n        [...]\n        this.locale = locale;\n        if ((this.encoding == null) && (this.context != null)) {\n            CharsetMapper mapper = context.getCharsetMapper();\n            this.encoding = mapper.getCharset(locale);\n            if ((contentType != null) && (contentType.indexOf(';') < 0)) {\n                contentType = contentType + \";charset=\" + encoding;\n            }\n        }\n    }\n\nThis means the new Locale doesn't override an existing encoding, which it\nshould (to be consistent with how a charset in setContentType() is handled,\nif nothing else). My suggestion is this:\n\n    public void setLocale(Locale locale) {\n        [...]\n        this.locale = locale;\n        if (this.context != null) {\n            CharsetMapper mapper = context.getCharsetMapper();\n            this.encoding = mapper.getCharset(locale);\n            if (contentType != null) {\n                if (contentType.indexOf(';') < 0)) {\n                    contentType = contentType + \";charset=\" + encoding;\n                }\n                else {\n                    // Replace the previous charset\n                    int i = contentType.indexOf(';');\n                    contentType = contentType.substring(0, i) + \n                        \";charset=\" + encoding;\n                }\n            }\n        }\n    }\n"}, {"count": 3, "tags": [], "text": "I'm not convinced this is really required by the spec, but since you provided\nthe patch, I'm glad to apply it. Thanks Hans.", "attachment_id": null, "bug_id": 6569, "id": 10995, "time": "2002-02-21T06:08:33Z", "creator": "remm@apache.org", "creation_time": "2002-02-21T06:08:33Z", "is_private": false}]
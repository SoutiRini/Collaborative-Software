[{"count": 0, "tags": [], "creator": "tixu@cs.ucsd.edu", "attachment_id": null, "text": "To replay the abnormal abort, put the following line in httpd.conf:\n\nChrootDir /home/username/Downloads\n\nnote that \"username\" is the valid user name, so the path is a valid path (make sure you use a valid path but not \"/\").\n\nThen, run Apache httpd as root (use \"su\"), Apache httpd will abort abnormally, with the following error message in error log:\n\nlibgcc_s.so.1 must be installed for pthread_cancel to work\n\nBy tracing the source code by gdb, we find that the abort is caused by calling pthread_exit() in apr_thread_exit() in srclib/apr/threadproc/unix/thread.c which is called by start_threads() in server/mpm/event/event.c or server/mpm/worker/worker.c.\n\nThe strange thing is that when using the following configuration setting:\n\nChrootDir /\n\nEverything is fine. The pthread_exit() is also called but it goes smoothly. Also running without root (i.e., as normal user) won't cause this abort.\n\nWe have replayed this on Ubuntu 10.04, Ubuntu 11.10, and Fedora 13, the abort behavior happened in all these three systems.\n\nThanks!", "id": 154856, "time": "2012-03-13T00:22:47Z", "bug_id": 52894, "creation_time": "2012-03-13T00:22:47Z", "is_private": false}, {"count": 1, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "id": 154857, "time": "2012-03-13T00:27:56Z", "bug_id": 52894, "creation_time": "2012-03-13T00:27:56Z", "is_private": false, "text": "Is there something unreasonable about having that lib in the chroot?"}, {"count": 2, "tags": [], "creator": "tixu@cs.ucsd.edu", "text": "(In reply to comment #1)\n> Is there something unreasonable about having that lib in the chroot?\n\nHi, Eric,\n\nWe have the libgcc (otherwise it's no way to build from the source code). The information is not accurate.\n\nAnother thing is that when you configure \n\nChrootDir /\n\nIt goes through the same routine without any problem. Note that it also calls pthread_exit() which led to the abort in configuration \"ChrootDir /home/user\".  \n\nI really have no idea why these two configurations makes the difference.  \n\nThanks!", "id": 154859, "time": "2012-03-13T00:40:54Z", "bug_id": 52894, "creation_time": "2012-03-13T00:40:54Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "text": "(In reply to comment #2)\n> (In reply to comment #1)\n> > Is there something unreasonable about having that lib in the chroot?\n> \n> Hi, Eric,\n> \n> We have the libgcc (otherwise it's no way to build from the source code). The\n> information is not accurate.\n> \n> Another thing is that when you configure \n> \n> ChrootDir /\n> \n> It goes through the same routine without any problem. Note that it also calls\n> pthread_exit() which led to the abort in configuration \"ChrootDir /home/user\".  \n> \n> I really have no idea why these two configurations makes the difference.  \n> \n\nThis is all consistent with it being present and usable in the root and not in the chroot.", "id": 154860, "time": "2012-03-13T00:43:29Z", "bug_id": 52894, "creation_time": "2012-03-13T00:43:29Z", "is_private": false}, {"count": 4, "tags": [], "creator": "tixu@cs.ucsd.edu", "attachment_id": null, "id": 154862, "time": "2012-03-13T00:56:21Z", "bug_id": 52894, "creation_time": "2012-03-13T00:56:21Z", "is_private": false, "text": "(In reply to comment #3)\n> (In reply to comment #2)\n> > (In reply to comment #1)\n> > > Is there something unreasonable about having that lib in the chroot?\n> > \n> > Hi, Eric,\n> > \n> > We have the libgcc (otherwise it's no way to build from the source code). The\n> > information is not accurate.\n> > \n> > Another thing is that when you configure \n> > \n> > ChrootDir /\n> > \n> > It goes through the same routine without any problem. Note that it also calls\n> > pthread_exit() which led to the abort in configuration \"ChrootDir /home/user\".  \n> > \n> > I really have no idea why these two configurations makes the difference.  \n> > \n> \n> This is all consistent with it being present and usable in the root and not in\n> the chroot.\n\nHi, Eric,\n\nSorry for the bothering. I still don't get it.:( \n\nDo you mean this is a normal behavior? Could you please explain a little bit more? Also, do you need more information on this (I see you changed it to NEEDINFO)?\n\nThanks a lot for the help!"}, {"count": 5, "tags": [], "bug_id": 52894, "text": "I recall passing references to it being necessary within the chroot before.  It's still not clear from your comments whether it's available both in your root and chroot.  \n\nIf it's required, and not present in the chroot, We won't second-guess that the system wants it there.", "id": 154863, "time": "2012-03-13T01:02:38Z", "creator": "covener@gmail.com", "creation_time": "2012-03-13T01:02:38Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "tixu@cs.ucsd.edu", "text": "(In reply to comment #5)\n> I recall passing references to it being necessary within the chroot before. \n> It's still not clear from your comments whether it's available both in your\n> root and chroot.  \n> \n> If it's required, and not present in the chroot, We won't second-guess that the\n> system wants it there.\n\nOk, so now I understand the problem.\n\nSo basically, 'chroot' is to run a program with a specified root directory. I changed the root directory to some \"dubby\" directory (although it's a valid directory). In the mean time, the dubby directory is not linked with the libgcc. As a result, when I call the pthread_exit(), it just aborts with the message to let me install libgcc. \n\nOn the other hand, when I chroot to \"/\" which is the default root directory, nothing changed and everything goes smoothly.\n\nI have to say that the system response is really important. The error message here is kind of misleading...:(\n\nThanks a lot for your patient, Eric. I do appreciate very much!", "id": 154864, "time": "2012-03-13T01:55:17Z", "bug_id": 52894, "creation_time": "2012-03-13T01:55:17Z", "tags": [], "is_private": false}, {"count": 7, "attachment_id": null, "creator": "nick@webthing.com", "text": "System error messages arising from an incorrectly configured chroot are far outside our control.", "id": 202820, "time": "2017-12-17T09:00:39Z", "bug_id": 52894, "creation_time": "2017-12-17T09:00:39Z", "tags": [], "is_private": false}]
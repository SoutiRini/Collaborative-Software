[{"count": 0, "attachment_id": null, "bug_id": 46480, "is_private": false, "id": 123777, "time": "2009-01-05T12:41:25Z", "creator": "brian.bonner@paraware.com", "creation_time": "2009-01-05T12:41:25Z", "tags": [], "text": "This used to work with version 1.6.5.\n\nI'm using Maven 2.0.9.  When I use the ant-run plugin, it used to log tasks after an SQL task was specified without any problem.  Upgrading to 1.7.0 or 1.7.1 breaks this functionality.\n\n<profiles>\n\t\t<profile>\n\t\t\t<id>createdb</id>\n\t\t\t<build>\n\t\t\t\t<plugins>\n\t\t\t\t\t<plugin>\n\t\t\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t\t\t<artifactId>maven-antrun-plugin</artifactId>\n\t\t\t\t\t\t<version>1.3</version>\n\t\t\t\t\t\t<configuration>\n\t\t\t\t\t\t\t<tasks>\n\t\t\t\t\t\t\t\t<echo>test before sql</echo>\n\t\t\t\t\t\t\t\t<sql driver=\"oracle.jdbc.OracleDriver\" url=\"jdbc:oracle:thin:@localhost:1521:XE\" userid=\"test\" password=\"test\" autocommit=\"false\" delimiter=\";\" onerror=\"continue\" >\n\t\t\t\t\t\t\t\t\t<transaction\n\t\t\t\t\t\t\t\t\t\tsrc=\"${basedir}/ddl/test.dev.sql\" />\n\t\t\t\t\t\t\t\t</sql>\n<echo>test after sql</echo>\n\t\t\t\t\t\t\t</tasks>\n\t\t\t\t\t\t</configuration>\n\t\t\t\t\t\t<executions>\n\t\t\t\t\t\t\t<execution>\n\t\t\t\t\t\t\t\t<id>create database</id>\n\t\t\t\t\t\t\t\t<phase>install</phase>\n\t\t\t\t\t\t\t\t<goals>\n\t\t\t\t\t\t\t\t\t<goal>run</goal>\n\t\t\t\t\t\t\t\t</goals>\n\t\t\t\t\t\t\t</execution>\n\t\t\t\t\t\t</executions>\n\t\t\t\t\t\t<dependencies>\n\t\t\t\t\t\t\t<dependency>\n\t\t\t\t\t\t\t\t<groupId>ojdbc</groupId>\n\t\t\t\t\t\t\t\t<artifactId>ojdbc</artifactId>\n\t\t\t\t\t\t\t\t<version>1.4</version>\n\t\t\t\t\t\t\t</dependency>\n\t\t\t\t\t\t</dependencies>\n\t\t\t\t\t</plugin>\n\t\t\t\t</plugins>\n\t\t\t</build>\n\t\t</profile>\n\nWith 1.6.5, I see this:\n\n[INFO] Executing tasks\n     [echo] test before sql\n      [sql] Executing file: C:\\work\\workspace\\OptimizerWebData\\sql\\01_optmzr_pro\nd.sql\n      [sql] 4252 of 4252 SQL statements executed successfully\n     [echo] test after sql\n\nWith 1.7.1, I see this:\n\n[INFO] Executing tasks\n     [echo] test before sql\n      [sql] Executing file: C:\\work\\workspace\\OptimizerWebData\\sql\\01_optmzr_pro\nd.sql\n      [sql] 4252 of 4252 SQL statements executed successfully\n     [echo] test after sql"}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 123791, "time": "2009-01-05T22:12:34Z", "bug_id": 46480, "creation_time": "2009-01-05T22:12:34Z", "is_private": false, "text": "I'm not familiar with the antrun plugin at all, and I don't really have a working Maven installation around either, so I may need some help debugging this.\n\nBut first things first, where is the difference between the two outputs?  I guess you've just pasted the wrong output for the 1.7.1 run."}, {"count": 2, "tags": [], "text": "Stefan, sorry about that.  Thanks for your msg.  I was too quick with the post.\n\nWith 1.7.1, I see this:\n\n[INFO] Executing tasks\n     [echo] test before sql\n      [sql] Executing file:\nC:\\work\\workspace\\OptimizerWebData\\sql\\01_optmzr_pro\nd.sql\n\nI don't see the # of statements executed or the second echo.  I had pulled down the source for 1.7.1 ant to debug this and see the print stream created and see the methods being called in the code (they all have a priority of 2), but for some reason the last two statements are not printing.\n\n", "is_private": false, "bug_id": 46480, "id": 123796, "time": "2009-01-06T04:53:17Z", "creator": "brian.bonner@paraware.com", "creation_time": "2009-01-06T04:53:17Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 46480, "attachment_id": null, "text": "Have you actually tried 1.7.0 as well?  I think I've spotted the problem, but if I do, it has been introduced with svn revision 551166 which went into 1.7.1 but not into 1.7.0.\n\nIn the execute method there is a finally block that looks like\n\n                } finally {\n                    FileUtils.close(out);\n                }\n\nin 1.7.1.  Can you change it to read\n\n                } finally {\n                    if (out != System.out) {\n                        FileUtils.close(out);\n                    }\n                }\n\nand somehow make maven use your patched code to verify this is causing\nthe problem?\n", "id": 123797, "time": "2009-01-06T06:17:56Z", "creator": "bodewig@apache.org", "creation_time": "2009-01-06T06:17:56Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "bodewig@apache.org", "text": "Actually, my proposed fix would be svn revision 731951", "count": 4, "id": 123798, "time": "2009-01-06T06:28:00Z", "bug_id": 46480, "creation_time": "2009-01-06T06:28:00Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 46480, "is_private": false, "text": "Brian, is there anything I can do to help testing - like providing a patched version of ant-1.7.1.jar that you could put into your local Maven repository or something?", "id": 123954, "time": "2009-01-12T04:29:27Z", "creator": "bodewig@apache.org", "creation_time": "2009-01-12T04:29:27Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "Stefan, my apologies for the delay in getting back to you.\n\nI don't think I tried 1.7.0.  I bet that does fix the problem.  I'll try it right now.", "is_private": false, "bug_id": 46480, "id": 123998, "time": "2009-01-13T09:54:42Z", "creator": "brian.bonner@paraware.com", "creation_time": "2009-01-13T09:54:42Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "1.7.0 did the trick.  So you nailed the problem.  I'll try a patched jar if you send it on over -- that would be great!  Thanks for your help -- and looking into the problem.", "is_private": false, "bug_id": 46480, "id": 123999, "time": "2009-01-13T09:58:31Z", "creator": "brian.bonner@paraware.com", "creation_time": "2009-01-13T09:58:31Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "bodewig@apache.org", "text": "Hi Brian, I'm glad 1.7.0 was an option for you.\n\nUnder http://people.apache.org/~bodewig/ant.jar you find a patched ant.jar built from the Ant 1.7.1 tag but with my patch to trunk backported.  This is certainly no real release ...\n\nStill it would be good if you could verify that it doesn't expose the same problem as 1.7.1.\n", "count": 8, "id": 124028, "time": "2009-01-14T04:53:43Z", "bug_id": 46480, "creation_time": "2009-01-14T04:53:43Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 46480, "text": "any news on my patched jar?", "id": 124382, "time": "2009-01-26T21:10:22Z", "creator": "bodewig@apache.org", "creation_time": "2009-01-26T21:10:22Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "brian.bonner@paraware.com", "attachment_id": null, "id": 124978, "time": "2009-02-19T07:01:45Z", "bug_id": 46480, "creation_time": "2009-02-19T07:01:45Z", "is_private": false, "text": "Stefan, it works fine.  I'm sorry for taking so long to get back to you.  Thank you for the help."}, {"count": 11, "tags": [], "text": "no problem at all, thanks for testing.\n\nI can now safely remove ant.jar from my people.a.o directory.", "is_private": false, "bug_id": 46480, "id": 124980, "time": "2009-02-19T07:48:38Z", "creator": "bodewig@apache.org", "creation_time": "2009-02-19T07:48:38Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "jkf@apache.org", "attachment_id": null, "id": 125864, "time": "2009-03-28T01:21:28Z", "bug_id": 46480, "creation_time": "2009-03-28T01:21:28Z", "is_private": false, "text": "*** Bug 46931 has been marked as a duplicate of this bug. ***"}]
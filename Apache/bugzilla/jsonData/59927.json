[{"count": 0, "tags": [], "bug_id": 59927, "attachment_id": 34091, "id": 192804, "time": "2016-08-02T11:50:12Z", "creator": "petr.sumbera@oracle.com", "creation_time": "2016-08-02T11:50:12Z", "is_private": false, "text": "Created attachment 34091\nproposed patch\n\nconfigure would not enable apr-util dbd mysql driver for MySQL 5.7 where is no longer present libmysqlclient_r:\n\nchecking for mysql_config... /usr/mysql/5.7/bin/mysql_config\n  adding \"-I/usr/mysql/5.7/include\" to CPPFLAGS\n  setting LDFLAGS to \"-L/usr/mysql/5.7/lib/amd64 -R/usr/mysql/5.7/lib/amd64 -lmysqlclient -lm\"\n  setting LIBS to \"-L/usr/mysql/5.7/lib/amd64 -R/usr/mysql/5.7/lib/amd64 -lmysqlclient -lm\"\nconfigure: checking for mysql in /usr/mysql/5.7\nchecking for mysql.h... yes\nchecking for mysql_init in -lmysqlclient_r... no\nchecking for my_global.h... yes\nchecking for mysql_init in -lmysqlclient_r... (cached) no\nchecking for my_sys.h... yes\nchecking for mysql_init in -lmysqlclient_r... (cached) no\nchecking for mysql/mysql.h... no\n  adding \"-I/usr/include\" to CPPFLAGS\n  setting LDFLAGS to \"-L/usr/lib \"\n\nMy understanding is that MySQL 5.7 is first version where this library is not present. But also in previous versions (e.g. 5.5 and 5.6) libmysqlclient_r was just link to libmysqlclient.\n\nWith attached proposed patch the configure will report following:\n\nconfigure: checking for mysql in /usr/mysql/5.7\nchecking for mysql.h... yes\nchecking for mysql_init in -lmysqlclient... yes\nchecking for my_global.h... yes\nchecking for mysql_init in -lmysqlclient... (cached) yes\nchecking for my_sys.h... yes\nchecking for mysql_init in -lmysqlclient... (cached) yes\n  adding \"-I/usr/mysql/5.7/include\" to APRUTIL_PRIV_INCLUDES\n  setting LDADD_dbd_mysql to \"-L/usr/mysql/5.7/lib/amd64 -R/usr/mysql/5.7/lib/amd64 -lmysqlclient -lm -lmysqlclient -L/usr/mysql/5.7/lib/amd64 -R/usr/mysql/5.7/lib/amd64 -lmysqlclient -lm\"\n  adding \"-I/usr/include\" to CPPFLAGS\n  setting LDFLAGS to \"-L/usr/lib \""}, {"attachment_id": null, "tags": [], "creator": "nick@webthing.com", "text": "Thanks for the patch, but I think we need something a little more.\n\nThat is to say, we should pick up mysqlclient_r if the installed version of mysql has it, and mysqlclient only if there is no _r.  Hence the logic:\n\ntest for libmysqlclient_r\nIf found, use it and set HAVE_MYSQL\nIf not found, test for libmysqlclient\nIf found, use it and set HAVE_MYSQL\nelse we have no MySQL.\n\nOr is there some good reason not to do that?", "count": 1, "id": 194211, "time": "2016-10-07T20:51:15Z", "bug_id": 59927, "creation_time": "2016-10-07T20:51:15Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 59927, "text": "Hi! I've been working on the limysqlclient_r -> libmysqlclient transition at Oracle.\n\nThere is no reason to prefer libmysqlclient_r over libmysqlclient. In all current releases, libmysqlclient is the preferred library. The last MySQL version to be shipped with a separate libmysqlclient_r library was MySQL 5.1, which was EOLed on December 31, 2013. We kept libmysqlclient_r as a compatibility symlink in MySQL 5.5 and 5.6, and removed it in 5.7. In MySQL 8.0 (currently in development), the --libs_r option to mysql-config is also gone.\n\nIt doesn't hurt to pick libmysqlclient_r over libmysqlclient, as suggested in the previous comment, but I don't think it's necessary to add the complexity.\n\nFor more info:\n\nhttp://mysqlserverteam.com/the-client-library-part-3-building-mysql-client-applications/\nhttp://mysqlserverteam.com/deprecating-the-mysql_config-libs_r-option/\nhttps://www.mysql.com/support/eol-notice.html", "id": 194300, "time": "2016-10-10T10:52:44Z", "creator": "norvald.ryeng@oracle.com", "creation_time": "2016-10-10T10:52:44Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "nick@webthing.com", "text": "Patch adopted in trunk and for the forthcoming APU-1.6.  Thanks.", "count": 3, "id": 198123, "time": "2017-04-02T16:29:01Z", "bug_id": 59927, "creation_time": "2017-04-02T16:29:01Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "jonas.ringh@cixit.se", "attachment_id": null, "text": "When using \"internal_internal_redirect\" the server port the request was made\nthough is lost. As far as I can tell this is only an issue if you are using a\nport that differs from the default one.\n\nHere is one way to reproduce the bug using the rewrite engine...\n\n1. Setup a virtual server to use at least two ports.\n\n--- --- ---\nListen 80\nListen 81\n\nNameVirtualHost x.x.x.x:80\nNameVirtualHost x.x.x.x:81\n<VirtualHost x.x.x.x:80 x.x.x.x:81>\n    DocumentRoot /home/user/bugtest_web\n</VirtualHost>\n--- --- ---\n\n2. In the root directory of the server, create a test script that prints the\n\"SERVER_PORT\" environment variable. Could for instance be a CGI-script, in which\ncase you also need to enable ExecCGI for the directory containing the test script.\n\n--- --- ---\n#!/bin/sh\necho Content-type: text/plain\necho\necho SERVER_PORT = $SERVER_PORT\n--- --- ---\n\n3. Within a \"<directory>\" directive create a rewrite rule that makes a local\nredirect to the test script.\n\n--- --- ---\n<directory /home/user/bugtest_web>\n    RewriteEngine on\n    RewriteRule test test.cgi\n</directory>\n--- --- ---\n\n4. Navigate to the test file via the rewriterule on both ports...\n\n$ lynx -dump x.x.x.x:80/test\n$ lynx -dump x.x.x.x:81/test\n\nIn both cases the output will be...\nSERVER_PORT = 80\n\nThe port that comes first in the virtualhost declaration is the one that is\nreturned. The port that corresponds to the request is obviously what should be\nreturned.\n\nAfter sifting though the source I found that mod_rewrite uses\n\"ap_internal_redirect\" to do the actual redirect.\n\n\"ap_internal_redirect\" calls \"internal_internal_redirect\" to setup the\n\"request_rec\" for the new URI. While doing that the original port information\nassociated with the request is not copied to the new URI.", "id": 78020, "time": "2005-08-03T18:47:51Z", "bug_id": 35999, "creation_time": "2005-08-03T18:47:51Z", "is_private": false}, {"attachment_id": 15865, "tags": [], "bug_id": 35999, "is_private": false, "count": 1, "id": 78021, "time": "2005-08-03T18:57:54Z", "creator": "jonas.ringh@cixit.se", "creation_time": "2005-08-03T18:57:54Z", "text": "Created attachment 15865\nPatch that fixes the problem"}, {"count": 2, "tags": [], "bug_id": 35999, "is_private": false, "text": "This bug is still present in 2.2.6", "id": 112234, "time": "2007-12-27T06:14:12Z", "creator": "ahh@one.com", "creation_time": "2007-12-27T06:14:12Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 35999, "is_private": false, "text": "This bug is still present in 2.2.9 on Windows (not tried on other platforms, but I assume there as well).", "id": 120040, "time": "2008-08-22T13:48:16Z", "creator": "m.stoff@stoffdv.at", "creation_time": "2008-08-22T13:48:16Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 35999, "text": "Oops, this has languished a long time.\nFixed in Trunk in r807015 - thanks for the report and patch.", "id": 129858, "time": "2009-08-23T13:32:13Z", "creator": "nick@webthing.com", "creation_time": "2009-08-23T13:32:13Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "text": "Backported to 2.2 (at last) in r807015 - thanks!", "id": 133477, "time": "2010-01-09T14:36:52Z", "bug_id": 35999, "creation_time": "2010-01-09T14:36:52Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 35999, "text": "Bah.  That should've read backported in r897568.", "id": 133478, "time": "2010-01-09T14:37:43Z", "creator": "nick@webthing.com", "creation_time": "2010-01-09T14:37:43Z", "is_private": false, "attachment_id": null}]
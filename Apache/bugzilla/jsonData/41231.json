[{"count": 0, "tags": [], "creator": "michael@maxspot.de", "text": "I'm issuing a request:\n\nGET /index.php HTTP/1.1\nHost: localhost\nUpgrade: TLS/1.0\nConnection: upgrade\n\nAnd my client crashes because it can't parse the plaintext given back by \nindex.php (which contains <?php for ($i = 0; $i < 10; $i++) echo \"foobar\"; ?>). \nIn strace it's clearly visible:\n[pid 16349] recv(8,\n\"\\24\\3\\1\\0\\1\\1\\26\\3\\1\\0000f\\212W\\335\\273\\16L\\352\\357\\3054\\32\\204\\311\\376\n\\264a4l\\3670\\17\\303e\\224\\202\\370!\\361\\271\\311\\320\\360\\356\\210ZN\\255w\\314\n~\\351\\377=}\\250irfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobarfoobar\",\n2048, 0) = 119\n\nIf an OPTION * HTTP/1.1-request is sent before, it correctly switches and \nprocesses the next request.\n\nYou can reproduce it by using tlsupgrade.c:\nGet http://people.apache.org/~bnicholes/tlsupgrade/tlsupgrade.c\nCompile it with gcc -lssl -o tlsupgrade tlsupgrade.c\nRun it using: strace -s 2048 ./tlsupgrade http://localhost/index.php\nSSLEngine needs to be set to optional for the vhost (on port 80).", "id": 97180, "time": "2006-12-21T21:59:47Z", "bug_id": 41231, "creation_time": "2006-12-21T21:59:47Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 41231, "attachment_id": null, "id": 97206, "time": "2006-12-23T10:02:47Z", "creator": "michael@maxspot.de", "creation_time": "2006-12-23T10:02:47Z", "is_private": false, "text": "Apparantly the APR_BUCKET_IS_EOC is true for some reason, so \nssl_filter_io_shutdown is called and the result is not filtered via SSL \nanymore. Before APR_BUCKET_IS_EOC is true, ssl_filter_write (which is called \nwhen APR_BUCKET_IS_EOC is not true) is called two times with NULL as data-\npointer. \n\nI don't know if this is normal behaviour and i'm not very into debugging \napache, but maybe it gives a hint to the developers."}, {"attachment_id": null, "tags": [], "bug_id": 41231, "is_private": false, "count": 2, "id": 110268, "time": "2007-11-06T07:03:28Z", "creator": "jorton@redhat.com", "creation_time": "2007-11-06T07:03:28Z", "text": "Fixed on trunk:  http://svn.apache.org/viewvc?view=rev&revision=592446"}]
[{"count": 0, "tags": [], "bug_id": 57691, "attachment_id": null, "id": 181701, "time": "2015-03-12T13:11:39Z", "creator": "dferradal@gmail.com", "creation_time": "2015-03-12T13:11:39Z", "is_private": false, "text": "Problem: mod_proxy or proxy_util are confusing a fcgi with a http one\n\nScenario: The only scenario I have seen where that happens is when you proxy to uds through mod_rewrite.\n\nExample:\n\nProxyPassMatch ^(.+\\.php)(/.+)?$ \"unix:/opt/apache/httpd/logs/fpm/owncloud.sock|fcgi://localhost/var/www/\" <-- WILL WORK\n\nIn the same exact context (VirtualHost):\nRewriteRule ^/(.+\\.php)(/.+)?$ unix:/opt/apache/httpd/logs/fpm/owncloud.sock|fcgi://localhost/var/www/ [P,L] <-- it seems proxy_util will interpret the client is requesting:\n/unix:/opt/apache/httpd/logs/fpm/owncloud.sock|fcgi://localhost/var/www/\n\n\n\nAs you can see in the trace log bellow it seems like a \"/\" has been prepended to the uds scheme turning it into a http scheme request:\n\n[Tue Mar 10 20:54:07.372247 2015] [proxy:trace2] [pid 7006:tid 139906126960384] proxy_util.c(1976): [client masked:masked] *: using default reverse proxy worker for https://masked/unix:/opt/apache/httpd/logs/fpm/owncloud.sock%7Cfcgi://localhost/var/www/ (no keepalive)\n[Tue Mar 10 20:54:07.372319 2015] [proxy:debug] [pid 7006:tid 139906126960384] mod_proxy.c(1163): [client masked:masked] AH01143: Running scheme https handler (attempt 0)\n[Tue Mar 10 20:54:07.372353 2015] [proxy:debug] [pid 7006:tid 139906126960384] proxy_util.c(2193): [client masked:masked] AH00944: connecting https://masked/unix:/opt/apache/httpd/logs/fpm/owncloud.sock%7Cfcgi://localhost/var/www/ to masked:443\n[Tue Mar 10 20:54:07.480068 2015] [proxy:debug] [pid 7006:tid 139906126960384] proxy_util.c(2394): [client masked:masked] AH00947: connected /unix:/opt/apache/httpd/logs/fpm/owncloud.sock%7Cfcgi://localhost/var/www/ to masked:443\n[Tue Mar 10 20:54:07.480241 2015] [ssl:error] [pid 7006:tid 139906126960384] [remote 188.226.254.185:443] AH01961: SSL Proxy requested for masked:443 but not enabled [Hint: SSLProxyEngine]\n[Tue Mar 10 20:54:07.480259 2015] [proxy:error] [pid 7006:tid 139906126960384] AH00961: HTTPS: failed to enable ssl support for masked:443 (masked)\n\nHope this helps."}]
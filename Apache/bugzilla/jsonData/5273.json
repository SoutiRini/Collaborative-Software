[{"count": 0, "tags": [], "bug_id": 5273, "text": "The mail is actually sent, but the Mail task claims failure.\n\nThis appears to be due to send QUIT returning a blank line, which causes the \nmail task to generate an IndexOutOfBoundsException in line 87 of \nSmtpResponseReader.\n\nI believe my mail server is probably MS-Exchange pretending to be a smtp mail \nserver.\n\nUsing the MimeMail task works perfectly.", "id": 8583, "time": "2001-12-04T17:20:05Z", "creator": "william_ferguson@versata.com", "creation_time": "2001-12-04T17:20:05Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 5273, "attachment_id": null, "id": 8588, "time": "2001-12-04T23:55:19Z", "creator": "bodewig@apache.org", "creation_time": "2001-12-04T23:55:19Z", "is_private": false, "text": "I wouldn't be all that surprised to see Exchange not following the RFCs - on the\nother hand, I already had to modify Jason's original code as it couldn't deal\nwith perfectly legal continuation lines ...\n\nCan you give me the protocol of a complete SMTP session that you run by using\ntelnet to the offending server's SMTP port?  Something like\n\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\n220 xxxxxxxxxxxxxxxx ESMTP Sendmail 8.11.6/8.11.6; Wed, 5 Dec 2001 08:45:01\n+0100helo xxxxxxxxxxxxxxxx\n250 xxxxxxxxxxxxxxxx Hello IDENT:0fcKw84eikv1kInYntvVQBPPFsMI8DQ8@localhost\n[127.0.0.1], pleased to meet you\nmail from: <some@legal.address>\n250 2.1.0 <some@legal.address>... Sender ok\nrcpt to: <someother@legal.address>\n250 2.1.5 <someother@legal.address>... Recipient ok\ndata\n354 Enter mail, end with \".\" on a line by itself\nSubject: Dummymail\n\nsome text here\n.\n250 2.0.0 fB57jc804797 Message accepted for delivery\nquit\n221 2.0.0 xxxxxxxxxxxxxxx closing connection\nConnection closed by foreign host.\n"}, {"count": 2, "attachment_id": 878, "bug_id": 5273, "is_private": false, "id": 8639, "time": "2001-12-05T14:27:57Z", "creator": "william_ferguson@versata.com", "creation_time": "2001-12-05T14:27:57Z", "tags": [], "text": "Created attachment 878\nlog of telnet session with mailserver"}, {"count": 3, "tags": [], "bug_id": 5273, "attachment_id": null, "id": 8669, "time": "2001-12-06T08:10:42Z", "creator": "bodewig@apache.org", "creation_time": "2001-12-06T08:10:42Z", "is_private": false, "text": "Hmm, the log looks the way it should (except for some stray white space in front\nof your quit command).\n\nAre you sure, you are talking about Ant 1.4.1?  line 87 is\n\nresult.setLength(0);\n\nwhich shouldn't throw and IndexOutOfBoundsException (can it?).\n\nCan you give us a complete stack trace please?"}, {"count": 4, "tags": [], "text": "The offending line is\n            result.append(line.substring(0, 3));\nwhich is line 87 in the source I have.\nSince the source can only be downloaded from the Nightly build section it is \nprobably slightly newer than 1.4.1\n\nBut this is the staktrace I get using the a straight Ant 1.4.1 install\n\njava.lang.StringIndexOutOfBoundsException: String index out of range: 3\n        at java.lang.String.substring(String.java:1522)\n        at org.apache.tools.mail.SmtpResponseReader.getResponse\n(SmtpResponseReader.java:87)\n        at org.apache.tools.mail.MailMessage.send(MailMessage.java:374)\n        at org.apache.tools.mail.MailMessage.sendQuit(MailMessage.java:368)\n        at org.apache.tools.mail.MailMessage.sendAndClose(MailMessage.java:279)\n        at org.apache.tools.ant.taskdefs.SendEmail.execute(SendEmail.java:246)\n        at org.apache.tools.ant.Task.perform(Task.java:217)\n        at org.apache.tools.ant.Target.execute(Target.java:164)\n        at org.apache.tools.ant.Target.performTasks(Target.java:182)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:601)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:560)\n        at org.apache.tools.ant.Main.runBuild(Main.java:454)\n        at org.apache.tools.ant.Main.start(Main.java:153)\n        at org.apache.tools.ant.Main.main(Main.java:176)\n\n\nIt the substring that is throwing the IndexOutOfBounds.\nAs will the other uses of substring, and charAt in this class, as none of them \ncheck for String length first.\n\n\n", "attachment_id": null, "id": 8680, "creator": "william_ferguson@versata.com", "time": "2001-12-06T13:53:32Z", "bug_id": 5273, "creation_time": "2001-12-06T13:53:32Z", "is_private": false}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 8736, "time": "2001-12-10T05:21:18Z", "bug_id": 5273, "creation_time": "2001-12-10T05:21:18Z", "is_private": false, "text": "OK, the sources have changed because all * imports have been changed to explicit\nones - that's why the line numbers have changed.\n\nLooking at your trace, the response is longer than three characters and follows\nall rules for SMTP.  I'll add some explicit checks, but they'll probably only\nlead to \"protocol error\" exceptions instead of this one.  Could you please try\nthe next nightly build (2001-12-11) and see what happens?"}, {"count": 6, "tags": [], "creator": "william_ferguson@versata.com", "attachment_id": null, "id": 8802, "time": "2001-12-11T20:41:41Z", "bug_id": 5273, "creation_time": "2001-12-11T20:41:41Z", "is_private": false, "text": "Ran with nightly build from 11-DEC-2001\nBuild output was:\n\n\nBUILD FAILED\n\nD:\\source\\main\\buildScripts\\NightlyBuild.xml:167: IO error sending mail\n\tat org.apache.tools.ant.taskdefs.SendEmail.execute(SendEmail.java:289)\n\tat org.apache.tools.ant.Task.perform(Task.java:217)\n\tat org.apache.tools.ant.Target.execute(Target.java:186)\n\tat org.apache.tools.ant.Target.performTasks(Target.java:204)\n\tat org.apache.tools.ant.Project.executeTarget(Project.java:855)\n\tat org.apache.tools.ant.Project.executeTargets(Project.java:809)\n\tat org.apache.tools.ant.Main.runBuild(Main.java:468)\n\tat org.apache.tools.ant.Main.start(Main.java:159)\n\tat org.apache.tools.ant.Main.main(Main.java:182)\n--- Nested Exception ---\njava.io.IOException: Unexpected reply to command: QUIT: \n\tat org.apache.tools.mail.MailMessage.send(MailMessage.java:412)\n\tat org.apache.tools.mail.MailMessage.sendQuit(MailMessage.java:403)\n\tat org.apache.tools.mail.MailMessage.sendAndClose(MailMessage.java:314)\n\tat org.apache.tools.ant.taskdefs.SendEmail.execute(SendEmail.java:287)\n\tat org.apache.tools.ant.Task.perform(Task.java:217)\n\tat org.apache.tools.ant.Target.execute(Target.java:186)\n\tat org.apache.tools.ant.Target.performTasks(Target.java:204)\n\tat org.apache.tools.ant.Project.executeTarget(Project.java:855)\n\tat org.apache.tools.ant.Project.executeTargets(Project.java:809)\n\tat org.apache.tools.ant.Main.runBuild(Main.java:468)\n\tat org.apache.tools.ant.Main.start(Main.java:159)\n\tat org.apache.tools.ant.Main.main(Main.java:182)\n"}, {"count": 7, "tags": [], "bug_id": 5273, "attachment_id": null, "text": "But it does send a response, doesn't it?  From your trace:\n\n221 retro.xedoc.com.au closing connection\n\nI'll see whether I can change the class so that a bad response on QUIT isn't\ntreated as a problem - does the mail get sent?\n", "id": 8924, "time": "2001-12-14T08:01:14Z", "creator": "bodewig@apache.org", "creation_time": "2001-12-14T08:01:14Z", "is_private": false}, {"count": 8, "tags": [], "text": "Yeah - it sends a response. But it appears to be an empty String.\nThe mail always gets sent.", "attachment_id": null, "id": 8948, "creator": "william_ferguson@versata.com", "time": "2001-12-16T14:14:49Z", "bug_id": 5273, "creation_time": "2001-12-16T14:14:49Z", "is_private": false}, {"count": 9, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 9440, "time": "2002-01-08T02:53:06Z", "bug_id": 5273, "creation_time": "2002-01-08T02:53:06Z", "is_private": false, "text": "OK, I finally changed the code to deal with errors in the QUIT command a little\ndifferently.  Could you please try the nightly build 2002-01-09 and see whether\nthe problem does away?"}, {"count": 10, "tags": [], "text": "It's been a month now since Stefan's fix went in place.  This should have fixed \nthis issue because we haven't heard back a nagative response from William.\nMarking it as fixed.  William, you may reopen it if the problem persists.", "attachment_id": null, "id": 10469, "creator": "umagesh@apache.org", "time": "2002-02-07T18:15:11Z", "bug_id": 5273, "creation_time": "2002-02-07T18:15:11Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "Created attachment 24240\nFO test case\n\nI faced this bug when I tried to render table with no exact widths for the\ntable cells. \n\nFO was generated by CSSToXSLFO converter from very simple html code and it was\ngenerated correctly.\n\nOriginal html:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n<head>\n</head>\n<body>\n<table><tr><td>cell 1</td><td>cell 2</td></tr></table>\n</body>\n</html>\n\nCSSToXSLFO produced FO stylesheet that I attached to the bug as a test case.\nIt's perfectly correct and works fine with FO->PDF conversion. RTF however\nproduced ugly table with huge unreadable columns.\n\nQuick fix:\n\nModify org.apache.fop.render.rtf.rtflib.tools.PercentContext. Replace:\n\n    public void setTableUnit(Table table, int tableUnit) {\n        tableUnitMap.put(table, new Integer(tableUnit));\n    }\n\nwith:\n\n    public void setTableUnit(Table table, int tableUnit) {\n        Integer tableUnitAsInt = new Integer(tableUnit);\n        tableUnitMap.put(table, tableUnitAsInt);\n        // put table units for all columns\n        for (Object tc : table.getColumns()) {\n            tableUnitMap.put(tc, tableUnitAsInt);\n        }\n    }\n\nExplanation:\n\nChecking the source code I found that RTF render can't resolve columns widths\ncorrectly in the startColumn(TableColumn tc) method of RTFHandler. The column\nwidth always come out as 0 for proportional width columns.\n\nActual call is:\n\nint iWidth = tc.getColumnWidth().getValue(percentManager);\n\nWhich finally comes to int getBaseLength(int lengthBase, FObj fobj) in\nPercentContext class\n\nFirst argument comes as LengthBase.TABLE_UNITS, second - TableColumn object to\nresolve width. Length is extracted from the Map:\n    Object unit = tableUnitMap.get(fobj);\n\n\nHowever this Map is never initialized correctly for TableColumn objects.\nInitialization is done only for the Table object but not for columns. All\nrequests for width calculation could not find width for columns specified in\nTABLE_UNITS, returned 0.0.\n\nAs a result 0.0 width passed to RTF call tag and produce ugly output for\ncolumns.\n\nSimple fix was straight-forward. Fill tableUnitMap with correct widths for\nTableColumn objects too. That fixed the problem and produce nice table output\nin RTF.", "is_private": false, "bug_id": 47811, "id": 130257, "time": "2009-09-09T11:56:17Z", "creator": "pmolchanov@idsk.com", "creation_time": "2009-09-09T11:56:17Z", "attachment_id": 24240}, {"count": 1, "text": "Created attachment 24241\nFix for RTF renderer", "bug_id": 47811, "attachment_id": 24241, "id": 130258, "time": "2009-09-09T11:58:29Z", "creator": "pmolchanov@idsk.com", "creation_time": "2009-09-09T11:58:29Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "gadams@apache.org", "is_private": false, "id": 157283, "attachment_id": null, "bug_id": 47811, "creation_time": "2012-04-07T01:37:29Z", "time": "2012-04-07T01:37:29Z", "text": "resetting severity from major to normal pending further review"}, {"count": 3, "tags": [], "bug_id": 47811, "attachment_id": null, "id": 157483, "time": "2012-04-07T01:43:42Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:43:42Z", "is_private": false, "text": "resetting P2 open bugs to P3 pending further review"}]
[{"count": 0, "attachment_id": null, "bug_id": 44199, "is_private": false, "id": 112731, "time": "2008-01-10T05:02:28Z", "creator": "skibaa@gmail.com", "creation_time": "2008-01-10T05:02:28Z", "tags": [], "text": "I want to contribute a custom SocketFactory allowing to analyze the utilization\nof acceptConnection attribute of a Connector. In a properly configured\nproduction system, there should be rare situations where connections wait for a\nworker thread to be handled. Our client complained on high latency of web\nrequests, but the measurement on servlet did not show high latency. So we wanted\nto know the number of connections which wait in socket backlog and were not\naccepted yet.\n\nI solved this problem by writing a custom SocketFactory, which accepts\nconnections immediately and puts it in my queue until a call to accept() will\ntake them. So the number of waiting connections can be monitored via JMX.\n\nTo activate this factory, the declaration of the corresponding Connector in\nserver.xml should be changed like in the following example.\n\n <Connector port=\"8080\" maxHttpHeaderSize=\"8192\"\n               maxThreads=\"10\" minSpareThreads=\"5\" maxSpareThreads=\"7\"\n               enableLookups=\"false\" redirectPort=\"8443\" acceptCount=\"10\"\n               connectionTimeout=\"2000\" disableUploadTimeout=\"true\"\n\n              \nsocketFactory=\"org.apache.tomcat.util.net.BacklogMeasuringServerSocketFactory\"/>\n\n\nNo changes in existing classes are required.\n\nPlease review the code in the attachment."}, {"count": 1, "attachment_id": 21373, "bug_id": 44199, "text": "Created attachment 21373\ncontribution patch", "id": 112732, "time": "2008-01-10T05:03:18Z", "creator": "skibaa@gmail.com", "creation_time": "2008-01-10T05:03:18Z", "tags": [], "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 44199, "text": "The code has moved on since this patch was provided. Applying it - or something like it - would require significant refactoring.", "id": 198161, "time": "2017-04-04T19:19:55Z", "creator": "markt@apache.org", "creation_time": "2017-04-04T19:19:55Z", "tags": [], "is_private": false}]
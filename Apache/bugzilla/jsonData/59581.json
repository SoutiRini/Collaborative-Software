[{"count": 0, "attachment_id": 33850, "bug_id": 59581, "text": "Created attachment 33850\nThe resulting spreadsheet as POI writes it\n\nThe following code runs through to completion normally\n\n        Workbook wb = new XSSFWorkbook();\n        Sheet sh = wb.createSheet(\"Sheet1\");\n\t\t\n        Row row = sh.createRow(0);\n\trow.createCell(0).setCellValue(1.0);\n\trow.createCell(1).setCellValue(2.0);\n\trow = sh.createRow(1);\n\trow.createCell(0).setCellValue(1.0);\n\trow.createCell(1).setCellValue(2.0);\n\trow = sh.createRow(2);\n\trow.createCell(0).setCellFormula(\"SUM(A1,B1)\");\n\trow.createCell(1).setCellFormula(\"SUM(A1,B1)\");\n\trow = sh.createRow(3);\n\trow.createCell(0).setCellFormula(\"SUM(A3,B3)\");\n\trow.createCell(1).setCellFormula(\"SUM(A3,B3)\");\n\t\t\n\tsh.shiftRows(3, 3, -2);\n\n\tFileOutputStream fileOut = new FileOutputStream(\n\t\t\t\"Shift_Row_Test.xlsx\");\n\twb.write(fileOut);\n\twb.close();\n\tfileOut.close();\n\nThe XML output produced appears correct. Unfortunately when I try to open the resulting file in Excel, it produces an error:\n\nExcel found unreadable content in 'Shift_Row_Test.xlsx'. Do you want to recover the contents of this workbook? If you trust the source of this workbook, click Yes.\n\nAllowing recovery removes only the row that was shifted. The resulting spreadsheet contains Rows at indexes 0 and 2. Strangely enough, if I manually add back the data that was removed, Excel reads the spreadsheet correctly! I believe that the problem is that POI writes the rows out of order after the shift (1, 3, 2).\n\nThe attachments are:\nShift_Row_Test.xlsx  - The way POI wrote it. \nShift_Row_Test_fix.xlsx - As Excel recovered it.\nShift_Row_Test_fix_mod.xlsx - As I modified the fix file to add back row 2.\n\nThe only one Excel won't read is Shift_Row_Test.xlsx. I played around with the files based on the idea that Excel is puking on the rows being out of order, and I can make Shift_Row_Test.xlsx work if I put the rows back in order but make no other changes. I can make Shift_Ros_Test_fix_mod.xlsx fail to read in Excel if I put the rows in the order that POI writes them after the shift.", "id": 191082, "time": "2016-05-19T15:29:09Z", "creator": "jmarkmurph@yahoo.com", "creation_time": "2016-05-19T15:29:09Z", "tags": [], "is_private": false}, {"attachment_id": 33851, "tags": [], "bug_id": 59581, "text": "Created attachment 33851\nThe spreadsheet as Excel recovered it.", "count": 1, "id": 191083, "time": "2016-05-19T15:30:09Z", "creator": "jmarkmurph@yahoo.com", "creation_time": "2016-05-19T15:30:09Z", "is_private": false}, {"attachment_id": 33852, "tags": [], "bug_id": 59581, "is_private": false, "count": 2, "id": 191084, "time": "2016-05-19T15:31:33Z", "creator": "jmarkmurph@yahoo.com", "creation_time": "2016-05-19T15:31:33Z", "text": "Created attachment 33852\nThe recovered spreadsheet with XML modified manually by me"}, {"count": 3, "tags": [], "text": "\n\n*** This bug has been marked as a duplicate of bug 57423 ***", "is_private": false, "id": 191119, "creator": "jmarkmurph@yahoo.com", "time": "2016-05-19T19:40:02Z", "bug_id": 59581, "creation_time": "2016-05-19T19:40:02Z", "attachment_id": null}]
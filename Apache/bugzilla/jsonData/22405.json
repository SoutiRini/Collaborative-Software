[{"count": 0, "tags": [], "creator": "hauser@acm.org", "attachment_id": null, "id": 42717, "time": "2003-08-14T07:28:19Z", "bug_id": 22405, "creation_time": "2003-08-14T07:28:19Z", "is_private": false, "text": "The user managing web applications under tomcat is often root.\nTypically root has \"umask 755\" and this makes sense for many tasks that have to\nbe accomplished as root.\n\nHowever web applications often contain passwords to access for example a database.\nTherefore, I suggest:\n1) make sure that the permissions generated by attributes autoDeploy and\nunpackWARs are 700\n2) add a \"permissions\" attribute that allows to \n   i) use the default umask if it is set to \"umask\"\n   ii) set any other octal umask value for this"}, {"count": 1, "attachment_id": null, "bug_id": 22405, "is_private": false, "id": 42725, "time": "2003-08-14T09:47:46Z", "creator": "puckman@taglab.com", "creation_time": "2003-08-14T09:47:46Z", "tags": [], "text": "\n\nCan't say that I agree. I would never dream of running my tomcat processes as root neither would I \nbe logged in and manage them as root (tip: sudo). And I would assume the files created by tomcat \nare using the umask of the tomcat process, didn't even think you could set them from inside Java, \nbut then I might not be up to date with the latezt cool API additions."}, {"count": 2, "tags": [], "creator": "hauser@acm.org", "attachment_id": null, "text": "Ok, I might have misunderstood somebody such that I thought that tomcat only\nruns under root which it obviously does not (I tested it now; and yes, even\nbefore this post, I did use sudo).\n\nIn order to avoid novices like myself falling into these traps, I suggest the\nfollowing 3 enhancements:\n1) warn if tomcat sees itself running as \"root\" and print a tutorial URL into\n   catalina.out\n2) warn if tomcat sees its umask as being other than ***7 (i.e. if its output\n   is world-readable) and print the same tutorial URL\n3) create the tutorial page how to deploy securely (I am happy to be the first\n   tester/contributor there!)\n\nRe: how to set owners/permissions from inside Java\n  --> a quick google search yielded the following (untested) results\nhttp://www.aoindustries.com/docs/aocode-public/com/aoindustries/io/unix/UnixFile.html\nhttp://www.xenonsoft.demon.co.uk/products/javaunix/docs/api/javaunix/io/UnixFile.html\n\nFormer \"Summary: deploy as 700 and additional attribute to be less restrictive\"\n\nFurther safeguard ideas to achieve secure deployment out of the Java-oriented\nworld (tomcat/ant) are described in\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=22370 and\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=22417 .", "id": 42737, "time": "2003-08-14T14:12:27Z", "bug_id": 22405, "creation_time": "2003-08-14T14:12:27Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jkf@apache.org", "attachment_id": null, "id": 42740, "time": "2003-08-14T14:50:25Z", "bug_id": 22405, "creation_time": "2003-08-14T14:50:25Z", "is_private": false, "text": "Both of these libraries work via native methods to achieve this. Ant has does\nnot use native methods."}, {"count": 4, "tags": [], "bug_id": 22405, "is_private": false, "text": "The Tomcat 7 docs include a section on security considerations. I have expanded the OS section for 7.0.7 to cover file permissions, umask etc.\n\nI am still thinking about if/how to implement the user, umask etc. checks.", "id": 143453, "time": "2011-01-18T20:07:00Z", "creator": "markt@apache.org", "creation_time": "2011-01-18T20:07:00Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 22405, "attachment_id": 26519, "text": "Created attachment 26519\nProposed patch for Tomcat 7\n\nThis patch adds a new listener that checks the user Tomcat is running as and the umask being used.", "id": 143479, "time": "2011-01-19T13:45:40Z", "creator": "markt@apache.org", "creation_time": "2011-01-19T13:45:40Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 22405, "is_private": false, "id": 144513, "time": "2011-02-23T14:26:21Z", "creator": "markt@apache.org", "creation_time": "2011-02-23T14:26:21Z", "tags": [], "text": "I have added the listener to 7.0.x and it will be included in 7.0.9 onwards.\n\nIt has not been enabled by default as it may break current configurations such as IDE environments. It will be enabled by default in Tomcat 8."}]
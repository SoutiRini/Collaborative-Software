[{"count": 0, "tags": [], "text": "The rewrite engine seems to work okay until the RewriteLogLevel is set to \nsomething other than 0.  If RewriteLogLevel is set to anything from 1 to 9, the \nserver stops responding to requests.  Other circumstances that may be relevant \nare: 1) a dozen or so rewrite rules using regular expression matching are \nconfigured, 2) the rewrite engine was enabled within a virtual host, and 3) the \nrewrite log files get created but remain 0 size (so it is unlikely related to \nFS permissions).  Netscape and IE were both tested on a 100Mb LAN connection.  \nOnce RewriteLogLevel was set back to 0, the responses from the same virtual \nhost went back to instantaneous in the same environment.  BTW, the Linux \ndistribution is RedHat 7.1.", "attachment_id": null, "bug_id": 8143, "id": 13715, "time": "2002-04-16T04:10:28Z", "creator": "rthomas-contrib@liveintellect.org", "creation_time": "2002-04-16T04:10:28Z", "is_private": false}, {"count": 1, "tags": [], "text": "Reproduced here too.  We do get the \"init rewrite engine with requested uri\"\nmessage, but no more.  I tried adding an extra call to rewritelog on the next\nline, but it never got executed (or at least the output never appears in the log).\n\nRedHat 7.1, uname -mrsp: Linux 2.4.2-2 i686 unknown\n\nIncidentally, I haven't been able to repoduce this on Solaris 8.", "is_private": false, "id": 14052, "creation_time": "2002-04-19T14:06:28Z", "time": "2002-04-19T14:06:28Z", "creator": "JTait@wyrddreams.demon.co.uk", "bug_id": 8143, "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "jwoolley@apache.org", "text": "I wonder if this is specific to RH71?  The httpd-test suite uses \nRewriteLogLevel 9 for the mod_rewrite tests, and the test suite has never given \nme (or any of the other developers that I know of) trouble on the mod_rewrite \ntests.  I personally use slackware-current (Linux 2.4.18) and have no trouble...\n\nThe best would be if you could provide us a backtrace of one of the hung \nprocesses.  Attach to the process with gdb and interrupt it with Ctrl-C, then \ntype \"bt\" at the (gdb) prompt and attach the output to this PR.  See \nhttp://httpd.apache.org/dev/debugging.html for more tips on getting a backtrace.\n\nThanks for using Apache!", "id": 14131, "time": "2002-04-20T05:57:36Z", "bug_id": 8143, "creation_time": "2002-04-20T05:57:36Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "creator": "jerdent@yahoo.com", "text": "Can't run my 1.3.19 mod_rewrite config (Debian Potatoe) on apache 2.035 on\nWindows XP (my dev machine): this does generate a 400 status, without reporting\nanything in the error log. Have not test on linux yet.\n\nHere are my conds (ruling on  with apache 1.3.19)\n<VirtualHost *>\n\tDocumentRoot E:/home/pagesweb/odontop7\n\tServerName localhost\n\n\tErrorDocument 404 /erreur.php\n\tErrorDocument 500 /erreur.php\n\n\tRewriteEngine\ton\n\tRewriteRule\t\t^/$\t\t/index.php?url_section=ufr&url_rubrique=1\t[L]\n\tRewriteRule\t\t^/ufr/?$\t\t/index.php?url_section=ufr&url_rubrique=1\t[L]\n\tRewriteRule\t\t^/centredesoins/?$\t\t/index.php?url_section=centredesoins&url_rubrique=2\n[L]\n\tRewriteRule\t\t^/(ufr|centredesoins)/([0-9]+)/?$\t\t/index.php?url_section=$1&url_rubrique=$2\n[L]\n</VirtualHost>", "id": 14135, "time": "2002-04-20T12:17:18Z", "bug_id": 8143, "creation_time": "2002-04-20T12:17:18Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "text": "Seeing same behavior....\nRedhat 7.1 \n\n# gdb ./httpd\nGNU gdb Red Hat Linux (5.1-0.71)\nCopyright 2001 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-redhat-linux\"...\n(gdb) run -X\nStarting program: /usr/local/apache2/bin/./httpd -X\n[New Thread 1024 (LWP 17814)]\n\nProgram received signal SIGINT, Interrupt.\n[Switching to Thread 1024 (LWP 17814)]\n0x4019aba5 in __sigsuspend (set=0xbfffbf70)\n    at ../sysdeps/unix/sysv/linux/sigsuspend.c:45\n45      ../sysdeps/unix/sysv/linux/sigsuspend.c: No such file or directory.\n        in ../sysdeps/unix/sysv/linux/sigsuspend.c\n(gdb) bt\n#0  0x4019aba5 in __sigsuspend (set=0xbfffbf70)\n    at ../sysdeps/unix/sysv/linux/sigsuspend.c:45\n#1  0x401601d9 in __pthread_wait_for_restart_signal (self=0x40168f80)\n    at pthread.c:969\n#2  0x40161f49 in __pthread_alt_lock (lock=0x80ed854, self=0x0) at restart.h:34\n#3  0x4015ed26 in __pthread_mutex_lock (mutex=0x80ed844) at mutex.c:120\n#4  0x4003e610 in apr_thread_mutex_lock (mutex=0x80ed840) at thread_mutex.c:148\n#5  0x4003cfe4 in apr_global_mutex_lock (mutex=0x80ed7b0) at global_mutex.c:130\n#6  0x402afb30 in rewritelog (r=0x8146e10, level=3,\n    text=0x402b2260 \"applying pattern '%s' to uri '%s'\") at mod_rewrite.c:3232\n#7  0x402ad8b3 in apply_rewrite_rule (r=0x8146e10, p=0x8103d50, perdir=0x0)\n    at mod_rewrite.c:1826\n#8  0x402ad56f in apply_rewrite_list (r=0x8146e10, rewriterules=0x8103d38,\n    perdir=0x0) at mod_rewrite.c:1666\n#9  0x402ac872 in hook_uri2file (r=0x8146e10) at mod_rewrite.c:1112\n#10 0x0809214c in ap_run_translate_name (r=0x8146e10) at request.c:107\n#11 0x08092b8d in ap_process_request_internal (r=0x8146e10) at request.c:167\n#12 0x0806d73e in ap_process_request (r=0x8146e10) at http_request.c:259\n#13 0x080693a1 in ap_process_http_connection (c=0x8140ab8) at http_core.c:291\n#14 0x08088094 in ap_run_process_connection (c=0x8140ab8) at connection.c:85\n#15 0x0808837f in ap_process_connection (c=0x8140ab8, csd=0x81409e8)\n    at connection.c:207\n#16 0x0807d28f in child_main (child_num_arg=0) at prefork.c:671\n#17 0x0807d351 in make_child (s=0x813c560, slot=0) at prefork.c:711\n#18 0x0807d45f in startup_children (number_to_start=5) at prefork.c:783\n#19 0x0807d835 in ap_mpm_run (_pconf=0x80b8020, plog=0x80f0100, s=0x813c560)\n    at prefork.c:998\n#20 0x08082ff8 in main (argc=2, argv=0xbffff004) at main.c:622\n#21 0x40188647 in __libc_start_main (main=0x80827cc <main>, argc=2,\n    ubp_av=0xbffff004, init=0x805ed3c <_init>, fini=0x809c240 <_fini>,\n    rtld_fini=0x4000dcd4 <_dl_fini>, stack_end=0xbfffeffc)\n    at ../sysdeps/generic/libc-start.c:129\n(gdb)\n\n\n\n", "is_private": false, "id": 15471, "creation_time": "2002-05-04T03:10:37Z", "time": "2002-05-04T03:10:37Z", "creator": "Frank_Vance@bmc.com", "bug_id": 8143, "attachment_id": null}, {"count": 5, "tags": [], "creator": "jwoolley@apache.org", "text": "Hmmm interesting.  What do you have RewriteLock set to?  What does httpd -V say? ", "id": 15472, "time": "2002-05-04T03:31:51Z", "bug_id": 8143, "creation_time": "2002-05-04T03:31:51Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 8143, "attachment_id": null, "id": 15473, "time": "2002-05-04T04:06:57Z", "creator": "Frank_Vance@bmc.com", "creation_time": "2002-05-04T04:06:57Z", "is_private": false, "text": "RewriteLock is not set.  The docs suggest it is unnecessary, since I am not\nusing a rewriting-map program.\n\nHere are the Rewrite directives I currently use:\nRewriteEngine On\nRewriteLog   logs/rewrite.log\nRewriteLogLevel 0\nRewriteMap   lower              int:tolower\nRewriteMap   goto               txt:/usr/local/apache2/conf/GOTO.conf\nRewriteRule  ^/go/+(.*)$      ${goto:${lower:$1}|GoToMatch.html} [R=permanent,L,NC]\n\n# ./httpd -V\nServer version: Apache/2.0.35\nServer built:   May  2 2002 11:30:37\nServer's Module Magic Number: 20020329:0\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/prefork\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/usr/local/apache2\"\n -D SUEXEC_BIN=\"/usr/local/apache2/bin/suexec\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\n"}, {"count": 7, "tags": [], "text": "AHA... I finally managed to reproduce this problem.  The only difference is \nthat I'm running with mod_rewrite built statically this time and I usually run \nit as a DSO.  As a DSO, it works, static, no go.  Does that match with what you \nguys are seeing?", "is_private": false, "id": 15521, "creation_time": "2002-05-06T01:29:53Z", "time": "2002-05-06T01:29:53Z", "creator": "jwoolley@apache.org", "bug_id": 8143, "attachment_id": null}, {"count": 8, "tags": [], "creator": "Frank_Vance@bmc.com", "attachment_id": null, "text": "I started out static, but rebuilt dynamic.  I have the problem both ways.... ", "id": 15522, "time": "2002-05-06T01:52:56Z", "bug_id": 8143, "creation_time": "2002-05-06T01:52:56Z", "is_private": false}, {"count": 9, "tags": [], "creator": "aaron@apache.org", "text": "Could someone who is having the problem please run this\n`grep SERIALIZE srclib/apr/include/apr.h` and attach the output\nhere?", "id": 15523, "time": "2002-05-06T02:27:27Z", "bug_id": 8143, "creation_time": "2002-05-06T02:27:27Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "Frank_Vance@bmc.com", "attachment_id": null, "text": "$ grep SERIALIZE srclib/apr/include/apr.h\n#define APR_USE_FLOCK_SERIALIZE           0\n#define APR_USE_SYSVSEM_SERIALIZE         1\n#define APR_USE_POSIXSEM_SERIALIZE        0\n#define APR_USE_FCNTL_SERIALIZE           0\n#define APR_USE_PROC_PTHREAD_SERIALIZE    0\n#define APR_USE_PTHREAD_SERIALIZE         1\n#define APR_HAS_FLOCK_SERIALIZE           1\n#define APR_HAS_SYSVSEM_SERIALIZE         1\n#define APR_HAS_POSIXSEM_SERIALIZE        0\n#define APR_HAS_FCNTL_SERIALIZE           1\n#define APR_HAS_PROC_PTHREAD_SERIALIZE    0\n#define APR_HAS_RWLOCK_SERIALIZE          1\n\n", "id": 15524, "time": "2002-05-06T02:30:03Z", "bug_id": 8143, "creation_time": "2002-05-06T02:30:03Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 8143, "is_private": false, "id": 15525, "creation_time": "2002-05-06T02:32:45Z", "time": "2002-05-06T02:32:45Z", "creator": "jwoolley@apache.org", "text": "[same as the last one reported on my end]\n\n#define APR_USE_FLOCK_SERIALIZE           0 \n#define APR_USE_SYSVSEM_SERIALIZE         1\n#define APR_USE_POSIXSEM_SERIALIZE        0\n#define APR_USE_FCNTL_SERIALIZE           0\n#define APR_USE_PROC_PTHREAD_SERIALIZE    0 \n#define APR_USE_PTHREAD_SERIALIZE         1 \n#define APR_HAS_FLOCK_SERIALIZE           1\n#define APR_HAS_SYSVSEM_SERIALIZE         1\n#define APR_HAS_POSIXSEM_SERIALIZE        0\n#define APR_HAS_FCNTL_SERIALIZE           1\n#define APR_HAS_PROC_PTHREAD_SERIALIZE    0\n#define APR_HAS_RWLOCK_SERIALIZE          1\n", "attachment_id": null}, {"count": 12, "tags": [], "creator": "rthomas-contrib@liveintellect.org", "attachment_id": null, "id": 15526, "time": "2002-05-06T02:58:35Z", "bug_id": 8143, "creation_time": "2002-05-06T02:58:35Z", "is_private": false, "text": "grep SERIALIZE srclib/apr/include/apr.h\n#define APR_USE_FLOCK_SERIALIZE           0\n#define APR_USE_SYSVSEM_SERIALIZE         1\n#define APR_USE_POSIXSEM_SERIALIZE        0\n#define APR_USE_FCNTL_SERIALIZE           0\n#define APR_USE_PROC_PTHREAD_SERIALIZE    0\n#define APR_USE_PTHREAD_SERIALIZE         1\n#define APR_HAS_FLOCK_SERIALIZE           1\n#define APR_HAS_SYSVSEM_SERIALIZE         1\n#define APR_HAS_POSIXSEM_SERIALIZE        0\n#define APR_HAS_FCNTL_SERIALIZE           1\n#define APR_HAS_PROC_PTHREAD_SERIALIZE    0\n#define APR_HAS_RWLOCK_SERIALIZE          1\n"}, {"count": 13, "tags": [], "creator": "aaron@apache.org", "attachment_id": null, "text": "OK, next questions: does this happen when the server is run as non-root?\nDoes semop() fail in an strace (with EACCES)? What is the minimum\nconfiguration I should need to reproduce this bug (I'm lazy today,\nit's Sunday.)?", "id": 15527, "time": "2002-05-06T03:37:34Z", "bug_id": 8143, "creation_time": "2002-05-06T03:37:34Z", "is_private": false}, {"count": 14, "tags": [], "creator": "jwoolley@apache.org", "text": "Bingo!\n\nbrk(0x824c000)                          = 0x824c000\ngettimeofday({1020656912, 937141}, NULL) = 0\nsemop(8781875, 0x40042960, 1)           = -1 EACCES (Permission denied)\nwrite(21, \"127.0.0.1 - - [05/May/2002:23:48\"..., 265) = 265\nsemop(8781875, 0x40042966, 1)           = -1 EACCES (Permission denied)\ngettimeofday({1020656912, 937444}, NULL) = 0\nrt_sigprocmask(SIG_SETMASK, NULL, [RT_0], 8) = 0\nrt_sigsuspend([] <unfinished ...>", "id": 15528, "time": "2002-05-06T03:51:11Z", "bug_id": 8143, "creation_time": "2002-05-06T03:51:11Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "text": "Oh, and as if you couldn't have guessed, from ipcs, the corresponding semaphore:\n\n0x00000000 8781875    root      600        1         \n\nThe minimum config seems to be: run Apache as root with User set to some guy \n(jcw5q in my case ;), you *might* need to be in -X mode, and have RewriteLog \nset up and RewriteEngine on and RewriteLogLevel set > 0 with at least one \nRewriteRule, I imagine.  httpd-test's config is sufficient.", "is_private": false, "id": 15531, "creation_time": "2002-05-06T03:57:52Z", "time": "2002-05-06T03:57:52Z", "creator": "jwoolley@apache.org", "bug_id": 8143, "attachment_id": null}, {"count": 16, "tags": [], "creator": "aaron@apache.org", "attachment_id": null, "id": 15532, "time": "2002-05-06T04:08:09Z", "bug_id": 8143, "creation_time": "2002-05-06T04:08:09Z", "is_private": false, "text": "I'm going to leave this as new for now. A fix has already been pointed out\n(while investigating another bug) and we will mark this as fixed once it\nhas been committed. For those of you who need a workaround now, here is a\ncompletely untested and unofficial patch that should disable the use of\nSysV Semaphores. Apply it like this:\n\n cd srclib/apr ; patch -p0 < thispatch.foo ; cd ../../ ; ./buildconf\n\nIndex: configure.in\n===================================================================\nRCS file: /home/cvs/apr/configure.in,v\nretrieving revision 1.425\ndiff -u -u -r1.425 configure.in\n--- configure.in\t4 Apr 2002 21:35:43 -0000\t1.425\n+++ configure.in\t6 May 2002 04:00:46 -0000\n@@ -1374,8 +1374,6 @@\n             APR_DECIDE(USE_FLOCK_SERIALIZE, [4.2BSD-style flock()]))\n APR_IFALLYES(header:fcntl.h define:F_SETLK,\n             APR_DECIDE(USE_FCNTL_SERIALIZE, [SVR4-style fcntl()]))\n-APR_IFALLYES(func:semget func:semctl define:SEM_UNDO,\n-            APR_DECIDE(USE_SYSVSEM_SERIALIZE, [SysV IPC semget()]))\n APR_IFALLYES(header:semaphore.h func:sem_open func_sem_close dnl\n              func_sem_unlink func:sem_post func_sem_wait,\n              APR_DECIDE(USE_POSIXSEM_SERIALIZE, [Posix sem_open()]))\n@@ -1401,9 +1399,6 @@\n         ;;\n     USE_FCNTL_SERIALIZE )\n         fcntlser=\"1\"\n-        ;;\n-    USE_SYSVSEM_SERIALIZE )\n-        sysvser=\"1\"\n         ;;\n     USE_POSIXSEM_SERIALIZE )\n         posixser=\"1\"\n"}, {"count": 17, "tags": [], "creator": "jwoolley@apache.org", "attachment_id": null, "text": "Note: see also PR8124, which is the same problem except in mod_ssl and not mod_rewrite. ", "id": 15554, "time": "2002-05-06T16:56:02Z", "bug_id": 8143, "creation_time": "2002-05-06T16:56:02Z", "is_private": false}, {"count": 18, "attachment_id": null, "creator": "aaron@apache.org", "text": "This has now been fixed in CVS, but unfortunately won't be part of 2.0.36.", "id": 15560, "time": "2002-05-06T18:25:02Z", "bug_id": 8143, "creation_time": "2002-05-06T18:25:02Z", "tags": [], "is_private": false}]
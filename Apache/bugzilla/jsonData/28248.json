[{"count": 0, "tags": [], "bug_id": 28248, "is_private": false, "text": "When fmt:formatDate tag is used in jsp-page content-language header is added.\nThis is ok, but when formatDate tag is called multiple times, multiple\ncontent-language headers are added. This causes that some browsers (including\nIE) will not display the page.\n\nThe problem seems to be in SetLocaleSupport.getFormattingLocale which for some\nreason calls setResponseLocale method and this sets content-language header.\n\nThis is tested with 1.0.3 and 1.0.5 versions.", "id": 55435, "time": "2004-04-07T07:39:10Z", "creator": "antti.suanto@luukku.com", "creation_time": "2004-04-07T07:39:10Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 28248, "attachment_id": null, "is_private": false, "id": 55486, "time": "2004-04-07T18:46:19Z", "creator": "martinc@apache.org", "creation_time": "2004-04-07T18:46:19Z", "text": "You filed this bug against the i18n taglib, but that taglib does not have 1.0.3 \nand 1.0.5 versions. Did you mean the Standard taglib (i.e. JSTL)?"}, {"count": 2, "tags": [], "bug_id": 28248, "attachment_id": null, "is_private": false, "id": 55491, "time": "2004-04-07T18:50:01Z", "creator": "martinc@apache.org", "creation_time": "2004-04-07T18:50:01Z", "text": "*** Bug 28258 has been marked as a duplicate of this bug. ***"}, {"count": 3, "tags": [], "bug_id": 28248, "attachment_id": null, "text": "Yes, sorry I selected wrong component. I meant standard taglib.", "id": 55506, "time": "2004-04-08T05:42:31Z", "creator": "antti.suanto@luukku.com", "creation_time": "2004-04-08T05:42:31Z", "is_private": false}, {"count": 4, "tags": [], "creator": "antti.suanto@luukku.com", "is_private": false, "text": "I tested the tag with tomcat and no problems. So the problem seems to be in OC4J\n(10g).", "id": 55507, "time": "2004-04-08T07:23:49Z", "bug_id": 28248, "creation_time": "2004-04-08T07:23:49Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 28248, "attachment_id": null, "text": "CC'ing the taglibs-dev address to all Standard bugs. ", "id": 57257, "time": "2004-05-12T00:27:07Z", "creator": "nagoya@felipeal.net", "creation_time": "2004-05-12T00:27:07Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 28248, "attachment_id": null, "is_private": false, "id": 59136, "time": "2004-06-11T21:48:52Z", "creator": "justyna.horwat@sun.com", "creation_time": "2004-06-11T21:48:52Z", "text": "I tried to reproduce the problem with JSTL 1.0.5 and Tomcat 4.1.30 but was unsuccessful.\n\nIf it is a problem with the OC4J container, please bring this to Oracle's attention so they can fix the bug \nin their container."}, {"count": 7, "tags": [], "bug_id": 28248, "text": "I'm facing the same problem on OC4J 10G (9.0.4.0.1).\nWhat happens is that response.setLocale(locale); is called as many times as \nformatDate (or formatNumber) is in the JSP, thus it provokes a header overflow \n(I analysed the traffic with Ethereal and you see as much a 20 Content-Language \nheaders in the response).\nIt works on Tomcat 4.1.30, but it is not a prove that it works  because may be \nTomcat ignores all the response.setLocale but the first what Oracle does not do.\nIn the spec it it said that :\n\"Sets the locale of the response, setting the headers (including the Content-\nType's charset) as appropriate. This method should be called before a call to \ngetWriter(). By default, the response locale is the default locale for the \nserver.\" Nothing more.\n", "id": 80535, "time": "2005-09-28T09:53:02Z", "creator": "EXTERNAL.Z19PMOUA@decathlon.com", "creation_time": "2005-09-28T09:53:02Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 28248, "text": "I checked Tomcat code of setHeader and it overwrites the header if it already \nexists but the call to setHeader(\"Content-Language\", <value>) occurs 20 times: \n    public void setHeader(String name, String value) {\n\n        if (isCommitted())\n            return;\n\n        if (included)\n            return;     // Ignore any call from an included servlet\n\n// This code overwrites\n        ArrayList values = new ArrayList();\n        values.add(value);\n        synchronized (headers) {\n            headers.put(name, values);\n        }\n// End of the code overwrites\n\n        String match = name.toLowerCase();\n        if (match.equals(\"content-length\")) {\n            int contentLength = -1;\n            try {\n                contentLength = Integer.parseInt(value);\n            } catch (NumberFormatException e) {\n                ;\n            }\n            if (contentLength >= 0)\n                setContentLength(contentLength);\n        } else if (match.equals(\"content-type\")) {\n            setContentType(value);\n        }\n\n    }", "id": 80541, "time": "2005-09-28T10:34:47Z", "creator": "EXTERNAL.Z19PMOUA@decathlon.com", "creation_time": "2005-09-28T10:34:47Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 28248, "is_private": false, "text": "To be fully precise about the problem, I decompiled the OC4J implementation and \nthe method setLocale() calls  addHeader(\"Content-Language\", language);\nnot setHeader which explains the problem :\n\n            public void setLocale(java.util.Locale locale)\n            {\n/*1805*/        if(locale == null || isIncluded)\n/*1805*/            return;\n/*1807*/        if(isCommitted() && locale != this.locale)\n/*1808*/            throw new IllegalStateException(\"Response is already \ncommitted!\");\n/*1811*/        this.locale = locale;\n/*1814*/        java.lang.String _charset = (java.lang.String)LOCALE_MAP.get\n(locale.toString());\n/*1815*/        if(_charset == null)\n/*1816*/            _charset = (java.lang.String)LOCALE_MAP.get\n(locale.getLanguage());\n/*1819*/        if(outputFetchStatus == 2 && charset != null && !\n_charset.equalsIgnoreCase(charset))\n/*1823*/            throw new IllegalStateException(\"Output writer already \nacquired\");\n/*1827*/        if(contentType != null && (charset == null || !\ncharset.equalsIgnoreCase(_charset)))\n                {\n/*1831*/            contentType = \ncom.evermind.server.http.EvermindHttpServletResponse.constructContentType\n(contentType, _charset);\n/*1832*/            contentTypeHeader = null;\n                }\n/*1836*/        charset = _charset;\n/*1837*/        isCharsetSet = true;\n/*1840*/        java.lang.String language = locale.getLanguage();\n/*1841*/        if(language != null && language.length() > 0)\n                {\n/*1843*/            java.lang.String country = locale.getCountry();\n/*1844*/            if(country != null && country.length() > 0)\n/*1845*/                addHeader(\"Content-Language\", language + \"-\" + country);\n/*1847*/            else\n/*1847*/                addHeader(\"Content-Language\", language);\n                }\n            }", "id": 80543, "time": "2005-09-28T11:39:12Z", "creator": "EXTERNAL.Z19PMOUA@decathlon.com", "creation_time": "2005-09-28T11:39:12Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 28248, "attachment_id": null, "is_private": false, "id": 80561, "time": "2005-09-28T18:54:49Z", "creator": "martinc@apache.org", "creation_time": "2005-09-28T18:54:49Z", "text": "This is an OC4J issue."}]
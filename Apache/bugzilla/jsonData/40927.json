[{"count": 0, "tags": [], "creator": "aboyko@ca.ibm.com", "attachment_id": null, "id": 95582, "time": "2006-11-08T11:41:03Z", "bug_id": 40927, "creation_time": "2006-11-08T11:41:03Z", "is_private": false, "text": "A GMF client application is capable of substituting fill and stop colors if they\nare white or black with user customized colors. Color substitution is done\nmanually by iterating through document node elements. Before the color switching\nis done the original SVGOMDocument is cloned using\nDOMUtilities.deepCloneDocument() method as following:\n\nDOMImplementation impl;\nimpl = SVGDOMImplementation.getDOMImplementation();\ndocument = DOMUtilities.deepCloneDocument(document, impl);\n\nThe end document is one used by GVTBuilder.build() which throws the following\nBridgeException with the code = \"uri.malformed\". Therefore, the image is not\nrendered. This is without color switching - the cloned document is untouched.\nFull stack trace is listed at the bottom.\n\nIf the document is not cloned, no exceptions thrown and the image is rendered. \n\nThe exception occurs for image: \"SVG_gradient_noattr.svg\"\nbut doesn't occur for image: \"SVG_flat.svg\"\n(Both images will be attached)\n\nSince, I would expect cloned and the original documents to be handled in the\nsame way by GVTBuilder#build(BridgeContext, SVGOMDocument), perhaps there is a\nbug somewhere in DOMUtilities.deepCloneDocument()?\n\nWould be nice to know what's special about image \"SVG_gradient_noattr.svg\"\ncompared to \"SVG_flat.svg\"? Why the first one gives an exception and the second\ndoesn't?\n\nNote: http://issues.apache.org/bugzilla/show_bug.cgi?id=40862 might be related\nto this one.\n\n\nStack Trace:\n\norg.apache.batik.transcoder.TranscoderException: null\nEnclosed Exception:\nnull:-1\nThe URI \"#linearGradient7288\"\nspecified on the element <linearGradient> is invalid\n\n\tat\norg.eclipse.gmf.runtime.draw2d.ui.render.awt.internal.svg.ImageTranscoderEx.transcode(ImageTranscoderEx.java)\n\n\tat org.apache.batik.transcoder.XMLAbstractTranscoder.transcode(Unknown Source)\n\n\tat org.apache.batik.transcoder.SVGAbstractTranscoder.transcode(Unknown Source)\n\n\tat\norg.eclipse.gmf.runtime.draw2d.ui.render.awt.internal.svg.SVGImageConverter.setUpTranscoders(SVGImageConverter.java:148)\n\n\tat\norg.eclipse.gmf.runtime.draw2d.ui.render.awt.internal.svg.SVGImageConverter.renderSVGtoSWTImage(SVGImageConverter.java:74)\n\n\tat\norg.eclipse.gmf.runtime.draw2d.ui.render.awt.internal.svg.SVGImage.renderImage(SVGImage.java:68)\n\n\tat\norg.eclipse.gmf.runtime.draw2d.ui.render.internal.AbstractRenderedImage.getSWTImage(AbstractRenderedImage.java:130)\n\n\tat\norg.eclipse.gmf.runtime.draw2d.ui.render.internal.RenderHelper$1.run(RenderHelper.java:103)\n\n\tat java.lang.Thread.run(Thread.java:797)"}, {"count": 1, "tags": [], "creator": "aboyko@ca.ibm.com", "attachment_id": 19101, "id": 95583, "time": "2006-11-08T11:44:27Z", "bug_id": 40927, "creation_time": "2006-11-08T11:44:27Z", "is_private": false, "text": "Created attachment 19101\nSVG_flat.svg\n\nImage that does NOT give the exception"}, {"count": 2, "text": "Created attachment 19102\nSVG_gradient_noattr.svg\n\nImage that does give the exception", "bug_id": 40927, "attachment_id": 19102, "id": 95584, "time": "2006-11-08T11:45:07Z", "creator": "aboyko@ca.ibm.com", "creation_time": "2006-11-08T11:45:07Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 40927, "text": "Hi Alex,\n\n   I suspect that this bug is fixed.\n   The problem is that when we clone a document we do \nnot propogate the document URL (Document.getDocumentURI()),\nthere has been some discussion if this is correct or not,\npersonally I think it's ok.  The bug was that the linear\ngradients wouldn't properly resolve local refs if the\ndocument lacked a base URL.  This bug has been fixed\nin SVN.  \n\n   Can you check trunk and see if your problem goes\naway?", "id": 95685, "time": "2006-11-11T03:30:50Z", "creator": "deweese@apache.org", "creation_time": "2006-11-11T03:30:50Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 40927, "text": "Although, I couldn't verify this properly with the latest source code, I \nnoticed that the exception is not thrown any more \nfor \"SVG_gradient_noattr.svg\" image by the transcoder after cloning. Hence \nmarking the bug as invalid.", "id": 95794, "time": "2006-11-13T14:49:50Z", "creator": "aboyko@ca.ibm.com", "creation_time": "2006-11-13T14:49:50Z", "is_private": false, "attachment_id": null}]
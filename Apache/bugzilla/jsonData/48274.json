[{"count": 0, "tags": [], "bug_id": 48274, "attachment_id": 24605, "text": "Created attachment 24605\npatch for HSSFPalette.java and TestHSSFPalette.java\n\nHSSFPalette.findSimilarColor considers a color value of 0 to be closer than 255 it is to 127.  Thus, for example,\n\nHSSFWorkbook workbook = new HSSFWorkbook();\nHSSFPalette palette = workbook.getCustomPalette();\nHSSFColor color = palette.findSimilarColor(0,102,255);\nshort[] rgb = color.getTriplet();\nSystem.out.println(java.util.Arrays.toString(rgb));\n\nprints \"[255,102,0]\".  The input color is not unlike turquoise, but the output color is a light red!\n\nThe reason findSimilarColor behaves this way is because it implements the Manhattan distance in byte space.  byte is signed, and thus 255 is really -1, which is adjacent to 0.\n\nA patch is enclosed which first converts the bytes to positive integers so that 255 is maximally far from 0.  Then the above example returns [0,102,204] which is much closer to the original [0,102,255].  The patch also includes additional tests for TestHSSFPalette.", "id": 132277, "time": "2009-11-24T07:03:07Z", "creator": "jeremys.poibugs@hotmail.com", "creation_time": "2009-11-24T07:03:07Z", "is_private": false}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "is_private": false, "id": 132304, "time": "2009-11-25T03:46:03Z", "bug_id": 48274, "creation_time": "2009-11-25T03:46:03Z", "text": "Thanks for this, applied to trunk in r884061, with a few slight tweaks"}]
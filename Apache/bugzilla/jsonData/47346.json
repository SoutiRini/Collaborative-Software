[{"count": 0, "tags": [], "text": "context: caching reverse proxy with balancer setup (but only one worker yet)\n\nAll content delivered from the backend without Last-Modified header is only cached until the expiry-date is reached once although there is an future Expires header. No re-caching appears. CacheIgnoreNoLastMod does not affect this behaviour.\n\nAccording to the docs (and -as far as I understand- RFC2616) an Expires-Header alone should be sufficient. Moreover CacheIgnoreNoLastMod should make caching possible even when Last-Modified header is missing.\n\nSounds similiar to 27791, but forcing Last-Modified to be set on the backend makes the Problem disappear.\n\n\nHeaders from backend triggering the problem:\n---\n  HTTP/1.1 200 OK\n  Date: Wed, 10 Jun 2009 12:27:14 GMT\n  Server: Apache/2.2.3 (Debian) PHP/5.2.0-8+etch11 mod_ssl/2.2.3 OpenSSL/0.9.8c\n  X-Powered-By: PHP/5.2.0-8+etch11\n  Cache-Control: max-age=300\n  Expires: Wed, 10 Jun 2009 12:32:14 GMT\n  Connection: close\n  Content-Type: text/html;charset=utf-8\n---\n\nafter 300sec from the first access the proxy-cache keeps ignoring the cache:\n---\n  HTTP/1.1 200 OK\n  Date: Wed, 10 Jun 2009 12:31:06 GMT\n  Server: Apache/2.2.3 (Debian) PHP/5.2.0-8+etch11 mod_ssl/2.2.3 OpenSSL/0.9.8c\n  X-Powered-By: PHP/5.2.0-8+etch11\n  Cache-Control: max-age=300\n  Expires: Wed, 10 Jun 2009 12:36:06 GMT\n  Content-Type: text/html;charset=utf-8\n  Via: 1.0 www.taz.de\n  Connection: close\n---\n  \nwhen Last-Modified id forced on backend like:\n---\n  HTTP/1.1 200 OK\n  Date: Wed, 10 Jun 2009 12:34:33 GMT\n  Server: Apache/2.2.3 (Debian) PHP/5.2.0-8+etch11 mod_ssl/2.2.3 OpenSSL/0.9.8c\n  X-Powered-By: PHP/5.2.0-8+etch11\n  Last-Modified: Wed, 10 Jun 2009 12:34:33 GMT\n  Expires: Wed, 10 Jun 2009 12:39:33 GMT\n  Cache-Control: max-age=300\n  Connection: close\n  Content-Type: text/html;charset=utf-8\n\n... the proxy-cache behaves:\n---\n  HTTP/1.1 200 OK\n  Date: Wed, 10 Jun 2009 12:36:48 GMT\n  Server: Apache/2.2.3 (Debian)\n  Last-Modified: Wed, 10 Jun 2009 12:36:34 GMT\n  X-Powered-By: PHP/5.2.0-8+etch11\n  Cache-Control: max-age=300\n  Expires: Wed, 10 Jun 2009 12:41:34 GMT\n  Via: 1.1 www.taz.de\n  Age: 14\n  Content-Length: 89601\n  Keep-Alive: timeout=15, max=300\n  Connection: Keep-Alive\n  Content-Type: text/html;charset=utf-8\n---\n\nrelevant config\n\non proxy cache machine:\n---\nProxyPreserveHost On\nProxyPass / balancer://webcluster/\n<Proxy balancer://webcluster>\n  ...\n</Proxy>\nCacheEnable mem /\n---\n\non backend\n---\nExpiresActive On\nExpiresByType text/html \"access plus 5 minutes\"\n---\n\nThe following line in my PHP app cures the desease:\n---\nheader( \"Last-Modified: \". gmdate( \"D, d M Y H:i:s\", time() ) .\" GMT\");\n---\n\nregards, Filip Moritz", "attachment_id": null, "id": 127791, "creator": "fil@taz.de", "time": "2009-06-10T06:28:25Z", "bug_id": 47346, "creation_time": "2009-06-10T06:28:25Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 47346, "is_private": false, "text": "Please check if this also happens with the disk cache. The mem cache has a worse performance than the disk cache and various other drawbacks.", "id": 127802, "time": "2009-06-10T09:24:50Z", "creator": "rpluem@apache.org", "creation_time": "2009-06-10T09:24:50Z", "attachment_id": null}]
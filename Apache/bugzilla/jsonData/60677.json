[{"count": 0, "tags": [], "creator": "tallison@mitre.org", "attachment_id": 34707, "id": 196649, "time": "2017-02-01T21:11:01Z", "bug_id": 60677, "creation_time": "2017-02-01T21:11:01Z", "is_private": false, "text": "Created attachment 34707\nTriggering file\n\nDominik Stadler's recent regression tests identified an invalid substring range exception triggered by WMF's drawString.\n\nI extracted the triggering wmf from the file in Dominik's regression corpus, and I'm attaching it here."}, {"count": 1, "tags": [], "bug_id": 60677, "attachment_id": null, "is_private": false, "id": 196667, "time": "2017-02-02T14:42:34Z", "creator": "tallison@mitre.org", "creation_time": "2017-02-02T14:42:34Z", "text": "This was caused by my change to byte[] from String.\n\nFor multibyte encodings (e.g. Shift_JIS), things get interesting.\n\nThe byte length might not equal the string length().\n\nThe x information is stored in dx[], an array parallel to the\nbyte array text[].  dx[] stores x position in the\nfirst byte of a multibyte character, but 0 for the other bytes\nin that character.\n\nWe need to map this information to the String offsets\n          dx[0] = 13 text[0] = -125\n          dx[1] = 0  text[1] = 118\n          dx[2] = 14 text[2] = -125\n          dx[3] = 0  text[3] = -115\n          \n needs to be remapped as:\n          dxNormed[0] = 13 textString.get(0) = U+30D7\n          dxNormed[1] = 14 textString.get(1) = U+30ED\n\n\nI have a patch ready, and I'll apply it once 3.16-beta2 is released."}, {"count": 2, "tags": [], "creator": "tallison@mitre.org", "attachment_id": null, "id": 197184, "time": "2017-02-21T13:42:41Z", "bug_id": 60677, "creation_time": "2017-02-21T13:42:41Z", "is_private": false, "text": "Doh, forgot to close out this issue.  Committed in r1781593."}]
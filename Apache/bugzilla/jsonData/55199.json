[{"count": 0, "tags": [], "bug_id": 55199, "attachment_id": null, "is_private": false, "id": 168288, "time": "2013-07-05T09:25:32Z", "creator": "vdm-photo@ya.ru", "creation_time": "2013-07-05T09:25:32Z", "text": "APR failed to configure properly in following cross-compiler configuration:\nBuild system: Linux\nTarget platform: FreeBSD (8.0 and 9.0 in my case, but it doesn't matter).\n\nCurrent configure script uses /sbin/sysctl to get exact FreeBSD version using parameter kern.osreldate:\n\nif test -x /sbin/sysctl; then\n  os_version=`/sbin/sysctl -n kern.osreldate`\nelse\n  os_version=000000\nfi\n\nThis code, obviously, doesn't work while cross-compiling on Linux. Moreover, it works INCORRECTLY if build platform is FreeBSD - it'll detect BUILD system's version, not TARGET one.\n\nI fixed this using $host variable:\n\ncase $host in\n  *freebsd7*)\n    os_version=700000;;\n  *freebsd8*)\n    os_version=800000;;\n  *freebsd9*)\n   os_version=900000;;\n  *)\n  # old default behavior for systems we don't intrested in\n  if test -x /sbin/sysctl; then\n    os_version=`/sbin/sysctl -n kern.osreldate`\n  else\n    os_version=000000\n  fi;;\nesac\n\nI guess this is not very good and universal solution. But this is only way to detect target system version programmatically.  Another way is to pass OS_VERSION to configure script as a parameter.\n\nNote: the most annoying part of this bug is that this error is swallowed by configure:\n\nConfiguring APR library\nPlatform: x86_64-pc-freebsd8.0\nchecking for working mkdir -p... yes\nAPR Version: 1.4.8\nchecking for chosen layout... apr\nchecking for x86_64-pc-freebsd8.0-gcc... x86_64-pc-freebsd8.0-gcc\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables... \nchecking whether we are cross compiling... yes\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether x86_64-pc-freebsd8.0-gcc accepts -g... yes\nchecking for x86_64-pc-freebsd8.0-gcc option to accept ISO C89... none needed\nchecking for a sed that does not truncate output... /bin/sed\nApplying APR hints file rules for x86_64-pc-freebsd8.0\n  setting apr_lock_method to \"USE_FLOCK_SERIALIZE\"\n/proc/sys/kern/osreldate: No such file or directory\n/tmp/automate-temp.1372947938.24033/httpd-apr4-2.4.4/httpd-2.4.4/srclib/apr/configure: line 6651: test: -ge: unary operator expected\n  setting CPPFLAGS to \"-D_THREAD_SAFE -D_REENTRANT\"\n  setting enable_threads to \"no\"\n/tmp/automate-temp.1372947938.24033/httpd-apr4-2.4.4/httpd-2.4.4/srclib/apr/configure: line 6684: test: -lt: unary operator expected\n\n... and continuing. Configure process is not stopped, but it results in various errors during compiling."}]
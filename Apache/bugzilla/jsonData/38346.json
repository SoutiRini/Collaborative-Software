[{"count": 0, "tags": [], "text": "There are two bugs in\n\norg.apache.catalina.connector.InputBuffer:\n\n1) If you send a POST with 8K in the body then the optimizedWrite flag in\nCharChunk prevents the input data from being read into the CharChunk. This only\nhappens at and after the second request on an input processor, because the\noptimizedWrite flag ist being set to true when recycling the InputBuffer after\nthe first request.\n\n2) After fixing that, you can more easily see another bug: realReadChars always\nreads the full ByteChunk buffer size and then tries to convert it into the\nCharChunk. There is a corner case, where CharChunk has a limit just a little too\nsmall, to be able to do that. This is not about making CharChunk much bigger. I\ncan give more precise details, but the patch might be self-explaining (it is\nvery short).\n\nI attach\n\n- a patch\n- a JSP and a perl script to easily reproduce the problem. Problem 1) can be\nreprodiced by setting CHUNK in the script to 8192, problem 2 (after fixing 1) by\nsetting it slightly bigger than 8192, e.g. 8300.", "attachment_id": null, "bug_id": 38346, "id": 84852, "time": "2006-01-21T21:35:08Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-01-21T21:35:08Z", "is_private": false}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": 17478, "text": "Created attachment 17478\nPatch for InputBuffer fixing 1) and 2)", "id": 84853, "time": "2006-01-21T21:36:57Z", "bug_id": 38346, "creation_time": "2006-01-21T21:36:57Z", "is_private": false}, {"count": 2, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": 17479, "id": 84854, "time": "2006-01-21T21:37:38Z", "bug_id": 38346, "creation_time": "2006-01-21T21:37:38Z", "is_private": false, "text": "Created attachment 17479\nTest JSP\n\nTest JSP to be called by the next attachment"}, {"count": 3, "tags": [], "bug_id": 38346, "attachment_id": 17480, "id": 84855, "time": "2006-01-21T21:38:26Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-01-21T21:38:26Z", "is_private": false, "text": "Created attachment 17480\nTest Client perl script\n\nClient side script which posts data to the test JSP to reproduce both bugs."}, {"count": 4, "tags": [], "text": "By the way: the same problem (and the same fix) apply to the 5.0 branch.", "is_private": false, "bug_id": 38346, "id": 84856, "time": "2006-01-21T21:39:04Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-01-21T21:39:04Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "I was at our customers side today. The problem is always reproducible with the\najp connector. On his system, I can not reproduce with HTTP connector. But from\nthe code in InputBuffer it's clear, that the occurence of the bug only depends\non the amount of data received on the socket, when the buffer loads new data.\n\nI'm pretty confident, that the patch also fixes bugs 34829, 28959, 27447, and\n24897. I know, that CoyoteReader/InputBuffer/(Byte|Char)Chunk are difficult to\nunderstand and noone wants to touch them. But I instrumented the classes to\nexactly find out what's happening, and if Remy (or whoever is willing to dig\ninto it) likes more explanation of the patch please ask.\n\nAt the customer's installation his problem was fixed with the patch.", "attachment_id": null, "bug_id": 38346, "id": 84901, "time": "2006-01-23T15:48:06Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-01-23T15:48:06Z", "is_private": false}, {"count": 6, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "text": "(In reply to comment #5)\n> I was at our customers side today. The problem is always reproducible with \nthe\n> ajp connector. On his system, I can not reproduce with HTTP connector. But \nfrom\n> the code in InputBuffer it's clear, that the occurence of the bug only \ndepends\n> on the amount of data received on the socket, when the buffer loads new data.\n\nBy default, the HTTP connector only reads 4K at a time, so serendipitously \nthis bug doesn't show itself.\n\nThe patch has been committed to the SVN trunk, and will appear in 5.5.16.\n\n", "id": 84931, "time": "2006-01-24T05:22:25Z", "bug_id": 38346, "creation_time": "2006-01-24T05:22:25Z", "is_private": false}, {"count": 7, "tags": [], "text": "*** Bug 38836 has been marked as a duplicate of this bug. ***", "attachment_id": null, "bug_id": 38346, "id": 103995, "time": "2007-06-01T19:09:31Z", "creator": "markt@apache.org", "creation_time": "2007-06-01T19:09:31Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 38346, "is_private": false, "count": 8, "id": 150888, "time": "2011-10-25T06:49:15Z", "creator": "naani101@gmail.com", "creation_time": "2011-10-25T06:49:15Z", "text": "thi issue still occurs with tomcat 5.5.28. Could you please let me know, how to apply this patch to 5.5.28?"}, {"count": 9, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "This is very unlikely the same problem.\n\nBugzilla is not a support form.\nPlease post your problem description to the Tomcat users list.\n\nRegards,\n\nRainer", "id": 150889, "time": "2011-10-25T08:33:03Z", "bug_id": 38346, "creation_time": "2011-10-25T08:33:03Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "naani101@gmail.com", "text": "Thanks for your response Jung. We have an environment using HTTP connector. The issue does not occur, other environment using AJP connector.\n\nIn code we are using\nBufferedReader in = request.getReader();\n\nWhen a request is sent on AJP connector environment, the above code reads only 8192 length, not whole.\n\nBut if a request is sent on HTTP connector environment, the same method reads whole data. do you have any idea.. Please help.\n\nThe Tomcat version same in the both of the environments above.", "id": 150893, "time": "2011-10-25T09:02:16Z", "bug_id": 38346, "creation_time": "2011-10-25T09:02:16Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "text": "Please discuss this on the Tomcat users list, see http://tomcat.apache.org/lists.html\n\nThank you.", "is_private": false, "bug_id": 38346, "id": 150894, "time": "2011-10-25T09:07:46Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2011-10-25T09:07:46Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 8283, "attachment_id": null, "id": 14022, "creation_time": "2002-04-18T22:38:46Z", "time": "2002-04-18T22:38:46Z", "creator": "Ryan.Lubke@Sun.COM", "text": "Given:\n\n<sql:setDataSource dataSource=\"${jstlDS}\" var='driverInfoDS' />\n\nResult:\n\nroot cause\n> javax.servlet.jsp.JspTagException: In <driver>, invalid driver class name: \"\nURL=jdbc:sybase:Tds:ace:4100/tempdb?FAKE_METADATA=true\"\n>         at\norg.apache.taglibs.standard.tag.common.sql.DataSourceUtil.setUsingParams(DataSourceUtil.java:176)\n>         at\norg.apache.taglibs.standard.tag.common.sql.DataSourceUtil.setDataSource(DataSourceUtil.java:124)\n>         at\norg.apache.taglibs.standard.tag.common.sql.SetDataSourceTagSupport.doStartTag(SetDataSourceTagSupport.java:110)\n>         at\norg.apache.taglibs.standard.tag.el.sql.SetDataSourceTag.doStartTag(SetDataSourceTag.java:104)", "is_private": false}, {"count": 1, "tags": [], "bug_id": 8283, "attachment_id": null, "id": 14027, "time": "2002-04-18T23:05:28Z", "creator": "bayern@essentially.net", "creation_time": "2002-04-18T23:05:28Z", "is_private": false, "text": "Ryan, I'm not sure I understand the bug report.  The following works for me:\n\n<%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jstl/core\" %>\n<%@ taglib prefix=\"sql\" uri=\"http://java.sun.com/jstl/sql\" %>\n\n<%!\n  public static class Foo implements javax.sql.DataSource {\n    public java.sql.Connection getConnection() { return null; }\n    public java.sql.Connection getConnection(String a, String b) {\n       return null; }\n    public int getLoginTimeout() { return 0; }\n    public java.io.PrintWriter getLogWriter() { return null; }\n    public void setLoginTimeout(int a) { }\n    public void setLogWriter(java.io.PrintWriter a) { }\n  }\n%>\n<%\n  pageContext.setAttribute(\"myDataSource\", new Foo());\n%>\n\n<sql:setDataSource\n  var=\"new\" dataSource=\"${myDataSource}\" />\n\n---\n\nIs the problem that the driver within the String representation of a DataSource \nyou're passing isn't valid?  If so, that's an issue we're waiting on spec \nclarification for."}, {"count": 2, "tags": [], "bug_id": 8283, "attachment_id": null, "id": 14045, "time": "2002-04-19T11:23:03Z", "creator": "Ryan.Lubke@Sun.COM", "creation_time": "2002-04-19T11:23:03Z", "is_private": false, "text": "I beleive the problem could be related to the fact that our DataSource overrides\nthe toString() method.  The Error message reported shows the result of calling\nthat method.\n"}, {"count": 3, "tags": [], "bug_id": 8283, "attachment_id": 1631, "is_private": false, "id": 14048, "time": "2002-04-19T12:44:41Z", "creator": "Ryan.Lubke@Sun.COM", "creation_time": "2002-04-19T12:44:41Z", "text": "Created attachment 1631\nCorrects ClassCastExceptions in SetDataSourceTagSupport"}, {"count": 4, "tags": [], "bug_id": 8283, "attachment_id": null, "id": 14049, "time": "2002-04-19T12:45:07Z", "creator": "Ryan.Lubke@Sun.COM", "creation_time": "2002-04-19T12:45:07Z", "is_private": false, "text": "Actually, it appears Jan corrected this issue already.  The ExpressionManager\nwas configured to evaluate as a String instead of an Object.\n\nHowever, there is now an issue with ClassCastExceptions being raised.\n\nI've atteched a patch to this bug that corrects the issue."}, {"count": 5, "tags": [], "bug_id": 8283, "attachment_id": null, "id": 14064, "time": "2002-04-19T17:18:38Z", "creator": "jan.luehe@sun.com", "creation_time": "2002-04-19T17:18:38Z", "is_private": false, "text": "Fixed:\n  - Applied Ryan's patch (thanks, Ryan!)\n  - Also removed DataSourceUtil constructor, in which a\n    DataSourceWrapper was allocated. This was out-of-date, since the\n    wrapper now is allocated inside setUsingParams()."}]
[{"count": 0, "attachment_id": null, "bug_id": 11540, "text": "Actually I tried to figure out what results when a configured ProxyTimeout has \nexpired. My testcase was as follows:\n\n- a nVH with a working ProxyPass and ProxyPassReverse set\n- low ProxyTimeout (2) setting within the nVH\n- iptables rule to simply drop incoming proxied host's traffic\n\nThe connection hangs until Apache's main Timeout value (default setting) from \nUAs point of view and it doesn't matter if ProxyTimeout was set or not.\nAdditionally I tried to set ProxyTimeout in the main config with identical \nbehaviour (leaving ProxyPass(Reverse) in its place).\nI didn't try ProxyTimeout within a configuration for Apache as regular client \nproxy, so it might be entailed with ProxyPass(Reverse) merely.", "id": 20764, "time": "2002-08-07T21:21:59Z", "creator": "cv@corbach.de", "creation_time": "2002-08-07T21:21:59Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "cv@corbach.de", "text": "Same behaviour with 2.0.40", "id": 21334, "time": "2002-08-19T21:01:31Z", "bug_id": 11540, "creation_time": "2002-08-19T21:01:31Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "minfrin@sharp.fm", "attachment_id": null, "id": 35236, "time": "2003-04-15T16:26:58Z", "bug_id": 11540, "creation_time": "2003-04-15T16:26:58Z", "is_private": false, "text": "From investigating this, ProxyTimeout only applies after the connection is\nsuccessfully established, which won't happen if the packets are dropped. Will\ncheck further to see if this is correct behaviour or not.\n"}, {"count": 3, "tags": [], "creator": "davel@canuck.com", "attachment_id": null, "id": 56841, "time": "2004-05-04T22:12:17Z", "bug_id": 11540, "creation_time": "2004-05-04T22:12:17Z", "is_private": false, "text": "*** Bug 23122 has been marked as a duplicate of this bug. ***"}, {"count": 4, "attachment_id": null, "bug_id": 11540, "is_private": false, "id": 57879, "time": "2004-05-21T22:16:28Z", "creator": "minfrin@sharp.fm", "creation_time": "2004-05-21T22:16:28Z", "tags": [], "text": "Confirmed - the ProxyTimeout applies after a successful connection. To test\nthis, you need to convince your test connection to connect successfully, but\nthen not send any data. The proxy should wait the timeout length for a response,\nand give up if this time is reached.\n\nI'm closing this bug for now, if you have further problems, reopen it.\n"}, {"count": 5, "tags": [], "bug_id": 11540, "is_private": false, "text": "\nI'm facing this problem with IHS2.042.2 (Apache/2.0.46) on AIX.\n\nSimply put, I have an upstream application server that takes about 15mins to \ngenerate a large report. The reverse proxy returns a 502 error to the client \nafter the connection timeout period elapses (which is normal). I can overcome \nthe problem by increasing the Timeout directive, but believe it would be more \nappropriate to use the ProxyTimeout directive. This does not, however, produce \nthe desired effect.\n\nPerhaps the last comment \"ProxyTimeout applies after a successful connection\" \ncould be clarified in more detail?", "id": 63576, "time": "2004-09-15T13:21:30Z", "creator": "anthonypahitas@hotmail.com", "creation_time": "2004-09-15T13:21:30Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 11540, "attachment_id": null, "text": "My observation is ProxyTimeout (by 2.0.51) rather sets the Connect timeout, not\nthe read timeout.\nAnother bug regarding ProxyTimeout is, that neither Timeout nor ProxyTimeout\napply when an SSL proxy connection (\"CONNECT\") is established.\nThese connections never time out.", "id": 65184, "time": "2004-10-15T14:24:06Z", "creator": "georg.zezschwitz@vodafone.com", "creation_time": "2004-10-15T14:24:06Z", "is_private": false}, {"count": 7, "tags": [], "creator": "maxes@sw.ru", "attachment_id": null, "id": 67389, "time": "2004-11-23T14:18:41Z", "bug_id": 11540, "creation_time": "2004-11-23T14:18:41Z", "is_private": false, "text": "Timeout for socket in case of proxy request set in modules/proxy/mod_proxy.c    \nby function ap_proxy_connect_to_backend():\n\n        /* Set a timeout on the socket */\n        if (conf->timeout_set == 1) {\n            apr_socket_timeout_set(*newsock, conf->timeout);\n        }\n        else {\n             apr_socket_timeout_set(*newsock, s->timeout);\n        }\n\nGDB show, that conf->timeout_set is 0, and timeout get from global config\n(from \"Timeout\" directive).\n\nNote, that other *_set variable never used in mod_proxy* for check\nsomething.\n\nI don't know why conf->timeout_set is zero in ap_proxy_connect_to_backend().\n\nMay be need compared 2 functions from\nmodules/proxy/mod_proxy.c:\ncreate_proxy_config and merge_proxy_config\n\nCheck this:\nps->timeout= (overrides->timeout_set == 0) ? base->timeout : overrides->timeout;\nIf overrides->timeout_set equal 0, than ps->timeout setted, but may be we\nneed set too :\n   ps->timeout_set = 1; \n  /* because timeout set always, timeout_set is always setted */\n?\n\nBut probably we don't need use *_set variable anywhere in proxy_utils to\ncheck.\n\nnext patch work in my environment:\ndiff -u  modules/proxy/proxy_util.c.save  modules/proxy/proxy_util.c\n--- modules/proxy/proxy_util.c.save     Tue Nov 23 14:47:48 2004\n+++ modules/proxy/proxy_util.c  Tue Nov 23 14:48:46 2004\n@@ -1128,7 +1128,7 @@\n #endif\n \n         /* Set a timeout on the socket */\n-        if (conf->timeout_set == 1) {\n+        if (conf->timeout != 0) {\n             apr_socket_timeout_set(*newsock, conf->timeout);\n         }\n         else {\n\n"}, {"count": 8, "tags": [], "creator": "graham.collinson@googlemail.com", "text": "Created attachment 15511\n2.0.53: ensures <opt>_set properties are set correctly in merge_proxy_config\n\nProxyTimeout directive is ignored because the timeout_set property gets cleared\nin merge_proxy_config.\tAttached patch resolves this problem", "id": 76603, "time": "2005-06-22T15:16:56Z", "bug_id": 11540, "creation_time": "2005-06-22T15:16:56Z", "is_private": false, "attachment_id": 15511}, {"count": 9, "tags": [], "creator": "graham.collinson@googlemail.com", "attachment_id": 15512, "id": 76604, "time": "2005-06-22T15:24:00Z", "bug_id": 11540, "creation_time": "2005-06-22T15:24:00Z", "is_private": false, "text": "Created attachment 15512\n2.1.3-beta: ensures <opt>_set properties are set correctly in merge_proxy_config"}, {"count": 10, "tags": [], "bug_id": 11540, "attachment_id": null, "is_private": false, "id": 79303, "time": "2005-09-01T20:37:26Z", "creator": "stuart@terminus.co.uk", "creation_time": "2005-09-01T20:37:26Z", "text": "This bug just bit me too. The patch in attachment 15511 looks good to me,\napplies cleanly (once it's been dos2unix'd) to 2.0.54, and I can confirm fixes\nthe bug. I'd certainly like this to be applied.\n\nI would also suggest that the documentation is updated to clarify that this\ntimeout is for *establishing* the connection only (at least that's what the code\nand my tests show); and that the core Timeout directive will affect the timeout\nfor an established connection. I'm happy to knock up a patch with suitable text\n- just say the word."}, {"count": 11, "attachment_id": null, "bug_id": 11540, "is_private": false, "id": 82207, "time": "2005-11-08T13:15:02Z", "creator": "stuart@terminus.co.uk", "creation_time": "2005-11-08T13:15:02Z", "tags": [], "text": "So this bug is still in both 2.0.55 and the trunk. I am confirming that the\nalready supplied attachments are still good for the respective (2.0 and 2.1)\nHEADs in SVN. Could we please get these applied?"}, {"count": 12, "tags": [], "bug_id": 11540, "attachment_id": null, "id": 99366, "creation_time": "2007-02-14T04:15:51Z", "time": "2007-02-14T04:15:51Z", "creator": "stuart@terminus.co.uk", "text": "Bumping because this bug *still* exists in 2.0.58 and 2.2.4 and trunk. Will\nattach an updated patch against trunk. This should also apply against the HEAD\nof 2.2.x branch (bar lines numbers being slightly off, but given the context it\nshould apply).", "is_private": false}, {"count": 13, "tags": [], "creator": "stuart@terminus.co.uk", "attachment_id": 19589, "id": 99367, "time": "2007-02-14T04:17:10Z", "bug_id": 11540, "creation_time": "2007-02-14T04:17:10Z", "is_private": false, "text": "Created attachment 19589\npatch against current trunk"}, {"count": 14, "tags": [], "bug_id": 11540, "attachment_id": null, "id": 99368, "creation_time": "2007-02-14T05:01:35Z", "time": "2007-02-14T05:01:35Z", "creator": "nick@webthing.com", "text": "(In reply to comment #13)\n> Created an attachment (id=19589) [edit]\n> patch against current trunk\n> \n\nI've just applied that one to trunk (with your tabs/indentation fixed).\n\nStuart, from memory I think I've seen your name on quite a few bugs, and they\ntend to be of the kind that look valid but need some effort to check.  These may\ntend to pass under the radar here.  Maybe it would be more productive for you to\nparticipate in dev@httpd with such points.", "is_private": false}, {"count": 15, "tags": [], "creator": "stuart@terminus.co.uk", "attachment_id": null, "id": 99411, "time": "2007-02-15T02:50:37Z", "bug_id": 11540, "creation_time": "2007-02-15T02:50:37Z", "is_private": false, "text": "(In reply to comment #14)\n> I've just applied that one to trunk (with your tabs/indentation fixed).\n\nGreat, thank you. Apologies for indentation, I based it off a patch we've been\nusing for a while on a local build and totally forgot to check for tabs<->spaces.\n\n> Stuart, from memory I think I've seen your name on quite a few bugs, and they\n> tend to be of the kind that look valid but need some effort to check.  These\n> may tend to pass under the radar here. Maybe it would be more productive for\n> you to participate in dev@httpd with such points.\n\nI'm already a subscriber. In fact, I brought this bug up there before:\nhttp://marc.theaimsgroup.com/?l=apache-httpd-dev&m=113257650709794&w=2 - but got\nno response. I actually asked yesterday on Freenode's #apache what the best\nmethod to push bugs was, but people only seemed to be dealing with user queries.\nIs there a more developer-centric channel? I was planning to make another post\nto the mailing list after resubmitting these patches.\n\nI certainly appreciate that patches aren't always obvious in their effect; and\nit's good that commiters don't just apply them without thought. :) I'm more than\nhappy to help out and give examples/explain my working. If you'd like to\ncontinue the discussion on how reporters/developers without commit access can\nget their bugs (valid ones and not) dealt with more readily, let's take if off\nthis bug. Please feel free to email me directly, or bring it up on dev@ and I'll\njoin in."}, {"count": 16, "attachment_id": 19602, "bug_id": 11540, "is_private": false, "id": 99470, "time": "2007-02-16T03:35:21Z", "creator": "stuart@terminus.co.uk", "creation_time": "2007-02-16T03:35:21Z", "tags": [], "text": "Created attachment 19602\npatch against current 2.2.x HEAD"}, {"count": 17, "tags": [], "creator": "stuart@terminus.co.uk", "text": "Created attachment 19606\npatch against current 2.0.x HEAD", "id": 99486, "time": "2007-02-16T06:22:55Z", "bug_id": 11540, "creation_time": "2007-02-16T06:22:55Z", "is_private": false, "attachment_id": 19606}, {"count": 18, "tags": [], "bug_id": 11540, "is_private": false, "text": "I had applied the patch in 2.0.59 and 2.2.4 versions, and doesn't work. I try in\nSolaris and Linux environment.", "id": 101798, "time": "2007-04-17T05:56:26Z", "creator": "jgn@tinet.org", "creation_time": "2007-04-17T05:56:26Z", "attachment_id": null}, {"count": 19, "tags": [], "creator": "davi@apache.org", "attachment_id": null, "id": 104206, "time": "2007-06-08T08:35:06Z", "bug_id": 11540, "creation_time": "2007-06-08T08:35:06Z", "is_private": false, "text": "What exactly doesnt work?"}, {"count": 20, "tags": [], "creator": "rpluem@apache.org", "text": "(In reply to comment #19)\n> What exactly doesnt work?\n\nI guess he is hit by\n\nhttp://mail-archives.apache.org/mod_mbox/httpd-dev/200705.mbox/%3c464F4E80.9020202@apache.org%3e", "id": 104207, "time": "2007-06-08T08:45:49Z", "bug_id": 11540, "creation_time": "2007-06-08T08:45:49Z", "is_private": false, "attachment_id": null}, {"count": 21, "attachment_id": null, "bug_id": 11540, "text": "The ProxyTimeout setting for mod_proxy is not working as described. According to\nthe documentation, ProxyTimeout should \"fail gracefully instead of waiting\nhowever long it takes the server to return.\"\n\nThis means that ProxyTimeout setting should cause mod_proxy to return an error\nback to the user instead of waiting until the Server's main Timeout value is\nreached, which it is doing now. It seems the ProxyTimeout is currently ignored\nas everyone else here describes.\n\nFor example if Apache has a Timeout of 60 seconds and ProxyTimeout is 10\nseconds, then mod_proxy should return an error message back to the user if after\n10 seconds it did not receive a response to the server it connected to. \n\nPlease fix. \n\nThanks.", "id": 105945, "time": "2007-07-25T12:54:35Z", "creator": "alon.dakik@gmail.com", "creation_time": "2007-07-25T12:54:35Z", "tags": [], "is_private": false}, {"count": 22, "tags": [], "bug_id": 11540, "attachment_id": null, "is_private": false, "id": 105946, "time": "2007-07-25T13:01:38Z", "creator": "rpluem@apache.org", "creation_time": "2007-07-25T13:01:38Z", "text": "Fixed in trunk as r546128, r550514. Backported to 2.2.x as r556972\n(http://svn.apache.org/viewvc?view=rev&rev=556972)."}]
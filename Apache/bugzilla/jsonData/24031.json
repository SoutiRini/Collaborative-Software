[{"count": 0, "tags": [], "creator": "kris.verbeeck@advalvas.be", "text": "The current reverse proxy code can not handle private keys that are\npassphrase protected.  The key is never decrypted (there is no\npassphrase prompt) which results in a SIGSEGV.  Using a non-encrypted\nkey fixes this SIGSEGV.\n\nGDB info of the segfault (no backtrace available):\n\n   (gdb) c\n   Continuing.\n   Program received signal SIGSEGV, Segmentation fault.\n   0x0810d39c in X509_check_private_key (x=0x8236b30, k=0x82420a8)\n       at x509_cmp.c:380\n   380                     if (BN_cmp(xk->pkey.rsa->n,k->pkey.rsa->n) != 0\n\n(See also the following thread:\nhttp://marc.theaimsgroup.com/?l=apache-httpd-dev&m=106629032008685&w=2)", "id": 46107, "time": "2003-10-23T06:37:33Z", "bug_id": 24031, "creation_time": "2003-10-23T06:37:33Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "apache@moresecurity.org", "attachment_id": null, "id": 47319, "time": "2003-11-13T21:48:59Z", "bug_id": 24031, "creation_time": "2003-11-13T21:48:59Z", "is_private": false, "text": "Is it possible to ask the passphrase and to control the private key at apache \nstartup, or does it just not use the certificate is private key is not ok ?\n\n"}, {"count": 2, "tags": [], "bug_id": 24031, "text": "Yes I think the solution should be to ask for the passphrase at Apache startup\n(in the a similar way as it is done for the mod_ssl server keys).  As for the\nsecond part of your question, Apache (the SSL proxy code) tries to use the\ncertificate to do client authentiation, but when it gets to the phase where it\nshould use the (decrypted) private key the SEGV occurs because there is no\ndecrypted version of that private key.  I traced trough the code and the actual\nX509 object that is being used, does contain the correct client certificate and\nencrypted private key.", "id": 47333, "time": "2003-11-14T07:29:40Z", "creator": "kris.verbeeck@advalvas.be", "creation_time": "2003-11-14T07:29:40Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "What i found in the code is all x509 clients  certificates are read with: \nSSL_X509_INFO_load_file function,\nwhich is  modssl_PEM_X509_INFO_read_bio\nwhich is:\n\ncrypto/pem/pem.h:STACK_OF(X509_INFO) *  PEM_X509_INFO_read_bio(BIO *bp,\nSTACK_OF(X509_INFO) *sk, pem_password_cb *cb, void *u);\n\nSeems ssl module does not use pem_password callback to eventually take the password:\nmodssl_PEM_X509_INFO_read_bio(in, sk, NULL, NULL);\n\ni will continue in this way and find how i could do to ask the pem password.\nEven if the private key need a passphrase and it's maybe different than the pem\npassword.\n\nTell me if you see i am directly going into a wall =)\n", "attachment_id": null, "bug_id": 24031, "id": 47335, "time": "2003-11-14T10:03:58Z", "creator": "apache@moresecurity.org", "creation_time": "2003-11-14T10:03:58Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 24031, "attachment_id": null, "id": 48115, "time": "2003-11-25T21:20:49Z", "creator": "jorton@redhat.com", "creation_time": "2003-11-25T21:20:49Z", "is_private": false, "text": "Matthieu, the way this would need to be done is to extend the existing code in\nssl_engine_pphrase.c so that it can decode any encrypted private keys for the\nproxy config structures at the right time during startup, not sure if you'd\nworked this much out already."}, {"count": 5, "tags": [], "bug_id": 24031, "attachment_id": null, "id": 50112, "time": "2004-01-05T22:15:19Z", "creator": "mads@apache.org", "creation_time": "2004-01-05T22:15:19Z", "is_private": false, "text": "I've added a warning about the problem with encrypted keys to the docs.\n"}, {"count": 6, "attachment_id": null, "bug_id": 24031, "text": "This bug tracks the feature request to add support for encrypted private keys to\nthe SSL proxy code.  The SEGV is fixed per bug 24030.", "id": 51212, "time": "2004-01-26T22:35:27Z", "creator": "jorton@redhat.com", "creation_time": "2004-01-26T22:35:27Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "asfbugz@velox.ch", "text": "*** Bug 57179 has been marked as a duplicate of this bug. ***", "id": 178975, "time": "2014-11-05T09:29:47Z", "bug_id": 24031, "creation_time": "2014-11-05T09:29:47Z", "is_private": false, "attachment_id": null}]
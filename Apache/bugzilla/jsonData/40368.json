[{"count": 0, "tags": [], "bug_id": 40368, "text": "There seems to be an issue with the WMF Transcoder which causes the text within\nthe SVG created to not line up with any graphics that are present.\n\nI have some example WMF files which I am trying to convert to SVG (with their\nSVG output), and you will see the problems straight away.\n\nAlso included is the source I am using to do the conversion.\n\nhttp://www.flerwin.net/wmftosvg.zip\n\nAs noted, I am using the SVN trunk version of Batik.\n\n\nAntonio Broughton", "id": 92761, "time": "2006-08-30T22:24:24Z", "creator": "antonio@flerwin.net", "creation_time": "2006-08-30T22:24:24Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 40368, "text": "(In reply to comment #0)\n> There seems to be an issue with the WMF Transcoder which causes the text within\n> the SVG created to not line up with any graphics that are present.\n\nYes, it is because the WMF transcoder does not use the Vertical Alignement for\ntexts in the WMF files (only Horizontal). I have corrected this in local on my\nPC, and it works, but I am not in sync with trunk, so I will have to sync before\nsending a patch. Hopefully this will be done in the Week-End (I have a CLA on\nfile for Batik).\n\nHerve Girod", "id": 92924, "time": "2006-09-02T13:16:47Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2006-09-02T13:16:47Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 40368, "is_private": false, "text": "Created attachment 18813\npatch file resolvinf bugs 40368 and 40403\n\nSome modifications in the wmf.tosvg package fixing this bug, and 40403 as well.", "id": 92953, "time": "2006-09-03T17:41:04Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2006-09-03T17:41:04Z", "attachment_id": 18813}, {"count": 3, "tags": [], "bug_id": 40368, "text": "Created attachment 18814\nfirst testcase", "id": 92954, "time": "2006-09-03T17:42:22Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2006-09-03T17:42:22Z", "is_private": false, "attachment_id": 18814}, {"count": 4, "text": "The test case is the first given by Antonio Broughton. I tested the above patch\nwith the two tests cases he provided, but the second is too large to be imported\nin bugzilla...\n\nThe patch mostly deals with the painting of texts for different vertical\nalignments. Previously, vertical alignment was not used for conversion.\n\nWhen using the test files, I discovered two small bugs in the WMFProperties\nclass as well, when dealing with rectangles and roundRectangles. Plus the\nalignment was not used in the properties two. So I consider that this patch\ncorrect also bug 40403 (the latter filed by myself...)\n\nHerve Girod", "bug_id": 40368, "attachment_id": null, "id": 92955, "time": "2006-09-03T17:50:48Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2006-09-03T17:50:48Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 40368, "attachment_id": null, "text": "The patch works fine when patched against the latest SVN trunk.\n\nThere is however, an issue with the bottom of the generated PDF (when\ntranscoding using the second [larger] WMF)\n\nThe horizontal alignment doesn't seem to match up, the text at the bottom is\nside by side... when it should be URL at the left, and eMail address at the\nright... (see WMF for better explaination).\n\nMaybe the text is within a box or something, and that is not correctly lining\nup? [rather than the text].", "id": 92961, "time": "2006-09-03T21:24:18Z", "creator": "antonio@flerwin.net", "creation_time": "2006-09-03T21:24:18Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 40368, "text": "(In reply to comment #5)\n\n> The horizontal alignment doesn't seem to match up, the text at the bottom is\n> side by side... when it should be URL at the left, and eMail address at the\n> right... (see WMF for better explaination).\n> \nSome cases of horizontal Alignment may not be correct, I think. I will look at\nthis during the week, I'm sure it will be easy to fix (and I am able to\nreproduce the problem with the second WMF image, of course). Thanks !!\n\nHerve Girod\n", "id": 92963, "time": "2006-09-03T22:40:42Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2006-09-03T22:40:42Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "herve.girod@club-internet.fr", "attachment_id": null, "text": "(In reply to comment #5)\n> The patch works fine when patched against the latest SVN trunk.\n> \n> There is however, an issue with the bottom of the generated PDF (when\n> transcoding using the second [larger] WMF)\n> \n> The horizontal alignment doesn't seem to match up, the text at the bottom is\n> side by side... when it should be URL at the left, and eMail address at the\n> right... (see WMF for better explaination).\n\nIt seems not to be in the transcoder package. There is only one String for the\nbottom and it has a lot of white spaces between the two consecutive words; the\nWMFPainter class correctly decodes the text (with all its white spaces), but if\nyou look at the resulting File, there is only one resulting white space between\nthe words.\n\nI tracked the problem in the SVGGraphics2D class, and the iteration stuff in the\nassociated attributed String is OK too. I suspect two possible causes (I will\nlook at it more closely in the next days, but perhaps Thomas DeWeese could give\na hint ?) :\n- either it is simply a problem of how Batik deals with several white\nconsecutive spaces\n- or it results on the way of how the underlying XML parser deals with\nconsecutive white spaces (the ignorable white space property).\n\nI suspect the second, because if I convert and open on the fly the second\nexample in my local copy of Batik, and I look at the resulting properties in the\nviewer, I see several white spaces, but only one is visible in the panel. Also,\nas said before, if I write the result in a File, I have only one white space.\n\nHoping this comment is not too confusing...\n\nHerve Girod", "id": 92996, "time": "2006-09-04T23:01:59Z", "bug_id": 40368, "creation_time": "2006-09-04T23:01:59Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 40368, "attachment_id": null, "id": 93002, "time": "2006-09-04T23:53:40Z", "creator": "deweese@apache.org", "creation_time": "2006-09-04T23:53:40Z", "is_private": false, "text": "(In reply to comment #7)\n\n> I tracked the problem in the SVGGraphics2D class, and the iteration stuff in \n> the associated attributed String is OK too. I suspect two possible causes \n> (I will look at it more closely in the next days, but perhaps Thomas \n> DeWeese could give a hint ?) :\n> - either it is simply a problem of how Batik deals with several white\n> consecutive spaces\n\n   It is how SVG deals with consecutive spaces.  We should be\nsetting xml:space=\"preserve\" on the Text elements we generate.\n(To be honest I'm astonished that we don't already, and that\nit hasn't hit us before this).\n\n> - or it results on the way of how the underlying XML parser deals with\n> consecutive white spaces (the ignorable white space property).\n\n   The spaces would be 'ignored' by Batik. The Parser can't ignore them.\n\n> I suspect the second, because if I convert and open on the fly the second\n> example in my local copy of Batik, and I look at the resulting properties in \n> the viewer, I see several white spaces, but only one is visible in the panel. \n> Also, as said before, if I write the result in a File, I have only one white \n> space.\n\n   How do you write the file to disk, is it through a transcoder,\nor serializing the Document?  The latter should still have all\nof the spaces.\n"}, {"count": 9, "tags": [], "bug_id": 40368, "text": "(In reply to comment #8)\n> \n>    How do you write the file to disk, is it through a transcoder,\n> or serializing the Document?  The latter should still have all\n> of the spaces.\n> \nThrough the SVGTranscoder.\n\n", "id": 93068, "time": "2006-09-05T21:51:17Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2006-09-05T21:51:17Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "herve.girod@club-internet.fr", "attachment_id": 18837, "text": "Created attachment 18837\nadd space:preserve property to text nodes\n\nAS this patch was prepared on my working copy of Batik, it also contains the\ncorrection for bug 35515 (same class SVGGraphics2D involved in another method)", "id": 93177, "time": "2006-09-07T23:34:10Z", "bug_id": 40368, "creation_time": "2006-09-07T23:34:10Z", "is_private": false}, {"count": 11, "tags": [], "creator": "herve.girod@club-internet.fr", "attachment_id": null, "is_private": false, "id": 93178, "time": "2006-09-07T23:36:12Z", "bug_id": 40368, "creation_time": "2006-09-07T23:36:12Z", "text": "(In reply to comment #10)\n> \n> AS this patch was prepared on my working copy of Batik, it also contains the\n> correction for bug 35515 (same class SVGGraphics2D involved in another method)\n\nThis was texted on the second example from Antonio Broughton and worked fine on\nmy computer \n\n"}, {"count": 12, "tags": [], "bug_id": 40368, "text": "Created attachment 18838\nsmall test case to test the space:preserve property\n\nThis small test case allows to test the space:preserve property setting", "id": 93179, "time": "2006-09-07T23:43:20Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2006-09-07T23:43:20Z", "is_private": false, "attachment_id": 18838}, {"count": 13, "tags": [], "creator": "antonio@flerwin.net", "attachment_id": null, "text": "I applied the patch for the space:preserve property in text nodes, and this adds\nthem to the text nodes, however, When viewing the SVG document in a number of ways:\n  * Firefox\n  * Squiggle\n\nIt does not contain the whitespace at the bottom...\n\nI even tried to use the PDFTranscoder from Apache FOP to create a PDF from the\nSVG... but... it also does not have the whitespace preserved\n\nAs said previously, the source code shows that the patch is actually adding the\nspace=\"preserve\" attribute to text nodes... heres an extract:\n\n<text fill=\"white\" x=\"201.7241\" space=\"preserve\" font-size=\"18\" y=\"1250.7085\"\nstroke=\"none\">www.fullyequipped.co.nz                       \nantonio@mcpond.co.nz</text>\n\nThis might be a difference in the latest trunk version, and the version you are\nusing Herve?", "id": 93263, "time": "2006-09-09T09:29:53Z", "bug_id": 40368, "creation_time": "2006-09-09T09:29:53Z", "is_private": false}, {"count": 14, "text": "I tried patching it with revision 439782 (as shown in the first patch), but this\nstill does not show the spaces.", "bug_id": 40368, "attachment_id": null, "id": 93264, "time": "2006-09-09T09:41:59Z", "creator": "antonio@flerwin.net", "creation_time": "2006-09-09T09:41:59Z", "tags": [], "is_private": false}, {"count": 15, "tags": [], "bug_id": 40368, "text": "(In reply to comment #13)\n> I applied the patch for the space:preserve property in text nodes, and this adds\n> them to the text nodes, however, When viewing the SVG document in a number of\nways:\n>   * Firefox\n>   * Squiggle\n> \n> It does not contain the whitespace at the bottom...\n>\nSame as you in last SVN version of Squiggle, and in Firefox, or IE + Adobe SVG\nViewer. It is because the property is set as \"space\", but it should be\n\"xml:space\". If you set it as \"xml:space\", it will be OK in Swiggle, Firefox,\nand Adobe SVG Viewer. But I have another problem. This is very simple to patch\nin the code, but if I set the property as \"xml:space\", then if I transcode the\nWMF File \"on the fly\" and view it in a JSVGCanvas (not by reopening a previously\nserialized SVG File), there is no more whitespaces between the two words. So I\nwill have to look a bit more at that before modifying my second patch File. It\nshouldn't be too long.\n\nHerve Girod ", "id": 93265, "time": "2006-09-09T11:10:12Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2006-09-09T11:10:12Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 40368, "attachment_id": null, "id": 93298, "time": "2006-09-10T13:55:01Z", "creator": "deweese@apache.org", "creation_time": "2006-09-10T13:55:01Z", "is_private": false, "text": "This is now fixed in SVN.\n\n(In reply to comment #12)\n> Created an attachment (id=18838) [edit]\n> small test case to test the space:preserve property\n\n   BTW, I don't think this tests this, I think the WMF is\nactually multiple text pieces not one with spaces."}, {"count": 17, "tags": [], "bug_id": 40368, "attachment_id": null, "is_private": false, "id": 93310, "time": "2006-09-10T21:38:24Z", "creator": "antonio@flerwin.net", "creation_time": "2006-09-10T21:38:24Z", "text": "All seems to work now!\n\nThanks Herve and Thomas"}, {"count": 18, "tags": [], "bug_id": 40368, "text": "Created attachment 18846\nsmall test case to test the space:preserve property", "id": 93315, "time": "2006-09-10T23:18:43Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2006-09-10T23:18:43Z", "is_private": false, "attachment_id": 18846}, {"count": 19, "tags": [], "creator": "herve.girod@club-internet.fr", "attachment_id": null, "text": "(In reply to comment #16)\n>    BTW, I don't think this tests this, I think the WMF is\n> actually multiple text pieces not one with spaces.\n\nThe last attachment is OK. When I deleted all the objects (save the text with\nwhite spaces) in Antonio's second test case (which was too large to import in\nBugzilla)PowerPoint splitted the text with white spaces in two separated texts\nwithout white spaces...\n", "id": 93316, "time": "2006-09-10T23:22:27Z", "bug_id": 40368, "creation_time": "2006-09-10T23:22:27Z", "is_private": false}, {"count": 20, "tags": [], "bug_id": 40368, "attachment_id": null, "id": 93760, "time": "2006-09-18T22:21:30Z", "creator": "antonio@flerwin.net", "creation_time": "2006-09-18T22:21:30Z", "is_private": false, "text": "I have noticed on my computer, when transcoding the second (larger) WMF test\nfile I posted, at the top right hand corner of the WMF, you will notice that\nthere is the words HAMILTON in white writing with black background.\n\nHowever, in the SVG, there is just a white space.\n\nLooking within the SVG file however, the HAMILTON words are actually there.\n\nIs there an issue with having a black background??\n\nThis is an extract of the SVG:\n\n<g stroke-linecap=\"butt\" font-size=\"24\" fill=\"white\" stroke-linejoin=\"round\"\nstroke=\"white\" font-weight=\"bold\" stroke-width=\"1.1596\">\n<text x=\"782.6629\" xml:space=\"preserve\" y=\"55.437\" stroke=\"none\">HAMILTON </text>\n<line y2=\"173.9339\" fill=\"none\" x1=\"31.3081\" x2=\"907.9352\" stroke=\"black\"\ny1=\"173.9339\"/>\n\n\nFor somereason, it is placing the HAMILTON white text with black background,\nwithin the same context as the barcode??"}, {"count": 21, "tags": [], "creator": "herve.girod@club-internet.fr", "attachment_id": null, "text": "(In reply to comment #20)\n> I have noticed on my computer, when transcoding the second (larger) WMF test\n> file I posted, at the top right hand corner of the WMF, you will notice that\n> there is the words HAMILTON in white writing with black background.\n> \n> However, in the SVG, there is just a white space.\n> \n> Looking within the SVG file however, the HAMILTON words are actually there.\n> \n> Is there an issue with having a black background??\n>\nI think the issue comes from a WMF Metafile operand that is not handled by Batik\nwhen importing the file : DIBBITBLT. THJis operand is present just before the\nHAMILTON text in the WMF file. It seems to fill a rectangle in the image in some\nobscure way (sort of copying a zone to another, may be even stretching in the\nprocess). I will look at it, to see if it is possible to handle this operand...", "id": 94041, "time": "2006-09-24T09:31:10Z", "bug_id": 40368, "creation_time": "2006-09-24T09:31:10Z", "is_private": false}, {"count": 22, "text": "(In reply to comment #20)\n> I have noticed on my computer, when transcoding the second (larger) WMF test\n> file I posted, at the top right hand corner of the WMF, you will notice that\n> there is the words HAMILTON in white writing with black background.\n> \n> However, in the SVG, there is just a white space.\n> \n> Looking within the SVG file however, the HAMILTON words are actually there.\n> \n> Is there an issue with having a black background??\n>\n\nOK the issue comes from the DIBBITBLT WMF operand that is not handled by Batik.\nI patched the WMF concersion library, and it now works in my local copy. I just\nhave to send the patch... Meanwhile, I close this bug, and create a new one, as\nthe problem is not an alignment problem.", "bug_id": 40368, "attachment_id": null, "id": 94042, "time": "2006-09-24T11:26:58Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2006-09-24T11:26:58Z", "tags": [], "is_private": false}]
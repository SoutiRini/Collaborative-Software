[{"count": 0, "tags": [], "bug_id": 56325, "text": "Created attachment 31448\nAn example of XLS file to help you reproduce a bug\n\nSteps to reproduce:\n1. Create an empty XLS file with 3 sheets (they're there by default)\n2. On the 3rd sheet create 6 named ranges. The scope of those names must be that sheet, not the workbook (it is important!), so do it with Name Manager.\n3. Run the code:\n\nimport org.apache.poi.hssf.usermodel.HSSFWorkbook;\nimport org.apache.poi.poifs.filesystem.POIFSFileSystem;\n\nimport java.io.FileInputStream;\nimport java.io.IOException;\n\npublic class Test {\n\n  public static void main(String[] args) throws IOException {\n    POIFSFileSystem fs = new POIFSFileSystem(new FileInputStream(\"empty.xls\"));\n    HSSFWorkbook wb = new HSSFWorkbook(fs);\n    wb.removeSheetAt(0);\n  }\n}\n\nExpected result is:\n- the first sheet is being removed from the sheet.\n\nThe actual result is:\nException in thread \"main\" java.lang.IndexOutOfBoundsException: Index: 3, Size: 3\n\tat java.util.ArrayList.RangeCheck(ArrayList.java:547)\n\tat java.util.ArrayList.get(ArrayList.java:322)\n\tat org.apache.poi.hssf.record.ExternSheetRecord.getRef(ExternSheetRecord.java:164)\n\tat org.apache.poi.hssf.record.ExternSheetRecord.adjustIndex(ExternSheetRecord.java:168)\n\tat org.apache.poi.hssf.model.LinkTable.updateIndexToInternalSheet(LinkTable.java:419)\n\tat org.apache.poi.hssf.model.InternalWorkbook.removeSheet(InternalWorkbook.java:721)\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.removeSheetAt(HSSFWorkbook.java:899)\n\tat Test.main(Test.java:12)", "id": 174139, "time": "2014-03-27T17:02:17Z", "creator": "frolovskij@gmail.com", "creation_time": "2014-03-27T17:02:17Z", "is_private": false, "attachment_id": 31448}, {"count": 1, "tags": [], "bug_id": 56325, "is_private": false, "text": "This seems to have been introduced by the fix for Bug 54400, the linkTable-code is a bit complicated and hard to get right, we obviously need another go at it.", "id": 175259, "time": "2014-05-15T19:51:16Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2014-05-15T19:51:16Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 56325, "is_private": false, "text": "I tried to fix this in r1595048 so that both the previous problem and this one are fixed and removing sheets correctly updates the references to external books in all cases.", "id": 175262, "time": "2014-05-15T21:16:06Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2014-05-15T21:16:06Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 56325, "text": "Hi, I encountered the possible the same problems with poi_3.10.1 and poi_3.11.beta2.\n\nThe workbook contains: \n* sheet1: is protected; contains formulas with referred cells from the other sheets\n* sheet2, 3, ...: nothing special\n* all sheets: contains named ranges for printing (print area, repeated page header)\n\nMy code: just open and try to delete any sheet using wb.removeSheetAt(x).\n\nError: the same exception as Aleksey. (IndexOutOfBoundsException at ExternSheetRecord#getRef).\n\nI wonder if this bug is fixed and withc version of poi containning the fix since i'm not familliar with bugzilla.\n\nSorry for my bad English.", "id": 177333, "time": "2014-08-23T06:58:53Z", "creator": "bboyz269@yahoo.com.vn", "creation_time": "2014-08-23T06:58:53Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "is_private": false, "id": 177334, "time": "2014-08-23T09:56:21Z", "bug_id": 56325, "creation_time": "2014-08-23T09:56:21Z", "text": "Can you attach the Excel file that triggers the problem so we can reproduce it? The original file in this bug-report works fine now via a unit-test so it seems there are more cases where it fails with similar error message."}, {"count": 5, "tags": [], "bug_id": 56325, "text": "I believe that I have the same problem here. After setting the print area or set the repeat rows. I can't use the method removeSheetAt(int).\n\nAnd in my code, if I remove the sheet first, and then set the print area or repeat rows, everything works well.", "id": 178726, "time": "2014-10-24T17:26:43Z", "creator": "zhixinni@gmail.com", "creation_time": "2014-10-24T17:26:43Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 56325, "text": "Sorry, I forgot the mention the POI version I'm using.\nIt is poi-3.10.1-2014-0818. \n\nAnd here is the exception I got:\nCaused by: java.lang.IndexOutOfBoundsException: Index: 12, Size: 6\n        at java.util.ArrayList.rangeCheck(ArrayList.java:571)\n        at java.util.ArrayList.get(ArrayList.java:349)\n        at org.apache.poi.hssf.record.ExternSheetRecord.getRef(ExternSheetRecord.java:164)\n        at org.apache.poi.hssf.record.ExternSheetRecord.adjustIndex(ExternSheetRecord.java:168)\n        at org.apache.poi.hssf.model.LinkTable.updateIndexToInternalSheet(LinkTable.java:419)\n        at org.apache.poi.hssf.model.InternalWorkbook.removeSheet(InternalWorkbook.java:721)\n        at org.apache.poi.hssf.usermodel.HSSFWorkbook.removeSheetAt(HSSFWorkbook.java:899)\n\n\nIn my code, I called removeSheetAt(3). And there are 6 sheets in the file. I set print area and repeat rows on the last two sheets.", "id": 178727, "time": "2014-10-24T17:30:08Z", "creator": "zhixinni@gmail.com", "creation_time": "2014-10-24T17:30:08Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 56325, "is_private": false, "text": "Created attachment 32143\nHere is a file can verify this problem\n\nHere is the code will cause this problem\npublic class PoiBugTesting {\n\n  public PoiBugTesting() {\n    // TODO Auto-generated constructor stub\n  }\n\n  public static void main(String[] args) {\n    try {\n      HSSFWorkbook wBook = (HSSFWorkbook) WorkbookFactory.create(new FileInputStream(\"C:\\\\Users\\\\xxx\\\\Desktop\\\\Bug Test Book.xls\"));\n      HSSFSheet sheet = wBook.cloneSheet(2);\n      wBook.setSheetName(3, \"Clone 1\");\n      sheet.setRepeatingRows(CellRangeAddress.valueOf(\"2:3\"));\n      wBook.setPrintArea(3, \"$A$4:$C$10\");\n      \n      sheet = wBook.cloneSheet(2);\n      wBook.setSheetName(4, \"Clone 2\");\n      sheet.setRepeatingRows(CellRangeAddress.valueOf(\"2:3\"));\n      wBook.setPrintArea(4, \"$A$4:$C$10\");\n      \n      wBook.removeSheetAt(2);\n      \n      FileOutputStream fOut = new FileOutputStream(\"C:\\\\Users\\\\xxx\\\\Desktop\\\\test.xls\");\n      wBook.write(fOut);\n      fOut.close();\n      \n    } catch (InvalidFormatException e) {\n      // TODO Auto-generated catch block\n      e.printStackTrace();\n    } catch (FileNotFoundException e) {\n      // TODO Auto-generated catch block\n      e.printStackTrace();\n    } catch (IOException e) {\n      // TODO Auto-generated catch block\n      e.printStackTrace();\n    }\n\n  }\n\n}", "id": 178728, "time": "2014-10-24T17:46:57Z", "creator": "zhixinni@gmail.com", "creation_time": "2014-10-24T17:46:57Z", "attachment_id": 32143}, {"attachment_id": null, "tags": [], "creator": "dominik.stadler@gmx.at", "is_private": false, "count": 8, "id": 181759, "time": "2015-03-14T14:57:32Z", "bug_id": 56325, "creation_time": "2015-03-14T14:57:32Z", "text": "I now added the latest test that was provided here, it works fine with latest versions of POI. \n\nIf you still see this problem, please check with the latest version of POI, at least 3.12-beta1 and reopen this bug with an updated test-file/unit-test or more information how the problem can be reproduced."}]
[{"count": 0, "tags": [], "text": "Created attachment 28630\nadding \"secret\" proxypass option\n\napache httpd config:\nProxyPass /test ajp://localhost:8009/test secret=123\n\ntomcat config:\n<Connector protocol=\"AJP/1.3\" requiredSecret=\"123\" ... />", "is_private": false, "bug_id": 53098, "id": 158156, "time": "2012-04-18T06:49:55Z", "creator": "dab18@izhnet.ru", "creation_time": "2012-04-18T06:49:55Z", "attachment_id": 28630}, {"count": 1, "tags": [], "bug_id": 53098, "attachment_id": null, "text": "Voting for this bug because this is the only way to prevent someone from constructing a ajp request and sending it with a invalid username to a tomcat server.  This module should support this.", "id": 162549, "time": "2012-10-03T19:55:27Z", "creator": "jacob.champlin@gmail.com", "creation_time": "2012-10-03T19:55:27Z", "is_private": false}, {"count": 2, "tags": [], "text": "example of more secure configuration.\n\nmain apache virtualhost file (world readable):\n\n...\nProxyPass /test ajp://localhost:8009/test\n#Include must be after ProxyPass\nInclude ajp_secrets.include\n...\n\ncontents of ajp_secrets.include (only root readable):\n\n...\nProxySet ajp://localhost:8009/test secret=123\n...", "is_private": false, "bug_id": 53098, "id": 167400, "time": "2013-05-24T16:03:57Z", "creator": "dab1818@gmail.com", "creation_time": "2013-05-24T16:03:57Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 53098, "attachment_id": null, "text": "Voting to this because it's a way of securing connection between Apache Reverse proxy and target application server. \n\nIt would be even better to have a \"signature request mechanism\" for some header. Like if the REMOTE_USER header is added by the reverse proxy, the header is signed in a REMOTE_USER_SIGNATURE field, using a private key stored on the reverse proxy.", "id": 190041, "time": "2016-04-07T11:44:58Z", "creator": "david.naramski@nowina.lu", "creation_time": "2016-04-07T11:44:58Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 53098, "attachment_id": null, "text": "signature will require modification on the Tomcat side.\nthis patch only impliment Tomcat requiredSecret option for mod_proxy, like mod_jk does.\nsee https://tomcat.apache.org/connectors-doc/reference/workers.html (search for \"secret\").\nsecurity for frontend to backend communication may be done by localhost connection or by network topology (network switch), etc.\n\nsecurity for frontend to backend communication may be done by localhost connection or by network topology (network switch, etc.), because this is internal trusted link.", "id": 190048, "time": "2016-04-07T17:50:12Z", "creator": "dab1818@gmail.com", "creation_time": "2016-04-07T17:50:12Z", "is_private": false}, {"count": 5, "tags": [], "creator": "dab1818@gmail.com", "attachment_id": null, "is_private": false, "id": 190049, "time": "2016-04-07T17:51:45Z", "bug_id": 53098, "creation_time": "2016-04-07T17:51:45Z", "text": "this patch is worked with apache-2.4.18"}, {"count": 6, "tags": [], "bug_id": 53098, "attachment_id": 33739, "id": 190066, "time": "2016-04-08T09:19:32Z", "creator": "dab1818@gmail.com", "creation_time": "2016-04-08T09:19:32Z", "is_private": false, "text": "Created attachment 33739\napache 2.4 patch"}, {"count": 7, "tags": [], "creator": "david.naramski@nowina.lu", "text": "(In reply to Dmitry A. Bakshaev from comment #4)\n> signature will require modification on the Tomcat side.\n> this patch only impliment Tomcat requiredSecret option for mod_proxy, like\n> mod_jk does.\n> see https://tomcat.apache.org/connectors-doc/reference/workers.html (search\n> for \"secret\").\n> security for frontend to backend communication may be done by localhost\n> connection or by network topology (network switch), etc.\n> \n> security for frontend to backend communication may be done by localhost\n> connection or by network topology (network switch, etc.), because this is\n> internal trusted link.\n\nYou're right, I've created a new request for this signature idea : 59285 (https://bz.apache.org/bugzilla/show_bug.cgi?id=59285). \n\nThis will permit to the application to treat this field without changing the Tomcat connector.", "id": 190126, "time": "2016-04-11T07:20:59Z", "bug_id": 53098, "creation_time": "2016-04-11T07:20:59Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "text": "(In reply to David Naramski from comment #7)\n> You're right, I've created a new request for this signature idea : 59285\n> (https://bz.apache.org/bugzilla/show_bug.cgi?id=59285). \n> \n> This will permit to the application to treat this field without changing the\n> Tomcat connector.\n\nwhy not use ssl for backend connection?\n\nintegrity, encryption, transparently for both sides\n\nmod_proxy can do it for http.\nnot sure about mod_proxy_ajp and tomcat ajp-connector.", "is_private": false, "bug_id": 53098, "id": 190128, "time": "2016-04-11T09:51:37Z", "creator": "dab1818@gmail.com", "creation_time": "2016-04-11T09:51:37Z", "attachment_id": null}, {"count": 9, "tags": [], "text": "(In reply to Dmitry A. Bakshaev from comment #8)\n> \n> why not use ssl for backend connection?\n> \n> integrity, encryption, transparently for both sides\n\nAgreed.\n\n> \n> mod_proxy can do it for http.\n> not sure about mod_proxy_ajp and tomcat ajp-connector.\n\nmod_proxy_ajp can also be configured to use TLS connections and PKI.", "is_private": false, "bug_id": 53098, "id": 190130, "time": "2016-04-11T11:28:45Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2016-04-11T11:28:45Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 53098, "attachment_id": null, "id": 190134, "time": "2016-04-11T15:09:29Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2016-04-11T15:09:29Z", "is_private": false, "text": "Yann, are you aure about proxy_ajp and TLS? I thought the TLS part is only inside proxy_http but I could be wrong. Of course one can use technology outside of httpd like stunnel.\n\nI also would be very surprised, but positively surprised, if we would find a way on AJP servers (Tomcat, Jetty) to configure AJP over TLS there.\n\nRegards,\n\nRainer"}, {"count": 11, "attachment_id": null, "creator": "ylavic.dev@gmail.com", "text": "Hmm, you are right, I thought \"ajps:\" was handled but it's an overlook on my side.\nIt shouldn't be too much pain to add it though, if Tomcat is already good to go, most of the code to handle TLS is in proxy_util.\nI could try to cook a patch...", "id": 190139, "time": "2016-04-11T16:41:17Z", "bug_id": 53098, "creation_time": "2016-04-11T16:41:17Z", "tags": [], "is_private": false}, {"count": 12, "tags": [], "text": "The subject of this bug report is adding support to include the \"secret\" AJP field. Please do not confuse things by bringing in other topics such as AJP support for TLS, instead open a new bug report for that independent issue.\n\nNow back to the actual topic of this bug. A simple non-controversial patch has been available since this bug was opened 4 years ago. Yet 4 years later it still has not been applied. Why?", "is_private": false, "bug_id": 53098, "id": 190142, "time": "2016-04-11T17:03:50Z", "creator": "jdennis@redhat.com", "creation_time": "2016-04-11T17:03:50Z", "attachment_id": null}, {"count": 13, "attachment_id": null, "creator": "ylavic.dev@gmail.com", "text": "(In reply to jdennis@redhat.com from comment #12)\n> Now back to the actual topic of this bug. A simple non-controversial patch\n> has been available since this bug was opened 4 years ago. Yet 4 years later\n> it still has not been applied. Why?\n\nMaybe because a stronger authentication method is possible by using an https connector? Not ajps though (I stand corrected!), but AFAICT current Tomcat versions can be configured to use https and hence TLS authentication.\n\nPlease keep in mind that committers are volunteer here, with limited time devoted to most important tasks, in their opinion...\n\nThe point is, IMHO, that a secret sent in clear text in not very secure.\nEither the network between httpd and tomcat is controlled and an (week) authentication is not needed, or the network is unsafe and a stronger authentication is required.", "id": 190182, "time": "2016-04-12T10:31:41Z", "bug_id": 53098, "creation_time": "2016-04-12T10:31:41Z", "tags": [], "is_private": false}, {"count": 14, "tags": [], "text": "I suspect everyone is in agreement that the transport needs to be protected for this to be useful. But lets not get the cart before the horse, protected transport only becomes an issue *after* this omission in the AJP protocol generation is fixed. That's all this bug report is asking for, to correct the omission. The patch is available, it's not hard. Nobody would be forced to use the feature so it doesn't make anything less secure. But as it stands now if you do want to use it, perhaps you have a protected transport available to you, you can't use it because the AJP protocol generator oddly omits the attribute.\n\nWe want to use the attribute. We'll worry about the separate issue of protected transport elsewhere. Make sense?", "is_private": false, "bug_id": 53098, "id": 190186, "time": "2016-04-12T13:02:11Z", "creator": "jdennis@redhat.com", "creation_time": "2016-04-12T13:02:11Z", "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 53098, "attachment_id": null, "text": "this patch just adds lost functionality to mod_proxy_ajp, a lot of time working in mod_jk+tomcat.\n\nno new features.\n\na typical usage scenario:\nclient(browser) - https(internet) - apache httpd(ssl-termination-acceleration) - mod_proxy_ajp - ajp - localhost(trusted area) - apache tomcat(application)\n\n\"secret\" need to \"bind\" multiple url on apache httpd to multiple tomcat instances or connectors one-to-one, to protect from fake ajp requests from other application and users from same host(localhost).\n\n\"secret\" works like \"identification\", not crypto-blablabla...\n\nssl,encryption&etc is separate question.", "id": 190194, "time": "2016-04-12T17:34:51Z", "creator": "dab1818@gmail.com", "creation_time": "2016-04-12T17:34:51Z", "is_private": false}, {"count": 16, "attachment_id": null, "creator": "ylavic.dev@gmail.com", "is_private": false, "id": 190199, "time": "2016-04-12T23:44:00Z", "bug_id": 53098, "creation_time": "2016-04-12T23:44:00Z", "tags": [], "text": "(In reply to jdennis@redhat.com from comment #14)\n> We want to use the attribute. We'll worry about the separate issue of\n> protected transport elsewhere. Make sense?\n\n(In reply to Dmitry A. Bakshaev from comment #15)\n> this patch just adds lost functionality to mod_proxy_ajp, a lot of time\n> working in mod_jk+tomcat.\n\nFair enough, there seem to (still) be attraction to it, so committed in r1738878, let's see what others say...\n\n> \n> a typical usage scenario:\n> client(browser) - https(internet) - apache\n> httpd(ssl-termination-acceleration) - mod_proxy_ajp - ajp -\n> localhost(trusted area) - apache tomcat(application)\n> \n> \"secret\" need to \"bind\" multiple url on apache httpd to multiple tomcat\n> instances or connectors one-to-one, to protect from fake ajp requests from\n> other application and users from same host(localhost).\n\nI can grok the \"isolation\" argument (prevent requests from reaching unexpected services), but not the security one.\nThis is definitively not a security feature (like SSLv2 isn't anymore), and shouldn't be presented as such.\nAs I said earlier, either localhost is trusted or it is not, and in the latter case \"secret\" won't change anything (significantly).\n\n> \n> \"secret\" works like \"identification\", not crypto-blablabla...\n> \n> ssl,encryption&etc is separate question.\n\nThis is called \"authentification\" in crypto, not blah, and it's probably the only way to achieve security goals, if any..."}, {"count": 17, "tags": [], "text": "Thank you!", "is_private": false, "bug_id": 53098, "id": 190200, "time": "2016-04-12T23:57:49Z", "creator": "jdennis@redhat.com", "creation_time": "2016-04-12T23:57:49Z", "attachment_id": null}, {"count": 18, "tags": [], "text": "thanks to all", "is_private": false, "bug_id": 53098, "id": 190215, "time": "2016-04-13T17:22:50Z", "creator": "dab1818@gmail.com", "creation_time": "2016-04-13T17:22:50Z", "attachment_id": null}]
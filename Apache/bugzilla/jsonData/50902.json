[{"count": 0, "tags": [], "text": "Hi there,\n\nThought this bug is related to bug #50247, but as per Eric's suggestion I'm opening a new bug.\n\nThe httpd in question is 2.2.16 running on EC2.\n\nWe see that after ~10 minutes of significant load, some of the worker processes get hang on poll().\n\nBy hang I mean that poll() call didn't finish for more than 30 seconds.\n\nThis is the stacktrace from one of the processes that are in this state:\n\n#0  0x00007f76fa70c748 in poll () from /lib64/libc.so.6\n#1  0x00007f76fabe2822 in apr_wait_for_io_or_timeout () from\n/usr/lib64/libapr-1.so.0\n#2  0x00007f76fabdd2da in apr_socket_recv () from /usr/lib64/libapr-1.so.0\n#3  0x00007f76fc0dfddd in ap_lingering_close ()\n#4  0x00007f76fc0eaa7e in ?? ()\n#5  0x00007f76fc0ead1a in ?? ()\n#6  0x00007f76fc0eadd0 in ?? ()\n#7  0x00007f76fc0eb908 in ap_mpm_run ()\n#8  0x00007f76fc0c54fb in main ()\n\nPlease let me know if there's any more information I can provide - this problem\nis obviously a major concern to us.\n\nThanks,\nTal", "attachment_id": null, "bug_id": 50902, "id": 144872, "time": "2011-03-09T09:34:35Z", "creator": "tal.yalon@gmail.com", "creation_time": "2011-03-09T09:34:35Z", "is_private": false}, {"count": 1, "tags": [], "creator": "trawick@apache.org", "is_private": false, "text": "We have to see the parameters passed to poll() (perhaps from strace, perhaps from a backtrace on a debug build, perhaps from somebody understanding the assembly code with the same build you got the backtraces from).\n\nThe timeout is hard-coded to 2 seconds, so it isn't supposed to block longer than that.\nA FIN has already been sent on the connection, so poll() could wake up on socket activity before \"too long.\"\n\nIf server-status is enabled, a thread with this backtrace should show up as \"C\" (closing).", "id": 144873, "time": "2011-03-09T10:06:52Z", "bug_id": 50902, "creation_time": "2011-03-09T10:06:52Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 50902, "text": "(In reply to comment #1)\n> We have to see the parameters passed to poll() (perhaps from strace, perhaps\n> from a backtrace on a debug build, perhaps from somebody understanding the\n> assembly code with the same build you got the backtraces from).\n> \n> The timeout is hard-coded to 2 seconds, so it isn't supposed to block longer\n> than that.\n\nIf the remote partner (in this case the client) does not close the socket we can return to the poll call over and over again for the next 30 seconds. We only stay in a single poll call for at max 2 seconds, but may have up to 15 calls to poll.", "id": 144875, "time": "2011-03-09T11:47:33Z", "creator": "rpluem@apache.org", "creation_time": "2011-03-09T11:47:33Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 50902, "text": "thanks, Ruediger\nwe need to distinguish between blocking in a single poll() call for a long time vs. repeatedly calling poll(); strace would make that clear; gdb could make that clear as well if used properly", "id": 144876, "time": "2011-03-09T12:01:57Z", "creator": "trawick@apache.org", "creation_time": "2011-03-09T12:01:57Z", "tags": [], "is_private": false}]
[{"count": 0, "text": "Server: https://aftenposten.www2.dk/\nCN: *.www2.dk\n\nError_log:\n[ssl:info] [pid 26766:tid 139907918526208] [remote 81.19.247.132:443] AH02005: SSL Proxy: Peer certificate CN mismatch: Certificate CN: *.www2.dk Requested hostname: aftenposten.www2.dk\n[ssl:info] [pid 26766:tid 139907918526208] [remote 81.19.247.132:443] AH01998: Connection closed to child 0 with abortive shutdown (server aftenposten-www2-dk.sandbox.userfacts.com:80)\n[proxy_http:error] [pid 26766:tid 139907918526208] (502)Unknown error 502: [client 10.56.114.48:9619] AH01084: pass request body failed to 81.19.247.132:443 (aftenposten.www2.dk)\n[proxy:error] [pid 26766:tid 139907918526208] [client 10.56.114.48:9619] AH00898: Error during SSL Handshake with remote server returned by /\n[proxy_http:error] [pid 26766:tid 139907918526208] [client 10.56.114.48:9619] AH01097: pass request body failed to 81.19.247.132:443 (aftenposten.www2.dk) from 10.56.114.48 ()", "bug_id": 53006, "is_private": false, "id": 155383, "time": "2012-03-30T06:42:55Z", "creator": "petterb@gmail.com", "creation_time": "2012-03-30T06:42:55Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 53006, "text": "That's right, mod_ssl currently doesn't have support for wildcard matching in proxy SSL connections (ssl_engine_io.c:ssl_io_filter_handshake() does a strcasecmp of the hostname only).\n\nSSLProxyCheckPeerCN defaults to \"off\" in 2.2, while in 2.4 it is \"on\" (if you haven't encountered the issue with previous httpd releases, then this is why - or you might have used a release before 2.2.12, when it was added for 2.2).\n\nWe could implement this with code similar to the one added to ssl_engine_init.c:ssl_check_public_cert() with r1176752 (where it has a purely diagnostic purpose, though).", "id": 157153, "time": "2012-04-04T13:55:53Z", "creator": "asfbugz@velox.ch", "creation_time": "2012-04-04T13:55:53Z", "is_private": false, "attachment_id": null}, {"count": 2, "text": "I see.\n\nIt seems reasonable that it should be mentioned in the upgrade doc as this makes these vhosts stop working after upgrade.", "bug_id": 53006, "attachment_id": null, "id": 157155, "time": "2012-04-04T14:07:26Z", "creator": "petterb@gmail.com", "creation_time": "2012-04-04T14:07:26Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 53006, "is_private": false, "id": 157156, "time": "2012-04-04T14:09:51Z", "creator": "asfbugz@velox.ch", "creation_time": "2012-04-04T14:09:51Z", "tags": [], "text": "(In reply to comment #2)\n> It seems reasonable that it should be mentioned in the upgrade doc as this\n> makes these vhosts stop working after upgrade.\n\nIt is already - see second bullet at\n\nhttp://httpd.apache.org/docs/2.4/upgrading.html#misc"}, {"count": 4, "tags": [], "bug_id": 53006, "attachment_id": null, "id": 157157, "time": "2012-04-04T14:19:52Z", "creator": "petterb@gmail.com", "creation_time": "2012-04-04T14:19:52Z", "is_private": false, "text": "I know about that one (i actually triggered Humbedooh to add the last part ;)\n\nBut i don't think it's clear that a server with a valid wildcard certificate will stop working.\n\nThat would entail one knows SSLProxyCheckPeerCN does not acknowledge wildcard certificates.\n\n\nRelevant part of bullet point for reference:\nSSLProxyCheckPeerCN and SSLProxyCheckPeerExpire now default to On, causing proxy requests to HTTPS hosts with bad or outdated certificates to fail with a 502 status code (Bad gateway)"}, {"attachment_id": null, "tags": [], "bug_id": 53006, "is_private": false, "count": 5, "id": 157158, "time": "2012-04-04T14:32:33Z", "creator": "asfbugz@velox.ch", "creation_time": "2012-04-04T14:32:33Z", "text": "Ah, sorry for misinterpreting your previous comment. I think it would make sense to mention this limitation in both the upgrade docs and in the reference section about SSLProxyCheckPeerCN (http://httpd.apache.org/docs/2.4/mod/mod_ssl.html#sslproxycheckpeercn)."}, {"attachment_id": 29240, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "count": 6, "id": 161480, "time": "2012-08-17T12:55:29Z", "bug_id": 53006, "creation_time": "2012-08-17T12:55:29Z", "text": "Created attachment 29240\nmod_ssl wildcard proxy cn match\n\nCan you try this patch?"}, {"count": 7, "tags": [], "text": "Created attachment 29241\npatch v2\n\nThat had from an off-by-one.  Try this instead?", "is_private": false, "id": 161481, "creator": "jorton@redhat.com", "time": "2012-08-17T12:57:05Z", "bug_id": 53006, "creation_time": "2012-08-17T12:57:05Z", "attachment_id": 29241}, {"attachment_id": null, "tags": [], "creator": "petterb@gmail.com", "is_private": false, "count": 8, "id": 161487, "time": "2012-08-17T14:25:03Z", "bug_id": 53006, "creation_time": "2012-08-17T14:25:03Z", "text": "Works! :)\n\nI verified by commenting out the SSLProxyCheckPeerExpire directive - making the site fail. Patch, and voila, the site works again.\n\nEnabling the directive again has no apparent effect, as i expected."}, {"count": 9, "tags": [], "creator": "ybudweiser@gmail.com", "attachment_id": null, "is_private": false, "id": 161499, "time": "2012-08-17T15:10:37Z", "bug_id": 53006, "creation_time": "2012-08-17T15:10:37Z", "text": "Verified Working on 2.4.2! :)\nThanks!"}, {"count": 10, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "is_private": false, "id": 161561, "time": "2012-08-21T14:47:35Z", "bug_id": 53006, "creation_time": "2012-08-21T14:47:35Z", "text": "Thanks for testing it out.\n\nDone in r1375584."}, {"count": 11, "tags": [], "bug_id": 53006, "attachment_id": null, "id": 163073, "time": "2012-10-31T07:27:35Z", "creator": "asfbugz@velox.ch", "creation_time": "2012-10-31T07:27:35Z", "is_private": false, "text": "Backported to 2.4.x in r1388547 - to appear in 2.4.4."}, {"count": 12, "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "id": 165618, "time": "2013-03-03T16:56:42Z", "bug_id": 53006, "creation_time": "2013-03-03T16:56:42Z", "is_private": false, "text": "fixed in 2.4.4"}]
[{"count": 0, "attachment_id": null, "bug_id": 24677, "is_private": false, "id": 47292, "time": "2003-11-13T08:48:59Z", "creator": "gwo@sachsenlb.de", "creation_time": "2003-11-13T08:48:59Z", "tags": [], "text": "We wrote two own tasks (Task1 and Task2), which references another class \n(CounterHelper) with a static int member ( counter ).\n\nTask1's and Task2's execute methods create an instance of CounterHelper\nand increment it's static member counter. After this the value of\ncounter is sent to stdout. \n\n###############################################################################\n\npackage staticant;\n\nimport org.apache.tools.ant.Task;\n\npublic class Task1 extends Task {\n\n  public void execute(){\n\n    CounterHelper ch = new CounterHelper();\n    ch.incCounter();\n    System.out.println(\"Task1: \"+ ch.getCounter());\n  }\n}\n\n\npackage staticant;\n\nimport org.apache.tools.ant.Task;\n\npublic class Task2 extends Task {\n\n  public void execute(){\n\n    CounterHelper ch = new CounterHelper();\n    ch.incCounter();\n    System.out.println(\"Task2: \"+ ch.getCounter());\n\n  }\n}\n\n\npackage staticant;\n\npublic class CounterHelper {\n\n  protected static int counter = 0;\n\n  public CounterHelper() {\n  }\n\n  public int getCounter() {\n    return counter;\n  }\n\n  public void incCounter() {\n   counter++;\n  }\n\n\n  public void setCounter(int counter) {\n    this.counter = counter;\n  }\n\n}\n\n###############################################################################\n\nWe also created a suitable build.xml file like that:\n\n###############################################################################\n\n<?xml version=\"1.0\"?>\n<!DOCTYPE project>\n<project name=\"AntProject\" default=\"main2\" basedir=\".\">\n\n<taskdef name=\"mytask1\" classname=\"staticant.Task1\" classpath=\"classes\"/>\n<taskdef name=\"mytask2\" classname=\"staticant.Task2\" classpath=\"classes\"/>\n\n    <target name=\"main2\" depends=\"main\">\n        <mytask2/>\n    </target>\n\n     <target name=\"main\">\n        <mytask1/>\n    </target>\n\n</project>\n\n###############################################################################\n\nWe expected that during execution of target \"main\" CounterHelper.counter\nis set to value 1 and during execution of target \"main2\" CounterHelper.counter\nis then set to value 2.\n\nBut we got following result:\n\n\n###############################################################################\n\nBuildfile: build.xml\n\nmain:\n  [mytask1] Task1: 1\n\nmain2:\n  [mytask2] Task2: 1\n\nBUILD SUCCESSFUL\nTotal time: 4 seconds\n\n###############################################################################\n\n????????????\n\n\nAfter some terrible nights of \"try and error\" :)\nwe found, that the result depends on setting (or unsetting) of the\nCLASSPATH environment variable to our target task classes.\n\nIn the \"Feadback and Troubleshooting\" section we also read:\n\n\"Ant does not need the CLASSPATH variable defined to anything to work.\"\n\nSo we learned, that don't setting the CLASSPATH brings the result above and\nsetting the CLASSPATH like\n\nexport CLASSPATH=:classes //points to our target task classes\n\nwe got the following expected result:\n\nBuildfile: build.xml\n\nmain:\n  [mytask1] Task1: 1\n\nmain2:\n  [mytask2] Task2: 2\n\nBUILD SUCCESSFUL\nTotal time: 4 seconds\n\n\nWe tested this using ant version 1.5.1, 1.5.4 on Linux or using JBuilder on \nWindows got the same behaviour.\n\n\nWhat's going wrong?"}, {"count": 1, "attachment_id": 9087, "bug_id": 24677, "is_private": false, "id": 47293, "time": "2003-11-13T08:51:45Z", "creator": "gwo@sachsenlb.de", "creation_time": "2003-11-13T08:51:45Z", "tags": [], "text": "Created attachment 9087\nExample: Task1"}, {"count": 2, "tags": [], "bug_id": 24677, "attachment_id": 9088, "text": "Created attachment 9088\nExample: Task2", "id": 47294, "time": "2003-11-13T08:52:04Z", "creator": "gwo@sachsenlb.de", "creation_time": "2003-11-13T08:52:04Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 24677, "text": "Created attachment 9089\nExample: CounterHelper", "id": 47295, "time": "2003-11-13T08:52:30Z", "creator": "gwo@sachsenlb.de", "creation_time": "2003-11-13T08:52:30Z", "is_private": false, "attachment_id": 9089}, {"count": 4, "attachment_id": 9090, "creator": "gwo@sachsenlb.de", "text": "Created attachment 9090\nExample: build file", "id": 47296, "time": "2003-11-13T08:52:52Z", "bug_id": 24677, "creation_time": "2003-11-13T08:52:52Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 24677, "is_private": false, "id": 47297, "time": "2003-11-13T09:07:50Z", "creator": "peter.reilly@corvil.com", "creation_time": "2003-11-13T09:07:50Z", "tags": [], "text": "This is not a bug.\nThe two definitions use different classloaders, so the classes\nin each are different.\n\nAnt can be told to use the same classloader by using the loaderref\nattribute of the taskdef task.\n\n<taskdef name=\"mytask1\" classname=\"staticant.Task1\" classpath=\"classes\"\n         loaderref=\"x\"/>\n<taskdef name=\"mytask2\" classname=\"staticant.Task2\" loaderref= \"x\"/>\n\n"}]
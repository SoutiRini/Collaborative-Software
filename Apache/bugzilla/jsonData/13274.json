[{"count": 0, "tags": [], "creator": "ikeno@infoscience.co.jp", "attachment_id": null, "text": "I am sorry to be poor English.\n\nIn the site which used external rewrite_map,\nsubsequent requests are destroyed by the request exceeding 2048 bytes.\n\nURL-A : http://foo/...exceed..2048bytes/ (length: 2056bytes)\nURL-A1: http://foo/...exceed..20 (length: 2048bytes)\nURL-A2: 48bytes/ (length: 8bytes)\nURL-B : http://bar/cgi-bin/bar.cgi (length: 26bytes)\nURL-C : http://foobar/cgi-bin/barf.cgi (length: 30bytes)\n\nclient                httpd              rewrite_map\n  |                     |                     |\n  |One client           |                     |\n  |access URL-A         |                     |\n  |--------------->     |                     |\n  |                     |send URL-A by pipe   |\n  |                     |------------------>  |\n  |                     |                     |\n  |                     | return URL-A by pipe|\n  |                     |  <------------------|\n  |               read from pipe              |\n  |               maximum 2048 bytes          |\n  |                     |                     |\n  |  return URL-A1      |                     |\n  |  <------------------|                     |\n  |                     |                     |\n  |Another client1      |                     |\n  |access URL-B         |                     |\n  |--------------->     |                     |\n  |                     |send URL-B by pipe   |\n  |                     |------------------>  |\n  |                     |                     |\n  |                     | return URL-B by pipe|\n  |                     |  <------------------|\n  |                     |                     |\n  |               read from pipe              |\n  |               maximum 2048 bytes          |\n  |                     |                     |\n  |  !!!return URL-A2   |                     |\n  |  <------------------|                     |\n  |                     |                     |\n  |                     |                     |\n  |Another client2      |                     |\n  |access URL-C         |                     |\n  |--------------->     |                     |\n  |                     |                     |\n  |                 -- SNIP --                |\n  |                     |                     |\n  |  !!!return URL-B    |                     |\n  |  <------------------|                     |\n  |                     |                     |\n\n======================================================================\nA easy patch for Apache 1.3.26 is appended to the following.\n======================================================================\n*** mod_rewrite.c.org\tThu May 30 02:39:23 2002\n--- mod_rewrite.c\tFri Oct  4 12:28:44 2002\n***************\n*** 2896,2901 ****\n--- 2896,2902 ----\n      char buf[LONG_STRING_LEN];\n      char c;\n      int i;\n+ \tint found_lf = 0;\n  #ifndef NO_WRITEV\n      struct iovec iov[2];\n  #endif\n***************\n*** 2928,2938 ****\n--- 2929,2950 ----\n      i = 0;\n      while (read(fpout, &c, 1) == 1 && (i < LONG_STRING_LEN-1)) {\n          if (c == '\\n') {\n+ \t\t\tfound_lf = 1;\n              break;\n          }\n          buf[i++] = c;\n      }\n      buf[i] = '\\0';\n+ \n+ \t/* skip next lf */\n+ \tif( found_lf == 0 ){\n+ \t\trewritelog(r, 5, \"this request exceeded %ld bytes: cut[%s]\", \nLONG_STRING_LEN, buf );\n+ \t\twhile (read(fpout, &c, 1) == 1) {\n+ \t\t\tif (c == '\\n') {\n+ \t\t\t\tbreak;\n+ \t\t\t}\n+ \t\t}\n+ \t}\n  \n      /* give the lock back */\n      rewritelock_free(r);\n======================================================================", "id": 23882, "time": "2002-10-04T04:57:45Z", "bug_id": 13274, "creation_time": "2002-10-04T04:57:45Z", "is_private": false}, {"count": 1, "tags": [], "text": "Some path handling in mod_rewrite is made in static buffers of that length (and\nthe strings are simply cut off at the end). In nearly all cases this length is\nsufficient because of the maximum path length of the OS.\n\nHowever, I'm changing the status to 'assigned'. Someone needs to rewrite the\ncode to use the heap pools rather than the stack ...", "attachment_id": null, "id": 34895, "creator": "nd@perlig.de", "time": "2003-04-10T17:45:40Z", "bug_id": 13274, "creation_time": "2003-04-10T17:45:40Z", "is_private": false}]
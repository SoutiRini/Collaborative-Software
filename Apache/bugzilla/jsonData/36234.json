[{"count": 0, "tags": [], "text": "The following configuration causes a seg fault on Solaris 10 (sparc):\n\n--cut--\nNameVirtualHost *:80\n\n<VirtualHost *>\nServerName adminconsole.test.com\nDocumentRoot /opt/apache2/htdocs\nErrorLog logs/adminconsole.test.com-error_log\nCustomLog logs/adminconsole.test.com-access_log common\n</VirtualHost>\n\n<VirtualHost *>\nServerName control.test.com\nDocumentRoot /opt/apache2/htdocs\nErrorLog logs/control.test.com-error_log\nCustomLog logs/control.test.com-access_log common\n</VirtualHost>\n--cut--\n\nSome playing with the above configuration proves that it is only the last\n<VirtualHost *> entry that causes the core.  If <VirtualHost *:80>, or\n<VirutalHost hostname> is used for the last entry everything works as expected\nif using <VirtualHost *> in prior declarations.\n\nHere is a truss and map of the core:\n\n--cut--\n[root@core {SunOS 5.10} - (via 192.168.52.88)]\n[507] /opt/apache2/conf 7 truss /opt/apache2/bin/httpd -S\n--snip--\nstat(\"/opt/apache2/htdocs\", 0xFFBFF378)         = 0\nVirtualHost configuration:\nwrite(2, \" V i r t u a l H o s t  \".., 27)      = 27\nwildcard NameVirtualHosts and _default_ servers:\nwrite(2, \" w i l d c a r d   N a m\".., 49)      = 49\n*:*                    adminconsole.test.com (/opt/apache2/conf/httpd.conf:252)\nwrite(2, \" * : *                  \".., 80)      = 80\n*:*                    control.test.com (/opt/apache2/conf/httpd.conf:259)\nwrite(2, \" * : *                  \".., 75)      = 75\n    Incurred fault #6, FLTBOUNDS  %pc = 0x000364C4\n      siginfo: SIGSEGV SEGV_MAPERR addr=0x0000000C\n    Received signal #11, SIGSEGV [default]\n      siginfo: SIGSEGV SEGV_MAPERR addr=0x0000000C\n--cut--\n\n--cut--\n[root@core {SunOS 5.10} - (via localhost)]\n[547] /opt/apache2/conf 47 pmap core\ncore 'core' of 9410:    /opt/apache2/bin/httpd -S\n00010000     328K r-x--  /opt/apache2/bin/httpd\n00070000      24K rwx--  /opt/apache2/bin/httpd\n00076000     952K rwx--    [ heap ]\nFEA20000      56K r-x--  /opt/apache2/modules/mod_rewrite.so\nFEA3C000      16K rwx--  /opt/apache2/modules/mod_rewrite.so\nFEA50000       8K r-x--  /opt/apache2/modules/mod_alias.so\nFEA60000      16K rwx--  /opt/apache2/modules/mod_alias.so\nFEA70000       8K rwx--\nFEA80000       8K r-x--  /opt/apache2/modules/mod_dir.so\nFEA90000       8K rwx--  /opt/apache2/modules/mod_dir.so\nFEAA0000      32K r-x--  /opt/apache2/modules/mod_negotiation.so\nFEAB6000       8K rwx--  /opt/apache2/modules/mod_negotiation.so\nFEAC0000       8K r-x--  /opt/apache2/modules/mod_vhost_alias.so\nFEAD0000       8K rwx--  /opt/apache2/modules/mod_vhost_alias.so\nFEAE0000      32K r-x--  /opt/apache2/modules/mod_cgid.so\nFEAF6000       8K rwx--  /opt/apache2/modules/mod_cgid.so\nFEB00000      16K r-x--  /opt/apache2/modules/mod_info.so\nFEB12000       8K rwx--  /opt/apache2/modules/mod_info.so\nFEB20000       8K rwx--\nFEB30000       8K r-x--  /opt/apache2/modules/mod_asis.so\nFEB40000       8K rwx--  /opt/apache2/modules/mod_asis.so\nFEB50000      40K r-x--  /opt/apache2/modules/mod_autoindex.so\nFEB68000       8K rwx--  /opt/apache2/modules/mod_autoindex.so\nFEB70000      16K r-x--  /opt/apache2/modules/mod_mime.so\nFEB82000       8K rwx--  /opt/apache2/modules/mod_mime.so\nFEB90000       8K r-x--  /opt/apache2/modules/mod_setenvif.so\nFEBA0000       8K rwx--  /opt/apache2/modules/mod_setenvif.so\nFEBB0000       8K r-x--  /opt/apache2/modules/mod_unique_id.so\nFEBC0000       8K rwx--  /opt/apache2/modules/mod_unique_id.so\nFEBD0000       8K r-x--  /opt/apache2/modules/mod_expires.so\nFEBE0000       8K rwx--  /opt/apache2/modules/mod_expires.so\nFEBF0000       8K rwx--\nFEC00000      24K r-x--  /opt/apache2/modules/mod_mime_magic.so\nFEC14000      16K rwx--  /opt/apache2/modules/mod_mime_magic.so\nFEC20000       8K r-x--  /opt/apache2/modules/mod_env.so\nFEC30000       8K rwx--  /opt/apache2/modules/mod_env.so\nFEC40000      24K r-x--  /opt/apache2/modules/mod_log_config.so\nFEC54000       8K rwx--  /opt/apache2/modules/mod_log_config.so\nFEC60000      40K r-x--  /opt/apache2/modules/mod_include.so\nFEC78000       8K rwx--  /opt/apache2/modules/mod_include.so\nFEC80000       8K r-x--  /opt/apache2/modules/mod_auth.so\nFEC90000       8K rwx--  /opt/apache2/modules/mod_auth.so\nFECA0000       8K rwx--\nFECB0000       8K r-x--  /opt/apache2/modules/mod_access.so\nFECC0000       8K rwx--  /opt/apache2/modules/mod_access.so\nFECE0000       8K r-x--  /platform/sun4u-us3/lib/libc_psr.so.1\nFECF0000      24K rwx--\nFED00000     848K r-x--  /lib/libc.so.1\nFEDE4000      32K rwx--  /lib/libc.so.1\nFEDEC000       8K rwx--  /lib/libc.so.1\nFEE00000       8K r-x--  /lib/libmd5.so.1\nFEE12000       8K rwx--  /lib/libmd5.so.1\nFEE20000     240K r-x--  /lib/libresolv.so.2\nFEE6C000      16K rwx--  /lib/libresolv.so.2\nFEE80000     584K r-x--  /lib/libnsl.so.1\nFEF22000      40K rwx--  /lib/libnsl.so.1\nFEF2C000      24K rwx--  /lib/libnsl.so.1\nFEF40000      32K r-x--  /lib/libaio.so.1\nFEF58000       8K rwx--  /lib/libaio.so.1\nFEF60000      40K r-x--  /usr/sfw/lib/libgcc_s.so.1\nFEF78000       8K rwx--  /usr/sfw/lib/libgcc_s.so.1\nFEF80000     680K r-x--  /lib/libm.so.2\nFF038000      32K rwx--  /lib/libm.so.2\nFF050000       8K rwx--\nFF060000      48K r-x--  /lib/libsocket.so.1\nFF07C000       8K rwx--  /lib/libsocket.so.1\nFF090000       8K rwx--\nFF0A0000      24K r-x--  /lib/librt.so.1\nFF0B6000       8K rwx--  /lib/librt.so.1\nFF0C0000       8K r-x--  /lib/libsendfile.so.1\nFF0D2000       8K rwx--  /lib/libsendfile.so.1\nFF0E0000      16K r-x--  /usr/lib/libmtmalloc.so.1\nFF0F4000       8K rwx--  /usr/lib/libmtmalloc.so.1\nFF100000     120K r-x--  /opt/apache2/lib/libapr-0.so.0.9.6\nFF12C000      16K rwx--  /opt/apache2/lib/libapr-0.so.0.9.6\nFF140000     168K r-x--  /opt/apache2/lib/libexpat.so.0.1.0\nFF178000       8K rwx--  /opt/apache2/lib/libexpat.so.0.1.0\nFF180000    1240K r-x--  /opt/apache2/lib/libcrypto.so.0.9.8\nFF2C4000      88K rwx--  /opt/apache2/lib/libcrypto.so.0.9.8\nFF2DA000       8K rwx--  /opt/apache2/lib/libcrypto.so.0.9.8\nFF2F0000      80K r-x--  /opt/apache2/lib/libaprutil-0.so.0.9.6\nFF312000      16K rwx--  /opt/apache2/lib/libaprutil-0.so.0.9.6\nFF328000      16K r-x--  /lib/libpthread.so.1\nFF330000       8K rwx--\nFF340000     232K r-x--  /opt/apache2/lib/libssl.so.0.9.8\nFF388000      24K rwx--  /opt/apache2/lib/libssl.so.0.9.8\nFF3A0000       8K r-x--  /lib/libdl.so.1\nFF3B0000     176K r-x--  /lib/ld.so.1\nFF3EC000       8K rwx--  /lib/ld.so.1\nFF3EE000       8K rwx--  /lib/ld.so.1\nFFBFC000      16K rw---    [ stack ]\n total      6896K\n--cut--\n\nStack dump shows a problem in dump_a_vhost:\n\n--cut--\n[root@core {SunOS 5.10} - (via localhost)]\n[548] /opt/apache2/conf 48 pstack core\ncore 'core' of 9410:    /opt/apache2/bin/httpd -S\n 000364c4 dump_a_vhost (158c30, ffffe000, 400, 0, 5c800, 15c070) + 8c\n 00036d88 ap_fini_vhost_config (74c00, 5c400, a4078, 80, 74c00, 75000) + 7a4\n 00035ac4 main     (a20f0, a4078, ffbff8e0, 75e14, 1117e, 0) + 2d0\n 00025d94 _start   (0, 0, 0, 0, 0, 0) + 5c\n--cut--\n\nI'm using the latest vhost.c from HEAD.  More analysis shows that if ic=0,\ndump_a_vhost still has a problem at line 419 of vhost.c, here:\n\n--cut--\nif (ic->sar->host_port == 0) {\n        buf[len-1] = '*';\n    }\n--cut--\n\nThe following diff prevents the core, but I'm not sure it's correct overall:\n\n--cut--\ndiff\ndiff vhost.c vhost.c.2.0.54.orig\n1c1,2\n< /* Copyright 1999-2004 The Apache Software Foundation\n---\n> /* Copyright 1999-2005 The Apache Software Foundation or its licensors, as\n>  * applicable.\n184,187c185\n<         if (rv) {\n<             return \"Cannot not resolve address '0.0.0.0' -- \"\n<                 \"check resolver configuration.\";\n<         }\n---\n>         ap_assert(rv == APR_SUCCESS); /* must be bug or out of storage */\n192,195c190\n<         if (rv) {\n<             return \"Cannot resolve address '255.255.255.255' -- \"\n<                 \"check resolver configuration.\";\n<         }\n---\n>         ap_assert(rv == APR_SUCCESS); /* must be bug or out of storage */\n405d399\n<        printf(\"ic %i\\n\", ic);\n464,467c458\n<                               // Solaris core is here ... ERROR\n<                               // printf(\"ic %i\\n\", ic->next);\n<                               // only dump_a_vhost if ic->next is valid -jjt\n<                               if (ic->next != 0) dump_a_vhost(f, ic);\n---\n>             dump_a_vhost(f, ic);\n--cut--", "attachment_id": null, "bug_id": 36234, "id": 78614, "time": "2005-08-18T05:04:56Z", "creator": "jtingiris@bellsouth.net", "creation_time": "2005-08-18T05:04:56Z", "is_private": false}, {"count": 1, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of 27731 ***", "id": 94102, "time": "2006-09-26T07:42:25Z", "bug_id": 36234, "creation_time": "2006-09-26T07:42:25Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 16368, "is_private": false, "text": "It seems that some strange side effects happen if mod_rewrite is loaded before\nmod_proxy.\n\nI have the following in the httpd.conf:\n--- snip ---\nLoadModule rewrite_module modules/mod_rewrite.so\nLoadModule proxy_module modules/mod_proxy.so\n--- snap ---\n\nand the following in an .htaccess (cgi-perl/.htaccess):\n--- snip ---\nRewriteEngine   On\nRewriteRule     (.*)    http://192.168.111.111:8080/no/$1 [P]\n--- snap ---\n\nwhich produces an unexptected result for the request:\n http://127.0.0.1/cgi-perl/blah?world=reboot\n.\nIt sends an request \n http://192.168.111.111:8080/no/blah%3Fworld=reboot?world=reboot\n.\n\nThe the two LoadModule lines are exchanged so that mod_proxy is before\nmod_rewrite it works as expcted (request \nhttp://192.168.111.111:8080/no/blah?world=reboot is sent).\n\nI don't know if this is really an bug or intended (I see it a bit as bug).", "id": 29947, "time": "2003-01-23T16:05:59Z", "creator": "andre.breiler@rd.bbc.co.uk", "creation_time": "2003-01-23T16:05:59Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 16368, "is_private": false, "text": "\n  This is a bug, in that the Apache 2.0 hook mechanisms were designed to be\n  independent of LoadModule order.  That said, we are sure to find a few edge\n  cases like the one you've identified.\n\n  Thanks for the report!\n", "id": 29960, "time": "2003-01-23T17:58:49Z", "creator": "wrowe@apache.org", "creation_time": "2003-01-23T17:58:49Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 16368, "attachment_id": null, "text": "hmm, it looks like the fixup hooks of mod_rewrite and mod_proxy create the\nproblem (both HOOK_FIRST).\n\nfirst case:\nmod_rewrite runs first: create r->filename=proxy:http://foo/bar?baz\nmod_proxy runs afterwards: enode that url and append query (again):\nhttp://foo/bar%3Fbaz?baz\n-> proxy handler runs with the result\n\nsecond case:\nmod_proxy fixup runs empty (no proxy request)\nmod_rewrite creates r->filename=proxy:http://foo/bar?baz\n-> proxy handler runs with the result.\n\nWe can solve this for now by hooking mod_proxy fixup explicitely before\nmod_rewrite. But AFAICS we need some further research to handle all the proxy\nstuff more clean.\n\nOpinions?", "id": 30786, "time": "2003-02-05T23:57:20Z", "creator": "nd@perlig.de", "creation_time": "2003-02-05T23:57:20Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 16368, "attachment_id": null, "text": "Been there, done that.\nIt's fixed in HEAD (2.1) and proposed for backport.\n\nThanks for using Apache!", "id": 31548, "time": "2003-02-18T21:01:22Z", "creator": "nd@perlig.de", "creation_time": "2003-02-18T21:01:22Z", "is_private": false}, {"count": 4, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "is_private": false, "id": 31797, "time": "2003-02-22T20:32:10Z", "bug_id": 16368, "creation_time": "2003-02-22T20:32:10Z", "text": "The fix will appear in the next release (2.0.45)."}]
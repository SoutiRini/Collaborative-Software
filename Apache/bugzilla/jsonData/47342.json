[{"count": 0, "tags": [], "bug_id": 47342, "text": "ReplicatedContext#start throws NullPointerException.\n\ncontext.xml is as follows.\n<Context className=\"org.apache.catalina.ha.context.ReplicatedContext\" />\n\nWhen Tomcat is started, the following logs are output. \n\nJun 10, 2009 6:40:57 PM org.apache.catalina.ha.context.ReplicatedContext start\nSEVERE: Unable to start ReplicatedContext\njava.lang.NullPointerException\n    at java.io.File.<init>(Unknown Source)\n    at org.apache.catalina.core.StandardContext.getBasePath(StandardContext.java:4840)\n    at org.apache.catalina.ha.context.ReplicatedContext.start(ReplicatedContext.java:63)\n    at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:791)\n    at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:771)\n    at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:526)\n    at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:630)\n    at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:556)\n    at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:491)\n    at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1206)\n    at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:314)\n    at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1053)\n    at org.apache.catalina.core.StandardHost.start(StandardHost.java:722)\n    at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1045)\n    at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)\n    at org.apache.catalina.core.StandardService.start(StandardService.java:516)\n    at org.apache.catalina.core.StandardServer.start(StandardServer.java:710)\n    at org.apache.catalina.startup.Catalina.start(Catalina.java:583)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n    at java.lang.reflect.Method.invoke(Unknown Source)\n    at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)\n    at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)\n\n\nThis causes because docBase has not been initialized. \nI think that this solution for the problem is an addition of initialization to ReplicatedContext#start. \n\nI made a patch.\n\nIndex: java/org/apache/catalina/ha/context/ReplicatedContext.java\n===================================================================\n--- java/org/apache/catalina/ha/context/ReplicatedContext.java    (revision 763870)\n+++ java/org/apache/catalina/ha/context/ReplicatedContext.java    (working copy)\n@@ -51,6 +51,13 @@\n     @Override\n     public synchronized void start() throws LifecycleException {\n         if ( this.started ) return;\n+        if( !initialized ) { \n+            try {\n+                init();\n+            } catch( Exception ex ) {\n+                throw new LifecycleException(\"Error initializaing \", ex);\n+            }\n+        }\n         super.addLifecycleListener(this);            \n         try {\n             CatalinaCluster catclust = (CatalinaCluster)this.getCluster();\n\n\n\nRegards.", "id": 127779, "time": "2009-06-10T02:48:24Z", "creator": "fujino.keiichi@oss.ntt.co.jp", "creation_time": "2009-06-10T02:48:24Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 47342, "text": "I'm unable to replicate your use case, mostly cause it seems as the className attribute is ignored on the conf/context.xml element", "id": 128062, "attachment_id": null, "creator": "fhanik@apache.org", "creation_time": "2009-06-18T11:16:14Z", "time": "2009-06-18T11:16:14Z", "is_private": false}, {"count": 2, "tags": [], "creator": "fujino.keiichi@oss.ntt.co.jp", "is_private": false, "text": "(In reply to comment #1)\n> I'm unable to replicate your use case, mostly cause it seems as the className\n> attribute is ignored on the conf/context.xml element\n\nI'm so sorry in the insufficient explanation. \nTo reproduce this bug\nIt is necessary to set ReplicatedContext to <<contextName>>.xml of conf/Catalina/localhost/directory. \nIt is not conf/context.xml. \n\nIMHO,\nI think that className attribute is ignored in conf/context.xml. \n\nBecause\ncontext instance is created by deployXXXX method of HostConfig.\nand\nThe ContextRuleSet created by ContextConfig(parse conf/context.xml) is as follows. \n  RuleSet contextRuleSet = new ContextRuleSet(\"\", false);\n  \nWhen boolean of the second argument is false, context instance is not created by Digester. \nAs a Result, \nObjectCreateRule to className attribute of Context is not added.", "id": 128072, "time": "2009-06-18T23:56:22Z", "bug_id": 47342, "creation_time": "2009-06-18T23:56:22Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Thanks for the patch.\n\nThe patch has been applied to trunk (although other changes in trunk mean the\nNPE doesn't occur) and has been proposed for 6.0.x.", "attachment_id": null, "id": 132507, "creator": "markt@apache.org", "time": "2009-11-30T16:39:23Z", "bug_id": 47342, "creation_time": "2009-11-30T16:39:23Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 47342, "text": "The patch has been applied to 6.0.x and will be included in 6.0.21 onwards.\n\nAgain, many thanks for your work on this issue.", "id": 132838, "time": "2009-12-15T11:05:46Z", "creator": "markt@apache.org", "creation_time": "2009-12-15T11:05:46Z", "is_private": false, "attachment_id": null}]
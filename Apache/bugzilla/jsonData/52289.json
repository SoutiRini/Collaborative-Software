[{"attachment_id": 28030, "tags": [], "creator": "ringerc@ringerc.id.au", "text": "Created attachment 28030\nFop font loading log\n\nFop appears to be misclassifying the font faces I have.\n\nI'm loading the fonts by having fop scan the directory they're in using the <fonts><directory> config param and it's finding them fine. However, Fop doesn't seem to be able to tell the difference between the condensed and non-condensed faces of these fonts. It also seems to think they all have the same weight (400) as per the log excerpts below.\n\nHere's an excerpt of the log output from fop where it detects the fonts. The full log is at  http://pastebin.com/91u9bW10 . You can see that it seems unable to distinguish the weights or how condensed they are:\n\nRegistering: HelveticaNeueLT Std Cn,normal,400 under F17\nHelveticaNeueLT Std Cn,normal,400: Replacing HelveticaNeueLTStd-BdCn (priority=23) by HelveticaNeueLTStd-Cn (priority=21)\nRegistering: HelveticaNeueLTStd-BlkCn,normal,400 under F18\nRegistering: Helvetica Neue LT Std,normal,400 under F18\nHelvetica Neue LT Std,normal,400: Not replacing HelveticaNeueLTStd-Cn (priority=21) by HelveticaNeueLTStd-BlkCn (priority=24)\nRegistering: HelveticaNeueLT Std Blk Cn,normal,400 under F18\n\nBy contrast, fontconfig identifies them as I'd expect:\n\n$ fc-list | grep Neue\nHelvetica Neue LT Std:style=55 Roman,Regular\nHelvetica Neue LT Std,HelveticaNeueLT Std Cn:style=57 Condensed,Regular\nHelvetica Neue LT Std,HelveticaNeueLT Std Blk Cn:style=97 Black Condensed,Regular\nHelvetica Neue LT Std,HelveticaNeueLT Std Cn:style=77 Bold Condensed,Bold\n \nThese were originally OpenType fonts with CFF outlines; they were converted to TrueType using FontForge. They behave as expected with other tools including FontConfig and can be used normally in apps.\n\nAs these are commercial fonts I can't attach them to this bug report directly, but I can lend them to anyone who needs them for testing purposes *only*. You know how it is with font foundries.", "count": 0, "id": 151988, "time": "2011-12-06T03:18:19Z", "bug_id": 52289, "creation_time": "2011-12-06T03:18:19Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "ringerc@ringerc.id.au", "is_private": false, "count": 1, "id": 151993, "time": "2011-12-06T03:44:28Z", "bug_id": 52289, "creation_time": "2011-12-06T03:44:28Z", "text": "See also https://issues.apache.org/bugzilla/show_bug.cgi?id=52290, which\nrelates to misclassification of some condensed faces. Since fop seems to be\nhaving trouble detecting the font weights too, this might not really be\nrelated, but it's worth seeing."}, {"count": 2, "tags": [], "creator": "ringerc@ringerc.id.au", "attachment_id": null, "is_private": false, "id": 151996, "time": "2011-12-06T07:30:39Z", "bug_id": 52289, "creation_time": "2011-12-06T07:30:39Z", "text": "It looks like the DejaVu fonts work better, but still not quite right:\n\n15:09:30,926 FINE  [org.apache.fop.fonts.FontInfo] (pool-8-thread-1) DejaVu Sans,italic,700: Replacing DejaVu Sans Condensed Bold Oblique (priority=23) by DejaVu Sans Bold Oblique (priority=13)\n15:09:30,974 FINE  [org.apache.fop.fonts.FontInfo] (pool-8-thread-1) DejaVu Sans,normal,700: Not replacing DejaVu Sans Bold (priority=5) by DejaVu Sans Condensed Bold (priority=15)\n15:09:31,008 FINE  [org.apache.fop.fonts.FontInfo] (pool-8-thread-1) DejaVu Serif,italic,700: Replacing DejaVu Serif Condensed Bold Italic (priority=22) by DejaVu Serif Bold Italic (priority=12)\n15:09:31,041 FINE  [org.apache.fop.fonts.FontInfo] (pool-8-thread-1) DejaVu Serif,italic,400: Replacing DejaVu Serif Condensed Italic (priority=17) by DejaVu Serif Italic (priority=7)\n15:09:31,084 FINE  [org.apache.fop.fonts.FontInfo] (pool-8-thread-1) DejaVu Sans,italic,400: Not replacing DejaVu Sans Oblique (priority=8) by DejaVu Sans Condensed Oblique (priority=18)\n15:09:31,141 FINE  [org.apache.fop.fonts.FontInfo] (pool-8-thread-1) DejaVu Serif,normal,400: Replacing DejaVu Serif Condensed (priority=10) by DejaVu Serif (priority=0)\n15:09:31,192 FINE  [org.apache.fop.fonts.FontInfo] (pool-8-thread-1) DejaVu Sans,normal,400: Not replacing DejaVu Sans (priority=0) by DejaVu Sans Condensed (priority=10)\n15:09:31,237 FINE  [org.apache.fop.fonts.FontInfo] (pool-8-thread-1) DejaVu Serif,normal,700: Not replacing DejaVu Serif Bold (priority=5) by DejaVu Serif Condensed Bold (priority=15)\n\nThat said, the DejaVu fonts contain detailed face names, so fop registers them with the full face name as an alternate family name, eg DejaVuSerifCondensed-Bold is registered as \"DejaVuSerifCondensed-Bold,normal,400\". This font can be selected by full name, providing a workaround for the lack of font-stretch without requiring manual registration of fonts. It's a bit of a hack and doesn't permit you to do things like say \"I want Helvetica Condensed\" then apply selective bold/italic styling and have the right face picked, though; you always have to specify the full explicit font name."}, {"count": 3, "tags": [], "bug_id": 52289, "text": "This looks like it might be partly by design.\n\nIt seems fop registers a font more than once. It'll register the \"most preferred\" face for a family under the general family name, but it'll also always register each exact face under:\n\n  font-family=\"TheExactFaceName\" font-style=\"normal\" font-weight=\"normal\"\n\nso eg if you have MyriadPro-BlackIt.ttf (with the same face name as the file name, sans extension) fop will register something like:\n\n  font-family=\"MyriadPro\" font-style=\"italic\" font-weight=\"900\"\n  font-family=\"MyriadPro-BlackIt\" font-style=\"normal\" font-weight=\"normal\"\n\nI was only seeing the exact-face-name registrations, which are very confusing.\n\nThere is a legitimate bug here, in that fop will always prefer a non-condensed face to a condensed face when registering for a (family,weight,slant) tuple, so there's no way to select how condensed you want a font based on (family,weight,slant,condensed), you have to specify the exact face name as illustrated in bug #52290 . That's more of a feature request than a bug, though - a way for fop to store and record information about how condensed a font is.", "id": 152180, "time": "2011-12-15T07:25:17Z", "creator": "ringerc@ringerc.id.au", "creation_time": "2011-12-15T07:25:17Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "ringerc@ringerc.id.au", "text": "Please flag as importance: enhancement", "count": 4, "id": 152182, "time": "2011-12-15T07:26:33Z", "bug_id": 52289, "creation_time": "2011-12-15T07:26:33Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 52289, "text": "resetting P2 open bugs to P3 pending further review", "id": 157379, "time": "2012-04-07T01:42:09Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:42:09Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 52289, "is_private": false, "text": "not a bug; use font configuration features to select desired font", "id": 157749, "time": "2012-04-09T18:58:23Z", "creator": "gadams@apache.org", "creation_time": "2012-04-09T18:58:23Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "gadams@apache.org", "is_private": false, "count": 7, "id": 158582, "time": "2012-04-30T00:15:02Z", "bug_id": 52289, "creation_time": "2012-04-30T00:15:02Z", "text": "batch transition resolved+wontfix to closed+wontfix"}, {"count": 8, "tags": [], "creator": "gadams@apache.org", "attachment_id": null, "text": "batch transition resolved+wontfix to closed+wontfix; if you believe this remains a bug and can demonstrate it with appropriate input FO file and output PDF file (as applicable), then you may reopen", "id": 158627, "time": "2012-04-30T00:17:23Z", "bug_id": 52289, "creation_time": "2012-04-30T00:17:23Z", "is_private": false}]
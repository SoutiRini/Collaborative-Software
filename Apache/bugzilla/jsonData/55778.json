[{"count": 0, "tags": [], "text": "Whenever i try to authenticate with GSSAPI to a LDAP server with a SSL connection (ldaps), the following exception is thrown:\n\njavax.naming.ServiceUnavailableException: myserver.at:636; socket closed; remaining name 'dc=example,dc=org'\n    at com.sun.jndi.ldap.Connection.readReply(Connection.java:452)\n    at com.sun.jndi.ldap.LdapClient.getSearchReply(LdapClient.java:631)\n    at com.sun.jndi.ldap.LdapClient.search(LdapClient.java:554)\n    at com.sun.jndi.ldap.LdapCtx.doSearch(LdapCtx.java:1985)\n    at com.sun.jndi.ldap.LdapCtx.searchAux(LdapCtx.java:1847)\n    at com.sun.jndi.ldap.LdapCtx.c_search(LdapCtx.java:1772)\n    ...\n\nSteps to reproduce:\n1. Configure the valve org.apache.catalina.authenticator.SpnegoAuthenticator in the server.xml with storeDelegatedCredential=\"true\".\n2. Configure the realm org.apache.catalina.realm.JNDIRealm in the server.xml with an SSL connection url (e.g. ldaps://myserver.at:636)\n3. Configure an auth-method with SPNEGO, security-constraints and security-roles in the web.xml\n4. Add required keystores to the jdk for the ldaps connection.\n5. Try to authenticate\n\nI debugged into the JNDIRealm and figured out, that changing line 2082 from \"context.addToEnvironment(\"javax.security.sasl.qop\", \"auth-conf\");\" to \"context.addToEnvironment(\"javax.security.sasl.qop\", \"auth\");\" would solve the problem. I also tested the fix with a new written JNDIRealm.\n\nBut i'm not sure, if this fix causes other security issues.", "is_private": false, "id": 171220, "creator": "gerald.kritzinger@oenb.at", "time": "2013-11-14T14:51:16Z", "bug_id": 55778, "creation_time": "2013-11-14T14:51:16Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 55778, "text": "It is safe to reduce that to auth when using SSL as SSL should take care of the integrity and confidentiality issues. However, it might not be appropriate to do that in all scenarios.\n\nTo address this bug I have added (yet) another option to the JNDI Realm - spengoDelegationQop. It defaults to the current \"auth-conf\".\n\nThis change has been applied to trunk and 7.0.x and will be included in 8.0.0-RC6 and 7.0.48 onwards.", "id": 171249, "time": "2013-11-15T18:30:19Z", "creator": "markt@apache.org", "creation_time": "2013-11-15T18:30:19Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 55778, "is_private": false, "id": 171281, "attachment_id": null, "creator": "gerald.kritzinger@oenb.at", "creation_time": "2013-11-18T07:14:21Z", "time": "2013-11-18T07:14:21Z", "text": "Thanks for the fast fix."}, {"count": 3, "tags": [], "bug_id": 55778, "attachment_id": null, "text": "(In reply to Mark Thomas from comment #1)\n\n> To address this bug I have added (yet) another option to the JNDI Realm -\n> spengoDelegationQop. It defaults to the current \"auth-conf\".\n\ns/spengoDelegationQop/spnegoDelegationQop/", "id": 171282, "time": "2013-11-18T08:07:31Z", "creator": "markt@apache.org", "creation_time": "2013-11-18T08:07:31Z", "is_private": false}]
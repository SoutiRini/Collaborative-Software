[{"count": 0, "text": "WsRemoteEndpointImplBase.sendBinary is not synchronized. And there's no way to detect the state outside.\n\nclient -> server -> client -> server\n\nThe second time client call sendBinary may fail due to the race condition of stateMachine.binaryStart and stateMachine.complete\n\njava.lang.IllegalStateException: The remote endpoint was in state [BINARY_FULL_WRITING] which is an invalid state for called method\n\tat org.apache.tomcat.websocket.WsRemoteEndpointImplBase$StateMachine.checkState(WsRemoteEndpointImplBase.java:1148)\n\tat org.apache.tomcat.websocket.WsRemoteEndpointImplBase$StateMachine.binaryStart(WsRemoteEndpointImplBase.java:1101)\n\tat org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendBytes(WsRemoteEndpointImplBase.java:131)\n\tat org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendBinary(WsRemoteEndpointBasic.java:43)", "bug_id": 57894, "attachment_id": null, "id": 182849, "time": "2015-05-05T16:29:49Z", "creator": "yaoweizhi@gmail.com", "creation_time": "2015-05-05T16:29:49Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 57894, "text": "The client knows that it called sendBinary() and that that call has not returned. The client therefore *does* know that it should not make another call to sendBinary(). Keeping track of all of this is a client responsibility. (If you want to change that, lobby the WebSocket EG).\n\nNote the Javadoc for RemoteEndpoint.Basic:\nfile:///D:/specs/tc8/ws/ws-jsr-356-1.1-final-javadoc/javax/websocket/RemoteEndpoint.Basic.html", "id": 182851, "time": "2015-05-05T19:12:53Z", "creator": "markt@apache.org", "creation_time": "2015-05-05T19:12:53Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "(In reply to Mark Thomas from comment #1)\n> Note the Javadoc for RemoteEndpoint.Basic:\n> file:///D:/specs/tc8/ws/ws-jsr-356-1.1-final-javadoc/javax/websocket/\n> RemoteEndpoint.Basic.html\n\nThis link might work a little better:\nhttp://download.oracle.com/otndocs/jcp/websocket-1_1-mrel-spec/index.html", "attachment_id": null, "id": 182852, "creator": "chuck.caldarale@unisys.com", "time": "2015-05-05T19:28:51Z", "bug_id": 57894, "creation_time": "2015-05-05T19:28:51Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 57894, "attachment_id": null, "id": 182853, "time": "2015-05-05T19:30:51Z", "creator": "chuck.caldarale@unisys.com", "creation_time": "2015-05-05T19:30:51Z", "is_private": false, "text": "(In reply to Chuck Caldarale from comment #2)\n> (In reply to Mark Thomas from comment #1)\n> > Note the Javadoc for RemoteEndpoint.Basic:\n> > file:///D:/specs/tc8/ws/ws-jsr-356-1.1-final-javadoc/javax/websocket/\n> > RemoteEndpoint.Basic.html\n> \n> This link might work a little better:\n> http://download.oracle.com/otndocs/jcp/websocket-1_1-mrel-spec/index.html\n\nThe above is for the entire JSR 356; for the online specific reference:\nhttp://docs.oracle.com/javaee/7/api/javax/websocket/RemoteEndpoint.Basic.html"}]
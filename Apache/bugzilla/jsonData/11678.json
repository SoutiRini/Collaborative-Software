[{"count": 0, "tags": [], "bug_id": 11678, "attachment_id": null, "id": 21000, "time": "2002-08-14T00:17:01Z", "creator": "jemiller@uchicago.edu", "creation_time": "2002-08-14T00:17:01Z", "is_private": false, "text": "I noticed that if you protect a resource using JNDIRealm and BASIC \nauthentication after you are prompted for user name and password and \nsuccessfully authenticate, if you wait awhile and then refresh the page (or \nview another page that is protected), it will prompt you for a password again. \nIt appears to time out after about 2 or 3 minutes.\n\nI'm using Tomcat 4.1.9.\n\nI'm using this in my server.xml,\n\n<Realm className=\"org.apache.catalina.realm.JNDIRealm\"\ndebug=\"99\"\nconnectionURL=\"ldap://localhost:8636\"\nconnectionName=\"\"\nconnectionPassword=\"\"\nuserPattern=\"uid={0}, ou=People, dc=uchicago, dc=edu\"\nuserRoleName=\"eduPersonAffiliation\"/>\n\nand this in my web.xml,\n\n<security-constraint>\n<web-resource-collection>\n<web-resource-name>Orientation Registration</web-resource-name>\n<url-pattern>/servlet/OrientationRegistration</url-pattern>\n<url-pattern>/servlet/OrientationRegistration/*</url-pattern>\n</web-resource-collection>\n<auth-constraint>\n<role-name>faculty</role-name>\n<role-name>staff</role-name>\n<role-name>student</role-name>\n</auth-constraint>\n</security-constraint>\n<login-config>\n<auth-method>BASIC</auth-method>\n<realm-name>The University of Chicago Directory</realm-name>\n</login-config>\n\nNote, this behavior does not occur when I use MemoryRealm instead."}, {"count": 1, "tags": [], "creator": "nagrajhc@yahoo.com", "text": "I've noticed this bug with tomcat 4.1.12 as well. I believe this is because the \nldap server timesout the connection after some time if there is no activity \nfrom the ldap client. Once the timeout occurs, if a user tries to browse a url \nthat requires authentication, the bind operation in ldap fails as ldap \nconnection is invalid and JNDIRealm class throws a \njavax.naming.CommunicationException. This results in authentication failure and \nuser is prompted for authentication again. This is quite irritating to the \nuser. When user types in uid/password second time, a new ldap connection is \ncreated and authentication succeeds.\n\nI think the solution is to detect ldap connection timeout in JNDIRealm and make \na new connection if necessary and then perform the bind for authentication. \nHope this bug gets fixed.\n\n-nagraj", "id": 24235, "attachment_id": null, "bug_id": 11678, "creation_time": "2002-10-09T20:21:10Z", "time": "2002-10-09T20:21:10Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 11678, "attachment_id": null, "id": 24236, "time": "2002-10-09T20:33:52Z", "creator": "jemiller@uchicago.edu", "creation_time": "2002-10-09T20:33:52Z", "is_private": false, "text": "Another problem is that I'm pretty sure that if you use BASIC authentication \nrather than session based authentication, it doesn't do any caching which \nmeans that everytime you access a protected resource, it authenticates against \nthe LDAP directory which isn't a very efficient thing to do.\n"}, {"count": 3, "tags": [], "bug_id": 11678, "attachment_id": null, "is_private": false, "id": 31094, "time": "2003-02-11T22:46:33Z", "creator": "jemiller@uchicago.edu", "creation_time": "2003-02-11T22:46:33Z", "text": "Is anyone going to fix this? It's a shame that 99% of the functionality is \nthere and yet it's completely unusable because of this bug.\n"}, {"count": 4, "tags": [], "bug_id": 11678, "attachment_id": null, "text": "It looks as if code is in JNDIRealm.java to deal with this issue as of about \nTomcat 4.1.19 or so.  (JNDIRealm 1.11).  But, there was a NullPointerException \ncausing that code not to work, at least against certain LDAP Servers.  (See bug \n# 19864).  Hopefully that (and therefore this) will be fixed very soon.", "id": 42114, "time": "2003-08-04T23:57:28Z", "creator": "jtulley@novell.com", "creation_time": "2003-08-04T23:57:28Z", "is_private": false}, {"count": 5, "attachment_id": null, "creator": "funkman@joedog.org", "text": "Patched in HEAD of 4.1. Please test and so I may port to 5.", "id": 42119, "time": "2003-08-05T00:58:39Z", "bug_id": 11678, "creation_time": "2003-08-05T00:58:39Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "creator": "info_issues.apache.org@nmhq.net", "text": "I tried to use\n\n    <copy tofile=\"${dir}/somefile\">\n        <first>\n            <sort>\n                <exists/>\n                <resources>\n                    <fileset file=\"${dir}/somefile\"/>\n                    <string value=\"default contents\"/>\n                </resources>\n            </sort>\n        </first>\n    </copy>\n\nwithin a macrofed to conditionally generate somefile in ${dir} if it doesn't exists already. This fails in the <string> case with the error message\" Only FileSystem resources are supported when concatenating files.\"\n\nStrangely, when using <concat> instead of <copy>, the <string> case works. But the <fileset> case then fails, because <concat> isn't capable of copying a file onto itself (\"Destination resource ... was specified as an input resource\").\n\nI can't use properties to control the condition because it's in a macrodef, and the properties would persist between macro invocations.", "id": 139115, "time": "2010-08-16T12:49:23Z", "bug_id": 49756, "creation_time": "2010-08-16T12:49:23Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "Just some notes - regardless of whether there is a bug or not:\n\nI think your usage of sort is wrong for what you are trying to do, in the case\nwhere the file exists, both resources compare equal and I don't think Ant\nmakes any guarantee as to which one will come out first.\n\nIf the file doesn't exist, it is considered smaller than the string (according\nto the manual, haven't checked the code) and thus would come before the string.\n\nYou probably want something like\n\n    <copy tofile=\"${dir}/somefile\">\n        <first>\n            <union>\n                <restrict>\n                    <exists/>\n                    <fileset file=\"${dir}/somefile\"/>\n                </restrict>\n                <string value=\"default contents\"/>\n            </union>\n        </first>\n    </copy>\n\nRe: properties in macrodef - take a look at the local task.", "is_private": false, "id": 139133, "creator": "bodewig@apache.org", "time": "2010-08-17T05:57:57Z", "bug_id": 49756, "creation_time": "2010-08-17T05:57:57Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 49756, "attachment_id": null, "is_private": false, "id": 139134, "time": "2010-08-17T06:23:15Z", "creator": "bodewig@apache.org", "creation_time": "2010-08-17T06:23:15Z", "text": "OK, this is not really a bug, it is expected behaviour.\n\nWhen you use the tofile attribute, only file system resources are supported.\nNot that I'd see any good reason why tofile couldn't work with arbitrary\nresources, but it is the way it is - I'll change this to an enhancement request\nlater.\n\nThe documentation even says so if you are willing to read it that way (no, it is\nnot clear and I'll change that as well):\n\n> To use a resource collection, the todir attribute must be set.\n\nIn your case you want to do something like\n\n<copy todir=\"${dir}\">\n  <mergemapper to=\"somefile\"/>\n  ...\n</copy>"}, {"count": 3, "tags": [], "bug_id": 49756, "attachment_id": null, "text": "documentation has been clarified with svn revision 986261", "id": 139135, "time": "2010-08-17T06:28:43Z", "creator": "bodewig@apache.org", "creation_time": "2010-08-17T06:28:43Z", "is_private": false}, {"count": 4, "tags": [], "text": "implemented with svn revision 986290", "is_private": false, "id": 139136, "creator": "bodewig@apache.org", "time": "2010-08-17T08:23:33Z", "bug_id": 49756, "creation_time": "2010-08-17T08:23:33Z", "attachment_id": null}]
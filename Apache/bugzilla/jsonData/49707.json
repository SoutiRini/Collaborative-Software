[{"count": 0, "tags": [], "text": "In the method \"setAttributeNS\" of the class \"AbstractElement\":\n\n- the 2nd argument \"qualifiedName\" is supposed to be a qualified name\n- a call to \"getAttributeNodeNS\" use the argument \"qualifiedName\"\n- a call to \"createAttributeNS\" use the argument \"qualifiedName\"\n\nThe problem is that \"getAttributeNodeNS\" requires a local name (and not a qualified name).\n\nSo, when I give a qualified name as second argument to \"setAttributeNS\",\nthe serach made by \"getAttributeNodeNS\" always return null (even when the attribute already exists).", "is_private": false, "bug_id": 49707, "id": 138896, "time": "2010-08-05T05:15:12Z", "creator": "jfm@macqel.eu", "creation_time": "2010-08-05T05:15:12Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 49707, "is_private": false, "text": "(In reply to comment #0)\n> In the method \"setAttributeNS\" of the class \"AbstractElement\":\n\nThe relevant documentation can be found online (Batik class [1] which implements a W3C DOM interface [2]).\n\n\n> So, when I give a qualified name as second argument to \"setAttributeNS\",\n> the serach made by \"getAttributeNodeNS\" always return null (even when the\n> attribute already exists).\n\nYou seem to be using distinct DOM interfaces to achieve apparently related results...? (It seems like you'd want to use \"getAttributeNS\" [1] instead.)\n\nPlease check the proper documentation and confirm if the above makes sense (maybe marking the issue as invalid), or please try to add more information. ;-)\n\n\n[1] http://xmlgraphics.apache.org/batik/javadoc/org/apache/batik/dom/AbstractElement.html#getAttributeNodeNS%28java.lang.String,%20java.lang.String%29\n[2] http://www.w3.org/2003/01/dom2-javadoc/org/w3c/dom/Element.html#getAttributeNodeNS_java.lang.String__java.lang.String_", "id": 139264, "time": "2010-08-19T19:01:21Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-08-19T19:01:21Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "jfm@macqel.eu", "attachment_id": null, "is_private": false, "id": 139273, "time": "2010-08-20T01:31:35Z", "bug_id": 49707, "creation_time": "2010-08-20T01:31:35Z", "text": "I do not understand your comment.\nHere another way of explaining what I found in your code.\n\nYOUR code in the library is:\n    public void setAttributeNS(String namespaceURI,\n                               String qualifiedName,\n                                      ^^^^^^^^^^^^^^\nyou want a QUALIFIED name as 2nd argument; ok that is as in W3C DOM documentation\n                               String value) throws DOMException {\n\n        if (attributes == null) {\n            attributes = createAttributes();\n        }\n        if (namespaceURI != null && namespaceURI.length() == 0) {\n            namespaceURI = null;\n        }\n        Attr attr = getAttributeNodeNS(namespaceURI, qualifiedName);\n                                                     ^^^^^^^^^^^^^\nHere you give a QUALIFIED name as argument but as explained in the  online documentation, getAttributeNodeNS NEED a LOCAL name. So you have the incorrect behaviour I have explained in my first comment\n\n        if (attr == null) {\n            attr = getOwnerDocument().createAttributeNS(namespaceURI,\n                                                        qualifiedName);\n            attr.setValue(value);\n            attributes.setNamedItemNS(attr);\n        } else {\n            attr.setValue(value);\n        }\n    }"}, {"count": 3, "tags": [], "creator": "deweese@apache.org", "attachment_id": null, "id": 139279, "time": "2010-08-20T07:35:19Z", "bug_id": 49707, "creation_time": "2010-08-20T07:35:19Z", "is_private": false, "text": "(In reply to comment #2)\n\n> YOUR code in the library is:\n>     public void setAttributeNS(String namespaceURI,\n>                                String qualifiedName,\n>                                       ^^^^^^^^^^^^^^\n> you want a QUALIFIED name as 2nd argument; ok that is as in W3C DOM\n> documentation\n\n>         Attr attr = getAttributeNodeNS(namespaceURI, qualifiedName);\n>                                                      ^^^^^^^^^^^^^\n> Here you give a QUALIFIED name as argument but as explained in the  online\n> documentation, getAttributeNodeNS NEED a LOCAL name.\n\n   I agree that this line is in error.  We should pass the localName\nhere, however\n\n> So you have the incorrect behaviour I have explained in my first comment\n\n   This I don't follow.  The call to getAttributeNodeNS will fail \nreturning null, but that simply means that we create a new attribute\nnode which might be inefficient but wouldn't make getAttributeNodeNS\nfail for you."}, {"count": 4, "attachment_id": null, "bug_id": 49707, "is_private": false, "id": 139281, "time": "2010-08-20T08:06:27Z", "creator": "jfm@macqel.eu", "creation_time": "2010-08-20T08:06:27Z", "tags": [], "text": "The bug I encountered that is a consequence of the mistake in AbstractElement.setAttributeNS is quite complex\n\n- when I said that \"getAttributeNodeNS\" failed, it is the one in your code, not in my code\n\n- You say your code create a new attribute for me. Yes, but so I have as a result two attributes with the same name?\n\n- In my code, the bug arise when the attribute is an Id attribute like (xml:id).\nThe consequence of your error was that the map 'elementsById' in your class \"AbstractDocument\" was not well updated. Finally, my call to \"getElementById\" on the document gave bad results.\n\n\nAnyway, I suppose you will fix the agreed error in \"setAttributeNS\"?\n\nOtherwise I would make a test like that:\n- create a document D with an element E with attribute xml:id=\"id1\"\n- then I would call: E.setAttributeNS( ..., \"xml:id\", \"id2\");\n- and finally I would test the result of a call to D.getElementById(\"id1\") \nGuess it is non null and return elt E?\n\n\nThanks for your support."}, {"count": 5, "tags": [], "creator": "deweese@apache.org", "attachment_id": null, "id": 139336, "time": "2010-08-22T11:14:05Z", "bug_id": 49707, "creation_time": "2010-08-22T11:14:05Z", "is_private": false, "text": "(In reply to comment #4)\n> The bug I encountered that is a consequence of the mistake in\n\n> - You say your code create a new attribute for me. Yes, but so I have as a\n> result two attributes with the same name?\n\n   No the new value replaces the old value.\n\n> - In my code, the bug arise when the attribute is an Id attribute like\n> (xml:id).\n> The consequence of your error was that the map 'elementsById' in your class\n> \"AbstractDocument\" was not well updated. Finally, my call to \"getElementById\"\n> on the document gave bad results.\n\n    Have to tried your test with the current SVN version of Batik?\nI can't reproduce your bug as described below with it.  I ask because\nthe code in the 'wrong' branch could just as easily be done by users\n(similar calls are available in the public DOM) in which case this \nwould fail for them as well, so this bug is more serious than the\nperformance issue.\n\n> Anyway, I suppose you will fix the agreed error in \"setAttributeNS\"?\n\n    Yes, but I want to make sure that you agree that the xml:id bug is\nfixe in current SVN first, otherwise this simply hides the real bug.\n\n> \n> Otherwise I would make a test like that:\n> - create a document D with an element E with attribute xml:id=\"id1\"\n> - then I would call: E.setAttributeNS( ..., \"xml:id\", \"id2\");\n> - and finally I would test the result of a call to D.getElementById(\"id1\") \n> Guess it is non null and return elt E?\n\n    This doesn't happen for me with current SVN Batik."}, {"count": 6, "tags": [], "bug_id": 49707, "attachment_id": null, "is_private": false, "id": 139341, "time": "2010-08-22T11:44:26Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-08-22T11:44:26Z", "text": "(In reply to comment #5)\n> > Otherwise I would make a test like that:\n> > - create a document D with an element E with attribute xml:id=\"id1\"\n> > - then I would call: E.setAttributeNS( ..., \"xml:id\", \"id2\");\n> > - and finally I would test the result of a call to D.getElementById(\"id1\") \n> > Guess it is non null and return elt E?\n> \n>     This doesn't happen for me with current SVN Batik.\n\n@Marchant:\nAs hinted by Thomas, please provide further information, such as:\n * Batik version (or revision when working with SVN);\n * Java version (JRE, JDK, vendor - Sun/Apache/OpenJDK, etc.);\n * SVG document version;\n * XML parser being used (Batik's or an external one).\n\nThe SVG document version being requested is somehow a shoot in the dark: May this have something to do with an SVG-version specific issue? (See bug 46791, for example.) Hope I'm not just adding more noise to this! ;-)"}, {"count": 7, "tags": [], "bug_id": 49707, "attachment_id": null, "is_private": false, "id": 139362, "time": "2010-08-23T06:59:12Z", "creator": "jfm@macqel.eu", "creation_time": "2010-08-23T06:59:12Z", "text": "Hi \n\nI have tried to reproduce my problem in a little example but I did not succeed :-(\n\nAnyway, the most important is that the error in \"AbstractElement.setAttributeNS\" will be fixed.\n\nThanks for your support"}]
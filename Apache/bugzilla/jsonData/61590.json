[{"count": 0, "tags": [], "bug_id": 61590, "attachment_id": 35399, "is_private": false, "id": 201328, "time": "2017-10-07T13:09:58Z", "creator": "kpreisser@apache.org", "creation_time": "2017-10-07T13:09:58Z", "text": "Created attachment 35399\nPatch to correctly detect JDK 9\n\nWhen trying to install Tomcat 9.0.1 on Windows (x64) where the JAVA_HOME environment variable points to the JDK 9, service.bat fails to recognize the Java binaries:\n\n> C:\\apache-tomcat-9.0.1\\bin>service install\n> The JAVA_HOME environment variable is not defined correctly\n> This environment variable is needed to run this program\n> NB: JAVA_HOME should point to a JDK not a JRE\n\nThis is because service.bat checks for \"java.exe\", \"javaw.exe\" and \"server\\jvm.dll\" within a \"jre\\bin\" directory, but the \"jre\" directory doesn't exist on JDK 9.\n\nInstead, the necessary binaries can be found directly within the JDK's \"bin\" folder.\n\n\nNote: Running the Tomcat Service using the SYSTEM user (root) works, but if you want to run the Tomcat Service as a different user with Java 9, it seems that additionally to having access to the Tomcat directory (e.g. \"D:\\Tomcat\"), the user also must have read access access to its parent directory (e.g. \"D:\\\") (or even the drive root) for some reason.\nOtherwise (if the user only has access to the Tomcat directory), starting the service will fail and the following error will be printed to stderr.log:\n\n> 2017-10-07 14:52:24 Commons Daemon procrun stderr initialized\n> java.lang.NoClassDefFoundError: org/apache/catalina/startup/Bootstrap\n> Caused by: java.lang.ClassNotFoundException: > org.apache.catalina.startup.Bootstrap\n>    at > java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:582)\n>    at > java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:185)\n>    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:496)\nException in thread \"main\" \n\nThis isn't the case with Java 8, where it is sufficient to have access to only the Tomcat directory."}, {"count": 1, "tags": [], "bug_id": 61590, "attachment_id": null, "id": 201352, "time": "2017-10-09T12:32:37Z", "creator": "markt@apache.org", "creation_time": "2017-10-09T12:32:37Z", "is_private": false, "text": "Fixed in:\n- trunk for 9.0.2 onwards\n- 8.5.x for 8.5.24 onwards\n- 8.0.x for 8.0.48 onwards\n- 7.0.x for 7.0.83 onwards"}]
[{"attachment_id": null, "tags": [], "creator": "fernando@mecon.gov.ar", "text": "I use this code as a \"sanitizer\" (ie, filters bad input from users) on JDK 1.3.1:\n\nString allowed= \"a-zA-Z0-9_@.: \u00f1\u00d1\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\\r\\n\\\\-\";\nRE r= new RE(\"[^\"+allowed+\"]\");\noutput= r.subst(input, \"_\", RE.REPLACE_ALL);\n\nWhen running:\n\nsanitize(\"a\u00e9$.JOla^|-+_\")\n\nI get:\n\njava.lang.ArrayIndexOutOfBoundsException: 16\n        at org.apache.regexp.RECompiler$RERange.delete(Unknown Source)\n        at org.apache.regexp.RECompiler$RERange.remove(Unknown Source)\n        at org.apache.regexp.RECompiler$RERange.include(Unknown Source)\n        at org.apache.regexp.RECompiler$RERange.include(Unknown Source)\n        at org.apache.regexp.RECompiler.characterClass(Unknown Source)\n        at org.apache.regexp.RECompiler.terminal(Unknown Source)\n        at org.apache.regexp.RECompiler.closure(Unknown Source)\n        at org.apache.regexp.RECompiler.branch(Unknown Source)\n        at org.apache.regexp.RECompiler.expr(Unknown Source)\n        at org.apache.regexp.RECompiler.compile(Unknown Source)\n        at org.apache.regexp.RE.<init>(Unknown Source)\n        at org.apache.regexp.RE.<init>(Unknown Source)\n\nThis is with both 1.2 and 1.3-dev (CVS) as of 28/Aug/2003.\n\nEverything works if I use:\n\nString allowed= \"a-zA-Z0-9_@.: \u00f1\u00d1\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\\r\\\\-\"; (removed \\n)\n\nThe same happen with other characters inside de [^].\n\nIs there's any other info needed, please let me know.", "count": 0, "id": 43452, "time": "2003-08-28T20:08:15Z", "bug_id": 22804, "creation_time": "2003-08-28T20:08:15Z", "is_private": false}, {"count": 1, "tags": [], "creator": "vgritsenko@apache.org", "attachment_id": null, "id": 43491, "time": "2003-08-30T00:37:57Z", "bug_id": 22804, "creation_time": "2003-08-30T00:37:57Z", "is_private": false, "text": "Fernando, you've got lots of funny characters in your program and I can't write\na program with those to test your bug. Please rewrite your test: use \\uXXXX\nencoding when using non ascii characters.\n\nAlternatively, you can attach your test and I can try and compile it on my\nplatform but that might not work as we might have different platform encodings.\n\nVadim"}, {"count": 2, "text": "Created attachment 8020\nTestcase", "creator": "fernando@mecon.gov.ar", "attachment_id": 8020, "id": 43550, "time": "2003-09-01T12:48:08Z", "bug_id": 22804, "creation_time": "2003-09-01T12:48:08Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "fernando@mecon.gov.ar", "attachment_id": null, "text": "Hello Vadim,\nPlease find attached a program with the accented chars \\u encoded.\nThat way the example blows with or without the \\n.\n\nThanks!\n\nFernando.", "id": 43551, "time": "2003-09-01T12:50:09Z", "bug_id": 22804, "creation_time": "2003-09-01T12:50:09Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 22804, "text": "Sorry, forgot the trace:\n\n\nlang.ArrayIndexOutOfBoundsException: 16\n        at org.apache.regexp.RECompiler$RERange.delete(Unknown Source)\n        at org.apache.regexp.RECompiler$RERange.remove(Unknown Source)\n        at org.apache.regexp.RECompiler$RERange.include(Unknown Source)\n        at org.apache.regexp.RECompiler$RERange.include(Unknown Source)\n        at org.apache.regexp.RECompiler.characterClass(Unknown Source)\n        at org.apache.regexp.RECompiler.terminal(Unknown Source)\n        at org.apache.regexp.RECompiler.closure(Unknown Source)\n        at org.apache.regexp.RECompiler.branch(Unknown Source)\n        at org.apache.regexp.RECompiler.expr(Unknown Source)\n        at org.apache.regexp.RECompiler.compile(Unknown Source)\n        at org.apache.regexp.RE.<init>(Unknown Source)\n        at org.apache.regexp.RE.<init>(Unknown Source)\n        at ar.gov.mecon.sso.testing.testre.sanitize(testre.java:25)\n        at ar.gov.mecon.sso.testing.testre.main(testre.java:39)", "id": 43552, "time": "2003-09-01T12:51:14Z", "creator": "fernando@mecon.gov.ar", "creation_time": "2003-09-01T12:51:14Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "vgritsenko@apache.org", "attachment_id": null, "text": "Ok, this exception should happen on any (negated?) character class which is more\nthan 16 ranges (example: [^02468ACEGIKMOQSUWY])", "id": 43558, "time": "2003-09-01T18:20:36Z", "bug_id": 22804, "creation_time": "2003-09-01T18:20:36Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 22804, "attachment_id": null, "text": "fixed. please test against latest CVS.", "id": 43560, "time": "2003-09-01T18:34:56Z", "creator": "vgritsenko@apache.org", "creation_time": "2003-09-01T18:34:56Z", "is_private": false}, {"count": 7, "text": "Works Ok.\n\nThanks!", "creator": "fernando@mecon.gov.ar", "attachment_id": null, "id": 43569, "time": "2003-09-01T20:10:46Z", "bug_id": 22804, "creation_time": "2003-09-01T20:10:46Z", "tags": [], "is_private": false}]
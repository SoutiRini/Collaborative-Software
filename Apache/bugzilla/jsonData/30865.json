[{"count": 0, "tags": [], "creator": "patrick@spacesurfer.com", "attachment_id": null, "is_private": false, "id": 62535, "time": "2004-08-26T14:32:11Z", "bug_id": 30865, "creation_time": "2004-08-26T14:32:11Z", "text": "The disk cache module creates temporary files in CacheRoot, these files have the\nformat aptmp??????\nSome of the time it does not clean up and remove the files, so the directory\nends up being full of these files (mostly of 0 size!). Eventually this slows\ndoen the file system to such a degree that the proxy slows down massively."}, {"count": 1, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "is_private": false, "id": 62542, "time": "2004-08-26T15:32:09Z", "bug_id": 30865, "creation_time": "2004-08-26T15:32:09Z", "text": "*** Bug 30868 has been marked as a duplicate of this bug. ***"}, {"count": 2, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "text": "*** Bug 30867 has been marked as a duplicate of this bug. ***", "id": 62544, "time": "2004-08-26T15:32:30Z", "bug_id": 30865, "creation_time": "2004-08-26T15:32:30Z", "is_private": false}, {"count": 3, "tags": [], "text": "*** Bug 30866 has been marked as a duplicate of this bug. ***", "is_private": false, "bug_id": 30865, "id": 62546, "time": "2004-08-26T15:32:45Z", "creator": "slive@apache.org", "creation_time": "2004-08-26T15:32:45Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "chip@force-elite.com", "attachment_id": null, "is_private": false, "id": 75924, "time": "2005-06-03T03:40:11Z", "bug_id": 30865, "creation_time": "2005-06-03T03:40:11Z", "text": "Does this still happen with 2.0.54?"}, {"count": 5, "tags": [], "bug_id": 30865, "text": "This still happens in 2.2.8, surprised that it's stagnated this long. This is really a showstopper since it will fill up CacheRoot dir with thousands of these files.", "id": 116031, "time": "2008-04-29T10:42:48Z", "creator": "richard_hubbe11@yahoo.com", "creation_time": "2008-04-29T10:42:48Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 30865, "text": "Does nobody use mod_cache?!? This bug is a real bite in the butt one!", "id": 117088, "time": "2008-05-28T09:41:27Z", "creator": "melser.anton@gmail.com", "creation_time": "2008-05-28T09:41:27Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "russ@i2rd.com", "attachment_id": null, "is_private": false, "id": 119529, "time": "2008-08-06T22:40:23Z", "bug_id": 30865, "creation_time": "2008-08-06T22:40:23Z", "text": "I just noticed this bug on a server. We had 26G of these temporary files.\n\nI compared the error log, access log, and file timestamp and data. The temp files correspond to the following error messages.\n\n(104)Connection reset by peer: cache: error returned while trying to return disk cached data\n\nRunning 2.2.4 "}, {"count": 8, "tags": [], "creator": "rahul.g.nair@gmail.com", "attachment_id": null, "is_private": false, "id": 119746, "time": "2008-08-12T11:16:40Z", "bug_id": 30865, "creation_time": "2008-08-12T11:16:40Z", "text": "can you cat any of the files (of size larger than 0) ?\nare they cache headers or data?\n"}, {"count": 9, "tags": [], "bug_id": 30865, "attachment_id": null, "id": 119747, "time": "2008-08-12T11:35:22Z", "creator": "melser.anton@gmail.com", "creation_time": "2008-08-12T11:35:22Z", "is_private": false, "text": "I've since gone back to squid, but I can confirm that they are data files."}, {"count": 10, "tags": [], "text": "They are data files in my case also. I used the data and timestamps to correlate entries in the accesslog by comparing orphaned image data (dimension, visually). I compared the matching accesslog entries with the errorlog to determine that the temp files were orphaned when the error message, \"104)Connection reset by peer: cache: error returned while trying to return disk cached data\", was logged.\n\nmod_cache # ls aptmp* | head -n 5| xargs file\naptmp03747j: Macromedia Flash data (compressed), version 8\naptmp06aged: Macromedia Flash data (compressed), version 8\naptmp0JnsLu: data\naptmp0TWluZ: Macromedia Flash data (compressed), version 8\naptmp0hE4Mx: Macromedia Flash data (compressed), version 8\n\nmod_cache # ls -l aptmp* | head -n 5\n-rw------- 1 apache apache 163680 Aug 12 13:58 aptmp03747j\n-rw------- 1 apache apache 139128 Aug 11 03:27 aptmp06aged\n-rw------- 1 apache apache   8184 Aug 12 06:04 aptmp0JnsLu\n-rw------- 1 apache apache 761112 Aug 11 16:21 aptmp0TWluZ\n-rw------- 1 apache apache 965712 Aug 11 17:10 aptmp0hE4Mx\n", "is_private": false, "bug_id": 30865, "id": 119748, "time": "2008-08-12T11:52:35Z", "creator": "russ@i2rd.com", "creation_time": "2008-08-12T11:52:35Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 30865, "text": "Created attachment 22437\nPatch against trunk\n\nDoes the attached patch against trunk (which works against 2.2.9 with some fuzz) resolve your problem?", "id": 119754, "time": "2008-08-12T13:04:44Z", "creator": "rpluem@apache.org", "creation_time": "2008-08-12T13:04:44Z", "is_private": false, "attachment_id": 22437}, {"count": 12, "tags": [], "creator": "minfrin@sharp.fm", "attachment_id": null, "is_private": false, "id": 144598, "time": "2011-02-27T09:34:55Z", "bug_id": 30865, "creation_time": "2011-02-27T09:34:55Z", "text": "This was fixed on httpd-trunk. We now register a pool cleanup, so that we always trigger a cleanup regardless of the type of failure."}, {"count": 13, "tags": [], "creator": "issues.apache.org@daleroberts.info", "text": "Sorry to disappoint but this is still a problem:\n\n########## Apache -V details ################\nServer version: Apache/2.2.24 (Unix)\nServer built:   Jun 21 2013 12:00:22\nServer's Module Magic Number: 20051115:31\nServer loaded:  APR 1.2.7, APR-Util 1.2.7\nCompiled using: APR 1.2.7, APR-Util 1.2.7\nArchitecture:   64-bit\nServer MPM:     Worker\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=128\n -D HTTPD_ROOT=\"/u01/apache2.2.24\"\n -D SUEXEC_BIN=\"/u01/apache2.2.24/bin/suexec\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n########## Apache -V details ################\n\n########## Directory Listing ##################\n-rw------- 1 apache apache  4943136 Oct 17 08:34 /u01/apache2/cache/aptmpLPAiY8\n-rw------- 1 apache apache   139128 Oct 17 08:35 /u01/apache2/cache/aptmpAScO9K\n-rw------- 1 apache apache   106392 Oct 17 08:35 /u01/apache2/cache/aptmpzbvoqv\n-rw------- 1 apache apache   130944 Oct 17 08:35 /u01/apache2/cache/aptmp4pFbxN\n-rw------- 1 apache apache  3846480 Oct 17 08:36 /u01/apache2/cache/aptmpykxaao\n-rw------- 1 apache apache   826584 Oct 17 08:38 /u01/apache2/cache/aptmpdgKGKz\n-rw------- 1 apache apache 23970936 Oct 17 08:40 /u01/apache2/cache/aptmpxd0Aoy\n-rw------- 1 apache apache   695640 Oct 17 08:41 /u01/apache2/cache/aptmpjKoSsz\n-rw------- 1 apache apache  7308312 Oct 17 08:41 /u01/apache2/cache/aptmpaY7lOm\n-rw------- 1 apache apache  3322704 Oct 17 08:41 /u01/apache2/cache/aptmpXoxnyl\n-rw------- 1 apache apache  3224496 Oct 17 08:41 /u01/apache2/cache/aptmpOXqLRq\n-rw------- 1 apache apache    98208 Oct 17 08:43 /u01/apache2/cache/aptmpuj8Lnt\n-rw------- 1 apache apache   106392 Oct 17 08:43 /u01/apache2/cache/aptmpePy9l1\n-rw------- 1 apache apache  3388176 Oct 17 08:45 /u01/apache2/cache/aptmpwdMS1Z\n-rw------- 1 apache apache    90024 Oct 17 08:46 /u01/apache2/cache/aptmpeRiaXk\n-rw------- 1 apache apache    90024 Oct 17 08:46 /u01/apache2/cache/aptmp0GspIT\n-rw------- 1 apache apache    16368 Oct 17 08:47 /u01/apache2/cache/aptmpKZkEoq\n-rw------- 1 apache apache    90024 Oct 17 08:47 /u01/apache2/cache/aptmp2QGVm6\n-rw------- 1 apache apache   466488 Oct 17 08:49 /u01/apache2/cache/aptmp5TwTBr\n-rw------- 1 apache apache 18815016 Oct 17 08:52 /u01/apache2/cache/aptmpYMao0G\n-rw------- 1 apache apache  4448256 Oct 17 08:54 /u01/apache2/cache/aptmpW2AscH\n-rw------- 1 apache apache  6856704 Oct 17 08:54 /u01/apache2/cache/aptmpVKR2Ac\n-rw------- 1 apache apache  3895296 Oct 17 08:54 /u01/apache2/cache/aptmpboQGxr\n########## Directory Listing ##################\n\nThis is on a pretty busy web server but the number of files grows very quickly and so the htclean I have setup to run a limit cache size to 4GB is effectively useless as things reached 11GB until I started digging into where the \"other 7GB\" of storage went and discovered these \"random\" files.\n\nThe only possibly interesting thing I'm doing is caching access to images and videos served from Tomcat servers using mod_jk (tomcat-connectors-1.2.37-src.tar.gz to be precise) and running mod_security but I don't see why those would cause the disk cache to leave stray files around.\n\nAgain, sorry to disappoint the people who thought they'd fixed this.", "id": 170645, "attachment_id": null, "bug_id": 30865, "creation_time": "2013-10-17T07:57:11Z", "time": "2013-10-17T07:57:11Z", "is_private": false}, {"count": 14, "tags": [], "creator": "issues.apache.org@daleroberts.info", "attachment_id": null, "text": "Having just check I can confirm I do not find any of these temporary files on the non production servers which run exactly the same configuration and versions for Apache but experience only internal testing traffic not real users or real load.\n\nLoad on the servers is at least 200 requests per second with about a quarter of those going through mod_disk_cache. This is significantly less that the servers can handle however so it's not a server overload causing this.\n\nAlso I see not immediate indication that Apache threads or processes are crashing our causing these files to be left lying around (I'm assuming such crashes would appear in the main server error log where it's logs restart).", "id": 170646, "time": "2013-10-17T08:06:40Z", "bug_id": 30865, "creation_time": "2013-10-17T08:06:40Z", "is_private": false}, {"count": 15, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 170649, "time": "2013-10-17T13:31:34Z", "bug_id": 30865, "creation_time": "2013-10-17T13:31:34Z", "text": "No indication anyone tried ruedigers patch"}, {"count": 16, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 200770, "time": "2017-09-08T15:32:25Z", "bug_id": 30865, "creation_time": "2017-09-08T15:32:25Z", "text": "I have found one cause of this leaking.  If a response ends abnornally, there\nis no original EOS bucket, and ap_die removes the cache_out filter,\nso the aptmp file is never cleaned up."}]
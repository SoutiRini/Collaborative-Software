[{"count": 0, "tags": [], "bug_id": 48165, "attachment_id": null, "is_private": false, "id": 131837, "time": "2009-11-09T22:54:46Z", "creator": "safinwang@qq.com", "creation_time": "2009-11-09T22:54:46Z", "text": "I want to evaluate a workbook that linked to other workbook using the following method:\nString dirName = \"c:/somedir/\";\nString bookNameA = \"test.xls\";\nString bookNameB = \"rm0509.xls\"; \nHSSFWorkbook wb = new HSSFWorkbook(new FileInputStream(dirName + bookNameA));\nHSSFWorkbook wbB = new HSSFWorkbook(new FileInputStream(dirName + bookNameB));\n\nHSSFFormulaEvaluator evaluator = new HSSFFormulaEvaluator(wb);\nHSSFFormulaEvaluator feB = new HSSFFormulaEvaluator(wbB);\n\n// Set up the workbook environment for evaluation\nString[] workbookNames = { bookNameA, bookNameB, };\nHSSFFormulaEvaluator[] evaluators = { evaluator, feB, };\nHSSFFormulaEvaluator.setupEnvironment(workbookNames, evaluators);\n\n// do an evaluation\nHSSFCell cell = wb.getSheetAt(0).getRow(0).getCell(0);\nevaluator.evaluateFormulaCell(cell);  \n\nThe exception happens when call the evaluator.evaluateFormulaCell(cell) method,the exception message is like this:\n14:18:08,437 [http-8080-Processor18] ERROR jsp - java.lang.RuntimeException: Invalid sheet name '1.2.1_LNE' in bool '1_Structure_Data.xls'.\n\tat org.apache.poi.ss.formula.OperationEvaluationContext.createExternSheetRefEvaluator(OperationEvaluationContext.java:90)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.getEvalForPtg(WorkbookEvaluator.java:480)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:379)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:257)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateReference(WorkbookEvaluator.java:524)\n\tat org.apache.poi.ss.formula.SheetRefEvaluator.getEvalForCell(SheetRefEvaluator.java:47)\n\tat org.apache.poi.ss.formula.LazyRefEval.getInnerValueEval(LazyRefEval.java:52)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.dereferenceValue(WorkbookEvaluator.java:411)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:392)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:257)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateReference(WorkbookEvaluator.java:524)\n\tat org.apache.poi.ss.formula.SheetRefEvaluator.getEvalForCell(SheetRefEvaluator.java:47)\n\tat org.apache.poi.ss.formula.LazyRefEval.getInnerValueEval(LazyRefEval.java:52)\n\tat org.apache.poi.hssf.record.formula.eval.OperandResolver.getSingleValue(OperandResolver.java:47)\n\tat org.apache.poi.hssf.record.formula.functions.Hlookup.evaluate(Hlookup.java:58)\n\tat org.apache.poi.hssf.record.formula.eval.FunctionEval.evaluate(FunctionEval.java:247)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:374)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:257)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateReference(WorkbookEvaluator.java:524)\n\tat org.apache.poi.ss.formula.SheetRefEvaluator.getEvalForCell(SheetRefEvaluator.java:47)\n\nI don't know why the sheet name is invalid,please help me!"}, {"count": 1, "text": "Please attached the problematic file, without it we can't do much to help you.\n\nYegor", "bug_id": 48165, "is_private": false, "id": 147489, "time": "2011-06-25T12:37:11Z", "creator": "yegor@dinom.ru", "creation_time": "2011-06-25T12:37:11Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 48165, "attachment_id": null, "text": "I am facing the same issue. I have attached the file as well the external referenced file for which I am seeing this issue.\nMy code is similar to the code above and I am seeing the exact same exception. I have copied my stacktrace here.\nAnyhelp is greatly appreciated.\n\njava.lang.RuntimeException: Invalid sheet name 'Dates' in bool 'ACCOUNTS_DELIVERY_CLT.xls'.\n\tat org.apache.poi.ss.formula.OperationEvaluationContext.createExternSheetRefEvaluator(OperationEvaluationContext.java:93)\n\tat org.apache.poi.ss.formula.OperationEvaluationContext.getRef3DEval(OperationEvaluationContext.java:249)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.getEvalForPtg(WorkbookEvaluator.java:607)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateFormula(WorkbookEvaluator.java:493)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluateAny(WorkbookEvaluator.java:287)\n\tat org.apache.poi.ss.formula.WorkbookEvaluator.evaluate(WorkbookEvaluator.java:229)\n\tat org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateFormulaCellValue(HSSFFormulaEvaluator.java:354)\n\tat org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator.evaluateFormulaCell(HSSFFormulaEvaluator.java:216)\n\tat imgrdatamodifier.UpdateExcelFile.updateFile(UpdateExcelFile.java:84)\n\tat imgrdatamodifier.UpdateExcelFile.main(UpdateExcelFile.java:32)", "id": 162601, "time": "2012-10-06T20:24:31Z", "creator": "tiwari.divya@gmail.com", "creation_time": "2012-10-06T20:24:31Z", "is_private": false}, {"count": 3, "tags": [], "creator": "tiwari.divya@gmail.com", "attachment_id": 29456, "id": 162602, "time": "2012-10-06T20:27:37Z", "bug_id": 48165, "creation_time": "2012-10-06T20:27:37Z", "is_private": false, "text": "Created attachment 29456\nThe File and the external referneced file\n\nThe files are attached.\nPlease take a look and let me know."}, {"count": 4, "tags": [], "bug_id": 48165, "attachment_id": null, "id": 162640, "time": "2012-10-09T10:50:20Z", "creator": "tiwari.divya@gmail.com", "creation_time": "2012-10-09T10:50:20Z", "is_private": false, "text": "Is there any update to this?"}, {"count": 5, "tags": [], "bug_id": 48165, "attachment_id": null, "id": 162650, "time": "2012-10-09T15:33:16Z", "creator": "tiwari.divya@gmail.com", "creation_time": "2012-10-09T15:33:16Z", "is_private": false, "text": "I did some debugging. The exception is thrown by the POI code as it seems to get an index <0 for the particular sheet in the external workbook.\nWhen I call the getSheetIndex function for the external sheet in question separately it returns a valid index (>0) but for some reason poi function ss.formula.OperationEvaluationContext.createExternalSheetRefEvaluator(...) is not able to get the correct index for the sheet when it is called to evaluate the formula.\nPlease Help."}, {"count": 6, "tags": [], "creator": "onealj@apache.org", "attachment_id": 34058, "id": 192526, "time": "2016-07-19T11:02:28Z", "bug_id": 48165, "creation_time": "2016-07-19T11:02:28Z", "is_private": false, "text": "Created attachment 34058\nPassing unit test\n\nI was unable to reproduce the problem in the latest version of POI (3.15 beta 2+) using the worksheets in attachment 29456. See my attached patch.\n\nIf you want to ensure that this stays fixed in the future, please submit a minimal worksheet that ideally contains just one relative external link to a second workbook and nothing else."}, {"count": 7, "tags": [], "bug_id": 48165, "attachment_id": null, "id": 192527, "time": "2016-07-19T11:03:47Z", "creator": "onealj@apache.org", "creation_time": "2016-07-19T11:03:47Z", "is_private": false, "text": "This was probably fixed in a previous version. Anyways, working now, though no guarantees that it won't break in the future without a unit test..."}]
[{"count": 0, "tags": [], "bug_id": 46506, "is_private": false, "text": "In a build process, I want to move a file named in the pattern of a-[x.x].jar to a.jar, where [x.x] is a version number of the library. I used the following globmapper as a nested element in the move task.\n\n    <mapper type=\"glob\" from=\"a*.jar\" to=\"a.jar\"/>\n\nI would expect the result as a.jar. Instead, it turns out to be a.jar-[x.x].\n\nI looked into the source code and found that the code always expect the variable part also exists in the \"to\" file name.  Not sure if it is by design spec or just a missing case.\n\nThe fix should be easy by introducing a flag: hasVarInTo initialized to true. Then modify the two methods as following.\n\n    public void setTo(String to) {\n        int index = to.lastIndexOf(\"*\");\n        if (index == -1) {\n            toPrefix = to;\n            toPostfix = \"\";\n            hasVarInTo = false;  // THIS IS ADDED FOR THE FIX\n        } else {\n            toPrefix = to.substring(0, index);\n            toPostfix = to.substring(index + 1);\n        }\n    }\n\n\n    public String[] mapFileName(String sourceFileName) {\n        if (fromPrefix == null\n            || !modifyName(sourceFileName).startsWith(modifyName(fromPrefix))\n            || !modifyName(sourceFileName).endsWith(modifyName(fromPostfix))) {\n            return null;\n        }\n        return new String[] {toPrefix\n                                 + (hasVarInTo? extractVariablePart(sourceFileName)\n                                 + toPostfix : \"\")}; // THIS IS MODIFIED TO\n                                                     // FIX THE ISSUE\n    }\n\n\nFor the \"from\" part, we can always assume there will be a variable since it is what globmapper is used for.\n\nIf it is by design spec, it should be noted in the document at the minimum.\n\nThanks,\nFeng", "id": 123914, "time": "2009-01-09T14:37:10Z", "creator": "fyang@praxalogic.org", "creation_time": "2009-01-09T14:37:10Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "is_private": false, "id": 123952, "time": "2009-01-12T03:48:42Z", "bug_id": 46506, "creation_time": "2009-01-12T03:48:42Z", "text": "before looking further into globmapper and how to prevent this surprise: if you\ndon't use a * in globmapper's \"to\", you really want to use a mergemapper.\n"}, {"count": 2, "attachment_id": null, "creator": "bodewig@apache.org", "is_private": false, "id": 123955, "time": "2009-01-12T05:19:32Z", "bug_id": 46506, "creation_time": "2009-01-12T05:19:32Z", "tags": [], "text": "fixed via svn revision 733729\n\nthe change means we are breaking backwards compatibility and I'll start a thread\nto discuss the issue before closing this report."}, {"count": 3, "attachment_id": null, "creator": "fyang@praxalogic.org", "text": "Hi Stefan,\n\nThanks a lot for referring me to the mergemapper in this case. It really works in my case. Somehow, I missed the variety of the usage of mergemapper.\n\nAs far as the fix goes, I do not see the backwards incompatibility. Can you please notify me with the URL to the discussion thread once you have set it up? I would like to join in the discussion.\n\nThanks,\nFeng", "id": 123961, "time": "2009-01-12T08:12:34Z", "bug_id": 46506, "creation_time": "2009-01-12T08:12:34Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "text": "It's on the Ant developer mailing list, see http://marc.info/?l=ant-dev&m=123176768705110&w=2\n\nThe issue is that there may be code out there that relies on the old behavior where the * was appended to the to pattern implicitly.  I wouldn't expect this to be common, but already found one such case in Ant's very own unit tests.\n", "is_private": false, "bug_id": 46506, "id": 123962, "time": "2009-01-12T08:19:21Z", "creator": "bodewig@apache.org", "creation_time": "2009-01-12T08:19:21Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "marked the change as backwards incompatible change and live with.", "id": 124517, "time": "2009-01-30T04:16:47Z", "bug_id": 46506, "creation_time": "2009-01-30T04:16:47Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "d.gaffuri@reply.it", "text": "Hello\n\nThe actual version of Tomcat is 4.1.10, but there's no choice for it.\n\nI've a JSP page extending TagSupport with a custom tag that defines a scripting \nvariable with a NESTED scope. Here's the extra info class:\n\npublic class WizardExtraInfo extends TagExtraInfo {\n\n    public VariableInfo[] getVariableInfo(TagData data) {\n        return new VariableInfo[] {\n            new VariableInfo(\"profiles\",\n                             \"browser.client.jsp.Profiles\",\n                             true,\n                             VariableInfo.NESTED)\n        };\n    }\n}\n\nWhen referencing the scripting variable inside the tag body a \nNullPointerException is thrown. Looking at the generated java code I see that \nthe variable is declared immediately after doStartTag() but synchronized only \nafter doAfterBody().\n\n      /* ----  cb:wizard ---- */\n      browser.client.jsp.tag.Wizard _jspx_th_cb_wizard_0 = \nbrowser.client.jsp.tag.Wizard) \n_jspx_tagPool_cb_wizard_undoAction_nextPage_nextAction_cancelAction.get\n(browser.client.jsp.tag.Wizard.class);\n      _jspx_th_cb_wizard_0.setPageContext(pageContext);\n      _jspx_th_cb_wizard_0.setParent(null);\n      _jspx_th_cb_wizard_0.setXXX;\n      int _jspx_eval_cb_wizard_0 = _jspx_th_cb_wizard_0.doStartTag();\n      if (_jspx_eval_cb_wizard_0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {\n        browser.client.jsp.Profiles profiles = null;\n        do {\n\n          /* body */\n          ...\n          profiles.get(...); // throws NullPointerException\n          ...\n          /* end body */\n\n          int evalDoAfterBody = _jspx_th_cb_wizard_0.doAfterBody();\n          profiles = (browser.client.jsp.Profiles) pageContext.findAttribute\n(\"profiles\");\n          if (evalDoAfterBody != \njavax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)\n            break;\n        } while (true);\n      }\n      if (_jspx_th_cb_wizard_0.doEndTag() == \njavax.servlet.jsp.tagext.Tag.SKIP_PAGE)\n        return;\n      _jspx_tagPool_cb_wizard_undoAction_nextPage_nextAction_cancelAction.reuse\n(_jspx_th_cb_wizard_0);\n\nThe same page compiled with Tomcat 3.3.1 correctly translates to\n\nint _jspx_eval_cb_wizard_0 = _jspx_th_cb_wizard_0.doStartTag();\nif (_jspx_eval_cb_wizard_0 == javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_TAG)\n    throw new JspTagException(\"Since tag handler...\");\nif (_jspx_eval_cb_wizard_0 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {\n    do {\n        browser.client.jsp.Profiles profiles = null;\n        profiles = (browser.client.jsp.Profiles) pageContext.findAttribute\n(\"profiles\");\n    ....\n\nThanks in advance.\n\nDaniele Gaffuri", "id": 22662, "time": "2002-09-11T10:47:13Z", "bug_id": 12517, "creation_time": "2002-09-11T10:47:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "d.gaffuri@reply.it", "text": "I've tried to compile a page with a custom tag extending BodyTagSupport and \ndeclaring a NESTED scripting variable named as the id attribute. In this case \nthe scripting variable is initialized after doInitBody() but is never declared. \nIt seems that another variable named _jspx_columnDescr_1, already declared at \nthe beginning of service method, is declared instead, and the result generates \ntwo compilation errors.\n\n/* ----  cb:column ---- */\nbrowser.ViewColumn _jspx_columnDescr_1 = columnDescr;\nbrowser.client.jsp.tag.Column _jspx_th_cb_column_1 = \n(browser.client.jsp.tag.Column) _jspx_tagPool_cb_column_value_name_id.get\n(browser.client.jsp.tag.Column.class);\n_jspx_th_cb_column_1.setPageContext(pageContext);\n_jspx_th_cb_column_1.setParent(_jspx_th_cb_column_0);\n_jspx_th_cb_column_1.setId(\"columnDescr\");\nint _jspx_eval_cb_column_1 = _jspx_th_cb_column_1.doStartTag();\nif (_jspx_eval_cb_column_1 != javax.servlet.jsp.tagext.Tag.SKIP_BODY) {\n  if (_jspx_eval_cb_column_1 != javax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE){\n    javax.servlet.jsp.tagext.BodyContent _bc = pageContext.pushBody();\n    _bc.clear();\n    out = _bc;\n    _jspx_th_cb_column_1.setBodyContent(_bc);\n    _jspx_th_cb_column_1.doInitBody();\n    columnDescr = (browser.ViewColumn) pageContext.findAttribute(\"columnDescr\");\n  }\n  do {\n    /* body */\n    int evalDoAfterBody = _jspx_th_cb_column_1.doAfterBody();\n    columnDescr = (browser.ViewColumn) pageContext.findAttribute(\"columnDescr\");\n    if (evalDoAfterBody != javax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN)\n      break;\n  } while (true);\n  if (_jspx_eval_cb_column_1 != javax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE)\n    out = pageContext.popBody();\n}\nif (_jspx_th_cb_column_1.doEndTag() == javax.servlet.jsp.tagext.Tag.SKIP_PAGE)\n  return;\n_jspx_tagPool_cb_column_value_name_id.reuse(_jspx_th_cb_column_1);\ncolumnDescr = _jspx_columnDescr_1;\n\nThe generated errors are:\n\nGenerated servlet error:\n    [javac] Compiling 1 source file\nD:\\jakarta-tomcat-4.1.10\n\\work\\Standalone\\localhost\\click\\data\\codes_jsp.java:514: _jspx_columnDescr_1 \nis already defined in _jspService\n(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)\n              browser.ViewColumn _jspx_columnDescr_1 = columnDescr;\n                                 ^\n\n\n\nAn error occurred at line: 84 in the jsp file: /data/codes.jsp\n\nGenerated servlet error:\nD:\\jakarta-tomcat-4.1.10\n\\work\\Standalone\\localhost\\click\\data\\codes_jsp.java:514: cannot resolve symbol\nsymbol  : variable columnDescr  \nlocation: class org.apache.jsp.codes_jsp\n              browser.ViewColumn _jspx_columnDescr_1 = columnDescr;\n                                                       ^\nDon't know if the two problems are related, so I add a comment instead of \nopening a new bug.\n\nThanks.", "id": 22668, "time": "2002-09-11T11:45:05Z", "bug_id": 12517, "creation_time": "2002-09-11T11:45:05Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "xliu@capitalthinking.com", "attachment_id": null, "id": 22695, "time": "2002-09-11T18:04:13Z", "bug_id": 12517, "creation_time": "2002-09-11T18:04:13Z", "is_private": false, "text": "I had the same problem with the new 4.1.10 release.\n\nOur custom tag simply implements 'Tag' interface and returns 'EVAL_BODY_INCLUDE'\nin doStartTag(). The tag exports 'menuString' as following:\n\npublic VariableInfo [] getVariableInfo(TagData pData) {\n        return new VariableInfo[] {\n            new VariableInfo(\"menuString\",\n                             \"java.lang.String\",\n                             true,\n                             VariableInfo.NESTED)\n                };\n    }\n\nCompiled java code for jsp page when two 'menu' tags are used in different \nblocks (which means different { } blocks)\n\n/* ----  ct:menu ---- (first one) */\n      {\n        java.lang.String menuString = null;\n        com.ct.tags.ui.MenuTag _jspx_th_ct_menu_0 =\n(com.ct.tags.ui.MenuTag)\n_jspx_tagPool_ct_menu_whichMenu.get(com.ct.tags.ui.MenuTag.class);\n        _jspx_th_ct_menu_0.setPageContext(pageContext);\n        _jspx_th_ct_menu_0.setParent(null);\n        _jspx_th_ct_menu_0.setWhichMenu(\"global\");\n        int _jspx_eval_ct_menu_0 = _jspx_th_ct_menu_0.doStartTag();\n        menuString = (java.lang.String)\npageContext.findAttribute(\"menuString\");\n        if (_jspx_eval_ct_menu_0 !=\njavax.servlet.jsp.tagext.Tag.SKIP_BODY) {\n          out.print( menuString );\n        }\n        if (_jspx_th_ct_menu_0.doEndTag() ==\njavax.servlet.jsp.tagext.Tag.SKIP_PAGE)\n          return;\n        _jspx_tagPool_ct_menu_whichMenu.reuse(_jspx_th_ct_menu_0);\n      }\n\n\n/* ----  ct:menu ---- (second one) */\n      com.ct.tags.ui.MenuTag _jspx_th_ct_menu_1 = (com.ct.tags.ui.MenuTag)\n_jspx_tagPool_ct_menu_whichMenu.get(com.ct.tags.ui.MenuTag.class);\n      _jspx_th_ct_menu_1.setPageContext(pageContext);\n      _jspx_th_ct_menu_1.setParent(null);\n      _jspx_th_ct_menu_1.setWhichMenu(\"top\");\n      int _jspx_eval_ct_menu_1 = _jspx_th_ct_menu_1.doStartTag();\n      menuString = (java.lang.String)\npageContext.findAttribute(\"menuString\");\n      if (_jspx_eval_ct_menu_1 != javax.servlet.jsp.tagext.Tag.SKIP_BODY)\n{\n        out.print( menuString );\n      }\n\n\njava error msg:\n\nGenerated servlet error:\n/home/xliu/Apache/jakarta-tomcat-4.1.10-\nsrc/build/work/Standalone/localhost/cmbs/custom_ui_elements/inc_gnav_jsp.java:15\n5:\ncannot resolve symbol\nsymbol  : variable menuString\nlocation: class org.apache.jsp.inc_gnav_jsp\n        out.print( menuString );\n\n********************************************************************************\nObservations:\n\n. this tag works on 4.1.9 release and 4.0.2 production.\n "}, {"count": 3, "tags": [], "creator": "jan.luehe@sun.com", "attachment_id": null, "id": 22713, "time": "2002-09-11T23:30:15Z", "bug_id": 12517, "creation_time": "2002-09-11T23:30:15Z", "is_private": false, "text": "Fixed.\n"}]
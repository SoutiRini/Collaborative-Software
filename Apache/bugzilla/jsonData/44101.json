[{"count": 0, "tags": [], "creator": "alex@valuadder.com", "text": "I have customized the workflow in a Lenya 2.0 RC6 deployment here, such that \nit is possible to directly publish a document in the authoring state if one \ncan both submit and publish (i.e. has the appropriate roles).\n\nHowever, this fails in o.a.l.cms.workflow.usecases.Publish.sendNotification \n(module workflow, line 331) if the page has not already undergone at least one \nworkflow transition and \"notify submitters\" is enabled, throwing \nArrayIndexOutOfBoundsException because versions.length (is 1) - 2 = -1.\n\nI recommend returning immediately before this if versions.length < 2.", "id": 111884, "time": "2007-12-18T21:31:58Z", "bug_id": 44101, "creation_time": "2007-12-18T21:31:58Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 44101, "is_private": false, "id": 111885, "time": "2007-12-18T21:37:10Z", "creator": "alex@valuadder.com", "creation_time": "2007-12-18T21:37:10Z", "tags": [], "text": "For reference, here's a stack trace:\n\norg.apache.cocoon.ProcessingException: Sitemap: error calling continuation\n\tat <map:call> - \nfile:///var/lib/tomcat5.5/webapps/lenya/lenya/modules/usecase/usecase.xmap:101:39\n\tat <map:mount> - \nfile:///var/lib/tomcat5.5/webapps/lenya/lenya/usecase.xmap:55:131\n\tat <map:mount> - \nfile:///var/lib/tomcat5.5/webapps/lenya/global-sitemap.xmap:288:105\n\tat <map:mount> - \nfile:///var/lib/tomcat5.5/webapps/lenya/sitemap.xmap:667:106\n\tat \norg.apache.cocoon.ProcessingException.throwLocated(ProcessingException.java:113)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.CallFunctionNode.invoke(CallFunctionNode.java:126)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)\n\tat \norg.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)\n\tat \norg.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)\n\tat \norg.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:254)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)\n\tat \norg.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)\n\tat \norg.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)\n\tat \norg.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:254)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)\n\tat \norg.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)\n\tat \norg.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)\n\tat \norg.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:254)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.MountNode.invoke(MountNode.java:118)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.ActTypeNode.invoke(ActTypeNode.java:139)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:47)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.MatchNode.invoke(MatchNode.java:108)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.PipelineNode.invoke(PipelineNode.java:143)\n\tat \norg.apache.cocoon.components.treeprocessor.AbstractParentProcessingNode.invokeNodes(AbstractParentProcessingNode.java:69)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.PipelinesNode.invoke(PipelinesNode.java:93)\n\tat \norg.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:235)\n\tat \norg.apache.cocoon.components.treeprocessor.ConcreteTreeProcessor.process(ConcreteTreeProcessor.java:177)\n\tat \norg.apache.cocoon.components.treeprocessor.TreeProcessor.process(TreeProcessor.java:254)\n\tat org.apache.cocoon.Cocoon.process(Cocoon.java:699)\n\tat \norg.apache.cocoon.servlet.CocoonServlet.service(CocoonServlet.java:1154)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\tat sun.reflect.GeneratedMethodAccessor75.invoke(Unknown Source)\n\tat \nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat \norg.apache.catalina.security.SecurityUtil$1.run(SecurityUtil.java:243)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat javax.security.auth.Subject.doAsPrivileged(Subject.java:517)\n\tat \norg.apache.catalina.security.SecurityUtil.execute(SecurityUtil.java:275)\n\tat \norg.apache.catalina.security.SecurityUtil.doAsPrivilege(SecurityUtil.java:161)\n\tat \norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:245)\n\tat org.apache.catalina.core.ApplicationFilterChain.access$0\n(ApplicationFilterChain.java:177)\n\tat \norg.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:156)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat \norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:152)\n\tat \norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)\n\tat \norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)\n\tat \norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)\n\tat \norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\n\tat \norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)\n\tat \norg.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)\n\tat \norg.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:199)\n\tat org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:282)\n\tat org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:767)\n\tat \norg.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:697)\n\tat \norg.apache.jk.common.ChannelSocket$SocketConnection.runIt(ChannelSocket.java:889)\n\tat \norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)\n\tat java.lang.Thread.run(Thread.java:619)\nCaused by: org.mozilla.javascript.WrappedException: Wrapped \norg.apache.lenya.cms.usecase.UsecaseException: java.lang.RuntimeException: \njava.lang.ArrayIndexOutOfBoundsException: -1 \n(file:///var/lib/tomcat5.5/webapps/lenya/lenya/modules/usecase/usecases.js#280)\n\tat \norg.mozilla.javascript.Context.throwAsScriptRuntimeEx(Context.java:1693)\n\tat org.mozilla.javascript.MemberBox.invoke(MemberBox.java:160)\n\tat \norg.mozilla.javascript.NativeJavaMethod.call(NativeJavaMethod.java:204)\n\tat \norg.mozilla.javascript.Interpreter.interpretLoop(Interpreter.java:3085)\n\tat org.mozilla.javascript.Interpreter.interpret(Interpreter.java:2251)\n\tat \norg.mozilla.javascript.InterpretedFunction.call(InterpretedFunction.java:161)\n\tat \norg.mozilla.javascript.ContextFactory.doTopCall(ContextFactory.java:340)\n\tat \norg.mozilla.javascript.ScriptRuntime.doTopCall(ScriptRuntime.java:2758)\n\tat \norg.mozilla.javascript.InterpretedFunction.call(InterpretedFunction.java:159)\n\tat org.mozilla.javascript.Context.call(Context.java:489)\n\tat \norg.mozilla.javascript.ScriptableObject.callMethod(ScriptableObject.java:1556)\n\tat \norg.mozilla.javascript.ScriptableObject.callMethod(ScriptableObject.java:1526)\n\tat \norg.apache.cocoon.components.flow.javascript.fom.FOM_JavaScriptInterpreter.handleContinuation(FOM_JavaScriptInterpreter.java:841)\n\tat \norg.apache.cocoon.components.treeprocessor.sitemap.CallFunctionNode.invoke(CallFunctionNode.java:124)\n\t... 70 more\nCaused by: org.apache.lenya.cms.usecase.UsecaseException: \njava.lang.RuntimeException: java.lang.ArrayIndexOutOfBoundsException: -1\n\tat \norg.apache.lenya.cms.usecase.AbstractUsecase.execute(AbstractUsecase.java:328)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat \nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat \nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat \norg.apache.avalon.excalibur.component.ComponentProxyGenerator$ComponentInvocationHandler.invoke(ComponentProxyGenerator.java:143)\n\tat $Proxy53.execute(Unknown Source)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat \nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat \nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.mozilla.javascript.MemberBox.invoke(MemberBox.java:145)\n\t... 82 more\nCaused by: java.lang.RuntimeException: \njava.lang.ArrayIndexOutOfBoundsException: -1\n\tat \norg.apache.lenya.cms.workflow.usecases.Publish.publish(Publish.java:316)\n\tat \norg.apache.lenya.cms.workflow.usecases.Publish.doExecute(Publish.java:294)\n\tat \norg.apache.lenya.cms.usecase.AbstractUsecase.execute(AbstractUsecase.java:319)\n\t... 93 more\nCaused by: java.lang.ArrayIndexOutOfBoundsException: -1\n\tat \norg.apache.lenya.cms.workflow.usecases.Publish.sendNotification(Publish.java:331)\n\tat \norg.apache.lenya.cms.workflow.usecases.Publish.publish(Publish.java:312)\n\t... 95 more"}, {"attachment_id": null, "tags": [], "creator": "andreas@apache.org", "text": "Should be fixed in revision 605842. Please test, TIA!", "count": 2, "id": 111939, "time": "2007-12-20T01:22:46Z", "bug_id": 44101, "creation_time": "2007-12-20T01:22:46Z", "is_private": false}]
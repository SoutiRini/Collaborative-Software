[{"count": 0, "tags": [], "bug_id": 47106, "attachment_id": null, "id": 126551, "time": "2009-04-27T09:18:18Z", "creator": "ross.heritage@gmail.com", "creation_time": "2009-04-27T09:18:18Z", "is_private": false, "text": "I have a slightly unusual setup where all content is retrieved via mod_proxy from various servers. However, to more clearly demonstrate the issue, I can simplify things to this configuration:\n\nProxyErrorOverride On\nErrorDocument 404 /404error.html\n\nRewriteEngine On\nRewriteRule (.*) http://backend.sever$1 [P]\n\n\nWhen requesting /whatever from this server, the initial request goes through to 'backend.server', which issues a 404 error.\n \nThe frontend server then makes another request to 'backend.server' for '/404error.html'. backend.server has this file, so responds with an HTTP 200 response.\n\nThe headend server now responds to the original request to /whatever, returning a HTTP 200 with the HTML for the error document."}, {"attachment_id": null, "tags": [], "creator": "minfrin@sharp.fm", "text": "Comparing the default_handler to the proxy_handler, the default_handler is respecting and not touching the r->status == 404 that is passed into the subrequest.\n\nIn contrast in the proxy, proxy_run_scheme_handler() stomps on r->status, replacing the 404 with the 200 it got from the backend.\n\nLooks like the fix is to teach mod_proxy not to do that.", "count": 1, "id": 134457, "time": "2010-02-12T11:59:36Z", "bug_id": 47106, "creation_time": "2010-02-12T11:59:36Z", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 24976\nFix for the problem\n\nThe proxy_handler was overwriting r->status with the response code from the backend, which was then faithfully passed to the frontend. This patch works out when the original value should be maintained and passed to the client.", "is_private": false, "id": 134463, "creation_time": "2010-02-12T16:25:31Z", "time": "2010-02-12T16:25:31Z", "creator": "minfrin@sharp.fm", "bug_id": 47106, "attachment_id": 24976}, {"count": 3, "tags": [], "bug_id": 47106, "attachment_id": null, "text": "Fixed in r909899, proposed for backport to v2.2.", "id": 134479, "time": "2010-02-13T20:28:16Z", "creator": "minfrin@sharp.fm", "creation_time": "2010-02-13T20:28:16Z", "is_private": false}]
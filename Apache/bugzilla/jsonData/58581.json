[{"count": 0, "tags": [], "bug_id": 58581, "attachment_id": 33255, "text": "Created attachment 33255\nproposed fix to avoid NPE\n\nMinimal files to reproduce this issue:\n1) create a directory named test and deploy it under webapps\ntest\n\u251c\u2500\u2500 WEB-INF\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 web.xml\n\u251c\u2500\u2500 error.html\n\u2514\u2500\u2500 test.html\n\nthe web.xml is as follows:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app version=\"3.0\">\n    <servlet-mapping>\n        <servlet-name>default</servlet-name>\n        <url-pattern>/test.html</url-pattern>\n    </servlet-mapping>\n\n    <error-page>\n        <error-code>404</error-code>\n        <location>/error.html</location>\n    </error-page>\n</web-app>\n2 ) start tomcat and visit http://localhost:8080/test/abc.html\n\nThe exception is thrown as follows:\n\n04-Nov-2015 22:24:04.984 SEVERE [http-nio-8080-exec-1] org.apache.catalina.core.StandardHostValve.custom Exception Processing                      ErrorPage[errorCode=404, location=/error.html]\n java.lang.NullPointerException\n    at org.apache.catalina.core.StandardHostValve.custom(StandardHostValve.java:391)\n    at org.apache.catalina.core.StandardHostValve.status(StandardHostValve.java:257)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:79)\n    at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:616)\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:361)\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:1057)\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:75)\n    at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:737)\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1531)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n    at java.lang.Thread.run(Thread.java:745)\n\nThe exception is not user-friendly, and somehow misleading. From the stack trace, user is likely to consider it as a tomcat bug. \n\nThe solution might be adding url-pattern /error.html to the default servlet, or just change the url-pattern to match all the html resources.\n\nMy suggestion is to avoid such NPE and tell user what to do.\n\nI have attached a proposed fix against trunk.", "id": 186238, "time": "2015-11-04T14:35:20Z", "creator": "huxing.zhang@gmail.com", "creation_time": "2015-11-04T14:35:20Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 58581, "attachment_id": null, "id": 186294, "time": "2015-11-06T15:15:04Z", "creator": "markt@apache.org", "creation_time": "2015-11-06T15:15:04Z", "is_private": false, "text": "Thanks for the report and the patch. I've applied the patch (with an additional fix that enabled thre default error page to be displayed if the custom page is not available) to trunk, 8.0.x (for 8.0.29) and 7.0.x (for 7.0.66)."}]
[{"count": 0, "tags": [], "creator": "msterner@gmail.com", "attachment_id": 32400, "is_private": false, "id": 180590, "time": "2015-01-27T13:17:52Z", "bug_id": 57504, "creation_time": "2015-01-27T13:17:52Z", "text": "Created attachment 32400\nRepeat build.xml\n\nIt seems like revision 1645615 broke the ant jasper task in 7.0.58 for taglibs.\n\nRepeat:\n\n 1) Download and unzip apache-tomcat-7.0.58.zip and apache-ant-1.9.4-bin.zip to a temporary directory.\n\n 2) Put the following into a new file build.xml in the directory: (attached, based on http://tomcat.apache.org/tomcat-7.0-doc/jasper-howto.html#Web_Application_Compilation)\n\n   <project>\n\n     <import file=\"apache-tomcat-7.0.58/bin/catalina-tasks.xml\"/>\n\n     <target name=\"jspc\">\n\n       <jasper\n                validateXml=\"false\"\n                uriroot=\"apache-tomcat-7.0.58/webapps/examples\"\n                webXmlFragment=\"tmp/WEB-INF/generated_web.xml\"\n                outputDir=\"tmp/WEB-INF/src\" />\n\n     </target>\n   </project>\n\n 3) Execute \"apache-ant-1.9.4/bin/ant jspc\" in the directory.\n\nExpected result:\n\n Compiled output in tmp/WEB-INF\n\nActual result:\n\n Exception is thrown and only partial output to tmp/WEB-INF:\n\n jspc:\n   [jasper] java.lang.NullPointerException\n   [jasper] \tat org.apache.jasper.JspCompilationContext.getTldLocation(JspCompilationContext.java:618)\n   [jasper] \tat org.apache.jasper.compiler.Parser.parseTaglibDirective(Parser.java:409)\n   [jasper] \tat org.apache.jasper.compiler.Parser.parseDirective(Parser.java:475)\n   [jasper] \tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1410)\n   [jasper] \tat org.apache.jasper.compiler.Parser.parse(Parser.java:138)\n   [jasper] \tat org.apache.jasper.compiler.ParserController.doParse(ParserController.java:242)\n   [jasper] \tat org.apache.jasper.compiler.ParserController.parse(ParserController.java:102)\n   [jasper] \tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:199)\n   [jasper] \tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:374)\n   [jasper] \tat org.apache.jasper.JspC.processFile(JspC.java:1213)\n   [jasper] \tat org.apache.jasper.JspC.execute(JspC.java:1364)\n   [jasper] \tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:292)\n   [jasper] \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   [jasper] \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n   [jasper] \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   [jasper] \tat java.lang.reflect.Method.invoke(Method.java:606)\n   [jasper] \tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\n   [jasper] \tat org.apache.tools.ant.Task.perform(Task.java:348)\n   [jasper] \tat org.apache.tools.ant.Target.execute(Target.java:435)\n   [jasper] \tat org.apache.tools.ant.Target.performTasks(Target.java:456)\n   [jasper] \tat org.apache.tools.ant.Project.executeSortedTargets(Project.java:1393)\n   [jasper] \tat org.apache.tools.ant.Project.executeTarget(Project.java:1364)\n   [jasper] \tat org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n   [jasper] \tat org.apache.tools.ant.Project.executeTargets(Project.java:1248)\n   [jasper] \tat org.apache.tools.ant.Main.runBuild(Main.java:851)\n   [jasper] \tat org.apache.tools.ant.Main.startAnt(Main.java:235)\n   [jasper] \tat org.apache.tools.ant.launch.Launcher.run(Launcher.java:280)\n   [jasper] \tat org.apache.tools.ant.launch.Launcher.main(Launcher.java:109)\n\nIf 7.0.58 is replaced by 7.0.57 then the repeat runs without any exception and with complete output.\n\nThe problem seems to be the cleanup of the tldLocationsCache initialization in revision 1645615, partially backported from revision 1541041, since it's still used by JspCompilationContext.getTldLocation.\n\nPossibly the fix is as easy as bringing back the initialization line."}, {"count": 1, "tags": [], "bug_id": 57504, "is_private": false, "text": "Created attachment 32401\nPatch to initialize tldLocationsCache\n\nI have verified this using tc7.0.x branch.\n\nThe attached patch prevents this error but I've not fully investigated the consequences.", "id": 180595, "time": "2015-01-27T16:25:49Z", "creator": "jboynes@apache.org", "creation_time": "2015-01-27T16:25:49Z", "attachment_id": 32401}, {"count": 2, "tags": [], "bug_id": 57504, "is_private": false, "text": "Patch applied in http://svn.apache.org/viewvc?view=revision&revision=1655089", "id": 180596, "time": "2015-01-27T16:50:08Z", "creator": "jboynes@apache.org", "creation_time": "2015-01-27T16:50:08Z", "attachment_id": null}]
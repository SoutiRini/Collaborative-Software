[{"count": 0, "tags": [], "bug_id": 55159, "text": "Created attachment 30499\npatch\n\nThe problem appears in version 7.0.41 and in revision 1497999.  I\nattached a two-line patch  (patch.diff) that fixes it.\n\nIn method \"ErrorReportValve.getPartialServletStackTrace\", the loop\nover \"elements\" keeps overriding \"pos\" with \"i\".  Therefore, only the\nlast written value is visible out of the loop and all the other writes\nand iterations are not necessary.  The patch iterates from the end of\n\"elements\" and breaks the first time when \"pos\" is set.\n\nThe above fix (in patch.diff) is certainly correct (it's easy to see\nthrough code inspection), but I think we can have an even shorter\npatch (one line, in patchShort.diff): just break as soon as \"pos\" is\nset, without reversion the loop order.  patchShort.diff is correct\nonly if there can be only one \"elements[i]\" with class name\n\"org.apache.catalina.core.ApplicationFilterChain\" and method name\n\"internalDoFilter\" or if it doesn't matter which such \"elements[i]\" is\ndetected (the last, like in the original code, or the first, like in\npatchShort.diff).", "id": 168130, "time": "2013-06-29T19:12:03Z", "creator": "nistor1@illinois.edu", "creation_time": "2013-06-29T19:12:03Z", "is_private": false, "attachment_id": 30499}, {"count": 1, "tags": [], "creator": "nistor1@illinois.edu", "attachment_id": 30500, "is_private": false, "id": 168131, "time": "2013-06-29T19:12:32Z", "bug_id": 55159, "creation_time": "2013-06-29T19:12:32Z", "text": "Created attachment 30500\npatchShort"}, {"attachment_id": null, "tags": [], "creator": "violetagg@apache.org", "text": "(In reply to Adrian Nistor from comment #0)\n> The above fix (in patch.diff) is certainly correct (it's easy to see\n> through code inspection), but I think we can have an even shorter\n> patch (one line, in patchShort.diff): just break as soon as \"pos\" is\n> set, without reversion the loop order.  patchShort.diff is correct\n> only if there can be only one \"elements[i]\" with class name\n> \"org.apache.catalina.core.ApplicationFilterChain\" and method name\n> \"internalDoFilter\" or if it doesn't matter which such \"elements[i]\" is\n> detected (the last, like in the original code, or the first, like in\n> patchShort.diff).\n\nWe need the last element and not the first one. So the first patch is the proper one.\n\nRegards\nVioleta", "count": 2, "id": 168170, "time": "2013-07-01T10:37:25Z", "bug_id": 55159, "creation_time": "2013-07-01T10:37:25Z", "is_private": false}, {"count": 3, "tags": [], "text": "Thanks for the report.\nThe first patch was applied in trunk and 7.0.x and will be included in 7.0.42 onwards.", "is_private": false, "bug_id": 55159, "id": 168175, "time": "2013-07-01T11:25:36Z", "creator": "violetagg@apache.org", "creation_time": "2013-07-01T11:25:36Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 29740, "attachment_id": null, "is_private": false, "id": 59720, "time": "2004-06-22T15:50:04Z", "creator": "maxb@apache.org", "creation_time": "2004-06-22T15:50:04Z", "text": "Configuring with --with-apr=/usr usually fails. This is because:\n\nThe generated exports.c #includes all *.h files found in <apr-prefix>/include\nIf <apr-prefix> == /usr , then this means /usr/include/*.h !!!\n\nOn most systems, it's quite likely that some of these are C++ headers, or have\nconflicting definitions, so breaking the build.\n\nThe solution is to only include apr and apr-util headers from the apr and\napr-util include directories. This is easy to do, as apr and apr-util headers\nfollow a consistent naming scheme.\n\nHere is a patch, to include only apr.h, apu.h, apr_*.h, and apu_*.h from the apr\nand apr-util include directories.\n\nIt is against httpd-2.0.49 (current release), but it applies without conflict to\n current 2.0-HEAD and 2.1-HEAD.\n\n--- httpd-2.0.49/server/Makefile.in.orig 2004-06-21 01:00:42.308012800 +0100\n+++ httpd-2.0.49/server/Makefile.in 2004-06-21 01:14:25.131174400 +0100\n@@ -31,7 +31,8 @@\n \n util.lo: test_char.h\n \n-EXPORT_DIRS = $(top_srcdir)/include $(top_srcdir)/os/$(OS_DIR)\n$(APR_INCLUDEDIR) $(APU_INCLUDEDIR) $(top_srcdir)/modules/http\n+EXPORT_DIRS = $(top_srcdir)/include $(top_srcdir)/os/$(OS_DIR)\n$(top_srcdir)/modules/http\n+EXPORT_DIRS_APR = $(APR_INCLUDEDIR) $(APU_INCLUDEDIR)\n \n # If export_files is a dependency here, but we remove it during this stage,\n # when exports.c is generated, make will not detect that export_files is no\n@@ -58,6 +59,10 @@\n  for dir in $(EXPORT_DIRS); do \\\n      ls $$dir/*.h >> $$tmp; \\\n  done; \\\n+ for dir in $(EXPORT_DIRS_APR); do \\\n+     ls $$dir/ap[ru].h >> $$tmp 2>/dev/null; \\\n+     ls $$dir/ap[ru]_*.h >> $$tmp 2>/dev/null; \\\n+ done; \\\n  sort -u $$tmp > $@; \\\n  rm -f $$tmp"}, {"count": 1, "tags": [], "bug_id": 29740, "attachment_id": 11910, "id": 59721, "time": "2004-06-22T15:56:42Z", "creator": "maxb@apache.org", "creation_time": "2004-06-22T15:56:42Z", "is_private": false, "text": "Created attachment 11910\nThe same patch as inline, but attached to avoid line-wrapping"}, {"count": 2, "tags": [], "bug_id": 29740, "attachment_id": null, "is_private": false, "id": 59925, "time": "2004-06-26T15:54:55Z", "creator": "sergeyli@pisem.net", "creation_time": "2004-06-26T15:54:55Z", "text": "We have had similar problems trying to build APR, APU, and then HTTPD all by\nthemselves, in Source Mage GNU/Linux. Our patches are here:\n\nhttp://codex.sourcemage.org/test/libs/apr/build.diff\nhttp://codex.sourcemage.org/test/libs/apr-util/build.diff"}, {"count": 3, "tags": [], "bug_id": 29740, "attachment_id": null, "is_private": false, "id": 66415, "time": "2004-11-04T03:13:28Z", "creator": "chip@force-elite.com", "creation_time": "2004-11-04T03:13:28Z", "text": "most reasonable places have the APR headers installed to /usr/include/apr-{0,1}\ndon't they?"}, {"count": 4, "tags": [], "bug_id": 29740, "attachment_id": null, "id": 66450, "time": "2004-11-04T12:30:07Z", "creator": "maxb@apache.org", "creation_time": "2004-11-04T12:30:07Z", "is_private": false, "text": "Replying to Paul Querna above:\n\nInstalling to <prefix>/include is the default in apr. For httpd to be\nincompatible with the default build and install of apr seems rather wrong to me.\n\nBesides, just because the bug won't affect some environments doesn't mean it\nshouldn't be fixed, especially when fixing it only requires a tiny patch, which\nI have already written and attached to the bug."}, {"count": 5, "tags": [], "text": "Replying to Sergey A. Lipnevich above:\n\nAFAICS your patches are about an entirely unrelated issue.", "attachment_id": null, "id": 66451, "creator": "maxb@apache.org", "time": "2004-11-04T12:32:03Z", "bug_id": 29740, "creation_time": "2004-11-04T12:32:03Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 29740, "attachment_id": null, "id": 66452, "time": "2004-11-04T12:43:15Z", "creator": "minfrin@apache.org", "creation_time": "2004-11-04T12:43:15Z", "is_private": false, "text": "APR must be able to find it's headers if they are installed in /usr/include or\nin /usr/include/apr-{0,1}, which is where APR v1.0 seems to want to put them.\n\nFixing this bug allows httpd v2.1 to be built as an RPM again.\n"}, {"count": 7, "tags": [], "bug_id": 29740, "attachment_id": null, "is_private": false, "id": 70485, "time": "2005-02-04T00:39:38Z", "creator": "jerenkrantz@apache.org", "creation_time": "2005-02-04T00:39:38Z", "text": "Applied in r151255.  Thanks!"}]
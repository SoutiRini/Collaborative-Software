[{"count": 0, "tags": [], "bug_id": 50440, "attachment_id": null, "is_private": false, "id": 142503, "time": "2010-12-09T02:35:33Z", "creator": "tommy.li@firefire.co", "creation_time": "2010-12-09T02:35:33Z", "text": "The following snippet of code will fail:\n\nFormulaEvaluator evaluator = workbook.getCreationHelper().createFormulaEvaluator();\nevaluator.evaluate(source)\n\nworkbook is of type org.apache.poi.ss.usermodel.Workbook\nsource is of type org.apache.poi.ss.usermodel.Cell with the following formula:\n=SUM(1+\n2)\n\nHere's the exception:\nCaught: org.apache.poi.ss.formula.FormulaParseException: Parse error near char 6 '\n' in specified formula 'SUM(1+\n2)'. Expected cell ref or constant literal"}, {"count": 1, "tags": [], "bug_id": 50440, "attachment_id": null, "is_private": false, "id": 142512, "time": "2010-12-09T05:34:41Z", "creator": "apache@gagravarr.org", "creation_time": "2010-12-09T05:34:41Z", "text": "Are newlines really valid characters within the formula though?\n\nAre you creating the formula with the newline it in through POI or excel?"}, {"count": 2, "tags": [], "bug_id": 50440, "text": "Created attachment 26388\nTest spreadsheet for newline in formula error", "id": 142542, "time": "2010-12-09T17:46:37Z", "creator": "tommy.li@firefire.co", "creation_time": "2010-12-09T17:46:37Z", "is_private": false, "attachment_id": 26388}, {"count": 3, "tags": [], "bug_id": 50440, "attachment_id": 26389, "is_private": false, "id": 142543, "time": "2010-12-09T17:48:24Z", "creator": "tommy.li@firefire.co", "creation_time": "2010-12-09T17:48:24Z", "text": "Created attachment 26389\nGroovy test harness for newline in formula error"}, {"count": 4, "tags": [], "bug_id": 50440, "text": "(In reply to comment #1)\n> Are newlines really valid characters within the formula though?\n> \n> Are you creating the formula with the newline it in through POI or excel?\n\nNew lines (created using alt+enter in formula bar on Windows Excel 2010 OR command+option+return in Mac Office 2008) are valid, i.e. Excel correctly calculates the formula.\n\nI created the formula using Excel and used Apache POI to read the workbook.\n\nI attached a test harness in Groovy and a spreadsheet (xlsx) that has new line chars in the formula.\n\nCheers,\n\nTommy.", "id": 142544, "time": "2010-12-09T17:48:52Z", "creator": "tommy.li@firefire.co", "creation_time": "2010-12-09T17:48:52Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "It looks like you can only have the newline in .xlsx files - when I save as a .xls and re-open then the newline has gone\n\nIf you can create a .xls file with the newlines, please upload it\n\nOtherwise, I'm going to work on the basis that this is a .xlsx only feature and try to fix it as that.", "attachment_id": null, "id": 142623, "creator": "apache@gagravarr.org", "time": "2010-12-13T00:35:08Z", "bug_id": 50440, "creation_time": "2010-12-13T00:35:08Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 50440, "text": "On the basis that this is a XSSF (.xlsx) only feature), then the newlines can't be turned into Ptgs so we don't need them when doing the Ptg parsing. As such, fixed in r1045021 by stripping them out during the XSSF Ptg step.", "id": 142624, "time": "2010-12-13T00:40:49Z", "creator": "apache@gagravarr.org", "creation_time": "2010-12-13T00:40:49Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 50440, "text": "(In reply to comment #6)\n> On the basis that this is a XSSF (.xlsx) only feature), then the newlines can't\n> be turned into Ptgs so we don't need them when doing the Ptg parsing. As such,\n> fixed in r1045021 by stripping them out during the XSSF Ptg step.\n\nAwesome, that was real quick.\n\nI should've mentioned that this problem happens in XSSF only, I couldn't replicate the problem in HSSF.\n\nSo when is the next stable release (assume it's 3.8) coming?  Where can I download the nightly builds?", "id": 142626, "time": "2010-12-13T01:13:09Z", "creator": "tommy.li@firefire.co", "creation_time": "2010-12-13T01:13:09Z", "is_private": false, "attachment_id": null}]
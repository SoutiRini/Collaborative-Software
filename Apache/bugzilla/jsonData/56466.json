[{"count": 0, "tags": [], "bug_id": 56466, "attachment_id": null, "id": 174916, "time": "2014-04-28T12:04:03Z", "creator": "seyhun_cavus@hotmail.com", "creation_time": "2014-04-28T12:04:03Z", "is_private": false, "text": "Intro: Today, I was clearing the configuration file of Apache HTTPD and before doing this I have upgraded Apache HTTPD to the latest version (2.4.9) to be able to use unix socket option.\nBut, I've faced some crushes while I clear the configuration file. Fortunately, I've found the source of the issue but it was really hard for me to detect it since I had also done more tuning operations today.\nSo, I was not sure about the bug, and now I am.\n\nThe source of the issue is mod_macro. May it is a bug or maybe it does not work as I have supposed to be.\nCrush logs are long. So, I am posting other footprints instead.\n\nFootprint 1:\n[Mon Apr 28 11:38:51.217549 2014] [macro:warn] [pid 16400:tid 140305156634368] macro 'modenull' multiply defined: \\xa0\\x92B, redefined on line 559 of \"/etc/httpd/httpd.conf\"\n[Mon Apr 28 11:37:01.830618 2014] [macro:warn] [pid 15815:tid 140126534055680] macro 'modenull' multiply defined: defined on line 559 of \"/etc/httpd/httpd.conf\", redefined on line 559 of \"/etc/httpd/httpd.conf\"\n- I actually did not redefine macros.\n\nFootprint 2:\nAH00082: an unknown filter was not added: reqtimeout\n- mod_reqtimeout was actually loaded.\n \nFootprint 3:\nAH01797: client denied by server configuration: /srv/www/\n- mod_access_compat has access already.\n\nAnd so on... It just breaks loading of other listed modules.\nThis is what I've used as macro definitions.\n\n-----------------------------------------------------\n\nDefine  root_www   /srv/www/\nDefine  root_ssl   /etc/ssl/certs/\n\n<Macro ConnectionDefault $id>\n# noting to do\n</Macro>\n\n<Macro ModeNull $id>\n# mod_php: noting to do\n</Macro>\n\n<Macro ModePHPFPM $id>\n    ProxyPassMatch ^/(.*\\.php)$ unix:/var/run/php-fpm.sock|fcgi://127.0.0.1:9000${root_www}/$id/@g\n</Macro>\n\n<Macro ModeHHVM $id>\n    ProxyPassMatch ^/(.*\\.php)$ unix:/var/run/hhvm/hhvm.sock|fcgi://127.0.0.1:9000${root_www}/$id/@g\n</Macro>\n\n<Macro ConnectionSSL $id>\n    SSLEngine On\n    SSLCertificateFile    \"${root_ssl}$id.crt\"\n    SSLCertificateKeyFile \"${root_ssl}$id.key\"\n    SSLCACertificateFile  \"${root_ssl}ca-certificates.crt\"\n</Macro>\n\n<Macro VHost $id $mode $port $connection $name $alias>\n    <VirtualHost *:$port>\n        ServerName   $name\n        ServerAlias  $alias\n\n        Use Connection$connection $id\n\n        DocumentRoot \"${root_www}/$id/\"\n        <Directory \"${root_www}/$id/\">\n            IncludeOptional ${root_www}/$id/.htaccess\n            AllowOverride None\n            Allow from all\n        </Directory>\n        ErrorLog /var/log/httpd/$id/error.log\n        CustomLog /var/log/httpd/$id/access.log combined\n\n        Use Mode$mode $id\n    </VirtualHost>\n</Macro>\n\n# Use VHost example Null   80  Default example.com www.example.com\n# Use VHost example PHPFPM 443 SSL     example.com www.example.com\n# Use VHost example HHVM   80  Default example.com www.example.com\n\nUndefMacro ConnectionDefault\nUndefMacro ConnectionSSL\nUndefMacro ModeNull\nUndefMacro ModePHPFPM\nUndefMacro ModeHHVM\nUndefMacro VHost\n\n-----------------------------------------------------"}, {"count": 1, "tags": [], "bug_id": 56466, "attachment_id": null, "id": 174918, "time": "2014-04-28T18:13:02Z", "creator": "seyhun_cavus@hotmail.com", "creation_time": "2014-04-28T18:13:02Z", "is_private": false, "text": "OK, I can confirm that the source of the issue has been totally my mistake !\n\nAfter reading the mod_macro documentation carefully, I have changed $ prefixes to %{} to avoid confusion and that has just solved the problem.\n\nNow, the macros are as following;\n\n[Hopefully, this posts may help to users who face this or similar problem.]\n\n-------------------------------------------------------------------------------\n# BEGIN MACROS\n#\n# http://httpd.apache.org/docs/current/mod/core.html#define\n# https://httpd.apache.org/docs/current/en/mod/mod_macro.html\n# http://wiki.apache.org/httpd/NameBasedSSLVHostsWithSNI\n#\n\nDefine  root_www   /srv/www/\nDefine  root_ssl   /etc/ssl/certs/\n\n<Macro ConnectionDefault %{id}>\n# nothing to do\n    ErrorLog /var/log/httpd/%{id}/error.log\n</Macro>\n\n<Macro ModeNull %{id}>\n# mod_php: nothing to do\n    ErrorLog /var/log/httpd/%{id}/error.log\n</Macro>\n\n<Macro ModePHPFPM %{id}>\n    ProxyPassMatch ^/(.*\\.php)$ unix:/var/run/php-fpm/php-fpm.sock|fcgi://127.0.0.1:9000${root_www}/%{id}\n</Macro>\n\n<Macro ModeHHVM %{id}>\n    ProxyPassMatch ^/(.*\\.php)$ unix:/var/run/hhvm/hhvm.sock|fcgi://127.0.0.1:9000${root_www}/%{id}\n</Macro>\n\n<Macro ConnectionSSL %{id}>\n    SSLEngine On\n    SSLCertificateFile    \"${root_ssl}%{id}.crt\"\n    SSLCertificateKeyFile \"${root_ssl}%{id}.key\"\n    SSLCACertificateFile  \"${root_ssl}ca-certificates.crt\"\n    ErrorLog /var/log/httpd/%{id}/error.log\n</Macro>\n\n<Macro VHost %{id} %{mode} %{port} %{connection} %{name} %{alias}>\n    <VirtualHost *:%{port}>\n        ServerName  %{name}\n        ServerAlias %{alias}\n\n        Use Connection%{connection} %{id}\n\n        DocumentRoot \"${root_www}/%{id}/\"\n        <Directory \"${root_www}/%{id}/\">\n            IncludeOptional ${root_www}/%{id}/.htaccess\n            AllowOverride None\n            Allow from all\n        </Directory>\n        CustomLog /var/log/httpd/%{id}/access.log combined\n        ErrorLog /var/log/httpd/%{id}/error.log\n\n        Use Mode%{mode} %{id}\n    </VirtualHost>\n</Macro>\n\n# Use VHost example Null   80  Default example.com www.example.com\n# Use VHost example PHPFPM 443 SSL     example.com www.example.com\n# Use VHost example HHVM   80  Default example.com www.example.com\n\nUndefMacro ConnectionDefault\nUndefMacro ConnectionSSL\nUndefMacro VHost\nUndefMacro ModeNull\nUndefMacro ModePHPFPM\nUndefMacro ModeHHVM\n\n# END MACROS\n-------------------------------------------------------------------------------"}, {"count": 2, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "id": 174919, "time": "2014-04-28T18:33:27Z", "bug_id": 56466, "creation_time": "2014-04-28T18:33:27Z", "is_private": false, "text": "Thanks for followup, remarking as invalid rather than fixed (= fixed in httpd)"}]
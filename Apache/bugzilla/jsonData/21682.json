[{"count": 0, "tags": [], "text": "I have a couple of Virtual hosts, many of them name-based on Port 80, one of\nthem IP-based on port 443 (using SSL). To give you an impression:\n\n/apache/2.0.47 (root/server) bin/httpd -S\nVirtualHost configuration:\nwildcard NameVirtualHosts and _default_ servers:\n*:443                  ssl.company.de (/usr/local/apache/common2/vh_ssl.conf:1)\n*:80                   is a NameVirtualHost\n         default server ssl.company.de  (/usr/local/apache/common2/vh_ssl.conf:1)\n         port 80 namevhost name1.company.de\n(/usr/local/apache/common2/vh_name1.conf:1)\n         port 80 namevhost name2.company.de\n(/usr/local/apache/common2/vh_name2.conf:1)\n         port 80 namevhost name3.company.de\n(/usr/local/apache/common2/vh_name3.conf:1)\n...\nSyntax OK\n\n(names edited, in my case about 30 virtual hosts)\n\nBasically, everything works as expected.\n\nNow I want to have one of my name-based Virtual Hosts the default VH when\nentering the machine's IP address and port 80. But when I change one of this\nname-based Virtual Hosts from\n   <VirtualHost *:80>\nto\n   <VirtualHost _default_:80>\n(like http://httpd.apache.org/docs-2.0/vhosts/examples.html#defaultoneport seems\nto tell me) then every execution of \"httpd\" (starting, stopping, even \"httpd\n-S\") results in a core dump:\n\nbin/apachectl sslstart\n[Thu Jul 17 12:51:58 2003] [crit] [Thu Jul 17 12:51:58 2003] file vhost.c, line\n232, assertion \"rv == APR_SUCCESS\" failed\nAbort - core dumped\n\nThe corresponding source code section is explicitly checking for the \"_default_\"\nvalue:\n\n    else if (strcasecmp(host, \"_default_\") == 0\n        || strcmp(host, \"255.255.255.255\") == 0) {\n        rv = apr_sockaddr_info_get(&my_addr, \"255.255.255.255\", APR_INET, port,\n0, p);\n        ap_assert(rv == APR_SUCCESS); /* must be bug or out of storage */\n    }", "attachment_id": null, "id": 40899, "creator": "michael.schroepl@telekurs.com", "time": "2003-07-17T11:49:59Z", "bug_id": 21682, "creation_time": "2003-07-17T11:49:59Z", "is_private": false}, {"count": 1, "tags": [], "text": "Hi Michael :-)\n\nThere must be a misunderstandig somewhere. The default *namebased* virtual host\nis always the first one of the particular IP/port combination. So in your case\nthe first <VirtualHost *:80> container.\n_default_ is only useful for IP-based virtualhosts.\n\nWe should check that assertation anyway, since a coredump triggered by a\nmisconfiguration isn't such cool :)", "attachment_id": null, "id": 40902, "creator": "nd@perlig.de", "time": "2003-07-17T12:55:06Z", "bug_id": 21682, "creation_time": "2003-07-17T12:55:06Z", "is_private": false}, {"count": 2, "tags": [], "text": "Full Ack in every aspect. ;-)", "attachment_id": null, "id": 40903, "creator": "michael.schroepl@telekurs.com", "time": "2003-07-17T12:57:55Z", "bug_id": 21682, "creation_time": "2003-07-17T12:57:55Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 21682, "attachment_id": null, "text": "hmm, seems to be a solaris specific issue. (cannot reproduce on my linux box).\nCan you get the value of rv from the coredump?", "id": 41064, "time": "2003-07-21T13:38:28Z", "creator": "nd@perlig.de", "creation_time": "2003-07-21T13:38:28Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 21682, "attachment_id": null, "text": "oh well, don't have ssl at the moment. Does it also happen without SSL?", "id": 41082, "time": "2003-07-21T15:16:33Z", "creator": "nd@perlig.de", "creation_time": "2003-07-21T15:16:33Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 21682, "attachment_id": null, "text": "> Does it also happen without SSL?\n\nI recompiled this Apache without SSL, and still ...\n\n/apache/2.0.47_noSSL (root/sperling) bin/apachectl start\n[Tue Jul 22 13:25:53 2003] [crit] [Tue Jul 22 13:25:53 2003] file vhost.c, line\n232, assertion \"rv == APR_SUCCESS\" failed\nAbort - core dumped\n\n> Can you get the value of rv from the coredump?\n\nUm, I am not aware of how to read such a coredump ... don't even know if proper\ntools are installed at all.\n\nWould it make sense to add some output statement (maybe to the error_log)\ndirectly to this code position and recompile? If you posted me the lines I would\ntry that out as well ...", "id": 41147, "time": "2003-07-22T11:35:26Z", "creator": "michael.schroepl@telekurs.com", "creation_time": "2003-07-22T11:35:26Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 21682, "attachment_id": null, "text": "ok, the following puts the number and hopefully an error description into the log.\n\nThanks.", "id": 41175, "time": "2003-07-22T18:29:58Z", "creator": "nd@perlig.de", "creation_time": "2003-07-22T18:29:58Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 21682, "attachment_id": 7457, "text": "Created attachment 7457\nadds an error log message", "id": 41176, "time": "2003-07-22T18:30:57Z", "creator": "nd@perlig.de", "creation_time": "2003-07-22T18:30:57Z", "is_private": false}, {"count": 8, "tags": [], "creator": "michael.schroepl@telekurs.com", "attachment_id": null, "id": 41195, "time": "2003-07-23T08:11:47Z", "bug_id": 21682, "creation_time": "2003-07-23T08:11:47Z", "is_private": false, "text": "/apache/2.0.47_noSSL (root/sperling) bin/apachectl start\n[Wed Jul 23 10:04:20 2003] [error] (EAI 1)address family not supported: rv == 670001\n[Wed Jul 23 10:04:20 2003] [crit] [Wed Jul 23 10:04:20 2003] file vhost.c, line\n233, assertion \"rv == APR_SUCCESS\" failed\nAbort - core dumped"}, {"count": 9, "attachment_id": null, "creator": "nd@perlig.de", "text": "Thanks. This points IMHO more and more to a system problem. Can you try\n\nListen 0.0.0.0:80\nand\nListen 0.0.0.0:443\n\nin that httpd.conf? Does it change anything?", "id": 41200, "time": "2003-07-23T10:41:05Z", "bug_id": 21682, "creation_time": "2003-07-23T10:41:05Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "bug_id": 21682, "attachment_id": null, "text": "I already had\n\nListen 80\nand\nListen 443\n\nin my configuration; modifying this to\n\nListen 0.0.0.0:80\nand\nListen 0.0.0.0:443\n\ndidn't change anything.\n\nUsing the machine's IP address there had no other effect either.", "id": 41201, "time": "2003-07-23T11:37:57Z", "creator": "michael.schroepl@telekurs.com", "creation_time": "2003-07-23T11:37:57Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 21682, "attachment_id": null, "text": "Ok, then let's try the next. Can you recompile the httpd with --disable-ipv6 ?\n(make clean before, or better compile from a fresh unpacked archive)", "id": 41203, "time": "2003-07-23T11:50:11Z", "creator": "nd@perlig.de", "creation_time": "2003-07-23T11:50:11Z", "is_private": false}, {"count": 12, "tags": [], "creator": "michael.schroepl@telekurs.com", "text": "(My shell script containing the \"configure\" statement starts with \"make\ndistclean\" already.)\n\nAdded '--disable-ipv6', recompiled ...\nBut: no change. Still coredumping even on \"apachectl configtest\".", "id": 41209, "time": "2003-07-23T12:43:56Z", "bug_id": 21682, "creation_time": "2003-07-23T12:43:56Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 21682, "attachment_id": null, "id": 41259, "time": "2003-07-23T20:43:24Z", "creator": "jerenkrantz@apache.org", "creation_time": "2003-07-23T20:43:24Z", "is_private": false, "text": "Is it possible to provide a clear reproduction recipe?\n\nUsing _default_:80 here didn't segfault (Solaris 9 box).\n\nISTR that we've had problems with machines that weren't at the current patch\nlevel from Sun - especially wrt the networking code.  You may want to download\nand install the latest recommended patch cluster, and see if that helps.  (It's\na good idea, anyway!)\n\nAlso, on Solaris, you need to use coreadm to produce core dumps if you run as root."}, {"count": 14, "tags": [], "creator": "michael.schroepl@telekurs.com", "text": "> Is it possible to provide a clear reproduction recipe?\n\nSome Apache httpd.conf file I can reproduce the effect with looks like this:\n\n     NameVirtualHost *:80\n     <VirtualHost _default_:80>\n      ServerName      default\n      DocumentRoot    /usr/local/shark/client/default\n     </VirtualHost>\n\nChanging the second line to <VirtualHost *:80> will make Apache run.\n\nOriginally, I had about 20 modules included; I am going try to recompile Apache\nwith less modules now and check whether this changes anything.\n\n> Also, on Solaris, you need to use coreadm to produce core dumps if you run as\nroot.\n\nThe file \"core\" (3.6 MB) is created in the current directory from where I invoke\n\"httpd\" - I am not aware to have done anything specific about that. (But I am\nnot the Solaris admin of this machine.)\n\n> You may want to download and install the latest recommended patch cluster, and\nsee if that helps. (It's a good idea, anyway!)\n\nUm ... that depends ... but it sure might be an option.", "id": 41280, "time": "2003-07-24T12:00:37Z", "bug_id": 21682, "creation_time": "2003-07-24T12:00:37Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 21682, "attachment_id": null, "text": "... reducing the set of modules didn't change anything:\n\n/apache/2.0.47_noSSL/bin (root/sperling) ./httpd -l\nCompiled in modules:\n  core.c\n  worker.c\n  http_core.c\n\n/apache/2.0.47_noSSL/bin (root/sperling) ./httpd -S\n[Thu Jul 24 16:45:16 2003] [error] (EAI 1)address family not supported: rv == 670001\n[Thu Jul 24 16:45:16 2003] [crit] [Thu Jul 24 16:45:16 2003] file vhost.c, line\n233, assertion \"rv == APR_SUCCESS\" failed\nAbort (core dumped)\n\n/apache/2.0.47_noSSL/bin (root/sperling) ./httpd -V\nServer version: Apache/2.0.47\nServer built:   Jul 24 2003 16:35:35\nServer's Module Magic Number: 20020903:4\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_USE_PROC_PTHREAD_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/usr/local/apache/2.0.47_noSSL\"\n -D SUEXEC_BIN=\"/usr/local/apache/2.0.47_noSSL/bin/suexec\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\n/apache/2.0.47_noSSL/bin (root/sperling) cat ../conf/httpd.conf\n  Listen 80\n  NameVirtualHost *:80\n  <VirtualHost _default_:80>\n# <VirtualHost *:80>\n    ServerName      default\n    DocumentRoot    /usr/local/shark/client/default\n  </VirtualHost>", "id": 41322, "time": "2003-07-24T14:52:37Z", "creator": "michael.schroepl@telekurs.com", "creation_time": "2003-07-24T14:52:37Z", "is_private": false}, {"count": 16, "tags": [], "text": "I just tried that configuration snippet on my Solaris box, and could not reproduce.\n\nCan you please provide your 'uname -a' output?\n\nLet's see how out-of-date that box is wrt patches.  I'm fairly sure we've seen\nthis problem with unpatched boxes.\n\nThanks.", "attachment_id": null, "id": 41446, "creator": "jerenkrantz@apache.org", "time": "2003-07-24T18:04:10Z", "bug_id": 21682, "creation_time": "2003-07-24T18:04:10Z", "is_private": false}, {"count": 17, "tags": [], "bug_id": 21682, "attachment_id": null, "text": "/apache_2_source/httpd-2.0.47 (root/sperling) uname -a\nSunOS sperling 5.8 Generic_108528-21 sun4u sparc SUNW,Ultra-4", "id": 41494, "time": "2003-07-25T10:06:00Z", "creator": "michael.schroepl@telekurs.com", "creation_time": "2003-07-25T10:06:00Z", "is_private": false}, {"count": 18, "tags": [], "creator": "trawick@apache.org", "text": "FYI...  I too believe that this is resolved via a Solaris fix (upgrade to the current \nrecommended patch level for your version of the OS).\n\nIt wouldn't be bad to have a --disable-getaddrinfo configure option in APR, since on \nsome older software levels from various vendors getaddrinfo() has some challenges that \nwe developers don't always notice ourselves.\n", "id": 41652, "time": "2003-07-28T13:38:16Z", "bug_id": 21682, "creation_time": "2003-07-28T13:38:16Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "creator": "jorton@redhat.com", "text": "Bug 27525 also concerns the vhost.c:323 assert() - marking this as a dup since\nthe repro case is covered in the other bug.\n\n*** This bug has been marked as a duplicate of 27525 ***", "id": 71526, "time": "2005-02-25T17:50:09Z", "bug_id": 21682, "creation_time": "2005-02-25T17:50:09Z", "is_private": false, "attachment_id": null}]
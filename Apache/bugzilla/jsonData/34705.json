[{"attachment_id": null, "tags": [], "bug_id": 34705, "text": "Using https: (have not tested with http:), browser - Firefox, if user fails to\nenter a valid username and password 2 or 3 times, the browser goes into a\nwaiting state, and the server thread spikes a processor (CPU usage goes to max).\n Even on a multiprocessor system, a couple of finger flubbing users can drive\nthe load of a system beyond preferred limits.  This behavior appears to be new\nas of 2.0.54 (2.0.53 did not do this as far as I know).\n\nSystem is: Dell 2650 2x2.8 Ghz w/2 GB RAM running Redhat Enterprise Linux 3.0.\n\nApache uses: PHP, mod_perl, mod_smbauth, and runs both http and SSL as vhosts.\n\nApache compiled with: ./configure --prefix=$APACHE_DIR \\\n  --enable-ldap --enable-auth-ldap --with-ldap \\\n  --enable-mods-shared=\"rewrite ssl auth_ldap ldap\"\n\nBelow is a gdb/bt full of one of the runaway processes:\n\n# gdb /usr/local/apache2/bin/httpd 669\nGNU gdb Red Hat Linux (6.1post-1.20040607.52rh)\nCopyright 2004 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-redhat-linux-gnu\"...Using host libthread_db library\n\"/lib/tls/libthread_db.so.1\".\n\nAttaching to program: /usr/local/apache2/bin/httpd, process 669\nReading symbols from /lib/libssl.so.4...done.\nLoaded symbols for /lib/libssl.so.4\nReading symbols from /lib/libcrypto.so.4...done.\nLoaded symbols for /lib/libcrypto.so.4\nReading symbols from /usr/kerberos/lib/libgssapi_krb5.so.2...done.\nLoaded symbols for /usr/kerberos/lib/libgssapi_krb5.so.2\nReading symbols from /usr/kerberos/lib/libkrb5.so.3...done.\nLoaded symbols for /usr/kerberos/lib/libkrb5.so.3\nReading symbols from /usr/kerberos/lib/libcom_err.so.3...done.\nLoaded symbols for /usr/kerberos/lib/libcom_err.so.3\nReading symbols from /usr/kerberos/lib/libk5crypto.so.3...done.\nLoaded symbols for /usr/kerberos/lib/libk5crypto.so.3\nReading symbols from /lib/libresolv.so.2...done.\nLoaded symbols for /lib/libresolv.so.2\nReading symbols from /usr/lib/libz.so.1...done.\nLoaded symbols for /usr/lib/libz.so.1\nReading symbols from /usr/local/apache2/lib/libaprutil-0.so.0...done.\nLoaded symbols for /usr/local/apache2/lib/libaprutil-0.so.0\nReading symbols from /lib/libdb-4.1.so...done.\nLoaded symbols for /lib/libdb-4.1.so\nReading symbols from /usr/lib/libexpat.so.0...done.\nLoaded symbols for /usr/lib/libexpat.so.0\nReading symbols from /usr/local/apache2/lib/libapr-0.so.0...done.\nLoaded symbols for /usr/local/apache2/lib/libapr-0.so.0\nReading symbols from /lib/tls/librt.so.1...done.\nLoaded symbols for /lib/tls/librt.so.1\nReading symbols from\n/usr/lib/perl5/5.8.0/i386-linux-thread-multi/CORE/libperl.so...done.\nLoaded symbols for /usr/lib/perl5/5.8.0/i386-linux-thread-multi/CORE/libperl.so\nReading symbols from /lib/libnsl.so.1...done.\nLoaded symbols for /lib/libnsl.so.1\nReading symbols from /lib/libdl.so.2...done.\nLoaded symbols for /lib/libdl.so.2\nReading symbols from /lib/tls/libm.so.6...done.\nLoaded symbols for /lib/tls/libm.so.6\nReading symbols from /lib/tls/libpthread.so.0...done.\n[Thread debugging using libthread_db enabled]\n[New Thread -1218551680 (LWP 669)]\nLoaded symbols for /lib/tls/libpthread.so.0\nReading symbols from /lib/tls/libc.so.6...done.\nLoaded symbols for /lib/tls/libc.so.6\nReading symbols from /lib/libcrypt.so.1...done.\nLoaded symbols for /lib/libcrypt.so.1\nReading symbols from /lib/libutil.so.1...done.\nLoaded symbols for /lib/libutil.so.1\nReading symbols from /usr/lib/libgdbm.so.2...done.\nLoaded symbols for /usr/lib/libgdbm.so.2\nReading symbols from /usr/lib/liblber.so.2...done.\nLoaded symbols for /usr/lib/liblber.so.2\nReading symbols from /usr/lib/libldap.so.2...done.\nLoaded symbols for /usr/lib/libldap.so.2\nReading symbols from /lib/ld-linux.so.2...done.\nLoaded symbols for /lib/ld-linux.so.2\nReading symbols from /usr/lib/libsasl.so.7...done.\nLoaded symbols for /usr/lib/libsasl.so.7\nReading symbols from /lib/libpam.so.0...done.\nLoaded symbols for /lib/libpam.so.0\nReading symbols from /lib/liblaus.so.1...done.\nLoaded symbols for /lib/liblaus.so.1\nReading symbols from /lib/libnss_files.so.2...done.\nLoaded symbols for /lib/libnss_files.so.2\nReading symbols from /usr/local/apache2/modules/mod_ldap.so...done.\nLoaded symbols for /usr/local/apache2/modules/mod_ldap.so\nReading symbols from /usr/local/apache2/modules/mod_auth_ldap.so...done.\nLoaded symbols for /usr/local/apache2/modules/mod_auth_ldap.so\nReading symbols from /usr/local/apache2/modules/mod_ssl.so...done.\nLoaded symbols for /usr/local/apache2/modules/mod_ssl.so\nReading symbols from /usr/local/apache2/modules/mod_rewrite.so...done.\nLoaded symbols for /usr/local/apache2/modules/mod_rewrite.so\nReading symbols from /usr/local/apache2/modules/mod_perl.so...done.\nLoaded symbols for /usr/local/apache2/modules/mod_perl.so\nReading symbols from /usr/local/apache2/modules/mod_smbauth.so...done.\nLoaded symbols for /usr/local/apache2/modules/mod_smbauth.so\nReading symbols from /usr/local/apache2/modules/libphp5.so...done.\nLoaded symbols for /usr/local/apache2/modules/libphp5.so\nReading symbols from /usr/lib/libstdc++.so.5...done.\nLoaded symbols for /usr/lib/libstdc++.so.5\nReading symbols from\n/usr/local/mysql-4.1.11-i686-linux-rhel3/lib/mysql/libmysqlclient.so.14...done.\nLoaded symbols for /usr/local/mysql/lib/mysql/libmysqlclient.so.14\nReading symbols from /usr/local/lib/libsybdb.so.3...done.\nLoaded symbols for /usr/local/lib/libsybdb.so.3\nReading symbols from /usr/lib/libttf.so.2...done.\nLoaded symbols for /usr/lib/libttf.so.2\nReading symbols from /usr/lib/libpng12.so.0...done.\nLoaded symbols for /usr/lib/libpng12.so.0\nReading symbols from /usr/lib/libjpeg.so.62...done.\nLoaded symbols for /usr/lib/libjpeg.so.62\nReading symbols from /usr/lib/libxml2.so.2...done.\nLoaded symbols for /usr/lib/libxml2.so.2\nReading symbols from /lib/libgcc_s.so.1...done.\nLoaded symbols for /lib/libgcc_s.so.1\nReading symbols from /usr/lib/sasl/libanonymous.so...done.\nLoaded symbols for /usr/lib/sasl/libanonymous.so\nReading symbols from /usr/lib/sasl/libcrammd5.so...done.\nLoaded symbols for /usr/lib/sasl/libcrammd5.so\nReading symbols from /usr/lib/sasl/libdigestmd5.so...done.\nLoaded symbols for /usr/lib/sasl/libdigestmd5.so\nReading symbols from /usr/kerberos/lib/libdes425.so.3...done.\nLoaded symbols for /usr/kerberos/lib/libdes425.so.3\nReading symbols from /usr/lib/sasl/libgssapiv2.so...done.\nLoaded symbols for /usr/lib/sasl/libgssapiv2.so\nReading symbols from /usr/lib/sasl/liblogin.so...done.\nLoaded symbols for /usr/lib/sasl/liblogin.so\nReading symbols from /usr/lib/sasl/libplain.so...done.\nLoaded symbols for /usr/lib/sasl/libplain.so\nReading symbols from /lib/libnss_winbind.so.2...done.\nLoaded symbols for /lib/libnss_winbind.so.2\nReading symbols from /lib/libnss_dns.so.2...done.\nLoaded symbols for /lib/libnss_dns.so.2\n0x004972ff in malloc_consolidate () from /lib/tls/libc.so.6\n(gdb) bt full\n#0  0x004972ff in malloc_consolidate () from /lib/tls/libc.so.6\nNo symbol table info available.\n#1  0x00496af9 in _int_malloc () from /lib/tls/libc.so.6\nNo symbol table info available.\n#2  0x00495e9d in malloc () from /lib/tls/libc.so.6\nNo symbol table info available.\n#3  0x011261b8 in _emalloc (size=5611904) at\n/usr/local/src/apache2/php-5.0.4/Zend/zend_alloc.c:182\n        p = (zend_mem_header *) 0x559898\n        real_size = 1\n        cache_index = 464\n#4  0x01146d3a in zend_objects_store_init (objects=0x11e2fd4, init_size=1024)\n    at /usr/local/src/apache2/php-5.0.4/Zend/zend_objects_API.c:32\nNo locals.\n#5  0x0112d936 in init_executor () at\n/usr/local/src/apache2/php-5.0.4/Zend/zend_execute_API.c:174\nNo locals.\n#6  0x01136518 in zend_activate () at\n/usr/local/src/apache2/php-5.0.4/Zend/zend.c:787\nNo locals.\n#7  0x011090e0 in php_request_startup () at\n/usr/local/src/apache2/php-5.0.4/main/main.c:1031\n        orig_bailout = {{__jmpbuf = {1, 18755292, -1073762564, -1073762536,\n-1073762992, \n      18192962}, __mask_was_saved = 0, __saved_mask = {__val = {0 <repeats 32\ntimes>}}}}\n        orig_bailout_set = 1 '\\001'\n        retval = 0\n#8  0x01159cdf in php_handler (r=0x96e14c8)\n    at /usr/local/src/apache2/php-5.0.4/sapi/apache2handler/sapi_apache2.c:527\n        orig_bailout = {{__jmpbuf = {0, 0, 0, 0, 0, 0}, __mask_was_saved = 0,\n__saved_mask = {\n      __val = {0 <repeats 32 times>}}}}\n        ctx = (php_struct *) 0x96e2e70\n        brigade = (apr_bucket_brigade *) 0x96e2ee8\n        bucket = (apr_bucket *) 0x1\n        rv = 1\n        parent_req = (request_rec *) 0x0\n#9  0x0807cc36 in ap_run_handler (r=0x96e14c8) at config.c:153\n        pHook = (ap_LINK_handler_t *) 0x1\n        n = 10\n        rv = 1\n#10 0x0807d14e in ap_invoke_handler (r=0x96e14c8) at config.c:364\n        new_handler = 0x1d0 <Address 0x1d0 out of bounds>\n        p2 = 0x1 <Address 0x1 out of bounds>\n        handler = 0x951a000 \"application/x-httpd-php\"\n        result = 158209224\n        old_handler = 0x0\n#11 0x0806cda4 in ap_internal_redirect (new_uri=0x953cd70\n\"/errormsgs/denied.html\", r=0x96dd4f0)\n    at http_request.c:465\n        new = (request_rec *) 0x96e14c8\n        access_status = 1\n#12 0x0806c862 in ap_process_request (r=0x96dd4f0) at http_request.c:262\n        access_status = 464\n#13 0x08068939 in ap_process_http_connection (c=0x96d3078) at http_core.c:251\n        r = (request_rec *) 0x96dd4f0\n---Type <return> to continue, or q <return> to quit---\n        csd_set = 1\n        csd = (apr_socket_t *) 0x96d2fa0\n#14 0x08085ed6 in ap_run_process_connection (c=0x96d3078) at connection.c:43\n        pHook = (ap_LINK_process_connection_t *) 0x1\n        n = 1\n        rv = 1\n#15 0x0807b7af in child_main (child_num_arg=1) at prefork.c:610\n        ret = 1\n        n = 1\n        ptrans = (apr_pool_t *) 0x96d2f68\n        allocator = (apr_allocator_t *) 0x96d0ed8\n        current_conn = (conn_rec *) 0x96d3078\n        status = 158150776\n        i = 464\n        lr = (ap_listen_rec *) 0x96d3078\n        curr_pollfd = 464\n        last_pollfd = 0\n        pollset = (apr_pollfd_t *) 0x96d1018\n        offset = 1\n        csd = (void *) 0x96d2fa0\n        sbh = (ap_sb_handle_t *) 0x96d0fe8\n        rv = 1\n        bucket_alloc = (apr_bucket_alloc_t *) 0x96d74a0\n#16 0x0807b8cc in make_child (s=0x948b800, slot=7) at prefork.c:704\n        pid = 0\n#17 0x0807bb12 in perform_idle_server_maintenance (p=0x94870a8) at prefork.c:839\n        status = 1\n        i = 1\n        idle_count = 3\n        ws = (worker_score *) 0x1\n        free_length = 2\n        free_slots = {7, 8, 10924584, 10887327, 0, 0, 0, 0, 0, 0, 0, 0,\n10924584, 1000000, 0, \n  10901179, 0, 0, 0, 0, -1073762032, 0, 1000000, 0, 0, 0, -1073761976,\n-1073761936, 0, 0, \n  -1073761976, 134769469}\n        last_non_dead = 16\n        total_non_dead = 12\n#18 0x0807c0b2 in ap_mpm_run (_pconf=0x5, plog=0x94bf188, s=0x0) at prefork.c:1040\n        status = 0\n        pid = {pid = -1, in = 0x94c8190, out = 0x94c81a8, err = 0xa66a64}\n        child_slot = 5\n        exitwhy = APR_PROC_EXIT\n        processed_status = 0\n        index = 158325008\n        remaining_children_to_start = 0\n        rv = 1\n#19 0x0808109a in main (argc=4, argv=0xbfffb284) at main.c:618\n        exit_status = 0\n        c = 68 'D'\n        configtestonly = 0\n---Type <return> to continue, or q <return> to quit---\n        confname = 0x80a0e73 \"conf/httpd.conf\"\n        def_server_root = 0x80a1b18 \"/usr/local/apache2\"\n        temp_error_log = 0x0\n        process = (process_rec *) 0x9485120\n        server_conf = (server_rec *) 0x948b800\n        pglobal = (apr_pool_t *) 0x94850a0\n        pconf = (apr_pool_t *) 0x94870a8\n        plog = (apr_pool_t *) 0x94bf188\n        ptemp = (apr_pool_t *) 0x94c81a8\n        pcommands = (apr_pool_t *) 0x94890b0\n        opt = (apr_getopt_t *) 0x9489148\n        rv = 1\n        mod = (module **) 0x948b800\n        optarg = 0xbfffcf49 \"SSL\"\n        signal_server = (apr_OFN_ap_signal_server_t *) 0x1d0\n(gdb)", "count": 0, "id": 74316, "time": "2005-05-02T14:18:56Z", "creator": "eric@lib.usf.edu", "creation_time": "2005-05-02T14:18:56Z", "is_private": false}, {"text": "The crash is in PHP, but it looks like some kind of memory corruption: I don't\nknow if bug 34618 could have this symptom but it may be worth trying the patch\nwhich fixes that bug:\n\nhttp://issues.apache.org/bugzilla/attachment.cgi?id=14873\n\notherwise, restarting with \"export MALLOC_TRACE_=2\" in the environment and\ngetting a new backtrace might help narrow it down.", "tags": [], "bug_id": 34705, "attachment_id": null, "count": 1, "id": 74330, "time": "2005-05-02T20:26:11Z", "creator": "jorton@redhat.com", "creation_time": "2005-05-02T20:26:11Z", "is_private": false}, {"text": "The suggested patch appears to have fixed the issue.\n\nI assume we'll see it in 2.0.55?", "tags": [], "bug_id": 34705, "attachment_id": null, "count": 2, "id": 74430, "time": "2005-05-04T13:43:59Z", "creator": "eric@lib.usf.edu", "creation_time": "2005-05-04T13:43:59Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 34705, "attachment_id": null, "id": 74431, "time": "2005-05-04T14:03:12Z", "creator": "jorton@redhat.com", "creation_time": "2005-05-04T14:03:12Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of 34618 ***"}]
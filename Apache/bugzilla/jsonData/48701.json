[{"count": 0, "tags": [], "bug_id": 48701, "attachment_id": null, "text": "I've updated from tomcat6-6.0.18-9.jpp5 to tomcat6-6.0.24-2.jpp5\n\nThis breaks a lot of JSPs! Jasper simply denies to compile them. I hunted down the bug to a very simple example:\n\n<%@taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\" %>\n<c:set var=\"now\" value='<%= new java.util.Date() %>' />\n<jsp:getProperty name=\"now\" property=\"time\" />\n\nThis will simply output the current unix time (e.g. 1265641020987).\nOn tomcat 6.0.24 I get this:\n\norg.apache.jasper.JasperException: jsp:getProperty for bean with name 'now'. Name was not previously introduced as per JSP.5.3\n\tat org.apache.jasper.compiler.Generator$GenerateVisitor.visit(Generator.java:1083)\n\tat org.apache.jasper.compiler.Node$GetProperty.accept(Node.java:1124)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2361)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2411)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2417)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:495)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2361)\n\tat org.apache.jasper.compiler.Generator.generate(Generator.java:3383)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:216)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:332)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:312)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:299)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:589)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:317)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\nMy JDK is\njava version \"1.6.0_17\"\nJava(TM) SE Runtime Environment (build 1.6.0_17-b04)\nJava HotSpot(TM) Server VM (build 14.3-b01, mixed mode)\n\nPlease fix that! I assume that a lot of apps will break out there ...", "id": 134330, "time": "2010-02-08T07:02:56Z", "creator": "boris@folgmann.de", "creation_time": "2010-02-08T07:02:56Z", "is_private": false}, {"count": 1, "tags": [], "creator": "boris@folgmann.de", "attachment_id": null, "id": 134331, "time": "2010-02-08T07:29:50Z", "bug_id": 48701, "creation_time": "2010-02-08T07:29:50Z", "is_private": false, "text": "To make it even more clear, this works:\n\n<jsp:useBean id=\"now\" class=\"java.util.Date\" />\n<jsp:getProperty name=\"now\" property=\"time\" />\n\nBut getProperty always fails when the bean is not created with useBean. It's not specific to <c:set>. Other constructions also fail."}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 134332, "time": "2010-02-08T07:39:12Z", "bug_id": 48701, "creation_time": "2010-02-08T07:39:12Z", "is_private": false, "text": "As per the error message at the beginning of the stack trace, the JSP is not valid."}, {"count": 3, "tags": [], "bug_id": 48701, "attachment_id": null, "text": "(In reply to comment #2)\n> As per the error message at the beginning of the stack trace, the JSP is not\n> valid.\n\nI'll just add that <c:set> does not create a scripting variable, it creates a scoped variable. Here's part of the spec section referenced in the stack trace (JSP.5.3):\n\nThe object named by the name must have been \u201cintroduced\u201d to the JSP processor using either the jsp:useBean action or a custom action with an associated VariableInfo entry for this name. If the object was not introduced in this manner, the container implementation is recommended (but not required) to raise a translation error, since the page implementation is in violation of the specification.\n\nLooks like that's what's happening...", "id": 134333, "time": "2010-02-08T07:47:42Z", "creator": "kschneider@gmail.com", "creation_time": "2010-02-08T07:47:42Z", "is_private": false}, {"count": 4, "tags": [], "creator": "boris@folgmann.de", "text": "That's really bad because that worked up to 6.0.18. I can't remember any problems with such JSPs since tomcat 4 and 5. What about a compatibility switch to keep all that 3rd party apps from breaking?", "id": 134335, "time": "2010-02-08T08:29:26Z", "bug_id": 48701, "creation_time": "2010-02-08T08:29:26Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "Reopening.\n\nReviewing implementation of o.a.j.compiler.ScriptingVariabler and what the specification says about objects, scripting variables, and introducing them:\n\n\n1. In Tomcat code we make no distinction between variables declared programmatically (through VariableInfo) and through TLD (TagVariableInfo).\n\nBoth introduce a java language variable (aka scripting variable) in the generated code.\n\nFrom JSP.7.1.2 of JSP/2.2 spec:\n\n\"Finally, the XML document is processed to create a JSP page implementation\nclass. This process may involve creating scripting variables. Each custom action\nwill provide information about variables, either statically in the TLD, or more\nflexibly by using the getVariableInfo method of a TagExtraInfo class.\"\n\n- both ways introduce a variable\n\n\n2. About the wording of JSP.5.3 I think that\nThere is no explicit requirement in the Spec to use TagVariableInfo to implement variables introduced through TLD at the time when we are generating the servlet code.  Thus I think the spec mentions VariableInfo in JSP.5.3, making no distinction.  Also maybe the wording was remained intact since JSP/1.1, and variable declarations in TLDs were introduced in JSP/1.2.\n\n\nThe place to fix this issue would be\nGenerator#GeneratorVisitor#visit(Node.CustomTag)\n- see \"JSP.5.3\" mentioned in a comment there", "id": 134521, "time": "2010-02-15T17:14:25Z", "bug_id": 48701, "creation_time": "2010-02-15T17:14:25Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 48701, "text": "Agreed. TagVariableInfo should be just as acceptable for this purpose.\n\nI have fixed this in trunk and proposed it for 6.0.x", "id": 135174, "time": "2010-03-08T21:55:43Z", "creator": "markt@apache.org", "creation_time": "2010-03-08T21:55:43Z", "tags": [], "is_private": false}, {"count": 7, "attachment_id": null, "bug_id": 48701, "text": "In r920880 of trunk I added a system property to allow disabling enforcement of JSP.5.3. This is proposed for 6.0 and 5.5.", "id": 135194, "time": "2010-03-09T14:27:48Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-03-09T14:27:48Z", "tags": [], "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 48701, "text": "*** Bug 47822 has been marked as a duplicate of this bug. ***", "id": 135196, "time": "2010-03-09T14:30:47Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-03-09T14:30:47Z", "tags": [], "is_private": false}, {"count": 9, "attachment_id": null, "bug_id": 48701, "text": "This has been applied to 5.5.x and will be included in 5.5.30 onwards.", "id": 135999, "time": "2010-04-10T21:40:09Z", "creator": "markt@apache.org", "creation_time": "2010-04-10T21:40:09Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "creator": "markt@apache.org", "text": "This has been applied to 5.5.x and will be included in 5.5.30 onwards.", "id": 136000, "time": "2010-04-10T21:48:11Z", "bug_id": 48701, "creation_time": "2010-04-10T21:48:11Z", "is_private": false, "attachment_id": null}, {"count": 11, "attachment_id": null, "bug_id": 48701, "text": "The patch has been applied to 6.0.x and will be included in 6.0.27 onwards.", "id": 136005, "time": "2010-04-11T09:39:38Z", "creator": "markt@apache.org", "creation_time": "2010-04-11T09:39:38Z", "tags": [], "is_private": false}, {"count": 12, "tags": [], "creator": "kwalking@cisco.com", "attachment_id": null, "id": 139055, "time": "2010-08-11T15:44:50Z", "bug_id": 48701, "creation_time": "2010-08-11T15:44:50Z", "is_private": false, "text": "Still seeing this after upgrading to 6.0.29...\n\norg.apache.jasper.JasperException: jsp:getProperty for bean with name 'auth'. Name was not previously introduced as per JSP.5.3\n        at org.apache.tools.ant.ProjectHelper.addLocationToBuildException(ProjectHelper.java:574)\n        at org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:422)\n        at org.apache.tools.ant.taskdefs.CallTarget.execute(CallTarget.java:144)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:306)\n        at org.apache.tools.ant.Task.perform(Task.java:401)\n        at org.apache.tools.ant.Target.execute(Target.java:338)\n        at org.apache.tools.ant.Target.performTasks(Target.java:365)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1237)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1094)\n        at org.apache.tools.ant.Main.runBuild(Main.java:669)\n        at org.apache.tools.ant.Main.startAnt(Main.java:220)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:215)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:90)"}, {"count": 13, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "(In reply to comment #12)\nAre you sure, that your jsp page is valid? If you are, please attach a war file with a sample web application that reproduces the issue.\n\nNote, that since 5.5.30 and 6.0.27 (as already is mentioned) you can disable the check for conformance with JSP.5.3. by defining a certain system property.\n\nhttp://tomcat.apache.org/tomcat-6.0-doc/config/systemprops.html\n\nI am re-closing this as FIXED.", "id": 139058, "time": "2010-08-11T18:04:07Z", "bug_id": 48701, "creation_time": "2010-08-11T18:04:07Z", "is_private": false, "attachment_id": null}]
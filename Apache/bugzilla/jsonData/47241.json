[{"count": 0, "tags": [], "bug_id": 47241, "attachment_id": null, "id": 127263, "time": "2009-05-22T00:33:36Z", "creator": "bugzilla@schermesser.com", "creation_time": "2009-05-22T00:33:36Z", "is_private": false, "text": "If you write a RewriteRule that set a cookie which contains a ':', the mod_rewrite is interpreting the ':' as a separator character, but you have no away to escape that character, and it is a valid character for a cookie value.\n\nEg if you set this RewriteRule :\n\nRewriteRule ^/toto;jsessionid=(\\w+):(\\w+)   - [cookie=JSESSIONID:$1:$2:%{HTTP_HOST}]\n\nYou have no way to set the cookie name at \"JSESSIONID\" and it's value at \"$1:$2\""}, {"count": 1, "text": "Created attachment 23705\nPatch File \n\nHere is a patch that fixes the issue.\n\nThe idea of the patch is quite simple.\n\nThe character ';' is not allowed in a cookie (cf. RFC).\n\nSo if there is a ';' in the string of the cookie then the separator used is ';' and not ':'.\nBut if there is no ';' in the string the default separator ':' is used. This is to unsure backward compatibility.", "creator": "bugzilla@schermesser.com", "attachment_id": 23705, "id": 127264, "time": "2009-05-22T00:36:57Z", "bug_id": 47241, "creation_time": "2009-05-22T00:36:57Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 47241, "attachment_id": null, "text": "How about\n\nRewriteRule ^/toto;jsessionid=(\\w+)(:)(\\w+)   -\n[cookie=JSESSIONID:$1$2$3:%{HTTP_HOST}]\n\n?", "id": 127265, "time": "2009-05-22T00:59:15Z", "creator": "rpluem@apache.org", "creation_time": "2009-05-22T00:59:15Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jonathan@phillipoux.net", "text": "I'm jumping in here, since I worked on this patch with the original reporter.\n\nUsing:\nRewriteRule ^/toto;jsessionid=(\\w+)(:)(\\w+)   -\n[cookie=JSESSIONID:$1$2$3:%{HTTP_HOST}]\n\nProduces exactly the same result as the rule in the bug description. This is because all variables are replaced in the do_expand function, before getting to add_cookie, which splits fields on the \":\" character, and the input string already has an extra \":\".", "id": 127268, "time": "2009-05-22T01:54:13Z", "bug_id": 47241, "creation_time": "2009-05-22T01:54:13Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 47241, "attachment_id": null, "id": 127353, "time": "2009-05-24T23:24:56Z", "creator": "jonathan@phillipoux.net", "creation_time": "2009-05-24T23:24:56Z", "is_private": false, "text": "Some additional info: using either the RewriteRule from the description or comment #2, the rewrite log with RewriteLogLevel 9 is:\n\n127.0.0.1 - - [25/May/2009:08:22:57 +0200] [localhost/sid#b9d11ed8][rid#b9eac1a0/initial] (2) init rewrite engine with requested uri /toto;jsessionid=abc:def\n127.0.0.1 - - [25/May/2009:08:22:57 +0200] [localhost/sid#b9d11ed8][rid#b9eac1a0/initial] (3) applying pattern '^/toto;jsessionid=(\\w+)(:)(\\w+)' to uri '/toto;jsessionid=abc:def'\n127.0.0.1 - - [25/May/2009:08:22:57 +0200] [localhost/sid#b9d11ed8][rid#b9eac1a0/initial] (5) setting cookie 'JSESSIONID=abc; path=/; domain=def; expires=Mon, 25-May-2009 06:22:57 GMT'\n127.0.0.1 - - [25/May/2009:08:22:57 +0200] [localhost/sid#b9d11ed8][rid#b9eac1a0/initial] (1) pass through /toto;jsessionid=abc:def"}, {"count": 5, "text": "Doesn't any value with a colon (or any other rfc2616 separator) need to be quoted? IMO it would be better if rewrite short-circuited tokenizing based on that, but I didn't test.", "creator": "covener@gmail.com", "is_private": false, "id": 127383, "time": "2009-05-25T08:29:24Z", "bug_id": 47241, "creation_time": "2009-05-25T08:29:24Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 47241, "attachment_id": null, "text": "*** Bug 44647 has been marked as a duplicate of this bug. ***", "id": 127728, "time": "2009-06-07T23:56:42Z", "creator": "jonathan@phillipoux.net", "creation_time": "2009-06-07T23:56:42Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 47241, "is_private": false, "text": "*** Bug 31781 has been marked as a duplicate of this bug. ***", "id": 127730, "time": "2009-06-07T23:58:12Z", "creator": "jonathan@phillipoux.net", "creation_time": "2009-06-07T23:58:12Z", "attachment_id": null}, {"count": 8, "text": "Hi,\n\nJust some details about separator characters to respond to Eric's comment.\n\nRFC 2109 and the newer 2965 (\"HTTP State Management Mechanism\" aka Cookies) states that within in the Set-Cookie, Set-Cookie2, Cookie and Cookie2 headers the syntax is of attr=value pairs, separated by semi-colons (\";\") or commas (\",\").\n\nAny other special characters as defined in RFC 2616 are allowed in cookie values, although they should presumably be \"-quoted to respect RFC 2616. This means that a colon (\":\") is a legal value in cookie attr=value pairs.\n\nmod_rewrite strips all character escaping before reaching the set_cookie function. Therefore, the set_cookie function can only work with non-escaped text. \n\nIt seems to me to make sense to use semi-colon (\";\") as a separator for cookie parts in mod_rewrite syntax, instead of colon (\":\"), since this is a separator character anyway. The attached patch implements this proposition.\n\nI hope this clarifies the problem and the proposed solution, and can be considered for inclusion in Apache. Please let us know any comments on this.\n\nRegards,\nJonathan", "creator": "jonathan@phillipoux.net", "is_private": false, "id": 127731, "time": "2009-06-08T01:13:17Z", "bug_id": 47241, "creation_time": "2009-06-08T01:13:17Z", "tags": [], "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 47241, "is_private": false, "text": "Sorry that this report did not get the needed attention. I've checked in a patch based on the original submitted patch with a few changes and proposed it for 2.4.x.  \n\nhttp://svn.apache.org/viewvc?view=revision&revision=1693963\n\nThe config is a little more explicit, without adding a new flag/rewriteoption and without scanning the parameter -- you must opt-in with the first character of the parameter as a ';'.", "id": 184287, "time": "2015-08-03T20:13:45Z", "creator": "covener@gmail.com", "creation_time": "2015-08-03T20:13:45Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 47241, "attachment_id": null, "id": 185920, "time": "2015-10-25T05:47:04Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2015-10-25T05:47:04Z", "is_private": false, "text": "This is part of 2.4.17"}]
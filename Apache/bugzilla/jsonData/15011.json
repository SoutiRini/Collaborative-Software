[{"count": 0, "tags": [], "text": "I recently upgraded a server from 1.3.20 to 1.3.26 only to find that keepalive \ntimeouts are not enforced once a child has served more than one client.\n\nThe easiest way to see this on our build was to issue the following request.\n\nGET / HTTP/1.1\nHost: server.com\nConnection: Keep-Alive\n\nWe have Apache/1.3.26 (Unix) mod_perl/1.26 mod_ssl/2.8.10 OpenSSL/0.9.6g\n\nThe second time that a child is used, the 15 second timeout is ignored and the \nprocess hangs for hours in the K (KeepAlive) state in /server-status (until the \nTCP connection times out or is closed by the client).\n\nOn a busy server eventually these hung child processes build up and deny \nlegitimate service.\n\nI believe this is related to revision 1.585 of http_main.c and have produced a \nfix by changing this code block at line 4916 in 1.3.26:\n\n#if defined(CYGWIN) \n#define SIG_IDLE_KILL SIGKILL \n#define SIG_TIMEOUT_KILL SIGUSR2 \n#else \n#define SIG_IDLE_KILL SIGUSR1 \n#define SIG_TIMEOUT_KILL SIGALRM \n#endif \n\nto\n\n#if defined(CYGWIN) || defined(SOLARIS2)\n#define SIG_IDLE_KILL SIGKILL \n#define SIG_TIMEOUT_KILL SIGUSR2 \n#else \n#define SIG_IDLE_KILL SIGUSR1 \n#define SIG_TIMEOUT_KILL SIGALRM \n#endif\n\nI gather solaris must have problems passing the SIGALRM signal. I also followed \nthe cygwin route of using SIGKILL to kill idle processes since it appears to \nwork where SIGUSR1 does not.", "attachment_id": null, "bug_id": 15011, "id": 27294, "time": "2002-12-03T00:39:17Z", "creator": "Graham.Stewart@sun.com", "creation_time": "2002-12-03T00:39:17Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 15011, "attachment_id": null, "id": 27295, "time": "2002-12-03T00:51:35Z", "creator": "trawick@apache.org", "creation_time": "2002-12-03T00:51:35Z", "is_private": false, "text": "Several people have seen this on Solaris over the years.  It apparently\nis unrelated to the change you alluded to.\n\nCan you try the patch here instead?\n\nhttp://www.faqchest.com/prgm/apach-l/apach-00/apach-0011/apach-001121/apach00113017_27195.html\n\nDo you have any threaded plug-in modules?\n"}, {"count": 2, "tags": [], "text": "Thanks for the quick response,\n\nI'm confused by the fact that 1.3.20 with OpenSSL 0.9.6b did not exhibit this \nproblem.\n\nI upgraded apache & openssl and suddenly the problem existed. The only \ndifference which I am aware of seems to be that I upgraded the max child count \nto 4096 from 256.\n\nI'd imagine if something is masking the SIGALRM then using a different signal \nmight well work, although I was hoping someone might know what caused this \nproblem.\n\nI'll try to build with the patch you suggest and see if that works too.\n", "attachment_id": null, "id": 27297, "creator": "Graham.Stewart@sun.com", "time": "2002-12-03T01:30:22Z", "bug_id": 15011, "creation_time": "2002-12-03T01:30:22Z", "is_private": false}]
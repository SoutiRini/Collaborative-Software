[{"count": 0, "tags": [], "creator": "claus@faerber.name", "text": "If a CGI script sends a \"Status: 200 OK\" header along with a valid\n\"Last-Modified\" header, Apache2 sends the 200 status code along with the\ntruncated response if the  browser sends a matching \"If-Modified-Since\" header.\n\nApache2 should also modify the status code to 304 if it truncates the response.\n\nAs a workaround, one can remove the \"Status: 200 OK\" line from the CGI response.\n\nExample CGI script (any POSIX-compatible host):\n---\n#!/bin/sh\ncat <<__EOF__\nStatus: 200 OK\nContent-Type: text/html; charset=UTF-8\nLast-Modified: Tue, 26 Dec 2006 12:00:00 GMT\n\nBOO!\n__EOF__\n---\n\nExample Ethereal trace (with IE 7, host name changed):\n---\nGET /test.cgi HTTP/1.1\nAccept: */*\nAccept-Language: de\nUA-CPU: x86\nAccept-Encoding: gzip, deflate\nIf-Modified-Since: Tue, 26 Dec 2006 12:00:00 GMT\nUser-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR\n1.0.3705; .NET CLR 1.1.4322; .NET CLR 2.0.50727; Media Center PC 4.0)\nHost: www.example.org\nConnection: Keep-Alive\n\n---\nHTTP/1.0 200 OK\nDate: Tue, 26 Dec 2006 16:47:53 GMT\nServer: Apache/2.0.54 (Debian GNU/Linux) mod_auth_pgsql/2.0.2b1\nmod_ldap_userdir/1.1.7 PHP/4.3.10-18 mod_ssl/2.0.54 OpenSSL/0.9.7e\nmod_perl/1.999.21 Perl/v5.8.4\nConnection: close\n\n\n---\nThe response should say \"HTTP/1.1 304 Not modified\"", "id": 97340, "time": "2006-12-26T08:56:04Z", "bug_id": 41245, "creation_time": "2006-12-26T08:56:04Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 41245, "text": "I forgot to mention that the correct status code is written to the log:\n---\np54973b57.dip0.t-ipconnect.de - - [26/Dec/2006:17:47:53 +0100] \"GET /test.cgi\nHTTP/1.1\" 304 - \"-\" \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR\n1.0.3705; .NET CLR 1.1.4322; .NET CLR 2.0.50727; Media Center PC 4.0)\"\n---", "count": 1, "id": 97341, "time": "2006-12-26T09:05:43Z", "creator": "claus@faerber.name", "creation_time": "2006-12-26T09:05:43Z", "is_private": false}, {"count": 2, "tags": [], "text": "If a CGI script emits a Status: header, then CGI takes responsibility for it. \nApache can make that decision if and only if CGI is silent on the subject.\n\nHere's from the CGI spec:\n\n7.2.1.3. Status  \n The \"Status\" header field is used to indicate to the server what status code \nthe server MUST use in the response message.\n\n", "attachment_id": null, "bug_id": 41245, "id": 97342, "time": "2006-12-26T10:16:36Z", "creator": "nick@webthing.com", "creation_time": "2006-12-26T10:16:36Z", "is_private": false}, {"count": 3, "tags": [], "creator": "claus@faerber.name", "attachment_id": null, "text": "Regardless of what a non-official draft specification says, the server must not\nremove header fields (such as \"Last-Modified\" and \"Content-Type\") and keep the\nstatus code. By doing this, Apache2 _does_ take responsibility that the new\nresponse be semantically correct.\n\nIt can't be correct behaviour that a CGI script sends a complete, valid response\n(\"200 OK\"), which is then corrupted by the server in that way.\n\nThere are IMO two options to handle such situations:\n1. A server must not change the semantics of the response AT ALL.\n2. A server can be seen as some sort of proxy which is allowed to change the\nresponse in CONSISTENT ways.\n\nIt seems that the CGI draft specification implies #1, while Apache actually does\n#2 in an inconsistent(!) way.", "id": 97344, "time": "2006-12-26T11:35:04Z", "bug_id": 41245, "creation_time": "2006-12-26T11:35:04Z", "is_private": false}, {"count": 4, "tags": [], "creator": "nick@webthing.com", "text": "You're using an old Apache version.  It was fixed on Feb. 4th.\n", "id": 97345, "time": "2006-12-26T12:05:01Z", "bug_id": 41245, "creation_time": "2006-12-26T12:05:01Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 41245, "text": "(In reply to comment #4)\n> You're using an old Apache version.  It was fixed on Feb. 4th.\n> \n\nI suppose I should've given references for that:\nFixed in:  \n trunk: http://svn.apache.org/viewcvs?rev=370692&view=rev  \n 2.0:   http://svn.apache.org/viewcvs?rev=374894&view=rev \n 2.2:   http://svn.apache.org/viewcvs?rev=374895&view=rev ", "id": 97346, "time": "2006-12-26T12:09:16Z", "creator": "nick@webthing.com", "creation_time": "2006-12-26T12:09:16Z", "is_private": false, "attachment_id": null}]
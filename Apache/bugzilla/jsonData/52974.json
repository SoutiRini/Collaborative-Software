[{"count": 0, "tags": [], "bug_id": 52974, "attachment_id": 28500, "is_private": false, "id": 155248, "time": "2012-03-22T20:43:20Z", "creator": "violetagg@apache.org", "creation_time": "2012-03-22T20:43:20Z", "text": "Created attachment 28500\nPatch proposal\n\nHi,\n\nI have a web application (attached) that has a Servlet with an annotated (@Resource) field and an annotated (@Resource) method.\n\nWhen I request the Servlet I'm receiving:\n\njavax.naming.NameNotFoundException: Name test.TestServlet is not bound in this Context\n  org.apache.naming.NamingContext.lookup(NamingContext.java:820)\n  org.apache.naming.NamingContext.lookup(NamingContext.java:168)\n  org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:472)\n  org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)\n\n\nI searched the sources and found that org.apache.catalina.startup.WebAnnotationSet processes and prepares for binding only @Resource annotation on a class level. However org.apache.catalina.core.DefaultInstanceManager tries to process @Resource annotation on field/method level and to inject the necessary Object. Unfortunately as the information is not processed and bound in the naming previously, NameNotFoundException is thrown.\n\nI would like to propose a patch (attached).\n\nI'm looking forward to your comments.\n\nThanks in advance.\n\nRegards\nVioleta Georgieva\n\n\nSteps to reproduce the issue:\n\n1. Deploy the attached web application\n2. Request http://localhost:8080/test/TestServlet\n3. NameNotFoundException is thrown\n4. Apply the patch and restart Tomcat\n5. Request http://localhost:8080/test/TestServlet\n6. You should see in the browser \"Annotated field: test Annotated method: test1\""}, {"count": 1, "tags": [], "bug_id": 52974, "attachment_id": 28501, "id": 155249, "time": "2012-03-22T20:45:03Z", "creator": "violetagg@apache.org", "creation_time": "2012-03-22T20:45:03Z", "is_private": false, "text": "Created attachment 28501\nSample application"}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 155324, "time": "2012-03-27T19:28:05Z", "bug_id": 52974, "creation_time": "2012-03-27T19:28:05Z", "is_private": false, "text": "Many thanks for the patch.\n\nIt has been applied to trunk and 7.0.x and will be included in 7.0.27 onwards."}, {"count": 3, "tags": [], "bug_id": 52974, "attachment_id": null, "is_private": false, "id": 155352, "time": "2012-03-28T20:50:47Z", "creator": "violetagg@apache.org", "creation_time": "2012-03-28T20:50:47Z", "text": "Thanks and Regards\nVioleta"}]
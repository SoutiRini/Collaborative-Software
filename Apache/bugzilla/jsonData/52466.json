[{"count": 0, "tags": [], "text": "It seems upgrade system is broken.\nTrying to add properties to handle upgrade for 52048, I noticed only NameUpdater#getCurrentName(String className) was used.\n\nOther methods that upgrade property names are not used so rules like:\norg.apache.jmeter.protocol.jdbc.config.DataSourceElement/JDBCSampler.url=dbUrl\n\nor org.apache.jmeter.config.ConfigTestElement|org.apache.jmeter.protocol.jdbc.config.gui.DbConfigGui=org.apache.jmeter.protocol.jdbc.config.DataSourceElement\n\ndon't work.\n\n\n\nShould we fix this or abandon feature ?", "attachment_id": null, "bug_id": 52466, "id": 152763, "time": "2012-01-13T22:28:20Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-01-13T22:28:20Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 52466, "attachment_id": null, "id": 152764, "time": "2012-01-13T22:29:20Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-01-13T22:29:20Z", "is_private": false, "text": "Affects 2.5.1."}, {"count": 2, "tags": [], "text": "The methods were originally all used by the OldSaveService class.\nThis handled the previous JMX format (Avalon).\nSupport for this format (and the OldSaveService class) was dropped in JMeter 2.4.\n\nIt's not clear why the methods were/are not used by the classes that handle the new format (which is loaded using XStream). Looks like this is an accidental omission that was never previously noticed.\n\nIt's also not clear why the getCurrentName(String) method is called by JMeterTreeModel, rather than the class that reads the JMX file format. \nThis was added to JMeterTreeModel in r323315, but the SVN log entry is not very explicit about why the change was done there, rather than when reading the JMX file.\n\nI think the old names can only originate from a JMX file, so if they are fixed as part of reading the file, then there should be no need to deal with the old names anywhere else in JMeter.", "is_private": false, "id": 152822, "creator": "sebb@apache.org", "time": "2012-01-16T10:45:11Z", "bug_id": 52466, "creation_time": "2012-01-16T10:45:11Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 52466, "attachment_id": null, "id": 152838, "time": "2012-01-16T21:22:46Z", "creator": "sebb@apache.org", "creation_time": "2012-01-16T21:22:46Z", "is_private": false, "text": "For reference, here's how the methods were used in OldSaveService.java [1]\n\nprivate static TestElement createTestElement(...){\n    ...\n    testClass = value of \"class\" attribute\n    gui_class = value of guiClass property\n    ...\n    newClass = NameUpdater.getCurrentTestName(testClass,gui_class);\n    element = (TestElement) Class.forName(newClass).newInstance();\n...\n}\n\nThe above method was used for creating all TestElement instances.\n\nprivate static JMeterProperty createProperty(...){\n    ...\n        // Do upgrade translation:\n        name = NameUpdater.getCurrentName(name, testClass);\n        if (TestElement.GUI_CLASS.equals(name)) {\n            value = NameUpdater.getCurrentName(value);\n        } else if (TestElement.TEST_CLASS.equals(name)) {\n            value=testClass; // must always agree\n        } else {\n            value = NameUpdater.getCurrentName(value, name, testClass);\n        }\n\n        // Delete any properties whose name converts to the empty string\n        if (oname.length() != 0 && name.length()==0) {\n            return null;\n        }\n\n        // Create the property:\n    ...\n}\n\nThe above method was used for creating all properties.\n\n[1] https://svn.apache.org/repos/asf/jmeter/tags/v2_3_4/src/core/org/apache/jmeter/save/OldSaveService.java"}, {"count": 4, "tags": [], "bug_id": 52466, "attachment_id": null, "id": 152855, "time": "2012-01-17T19:58:16Z", "creator": "sebb@apache.org", "creation_time": "2012-01-17T19:58:16Z", "is_private": false, "text": "Fixed in SVN:\n\nURL: http://svn.apache.org/viewvc?rev=1232550&view=rev\nLog:\nBug 52466 - Upgrade Test Plan feature : NameUpdater does not upgrade properties\n\nModified:\n   jmeter/trunk/bin/testfiles/GuiTest.jmx\n   jmeter/trunk/src/core/org/apache/jmeter/gui/tree/JMeterTreeModel.java\n   jmeter/trunk/src/core/org/apache/jmeter/save/SaveService.java\n   jmeter/trunk/src/core/org/apache/jmeter/save/converters/BooleanPropertyConverter.java\n   jmeter/trunk/src/core/org/apache/jmeter/save/converters/ConversionHelp.java\n   jmeter/trunk/src/core/org/apache/jmeter/save/converters/IntegerPropertyConverter.java\n   jmeter/trunk/src/core/org/apache/jmeter/save/converters/LongPropertyConverter.java\n   jmeter/trunk/src/core/org/apache/jmeter/save/converters/StringPropertyConverter.java\n   jmeter/trunk/src/core/org/apache/jmeter/save/converters/TestElementConverter.java\n   jmeter/trunk/src/reports/org/apache/jmeter/report/gui/tree/ReportTreeModel.java\n   jmeter/trunk/xdocs/changes.xml\n\n\nURL: http://svn.apache.org/viewvc?rev=1232554&view=rev\nLog:\nBug 52466 - Upgrade Test Plan feature : NameUpdater does not upgrade properties\nAllow for deleted properties\n\nModified:\n   jmeter/trunk/src/core/org/apache/jmeter/save/converters/MultiPropertyConverter.java\n   jmeter/trunk/src/core/org/apache/jmeter/save/converters/TestElementConverter.java\n   jmeter/trunk/src/core/org/apache/jmeter/save/converters/TestElementPropertyConverter.java"}, {"count": 5, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": 28171, "text": "Created attachment 28171\nTest Plan to upgrade\n\nTest Plan to use to see strange behaviour", "id": 152904, "time": "2012-01-18T22:07:58Z", "bug_id": 52466, "creation_time": "2012-01-18T22:07:58Z", "is_private": false}, {"count": 6, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "I am not sure this issue is fixed.\nWorking on Bug 52048, I updated upgrade.properties to ensure compatibility.\nI noticed upgrade is not working properly.\n\nI don't think issue is in patch (at least all except upgrade.properties) so I suspect an issue in upgrade.\n\n\nTo reproduce issue, apply patch on Bug 52048 then try to upgrade attached Test Plan, you will see that the second BSH Sampler gets the same configuration as the first one.", "id": 152905, "time": "2012-01-18T22:11:06Z", "bug_id": 52466, "creation_time": "2012-01-18T22:11:06Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 52466, "attachment_id": null, "is_private": false, "id": 152910, "time": "2012-01-19T01:17:51Z", "creator": "sebb@apache.org", "creation_time": "2012-01-19T01:17:51Z", "text": "Oops! wrong variable was being returned.\n\nURL: http://svn.apache.org/viewvc?rev=1233146&view=rev\nLog:\nBug 52466 - Upgrade Test Plan feature : NameUpdater does not upgrade properties (r1227589)\nFix typo: was returning original name rather than the updated property name\n\nModified:\n   jmeter/trunk/src/core/org/apache/jmeter/save/converters/ConversionHelp.java"}, {"count": 8, "tags": [], "text": "Another fix needed to handle top level elements.\n\nURL: http://svn.apache.org/viewvc?rev=1235564&view=rev\nLog:\nBug 52466 - Upgrade Test Plan feature : NameUpdater does not upgrade properties (r1227589)\nAlso need to upgrade top-level element names", "attachment_id": null, "id": 153130, "creator": "sebb@apache.org", "time": "2012-01-25T00:05:00Z", "bug_id": 52466, "creation_time": "2012-01-25T00:05:00Z", "is_private": false}]
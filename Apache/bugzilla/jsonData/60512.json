[{"count": 0, "text": "The XSSFRelation doesn't have a relation of type Custom property. Hence while cloning a sheet (XSSFSheet) containing a custom property relation type, it generates an exception \n\nPOIXMLException: Can't clone sheet - unknown relation type found: http://schemas.openxmlformats.org/officeDocument/2006/relationships/customProperty\n\n(XSSFWorkbook.java)\n\n private static void addRelation(RelationPart rp, POIXMLDocumentPart target) {\n        PackageRelationship rel = rp.getRelationship();\n        if (rel.getTargetMode() == TargetMode.EXTERNAL) {\n            target.getPackagePart().addRelationship(\n                rel.getTargetURI(), rel.getTargetMode(), rel.getRelationshipType(), rel.getId());\n        } else {        \n            XSSFRelation xssfRel = XSSFRelation.getInstance(rel.getRelationshipType());\n            if (xssfRel == null) {\n                // Don't copy all relations blindly, but only the ones we know about\n                throw new POIXMLException(\"Can't clone sheet - unknown relation type found: \"+rel.getRelationshipType());\n            }\n            target.addRelation(rel.getId(), xssfRel, rp.getDocumentPart());\n        }\n    }\n\nYou can find more infos here: http://people.apache.org/~centic/poi_regression/reportsAll/", "bug_id": 60512, "attachment_id": null, "id": 195614, "time": "2016-12-22T14:55:14Z", "creator": "samsontesfay@tagetik.com", "creation_time": "2016-12-22T14:55:14Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "A possible fix: add a new XSSFRelation (XSSFRelation.java)\n\n    \n    public static final XSSFRelation CUSTOM_PROPERTIES = new XSSFRelation(\n    \t\t\"application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty\",\n            \"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customProperty\",\n            \"/xl/customProperty#.bin\",\n            null\n        );", "attachment_id": null, "bug_id": 60512, "id": 195615, "time": "2016-12-22T15:19:11Z", "creator": "samsontesfay@tagetik.com", "creation_time": "2016-12-22T15:19:11Z", "is_private": false}, {"count": 2, "tags": [], "text": "Can you attch a sample workbook with a custom relation so that we can write a unit test for this?\nCode that adds a custom relation to a blank workbook works too.", "attachment_id": null, "id": 195669, "creation_time": "2016-12-27T18:25:20Z", "time": "2016-12-27T18:25:20Z", "creator": "onealj@apache.org", "bug_id": 60512, "is_private": false}, {"count": 3, "tags": [], "creator": "samsontesfay@tagetik.com", "attachment_id": 34570, "is_private": false, "id": 195721, "time": "2016-12-30T14:11:35Z", "bug_id": 60512, "creation_time": "2016-12-30T14:11:35Z", "text": "Created attachment 34570\nTestCloneSheetWithCustomProperty\n\nHere I have attached a sample excel file which contains a custom property (i.e. raises an exception when the contained sheet is to be cloned)."}, {"count": 4, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "is_private": false, "id": 195724, "time": "2016-12-30T16:55:50Z", "bug_id": 60512, "creation_time": "2016-12-30T16:55:50Z", "text": "Applied via r1776606, thanks for the suggested patch."}]
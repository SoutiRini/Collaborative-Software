[{"count": 0, "tags": [], "creator": "petterb@gmail.com", "attachment_id": null, "id": 155009, "time": "2012-03-17T23:45:22Z", "bug_id": 52935, "creation_time": "2012-03-17T23:45:22Z", "is_private": false, "text": "Responds with '404 Not Found',\n\nWorks in 2.2.22, same config.\n\nWorks fine without env (ProxyPass / http;//duckduckgo.com/)\n\n\n$ cat /usr/local/apache2/conf/extra/httpd-vhosts.conf\nLogLevel proxy:trace8\n\n<VirtualHost _default_:80>\n#   SetEnv duck duckduckgo.com\n    SetEnvIf Request_URI \".*\" duck=duckduckgo.com\n#   RewriteEngine On\n#   RewriteRule ^ - [E=duck:duckduckgo.com]\n\n    ProxyRequests Off \n    ProxyPassInterpolateEnv On\n    ProxyPass / http://${duck}/ interpolate\n#   ProxyPass / http://duckduckgo.com/\n#   Header set duck \"%{duck}e on 2.4.1\"\n</VirtualHost>\n\n\n$ sudo /usr/local/apache2/bin/apachectl -k start; tail -fn0 /usr/local/apache2/logs/error_log \n[Sun Mar 18 00:39:33.582614 2012] [core:warn] [pid 14233:tid 140214237484864] AH00111: Config variable ${duck} is not defined\n[Sun Mar 18 00:39:33.590089 2012] [proxy:debug] [pid 14236:tid 140214237484864] proxy_util.c(1640): AH00925: initializing worker proxy:reverse shared\n[Sun Mar 18 00:39:33.590134 2012] [proxy:debug] [pid 14236:tid 140214237484864] proxy_util.c(1680): AH00927: initializing worker proxy:reverse local\n[Sun Mar 18 00:39:33.590172 2012] [mpm_event:notice] [pid 14234:tid 140214237484864] AH00489: Apache/2.4.1 (Unix) configured -- resuming normal operations\n[Sun Mar 18 00:39:33.590189 2012] [mpm_event:info] [pid 14234:tid 140214237484864] AH00490: Server built: Mar 15 2012 14:52:12\n[Sun Mar 18 00:39:33.590195 2012] [proxy:debug] [pid 14236:tid 140214237484864] proxy_util.c(1712): AH00930: initialized pool in child 14236 for (*) min=0 max=25 smax=25\n[Sun Mar 18 00:39:33.590206 2012] [proxy:debug] [pid 14236:tid 140214237484864] proxy_util.c(1640): AH00925: initializing worker http://${duck}/ shared\n[Sun Mar 18 00:39:33.590220 2012] [proxy:debug] [pid 14236:tid 140214237484864] proxy_util.c(1680): AH00927: initializing worker http://${duck}/ local\n[Sun Mar 18 00:39:33.590221 2012] [core:notice] [pid 14234:tid 140214237484864] AH00094: Command line: '/usr/local/apache2/bin/httpd'\n[Sun Mar 18 00:39:33.590241 2012] [proxy:debug] [pid 14236:tid 140214237484864] proxy_util.c(1712): AH00930: initialized pool in child 14236 for (${duck}) min=0 max=25 smax=25\n[Sun Mar 18 00:39:33.590236 2012] [proxy:debug] [pid 14237:tid 140214237484864] proxy_util.c(1640): AH00925: initializing worker proxy:reverse shared\n[Sun Mar 18 00:39:33.590266 2012] [proxy:debug] [pid 14237:tid 140214237484864] proxy_util.c(1680): AH00927: initializing worker proxy:reverse local\n[Sun Mar 18 00:39:33.590313 2012] [proxy:debug] [pid 14237:tid 140214237484864] proxy_util.c(1712): AH00930: initialized pool in child 14237 for (*) min=0 max=25 smax=25\n[Sun Mar 18 00:39:33.590347 2012] [proxy:debug] [pid 14237:tid 140214237484864] proxy_util.c(1640): AH00925: initializing worker http://${duck}/ shared\n[Sun Mar 18 00:39:33.590366 2012] [proxy:debug] [pid 14237:tid 140214237484864] proxy_util.c(1680): AH00927: initializing worker http://${duck}/ local\n[Sun Mar 18 00:39:33.590379 2012] [proxy:debug] [pid 14237:tid 140214237484864] proxy_util.c(1712): AH00930: initialized pool in child 14237 for (${duck}) min=0 max=25 smax=25\n[Sun Mar 18 00:39:33.590567 2012] [proxy:debug] [pid 14238:tid 140214237484864] proxy_util.c(1640): AH00925: initializing worker proxy:reverse shared\n[Sun Mar 18 00:39:33.590596 2012] [proxy:debug] [pid 14238:tid 140214237484864] proxy_util.c(1680): AH00927: initializing worker proxy:reverse local\n[Sun Mar 18 00:39:33.590640 2012] [proxy:debug] [pid 14238:tid 140214237484864] proxy_util.c(1712): AH00930: initialized pool in child 14238 for (*) min=0 max=25 smax=25\n[Sun Mar 18 00:39:33.590651 2012] [proxy:debug] [pid 14238:tid 140214237484864] proxy_util.c(1640): AH00925: initializing worker http://${duck}/ shared\n[Sun Mar 18 00:39:33.590663 2012] [proxy:debug] [pid 14238:tid 140214237484864] proxy_util.c(1680): AH00927: initializing worker http://${duck}/ local\n[Sun Mar 18 00:39:33.590687 2012] [proxy:debug] [pid 14238:tid 140214237484864] proxy_util.c(1712): AH00930: initialized pool in child 14238 for (${duck}) min=0 max=25 smax=25\n[Sun Mar 18 00:39:38.202264 2012] [core:info] [pid 14237:tid 140214135572224] [client ::1:60421] AH00128: File does not exist: proxy:http://duckduckgo.com/\n\n\n$ /usr/local/apache2/bin/apachectl -V\nServer version: Apache/2.4.1 (Unix)\nServer built:   Mar 15 2012 14:52:12\nServer's Module Magic Number: 20120211:0\nServer loaded:  APR 1.4.5, APR-UTIL 1.4.1\nCompiled using: APR 1.4.5, APR-UTIL 1.4.1\nArchitecture:   64-bit\nServer MPM:     event\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=256\n -D HTTPD_ROOT=\"/usr/local/apache2\"\n -D SUEXEC_BIN=\"/usr/local/apache2/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\n\n$ cat config.nice \n#! /bin/sh\n#\n# Created by configure\n\n\"./configure\" \\\n\"$@\""}, {"count": 1, "tags": [], "text": "Seem to have found a fix in mod_proxy.c child_init(). By adding the line:\n\nconf->reverse = reverse;\n\nto the end of the while loop. (As it is in httpd 2.2.22).\n\n\nOtherwise it would fail to find a reverse proxy worker in proxy.util.c ap_proxy_pre_request(), because conf->reverse would be NULL.\nAnd then proxy_handler() would return HTTP_SERVICE_UNAVAILABLE.", "is_private": false, "bug_id": 52935, "id": 155043, "time": "2012-03-19T13:19:55Z", "creator": "petterb@gmail.com", "creation_time": "2012-03-19T13:19:55Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 52935, "text": "*** Bug 52902 has been marked as a duplicate of this bug. ***", "count": 2, "id": 155046, "time": "2012-03-19T13:48:38Z", "creator": "rpluem@apache.org", "creation_time": "2012-03-19T13:48:38Z", "is_private": false}, {"count": 3, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 155047, "time": "2012-03-19T13:55:51Z", "bug_id": 52935, "creation_time": "2012-03-19T13:55:51Z", "is_private": false, "text": "(In reply to comment #1)\n> Seem to have found a fix in mod_proxy.c child_init(). By adding the line:\n> \n> conf->reverse = reverse;\n> \n> to the end of the while loop. (As it is in httpd 2.2.22).\n> \n> \n> Otherwise it would fail to find a reverse proxy worker in proxy.util.c\n> ap_proxy_pre_request(), because conf->reverse would be NULL.\n> And then proxy_handler() would return HTTP_SERVICE_UNAVAILABLE.\n\nThanks for the pointers. I committed a slightly modified version to trunk as r1302444."}, {"count": 4, "tags": [], "creator": "petterb@gmail.com", "attachment_id": null, "id": 155048, "time": "2012-03-19T14:25:16Z", "bug_id": 52935, "creation_time": "2012-03-19T14:25:16Z", "is_private": false, "text": "I actually got recurring Segmentation fault's when i also removed the statement from within 'if (!reverse)'. So, i kept that one.\n\n\n[core:notice] [pid 22626:tid 139771204532032] AH00052: child pid 25078 exit signal Segmentation fault (11)"}, {"attachment_id": null, "tags": [], "bug_id": 52935, "text": "(In reply to comment #4)\n> I actually got recurring Segmentation fault's when i also removed the statement\n> from within 'if (!reverse)'. So, i kept that one.\n> \n> \n> [core:notice] [pid 22626:tid 139771204532032] AH00052: child pid 25078 exit\n> signal Segmentation fault (11)\n\nThanks for pointing this out. I was a little bit quick with my modification. Fixed in r1302483.", "count": 5, "id": 155049, "time": "2012-03-19T14:52:46Z", "creator": "rpluem@apache.org", "creation_time": "2012-03-19T14:52:46Z", "is_private": false}, {"count": 6, "tags": [], "creator": "petterb@gmail.com", "attachment_id": null, "id": 155054, "time": "2012-03-19T16:01:30Z", "bug_id": 52935, "creation_time": "2012-03-19T16:01:30Z", "is_private": false, "text": "Sure thing :)\n\n\nJust throwing in a couple unimportant code suggestions to avoid setting 'conf-reverse' twice the first round.\n\n1. Delete 'conf->reverse = reverse;' from if block and send 'reverse' rather than 'conf->reverse' to ap_proxy_initialize_worker()\n\n2. Put the second 'conf->reverse = reverse;' in an else block"}, {"attachment_id": null, "tags": [], "bug_id": 52935, "text": "fixed in 2.4.2", "count": 7, "id": 158853, "time": "2012-05-06T07:25:17Z", "creator": "sf@sfritsch.de", "creation_time": "2012-05-06T07:25:17Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "Hi,\n\n33774 and 50775 address the same symptom but apparently different causes. 33774 describes exactly what I am experiencing.\n\nThe tomcat was running fine on Windows Server 2003 in a 2003 ActiveDirectory. No timeouts or issues then, authentication worked without timeouts or errors.\nWe just recently migrated the ActiveDirectory to 2008 R2, then this problem started to occur. The server running the tomcat Server itself was not changed in any way.\n\nHere is my log output:\n\n10.02.2012 10:08:33 org.apache.catalina.realm.JNDIRealm authenticate\nSCHWERWIEGEND: Exception performing authentication\njavax.naming.PartialResultException [Root exception is javax.naming.CommunicationException: xxx.xxxxxx.xx:389 [Root exception is java.net.SocketTimeoutException: connect timed out]]\n\tat com.sun.jndi.ldap.LdapNamingEnumeration.hasMoreImpl(Unknown Source)\n\tat com.sun.jndi.ldap.LdapNamingEnumeration.hasMoreReferrals(Unknown Source)\n\tat com.sun.jndi.ldap.LdapNamingEnumeration.hasMoreImpl(Unknown Source)\n\tat com.sun.jndi.ldap.LdapNamingEnumeration.hasMoreReferrals(Unknown Source)\n\tat com.sun.jndi.ldap.LdapNamingEnumeration.hasMoreImpl(Unknown Source)\n\tat com.sun.jndi.ldap.LdapNamingEnumeration.hasMore(Unknown Source)\n\tat org.apache.catalina.realm.JNDIRealm.getUserBySearch(JNDIRealm.java:1359)\n\tat org.apache.catalina.realm.JNDIRealm.getUser(JNDIRealm.java:1186)\n\tat org.apache.catalina.realm.JNDIRealm.getUser(JNDIRealm.java:1145)\n\tat org.apache.catalina.realm.JNDIRealm.authenticate(JNDIRealm.java:1087)\n\tat org.apache.catalina.realm.JNDIRealm.authenticate(JNDIRealm.java:945)\n\tat org.apache.catalina.authenticator.FormAuthenticator.authenticate(FormAuthenticator.java:259)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:449)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\n\tat org.apache.catalina.authenticator.SingleSignOn.invoke(SingleSignOn.java:394)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:852)\n\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)\n\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\n\tat java.lang.Thread.run(Unknown Source)\nCaused by: javax.naming.CommunicationException: xxx.xxxxxx.xx:389 [Root exception is java.net.SocketTimeoutException: connect timed out]\n\tat com.sun.jndi.ldap.LdapReferralContext.<init>(Unknown Source)\n\tat com.sun.jndi.ldap.LdapReferralException.getReferralContext(Unknown Source)\n\tat com.sun.jndi.ldap.LdapNamingEnumeration.hasMoreReferrals(Unknown Source)\n\t... 22 more\nCaused by: java.net.SocketTimeoutException: connect timed out\n\tat java.net.PlainSocketImpl.socketConnect(Native Method)\n\tat java.net.PlainSocketImpl.doConnect(Unknown Source)\n\tat java.net.PlainSocketImpl.connectToAddress(Unknown Source)\n\tat java.net.PlainSocketImpl.connect(Unknown Source)\n\tat java.net.SocksSocketImpl.connect(Unknown Source)\n\tat java.net.Socket.connect(Unknown Source)\n\tat sun.reflect.GeneratedMethodAccessor39.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat com.sun.jndi.ldap.Connection.createSocket(Unknown Source)\n\tat com.sun.jndi.ldap.Connection.<init>(Unknown Source)\n\tat com.sun.jndi.ldap.LdapClient.<init>(Unknown Source)\n\tat com.sun.jndi.ldap.LdapClient.getInstance(Unknown Source)\n\tat com.sun.jndi.ldap.LdapCtx.connect(Unknown Source)\n\tat com.sun.jndi.ldap.LdapCtx.<init>(Unknown Source)\n\tat com.sun.jndi.ldap.LdapCtxFactory.getUsingURL(Unknown Source)\n\tat com.sun.jndi.ldap.LdapCtxFactory.getLdapCtxInstance(Unknown Source)\n\tat com.sun.jndi.url.ldap.ldapURLContextFactory.getObjectInstance(Unknown Source)\n\tat javax.naming.spi.NamingManager.getURLObject(Unknown Source)\n\tat javax.naming.spi.NamingManager.processURL(Unknown Source)\n\tat javax.naming.spi.NamingManager.processURLAddrs(Unknown Source)\n\tat javax.naming.spi.NamingManager.getObjectInstance(Unknown Source)\n\t... 25 more", "attachment_id": null, "id": 153646, "creator": "colin.schaefer@beeline-group.com", "time": "2012-02-10T09:48:12Z", "bug_id": 52636, "creation_time": "2012-02-10T09:48:12Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 52636, "attachment_id": null, "id": 153647, "time": "2012-02-10T10:05:12Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-02-10T10:05:12Z", "is_private": false, "text": "http://tomcat.apache.org/bugreport.html#Bugzilla_is_not_a_support_forum\nAsk on the users@ list first.\n\nI do not see any Tomcat errors here. It is just a timeout coming from your ActiveDirectory server. Note that there is \"PartialResultException\" there. Maybe you can reconfigure your ActiveDirectory server or the search clause used by the realm, or can inspect the packets that are sent over network. The users list is the place to discuss all that, not bugzilla."}, {"count": 2, "tags": [], "text": "Hi Konstantin,\n\nour AD is serving 50+ servers fine without any timeouts and errors (before and after the update). The tomcat is the only system throwing errors after the update.\n\nThe configuration works fine, because after a restart of the tomcat, login is possible for a short while obviously until the timeout occurs (as stated in the other issues). As the logs state the \"PartialNamingException\" is not the root exception, so there is no configuration error. The root Exceptions are Communication and SocketTimeout.\n\nI will not change the core timeouts and settings of my central directory service for a single system not handling a socket timeout.", "attachment_id": null, "id": 153648, "creator": "colin.schaefer@beeline-group.com", "time": "2012-02-10T10:24:29Z", "bug_id": 52636, "creation_time": "2012-02-10T10:24:29Z", "is_private": false}, {"count": 3, "tags": [], "text": "> our AD is serving 50+ servers fine without any timeouts and errors\n\nThen maybe network between Tomcat and your AD is at fault?\n\n> not handling a socket timeout\n\nAnd how are you supposing to handle it here? A search is performed and it is interrupted in a mid-flight. Try to write a patch.\n\n\nNote that there is a way to ignore most PartialResultExceptions in JNDIRealm by setting \"adCompat\" flag in the configuration, but it is likely not what you want here.\n\nAnyway, you have to discuss your problem on the users@ list first.", "attachment_id": null, "id": 153650, "creator": "knst.kolinko@gmail.com", "time": "2012-02-10T10:55:07Z", "bug_id": 52636, "creation_time": "2012-02-10T10:55:07Z", "is_private": false}, {"count": 4, "tags": [], "text": "Looking at the stack trace you will see that referrals are being returned. Failure to follow these is triggering the exceptions. As per the Tomcat docs, you need to use adCompat.\n\nFurther questions on this topic belong on the users mailing list.", "attachment_id": null, "id": 153657, "creator": "markt@apache.org", "time": "2012-02-10T11:39:54Z", "bug_id": 52636, "creation_time": "2012-02-10T11:39:54Z", "is_private": false}, {"count": 5, "tags": [], "text": "I\u00b4ll try the adCompat. Thanks for the feedback.", "attachment_id": null, "id": 153660, "creator": "colin.schaefer@beeline-group.com", "time": "2012-02-10T13:10:35Z", "bug_id": 52636, "creation_time": "2012-02-10T13:10:35Z", "is_private": false}]
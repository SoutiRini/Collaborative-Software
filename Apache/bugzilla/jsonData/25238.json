[{"count": 0, "tags": [], "text": "I start Tomcat 4.1.29 with \nstartup -security\n\nThe testing page, /test/test.jsp,\ninvokes a method from a class in test.jar.\nThe method reads the \"user.home\" system property.\n\nThis works with a grant statement without codebase.\nIt does not work with a grant statement which specifies the test.jar file\nas codebase.\nI have tried several variants of writing the codebase. None worked.\n\nI will attach my catalina.policy (my additions at the end of the file)\nand test.war files", "is_private": false, "id": 48561, "creator": "avogt@skillsonline.de", "time": "2003-12-05T12:01:39Z", "bug_id": 25238, "creation_time": "2003-12-05T12:01:39Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 9404\nhas grant statement for my test.jar", "is_private": false, "id": 48562, "creator": "avogt@skillsonline.de", "time": "2003-12-05T12:02:52Z", "bug_id": 25238, "creation_time": "2003-12-05T12:02:52Z", "attachment_id": 9404}, {"count": 2, "tags": [], "creator": "avogt@skillsonline.de", "is_private": false, "text": "Created attachment 9405\nweb archive of test application. Contains test.jsp", "id": 48563, "time": "2003-12-05T12:03:43Z", "bug_id": 25238, "creation_time": "2003-12-05T12:03:43Z", "attachment_id": 9405}, {"count": 3, "tags": [], "text": "I can reproduce this under WinXP on TC4 and TC5.\n\nI have a simple test application that is deployed in exploded form. A JSP \ncontains a single call to <%=test.Bug25238.getUserHome() %>\n\nThe class is located at ${catalina.home}/webapps/Bugfix/WEB-\nINF/classes/test/Bug25238.class\n(as expected)\n\nThis enables the JSP to work:\ngrant codeBase \"file:${catalina.home}/webapps/Bugfix/-\" {\n    permission java.util.PropertyPermission \"user.home\", \"read\";\n};\n\nThis one doesn't:\ngrant codeBase \"file:${catalina.home}/webapps/Bugfix/WEB-INF/classes/-\" {\n    permission java.util.PropertyPermission \"user.home\", \"read\";\n};\n\nI have tried various combinations and it seems that any codeBase below \nthe /webapps/Bugfix/ gets ignored.", "attachment_id": null, "id": 59904, "creator": "markt@apache.org", "time": "2004-06-25T22:09:38Z", "bug_id": 25238, "creation_time": "2004-06-25T22:09:38Z", "is_private": false}, {"count": 4, "tags": [], "text": "I think you need to check the codeSource URLs that are used in the classloader.", "attachment_id": null, "id": 59908, "creator": "remm@apache.org", "time": "2004-06-25T23:12:09Z", "bug_id": 25238, "creation_time": "2004-06-25T23:12:09Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 25238, "attachment_id": null, "id": 59912, "time": "2004-06-25T23:45:01Z", "creator": "william.barker@wilshire.com", "creation_time": "2004-06-25T23:45:01Z", "is_private": false, "text": "Have you precompiled test.jsp?  Otherwise it's the one without permission to \nread user.home."}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Thanks Bill, spot on. I thought I must be missing the blindingly obvious ;)\n\nTo summarise, all code sources in the stack must have the necessary \npermission. Both the test case in the original bug report and my own test case \nfailed to give the JSP the necessary permission. (Permissions for uncompiled \nJSPs are those granted to the context root directory - see the security \nmanager HOWTO for more info.)\n\nThe following set of permissons allowed my test case to work as expected:\n\n// For the class\ngrant codeBase \"file:${catalina.home}/webapps/Bugfix/WEB-INF/classes/-\" {\n  permission java.util.PropertyPermission \"user.home\", \"read\";\n};\n// For the JSP\ngrant codeBase \"file:${catalina.home}/webapps/Bugfix/\" {\n  permission java.util.PropertyPermission \"user.home\", \"read\";\n};\n", "id": 59954, "time": "2004-06-27T18:09:52Z", "bug_id": 25238, "creation_time": "2004-06-27T18:09:52Z", "is_private": false}]
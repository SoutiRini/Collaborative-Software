[{"count": 0, "tags": [], "creator": "japs@adm.ku.dk", "attachment_id": null, "is_private": false, "id": 88853, "time": "2006-05-06T13:18:31Z", "bug_id": 39499, "creation_time": "2006-05-06T13:18:31Z", "text": "I am running a reverse proxy server. Since I upgraded to Apache 2.2.0\n(and 2.2.2) I have had a lot of errors: \"error reading status line\"\n\nThe relevant part of the config file is:\n\n<VirtualHost *:80>\n    ServerName  www.ku.dk\nProxyPass             /   http://malamute.adm.ku.dk/\nProxyPassReverse      /   http://malamute.adm.ku.dk/\n</VirtualHost>\n\nWith \"debug\" I get the following error_log:\n\n[Sat May 06 13:52:12 2006] [debug] mod_proxy_http.c(54): proxy: HTTP: \ncanonicalising URL //malamute.adm.ku.dk/net\n[Sat May 06 13:52:12 2006] [debug] proxy_util.c(1378): [client \n2001:878:100:14::134] proxy: http: found worker http://malamute.adm.ku.dk/ for \nhttp://malamute.adm.ku.dk/net\n[Sat May 06 13:52:12 2006] [debug] mod_proxy.c(756): Running scheme http \nhandler (attempt 0)\n[Sat May 06 13:52:12 2006] [debug] mod_proxy_http.c(1662): proxy: HTTP: \nserving URL http://malamute.adm.ku.dk/net\n[Sat May 06 13:52:12 2006] [debug] proxy_util.c(1798): proxy: HTTP: has \nacquired connection for (malamute.adm.ku.dk)\n[Sat May 06 13:52:12 2006] [debug] proxy_util.c(1858): proxy: connecting \nhttp://malamute.adm.ku.dk/net to malamute.adm.ku.dk:80\n[Sat May 06 13:52:12 2006] [debug] proxy_util.c(1951): proxy: connected /net \nto malamute.adm.ku.dk:80\n[Sat May 06 13:52:12 2006] [debug] proxy_util.c(2141): proxy: HTTP: connection \ncomplete to 130.225.126.178:80 (malamute.adm.ku.dk)\n[Sat May 06 13:52:12 2006] [info] [client 130.225.126.178] (32)Broken pipe: \ncore_output_filter: writing data to the network\n[Sat May 06 13:52:12 2006] [error] [client 2001:878:100:14::134] proxy: error \nreading status line from remote server malamute.adm.ku.dk\n[Sat May 06 13:52:12 2006] [error] [client 2001:878:100:14::134] proxy: Error \nreading from remote server returned by /net\n[Sat May 06 13:52:12 2006] [debug] proxy_util.c(1816): proxy: HTTP: has \nreleased connection for (malamute.adm.ku.dk)\n\nHere I have used IPv6 between the client and proxy server, and IPv4 between \nthe proxy server and the backend server. However, I observe the same error \nwith pure IPv4.\n\nThe error occur very often (every 2-5 minutes) during light load of the proxy \nserver. During moderate load the error is very seldom (every 60-120 minutes).\n\nLinux proxy4.adm.ku.dk 2.6.12-18mdk #1 Wed Mar 15 13:15:23 MST 2006 i686 Intel\n(R) Pentium(R) 4 CPU 3.20GHz unknown GNU/Linux\n\nJan P. Sorensen"}, {"count": 1, "tags": [], "bug_id": 39499, "is_private": false, "text": "I have been seeing a similar issue when using 2.2.2, worker MPM and an IIS\nbackend server. Everything works ok with an apache backend.\n\nHave done some limited investication, \n\nEverything works fine untill the backend server closes the connection, due to a\nkeep-alive timeout ( hence why it works better under a higher load as the\ntimeout is reached less often due to mod_proxy pooling connections). Have found\nthe IIS closes the connection with an RST packet while apache does a fin/ack\nreset handshake. When mod_proxy recv's a rst from the backend the next request\nto that proxy worker causes the issue listed here. A subsequent reqest sets up a\nnew back end connection and things work ok again until the keep-alive time out.\n\nI have tried this with the pre-threaded mpm and everything is fine. Have also\nfound the same issue with HEAD.\n\nMy solution was to set the timeout on the backend server to something stupid, in\nmy case a week.\n\nI have a decent dev system in the lab atm so if needed can provide any addition\ninfo if instructions are given.\n\nJames", "id": 88864, "time": "2006-05-07T00:49:32Z", "creator": "james@arpstorm.net", "creation_time": "2006-05-07T00:49:32Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "I ofc ment pre-fork MPM , sorry its late here :)", "is_private": false, "id": 88865, "creator": "james@arpstorm.net", "time": "2006-05-07T00:52:09Z", "bug_id": 39499, "creation_time": "2006-05-07T00:52:09Z", "attachment_id": null}, {"count": 3, "text": "same problem here with apache 2.2.2 (on linux 2.6.17-rc4) and IIS on windows\n2003sp1 + owa exchange 2003sp2\nI have workarounded the problem adding 'SetEnv proxy-nokeepalive 1' to the\nvirtualhost section, or removing the flag 'Enable HTTP Keep-Alives' in the IIS\nmanager on windows 2003. Default timeout for keep-alives connections is 2\nminutes (120 seconds) for windows 2003sp1\n\napache 1.3.35 is working *fine*", "bug_id": 39499, "is_private": false, "id": 89201, "time": "2006-05-17T13:29:05Z", "creator": "pupilla@hotmail.com", "creation_time": "2006-05-17T13:29:05Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 39499, "is_private": false, "count": 4, "id": 89202, "time": "2006-05-17T13:35:14Z", "creator": "pupilla@hotmail.com", "creation_time": "2006-05-17T13:35:14Z", "text": "...mmm I don't know if this relevant: my envrinonment is all ipv4"}, {"attachment_id": null, "tags": [], "creator": "pupilla@hotmail.com", "text": "I did try to set 'connection timeout' to 604800 seconds (1 week) in IIS\n(back-end server) but the problem isn't resolved.", "count": 5, "id": 89204, "time": "2006-05-17T13:59:39Z", "bug_id": 39499, "creation_time": "2006-05-17T13:59:39Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 39499, "text": "Same issue with windows 2000sp4 and IIS 4.0 on windows NT 4.0sp6a", "count": 6, "id": 90191, "time": "2006-06-14T09:36:11Z", "creator": "pupilla@hotmail.com", "creation_time": "2006-06-14T09:36:11Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 39499, "is_private": false, "count": 7, "id": 90195, "time": "2006-06-14T10:28:01Z", "creator": "pupilla@hotmail.com", "creation_time": "2006-06-14T10:28:01Z", "text": "Here is a tcpdump capture where IIS 4.0/windows nt4.0sp6a (172.16.1.78) is\nresetting the connection to the apache (172.16.1.247). After that, I get 'proxy:\nerror reading status line from remote server' error.\n\n19:12.981716 IP (tos 0x0, ttl 128, id 33088, offset 0, flags [DF], proto: TCP\n(6), length: 40) 172.16.1.78.80 > 172.16.1.247.3355: R, cksum 0xc03b (correct),\n2080897236:2080897236(0) win 0\n"}, {"count": 8, "tags": [], "creator": "ssehic@gmail.com", "is_private": false, "id": 97201, "attachment_id": null, "bug_id": 39499, "creation_time": "2006-12-22T15:25:45Z", "time": "2006-12-22T15:25:45Z", "text": "You could try the fix from PR #37770. That should fix it.\n\n"}, {"count": 9, "tags": [], "creator": "japs@adm.ku.dk", "is_private": false, "text": "#37770 solves the problem", "id": 98030, "time": "2007-01-14T05:20:37Z", "bug_id": 39499, "creation_time": "2007-01-14T05:20:37Z", "attachment_id": null}, {"count": 10, "tags": [], "creator": "japs@adm.ku.dk", "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of 37770 ***", "id": 98033, "time": "2007-01-14T05:24:44Z", "bug_id": 39499, "creation_time": "2007-01-14T05:24:44Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 39499, "is_private": false, "count": 11, "id": 98099, "time": "2007-01-16T01:24:39Z", "creator": "pupilla@hotmail.com", "creation_time": "2007-01-16T01:24:39Z", "text": "I can confirm #37770 solves the problem"}, {"attachment_id": null, "tags": [], "bug_id": 39499, "is_private": false, "count": 12, "id": 106009, "time": "2007-07-28T02:37:23Z", "creator": "abhishek.rhce@yahoo.co.in", "creation_time": "2007-07-28T02:37:23Z", "text": "I am using apache as a webserver and proxy loadbalancer for backed mongrels . OS\nis FreeBSD 5.4 and apache 2.2.4 , i am getting error related to proxy in my\napache  error log , this is happen when server has good traffic here i am\npasting myy apache config and error logs\n\n\n\n<VirtualHost *:80>\nServerName example.com\n \nDocumentRoot /home/web/public\n\n<Directory \"/home/web/public\">\n    Options FollowSymLinks\n    AllowOverride None\n    Order allow,deny\n    Allow from all\nSetEnv force-proxy-request-1.0 1\n        SetEnv proxy-nokeepalive 1\n</Directory>\n\n<Location />\nSetEnv force-proxy-request-1.0 1\nSetEnv proxy-nokeepalive 1\n</Location>\n\n\n# Disable  forward proxy for security\nProxyRequests Off\n\n# Enable reverse proxying\n<Proxy *>\n      Order deny,allow\n      Allow from all\n</Proxy>\nProxyPreserveHost on\n\n<Proxy balancer://mongrel_cluster>\n\n    BalancerMember http://192.168.1.110:6001 \n    BalancerMember http://192.168.1.110:6002 \n    BalancerMember http://192.168.1.110:6003 \n    BalancerMember http://192.168.1.110:6004 \n    BalancerMember http://192.168.1.110:6005 \n    BalancerMember http://192.168.1.110:6006 \n    BalancerMember http://192.168.1.108:6002 \n    BalancerMember http://192.168.1.108:6003 \n    BalancerMember http://192.168.1.108:6004 \n    BalancerMember http://192.168.1.108:6005 \n    BalancerMember http://192.168.1.108:6006 \n\n</Proxy>\n\nRewriteEngine On\n#RewriteLog /var/log/httpd/rewrite_log\n#RewriteLogLevel 9\n\n#Rule For monitoring Web server from loadbalancer\n\nRewriteRule ^/webmonitoring.html /webmonitoring.html [L]\n\n# Check for maintenance file and redirect all requests\n#  ( this is for use with Capistrano's disable_web task )\n\n RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f\n  RewriteCond %{SCRIPT_FILENAME} !maintenance.html\n  RewriteRule ^.*$ /system/maintenance.html [L]\n\n#RewriteCond %{HTTP_HOST}  !^www.example.com [NC]\n#RewriteRule ^/(.*)  http://www.example.com/$1 [R,L]\n\n# Rewrite index to check for static\n  RewriteRule ^/(.*\\.(css|js|gif|png|jpg))\\.v[0-9.]+$ /$1\n  RewriteRule ^/$ /index.html [QSA]\n\n# Rewrite to check for Rails cached page\n#  RewriteRule ^([^.]+)$ $1.html [QSA]\n\n# Redirect all non-static requests to cluster\n  RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f\n  RewriteRule ^/(.*)$ balancer://mongrel_cluster%{REQUEST_URI} [P,QSA,L]\n\n# Deflate\n  AddOutputFilterByType DEFLATE text/html text/plain text/css text/javascript\n\n<DirectoryMatch \"^/.*/\\.svn/\">\n    ErrorDocument 403 /404.html\n    Order allow,deny\n    Deny from all\n    Satisfy All\n  </DirectoryMatch>\n\nErrorLog /var/log/httpd/httpd-error.log\nCustomLog /var/log/httpd/httpd-access.log combined\n\n\n</VirtualHost>\n\nSat Jul 28 00:32:38 2007] [error] [client xx.xx.xx.xx] proxy: error reading\nstatus line from remote server  xx.xx.xx.xx\n[Sat Jul 28 00:32:38 2007] [error] [client xx.xx.xx.xx] proxy: Error reading\nfrom remote server returned by /embed-services/contest/51895\n[Sat Jul 28 00:32:42 2007] [error] [client xx.xx.xx.xx] proxy: error reading\nstatus line from remote server 192.168.1.x\n[Sat Jul 28 00:32:42 2007] [error] [client xx.xx.xx.xx] proxy: Error reading\nfrom remote server returned by /rss/latest\ng \n\n\n\n\n"}]
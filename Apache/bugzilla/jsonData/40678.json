[{"count": 0, "tags": [], "bug_id": 40678, "attachment_id": null, "text": "Currently <macrodef> only allows the creation of new tasks.\nThis makes it difficult to for example compose conditions\nfrom other conditions - see \nhttp://marc.theaimsgroup.com/?t=115928538600003&r=1&w=2\nfor a dicussion.\n\nThis patch allows this.\nOverview of changes:\n<macrodef> to have a new element <fragment>, this can contain\narbitary xml and associate it with a name. The name *has* to\nhave a '-' in it (this means that the fragment will not be\nconfused with refection based elements).\nIf a fragment is used, macrodef will create a MacroFragmentTask\ninstead of a MacroInstance. This MacroFragmentTask extends MacroInstance\nand implements MacroFragment.\nMacroInstance has been modified a little so it can be extended.\nUnknownElement has been modifed to check if child unknown elements\nare MacroInstances and if so expand them by calling MacroFragment.getUnknowns()\n\nUsage:\n   <macrodef name=\"file-sets\">\n      <fragment>\n        <fileset dir=\"build/a\"/>\n        <fileset dir=\"build/b\"/>\n      </fragment>\n    </macrodef>\n\n    <copy todir=\"build/c\">\n      <file-sets/>\n    </copy>\n\n\nand:\n    <macrodef name=\"is-empty-file\">\n      <attribute name=\"file\" />\n      <fragment>\n        <and>\n          <available file=\"@{file}\" type=\"file\" />\n          <length file=\"@{file}\" length=\"0\" />\n        </and>\n      </fragment>\n    </macrodef>\n\n    <condition property=\"build.is.empty\">\n      <is-empty-file file=\"build.xml\"/>\n    </condition>\n\n    <echo>${build.is.empty}</echo>\n    <touch file=\"empty.file\"/>\n\n    <condition property=\"empty.is.empty\">\n      <is-empty-file file=\"empty.file\"/>\n    </condition>\n\n    <echo>${empty.is.empty}</echo>", "id": 94473, "time": "2006-10-04T08:55:49Z", "creator": "peterreilly@apache.org", "creation_time": "2006-10-04T08:55:49Z", "is_private": false}, {"attachment_id": 18962, "tags": [], "bug_id": 40678, "is_private": false, "count": 1, "id": 94474, "time": "2006-10-04T08:58:29Z", "creator": "peterreilly@apache.org", "creation_time": "2006-10-04T08:58:29Z", "text": "Created attachment 18962\npatch containing differences and new files"}, {"count": 2, "tags": [], "bug_id": 40678, "attachment_id": null, "text": "1. It kicks ass that you were able to get something working here.\n2. It's a little bit of a drawback that a fragment has to have a hyphen in the\nname.  :(", "id": 94524, "time": "2006-10-05T07:09:13Z", "creator": "mbenson@apache.org", "creation_time": "2006-10-05T07:09:13Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 40678, "is_private": false, "count": 3, "id": 94561, "time": "2006-10-05T15:10:47Z", "creator": "peterreilly@apache.org", "creation_time": "2006-10-05T15:10:47Z", "text": "I think that the restiction can be removed.\nthe code can ask IH if the parent class has\nexplicit named elements, still we should\nhighlight that since the fragment can be used\nnearly anywhere, one should be carefull with\nthe choice of name.\n\nOne issue outstanding is error reporting,\nthe location of the use of the fragment is\nlost, this may not be an issue for some uses\n(the task that has the fragment will be complaining)\nbut we need to experiment a little."}, {"attachment_id": 20766, "tags": [], "bug_id": 40678, "text": "Created attachment 20766\nnew patch - separate task fragmentdef\n\nThis is a new patch that adds a new task - fragmentdef.\nIt allows the definition of fairly arbitary element sequences\nthat can be placed in tasks or types. It does not have\nthe restriction of having a \"-\" in the name.\nUsage:\n<fragmentdef name=\"allfilesets\">\n  <sequential>\n    <fileset dir=\"a\" includes=\"*.jar\"/>\n    <fileset dir=\"b\" includes=\"*.jar\"/>\n  </sequential>\n</fragmentdef>\n\n<javac ..>\n   <classpath>\n     <allfilesets/>\n   </classpath>\n</javac>\n\n<jar jarfile=\"all.jar\">\n   <allfilesets/>\n</jar>", "count": 4, "id": 107690, "time": "2007-09-04T04:36:01Z", "creator": "peterreilly@apache.org", "creation_time": "2007-09-04T04:36:01Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 40678, "attachment_id": null, "text": "+1; much better re-use, but I'm not sure about the name. <datadef>? ", "id": 107697, "time": "2007-09-04T05:54:49Z", "creator": "stevel@apache.org", "creation_time": "2007-09-04T05:54:49Z", "is_private": false}, {"count": 6, "tags": [], "creator": "peterreilly@apache.org", "text": "names.....\nAnother alternative is to allow macrodef to be used like\nthis. I am a little worried about this (changing macrodef)\nas it may effect current scripts, but it is something to\nconsider.\n\n", "id": 107699, "time": "2007-09-04T06:09:29Z", "bug_id": 40678, "creation_time": "2007-09-04T06:09:29Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 40678, "is_private": false, "text": "Created attachment 20833\nNew patch to enable any marcodef to be used.\n\nThis patch allows macrodef to be used\nto define any elements to be used.\nfor example:\n<macrodefdef name=\"allfilesets\">\n  <sequential>\n    <fileset dir=\"a\" includes=\"*.jar\"/>\n    <fileset dir=\"b\" includes=\"*.jar\"/>\n  </sequential>\n</fragmentdef>\n\n<javac ..>\n   <classpath>\n     <allfilesets/>\n   </classpath>\n</javac>\n\n<jar jarfile=\"all.jar\">\n   <allfilesets/>\n</jar>", "id": 108268, "time": "2007-09-17T04:04:35Z", "creator": "peterreilly@apache.org", "creation_time": "2007-09-17T04:04:35Z", "attachment_id": 20833}, {"count": 8, "tags": [], "creator": "rpk_pro@pobox.com", "text": "What happened to this? fragmentdef or something similar would be really useful.", "id": 159168, "time": "2012-05-18T16:52:46Z", "bug_id": 40678, "creation_time": "2012-05-18T16:52:46Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 40678, "attachment_id": null, "text": "Peter, this looks like something people have been asking for.  Do you recall why you didn't commit the final incarnation?", "id": 172125, "time": "2014-01-06T20:11:58Z", "creator": "bodewig@apache.org", "creation_time": "2014-01-06T20:11:58Z", "is_private": false}, {"count": 10, "tags": [], "creator": "peterreilly@apache.org", "text": "No, I moved jobs and did not follow up.\nI think that I used this in a number of test builds and got a little\nconfused with the embedding of elements in other tasks.\nHowever it does seem to be a nice feature.\n\nPeter", "id": 172129, "time": "2014-01-06T22:00:54Z", "bug_id": 40678, "creation_time": "2014-01-06T22:00:54Z", "is_private": false, "attachment_id": null}]
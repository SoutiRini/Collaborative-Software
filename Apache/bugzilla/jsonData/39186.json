[{"count": 0, "tags": [], "text": "The output of a remotely executed command does not appear reliably. It seems as \nif only the first usage of sshexec within a built logs the output of the remote \ncommand.\n\nThe following build file part reveals the error:\n\n\t<target name=\"copyScript\">\n\t\t<property name=\"local.test.script\" value=\"C:\\Temp\\test.sh\"/>\n\t\t<echo file=\"${local.test.script}\">\necho \"Output to stdout\" \necho \"Output to stderr\" 2>&amp;1\t\t\t\n\t\t</echo>\n\t\t<scp file=\"${local.test.script}\" \nremoteTofile=\"user@${remote.host}:${remote.test.script}\"  trust=\"true\" \nkeyfile=\"${user.home}/.ssh/id_dsa\" passphrase=\"\"/>\n\t</target>\n\n\t<target name=\"sshExecOrgStdoutStderr\" depends=\"copyScript\">\n\t\t<sshexec host=\"host\" username=\"user\" command=\"sh \n${remote.test.script}\"  trust=\"true\" keyfile=\"${user.home}/.ssh/id_dsa\" \npassphrase=\"\" outputProperty=\"ssh.out\"/>\t\t\n\t\t<echo message=\"Stdout/stderr: ${ssh.out}\"/>\n\t\t<sshexec host=\"host\" username=\"user\" command=\"sh \n${remote.test.script}\"  trust=\"true\" keyfile=\"${user.home}/.ssh/id_dsa\" \npassphrase=\"\" outputProperty=\"ssh.out\"/>\t\t\n\t\t<echo message=\"Stdout/stderr: ${ssh.out}\"/>\t\t\n\t</target>\n\nThe output of this build target is:\n\nsshExecOrgStdoutStderr:\n  [sshexec] Connecting to host:22\n  [sshexec] Output to stdout\n  [sshexec] Output to stderr\n     [echo] Stdout/stderr: Output to stdout\n     [echo] Output to stderr\n  [sshexec] Connecting to host:22\n     [echo] Stdout/stderr: Output to stdout\n     [echo] Output to stderr\n\nThe lines   \n[sshexec] Output to stdout\n[sshexec] Output to stderr\nshould also appear for the second call to sshexec. The outputProperty is not \naffected.\n\nHere is a patch which uses the LogOutputStream in order to solve the issue.\n\n--- SSHExecMod.java\t31 Mar 2006 07:25:55 -0000\t1.2\n+++ SSHExecMod.java\t3 Apr 2006 10:54:50 -0000\n@@ -25,10 +25,13 @@\n import java.io.FileWriter;\n import java.io.IOException;\n import java.io.InputStream;\n+import java.io.OutputStreamWriter;\n+import java.io.PrintStream;\n import java.io.StringReader;\n \n import org.apache.tools.ant.BuildException;\n import org.apache.tools.ant.Project;\n+import org.apache.tools.ant.taskdefs.LogOutputStream;\n import org.apache.tools.ant.taskdefs.optional.ssh.SSHBase;\n import org.apache.tools.ant.util.TeeOutputStream;\n \n@@ -166,7 +169,7 @@\n         }\n \n         ByteArrayOutputStream out = new ByteArrayOutputStream();\n-        TeeOutputStream tee = new TeeOutputStream(out, System.out);\n+        TeeOutputStream tee = new TeeOutputStream(out, new LogOutputStream\n(this, Project.MSG_INFO));\n \n         InputStream istream = null ;\n         if (this.inputFile != null) {\n@@ -192,7 +195,7 @@\n             final ChannelExec channel = (ChannelExec) session.openChannel\n(\"exec\");\n             channel.setCommand(command);\n             channel.setOutputStream(tee);\n-            channel.setExtOutputStream(tee);\n+            channel.setExtOutputStream(new TeeOutputStream(out, new \nLogOutputStream(this, Project.MSG_ERR)));\n             channel.setInputStream(istream) ;\n             channel.connect();", "attachment_id": null, "bug_id": 39186, "id": 87529, "time": "2006-04-03T12:06:38Z", "creator": "Markus.Barchfeld@dvag.com", "creation_time": "2006-04-03T12:06:38Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "is_private": false, "id": 87862, "time": "2006-04-12T20:24:00Z", "bug_id": 39186, "creation_time": "2006-04-12T20:24:00Z", "text": "\n\n*** This bug has been marked as a duplicate of 36302 ***"}]
[{"count": 0, "tags": [], "bug_id": 46678, "text": "I wrote an input filter using mod_ext_filter. In the filter \"implementation\" I get the post data (from stdin) and modify it (to stdout) with no issues. However, after changing the post data, the Content-Length of the request still has the original value. For instance:\n\nOriginal post data: param1=12345 with Content-Length: 12 \nPost data after filter: param1=abcdefghij with Content-Length: 12\n\nThen because the Content-Length is not changed, when the request post data is\nreceived after the filter, it will be truncated to the original Content-Length\nsize (i.e. would get param1=abcde in the previous example).\n\nThe filter implementation is a Java program (speed is not an issue), and this is\nhow the filter definition looks:\n\nExtFilterDefine filtername mode=input cmd=\"/path_to_java/java.exe -classpath\n/path_to_java_app com.my.program.Filter\"\n\nAs you can see, I am not using the PreservesContentLength flag. Also, this is\nrunning on Windows XP, and using Apache 2.2.10 (I already verified and 2.2.11\ndoes not mention anything like this in the release notes). I also tried setting the Content-Length using mod_headers but this cause another problem (would completely remove the post data). \n\nI am reporting this as a bug, as supposedly not using the PreservesContentLength flag should let the filter change the Content-Length.", "id": 124729, "time": "2009-02-09T04:49:30Z", "creator": "criswebea1@yahoo.com.ar", "creation_time": "2009-02-09T04:49:30Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "jenseng@gmail.com", "attachment_id": null, "text": "I've confirmed this behavior on Apache 2.2.3 (Debian Etch).\n\nAlso noteworthy is this only seems to happen if the request is handled locally. It works fine when using a reverse proxy. For example:\n\n# foo gets replaced with foobarbaz, but content-length is unchanged, resulting\n# in possible truncation\nExtFilterDefine foobar mode=output cmd=\"/bin/sed s/foo/foobarbaz/g\"\n<Location /my/path>\n  SetOutputFilter foobar\n</Location>\n\n# foo gets replaced with foobarbaz and content-length is adjusted accordingly\nRewriteEngine On\nRewriteRule ^/my/path http://otherserver/my/path [P]\nExtFilterDefine foobar mode=output cmd=\"/bin/sed s/foo/foobarbaz/g\"\n<Location /my/path>\n  SetOutputFilter foobar\n</Location>", "id": 127315, "time": "2009-05-22T13:09:02Z", "bug_id": 46678, "creation_time": "2009-05-22T13:09:02Z", "is_private": false}]
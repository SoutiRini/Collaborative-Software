[{"count": 0, "tags": [], "creator": "yan.pujante@reuters.com", "attachment_id": null, "is_private": false, "id": 7292, "time": "2001-10-29T16:53:56Z", "bug_id": 4501, "creation_time": "2001-10-29T16:53:56Z", "text": "This problem occurs with j2ee version:\nJava 2 Enterprise Edition version 1.3_01, build 1.3_01-b01\n\nusing \n\njava version \"1.3.1\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.3.1-b24)\nJava HotSpot(TM) Client VM (build 1.3.1-b24, mixed mode)\n\nThe pattern I have is that my request goes to a servlet.. my servlet does the\nprocessing and then 'forward' the display to a jsp page. If I have a syntax\nerror in the jsp page then I get the following exception:\n\njava.lang.ClassCastException: org.apache.jasper.JasperException\n        at\norg.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:352)\n        at com.reuters.pds.webapp.gui.core.Page.display(Page.java:71)\n        at\ncom.reuters.pds.webapp.gui.core.PDSServlet.service(PDSServlet.java:77)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n        at\norg.apache.catalina.core.ApplicationFilterChain.access$0(ApplicationFilterChain.java:197)\n        at\norg.apache.catalina.core.ApplicationFilterChain$1.run(ApplicationFilterChain.java:176)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:172)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:243)\n        at\norg.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:215)\n        at\norg.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n        at\norg.apache.catalina.valves.CertificatesValve.invoke(CertificatesValve.java:246)\n        at\norg.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:564)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n        at\norg.apache.catalina.core.StandardContext.invoke(StandardContext.java:2314)\n        at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:164)\n        at\norg.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n        at\norg.apache.catalina.authenticator.SingleSignOn.invoke(SingleSignOn.java:368)\n        at\norg.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:564)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:163)\n        at\norg.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n        at\norg.apache.catalina.connector.http.HttpProcessor.process(HttpProcessor.java:995)\n        at\norg.apache.catalina.connector.http.HttpProcessor.run(HttpProcessor.java:1088)\n        at java.lang.Thread.run(Thread.java:484)\n\n\nThe code that I am actually executing is the following one:\n  protected void display(String pageName,\n                         Servlet parent,\n                         HttpServletRequest request,\n                         HttpServletResponse response)\n    throws ServletException, IOException\n  {\n    request.setAttribute(\"pageBean\", this);\n    RequestDispatcher rd =\nparent.getServletConfig().getServletContext().getRequestDispatcher(pageName);\n    rd.forward(request, response);\n    request.removeAttribute(\"pageBean\");\n  }\n\nIt doesn't prevent the application from running when it is correct but it makes\ndevelopment of the jsp almost impossible.."}, {"text": "I checked the code of the ApplicationDispatcher class:\n\nException e = pe.getException();\nif( e.getClass().getName().equals(\"javax.servlet.ServletException\") )\n  throw (ServletException)e;\nthrow (IOException)e;\n\nThe code looks like it assumes that if it is not a ServletException then it is a IOException. In this case it seems that the exception thrown (JasperException) is in fact a ServletException (inherites from it). So of course the downcast fails.\n\nif(e instance of ServletException)\n  throw (ServletException e)\nthrow (IOException) e;\n\nwould probably work better.\n\nBut I don't know the rest of the code. Maybe it is just not right to get a JasperException at this point in the code so the problem would be somewhere else.\n\nYan", "tags": [], "creator": "yan.pujante@reuters.com", "is_private": false, "count": 1, "id": 7306, "time": "2001-10-30T08:17:23Z", "bug_id": 4501, "creation_time": "2001-10-30T08:17:23Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 7338, "time": "2001-10-30T14:23:06Z", "bug_id": 4501, "creation_time": "2001-10-30T14:23:06Z", "text": "Oh, ok, I get it now. It would only happen with a security manager, though\n(which is the configuration used by the J2EE RI). include does the same thing.\nI don't see any reason not to use instanceof here (Glenn, any issues with that ?)."}, {"count": 3, "tags": [], "bug_id": 4501, "text": "Nightly for 11/1 will have the fix. The fix will be backported to the 4.0.x \nbranch and included in 4.0.2 after being tested a bit.", "id": 7393, "time": "2001-10-31T11:58:58Z", "creator": "remm@apache.org", "creation_time": "2001-10-31T11:58:58Z", "is_private": false, "attachment_id": null}]
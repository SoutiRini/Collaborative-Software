[{"count": 0, "text": "Eclipse WTP has an option \"Serve modules without publishing\" that works well with tc6, but not with tc7.\nAfter investigation by the WTP team, there seem to be no way for them to fix this without modifying tomcat. The problem in WTP is reported here : https://bugs.eclipse.org/bugs/show_bug.cgi?id=333102\n\nBasically, their DirContext implementation (org.eclipse.jst.server.tomcat.loader.WtpDirContext) returns a ResourceAttributes that correctly points to an existing location, but org.apache.catalina.loader.WebappClassLoader.findResourceInternal(String, String) ignores it and returns a ResourceEntry whose codeBase and source fields point to a non-existing location.\nThis breaks applications that call getResource(...) on the Thread ContextClassLoader and use the returned URL.\nA call to getResourceAsStream(...) on the Thread CCL is OK.", "bug_id": 51741, "is_private": false, "id": 148913, "time": "2011-08-29T21:29:56Z", "creator": "slaurent@apache.org", "creation_time": "2011-08-29T21:29:56Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 51741, "attachment_id": null, "id": 148914, "time": "2011-08-29T21:32:41Z", "creator": "slaurent@apache.org", "creation_time": "2011-08-29T21:32:41Z", "is_private": false, "text": "I'm preparing a patch for org.apache.catalina.loader.WebappClassLoader.findResourceInternal(String, String) but I'm also wondering if tomcat should not provide such a \"virtual\" DirContext just like org.apache.catalina.loader.VirtualWebappLoader is provided (which could probably be used by WTP instead of org.eclipse.jst.server.tomcat.loader.WtpWebappLoader)"}, {"count": 2, "tags": [], "bug_id": 51741, "attachment_id": null, "id": 148915, "time": "2011-08-29T22:16:42Z", "creator": "markt@apache.org", "creation_time": "2011-08-29T22:16:42Z", "is_private": false, "text": "With aliases and altDirContexts this code is already pretty messy. A virtual DirContext may make things worse."}, {"count": 3, "tags": [], "creator": "slaurent@apache.org", "text": "fixed WebappClassLoader in r1163802, will be available in tomcat 7.0.22", "id": 148938, "time": "2011-08-31T20:41:55Z", "bug_id": 51741, "creation_time": "2011-08-31T20:41:55Z", "is_private": false, "attachment_id": null}, {"count": 4, "text": "Not sure about the expected behavior of the WepappClassLoader, but here's something I ran into while testing the new release 7.0.22.\n\nI'm still experiencing the issue when using org.apache.catalina.loader.WebappClassLoader.findResources(String).\n\nUnlike org.apache.catalina.loader.WebappClassLoader.findResource(String), it doesn't look for resources into the local repository using org.apache.catalina.loader.WebappClassLoader.findResourceInternal(String, String), where the fix to this bug can be found.\n\nNot sure if this is an expected behavior, but this use case doesn't seem to be covered by the fix.", "bug_id": 51741, "is_private": false, "id": 150131, "time": "2011-10-04T16:50:37Z", "creator": "matouellet@taleo.com", "creation_time": "2011-10-04T16:50:37Z", "tags": [], "attachment_id": null}, {"count": 5, "tags": [], "creator": "slaurent@apache.org", "attachment_id": null, "text": "you're correct, my fix is not sufficient, I'll work on it soon.\nUnfortunately the code in tomcat is quite complex and feels like it has a lot of history, I have to be very careful not to break anything...", "id": 150143, "time": "2011-10-04T19:11:46Z", "bug_id": 51741, "creation_time": "2011-10-04T19:11:46Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 51741, "attachment_id": null, "id": 150145, "time": "2011-10-04T19:52:40Z", "creator": "matouellet@taleo.com", "creation_time": "2011-10-04T19:52:40Z", "is_private": false, "text": "Thank you very much !"}, {"count": 7, "tags": [], "creator": "Larry.Isaacs@sas.com", "text": "Sylvain,\n\nThanks for your work on this.  I've verified the \"<classloader>.getResource()\" is fixed in Tomcat 7.0.22 for \"Serve modules without publishing\".  Unfortunately, the testing revealed I missed a change to DirContextURLConnection in 7.0.21 which breaks annotation processing for 3.0 webapps.  See Eclipse bug:\nhttps://bugs.eclipse.org/bugs/show_bug.cgi?id=360012\n\nThis means that WTP 3.2.5, 3.3.2, or 3.4 will be needed to avoid the annotation problem in a released WTP.  An updated org.eclipse.jst.server.tomcat.runtime.70.loader.jar is available in the bug above which fixes the problem.  Until those releases are available, the simplest way to work around if you are using a 3.0 webapp is to edit the org.eclipse.jst.server.tomcat.core plug-in jar to replace the \".70.loader\" jar with the updated one.\n\nFinally, I've updated the project set I use for testing to include a test for \"<classloader>.getResources()\".  I'll try to clean it up some and attach a zip to the Eclipse bug in case you or someone else wants to use it.\n\nCheers,\nLarry", "id": 150217, "time": "2011-10-05T21:06:41Z", "bug_id": 51741, "creation_time": "2011-10-05T21:06:41Z", "is_private": false, "attachment_id": null}, {"count": 8, "text": "I'm still working on a patch...\nActually, I think that it's really impossible to have a custom DirContext that fakes WEB-INF/classes to allow multiple virtual paths because one way or another it would return inexistent URLs.\n\nSo, I started to work on a patch that would allow to specify additional paths that should be searched for annotated classes just like WEB-INF/classes. Such a configuration parameter is located on the StandardContext.\n\nWith this patch, WTP could totally avoid to provide its own extensions to tomcat classes and just configure a <Context> with the new property, a <Resource> with the org.apache.naming.resources.VirtualDirContext implementation and a <Loader> with the org.apache.catalina.loader.VirtualWebappLoader implementation.", "bug_id": 51741, "is_private": false, "id": 150536, "time": "2011-10-13T18:32:50Z", "creator": "slaurent@apache.org", "creation_time": "2011-10-13T18:32:50Z", "tags": [], "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 51741, "attachment_id": null, "id": 151689, "creation_time": "2011-11-21T13:26:20Z", "time": "2011-11-21T13:26:20Z", "creator": "Larry.Isaacs@sas.com", "text": "I agree to release under the Apache Licence my changes to WtpDirContext found in the Eclipse WTP source.  These changes extended the source that Fabrizio Giustina originally contributed to both Eclipse and Tomcat.", "is_private": false}, {"count": 10, "text": "patch commited on trunk : 1209686 + 1209694 + 1209731\n\nI'll apply to tc 7 in a couple of days", "bug_id": 51741, "attachment_id": null, "id": 151932, "time": "2011-12-02T22:41:25Z", "creator": "slaurent@apache.org", "creation_time": "2011-12-02T22:41:25Z", "tags": [], "is_private": false}, {"count": 11, "text": "applied on tc7, will be available in 7.0.24.", "bug_id": 51741, "is_private": false, "id": 152027, "time": "2011-12-06T21:07:07Z", "creator": "slaurent@apache.org", "creation_time": "2011-12-06T21:07:07Z", "tags": [], "attachment_id": null}, {"count": 12, "text": "Note that the patch to ContextConfig contained invalid assumptions that triggered regressions (see bug 52669). Namely:\n- the patch assumed that web applications were always deployed in exploded form\n- the patch assumed that classes were always located in packages\n\nThe patch also broke OSGi embedded usage.", "bug_id": 51741, "is_private": false, "id": 153817, "time": "2012-02-15T19:59:18Z", "creator": "markt@apache.org", "creation_time": "2012-02-15T19:59:18Z", "tags": [], "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 51741, "text": "See r1307600 for one more issue with the patch.\nThe fix will be in 7.0.27.", "count": 13, "id": 155422, "time": "2012-03-30T20:51:25Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-03-30T20:51:25Z", "is_private": false}]
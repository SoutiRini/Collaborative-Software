[{"count": 0, "tags": [], "bug_id": 32067, "is_private": false, "id": 66478, "attachment_id": null, "creator": "gs-apache-dev@gluelogic.com", "creation_time": "2004-11-04T21:40:36Z", "time": "2004-11-04T21:40:36Z", "text": "mod_rewrite in Apache 1.3.33 (only up to 1.3.31 is listed in Bugzilla) crashes\nwith a NULL pointer dereference on a dual AMD Opteron machine running Fedora\nCore 3 test 3.\n\nSteps to reproduce (always reproducible):\n\ncd /var/tmp/gs\ntar xvzf apache_1.3.33.tar.gz\ncd apache_1.3.33\nCC=\"gcc -g\" ./configure --prefix=/var/tmp/gs/apache --enable-module=rewrite\n--enable-shared=rewrite\nperl -pi -e 's/CFLAGS1=/CFLAGS1=-g/' `find . -name Makefile`\nmake\nmake install\n\nEntire contents of conf/httpd.conf:\n\nServerType standalone\nServerRoot \"/var/tmp/gs/apache\"\nPidFile /var/tmp/gs/httpd-test.pid\nScoreBoardFile /var/tmp/gs/httpd-test.scoreboard\nBindAddress 127.0.0.1\nPort 8080\nUser gs\nGroup gs\nResourceConfig /dev/null\nAccessConfig /dev/null\nErrorLog  /dev/null\nCoreDumpDirectory /var/tmp/gs                                                  \n                                                                               \n                                                                               \n                                                                             \nLoadModule rewrite_module     libexec/mod_rewrite.so                           \n                                                                               \n                                    \nClearModuleList\nAddModule mod_rewrite.c\nAddModule mod_so.c                                                             \n                                                                               \n                                                                               \n                                                                  \n#DocumentRoot /var/www\nErrorDocument 404 /error.html\nRewriteEngine on\nRewriteRule !^/(error.html|another1.html)$ /nonexistent.html [L]\n\n\nAt the command line:\n]$ bin/httpd -X &\n]$ telnet localhost 8080\nTrying 127.0.0.1...\nConnected to localhost.localdomain (127.0.0.1).\nEscape character is '^]'.\nGET /bogus HTTP/1.0\nHost: bogus\n \nConnection closed by foreign host.\n[1]+  Segmentation fault      (core dumped) bin/httpd -X &\n\n\n\nBacktrace of core:\n\n(gdb) target core core.12956\nCore was generated by `bin/httpd -X'.\nProgram terminated with signal 11, Segmentation fault.\nReading symbols from /lib64/tls/libm.so.6...done.\nLoaded symbols for /lib64/tls/libm.so.6\nReading symbols from /lib64/libcrypt.so.1...done.\nLoaded symbols for /lib64/libcrypt.so.1\nReading symbols from /usr/lib64/libgdbm.so.2...done.\nLoaded symbols for /usr/lib64/libgdbm.so.2\nReading symbols from /usr/lib64/libexpat.so.0...done.\nLoaded symbols for /usr/lib64/libexpat.so.0\nReading symbols from /lib64/libdl.so.2...done.\nLoaded symbols for /lib64/libdl.so.2\nReading symbols from /lib64/tls/libc.so.6...done.\nLoaded symbols for /lib64/tls/libc.so.6\nReading symbols from /lib64/ld-linux-x86-64.so.2...done.\nLoaded symbols for /lib64/ld-linux-x86-64.so.2\nReading symbols from /lib64/libnss_files.so.2...done.\nLoaded symbols for /lib64/libnss_files.so.2\nReading symbols from /lib64/libnss_dns.so.2...done.\nLoaded symbols for /lib64/libnss_dns.so.2\nReading symbols from /lib64/libresolv.so.2...done.\nLoaded symbols for /lib64/libresolv.so.2\nReading symbols from /var/tmp/gs/apache/libexec/mod_rewrite.so...done.\nLoaded symbols for /var/tmp/gs/apache/libexec/mod_rewrite.so\n#0  0x00000000004551c6 in sslow (m=0x7fbfffcf10, start=0x0, stop=0x594348\n\"/bogus\", startst=31, stopst=33) at engine.c:728\n728             register int c = (start == m->beginp) ? OUT : *(start-1);\n(gdb) bt\n#0  0x00000000004551c6 in sslow (m=0x7fbfffcf10, start=0x0, stop=0x594348\n\"/bogus\", startst=31, stopst=33) at engine.c:728\n#1  0x00000000004540b6 in sdissect (m=0x7fbfffcf10, start=0x594348 \"/bogus\",\nstop=0x594348 \"/bogus\", startst=1, stopst=33) at engine.c:360\n#2  0x0000000000453991 in smatcher (g=0x58e610, string=0x594348 \"/bogus\",\nnmatch=10, pmatch=0x7fbfffd090, eflags=0) at engine.c:157\n#3  0x000000000045833c in regexec (preg=0x580828, string=0x594348 \"/bogus\",\nnmatch=10, pmatch=0x7fbfffd090, eflags=0) at regexec.c:138\n#4  0x0000000000440fbb in ap_regexec (preg=0x580828, string=0x594348 \"/bogus\",\nnmatch=10, pmatch=0x7fbfffd090, eflags=0) at util.c:331\n#5  0x0000002a9578df2e in apply_rewrite_rule (r=0x593220, p=0x580280,\nperdir=0x0) at mod_rewrite.c:1861\n#6  0x0000002a9578da9b in apply_rewrite_list (r=0x593220, rewriterules=0x580260,\nperdir=0x0) at mod_rewrite.c:1698\n#7  0x0000002a9578c816 in hook_uri2file (r=0x593220) at mod_rewrite.c:1093\n#8  0x0000000000427065 in run_method (r=0x593220, offset=0, run_all=0) at\nhttp_config.c:327\n#9  0x00000000004270cd in ap_translate_name (r=0x593220) at http_config.c:339\n#10 0x000000000043e6f2 in process_request_internal (r=0x593220) at\nhttp_request.c:1192\n#11 0x000000000043eae9 in ap_process_request (r=0x593220) at http_request.c:1314\n#12 0x00000000004350fe in child_main (child_num_arg=0) at http_main.c:4786\n#13 0x0000000000435316 in make_child (s=0x57f0b0, slot=0, now=1099603704) at\nhttp_main.c:4901\n#14 0x0000000000435495 in startup_children (number_to_start=5) at http_main.c:4983\n#15 0x0000000000435bb8 in standalone_main (argc=2, argv=0x7fbffff9b8) at\nhttp_main.c:5315\n#16 0x00000000004363a1 in main (argc=2, argv=0x7fbffff9b8) at http_main.c:5657\n\n\nBefore narrowing down to the above for reproducibility, in my much more complex\nsetup, if I varied the rewrite rule, the problem would disappear.  It only\ntriggered when there were two .html entries ^(xxx.html|xxxxx.html)$ in the\nrewrite rule; it did not happen with ^(error.html|robots.txt)$   It also varied\non the length of the rules: ^(error.html|another.html)$ worked, while\n^(error.html|another1.html)$ crashed.  Varying the rewrite rule in the simple\nreproducible steps above was not done; I'm out of tuits at the moment."}, {"count": 1, "tags": [], "creator": "nd@perlig.de", "text": "Looks like the same problem. The hregex lib is not 64 bit compatible.\n\n*** This bug has been marked as a duplicate of 31858 ***", "id": 66479, "time": "2004-11-04T21:56:39Z", "bug_id": 32067, "creation_time": "2004-11-04T21:56:39Z", "is_private": false, "attachment_id": null}]
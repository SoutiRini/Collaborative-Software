[{"count": 0, "tags": [], "creator": "gillbuzz@10g.pl", "attachment_id": 32353, "id": 180213, "time": "2015-01-07T15:35:34Z", "bug_id": 57423, "creation_time": "2015-01-07T15:35:34Z", "is_private": false, "text": "Created attachment 32353\njava test code\n\nXSSF implementation of Sheet.shiftRows() causes corrupted output xlsx file when the shift value is bigger than the number of row(s) being shifted. This is regardless of whether the shift value is negative or positive.\n\nExcel 2010 on opening the output file says:\n\"Excel found unreadable content\" and offers recovering the file by removing the unreadable content.\n\nThis can be observed in examples like the following:\nnegative shift of 1 row by less than -1\nnegative shift of 2 rows by less than -2\npositive shift of 1 row by 2 or more \npositive shift of 2 rows by 3 or more\n\nPlease find java test code attached along with xlsx template file used for testing."}, {"attachment_id": 32354, "tags": [], "bug_id": 57423, "text": "Created attachment 32354\nxlsx file used for testing", "count": 1, "id": 180214, "time": "2015-01-07T15:37:07Z", "creator": "gillbuzz@10g.pl", "creation_time": "2015-01-07T15:37:07Z", "is_private": false}, {"count": 2, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 181415, "time": "2015-03-01T18:40:49Z", "bug_id": 57423, "creation_time": "2015-03-01T18:40:49Z", "is_private": false, "text": "In a quick test on Linux with LibreOffice I could not reproduce this, the shifted rows looked fine with (4, 5, -3), let's try if it is reproducible on Windows with Excel..."}, {"count": 3, "tags": [], "creator": "gillbuzz@10g.pl", "attachment_id": null, "id": 181549, "time": "2015-03-06T09:50:43Z", "bug_id": 57423, "creation_time": "2015-03-06T09:50:43Z", "is_private": false, "text": "This is the behaviour I am having on windows excel 2010."}, {"count": 4, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 182754, "time": "2015-04-30T09:11:47Z", "bug_id": 57423, "creation_time": "2015-04-30T09:11:47Z", "is_private": false, "text": "I verified that Excel complains about such a sheet. Analysis indicates that the cause is that we do not fix the order of rows in the data structure XSSFSheet->worksheet->sheetdata, which holds an array of rows. \n\nThe shifting currently leaves this array unordered, which seems to be fine for LibreOffice/OpenOffice, but causes Excel to complain.\n\nUnfortunately fixing seems to be a bit harder as the XmlBeans interfaces does not easily allow to change array contents without actually cloning the whole object, let's see if there is a way to do it correctly."}, {"count": 5, "tags": [], "creator": "dominik.stadler@gmx.at", "text": "I have now added a testcase to class TestUnfixedBugs which verifies this bug, unfortunately this is complicated to fix because XmlBeans makes it hard to reorder things in an array...", "id": 182759, "time": "2015-04-30T11:55:18Z", "bug_id": 57423, "creation_time": "2015-04-30T11:55:18Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 57423, "attachment_id": null, "text": "*** Bug 59581 has been marked as a duplicate of this bug. ***", "id": 191120, "time": "2016-05-19T19:40:02Z", "creator": "jmarkmurph@yahoo.com", "creation_time": "2016-05-19T19:40:02Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 57423, "text": "Probably one of the XmlCursor.move... methods could be useful here... \n\nSee https://xmlbeans.apache.org/docs/2.0.0/reference/org/apache/xmlbeans/XmlCursor.html#moveXml(org.apache.xmlbeans.XmlCursor)", "count": 7, "id": 194882, "time": "2016-11-08T21:27:12Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-11-08T21:27:12Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 57423, "attachment_id": null, "text": "Not fixed in 3 years?", "id": 202649, "time": "2017-12-08T21:07:28Z", "creator": "miaposta21_@hotmail.com", "creation_time": "2017-12-08T21:07:28Z", "is_private": false}, {"count": 9, "text": "Feel free to submit a patch! Everything is open source.", "bug_id": 57423, "attachment_id": null, "id": 202661, "time": "2017-12-09T00:36:11Z", "creator": "onealj@apache.org", "creation_time": "2017-12-09T00:36:11Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "creator": "miaposta21_@hotmail.com", "attachment_id": 35597, "text": "Created attachment 35597\nJUnit test class.\n\nAdd JUnit test class.", "id": 202684, "time": "2017-12-10T16:51:46Z", "bug_id": 57423, "creation_time": "2017-12-10T16:51:46Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 57423, "attachment_id": null, "text": "Before:    After:\n  A        A\n1 a        <empty>\n2 b        <empty>\n3 c        c\n4          a\n5          b\n\nsh.createRow(0).createCell(0).setCellValue(\"a\");\nsh.createRow(1).createCell(0).setCellValue(\"b\");\nsh.createRow(2).createCell(0).setCellValue(\"c\");\nsh.shiftRows(0, 1, 3); //move \"a\" and \"b\" 3 rows down\n\nOutput: xl/sheet1.xlsx\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<worksheet xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\">\n  <dimension ref=\"A3:B5\"/>\n  <sheetViews><sheetView workbookViewId=\"0\" tabSelected=\"true\"/></sheetViews>\n  <sheetFormatPr defaultRowHeight=\"15.0\"/>\n  <sheetData>\n    <row r=\"4\"><c r=\"A4\" t=\"s\"><v>0</v></c></row> <!-- \"a\" -->\n    <row r=\"5\"><c r=\"A5\" t=\"s\"><v>1</v></c></row> <!-- \"b\" -->\n    <row r=\"3\"><c r=\"A3\" t=\"s\"><v>2</v></c></row> <!-- \"c\" -->\n  </sheetData>\n  <pageMargins bottom=\"0.75\" footer=\"0.3\" header=\"0.3\" left=\"0.7\" right=\"0.7\" top=\"0.75\"/>\n</worksheet>", "id": 202749, "time": "2017-12-13T05:15:03Z", "creator": "onealj@apache.org", "creation_time": "2017-12-13T05:15:03Z", "is_private": false}, {"text": "(In reply to Luca from comment #10)\n> Created attachment 35597 [details]\n> JUnit test class.\n> \n> Add JUnit test class.\n\nThanks for the unit test. Applied in r1817975 using `sh.shiftRows(0, 1, 3)`", "tags": [], "bug_id": 57423, "attachment_id": null, "count": 12, "id": 202750, "time": "2017-12-13T06:23:07Z", "creator": "onealj@apache.org", "creation_time": "2017-12-13T06:23:07Z", "is_private": false}]
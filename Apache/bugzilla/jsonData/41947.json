[{"count": 0, "tags": [], "bug_id": 41947, "attachment_id": null, "text": "I believe I have stumbled upon a bug in Batik (present in current\ndevelopment sources). It is exposed by the following SVG:\n\n<svg version=\"1.1\"\n     xmlns=\"http://www.w3.org/2000/svg\"\n     xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n     viewBox=\"-100.00 -100.00 500.00 500.00\">\n<circle r=\"5.0000\" id=\"button\" fill=\"red\" />\n<g transform=\"translate(0,15)\">\n  <animateTransform attributeName=\"transform\"\n                    type=\"translate\"\n                    from=\"0,15\" to=\"0,45\"\n                    dur=\"0.4s\"\n                    fill=\"freeze\"\n                    additive=\"replace\"\n                    begin=\"button.click\" />\n  <circle r=\"5.0000\" fill=\"blue\" />\n</g>\n</svg>\n\nThe idea here is that a click on the circle with ID \"button\" triggers\nthe animation of the second circle (within the group). The bug is that\nquite often (at more or less random times), the circle's position is\nreset to the original position rather than remain at the end of the\nanimation.\n\n\nI am unfamiliar with the Batik sources (and Java as such), but I have\nlooked at the sources, and it appears to me that the problem is in\nTimedElement.java, in TimedElement.sampleAt(). Near the end there is\nsomething to do with computing/\"sampling\" the final value, and it\nseems that for some reason this is done by taking the current time (in\nthe variable t) modulo the animation's duration (in the variable\nd). Presumably due to floating point inaccuracies, this modulo\noperations sometimes just \"overflows\" back to just above zero, causing\nthe effect (position reset) described above.\n\nIf I simply add a small constant, such as 0.05, to the duration 'd',\nthe bug seems to disappear. However I don't expect that this is really\nthe correct solution. Hopefully someone with a better grasp of Batik\nwill be able to fix it properly.", "id": 100960, "time": "2007-03-26T06:41:47Z", "creator": "frodef@stud.cs.uit.no", "creation_time": "2007-03-26T06:41:47Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 41947, "attachment_id": null, "text": "Hi Frode.\n\nThanks for the useful test case.  It does indeed seem to be some numerical\naccuracy issue.", "id": 101004, "time": "2007-03-26T23:15:14Z", "creator": "cam@apache.org", "creation_time": "2007-03-26T23:15:14Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 41947, "text": "This is now fixed in SVN.", "id": 108595, "time": "2007-09-25T18:07:19Z", "creator": "cam@apache.org", "creation_time": "2007-09-25T18:07:19Z", "is_private": false, "attachment_id": null}]
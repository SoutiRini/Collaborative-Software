[{"count": 0, "tags": [], "bug_id": 42361, "text": "When using a form with a custom encoding (e.g. \"multipart/form-data\"), the\ncontent type is not restored after a redirect to a login page (auth-method = FORM).\n\nTo reproduce:\n- A page that POSTs using multipart/form-data encoding (or anything other than\napplication/x-www-form-urlencoded) to a result page that is protected by a login\npage (auth-method=FORM) is invoked.\n- Even though the multipart POST data exists (verified by reading input stream\nof request from result page) the content type of the request is always\n\"application/x-www-form-urlencoded\".  \n- This only happens when redirected to the login page first.  It does not happen\nif already logged in.", "id": 102966, "time": "2007-05-08T16:06:35Z", "creator": "prunge@onaustralia.com.au", "creation_time": "2007-05-08T16:06:35Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "prunge@onaustralia.com.au", "attachment_id": 20152, "id": 102967, "time": "2007-05-08T16:17:52Z", "bug_id": 42361, "creation_time": "2007-05-08T16:17:52Z", "is_private": false, "text": "Created attachment 20152\nMultipart POST test case WAR\n\nTo reproduce the bug:\n- Browse to the data entry page, e.g. http://localhost:8080/multipartposttest/\n- Fill in some values (fields may be left blank, don't make file too big)\n- Press 'send this' button to submit form\n- A redirect to the login page will occur.  Expects a user that has 'manager'\nrole.\n- Results page shows some header values and request contents.  Note the content\ntype is \"application/x-www-form-urlencoded\" which is incorrect - should be\nmultipart/form-data encoding.  Everything else seems correct.\n- Go back to first data entry page using back button on browser and resubmit\nform.  Because already logged in you will go directly to results page.\n- Note content type is now correct, e.g. \"multipart/form-data;\nboundary=---------------------------187161971819895\"."}, {"count": 2, "tags": [], "creator": "prunge@onaustralia.com.au", "attachment_id": 20153, "id": 102968, "time": "2007-05-08T16:22:20Z", "bug_id": 42361, "creation_time": "2007-05-08T16:22:20Z", "is_private": false, "text": "Created attachment 20153\nPatch for org/apache/catalina/authenticator/FormAuthenticator.java"}, {"count": 3, "tags": [], "creator": "prunge@onaustralia.com.au", "text": "Created attachment 20154\nPatch for org/apache/catalina/authenticator/SavedRequest.java", "id": 102969, "time": "2007-05-08T16:23:19Z", "bug_id": 42361, "creation_time": "2007-05-08T16:23:19Z", "is_private": false, "attachment_id": 20154}, {"count": 4, "tags": [], "bug_id": 42361, "attachment_id": null, "text": "Looks like the cause could be due to\norg.apache.catalina.authenticator.FormAuthenticator class hardcoding the content\ntype when restoring POST requests:\n\nL431: contentType.setString(\"application/x-www-form-urlencoded\");\n\nCreated patch that saves the content type to the SavedRequest object and\nrestores it when needed.  This seems to fix the issue.", "id": 102971, "time": "2007-05-08T16:28:21Z", "creator": "prunge@onaustralia.com.au", "creation_time": "2007-05-08T16:28:21Z", "is_private": false}, {"count": 5, "attachment_id": null, "creator": "markt@apache.org", "text": "The fix has been applied to svn and will be included in 5.5.24 and 6.0.14.\n\nMany thanks for your patch.", "id": 102976, "time": "2007-05-08T17:05:25Z", "bug_id": 42361, "creation_time": "2007-05-08T17:05:25Z", "tags": [], "is_private": false}]
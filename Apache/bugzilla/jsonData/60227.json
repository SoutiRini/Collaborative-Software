[{"count": 0, "text": "I am reading a file using the following code\nString strFile = \"C:\\\\usr\\\\_excel_\\\\test.xlsx\";\nFileInputStream file = new FileInputStream(new File(strFile));\nXSSFWorkbook workbook = new XSSFWorkbook(file);\n\nThen I try to update an existing formula on column 1 for more than 2 rows using\n\n  for(int index = 0 ; index < 10; index++){\n     Row row = sheet.getRow(index);\n     Cell cell = row.getCell(0);\t\n     cell.setCellFormula(\"SUM(200)\");\n  }\n\nIt updates the cell with the new formula, but when we try to open the excel file, I get\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<recoveryLog xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><logFileName>error072480_01.xml</logFileName><summary>Errors were detected in file 'D:\\downloads\\eurest (21).xlsm'</summary><removedRecords summary=\"Following is a list of removed records:\">\n\n<removedRecord>Removed Records: Shared formula from /xl/worksheets/sheet6.xml part</removedRecord>\n\n<removedRecord>Removed Records: Formula from /xl/calcChain.xml part (Calculation properties)</removedRecord></removedRecords></recoveryLog>\n\nNOTE: it works well if I change the for loop condition to index<3 and update only 2 cells.", "bug_id": 60227, "attachment_id": null, "id": 194233, "time": "2016-10-08T17:54:55Z", "creator": "hasitha.gunasinghe@iicorporate.com", "creation_time": "2016-10-08T17:54:55Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "onealj@apache.org", "text": "Can you attach the file needed to reproduce this bug?", "id": 194238, "time": "2016-10-08T21:07:34Z", "bug_id": 60227, "creation_time": "2016-10-08T21:07:34Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "hasitha.gunasinghe@iicorporate.com", "text": "Created attachment 34339\nall you need is a few formulas defined in the sheet.\n\nall you need is a few formulas defined in the sheet. Try to update more than 3 existing formulas and we get the error when trying to open the .xlsx file.\n\nThanks", "id": 194239, "time": "2016-10-08T21:12:24Z", "bug_id": 60227, "creation_time": "2016-10-08T21:12:24Z", "is_private": false, "attachment_id": 34339}, {"count": 3, "tags": [], "creator": "onealj@apache.org", "attachment_id": null, "is_private": false, "id": 194240, "time": "2016-10-08T21:32:26Z", "bug_id": 60227, "creation_time": "2016-10-08T21:32:26Z", "text": "Are you sure that the error message Excel gives you is from the attached test file? The error record refers to sheet6.xml and Eutelsat (21).xlsm\n\nSeems like the error message may be coming from a different file."}, {"count": 4, "tags": [], "text": "The error message was copied over from a different file. But you should be able to reproduce the error from the attached file. Were you able to reproduce ?", "is_private": false, "bug_id": 60227, "id": 194241, "time": "2016-10-08T21:36:34Z", "creator": "hasitha.gunasinghe@iicorporate.com", "creation_time": "2016-10-08T21:36:34Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 60227, "is_private": false, "count": 5, "id": 194242, "time": "2016-10-08T21:57:55Z", "creator": "onealj@apache.org", "creation_time": "2016-10-08T21:57:55Z", "text": "I had no issues opening the file in LibreOffice after executing the following code.\nLooking at the error message from comment 0, there may be an issue with overwritten shared formulas not getting removed from the workbook. However, the example workbook (attachment 34339) does not appear to have these shared formulas.\n\nAdded to TestXSSFBugs.java:\n@Test\npublic void test60227() throws Exception {\n    XSSFWorkbook wb = (XSSFWorkbook) WorkbookFactory.create(new File(\"/tmp/bug60227.xlsx\"));\n    Sheet sheet = wb.getSheetAt(0);\n    for (int index = 0 ; index < 10; index++){\n        Row row = sheet.getRow(index);\n        Cell cell = row.getCell(0);\n        cell.setCellFormula(\"SUM(200)\");\n    }\n    OutputStream fos = new FileOutputStream(\"/tmp/bug60227-out.xlsx\");\n    wb.write(fos);\n    fos.close();\n    wb.close();\n}\n\nUsing the test.xlsx file from attachment 34339 and the unit test that I wrote based on your description from comment 0, do you still get an error in Excel, and if you do, can you submit that error message?"}, {"count": 6, "tags": [], "creator": "onealj@apache.org", "attachment_id": 34341, "id": 194244, "time": "2016-10-08T22:18:03Z", "bug_id": 60227, "creation_time": "2016-10-08T22:18:03Z", "is_private": false, "text": "Created attachment 34341\noutput workbook from unit test in comment 5"}, {"count": 7, "tags": [], "creator": "hasitha.gunasinghe@iicorporate.com", "attachment_id": null, "id": 194245, "time": "2016-10-08T22:36:58Z", "bug_id": 60227, "creation_time": "2016-10-08T22:36:58Z", "is_private": false, "text": "Yes. I do get the following error.\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<recoveryLog xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><logFileName>error157560_01.xml</logFileName><summary>Errors were detected in file 'D:\\downloads\\test (1).xlsx'</summary><removedRecords summary=\"Following is a list of removed records:\"><removedRecord>Removed Records: Shared formula from /xl/worksheets/sheet1.xml part</removedRecord><removedRecord>Removed Records: Formula from /xl/calcChain.xml part (Calculation properties)</removedRecord></removedRecords></recoveryLog>"}, {"attachment_id": null, "tags": [], "bug_id": 60227, "is_private": false, "count": 8, "id": 194246, "time": "2016-10-08T22:39:05Z", "creator": "hasitha.gunasinghe@iicorporate.com", "creation_time": "2016-10-08T22:39:05Z", "text": "(In reply to Javen O'Neal from comment #6)\n> Created attachment 34341 [details]\n> output workbook from unit test in comment 5\n\nI get the following error when I try to open the attached excel file\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<recoveryLog xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><logFileName>error157560_03.xml</logFileName><summary>Errors were detected in file 'D:\\downloads\\bug60227-out (1).xlsx'</summary><additionalInfo><info>Excel completed file level validation and repair. Some parts of this workbook may have been repaired or discarded.</info></additionalInfo><removedRecords summary=\"Following is a list of removed records:\"><removedRecord>Removed Records: Shared formula from /xl/worksheets/sheet1.xml part</removedRecord><removedRecord>Removed Records: Formula from /xl/calcChain.xml part (Calculation properties)</removedRecord></removedRecords></recoveryLog>"}, {"count": 9, "tags": [], "bug_id": 60227, "text": "(In reply to Javen O'Neal from comment #5)\n> I had no issues opening the file in LibreOffice after executing the\n> following code.\n> Looking at the error message from comment 0, there may be an issue with\n> overwritten shared formulas not getting removed from the workbook. However,\n> the example workbook (attachment 34339 [details]) does not appear to have\n> these shared formulas.\n> \n> Added to TestXSSFBugs.java:\n> @Test\n> public void test60227() throws Exception {\n>     XSSFWorkbook wb = (XSSFWorkbook) WorkbookFactory.create(new\n> File(\"/tmp/bug60227.xlsx\"));\n>     Sheet sheet = wb.getSheetAt(0);\n>     for (int index = 0 ; index < 10; index++){\n>         Row row = sheet.getRow(index);\n>         Cell cell = row.getCell(0);\n>         cell.setCellFormula(\"SUM(200)\");\n>     }\n>     OutputStream fos = new FileOutputStream(\"/tmp/bug60227-out.xlsx\");\n>     wb.write(fos);\n>     fos.close();\n>     wb.close();\n> }\n> \n> Using the test.xlsx file from attachment 34339 [details] and the unit test\n> that I wrote based on your description from comment 0, do you still get an\n> error in Excel, and if you do, can you submit that error message?\n\nyes. I do get the error when I ran your unit test code and opened the file in Microsoft Excel.\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<recoveryLog xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><logFileName>error157560_01.xml</logFileName><summary>Errors were detected in file 'D:\\downloads\\test (1).xlsx'</summary><removedRecords summary=\"Following is a list of removed records:\"><removedRecord>Removed Records: Shared formula from /xl/worksheets/sheet1.xml part</removedRecord><removedRecord>Removed Records: Formula from /xl/calcChain.xml part (Calculation properties)</removedRecord></removedRecords></recoveryLog>", "id": 194247, "time": "2016-10-08T22:41:48Z", "creator": "hasitha.gunasinghe@iicorporate.com", "creation_time": "2016-10-08T22:41:48Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 60227, "text": "Do you still get a corrupted workbook if you replace \n> cell.setCellFormula(\"SUM(200)\");\nwith\n> cell.setCellValue(\"text\");", "id": 194252, "time": "2016-10-09T02:30:52Z", "creator": "onealj@apache.org", "creation_time": "2016-10-09T02:30:52Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "hasitha.gunasinghe@iicorporate.com", "attachment_id": null, "id": 194254, "time": "2016-10-09T04:36:24Z", "bug_id": 60227, "creation_time": "2016-10-09T04:36:24Z", "is_private": false, "text": "(In reply to Javen O'Neal from comment #10)\n> Do you still get a corrupted workbook if you replace \n> > cell.setCellFormula(\"SUM(200)\");\n> with\n> > cell.setCellValue(\"text\");\n\nNo.I do not get the error if I do cell.setCellValue(\"text\");"}, {"count": 12, "text": "Potential duplicate: bug 58106", "creator": "onealj@apache.org", "attachment_id": null, "id": 194271, "time": "2016-10-09T11:17:31Z", "bug_id": 60227, "creation_time": "2016-10-09T11:17:31Z", "tags": [], "is_private": false}, {"count": 13, "tags": [], "bug_id": 60227, "attachment_id": null, "text": "Potentially related or duplicate: bug 47570", "id": 194501, "time": "2016-10-18T16:23:38Z", "creator": "onealj@apache.org", "creation_time": "2016-10-18T16:23:38Z", "is_private": false}, {"count": 14, "text": "\n\n*** This bug has been marked as a duplicate of bug 61869 ***", "creator": "yegor@dinom.ru", "is_private": false, "id": 202882, "time": "2017-12-21T13:53:17Z", "bug_id": 60227, "creation_time": "2017-12-21T13:53:17Z", "tags": [], "attachment_id": null}, {"count": 15, "tags": [], "text": "Fixed in r1818818\n\nUpdating a shared formula should now preserve all references to it from other cells. I ran your test and Excel 2013 opens the output without any issues.\n\nYegor", "is_private": false, "id": 202884, "creation_time": "2017-12-21T13:57:03Z", "time": "2017-12-21T13:57:03Z", "creator": "yegor@dinom.ru", "bug_id": 60227, "attachment_id": null}]
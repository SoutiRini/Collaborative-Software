[{"count": 0, "tags": [], "bug_id": 56422, "attachment_id": null, "id": 174669, "time": "2014-04-17T11:12:33Z", "creator": "covener@gmail.com", "creation_time": "2014-04-17T11:12:33Z", "is_private": false, "text": "in 2.2, authnz_ldap needs to pre-scan the list of requires to avoid failing the request if authzldapauthoritative has not been set. Otherwise, on a config section where it's configured for some enclosing scope, it blows up if it is loaded but cannot find the DN\n\n\n    if(!req) {\n        ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,\n            \"ldap authorize: Creating LDAP req structure\");\n\n        /* Build the username filter */\n        authn_ldap_build_filter(filtbuf, r, r->user, NULL, sec);\n\n        /* Search for the user DN */\n        result = util_ldap_cache_getuserdn(r, ldc, sec->url, sec->basedn,\n             sec->scope, sec->attributes, filtbuf, &dn, &vals);\n\n        /* Search failed, log error and return failure */\n        if(result != LDAP_SUCCESS) {\n            ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,\n                \"auth_ldap authorise: User DN not found, %s\", ldc->reason);\n            return sec->auth_authoritative? HTTP_UNAUTHORIZED : DECLINED;\n        }\n\nn/a to 2.4 since it won't get called w/o its own Require directives."}]
[{"attachment_id": null, "tags": [], "creator": "oleg.kuryan@gmail.com", "text": "Currently there is no implementation for SUMIFS function in POI library.\nhttp://office.microsoft.com/en-us/excel-help/sumifs-function-HA010047504.aspx\n\nIs it possible to add it?", "count": 0, "id": 152743, "time": "2012-01-13T06:24:10Z", "bug_id": 52462, "creation_time": "2012-01-13T06:24:10Z", "is_private": false}, {"count": 1, "text": "Of course it is possible, but no-one has volunteered to do it so far... \n\nPOI supports SUMIF which is a close relative of SUMIFS and can share the code. Would you volunteer to write a patch ?\n\nYegor", "bug_id": 52462, "attachment_id": null, "id": 152744, "time": "2012-01-13T07:44:40Z", "creator": "yegor@dinom.ru", "creation_time": "2012-01-13T07:44:40Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 52462, "is_private": false, "text": "Hi Yegor,\n\nI can try, but as I'm new to that lib, could you, please, point to start place.\nAs I see \"SUMIFS\" has 2differences from SUMIF:\n1) sequence of arguments is different\n2) number of input arguments is undefined.\n\nNow I see that there is no Abstract function defined for function with undefined number of arguments. Also I can't find example of implementation for such type of functions to look at.\n\nCould you, please, give a start point?", "id": 152747, "time": "2012-01-13T10:03:46Z", "creator": "oleg.kuryan@gmail.com", "creation_time": "2012-01-13T10:03:46Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "yegor@dinom.ru", "text": "Sure, I'm going to write an implementation sketch over weekend. \n\nYegor\n\n(In reply to comment #2)\n> Hi Yegor,\n> \n> I can try, but as I'm new to that lib, could you, please, point to start place.\n> As I see \"SUMIFS\" has 2differences from SUMIF:\n> 1) sequence of arguments is different\n> 2) number of input arguments is undefined.\n> \n> Now I see that there is no Abstract function defined for function with\n> undefined number of arguments. Also I can't find example of implementation for\n> such type of functions to look at.\n> \n> Could you, please, give a start point?", "id": 152751, "time": "2012-01-13T13:06:46Z", "bug_id": 52462, "creation_time": "2012-01-13T13:06:46Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 52462, "is_private": false, "text": "Created attachment 28157\ninitial draft of SUMIFS", "id": 152782, "time": "2012-01-14T15:08:08Z", "creator": "yegor@dinom.ru", "creation_time": "2012-01-14T15:08:08Z", "attachment_id": 28157}, {"count": 5, "text": "Here is initial implementation of SUMIFS. \n\nI think I covered most of it. The test case mimics the first example from http://office.microsoft.com/en-us/excel-help/sumifs-function-HA010047504.aspx. Please add Example 2 - Example 5, I added placeholders in TestSumifs.java\n\nA tricky thing is to verify the behavior of SUMIFS against invalid or wrong arguments. Please carefully read the spec and verify that the implementation handles all cases (wrong type of arguments, ranges have different dimensions, etc.). \n\nFeel free to edit the code if you find any bugs. \n\nP.S. It would be great if you follow the pattern and add support for other *IFS functions from the AnalysisToolpack: AVERAGEIFS and COUNTIFS, they should be pretty much similar to SUMIFS.\n\nRegards,\nYegor", "bug_id": 52462, "attachment_id": null, "id": 152783, "time": "2012-01-14T15:21:33Z", "creator": "yegor@dinom.ru", "creation_time": "2012-01-14T15:21:33Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "id": 152992, "time": "2012-01-21T11:51:45Z", "bug_id": 52462, "creation_time": "2012-01-21T11:51:45Z", "is_private": false, "text": "I committed support for SUMIFS() in r1234305\n\nYegor"}, {"count": 7, "tags": [], "bug_id": 52462, "is_private": false, "text": "Hi Yegor,\n\nThank you for implementing this. Unfortunately, I wasn't able to do that this week. I just synchronized from trunk and tested changes. \nI've tried to create excel file with  SUMIFS function using formula cell  cell.setCellFormula\n\nBut in newly created excel file formula is saved as string and not formula. Do you know how to fix this?", "id": 152993, "time": "2012-01-21T15:13:39Z", "creator": "oleg.kuryan@gmail.com", "creation_time": "2012-01-21T15:13:39Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "Need to reopen bug because of the above comments", "attachment_id": null, "bug_id": 52462, "id": 153010, "time": "2012-01-22T13:35:27Z", "creator": "oleg.kuryan@gmail.com", "creation_time": "2012-01-22T13:35:27Z", "is_private": false}, {"count": 9, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "is_private": false, "id": 153035, "time": "2012-01-23T07:35:09Z", "bug_id": 52462, "creation_time": "2012-01-23T07:35:09Z", "text": "Please post sample code you are using. Even better if you upload a failing junit test that demonstrates what's wrong. \n\nI checked with trunk and setting formulas with SUMIFS works OK to me, for both HSSF and XSSF. \n\nYegor"}, {"count": 10, "tags": [], "text": "I'm Using for verification Excel 2010 in Russian language. Below is code that create excel file with SUM and SUMIFS functions. Just to compare results.\n\nAs result I get attached excel file test.xls. Below are screenshots on how formulas looks like in Russian version:\n1) http://clip2net.com/s/1vOP4 - note that SUMIFS is not displayed in excel in russian variant (\"\u0421\u0423\u041c\u041c\u0410\u0415\u0421\u041b\u0418\u041c\u041d\")\n2) http://clip2net.com/s/1vOQ5 - note that here SUM function is properly converted to russian variant \"\u0421\u0423\u041c\u041c\"\n\nCode used for testing\n---------------------\n    Workbook wb = new HSSFWorkbook();\n    Sheet sheet = wb.createSheet();\n    Row row = sheet.createRow((short) 0);\n    Cell cell = row.createCell((short) 0);\n    cell.setCellValue((String) \"Number\");\n    cell = row.createCell((short) 1);\n    cell.setCellValue((String) \"Sum\");\n    cell = row.createCell((short) 2);\n    cell.setCellValue((String) \"Status\");\n    cell = row.createCell((short) 3);\n    cell.setCellValue((String) \"isDeleted\");\n    short maxSize = 10;\n    for(short counter = 1; counter <= maxSize; counter++) {\n      row = sheet.createRow(counter);\n      cell = row.createCell((short) 0);\n      cell.setCellValue(counter);\n      cell = row.createCell((short) 1);\n      cell.setCellValue(10000);\n      cell = row.createCell((short) 2);\n      cell.setCellValue(\"Opened\");\n      cell = row.createCell((short) 3);\n      cell.setCellValue(\"Yes\");\n\n      if(counter == 1) {\n        cell = row.createCell((short) 5);\n        cell.setCellValue((String) \"Total Not Working\");\n        cell = row.createCell((short) 6);\n        String cellFormula = \"SUMIFS(B2:B\" + (maxSize + 1) + \", D2:D\" + (maxSize + 1) + \", \\\"=Yes\\\", C2:C\" + (maxSize + 1) + \", \\\"=Opened\\\")\";\n        cell.setCellFormula(cellFormula);\n      }  else if(counter == 2) {\n        cell = row.createCell((short) 5);\n        cell.setCellValue((String) \"Total Working\");\n        cell = row.createCell((short) 6);\n        String cellFormula =  \"SUM(B2:B\" + (maxSize + 1) + \")\";\n        cell.setCellFormula(cellFormula);\n      }\n\n\n\n    }\n\n    try {\n      FileOutputStream out = new FileOutputStream(new File(\"D:/test.xls\"));\n      wb.write(out);\n      out.flush();\n      out.close();\n    } catch(IOException e) {\n      e.printStackTrace();\n    }", "attachment_id": null, "bug_id": 52462, "id": 153036, "time": "2012-01-23T08:15:52Z", "creator": "oleg.kuryan@gmail.com", "creation_time": "2012-01-23T08:15:52Z", "is_private": false}, {"attachment_id": 28188, "tags": [], "creator": "oleg.kuryan@gmail.com", "text": "Created attachment 28188\nAttachment to show generated file for note working test case", "count": 11, "id": 153037, "time": "2012-01-23T08:17:02Z", "bug_id": 52462, "creation_time": "2012-01-23T08:17:02Z", "is_private": false}, {"count": 12, "tags": [], "text": "Can you check with XSSF ? Run the same code,only replace\n Workbook wb = new HSSFWorkbook();\n\nwith\nWorkbook wb = new XSSFWorkbook();\n\nYegor\n\n(In reply to comment #11)\n> Created attachment 28188 [details]\n> Attachment to show generated file for note working test case\n\n(In reply to comment #11)\n> Created attachment 28188 [details]\n> Attachment to show generated file for note working test case\n\n(In reply to comment #11)\n> Created attachment 28188 [details]\n> Attachment to show generated file for note working test case", "is_private": false, "bug_id": 52462, "id": 153038, "time": "2012-01-23T09:44:39Z", "creator": "yegor@dinom.ru", "creation_time": "2012-01-23T09:44:39Z", "attachment_id": null}, {"count": 13, "tags": [], "creator": "oleg.kuryan@gmail.com", "attachment_id": null, "id": 153039, "time": "2012-01-23T10:05:27Z", "bug_id": 52462, "creation_time": "2012-01-23T10:05:27Z", "is_private": false, "text": "With XSSFWorkbook everything works fine. So something wrong with HSSFWorkbook."}, {"count": 14, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "id": 153397, "time": "2012-02-03T10:21:07Z", "bug_id": 52462, "creation_time": "2012-02-03T10:21:07Z", "is_private": false, "text": "Unfortunately I cannot easily fix it in HSSF. \n\nStrictly speaking, the SUMIFS function is not supported by the binary .xls format and this is why POI writes incorrect data and the resulting formula is not recognized by Excel.\n\nSUMIFS is not a 'normal' function like MAX, SUM or SUMIF: it is included in the Excel Analysis Toolpack (ATP) which is an Add-On and installed separately. From this point of view, the Analysis Toolpack is like a VBA module, only in pre-compiled form. \nThe primary scope of the support for ATP functions in POI is evaluation, that is, POI recognizes functions with SUMIFS and can evaluate them. Setting a formula with ATP functions is another task and, I should say, a difficult one. The main difficulty is when you create a formula with ATP functions then Excel inserts supplemental data structures - in my test files these were defined named ranges with names like \"_xlfn.\" and these named ranges prefix the ATP function names. To make it clear, the internal name of formula with ATP functions look like _xlfn.SUMIFS(A2:A9,B2:B9,\"=A*\"). POI writes \"pure\" tokens and the formula is written as SUMIFS(A2:A9,B2:B9,\"=A*\"). Evidently it is not enough to make Excel happy.\n\nThis feature is not documented in the .xls spec and I don't see how to easily implement it. \n\n\nRegards,\nYegor"}]
[{"count": 0, "tags": [], "creator": "richton@nbcs.rutgers.edu", "attachment_id": null, "is_private": false, "id": 84287, "time": "2006-01-05T22:48:19Z", "bug_id": 38146, "creation_time": "2006-01-05T22:48:19Z", "text": "mod_ldap does not perform Start TLS properly. Per RFC2830, Start TLS is an\nLDAPv3 Extended Operation. As such, LDAPv3 must be selected as the protocol\nversion PRIOR to performing the Start TLS operation. util_ldap.c does not do\nthis, resulting in LDAP \"Not Available\" errors (interpreted, \"extended\noperations are not available in LDAPv2 per RFC\") when it is attempted to be used.\n\nThe solution is trivial: change to LDAPv3 before attempting to use Extended\nOperations. Please consider the attached code move. It should apply clean to\n2.2.0 and snapshot 20060105173307.\n\n--- util_ldap.c.orig    2006-01-05 15:23:46.237518000 -0500\n+++ util_ldap.c 2006-01-05 15:24:16.355137000 -0500\n@@ -263,6 +263,9 @@\n             return(result->rc);\n         }\n\n+        /* always default to LDAP V3 */\n+        ldap_set_option(ldc->ldap, LDAP_OPT_PROTOCOL_VERSION, &version);\n+\n         /* set client certificates */\n         if (!apr_is_empty_array(ldc->client_certs)) {\n             apr_ldap_set_option(ldc->pool, ldc->ldap, APR_LDAP_OPT_TLS_CERT,\n@@ -292,9 +295,6 @@\n         /* Set the alias dereferencing option */\n         ldap_set_option(ldc->ldap, LDAP_OPT_DEREF, &(ldc->deref));\n\n-        /* always default to LDAP V3 */\n-        ldap_set_option(ldc->ldap, LDAP_OPT_PROTOCOL_VERSION, &version);\n-\n /*XXX All of the #ifdef's need to be removed once apr-util 1.2 is released */\n #ifdef APR_LDAP_OPT_VERIFY_CERT\n         apr_ldap_set_option(ldc->pool, ldc->ldap,"}, {"count": 1, "tags": [], "bug_id": 38146, "is_private": false, "text": "Patch applied to trunk and proposed for backport", "id": 84822, "time": "2006-01-20T18:01:08Z", "creator": "bnicholes@apache.org", "creation_time": "2006-01-20T18:01:08Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 38146, "is_private": false, "text": "Trunk commit: r370856 (http://svn.apache.org/viewcvs.cgi?rev=370856&view=rev) \nBackport proposal: r370857 \n(http://svn.apache.org/viewcvs.cgi?rev=370857&view=rev) ", "id": 84846, "time": "2006-01-21T12:53:12Z", "creator": "rpluem@apache.org", "creation_time": "2006-01-21T12:53:12Z", "attachment_id": null}]
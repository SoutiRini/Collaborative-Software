[{"count": 0, "tags": [], "creator": "cwood@site5.com", "text": "With using modsec2 for security - our servers will randomly get triggered to cause an indefinite loop with apr_pool_cleanup_null. We are unsure of what actually triggers it, other than modsecurity (2.7.1) it self - as disabling this module fleet wide, we have no had the same problems..\n\nThe indications are a 3rd httpd child forked off, and consuming more than its fair share of the CPU..\n\nnobody   51805  1.1  2.2 837744 273500 ?       Sl   15:58   0:24  \\_ /usr/local/apache/bin/httpd -k start -DSSL\nnobody    2884 46.1  2.1 837744 263912 ?       R    16:29   1:24  |   \\_ /usr/local/apache/bin/httpd -k start -DSSL\nnobody    3955 47.3  2.1 837744 264148 ?       R    16:30   1:02  |   \\_ /usr/local/apache/bin/httpd -k start -DSSL\nnobody    3981 45.3  2.1 837744 264164 ?       R    16:30   0:58  |   \\_ /usr/local/apache/bin/httpd -k start -DSSL\nnobody    3986 47.1  2.1 837744 264164 ?       R    16:30   1:00  |   \\_ /usr/local/apache/bin/httpd -k start -DSSL\nnobody    4024 47.2  2.1 837744 264168 ?       R    16:30   0:58  |   \\_ /usr/local/apache/bin/httpd -k start -DSSL\nnobody    4031 51.2  2.1 837744 264176 ?       R    16:30   1:02  |   \\_ /usr/local/apache/bin/httpd -k start -DSSL\nnobody    4052 46.6  2.1 837744 264176 ?       R    16:30   0:55  |   \\_ /usr/local/apache/bin/httpd -k start -DSSL\nnobody    4146 47.8  2.1 837744 264200 ?       R    16:30   0:51  |   \\_ /usr/local/apache/bin/httpd -k start -DSSL\n...\n...\n...\n\nAn strace of the given process does not show anything, as its caught in a loop - no system calls, while an ltrace of the process ID will confirm the looping..\n\napr_pool_cleanup_null(0x2914ea0, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914f10, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914ed8, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914ea0, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914f10, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914ed8, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914ea0, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914f10, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914ed8, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914ea0, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914f10, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\napr_pool_cleanup_null(0x2914ed8, 2, 0x42a9f0, 0, 0x7a62efdaa940)                                                                  = 0\n...\n...\n...\n\nUnfortunately, there isn't much information other than the above and disabling modsecurity the issue goes away, as we dont know know how to reproduce or what triggers the loop in the first place. Any advice on this would be greatly appreciated.", "id": 165217, "time": "2013-02-12T21:52:56Z", "bug_id": 54554, "creation_time": "2013-02-12T21:52:56Z", "is_private": false, "attachment_id": null}]
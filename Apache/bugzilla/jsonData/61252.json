[{"text": "Hi\nusing Poi 3.15 we have a problem with the evaluation of the formulas with more than 30 arguments(in our user case we have a SUM operand).\nTaking a look to the code we have seen that in the class MultiOperandNumericFunction.java there is a constant value DEFAULT_MAX_NUM_OPERANDS = 30.\nthis value is used during the evaluation of the formulas to check the maximum number of arguments. According to us should be better to use the value retrieve from the class SpreadsheetVersion.java but fix in this way the problem require a lot of changes on the code.\nConsidering that 30 was the maximum number of arguments of Excel 97, a very old version, could be more reasonable to use 255 instead that is the limit for Excel 2007 or major. \nThe fix using the limit of 255 is very fast and safe.\nwe looking forward for your feedback\nBest Regards\nFloriano", "tags": [], "creator": "florianogiambelli@tagetik.com", "is_private": false, "count": 0, "id": 199583, "time": "2017-07-05T14:58:52Z", "bug_id": 61252, "creation_time": "2017-07-05T14:58:52Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 61252, "attachment_id": null, "is_private": false, "id": 199587, "time": "2017-07-05T17:26:31Z", "creator": "fanningpj@yahoo.com", "creation_time": "2017-07-05T17:26:31Z", "text": "Floriano - would you be in a position to submit a patch?\norg.apache.poi.ss.SpreadsheetVersion has the operand count as a param - 30 for Excel97 and 255 for Excel2007.\nSo maybe the fix is to ensure that this gets used instead of using a separate constant."}, {"count": 2, "tags": [], "bug_id": 61252, "text": "Passing a SpreadsheetVersion around in all these function APIs looks like it will be a big change.\nI think we might need to use a ThreadLocal, similar to LocaleUtil.", "id": 199591, "time": "2017-07-05T18:52:24Z", "creator": "fanningpj@yahoo.com", "creation_time": "2017-07-05T18:52:24Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 61252, "text": "Is it really so bad to just use the larger version constant in formula calculation?  Are there cases where we really _need_ to throw an error or stop processing arguments after 30 for older workbooks?  Could we just note in the docs that using a formula call with > 30 arguments and then saving in the older format would cause problems when opening in Excel?", "id": 199592, "time": "2017-07-05T19:22:01Z", "creator": "gwoolsey@apache.org", "creation_time": "2017-07-05T19:22:01Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 61252, "attachment_id": null, "is_private": false, "id": 199594, "time": "2017-07-05T20:46:57Z", "creator": "fanningpj@yahoo.com", "creation_time": "2017-07-05T20:46:57Z", "text": "Greg - that seems like a pragmatic solution - we should just change to this:\n\nprivate static final int DEFAULT_MAX_NUM_OPERANDS = SpreadsheetVersion.EXCEL2007.getMaxFunctionArgs();"}, {"count": 5, "tags": [], "bug_id": 61252, "text": "Related: bug 58975", "id": 199597, "time": "2017-07-05T21:32:50Z", "creator": "onealj@apache.org", "creation_time": "2017-07-05T21:32:50Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 61252, "text": "I accidentally committed the change to increase the limit to 255 operands in https://svn.apache.org/viewvc?view=revision&revision=1800949 - I will add some test cases tomorrow.", "id": 199600, "time": "2017-07-05T22:59:30Z", "creator": "fanningpj@yahoo.com", "creation_time": "2017-07-05T22:59:30Z", "tags": [], "is_private": false}, {"count": 7, "attachment_id": null, "bug_id": 61252, "text": "This is resolved as far as I see.", "id": 200982, "time": "2017-09-19T20:52:48Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2017-09-19T20:52:48Z", "tags": [], "is_private": false}]
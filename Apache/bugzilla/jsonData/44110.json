[{"count": 0, "tags": [], "bug_id": 44110, "attachment_id": null, "text": "Hi there\n\nWe are using mod_proxy* under Apache 2.2 (CentOS5) as a reverse proxy frontend\nfor several backend servers. We are wanting to add a SharePoint server to this,\nbut it is currently set to require NTLM (only) authentication. NTLM cannot work\nthrough a proxy, but there is a workaround - RFC4559.\n\nISA and Squid already support it, but it appears Apache doesn't? Is there any\nintent to add support for this?\n\nThanks!\n\nJason", "id": 111933, "time": "2007-12-19T19:10:01Z", "creator": "jhaar@trimble.co.nz", "creation_time": "2007-12-19T19:10:01Z", "is_private": false}, {"count": 1, "tags": [], "text": "(In reply to comment #0)\n\n> ISA and Squid already support it, but it appears Apache doesn't? Is there any\n> intent to add support for this?\n\nWhat do you mean by support? \n\nhttpd does not support authentication via RFC4559 by itself. But from a quick\nglance at RFC4559 I think if the backend server of the reverse proxy supports\nRFC4559 as authentication mechanism it should also work with httpd in front as a\nreverse proxy. The issue with NTLM is that it requires that the challenge\nresponse mechanism is running on the same HTTP connection / TCP connection. It\ncannot be done across different HTTP connections. I see no such requirement for\nRFC4559.\n", "attachment_id": null, "bug_id": 44110, "id": 111962, "time": "2007-12-20T12:53:13Z", "creator": "rpluem@apache.org", "creation_time": "2007-12-20T12:53:13Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 44110, "text": "I was just guessing about it being an RFC4559 issue. My point is that currently\nif I access a NTLM-only protected web server through a Squid-2.6 proxy, it works\n(via some magic involving \"Session-Based-Authentication\"), but if I access the\nsame box through an Apache 2.2+ mod_proxy, it doesn't.\n\nMaybe Squid \"fakes it\" so that the browser does NTLM between itself and the\nproxy, and then Squid re-does NTLM to the real end-server? I've got a packet\ntrace and it seems to show the browser purely doing NTLM - and working.", "id": 111967, "time": "2007-12-20T14:54:01Z", "creator": "jhaar@trimble.co.nz", "creation_time": "2007-12-20T14:54:01Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 44110, "attachment_id": null, "text": "You are correct that NTLM does not work with httpd proxy, but as I understood\nyou you do not want to use NTLM but RFC4559 which is different from NTLM. So how\ndoes this relate to your original question?", "id": 111990, "time": "2007-12-21T08:01:09Z", "creator": "rpluem@apache.org", "creation_time": "2007-12-21T08:01:09Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 44110, "attachment_id": null, "id": 112155, "time": "2007-12-23T23:27:57Z", "creator": "peter.pearce@petrosa.co.za", "creation_time": "2007-12-23T23:27:57Z", "is_private": false, "text": "\nThis looks like a duplicate of bug 39673 ?"}, {"count": 5, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 112156, "time": "2007-12-24T00:36:31Z", "bug_id": 44110, "creation_time": "2007-12-24T00:36:31Z", "is_private": false, "text": "(In reply to comment #4)\n> This looks like a duplicate of bug 39673 ?\n\nNot really, because as far as I understood the original question it was about\nRFC4559 and not NTLM. But I admit that the original reporter confused me in the\nmeantime.\n\n"}, {"count": 6, "tags": [], "text": "\n> Not really, because as far as I understood the original question it was about\n> RFC4559 and not NTLM. But I admit that the original reporter confused me in the\n> meantime.\n> \n\nYeah - sorry about that. I knew that Squid somehow supported proxying NTLM and\nthe closest description I could find was in RFC4889. What I really meant was\nthat Squid supported proxying NTLM, and it might have something to do with the\n\"Proxy: Session-Based-Authentication\" header I see it showing - but I really\ndon't have much evidence for that. Somehow it works. So if Squid supports it as\na forwarding proxy, I would imagine(?) Apache could be coded to support it as a\nreverse-proxy. That's where I was coming from :-)\n\n\n\n", "attachment_id": null, "id": 112162, "creator": "jhaar@trimble.co.nz", "time": "2007-12-24T03:29:00Z", "bug_id": 44110, "creation_time": "2007-12-24T03:29:00Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 44110, "attachment_id": null, "text": "Hi there again\n\nI have been looking at the Squid code around this, and the term they use is\n\"connection pinning\" - which I gather means it's the way they make the\nproxy-to-NTLM-server TCP connection stay live whilst the browser-to-proxy could\nbe different TCP HTTP connections? I know NTLM authentication is supposed to be\nonly possible over a single TCP-connection - i.e. no HTTP/1.0-style connections.\n\nThis is all guess work by me - I hope I'm not digging a deeper hole ;-)\n\n\nJason", "id": 113097, "time": "2008-01-23T15:54:00Z", "creator": "jhaar@trimble.co.nz", "creation_time": "2008-01-23T15:54:00Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 44110, "attachment_id": null, "id": 113840, "time": "2008-02-17T12:25:19Z", "creator": "jhaar@trimble.co.nz", "creation_time": "2008-02-17T12:25:19Z", "is_private": false, "text": "Looks like I screwed up. I had the VirtualHost set up with\n\nSetEnv force-proxy-request-1.0 0\nSetEnv proxy-nokeepalive 0\n\n...for historical reasons and completely blanked out the little factlet that\nNTLM requires KeepAlive/HTTP1.1 in order to operate. Once I removed those\nsettings it started working.\n\nSo you can use Apache as a reverse-proxy frontend to NTLM-only IIS webapps. :-)\n\nJason"}]
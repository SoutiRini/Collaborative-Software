[{"count": 0, "tags": [], "text": "With the recent apache 2.2.10 update, @ARGV is being populated with an extra\nempty argument.  Here is an example from straces of what httpd is trying to\nrun:\n\nstrace of process calling suexec with apache 2.2.10\n\n[pid 18070] execve(\"/usr/local/apache/bin/suexec\",\n[\"/usr/local/apache/bin/suexec\", \"2057\", \"2051\",\n\"rick.pl\", \"\"], [/* 24 vars */]) = 0\n\nsame in apache 2.2.9\n\n[pid 21364] execve(\"/usr/local/apache/bin/suexec\",\n[\"/usr/local/apache/bin/suexec\", \"2057\", \"2051\",\n\"rick.pl\"], [/* 24 vars */]) = 0\n\n\nyou'll notice in the 2.2.10 example, there is an empty arg being passed.  This\ncan easily be duplicated on any apache 2.2.10 server.\n\n   This only occurs with MPM_Worker enabled on the server. It don't appear in MPM_Prefork for this in default setting.", "attachment_id": null, "bug_id": 46380, "id": 123237, "time": "2008-12-11T04:38:18Z", "creator": "russ@cpanel.net", "creation_time": "2008-12-11T04:38:18Z", "is_private": false}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 123246, "time": "2008-12-11T12:10:45Z", "bug_id": 46380, "creation_time": "2008-12-11T12:10:45Z", "is_private": false, "text": "Please provide the URL that was used calling your perl script including the arguments."}, {"id": 123247, "tags": [], "bug_id": 46380, "attachment_id": null, "count": 2, "text": "http://xpthemetest.com/cgi-bin/test.cgi\n\n\nThis is the code for the script:\n\n---------------------\n#!/usr/bin/perl\n\nprint \"Content-Type: text/html\\n\\n\";\nprint \"Argument count: $#ARGV<br>\\n\";\nfor ($i = 0; $i <= $#ARGV; $i++){\n   print \"Argument $i is: \";\n   print @ARGV[$i];\n   print \"<br>\\n\";\n}\n1;\n---------------------\n\nprior to 2.2.10, it would return:\n\nArgument count: -1\n", "time": "2008-12-11T20:50:14Z", "creator": "russ@cpanel.net", "creation_time": "2008-12-11T20:50:14Z", "is_private": false}, {"count": 3, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 123256, "time": "2008-12-12T06:22:55Z", "bug_id": 46380, "creation_time": "2008-12-12T06:22:55Z", "is_private": false, "text": "Can you please try if the following patch fixes your issue?\n\nIndex: modules/generators/mod_cgid.c\n===================================================================\n--- modules/generators/mod_cgid.c       (revision 726007)\n+++ modules/generators/mod_cgid.c       (working copy)\n@@ -201,7 +201,7 @@\n     char *w;\n     int idx = 0;\n\n-    if (ap_strchr_c(args, '=')) {\n+    if (!(*args) || ap_strchr_c(args, '=')) {\n         numwords = 0;\n     }\n     else {\n"}, {"count": 4, "tags": [], "creator": "russ@cpanel.net", "text": "If there is a query string, either ?param=value or ?arg+arg+arg, no extra item is added.\n\nThe problem also seem sdependent on the shebang line, for example out of these two scripts the /bin/bash one does not have a spurious argument, The /usr/bin/perl one does.\n\n\n", "id": 123294, "time": "2008-12-14T16:23:52Z", "bug_id": 46380, "creation_time": "2008-12-14T16:23:52Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "dan@cpanel.net", "text": "Created attachment 23019\nCGI (in perl) that exhibits this issue and includes server info", "id": 123295, "time": "2008-12-14T16:59:34Z", "bug_id": 46380, "creation_time": "2008-12-14T16:59:34Z", "is_private": false, "attachment_id": 23019}, {"count": 6, "tags": [], "creator": "dan@cpanel.net", "attachment_id": 23020, "id": 123296, "time": "2008-12-14T17:00:10Z", "bug_id": 46380, "creation_time": "2008-12-14T17:00:10Z", "is_private": false, "text": "Created attachment 23020\nCGI with shell-as-shebang that does not suffer from this bug"}, {"count": 7, "tags": [], "creator": "dan@cpanel.net", "attachment_id": null, "id": 123297, "time": "2008-12-14T17:02:13Z", "bug_id": 46380, "creation_time": "2008-12-14T17:02:13Z", "is_private": false, "text": "(In reply to comment #3)\n> Can you please try if the following patch fixes your issue?\n> \n> Index: modules/generators/mod_cgid.c\n> ===================================================================\n> --- modules/generators/mod_cgid.c       (revision 726007)\n> +++ modules/generators/mod_cgid.c       (working copy)\n> @@ -201,7 +201,7 @@\n>      char *w;\n>      int idx = 0;\n> \n> -    if (ap_strchr_c(args, '=')) {\n> +    if (!(*args) || ap_strchr_c(args, '=')) {\n>          numwords = 0;\n>      }\n>      else {\n\nUnfortunately that did not resolve it.\n\nThis was my configure line:\n\n./configure --disable-authn-default --enable-expires --enable-headers --enable-info --enable-logio --enable-rewrite --enable-ssl --enable-suexec --enable-unique-id --prefix=/usr/local/apache --with-included-apr --with-mpm=worker --with-ssl=/usr --with-suexec-caller=nobody --with-suexec-docroot=/ --with-suexec-gidmin=100 --with-suexec-logfile=/usr/local/apache/logs/suexec_log --with-suexec-uidmin=100 --with-suexec-userdir=public_html"}, {"count": 8, "tags": [], "text": "(In reply to comment #7)\n> (In reply to comment #3)\n> > Can you please try if the following patch fixes your issue?\n> > \n> > Index: modules/generators/mod_cgid.c\n> > ===================================================================\n> > --- modules/generators/mod_cgid.c       (revision 726007)\n> > +++ modules/generators/mod_cgid.c       (working copy)\n> > @@ -201,7 +201,7 @@\n> >      char *w;\n> >      int idx = 0;\n> > \n> > -    if (ap_strchr_c(args, '=')) {\n> > +    if (!(*args) || ap_strchr_c(args, '=')) {\n> >          numwords = 0;\n> >      }\n> >      else {\n> \n> Unfortunately that did not resolve it.\n\nI take that back, it *does* resolve it :) I'll have to look into why it didn't seem to work before.", "attachment_id": null, "bug_id": 46380, "id": 123299, "time": "2008-12-14T18:02:59Z", "creator": "dan@cpanel.net", "creation_time": "2008-12-14T18:02:59Z", "is_private": false}, {"count": 9, "tags": [], "creator": "dan@cpanel.net", "text": "Created attachment 23021\ndon't set args if there are none\n\nRedoing it with a make clean first and ensuring the patch is applied, definitely works.\n\nWe've apply this patch now in our EasyApache building system.\n\nThanks for your assistance with that, looking forward to it being part of the core :)\n\nThanks again!", "id": 123301, "time": "2008-12-14T18:59:22Z", "bug_id": 46380, "creation_time": "2008-12-14T18:59:22Z", "is_private": false, "attachment_id": 23021}, {"count": 10, "tags": [], "bug_id": 46380, "attachment_id": null, "text": "Committed to trunk as r726636.", "id": 123304, "time": "2008-12-14T23:48:03Z", "creator": "rpluem@apache.org", "creation_time": "2008-12-14T23:48:03Z", "is_private": false}, {"count": 11, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 124301, "time": "2009-01-22T13:10:30Z", "bug_id": 46380, "creation_time": "2009-01-22T13:10:30Z", "is_private": false, "text": "*** Bug 46530 has been marked as a duplicate of this bug. ***"}, {"count": 12, "tags": [], "bug_id": 46380, "attachment_id": null, "text": "Proposed for backport as r800136.", "id": 129385, "time": "2009-08-02T12:31:26Z", "creator": "rpluem@apache.org", "creation_time": "2009-08-02T12:31:26Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 46380, "text": "Backported to 2.2.x as r800410.", "count": 13, "id": 129408, "time": "2009-08-03T07:39:02Z", "creator": "rpluem@apache.org", "creation_time": "2009-08-03T07:39:02Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 61384, "text": "Created attachment 35202\nDon't add charset to multipart/form-data content type\n\nAs reported by a few JMeter users on the users mailing list. IIS will not accept files that are send inside a multipart/form-data. It seems that the only difference between working (with other clients) and non-working (with JMeter) clients is the addition of a charset to the multipart/form-data content type.\n\nIt seems that akka-http had the same problems as reported on https://github.com/akka/akka-http/issues/338\n\nThe attached patch removes the charset on the multipart content-type. The entities that are part of the multipart will remain there charsets.", "id": 200204, "time": "2017-08-05T17:41:26Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2017-08-05T17:41:26Z", "is_private": false, "attachment_id": 35202}, {"count": 1, "tags": [], "bug_id": 61384, "is_private": false, "text": "Hi Felix, \nIs this issue related also to Bug 60800 ?\nThanks", "id": 200215, "time": "2017-08-07T12:39:10Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-08-07T12:39:10Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "(In reply to Philippe Mouawad from comment #1)\n> Hi Felix, \n> Is this issue related also to Bug 60800 ?\n> Thanks\n\nAnd also Bug 56141 ?", "is_private": false, "bug_id": 61384, "id": 200216, "time": "2017-08-07T12:40:29Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-08-07T12:40:29Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 61384, "text": "(In reply to Philippe Mouawad from comment #2)\n> (In reply to Philippe Mouawad from comment #1)\n> > Hi Felix, \n> > Is this issue related also to Bug 60800 ?\n> > Thanks\n> \n> And also Bug 56141 ?\n\nWell 56141 looks related. And as comment 3 on that bug shows the same findings (it works better when the charset is not on the form-data), I think it is safe to apply this patch.", "id": 200443, "time": "2017-08-24T18:27:21Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2017-08-24T18:27:21Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 61384, "is_private": false, "text": "Will be included in version 3.3.\n\nDate: Fri Aug 25 19:02:36 2017\nNew Revision: 1806215\n\nURL: http://svn.apache.org/viewvc?rev=1806215&view=rev\nLog:\nDon't set the charset on enclosing multipart/form-data header. It irritates some servers.\n\nThe charset was added sometime back while refactoring to use a newer api of http client.\nSee https://bz.apache.org/bugzilla/show_bug.cgi?id=56141 for more info.\n\nBugzilla Id: 61384\n\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n    jmeter/trunk/xdocs/changes.xml", "id": 200454, "time": "2017-08-25T19:04:01Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2017-08-25T19:04:01Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 61384, "text": "Created attachment 35258\nAlternative patch taking into account charset only if set", "id": 200468, "time": "2017-08-27T10:17:27Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-08-27T10:17:27Z", "is_private": false, "attachment_id": 35258}, {"count": 6, "tags": [], "bug_id": 61384, "text": "Created attachment 35259\nTest plan showing issue with current nightly build as of 27 august 2017", "id": 200469, "time": "2017-08-27T12:26:28Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-08-27T12:26:28Z", "is_private": false, "attachment_id": 35259}, {"count": 7, "tags": [], "text": "With attached plan, even If I have set UTF-8 charset, request sent corrupts file name:\nPOST http://localhost:8081/\n\nPOST data:\n--grIHU42M9gTheYA5QVpw9uJAi6UAsLd8_QhLl\nContent-Disposition: form-data; name=\"toto\"\n\ntiti\n--grIHU42M9gTheYA5QVpw9uJAi6UAsLd8_QhLl\nContent-Disposition: form-data; name=\"chineseChar\"\n\n\u5b89\n--grIHU42M9gTheYA5QVpw9uJAi6UAsLd8_QhLl\nContent-Disposition: form-data; name=\"test\"; filename=\"?.jmx\"\nContent-Type: text/plain\n\n<actual file content, not shown here>\n--grIHU42M9gTheYA5QVpw9uJAi6UAsLd8_QhLl--\n\n\n[no cookies]\n\nRequest Headers:\nConnection: keep-alive\nContent-Length: 2768\nContent-Type: multipart/form-data; boundary=grIHU42M9gTheYA5QVpw9uJAi6UAsLd8_QhLl\nHost: localhost:8081\nUser-Agent: Apache-HttpClient/4.5.3 (Java/1.8.0_112)", "is_private": false, "bug_id": 61384, "id": 200470, "time": "2017-08-27T12:27:11Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-08-27T12:27:11Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 61384, "text": "*** Bug 60800 has been marked as a duplicate of this bug. ***", "id": 200472, "time": "2017-08-27T12:29:39Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-08-27T12:29:39Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 61384, "text": "Author: pmouawad\nDate: Sun Aug 27 12:39:50 2017\nNew Revision: 1806358\n\nURL: http://svn.apache.org/viewvc?rev=1806358&view=rev\nLog:\nBug 61384 - Adding charset to multipart/form-data content type irritates IIS\n\nBugzilla Id: 61384\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java", "count": 9, "id": 200473, "time": "2017-08-27T12:41:36Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-08-27T12:41:36Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 61384, "is_private": false, "text": "Author: pmouawad\nDate: Sun Aug 27 12:54:56 2017\nNew Revision: 1806361\n\nURL: http://svn.apache.org/viewvc?rev=1806361&view=rev\nLog:\nBug 61384 - Adding charset to multipart/form-data content type irritates IIS\nFix failing tests\nBugzilla Id: 61384\n\nModified:\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/sampler/TestHTTPSamplersAgainstHttpMirrorServer.java", "id": 200476, "time": "2017-08-27T12:55:53Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-08-27T12:55:53Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 61384, "text": "Author: pmouawad\nDate: Sun Aug 27 13:44:44 2017\nNew Revision: 1806366\n\nURL: http://svn.apache.org/viewvc?rev=1806366&view=rev\nLog:\nBug 61384 - Adding charset to multipart/form-data content type irritates IIS\nFix failing test\nAdd test on param non corruption when charset is UTF-8\nBugzilla Id: 61384\n\nModified:\n    jmeter/trunk/bin/testfiles/TEST_HTTP.jmx\n    jmeter/trunk/bin/testfiles/TEST_HTTP_HttpClient4.csv\n    jmeter/trunk/bin/testfiles/TEST_HTTP_HttpClient4.xml\n    jmeter/trunk/bin/testfiles/TEST_HTTP_Java.csv\n    jmeter/trunk/bin/testfiles/TEST_HTTP_Java.xml", "id": 200480, "time": "2017-08-27T13:58:16Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-08-27T13:58:16Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "id": 200481, "attachment_id": null, "bug_id": 61384, "creation_time": "2017-08-27T14:15:13Z", "time": "2017-08-27T14:15:13Z", "text": "Author: pmouawad\nDate: Sun Aug 27 14:14:36 2017\nNew Revision: 1806369\n\nURL: http://svn.apache.org/viewvc?rev=1806369&view=rev\nLog:\nBug 61384 - Adding charset to multipart/form-data content type irritates IIS\nFix failing test\nAdd test on param non corruption when charset is UTF-8 , second try\nBugzilla Id: 61384\n\nModified:\n    jmeter/trunk/bin/testfiles/TEST_HTTP_HttpClient4.xml\n    jmeter/trunk/bin/testfiles/TEST_HTTP_Java.xml"}, {"count": 13, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "id": 200482, "attachment_id": null, "bug_id": 61384, "creation_time": "2017-08-27T17:49:37Z", "time": "2017-08-27T17:49:37Z", "text": "Author: pmouawad\nDate: Sun Aug 27 17:49:03 2017\nNew Revision: 1806384\n\nURL: http://svn.apache.org/viewvc?rev=1806384&view=rev\nLog:\nBug 61384 - Adding charset to multipart/form-data content type irritates IIS\nFix failing test:\n- Java Implementation corrupts parameter name for UTF-8, so add a check\n- Fix wrong CSV file for Java\nBugzilla Id: 61384\n\nModified:\n    jmeter/trunk/bin/testfiles/TEST_HTTP.jmx\n    jmeter/trunk/bin/testfiles/TEST_HTTP_Java.csv"}, {"count": 14, "text": "(In reply to Philippe Mouawad from comment #7)\n> With attached plan, even If I have set UTF-8 charset, request sent corrupts\n> file name:\n> POST http://localhost:8081/\n> \n> POST data:\n> --grIHU42M9gTheYA5QVpw9uJAi6UAsLd8_QhLl\n> Content-Disposition: form-data; name=\"toto\"\n> \n> titi\n> --grIHU42M9gTheYA5QVpw9uJAi6UAsLd8_QhLl\n> Content-Disposition: form-data; name=\"chineseChar\"\n> \n> \u5b89\n> --grIHU42M9gTheYA5QVpw9uJAi6UAsLd8_QhLl\n> Content-Disposition: form-data; name=\"test\"; filename=\"?.jmx\"\n> Content-Type: text/plain\n> \n> <actual file content, not shown here>\n> --grIHU42M9gTheYA5QVpw9uJAi6UAsLd8_QhLl--\n> \n> \n> [no cookies]\n> \n> Request Headers:\n> Connection: keep-alive\n> Content-Length: 2768\n> Content-Type: multipart/form-data;\n> boundary=grIHU42M9gTheYA5QVpw9uJAi6UAsLd8_QhLl\n> Host: localhost:8081\n> User-Agent: Apache-HttpClient/4.5.3 (Java/1.8.0_112)\n\nThe file name is part of the header and has to be encoded (using quoted printable) separately. It is another problem.", "creator": "felix.schumacher@internetallee.de", "is_private": false, "id": 200483, "time": "2017-08-27T18:08:19Z", "bug_id": 61384, "creation_time": "2017-08-27T18:08:19Z", "tags": [], "attachment_id": null}, {"count": 15, "tags": [], "text": "Author: pmouawad\nDate: Sat Sep  2 13:27:57 2017\nNew Revision: 1807047\n\nURL: http://svn.apache.org/viewvc?rev=1807047&view=rev\nLog:\nBug 61384 - Adding charset to multipart/form-data content type irritates IIS\nRevert changes as per further analysis and jmeter/hc mailing lists answers\nBugzilla Id: 61384\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/sampler/TestHTTPSamplersAgainstHttpMirrorServer.java", "is_private": false, "bug_id": 61384, "id": 200581, "time": "2017-09-02T13:28:36Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-09-02T13:28:36Z", "attachment_id": null}]
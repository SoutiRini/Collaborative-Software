[{"attachment_id": null, "tags": [], "bug_id": 13021, "is_private": false, "count": 0, "id": 23423, "time": "2002-09-26T09:09:19Z", "creator": "emilc77prof@softhome.net", "creation_time": "2002-09-26T09:09:19Z", "text": "reason:\nthere may be another application that reads the log (a viewer), with \nRanomAccessFile (set on \"R\"). When you try to renameTo(), program fails to \nrename, and bye-bye the backup file;\nThe same problem we encountered with RollingFileAppender\n\nI Propose:\nreplace renameTo()... with copy(); the backup file is created all the times.\n\npresent code:\n\nboolean result = file.renameTo(target);\nif(result) {\nLogLog.debug(fileName +\" -> \"+ scheduledFilename);\n} else {\nLogLog.error(\"Failed to rename [\"+fileName+\"] to [\"+scheduledFilename+\"].\");\n}\n\nproposed code:\n\n// copy file content to target instead of renaming it\njava.io.BufferedReader in = null;\njava.io.BufferedWriter out = null;\ntry {\n    if (getEncoding() == null) {\n        in = new java.io.BufferedReader(new java.io.FileReader(file));\n        out = new java.io.BufferedWriter(new java.io.FileWriter(target));\n    } else {\n        in = new java.io.BufferedReader(new java.io.InputStreamReader( new \njava.io.FileInputStream(file), getEncoding()));\n        out = new java.io.BufferedWriter(new java.io.OutputStreamWriter( new \njava.io.FileOutputStream(target), getEncoding()));\n    }\n    int length;\n    String line;\n    while ((line = in.readLine()) != null) {\n        if (line.length() != 0) {\n            out.write(line);\n        }\n        out.newLine();\n    }\n    LogLog.debug(fileName +\" -> \"+ scheduledFilename);\n}catch(java.io.IOException exc){\n    LogLog.error(\"Failed to copy [\" + fileName + \"] to [\" + scheduledFilename \n+ \"].\");\n    // exc.printStackTrace();\n} finally {\n    if (out != null) {\n        out.close();\n    }\n    if (in != null) {\n        in.close();\n    }\n}"}, {"count": 1, "tags": [], "bug_id": 13021, "text": "We also have problems with the RollingFileAppender and File.renameTo(). RenameTo is a critical \nmethod, it is not platform independent. See bug database at java.sun.com and you will find \nseveral entries. We have encountered the problem with JDK 1.4.1 on Solaris. If rollOver fails \ncurrently, the server application can't do anything!\n\nThe suggested solution seems to solve \nthese problems: avoid File.renameTo().", "id": 27107, "attachment_id": null, "creator": "Jovovich@gmx.net", "creation_time": "2002-11-28T11:17:11Z", "time": "2002-11-28T11:17:11Z", "is_private": false}, {"count": 2, "tags": [], "creator": "Brian@PingToo.com", "text": "(In reply to comment #1)\n> We also have problems with the RollingFileAppender and File.renameTo().\nRenameTo is a critical \n> method, it is not platform independent. See bug database at java.sun.com and\nyou will find \n> several entries. We have encountered the problem with JDK 1.4.1 on Solaris. If\nrollOver fails \n> currently, the server application can't do anything!\n> \n> The suggested solution seems to solve \n> these problems: avoid File.renameTo().\n\n\nSun think they have closed this problem in J2SE 5.0 (4167147) by changing the\nspecification!!! Not much help to those of us in the real world, because there\nis no real alternative. I've tested the suggested fix and it \"works\", but does\nnot address the issue in a general manner.\n\nI believe this log4j bug (13021) is a duplicate of 29726. Please refer to the\nearlier bug for more discussion. Further posting here would just be confusing.", "id": 67541, "time": "2004-11-29T15:07:51Z", "bug_id": 13021, "creation_time": "2004-11-29T15:07:51Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 13021, "text": "Yup, it's the same issue.\n\n*** This bug has been marked as a duplicate of 29726 ***", "id": 68263, "time": "2004-12-10T18:20:44Z", "creator": "yoavs@computer.org", "creation_time": "2004-12-10T18:20:44Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "steven.libonati@wachovia.com", "attachment_id": null, "id": 95498, "time": "2006-11-06T14:12:47Z", "bug_id": 40912, "creation_time": "2006-11-06T14:12:47Z", "is_private": false, "text": "In the following testcases, it seems the file is deleted whether the property \nis set or not. Therefore, I believe there is a bug with patternset. When I \ndon't use patternset, all works as expected. See tests 3 and 4.\n\n# test 1 listing \n\n<?xml version=\"1.0\"?>\n<project name=\"test1\" basedir=\".\" default=\"test1\">\n\t\n\t<property name=\"test-prop\" value=\"true\" />\n\t\n\t<patternset id=\"test.patternset\">\n\t\t<include name=\"myfile\" unless=\"test-prop\" />\n\t</patternset>\n\t\n\t<!-- using patternset, property is set -->\n\t\n\t<target name=\"test1\">\t\n\t\t<echo>${test-prop}</echo>\n\t\t<mkdir dir=\"mydir\" />\n\t\t<touch file=\"mydir/myfile\" />\n\t\t<delete failonerror=\"false\">\n\t\t\t<fileset dir=\"mydir\">\n\t\t\t\t<patternset refid=\"test.patternset\" />\n\t\t\t</fileset>\n\t\t</delete>\n\t</target>\n\n</project>\n\n# test1 results\n\nBuildfile: test1.xml\n\ntest1:\n     [echo] true\n    [mkdir] Created dir: C:\\ant-bug\\mydir\n    [touch] Creating C:\\ant-bug\\mydir\\myfile\n   [delete] Deleting 1 files from C:\\ant-bug\\mydir\n\nBUILD SUCCESSFUL\nTotal time: 1 second\n\n#test2 listing\n\n<?xml version=\"1.0\"?>\n<project name=\"test2\" basedir=\".\" default=\"test2\">\n\t\n\t<patternset id=\"test.patternset\">\n\t\t<include name=\"myfile\" unless=\"test-prop\" />\n\t</patternset>\n\n\n\t<!-- using patternset, property is not set -->\n\t<target name=\"test2\">\n\t\t\n\t\t<echo>${test-prop}</echo>\n\t\t<mkdir dir=\"mydir\" />\n\t\t<touch file=\"mydir/myfile\" />\n\t\t<delete failonerror=\"false\">\n\t\t\t<fileset dir=\"mydir\">\n\t\t\t\t<patternset refid=\"test.patternset\" />\n\t\t\t</fileset>\n\t\t</delete>\n\t</target>\n</project>\n\n#test2 results\n\nBuildfile: test2.xml\n\ntest2:\n     [echo] ${test-prop}\n    [touch] Creating C:\\ant-bug\\mydir\\myfile\n   [delete] Deleting 1 files from C:\\ant-bug\\mydir\n\nBUILD SUCCESSFUL\nTotal time: 1 second\n\n#test3 listing\n\n<?xml version=\"1.0\"?>\n<project name=\"test3\" basedir=\".\" default=\"test3\">\n\t\n\t<property name=\"test-prop\" value=\"true\" />\n\n\t<target name=\"test3\">\n\t\t<!-- not using patternset, property is set -->\n\t\t<property name=\"test-prop\" value=\"true\" />\n\t\t<echo>${test-prop}</echo>\n\t\t<mkdir dir=\"mydir\" />\n\t\t<touch file=\"mydir/myfile\" />\n\t\t<delete failonerror=\"false\">\n\t\t\t<fileset dir=\"mydir\">\n\t\t\t\t<include name=\"myfile\" unless=\"test-prop\" />\n\t\t\t</fileset>\n\t\t</delete>\n\t</target>\n\t\n\n</project>\n\n#test3 results\n\nBuildfile: test3.xml\n\ntest3:\n     [echo] true\n    [touch] Creating C:\\ant-bug\\mydir\\myfile\n\nBUILD SUCCESSFUL\nTotal time: 1 second\n\n#test4 listing\n\n<?xml version=\"1.0\"?>\n<project name=\"test4\" basedir=\".\" default=\"test4\">\n\t\n\t<!-- not using patternset, property is not set -->\n\t\n\t<target name=\"test4\">\n\t\t<echo>${test-prop}</echo>\n\t\t<mkdir dir=\"mydir\" />\n\t\t<touch file=\"mydir/myfile\" />\n\t\t<delete failonerror=\"false\">\n\t\t\t<fileset dir=\"mydir\">\n\t\t\t\t<include name=\"myfile\" unless=\"test-prop\" />\n\t\t\t</fileset>\n\t\t</delete>\n\t</target>\n\n</project>\n\n#test4 results\n\nBuildfile: test4.xml\n\ntest4:\n     [echo] ${test-prop}\n   [delete] Deleting 1 files from C:\\ant-bug\\mydir\n\nBUILD SUCCESSFUL\nTotal time: 1 second"}, {"count": 1, "tags": [], "bug_id": 40912, "text": "The problem with your conditional patternset is that when your property is not\nset, the patternset effectively doesn't exist.  This defaults your fileset to\ninclude **/* .  You should see the behavior you want if you switch to <exclude\nname=\"myfile\" if=\"test-prop\" />", "id": 95499, "time": "2006-11-06T14:20:49Z", "creator": "mbenson@apache.org", "creation_time": "2006-11-06T14:20:49Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "ruediger.pluem@vodafone.com", "text": "Hi,\n\nthere may be a problem with the COPY request handling in the WebDAV servlet of\nTomcat.\n\nEnvironment:\n\nI created the webdav application with the following web.xml file in\nwebapps/webdav/WEB-INF:\n\n<!DOCTYPE web-app\n    PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n    \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n \n<web-app>\n \n  <servlet>\n    <servlet-name>webdav</servlet-name>\n    <servlet-class>org.apache.catalina.servlets.WebdavServlet</servlet-class>\n    <init-param>\n      <param-name>debug</param-name>\n      <param-value>10</param-value>\n    </init-param>\n    <init-param>\n      <param-name>listings</param-name>\n      <param-value>true</param-value>\n    </init-param>\n    <!-- Uncomment this to enable read and write access -->\n    <init-param>\n      <param-name>readonly</param-name>\n      <param-value>false</param-value>\n    </init-param>\n    <!--load-on-startup>1</load-on-startup-->\n  </servlet>\n  <servlet-mapping>\n    <servlet-name>webdav</servlet-name>\n    <url-pattern>/</url-pattern>\n  </servlet-mapping>\n\n</web-app>\n\nThe directory webapps/webdav/ is writable by the Tomcat jvm.\n\nI created the collection col and uploaded the file file.txt with cadaver (which\nworked fine).\n\nSo this is our starting point:\n\ndav:/webdav/> ls\nListing collection `/webdav/': succeeded.\nColl:  col                                     0  Jan  1  1970\n       file.txt                              625  Feb 24 12:21\n\n\n1. If the source resource is a file and the destination resource is an existing\ncollection the collection\ngets deleted and replaced by the file. For example the following request\n\nCOPY /webdav/file.txt HTTP/1.1\nHost: 127.0.0.1:8080\nConnection: TE\nTE: trailers\nDepth: infinity\nDestination: http://127.0.0.1:8080/webdav/col/\nOverwrite: T\n\ndeletes the collection col and replaces it with a file that is named col and has\nthe contents of file.txt.\n\n\n2. If the source resource is collection and the destination resource is a\nexisting file the file\ngets deleted and replaced by the collection. For example the following request\n\n\nCOPY /webdav/col/ HTTP/1.1\nHost: 127.0.0.1:8080\nConnection: TE\nTE: trailers\nDepth: infinity\nDestination: http://127.0.0.1:8080/webdav/file.txt\nOverwrite: T\n\ndeletes the file file.txt and replaces it with a collection that is named\nfile.txt and has the contents of col.\n\nFrom reading RFC 2518 I am not quite sure if this may be an intended behaviour,\nbut I noticed it as it is quite\ndifferent from the behaviour of a UNIX cp command and thus may lead to\nunnecessary loss of data.\n\nIf it works as designed just let me know. Then I need to be more careful in the\nfuture when handling with webdav :-).\n\n\nRegards\n\n\nR\u00fcdiger Pl\u00fcm", "id": 52849, "attachment_id": null, "bug_id": 27185, "creation_time": "2004-02-24T13:08:32Z", "time": "2004-02-24T13:08:32Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 27185, "is_private": false, "text": "This is working as per the webdav spec.\n<spec-quote>\n8.8.4 COPY and the Overwrite Header\n\n   If a resource exists at the destination and the Overwrite header is\n   \"T\" then prior to performing the copy the server MUST perform a\n   DELETE with \"Depth: infinity\" on the destination resource.  If the\n   Overwrite header is set to \"F\" then the operation will fail.\n</spec-quote>\n\nThe spec makes no reference to the type of source and destination resources \nhaving an effect on whether or not the copy takes place.\n\nNote: A resource may be a file or a collection.\n\nI am afraid you are just going to have to be careful ;)", "id": 52899, "time": "2004-02-24T23:43:08Z", "creator": "markt@apache.org", "creation_time": "2004-02-24T23:43:08Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 53367, "attachment_id": null, "id": 159733, "time": "2012-06-06T01:01:10Z", "creator": "fhanik@apache.org", "creation_time": "2012-06-06T01:01:10Z", "is_private": false, "text": "during the \n con.connect(); \ncall in the method \n\nprotected PooledConnection borrowConnection(long now, PooledConnection con, String username, String password) in ConnectionPool.java\n\nThere is no counting down the size of the pool. This means, if a connection failure happens here, the pool size remains the same. This means that 'size' will show the pool as full, but in reality the pool is empty"}, {"count": 1, "tags": [], "creator": "fhanik@apache.org", "text": "Fixed in r1346691", "id": 159734, "time": "2012-06-06T01:03:16Z", "bug_id": 53367, "creation_time": "2012-06-06T01:03:16Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "monteslu@gmail.com", "text": "I don't believe this is fixed.  Pulled down from svn trunk, buit, and can still easily reproduce.", "id": 160488, "time": "2012-07-07T16:55:04Z", "bug_id": 53367, "creation_time": "2012-07-07T16:55:04Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 53367, "is_private": false, "id": 160536, "time": "2012-07-09T15:55:27Z", "creator": "fhanik@apache.org", "creation_time": "2012-07-09T15:55:27Z", "tags": [], "text": "I'll take a look today"}, {"count": 4, "tags": [], "bug_id": 53367, "attachment_id": null, "text": "Please post your configuration. Reran all tests and I'm unable to reproduce this issue.", "id": 160538, "time": "2012-07-09T16:22:19Z", "creator": "fhanik@apache.org", "creation_time": "2012-07-09T16:22:19Z", "is_private": false}, {"count": 5, "tags": [], "text": "Unable to reproduce after ticket has been reopened. Please reopen with at a minimum your configuration.", "attachment_id": null, "bug_id": 53367, "id": 160544, "time": "2012-07-09T17:43:30Z", "creator": "fhanik@apache.org", "creation_time": "2012-07-09T17:43:30Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 53367, "is_private": false, "text": "I'm able to reproduce the error on tomact 7.0.37\n\nException: [http-bio-8080-exec-41] Timeout: Pool empty. Unable to fetch a connection in 30 seconds, none available[size:120; busy:119; idle:0; lastwait:30000].\nException: [http-bio-8080-exec-33] Timeout: Pool empty. Unable to fetch a connection in 30 seconds, none available[size:120; busy:119; idle:0; lastwait:30000].\nException: [http-bio-8080-exec-3] Timeout: Pool empty. Unable to fetch a connection in 30 seconds, none available[size:120; busy:119; idle:0; lastwait:30000].", "id": 173964, "time": "2014-03-20T06:45:08Z", "creator": "nashfrequent@gmail.com", "creation_time": "2014-03-20T06:45:08Z", "attachment_id": null}, {"count": 7, "text": "How about Tomcat 7.0.52 -- the latest?\n\nAlso, you haven't provided any indication that this is a problem with the pool... it could just be misuse of the pool. You'll need configuration, thread dumps, etc. to justify reopening this bug.", "bug_id": 53367, "attachment_id": null, "id": 173982, "time": "2014-03-20T19:14:34Z", "creator": "chris@christopherschultz.net", "creation_time": "2014-03-20T19:14:34Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 53367, "attachment_id": null, "text": "I think you may experience a different scenario here, than the actual bug reported.\nhttp://svn.apache.org/viewvc/tomcat/tc7.0.x/trunk/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool/ConnectionPool.java?view=markup\n\nLine\nthrow new PoolExhaustedException(\"[\" + Thread.currentThread().getName()+\"] \" +\n                        \"Timeout: Pool empty. Unable to fetch a connection in \" + (maxWait / 1000) +\n                        \" seconds, none available[size:\"+size.get() +\"; busy:\"+busy.size()+\"; idle:\"+idle.size()+\"; lastwait:\"+timetowait+\"].\");\n\nThe statement\n  busy.size()\nis not just a counter, it actually measures the number of connections that are placed in the busy queue.\n\nHere is what I would do\n\n1. set logAbandoned=\"true\"\n//this will print a log entry of places in your code that are leaking connections (ie failing to call Connection.close())\n\nWith the log output from 1, we should be able to resolve all your problems.", "id": 173994, "time": "2014-03-21T14:29:01Z", "creator": "fhanik@apache.org", "creation_time": "2014-03-21T14:29:01Z", "is_private": false}, {"count": 9, "text": "Created attachment 31838\nTest demonstrating jdbc-pool connection leakage\n\nI wrote a test which demonstrates how connections can be leaked. To execute the test you need MySQL server running on port 3306.", "bug_id": 53367, "attachment_id": 31838, "id": 176574, "time": "2014-07-22T01:36:19Z", "creator": "asafonov@tango.me", "creation_time": "2014-07-22T01:36:19Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "bug_id": 53367, "is_private": false, "text": "Created attachment 31840\nUnit test demonstrating fair queue not working properly\n\nThis tests correctly fails (assertion fails) when it is supposed to properly show the bug.", "id": 176582, "time": "2014-07-22T09:56:36Z", "creator": "fhanik@apache.org", "creation_time": "2014-07-22T09:56:36Z", "attachment_id": 31840}, {"count": 11, "tags": [], "bug_id": 53367, "attachment_id": null, "id": 176583, "time": "2014-07-22T09:57:54Z", "creator": "fhanik@apache.org", "creation_time": "2014-07-22T09:57:54Z", "is_private": false, "text": "(In reply to Anton from comment #9)\n> Created attachment 31838 [details]\n> Test demonstrating jdbc-pool connection leakage\n> \n> I wrote a test which demonstrates how connections can be leaked. To execute\n> the test you need MySQL server running on port 3306.\n\nAnton, thank you for your test. I do confirm the bug you are seeing.\nHere is what I got\n\n1. work around is to set poolProperties.setFairQueue(false)\n2. I did modify the test to properly fail on assertion to demonstrate the actual bug\n\nI will get this fixed."}, {"count": 12, "text": "Great, thank you!", "bug_id": 53367, "attachment_id": null, "id": 176595, "time": "2014-07-22T16:40:46Z", "creator": "asafonov@tango.me", "creation_time": "2014-07-22T16:40:46Z", "tags": [], "is_private": false}, {"count": 13, "tags": [], "text": "Fixed in trunk at r1613123", "attachment_id": null, "id": 176649, "creation_time": "2014-07-24T13:44:24Z", "time": "2014-07-24T13:44:24Z", "creator": "fhanik@apache.org", "bug_id": 53367, "is_private": false}, {"count": 14, "attachment_id": null, "bug_id": 53367, "is_private": false, "id": 176650, "time": "2014-07-24T14:02:13Z", "creator": "fhanik@apache.org", "creation_time": "2014-07-24T14:02:13Z", "tags": [], "text": "Fixed in r1613137 of Tomcat 7 branch"}, {"count": 15, "tags": [], "bug_id": 53367, "is_private": false, "text": "Flag correction in trunk r1613135", "id": 176651, "time": "2014-07-24T14:02:54Z", "creator": "fhanik@apache.org", "creation_time": "2014-07-24T14:02:54Z", "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 53367, "attachment_id": null, "id": 183330, "time": "2015-06-04T17:12:21Z", "creator": "fhanik@apache.org", "creation_time": "2015-06-04T17:12:21Z", "is_private": false, "text": "*** Bug 56660 has been marked as a duplicate of this bug. ***"}]
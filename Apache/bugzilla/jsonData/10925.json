[{"attachment_id": null, "tags": [], "creator": "craig@netapp.com", "text": "> diff -u orig-mod_ext_filter.c mod_ext_filter.c \n--- orig-mod_ext_filter.c       Wed Jul 17 12:07:58 2002\n+++ mod_ext_filter.c    Wed Jul 17 13:55:11 2002\n@@ -382,7 +382,9 @@\n     ef_ctx_t *ctx = f->ctx;\n     apr_status_t rc;\n     ef_dir_t *dc = ctx->dc;\n-\n+    const char * const *env;\n+    apr_table_t *e = f->r->subprocess_env;\n+        \n     ctx->proc = apr_pcalloc(ctx->p, sizeof(*ctx->proc));\n \n     rc = apr_procattr_create(&ctx->procattr, ctx->p);\n@@ -404,10 +406,29 @@\n         ap_assert(rc == APR_SUCCESS);\n     }\n                                   \n+    /* adding the CGI vars seems like a bit of overkill, but I figure the only\n+     * drawback is the time necessary to run the routine.\n+     * If someone is using mod_ext_filter, then they are probably not\n+     * overly concerned about performance.\n+     */\n+    ap_add_cgi_vars(f->r);\n+    apr_table_setn(f->r->subprocess_env, \"DOCUMENT_URI\", f->r->uri);\n+    apr_table_setn(f->r->subprocess_env, \"DOCUMENT_PATH_INFO\", f->r->path_info);\n+    if (f->r->args) {\n+            /* QUERY_STRING is added by ap_add_cgi_vars */\n+        char *arg_copy = apr_pstrdup(f->r->pool, f->r->args);\n+        ap_unescape_url(arg_copy);\n+        apr_table_setn(f->r->subprocess_env, \"QUERY_STRING_UNESCAPED\",\n+                       ap_escape_shell_cmd(f->r->pool, arg_copy));\n+    }\n+\n+    env = (const char * const *) ap_create_environment(ctx->p,\n+                                                       f->r->subprocess_env);\n+\n     rc = apr_proc_create(ctx->proc, \n                             ctx->filter->command, \n                             (const char * const *)ctx->filter->args, \n-                            NULL, /* environment */\n+                            env, /* environment */\n                             ctx->procattr, \n                             ctx->p);\n     if (rc != APR_SUCCESS) {", "count": 0, "id": 19720, "time": "2002-07-17T21:02:55Z", "bug_id": 10925, "creation_time": "2002-07-17T21:02:55Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 10925, "attachment_id": null, "id": 19764, "time": "2002-07-18T12:40:38Z", "creator": "trawick@apache.org", "creation_time": "2002-07-18T12:40:38Z", "is_private": false, "text": "code committed with trivial tweaks, doc updated\n\nThanks for your patch, and thanks for using mod_ext_filter.\n"}, {"count": 2, "text": "*** Bug 11353 has been marked as a duplicate of this bug. ***", "creator": "slive@apache.org", "attachment_id": null, "id": 20550, "time": "2002-08-01T17:08:19Z", "bug_id": 10925, "creation_time": "2002-08-01T17:08:19Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 57888, "attachment_id": null, "text": "build.xml:\n\n    <project name=\"test\" default=\"build\">\n      <target name=\"build\">\n        <exec executable=\"cmd.exe\" failonerror=\"true\">\n          <arg value=\"/c\"/>\n          <arg value=\"ant.bat\"/>\n          <arg value=\"-Da=\"/>\n          <arg value=\"-Db=c\"/>\n        </exec>\n      </target>\n    </project>\n\nsub-build.xml:\n\n    <project name=\"sub-build\" default=\"build\">\n      <target name=\"build\">\n        <echo message=\"The value we get in the sub-build: ${a}\"/>\n      </target>\n    </project>\n\nC:\\Users\\Tester\\Documents\\issues\\ant\\cmd mangling>ant -verbose\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0\nApache Ant(TM) version 1.9.4 compiled on April 29 2014\nTrying the default build file: build.xml\nBuildfile: C:\\Users\\Tester\\Documents\\issues\\ant\\cmd mangling\\build.xml\nDetected Java version: 1.8 in: c:\\DevEnv\\Tools\\Java\\jdk1.8.0_05\\jre\nDetected OS: Windows 8\nparsing buildfile C:\\Users\\Tester\\Documents\\issues\\ant\\cmd mangling\\build.xml with URI = file:/C:/Users/Tester/Documents/issues/ant/cmd%20mangling/build.xml\nProject base dir set to: C:\\Users\\Tester\\Documents\\issues\\ant\\cmd mangling\nBuild sequence for target(s) `build' is [build]\nComplete build sequence is [build, ]\n\nbuild:\nparsing buildfile jar:file:/C:/DevEnv/Common/Tools/Ant/lib/ant.jar!/org/apache/tools/ant/antlib.xml with URI = jar:file:/C:/DevEnv/Common/Tools/Ant/lib/ant.jar!/org/apache/tools/an\nt/antlib.xml from a zip file\n     [exec] Current OS is Windows 8\n     [exec] Executing 'cmd.exe' with arguments:\n     [exec] '/c'\n     [exec] 'ant.bat'\n     [exec] '-Da='\n     [exec] '-Db=c'\n     [exec]\n     [exec] The ' characters around the executable and arguments are\n     [exec] not part of the command.\n     [exec] Buildfile: C:\\Users\\Tester\\Documents\\issues\\ant\\cmd mangling\\build.xml\n     [exec]\n     [exec] BUILD FAILED\n     [exec] Target \"c\" does not exist in the project \"test\".\n     [exec]\n     [exec] Total time: 0 seconds\n\nOther notes:\n* The same happens if you exec executable=\"ant.bat\". This script uses \"cmd.exe\" because the exec task docs warn about \"ant.bat\" not working (which does not appear to be the case.)\n* The equivalent works fine on any other platform.\n* Using exec to run java instead seems to work, but then you have to mess around replicating things handled by the Ant script, such as inserting ANT_OPTS and ANT_ARGS at the appropriate positions.\n\nThe road here:\n* We had to run our build under a different JDK from the one Ant was launched with.\n* Since the <ant> task doesn't let you specify the JDK to use at all, we tried to fork ant explicitly using <exec>.\n* Now we find our command-line is being mangled.", "id": 182826, "time": "2015-05-05T01:25:07Z", "creator": "trejkaz@trypticon.org", "creation_time": "2015-05-05T01:25:07Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 57888, "is_private": false, "text": "Turns out running it directly breaks too, so I guess it isn't exec, it must be either cmd or the batch file.\n\nC:\\Users\\Tester\\Documents\\issues\\ant\\cmd mangling> ant -f sub-build.xml -Da= -Db=c\n\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0\nBuildfile: C:\\Users\\Daniel\\Documents\\issues\\ant\\cmd mangling\\sub-build.xml\n\nBUILD FAILED\nTarget \"c\" does not exist in the project \"sub-build\".\n\nTotal time: 0 seconds", "id": 182829, "time": "2015-05-05T02:00:30Z", "creator": "trejkaz@trypticon.org", "creation_time": "2015-05-05T02:00:30Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 57888, "attachment_id": null, "is_private": false, "id": 182981, "time": "2015-05-14T05:25:22Z", "creator": "bodewig@apache.org", "creation_time": "2015-05-14T05:25:22Z", "text": "This is the nature of Windows batch files https://support.microsoft.com/en-us/kb/35938\n\nThe code inside the batch file sees\n\n'/c'\n'ant.bat'\n'-Da'\n'-Db'\n'c'\n\nand there isn't anything we could do about it.  You will need to provide some kind of value to a.  IIRC quoting won't help either."}, {"count": 3, "tags": [], "text": "My guess is that providing an ant.exe might get around it.", "is_private": false, "id": 182982, "creator": "trejkaz@trypticon.org", "time": "2015-05-14T09:24:02Z", "bug_id": 57888, "creation_time": "2015-05-14T09:24:02Z", "attachment_id": null}]
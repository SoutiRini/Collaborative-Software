[{"count": 0, "tags": [], "bug_id": 45961, "text": "I developed own canonicalization method and register it. Sign with my method perform successful, but verify finished with error: Cannot find SignatureValue in Signature. Constructor SignedInfo(Element, Strign) canonicalize ds:SignedInfo by my method, reparse it into a new document and replace the original not-canonicalized ds:SignedInfo. After replace, XMLSignature try get ds:SignatureValue by method getNextSibling of element ds:SignedInfo. But it is null!", "id": 121265, "time": "2008-10-07T05:17:09Z", "creator": "anton.k.ekb@gmail.com", "creation_time": "2008-10-07T05:17:09Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "sean.mullan@oracle.com", "attachment_id": null, "is_private": false, "id": 121270, "time": "2008-10-07T06:55:04Z", "bug_id": 45961, "creation_time": "2008-10-07T06:55:04Z", "text": "(In reply to comment #0)\n> I developed own canonicalization method and register it. Sign with my method\n> perform successful, but verify finished with error: Cannot find SignatureValue\n> in Signature. Constructor SignedInfo(Element, Strign) canonicalize\n> ds:SignedInfo by my method, reparse it into a new document and replace the\n> original not-canonicalized ds:SignedInfo. After replace, XMLSignature try get\n> ds:SignatureValue by method getNextSibling of element ds:SignedInfo. But it is\n> null!\n> \n\nYou say you parsed it into a new document, so did you use Document.importNode when replacing the SignedInfo in the original document?\n\nIn any case, we will need a reproducible test case to analyze this. Please \nattach it to the bug report, thanks.\n"}, {"count": 2, "tags": [], "bug_id": 45961, "attachment_id": 22689, "id": 121298, "time": "2008-10-07T21:48:06Z", "creator": "anton.k.ekb@gmail.com", "creation_time": "2008-10-07T21:48:06Z", "is_private": false, "text": "Created attachment 22689\nBug 45961 test case. (Eclipse project)"}, {"count": 3, "tags": [], "bug_id": 45961, "text": "> You say you parsed it into a new document, so did you use Document.importNode\n> when replacing the SignedInfo in the original document?\n\nSee org.apache.xml.security.signature.SignedInfo(element : Element, BaseURI : String) constructor.\n \n> In any case, we will need a reproducible test case to analyze this. Please \n> attach it to the bug report, thanks.\n \nOk. See attachement.\n", "id": 121299, "time": "2008-10-07T21:51:17Z", "creator": "anton.k.ekb@gmail.com", "creation_time": "2008-10-07T21:51:17Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "sean.mullan@oracle.com", "is_private": false, "text": "This is not a bug. You are invoking the XMLSignature(Element, String) constructor with a Signature element that is not complete. This constructor should be invoked when you are validating an XML Signature that has been parsed from a Document. You need to first generate an XML Signature using your CanonicalizationMethod, but before you do that you must register your CanonicalizationMethod impl. with the register method so that the XMLSec library is aware of it. You may want to look at some of the XML Signature samples to see how to generate XML Signatures.", "id": 121401, "time": "2008-10-10T06:07:22Z", "bug_id": 45961, "creation_time": "2008-10-10T06:07:22Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "anton.k.ekb@gmail.com", "is_private": false, "text": "Created attachment 22717\nBug 45961 test case 2. (Eclipse project)", "id": 121455, "time": "2008-10-12T22:05:44Z", "bug_id": 45961, "creation_time": "2008-10-12T22:05:44Z", "attachment_id": 22717}, {"count": 6, "tags": [], "creator": "anton.k.ekb@gmail.com", "is_private": false, "text": "(In reply to comment #4)\n> This is not a bug. You are invoking the XMLSignature(Element, String)\n> constructor with a Signature element that is not complete. This constructor\n> should be invoked when you are validating an XML Signature that has been parsed\n> from a Document. You need to first generate an XML Signature using your\n> CanonicalizationMethod, but before you do that you must register your\n> CanonicalizationMethod impl. with the register method so that the XMLSec\n> library is aware of it. You may want to look at some of the XML Signature\n> samples to see how to generate XML Signatures.\n> \n\nOk. Now I\u2019m invoking the XMLSignature(Element, String) constructor with a Signature element that is complete. And again I'm getting a exception with a error message \u201cCannot find SignatureValue in Signature\u201d. See attachment.\n", "id": 121456, "time": "2008-10-12T22:42:02Z", "bug_id": 45961, "creation_time": "2008-10-12T22:42:02Z", "attachment_id": null}, {"count": 7, "text": "Fixed in the latest source tree.\n\nThe problem was that if you define a custom canonicalization method, the SignedInfo element is canonicalized and replaced before validating the signature and references (as a security precaution). However, the code was still holding a stale reference to the old SignedInfo element, thus the exception. The fix was to simply get a reference to the new SignedInfo element.", "bug_id": 45961, "attachment_id": null, "id": 121502, "time": "2008-10-14T08:18:12Z", "creator": "sean.mullan@oracle.com", "creation_time": "2008-10-14T08:18:12Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 45961, "text": "Created attachment 22732\nBug 45961 test case 3.", "id": 121527, "time": "2008-10-15T03:01:24Z", "creator": "anton.k.ekb@gmail.com", "creation_time": "2008-10-15T03:01:24Z", "is_private": false, "attachment_id": 22732}, {"count": 9, "tags": [], "creator": "anton.k.ekb@gmail.com", "is_private": false, "text": "I sign document with enveloped transform and own canonicaliztion method. Document verification is finishing with error in a work of transformer TransformEnvelopedSignature. Because a instance of SignedInfo saves references to old element Reference into array _referenceEl. See attachment.", "id": 121528, "time": "2008-10-15T03:24:53Z", "bug_id": 45961, "creation_time": "2008-10-15T03:24:53Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 45961, "attachment_id": null, "id": 121631, "time": "2008-10-16T08:44:51Z", "creator": "sean.mullan@oracle.com", "creation_time": "2008-10-16T08:44:51Z", "is_private": false, "text": "Thanks for the updated test case. Should be fixed now. Fixes have been checked\ninto latest source tree."}]
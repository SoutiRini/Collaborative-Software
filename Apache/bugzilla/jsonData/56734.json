[{"count": 0, "tags": [], "bug_id": 56734, "attachment_id": 31824, "text": "Created attachment 31824\nPatch for 2.5-HEAD /trunk, ideally backport to 2.4.x.\n\nmod_lua setcookie applies double-quotes to Expires and Path ( e.g. Path=\"/web-app\"; ) that break at least MSIE.  This should not enclose the Expires and Path in double-quotes since, although the examples in earlier versions of HTTP Cookie RFC show double-quoted values, it's not so in the latest RFC http://tools.ietf.org/html/rfc6265 and it does prevent the cookie from being sent to the server in at least MSIE 9, breaking for example /web-app session cookies.\n\nThis is related to https://issues.apache.org/bugzilla/show_bug.cgi?id=52779 .\n\nI've attached a 2.4-HEAD patch for lua_request.c, ideally to work back to 2.4.x, and below is a work-around in Lua itself.\n\n-- Use this setCookie instead of Apache r:setcookie.\n-- Apache r:setcookie is broken where double-quotes are added to Path\nfunction setCookie(r,c)\n\tlocal expires = ''\n\tif c.expires ~= nil then\n\t\tif type(c.expires) == \"number\" then expires = '; Expires='.. os.date(\"!%a, %d %b %Y %H:%M:%S GMT\",c.expires)\n\t\telse expires = '; Expires='.. c.expires\n\t\tend\n\telse \n\t\texpires = ''\n\tend\n\t\n\tr.err_headers_out[\"Set-Cookie\"] = c.key ..'='.. c.value .. expires ..\n\t\t(c.domain ~= nil and '; Domain='.. c.domain or '') ..\n\t\t((c.path ~= nil and string.len(c.path) ~= 0) and '; Path='.. c.path or '') ..\n\t\t((c.secure ~= nil and c.secure) and '; Secure' or '') ..\n\t\t((c.httponly ~= nil and c.httponly) and '; HttpOnly' or '')\nend", "id": 176446, "time": "2014-07-17T03:42:15Z", "creator": "kmashint@yahoo.com", "creation_time": "2014-07-17T03:42:15Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 56734, "attachment_id": null, "id": 176510, "creation_time": "2014-07-18T19:16:41Z", "time": "2014-07-18T19:16:41Z", "creator": "humbedooh@apache.org", "text": "Fixed in trunk (r1611741) and 2.4.x (r1611744), thanks!", "is_private": false}]
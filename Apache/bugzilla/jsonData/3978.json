[{"count": 0, "tags": [], "creator": "pwray@lgc.com", "attachment_id": null, "id": 6389, "time": "2001-10-04T12:53:44Z", "bug_id": 3978, "creation_time": "2001-10-04T12:53:44Z", "is_private": false, "text": "Ant fails to create the junit task.\n\nHere is the target containing the junit task:\n\n    <target name=\"test\" depends=\"init\" description=\"Run unit tests\">\n        <delete dir=\"${junit.results}\"/>\n        <mkdir dir=\"${junit.results}\"/>\n        <property name=\"DefClassPath\" refid=\"classpath.default\" />\n        <echo message=\"Compiling with classpath ${DefClassPath}\" />\n        <echo message=\"Running unit tests...\"/>\n        <junit fork=\"yes\" haltonfailure=\"yes\">\n            <classpath>\n                <path refid=\"classpath.default\"/>\n                <pathelement location=\"${build.dir}\"/>\n            </classpath>\n            <formatter type=\"plain\" usefile=\"false\"/>\n            <formatter type=\"xml\"/>\n            <batchtest todir=\"${junit.results}\">\n                <fileset dir=\"${build.dir}\" includes=\"**/*Test.class\"/>\n            </batchtest>\n        </junit>\n    </target>\n\n\nHere is the classpath it works with locally:\n\n     [echo] Compiling with classpath C:\\junit3.7\\lib\\junit.jar;C:\\junit3.7\\lib\\s\nrc.jar;C:\\ant\\jakarta-ant-1.4\\lib\\ant.jar;C:\\ant\\jakarta-ant-1.4\\lib\\crimson.jar\n;C:\\ant\\jakarta-ant-1.4\\lib\\jakarta-ant-1.4-optional.jar;C:\\ant\\jakarta-ant-1.4\\\nlib\\jaxp.jar;C:\\ant\\jakarta-ant-1.4\\lib\\StarTeam-sdk.jar;C:\\cruisecontrol\\1.2.1a\n\\cruisecontrol.jar;C:\\cruisecontrol\\1.2.1a\\lib\\activation.jar;C:\\cruisecontrol\\1\n.2.1a\\lib\\ant-leakfree.jar;C:\\cruisecontrol\\1.2.1a\\lib\\ant.jar;C:\\cruisecontrol\\\n1.2.1a\\lib\\jakarta-oro-2.0.3.jar;C:\\cruisecontrol\\1.2.1a\\lib\\jmxri.jar;C:\\cruise\ncontrol\\1.2.1a\\lib\\jmxtools.jar;C:\\cruisecontrol\\1.2.1a\\lib\\junit.jar;C:\\cruisec\nontrol\\1.2.1a\\lib\\mail.jar;C:\\cruisecontrol\\1.2.1a\\lib\\optional.jar;C:\\cruisecon\ntrol\\1.2.1a\\lib\\servlet.jar;C:\\cruisecontrol\\1.2.1a\\lib\\starteam-sdk-interfaceon\nly.jar;C:\\cruisecontrol\\1.2.1a\\lib\\StarTeam-sdk.jar;C:\\cruisecontrol\\1.2.1a\\lib\\\nxalan.jar;C:\\cruisecontrol\\1.2.1a\\lib\\xerces.jar\n\nHere is the error:\n\nBUILD FAILED\n\nC:\\cruisecontrol\\1.2.1a\\bin\\starteambuild.xml:135: Could not create task of type\n: junit due to java.lang.NoClassDefFoundError: junit/framework/TestListener\n        at org.apache.tools.ant.Project.createTask(Project.java:509)\n        at org.apache.tools.ant.UnknownElement.makeTask(UnknownElement.java:148)\n\n        at org.apache.tools.ant.UnknownElement.maybeConfigure(UnknownElement.jav\na:83)\n        at org.apache.tools.ant.Task.perform(Task.java:216)\n        at org.apache.tools.ant.Target.execute(Target.java:164)\n        at org.apache.tools.ant.Target.performTasks(Target.java:182)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:601)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:560)\n        at org.apache.tools.ant.Main.runBuild(Main.java:454)\n        at org.apache.tools.ant.Main.start(Main.java:153)\n        at org.apache.tools.ant.Main.main(Main.java:176)\n\nHere is the nested exception:\n\njava.lang.NoClassDefFoundError: junit/framework/TestListener\n        at java.lang.ClassLoader.defineClass0(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:486)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:11\n1)\n        at java.net.URLClassLoader.defineClass(URLClassLoader.java:248)\n        at java.net.URLClassLoader.access$100(URLClassLoader.java:56)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:195)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:297)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:286)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:253)\n        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:313)\n        at java.lang.Class.newInstance0(Native Method)\n        at java.lang.Class.newInstance(Class.java:237)\n        at org.apache.tools.ant.Project.createTask(Project.java:486)\n        at org.apache.tools.ant.UnknownElement.makeTask(UnknownElement.java:148)\n\n        at org.apache.tools.ant.UnknownElement.maybeConfigure(UnknownElement.jav\na:83)\n        at org.apache.tools.ant.Task.perform(Task.java:216)\n        at org.apache.tools.ant.Target.execute(Target.java:164)\n        at org.apache.tools.ant.Target.performTasks(Target.java:182)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:601)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:560)\n        at org.apache.tools.ant.Main.runBuild(Main.java:454)\n        at org.apache.tools.ant.Main.start(Main.java:153)\n        at org.apache.tools.ant.Main.main(Main.java:176)"}, {"count": 1, "tags": [], "text": "Hi,\n\nThis is expected behaviour. The junit.jar has to be in the same classloader \nthat the junit task is in. This means that you either have to place junit.jar \nin $ANT_HOME/lib or remove optional.jar from $ANT_HOME/lib and use <taskdef \n..> to define it with a classpath that includes junit and optional.jar\n", "attachment_id": null, "bug_id": 3978, "id": 6406, "time": "2001-10-05T02:15:24Z", "creator": "donaldp@apache.org", "creation_time": "2001-10-05T02:15:24Z", "is_private": false}]
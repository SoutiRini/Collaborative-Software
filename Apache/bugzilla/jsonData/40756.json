[{"count": 0, "tags": [], "bug_id": 40756, "text": "When an Apache config file contains any ProxyBlock directive, if a remote client\nattempts to proxy through the server (using CONNECT) to a target host which does\nnot have a DNS entry, httpd will segfault.\n\nap_proxy_connect_handler does a DNS lookup of uri.hostname in\nproxy_connect.c:127 and stores the result in uri_addr.  However, it does not\ncheck for an error until line 174.  On line 144, it calls\nap_proxy_checkproxyblock with the uri_addr variable, which can be NULL if the\nDNS lookup failed.  When ap_proxy_checkproxyblock tries to dereference uri_addr\n(in proxy_util.c:961 or 965), it accesses invalid memory.\n\nThere are a couple of possible solutions to this.  uri_addr is only dereferenced\nin the call to ap_log_error.  So ap_proxy_checkproxyblock could test uri_addr\nbefore calling ap_log_error.  The other solution is to move the check for DNS\nlookup failure in proxy_connect.c up from line 174 to around 129 (immediately\nfollowing the call to apr_sockaddr_info_get).", "id": 94820, "time": "2006-10-13T11:58:08Z", "creator": "tbeattie@boingo.com", "creation_time": "2006-10-13T11:58:08Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 40756, "text": "Created attachment 19005\nFix to check the result of apr_sockaddr_info_get before passing uri_addr to ap_proxy_checkproxyblock", "id": 94823, "time": "2006-10-13T12:52:34Z", "creator": "tbeattie@boingo.com", "creation_time": "2006-10-13T12:52:34Z", "is_private": false, "attachment_id": 19005}, {"count": 2, "tags": [], "text": "Is this ever going to be addressed.  I guess my users like requesting pages that\naren't in dns because I'm seeing it all over the place.  But I can only\nreproduce it with ProxyRemote as well as ProxyBlock.  If I have ProxyRemote off\nthen it works just fine.", "attachment_id": null, "bug_id": 40756, "id": 107353, "time": "2007-08-28T10:48:18Z", "creator": "j17f3y7xsxegdly2@nyms.net", "creation_time": "2007-08-28T10:48:18Z", "is_private": false}, {"count": 3, "tags": [], "creator": "j17f3y7xsxegdly2@nyms.net", "is_private": false, "text": "As soon as I sent that, I realized that I probably sounded snippity.  Totally\nnot intended.  Thank you for the wonderful web server and for all of your hard\nwork.  Dude I'm a dork some times.", "id": 107354, "time": "2007-08-28T10:49:26Z", "bug_id": 40756, "creation_time": "2007-08-28T10:49:26Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 40756, "text": "Reviewing after far too long, it appears your CONNECT patch may still be needed,\nbut the FTP patch appears unnecessary, as the current code makes the check\nbefore using the addr.  Is that a fair summary of 2.2?", "id": 107519, "time": "2007-08-30T16:50:33Z", "creator": "nick@webthing.com", "creation_time": "2007-08-30T16:50:33Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 40756, "attachment_id": null, "id": 107522, "time": "2007-08-30T18:45:12Z", "creator": "tbeattie@boingo.com", "creation_time": "2007-08-30T18:45:12Z", "is_private": false, "text": "After reviewing the code for httpd-2.2.0, it appears your assessment is correct.\n The patch I made applies to version 2.0.x."}, {"count": 6, "tags": [], "text": "Fixed in 2.2.6", "attachment_id": null, "id": 107874, "creator": "nick@webthing.com", "time": "2007-09-08T13:31:55Z", "bug_id": 40756, "creation_time": "2007-09-08T13:31:55Z", "is_private": false}]
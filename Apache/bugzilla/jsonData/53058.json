[{"count": 0, "tags": [], "bug_id": 53058, "attachment_id": 28574, "id": 157819, "time": "2012-04-10T22:02:43Z", "creator": "superrubiroyd@gmail.com", "creation_time": "2012-04-10T22:02:43Z", "is_private": false, "text": "Created attachment 28574\nPatch"}, {"count": 1, "tags": [], "bug_id": 53058, "attachment_id": 28575, "id": 157820, "time": "2012-04-10T22:05:20Z", "creator": "superrubiroyd@gmail.com", "creation_time": "2012-04-10T22:05:20Z", "is_private": false, "text": "Created attachment 28575\nSource xls file to show the structure of drawing records"}, {"count": 2, "tags": [], "bug_id": 53058, "attachment_id": 28576, "id": 157821, "time": "2012-04-10T22:06:30Z", "creator": "superrubiroyd@gmail.com", "creation_time": "2012-04-10T22:06:30Z", "is_private": false, "text": "Created attachment 28576\nTarget file which represents structure of workbook.xls in xml format"}, {"count": 3, "attachment_id": null, "bug_id": 53058, "text": "Hi, I have created this utility as part of my GSoC proposal.\nhttp://www.google-melange.com/gsoc/proposal/review/google/gsoc2012/evgeniy44/1\n\nI look forward to your feedback.", "id": 157822, "time": "2012-04-10T22:12:31Z", "creator": "superrubiroyd@gmail.com", "creation_time": "2012-04-10T22:12:31Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "text": "Hi Evgeniy,\n\nA very good start! I see that for now only a few records override toXML(): EscherSplitMenuColorsRecord, EscherBSERecord and EscherDggRecord.\nDo you plan to implement toXML for the rest of DDF ? I think the answer is 'yes', just want to confirm it. \n\nFor EscherOptRecord it would be great to show properties as child nodes, something like this:  \n\n<EscherOptRecord>\n  <Property id=\"127\" value=\"32440321\" name=\"protection.lockagainstgrouping\"/>\n  <Property id=\"128\" value=\"809474328\" name=\"text.textid\"/>\n  <Property id=\"191\" value=\"262148\"  name=\"text.sizetexttofitshape\"/>\n  <Property id=\"447\" value=\"1114113\"  name=\"fill.nofillhittest\"/>\n  <Property id=\"511\" value=\"1638417\" name=\"linestyle.nolinedrawdash\"/>\n  <Property id=\"831\" value=\"524288\"  name=\"shape.backgroundshape\"/>\n  <Property id=\"959\" value=\"131072\" name=\"groupshape.print\"/>\n</EscherOptRecord>\n\nSome records show recordId as decimals, others as hex. It should be unified, I think hex everywhere would be OK. \n\nRecords thar are not supported (UnknownEscherRecord) should print their data in hex form:\n<UnknownEscherRecord>\n  50 4B 03 04 14 00 06 00 08 00 00 00 21 00 98 28 26\n</UnknownEscherRecord>\n\nOther than that, very cool! \n\nLooking forward to working with you on GSoC!\n\nRegards,\nYegor", "is_private": false, "bug_id": 53058, "id": 157972, "time": "2012-04-12T08:57:02Z", "creator": "yegor@dinom.ru", "creation_time": "2012-04-12T08:57:02Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Created attachment 28597\nUpdated patch", "is_private": false, "bug_id": 53058, "id": 158002, "time": "2012-04-12T22:39:29Z", "creator": "superrubiroyd@gmail.com", "creation_time": "2012-04-12T22:39:29Z", "attachment_id": 28597}, {"count": 6, "tags": [], "bug_id": 53058, "text": "Created attachment 28598\nUpdated target file which represents structure of workbook.xls in xml format", "id": 158003, "time": "2012-04-12T22:41:47Z", "creator": "superrubiroyd@gmail.com", "creation_time": "2012-04-12T22:41:47Z", "is_private": false, "attachment_id": 28598}, {"count": 7, "tags": [], "creator": "superrubiroyd@gmail.com", "attachment_id": null, "id": 158004, "time": "2012-04-12T22:44:08Z", "bug_id": 53058, "creation_time": "2012-04-12T22:44:08Z", "is_private": false, "text": "Hi, I have updated patch according to your advices. \nAlso I have updated target xml file.\n\nI look forward to your feedback.\nWith best regards, Evgeniy Berlog"}, {"count": 8, "tags": [], "creator": "yegor@dinom.ru", "text": "Very cool. It is nearly complete in my opinion, I only have two things to say:\n\n1. Complete the use case : modify the source workbook with POI. Call sheet.getDrawingPatriarch() for each sheet, save the result and run BiffDrawingToXml. We expect that the output will be identical to the source but I guess it will be not. \n\n2.  RecordId, Version and Instance are record attributes (as opposed to the record body) and they  ought to be XML attributes instead of child nodes:\n\n<EscherClientAnchorRecord recordId=\"0xF010\" version\"0x00\" instance=\"0x00\">\n...\n</EscherClientAnchorRecord>\n\nThis way we clearly separate record attributes (i.e record header) from the record body.\n\nOther than that, very cool.\n\nRegards,\nYegor\n\n(In reply to comment #7)\n> Hi, I have updated patch according to your advices. \n> Also I have updated target xml file.\n> \n> I look forward to your feedback.\n> With best regards, Evgeniy Berlog", "id": 158060, "time": "2012-04-14T10:14:47Z", "bug_id": 53058, "creation_time": "2012-04-14T10:14:47Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "superrubiroyd@gmail.com", "attachment_id": 28609, "id": 158092, "time": "2012-04-15T15:39:38Z", "bug_id": 53058, "creation_time": "2012-04-15T15:39:38Z", "is_private": false, "text": "Created attachment 28609\nUpdated patch"}, {"count": 10, "attachment_id": 28610, "bug_id": 53058, "is_private": false, "id": 158093, "time": "2012-04-15T15:45:06Z", "creator": "superrubiroyd@gmail.com", "creation_time": "2012-04-15T15:45:06Z", "tags": [], "text": "Created attachment 28610\nThe copy of workbook.xls made by POI\n\nCode for copying workbook.xls into target.xls:\n    public static void main(String[] args) {\n        String input = \"workbook.xls\";\n        String output = \"target.xls\";\n        try{\n            POIFSFileSystem fs = new POIFSFileSystem(new\n                    FileInputStream(input));\n            HSSFWorkbook workbook = new HSSFWorkbook(fs);\n            HSSFSheet sheet = workbook.getSheetAt(0);\n\n            HSSFPatriarch patriarch = sheet.createDrawingPatriarch();\n\n            FileOutputStream fileOut = new FileOutputStream(output);\n            workbook.write(fileOut);\n            fileOut.close();\n\n        } catch(IOException e){\n            System.out.println(\"Can't open file \"+input+\" or \"+output);\n            System.exit(1);\n        }\n    }"}, {"count": 11, "tags": [], "creator": "superrubiroyd@gmail.com", "text": "Created attachment 28611\nXml file which represents structure of target.xls", "id": 158094, "time": "2012-04-15T15:46:20Z", "bug_id": 53058, "creation_time": "2012-04-15T15:46:20Z", "is_private": false, "attachment_id": 28611}, {"count": 12, "tags": [], "bug_id": 53058, "text": "Created attachment 28612\nXml file which represents structure of workbook.xls", "id": 158095, "time": "2012-04-15T15:52:31Z", "creator": "superrubiroyd@gmail.com", "creation_time": "2012-04-15T15:52:31Z", "is_private": false, "attachment_id": 28612}, {"count": 13, "tags": [], "creator": "superrubiroyd@gmail.com", "attachment_id": null, "id": 158096, "time": "2012-04-15T16:01:43Z", "bug_id": 53058, "creation_time": "2012-04-15T16:01:43Z", "is_private": false, "text": "Hi Yegor,\nThanks much for your advices!\nI have added 'recordId', 'version' and 'instance' fields as record attributes.\nAlso I copied workbook.xls into target.xls using the code above to compare their structures.\nYou were right. The stuctures were different, what you can see while comparing target.xml and workbook.xml. \nPlease, check if any more changes are required or not.\nMy GSoC proposal includes resolving of this problem.\n\n\nWith best regards, Evgeniy Berlog"}, {"count": 14, "tags": [], "creator": "superrubiroyd@gmail.com", "attachment_id": 28622, "text": "Created attachment 28622\nXml file which represents structure of target.xls", "id": 158126, "time": "2012-04-17T07:41:15Z", "bug_id": 53058, "creation_time": "2012-04-17T07:41:15Z", "is_private": false}, {"count": 15, "tags": [], "creator": "yegor@dinom.ru", "text": "Evgeniy,\n\nthis is nearly complete. The final touch will be a command-line interface. Something like this:\n\nBiffDrawingToXml -sheet <sheetId> <inputFileName>\nor\nBiffDrawingToXml -sheet \"sheetName\" <inputFileName>\n\nThe name of the output xml file should be derived from the input file name, i.e. xmlFileName = inputFileName.replace(\".xls\", \".xml\")\n\nPlease complete these changes and I will check this utility in SVN.\n\nYegor", "id": 158491, "attachment_id": null, "bug_id": 53058, "creation_time": "2012-04-28T10:40:52Z", "time": "2012-04-28T10:40:52Z", "is_private": false}, {"count": 16, "tags": [], "text": "Created attachment 28698\nUpdated patch\n\nHi, I have added command line interface to this utility. \nHere is utility description:\n\nSynopsis:\nBiffDrawingToXml [Options] <Source file>\n\nOptions:\n-exclude-workbook  (excludes records which belong to the workbook)\n-sheet-name \"sheetName\" (addes to xml file records of the sheet with specified name)\n-sheet-indexes <indexesList> (addes to xml file records of the sheets with specified indexes. Indexes must be separated by comma)\n\nIf no sheets is specified, utility converts all of them into xml file\n\nThanks for your advices.\nWith best regards, Evgeniy Berlog", "attachment_id": 28698, "id": 158664, "creator": "superrubiroyd@gmail.com", "time": "2012-04-30T14:34:16Z", "bug_id": 53058, "creation_time": "2012-04-30T14:34:16Z", "is_private": false}]
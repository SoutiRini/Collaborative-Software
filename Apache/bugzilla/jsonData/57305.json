[{"count": 0, "tags": [], "text": "Created attachment 32256\npatch implementing this feature\n\nI'm running proxy without UI.\n\nMain problem is that ProxyControl class uses \nGuiPackage.getInstance().getTreeModel() as source of tree model\nto fix this i've added static member to ProxyControl, \nwitch can be overridden by user.", "is_private": false, "bug_id": 57305, "id": 179484, "time": "2014-12-03T15:19:16Z", "creator": "jarek102@gmail.com", "creation_time": "2014-12-03T15:19:16Z", "attachment_id": 32256}, {"count": 1, "tags": [], "creator": "jarek102@gmail.com", "attachment_id": null, "text": "Usage:\n\n        treeModel = new JMeterTreeModel(new Object());\n        \n        ProxyControl.setGlobalTreeRoot(treeModel);\n        \n        JMeterTreeNode root = (JMeterTreeNode) treeModel.getRoot();\n        treeModel.addSubTree(testPlanTree, root);\n        \n        proxy = new ProxyControl();\n        proxy.setTarget(findTargetNode(root));\n        proxy.setPort(8282);\n        \n        treeModel.addComponent(proxy, (JMeterTreeNode) root.getChildAt(1));\n        \n        proxy.startProxy();", "id": 179485, "time": "2014-12-03T15:24:43Z", "bug_id": 57305, "creation_time": "2014-12-03T15:24:43Z", "is_private": false}, {"count": 2, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 179603, "time": "2014-12-07T20:55:30Z", "bug_id": 57305, "creation_time": "2014-12-07T20:55:30Z", "is_private": false, "text": "Hi,\nThanks for contribution.\nTo be complete it would be interesting to have an option to start proxy from command-line .\nI see you start it through API manipulation.\n\nRegards"}, {"count": 3, "tags": [], "bug_id": 57305, "text": "Why is this NEEDINFO?  This is an important first step, and it would nice to get this merged.", "id": 190072, "time": "2016-04-08T17:04:36Z", "creator": "wyatt.epp@gmail.com", "creation_time": "2016-04-08T17:04:36Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "jepp@cas.org", "attachment_id": null, "text": "Turns out this patch is actually important for being able to build against JMeter 3.0 and still make a valid JMeterTreeModel.\n\nThe method I was using for 2.13 was a shortcut that worked fine, but I had to rewrite it to create JMeterTreeNode.parent relations after updating.  But that caused this to become an issue at runtime.\n\nThe posted patch still applies mostly clean; needs two small changes.  I'll attach an updated version.", "id": 194442, "time": "2016-10-15T00:58:20Z", "bug_id": 57305, "creation_time": "2016-10-15T00:58:20Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 57305, "attachment_id": 34374, "id": 194443, "time": "2016-10-15T01:02:53Z", "creator": "jepp@cas.org", "creation_time": "2016-10-15T01:02:53Z", "is_private": false, "text": "Created attachment 34374\nUpdated patch should apply clean to 3.0 source tree"}, {"count": 6, "tags": [], "bug_id": 57305, "attachment_id": null, "id": 194448, "time": "2016-10-15T11:29:07Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-10-15T11:29:07Z", "is_private": false, "text": "(In reply to Wyatt Epp from comment #5)\n> Created attachment 34374 [details]\n> Updated patch should apply clean to 3.0 source tree\n\nThanks for patch.\nCould you give an example of how you use it ?\nThank you"}, {"count": 7, "tags": [], "bug_id": 57305, "attachment_id": null, "id": 194468, "time": "2016-10-17T13:03:51Z", "creator": "jepp@cas.org", "creation_time": "2016-10-17T13:03:51Z", "is_private": false, "text": "(In reply to Philippe Mouawad from comment #6)\n> (In reply to Wyatt Epp from comment #5)\n> > Created attachment 34374 [details]\n> > Updated patch should apply clean to 3.0 source tree\n> \n> Thanks for patch.\n> Could you give an example of how you use it ?\n\nIt's just an update of Jarek's patch, so usage is unchanged from Comment #2 (only necessary when you're running headless)."}, {"count": 8, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 194469, "time": "2016-10-17T13:43:40Z", "bug_id": 57305, "creation_time": "2016-10-17T13:43:40Z", "is_private": false, "text": "My question was more, do you have a complete example of using it ?\nFor me it means you're using it through API.\nRegards"}, {"count": 9, "tags": [], "bug_id": 57305, "attachment_id": null, "id": 194470, "time": "2016-10-17T13:59:27Z", "creator": "jepp@cas.org", "creation_time": "2016-10-17T13:59:27Z", "is_private": false, "text": "(In reply to Philippe Mouawad from comment #8)\n> My question was more, do you have a complete example of using it ?\n\nComplete example of using... what, exactly?  It's not clear what you're looking for.\n\n> For me it means you're using it through API.\n\nWell... yes?  I mean, that's the only way to record headless, right now.\n\nBTW, would it be asking too much to get this patch added to the 3.1 branch?"}, {"count": 10, "tags": [], "bug_id": 57305, "attachment_id": null, "id": 194472, "time": "2016-10-17T14:07:04Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-10-17T14:07:04Z", "is_private": false, "text": "(In reply to Wyatt Epp from comment #9)\n> (In reply to Philippe Mouawad from comment #8)\n> > My question was more, do you have a complete example of using it ?\n> \n> Complete example of using... what, exactly?  It's not clear what you're\n> looking for.\n\nOf using JMeter in headless mode to record.\n> \n> > For me it means you're using it through API.\n> \n> Well... yes?  I mean, that's the only way to record headless, right now.\n\nSo my request is to have an example of using the API.\n> \n> BTW, would it be asking too much to get this patch added to the 3.1 branch?\n\nYes if you are able to provide this example :-) \nThanks"}, {"count": 11, "tags": [], "bug_id": 57305, "attachment_id": null, "text": "(In reply to Philippe Mouawad from comment #10)\n> (In reply to Wyatt Epp from comment #9)\n> > Complete example of using... what, exactly?  It's not clear what you're\n> > looking for.\n> \n> Of using JMeter in headless mode to record.\n\nPlease clarify your definition of \"complete\", then?\n\nAnyway, the sample in Comment #2 should be plenty for anyone deep enough into the code that they're legitimately affected by this bug (especially prior to 3.0, where you didn't have to properly establish JMeterTreeNode.parent relations on your RecordingController et al to capture properly).", "id": 194473, "time": "2016-10-17T14:31:09Z", "creator": "jepp@cas.org", "creation_time": "2016-10-17T14:31:09Z", "is_private": false}, {"count": 12, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 194474, "time": "2016-10-17T14:45:15Z", "bug_id": 57305, "creation_time": "2016-10-17T14:45:15Z", "is_private": false, "text": "(In reply to Wyatt Epp from comment #11)\n> (In reply to Philippe Mouawad from comment #10)\n> > (In reply to Wyatt Epp from comment #9)\n> > > Complete example of using... what, exactly?  It's not clear what you're\n> > > looking for.\n> > \n> > Of using JMeter in headless mode to record.\n> \n> Please clarify your definition of \"complete\", then?\n> \n> Anyway, the sample in Comment #2 should be plenty for anyone deep enough\n> into the code that they're legitimately affected by this bug (especially\n> prior to 3.0, where you didn't have to properly establish\n> JMeterTreeNode.parent relations on your RecordingController et al to capture\n> properly).\n\nIf snipped above is fine, then that's what I mean by complete :-)"}, {"count": 13, "tags": [], "bug_id": 57305, "attachment_id": null, "text": "(In reply to Philippe Mouawad from comment #12)\n> If snipped above is fine, then that's what I mean by complete :-)\n\nWell, it was more than enough for me, so great!  It'll be very nice to have this; I had to reopen a bug in our internal tracker when I rolled back to 2.13.  Thanks!", "id": 194475, "time": "2016-10-17T15:21:55Z", "creator": "jepp@cas.org", "creation_time": "2016-10-17T15:21:55Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 57305, "attachment_id": null, "id": 194482, "time": "2016-10-17T20:44:11Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-10-17T20:44:11Z", "is_private": false, "text": "(In reply to Wyatt Epp from comment #13)\n> (In reply to Philippe Mouawad from comment #12)\n> > If snipped above is fine, then that's what I mean by complete :-)\n> \n> Well, it was more than enough for me, so great!  It'll be very nice to have\n> this; I had to reopen a bug in our internal tracker when I rolled back to\n> 2.13.  Thanks!\n\nHi,\nI used the sample above and it is not complete.\n1)testPlanTree variable is not initialized\n2) findTargetNode does not exist\n\nIf we add this patch to core, we need to provide a complete and working example and in this case see which API should be made public. That's why I am asking for those information.\n\nThanks\nRegards"}, {"count": 15, "tags": [], "text": "Created attachment 34386\n\"complete and working\" example\n\n(In reply to Philippe Mouawad from comment #14)\n> I used the sample above and it is not complete.\n\nWhat, you didn't expect that to run as-is, did you?\n\n> If we add this patch to core, we need to provide a complete and working\n> example\n\nOh, moving the goalposts on me? Rude.\n\nI'll play along, but only because we actually need this patch merged so we don't have to maintain our own version of JMeter internally.\n\n> and in this case see which API should be made public.\n\nWhat?  No.  Stop.  The method this patch adds must be public; anything else would be *completely* useless.", "is_private": false, "id": 194510, "creator": "jepp@cas.org", "time": "2016-10-18T17:12:07Z", "bug_id": 57305, "creation_time": "2016-10-18T17:12:07Z", "attachment_id": 34386}, {"count": 16, "tags": [], "bug_id": 57305, "attachment_id": null, "id": 194515, "time": "2016-10-18T18:23:08Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-10-18T18:23:08Z", "is_private": false, "text": "(In reply to Wyatt Epp from comment #15)\n> Created attachment 34386 [details]\n> \"complete and working\" example\n> \n> (In reply to Philippe Mouawad from comment #14)\n> > I used the sample above and it is not complete.\n> \n> What, you didn't expect that to run as-is, did you?\n\nI did :-)\n> \n> > If we add this patch to core, we need to provide a complete and working\n> > example\n> \n> Oh, moving the goalposts on me? Rude.\n\n:-) \n> \n> I'll play along, but only because we actually need this patch merged so we\n> don't have to maintain our own version of JMeter internally.\n> \n> > and in this case see which API should be made public.\n> \n> What?  No.  Stop.  The method this patch adds must be public; anything else\n> would be *completely* useless.\n\nOf course for this one.\n\nThanks for patch and example"}, {"count": 17, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 194527, "time": "2016-10-18T20:55:56Z", "bug_id": 57305, "creation_time": "2016-10-18T20:55:56Z", "is_private": false, "text": "Hello again @Wyatt,\n\nFew questions:\n\n- How is user supposed to use the Proxy. He starts it in non gui mode. But how does he saves the Test plan recorded ?\n\nI suppose you have some custom development to do that ? Any chance you contribute more ?\n\n\n- Would it make sense in the future to have a command line option to start proxy in NON GUI mode\n\n\nRegards"}, {"count": 18, "tags": [], "bug_id": 57305, "attachment_id": null, "text": "(In reply to Philippe Mouawad from comment #17)\n>\n> - How is user supposed to use the Proxy. He starts it in non gui mode. But\n> how does he saves the Test plan recorded ?\n\nThat's far beyond the scope of this bug.  Think of it as an exercise for the reader. ;)\n\n> I suppose you have some custom development to do that ? Any chance you\n> contribute more ?\n\nI'd *like* to, but we've been over this before: I can't actually release/upstream our full headless recording daemon until the release has been cleared with legal.  I'm still making noise about it, but it's not up to me and I don't have an ETA.  I'm in a bit of a grey area already for cleaning up that patch and sample.\n\n> - Would it make sense in the future to have a command line option to start\n> proxy in NON GUI mode\n\nMaybe.  In practice, we've found it works best to have the recorder be a daemon that accepts commands from a TCP client and gives feedback. (Similar to how jcmd or jfr work, I think.)\n\nBTW, can you be update the milestone?  I don't have permissions for that.", "id": 194530, "time": "2016-10-18T22:09:32Z", "creator": "jepp@cas.org", "creation_time": "2016-10-18T22:09:32Z", "is_private": false}, {"count": 19, "tags": [], "bug_id": 57305, "attachment_id": 34394, "text": "Created attachment 34394\nAllow to use ProxyControl in non GUI mode\n\nUse instance variable instead of static one.\n\n@Wyatt\nWas there any reason to use a static variable? Can you check, if this patch helps you?\n\n@Team\nI think it is safe to include this in 3.1, what do you think?", "id": 194597, "time": "2016-10-20T20:16:05Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2016-10-20T20:16:05Z", "is_private": false}, {"count": 20, "tags": [], "creator": "jepp@cas.org", "attachment_id": null, "id": 194601, "time": "2016-10-20T21:16:41Z", "bug_id": 57305, "creation_time": "2016-10-20T21:16:41Z", "is_private": false, "text": "(In reply to Felix Schumacher from comment #19)\n>\n> @Wyatt\n> Was there any reason to use a static variable? Can you check, if this patch\n> helps you?\n\nThat's just how the original patch posted by the reporter did things-- all I did was fix up his patch to apply clean on the 3.0 source tree.\n\nIf I had to guess it's just because he thought it was more natural to set things up by calling a static method.  (I happen to disagree.)  I'm pretty sure it'll be fine if it's not static.\n\n> @Team\n> I think it is safe to include this in 3.1, what do you think?\n\nWe would appreciate it greatly."}, {"count": 21, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 194602, "time": "2016-10-20T21:22:10Z", "bug_id": 57305, "creation_time": "2016-10-20T21:22:10Z", "is_private": false, "text": "(In reply to Felix Schumacher from comment #19)\n> Created attachment 34394 [details]\n> Allow to use ProxyControl in non GUI mode\n> \n> Use instance variable instead of static one.\n> \n> @Wyatt\n> Was there any reason to use a static variable? Can you check, if this patch\n> helps you?\n> \n> @Team\n> I think it is safe to include this in 3.1, what do you think?\n\nHi Felix,\nOk for inclusion provided we provide the code sample to use it somewhere in docs.\nNote this means we make classes mentionned kind of public API that should then be backward compatible.\nFinally I don't see currently how users using code can easily save the recorded test plan.\n\nThanks for review and patch\nRegards"}, {"count": 22, "tags": [], "bug_id": 57305, "attachment_id": null, "text": "(In reply to Philippe Mouawad from comment #21)\n> Note this means we make classes mentionned kind of public API that should\n> then be backward compatible.\n\nEh?  The whole API is already public (if largely undocumented)-- I wouldn't have been able to write any of our tooling otherwise.\n\n> Finally I don't see currently how users using code can easily save the\n> recorded test plan.\n\nThat's because there isn't one.  For all that it only ends up being about twenty lines of code, it was really annoying to write that part, in fact.\n\n(It would be quite grand if there were a simple way to dump a JMeterTreeNode or JMeterTreeModel to JMX via SaveService.  But there isn't.  Has anyone filed a bug about that...?)", "id": 194603, "time": "2016-10-20T22:11:43Z", "creator": "jepp@cas.org", "creation_time": "2016-10-20T22:11:43Z", "is_private": false}, {"count": 23, "tags": [], "text": "@philippe I put a sample class inside the test src dirextory. It is not complete in the sense, that it outputs correct code, but it will hopefully give the right direction for those who are interested in this \"feature\".\n\nDate: Fri Oct 28 17:56:25 2016\nNew Revision: 1767048\n\nURL: http://svn.apache.org/viewvc?rev=1767048&view=rev\nLog:\nRemove dependency of ProxyControl on GuiPackage.\nBased on patches by jarek102 at gmail.com and Wyatt Epp (wyatt.epp at gmail.com)\n\nBugzilla Id: 57305\n\nAdded:\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/proxy/NonGuiProxySample.java   (with props)\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/proxy/ProxyControl.java\n    jmeter/trunk/xdocs/changes.xml", "is_private": false, "bug_id": 57305, "id": 194705, "time": "2016-10-28T17:59:42Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2016-10-28T17:59:42Z", "attachment_id": null}, {"count": 24, "tags": [], "bug_id": 57305, "attachment_id": null, "id": 194776, "time": "2016-11-02T15:23:55Z", "creator": "lars.holmberg@redshirt.se", "creation_time": "2016-11-02T15:23:55Z", "is_private": false, "text": "This is really cool stuff! \n\nIt would be very useful for me (and others too, I think) if this could be exposed as a script, useable out of the box (similar to bin/mirror-server).\n\nPerhaps it could trigger writing the test plan on receiving SIGINT/CTRL-C from the user."}, {"count": 25, "tags": [], "bug_id": 57305, "attachment_id": null, "id": 194777, "time": "2016-11-02T15:31:20Z", "creator": "jepp@cas.org", "creation_time": "2016-11-02T15:31:20Z", "is_private": false, "text": "(In reply to Lars H from comment #24)\n> \n> It would be very useful for me (and others too, I think) if this could be\n> exposed as a script, useable out of the box (similar to bin/mirror-server).\n\nI'd recommend filing a bug about that separately."}, {"count": 26, "tags": [], "creator": "lars.holmberg@redshirt.se", "attachment_id": null, "text": "(In reply to Wyatt Epp from comment #25)\n> (In reply to Lars H from comment #24)\n> > \n> > It would be very useful for me (and others too, I think) if this could be\n> > exposed as a script, useable out of the box (similar to bin/mirror-server).\n> \n> I'd recommend filing a bug about that separately.\n\nYes that makes sense. Added separate issue for the script: https://bz.apache.org/bugzilla/show_bug.cgi?id=60335", "id": 194791, "time": "2016-11-03T09:58:12Z", "bug_id": 57305, "creation_time": "2016-11-03T09:58:12Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "juliancesar@gmail.com", "attachment_id": 27777, "id": 150586, "time": "2011-10-14T19:34:39Z", "bug_id": 52033, "creation_time": "2011-10-14T19:34:39Z", "is_private": false, "text": "Created attachment 27777\nSuggested changes\n\nWe had a need to use multiple certificates for mutual authentication in web servers, from some code suggestions found on the internet we create a model that would like to suggest for the next release of JMeter.\n\nThe expected behavior is that when you configure a key store containing more than one private key, it must request a certificate for each virtual user (thread), and if the number of virtual users is greater than the certificate, he should restart the list of certificates.\n\nBecause the delay in loading the JKS and the noises caused for him in the test, we changed the code so that the JKS was initializated on JMeter startup.\n\nWe use the tag v2_5_RC3 for development. The suggestion to update the code of 4 classes is attached as a patch to SVN.\nWe did some tests and the load time of 7000 certificates / keys lasted average of 3 seconds.\n\nThis implementation can be used in the next release of JMeter?"}, {"count": 1, "tags": [], "bug_id": 52033, "attachment_id": null, "text": "Hello,\nThanks for the patch but can you recreate it by removing all tabs that have been added ?\nWe generally use 4 spaces indentation (never any tabs).\n\nThanks", "id": 150588, "time": "2011-10-14T20:06:14Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-10-14T20:06:14Z", "is_private": false}, {"count": 2, "text": "Created attachment 27778\nNew patch with spaces.\n\nSorry.", "bug_id": 52033, "is_private": false, "id": 150589, "time": "2011-10-14T20:14:32Z", "creator": "juliancesar@gmail.com", "creation_time": "2011-10-14T20:14:32Z", "tags": [], "attachment_id": 27778}, {"count": 3, "tags": [], "creator": "sebb@apache.org", "text": "Thanks for the patch; unfortunately it does not apply cleanly to the code in trunk.\n\nAlso, there are several instances of using @SuppressWarnings.\nAs far as possible we don't allow these.\nThe instance ArrayList fields in DefaultKeyStore should be local variables.\nThe mutable static caches in JsseSLManager are not thread-safe.\n\nBut we can fix these.\n\nI'm more concerned about the use of the system property names javax.net.ssl.keyStoreStartIndex and javax.net.ssl.keyStoreEndIndex.\n\nAre these standard property names?\nI could not find any reference to them.\nIf these are invented names, then they should not use the javax namespace.\nProbably should be JMeter properties.\n\nThe proposal needs a bit more consideration.", "id": 150624, "time": "2011-10-15T15:42:46Z", "bug_id": 52033, "creation_time": "2011-10-15T15:42:46Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 52033, "attachment_id": null, "text": "I was waiting for us to reach this point, this properties is used to load a range of certificates/keys of jks, we use this when using distributed tests, we can help to write a documentation about this and we consider that this feature is very important.\nAbout the names of properties, really dont exists in documentation, we invented that! however we can change it.\n\nWe appreciate your patience, we intend to help more with less mistakes in the future, thank you!", "id": 150658, "time": "2011-10-17T11:19:30Z", "creator": "juliancesar@gmail.com", "creation_time": "2011-10-17T11:19:30Z", "is_private": false}, {"text": "OK\n\nIn which case the only problem is that a system property in the javax namespace is not appropriate.\n\nI'll see about incorporating the patch in due course.", "tags": [], "bug_id": 52033, "is_private": false, "count": 5, "id": 150659, "time": "2011-10-17T11:39:39Z", "creator": "sebb@apache.org", "creation_time": "2011-10-17T11:39:39Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 52033, "attachment_id": null, "text": "Sebba, we tested the proposal that appears to be stable. We are very interested in including this feature to prevent us to use an unofficial version of JMeter. There are planning on which version will the use of multiple certificates as proposed? How long could we wait?", "id": 150830, "time": "2011-10-21T19:01:07Z", "creator": "botelhojp@gmail.com", "creation_time": "2011-10-21T19:01:07Z", "is_private": false}, {"count": 7, "tags": [], "creator": "sebb@apache.org", "text": "Found a few other issues with the patch:\n- the behaviour for start = end = 0 was changed\n- unnecessary class fields\n- unsafe caching of fields\n\nApplied changes to SVN:\n\nURL: http://svn.apache.org/viewvc?rev=1187840&view=rev\nLog:\nBug 52033 - Allowing multiple certificates (JKS)\n\nModified:\n   jakarta/jmeter/trunk/bin/jmeter.properties\n   jakarta/jmeter/trunk/src/core/org/apache/jmeter/util/JsseSSLManager.java\n   jakarta/jmeter/trunk/src/core/org/apache/jmeter/util/SSLManager.java\n   jakarta/jmeter/trunk/src/core/org/apache/jmeter/util/keystore/DefaultKeyStore.java\n   jakarta/jmeter/trunk/src/core/org/apache/jmeter/util/keystore/JmeterKeyStore.java\n   jakarta/jmeter/trunk/xdocs/changes.xml\n\nPlease check if the updated code works for you.\nNote that I changed the property names, and the meaning of the last index.\nIf start = end, then that is the index of the single alias to be used.\n\nAlso, at present the index range has to be chosen before starting a test.\nIs there a use case for allowing the range of aliases to vary between samples?\nOr more likely, using a different fixed alias for different samples?\nFor example, when connecting to different hosts, perhaps these will need different aliases?", "id": 150841, "time": "2011-10-23T02:06:37Z", "bug_id": 52033, "creation_time": "2011-10-23T02:06:37Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 52033, "attachment_id": null, "text": "Made another change to improve thread-safety in r1187876.\n\nPlease try with any build from that fix and report if the issue is solved.", "id": 150895, "time": "2011-10-25T10:50:04Z", "creator": "sebb@apache.org", "creation_time": "2011-10-25T10:50:04Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 52033, "attachment_id": null, "is_private": false, "id": 151105, "time": "2011-11-01T12:57:48Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-11-01T12:57:48Z", "text": "Message from Julian Cesar:\nHello Philippe,\n\nWe test and we found a problem.\nIn line 89 (v_certChains.add((X509Certificate[]) chain)) of DefaultKeyStore we have a class cast problem:\n\n2011/11/01 10:19:10 ERROR - jmeter.util.SSLManager: Problem loading keystore: [Ljava.security.cert.Certificate; cannot be cast to [Ljava.security.cert.X509Certificate;\n\nWe are using the revision 1195404."}, {"count": 10, "tags": [], "creator": "juliancesar@gmail.com", "text": "Maybe we need to iterate one by one of certificates to be cast to x509. In the code originally sent we did this way.", "id": 151107, "time": "2011-11-01T13:02:06Z", "bug_id": 52033, "creation_time": "2011-11-01T13:02:06Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 52033, "attachment_id": null, "text": "Would it be possible for you to test again with upcoming revision, I just\ncommited the fix to this:\n\nDate: Tue Nov  1 13:11:56 2011\nNew Revision: 1195978\n\nURL: http://svn.apache.org/viewvc?rev=1195978&view=rev\nLog:\nBug 52033 - Allowing multiple certificates (JKS):\nFixed classcastexception\n\nModified:\n  \njakarta/jmeter/trunk/src/core/org/apache/jmeter/util/keystore/DefaultKeyStore.java", "id": 151109, "time": "2011-11-01T13:13:42Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-11-01T13:13:42Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 52033, "attachment_id": null, "text": "Message from Julian Cesar:\nThe problem with the class cast is solved, but 2 problems still exists.\n\n1. Always the same certificate is used, if you use the keystore was sent you can see this;\n2. Is interesting that the certificates are loaded at startup jmeter or as soon as a key store is selected, because this load takes around 3 seconds, and this can cause noise in the test and also the incomplete certificates loading can cause a malfunction of user requests.", "id": 151113, "time": "2011-11-01T13:58:14Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-11-01T13:58:14Z", "is_private": false}, {"count": 13, "text": "Hello,\nYou can achieve the first by setting:\n- HTTPClient 3.1 or 4 as implementation\n- setting https.use.cached.ssl.context=false\n\n\nFor the second , we will make it an option.\nRegards\nPhilippe", "bug_id": 52033, "attachment_id": null, "id": 151116, "time": "2011-11-01T14:18:19Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-11-01T14:18:19Z", "tags": [], "is_private": false}, {"count": 14, "tags": [], "creator": "juliancesar@gmail.com", "attachment_id": null, "id": 151119, "time": "2011-11-01T15:49:28Z", "bug_id": 52033, "creation_time": "2011-11-01T15:49:28Z", "is_private": false, "text": "if you create a option to load key store on start jmeter would be perfect.\nWe would like a nightly builds for the final tests, when we have it?"}, {"count": 15, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 151123, "time": "2011-11-01T21:52:57Z", "bug_id": 52033, "creation_time": "2011-11-01T21:52:57Z", "is_private": false, "text": "Date: Tue Nov  1 21:51:46 2011\nNew Revision: 1196306\n\nURL: http://svn.apache.org/viewvc?rev=1196306&view=rev\nLog:\nBug 52033 - Allowing multiple certificates (JKS)\nAdded Keystore Config component to enable configuring:\n- Preload\n- Start alias index\n- End alias index\n\nAdded:\n   jmeter/trunk/src/components/org/apache/jmeter/config/KeystoreConfig.java   (with props)\n   jmeter/trunk/src/components/org/apache/jmeter/config/KeystoreConfigBeanInfo.java   (with props)\n   jmeter/trunk/src/components/org/apache/jmeter/config/KeystoreConfigResources.properties   (with props)\n   jmeter/trunk/xdocs/images/screenshots/keystore_config.png   (with props)\nModified:\n   jmeter/trunk/src/core/org/apache/jmeter/util/SSLManager.java\n   jmeter/trunk/src/core/org/apache/jmeter/util/keystore/DefaultKeyStore.java\n   jmeter/trunk/src/core/org/apache/jmeter/util/keystore/JmeterKeyStore.java\n   jmeter/trunk/xdocs/usermanual/component_reference.xml"}, {"count": 16, "text": "Hello Julian,\nPreload was implemented through new \"KKeystore Config\" new config element.\nAS soon as Nightly build is available you can test it.\nYou will need to change your test plan to add \"Keystore Config\" component.\n\nRegards\nPhilippe", "bug_id": 52033, "attachment_id": null, "id": 151125, "time": "2011-11-01T22:07:54Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-11-01T22:07:54Z", "tags": [], "is_private": false}, {"count": 17, "tags": [], "creator": "juliancesar@gmail.com", "text": "I tested with 7000 certs and everything is ok!\n\nIt would be interesting if not put values \u200b\u200bfor the start and index end on Keystore Configuration, we try to get the https.keyStoreStartIndex and https.keyStoreEndIndex contained in the file jmeter.properties, because if it is distributed test is a necessary thing. This makes sense for you?", "id": 151153, "time": "2011-11-03T15:56:56Z", "bug_id": 52033, "creation_time": "2011-11-03T15:56:56Z", "is_private": false, "attachment_id": null}, {"count": 18, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 151154, "time": "2011-11-03T16:33:52Z", "bug_id": 52033, "creation_time": "2011-11-03T16:33:52Z", "is_private": false, "text": "Implemented as required.\nI will close issue as solved, please reopen if you find any issue and in all cases, comment to say tests are OK on your side.\n\nThanks for your contribution on this.\n\nDate: Thu Nov  3 16:29:32 2011\nNew Revision: 1197207\n\nURL: http://svn.apache.org/viewvc?rev=1197207&view=rev\nLog:\nBUG_52033 :\nDefault to jmeter.properties if start and end not set\nHandle errors in inputed start and endIndex\n\nModified:\n   jmeter/trunk/src/components/org/apache/jmeter/config/KeystoreConfig.java"}, {"count": 19, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "*** Bug 22510 has been marked as a duplicate of this bug. ***", "id": 151244, "time": "2011-11-06T23:05:39Z", "bug_id": 52033, "creation_time": "2011-11-06T23:05:39Z", "is_private": false, "attachment_id": null}, {"count": 20, "tags": [], "creator": "juliancesar@gmail.com", "attachment_id": 28381, "id": 154120, "time": "2012-02-24T18:34:18Z", "bug_id": 52033, "creation_time": "2012-02-24T18:34:18Z", "is_private": false, "text": "Created attachment 28381\nCorrection"}, {"count": 21, "tags": [], "bug_id": 52033, "attachment_id": null, "is_private": false, "id": 154121, "time": "2012-02-24T18:34:50Z", "creator": "juliancesar@gmail.com", "creation_time": "2012-02-24T18:34:50Z", "text": "Hi, I made a dumb mistake in this feature! \nWe did not have detected this problem until we need to get a specific certificate.\nThe correction is atached in ticket."}, {"count": 22, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 154122, "time": "2012-02-24T18:37:19Z", "bug_id": 52033, "creation_time": "2012-02-24T18:37:19Z", "is_private": false, "text": "Can you explain the issue ?\n\nMaybe you should create a new Bugzilla for this.\n\nThank you\nRegards\nPhilippe"}, {"count": 23, "text": "Done! The bug 52762 was created.\n\nThanks", "bug_id": 52033, "attachment_id": null, "id": 154125, "time": "2012-02-24T19:14:35Z", "creator": "juliancesar@gmail.com", "creation_time": "2012-02-24T19:14:35Z", "tags": [], "is_private": false}]
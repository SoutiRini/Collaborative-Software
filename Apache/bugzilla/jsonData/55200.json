[{"count": 0, "tags": [], "text": "I see sometimes failing connections due to IOException (see below).\nThis happens when trying to send thousands of binary messages (1024 bytes each) without any delay between the subsequent messages.\n\nHaving look at the code in AsyncChannelWrapperSecure$WriteTask.run(219), I think it is not correct to assume that if not all of the bytes in the buffer are written, this shall produce IOException. I think in this case, there shall be an attempt to write the rest of the bytes in a cycle.\n\n\nHere one exception I got during the test:\nException is :java.io.IOException: java.util.concurrent.ExecutionException: java.io.IOException: Only wrote [460] of [1,098] bytes\n\tat org.apache.tomcat.websocket.WsRemoteEndpointImplBase.startMessageBlock(WsRemoteEndpointImplBase.java:204)\n\tat org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendBytes(WsRemoteEndpointImplBase.java:113)\n\tat org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendBinary(WsRemoteEndpointBasic.java:43)\n\tat WebsocketsTestManager$TestThread.run(WebsocketsTestManager.java:271)\nCaused by: java.util.concurrent.ExecutionException: java.io.IOException: Only wrote [460] of [1,098] bytes\n\tat org.apache.tomcat.websocket.WsRemoteEndpointImplBase$FutureToSendHandler.get(WsRemoteEndpointImplBase.java:729)\n\tat org.apache.tomcat.websocket.WsRemoteEndpointImplBase.startMessageBlock(WsRemoteEndpointImplBase.java:202)\n\t... 3 more\nCaused by: java.io.IOException: Only wrote [460] of [1,098] bytes\n\tat org.apache.tomcat.websocket.AsyncChannelWrapperSecure$WriteTask.run(AsyncChannelWrapperSecure.java:220)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:789)", "is_private": false, "bug_id": 55200, "id": 168292, "time": "2013-07-05T14:27:48Z", "creator": "s.boshev@gmail.com", "creation_time": "2013-07-05T14:27:48Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 55200, "text": "Thanks for the report. I agree with your analysis. I can't reproduce this but I have implemented what I believe is an appropriate fix in trunk.", "id": 168297, "time": "2013-07-05T17:22:47Z", "creator": "markt@apache.org", "creation_time": "2013-07-05T17:22:47Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "text": "I have tried this for jasper2 from the 4_1_9 tag and from cvs head (2002/08/21).\n\nFor a simple webapp with JSPs in subdirectories, a command like:\n  java org.apache.jasper.JspC -d gensrc -webapp webapp\n\ncreates all the java files in the top directory of gensrc.  Any subdirectories\nin the webapp are created - but they are all empty.  If you have index.jsp in\neach subdirectory - then you only get a single index.jsp in the top level of gensrc.\n\n\nFor a more complex webapp, the name mungling gets totally confused.  I have not\nbeen able to reproduce this on a small simple webapp - so these reports are\nfor my real webapp.    Using the same JspC command line about I get the\nfollowing error message:\n\n2002-08-21 11:24:38 - The file argument\n'/home/gregw/Clients/Cisco/vob/ssd.icotton-GRWILKIN/nwsp/webapp/wap/pages/accountLogon.jsp'\ndoes not exist\nerror:/home/gregw/Clients/Cisco/vob/ssd.icotton-GRWILKIN/nwsp/webapp/wap/pages/accountLogon.jsp\n\nHowever that file does exist.\n\nMore over if I look in the gensrc directory it has created an empty directory \ncalled:\n\ngensrc/home/gregw/Clients/Cisco/vob/ssd.icotton-GRWILKIN/nwsp/webapp/wap/pages\n\nSomehow it has got the absolute file path of the webapp\n/home/gregw/Clients/Cisco/vob/ssd.icotton-GRWILKIN/nwsp/webapp into the package\npath?    \n\nI have tried running JspC with default paths and absolute paths.  Same results.", "is_private": false, "bug_id": 11891, "id": 21436, "time": "2002-08-21T10:28:37Z", "creator": "gregw@mortbay.org", "creation_time": "2002-08-21T10:28:37Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "I have fixed some of this and am making sure I have not broken anything in the \nprocess.  I will send a patch today or tomorrow.", "is_private": false, "id": 21442, "creator": "jakarta@trollingers.com", "time": "2002-08-21T11:08:56Z", "bug_id": 11891, "creation_time": "2002-08-21T11:08:56Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 11891, "attachment_id": 2789, "id": 21454, "time": "2002-08-21T12:53:17Z", "creator": "jakarta@trollingers.com", "creation_time": "2002-08-21T12:53:17Z", "is_private": false, "text": "Created attachment 2789\ndiff of JspCompilationContext.java"}, {"count": 3, "tags": [], "text": "Created attachment 2790\ndiff JspC.java", "attachment_id": 2790, "bug_id": 11891, "id": 21455, "time": "2002-08-21T12:53:43Z", "creator": "jakarta@trollingers.com", "creation_time": "2002-08-21T12:53:43Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 11891, "attachment_id": 2791, "id": 21456, "time": "2002-08-21T12:54:08Z", "creator": "jakarta@trollingers.com", "creation_time": "2002-08-21T12:54:08Z", "is_private": false, "text": "Created attachment 2791\ndiff messages.properties"}, {"count": 5, "tags": [], "creator": "jakarta@trollingers.com", "attachment_id": null, "text": "this patch should fix the generation of the source files in the right \ndirectories as well as putting the compiled classes in those same directories.\n\nit also changes the class name generation a bit (it no longer escapes '_')\n\nthe compiled classes should show up in the same place they would if you went to \nthe page directly.\n\nalso I added 2 new flags -l to list the errors (this will continue to compile \neven when a compile error is found) I added this to skip over directive include \nfiles that wont compile and -s to show successful compile messages (these are \nsent to the static log var) I also added a method to allow the change of the \nstatic log var\n\nplease let me know if this solves your problems (or causes any new ones).", "id": 21457, "time": "2002-08-21T12:58:57Z", "bug_id": 11891, "creation_time": "2002-08-21T12:58:57Z", "is_private": false}, {"count": 6, "attachment_id": 2792, "bug_id": 11891, "is_private": false, "id": 21458, "time": "2002-08-21T13:21:52Z", "creator": "jakarta@trollingers.com", "creation_time": "2002-08-21T13:21:52Z", "tags": [], "text": "Created attachment 2792\nthis patch should replace the first one (forgot a piece)"}, {"count": 7, "tags": [], "bug_id": 11891, "attachment_id": null, "id": 21459, "time": "2002-08-21T13:23:05Z", "creator": "jakarta@trollingers.com", "creation_time": "2002-08-21T13:23:05Z", "is_private": false, "text": "the 4th patch is a replacement for the first JspC.java patch.. sorry about the \nconfusion I know I am going to cause.. :-)"}, {"count": 8, "tags": [], "bug_id": 11891, "attachment_id": null, "id": 21467, "time": "2002-08-21T14:04:43Z", "creator": "gregw@mortbay.org", "creation_time": "2002-08-21T14:04:43Z", "is_private": false, "text": "Thanks for the rapid response.\n\nWell those patches make it a bit better.... Files are being generated in the\nright place now.   But if you include a -webinc flag you still get all the\nservlets called the same thing.  eg you get lots of servlets defined as\norg.apache.jsp.index_jsp\n\n\nand in my complex webapp, I still get \n\n2002-08-21 03:02:53 - The file argument\n'/home/gregw/Clients/Cisco/vob/ssd.icotton-GRWILKIN/nwsp/webapp/wap/pages/accountLogon.jsp'\ndoes not exist\nerror:/home/gregw/Clients/Cisco/vob/ssd.icotton-GRWILKIN/nwsp/webapp/wap/pages/accountLogon.jsp\n\n\nI'll try and reproduce in a simple webapp, but this will take me another day or two."}, {"count": 9, "tags": [], "bug_id": 11891, "attachment_id": null, "is_private": false, "id": 21468, "time": "2002-08-21T14:29:14Z", "creator": "jakarta@trollingers.com", "creation_time": "2002-08-21T14:29:14Z", "text": "I can not reproduce your problem with the -webinc flag.  It all works fine for \nme, did you try it with something simple or your big app?\n\nthanks,\nJohn"}, {"count": 10, "tags": [], "text": "\nFor a simple webapp, ls -R :\n\nwebapp/:\nCVS/  WEB-INF/  date.jsp  hello.jsp  hello2.jsp  subdir/\n\nwebapp/CVS:\nEntries  Repository  Root\n\nwebapp/WEB-INF:\nCVS/  jsp.xml  web.xml\n\nwebapp/WEB-INF/CVS:\nEntries  Repository  Root\n\nwebapp/subdir:\ndate2.jsp  hello.jsp  hello3.jsp  hello4.jsp  subsubdir/\n\nwebapp/subdir/subsubdir:\nhello.jsp  hello5.jsp\n\n\n\nI run java org.apache.jasper.JspC -d gensrc -webapp webapp -webinc jsp.xml\nand jsp.xml ends up with three definitions of\n \n       <servlet>\n                <servlet-name>org.apache.jsp.hello_jsp</servlet-name>\n                <servlet-class>org.apache.jsp.hello_jsp</servlet-class>\n        </servlet>\n\n\nIn fact all the package names are org.apache.jsp even in the generated\nsource code:\ngensrc/date_jsp.java:package org.apache.jsp;\ngensrc/hello_jsp.java:package org.apache.jsp;\ngensrc/hello2_jsp.java:package org.apache.jsp;\ngensrc/subdir/hello4_jsp.java:package org.apache.jsp;\ngensrc/subdir/hello3_jsp.java:package org.apache.jsp;\ngensrc/subdir/date2_jsp.java:package org.apache.jsp;\ngensrc/subdir/hello_jsp.java:package org.apache.jsp;\ngensrc/subdir/subsubdir/hello5_jsp.java:package org.apache.jsp;\ngensrc/subdir/subsubdir/hello_jsp.java:package org.apache.jsp;\n\n\nMaybe I did not apply the patches correctly???\nTell me when they are in CVS and I'll do an update and try again.\n\n\n\n\n\n\n\n\n", "is_private": false, "id": 21471, "creator": "gregw@mortbay.org", "time": "2002-08-21T15:01:38Z", "bug_id": 11891, "creation_time": "2002-08-21T15:01:38Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "the package names will always be org.apache.jsp (unless you specify other wise \nwith the -p option.  Can you attach your sample war file, as I have the same \nsimple type of setup and it works fine for me. \n\n\n\nI get this \n\t<servlet>\n\t\t<servlet-name>org.apache.jsp.index_jsp</servlet-name>\n\t\t<servlet-class>org.apache.jsp.index_jsp</servlet-class>\n\t</servlet>\n\n\t<servlet>\n\t\t<servlet-name>org.apache.jsp.john_is_cool1_jsp</servlet-name>\n\t\t<servlet-class>org.apache.jsp.john_is_cool1_jsp</servlet-class>\n\t</servlet>\n\n\t<servlet>\n\t\t<servlet-name>org.apache.jsp.heather_is_cool1_jsp</servlet-name>\n\t\t<servlet-class>org.apache.jsp.heather_is_cool1_jsp</servlet-\nclass>\n\t</servlet>\n\n\t<servlet>\n\t\t<servlet-name>org.apache.jsp.heather_is_cool2_jsp</servlet-name>\n\t\t<servlet-class>org.apache.jsp.heather_is_cool2_jsp</servlet-\nclass>\n\t</servlet>\n\n\t<servlet-mapping>\n\t\t<servlet-name>org.apache.jsp.index_jsp</servlet-name>\n\t\t<url-pattern>/index.jsp</url-pattern>\n\t</servlet-mapping>\n\n\t<servlet-mapping>\n\t\t<servlet-name>org.apache.jsp.john_is_cool1_jsp</servlet-name>\n\t\t<url-pattern>/john/john_is_cool1.jsp</url-pattern>\n\t</servlet-mapping>\n\n\t<servlet-mapping>\n\t\t<servlet-name>org.apache.jsp.heather_is_cool1_jsp</servlet-name>\n\t\t<url-pattern>/john/heather/heather_is_cool1.jsp</url-pattern>\n\t</servlet-mapping>\n\n\t<servlet-mapping>\n\t\t<servlet-name>org.apache.jsp.heather_is_cool2_jsp</servlet-name>\n\t\t<url-pattern>/john/heather/heather_is_cool2.jsp</url-pattern>\n\t</servlet-mapping>\n\nThe patches are not in CVS yet as I do not have commit privs", "attachment_id": null, "bug_id": 11891, "id": 21475, "time": "2002-08-21T15:22:45Z", "creator": "jakarta@trollingers.com", "creation_time": "2002-08-21T15:22:45Z", "is_private": false}, {"count": 12, "tags": [], "creator": "gregw@mortbay.org", "attachment_id": 2793, "id": 21476, "time": "2002-08-21T15:31:54Z", "bug_id": 11891, "creation_time": "2002-08-21T15:31:54Z", "is_private": false, "text": "Created attachment 2793\nWebapp that demonstrates the -webinc problem"}, {"count": 13, "tags": [], "text": "\nI've attached a demo webapp.   Are you sure that the packages should all be\norg.apache.jsp?   What good is putting the different hello.java classes in\ndifferent directories in gensrc if they are all going to endup in the same\nclassfile?\n\nJasper 1 generated package names matching the gensrc directories:\n\n        <servlet>\n                <servlet-name>date</servlet-name>\n                <servlet-class>date</servlet-class>\n        </servlet>\n\n        <servlet>\n                <servlet-name>hello</servlet-name>\n                <servlet-class>hello</servlet-class>\n        </servlet>\n\n        <servlet>\n                <servlet-name>subdir.date2</servlet-name>\n                <servlet-class>subdir.date2</servlet-class>\n        </servlet>\n\n        <servlet>\n                <servlet-name>subdir.hello</servlet-name>\n                <servlet-class>subdir.hello</servlet-class>\n        </servlet>\n\n        <servlet-mapping>\n                <servlet-name>date</servlet-name>\n                <url-pattern>/date.jsp</url-pattern>\n        </servlet-mapping>\n\n        <servlet-mapping>\n                <servlet-name>hello</servlet-name>\n                <url-pattern>/hello.jsp</url-pattern>\n        </servlet-mapping>\n\n        <servlet-mapping>\n                <servlet-name>subdir.date2</servlet-name>\n                <url-pattern>/subdir/date2.jsp</url-pattern>\n        </servlet-mapping>\n\n        <servlet-mapping>\n                <servlet-name>subdir.hello</servlet-name>\n                <url-pattern>/subdir/hello.jsp</url-pattern>\n        </servlet-mapping>\n\n", "is_private": false, "id": 21479, "creator": "gregw@mortbay.org", "time": "2002-08-21T15:36:05Z", "bug_id": 11891, "creation_time": "2002-08-21T15:36:05Z", "attachment_id": null}, {"count": 14, "tags": [], "text": "Your sample works fine for me.  Make sure you applied the patchs correctly.", "is_private": false, "bug_id": 11891, "id": 21481, "time": "2002-08-21T15:44:18Z", "creator": "jakarta@trollingers.com", "creation_time": "2002-08-21T15:44:18Z", "attachment_id": null}, {"count": 15, "attachment_id": null, "bug_id": 11891, "is_private": false, "id": 21483, "time": "2002-08-21T15:51:34Z", "creator": "jakarta@trollingers.com", "creation_time": "2002-08-21T15:51:34Z", "tags": [], "text": "Yes org.apache.jsp is ok for all the package names.  If you run the webapp you \nwill see that despite the fact that the classes are both \norg.apache.jsp.Hello_jsp that if you make the jsp pages different it will work \nfine.  "}, {"count": 16, "tags": [], "text": "The diffs look to have been applied OK?  It may be some other difference in our\nbase versions.      I've rolled back to the old jasper for now - because nothing\nworks for the big webapp and I can't make a small redproducable test case yet.\n\nSo if you think you have fixed the directory issue with your patches - you may\nas well mark this issue as closed and submit your patches to the tree.\n\nI'll sync with CVS next week and try again when I have more time.\n\nthanks for your help.\n", "is_private": false, "bug_id": 11891, "id": 21484, "time": "2002-08-21T15:57:12Z", "creator": "gregw@mortbay.org", "creation_time": "2002-08-21T15:57:12Z", "attachment_id": null}, {"count": 17, "tags": [], "text": "\nJust another note on the packages.  While having two different classes\ncalled org.apache.jsp.Hello_jsp may be OK in tomcat, it certainly is not\nOK in Jetty\n\nWhen I compile the two different classes I end up with two different \norg/apache/jsp/Hello_jsp.class files.    I have no where to put these\nso that they can be loaded.   I normally moved the compiled class files\nto WEB-INF/classes - but I can't if both classes are named the same thing.\n\nSo I can't even get to the stage of running this, as I know I have nowhere to\nput the two classes.\n\nAre you really really sure that you are running the precompile version and not\njust compiling on the fly.  Can you remove the jsp files from your webapp and\nstill see different content for both the Hello files?\n\n", "is_private": false, "id": 21487, "creator": "gregw@mortbay.org", "time": "2002-08-21T16:24:00Z", "bug_id": 11891, "creation_time": "2002-08-21T16:24:00Z", "attachment_id": null}, {"count": 18, "attachment_id": null, "bug_id": 11891, "text": "Yes, they are running the different classes and not rebuilding them.  How this \ndoes this I do know know, but if you post to tomcat-dev they might be able to \nexplain.\n\nthe JSP spec says the following\n\n\"The JSP Page implementation object belongs to an implementation-dependent\nnamed package. The package used may vary between one JSP and another, so\nminimal assumptions should be made.\"\n\nfrom this statement the spec allows the same package name (or different ones) \nand it is dependent upon the provider (ie tomcat or jetty) I do not know how \njetty does its packaging.", "id": 21493, "time": "2002-08-21T17:27:10Z", "creator": "jakarta@trollingers.com", "creation_time": "2002-08-21T17:27:10Z", "tags": [], "is_private": false}, {"count": 19, "tags": [], "bug_id": 11891, "attachment_id": null, "is_private": false, "id": 21495, "time": "2002-08-21T17:58:41Z", "creator": "gregw@mortbay.org", "creation_time": "2002-08-21T17:58:41Z", "text": "Sorry to go on about this....  Firstly can you send me the jsp.xml file\nand an ls -R of the gensrc you get - so we can verify that it is working\nthe same for both of us.\n\nFor what I'm getting generated, I cannot see how any container \ncan run the generated xml (I'm on the servlet JSR panel - so you would hope\nthat I know :-)\n \n       <servlet>\n                <servlet-name>org.apache.jsp.hello_jsp</servlet-name>\n                <servlet-class>org.apache.jsp.hello_jsp</servlet-class>\n        </servlet>\n        <servlet>\n                <servlet-name>org.apache.jsp.hello_jsp</servlet-name>\n                <servlet-class>org.apache.jsp.hello_jsp</servlet-class>\n        </servlet>\n\n        <servlet-mapping>\n                <servlet-name>org.apache.jsp.hello_jsp</servlet-name>\n                <url-pattern>/hello.jsp</url-pattern>\n        </servlet-mapping>\n\n        <servlet-mapping>\n                <servlet-name>org.apache.jsp.hello_jsp</servlet-name>\n                <url-pattern>/subdir/hello.jsp</url-pattern>\n        </servlet-mapping>\n\nSo both hello.jsp servlets have been mapped to a servlet called\norg.apache.jsp.hello_jsp\n\nThat servlet has been defined twice to be org.apache.jsp.hello_jsp class\n\nSo no matter what - the servlet container must serve the same content\nfor both those hello.jsp files, as they are defined as the same servlet.\n"}, {"count": 20, "tags": [], "creator": "gregw@mortbay.org", "attachment_id": null, "id": 21954, "creation_time": "2002-08-29T10:41:37Z", "time": "2002-08-29T10:41:37Z", "bug_id": 11891, "text": "Sorry but I'm reopening this again as I still cannot make it work for me, and I\nnow have other users complaining about it.    I will attach new simpler example\nof the problem.\n\nI have created a simple webapp called jspdemo:\n  jspdemo/: WEB-INF/  index.jsp  subdir/\n  jspdemo/WEB-INF: classes/\n  jspdemo/WEB-INF/classes: \n  jspdemo/subdir: index.jsp\n\nthis is attached as before.zip\n\nI then run \n\njava org.apache.jasper.JspC -webapp jspdemo -d jspdemo/WEB-INF/classes -webxml\njspdemo/WEB-INF/web.xml\n\nwhich generates the source and web.xml (after.zip), but they cannot be used\nbecause of two problems.\n\nThe source files generated are:\n  jspdemo/WEB-INF/classes/index_jsp.java\n  jspdemo/WEB-INF/classes/subdir/index_jsp.java\n\nBut both are in the org.apache.jsp package. Thus I cannot compile them\nto WEB-INF/classes as both end up in \nWEB-INF/classes/org/apache/jsp/index_jsp.class\n\nAlso the generated web.xml has a duplicate definition of\n        <servlet>\n                <servlet-name>org.apache.jsp.index_jsp</servlet-name>\n                <servlet-class>org.apache.jsp.index_jsp</servlet-class>\n        </servlet>\n\nwhich is used by both servlet mapping clauses, so both JSPs are mapped\nto the same servlet.\n\n\n\n ", "is_private": false}, {"count": 21, "attachment_id": 2866, "bug_id": 11891, "text": "Created attachment 2866\njspdemo before JspC generation", "id": 21955, "time": "2002-08-29T10:46:10Z", "creator": "gregw@mortbay.org", "creation_time": "2002-08-29T10:46:10Z", "tags": [], "is_private": false}, {"count": 22, "tags": [], "creator": "gregw@mortbay.org", "is_private": false, "text": "Created attachment 2867\njspdemo after JspC generation", "id": 21956, "time": "2002-08-29T10:46:44Z", "bug_id": 11891, "creation_time": "2002-08-29T10:46:44Z", "attachment_id": 2867}, {"count": 23, "attachment_id": 2903, "bug_id": 11891, "text": "Created attachment 2903\nContributed patch for this problem.", "id": 22168, "time": "2002-09-03T14:49:03Z", "creator": "gregw@mortbay.org", "creation_time": "2002-09-03T14:49:03Z", "tags": [], "is_private": false}, {"count": 24, "tags": [], "text": "I have attached a patch from noam@violanetworks.com that appears to fix the \npackage naming problem.\n", "is_private": false, "bug_id": 11891, "id": 22169, "time": "2002-09-03T14:50:44Z", "creator": "gregw@mortbay.org", "creation_time": "2002-09-03T14:50:44Z", "attachment_id": null}, {"count": 25, "attachment_id": null, "bug_id": 11891, "text": "I have a fix that modifies the <javac> code by adding a -isolate flag that \ncompiles each jsp file in isolation.  If anyone wants it, let me know and I can \nupload it.", "id": 22515, "time": "2002-09-09T13:38:29Z", "creator": "cmcneilly@smartbrief.com", "creation_time": "2002-09-09T13:38:29Z", "tags": [], "is_private": false}, {"count": 26, "attachment_id": null, "bug_id": 11891, "text": "I also had JspC do the compilation itself, which made the JspC easier to deal \nwith (IMHO). Unfortunately, other committers didn't agree, and compilation is \nnow a separate operation (which is a bit tricky because of the faked package \nstructure).", "id": 22523, "time": "2002-09-09T14:42:41Z", "creator": "remm@apache.org", "creation_time": "2002-09-09T14:42:41Z", "tags": [], "is_private": false}, {"count": 27, "tags": [], "creator": "jakarta@trollingers.com", "attachment_id": null, "id": 23000, "time": "2002-09-17T18:28:34Z", "bug_id": 11891, "creation_time": "2002-09-17T18:28:34Z", "is_private": false, "text": "Is anyone going to add the patch for package names.. as it would realy make a \nlot of other things work nicely (ie ant compiles of JSP pages)"}, {"count": 28, "attachment_id": null, "bug_id": 11891, "text": "Hi,\n\nI analyzed the problem with jspc and jsp pages in a directory structure.\n\nThese are the problems based on the Tomcat 4.1.12 version:\n\n1. the directory structure is copied to place the generated Java files into it. \nBut there's a problem with the package names. What are you doing if there's a \ndirectory or sub-directory with a not legal Java package name, e.g. 'static' or \n'public' etc. so that e.g. a directory name would be /static/public/infopages. \nThis should be converted into e.g. '_static/_public/_infopages'.\n\n2. The generated Java file has always the same package (the first line in the \nJava source file). That's by default org.apache.jsp. It should be the converted \ndirectory structure to a legal package name: for the example above it should be: \n'package _static._public._infopages;'\n\n3. Probably there are also restrictions for a Java class name. Probably some \ncharacters are not allowd in the class name but are legal for jsp names. These \nshould be escaped.\n\n4. The servlet mappings file generator should use all the above used techniques \nto generate a correct mapping. For the above example it should be (with the page \nTest.jsp):\n\n<servlet>\n  <servlet-name>_static__public__infopages_Test_jsp</servlet-name>\n  <servlet-class>_static._public._infopages.Test_jsp</servlet-class>\n</servlet>\n\n<servlet-mapping>\n <servlet-name>_static__public__infopages_Test_jsp</servlet-name>\n <url-pattern>/static/public/infopages/Test.jsp</url-pattern>\n</servlet-mapping>\n\nI hope these comments are useful for a correct implementation of the JspC for \nlarger web applications with a rich directory structure and jsp names.\n\nWith Regards,\nUdo Walker\n\n\n", "id": 23550, "time": "2002-09-27T15:40:30Z", "creator": "Udo.Walker@abas.de", "creation_time": "2002-09-27T15:40:30Z", "tags": [], "is_private": false}, {"count": 29, "tags": [], "creator": "mbrodzia@erggroup.com", "attachment_id": null, "id": 24598, "time": "2002-10-16T03:25:41Z", "bug_id": 11891, "creation_time": "2002-10-16T03:25:41Z", "is_private": false, "text": "I am unclear as to whether this problem is approaching a resolution. I am also \nsuffering from the same issue in relation to the lack of class packaging for \nfiles with the same name. Surely this is a prevalent problem, as a lot of \npeople must use 'index.jsp' throughout their directory structure.\n\nThe release notes for Tomcat 4.1 ($Id: RELEASE-NOTES-4.1.txt,v 1.21 2002/09/23 \n00:32:46 billbarker Exp $) refer to this bug, and indicate the fix as being \nthe '-webapp' option. I don't believe that this resolves the issue.\n\nWhilst I can both precompile the classes into .java as well as compile \ninto .class using the compile=\"true\" switch, this does not suffice for \ndeployment; I am deploying into JBoss 3.0.3 / Tomcat 4.1.12 bundle, and this \ngets translated into the Apache directory structure. Because there are \nseveral 'org.apache.jsp.index_jsp' class files located within different \ndirectories in the WEB-INF/classes directory of the WAR file, this confuses the \nclass loader and stops deployment.\n\nI believe that instead a fixed package which I believe is currently the case, \nthe generated code should contain packages that reflect the JSP directory \nstructure such as the following:\n\n/index.jsp \n  Java file: com.my.package.index_jsp\n  Generated to: /generated/com/my/package/index_jsp.java\n/hello/index.jsp \n  Java file: com.my.package.hello.index_jsp\n  Generated to: /generated/com/my/package/hello/index_jsp.java\n\ninstead of what currently happens, which is\n/index.jsp \n  Java file: com.my.package.index_jsp\n  Generated to: /generated/com/my/package/index_jsp.java\n/hello/index.jsp \n  Java file: com.my.package.index_jsp\n  Generated to: /generated/com/my/package/hello/index_jsp.java\n\nHas somebody already contributed a patch to correctly package the generated \njava source code (and when I say package, I reiterate that I mean 'package xxx' \nwithin the Java source, not simply by locating the source in a sub-directory)?\n"}, {"count": 30, "tags": [], "creator": "mbrodzia@erggroup.com", "attachment_id": null, "id": 24599, "time": "2002-10-16T04:58:35Z", "bug_id": 11891, "creation_time": "2002-10-16T04:58:35Z", "is_private": false, "text": "Greg, I have applied your patch and this has enabled me to proceed \nsuccessfully. It would be great if this could be integrated into the next \nTomcat release."}, {"count": 31, "tags": [], "creator": "gregw@mortbay.org", "attachment_id": null, "id": 24608, "time": "2002-10-16T07:58:11Z", "bug_id": 11891, "creation_time": "2002-10-16T07:58:11Z", "is_private": false, "text": "Mark,\nthat patch introduced other problems with normal JSP compilation, so \nI have backed it out of my copy of jasper.    Note that I'm not a tomcat\ncommitter and this issue has yet to be assigned to a tomcat developer - so\nI don't know if it is being worked on?"}, {"count": 32, "tags": [], "bug_id": 11891, "attachment_id": null, "id": 24846, "time": "2002-10-18T06:53:05Z", "creator": "mbrodzia@erggroup.com", "creation_time": "2002-10-18T06:53:05Z", "is_private": false, "text": "Greg,\n\nYes I had the problems with normal JSP compilation as well, and it was due to \nan unchecked cast. Here is the change that resolves it:\n\nJSPCompilationContext.java 145:\n\nboolean isPAckageNeeded= false;\nif ( options instanceof JspC )\n{\n    isPAckageNeeded= ((JspC)options).isOutputDirSet();//if not -dd option\n}\n\nI can now precompile and also use standard JSP compilation.\n"}, {"count": 33, "tags": [], "text": "The patch attachment dated \"09/03/03\" along with Mark's notes from 10/18 worked\ngreat with our application (334 jsp's, 8 or so directories).  \n\nPreviously we had two issues: if we compiled the whole app in one shot then we\nhad problems since we have files of the same name in different directories, but\nif we compiled the application a directory at a time (setting the package\ndifferently for each one) we had problems since we have one file that gets\nincluded from different directories.\n", "attachment_id": null, "bug_id": 11891, "id": 26464, "time": "2002-11-18T12:48:15Z", "creator": "toby@caboteria.org", "creation_time": "2002-11-18T12:48:15Z", "is_private": false}, {"count": 34, "tags": [], "creator": "kin-man.chung@sun.com", "attachment_id": null, "id": 35044, "time": "2003-04-11T23:36:36Z", "bug_id": 11891, "creation_time": "2003-04-11T23:36:36Z", "is_private": false, "text": "I believe the current 4.1.x has fixed some of the issues and my latest commit in\nTC 5 addresses all the issues (it also unifies embedded compilation and jspc). \ntry it out and let me know if there are others.  Thnaks."}]
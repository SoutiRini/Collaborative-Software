[{"count": 0, "tags": [], "creator": "tmg@cnicorp.com", "is_private": false, "text": "I'm running Windows 2000 Advance Server with Tomcat 4.29 and IIS 5\n\nI have the ISAPI redirector installed and working with IIS & Tomcat on HTTP\nhttp://localhost/MySite/HomePage.jsp\n\nI installed a server certificate and enables SSL on port 443 in IIS\n\nI'm able to view 'static' objects (like html pages & images) via SSL\nhttps://localhost/MySite/index.html\n\nWhile any non SSL URL (still static objects) will not be served by IIS and the\nuser will see the 'standard' IIS error: \nHTTP 403.4 - Forbidden: SSL required\nhttp://localhost/MySite/index.html\n\nThe problem is when I try to view any JSP/Servlet  the browser wants to 'save'\nthe page to the local drive.\nhttp://localhost/MySite/HomePage.jsp\nIn other words the JSP is not served as HTML to the browser and the browser does\nnot know what to do with the file except save it.\n\nI set the ISAPI error reporting to DEBUG and it looks like it the redirector\njust 'stops' and does not forward the request correctly.\n\n*****\nSo the questions is:\n   How to I get the ISAPI redirector to work with SSL?\n   Connecting IIS (on port 80) to Tomcat with SSL enabled on every URL and so\nhttp urls will be redirected to https\n*****\n\nThere are no erros in my tomcat logs.\n\nHere is my ISAPI log file of trying to serve a JSP page:\n\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (1018)]: Using registry.\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (1020)]: Using log file\nC:\\\\Program Files\\\\Apache Group\\\\Tomcat 4.1\\\\iis\\\\iis_redirect.txt.\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (1021)]: Using log level 0.\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (1022)]: Using extension uri\n/jakarta/isapi_redirector.dll.\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (1023)]: Using worker file\nC:\\\\Program Files\\\\Apache Group\\\\Tomcat 4.1\\\\conf\\\\workers.properties.\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (1024)]: Using worker mount file\nC:\\\\Program Files\\\\Apache Group\\\\Tomcat 4.1\\\\conf\\\\uriworkermap.properties.\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (1025)]: Using uri select 0.\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (1041)]: Ignoring worker mount\nfile entry default.worker=ajp13.\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (1041)]: Ignoring worker mount\nfile entry j_security_check=ajp13.\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (172)]: Into\njk_uri_worker_map_t::uri_worker_map_alloc\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (375)]: Into\njk_uri_worker_map_t::uri_worker_map_open\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (396)]:\njk_uri_worker_map_t::uri_worker_map_open, rule map size is 5\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (299)]: Into\njk_uri_worker_map_t::uri_worker_map_open, suffix rule /.jsp=ajp13 was added\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (321)]: Into\njk_uri_worker_map_t::uri_worker_map_open, match rule /MySite/Servlets/=ajp13 was\nadded\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (299)]: Into\njk_uri_worker_map_t::uri_worker_map_open, suffix rule /MySite/.jsp=ajp13 was added\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (299)]: Into\njk_uri_worker_map_t::uri_worker_map_open, suffix rule /MySite/.do=ajp13 was added\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (345)]: Into\njk_uri_worker_map_t::uri_worker_map_open, exact rule\n/MySite/AdminFunctions/j_security_check=ajp13 was added\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (408)]: Into\njk_uri_worker_map_t::uri_worker_map_open, there are 5 rules\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (422)]:\njk_uri_worker_map_t::uri_worker_map_open, done\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (88)]: Into wc_open\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (224)]: Into build_worker_map, creating\n1 workers\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (230)]: build_worker_map, creating\nworker ajp13\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (148)]: Into wc_create_worker\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (260)]: Factory :ajp12\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (260)]: Factory :ajp13\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (164)]: wc_create_worker, about to\ncreate instance ajp13 of ajp13\n[Thu Jan 29 13:18:16 2004]  [jk_ajp13_worker.c (108)]: Into ajp13_worker_factory\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (173)]: wc_create_worker, about to\nvalidate and init ajp13\n[Thu Jan 29 13:18:16 2004]  [jk_ajp_common.c (1206)]: Into jk_worker_t::validate\n[Thu Jan 29 13:18:16 2004]  [jk_ajp_common.c (1226)]: In jk_worker_t::validate\nfor worker ajp13 contact is localhost:8009\n[Thu Jan 29 13:18:16 2004]  [jk_ajp_common.c (1254)]: Into jk_worker_t::init\n[Thu Jan 29 13:18:16 2004]  [jk_ajp_common.c (1274)]: In jk_worker_t::init,\nsetting socket timeout to 0\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (189)]: wc_create_worker, done\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (240)]: build_worker_map, removing old\najp13 worker \n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (252)]: build_worker_map, done\n[Thu Jan 29 13:18:16 2004]  [jk_worker.c (111)]: wc_open, done 1\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (655)]: Detected IIS >= 5.0\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (696)]: HttpFilterProc started\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (759)]: In HttpFilterProc Virtual\nHost redirection of /localhost/MySite/Htmlfiles/Home.jsp\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (460)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (477)]: Attempting to map URI\n'/localhost/MySite/Htmlfiles/Home.jsp'\n[Thu Jan 29 13:18:16 2004]  [jk_uri_worker_map.c (558)]:\njk_uri_worker_map_t::map_uri_to_worker, Found a suffix match ajp13 -> *.jsp\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (775)]: HttpFilterProc\n[/MySite/Htmlfiles/Home.jsp] is a servlet url - should redirect to ajp13\n[Thu Jan 29 13:18:16 2004]  [jk_isapi_plugin.c (838)]: HttpFilterProc check if\n[/MySite/Htmlfiles/Home.jsp] is points to the web-inf directory\n...nothing follows....\n****************\nserver.xml\n<Server port=\"8005\" shutdown=\"SHUTDOWN\" debug=\"0\">\n  <GlobalNamingResources>\n    <Resource name=\"UserDatabase\" auth=\"Container\"\n              type=\"org.apache.catalina.UserDatabase\"\n       description=\"User database that can be updated and saved\">\n    </Resource>\n    <ResourceParams name=\"UserDatabase\">\n      <parameter>\n        <name>factory</name>\n       \n<value>org.apache.catalina.users.MemoryUserDatabaseFactory</value></parameter>\n      <parameter>\n        <name>pathname</name>\n        <value>conf/tomcat-users.xml</value></parameter>\n    </ResourceParams>\n  </GlobalNamingResources>\n\n  <!-- Define the Tomcat Stand-Alone Service -->\n  <Service name=\"Tomcat-Standalone\">\n\n    <!-- Define a Coyote HTTP/1.1 Connector on port 8080-->\n    <Connector className=\"org.apache.coyote.tomcat4.CoyoteConnector\"\n               port=\"8080\" minProcessors=\"5\" maxProcessors=\"75\"\n               enableLookups=\"true\" redirectPort=\"443\"\n               acceptCount=\"10\" debug=\"9\" connectionTimeout=\"10\"\n               useURIValidationHack=\"false\" />\n\n    <!-- Define a Coyote/JK2 AJP 1.3 Connector on port 8009 -->\n   <Connector className=\"org.apache.coyote.tomcat4.CoyoteConnector\"\n               port=\"8009\" \n               minProcessors=\"5\" \n\t\t   maxProcessors=\"75\"\n               enableLookups=\"false\" \n               acceptCount=\"10\" debug=\"0\" \n\t\t   connectionTimeout=\"20000\"\n               useURIValidationHack=\"false\"\n               redirectPort=\"443\"\n\t\t   protocolHandlerClassName=\"org.apache.jk.server.JkCoyoteHandler\"/>\n\n    <!-- Define the top level container in our container hierarchy -->\n    <Engine name=\"Standalone\" defaultHost=\"localhost\" debug=\"0\">\n\n      <!-- Global logger unless overridden at lower levels -->\n      <Logger className=\"org.apache.catalina.logger.FileLogger\"\n              prefix=\"catalina_log\" suffix=\".txt\"\n              timestamp=\"true\"/>\n\n      <Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\"  debug=\"0\"\n\t\t\t\tresourceName=\"UserDatabase\"/>\n\n      <!-- Define MySite virtual host \t -->\n\t <Host name=\"localhost\" debug=\"0\" appBase=\"webapps\" unpackWARs=\"true\"\nautoDeploy=\"true\">\n\t\t<Valve className=\"org.apache.catalina.authenticator.SingleSignOn\" debug=\"0\"/>\n\t\t<Context path=\"/MySite\" docBase=\"c:\\Websites\\MySite\" debug=\"0\" \n\t\t\treloadable=\"false\" crossContext=\"false\">\n\t\t<Logger className=\"org.apache.catalina.logger.FileLogger\" prefix=\"MySite_log\"\n\t\t\tsuffix=\".txt\" timestamp=\"true\" verbosityLevel=\"DEBUG\"/>\n\t\t</Context>\n\t</Host>\n\n</Engine>\n</Service>\n</Server>\n\n**********\nuriworkermap.properties\n**********\n# Default worker to be used through our mappings\ndefault.worker=ajp13\n# Root context mounts for Tomcat\n/*.jsp=$(default.worker)\nj_security_check=$(default.worker)\n# The following line mounts all JSP file and the /servlet/ uri to tomcat\n/MySite/Servlets/*=$(default.worker)\n/MySite/*.jsp=$(default.worker)\n/MySite/*.do=$(default.worker)\n/MySite/AdminFunctions/j_security_check=$(default.worker)\n\n**********\nworkers.properties\n**********\nworkers.tomcat_home=C:\\Program Files\\Apache Group\\Tomcat 4.1\nworkers.java_home=C:\\j2sdk1.4.2_03\nps=\\\nworker.list=ajp13\nworker.ajp13.port=8009\nworker.ajp13.host=localhost\nworker.ajp13.type=ajp13\nworker.ajp13.lbfactor=1\n\n\n********nothing follows***********", "id": 51422, "time": "2004-01-29T18:39:48Z", "bug_id": 26529, "creation_time": "2004-01-29T18:39:48Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 26529, "text": "any one have any sugestions?", "id": 54386, "time": "2004-03-22T14:24:34Z", "creator": "tmg@cnicorp.com", "creation_time": "2004-03-22T14:24:34Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 26529, "attachment_id": null, "is_private": false, "id": 60447, "time": "2004-07-11T18:30:49Z", "creator": "markt@apache.org", "creation_time": "2004-07-11T18:30:49Z", "text": "Bugzilla is not the correct forum for asking support questions. Please use the \ntomcat-user mailing list for qustions of this nature."}]
[{"count": 0, "tags": [], "bug_id": 52337, "attachment_id": 28072, "id": 152176, "time": "2011-12-15T02:55:52Z", "creator": "niklas.rehfeld@gmail.com", "creation_time": "2011-12-15T02:55:52Z", "is_private": false, "text": "Created attachment 28072\ntest document that causes the error.\n\nOn certain office documents (attached is one where this happens) running the following code causes the array 'headings' truncated. So the last field (headParts) of the last VtHeadingPair is 5 or 6 bytes long instead of 8. (depending on the document)\n\n---------------\n\nPropertySet ps = PropertySetFactory.create(inStream);\n (!(ps instanceof DocumentSummaryInformation))\n     return;\nDocumentSummaryInformation dsi = (DocumentSummaryInformation) ps;\nSection s = (Section) dsi.getSections().get(0);\nObject hdrs = s.getProperty(PropertyIDMap.PID_HEADINGPAIR); \nbyte[] headings = null;\nif (hdrs == null)\n     return;\nheadings = (byte[]) hdrs;\n\n----------------\n\nIt happens with excel and word documents, but seemingly not with powerpoint ones. \n\nThis problem occurs using POI 3.8 beta 6 (r1213215 from SVN, I think). It does not occur in 3.6+dfsg-2 from debian sid.\n\nI've had a look through the Document, the relevant part (with my annotations) is: \n\n------------...\n0000f8c0  fe ff 00 00 05 01 02 00  00 00 00 00 00 00 00 00  |................|\n\t |order|vers |\tsysid    |     clsid...\n0000f8d0  00 00 00 00 00 00 00 00  02 00 00 00 02 d5 cd d5  |................|\n\t\tclsid...\t  |#propsets=2|  fmtid 0      \n0000f8e0  9c 2e 1b 10 93 97 08 00  2b 2c f9 ae 44 00 00 00  |........+,..D...|\n\t\tfmtid 0                       | offset0=68\n0000f8f0  05 d5 cd d5 9c 2e 1b 10  93 97 08 00 2b 2c f9 ae  |............+,..|\n\t\t\t\t...fmtid 1...\n0000f900  58 01 00 00 14 01 00 00  0c 00 00 00 01 00 00 00  |X...............| \n          offset1=344| PROPSET 0 Starts here...\n0000f910  68 00 00 00 0f 00 00 00  70 00 00 00 05 00 00 00  |h.......p.......|\n... etc ...\n0000f9f0  61 20 74 65 73 74 00 0c  10 00 00 02 00 00 00 1e  |a test..........|\n                              | type | pad |  count=1  |type=string \n0000fa00  00 00 00 06 00 00 00 54  69 74 6c 65 00 03 00 00  |.......Title....|\n\t\t  | length=6  |  string...       |type=int32\n0000fa10  00 01 00 00 00 00 00 00  a8 00 00 00 03 00 00 00  |................|\n\t    |headparts=1|\t  |-- PROPSET1 starts here\n---------------\n\nSo the document seems well formed. \n\nI had a hunt around the POI source, but couldn't see anything obviously wrong. \n\nUsing sun java 6 (1.6.0) 64 bit."}, {"count": 1, "tags": [], "bug_id": 52337, "attachment_id": 28073, "id": 152177, "time": "2011-12-15T03:00:34Z", "creator": "niklas.rehfeld@gmail.com", "creation_time": "2011-12-15T03:00:34Z", "is_private": false, "text": "Created attachment 28073\nannotated hexdump of DocumentSummaryInformation block\n\nThe alignment on the original bug description didn't work, so here's a text file of it."}, {"count": 2, "tags": [], "bug_id": 52337, "text": "Thanks for the detailed investigation, it looks like the same issue as Bug 52385.\n\nWe confirmed the problem, the fix is on the way.\n\nYegor", "id": 152649, "time": "2012-01-10T07:07:46Z", "creator": "yegor@dinom.ru", "creation_time": "2012-01-10T07:07:46Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 52337, "attachment_id": null, "id": 153799, "time": "2012-02-15T07:53:54Z", "creator": "yegor@dinom.ru", "creation_time": "2012-02-15T07:53:54Z", "is_private": false, "text": "Should be fixed in r1244388, junit added. \n\nRegards,\nYegor"}]
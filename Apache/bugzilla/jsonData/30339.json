[{"count": 0, "tags": [], "bug_id": 30339, "attachment_id": null, "text": "Okay, this one is strange.  I've got an Ant build.xml file that builds a jar\nfile containing 481 entries, built up from several subdirectories.  If I take\nthe produced jar file and put it on the web site, Safari on Mac OS X 10.3.4,\nFirefox on Fedora Core 2 and Windows 2000, and IE 6 on Windows 2000, against\nJava 1.4.1, Java 1.4.2, and Java 1.5.0 beta 2, all refuse to launch the applet\nthat uses this jar file for its class files and resources.. I get a message\nsaying that the entry point class can not be found, and I see in my web server\nthat, after retrieving the jar file, the client JVM tries to load the entry\npoint class directly.\n\nBUT, if I take the Jar file on my Solaris system, expand it with 'jar xf', then\nrejar it with a matching 'jar cf', all of the above platforms find the entry\npoint class properly in the rejar'ed jar file.  There's something about the Jar\nfile that Ant is producing in this case that just won't go, even though it\nobviously contains everything necessary for proper execution when I take it\nthrough a roundtrip using Sun's jar tool.\n\nWhen I run both jar files through zipinfo, I see the following differences:\n\nThe Ant-produced jar file has file types of 'unx', and the class files are\nvery much out of order.  A sample zipinfo excerpt is as follows:\n\n-rw-r--r--  2.0 unx     264 b- defN 26-Jul-04 19:25\narlut/csd/ganymede/float_field.class\n-rw-r--r--  2.0 unx     618 b- defN 26-Jul-04 19:25\narlut/csd/ganymede/invid_field.class\n-rw-r--r--  2.0 unx     290 b- defN 26-Jul-04 19:25\narlut/csd/ganymede/ip_field.class\n-rw-r--r--  2.0 unx     262 b- defN 26-Jul-04 19:25\narlut/csd/ganymede/num_field.class\n-rw-r--r--  2.0 unx     915 b- defN 26-Jul-04 19:25\narlut/csd/ganymede/pass_field.class\n-rw-r--r--  2.0 unx    1160 b- defN 26-Jul-04 19:25\narlut/csd/ganymede/perm_field.class\n-rw-r--r--  2.0 unx     636 b- defN 26-Jul-04 19:25\narlut/csd/ganymede/string_field.class\n483 files, 1377893 bytes uncompressed, 604275 bytes compressed:  56.1%\n\nWith command line jar from Java 1.4.2_05, I see entries like:\n\n-rw----     2.0 fat    1570 bl defN 26-Jul-04 19:29\norg/xml/sax/helpers/AttributeListImpl.class\n-rw----     2.0 fat     934 bl defN 26-Jul-04 19:29\norg/xml/sax/helpers/LocatorImpl.class\n-rw----     2.0 fat     893 bl defN 26-Jul-04 19:29\norg/xml/sax/helpers/ParserFactory.class\n481 files, 1377635 bytes uncompressed, 604097 bytes compressed:  56.1%\n\nI'll include as attachments the good jar file produced by 'jar', the bad\njar file produced by Ant, and the html file used to launch the applet.", "id": 61161, "time": "2004-07-27T02:12:41Z", "creator": "jonabbey@ganymeta.org", "creation_time": "2004-07-27T02:12:41Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 12230\nThe jar file produced by Ant.. browsers using Java 1.4.1, 1.4.2, 1.5.0 fail when launching an applet with this jar", "is_private": false, "id": 61162, "creator": "jonabbey@ganymeta.org", "time": "2004-07-27T02:13:40Z", "bug_id": 30339, "creation_time": "2004-07-27T02:13:40Z", "attachment_id": 12230}, {"count": 2, "tags": [], "bug_id": 30339, "attachment_id": 12231, "id": 61163, "time": "2004-07-27T02:14:18Z", "creator": "jonabbey@ganymeta.org", "creation_time": "2004-07-27T02:14:18Z", "is_private": false, "text": "Created attachment 12231\nThe exact same contents, after dumping out with 1.4.2 jar command and repacking.  Works great on all browsers."}, {"count": 3, "tags": [], "bug_id": 30339, "attachment_id": null, "is_private": false, "id": 61164, "time": "2004-07-27T02:15:23Z", "creator": "jonabbey@ganymeta.org", "creation_time": "2004-07-27T02:15:23Z", "text": "Here is the HTML used to launch applications out of these jar files.. this\nwill work or fail according to which attachment I use as ganymede.jar in\nthe local directory\n\n<HTML>\n<HEAD>\n<TITLE>Ganymede Login - csdsun9.arlut.utexas.edu</TITLE>\n</HEAD>\n<BODY BGCOLOR=\"#000000\" marginheight=0 marginwidth=0>\n<center>\n<APPLET WIDTH=\"320\" HEIGHT=\"350\"\n        CODE=\"arlut.csd.ganymede.client.glogin\"\n        ARCHIVE=\"ganymede.jar\">\n<PARAM NAME=\"ganymede.serverhost\" VALUE=\"csdsun9.arlut.utexas.edu\" >\n<PARAM NAME=\"ganymede.registryPort\" VALUE=\"1100\" >\n</APPLET>\n</center>\n</BODY>\n</HTML>\n"}, {"count": 4, "tags": [], "bug_id": 30339, "attachment_id": null, "id": 61165, "time": "2004-07-27T02:20:22Z", "creator": "jonabbey@ganymeta.org", "creation_time": "2004-07-27T02:20:22Z", "is_private": false, "text": "At this point, I can't identify what might be significantly different between\nthe two jar files attached above.  Other jar files produced by Ant 1.6.2 on my\nSolaris system do work properly on the browsers I've tested.. even the bad jar\nfile attached will work properly, if I use the Jar file with Java Web Start or\ndirectly with Appletviewer.. but if I try running it with any of the following\nbrowser/OS/JDK combinations it fails..\n\nSafari - Mac OS X 10.3.4 - JDK 1.4.1\nFirefox - Fedora Core 2 - JDK 1.4.2_05\nFirefox - Fedora Core 2 - JDK 1.5.0 beta 2\nFirefox - Windows 2000 - JDK 1.5.0 beta 2\nIE 6 - Windows 2000 - JDK 1.5.0 beta 2\n\nClearly there is something in the jar file generated by Ant which tickles an\nedge case in these JDK's.. but only when they are trying to launch an applet\nfrom the jar file on a web server through a web browser, seemingly.\n\nHair pullingly mysterious.\n\nIt should be possible to verify this test case by putting the HTML file in\ncomment 3 onto a web server along with the two versions of ganymede.jar from\nthe attachments.. the one marked bad should report a failure to load\narlut.csd.ganymede.client.glogin, and the one marked good should not.. (though\neven on success the one marked good will indicate an exception trying to\nconnect to our internal RMI server mentioned in the applet parameter.)"}, {"count": 5, "tags": [], "bug_id": 30339, "attachment_id": null, "text": "Here's the Ant Jar task definition in question, just by way of explaining why\nthe classes appear in the order they do in the Ant produced jar file.\n\n    <!-- Build the client jar file -->\n    <jar jarfile=\"${build.lib}/ganymede.jar\">\n      <fileset dir=\"${build.classes}\" includes=\"arlut/csd/ganymede/client/*.class\"/>\n      <fileset dir=\"${build.classes}\" includes=\"arlut/csd/Util/**/*.class\"/>\n      <fileset dir=\"${build.classes}\"\nincludes=\"arlut/csd/JDataComponent/**/*.class\"/>\n      <fileset dir=\"${build.classes}\" includes=\"arlut/csd/JCalendar/**/*.class\"/>\n      <fileset dir=\"${build.classes}\" includes=\"arlut/csd/JDialog/**/*.class\"/>\n      <fileset dir=\"${build.classes}\" includes=\"arlut/csd/JTable/**/*.class\"/>\n      <fileset dir=\"${build.classes}\" includes=\"arlut/csd/JTree/**/*.class\"/>\n      <fileset dir=\"${build.classes}\" includes=\"arlut/csd/ganymede/*_Stub.class\"/>\n      <fileset dir=\"${build.classes}\" includes=\"org/xml/sax/**/*.class\"/>\n      <fileset dir=\"${build.classes}\" includes=\"com/jclark/**/*.class\"/>\n\n      <fileset dir=\"${graphics.dir}\" includes=\"arlut/csd/JCalendar/*\"/>\n      <fileset dir=\"${graphics.dir}\" includes=\"arlut/csd/JDataComponent/*\"/>\n      <fileset dir=\"${graphics.dir}\" includes=\"arlut/csd/JCalendar/*\"/>\n      <fileset dir=\"${graphics.dir}\" includes=\"arlut/csd/ganymede/client/*\"/>\n\n      <fileset dir=\"${build.classes}\">\n        <!-- Basic things -->\n        <include name=\"arlut/csd/ganymede/Base.class\"/>\n        <include name=\"arlut/csd/ganymede/BaseDump.class\"/>\n        <include name=\"arlut/csd/ganymede/BaseField.class\"/>\n        <include name=\"arlut/csd/ganymede/BaseListTransport.class\"/>\n        <include name=\"arlut/csd/ganymede/BaseNode.class\"/>\n        <include name=\"arlut/csd/ganymede/CatTreeNode.class\"/>\n        <include name=\"arlut/csd/ganymede/Category.class\"/>\n        <include name=\"arlut/csd/ganymede/CategoryDump.class\"/>\n        <include name=\"arlut/csd/ganymede/CategoryNode.class\"/>\n        <include name=\"arlut/csd/ganymede/CategoryTransport.class\"/>\n        <include name=\"arlut/csd/ganymede/Client.class\"/>\n        <include name=\"arlut/csd/ganymede/ClientAsyncResponder.class\"/>\n        <include name=\"arlut/csd/ganymede/FieldInfo.class\"/>\n        <include name=\"arlut/csd/ganymede/FieldTemplate.class\"/>\n        <include name=\"arlut/csd/ganymede/FieldType.class\"/>\n        <include name=\"arlut/csd/ganymede/Invid.class\"/>\n        <include name=\"arlut/csd/ganymede/NameSpace.class\"/>\n        <include name=\"arlut/csd/ganymede/NotLoggedInException.class\"/>\n        <include name=\"arlut/csd/ganymede/PermEntry.class\"/>\n        <include name=\"arlut/csd/ganymede/PermMatrix.class\"/>\n        <include name=\"arlut/csd/ganymede/Server.class\"/>\n        <include name=\"arlut/csd/ganymede/Session.class\"/>\n        <include name=\"arlut/csd/ganymede/SpaceNode.class\"/>\n        <include name=\"arlut/csd/ganymede/SchemaConstants.class\"/>\n        <include name=\"arlut/csd/ganymede/XMLSession.class\"/>\n\n        <!-- Remote interfaces -->\n        <include name=\"arlut/csd/ganymede/boolean_field.class\"/>\n        <include name=\"arlut/csd/ganymede/date_field.class\"/>\n        <include name=\"arlut/csd/ganymede/db_field.class\"/>\n        <include name=\"arlut/csd/ganymede/db_object.class\"/>\n        <include name=\"arlut/csd/ganymede/invid_field.class\"/>\n        <include name=\"arlut/csd/ganymede/ip_field.class\"/>\n        <include name=\"arlut/csd/ganymede/num_field.class\"/>\n        <include name=\"arlut/csd/ganymede/float_field.class\"/>\n        <include name=\"arlut/csd/ganymede/pass_field.class\"/>\n        <include name=\"arlut/csd/ganymede/perm_field.class\"/>\n        <include name=\"arlut/csd/ganymede/string_field.class\"/>\n        <include name=\"arlut/csd/ganymede/ClientMessage.class\"/>\n        <include name=\"arlut/csd/ganymede/clientAsyncMessage.class\"/>\n        <include name=\"arlut/csd/ganymede/FileReceiver.class\"/>\n\n        <!-- Deserialization stuff -->\n        <include name=\"arlut/csd/ganymede/adminSession.class\"/>\n        <include name=\"arlut/csd/ganymede/Admin.class\"/>\n        <include name=\"arlut/csd/ganymede/DBBaseCategory.class\"/>\n        <include name=\"arlut/csd/ganymede/DBBaseCategory$*.class\"/>\n        <include name=\"arlut/csd/ganymede/DBObject.class\"/>\n        <include name=\"arlut/csd/ganymede/DBObjectBase.class\"/>\n        <include name=\"arlut/csd/ganymede/DBObjectBase$*.class\"/>\n        <include name=\"arlut/csd/ganymede/GanymedeSession.class\"/>\n        <include name=\"arlut/csd/ganymede/GanymedeSession$*.class\"/>\n        <include name=\"arlut/csd/ganymede/SchemaEdit.class\"/>\n\n        <!-- Query stuff -->\n        <include name=\"arlut/csd/ganymede/DumpResult.class\"/>\n        <include name=\"arlut/csd/ganymede/Query.class\"/>\n        <include name=\"arlut/csd/ganymede/QueryAndNode.class\"/>\n        <include name=\"arlut/csd/ganymede/QueryDataNode.class\"/>\n        <include name=\"arlut/csd/ganymede/QueryNode.class\"/>\n        <include name=\"arlut/csd/ganymede/QueryNotNode.class\"/>\n        <include name=\"arlut/csd/ganymede/QueryOrNode.class\"/>\n        <include name=\"arlut/csd/ganymede/QueryResult.class\"/>\n        <include name=\"arlut/csd/ganymede/QueryResult$*.class\"/>\n        <include name=\"arlut/csd/ganymede/Result.class\"/>\n        <include name=\"arlut/csd/ganymede/ObjectHandle.class\"/>\n\n        <!-- Wizard stuff -->\n        <include name=\"arlut/csd/ganymede/Ganymediator.class\"/>\n        <include name=\"arlut/csd/ganymede/ReturnVal.class\"/>\n      </fileset>\n    </jar>", "id": 61166, "time": "2004-07-27T02:25:49Z", "creator": "jonabbey@ganymeta.org", "creation_time": "2004-07-27T02:25:49Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 30339, "text": "Is there anything else I can do to help with an appraisal of this bug?", "id": 62222, "time": "2004-08-20T01:32:17Z", "creator": "jonabbey@arlut.utexas.edu", "creation_time": "2004-08-20T01:32:17Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 30339, "attachment_id": null, "is_private": false, "id": 62237, "time": "2004-08-20T14:48:47Z", "creator": "mbenson@apache.org", "creation_time": "2004-08-20T14:48:47Z", "text": "Just out of curiosity, are you running this only on a company webserver or have \nyou tried running it against a local webserver?"}, {"count": 8, "tags": [], "bug_id": 30339, "attachment_id": null, "text": "I'm running it on a web server I control, yes.\n\nI'm pulling down Ant 1.6.2 now.  I'll comment further when I see whether the\nproblem persists in the newer Ant.", "id": 63318, "time": "2004-09-09T22:08:06Z", "creator": "jonabbey@arlut.utexas.edu", "creation_time": "2004-09-09T22:08:06Z", "is_private": false}, {"count": 9, "tags": [], "text": "Oh, duh.  Sorry, I had already tested this problem in 1.6.2, apparently.\n\nAt this point it still seems that the jar task in Ant produces JAR files that\ncan break under certain (obviously rare, edge case) circumstances with Java\n1.4.1, 1.4.2, or 1.5.0 beta.", "attachment_id": null, "bug_id": 30339, "id": 63320, "time": "2004-09-09T22:22:53Z", "creator": "jonabbey@arlut.utexas.edu", "creation_time": "2004-09-09T22:22:53Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 30339, "text": "Your first example jat contains two duplicate files,\narlut/csd/JDataComponent/calendar_dn.gif and arlut/csd/JCalendar/up.gif.\n\nCould they be the reason?\n\nThere are two fileset in your task pointing to the same directories:\n<fileset dir=\"${graphics.dir}\" includes=\"arlut/csd/JCalendar/*\"/>\n\nIf you remove one of them, does that make your browsers happy?\n", "id": 65750, "time": "2004-10-26T15:46:17Z", "creator": "bodewig@apache.org", "creation_time": "2004-10-26T15:46:17Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "text": "Ahhhhh.. very good catch!  Yes, that seems to fix things quite nicely.\n\nPerhaps Ant could use some logic to detect files being placed multiple times\ninto the same Jar file?", "attachment_id": null, "id": 65794, "creator": "jonabbey@ganymeta.org", "time": "2004-10-27T03:52:54Z", "bug_id": 30339, "creation_time": "2004-10-27T03:52:54Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 30339, "text": "The logic is there and controlled by the duplicate attribute of the task.\n\nIt's default value makes Ant add all instances of the \"same\" files.", "id": 65883, "time": "2004-10-28T08:21:52Z", "creator": "bodewig@apache.org", "creation_time": "2004-10-28T08:21:52Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 30339, "attachment_id": null, "is_private": false, "id": 65933, "time": "2004-10-28T20:03:39Z", "creator": "jonabbey@ganymeta.org", "creation_time": "2004-10-28T20:03:39Z", "text": "Oh, then this is probably INVALID, then?  Or at best, a documentation issue?\n\nIt's quite surprising to have Ant produce a jar file that produces undefined\nbehavior across JVMs, but that's arguably a JVM issue?"}, {"count": 14, "tags": [], "bug_id": 30339, "text": "Yep.  Not a bug.", "id": 66534, "time": "2004-11-05T15:54:05Z", "creator": "bodewig@apache.org", "creation_time": "2004-11-05T15:54:05Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "bug_id": 30339, "text": "So, why is the default behavior to accept duplicate copies of a file into the\njar file, given that this can cause unpredictable problems in some deployment\ncontexts, then?", "id": 66555, "time": "2004-11-05T20:02:56Z", "creator": "jonabbey@ganymeta.org", "creation_time": "2004-11-05T20:02:56Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 30339, "attachment_id": null, "text": "Often the answer to this type of question is backwards-compatibility.", "id": 66556, "time": "2004-11-05T21:07:29Z", "creator": "mbenson@apache.org", "creation_time": "2004-11-05T21:07:29Z", "is_private": false}, {"count": 17, "tags": [], "text": "Yes, its backwards compatibility.\n\nEarlier versions of the tasks offered no control and allowed multiple copies, so\nwe had to make it the default behavior when we introduced the duplicate attribute.", "is_private": false, "id": 66782, "creator": "bodewig@apache.org", "time": "2004-11-12T09:30:16Z", "bug_id": 30339, "creation_time": "2004-11-12T09:30:16Z", "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 30339, "text": "(In reply to comment #17)\n> Yes, its backwards compatibility.\n> \n> Earlier versions of the tasks offered no control and allowed multiple copies, so\n> we had to make it the default behavior when we introduced the duplicate attribute.\n\nSurely something should be said in the documentation, then.", "id": 66958, "time": "2004-11-15T21:51:17Z", "creator": "jonabbey@ganymeta.org", "creation_time": "2004-11-15T21:51:17Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "bug_id": 30339, "attachment_id": null, "id": 66968, "time": "2004-11-15T22:34:57Z", "creator": "mbenson@apache.org", "creation_time": "2004-11-15T22:34:57Z", "is_private": false, "text": "And it is... the default value of <jar>'s duplicate attribute is documented in \nthe Ant manual as \"add\"."}, {"count": 20, "tags": [], "bug_id": 30339, "text": "Surely.  But it would be appropriate to document that the default setting\n(\"add\") can generate Jar files that will mysteriously fail to work in certain\ndeployments if duplicate files are actually included in the Jar file.\n\nSuch a documentation note would have saved me months of confusion and misery.", "id": 67366, "time": "2004-11-22T23:25:29Z", "creator": "jonabbey@ganymeta.org", "creation_time": "2004-11-22T23:25:29Z", "is_private": false, "attachment_id": null}, {"count": 21, "tags": [], "bug_id": 30339, "attachment_id": null, "id": 67367, "time": "2004-11-22T23:58:15Z", "creator": "mbenson@apache.org", "creation_time": "2004-11-22T23:58:15Z", "is_private": false, "text": "Added warnings for <zip>, <jar>, <war> and <ear> in CVS.\n\nThanks,\nMatt"}, {"count": 22, "tags": [], "bug_id": 30339, "attachment_id": null, "text": "Concur, that should take care of things.\n\nThanks!", "id": 67377, "time": "2004-11-23T05:47:26Z", "creator": "jonabbey@ganymeta.org", "creation_time": "2004-11-23T05:47:26Z", "is_private": false}, {"count": 23, "tags": [], "bug_id": 30339, "text": "*** Bug 33049 has been marked as a duplicate of this bug. ***", "id": 69556, "time": "2005-01-11T21:51:16Z", "creator": "jkf@apache.org", "creation_time": "2005-01-11T21:51:16Z", "is_private": false, "attachment_id": null}]
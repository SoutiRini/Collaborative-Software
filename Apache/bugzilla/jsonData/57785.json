[{"count": 0, "tags": [], "bug_id": 57785, "attachment_id": null, "id": 182216, "time": "2015-04-01T15:11:45Z", "creator": "nick@webthing.com", "creation_time": "2015-04-01T15:11:45Z", "is_private": false, "text": "The non-standard REDIRECT_URL environment variable is introduced in UTIL_SCRIPT in r1053363 .  Although the commit message is not clear, it appears to be intended to serve as a \"return to\" URL when the server executes an internal redirect.\n\nTo serve correctly as such, it must return a full URL.  Instead, it simply returns r->prev->uri, which is likely to be a relative URL, and may resolve incorrectly in an application.\n\nThe example we recently encountered was using mod_auth_form, where we needed to patch util_script to generate a variable we could use with SSI in\n<input type=\"hidden\" name=\"httpd_location_old\" value=\"<!--#echo var=\"REDIRECT_URL\"-->\">.\n\nI propose to tidy my patch and apply in trunk.  I'll also check whether pr53772 might be low-hanging fruit for this patch."}, {"count": 1, "tags": [], "bug_id": 57785, "attachment_id": null, "text": "Backported to v2.4.17.", "id": 185502, "time": "2015-09-26T23:40:55Z", "creator": "minfrin@sharp.fm", "creation_time": "2015-09-26T23:40:55Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 57785, "is_private": false, "id": 185795, "time": "2015-10-19T15:08:38Z", "creator": "apache-b6e@deemzed.uk", "creation_time": "2015-10-19T15:08:38Z", "tags": [], "text": "This patch appears to break the prexisting PHP behaviour (all versions, verified as far back as PHP 5.2). When cgi.fix_pathinfo=1, PHP will under some conditions set SCRIPT_NAME directly from REDIRECT_URL (noticed running under FastCGI).\n\nI'm not going to argue correct behaviour, only point out that the existing behaviour that was relied by another project has been broken by this change."}, {"count": 3, "tags": [], "bug_id": 57785, "attachment_id": null, "id": 185808, "time": "2015-10-20T09:44:29Z", "creator": "nick@webthing.com", "creation_time": "2015-10-20T09:44:29Z", "is_private": false, "text": "Dave, thanks for the heads-up.  I had hoped in vain that a spell in trunk would pick up any such issues.  REDIRECT_URL is a total misnomer for the PHP usage you describe, but I guess there's a lot of history in HTTPD and PHP patching API features.\n\nWhat do you think is the best fix now?\n 1) Leave it to PHP?\n 2) Introduce yet another env var?\n 3) Introduce a flag to switch between the two?\n 4) Other (please specify?)"}, {"count": 4, "attachment_id": null, "bug_id": 57785, "text": "Heh - don't ask me, I'm not affiliated with either project! \n\nFrom my perspective we worked around the problem by backing out this patch on our 2.4.17 build, but we've been experiencing other issues with 2.4.17 that means we've reverted to 2.4.16 for now while I try to track them down.\n\nObviously the correct behaviour is always preferred, but someone probably needs to give PHP the heads up to sort out their SCRIPT_NAME handling.", "id": 185810, "time": "2015-10-20T11:00:56Z", "creator": "apache-b6e@deemzed.uk", "creation_time": "2015-10-20T11:00:56Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 57785, "attachment_id": null, "id": 185862, "time": "2015-10-23T04:49:47Z", "creator": "scott@qth.com", "creation_time": "2015-10-23T04:49:47Z", "is_private": false, "text": "As a web hosting provider with customers affected by this change, my vote would be to offer some type of option to allow switching between the two, preferably something in .htaccess that is easily managed by the end-customer on a per-directory basis.\n\n- Scott"}, {"count": 6, "tags": [], "creator": "marcelo@marcelopedra.com.ar", "text": "I second Scott Neader. Please review what changes you have introduced in Apache 2.4.17 because 2.4.16 worked without problems.\n\nSince 2.4.17 we are seeing all kind of issues in websites using mod_rewrite. Mainly, CMS systems in general trying to use pretty permalinks, and specifically WordPress sites using cache plugins are currently unable to correctly rebuild their cache dirs.\n\nAnd since we use cPanel, we are stuck with 2.4.17 with no possibility to roll back to 2.4.16.\n\nIdeas are welcome. Also a bugfix (ASAP please).", "id": 185895, "time": "2015-10-23T14:54:23Z", "bug_id": 57785, "creation_time": "2015-10-23T14:54:23Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 57785, "attachment_id": null, "text": "Here at cPanel we are reverting our 2.4.17 release and are going to re-release 2.4.16. Too many issues with mod_rewrite/REDIRECT_URL causing a *lot* of applications to stop working.", "id": 185903, "time": "2015-10-23T16:55:46Z", "creator": "jacob.perkins@cpanel.net", "creation_time": "2015-10-23T16:55:46Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 57785, "attachment_id": null, "text": "I can confirm that after downgrading to 2.4.16, WordPress and other CMS went back to normal functioning.\n\nI work with WordPress, Joomla and Magento across different server/PHP configurations, and the fixing factor was the downgrade to Apache 2.4.16.\n\nHopefully, this bug may not happen again as it difficulted operations to hundreds of sites.\n\nThanks!", "id": 186033, "time": "2015-10-27T22:14:55Z", "creator": "marcelo@marcelopedra.com.ar", "creation_time": "2015-10-27T22:14:55Z", "is_private": false}, {"count": 9, "tags": [], "creator": "nathanjosiah@gmail.com", "attachment_id": null, "id": 186229, "time": "2015-11-03T23:39:24Z", "bug_id": 57785, "creation_time": "2015-11-03T23:39:24Z", "is_private": false, "text": "I can confirm that this change broke several sites that I manage without me knowing due to automatic updates. Please fix this ASAP!"}, {"count": 10, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "id": 186230, "time": "2015-11-04T00:28:45Z", "bug_id": 57785, "creation_time": "2015-11-04T00:28:45Z", "is_private": false, "text": "The next 2.4 release will revert back to the old behavior by default."}, {"count": 11, "tags": [], "bug_id": 57785, "attachment_id": null, "text": "I believe this patch in 2.4.x branch restores previous behavior https://github.com/apache/httpd/commit/7feb3c0999927f9d0d16f37c7bed13b58c09162f", "id": 186368, "time": "2015-11-12T04:50:39Z", "creator": "anatol.pomozov@gmail.com", "creation_time": "2015-11-12T04:50:39Z", "is_private": false}]
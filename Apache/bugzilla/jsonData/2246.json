[{"count": 0, "tags": [], "text": "I used HTMLLayout and I saw that Throwables' stacktrace does not appear indented (as you could see in a printStackTrace() with no parameters). I tried to change the following piece of code in escapeHTMLTags:\n\n    for(int i=0; i < input.length(); i++) {\n        ch = input.charAt(i);\n        if(ch == '<') {\n            buf.append(\"&lt;\");\n        }else if(ch == '>') {\n            buf.append(\"&gt;\");\n        }else {\n            buf.append(ch);\n        }\n    }\n\n\nby this one:\n\n    for(int i=0; i < input.length(); i++) {\n        ch = input.charAt(i);\n        if(ch == '<') {\n            buf.append(\"&lt;\");\n        }else if(ch == '>') {\n            buf.append(\"&gt;\");\n        }else if(ch == '\\t') {          //new line\n            buf.append(TRACE_PREFIX);   //new line\n        }else {\n            buf.append(ch);\n        }\n    }\n\nand it worked fine. Furthermore you should think about adding a new line supporting '\\n' and replacing it by <br> to see it in the HTML result.\nFinally, I've seen that you're looking for efficiency using StringBuffer concatenation instead of String concatenation, so you should also change this lines:\n        for(int i=0; i < input.length(); i++) {\n\nby this new ones:\n        int strLength = input.length();\n        for(int i=0; i < strLength; i++) {\n\nand you will only make 1 call to input.length(), instead of making (input.length()-1) calls.\n\nI hope it helps and please forget me if my english is too bad...\n\nRegards\nHoraci Macias", "attachment_id": null, "id": 3115, "creator": "hmacias@mail.fujitsu.es", "time": "2001-06-20T05:18:08Z", "bug_id": 2246, "creation_time": "2001-06-20T05:18:08Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bugzilla@apache.org", "is_private": false, "text": "\nHello,\n\nThis bug report is on log4j 1.1beta. Have you tried a final version like log4j \nversion 1.1.3? \n\nI have taken note of the \n\n        int strLength = input.length();\n        for(int i=0; i < strLength; i++) {\n\noptimization. Thank you. Ceki", "id": 3117, "time": "2001-06-20T05:33:14Z", "bug_id": 2246, "creation_time": "2001-06-20T05:33:14Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "hmacias@mail.fujitsu.es", "attachment_id": null, "text": "Hello,\n\nI've tried with final version 1.1.3 and I got the same results. I selected Version 1.1beta in bug database form because version 1.3 does not appear in that form. (maybe another bug? ;D).\n\nThe solution I told you also works on 1.1.3\n\nRegards,\n\nHoraci Macias", "id": 3144, "time": "2001-06-21T04:30:56Z", "bug_id": 2246, "creation_time": "2001-06-21T04:30:56Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 2246, "attachment_id": null, "id": 3159, "time": "2001-06-21T07:53:15Z", "creator": "bugzilla@apache.org", "creation_time": "2001-06-21T07:53:15Z", "is_private": false, "text": "\nI don't see what the problem is. Can you cut-and-paste and show me what's \nwrong? Thank you."}, {"count": 4, "tags": [], "text": "The problem is that if you use HTMLLayout and you want to log Throwables you'll see the stackTrace without indentation, like this:\n\njava.lang.NullPointerException java.lang.Throwable() java.lang.Exception() java.lang.RuntimeException() java.lang.NullPointerException() evaluated code\tevaluated code\n\ninstead of this:\n\njava.lang.NullPointerException\n\tjava.lang.Throwable()\n\tjava.lang.Exception()\n\tjava.lang.RuntimeException()\n\tjava.lang.NullPointerException()\n\tevaluated code\n\tevaluated code\n\nbecause new lines and tabs in HTML are ignored, you have to use <br> or &nbsp; to indent.\nIf you try this piece of code:\n//BEGIN CODE\norg.apache.log4j.Category aCat = org.apache.log4j.Category.getInstance(\"Testing\");\norg.apache.log4j.HTMLLayout layout = new org.apache.log4j.HTMLLayout();\norg.apache.log4j.WriterAppender ap = new org.apache.log4j.WriterAppender(layout, System.out);\naCat.addAppender(ap);\ntry{\n    String a = null;\n    a.equals(\"\");\t//will throw NullPointerException\n}catch(Exception t){\n    aCat.fatal(\"Errors ocurred\", t);\n}\n//END CODE\n\nyou'll see on System.out an HTML like this one: (paste it on a browser)\n<!-- BEGIN HTML using HTMLLayout -->\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html>\n<head>\n<title>Log4J Log Messages</title>\n<style type=\"text/css\">\n<!--\nbody, table {font-family: arial,sans-serif; font-size: x-small;}\nth {background: #336699; color: #FFFFFF; text-align: left;}\n-->\n</style>\n</head>\n<body bgcolor=\"#FFFFFF\" topmargin=\"6\" leftmargin=\"6\">\n<hr size=\"1\" noshade>\nLog session start time Fri Jun 22 08:23:16 CEST 2001<br>\n<br>\n<table cellspacing=\"0\" cellpadding=\"4\" border=\"1\" bordercolor=\"#224466\" width=\"100%\">\n<tr>\n<th>Time</th>\n<th>Thread</th>\n<th>Priority</th>\n<th>Category</th>\n<th>Message</th>\n</tr>\n\n<tr>\n<td>80</td>\n<td title=\"main thread\">main</td>\n<td title=\"Priority\"><font color=\"#993300\"><strong>FATAL</strong></font></td>\n<td title=\"Testing category\">Testing</td>\n<td title=\"Message\">Errors ocurred</td>\n</tr>\n<tr><td bgcolor=\"#993300\" style=\"color:White; font-size : xx-small;\" colspan=\"6\">java.lang.NullPointerException\n<br>&nbsp;&nbsp;&nbsp;&nbsp;\tjava.lang.Throwable()\n\tjava.lang.Exception()\n\tjava.lang.RuntimeException()\n\tjava.lang.NullPointerException()\n\tevaluated code\n\tevaluated code\n\n</td></tr>\n</table>\n<br>\n</body></html>\n<!-- END HTML using HTMLLayout-->\n\nI think it would be more usefull to see stacktraces indented, like this HTML:\n<!-- BEGIN HTML using Modified HTMLLayout -->\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html>\n<head>\n<title>Log4J Log Messages</title>\n<style type=\"text/css\">\n<!--\nbody, table {font-family: arial,sans-serif; font-size: x-small;}\nth {background: #336699; color: #FFFFFF; text-align: left;}\n-->\n</style>\n</head>\n<body bgcolor=\"#FFFFFF\" topmargin=\"6\" leftmargin=\"6\">\n<hr size=\"1\" noshade>\nLog session start time Fri Jun 22 08:26:02 CEST 2001<br>\n<br>\n<table cellspacing=\"0\" cellpadding=\"4\" border=\"1\" bordercolor=\"#224466\" width=\"100%\">\n<tr>\n<th>Time</th>\n<th>Thread</th>\n<th>Priority</th>\n<th>Category</th>\n<th>Message</th>\n</tr>\n\n<tr>\n<td>70</td>\n<td title=\"main thread\">main</td>\n<td title=\"Priority\"><font color=\"#993300\"><strong>FATAL</strong></font></td>\n<td title=\"Testing category\">Testing</td>\n<td title=\"Message\">Errors ocurred</td>\n</tr>\n<tr><td bgcolor=\"#993300\" style=\"color:White; font-size : xx-small;\" colspan=\"6\">java.lang.NullPointerException\n<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;java.lang.Throwable()\n<br>&nbsp;&nbsp;&nbsp;&nbsp;java.lang.Exception()\n<br>&nbsp;&nbsp;&nbsp;&nbsp;java.lang.RuntimeException()\n<br>&nbsp;&nbsp;&nbsp;&nbsp;java.lang.NullPointerException()\n<br>&nbsp;&nbsp;&nbsp;&nbsp;evaluated code\n<br>&nbsp;&nbsp;&nbsp;&nbsp;evaluated code\n\n</td></tr>\n</table>\n<br>\n</body></html>\n<!-- END HTML using Modified HTMLLayout -->\n\nif you try the code or if you look these HTML pages on a browser you'll see the difference. (I've tried it on Internet Explorer 5.0 and Opera 5.11)", "is_private": false, "id": 3179, "creator": "hmacias@mail.fujitsu.es", "time": "2001-06-21T23:26:23Z", "bug_id": 2246, "creation_time": "2001-06-21T23:26:23Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 2246, "attachment_id": null, "id": 15826, "time": "2002-05-09T17:52:27Z", "creator": "ceki@apache.org", "creation_time": "2002-05-09T17:52:27Z", "is_private": false, "text": "\nLog4j 1.2rc1 incorporates the change you mentioned."}]
[{"count": 0, "tags": [], "creator": "rick@wisefam.com", "text": "I'm building a spreadsheet and adding a formula to a cell.\n\nIf I do: new_desc_cell.setCellFormula(\"IF(ISERROR(VLOOKUP(A5,Desc!$a$4:$c$60,2,false)),\\\"\\\",VLOOKUP(A5,Desc!$a$4:$c$60,2,false))\");\nit works.\n\nIf I do: new_desc_cell.setCellFormula(\"IFERROR(VLOOKUP(A5,Desc!$a$4:$c$60,2,false),\\\"\\\")\");\nit appears to work, but when I open the spreadsheet in Excel 2010, I get a #NAME? error.  If I do a global replace of \"IFERROR\" with \"IFERROR\" (same text), the problem goes away.\n\nI can use the first as a workaround, of course.", "id": 175087, "time": "2014-05-07T18:43:16Z", "bug_id": 56499, "creation_time": "2014-05-07T18:43:16Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 56499, "is_private": false, "count": 1, "id": 175155, "time": "2014-05-12T09:56:18Z", "creator": "apache@gagravarr.org", "creation_time": "2014-05-12T09:56:18Z", "text": "Are you re-evaluating the formula in POI before you write the file out?"}, {"count": 2, "tags": [], "creator": "rick@wisefam.com", "is_private": false, "text": "\nI have the following code:\n\n\n  Cell\tnew_desc_cell = row.createCell(desc_col, Cell.CELL_TYPE_FORMULA);\n\n  String\tdesc_lookup = \"VLOOKUP(\" + colnumToName(key_col) +\n    (row.getRowNum() + 1) + \",Desc!$a$2:$c$\"+ desc_row_count + \",2,false)\";\n\n  new_desc_cell.setCellFormula(\"IF(ISERROR(\" + desc_lookup + \"),\\\"\\\",\"\n    + desc_lookup + \")\");\n\nThe formula is at least parsing, because it throws an error if the formula has an error.  I'm not explicitly evaluating the formula.  As you can see, I worked around the problem by using IF(ISERROR()) in place of IFERROR().", "id": 175160, "time": "2014-05-12T12:53:13Z", "bug_id": 56499, "creation_time": "2014-05-12T12:53:13Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "A few things to try:\n * Write the iferror formula, save, load, see if POI sees the formula string correctly\n * Evaluate, see it it works\n * Evaluate, save, see if Excel is then happy", "is_private": false, "bug_id": 56499, "id": 175161, "time": "2014-05-12T13:14:55Z", "creator": "apache@gagravarr.org", "creation_time": "2014-05-12T13:14:55Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "rick@wisefam.com", "text": "\n1. Wrote the formula, reloaded it.  Got back:\n\nFormula: IFERROR(VLOOKUP(A6,Desc!$A$2:$C$42,2,FALSE),\"\")\nValue: Use default names - New list of Store names provided in operations\n\nThe values are correct.\n\n2. Evaluated before write.  Got an evaluator: \nFormulaEvaluator\tevaluator = row.getSheet().getWorkbook().getCreationHelper().createFormulaEvaluator();\n\nAfter setting cell formula, called evaluator.evaluate() for each cell.\n\nNo change to behavior.\n\n3. After the evaluation (in step 2), wrote the spreadsheet, no change to behavior.", "id": 175169, "time": "2014-05-12T16:54:34Z", "bug_id": 56499, "creation_time": "2014-05-12T16:54:34Z", "is_private": false, "attachment_id": null}, {"attachment_id": 31610, "tags": [], "bug_id": 56499, "is_private": false, "count": 5, "id": 175171, "time": "2014-05-12T17:22:30Z", "creator": "rick@wisefam.com", "creation_time": "2014-05-12T17:22:30Z", "text": "Created attachment 31610\nResulting spreadsheet"}, {"count": 6, "attachment_id": 31611, "bug_id": 56499, "text": "Created attachment 31611\nExample code", "id": 175172, "time": "2014-05-12T17:23:23Z", "creator": "rick@wisefam.com", "creation_time": "2014-05-12T17:23:23Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "rick@wisefam.com", "is_private": false, "text": "\nIncluded code that demonstrates the problem.  Running it will create an Excel workbook.  If you open it in Excel, formula in A3 is fine, but formula in A2 is broken.  If you edit the cell, and replace a couple of characters with the same characters, the cell works.", "id": 175173, "time": "2014-05-12T17:25:22Z", "bug_id": 56499, "creation_time": "2014-05-12T17:25:22Z", "attachment_id": null}, {"count": 8, "attachment_id": null, "bug_id": 56499, "text": "Some analysis:\n* IFERROR is not part of the default set of Excel functions, but is marked as \"external\" in the parsed formula:\n    Ptg[7]=org.apache.poi.ss.formula.ptg.FuncVarPtg [#external# nArgs=3]V\n\n* The externalname is added by POI as follows:\n[EXTERNALNAME]\n    .options      = 0\n    .ix      = 0\n    .name    = IFERROR\norg.apache.poi.ss.formula.ptg.ErrPtg [#REF!].\n[/EXTERNALNAME]\n\n* When the file is edited and saved in Excel it is saved as follows:\n[NAME]\n    .option flags           = 0x038B\n    .keyboard shortcut      = 0x00\n    .length of the name     = 13\n    .extSheetIx(1-based, 0=Global)= 0\n    .sheetTabIx             = 0\n    .Menu text length       = 0\n    .Description text length= 0\n    .Help topic text length = 0\n    .Status bar text length = 0\n    .NameIsMultibyte        = false\n    .Name (Unicode text)    = _xlfn.IFERROR\n    .Formula (nTokens=1):\n       org.apache.poi.ss.formula.ptg.ErrPtg [#NAME?].\n    .Menu text       = \n    .Description text= \n    .Help topic text = \n    .Status bar text = \n[/NAME]\n\n* The external name is currently built in InternalWorkbook.getNameXPtg()", "id": 188454, "time": "2016-02-15T20:46:32Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-02-15T20:46:32Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "bug_id": 56499, "attachment_id": 33560, "is_private": false, "id": 188455, "time": "2016-02-15T20:53:43Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-02-15T20:53:43Z", "text": "Created attachment 33560\nTestcase to produce the incorrect file"}]
[{"count": 0, "tags": [], "bug_id": 48304, "attachment_id": null, "is_private": false, "id": 132467, "time": "2009-11-30T13:14:02Z", "creator": "ms419@freezone.co.uk", "creation_time": "2009-11-30T13:14:02Z", "text": "http://thread.gmane.org/gmane.comp.apache.user/88179\n\nPutting just the following \"Rewrite\" directives in a .htaccess file breaks some rules from a .htaccess file in a parent directory,\n\n  RewriteEngine On\n  RewriteOptions inherit\n\nFor example, I have a file, .../foo.html, and a directory, .../foo. I put in .../.htaccess,\n\n  DirectorySlash Off\n  \n  RewriteEngine On\n  RewriteCond %{REQUEST_FILENAME}.html -f\n  RewriteRule . %{REQUEST_FILENAME}.html\n\nNow requests for http://example.com/.../foo happily respond with .../foo.html\n\n- but if I put in .../foo/.htaccess,\n\n  RewriteEngine On\n  RewriteOptions inherit\n\nNow requests for http://example.com/.../foo no longer respond with .../foo.html : (\n\nI think this is because any \"Rewrite\" directive in .../foo/.htaccess causes rules from .../.htaccess to not apply\n\n- however I don't think it's possible for any rule defined in .../foo/.htaccess to match the URL, http://example.com/.../foo\n\n  RewriteRule ^$ %{REQUEST_FILENAME}.html\n\n^ This rule, in .../foo/.htaccess, matches http://example.com/.../foo/, but not http://example.com/.../foo\n\nI wish that either,\n\n* \"Rewrite\" directives in .../foo/.htaccess would have no effect on the URL, http://example.com/.../foo - rules from .../.htaccess would still apply, or\n* it would be possible for a rule in .../foo/.htaccess to match http://example.com/.../foo\n\nI checked that this is still the case with trunk revision 883548"}, {"count": 1, "tags": [], "creator": "bobsiegen@googlemail.com", "attachment_id": null, "id": 132557, "creation_time": "2009-12-01T13:39:27Z", "time": "2009-12-01T13:39:27Z", "bug_id": 48304, "text": "(In reply to comment #0)\n> - but if I put in .../foo/.htaccess,\n> \n>   RewriteEngine On\n>   RewriteOptions inherit\n> \n> Now requests for http://example.com/.../foo no longer respond with .../foo.html\n\nCorrect. The config structure should be merged with foo/.htaccess for a request of foo (no trailing slash) but mod_rewrite won't run its fixup hook (per-dir runtime) in case the dir was not reached completely (=trailing slash is missing).\n\nThat is by design.", "is_private": false}, {"count": 2, "tags": [], "bug_id": 48304, "attachment_id": 27918, "is_private": false, "id": 151364, "time": "2011-11-10T12:36:40Z", "creator": "matthew.byng-maddick@bbc.co.uk", "creation_time": "2011-11-10T12:36:40Z", "text": "Created attachment 27918\nPatch to modules/mappers/mod_rewrite.c to allow override of the \"don't process .htaccess in the directory without a trailing slash\" behaviour\n\nThis behaviour really should be configurable by the use of a RewriteOptions option. In our case, the issue is actually that we're trying to use .htaccess to allow rewriting and proxying of an entire URL space (including the variant without the trailing slash), and while we can turn DirectorySlash Off in mod_dir, you cannot turn this behaviour off in mod_rewrite.\n\nThe \"by design\" includes the comment:\n    /*\n     *  .htaccess file is called before really entering the directory, i.e.:\n     *  URL: http://localhost/foo  and .htaccess is located in foo directory\n     *  Ignore such attempts, since they may lead to undefined behaviour.\n     */\n\nAnd as best I can tell, this \"undefined behaviour\" is mod_rewrite's RewriteRules kicking in before mod_dir does in the handling of the request without the trailing slash, and, while it's important that the default behaviour is this, it really should be possible to say \"no, I really want you to handle that\".\n\nI've attached a fairly trivial patch that allows this through the use of a \"RewriteOptions AllowNoSlash\" directive. We're probably going to patch this locally anyway, but it would be good to get it back into the upstream httpd distribution.\n\nCheers\n\nMBM"}, {"count": 3, "tags": [], "bug_id": 48304, "attachment_id": null, "is_private": false, "id": 151894, "time": "2011-12-01T12:47:23Z", "creator": "minfrin@sharp.fm", "creation_time": "2011-12-01T12:47:23Z", "text": "Applied to httpd-trunk and httpd-2.4.x."}]
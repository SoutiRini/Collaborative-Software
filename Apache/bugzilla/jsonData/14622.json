[{"count": 0, "tags": [], "bug_id": 14622, "text": "Here is a jsp which shows the issue:\n\n<%@ page import=\"java.security.Permission,\n                 org.acme.Hello\"%>\n\n<html>\n<body>\n<%\n        SecurityManager sm = System.getSecurityManager();\n        if (sm == null) {\n                System.setSecurityManager(new SecurityManager(){\n                    public void checkPermission(Permission perm) {}\n                    public void checkPermission(Permission perm, Object \ncontext) {}\n\n                });\n        }\n%>\nTo see the bug you'd cast to a class in the WebAppClassloader only: <%= \nObject.class.isAssignableFrom( Hello.class ) %>\n</body>\n</html>\n\nUpon running the code, Jasper finishes with the following stack trace:\n\njava.lang.NullPointerException\n\tat org.apache.jasper.servlet.JasperLoader.loadClass\n(JasperLoader.java:179)\n\tat org.apache.jasper.servlet.JasperLoader.loadClass\n(JasperLoader.java:131)\n\tat java.lang.ClassLoader.loadClassInternal(ClassLoader.java:310)\n\tat org.apache.jsp.index_jsp.class$(index_jsp.java:56)\n\tat org.apache.jsp.index_jsp._jspService(index_jsp.java:63)\n....snipped...", "id": 26423, "time": "2002-11-17T01:38:08Z", "creator": "jacek_laskowski@hp.com", "creation_time": "2002-11-17T01:38:08Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 14622, "is_private": false, "text": "This is not a bug.  The SecurityManager is global to the entire JVM Tomcat/Jasper\nis running in.  It is the responsibility of the container to set the\nSecurityManager.  This will not be changed.  Allowing a JSP page to set\nthe SecurityManager would be a huge security risk. To use the Tomcat 4\nSecurityManager start Tomcat with the -security option.", "id": 26442, "time": "2002-11-17T15:18:42Z", "creator": "glenn@apache.org", "creation_time": "2002-11-17T15:18:42Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "jacek_laskowski@hp.com", "attachment_id": null, "text": "The bug is not necessarily with who sets SM, but with the way Jasper checks\nwhether there's a SM installed or not. At first, it checks it via\nSystem.getSecurityManager(), and then it simply assumes securityManager is\nalready set, but that assumption is too weak.\n\nWhen Jasper loads a class after securityManager's initialization, and\nSystem.getSecurityManager() returns not-null value, the variable -\nsecurityManager is still null, but Jasper doesn't care about it - that's the bug.\n\nThe jsp is just example, and in fact would have been anything that sets SM.", "id": 26445, "time": "2002-11-17T19:52:44Z", "bug_id": 14622, "creation_time": "2002-11-17T19:52:44Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 14622, "attachment_id": null, "id": 26537, "time": "2002-11-19T01:54:00Z", "creator": "jfarcand@apache.org", "creation_time": "2002-11-19T01:54:00Z", "is_private": false, "text": "Again, trying to set the security manager from a JSP or a Servlet is illegal\n(and Tomcat will throws and exception) if you run Tomcat using -security.\n\nIf you don't start Tomcat using -security, all the security mechanism is broken\nand will not be initialized properly. IF you are seeing that problem using\n-security, then add more information...but if not, then please do not re-open\nthe bug.\n\n-- Jeanfrancois"}]
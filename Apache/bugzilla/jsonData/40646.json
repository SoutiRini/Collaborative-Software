[{"count": 0, "tags": [], "creator": "maxime@maxime.net.ru", "attachment_id": null, "id": 94285, "time": "2006-09-29T12:39:34Z", "bug_id": 40646, "creation_time": "2006-09-29T12:39:34Z", "is_private": false, "text": "When caching is enabled using mod_proxy, some clients are sending compressed\ncontent even if they do not ask (have no Accept-Encoding header) or when cached\ncopy is compressed using a method doesn't supported by client,"}, {"count": 1, "tags": [], "text": "Created attachment 18939\nfix for this bug\n\nproposed fix for this issue.", "is_private": false, "bug_id": 40646, "id": 94286, "time": "2006-09-29T12:44:50Z", "creator": "maxime@maxime.net.ru", "creation_time": "2006-09-29T12:44:50Z", "attachment_id": 18939}, {"count": 2, "tags": [], "text": "That doesn't look right to me.  The proxy cache should not be in the business of\nchecking accept-encoding unless the origin server asks it to.\n\nWhat should be happening here is that the origin server should be sending Vary:\naccept-encoding if it wants the proxy cache to check this field against the\nrequest.  I have no idea if the 1.3 cache properly handles Vary.  Modern\nversions of apache httpd (2.2) certainly do.\n\nIs the origin server in your tests sending Vary: accept-encoding?", "attachment_id": null, "bug_id": 40646, "id": 94288, "time": "2006-09-29T14:43:34Z", "creator": "slive@apache.org", "creation_time": "2006-09-29T14:43:34Z", "is_private": false}, {"count": 3, "tags": [], "creator": "maxime@maxime.net.ru", "attachment_id": null, "id": 94291, "time": "2006-09-29T16:02:34Z", "bug_id": 40646, "creation_time": "2006-09-29T16:02:34Z", "is_private": false, "text": "Let split this issue on two cases:\n1. Vary header in cached copy have vary: accept-encoding header and\nContent-encoding: gzip, while current serving reguest have only accept-encoding:\ncompress. In this case client will get cached request with wrong (unsupported)\ncontent-encoding.\n\n2. Yes, I see, if current request doesn't have accept-encoding header, it should\nnot get compressed content from the cache, but in fact it does get it\ncompressed. I have the following LogFormat defined:\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{User-Agent}i\\\"\n\\\"A-Encoding:%{Accept-Encoding}i\\\" \\\"C-Encoding:%{Content-Encoding}o\\\"\" combinedya\n\nand this led to the following log entry occuring time to time in the log:\n213.180.206.248 - - [29/Sep/2006:12:42:37 +0400] \"GET /robots.txt HTTP/1.1\" 200\n348 \"Yandex/1.01.001 (compatible; Win16; I)\" \"A-Encoding:-\" \"C-Encoding:gzip\"\n\nYandex team confirmed that it's robot got compressed content and has uproperly\nprocessed it due this issue."}, {"count": 4, "text": "The log entry doesn't prove anything.  As I said, the proxy cache is not\nresponsible for doing any content-negotiation -- it need only check for headers\nmentioned in the origin server's Vary response.  So there are not two cases;\nthere is only one: either the server honors the Vary header or it doesn't.\n\nYou seem to be claiming that the server doesn't honor the Vary header.  My quick\nreading of the code suggests that it should.  If it doesn't, then there is\nindeed a bug.\n\nWhat version are you running exactly?", "bug_id": 40646, "attachment_id": null, "id": 94296, "time": "2006-09-29T18:42:37Z", "creator": "slive@apache.org", "creation_time": "2006-09-29T18:42:37Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "creator": "maxime@maxime.net.ru", "text": "Origin server running Apache 2.0.55, while proxy running Apache 1.3.33\n\nThose headers origin server are sending for compressed content:\nHTTP/1.1 200 OK\nDate: Sat, 30 Sep 2006 07:42:18 GMT\nServer: Apache/2.0.55\nSet-Cookie: being=217.16.18.202.1159602138074850; path=/; expires=Wed, 24-Sep-31\n07:42:18 GMT\nLast-Modified: Wed, 20 Sep 2006 06:53:35 GMT\nETag: \"50ea0e-d31-10e0f9c0\"\nAccept-Ranges: bytes\nCache-Control: max-age=3600\nExpires: Sat, 30 Sep 2006 08:42:18 GMT\nVary: Accept-Encoding\nContent-Encoding: gzip\nContent-Length: 348\nConnection: close\nContent-Type: text/plain; charset=koi8-r\n", "id": 94301, "time": "2006-09-30T01:13:41Z", "bug_id": 40646, "creation_time": "2006-09-30T01:13:41Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "all proxy and cache work in 1.3 is ended; efforts are focused on 2.2", "is_private": false, "id": 106208, "creation_time": "2007-08-02T13:14:05Z", "time": "2007-08-02T13:14:05Z", "creator": "jim@apache.org", "bug_id": 40646, "attachment_id": null}]
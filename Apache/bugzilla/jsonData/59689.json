[{"count": 0, "tags": [], "bug_id": 59689, "attachment_id": null, "id": 191533, "time": "2016-06-10T17:11:35Z", "creator": "rckolli@hotmail.com", "creation_time": "2016-06-10T17:11:35Z", "is_private": false, "text": "Hi,\n  I need help with LDAP issue that's occurring after upgrading Apache to 2.4.20. I've upgraded Apache from 2.4.9 to 2.4.20 .Its giving 500 error after LDAP authentication. The same URL's works fine with 2.4.9.\n Below are the logs during startup of both versions.\n\n2.4.9:\n\n[ssl:info] [pid 15985:tid 139659251603200] AH01876: mod_ssl/2.4.9 compiled against Server: Apache/2.4.9, Library: OpenSSL/1.0.0\n[ldap:info] [pid 15988:tid 139659251603200] AH01318: APR LDAP: Built with OpenLDAP LDAP SDK\n[ldap:info] [pid 15988:tid 139659251603200] AH01319: LDAP: SSL support available\n\n2.4.20:\n\n[ssl:info] [pid 23260:tid 139901405628160] AH01876: mod_ssl/2.4.20 compiled against Server: Apache/2.4.20, Library: OpenSSL/1.0.1t\n[ldap:info] [pid 23265:tid 139901405628160] AH01320: LDAP: SSL support unavailable\n\nVersions:\nRed Hat Enterprise Linux Server release 6.7 (Santiago)\nphp-ldap-5.3.3-46.el6_7.1.x86_64\nopenldap-2.4.40-7.el6_7.x86_64\napr-util-ldap-1.3.9-3.el6_0.1.x86_64\n\n    Let me know if you need any more info.\nThx."}, {"count": 1, "tags": [], "bug_id": 59689, "attachment_id": null, "text": "You switched the openssl library from. 1.0.0 to 1.0.1t. Openldap is likely to be compiled against 1.0.0. This causes version conflicts. Ensure that all components of httpd and apr use the same openssl library.", "id": 191535, "time": "2016-06-10T18:36:33Z", "creator": "rpluem@apache.org", "creation_time": "2016-06-10T18:36:33Z", "is_private": false}, {"count": 2, "attachment_id": null, "creator": "rckolli@hotmail.com", "text": "(In reply to Ruediger Pluem from comment #1)\n> You switched the openssl library from. 1.0.0 to 1.0.1t. Openldap is likely\n> to be compiled against 1.0.0. This causes version conflicts. Ensure that all\n> components of httpd and apr use the same openssl library.\n\nHi Ruediger,\n    Thanks for response. Can you tell me how to check with what version it is compiled ?\nThanks.", "id": 191635, "time": "2016-06-14T13:20:57Z", "bug_id": 59689, "creation_time": "2016-06-14T13:20:57Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 59689, "attachment_id": null, "id": 191640, "creation_time": "2016-06-14T18:53:51Z", "time": "2016-06-14T18:53:51Z", "creator": "rpluem@apache.org", "text": "(In reply to rckolli from comment #2)\n> (In reply to Ruediger Pluem from comment #1)\n> > You switched the openssl library from. 1.0.0 to 1.0.1t. Openldap is likely\n> > to be compiled against 1.0.0. This causes version conflicts. Ensure that all\n> > components of httpd and apr use the same openssl library.\n> \n> Hi Ruediger,\n>     Thanks for response. Can you tell me how to check with what version it\n> is compiled ?\n> Thanks.\n\nTurns out that I was wrong and with RedHat 6 OpenLDAP is no longer compiled with openssl but with nss.\nNevertheless when comparing your 2.4.9 / 2.4.20 output I miss the line [ldap:info] [pid 15988:tid 139659251603200] AH01318: APR LDAP: Built with OpenLDAP LDAP SDK\nfrom the 2.4.9 output. Copy and paste error or really missing?", "is_private": false}, {"count": 4, "tags": [], "creator": "rckolli@hotmail.com", "attachment_id": null, "text": "Yes, its a miss on 2.4.20 during startup where I'm having issues. I do see that on 2.4.9 startup where LDAP works.\nThx.", "id": 191645, "time": "2016-06-14T21:05:38Z", "bug_id": 59689, "creation_time": "2016-06-14T21:05:38Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 59689, "attachment_id": null, "id": 191658, "time": "2016-06-15T07:56:49Z", "creator": "rpluem@apache.org", "creation_time": "2016-06-15T07:56:49Z", "is_private": false, "text": "(In reply to rckolli from comment #4)\n> Yes, its a miss on 2.4.20 during startup where I'm having issues. I do see\n> that on 2.4.9 startup where LDAP works.\n> Thx.\n\nIn this case I believe your APR-UTIL lacks the needed LDAP feature at all. I suppose that you do not use the RedHat provided apr-util, but your own which lacks these feature. Can you please do a\n\n./httpd -V"}, {"count": 6, "tags": [], "bug_id": 59689, "attachment_id": null, "id": 191680, "creation_time": "2016-06-15T14:13:09Z", "time": "2016-06-15T14:13:09Z", "creator": "rckolli@hotmail.com", "text": "Pasted the output for both versions.\n2.4.9:\n\nServer version: Apache/2.4.9 (Unix)\nServer built:   Oct 13 2014 13:00:03\nServer's Module Magic Number: 20120211:31\nServer loaded:  APR 1.5.1, APR-UTIL 1.5.3\nCompiled using: APR 1.5.1, APR-UTIL 1.5.3\nArchitecture:   64-bit\nServer MPM:     event\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=256\n -D HTTPD_ROOT=\"/apps/lsn/apache\"\n -D SUEXEC_BIN=\"/apps/lsn/apache/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"/opt/lsn/etc/apache/mime.types\"\n -D SERVER_CONFIG_FILE=\"/opt/lsn/etc/apache/httpd.conf\"\n\n\n2.4.20:\n\nServer version: Apache/2.4.20 (Unix)\nServer built:   Apr 13 2016 19:37:48\nServer's Module Magic Number: 20120211:57\nServer loaded:  APR 1.5.2, APR-UTIL 1.5.4\nCompiled using: APR 1.5.2, APR-UTIL 1.5.4\nArchitecture:   64-bit\nServer MPM:     worker\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=256\n -D HTTPD_ROOT=\"/apps/apache/2.4.20\"\n -D SUEXEC_BIN=\"/apps/apache/2.4.20/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"", "is_private": false}, {"count": 7, "tags": [], "bug_id": 59689, "attachment_id": null, "id": 191712, "time": "2016-06-16T09:32:26Z", "creator": "rpluem@apache.org", "creation_time": "2016-06-16T09:32:26Z", "is_private": false, "text": "You switched from APR-UTIL 1.5.3 to APR-UTIL 1.5.4 and I suppose that APR-UTIL 1.5.4 is not correctly setup with ldap.\n\nCan you please do:\n\n./bin/apu-1-config --ldap-libs\nldd lib/apr-util-1/apr_ldap-1.so\n\nfor your APR-UTIL 1.5.4 location and compare this to the results of your APR-UTIL-1.5.3."}, {"count": 8, "tags": [], "bug_id": 59689, "attachment_id": null, "text": "I do not see apu-1-config under 2.4.20 binaries and also apr-util-1 under lib folder. It seems 2.4.20 were compiled in a different way compare to 2.4.9.I see these files under $2.4.20/lib folder\n-rwxr-x--- 1 lsn lsn  376173 Apr 13 19:39 libldap.so\n-rwxr-x--- 1 lsn lsn  412912 Apr 13 19:39 libldap_r.so\n-rwxr-x--- 1 lsn lsn  412912 Apr 13 19:39 libldap_r-2.4.so.2.10.4\n-rwxr-x--- 1 lsn lsn  412912 Apr 13 19:39 libldap_r-2.4.so.2\n-rwxr-x--- 1 lsn lsn  376173 Apr 13 19:39 libldap-2.4.so.2.10.4\n-rwxr-x--- 1 lsn lsn  376173 Apr 13 19:39 libldap-2.4.so.2\n\n\n Is there a way I can check separately?", "id": 191719, "time": "2016-06-16T22:34:30Z", "creator": "rckolli@hotmail.com", "creation_time": "2016-06-16T22:34:30Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 59689, "attachment_id": null, "text": "(In reply to rckolli from comment #8)\n> I do not see apu-1-config under 2.4.20 binaries and also apr-util-1 under\n> lib folder. It seems 2.4.20 were compiled in a different way compare to\n> 2.4.9.I see these files under $2.4.20/lib folder\n> -rwxr-x--- 1 lsn lsn  376173 Apr 13 19:39 libldap.so\n> -rwxr-x--- 1 lsn lsn  412912 Apr 13 19:39 libldap_r.so\n> -rwxr-x--- 1 lsn lsn  412912 Apr 13 19:39 libldap_r-2.4.so.2.10.4\n> -rwxr-x--- 1 lsn lsn  412912 Apr 13 19:39 libldap_r-2.4.so.2\n> -rwxr-x--- 1 lsn lsn  376173 Apr 13 19:39 libldap-2.4.so.2.10.4\n> -rwxr-x--- 1 lsn lsn  376173 Apr 13 19:39 libldap-2.4.so.2\n> \n> \n>  Is there a way I can check separately?\n\nTry an\n\nldd ./httpd\n\non your 2.4.20 binary to see where the APR / APR-UTIL it uses can be found. The above seems to indicate that you compiled your own openldap with 2.4.20. I am getting more and more convinced that the reason behind your trouble is a mistake while building 2.4.20 and not a bug in httpd itself.", "id": 191739, "time": "2016-06-17T09:58:07Z", "creator": "rpluem@apache.org", "creation_time": "2016-06-17T09:58:07Z", "is_private": false}, {"count": 10, "tags": [], "creator": "rckolli@hotmail.com", "text": "That makes sense. For 2.4.20, it says not found for apr utils.\n\n2.4.9:\n        ldd /apps/lsn/apache_bkp_2.4.9/bin/httpd\n        linux-vdso.so.1 =>  (0x00007fff3e3cc000)\n        libpcre.so.0 => /lib64/libpcre.so.0 (0x0000003876000000)\n        libaprutil-1.so.0 => /apps/lsn/apache/lib/libaprutil-1.so.0 (0x00007fda49f89000)\n        libexpat.so.1 => /lib64/libexpat.so.1 (0x000000387b400000)\n        libapr-1.so.0 => /apps/lsn/apache/lib/libapr-1.so.0 (0x00007fda49d56000)\n        librt.so.1 => /lib64/librt.so.1 (0x0000003876800000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x000000387a800000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x0000003876400000)\n        libc.so.6 => /lib64/libc.so.6 (0x0000003875c00000)\n        /lib64/ld-linux-x86-64.so.2 (0x0000003875800000)\n        libfreebl3.so => /lib64/libfreebl3.so (0x000000387a400000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00007fda49b4f000)\n\n2.4.20:\n        ldd /apps/apache/current/bin/httpd\n        linux-vdso.so.1 =>  (0x00007ffdfd1ba000)\n        libpcre.so.1 => not found\n        libaprutil-1.so.0 => not found\n        libexpat.so.1 => /lib64/libexpat.so.1 (0x000000387b400000)\n        libapr-1.so.0 => not found\n        librt.so.1 => /lib64/librt.so.1 (0x0000003876800000)\n        libcrypt.so.1 => /lib64/libcrypt.so.1 (0x000000387a800000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x0000003876400000)\n        libc.so.6 => /lib64/libc.so.6 (0x0000003875c00000)\n        /lib64/ld-linux-x86-64.so.2 (0x0000003875800000)\n        libfreebl3.so => /lib64/libfreebl3.so (0x000000387a400000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x0000003876000000)", "id": 191752, "time": "2016-06-17T15:17:00Z", "bug_id": 59689, "creation_time": "2016-06-17T15:17:00Z", "is_private": false, "attachment_id": null}]
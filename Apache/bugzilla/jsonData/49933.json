[{"count": 0, "tags": [], "creator": "adamwilmer@yahoo.co.uk", "is_private": false, "text": "Created attachment 26027\nWord 95 document with a section\n\nProcessing a word 6/word 95 document with sections causes ArrayIndexOutOfBoundsException. Tika (Revision: 997224, 2010-09-14) with 3.7-beta2 POI dependency on the attached document gives rise to:\n\nException in thread \"main\" org.apache.tika.exception.TikaException: Unexpected RuntimeException from org.apache.tika.parser.microsoft.OfficeParser@1e7c5cb\n        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:165)\n        at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:146)\n        at org.apache.tika.cli.TikaCLI.process(TikaCLI.java:197)\n        at org.apache.tika.cli.TikaCLI.main(TikaCLI.java:71)\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 22\n        at org.apache.poi.util.LittleEndian.getShort(LittleEndian.java:46)\n        at org.apache.poi.hwpf.sprm.SprmOperation.<init>(SprmOperation.java:54)\n        at org.apache.poi.hwpf.sprm.SprmIterator.next(SprmIterator.java:45)\n        at org.apache.poi.hwpf.sprm.SectionSprmUncompressor.uncompressSEP(SectionSprmUncompressor.java:36)\n        at org.apache.poi.hwpf.model.SEPX.<init>(SEPX.java:33)\n        at org.apache.poi.hwpf.model.OldSectionTable.<init>(OldSectionTable.java:61)\n        at org.apache.poi.hwpf.HWPFOldDocument.<init>(HWPFOldDocument.java:103)\n        at org.apache.poi.hwpf.HWPFOldDocument.<init>(HWPFOldDocument.java:42)\n        at org.apache.tika.parser.microsoft.WordExtractor.parseWord6(WordExtractor.java:150)\n        at org.apache.tika.parser.microsoft.WordExtractor.parse(WordExtractor.java:51)\n        at org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:187)\n        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:163)", "id": 139879, "time": "2010-09-15T08:33:44Z", "bug_id": 49933, "creation_time": "2010-09-15T08:33:44Z", "attachment_id": 26027}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 139931, "creation_time": "2010-09-17T09:47:23Z", "time": "2010-09-17T09:47:23Z", "bug_id": 49933, "text": "That turned out to be slightly trickier than expected, as there were issues with both the Sprm decoding and the byte/character translation on the old section table\n\nFixed in r998131. The fix also seems to have improved some problem word97 files too, so it's not all bad!", "is_private": false}, {"count": 2, "tags": [], "bug_id": 49933, "attachment_id": null, "is_private": false, "id": 139940, "time": "2010-09-17T15:48:11Z", "creator": "ssmeets@ravn.co.uk", "creation_time": "2010-09-17T15:48:11Z", "text": "Hi Nick,\n\nThanks for your fix. This fixes several documents, but there are still some documents that produce ArrayIndexOutOfBoundsExceptions. Attached the files that cause the execpetions being thrown. Unfortunately my knowledge of old Word docs is limited, otherwise I could have helped.\n\nStacktraces:\nProcessing: Case1.doc\njava.lang.ArrayIndexOutOfBoundsException: 240\n\tat org.apache.poi.hwpf.sprm.SprmOperation.getOperand(SprmOperation.java:94)\n\tat org.apache.poi.hwpf.sprm.SectionSprmUncompressor.unCompressSEPOperation(SectionSprmUncompressor.java:57)\n\tat org.apache.poi.hwpf.sprm.SectionSprmUncompressor.uncompressSEP(SectionSprmUncompressor.java:37)\n\tat org.apache.poi.hwpf.model.SEPX.<init>(SEPX.java:33)\n\tat org.apache.poi.hwpf.model.OldSectionTable.<init>(OldSectionTable.java:61)\n\tat org.apache.poi.hwpf.HWPFOldDocument.<init>(HWPFOldDocument.java:103)\n\tat org.apache.poi.hwpf.HWPFOldDocument.<init>(HWPFOldDocument.java:42)\n\tat com.ravn.test.poi.OldMSDocTester.parse(OldMSDocTester.java:27)\n\tat com.ravn.test.Tester.main(Tester.java:29)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat com.intellij.rt.execution.application.AppMain.main(AppMain.java:115)\nProcessing: Case2.doc\njava.lang.ArrayIndexOutOfBoundsException: 244\nProcessing: Case3.doc\njava.lang.ArrayIndexOutOfBoundsException: 32\nProcessing: Case4.doc\njava.lang.ArrayIndexOutOfBoundsException: 26\nProcessing: Case5.doc\njava.lang.ArrayIndexOutOfBoundsException: 238\nProcessing: Case6.doc\njava.lang.ArrayIndexOutOfBoundsException: 247"}, {"count": 3, "tags": [], "text": "Created attachment 26046\nDocuments that throw an ArrayIndexOutOfBoundsException", "is_private": false, "id": 139941, "creator": "ssmeets@ravn.co.uk", "time": "2010-09-17T15:49:48Z", "bug_id": 49933, "creation_time": "2010-09-17T15:49:48Z", "attachment_id": 26046}, {"count": 4, "tags": [], "bug_id": 49933, "attachment_id": null, "id": 139952, "time": "2010-09-19T06:00:25Z", "creator": "apache@gagravarr.org", "creation_time": "2010-09-19T06:00:25Z", "is_private": false, "text": "I've added a slightly icky fix of adding a couple of spare 0 bytes on the end of the array, so that we should always be able to decode the SEPX without error, even if not always making sense of the contents fully...\n\nI can now process all 6 of your files without error"}, {"count": 5, "tags": [], "bug_id": 49933, "is_private": false, "id": 140216, "creation_time": "2010-09-27T09:12:25Z", "time": "2010-09-27T09:12:25Z", "creator": "max.valjanski@gmail.com", "text": "Last fix did broke another Word95 file:\n\njava.lang.ArrayIndexOutOfBoundsException: 34\n\tat org.apache.poi.hwpf.sprm.SprmOperation.getOperand(SprmOperation.java:94)\n\tat org.apache.poi.hwpf.sprm.SectionSprmUncompressor.unCompressSEPOperation(SectionSprmUncompressor.java:57)\n\tat org.apache.poi.hwpf.sprm.SectionSprmUncompressor.uncompressSEP(SectionSprmUncompressor.java:37)\n\tat org.apache.poi.hwpf.model.SEPX.<init>(SEPX.java:33)\n\tat org.apache.poi.hwpf.model.OldSectionTable.<init>(OldSectionTable.java:66)\n\tat org.apache.poi.hwpf.HWPFOldDocument.<init>(HWPFOldDocument.java:103)\n\tat org.apache.poi.hwpf.extractor.Word6Extractor.<init>(Word6Extractor.java:58)\n\tat org.apache.poi.hwpf.extractor.Word6Extractor.<init>(Word6Extractor.java:55)\n\tat org.apache.poi.hwpf.extractor.Word6Extractor.<init>(Word6Extractor.java:47)\n\tat org.apache.poi.hwpf.extractor.TestWordExtractor.testWord95err(TestWordExtractor.java:279)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat com.intellij.junit3.JUnit3IdeaTestRunner.doRun(JUnit3IdeaTestRunner.java:108)\n\tat com.intellij.junit3.JUnit3IdeaTestRunner.startRunnerWithArgs(JUnit3IdeaTestRunner.java:42)\n\tat com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:192)\n\tat com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:64)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat com.intellij.rt.execution.application.AppMain.main(AppMain.java:115)", "attachment_id": null}, {"count": 6, "tags": [], "creator": "max.valjanski@gmail.com", "attachment_id": 26083, "id": 140217, "creation_time": "2010-09-27T09:13:27Z", "time": "2010-09-27T09:13:27Z", "bug_id": 49933, "text": "Created attachment 26083\nword95 doc", "is_private": false}, {"count": 7, "tags": [], "creator": "vlsergey@gmail.com", "attachment_id": null, "id": 147850, "creation_time": "2011-07-09T15:38:33Z", "time": "2011-07-09T15:38:33Z", "bug_id": 49933, "text": "Workaround for this bug implemented in trunk. Now section properties won't be parsed immediatly on loading. Text is extracted (but encoding is not, sorry).\n\n\"Real\" fix shall include new Word95 SPRM parser (which is different from Word97-or-later SPRM parsed).", "is_private": false}]
[{"count": 0, "tags": [], "creator": "delen@tut.by", "text": "At first about the problem. If start Apache twice, it may happen that second instance will ignore the first one:\n\n> % sudo apachectl restart && sudo apachectl restart\n> httpd not running, trying to start\n> httpd not running, trying to start\n> % ps -ef | grep httpd | grep -v grep\n> root     28608     1  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28613 28608  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28614 28608  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28615 28608  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28616 28608  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> root     28617     1  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28699 28617  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28700 28617  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28701 28617  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28702 28617  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n\nAnd here are the problem, one of httpd groups becomes uncontrolled by the usual way:\n\n> % sudo apachectl stop\n> % sudo apachectl stop\n> httpd (no pid file) not running\n> % ps -ef | grep httpd | grep -v grep\n> root     28608     1  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28613 28608  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28614 28608  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28615 28608  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n> daemon   28616 28608  0 04:58 ?        00:00:00 /usr/local/apache2/bin/httpd -k restart\n\nSecond httpd instance overwrites pid file (from log: \"pid file /usr/local/apache2/logs/httpd.pid overwritten -- Unclean shutdown of previous Apache run?\") so there are no regular way to control first httpd instance.\n\nHow to reproduce. It seems httpd should be quite heavy to achieve this (with a lot of modules). Default way (configure && make && sudo make install) works ok, but for example using this way it reproduces for me on clean CentOS 7.1:\n\n> % configure --enable-modules=all --enable-mods-static=all\n> % make && sudo make install\n\nIssue might sitting there for a lot of time. In 2.2 it is similar with one conceptual difference:\n\n> % sudo apachectl restart && sudo apachectl restart\n> httpd not running, trying to start\n> httpd not running, trying to start\n> (98)Address already in use: make_sock: could not bind to address [::]:80\n> (98)Address already in use: make_sock: could not bind to address 0.0.0.0:80\n> no listening sockets available, shutting down\n> Unable to open logs\n\nThat inability to bind port saves from second httpd instance. But since 2.4.17 there is unconditionally used SO_REUSEPORT on listening socket (even if feature that it is intended for is not used), so binding of already bound port goes without errors.", "id": 191330, "time": "2016-05-31T09:40:29Z", "bug_id": 59644, "creation_time": "2016-05-31T09:40:29Z", "is_private": false, "attachment_id": null}]
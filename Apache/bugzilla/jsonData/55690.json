[{"count": 0, "tags": [], "bug_id": 55690, "text": "configure.in contains broken check of Linux kernel version:\n\ncase $host in\n...\n    *linux*)\n        os_version=`uname -r | sed -e 's/\\(.\\)\\.\\(.\\)\\.\\(.\\).*/\\1\\2\\3/'`\n        ;;\n\n\nIt fails with all kernels >=3.10.0.\nIt also treats e.g. 2.6.3 and 2.6.32 as the same version.\n\n./configure prints:\n\n...\nchecking for create_area... no\nchecking for MAP_ANON in sys/mman.h... yes\nchecking for /dev/zero... yes\nchecking for mmap that can map /dev/zero... yes\n./configure: line 21360: test: 3.10.17-gentoo: integer expression expected\ndecision on anonymous shared memory allocation method... 4.4BSD-style mmap() via MAP_ANON\n./configure: line 21672: test: 3.10.17-gentoo: integer expression expected\ndecision on namebased memory allocation method... SysV IPC shmget()\nchecking for size_t... yes\nchecking for working alloca.h... yes\nchecking for alloca... yes\n...", "id": 170753, "time": "2013-10-22T16:44:29Z", "creator": "Arfrever.FTA@GMail.Com", "creation_time": "2013-10-22T16:44:29Z", "is_private": false, "attachment_id": null}, {"count": 1, "text": "I just noticed this yesterday for the first time... 3.11.x kernel is breaking it.\n\nFixed in r1535027\n\nIf you're able to test that on a 2.6 or pre-2.4 Linux I'd appreciate that.", "bug_id": 55690, "is_private": false, "id": 170767, "time": "2013-10-23T13:34:21Z", "creator": "jorton@redhat.com", "creation_time": "2013-10-23T13:34:21Z", "tags": [], "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 55690, "is_private": false, "id": 170769, "time": "2013-10-23T15:37:57Z", "creator": "Arfrever.FTA@GMail.Com", "creation_time": "2013-10-23T15:37:57Z", "tags": [], "text": "(I do not use old kernels anymore.)\n\nYour solution does not work for 4.0.* versions. If also fails when the last \".0\" is skipped.\nI have tested your solution in shell by defining uname() function.\n\n$ uname() { echo 3.11.6; }\n$ os_major=`uname -r | sed -e 's/\\([1-9][0-9]*\\)\\..*/\\1/'`\n$ os_minor=`uname -r | sed -e 's/[1-9][0-9]*\\.\\([1-9][0-9]*\\)\\..*/\\1/'`\n$ declare -p os_major os_minor\ndeclare -- os_major=\"3\"\ndeclare -- os_minor=\"11\"\n$ uname() { echo 4.0.1; }\n$ os_major=`uname -r | sed -e 's/\\([1-9][0-9]*\\)\\..*/\\1/'`\n$ os_minor=`uname -r | sed -e 's/[1-9][0-9]*\\.\\([1-9][0-9]*\\)\\..*/\\1/'`\n$ declare -p os_major os_minor\ndeclare -- os_major=\"4\"\ndeclare -- os_minor=\"4.0.1\"\n$ uname() { echo 3.12; }\n$ os_major=`uname -r | sed -e 's/\\([1-9][0-9]*\\)\\..*/\\1/'`\n$ os_minor=`uname -r | sed -e 's/[1-9][0-9]*\\.\\([1-9][0-9]*\\)\\..*/\\1/'`\n$ declare -p os_major os_minor\ndeclare -- os_major=\"3\"\ndeclare -- os_minor=\"3.12\""}, {"count": 3, "attachment_id": null, "bug_id": 55690, "is_private": false, "id": 170771, "time": "2013-10-23T15:42:53Z", "creator": "Arfrever.FTA@GMail.Com", "creation_time": "2013-10-23T15:42:53Z", "tags": [], "text": "(In reply to Arfrever Frehtes Taifersar Arahesis from comment #2)\n> Your solution does not work for 4.0.* versions.\n\nOr just 3.0.*."}, {"count": 4, "tags": [], "bug_id": 55690, "text": "Thanks - r1535157 - anything still broken?", "id": 170783, "time": "2013-10-23T20:23:20Z", "creator": "jorton@redhat.com", "creation_time": "2013-10-23T20:23:20Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "Oh, and Linux has always used x.y.z-style versioning AFAIK so I'm not worried about failing if .z is missing.", "is_private": false, "id": 170784, "creator": "jorton@redhat.com", "time": "2013-10-23T20:26:57Z", "bug_id": 55690, "creation_time": "2013-10-23T20:26:57Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 55690, "text": "(In reply to Joe Orton from comment #5)\n> Oh, and Linux has always used x.y.z-style versioning AFAIK so I'm not\n> worried about failing if .z is missing.\n\nThe last .0 is skipped at least in names of tarballs.\nhttps://www.kernel.org/pub/linux/kernel/v3.x/", "id": 170786, "time": "2013-10-23T20:38:00Z", "creator": "Arfrever.FTA@GMail.Com", "creation_time": "2013-10-23T20:38:00Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 55690, "attachment_id": null, "is_private": false, "id": 170788, "time": "2013-10-23T21:22:42Z", "creator": "Arfrever.FTA@GMail.Com", "creation_time": "2013-10-23T21:22:42Z", "text": "(In reply to Joe Orton from comment #4)\n> Thanks - r1535157 - anything still broken?\n\nIt does not fix os_minor. You need to escape + character:\n\n$ uname() { echo 3.0.5; }\n$ os_major=`uname -r | sed -e 's/\\([1-9][0-9]*\\)\\..*/\\1/'`\n$ os_minor=`uname -r | sed -e 's/[1-9][0-9]*\\.\\([0-9]+\\)\\..*/\\1/'`\n$ declare -p os_major os_minor\ndeclare -- os_major=\"3\"\ndeclare -- os_minor=\"3.0.5\"\n$ os_minor=`uname -r | sed -e 's/[1-9][0-9]*\\.\\([0-9]\\+\\)\\..*/\\1/'`\n$ declare -p os_major os_minor\ndeclare -- os_major=\"3\"\ndeclare -- os_minor=\"0\""}, {"count": 8, "attachment_id": null, "bug_id": 55690, "is_private": false, "id": 171203, "time": "2013-11-13T08:37:11Z", "creator": "Arfrever.FTA@GMail.Com", "creation_time": "2013-11-13T08:37:11Z", "tags": [], "text": "(In reply to Arfrever Frehtes Taifersar Arahesis from comment #7)\n\nAnd something like this now occurs:\n\n...\nconfigure: Check for compiler flags...\nchecking whether the compiler provides atomic builtins... yes\nchecking whether to enable -D_LARGEFILE64_SOURCE... no\n./configure: line 19058: test: 3.11.7-gentoo: integer expression expected\nconfigure: Configured for Linux 3.3.11.7-gentoo\nconfigure: \nconfigure: Checking for libraries...\nchecking for library containing gethostbyname... none required\nchecking for library containing gethostname... none required\n...\n\n\nSufficient patch:\n\n--- configure.in\n+++ configure.in\n@@ -681,7 +681,7 @@\n         ;;\n     *linux*)\n         os_major=[`uname -r | sed -e 's/\\([1-9][0-9]*\\)\\..*/\\1/'`]\n-        os_minor=[`uname -r | sed -e 's/[1-9][0-9]*\\.\\([0-9]+\\)\\..*/\\1/'`]\n+        os_minor=[`uname -r | sed -e 's/[1-9][0-9]*\\.\\([0-9]\\+\\)\\..*/\\1/'`]\n         if test $os_major -lt 2 -o \\( $os_major -eq 2 -a $os_minor -lt 4 \\); then\n             AC_MSG_WARN([Configured for pre-2.4 Linux $os_major.$os_minor])\n             os_pre24linux=1\n["}, {"count": 9, "tags": [], "bug_id": 55690, "attachment_id": null, "is_private": false, "id": 171206, "time": "2013-11-13T12:16:46Z", "creator": "trawick@apache.org", "creation_time": "2013-11-13T12:16:46Z", "text": "(In reply to Arfrever Frehtes Taifersar Arahesis from comment #8)\n...\n> Sufficient patch:\n...\n> -        os_minor=[`uname -r | sed -e 's/[1-9][0-9]*\\.\\([0-9]+\\)\\..*/\\1/'`]\n> +        os_minor=[`uname -r | sed -e 's/[1-9][0-9]*\\.\\([0-9]\\+\\)\\..*/\\1/'`]\n\nThis patch committed to apr trunk as r1541486...\n\nAll three revisions merged to the 1.5.x branch with r1541489..."}, {"count": 10, "tags": [], "bug_id": 55690, "text": "Thanks Jeff and Arfrever.", "id": 171240, "time": "2013-11-15T12:19:56Z", "creator": "jorton@redhat.com", "creation_time": "2013-11-15T12:19:56Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "david.konecny@volny.cz", "text": "\"Trying to override task definition\" is logged as MSG_WARN instead of\nMSG_VERBOSE in my usage of <macrodef> task. I will attach simple scripts which\ndemonstrate the issue. There are three files:\n* template.xml defines two macros: <myecho> and <myecho2>. The only difference\nis that <myecho2> has attribute with default value (important for the case\nreproduction)\n* subproject.xml imports template.xml and uses both macros\n* mainproject.xml imports template.xml and uses both macros and in addition\ncalls also subproject.xml\n\nIf you execute mainproject.xml you will get warning \"Trying to override old\ndefinition of task http://www.netbeans.org/ns/myecho/2:myecho2\" but I think it\nshould be logged as MSG_VERBOSE only.\n\nLooking at the source code of ComponentHelper.updateDataTypeDefinition() it\nfirst checks whether AntTypeDefinitions are sameDefinition(). <myecho> is the\nsame, but <myecho2> is not because its value of default attribute is different -\nsee the scripts. What follows is that similarDefinition() is called on\nAntTypeDefinitions. I know nothing about what is your semantics of \"similar\",\nbut common sense told me that they should be similar because it is the same\nmacro. :-) But this methods returns false too which results in MSG_WARN logging\nlevel to be used.\n\nI played with that a bit more and will attach also possible patch which solved\nthe issue for me. I changed two things:\n* MacroDef.MyAntTypeDefinition.similarDefinition used to be the same as\nMacroDef.MyAntTypeDefinition.sameDefinition. Now it is less strict and ignore\ndefault value of macro attributes, but as I said I have no idea what is the\nsemantics of similarity.\n* AntTypeDefinition.similarDefinition was returning false to me because my\nclassloader is URLClassLoader and not AntClassLoader as expected now. Even less\nclear to me what is wrong here.\n\nBtw. it is issue <http://www.netbeans.org/issues/show_bug.cgi?id=43968> for\nNetBeans IDE which now uses Ant as native build system. It is not high priority,\njust more clutter in output and \"a bug\" for some of our users.", "id": 63519, "time": "2004-09-14T11:05:05Z", "bug_id": 31215, "creation_time": "2004-09-14T11:05:05Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 12727\nzip file with Ant scripts", "is_private": false, "id": 63520, "creator": "david.konecny@volny.cz", "time": "2004-09-14T11:07:23Z", "bug_id": 31215, "creation_time": "2004-09-14T11:07:23Z", "attachment_id": 12727}, {"attachment_id": 12728, "tags": [], "bug_id": 31215, "is_private": false, "count": 2, "id": 63521, "time": "2004-09-14T11:09:47Z", "creator": "david.konecny@volny.cz", "creation_time": "2004-09-14T11:09:47Z", "text": "Created attachment 12728\npossible patch of the problem"}, {"count": 3, "tags": [], "bug_id": 31215, "attachment_id": null, "text": "First thanks for the clear report!\n\nThe two myecho2 macros are different - they do have different behaviour\nwhen <myecho2/> is used. As you point out, this is due to the different\nsetting of the defaulted attribute.\n\nThe similar/same issue came for attempting to deal with:\n<project default=\"call\">\n   <taskdef name=\"x\" classname=\"y\" classpath=\"z\"/>\n   <target name=\"call\">\n      <antcall target=\"callee\"/>\n   </target>\n   <target name=\"callee\">\n      <x/>\n   </target>\n</project>\n\nThis is a common use-case, and we do not want to get a\nmessage that \"x\" has been redefined. The second definition\nis not exactly the same as the first - it may have a different\nclassloader, hence the similar method and the VERBOSE message.\n\nIf someone did:\n\n<project>\n   <taskdef name=\"x\" classname=\"y\"/>\n   <taskdef name=\"x\" classname=\"anotherclass\"/>\n</project>\n\nWe want to tell the user that x has been redefined. {Although\nthere are bug reports about this been too noisey}.\n\nThe same idea carries over to macrodef (and the other *def)\nfunctions.\n\nThe issue with AntTypeDefinition.similarDefinition not checking\nto see if the classloaders are the same is a bug - thanks.\n\n\nSo the question is, should ant report the differences between\nthe two definitions of <myecho2> ?\n\nI see a number of solutions:\n\n1) treat differences in default values as \"similar\" - your patch\n2) treat all redefinitions as VERBOSE\n3) leave as is\n\nAs this is important from the point of view of intergration\nwith netbeans, I would be inclined to option 1) or option 2).\nHowever, I would like other comments before committing the patch.\n", "id": 63536, "time": "2004-09-14T17:54:32Z", "creator": "peterreilly@apache.org", "creation_time": "2004-09-14T17:54:32Z", "is_private": false}, {"count": 4, "tags": [], "text": "Thanks for the explanation.\n\nRe. \"from the point of view of intergration with netbeans\" - I just worked\naround it in NetBeans by filtering these messages out from output which user can\nsee in IDE.", "is_private": false, "id": 64097, "creator": "david.konecny@volny.cz", "time": "2004-09-23T10:07:32Z", "bug_id": 31215, "creation_time": "2004-09-23T10:07:32Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 31215, "text": "Changed summary to reflect the fact that it is the\nsame macrodef definition that causes the problem", "count": 5, "id": 72444, "time": "2005-03-15T14:24:53Z", "creator": "peterreilly@apache.org", "creation_time": "2005-03-15T14:24:53Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 31215, "text": "The ant code now allows macrodefs declared in the same\nfile/line to be treated as similar definitions, and so\nthe log mesage will be VERBOSE.", "id": 72445, "time": "2005-03-15T14:38:45Z", "creator": "peterreilly@apache.org", "creation_time": "2005-03-15T14:38:45Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 26330, "attachment_id": null, "id": 50931, "time": "2004-01-22T01:59:23Z", "creator": "wms@igoweb.org", "creation_time": "2004-01-22T01:59:23Z", "is_private": false, "text": "When CPU load is high, ant sometimes \"freezes\". Sending a SIGQUIT to Java to get\na thread dump, I see that there is only one thread running, and it is waiting on\na condition in the \"org.apache.tools.ant.Project.fireTargetFinished\" function.\nSeems that probably there is a race condition, when tasks are given very unfair\nscheduling (due to heavy load), the monitor is notified before the thread starts\nwaiting? Just a guess. Here's the full thread dump, as you can see the only\napplication thread is the one that is waiting:\n\nFull thread dump Java HotSpot(TM) Client VM (1.4.2_03-b02 mixed mode):\n \n\"Signal Dispatcher\" daemon prio=1 tid=0x0809d458 nid=0x1d54 waiting on condition\n[0..0]\n \n\"Finalizer\" daemon prio=1 tid=0x08088698 nid=0x1d54 in Object.wait()\n[4c942000..4c942854]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0x44c284c0> (a java.lang.ref.ReferenceQueue$Lock)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:111)\n        - locked <0x44c284c0> (a java.lang.ref.ReferenceQueue$Lock)\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:127)\n        at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\n \n\"Reference Handler\" daemon prio=1 tid=0x08087aa8 nid=0x1d54 in Object.wait()\n[4c8c1000..4c8c1854]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0x44c28528> (a java.lang.ref.Reference$Lock)\n        at java.lang.Object.wait(Object.java:429)\n        at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:115)\n        - locked <0x44c28528> (a java.lang.ref.Reference$Lock)\n \n\"main\" prio=1 tid=0x080522b8 nid=0x1d54 waiting on condition [bfffc000..bfffcb08]\n        at org.apache.tools.ant.Project.fireTargetFinished(Project.java:1944)\n        at org.apache.tools.ant.Target.performTasks(Target.java:337)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1339)\n        at org.apache.tools.ant.taskdefs.Ant.execute(Ant.java:397)\n        at org.apache.tools.ant.taskdefs.CallTarget.execute(CallTarget.java:143)\n       at org.apache.tools.ant.Task.perform(Task.java:341)\n        at org.apache.tools.ant.Target.execute(Target.java:309)\n        at org.apache.tools.ant.Target.performTasks(Target.java:336)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1339)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1255)\n        at org.apache.tools.ant.Main.runBuild(Main.java:609)\n        at org.apache.tools.ant.Main.start(Main.java:196)\n        at org.apache.tools.ant.Main.main(Main.java:235)\n \n\"VM Thread\" prio=1 tid=0x08086788 nid=0x1d54 runnable\n \n\"VM Periodic Task Thread\" prio=1 tid=0x0809fc50 nid=0x1d54 waiting on condition\n\"Suspend Checker Thread\" prio=1 tid=0x0809cab8 nid=0x1d54 runnable"}, {"count": 1, "attachment_id": null, "bug_id": 26330, "text": "Oh, forgot to mention, I got ant from the jpackage RPM \"ant-1.5.4-2jpp\". Linux,\nrunning java 1.4.2_03.", "id": 50932, "time": "2004-01-22T02:00:37Z", "creator": "wms@igoweb.org", "creation_time": "2004-01-22T02:00:37Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "peter.reilly@corvil.com", "is_private": false, "id": 50962, "attachment_id": null, "bug_id": 26330, "creation_time": "2004-01-22T10:51:14Z", "time": "2004-01-22T10:51:14Z", "text": "I have seen ant freeze a number of times - less recently with\njava 1.4.2_03 and fedora.\nI used SIGQUIT on some of the occasions, but nothing was\nobvious.\nLooking at your stack and the code, there seems to be no object.wait() at\nProject#fireTargetFinished().\n\nSome other people have mentioned that this may a problem\nwith java ant the native posix threads in RH 9 and Fedora.\n\nTry using:\nexport LD_ASSUME_KERNEL=2.4.1\nbefore running ant.\n\nOr try using the Blackdown-1.4.2-rc1 java port."}, {"count": 3, "tags": [], "bug_id": 26330, "attachment_id": null, "id": 53737, "time": "2004-03-09T17:32:25Z", "creator": "peter.reilly@corvil.com", "creation_time": "2004-03-09T17:32:25Z", "is_private": false, "text": "From the stack trace one can see that this\nis not an ant problem - problems like\nthis have been reported with java programs\nusing NTPL on rh9.0 and fedora.\nMarking this as WONTFIX as it is (IMO) a java problem."}]
[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "Reviewing r1401816 I see two issues in tagplugin o.a.jasper.tagplugins.jstl.core.Out:\n\nThe code that the plugin generates calls value.toString(), default.toString() and passes these String values to the static method Out.output(...). This new method was added in r1401816.\n\nI think the output() method should accept Objects instead of Strings, because the following is wrong:\n\n1. The evaluation of default.toString() is not needed at all if the default is not used.\n\n2. The JSTL spec (1.1, 1.2) says that there is special processing if value is java.io.Reader. There is no such processing in the current code. (It seems that this feature was added in JSTL 1.1).\n\n[quote]\nIf the result of the evaluation is not a java.io.Reader object, then it is coerced to\na String and is subsequently emitted into the current JspWriter object.\n\nIf the result of the evaluation is a java.io.Reader object, data is first read from the\nReader object and then written into the current JspWriter object.\n[/quote]\n\nThese two issues are not new - they existed before the recent changes.", "id": 163439, "time": "2012-11-14T08:38:29Z", "bug_id": 54144, "creation_time": "2012-11-14T08:38:29Z", "is_private": false}, {"count": 1, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "3. JSTL spec says (under \"Null & Error Handling\"):\n\"If no default value is specified, it itself defaults to an empty string.\"\n\nIn the current code:\na) A null is used instead of \"\" as the value of strDefName.\nb) I suspect that the following check for \"no default value specified\" is incorrect:\n            ctxt.generateJavaSource(\"if(\");\n            ctxt.generateAttribute(\"default\");\n            ctxt.generateJavaSource(\" != null){\");\n\nOne has to check whether the attribute is present, instead of checking whether its value is null.", "id": 163449, "time": "2012-11-15T05:03:00Z", "bug_id": 54144, "creation_time": "2012-11-15T05:03:00Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 54144, "text": "(In reply to comment #1)\n> One has to check whether the attribute is present, instead of checking\n> whether its value is null.\n\nActually checking for null should be OK here. Apache implementation of JSTL tests for null there. \"if (def != null)\" on line 100 in\nhttp://svn.apache.org/viewvc/tomcat/taglibs/standard/tags/standard-112/src/org/apache/taglibs/standard/tag/common/core/OutSupport.java?view=markup\n\n\n4. If default is not specified, the body of the tag has to be used as the default value. This feature was completely broken by r1401816 as the following lines were removed:\n\n-        ctxt.generateJavaSource(\"    }else{\");\n-        ctxt.generateBody();\n-        ctxt.generateJavaSource(\"    }\");", "id": 163451, "time": "2012-11-15T08:48:09Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-11-15T08:48:09Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 54144, "attachment_id": null, "id": 163491, "time": "2012-11-16T22:49:51Z", "creator": "markt@apache.org", "creation_time": "2012-11-16T22:49:51Z", "is_private": false, "text": "I've fixed using body as the default issue in trunk and 7.0.x."}, {"count": 4, "tags": [], "bug_id": 54144, "attachment_id": null, "id": 163493, "time": "2012-11-17T00:01:53Z", "creator": "markt@apache.org", "creation_time": "2012-11-17T00:01:53Z", "is_private": false, "text": "Fixed in trunk and 7.0.x and will be included in 7.0.33 onwards."}]
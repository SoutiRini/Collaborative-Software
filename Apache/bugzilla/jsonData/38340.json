[{"count": 0, "tags": [], "bug_id": 38340, "attachment_id": null, "text": "mod_proxy_ajp does not support support common header codes (0xA0??) described \nin http://httpd.apache.org/docs/2.2/mod/mod_proxy_ajp.html.en#resppacketstruct \n \nHOW TO REPEAT: \nuse with tomcat 4.0: \n[Fri Jan 20 14:07:48 2006] [debug] mod_proxy_ajp.c(195): proxy: \nAPR_BUCKET_IS_EOS \n[Fri Jan 20 14:07:48 2006] [debug] mod_proxy_ajp.c(200): proxy: data to read \n(max 8186 at 4) \n[Fri Jan 20 14:07:48 2006] [debug] mod_proxy_ajp.c(215): proxy: got 0 bytes of \ndata \n[Fri Jan 20 14:07:51 2006] [debug] ajp_header.c(643): ajp_read_header: \najp_ilink_received 04 \n[Fri Jan 20 14:07:51 2006] [debug] ajp_header.c(653): ajp_parse_type: got 04 \n[Fri Jan 20 14:07:51 2006] [debug] ajp_header.c(484): ajp_unmarshal_response: \nstatus = 200 \n[Fri Jan 20 14:07:51 2006] [debug] ajp_header.c(495): ajp_unmarshal_response: \nNumber of headers is = 2 \n[Fri Jan 20 14:07:51 2006] [error] ajp_msg_get_string(): \nBufferOverflowException 16 55 \n[Fri Jan 20 14:07:51 2006] [error] ajp_unmarshal_response: Null header value \n[Fri Jan 20 14:07:51 2006] [error] (120001)APR does not understand this error \ncode: proxy: send body failed to (null) (localhost) \n[Fri Jan 20 14:07:51 2006] [debug] proxy_util.c(1769): proxy: AJP: has \nreleased connection for (localhost) \n \nThe problem is in responce packet parsing code. \n \nHOW TO FIX: \nApply patch: \n--- ajp_header.c.ORIG   Fri Jan 20 15:15:58 2006 \n+++ ajp_header.c        Fri Jan 20 15:39:33 2006 \n@@ -506,7 +506,7 @@ \n         } \n \n         if ((name & 0XFF00) == 0XA000) { \n-            ajp_msg_peek_uint16(msg, &name); \n+            ajp_msg_get_uint16(msg, &name); \n             stringname = long_res_header_for_sc(name); \n             if (stringname == NULL) { \n                 ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,", "id": 84838, "time": "2006-01-21T01:21:46Z", "creator": "apesternikov@yahoo.com", "creation_time": "2006-01-21T01:21:46Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 38340, "attachment_id": 17470, "text": "Created attachment 17470\nPatch against 2.2", "id": 84839, "time": "2006-01-21T01:23:46Z", "creator": "apesternikov@yahoo.com", "creation_time": "2006-01-21T01:23:46Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 38340, "is_private": false, "text": "Created attachment 17471\nPatch against trunk\n\nThe trunk version is got ahead so patch is different", "id": 84840, "time": "2006-01-21T01:28:01Z", "creator": "apesternikov@yahoo.com", "creation_time": "2006-01-21T01:28:01Z", "attachment_id": 17471}, {"count": 3, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 84841, "time": "2006-01-21T02:03:54Z", "bug_id": 38340, "creation_time": "2006-01-21T02:03:54Z", "is_private": false, "text": "Thanks for the patch. From the first glance it seems to do the correct thing.\nCould you please attach a testcase (e.g. a jsp) such that I can doublecheck the\npatch?"}, {"count": 4, "tags": [], "bug_id": 38340, "is_private": false, "text": "Forget about the example. I was not able to reproduce the problem, because I\nused Tomcat 5 to test which does not sent the headers back as integers any\nlonger but as strings.\nBTW: Your trunk version of the patch is wrong as we need to peek at this\nposition of the code. Nevertheless the 2.2.x version looks good and I will take\ncare of it.", "id": 84844, "time": "2006-01-21T11:50:40Z", "creator": "rpluem@apache.org", "creation_time": "2006-01-21T11:50:40Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Committed to trunk as r371013 \n(http://svn.apache.org/viewcvs.cgi?rev=371013&view=rev) and proposed for \nbackport as r371014 (http://svn.apache.org/viewcvs.cgi?rev=&view=rev). ", "is_private": false, "id": 84845, "creation_time": "2006-01-21T12:49:50Z", "time": "2006-01-21T12:49:50Z", "creator": "rpluem@apache.org", "bug_id": 38340, "attachment_id": null}, {"count": 6, "tags": [], "creator": "apesternikov@yahoo.com", "attachment_id": null, "is_private": false, "id": 84907, "time": "2006-01-23T19:02:51Z", "bug_id": 38340, "creation_time": "2006-01-23T19:02:51Z", "text": "(In reply to comment #5) \n> Committed to trunk as r371013  \n> (http://svn.apache.org/viewcvs.cgi?rev=371013&view=rev) and proposed for  \n> backport as r371014 (http://svn.apache.org/viewcvs.cgi?rev=&view=rev).  \n \nThank you, Ruediger! \n \nI have a small comment on reproducing the problem. \ndefault connector in Tomcat 4.1 is org.apache.coyote.tomcat4.CoyoteConnector \nwhich works ok. \nTo reproduce the problem you have to use \norg.apache.ajp.tomcat4.Ajp13Connector. \nThis is a part of server.xml as of jakarta-tomcat-4.1.31-src.tar.gz: \n \n    <!-- Define a Coyote/JK2 AJP 1.3 Connector on port 8009 --> \n    <Connector className=\"org.apache.coyote.tomcat4.CoyoteConnector\" \n               port=\"8009\" minProcessors=\"5\" maxProcessors=\"75\" \n               enableLookups=\"true\" redirectPort=\"8443\" \n               acceptCount=\"10\" debug=\"0\" connectionTimeout=\"0\" \n               useURIValidationHack=\"false\" \n               \nprotocolHandlerClassName=\"org.apache.jk.server.JkCoyoteHandler\"/> \n \n    <!-- Define an AJP 1.3 Connector on port 8009 --> \n    <!-- \n    <Connector className=\"org.apache.ajp.tomcat4.Ajp13Connector\" \n               port=\"8009\" minProcessors=\"5\" maxProcessors=\"75\" \n               acceptCount=\"10\" debug=\"0\"/> \n    --> \n \nSo you need to comment out the first connector and uncomment the second one. \nAfter that any access (even 404) will cause the problem. \n "}, {"count": 7, "tags": [], "bug_id": 38340, "attachment_id": null, "id": 84908, "time": "2006-01-23T21:25:47Z", "creator": "rpluem@apache.org", "creation_time": "2006-01-23T21:25:47Z", "is_private": false, "text": "(In reply to comment #6)\n\n> To reproduce the problem you have to use \n> org.apache.ajp.tomcat4.Ajp13Connector.\n\nThis is the one that had been marked deprecated some time ago :-).\n"}, {"count": 8, "tags": [], "text": "(In reply to comment #7) \n> > To reproduce the problem you have to use  \n> > org.apache.ajp.tomcat4.Ajp13Connector. \n>  \n> This is the one that had been marked deprecated some time ago :-). \n \nNot a good reason to break own specs \nhttp://httpd.apache.org/docs/2.2/mod/mod_proxy_ajp.html.en#resppacketstruct \n ", "attachment_id": null, "bug_id": 38340, "id": 84912, "time": "2006-01-23T22:20:54Z", "creator": "apesternikov@yahoo.com", "creation_time": "2006-01-23T22:20:54Z", "is_private": false}]
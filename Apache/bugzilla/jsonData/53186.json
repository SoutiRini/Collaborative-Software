[{"count": 0, "tags": [], "text": "Overview Description:\n\norg.apache.tomcat.util.net.AbstractEndpoint uses a org.apache.tomcat.util.threads.LimitLatch to limit the amount of connections to whatever was set using the maxConnections property of the connector.\n\nIn the org.apache.tomcat.util.net.JIoEndpoint implementation this is incremented as part of the main Acceptor run method (JIoEndpoint:204) but only decremented during a specific case of SocketProcessor.run()(JIoEndpoint:310).\n\nIf for any reason line 310 does not execute then, over time, the limitlatch will steadily increment with no possibility of decrementing. Until the limit is reached and no more connections can be serviced.\n\nIn my particular case the problem occurs when the setSocketOptions method is called (JIoEndpoint:221) and the native implementation of PlainSocketImpl causes an error due to the socket being closed (as described in the comment on line 942 of http://cr.openjdk.java.net/~chegar/6882910/webrev.00/webrev/src/solaris/native/java/net/PlainSocketImpl.c.frames.html)\n\nSteps to Reproduce: \n\nCan't reproduce in isolation (due to unknown root cause creating initial error in native code). Reproducible under load in Performance and Production environments.\n\nReading the code shows a number of possible reasons why this COULD happen.\n\nActual Results: \n\nThe container stops responding to requests. \n\nThe process continues to run and scheduled tasks etc will continue occuring and logging. Can't even telnet to the port (as the Acceptor thread is blocked by the LimitLatch).\n\nAdditional Builds and Platforms:\n\n - Occurs On\n        Solaris \n\n - Doesn't Occur On\n        Linux (although I would expect any other intermittent exception in JIoEndpointsetSocketOptions or JIoEndpoint$SocketProcessor.run() to produce the same result on any platform)", "is_private": false, "bug_id": 53186, "id": 158791, "time": "2012-05-03T17:50:43Z", "creator": "parker.p.dev@gmail.com", "creation_time": "2012-05-03T17:50:43Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "text": "There might be some relation to BZ53173", "id": 158794, "time": "2012-05-03T19:15:33Z", "bug_id": 53186, "creation_time": "2012-05-03T19:15:33Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 53186, "is_private": false, "count": 2, "id": 158797, "time": "2012-05-03T21:25:01Z", "creator": "parker.p.dev@gmail.com", "creation_time": "2012-05-03T21:25:01Z", "text": "Yep looks like a different instance of the same problem to me, didn't find that in my search.\n\n(In reply to comment #1)\n> There might be some relation to BZ53173"}, {"count": 3, "tags": [], "creator": "bugzilla@pidster.com", "attachment_id": null, "text": "I concur, but I'd suggest we leave it open for Filip to review.", "id": 158804, "time": "2012-05-04T07:03:01Z", "bug_id": 53186, "creation_time": "2012-05-04T07:03:01Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 53186, "is_private": false, "text": "That is correct. Thank you for the report. It has been fixed.\n\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=53173\n\n*** This bug has been marked as a duplicate of bug 53173 ***", "id": 158879, "time": "2012-05-07T12:47:40Z", "creator": "fhanik@apache.org", "creation_time": "2012-05-07T12:47:40Z", "attachment_id": null}]
[{"count": 0, "tags": [], "text": "This bug affects only JSP documents written in the XML syntax.\nThe JSP compiler appears to incorrectly handle the <jsp:root>\ntag that is the root tag of a document in XML syntax.\n\nOne result is that two </jsp:root> end tags get emitted into the page.\nThe more subtle issue has to do with the xmlns:jsp and version\nattributes on the <jsp:root> start tag.  Jasper inserts hardcoded values \nfor those attributes corresponding to the JSP 1.2 release. But in order\nto be truly valid, the document itself should contain those attributes\n(at least version is required). So two instances of each attribute end up\nin the output, causing the resulting XML stream to be invalid.\n\nFor example, the tag library validator in JSPTL generates an XML parse \nerror when it tries to run an XML parser on the XML generated by the \nJSP compiler from any JSP page in XML syntax.\n\nThe following diff is a solution which causes the compiler to ignore\nany xmlns:jsp or version attributes in <jsp:root> tags in documents,\nin favor of its own hardcoded values. This is the simplest solution,\nbut it might be preferable for the compiler to generate a parse error\nif the version tag in the document is a later version than the compiler\ncan process.\n\nIndex: XmlOutputter.java\n===================================================================\nRCS file: /home/cvspublic/jakarta-tomcat-\n4.0/jasper/src/share/org/apache/jasper/compiler/XmlOutputter.java,v\nretrieving revision 1.15\ndiff -u -p --unified=5 -r1.15 XmlOutputter.java\n--- XmlOutputter.java\t2001/07/25 01:49:10\t1.15\n+++ XmlOutputter.java\t2001/08/20 18:14:35\n@@ -126,12 +126,12 @@ public class XmlOutputter {\n     void addRootAttrs(Attributes attrs) {\n \tjspRootLevel++;\n         int attrsLength = attrs.getLength();\n         for (int i = 0; i < attrsLength; i++) {\n \t    String qName = attrs.getQName(i);\n-\t    if (attrs.getQName(i).startsWith(\"xmlns:jsp\") \n-\t\t&& jspRootLevel > 1) continue; \n+\t    if ((qName.startsWith(\"xmlns:jsp\") || \n+\t\t qName.equals(\"version\"))) continue; \n             rootAttrs.addAttribute(attrs.getURI(i), attrs.getLocalName(i),\n                 attrs.getQName(i), attrs.getType(i), attrs.getValue(i));\n         }\n     }\n \n@@ -142,18 +142,15 @@ public class XmlOutputter {\n \t rootAttrs.addAttribute(\"\", \"xmlns\", \"xmlns:\" + prefix, \"CDATA\", uri);\n      }\n \n \n     /*\n-     * Only put the </jsp:root> tag when we're dealing\n-     * with the top level 'container' page.\n+     * Don't append the root end tag here because the\n+     * getPageData method will append it later.\n      */\n     void rootEnd() {\n \tjspRootLevel--;\n-\tif (jspRootLevel == 0) {\n-\t    append(\"jsp:root\");\n-\t}\n     }\n     \n     /**\n      * Append the cdata to the XML stream.\n      */", "attachment_id": null, "id": 5019, "creator": "mark.abbott@openwave.com", "time": "2001-08-29T15:30:48Z", "bug_id": 3351, "creation_time": "2001-08-29T15:30:48Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "craig.mcclanahan@sun.com", "text": "*** Bug 3174 has been marked as a duplicate of this bug. ***", "count": 1, "id": 5187, "time": "2001-09-06T17:54:17Z", "bug_id": 3351, "creation_time": "2001-09-06T17:54:17Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 3351, "text": "Fixed in nightly build 20010907.\n", "id": 5219, "time": "2001-09-07T12:07:23Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-09-07T12:07:23Z", "is_private": false, "attachment_id": null}]
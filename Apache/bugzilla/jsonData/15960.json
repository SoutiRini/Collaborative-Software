[{"count": 0, "tags": [], "creator": "jhkeller@ucdavis.edu", "text": "When running log4j with a TelnetAppender within Tomcat 4.0x, Tomcat's normal\nshutdown hook does not seem to kill the process.\n\nThe servlets give messages that they are being shut down, but the process does\nnot end.  I believe that tomcat is shutting down properly, but the\nTelnetAppender ServerSocket is listening on a non-daemon thread.  This is\npreventing the server\nfrom shutting down as requested.\n\nThis causes a problem for restarting the server as the TelnetAppender is still\nlistening on the specified port and the next restart of the tomcat engine then\nbombs when attaching loggers because the port is already in use on the machine.\n This causes the error in Bug# 15198 when the servlet survives the logger\nexception and attempts to use the logger.", "id": 29136, "time": "2003-01-10T17:20:23Z", "bug_id": 15960, "creation_time": "2003-01-10T17:20:23Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "jhkeller@ucdavis.edu", "is_private": false, "text": "Created attachment 4397\nPatch to mahe TelnetAppender use a daemon thread", "id": 29138, "time": "2003-01-10T17:37:46Z", "bug_id": 15960, "creation_time": "2003-01-10T17:37:46Z", "attachment_id": 4397}, {"count": 2, "tags": [], "creator": "jhkeller@ucdavis.edu", "text": "The problem seems to be solved by making the SocketHandler Thread class in the\ntelnet appender into a Daemon thread.\n\nIf this does not cause other problems, then I propose the attached patch.", "id": 29139, "time": "2003-01-10T17:37:57Z", "bug_id": 15960, "creation_time": "2003-01-10T17:37:57Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "yoavs@computer.org", "text": "The daemon patch is only OK.  You should call LogManager#shutdown at the end of \nyour webapp's execution, e.g. in a ServletContextListener#contextDestroyed \nmethod.  That will call removeAllAppenders which in turn will call \nTelnetAppender#close, which interrupts the thread.", "id": 68286, "time": "2004-12-10T19:55:13Z", "bug_id": 15960, "creation_time": "2004-12-10T19:55:13Z", "is_private": false, "attachment_id": null}]
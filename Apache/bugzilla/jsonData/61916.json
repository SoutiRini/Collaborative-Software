[{"count": 0, "tags": [], "bug_id": 61916, "attachment_id": null, "text": "Overview:\nAddDefaultCharsetFilter wouldn't work if one set response header 'content-type' through setHeader() instead of setContentType().\nI tried to debug the webapp by adding a breakpoint in be beginning of method AddDefaultCharsetFilter.ResponseWrapper#setContentType(String), while the CXF framework did't invoke setContentType().\nSo I think that cxf may set response header Content-Type by invoking setHeader() but there is not a overridden method setHeader() in class AddDefaultCharsetFilter.ResponseWrapper\n\nSteps to Reproduce:\n1) Adding a maven dependecy in pom.xml\n<dependency>\n\t<groupId>org.apache.tomcat</groupId>\n\t<artifactId>tomcat-catalina</artifactId>\n\t<version>8.5.23</version>\n\t<scope>provided</scope>\n</dependency>\n2) Adding a filter registeration in web.xml\n<filter>\n\t<filter-name>AddDefaultCharset</filter-name>\n\t<filter-class>org.apache.catalina.filters.AddDefaultCharsetFilter</filter-class>\n\t<init-param>\n\t\t<param-name>encoding</param-name>\n\t\t<param-value>UTF-8</param-value>\n\t</init-param>\n</filter>\n<filter-mapping>\n\t<filter-name>AddDefaultCharset</filter-name>\n\t<servlet-name>cxf</servlet-name>\n</filter-mapping>\n3) Adding a method in cxf jax-rs service bean UserResource.java\n@Path(\"hello\")\n@Produces(MediaType.TEXT_PLAIN)\npublic Response hello(){\n\treturn Response.ok(\"hello\").build();\n}\n4) request the hello service\n\nActual Results:\nContent-Type: text/plain\n\nExpected Results:\nContent-Type: text/plain;charset=UTF-8\n\nBuild Date & Hardware:\n\t\nAdditional Builds and Platforms:\n\nAdditional Information:", "id": 202835, "time": "2017-12-19T06:34:20Z", "creator": "fuweichin@gmail.com", "creation_time": "2017-12-19T06:34:20Z", "is_private": false}, {"count": 1, "tags": [], "text": "Thanks for the report. I fixed addHeader() as well as setHeader()\n\nFixed in:\n- trunk for 9.0.3 onwards\n- 8.5.x for 8.5.25 onwards\n- 8.0.x for 8.0.49 onwards\n- 7.0.x for 7.0.84 onwards", "is_private": false, "id": 203079, "creator": "markt@apache.org", "time": "2018-01-04T17:32:51Z", "bug_id": 61916, "creation_time": "2018-01-04T17:32:51Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "Implementation of addHeader() in r1820138 is broken: it needs to call super.addHeader().\n\nThis concerns 9.0.3 (currently being voted as a release candidate).\n\n\nA fix is trivial, but maybe it is worth to extend the unit tests that were created for this issue.", "id": 203300, "time": "2018-01-16T17:31:20Z", "bug_id": 61916, "creation_time": "2018-01-16T17:31:20Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 61916, "is_private": false, "id": 203307, "time": "2018-01-16T22:33:49Z", "creator": "markt@apache.org", "creation_time": "2018-01-16T22:33:49Z", "tags": [], "text": "Regression fixed in:\n- trunk for 9.0.4 onwards\n- 8.5.x for 8.5.27 onwards\n- 8.0.x for 8.0.49 onwards\n- 7.0.x for 7.0.84 onwards"}]
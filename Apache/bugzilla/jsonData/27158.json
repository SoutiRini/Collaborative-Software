[{"count": 0, "tags": [], "bug_id": 27158, "attachment_id": null, "is_private": false, "id": 52797, "time": "2004-02-23T14:08:43Z", "creator": "marc.gimpel@wimba.com", "creation_time": "2004-02-23T14:08:43Z", "text": "I set the mail/Session ressource parameter in server.xml\n          <Resource name=\"mail/Session\" auth=\"Container\"\n                    type=\"javax.mail.Session\"/>\n          <ResourceParams name=\"mail/Session\">\n            <parameter>\n              <name>mail.smtp.host</name>\n              <value>10.0.0.4</value>\n            </parameter>\n          </ResourceParams>\nThen in my web app\n  <resource-ref>\n    <res-ref-name>mail/Session</res-ref-name>\n    <res-type>javax.mail.Session</res-type>\n    <res-auth>Container</res-auth>\n  </resource-ref>\nYet when I call the code\n\n    Context initCtx = new InitialContext();\n    Context envCtx = (Context) initCtx.lookup(\"java:comp/env\");\n    Session session = (Session) envCtx.lookup(\"mail/Session\");\n      // Prepare our mail message\n      Message message = new MimeMessage(session);\n      message.setFrom(new InternetAddress(from));\n      InternetAddress dests[] = new InternetAddress[]\n          { new InternetAddress(to) };\n      message.setRecipients(Message.RecipientType.TO, dests);\n      message.setSubject(subject);\n      message.setSentDate(new Date());\n      //create the Multipart\n      Multipart mp = new MimeMultipart();    \n      //create and fill the first message part\n      MimeBodyPart mbp1 = new MimeBodyPart();\n      mbp1.setText(content);\n      mp.addBodyPart(mbp1);\n      //create and fill the second message part\n      if (attach != null && attach.length() > 0) {\n        MimeBodyPart mbp2 = new MimeBodyPart();\n        mbp2.setText(attach, \"text/plain\");\n        mp.addBodyPart(mbp2);\n      }\n      //add the Multipart to the message\n      message.setContent(mp);\n      // Send our mail message\n      Transport.send(message);\n\nThe mail/Session resource tries to connect to localhost instead of 10.0.0.4 as\nthe resource parameter in server.xml was configured.\nI get the following exception\n\njavax.mail.SendFailedException: Sending failed;\n  nested exception is: \n\tjavax.mail.MessagingException: Could not connect to SMTP host: localhost, port: 25;\n  nested exception is: \n\tjava.net.ConnectException: Connection refused: connect\n\tat javax.mail.Transport.send0(Transport.java:219)\n\tat javax.mail.Transport.send(Transport.java:81)\n\tat\ncom.wimba.misc.registration.RegistrationModel.sendMessage(RegistrationModel.java:245)\n\tat\ncom.wimba.misc.registration.RegistrationModel.sendRequestToWimba(RegistrationModel.java:162)\n\tat\ncom.wimba.misc.registration.RegistrationAction.execute(RegistrationAction.java:77)\n\tat\norg.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:484)\n\tat org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:274)\n\tat org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\tat org.apache.struts.action.ActionServlet.doPost(ActionServlet.java:525)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2417)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:171)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:193)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:781)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:549)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:589)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:666)\n\tat java.lang.Thread.run(Thread.java:534)\njavax.mail.MessagingException: Could not connect to SMTP host: localhost, port: 25;\n  nested exception is: \n\tjava.net.ConnectException: Connection refused: connect\n\tat com.sun.mail.smtp.SMTPTransport.openServer(SMTPTransport.java:867)\n\tat com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:156)\n\tat javax.mail.Service.connect(Service.java:234)\n\tat javax.mail.Service.connect(Service.java:135)\n\tat javax.mail.Service.connect(Service.java:87)\n\tat com.sun.mail.smtp.SMTPTransport.connect(SMTPTransport.java:93)\n\tat javax.mail.Transport.send0(Transport.java:163)\n\tat javax.mail.Transport.send(Transport.java:81)\n\tat\ncom.wimba.misc.registration.RegistrationModel.sendMessage(RegistrationModel.java:245)\n\tat\ncom.wimba.misc.registration.RegistrationModel.sendRequestToWimba(RegistrationModel.java:162)\n\tat\ncom.wimba.misc.registration.RegistrationAction.execute(RegistrationAction.java:77)\n\tat\norg.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:484)\n\tat org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:274)\n\tat org.apache.struts.action.ActionServlet.process(ActionServlet.java:1482)\n\tat org.apache.struts.action.ActionServlet.doPost(ActionServlet.java:525)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:256)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2417)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:171)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:193)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:781)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:549)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:589)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:666)\n\tat java.lang.Thread.run(Thread.java:534)"}, {"count": 1, "tags": [], "text": "Global JNDI resources are NOT autoimatically visible to every web app. You need\nto add a Context element to server.xml with a ResourceLink to the global\nresource to make it visible to your web app.", "attachment_id": null, "id": 69828, "creation_time": "2005-01-18T23:56:22Z", "time": "2005-01-18T23:56:22Z", "creator": "markt@apache.org", "bug_id": 27158, "is_private": false}, {"count": 2, "tags": [], "bug_id": 27158, "attachment_id": null, "is_private": false, "id": 17003, "time": "2005-03-23T00:04:25Z", "creator": "markt@apache.org", "creation_time": "2005-03-23T00:04:25Z", "text": "*** Bug 34111 has been marked as a duplicate of this bug. ***"}]
[{"count": 0, "tags": [], "bug_id": 41325, "attachment_id": null, "id": 97800, "time": "2007-01-08T22:15:27Z", "creator": "saijaiganesh@gmail.com", "creation_time": "2007-01-08T22:15:27Z", "is_private": false, "text": "We are using Apache 59 (RHEL 3, Worker) as a forward proxy.\nWe have a traffic of approx 20 Mbps on this machine (dual CPU with HT enabled).\nResource utilization is very good (44-49 MB or RAM per httpd process and 10% of\nCPU utilization)\nWe notice that Apache stops responding all of a sudden and will work only if we\nrestart it!\nThere is no entries in the error log (between the hang and the restart)that\nmight indicate an issue with Apache. \nNote: the outage occurred at 16:40 hrs approx\n\n<error log snip>\n[Mon Jan 08 16:08:13 2007] [error] [client 80.127.52.177] proxy: error reading\nstatus line from remote server 85.17.63.102, referer: http://pwnots.hyves.nl/\n[Mon Jan 08 16:08:13 2007] [error] [client 80.127.52.177] proxy: Error reading\nfrom remote server returned by\nhttp://85.17.63.102/hasmessage.js?digest=aGVzbGFiXzExNjgyNzU5MTVf1ktM1m3qEEh3avmnwVBnmw%3D%3D&noCache=5734566726&show=normal&status=online&changeStatus=false,\nreferer: http://pwnots.hyves.nl/\n[Mon Jan 08 16:08:26 2007] [error] [client 82.92.46.149] proxy: error reading\nstatus line from remote server 85.17.63.102, referer:\nhttp://rianne135.hyves.nl/vrienden/\n[Mon Jan 08 16:08:26 2007] [error] [client 82.92.46.149] proxy: Error reading\nfrom remote server returned by\nhttp://85.17.63.102/hasmessage.js?digest=amFubmVrZXNjaHJldWRlcnNfMTE2ODI3NTkzM18eH8Ve1Bd7NIFiBHv517nY&noCache=5079609824&show=normal&status=online&changeStatus=false,\nreferer: http://rianne135.hyves.nl/vrienden/\n[Mon Jan 08 16:39:28 2007] [warn] child process 6220 still did not exit, sending\na SIGTERM\n[Mon Jan 08 16:39:28 2007] [warn] child process 6728 still did not exit, sending\na SIGTERM\n[Mon Jan 08 16:39:28 2007] [warn] child process 6217 still did not exit, sending\na SIGTERM\n[Mon Jan 08 16:39:28 2007] [warn] child process 6218 still did not exit, sending\na SIGTERM\n[Mon Jan 08 16:39:28 2007] [warn] child process 6550 still did not exit, sending\na SIGTERM\n\n<error log snip>\n\nThis is the second such outage that we noticed in a week.\n\nHttpd conf has the following entries\n\n<IfModule worker.c>\nServerLimit         18\nStartServers        10\nThreadsPerChild     50\nMaxClients          900\nMinSpareThreads     100\nMaxSpareThreads     900\nMaxRequestsPerChild 2000\n</IfModule>\n\nand \nKeepAlive Off\n\nWhen the outage occurred we could not access the /server-status page to see what\nApache is doing.\nAlso here are some additional (at the time of hanging)info\n# ps aux | grep httpd\nroot      7645  0.0  0.2 284776 12068 ?      S    Jan02   0:29\n/usr/local/apache59/bin/httpd -k start\nnobody    7648  0.0  0.2 284544 11840 ?      S    Jan02   0:00\n/usr/local/apache59/bin/httpd -k start\nnobody    1759  0.2  1.0 607320 44420 ?      S    15:32   0:08\n/usr/local/apache59/bin/httpd -k start\nnobody    6215  0.0  0.9 546736 37124 ?      S    16:00   0:02\n/usr/local/apache59/bin/httpd -k start\nnobody    6217  0.0  0.9 546736 37144 ?      S    16:00   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6218  0.0  0.9 554992 37480 ?      S    16:00   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6220  0.0  0.9 545704 37072 ?      S    16:00   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6389  0.0  0.9 546736 37132 ?      S    16:03   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6416  0.0  0.9 546736 37144 ?      S    16:03   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6417  0.0  0.9 546736 37156 ?      S    16:03   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6466  0.0  0.9 546736 37116 ?      S    16:03   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6467  0.0  0.9 545712 37116 ?      S    16:03   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6468  0.0  0.9 546736 37144 ?      S    16:03   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6469  0.0  0.9 545712 37104 ?      S    16:03   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6530  0.1  0.9 545712 37116 ?      S    16:03   0:02\n/usr/local/apache59/bin/httpd -k start\nnobody    6534  0.0  0.9 546736 37232 ?      S    16:03   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6535  0.0  0.9 546736 37120 ?      S    16:03   0:01\n/usr/local/apache59/bin/httpd -k start\nnobody    6543  0.1  0.9 546736 37136 ?      S    16:03   0:02\n/usr/local/apache59/bin/httpd -k start\nnobody    6550  0.1  0.9 546736 37152 ?      S    16:03   0:02\n/usr/local/apache59/bin/httpd -k start\nnobody    6728  0.0  0.9 546736 37148 ?      S    16:03   0:00\n/usr/local/apache59/bin/httpd -k start\nnobody    6753  0.0  0.9 546736 37156 ?      S    16:03   0:01\n/usr/local/apache59/bin/httpd -k start\n\n\nAny help will be highly appreciated"}, {"count": 1, "tags": [], "bug_id": 41325, "attachment_id": null, "id": 97846, "time": "2007-01-09T12:43:42Z", "creator": "rpluem@apache.org", "creation_time": "2007-01-09T12:43:42Z", "is_private": false, "text": "Please obtain a backtrace of a hanging process via gdb\n(http://httpd.apache.org/dev/debugging.html#backtrace) and apply the following\ngdb command once you have attached gdb to the hanging process:\n\nthread apply all bt full\n\nFurthermore the output of a strace of an hanging process might be helpfull too\n(http://httpd.apache.org/dev/debugging.html#truss)"}, {"count": 2, "tags": [], "text": "We have made the following changes to the conf:\nKeepAlive On\nMaxKeepAliveRequests 50\nMaxKeepAliveTimeOut 3\n\nFor the past 10 days we did not have any outages.\nGiven the randomness of the incident, we will update the required details \nwhenever it happens.\n\n(In reply to comment #1)\n> Please obtain a backtrace of a hanging process via gdb\n> (http://httpd.apache.org/dev/debugging.html#backtrace) and apply the \nfollowing\n> gdb command once you have attached gdb to the hanging process:\n> thread apply all bt full\n> Furthermore the output of a strace of an hanging process might be helpfull \ntoo\n> (http://httpd.apache.org/dev/debugging.html#truss)\n\n", "attachment_id": null, "id": 98253, "creator": "saijaiganesh@gmail.com", "time": "2007-01-19T02:54:14Z", "bug_id": 41325, "creation_time": "2007-01-19T02:54:14Z", "is_private": false}, {"count": 3, "text": "Created attachment 19980\nDiagnostics that were taken during a outage\n\nDiagnostics of the system (top, netstat and vmstat) during one such outage", "creator": "saijaiganesh@gmail.com", "attachment_id": 19980, "id": 101799, "time": "2007-04-17T06:07:57Z", "bug_id": 41325, "creation_time": "2007-04-17T06:07:57Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 41325, "attachment_id": null, "id": 101800, "time": "2007-04-17T06:13:25Z", "creator": "saijaiganesh@gmail.com", "creation_time": "2007-04-17T06:13:25Z", "is_private": false, "text": "Unfortunately before we could run the following script Apache recovered!\n1. for pid in `ps -eaf | fgrep httpd | cut -d' ' -f4`\n    do\n        pstack $pid >> outage_data\n    done\n2. pstree -Gph | grep httpd >> outage_data\n3.ps aux | grep httpd >> outage_data\n4.strace -f httpd -d /usr/local/apache59 >& strace_output\n\n<let us know if you need any more commands to be added.>\nThe strange thing now is that Apache recovers after an hour of so on its own.\nduring this time we can ping the machine from outside.\nserver-status page will not be available (any page for that matter)\n\nCan you suggest us any angle where we can investigate this issue.\n"}, {"count": 5, "tags": [], "bug_id": 41325, "attachment_id": 20141, "id": 102898, "time": "2007-05-07T06:02:08Z", "creator": "saijaiganesh@gmail.com", "creation_time": "2007-05-07T06:02:08Z", "is_private": false, "text": "Created attachment 20141\noutput of pstack during the outage\n\nOutput of the following command during the outage.\nfor pid in `ps -eaf | fgrep httpd | cut -d' ' -f4`\n    do\n\tpstack $pid > pstack_data_httpd.log\n    done"}, {"count": 6, "tags": [], "text": "Sorry for being confused, but you attached a pstack of a JVM and not of a httpd\nprocess. Where is the connection to your problem?", "attachment_id": null, "id": 102904, "creator": "rpluem@apache.org", "time": "2007-05-07T07:29:04Z", "bug_id": 41325, "creation_time": "2007-05-07T07:29:04Z", "is_private": false}, {"count": 7, "tags": [], "creator": "nick@webthing.com", "is_private": false, "text": "The original log posted looks like a problem with the server shutting down (all\nthose SIGTERMs).  This has changed substantially in 2.2, so probably doesn't\napply any more.  Please try with 2.2.  And answer Rudiger's question if you want\nto reopen.\n\nIn any case, it's not a mod_proxy bug.  That would affect individual requests,\nnot the entire server.", "id": 107865, "time": "2007-09-08T09:24:24Z", "bug_id": 41325, "creation_time": "2007-09-08T09:24:24Z", "attachment_id": null}]
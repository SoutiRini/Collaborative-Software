[{"count": 0, "attachment_id": null, "creator": "Thomas.Hoffmann@speed4trade.com", "text": "Hello,\nI tracked down an issue with version 3.2\nI use Cache Manager and a GET request within a thread group. In the advanced settings of the http request, fetching the embedded resources is checked.\nIf the included CSS or JS files are gzip compressed, the Cache is not working any more. The internal method \"setCache\" is not called for these files.\n\n\"Content-Encoding:gzip\" in the http response header will disable caching and prevent the Cache Manager to work.\nIn my opinion it should cache despite compression as compression is recommended for speeding up pages.\n\nWhen I disable mod_deflate, JMeter works as expected and caches the static files which are included in the HTML page.\n\nIf you need further information, I can set up a sample page.\n\nKind regards,\nThomas", "id": 199145, "time": "2017-06-10T21:14:20Z", "bug_id": 61176, "creation_time": "2017-06-10T21:14:20Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 61176, "text": "Hello,\nThanks for report.\nAre you sure that your issue is not due to presence of Vary header ?\nWould it be possible to provide a Sample request and response ?\n\nThanks", "id": 199146, "time": "2017-06-10T22:50:26Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-06-10T22:50:26Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 61176, "is_private": false, "text": "Created attachment 35046\nJMeter with working cache", "id": 199161, "time": "2017-06-12T12:21:49Z", "creator": "Thomas.Hoffmann@speed4trade.com", "creation_time": "2017-06-12T12:21:49Z", "attachment_id": 35046}, {"count": 3, "tags": [], "creator": "Thomas.Hoffmann@speed4trade.com", "attachment_id": 35047, "is_private": false, "id": 199162, "time": "2017-06-12T12:22:09Z", "bug_id": 61176, "creation_time": "2017-06-12T12:22:09Z", "text": "Created attachment 35047\nJMeter with non-working cache because of gzip"}, {"count": 4, "tags": [], "bug_id": 61176, "text": "Hello,\n\nI set up a test environment with two URLs:\nhttp://52.59.21.204/jmeter.php\nhttp://52.59.21.204/jmeter2.php\n\nThe second link contains a JS which is compressed.\nThis causes JMeter to fetch the JS again and again.\nI also attached screenshots of wireshark which shows the behaviour.\n\nIn the screenshots you can see the first time the PHP and included CSS and JS are fetched.\nFurther calls will fetch the JS file if it was delivered with \"Content-Encoding:gzip\"\n\nHope this helps to figure out the reason.\n\nThank you in advance,\nThomas", "id": 199163, "time": "2017-06-12T12:25:09Z", "creator": "Thomas.Hoffmann@speed4trade.com", "creation_time": "2017-06-12T12:25:09Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "Thomas.Hoffmann@speed4trade.com", "text": "Addendum: Request and Response\n\nhttp://52.59.21.204/jmeter2.js\n\nRequest-Headers:\n================\nAccept:*/*\nAccept-Encoding:gzip, deflate, sdch\nAccept-Language:de-DE,de;q=0.8,en-US;q=0.6,en;q=0.4\nCache-Control:no-cache\nConnection:keep-alive\nHost:52.59.21.204\nPragma:no-cache\nReferer:http://52.59.21.204/jmeter2.php\nUser-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36\n\nResponse-Headers:\n=================\nAccept-Ranges:bytes\nCache-Control:max-age=2419197\nConnection:Keep-Alive\nContent-Encoding:gzip\nContent-Length:58\nContent-Type:application/javascript\nDate:Mon, 12 Jun 2017 12:11:23 GMT\nETag:\"b6-551c23791451c-gzip\"\nExpires:Mon, 10 Jul 2017 12:11:21 GMT\nKeep-Alive:timeout=5, max=100\nLast-Modified:Mon, 12 Jun 2017 12:11:21 GMT\nServer:Apache/2.4.18 (Ubuntu)\nVary:Accept-Encoding", "id": 199164, "attachment_id": null, "bug_id": 61176, "creation_time": "2017-06-12T12:31:48Z", "time": "2017-06-12T12:31:48Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 61176, "is_private": false, "text": "(In reply to Thomas Hoffmann from comment #5)\n> Addendum: Request and Response\n> \n> http://52.59.21.204/jmeter2.js\n> \n> Request-Headers:\n> ================\n> Accept:*/*\n> Accept-Encoding:gzip, deflate, sdch\n> Accept-Language:de-DE,de;q=0.8,en-US;q=0.6,en;q=0.4\n...\n> \n> Response-Headers:\n> =================\n> Accept-Ranges:bytes\n> Cache-Control:max-age=2419197\n...\n> Vary:Accept-Encoding\n\nJMeter will not cache responses with \"Vary\" header in the current releases.\n\nThe same behaviour would be seen with the php pages, as both jmeter.php and jmeter2.php have the \"Vary\" header.\n\nFeel free to discuss the current behaviour on the mailing list. Currently I would see this as an enhancement request rather than a bug.", "id": 199167, "time": "2017-06-12T15:13:47Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2017-06-12T15:13:47Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 61176, "text": "Hello,\n\nthanks for the analysis.\n\nI have checked the documentation of mod_deflate:\nhttp://httpd.apache.org/docs/2.0/mod/mod_deflate.html\n\n\"The mod_deflate module sends a Vary: Accept-Encoding HTTP response header to alert proxies that a cached response should be sent only to clients that send the appropriate Accept-Encoding request header. This prevents compressed content from being sent to a client that will not understand it.\"\n\nSo when using the mod_deflate module, caching in JMeter doesn't work any more.\nAs this module is very common, I consider this feature as quite important.\n\nAccording to https://w3techs.com/technologies/details/ce-gzipcompression/all/all\nover 70% of the websites are using compression. This means that JMeter caching is not working for over 70% of the websites (without modifying server settings).\n\nPrevent caching was introduced with this ticket:\nhttps://bz.apache.org/bugzilla/show_bug.cgi?id=58079", "id": 199172, "time": "2017-06-12T15:31:08Z", "creator": "Thomas.Hoffmann@speed4trade.com", "creation_time": "2017-06-12T15:31:08Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 61176, "is_private": false, "text": "@thomas, could you test, if current trunk works for you?\n\nThis will be included in JMeter version 3.3.\n\nDate: Thu Jul 13 17:43:15 2017\nNew Revision: 1801854\n\nURL: http://svn.apache.org/viewvc?rev=1801854&view=rev\nLog:\nWe are not not doing any real work here and it simplifies our code.\n\nIn preparation of Bugzilla Id: 61176 (and github pr #298)\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\n\nDate: Thu Jul 13 17:44:57 2017\nNew Revision: 1801855\n\nURL: http://svn.apache.org/viewvc?rev=1801855&view=rev\nLog:\nUse log string templates instead of string concatenation.\n\nThis should make the code a bit more readable.\n\nIn preparation of Bugzilla Id: 61176 (and github pr #298)\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\nDate: Thu Jul 13 17:51:49 2017\nNew Revision: 1801856\n\nURL: http://svn.apache.org/viewvc?rev=1801856&view=rev\nLog:\nExtract code into local private methods.\n\nExtract the various methods for calculation of the expiration date into\nsmaller methods in an attempt to make code more readable.\n\nIn preparation of Bugzilla Id: 61176 (and github pr #298)\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\n\nDate: Thu Jul 13 17:53:29 2017\nNew Revision: 1801857\n\nURL: http://svn.apache.org/viewvc?rev=1801857&view=rev\nLog:\nRename local variable to comply with java naming conventions.\n\nIn preparation of Bugzilla Id: 61176 (and github pr #298)\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\n\nDate: Thu Jul 13 17:54:29 2017\nNew Revision: 1801858\n\nURL: http://svn.apache.org/viewvc?rev=1801858&view=rev\nLog:\nReformat to make it easier to read.\n\nIn preparation of Bugzilla Id: 61176 (and github pr #298)\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\nDate: Thu Jul 13 18:23:05 2017\nNew Revision: 1801859\n\nURL: http://svn.apache.org/viewvc?rev=1801859&view=rev\nLog:\nImplement caching of requests with \"vary\" header.\n\nBugzilla Id: 61176 (closes #298 on github)\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPJavaImpl.java\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/control/TestCacheManagerBase.java\n    jmeter/trunk/xdocs/changes.xml\n    jmeter/trunk/xdocs/usermanual/component_reference.xml", "id": 199768, "time": "2017-07-13T18:26:46Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2017-07-13T18:26:46Z", "attachment_id": null}, {"count": 9, "attachment_id": null, "creator": "felix.schumacher@internetallee.de", "is_private": false, "id": 200064, "time": "2017-07-26T19:57:17Z", "bug_id": 61176, "creation_time": "2017-07-26T19:57:17Z", "tags": [], "text": "Date: Wed Jul 26 19:56:08 2017\nNew Revision: 1803103\n\nURL: http://svn.apache.org/viewvc?rev=1803103&view=rev\nLog:\nGuard debug log messages that call a function with Logger#isDebugEnabled\n\nBugzilla Id: 61176\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java"}]
[{"count": 0, "tags": [], "bug_id": 55732, "attachment_id": null, "text": "File too large to upload (2.5mb), it may be found here...\n\nhttp://www.cdt.org/files/CDT_Data_Retention-PPT.ppt\n\nIt is a Microsoft Powerpoint 97 presentation \n   [ https://issues.apache.org/jira/browse/TIKA-1189?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&focusedCommentId=13810577#comment-13810577 ] \n\nNick Burch commented on TIKA-1189:\n----------------------------------\n\nThis looks to be a bug in Apache POI, one of the upstream libraries that Tika uses. Any chance you could open a bug in the POI Bugzilla - http://issues.apache.org/bugzilla/buglist.cgi?product=POI - and attach the file there?\n\nFails to parse PPT file\n-----------------------\n\n               Key: TIKA-1189\n               URL: https://issues.apache.org/jira/browse/TIKA-1189\n           Project: Tika\n        Issue Type: Bug\n        Components: cli, gui\n       Environment: OSX 10.9, OSX 10.6\n          Reporter: Aimee Dev\n       Attachments: CDT_Data_Retention-PPT.ppt\n\n\nOut of the box tika application when presented with the file results in \nApache Tika was unable to parse the document\nat /Volumes/FREECOM_HDD/Test/CDT_Data_Retention-PPT.ppt.\nThe full exception stack trace is included below:\norg.apache.tika.exception.TikaException: Unexpected RuntimeException from org.apache.tika.parser.microsoft.OfficeParser@224f9db\n\tat org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:244)\n\tat org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)\n\tat org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:120)\n\tat org.apache.tika.gui.TikaGUI.handleStream(TikaGUI.java:320)\n\tat org.apache.tika.gui.TikaGUI.openFile(TikaGUI.java:279)\n\tat org.apache.tika.gui.ParsingTransferHandler.importFiles(ParsingTransferHandler.java:94)\n\tat org.apache.tika.gui.ParsingTransferHandler.importData(ParsingTransferHandler.java:77)\n\tat javax.swing.TransferHandler.importData(TransferHandler.java:826)\n\tat javax.swing.TransferHandler$DropHandler.drop(TransferHandler.java:1536)\n\tat java.awt.dnd.DropTarget.drop(DropTarget.java:450)\n\tat javax.swing.TransferHandler$SwingDropTarget.drop(TransferHandler.java:1274)\n\tat sun.awt.dnd.SunDropTargetContextPeer.processDropMessage(SunDropTargetContextPeer.java:537)\n\tat sun.lwawt.macosx.CDropTargetContextPeer.processDropMessage(CDropTargetContextPeer.java:127)\n\tat sun.awt.dnd.SunDropTargetContextPeer$EventDispatcher.dispatchDropEvent(SunDropTargetContextPeer.java:851)\n\tat sun.awt.dnd.SunDropTargetContextPeer$EventDispatcher.dispatchEvent(SunDropTargetContextPeer.java:775)\n\tat sun.awt.dnd.SunDropTargetEvent.dispatch(SunDropTargetEvent.java:48)\n\tat java.awt.Component.dispatchEventImpl(Component.java:4716)\n\tat java.awt.Container.dispatchEventImpl(Container.java:2287)\n\tat java.awt.Component.dispatchEvent(Component.java:4687)\n\tat java.awt.LightweightDispatcher.retargetMouseEvent(Container.java:4832)\n\tat java.awt.LightweightDispatcher.processDropTargetEvent(Container.java:4566)\n\tat java.awt.LightweightDispatcher.dispatchEvent(Container.java:4417)\n\tat java.awt.Container.dispatchEventImpl(Container.java:2273)\n\tat java.awt.Window.dispatchEventImpl(Window.java:2719)\n\tat java.awt.Component.dispatchEvent(Component.java:4687)\n\tat java.awt.EventQueue.dispatchEventImpl(EventQueue.java:735)\n\tat java.awt.EventQueue.access$200(EventQueue.java:103)\n\tat java.awt.EventQueue$3.run(EventQueue.java:694)\n\tat java.awt.EventQueue$3.run(EventQueue.java:692)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.security.ProtectionDomain$1.doIntersectionPrivilege(ProtectionDomain.java:76)\n\tat java.security.ProtectionDomain$1.doIntersectionPrivilege(ProtectionDomain.java:87)\n\tat java.awt.EventQueue$4.run(EventQueue.java:708)\n\tat java.awt.EventQueue$4.run(EventQueue.java:706)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.security.ProtectionDomain$1.doIntersectionPrivilege(ProtectionDomain.java:76)\n\tat java.awt.EventQueue.dispatchEvent(EventQueue.java:705)\n\tat java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:242)\n\tat java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:161)\n\tat java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:150)\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:146)\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:138)\n\tat java.awt.EventDispatchThread.run(EventDispatchThread.java:91)\nCaused by: java.lang.RuntimeException: Couldn't instantiate the class for type with id 5000 on class class org.apache.poi.hslf.record.DummyPositionSensitiveRecordWithChildren : java.lang.reflect.InvocationTargetException\nCause was : java.lang.RuntimeException: Couldn't instantiate the class for type with id 5002 on class class org.apache.poi.hslf.record.DummyPositionSensitiveRecordWithChildren : java.lang.reflect.InvocationTargetException\nCause was : java.lang.RuntimeException: Couldn't instantiate the class for type with id 5003 on class class org.apache.poi.hslf.record.BinaryTagDataBlob : java.lang.reflect.InvocationTargetException\nCause was : java.lang.RuntimeException: Couldn't instantiate the class for type with id 4012 on class class org.apache.poi.hslf.record.StyleTextProp9Atom : java.lang.reflect.InvocationTargetException\nCause was : java.lang.ArrayIndexOutOfBoundsException: 56\n\tat org.apache.poi.hslf.record.Record.createRecordForType(Record.java:185)\n\tat org.apache.poi.hslf.record.Record.findChildRecords(Record.java:128)\n\tat org.apache.poi.hslf.model.SimpleShape.getClientRecords(SimpleShape.java:347)\n\tat org.apache.poi.hslf.model.SimpleShape.getClientDataRecord(SimpleShape.java:319)\n\tat org.apache.poi.hslf.model.TextShape.getPlaceholderAtom(TextShape.java:591)\n\tat org.apache.poi.hslf.model.Sheet.getPlaceholder(Sheet.java:438)\n\tat org.apache.poi.hslf.model.HeadersFooters.isVisible(HeadersFooters.java:244)\n\tat org.apache.poi.hslf.model.HeadersFooters.isHeaderVisible(HeadersFooters.java:148)\n\tat org.apache.tika.parser.microsoft.HSLFExtractor.parse(HSLFExtractor.java:62)\n\tat org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:189)\n\tat org.apache.tika.parser.microsoft.OfficeParser.parse(OfficeParser.java:161)\n\tat org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:242)\n\t... 42 more\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.GeneratedConstructorAccessor12.newInstance(Unknown Source)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n\tat org.apache.poi.hslf.record.Record.createRecordForType(Record.java:181)\n\t... 53 more\nCaused by: java.lang.RuntimeException: Couldn't instantiate the class for type with id 5002 on class class org.apache.poi.hslf.record.DummyPositionSensitiveRecordWithChildren : java.lang.reflect.InvocationTargetException\nCause was : java.lang.RuntimeException: Couldn't instantiate the class for type with id 5003 on class class org.apache.poi.hslf.record.BinaryTagDataBlob : java.lang.reflect.InvocationTargetException\nCause was : java.lang.RuntimeException: Couldn't instantiate the class for type with id 4012 on class class org.apache.poi.hslf.record.StyleTextProp9Atom : java.lang.reflect.InvocationTargetException\nCause was : java.lang.ArrayIndexOutOfBoundsException: 56\n\tat org.apache.poi.hslf.record.Record.createRecordForType(Record.java:185)\n\tat org.apache.poi.hslf.record.Record.findChildRecords(Record.java:128)\n\tat org.apache.poi.hslf.record.DummyPositionSensitiveRecordWithChildren.<init>(DummyPositionSensitiveRecordWithChildren.java:52)\n\t... 57 more\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.GeneratedConstructorAccessor12.newInstance(Unknown Source)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n\tat org.apache.poi.hslf.record.Record.createRecordForType(Record.java:181)\n\t... 59 more\nCaused by: java.lang.RuntimeException: Couldn't instantiate the class for type with id 5003 on class class org.apache.poi.hslf.record.BinaryTagDataBlob : java.lang.reflect.InvocationTargetException\nCause was : java.lang.RuntimeException: Couldn't instantiate the class for type with id 4012 on class class org.apache.poi.hslf.record.StyleTextProp9Atom : java.lang.reflect.InvocationTargetException\nCause was : java.lang.ArrayIndexOutOfBoundsException: 56\n\tat org.apache.poi.hslf.record.Record.createRecordForType(Record.java:185)\n\tat org.apache.poi.hslf.record.Record.findChildRecords(Record.java:128)\n\tat org.apache.poi.hslf.record.DummyPositionSensitiveRecordWithChildren.<init>(DummyPositionSensitiveRecordWithChildren.java:52)\n\t... 63 more\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.GeneratedConstructorAccessor11.newInstance(Unknown Source)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n\tat org.apache.poi.hslf.record.Record.createRecordForType(Record.java:181)\n\t... 65 more\nCaused by: java.lang.RuntimeException: Couldn't instantiate the class for type with id 4012 on class class org.apache.poi.hslf.record.StyleTextProp9Atom : java.lang.reflect.InvocationTargetException\nCause was : java.lang.ArrayIndexOutOfBoundsException: 56\n\tat org.apache.poi.hslf.record.Record.createRecordForType(Record.java:185)\n\tat org.apache.poi.hslf.record.Record.findChildRecords(Record.java:128)\n\tat org.apache.poi.hslf.record.BinaryTagDataBlob.<init>(BinaryTagDataBlob.java:52)\n\t... 69 more\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n\tat org.apache.poi.hslf.record.Record.createRecordForType(Record.java:181)\n\t... 71 more\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 56\n\tat org.apache.poi.util.LittleEndian.getInt(LittleEndian.java:163)\n\tat org.apache.poi.hslf.record.StyleTextProp9Atom.<init>(StyleTextProp9Atom.java:70)\n\t... 76 more\n\n\n\n--\nThis message was sent by Atlassian JIRA\n(v6.1#6144)", "id": 170957, "time": "2013-11-01T07:33:56Z", "creator": "aimdev@mail.com", "creation_time": "2013-11-01T07:33:56Z", "is_private": false}, {"count": 1, "attachment_id": 31329, "creator": "marcel.pokrandt@vgb.org", "is_private": false, "id": 173352, "time": "2014-02-19T10:02:44Z", "bug_id": 55732, "creation_time": "2014-02-19T10:02:44Z", "tags": [], "text": "Created attachment 31329\nerrornous PPT-File - just textarea\n\nstore in \ntest-data\\document"}, {"count": 2, "tags": [], "bug_id": 55732, "text": "Created attachment 31330\nsuggested patch\n\nstore in\nsrc\\scratchpad\\src\\org\\apache\\poi\\hslf\\record", "id": 173353, "time": "2014-02-19T10:04:14Z", "creator": "marcel.pokrandt@vgb.org", "creation_time": "2014-02-19T10:04:14Z", "is_private": false, "attachment_id": 31330}, {"count": 3, "tags": [], "text": "Created attachment 31331\nsuggested testcase\n\nstore in\nsrc\\testcases\\org\\apache\\poi\\hslf\\model", "attachment_id": 31331, "bug_id": 55732, "id": 173354, "time": "2014-02-19T10:05:01Z", "creator": "marcel.pokrandt@vgb.org", "creation_time": "2014-02-19T10:05:01Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 55732, "text": "I can confirm this bug with my own old \u00b497 PPT which contains nothing more than an empty Text-Area.\n\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 20\n\tat org.apache.poi.util.LittleEndian.getInt(LittleEndian.java:161)\n\tat org.apache.poi.hslf.record.StyleTextProp9Atom.<init>(StyleTextProp9Atom.java:70)\n\t... 65 more\n\n\nI made a small test-case (attached) and a suggested solution (attached too) as a patch of class org.apache.poi.hslf.record.StyleTextProp9Atom. Before reading the (not used) fields textCfException9 and textSiException I check if the offset is already behind the array size. \n\nif (i >= data.length) {\n      break;\n}\n        \t\nSince both fields are NOT used anywhere I think it should be safe to skip reading them in this case. With my patch two of my checked files with same error succeed to parse and I could extract text.\n\n\nI would really appreciate if you could integrate this patch because I\u00b4m using poi/tika for indexing a great bunch of office files and a lot of them seem to fail because of the same error.", "id": 173355, "time": "2014-02-19T10:07:23Z", "creator": "marcel.pokrandt@vgb.org", "creation_time": "2014-02-19T10:07:23Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "kiwiwings@apache.org", "attachment_id": null, "text": "Thank you for the patch.\nCommitted with SVN ver r1569984\nand because the original file still failed - another check was necessary - r1569999", "id": 173385, "time": "2014-02-20T00:05:52Z", "bug_id": 55732, "creation_time": "2014-02-20T00:05:52Z", "is_private": false}]
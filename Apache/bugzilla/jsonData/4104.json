[{"count": 0, "tags": [], "creator": "vicentesalvador@netscape.net", "attachment_id": null, "id": 6586, "time": "2001-10-11T06:06:19Z", "bug_id": 4104, "creation_time": "2001-10-11T06:06:19Z", "is_private": false, "text": "At the end of the method we have:\n\nrequestURI = savedRequestURL(session);\nif (debug >= 1)\n   log(\"Redirecting to original '\" + requestURI + \"'\");\nhres.sendRedirect(hres.encodeRedirectURL(requestURI));\nreturn (false);\n\nBut the savedRequestURL can return null.\nSteps to reproduce:\n1. open the browser and type the UTL when the login form page resides:\n   http://myserver:8080/login/login.jsp\n\n2.Authenticate correctly and then the servers redirects you to:\n  http://myserver:8080/null\nI know that this is not usual but we need a method to detect this, and redirect\nto a proper URL. Maybe this URL can be setted by a property param. If not\npossible, a 4.0.1 timeframe patch could be:\n\nrequestURI = savedRequestURL(session);\nif (debug >= 1)\n   log(\"Redirecting to original '\" + requestURI + \"'\");\nif (requestURL == null)\n    requestURL = \"\";\nhres.sendRedirect(hres.encodeRedirectURL(requestURI));\nreturn (false);\n\nI've not tested this patch but it should work;"}, {"count": 1, "tags": [], "bug_id": 4104, "attachment_id": null, "text": "Same issue as 3839.\n\n*** This bug has been marked as a duplicate of 3839 ***", "id": 6595, "time": "2001-10-11T09:06:16Z", "creator": "remm@apache.org", "creation_time": "2001-10-11T09:06:16Z", "is_private": false}, {"count": 2, "tags": [], "creator": "craig.mcclanahan@sun.com", "attachment_id": null, "id": 6599, "time": "2001-10-11T09:33:21Z", "bug_id": 4104, "creation_time": "2001-10-11T09:33:21Z", "is_private": false, "text": "It is not valid for an application to directly reference the form login page. \nI'm going to be changing the authenticator to return a BAD_REQUEST error status\ninstead of a meaningless 404 for the \"/null\" page to make this more clear to\napplication users.\n"}, {"count": 3, "tags": [], "creator": "craig.mcclanahan@sun.com", "attachment_id": null, "id": 6605, "time": "2001-10-11T15:58:43Z", "bug_id": 4104, "creation_time": "2001-10-11T15:58:43Z", "is_private": false, "text": "Changed (as I described earlier) in nightly build 20011012.  Will be changed in\n4.0.1 final release also (after confirming it was OK with Remy).\n"}, {"count": 4, "tags": [], "bug_id": 4104, "attachment_id": null, "text": "I think it is very useful, in some cases, to have the login page referenced \ndirectly. For example if a web application needs a to show login form on a main \npage (is not a login page itself). The login form has text inputs j_username \nand j_password and will be submitted directly to j_security_check. In this case \nthe /null page is returned to the user, as in case if login page were \nreferenced directly.\n\nI think that the best solution for this would be to have another parameter in \nweb.xml \"form-login-config\" section. The parameter specifies the page, which \nwill be returned if the login page were referenced directly and the login \nsucceeded. But beacuse the servlet 2.3 specification doesn't say anything about \nit, then it does break the compatibility.\n\nAnother solution would be to redirected the user to the default page. If the \nrequestURI is null then the Tomcat checks if the catalog of the login page has \na default page. If the default page is present, then redirects the user to that \npage, else returns the BAD_REQUEST response. This solution raises the question: \nhow to find the URI of the default page of the resource? I searched for this in \nthe Servlet API and didn't find a clear answer. Maybe the RequestDispather \ncould be used for this?\n\nI know this bug is also present in Tomcat 3.2.2 (#4048). And at the moment I \nsolved this by defining a /null mapping in web.xml. The servlet behind this \nmapping redirects the users to a default page.\nFor example:\n   <servlet>\n        <servlet-name>\n            NullRedirector\n        </servlet-name>\n        <servlet-class>\n           package.NullRedirector\n        </servlet-class>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>\n            NullRedirector\n        </servlet-name>\n        <url-pattern>\n            /login/null\n        </url-pattern>\n    </servlet-mapping>\n\nOf course this is a bad solution, but I didn't find any better. But if in the \nfuture the BAD_REQUEST response will be returned, then I can't see any solution \nto have the this functionality? \n\nI also read Craig's comment (bug #3839) that swiching to BASIC authentication \nwould break the application functionality if the login form is hyperlinked by \napps pages. But in my case it is nessesary to have a login form on the main \npage of my application. \n\nOf course another solution would be to build the authentication/authorization \nlogin into web application, so the problem could be solved, but in this way I \ncan't use many features of the Web container, for example: have the username \nreturned by calling the request.getRemoteUser(), have the username logged in \nlog file, etc...", "id": 6608, "time": "2001-10-12T01:56:12Z", "creator": "Tonu.Poeld@andmevara.ee", "creation_time": "2001-10-12T01:56:12Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 4104, "attachment_id": null, "text": "It doesn't matter how useful or non-useful the proposed solution would be when\nit violates the Servlet Spec, and applications that depended on it would not be\nportable to any other servlet container.\n\nIf you don't like the way form based login works, the proper avenue is through\nmodifying the next version of the spec (which will translate into changes in the\nbehavior of Tomcat, and all other implementations).\n\nOtherwise, you have the alternative to build authentication and access control\ninto your application.  Using the new Filter APIs, you have the opportunity to\ndo this without giving up the use of request.getRemoteUser() and\nrequest.isUserInRole(), because you can wrap the incoming request before passing\nit on to the servlet.\n", "id": 6633, "time": "2001-10-12T08:50:36Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-10-12T08:50:36Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 4104, "attachment_id": null, "text": "They say that Weblogic server returns the default page in this case. Returning \nthe default page doesn't violate the Servlet spec either, because the spec \ndoesn't state how to handle this situation? See bug #1861 comments.", "id": 6673, "time": "2001-10-13T04:48:38Z", "creator": "Tonu.Poeld@andmevara.ee", "creation_time": "2001-10-13T04:48:38Z", "is_private": false}]
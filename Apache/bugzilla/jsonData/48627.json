[{"count": 0, "tags": [], "creator": "mhn4dev@googlemail.com", "text": "I recently updated from Tomcat 6.0.20 to 6.0.24.\nNow some jsps with jsf tags are not compiling anymore.\n\nFollowing tag results in a JasperException in 6.0.24 but compiles fine with older versions:\n\n<h:outputText value=\"\\\\\">\n\nStack:\nCaused by: org.apache.jasper.JasperException: /pages/preferences.jsp(147,100) According to TLD or attribute directive in tag file, attribute value does not accept any expressions\n                at org.apache.jasper.compiler.DefaultErrorHandler.jspError(DefaultErrorHandler.java:40)\n                at org.apache.jasper.compiler.ErrorDispatcher.dispatch(ErrorDispatcher.java:407)\n                at org.apache.jasper.compiler.ErrorDispatcher.jspError(ErrorDispatcher.java:148)\n                at org.apache.jasper.compiler.Validator$ValidateVisitor.checkXmlAttributes(Validator.java:1165)\n                at org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:852)\n                at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1530)\n                at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2361)\n                at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2411)\n                at org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:871)\n                at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1530)\n                at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2361)\n                at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2411)\n                at org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:871)\n                at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1530)\n                at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2361)\n                at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2411)\n                at org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:871)\n                at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1530)\n                at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2361)\n                at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2411)\n                at org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:871)\n                at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1530)\n                at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2361)\n                at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2411)\n                at org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:871)\n                at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1530)\n                at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2361)\n                at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2411)\n                at org.apache.jasper.compiler.Validator$ValidateVisitor.visit(Validator.java:871)\n                at org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1530)\n                at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2361)\n                at org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2411)\n                at org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2417)\n                at org.apache.jasper.compiler.Node$Root.accept(Node.java:495)\n                at org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2361)\n                at org.apache.jasper.compiler.Validator.validateExDirectives(Validator.java:1775)\n                at org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:183)\n                at org.apache.jasper.compiler.Compiler.compile(Compiler.java:332)\n                at org.apache.jasper.compiler.Compiler.compile(Compiler.java:312)\n                at org.apache.jasper.compiler.Compiler.compile(Compiler.java:299)\n                at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:589)\n                at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:317)\n                at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)\n                at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\n                at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n                at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\n                at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n                at org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:646)\n                at org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:551)\n                at org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:488)\n                at org.apache.jasper.runtime.JspRuntimeLibrary.include(JspRuntimeLibrary.java:968)\n                at org.apache.jasper.runtime.PageContextImpl.doInclude(PageContextImpl.java:650)\n                at org.apache.jasper.runtime.PageContextImpl.include(PageContextImpl.java:644)\n                at org.apache.tiles.jsp.context.JspTilesRequestContext.include(JspTilesRequestContext.java:80)\n                ... 67 more", "id": 133968, "time": "2010-01-27T00:28:18Z", "bug_id": 48627, "creation_time": "2010-01-27T00:28:18Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 48627, "is_private": false, "id": 133979, "time": "2010-01-27T16:58:01Z", "creator": "jonv-gen1@jmv.com", "creation_time": "2010-01-27T16:58:01Z", "tags": [], "text": "We're also hitting this since upgrading to 6.0.24 -- in our case, the attribute value also contains a '\\' character.\n\nI'm updating the platform to \"All\" since we're running on various OS combinations and have seen the issue on both Windows and Mac so far. I also upgraded severity to \"major\" since it's a significant loss of functionality for those of us who do hit it. :)"}, {"attachment_id": null, "tags": [], "bug_id": 48627, "text": "I have been able to reproduce this and have added a test case for it to Tomcat 7. I know exactly what caused it. My recent changes to address a number of issues with EL parsing made the incorrect assumption that EL would be valid for any attribute. Clearly that isn't a valid assumption.\n\nI agree this is a nasty regression and I am working on a fix. Once I have a fix are either of you willing and able to test it? You'll either need to build Tomcat from source or I can provide a binary patch.", "count": 2, "id": 134005, "time": "2010-01-28T15:38:13Z", "creator": "markt@apache.org", "creation_time": "2010-01-28T15:38:13Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jonv-gen1@jmv.com", "text": "Yeah, I'd be happy to test it. Thanks!", "id": 134008, "time": "2010-01-28T16:39:19Z", "bug_id": 48627, "creation_time": "2010-01-28T16:39:19Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "mhn4dev@googlemail.com", "text": "I can also test it but I need a binary patch", "id": 134011, "time": "2010-01-28T23:59:11Z", "bug_id": 48627, "creation_time": "2010-01-28T23:59:11Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 48627, "text": "Created attachment 24910\nBinary patch for testing purposes only\n\nThis has been fixed in trunk and proposed for 6.0.x.\n\nTo test if you are happy build from source, checkout tc6.0.x/trunk and apply this patch before building: http://svn.apache.org/viewvc?view=revision&revision=904949\n\nTo test with the binary patch, make the following changes to a 6.0.24 installation:\n\n1. Create the following directory structure in $CATALINA_HOME/lib\norg/apache/jasper/compiler\n\n2. Download the binary patch attachment and extract the 2 class files to the directory you created in step 1.\n\nYou should now have:\n$CATALINA_HOME/lib/org/apache/jasper/compiler/AttributeParser.class\n$CATALINA_HOME/lib/org/apache/jasper/compiler/Parser.class\n\n3. Empty the $CATALINA_BASE/work directory\n\n4. Start Tomcat\n\nPlease be aware that this patch in both source and binary form is for testing purposes only and is not an official release from the ASF.\n\nLet us know how you get on. Thanks in advance.", "id": 134055, "time": "2010-01-30T17:56:27Z", "creator": "markt@apache.org", "creation_time": "2010-01-30T17:56:27Z", "is_private": false, "attachment_id": 24910}, {"count": 6, "attachment_id": null, "bug_id": 48627, "is_private": false, "id": 134112, "time": "2010-02-01T13:38:57Z", "creator": "jonv-gen1@jmv.com", "creation_time": "2010-02-01T13:38:57Z", "tags": [], "text": "The fix worked perfectly for me. I took your binary patch to make things a little faster -- let me know if you need extra verification and I can build it from source.\n\nThanks Mark!"}, {"count": 7, "tags": [], "creator": "mhn4dev@googlemail.com", "text": "The initial JasperException does not occur anymore but I got a new one.\nMaybe the patch is not fully compatible?\n\nCaused by: java.lang.NoSuchMethodError: org.apache.jasper.compiler.PageInfo.isErrorOnUndeclaredNamespace()Z\n\tat org.apache.jasper.compiler.Parser.parseCustomTag(Parser.java:1175)\n\tat org.apache.jasper.compiler.Parser.parseElements(Parser.java:1422)\n\tat org.apache.jasper.compiler.Parser.parse(Parser.java:131)\n\tat org.apache.jasper.compiler.ParserController.doParse(ParserController.java:255)\n\tat org.apache.jasper.compiler.ParserController.parse(ParserController.java:103)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:170)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:332)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:312)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:299)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:589)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:317)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:646)\n\tat org.apache.catalina.core.ApplicationDispatcher.doInclude(ApplicationDispatcher.java:551)\n\tat org.apache.catalina.core.ApplicationDispatcher.include(ApplicationDispatcher.java:488)\n\tat org.apache.jasper.runtime.JspRuntimeLibrary.include(JspRuntimeLibrary.java:968)\n\tat org.apache.jasper.runtime.PageContextImpl.doInclude(PageContextImpl.java:650)\n\tat org.apache.jasper.runtime.PageContextImpl.include(PageContextImpl.java:644)\n\tat org.apache.tiles.jsp.context.JspTilesRequestContext.include(JspTilesRequestContext.java:80)\n\t... 93 more\nCause:", "id": 134122, "time": "2010-02-02T01:28:01Z", "bug_id": 48627, "creation_time": "2010-02-02T01:28:01Z", "is_private": false, "attachment_id": null}, {"count": 8, "attachment_id": null, "bug_id": 48627, "is_private": false, "id": 134123, "time": "2010-02-02T01:38:19Z", "creator": "markt@apache.org", "creation_time": "2010-02-02T01:38:19Z", "tags": [], "text": "(In reply to comment #7)\n> The initial JasperException does not occur anymore but I got a new one.\n> Maybe the patch is not fully compatible?\n> \n> Caused by: java.lang.NoSuchMethodError:\n> org.apache.jasper.compiler.PageInfo.isErrorOnUndeclaredNamespace()Z\n\nThat method was introduced in Tomcat 7. \n>     at org.apache.jasper.compiler.Parser.parseCustomTag(Parser.java:1175)\n>     at org.apache.jasper.compiler.Parser.parseElements(Parser.java:1422)\n>     at org.apache.jasper.compiler.Parser.parse(Parser.java:131)\n\nand these line numbers are Tomact 7 line numbers.\n\nThe binary patch is only intended for testing with Tomcat 6.0.24."}, {"count": 9, "tags": [], "creator": "markt@apache.org", "text": "(In reply to comment #6)\n> The fix worked perfectly for me. I took your binary patch to make things a\n> little faster -- let me know if you need extra verification and I can build it\n> from source.\n> \n> Thanks Mark!\n\nThanks for the testing. I'll add a note to the STATUS file.", "id": 134124, "time": "2010-02-02T01:40:19Z", "bug_id": 48627, "creation_time": "2010-02-02T01:40:19Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "mhn4dev@googlemail.com", "attachment_id": null, "id": 134125, "time": "2010-02-02T01:49:36Z", "bug_id": 48627, "creation_time": "2010-02-02T01:49:36Z", "is_private": false, "text": "I don't have Tomcat 7, I wasn't even aware of it. \nI am using 6.0.24 and used the binary patch applied to this bug."}, {"count": 11, "tags": [], "creator": "mhn4dev@googlemail.com", "text": "I decompiled the patch and it contains this line:\n  if(pageInfo.isErrorOnUndeclaredNamespace())", "id": 134126, "time": "2010-02-02T01:53:39Z", "bug_id": 48627, "creation_time": "2010-02-02T01:53:39Z", "is_private": false, "attachment_id": null}, {"count": 12, "attachment_id": 24925, "bug_id": 48627, "is_private": false, "id": 134219, "time": "2010-02-04T04:47:49Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-02-04T04:47:49Z", "tags": [], "text": "Created attachment 24925\nUpdated source patch for Tomcat 6.0\n\nUpdated patch for Tomcat 6.0.24.\nIt is the result of merging revisions 904949, 905226, 906465 from trunk."}, {"count": 13, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "Created attachment 24926\nUpdated binary patch for Tomcat 6.0.24 for testing purposes only\n\nUpdated binary patch for Tomcat 6.0.24 that corresponds to the source patch from attachment 24925\n\nIts usage is subject to the conditions stated in Comment 5.\n\nPlease be aware that this patch in both source and binary form is for testing purposes only and is not an official release from the ASF.", "id": 134220, "time": "2010-02-04T05:03:48Z", "bug_id": 48627, "creation_time": "2010-02-04T05:03:48Z", "is_private": false, "attachment_id": 24926}, {"count": 14, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 134850, "time": "2010-02-24T09:17:07Z", "bug_id": 48627, "creation_time": "2010-02-24T09:17:07Z", "is_private": false, "text": "This has been fixed in 6.0.x and will be included in 6.0.25 onwards."}]
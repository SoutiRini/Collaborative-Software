[{"count": 0, "tags": [], "bug_id": 20183, "attachment_id": null, "id": 37670, "time": "2003-05-23T12:44:08Z", "creator": "marcus.janson@tre.se", "creation_time": "2003-05-23T12:44:08Z", "is_private": false, "text": "Hi!\n\nIn my project we use Apache 2.0.45 as front-end to proxy certain requests to a \nbackend HTTP server. We also use the ErrorDocument feature of Apache for \npredefined error pages. \n\nWhen using range requests and ErrorDocument in conjunction we see some strange \nbehaviour, all 20* responses from the backend HTTP server other than 200 OK are \nhandled as errors by Apache. When the backend HTTP server for example returns a \n206 PARTIAL CONTENT the Apache returns the ErrorDocument to the user.\nThis behaviour has been verified by running telnet to port 80 on both Apache \nand the HTTP backend server.\n\nI had a quick peek in the code for proxy_http.c and I think I found what's \ncausing this problem:\n\n(line 984-987)\n..\nif ( conf->error_override ) {\n    /* the code above this checks for 'OK' which is what the hook expects */\n    if ( r->status == HTTP_OK)\n        return OK;\n..\n\nI changed the r->status == HTTP_OK to check for 200-206 HTTP responses, \ncompiled and it seems to work now. \n\nCheers\n\n/Marcus Janson\n<-- tre.se -->"}, {"count": 1, "attachment_id": null, "creator": "jorton@redhat.com", "is_private": false, "id": 53883, "time": "2004-03-11T17:24:01Z", "bug_id": 20183, "creation_time": "2004-03-11T17:24:01Z", "tags": [], "text": "Thanks for tracking that down; I've committed a complete fix here:\n\nhttp://cvs.apache.org/viewcvs.cgi/httpd-2.0/modules/proxy/proxy_http.c?r1=1.183&r2=1.184"}, {"count": 2, "tags": [], "text": "I'm reopening this because I'm running into a similar related issue.\n\nI'm using rewrite rules and proxying along with an ErrorDocument to do a load \nbalancing configuration with failover when the proxy request fails.  If the \nproxy can't hit the server and returns a 502, I use an ErrorDocument to force a \nredirect to the same URL after changing a cookie that tells it to try another \nserver out of a rewrite map. \n\nThe problem is that the 302 redirect is being treated as an error and \nsubsequent requests never reach my ErrorDocument handler.  When I read this \nreport it sounds as if the patch was to treat anything other than 2xx as an \nerror.  Is a redirect truly an error?  If so, then the only way I can achieve \nwhat I'm attempting is to send a 200 response with a META-REFRESH tag. \n\nI believe the code in http_request.c in ap_die() has the same issue where it \nchecks if r->status != HTTP_OK.", "is_private": false, "id": 55849, "creator": "byron.guernsey@ge.com", "time": "2004-04-15T19:18:13Z", "bug_id": 20183, "creation_time": "2004-04-15T19:18:13Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "I'm recanting my comments below.  The error I encountered was due to a bad \nrewrite rule that generated an additional 502 in the ErrorDocument script.  The \n302's are being treated correctly.  Thanks and sorry for reopening this one.\n", "attachment_id": null, "id": 55854, "creator": "byron.guernsey@ge.com", "time": "2004-04-15T20:44:01Z", "bug_id": 20183, "creation_time": "2004-04-15T20:44:01Z", "is_private": false}]
[{"count": 0, "attachment_id": null, "creator": "mguillemot@yahoo.fr", "is_private": false, "id": 72784, "time": "2005-03-24T14:37:36Z", "bug_id": 34164, "creation_time": "2005-03-24T14:37:36Z", "tags": [], "text": "In Tomcat 5.5.7, the context attributes seem to have been removed before the\nmethod destroy() of the loaded servlets is called. This is not the case with\nTomcat 5.0.28 and I guess that it is wrong because Struts for instance relies on\nit to destroy its modules (in\norg.apache.struts.action.ActionServlet#destroyModules).\n\nIn the case of struts, this causes the plugins not to be notified that they are\ndestroyed what is against their expected behavior.\n\nA simple servlet illustrates the problem:\n\npublic class TestServlet extends HttpServlet\n{\n  public void init() throws ServletException\n  {\n    log(\"In init TestServlet\");\n    getServletContext().setAttribute(\"test\", \"test\");\n    log(\"Attribute test: \" + getServletContext().getAttribute(\"test\"));\n  }\n\n  public void destroy()\n  {\n    log(\"In destroy TestServlet\");\n    log(\"Attribute test: \" + getServletContext().getAttribute(\"test\"));\n    super.destroy();\n  }\n}\n\nConfigured with:\n  <servlet>\n    <servlet-name>test</servlet-name>\n    <description>Custom test</description>\n    <servlet-class>de.internetzky.test.TestServlet</servlet-class>\n    <load-on-startup>2</load-on-startup>\n  </servlet>\n\t\n\n  <servlet-mapping>\n    <servlet-name>test</servlet-name>\n    <url-pattern>/foo/*</url-pattern>\n  </servlet-mapping>\n\nGives following output in Tomcat 5.5.7:\n\nINFO main org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/test]\n- test: In init TestServlet\n INFO main org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/test]\n- test: Attribute test: test\n\nINFO http-8080-Processor24\norg.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/test] - test: In\ndestroy TestServlet\n INFO http-8080-Processor24\norg.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/test] - test:\nAttribute test: null\n\nbut in Tomcat 5.0.28:\nStandardContext[/test]test: In init TestServlet\nStandardContext[/test]test: Attribute test: test\n\nStandardContext[/test]test: In destroy TestServlet\nStandardContext[/test]test: Attribute test: test"}, {"count": 1, "attachment_id": null, "creator": "remm@apache.org", "is_private": false, "id": 72785, "time": "2005-03-24T14:41:24Z", "bug_id": 34164, "creation_time": "2005-03-24T14:41:24Z", "tags": [], "text": "\n\n*** This bug has been marked as a duplicate of 33463 ***"}]
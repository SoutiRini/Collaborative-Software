[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "text": "This is a rare minor issue that I encountered when testing 7.0.56 release candidate.\n\nPlatform: Windows 7, 32-bit JDK 6u45 + 7u67.\n\nI encountered it when running the whole testsuite. After that I did ~50 runs in a loop of this specific test with all 3 connectors with\n\ntest.entry=org.apache.tomcat.websocket.TestWsWebSocketContainer\ntest.entry.methods=testSmallTextBufferClientTextMessage\n\nThe issue reproduced 2 times with NIO, 1 time with APR and 1 time with BIO - all from 50x3 connectors runs.\n\nStacktraces are the same (it is websocket client's stacktrace, it does not depend on server side). This one is from running with NIO:\n\n[[[\nTestcase: testSmallTextBufferClientTextMessage took 2,587 sec\n\tCaused an ERROR\njava.util.concurrent.ExecutionException: java.io.IOException: Unable to write the complete message as the WebSocket connection has been closed\njava.io.IOException: java.util.concurrent.ExecutionException: java.io.IOException: Unable to write the complete message as the WebSocket connection has been closed\n\tat org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendPartialString(WsRemoteEndpointImplBase.java:229)\n\tat org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendString(WsRemoteEndpointImplBase.java:172)\n\tat org.apache.tomcat.websocket.WsRemoteEndpointBasic.sendText(WsRemoteEndpointBasic.java:37)\n\tat org.apache.tomcat.websocket.TestWsWebSocketContainer.doBufferTest(TestWsWebSocketContainer.java:256)\n\tat org.apache.tomcat.websocket.TestWsWebSocketContainer.testSmallTextBufferClientTextMessage(TestWsWebSocketContainer.java:156)\nCaused by: java.util.concurrent.ExecutionException: java.io.IOException: Unable to write the complete message as the WebSocket connection has been closed\n\tat org.apache.tomcat.websocket.FutureToSendHandler.get(FutureToSendHandler.java:102)\n\tat org.apache.tomcat.websocket.WsRemoteEndpointImplBase.sendPartialString(WsRemoteEndpointImplBase.java:224)\nCaused by: java.io.IOException: Unable to write the complete message as the WebSocket connection has been closed\n\tat org.apache.tomcat.websocket.WsSession.doClose(WsSession.java:447)\n\tat org.apache.tomcat.websocket.WsSession.close(WsSession.java:418)\n\tat org.apache.tomcat.websocket.WsFrameClient.close(WsFrameClient.java:86)\n\tat org.apache.tomcat.websocket.WsFrameClient.access$300(WsFrameClient.java:26)\n\tat org.apache.tomcat.websocket.WsFrameClient$WsFrameClientCompletionHandler.completed(WsFrameClient.java:115)\n\tat org.apache.tomcat.websocket.WsFrameClient$WsFrameClientCompletionHandler.completed(WsFrameClient.java:100)\n\tat sun.nio.ch.Invoker.invokeUnchecked(Invoker.java:126)\n\tat sun.nio.ch.Invoker$2.run(Invoker.java:218)\n\tat sun.nio.ch.AsynchronousChannelGroupImpl$1.run(AsynchronousChannelGroupImpl.java:112)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:745)\n]]]\n\n(The stack traces look a bit confusing, because they span Future and different threads. The main one is at the top, in \"WsRemoteEndpointImplBase.sendPartialString()\").\n\nMy assessment\n==============\nI think that this is a variant of expected behaviour.\n\nThe test case testSmallTextBufferClientTextMessage is essentially a call to\n{\n doBufferTest(true, false, true, false);\n}\nwhere 4th argument is pass:=false. It is expected to fail.", "id": 178210, "time": "2014-09-30T22:20:55Z", "bug_id": 57047, "creation_time": "2014-09-30T22:20:55Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "markt@apache.org", "is_private": false, "id": 178741, "time": "2014-10-24T22:47:20Z", "bug_id": 57047, "creation_time": "2014-10-24T22:47:20Z", "tags": [], "text": "I've ported the fix from trunk that should address this."}]
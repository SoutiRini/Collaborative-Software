[{"count": 0, "tags": [], "bug_id": 56293, "text": "Since Tomcat 7.0.28, the WebappClassLoader does not cache any resources on the classpath except .class and .properties files (see https://issues.apache.org/bugzilla/show_bug.cgi?id=53081).\nThis leads to a massive performance problem in applications that contain .jars on the classpath that use the ServiceLoader mechanism of Java 6 to bind concrete XML readers and writers to their respective interfaces, since every time the concrete instance is loaded, the WebappClassLoader has to open the .jar to read which concrete implementation is used.\nA possible solution might be that caching is enabled for all resources that reside in the META-INF/services folder.", "id": 173968, "time": "2014-03-20T09:53:08Z", "creator": "michael.thiele@saxsys.de", "creation_time": "2014-03-20T09:53:08Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 56293, "is_private": false, "text": "Neither the problem nor the solution appear to be that simple. Looking at the ServiceLoader code, the contents of META-INF/services aren't read using the method where the caching was removed.\n\nCan you put together a simple test case that demonstrates this issue?", "id": 173970, "time": "2014-03-20T11:18:21Z", "creator": "markt@apache.org", "creation_time": "2014-03-20T11:18:21Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 56293, "text": "Created attachment 31417\nExample .war and maven projects for the META-INF/services caching problem\n\nI have built a small example of what happens in our code.\nDeployment in Tomcat 7.0.27 and 7.0.28 should render different results (time needed is increased by factor 10 with META-INF/services) when accessing the root path, e.g., http://localhost:8080/tomcat.caching-0.0.1-SNAPSHOT/.", "id": 173979, "time": "2014-03-20T15:41:56Z", "creator": "michael.thiele@saxsys.de", "creation_time": "2014-03-20T15:41:56Z", "is_private": false, "attachment_id": 31417}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 173980, "time": "2014-03-20T17:01:20Z", "bug_id": 56293, "creation_time": "2014-03-20T17:01:20Z", "text": "Thanks for the test case. It appears that the ServiceLoader code isn't used and it is clear that the code path where caching was removed is used.\n\nI agree that caching the contents META-INF/services id probably the way to go but I think there will need to be some form of limit just in case there is a large file there for some strange reason. I'm looking into a fix now."}, {"count": 4, "tags": [], "bug_id": 56293, "text": "This has been fixed in 8.0.x for 8.0.5 onwards and in 7.0.x for 7.0.53 onwards.", "id": 174037, "time": "2014-03-23T20:44:32Z", "creator": "markt@apache.org", "creation_time": "2014-03-23T20:44:32Z", "is_private": false, "attachment_id": null}]
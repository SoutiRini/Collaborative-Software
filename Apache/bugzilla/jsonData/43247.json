[{"count": 0, "tags": [], "bug_id": 43247, "attachment_id": null, "id": 107454, "time": "2007-08-29T21:38:22Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-08-29T21:38:22Z", "is_private": false, "text": "I did a bit of investigation on this and ended up implementing a couple of\nthings I really didn't need to implement (we only need the binary, I ended up\nimplementing some of the embedding side of it too, before I had figured out\nwhere the binary actually was.)\n\nNew functionality:\n  HSLFSlideShow.getEmbeddedObjects, returns ObjectData[] similar to getPictures.\n\nNew record types:\n  ExEmbed\n  ExEmbedAtom\n  ExOleObjAtom\n  ExOleObjStg"}, {"count": 1, "tags": [], "bug_id": 43247, "attachment_id": 20735, "text": "Created attachment 20735\nProposed patch", "id": 107455, "time": "2007-08-29T21:38:39Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-08-29T21:38:39Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 43247, "text": "Created attachment 20736\nole2-embedding-2003.ppt\n\nAttaching my test file.", "id": 107456, "time": "2007-08-29T21:39:59Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-08-29T21:39:59Z", "is_private": false, "attachment_id": 20736}, {"attachment_id": 20737, "tags": [], "bug_id": 43247, "text": "Created attachment 20737\nTestOleEmbedding.java\n\nAttaching a simple unit test.", "count": 3, "id": 107457, "time": "2007-08-29T21:41:51Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-08-29T21:41:51Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 43247, "attachment_id": 20748, "text": "Created attachment 20748\nReviewed patch\n\nVarious fixes to the patch, spotted through code review by a second person.", "id": 107521, "time": "2007-08-30T18:06:31Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-08-30T18:06:31Z", "is_private": false}, {"count": 5, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "id": 107864, "time": "2007-09-08T09:13:42Z", "bug_id": 43247, "creation_time": "2007-09-08T09:13:42Z", "is_private": false, "text": "Patch applied. Thanks for it.\n\nHowever, I will close this bug only when I see unit tests for low-level record\nclasses:\n\nsrc/scratchpad/src/org/apache/poi/hslf/record/ExOleObjStg.java\nsrc/scratchpad/src/org/apache/poi/hslf/record/ExOleObjAtom.java\nsrc/scratchpad/src/org/apache/poi/hslf/record/ExEmbedAtom.java\nsrc/scratchpad/src/org/apache/poi/hslf/record/ExEmbed.java\n\nA minimal unit test should take a reference data from a ppt file and verify\ngetters/setters against it.\nSee unit tests in src/scratchpad/testcases/org/apache/poi/hslf/record and follow\nthe pattern.\n\nIdeas for further development:\n (1) it should be possible to access OLE object properties contained in ExEmbed\ncontainer.\nDid you figure out how to link ExOleObjStg and the corresponding ExEmbed? My\nguess is that the order of ExEmbed in\nDocument.ExObjList corresponds to the order of ExOleObjStg records. That is for\nthe 1st ExOleObjStg we take the 1st Document.ExObjList.ExEmbed, etc.\n\nAny thoughts?  \n \n (2)  I think OLE shapes should be instances of \n OLEObjectShape extends SimpleShape. \n\nUser code may look something like this:\n\nShape[] shape = slide.getShapes();\nfor (int i=0; i,shape.length; i++){\n  if(shape[i] instanceof OLEObjectShape){\n    OLEObjectShape obj = (OLEObjectShape)shape[i];\n    ObjectData data = obj.getObjectData();\n\n    //shoule be able to access object properties\n    String clipboardName = obj.getClipboardName();\n    if(clipboardName.equals(\"Microsoft Office Excel Worksheet\")){\n       //do something with the data\n    }    \n\n  }\n}\n\n (3) Can we construct a workbook or a presentation given the binary data\nretrieved from ObjectData.getData()?\n\n\nRegards,\nYegor\n"}, {"count": 6, "tags": [], "bug_id": 43247, "attachment_id": null, "text": "I'll see if I can get some time to make unit tests for those.  I'm not sure if I actually implemented setters \nso in theory I would only need to check that the getters return the expected values.  Only problem is \nthat I'm currently stuck working on something more important (I do all this stuff during office hours, so \nI can't easily choose to work on unit testing something we don't use ourselves.  Since we only actually \nended up using the method to get all the objects...)\n\nAs for the other suggestions...\n\n(1) I'm pretty sure you're right about the IDs, since the IDs are small numbers and there is no other \nobvious way for them to be referenced.  The OLE properties are inside the storage itself so any API that \ngoes as far as to allow access to them would need to load the whole filesystem from there.\n\n(2) Hmm... might not be a bad idea.  I was just following the code done for pictures for this stuff, but in \nthe event where the same object is embedded twice (I'm sure it must be possible since they're \nreferenced by ID) this would allow us to see where they are and eventually render them perhaps.  \nAlthough with regards to rendering, what I have found is that in the document there is also an EMF \nsnapshop of the OLE object embedded as an ordinary picture.  So it may be that it already renders \nproperly if anyone has written a renderer...\n\n(3) Yep.  Passing that InputStream straight into a POIFSFileSystem results in a working filesystem, which \ncan then be passed into whatever constructor is needed (although what we're doing is writing it to a \ntemporary location first, so that we can potentially read from it multiple times without having to re-get \nthe input stream.)  However what I have noticed is that in some cases, saving the InputStream to a file \ndoesn't allow the file to be opened in the actual Office application, even if POI's classes have no \nproblems accessing the contents.", "id": 107889, "time": "2007-09-08T22:51:01Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-09-08T22:51:01Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 43247, "attachment_id": null, "id": 107891, "creation_time": "2007-09-08T23:17:55Z", "time": "2007-09-08T23:17:55Z", "creator": "yegor@dinom.ru", "text": ">I'm currently stuck working on something more important\n\nNo rush. Just put it in your TODO list. \n\nYegor", "is_private": false}, {"count": 8, "tags": [], "bug_id": 43247, "attachment_id": null, "id": 115630, "creation_time": "2008-04-16T04:50:46Z", "time": "2008-04-16T04:50:46Z", "creator": "yegor@dinom.ru", "text": "Finally I can resolve it.\nI implemented OLEShape which extends Picture and can be used to retrieve the OLE data and some basic properties (progID, short and full names).\n\nThe usage is something like this:\n\nShape[] shape = slide.getShapes();\n        for (int i = 0; i < shape.length; i++) {\n            if (shape[i] instanceof OLEShape) {\n                OLEShape ole = (OLEShape) shape[i];\n                ObjectData data = ole.getObjectData();\n                String name = ole.getInstanceName();\n                if (\"Worksheet\".equals(name)) {\n                    HSSFWorkbook wb = new HSSFWorkbook(data.getData());\n                } else if (\"Document\".equals(name)) {\n                    HWPFDocument doc = new HWPFDocument(data.getData());\n                }\n            }\n        }\n\nRegards,\nYegor", "is_private": false}]
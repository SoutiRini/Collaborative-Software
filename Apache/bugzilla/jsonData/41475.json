[{"count": 0, "tags": [], "bug_id": 41475, "text": "Max OS X, Linux, Solaris\nApache: 2.2.4\n\nWhen an object is cached who's URL is url-escaped (containg spaces, etc),\nmod_cache will never serve the cached file because the key-lookup to locate\nthe cached file is performed using the escaped URL. Instead the file is\ncached over and over again, using the unescaped URL as the key.\n\nPS: I added the ap_log_error to cache_generate_key_default() in cache_storage.c\n\nTest-config:\n\n<Location /tmc/>\n  ExpiresActive On\n  ExpiresDefault A31536000\n</Location>\nCacheEnable disk /tmc/\n...\n\n# mkdir -p htpdocs/tmc\n# cp /etc/hosts htdocs/tmc/bla.txt \n# cp /etc/hosts htdocs/tmc/foo\\ bar.txt\n\nThis problem is quite similar in effect to #40805.\n\n# curl -D - -o /dev/null 'http://localhost/tmc/foo%20bar.txt'\n\nrequest #1\n\nFri Jan 26 14:41:16 2007] [debug] cache_storage.c(432): cache_generate_key_default(): key is 'http://\nlocalhost:80/tmc/foo%20bar.txt?'\n[Fri Jan 26 14:41:16 2007] [debug] mod_cache.c(129): Adding CACHE_SAVE filter for /tmc/foo%\n20bar.txt\n[Fri Jan 26 14:41:16 2007] [debug] mod_cache.c(136): Adding CACHE_REMOVE_URL filter for /tmc/foo%\n20bar.txt\n[Fri Jan 26 14:41:16 2007] [debug] cache_storage.c(432): cache_generate_key_default(): key is 'http://\nlocalhost:80/tmc/foo bar.txt?'\n[Fri Jan 26 14:41:16 2007] [debug] mod_cache.c(609): cache: Caching url: /tmc/foo%20bar.txt\n[Fri Jan 26 14:41:16 2007] [debug] mod_cache.c(615): cache: Removing CACHE_REMOVE_URL filter.\n[Fri Jan 26 14:41:16 2007] [debug] mod_cache.c(658): cache: Added date header\n[Fri Jan 26 14:41:16 2007] [debug] mod_disk_cache.c(954): disk_cache: Stored headers for URL http://\nlocalhost:80/tmc/foo bar.txt?\n[Fri Jan 26 14:41:16 2007] [debug] mod_disk_cache.c(1043): disk_cache: Body for URL http://localhost:\n80/tmc/foo bar.txt? cached.\n\n\nrequest #2\n\n[Fri Jan 26 14:41:44 2007] [debug] cache_storage.c(432): cache_generate_key_default(): key is 'http://\nlocalhost:80/tmc/foo%20bar.txt?'\n[Fri Jan 26 14:41:44 2007] [debug] mod_cache.c(129): Adding CACHE_SAVE filter for /tmc/foo%\n20bar.txt\n[Fri Jan 26 14:41:44 2007] [debug] mod_cache.c(136): Adding CACHE_REMOVE_URL filter for /tmc/foo%\n20bar.txt\n[Fri Jan 26 14:41:44 2007] [debug] cache_storage.c(432): cache_generate_key_default(): key is 'http://\nlocalhost:80/tmc/foo bar.txt?'\n[Fri Jan 26 14:41:44 2007] [debug] mod_cache.c(609): cache: Caching url: /tmc/foo%20bar.txt\n[Fri Jan 26 14:41:44 2007] [debug] mod_cache.c(615): cache: Removing CACHE_REMOVE_URL filter.\n[Fri Jan 26 14:41:44 2007] [debug] mod_cache.c(658): cache: Added date header\n[Fri Jan 26 14:41:44 2007] [debug] mod_disk_cache.c(954): disk_cache: Stored headers for URL http://\nlocalhost:80/tmc/foo bar.txt?\n[Fri Jan 26 14:41:44 2007] [debug] mod_disk_cache.c(1043): disk_cache: Body for URL http://localhost:\n80/tmc/foo bar.txt? cached.\n\n\n# curl -D - -o /dev/null 'http://localhost/tmc/bla.txt' \n\nrequest #1\n[Fri Jan 26 14:44:21 2007] [debug] cache_storage.c(432): cache_generate_key_default(): key is 'http://\nlocalhost:80/tmc/bla.txt?'\n[Fri Jan 26 14:44:21 2007] [debug] mod_cache.c(129): Adding CACHE_SAVE filter for /tmc/bla.txt\n[Fri Jan 26 14:44:21 2007] [debug] mod_cache.c(136): Adding CACHE_REMOVE_URL filter for /tmc/\nbla.txt\n[Fri Jan 26 14:44:21 2007] [debug] cache_storage.c(432): cache_generate_key_default(): key is 'http://\nlocalhost:80/tmc/bla.txt?'\n[Fri Jan 26 14:44:21 2007] [debug] mod_cache.c(609): cache: Caching url: /tmc/bla.txt\n[Fri Jan 26 14:44:21 2007] [debug] mod_cache.c(615): cache: Removing CACHE_REMOVE_URL filter.\n[Fri Jan 26 14:44:21 2007] [debug] mod_cache.c(658): cache: Added date header\n[Fri Jan 26 14:44:21 2007] [debug] mod_disk_cache.c(954): disk_cache: Stored headers for URL http://\nlocalhost:80/tmc/bla.txt?\n[Fri Jan 26 14:44:21 2007] [debug] mod_disk_cache.c(1043): disk_cache: Body for URL http://localhost:\n80/tmc/bla.txt? cached.\n\nrequest #2\n[Fri Jan 26 14:44:43 2007] [debug] cache_storage.c(432): cache_generate_key_default(): key is 'http://\nlocalhost:80/tmc/bla.txt?'\n[Fri Jan 26 14:44:43 2007] [debug] mod_disk_cache.c(477): disk_cache: Recalled cached URL info \nheader http://localhost:80/tmc/bla.txt?\n[Fri Jan 26 14:44:43 2007] [debug] mod_disk_cache.c(750): disk_cache: Recalled headers for URL \nhttp://localhost:80/tmc/bla.txt?\n[Fri Jan 26 14:44:43 2007] [info] Incoming request is asking for a uncached version of /tmc/bla.txt, but \nwe know better and are ignoring it\n[Fri Jan 26 14:44:43 2007] [debug] mod_cache.c(263): cache: running CACHE_OUT filter\n[Fri Jan 26 14:44:43 2007] [debug] mod_cache.c(277): cache: serving /tmc/bla.txt", "id": 98561, "time": "2007-01-26T06:27:38Z", "creator": "lu@cachescrubber.org", "creation_time": "2007-01-26T06:27:38Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 41475, "attachment_id": null, "text": "*** Bug 41516 has been marked as a duplicate of this bug. ***", "id": 98880, "time": "2007-02-01T12:47:38Z", "creator": "rpluem@apache.org", "creation_time": "2007-02-01T12:47:38Z", "is_private": false}, {"count": 2, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "text": "Could you please give the attached patch a try and report back whether it solves\nyour problem?", "id": 99014, "time": "2007-02-06T06:49:05Z", "bug_id": 41475, "creation_time": "2007-02-06T06:49:05Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "id": 99015, "attachment_id": 19529, "bug_id": 41475, "creation_time": "2007-02-06T06:49:38Z", "time": "2007-02-06T06:49:38Z", "text": "Created attachment 19529\nPatch against trunk"}, {"count": 4, "tags": [], "bug_id": 41475, "attachment_id": null, "text": "(In reply to comment #2)\n> Could you please give the attached patch a try and report back whether it solves\n> your problem?\n\nI applied your patch against 2.2.4.\n\nThe testcase I used to report the problem (see above) worked for me.", "id": 99018, "time": "2007-02-06T07:28:45Z", "creator": "lu@cachescrubber.org", "creation_time": "2007-02-06T07:28:45Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 41475, "text": "(In reply to comment #4)\n> (In reply to comment #2)\n> > Could you please give the attached patch a try and report back whether it solves\n> > your problem?\n> \n> I applied your patch against 2.2.4.\n> \n> The testcase I used to report the problem (see above) worked for me.\n\nConfirming that this solved my problems also (duplicate reported bug 41516),\nwhen applied to 2.2.4.", "id": 99274, "time": "2007-02-12T06:48:51Z", "creator": "dean.scothern@eduserv.org.uk", "creation_time": "2007-02-12T06:48:51Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 41475, "text": "Thanks for the feedback. Committed to trunk as r506621\n(http://svn.apache.org/viewvc?view=rev&revision=506621).", "id": 99292, "time": "2007-02-12T12:30:12Z", "creator": "rpluem@apache.org", "creation_time": "2007-02-12T12:30:12Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 41475, "text": "Backported to 2.2.x as r539112 (http://svn.apache.org/viewvc?view=rev&rev=539112).", "id": 103317, "time": "2007-05-17T14:20:11Z", "creator": "rpluem@apache.org", "creation_time": "2007-05-17T14:20:11Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "When using mod_disk_cache in conjonction with mod_proxy, the mod_disk_cache \nfailed to update his cache after a 304 response to backend request is received.\n\nMy configuration is as following:\n- build apache based on sources http-2.2.0-win32-rev2 with MS VC++7\n- having applied patch based on rev374931 (cache_storage. Without that it \nwon't work.\n\n- httpd.conf revelant parts:\n\nCacheEnable disk /\nCacheRoot \"d:/somdir\"\nCacheDirLength 1\nCacheDirLevels 1\nCacheMaxExpire 604800\nCacheDefaultExpire 604800\nCacheLastModifiedFactor 2.0\n\nSetEnvIf Request_URI \"\\.css$\"  force-no-vary\nSetEnvIf Request_URI \"\\.gif$\"  force-no-vary\nSetEnvIf Request_URI \"\\.hta$\"  force-no-vary\nSetEnvIf Request_URI \"\\.html$\" force-no-vary\nSetEnvIf Request_URI \"\\.jpg$\"  force-no-vary\nSetEnvIf Request_URI \"\\.js$\"   force-no-vary\nSetEnvIf Request_URI \"\\.vbs$\"  force-no-vary\n\nProxyPass /dummy http://someserver/somedir/\n\n- error.log:\n\n[Wed Mar 01 17:55:04 2006] [debug] mod_cache.c(602): cache: Caching \nurl: /dummy/somefile.htm\n[Wed Mar 01 17:55:04 2006] [debug] mod_cache.c(608): cache: Removing \nCACHE_REMOVE_URL filter.\n[Wed Mar 01 17:55:04 2006] [debug] mod_disk_cache.c(854): (OS 5)Access is \ndenied.  : disk_cache: rename tempfile to varyfile failed: \nd:/somedir/aptmphDPPNj -> d:/somedir/K/dJOTUGmp@MAIPFjfsNpFA.header\n[Wed Mar 01 17:55:04 2006] [debug] mod_cache.c(796): (OS 5)Access is \ndenied.  : cache: store_headers failed\n[Wed Mar 01 17:55:04 2006] [debug] mod_proxy_http.c(1530): proxy: end body send\n[Wed Mar 01 17:55:04 2006] [debug] proxy_util.c(1769): proxy: HTTPS: has \nreleased connection for (*)", "attachment_id": null, "id": 86384, "creator": "dodger_web@yahoo.fr", "time": "2006-03-02T10:11:45Z", "bug_id": 38827, "creation_time": "2006-03-02T10:11:45Z", "is_private": false}, {"count": 1, "tags": [], "creator": "dodger_web@yahoo.fr", "attachment_id": null, "text": "Seems to be related to vary header set on cached page.\n\nAdding this in httpd.conf does solve the problem.\n\n\"Header unset Vary\"\n\nBut then, we're loosing the opportunity to control cache with VARY.\n\nI did track the problem to this line of code in mod_disk_cache, line 851:\n\nrv = safe_file_rename(conf, dobj->tempfile, dobj->hdrsfile,\n                                  r->pool);\n\nSeems to not be able to overwrite an existing file.", "id": 86400, "time": "2006-03-02T14:33:27Z", "bug_id": 38827, "creation_time": "2006-03-02T14:33:27Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 38827, "text": "I think r1405494 in trunk resolves this.", "id": 163160, "time": "2012-11-04T03:22:59Z", "creator": "covener@gmail.com", "creation_time": "2012-11-04T03:22:59Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "text": "fixed in 2.4.4", "id": 165612, "time": "2013-03-03T16:51:52Z", "bug_id": 38827, "creation_time": "2013-03-03T16:51:52Z", "is_private": false}, {"count": 4, "tags": [], "creator": "roel@roelschroeven.net", "attachment_id": null, "text": "Is this going to be fixed in 2.2 as well?", "id": 166319, "time": "2013-04-02T11:46:50Z", "bug_id": 38827, "creation_time": "2013-04-02T11:46:50Z", "is_private": false}, {"count": 5, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 195743, "time": "2016-12-31T00:23:18Z", "bug_id": 38827, "creation_time": "2016-12-31T00:23:18Z", "text": "Closing out 2.2.x bugs, fixed in 2.4.4."}]
[{"count": 0, "tags": [], "creator": "nospam@uadm.com", "attachment_id": null, "text": "cgi process are not being closed and end up in a zombie state untill parent\nprocess is terminated. This has been observed on move then 5 servers.", "id": 40993, "time": "2003-07-20T06:13:00Z", "bug_id": 21737, "creation_time": "2003-07-20T06:13:00Z", "is_private": false}, {"count": 1, "tags": [], "creator": "nick@cpanel.net", "attachment_id": 7406, "is_private": false, "id": 41008, "time": "2003-07-20T18:07:18Z", "bug_id": 21737, "creation_time": "2003-07-20T18:07:18Z", "text": "Created attachment 7406\nreverse what happened in 1.3.28"}, {"count": 2, "tags": [], "creator": "nick@cpanel.net", "attachment_id": null, "text": "I've been having the same problem.  Please try that patch I attached.  ", "id": 41009, "time": "2003-07-20T18:08:05Z", "bug_id": 21737, "creation_time": "2003-07-20T18:08:05Z", "is_private": false}, {"count": 3, "tags": [], "creator": "nick@cpanel.net", "attachment_id": null, "text": "The problem is that when running under suexec you cannot send the process\nsigterm since apache and the script are running with diffrent uids.  Apache\n1.3.28 beleives the process is dead because the kill failed and sets\np_kill_how=kill_never.  It really should look for -ESRCH.", "id": 41010, "time": "2003-07-20T18:19:55Z", "bug_id": 21737, "creation_time": "2003-07-20T18:19:55Z", "is_private": false}, {"count": 4, "tags": [], "creator": "nick@cpanel.net", "attachment_id": 7407, "is_private": false, "id": 41011, "time": "2003-07-20T18:35:01Z", "bug_id": 21737, "creation_time": "2003-07-20T18:35:01Z", "text": "Created attachment 7407\ninstead of reverse ... fix"}, {"count": 5, "tags": [], "creator": "nick@cpanel.net", "attachment_id": null, "text": "The second patch implements a fix instead of reverting things back to the way\n1.3.27 handled things.", "id": 41012, "time": "2003-07-20T18:36:56Z", "bug_id": 21737, "creation_time": "2003-07-20T18:36:56Z", "is_private": false}, {"count": 6, "tags": [], "creator": "nick@cpanel.net", "attachment_id": null, "is_private": false, "id": 41013, "time": "2003-07-20T18:48:10Z", "bug_id": 21737, "creation_time": "2003-07-20T18:48:10Z", "text": "This probably should be critical as it causes servers to crash."}, {"count": 7, "tags": [], "creator": "nick@cpanel.net", "attachment_id": null, "text": "*** Bug 21739 has been marked as a duplicate of this bug. ***", "id": 41015, "time": "2003-07-20T18:50:01Z", "bug_id": 21737, "creation_time": "2003-07-20T18:50:01Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41016, "time": "2003-07-20T18:52:14Z", "creator": "nospam@uadm.com", "creation_time": "2003-07-20T18:52:14Z", "is_private": false, "text": "I don't think the patch works (either of them). Still got new defuncts.\nHowever I tested on one server only."}, {"count": 9, "text": "sorry about severity change, new to bugzilla.\n\n(altho I haven't experience any crushs on 7 servers some with multiple instances\nof apache).", "bug_id": 21737, "attachment_id": null, "id": 41017, "time": "2003-07-20T18:58:00Z", "creator": "nospam@uadm.com", "creation_time": "2003-07-20T18:58:00Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41018, "time": "2003-07-20T20:01:07Z", "creator": "nick@cpanel.net", "creation_time": "2003-07-20T20:01:07Z", "is_private": false, "text": "Can you get it to reliably create a defunct process by doing the following?\n\n> a) Put a this script in your cgi-bin\n> --cut here--\n> #!/usr/bin/php\n> <?php phpinfo(); ?>\n> --cut here--\n> \n> b) Go to it your web browser.  Click reload over and over again (this\n> will eventually cause a sigpipe). \n> \n> c) watch the zombies build up"}, {"count": 11, "tags": [], "creator": "nospam@uadm.com", "attachment_id": null, "text": "The problem is fixed, I forgot I had another apache on that server. sorry for\nextra work I caused.", "id": 41024, "time": "2003-07-20T20:51:54Z", "bug_id": 21737, "creation_time": "2003-07-20T20:51:54Z", "is_private": false}, {"count": 12, "tags": [], "creator": "nick@cpanel.net", "attachment_id": null, "text": "Just to confirm, the patched apache is working correctly?", "id": 41026, "time": "2003-07-20T21:13:34Z", "bug_id": 21737, "creation_time": "2003-07-20T21:13:34Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41028, "time": "2003-07-20T21:14:41Z", "creator": "nick@cpanel.net", "creation_time": "2003-07-20T21:14:41Z", "is_private": false, "text": "*** Bug 21746 has been marked as a duplicate of this bug. ***"}, {"count": 14, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41029, "time": "2003-07-20T21:24:07Z", "creator": "nospam@uadm.com", "creation_time": "2003-07-20T21:24:07Z", "is_private": false, "text": "I'm not sure now. I manualy patched (with the second patch) few servers and they\nlook fine, one cpanel server (with the first patch) still defuncts. not sure\nyet if it's me of the patch."}, {"count": 15, "tags": [], "bug_id": 21737, "text": "second cpanel defuncts.", "id": 41030, "time": "2003-07-20T21:27:45Z", "creator": "nospam@uadm.com", "creation_time": "2003-07-20T21:27:45Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41031, "time": "2003-07-20T21:30:22Z", "creator": "nospam@uadm.com", "creation_time": "2003-07-20T21:30:22Z", "is_private": false, "text": "second patch also defuncts. so to sum it, the patches don't work."}, {"count": 17, "tags": [], "bug_id": 21737, "attachment_id": null, "text": "I can create a defunct process with the script above and get it about 80% of the\ntime. The defunct process is gone very quickly now.", "id": 41032, "time": "2003-07-20T21:40:20Z", "creator": "nospam@uadm.com", "creation_time": "2003-07-20T21:40:20Z", "is_private": false}, {"count": 18, "tags": [], "bug_id": 21737, "text": "You should probably still get defunct processes (the same thing happens in\n1.3.27 and below), but they shouldn't exist for more then 5 or so seconds cause\nthere is still a wait time between the time sigpip is recieved and the timeout.\n This should be ok though.", "id": 41034, "time": "2003-07-20T22:06:54Z", "creator": "nick@cpanel.net", "creation_time": "2003-07-20T22:06:54Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "creator": "john@server3.wox.org", "attachment_id": null, "text": "> You should probably still get defunct processes (the same thing happens in\n> 1.3.27 and below), but they shouldn't exist for more then 5 or so seconds \ncause\n> there is still a wait time between the time sigpip is recieved and the \ntimeout.\n\nOh no!\nThe defunct-processes won't clean automaticly!", "id": 41035, "time": "2003-07-20T22:17:49Z", "bug_id": 21737, "creation_time": "2003-07-20T22:17:49Z", "is_private": false}, {"count": 20, "tags": [], "creator": "nick@cpanel.net", "attachment_id": null, "text": "John:  do you still see them lingering after using the patch?", "id": 41039, "time": "2003-07-21T00:27:48Z", "bug_id": 21737, "creation_time": "2003-07-21T00:27:48Z", "is_private": false}, {"count": 21, "tags": [], "creator": "jwoolley@apache.org", "attachment_id": null, "text": "Just so you know, we (the dev team) have seen this bug report and are looking into it.  Thanks \nfor the detailed investigation! ", "id": 41042, "time": "2003-07-21T02:25:16Z", "bug_id": 21737, "creation_time": "2003-07-21T02:25:16Z", "is_private": false}, {"count": 22, "tags": [], "creator": "inhaber@147099.vserver.de", "attachment_id": null, "text": "The patch does not help!", "id": 41057, "time": "2003-07-21T10:56:51Z", "bug_id": 21737, "creation_time": "2003-07-21T10:56:51Z", "is_private": false}, {"count": 23, "tags": [], "creator": "chatmaster@charter.net", "attachment_id": null, "text": "This appears to be the modified PHP-suexec patch you have that is broken.  Note \nthis is likely only a problem for users that use Cpanel and the Apache version \nwith the newly updated alloc.c patch--looking at it, it is a source of more \nproblems.  You are looking in the wrong place.  The php-suexec patch that I've \nmodified myself and use with Apache 1.3.28 does not suffer from these problems \nat all.  I believe that is the cause of your problems and your alloc.c patch \ncauses more (look at the modifications to see why!)  Maybe I'm wrong, but this \nis how it appears looking at the patch and the alloc.c patch as well seems to \ncause yet more issues.", "id": 41127, "time": "2003-07-22T06:32:51Z", "bug_id": 21737, "creation_time": "2003-07-22T06:32:51Z", "is_private": false}, {"count": 24, "tags": [], "creator": "chatmaster@charter.net", "attachment_id": null, "is_private": false, "id": 41128, "time": "2003-07-22T06:35:35Z", "bug_id": 21737, "creation_time": "2003-07-22T06:35:35Z", "text": "I.e., it's ignoring -USR1 hup's and so on, which is also conflicting with your \ncontrol panel on new account set ups and so on, which is causing more users to \nsubmit reports about this version of Apache having this bug, which beyond the \nPHP-SuEXEC patch and the messed up alloc.c patch, doesn't exist (*from what I've \nseen*--I may be wrong, but it _is_ a source of additional problems)."}, {"count": 25, "text": "While I have actually been able to confirm this on .28 with the PHP-suexec patch \nunder specific circumstances--I am not able to reproduce the problem for .28 nor \n.27 without that patch being implemented.\n\nHas anyone experienced this issue that is not using the PHP suexec patch from \nhttp://www.localhost.nl/patches/ (or a similar source), be it a modified version \nof this patch or not?  I.e., the problem exists on installs without this?  I've \nnot been able to reproduce it without this patch being implemented.\n\nEither way, the alloc.c patch is not the solution, at least not a complete \nsolution and opens up other problems, with some tests.  More information about \nthat later, if it's needed.", "bug_id": 21737, "attachment_id": null, "id": 41129, "time": "2003-07-22T06:58:44Z", "creator": "chatmaster@charter.net", "creation_time": "2003-07-22T06:58:44Z", "tags": [], "is_private": false}, {"count": 26, "text": "Not sure why the comments I added is not in.\n\nI can confirm the problem as well. My setup is stock apache1.3.28 (no php-suexec\npath) with modssl 2.8.15-1.3.28 and php 4.3.2. A simple test script that only\ndisplay \"hello world\" will stay as a defunct process owned by the suExec user.\nThe defunct process only went away after a restart of the apache processes.", "bug_id": 21737, "is_private": false, "id": 41187, "time": "2003-07-23T01:56:42Z", "creator": "cheewai_yeung@yahoo.com", "creation_time": "2003-07-23T01:56:42Z", "tags": [], "attachment_id": null}, {"count": 27, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41188, "creation_time": "2003-07-23T02:06:02Z", "time": "2003-07-23T02:06:02Z", "creator": "chatmaster@charter.net", "text": "Odd, I've not been able to recreate this on non \"PHP for CGI w/ SuEXEC\" patched \nsystems, but I sincey you experience it as well, I personally assume it relates \nto CGI and SuEXEC.  Has anyone confirmed this on non-SuEXEC enabled installs?", "is_private": false}, {"count": 28, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41190, "creation_time": "2003-07-23T05:37:03Z", "time": "2003-07-23T05:37:03Z", "creator": "nick@cpanel.net", "text": "I'm not sure why the first patch would cause USR1 not to work.  The patch just\nreverts parts of alloc.c to 1.3.27.   ", "is_private": false}, {"count": 29, "tags": [], "creator": "chatmaster@charter.net", "attachment_id": null, "is_private": false, "id": 41191, "time": "2003-07-23T06:09:12Z", "bug_id": 21737, "creation_time": "2003-07-23T06:09:12Z", "text": "I was mistaken.  This was not related.  The patch did cause other problems \nthough.  I will attempt to recreate the problem in various ways and report it in \nthe very near future.  However, since this doesn't seem to be the overall \nsolution and more of a quick fix, I suppose there's no need."}, {"count": 30, "tags": [], "creator": "nick@cpanel.net", "attachment_id": null, "text": "Which patch are you using?  The first one or the second one.  \n\nI've reviewed the second one:\n\nhttp://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=7407\n\nand I can't see how it could cause a problem.   I'm not so sure about the first\none though.", "id": 41192, "time": "2003-07-23T06:23:42Z", "bug_id": 21737, "creation_time": "2003-07-23T06:23:42Z", "is_private": false}, {"count": 31, "tags": [], "creator": "cnoack@informatik.tu-cottbus.de", "attachment_id": null, "text": "I confirm the bug for Apache 1.3.28/mod_ssl-2.8.15-1.3.28/php-4.3.1 running on\nOpenBSD 3.2. The fix (7407) seems to be working here.", "id": 41193, "time": "2003-07-23T07:21:18Z", "bug_id": 21737, "creation_time": "2003-07-23T07:21:18Z", "is_private": false}, {"count": 32, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41199, "time": "2003-07-23T10:14:21Z", "creator": "cheewai_yeung@yahoo.com", "creation_time": "2003-07-23T10:14:21Z", "is_private": false, "text": "I applied the patch 7407 and it seems to fix the problem. Now the suEXEC process\nno longer stayed in zombie state."}, {"count": 33, "text": "*** Bug 21926 has been marked as a duplicate of this bug. ***", "bug_id": 21737, "attachment_id": null, "id": 41632, "time": "2003-07-28T10:33:28Z", "creator": "mads@apache.org", "creation_time": "2003-07-28T10:33:28Z", "tags": [], "is_private": false}, {"count": 34, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41637, "time": "2003-07-28T10:54:35Z", "creator": "serge@kilio.fr", "creation_time": "2003-07-28T10:54:35Z", "is_private": false, "text": "with the second patch: \nhttp://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=7407 \nseems to be ok. \nI got some defunct process butthey are killed in few seconds. Looks good, thanks. "}, {"count": 35, "text": "We had severe zombie problems as well after upgrading to 1.3.28 (on Solaris \n2.8). Compiling with the second (7407) patch solved the zombie problem for us \nas well.", "bug_id": 21737, "attachment_id": null, "id": 41650, "time": "2003-07-28T13:06:42Z", "creator": "eef.vanes@atosorigin.com", "creation_time": "2003-07-28T13:06:42Z", "tags": [], "is_private": false}, {"count": 36, "tags": [], "creator": "chatmaster@charter.net", "attachment_id": null, "text": "This second 'patch' is just reverting back to the alloc.c file for .27 instead \nof .28.  Has anyone noted any impact due to this?  This does seem to help, but \nnot completely remove the issue.  Also, bypassing the function(s) in .28--does \nthis matter?  It seems to be a logic error.", "id": 41663, "time": "2003-07-28T15:25:47Z", "bug_id": 21737, "creation_time": "2003-07-28T15:25:47Z", "is_private": false}, {"count": 37, "tags": [], "bug_id": 21737, "text": "The first patch is the one that revents, the second one is the one that should\nfix the problem with keeping the current logic.", "id": 41698, "time": "2003-07-29T05:01:47Z", "creator": "nick@cpanel.net", "creation_time": "2003-07-29T05:01:47Z", "is_private": false, "attachment_id": null}, {"count": 38, "tags": [], "creator": "nick@cpanel.net", "attachment_id": null, "is_private": false, "id": 41699, "time": "2003-07-29T05:02:38Z", "bug_id": 21737, "creation_time": "2003-07-29T05:02:38Z", "text": "s/revents/reverts (gee 1am)"}, {"count": 39, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41700, "creation_time": "2003-07-29T05:45:08Z", "time": "2003-07-29T05:45:08Z", "creator": "chatmaster@charter.net", "text": "I meant first, not second. :-)", "is_private": false}, {"count": 40, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41834, "time": "2003-07-31T09:42:36Z", "creator": "eef.vanes@atosorigin.com", "creation_time": "2003-07-31T09:42:36Z", "is_private": false, "text": "What will happen with this patch in the future? Will this be part of 1.3.29 or \nwill it become an official patch? We like to know that before we start \nupgrading all our other apache 1.3.27 instances."}, {"count": 41, "tags": [], "bug_id": 21737, "is_private": false, "text": "Though I am not the person that would authorize anything as official or have \nany control over what Apache does, and I don't personally assume this would be \nimplemented in .29 or be official (what do I know), I still recommend you \nupgrade to .28 and implement this patch if you find you have to (or create some \nsolution yourself that maybe you feel more comfortable with otherwise).  You \ndon't want to stick with .27 at this point anyway.", "id": 41868, "time": "2003-07-31T15:50:13Z", "creator": "chatmaster@charter.net", "creation_time": "2003-07-31T15:50:13Z", "attachment_id": null}, {"count": 42, "text": "For me, patch 7407 works like a dream. I have yet to see any zombie processes \nwith my PHP script or with the \"phpinfo()\" script mentioned above. Before, I \ncould reproduce the zombies quite easily - about 50% of the time with my script \nand 100% of the time with the \"phpinfo()\" script.\n\nBTW, I'm not using any \"PHP-suexec\" patch.", "bug_id": 21737, "attachment_id": null, "id": 41969, "time": "2003-08-01T20:14:15Z", "creator": "jr-apachebugs2@quo.to", "creation_time": "2003-08-01T20:14:15Z", "tags": [], "is_private": false}, {"count": 43, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41980, "time": "2003-08-01T22:48:33Z", "creator": "chatmaster@charter.net", "creation_time": "2003-08-01T22:48:33Z", "is_private": false, "text": "Hi Jordan,\n\nI'm curious, do you have suexec enabled?  If so, do you have this problem \nwithout it enabled?"}, {"count": 44, "text": "Sorry if that sounded obvious to ask, given the history of the reports. :-)", "bug_id": 21737, "is_private": false, "id": 41981, "time": "2003-08-01T22:51:34Z", "creator": "chatmaster@charter.net", "creation_time": "2003-08-01T22:51:34Z", "tags": [], "attachment_id": null}, {"count": 45, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 41983, "time": "2003-08-01T23:14:25Z", "creator": "jr-apachebugs2@quo.to", "creation_time": "2003-08-01T23:14:25Z", "is_private": false, "text": "Yes, I use suexec.\n\nI just tested the phpinfo() script on a virtual site that does NOT use suexec, \nand I get no zombies while holding down the browser's Refresh key (F5 in \nInternet Explorer).\n\nWhen the same script is run on a suexec site, I get about 10 zombies per second \n(great potential for DoS?). Patch 7407 fixes this for me."}, {"count": 46, "tags": [], "bug_id": 21737, "attachment_id": null, "text": "How about on a build without suexec compiled in as an option, rather than a \nsite without it enabled on a build that has it?  I'm just testing out a few \nthoeries that likely have little to do with your problem, but I'd like to see if \nanyone sees this on a non-suexec build... and if so, how long they take to die \noff.  If you don't mind anyway.  Thanks.", "id": 41984, "time": "2003-08-01T23:20:40Z", "creator": "chatmaster@charter.net", "creation_time": "2003-08-01T23:20:40Z", "is_private": false}, {"count": 47, "tags": [], "creator": "jr-apachebugs2@quo.to", "attachment_id": null, "text": "I tested the phpinfo() script on a 1.3.28 server that doesn't have suexec \ncompiled in, and got no zombies.", "id": 41985, "time": "2003-08-01T23:30:33Z", "bug_id": 21737, "creation_time": "2003-08-01T23:30:33Z", "is_private": false}, {"count": 48, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 42003, "time": "2003-08-02T17:39:00Z", "creator": "rvm1974@raketnet.nl", "creation_time": "2003-08-02T17:39:00Z", "is_private": false, "text": "Ralf S. Engelschall posted a different patch on apache-http-dev:\nhttp://marc.theaimsgroup.com/?l=apache-httpd-dev&m=105952652425849&w=2\n\nIs that patch better than 4707?\n"}, {"count": 49, "tags": [], "creator": "nick@cpanel.net", "attachment_id": null, "text": "Either one should work just as well", "id": 42006, "time": "2003-08-02T17:55:37Z", "bug_id": 21737, "creation_time": "2003-08-02T17:55:37Z", "is_private": false}, {"count": 50, "tags": [], "creator": "chatmaster@charter.net", "attachment_id": null, "text": "Yes, it would be a better overall patch, though, as he stated himself, the \noriginal one works, but could be improved--which it seems it was.  I'd recommend \nusing this other patch by Ralf overall.", "id": 42010, "time": "2003-08-02T20:17:05Z", "bug_id": 21737, "creation_time": "2003-08-02T20:17:05Z", "is_private": false}, {"count": 51, "tags": [], "bug_id": 21737, "text": "The FreeBSD port apache13-modssl (Apache 1.3.28 + ModSSL 2.8.15) has been \nupdated to include the 4707 patch. My server with heavy CGI (Perl and PHP) was \ncreating zombies left and right, about 5000/hour.\n\nI like the 4707 patch. It made me happy again.", "id": 42776, "time": "2003-08-14T19:57:28Z", "creator": "kahn@deadbbs.com", "creation_time": "2003-08-14T19:57:28Z", "is_private": false, "attachment_id": null}, {"count": 52, "tags": [], "creator": "ajp-apache@aripollak.com", "attachment_id": null, "is_private": false, "id": 43638, "time": "2003-09-02T21:17:37Z", "bug_id": 21737, "creation_time": "2003-09-02T21:17:37Z", "text": "This patch does not work for me. I'm using suEXEC, mod_ssl compiled as a DSO,\nmod_frontpage_mirfak, mod_gzip, mod_pointer, and mod_throttle, all compiled as\nDSO modules."}, {"count": 53, "tags": [], "creator": "ajp-apache@aripollak.com", "attachment_id": null, "text": "I should note that the patch given on the mailing list works fine.", "id": 43640, "time": "2003-09-02T21:20:17Z", "bug_id": 21737, "creation_time": "2003-09-02T21:20:17Z", "is_private": false}, {"count": 54, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 43666, "time": "2003-09-03T13:50:45Z", "creator": "trawick@apache.org", "creation_time": "2003-09-03T13:50:45Z", "is_private": false, "text": "This is the patch that actually got committed (yesterday):\n\nhttp://cvs.apache.org/viewcvs.cgi/apache-1.3/src/main/alloc.c.diff?r1=1.145&r2=1.146\n\nIt is slightly different than the patches that were posted to the mailing\nlist, but it addresses all known concerns.\n\n"}, {"count": 55, "tags": [], "creator": "eseidel@apple.com", "attachment_id": null, "is_private": false, "id": 43683, "time": "2003-09-03T22:12:53Z", "bug_id": 21737, "creation_time": "2003-09-03T22:12:53Z", "text": "I applied the patch for alloc.c as is in the CVS tree to a APACHE_1_3_27 source.  I failed to correct \nthe problem for me under Mac OS X 10.3... investigating further..."}, {"count": 56, "tags": [], "bug_id": 21737, "attachment_id": null, "id": 43687, "time": "2003-09-04T00:51:14Z", "creator": "eseidel@apple.com", "creation_time": "2003-09-04T00:51:14Z", "is_private": false, "text": "I have confirmed, this condition still exists on Mac OS X 10.3 with this patch.  I patched the 1.3.28 \nsources (I erred in my comment above).  And was still able to reproduce this.\n\nI did extensive further testing and found that both Mac OS X, and FreeBSD violate the POSIX \nspecification for kill() and return ESRCH, when sending a signal to a zombie process.\n\nThis violation introduces a race condition with this patched code, as a process could finish (become \nzombie) after the NEED_WAITPID \"waitpid\" cleanup, but before the ap_os_kill() call and thus return \nESRCH, be marked as kill_never, and then never be cleaned up.\n\nAlthough it is my hope that Mac OS X 10.3 final will have fixed this error.  Apache is still left with \nan interoperability problem on Mac OS X 10.2 and likely FreeBSD (as they share this same \nvioloation).\n\nI have attached my program \"main.c\" which tests for this phenomenon."}, {"count": 57, "tags": [], "creator": "eseidel@apple.com", "attachment_id": 8055, "is_private": false, "id": 43689, "time": "2003-09-04T00:52:21Z", "bug_id": 21737, "creation_time": "2003-09-04T00:52:21Z", "text": "Created attachment 8055\nA program to test errno after signal to zombie process."}, {"count": 58, "tags": [], "creator": "eseidel@apple.com", "attachment_id": null, "text": "Thinking about this a little more... I think there are two options here:\n\n1.  Come up with a solution, not dependant on this behaviour of kill...  (moving the waitpid to after \nthe kill call should be sufficient?)\n\n2.  Add a configure.in rule to check for the POSIX compliance to kill and conditionally deal with it's \ncompliance or non-compliance accordingly.  There may be other systems (besides OS X and \nFreeBSD) which have this ESRCH behaviour when sending to zombies...", "id": 43724, "time": "2003-09-04T15:51:42Z", "bug_id": 21737, "creation_time": "2003-09-04T15:51:42Z", "is_private": false}, {"count": 59, "tags": [], "creator": "eseidel@apple.com", "attachment_id": null, "text": "Here is a \"hack\" which fixes the problem on Mac OS X (likely FreeBSD as well).\n\n-           if (ap_os_kill(p->pid, SIGTERM) == -1) {\n+           if ( (ap_os_kill(p->pid, SIGTERM) == -1) && (errno == ESRCH) ) {\n+               // in case ESRCH means \"zombie\".\n+                waitpid(p->pid, (int *) 0, 0);", "id": 43727, "time": "2003-09-04T19:14:44Z", "bug_id": 21737, "creation_time": "2003-09-04T19:14:44Z", "is_private": false}, {"count": 60, "tags": [], "creator": "eseidel@apple.com", "attachment_id": null, "is_private": false, "id": 43733, "time": "2003-09-05T02:59:35Z", "bug_id": 21737, "creation_time": "2003-09-05T02:59:35Z", "text": "Unless I'm mistaken, can't kill return EPERM for setuid processes?  Wouldn't that also leak?"}, {"count": 61, "text": "Another data point: I received an e-mail from a Tru64 user indicating that the\npatch as committed failed there too, and that Ralf's patch worked fine.", "bug_id": 21737, "is_private": false, "id": 43738, "time": "2003-09-05T11:18:48Z", "creator": "trawick@apache.org", "creation_time": "2003-09-05T11:18:48Z", "tags": [], "attachment_id": null}, {"count": 62, "tags": [], "creator": "jim@apache.org", "attachment_id": null, "is_private": false, "id": 43743, "time": "2003-09-05T12:44:25Z", "bug_id": 21737, "creation_time": "2003-09-05T12:44:25Z", "text": "Because of the bogusness of how some OSs handle errors from KILL, I've changed us to simply kill \nand wait. "}]
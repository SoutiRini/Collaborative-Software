[{"count": 0, "tags": [], "creator": "michael@wyraz.de", "text": "From version 5.0.4 to 5.0.5 the File\norg/apache/tomcat/util/http/mapper/Mapper.java was changed to redirect requests\nwhich matches a directory but have a missing trailing slash are redirected to\nthe same url with the slash. This breaks some webapps because the redirect is\nalso done for urls which are mapped to servlets.\n\nExample:\nA Servlet is mapped to /. The user calls /page which is handled by the servlet.\nIf a direcory named \"page\" exists, tomcat redirects to /page/. This is fine for\ndirectory indexing but bad for complex applications.\n\nSee also:\nhttp://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-connectors/util/java/org/apache/tomcat/util/http/mapper/Mapper.java?r1=1.23&r2=1.24", "id": 67532, "time": "2004-11-29T11:08:48Z", "bug_id": 32424, "creation_time": "2004-11-29T11:08:48Z", "is_private": false, "attachment_id": null}, {"count": 1, "text": "When i change the mapping from \"/\" to \"/*\" the url i no more redirected. But\nshould'nt it work for \"/\"?", "bug_id": 32424, "is_private": false, "id": 67533, "time": "2004-11-29T11:31:11Z", "creator": "michael@wyraz.de", "creation_time": "2004-11-29T11:31:11Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "text": "\"/\" is if everything else failed.\nThe mapper has to assume that the default servlet will, at least to some extent,\nbe responsible for static page serving.", "is_private": false, "id": 67534, "creation_time": "2004-11-29T11:38:45Z", "time": "2004-11-29T11:38:45Z", "creator": "remm@apache.org", "bug_id": 32424, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 32424, "attachment_id": null, "text": "I have a filter mapped to /* \nWhen I call a url without a trailing slash which is a directory, tomcat\nredirects it to this dir with slash.", "id": 68342, "time": "2004-12-13T15:28:12Z", "creator": "sander.de.boer@eo.nl", "creation_time": "2004-12-13T15:28:12Z", "is_private": false}, {"count": 4, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 68343, "time": "2004-12-13T15:32:01Z", "bug_id": 32424, "creation_time": "2004-12-13T15:32:01Z", "is_private": false, "text": "In this case, Tomcat will indeed issue a redirect right away.\nPlease do not reopen the issue."}, {"count": 5, "tags": [], "text": "(In reply to comment #4)\n> In this case, Tomcat will indeed issue a redirect right away.\n> Please do not reopen the issue.\n\nWhy does Tomcat redirect right away? Shouldn't the filter be given a chance to\nprocess the original (no slash) request? \n\nI have an application that was previously deployed using Jetty and I'm currently\nlooking at moving over to Tomcat 5.5 but this is a show stopper for me. I can't\nrename the directories and the end users expect the original (no slash) paths to\nwork. The application does not do directory listings so adding the slash doesn't\nhelp us in the least. Is there a way to disable this?\n\nIt seems to me that this redirect should be sent by the default servlet *after*\nany user filters/servlet have had a chance to process the request but then I\nassume this behaviour is according to the spec? If so where is it specified?", "is_private": false, "id": 70649, "creation_time": "2005-02-08T22:22:12Z", "time": "2005-02-08T22:22:12Z", "creator": "oliverh@ourcommunity.com.au", "bug_id": 32424, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 32424, "text": "The behavior is not specified anywhere, but the idea is that in the case of a\nphysical folder or the root of a context, the trailing '/' is not relevant.\nSince this causes recurrent path resolution issues (which made servlets like our\ndefault servlet needlessly more complex), we always present the servlet with a\ntraining '/' in all cases. It is also the most efficient, so that's the the\nimplementation which is currently used.\n\nI regret it would prevent you from using Tomcat, but there's nothing that I will\nchange here.", "count": 6, "id": 70652, "time": "2005-02-08T22:39:45Z", "creator": "remm@apache.org", "creation_time": "2005-02-08T22:39:45Z", "is_private": false}, {"count": 7, "tags": [], "creator": "oliverh@ourcommunity.com.au", "text": "> The behavior is not specified anywhere\n\nThen isn't it clearly a bug? While the slash makes no sematic difference when\nyour using the default servlet it *can* and does make a difference for\napplications that do not use the default servlet (like mine and clearly others). \n\nAlso so much for interoperability between Servlet containers. Given that Tomcat\nis the reference implementation of the Servlet spec should I raise a bug with\nJetty (and probably every other implementation) given that it does not exhibit\nthis behaviour?\n\n> I regret it would prevent you from using Tomcat, but there's nothing \n> that I will change here.\n \nI understand that I'm not going to persuade you to change this but at the very\nleast there should be a way to disable it. If you point me in the right\ndirection perhaps I could implement a patch?\n", "id": 70715, "time": "2005-02-09T23:17:11Z", "bug_id": 32424, "creation_time": "2005-02-09T23:17:11Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 70718, "time": "2005-02-10T00:04:54Z", "bug_id": 32424, "creation_time": "2005-02-10T00:04:54Z", "is_private": false, "text": "Unfortunately, I would have to veto your patch. I would appreciate if you were\nnot whining. Thanks."}, {"count": 9, "tags": [], "text": "If you want to modify the HTTP mapping behavior for your own purposes, the\nmapping class is org.apache.tomcat.util.http.mapper.Mapper in\njakarta-tomcat-connectors/util. Rule 7 is the one which sends the HTTP redirect.", "attachment_id": null, "bug_id": 32424, "id": 70719, "time": "2005-02-10T00:13:59Z", "creator": "remm@apache.org", "creation_time": "2005-02-10T00:13:59Z", "is_private": false}, {"count": 10, "tags": [], "creator": "oliverh@ourcommunity.com.au", "attachment_id": null, "id": 70722, "time": "2005-02-10T01:28:08Z", "bug_id": 32424, "creation_time": "2005-02-10T01:28:08Z", "is_private": false, "text": "> I would appreciate if you were not whining.\n\nI'm simply trying to get a decent explanation of why this is not a bug - which\nyou have failed to provide in any of your comments. I understand this behaviour\nis solving some problem or other but that doesn't mean it not a bug and it's\ncertainly contrary to the spirit of the spec relating to filters and to the\nmapping of requests. \n\nAnyway I'll shutup since I'm clearly wasting my time."}, {"count": 11, "tags": [], "creator": "Keith@Apache.org", "attachment_id": null, "id": 70728, "time": "2005-02-10T06:58:31Z", "bug_id": 32424, "creation_time": "2005-02-10T06:58:31Z", "is_private": false, "text": "FWIW The redirect to add a trailing slash is required prior to any\nauthentication challenges for correct credential cacheing on the client.  The\ncontainer is correct to 302 + / the request as soon as possible, if the request\nis missing a trailing slash.  When I tested Jetty about a year ago it did this\nas well."}, {"count": 12, "tags": [], "creator": "oliverh@ourcommunity.com.au", "text": "Keith thanks for making the logic behind this clearer.\n\nI understand that this is desirable behaviour *when* the \"default\" servlet ends\nup handling the request but the redirect happens in \"Rule 7\" of the mapper where\nit is only *possible* that the \"default\" servlet will handle the request. In my\nweb app a filter forwards the request on so that in the end the \"default\"\nservlet is never invoked which means the assumption made at \"Rule 7\" was invalid. \n\nIn addition to this the spec is quite clear that a filter that is mapped to \"/*\"\nshould be given the opportunity to filter all requests - in this special case\nTomcat does not fulfil this requirement as it makes the *incorrect* assumption\nthat the redirected request is logically the same as the original. eg. In my web\napp the request for \"/images\" is not the same as \"/images/\" (even though I don't\nhave a servlet mapped to \"/images\") however Tomcat does not allow our forwarding\nfilter to process the \"/images\" request and forward it on the the correct\nservlet as there happens to be a directory called \"images\" in out web app. \n\nI'm currently using Jetty and it allows filters to process the request *before*\ndoing the 302. ", "id": 70796, "time": "2005-02-10T23:04:30Z", "bug_id": 32424, "creation_time": "2005-02-10T23:04:30Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 70797, "time": "2005-02-10T23:34:40Z", "bug_id": 32424, "creation_time": "2005-02-10T23:34:40Z", "is_private": false, "text": "Didn't you promise the following: \"Anyway I'll shutup since I'm clearly wasting\nmy time\" ? ;)"}, {"count": 14, "tags": [], "bug_id": 32424, "attachment_id": null, "text": "The migration of Tomcat 4.x / Jetty web applications to 5.5.x is not possible\nbecause of this 302/redirect for url's with names like existing directories in\nthe web app. This may be a real show stopper! I still do not understand why\nTomcat interferes with the url space my web app is responsible for?!", "id": 71285, "time": "2005-02-21T00:05:32Z", "creator": "cocoon@felix.shacknet.nu", "creation_time": "2005-02-21T00:05:32Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 32424, "text": "(In reply to comment #9)\n> If you want to modify the HTTP mapping behavior for your own purposes, the\n> mapping class is org.apache.tomcat.util.http.mapper.Mapper in\n> jakarta-tomcat-connectors/util. Rule 7 is the one which sends the HTTP \nredirect.\n\nIs it possible to make this configurable in tomcat 5 or 5.5?", "count": 15, "id": 74070, "time": "2005-04-25T05:45:46Z", "creator": "roy_huang@nbmgroup.com", "creation_time": "2005-04-25T05:45:46Z", "is_private": false}, {"count": 16, "tags": [], "creator": "t.katelbach@systheo.com", "attachment_id": null, "id": 74079, "time": "2005-04-25T10:52:50Z", "bug_id": 32424, "creation_time": "2005-04-25T10:52:50Z", "is_private": false, "text": "This is definitly a structural bug within Tomcat5, Redirection decisions \nshouldn't be made by Tomcat but by our own application, otherwise we should \nconstrain our architecture to Tomcats own structure?? or be stuck with using \nT4.1 or another container... this will surely be a recurent bug declaration. \nI understand if this simplifies T5's structure but is it acceptable to \nconstraint this way? In my use case I call for url : /login an he sends me \nto /login/ even though I don't even have a login folder and after login instead \nof redirect to /myurl he blocks me in that context being: /login/myurl which \nofcourse makes no sense. \nPlease reconcider this issue. \nor atleast make it configurable as Roy requests it. "}, {"count": 17, "tags": [], "bug_id": 32424, "attachment_id": null, "text": "(In reply to comment #16)\n> This is definitly a structural bug within Tomcat5, Redirection decisions \n> shouldn't be made by Tomcat but by our own application, otherwise we should \n> constrain our architecture to Tomcats own structure?? or be stuck with using \n> T4.1 or another container... this will surely be a recurent bug declaration. \n> I understand if this simplifies T5's structure but is it acceptable to \n> constraint this way? In my use case I call for url : /login an he sends me \n> to /login/ even though I don't even have a login folder and after login instead \n> of redirect to /myurl he blocks me in that context being: /login/myurl which \n> ofcourse makes no sense. \n> Please reconcider this issue. \n> or atleast make it configurable as Roy requests it. \n\nUnfortunately, the basis for your rant is bad. There will be no redirection of\nany sort unless you do have a \"login\" folder. Otherwise, how do you expect\nTomcat to be able to match a servlet mapped to, say \"/test\" ?\n\nIndeed, if you do not like this behavior, you should at the moment consider\nusing another container, or change the code to your liking according to my\nindications.\n\nAlso, please try to get spelling right. This helps raising credibility of the\nperson making the statement.\n", "id": 74080, "time": "2005-04-25T11:03:33Z", "creator": "remm@apache.org", "creation_time": "2005-04-25T11:03:33Z", "is_private": false}, {"count": 18, "tags": [], "bug_id": 32424, "attachment_id": null, "text": "After having carefully read all comments here, I still do not understand why it would not make sense to allow disabling rule 7.\n\nWhy would you serve the content rather than sending an HTTP 301 to the client. To my knowledge search engines consider that URLs sans trailing slash and URLs with trailing slash are different. Consequently tomcat would serve an identical content for two different URLs which can lead to poor SEO ranking.\n\nI'd like to know if this behavious also apply to tomcat 6.", "id": 139312, "time": "2010-08-21T08:55:53Z", "creator": "franck93@gmail.com", "creation_time": "2010-08-21T08:55:53Z", "is_private": false}]
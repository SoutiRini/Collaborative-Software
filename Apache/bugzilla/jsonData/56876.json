[{"count": 0, "tags": [], "bug_id": 56876, "text": "sendRedirect address wrong at port mapping or proxied .\neg:\n\n http://www.domaintest.com/ maping to: http://192.168.1.123:8080/\n\nindex.jsp\ncode:\n<%\nresponse.sendRedirect(\"/abc.jsp\");\n%>\nwhen enter http://www.domaintest.com/\nout put header  for Location\uff1a\n\nLocation: http://192.168.1.123:8080/abc.jsp\n\nis not  http://www.domainttest/abc.jsp\n\nfound tomcatcode at  org.apache.catalina.connector.Response#toAbsolute\n\ncode:\nprivate String toAbsolute(String location) {\n\n        if (location == null)\n            return (location);\n\n        boolean leadingSlash = location.startsWith(\"/\");\n\n        if (leadingSlash || !hasScheme(location)) {\n\n            redirectURLCC.recycle();\n\n            String scheme = request.getScheme();\n            String name = request.getServerName(); //## bug at here !!!!!! \uff0ccan use host header .\n            int port = request.getServerPort();\n\n            try {\n                redirectURLCC.append(scheme, 0, scheme.length());\n                redirectURLCC.append(\"://\", 0, 3);\n                redirectURLCC.append(name, 0, name.length());\n                if ((scheme.equals(\"http\") && port != 80)\n                    || (scheme.equals(\"https\") && port != 443)) {\n                    redirectURLCC.append(':');\n                    String portS = port + \"\";\n                    redirectURLCC.append(portS, 0, portS.length());\n                }\n                if (!leadingSlash) {\n                    String relativePath = request.getDecodedRequestURI();\n                    int pos = relativePath.lastIndexOf('/');\n                    relativePath = relativePath.substring(0, pos);\n                    \n                    String encodedURI = null;\n                    final String frelativePath = relativePath;\n                    if (SecurityUtil.isPackageProtectionEnabled() ){\n                        try{\n                            encodedURI = (String)AccessController.doPrivileged( \n                                new PrivilegedExceptionAction(){                                \n                                    public Object run() throws IOException{\n                                        return urlEncoder.encodeURL(frelativePath);\n                                    }\n                           });   \n                        } catch (PrivilegedActionException pae){\n                            IllegalArgumentException iae =\n                                new IllegalArgumentException(location);\n                            iae.initCause(pae.getException());\n                            throw iae;\n                        }\n                    } else {\n                        encodedURI = urlEncoder.encodeURL(relativePath);\n                    }\n                    redirectURLCC.append(encodedURI, 0, encodedURI.length());\n                    redirectURLCC.append('/');\n                }\n                redirectURLCC.append(location, 0, location.length());\n            } catch (IOException e) {\n                IllegalArgumentException iae =\n                    new IllegalArgumentException(location);\n                iae.initCause(e);\n                throw iae;\n            }\n\n            return redirectURLCC.toString();\n\n        } else {\n\n            return (location);\n\n        }\n\n    }", "id": 177289, "time": "2014-08-21T01:49:16Z", "creator": "pinke@trydone.com", "creation_time": "2014-08-21T01:49:16Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 56876, "text": "This is likely not a bug but a mis-configuration.\nPlease ask on the Tomcat users list first, see http://tomcat.apache.org/lists.html for \"tomcat-users\".\nYou might also want to have a look at\n\nhttp://tomcat.apache.org/tomcat-6.0-doc/config/http.html#Proxy_Support\n\nand\n\nhttp://www.catb.org/~esr/faqs/smart-questions.html.\n\nPlease do not follow-up here unless a discussion on the users list clearly indicates that you actually hit a bug.\n\nRegards,\n\nRainer", "id": 177291, "time": "2014-08-21T07:15:38Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2014-08-21T07:15:38Z", "tags": [], "is_private": false}]
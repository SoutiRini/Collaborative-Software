[{"count": 0, "tags": [], "text": "In documentation for the core module (manual/mod/core.xml), there's a very prominent warning about the safety of pthread mutexes:\n\n\"On most systems, if a child process terminates abnormally while holding a mutex that uses this implementation, the server will deadlock and stop responding to requests. When this occurs, the server will require a manual restart to recover.\nSolaris is a notable exception as it provides a mechanism which usually allows the mutex to be recovered after a child process terminates abnormally while holding a mutex.\nIf your system implements the pthread_mutexattr_setrobust_np() function, you may be able to use the pthread option safely.\"\n\nLinux has supported robust pthread mutexes for quite some time: Documentation/robust-futexes.txt went into the kernel in 2006, and man pages for pthread_mutexattr_setrobust_np were added in ~2008.\n\nThere may well be systems that still don't support it, so the warning should probably still stay, but could you please add Linux to the list of systems where it's safe?", "attachment_id": null, "bug_id": 58744, "id": 186994, "time": "2015-12-17T03:09:15Z", "creator": "dja@axtens.net", "creation_time": "2015-12-17T03:09:15Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 58744, "text": "Created attachment 33381\nAdded Linux as platform that supports strong pthread mutex", "id": 187178, "time": "2015-12-28T14:23:14Z", "creator": "toscano.luca@gmail.com", "creation_time": "2015-12-28T14:23:14Z", "is_private": false, "attachment_id": 33381}, {"count": 2, "tags": [], "bug_id": 58744, "text": "Hi Daniel,\n\nI checked your statement and added a patch for the documentation, let me know if you want me to add more info. I don't have commit permissions so we'll need to wait for somebody to pick this bug up :)\n\nLuca", "id": 187179, "time": "2015-12-28T14:24:19Z", "creator": "toscano.luca@gmail.com", "creation_time": "2015-12-28T14:24:19Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 58744, "text": "Hi Luca,\n\nThanks for the patch!\n\nI've done some more reading, and it seems that robust mutexes were added to POSIX, in Issue 7 (released 2008).\n\n(See http://pubs.opengroup.org/onlinepubs/9699919799/functions/pthread_mutexattr_getrobust.html, or for a more accessible explanation, http://stackoverflow.com/questions/9804915/robust-pthread-mutexes-portability-across-platforms )\n\nThis is definitely bikeshedding, but maybe it would be worth rewording the patch to say that it's available on Solaris, Linux and any other system that supports POSIX robust mutexes?\n\nThanks again.\nDaniel", "id": 187385, "time": "2016-01-04T23:57:53Z", "creator": "dja@axtens.net", "creation_time": "2016-01-04T23:57:53Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 58744, "attachment_id": 33422, "id": 187483, "time": "2016-01-07T16:18:51Z", "creator": "toscano.luca@gmail.com", "creation_time": "2016-01-07T16:18:51Z", "is_private": false, "text": "Created attachment 33422\nAdded Linux as platform that supports strong pthread mutex + POSIX\n\nHi Daniel,\n\ndo you think that the following sentence embodies your thoughts?\n\n\"If your system is POSIX compliant or if it implements the pthread_mutexattr_setrobust_np() function, you may be able to use the pthread option safely.\"\n\nAdded new patch just in case :)\n\nLuca"}, {"count": 5, "tags": [], "creator": "rbowen@apache.org", "attachment_id": null, "text": "Thank you.\n\nApplied to trunk in r1724265.\nApplied to 2.4 in r1724267.", "id": 187568, "time": "2016-01-12T16:14:52Z", "bug_id": 58744, "creation_time": "2016-01-12T16:14:52Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "awinters@aconex.com", "attachment_id": null, "is_private": false, "id": 118917, "time": "2008-07-22T21:39:59Z", "bug_id": 45463, "creation_time": "2008-07-22T21:39:59Z", "text": "If you have a very large corrupt zip (100+ meg) that doesn't have a end-of-central-directory signature, ZipFile.positionAtCentralDirectory can spend hours doing a reverse seek through the entire zip file looking for the marker.  It seems to me that it should give up and throw a ZipException after 65557 bytes.  Here's why...\n\nAs per the zip file specification at http://www.pkware.com/documents/casestudies/APPNOTE.TXT we can see that the zip file comment won't be more than 65535 bytes; so MAX_EOCD_SIZE and our bail-out point should be 0xFF + MIN_EOCD_SIZE.\n\n  I.  End of central directory record:\n\n        end of central dir signature    4 bytes  (0x06054b50)\n        number of this disk             2 bytes\n        number of the disk with the\n        start of the central directory  2 bytes\n        total number of entries in the\n        central directory on this disk  2 bytes\n        total number of entries in\n        the central directory           2 bytes\n        size of the central directory   4 bytes\n        offset of start of central\n        directory with respect to\n        the starting disk number        4 bytes\n        .ZIP file comment length        2 bytes\n        .ZIP file comment       (variable size)\n\nThis is a serious performance issue."}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 119345, "creation_time": "2008-08-04T05:14:36Z", "time": "2008-08-04T05:14:36Z", "bug_id": 45463, "text": "the appnotes you mention are not really the latest, that would probably be http://www.info-zip.org/doc/appnote-iz-latest.zip\n\nstill the last record remains to be the EOCD record and its size hasn't changed, so your observation and calculations are still correct.", "is_private": false}, {"count": 2, "tags": [], "bug_id": 45463, "attachment_id": null, "text": "suggested change implemented in svn revision 683942, thanks.", "id": 119599, "time": "2008-08-08T04:37:17Z", "creator": "bodewig@apache.org", "creation_time": "2008-08-08T04:37:17Z", "is_private": false}]
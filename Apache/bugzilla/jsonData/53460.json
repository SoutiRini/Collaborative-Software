[{"count": 0, "tags": [], "bug_id": 53460, "attachment_id": null, "text": "I noticed this while testing the fix for bug 53230 in Tomcat 6.\n\nTo reproduce:\n1. Limit the count of active sessions supported by session manager, by adding the following line to conf/server.xml:\n\n<Manager maxActiveSessions=\"0\" />\n\n2. Start Tomcat and access the NumGuess example:\n\nhttp://localhost:8080/examples/jsp/num/numguess.jsp\n\n\nActual result:\n- Blank page.\n- An error (SEVERE) is logged by JspFactoryImpl.internalGetPageContext(),\nwhere this exception is swallowed.\n\nExpected result:\n- Error page.\n- This expected issue does not deserve severe logging.\n\nNote, that simply rethrowing it in JspFactoryImpl.internalGetPageContext() will not help, as will be further swallowed by Java code of JSP page and proper error handling there does not happen without a PageContext instance - see r1347100 for related fix.\n\nMaybe create PageContext instance and initialize session in two separate calls? So that if session initialization fails, it could be handled by that PageContext instance.\n\n\nStack trace:\n(trunk, running with SecurityManager enabled)\n[[[\n23-Jun-2012 17:28:20.937 SEVERE [http-apr-8080-exec-2] org.apache.jasper.runtime.JspFactoryImpl.internalGetPageContext Exception initializing page context\n org.apache.catalina.session.TooManyActiveSessionsException: createSession: Too many active sessions\n\tat org.apache.catalina.session.ManagerBase.createSession(ManagerBase.java:616)\n\tat org.apache.catalina.connector.Request.doGetSession(Request.java:2687)\n\tat org.apache.catalina.connector.Request.getSession(Request.java:2119)\n\tat org.apache.catalina.connector.RequestFacade$GetSessionPrivilegedAction.run(RequestFacade.java:217)\n\tat org.apache.catalina.connector.RequestFacade$GetSessionPrivilegedAction.run(RequestFacade.java:206)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.apache.catalina.connector.RequestFacade.getSession(RequestFacade.java:895)\n\tat org.apache.catalina.connector.RequestFacade.getSession(RequestFacade.java:910)\n\tat org.apache.jasper.runtime.PageContextImpl._initialize(PageContextImpl.java:146)\n\tat org.apache.jasper.runtime.PageContextImpl.initialize(PageContextImpl.java:125)\n\tat org.apache.jasper.runtime.JspFactoryImpl.internalGetPageContext(JspFactoryImpl.java:112)\n\tat org.apache.jasper.runtime.JspFactoryImpl.access$000(JspFactoryImpl.java:41)\n\tat org.apache.jasper.runtime.JspFactoryImpl$PrivilegedGetPageContext.run(JspFactoryImpl.java:156)\n\tat org.apache.jasper.runtime.JspFactoryImpl$PrivilegedGetPageContext.run(JspFactoryImpl.java:129)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat org.apache.jasper.runtime.JspFactoryImpl.getPageContext(JspFactoryImpl.java:63)\n\tat org.apache.jsp.jsp.num.numguess_jsp._jspService(numguess_jsp.java:54)\n\n]]]", "id": 160198, "time": "2012-06-23T14:02:41Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-06-23T14:02:41Z", "is_private": false}, {"count": 1, "tags": [], "text": "I'm leaning towards:\n- re-throwing the original exception if a PageContext can't be created\n- modifying the generated JSP code so if no PageContext is present any error is wrapped in a ServletExcaption and re-thrown (rather than logged) so the container can handle it\n\nThis should ensure any problems creating the PageContext instance are clearly visible.", "is_private": false, "id": 160263, "creator": "markt@apache.org", "time": "2012-06-26T13:58:54Z", "bug_id": 53460, "creation_time": "2012-06-26T13:58:54Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 53460, "attachment_id": null, "is_private": false, "id": 160273, "time": "2012-06-26T20:09:50Z", "creator": "markt@apache.org", "creation_time": "2012-06-26T20:09:50Z", "text": "Fixed in trunk and 7.0.x and will be included in 7.0.29 onwards."}, {"count": 3, "tags": [], "bug_id": 53460, "attachment_id": null, "is_private": false, "id": 161847, "time": "2012-08-30T14:01:30Z", "creator": "patches@portaildulibre.fr", "creation_time": "2012-08-30T14:01:30Z", "text": "Hi, \n\nCan you backport this patch to 6.0 ?\n\nBug 53230 was backport in 6.0.36 but it fix only servlet access, not jsp access as described in this bug.\n\nRegards,"}]
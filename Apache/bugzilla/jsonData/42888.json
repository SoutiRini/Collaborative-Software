[{"count": 0, "tags": [], "creator": "vmferr@gmail.com", "attachment_id": null, "id": 105376, "time": "2007-07-13T07:14:15Z", "bug_id": 42888, "creation_time": "2007-07-13T07:14:15Z", "is_private": false, "text": "Hi everyone!\n\nMy team is having problems on a large production site at work. All days, it \nappears three or four core dumps. After studying some of them, it seems to us \nthat there may be some kind of problem with Apache when its processes try to \nrestart. \n\nWe use a multi-thread implementation -using worker.c-\n\nWhen happening at work, the directive \"MaxRequestPerChild\" was set to \"1000\". \nThe same behaviour could be reproduced in a development environment by setting \nthe processes to be restarted just after having processed only 50 requests -by \nsettintg the directive \"MaxRequestPerChild\" to \"50\". \n\nLatter, we changed \"MaxRequestPerChild\" to \"10000\" -10000 is the default Apache \nvalue for this directive-. Although it was not so often than before, from time \nto time this behaviour kept happening.\n\nDoes anyone have any idea to explain this behaviour?\n\nIn advance, thank you for your help!\n\n\n\nWhat follows are the datails of one of this core dumps.\n\nThis is the environment:\n\n[cmc@madarrcc33 apache_2.0.53_debug]$ uname -a\nLinux madarrcc33.indra.es 2.6.10-1.771_FC2smp #1 SMP Mon Mar 28 01:10:51 EST \n2005 i686 i686 i386 GNU/Linux\n\n[cmc@madarrcc33 bin]$ ./httpd -l\nCompiled in modules:\n  core.c\n  mod_access.c\n  mod_auth.c\n  mod_include.c\n  mod_log_config.c\n  mod_env.c\n  mod_setenvif.c\n  worker.c\n  http_core.c\n  mod_mime.c\n  mod_status.c\n  mod_autoindex.c\n  mod_asis.c\n  mod_cgid.c\n  mod_negotiation.c\n  mod_dir.c\n  mod_imap.c\n  mod_actions.c\n  mod_userdir.c\n  mod_alias.c\n  mod_so.c\n  \n  \n  \nAnd this is the gdb output when studying the controversial thread that produced \nthe core dump:\n \n[...]\nCore was generated by `/aplicaciones/apache/SSAAapache/bin/httpd -\nf /aplicaciones/apache/http-intranet'.\nProgram terminated with signal 11, Segmentation fault.\nReading symbols from /etc/libcwait.so...done.\nLoaded symbols for /etc/libcwait.so\nReading symbols from /lib/libssl.so.4...done.\nLoaded symbols for /lib/libssl.so.4\nReading symbols from /lib/libcrypto.so.4...done.\nLoaded symbols for /lib/libcrypto.so.4\nReading symbols from /usr/kerberos/lib/libgssapi_krb5.so.2...done.\nLoaded symbols for /usr/kerberos/lib/libgssapi_krb5.so.2\nReading symbols from /usr/kerberos/lib/libkrb5.so.3...done.\nLoaded symbols for /usr/kerberos/lib/libkrb5.so.3\nReading symbols from /usr/kerberos/lib/libcom_err.so.3...done.\nLoaded symbols for /usr/kerberos/lib/libcom_err.so.3\nReading symbols from /usr/kerberos/lib/libk5crypto.so.3...done.\nLoaded symbols for /usr/kerberos/lib/libk5crypto.so.3\nReading symbols from /lib/libresolv.so.2...done.\n[...]\nLoaded symbols for /lib/libgcc_s.so.1\n#0  0x00e66ba1 in __read_nocancel () from /lib/tls/libpthread.so.0\n\n\n(gdb) info threads\n[...]\n  5 process 32306  0x00e643ad in pthread_cond_wait@@GLIBC_2.3.2 () \nfrom /lib/tls/libpthread.so.0\n  4 process 32307  0x00e643ad in pthread_cond_wait@@GLIBC_2.3.2 () \nfrom /lib/tls/libpthread.so.0\n  3 process 32308  0x00e643ad in pthread_cond_wait@@GLIBC_2.3.2 () \nfrom /lib/tls/libpthread.so.0\n  2 process 32309  0x00e66d9e in accept () from /lib/tls/libpthread.so.0\n* 1 process 32050  0x00e66ba1 in __read_nocancel () \nfrom /lib/tls/libpthread.so.0\n\n\n(gdb) thread apply all where\n[...]\nThread 1 (process 32050):\n#0  0x00e66ba1 in __read_nocancel () from /lib/tls/libpthread.so.0\n#1  0x08069f69 in ap_mpm_pod_check (pod=0xfffffe00) at pod.c:54\n#2  0x08068522 in child_main (child_num_arg=-512) at worker.c:1195\n#3  0x08068702 in make_child (s=0x9574f00, slot=0) at worker.c:1278\n#4  0x08068afb in perform_idle_server_maintenance () at worker.c:1480\n#5  0x08068dbd in server_main_loop (remaining_children_to_start=0) at \nworker.c:1582\n#6  0x08068fa0 in ap_mpm_run (_pconf=0x2, plog=0x959f158, s=0x9574f00) at \nworker.c:1684\n#7  0x0806ebb2 in main (argc=5, argv=0xbfffadc4) at main.c:623\n\n\n(gdb) thread apply all where full\n[...]\nThread 1 (process 32050):\n#0  0x00e66ba1 in __read_nocancel () from /lib/tls/libpthread.so.0\nNo symbol table info available.\n#1  0x08069f69 in ap_mpm_pod_check (pod=0xfffffe00) at pod.c:54\n\tc = 9 '\\t'\n\tfd = 4\n\trc = -512\n#2  0x08068522 in child_main (child_num_arg=-512) at worker.c:1195\n\tthreads = (apr_thread_t **) 0x95bdbe0\n\trv = 157055664\n\tts = (thread_starter *) 0x95c7b58\n\tthread_attr = (apr_threadattr_t *) 0x95c7b68\n\tstart_thread_id = (apr_thread_t *) 0x95c7b98\n#3  0x08068702 in make_child (s=0x9574f00, slot=0) at worker.c:1278\n\tpid = 0\n#4  0x08068afb in perform_idle_server_maintenance () at worker.c:1480\n\tstatus = 1\n\tany_dying_threads = 0\n\tany_dead_threads = 0\n\tall_dead_threads = 1\n\ti = 0\n\tj = -1073763581\n\tidle_thread_count = 0\n\tps = (process_score *) 0xb751e050\n\tfree_length = 1\n\ttotally_free_length = 1\n\tfree_slots = {0, 0, 0, 0, 0, 0, 0, 0, 5698040, 1000000, 0, 5674655, 0, \n0, 0, 0, -1073763280, 0, 1000000, 0, 0, 0, -1073763224, \n  -1073763184, 0, 0, -1073763224, 134690625, 1000000, 0, 0, 256}\n\tlast_non_dead = 3\n\ttotal_non_dead = 4\n\tactive_thread_count = 58\n#5  0x08068dbd in server_main_loop (remaining_children_to_start=0) at \nworker.c:1582\n\tchild_slot = 0\n\texitwhy = APR_PROC_EXIT\n\tstatus = 0\n\tprocessed_status = 0\n\tpid = {pid = -1, in = 0xbfffacc8, out = 0x0, err = 0x0}\n\ti = 256\n#6  0x08068fa0 in ap_mpm_run (_pconf=0x2, plog=0x959f158, s=0x9574f00) at \nworker.c:1684\n\tremaining_children_to_start = 2\n\trv = -512\n#7  0x0806ebb2 in main (argc=5, argv=0xbfffadc4) at main.c:623\n\texit_status = 0\n\tc = 102 'f'\n\tconfigtestonly = 0\n\tconfname = 0xbfffeb32 \"/aplicaciones/apache/http-\nintranet/conf/httpd.conf\"\n\tdef_server_root = 0x808bff4 \"/aplicaciones/apache/SSAAapache\"\n\ttemp_error_log = 0x0\n\tprocess = (process_rec *) 0x9571120\n\tserver_conf = (server_rec *) 0x9574f00\n\tpglobal = (apr_pool_t *) 0x95710a0\n\tpconf = (apr_pool_t *) 0x95730a8\n\tplog = (apr_pool_t *) 0x959f158\n\tptemp = (apr_pool_t *) 0x95c7ab0\n\tpcommands = (apr_pool_t *) 0x95750b0\n\topt = (apr_getopt_t *) 0x9575148\n\trv = -512\n\tmod = (module **) 0x9574f00\n\toptarg = 0xbfffeb32 \"/aplicaciones/apache/http-intranet/conf/httpd.conf\"\n\tsignal_server = (apr_OFN_ap_signal_server_t *) 0x1"}, {"count": 1, "tags": [], "bug_id": 42888, "attachment_id": null, "text": "Cannot recreate this problem. Closing bug report and suggesting you post on users@", "id": 106271, "time": "2007-08-03T07:36:29Z", "creator": "jim@apache.org", "creation_time": "2007-08-03T07:36:29Z", "is_private": false}]
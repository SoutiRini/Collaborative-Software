[{"count": 0, "tags": [], "bug_id": 54536, "attachment_id": null, "is_private": false, "id": 165118, "time": "2013-02-07T12:33:41Z", "creator": "th7ohn@hotmail.com", "creation_time": "2013-02-07T12:33:41Z", "text": "The changes of the ErrorSupportValve introduced in catalina-v7.0.30 does not respect HttpServletResponse.sendError(int sc, String msg)  because when a msg is provided with a status which is not present in the LocalStrings.properties of the 'org.apache.catalina.valves' package, the error page won't be forwarded to the response body.\n\nThis issue was triggered due to the following change which was performed at revision 1348777:\n\nThe change of the             \n   report = sm.getString(\"http.\" + statusCode, message);\nto\n   report = sm.getString(\"http.\" + statusCode);\n\nresults in 'report==null' for custom status codes returning a response without the error page body.\n\n        if (report == null) {\n            return;\n        }"}, {"count": 1, "tags": [], "bug_id": 54536, "text": "The correct revision is 1362000", "id": 165120, "time": "2013-02-07T12:38:55Z", "creator": "th7ohn@hotmail.com", "creation_time": "2013-02-07T12:38:55Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "text": "What status code are you sending and why?", "count": 2, "id": 165121, "time": "2013-02-07T13:19:22Z", "bug_id": 54536, "creation_time": "2013-02-07T13:19:22Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 54536, "is_private": false, "text": "I am using custom code '901' in order to detect and handle session timeouts in AJAX requests.", "id": 165124, "time": "2013-02-07T15:09:52Z", "creator": "th7ohn@hotmail.com", "creation_time": "2013-02-07T15:09:52Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 54536, "attachment_id": null, "is_private": false, "id": 165169, "time": "2013-02-10T20:32:02Z", "creator": "1983-01-06@gmx.net", "creation_time": "2013-02-10T20:32:02Z", "text": "Why not 408?"}, {"attachment_id": null, "tags": [], "bug_id": 54536, "text": "My reading of RFC2616 is that custom status codes are not permitted.\n\nIf you set a custom status code that will still be sent to the client - just with a default error page.\n\nI'm currently on the fence whether to fix this or close it as invalid.\n\nWhy do you need the custom error page to be sent to the client? Why isn't the 901 status code and the default error page enough?", "count": 5, "id": 165192, "time": "2013-02-12T11:31:33Z", "creator": "markt@apache.org", "creation_time": "2013-02-12T11:31:33Z", "is_private": false}, {"count": 6, "text": "(In reply to comment #0)\n>\n> The correct revision is r1362000\n>\n> The change of the             \n>    report = sm.getString(\"http.\" + statusCode, message);\n> to\n>    report = sm.getString(\"http.\" + statusCode);\n> \n> results in 'report==null' for custom status codes\n\nRegarding the change in r1362000\n\nThe 2nd argument to sm.getString(..) is not a default value, but an argument used for \"{0}\" in a MessageFormat.\n\nBUT, there is small difference in the values returned by\n(a) sm.getString(key) and\n(b) sm.getString(key, args)\nwhen the resource is not found.\n\n(a) returns null, (b) returns MessageFormat.format(key, args) which is \"key\"\n\nThis caused a change in behaviour that this code block is now called:\n\n> \n>         if (report == null) {\n>             return;\n>         }\n\nThus instead of rendering the \"default\" error page, a blank page is rendered.\n\n\nBTW, I suspect that you can fix your issue by defining a custom error page in your web.xml, instead of relying on the default one.", "bug_id": 54536, "is_private": false, "id": 165194, "time": "2013-02-12T13:42:29Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2013-02-12T13:42:29Z", "tags": [], "attachment_id": null}, {"count": 7, "text": "\nStatus code 408 - Request Timeout, as it is described in RFC 2616 occurs when \"The client did not produce a request within the time that the server was prepared to wait. The client MAY repeat the request without modifications at any later time.\". My understanding of status code 408 is that  when a client(browser) sends a request and while the request is being processed by the server the connection timeouts, which is not the same case. \n\nThe actual problem is that i expect the response body (default error page) to contain a message field with the url in which the user should be redirected (ex login page), because otherwise without this functionality the response body of the request, the session of which has been timed out, returns the login page with status 200, this cannot be handled effectively in the context of an AJAX request (at least with my current implementation). So, i return an error which can be caught in JS level and using the message (<b>message</b> <u>redirectUrl:/test/login?login_error=3</u>) redirects them to the desired page.\n\nAs for RFC2616, in section 6.1.1,  i found the following part which mentions that:\n\n\" HTTP status codes are extensible. HTTP applications are not required\n   to understand the meaning of all registered status codes, though such\n   understanding is obviously desirable.\"\n   \nbut it isn't my intention to argue over this, i just found this inconsistency between the releases and i mention it.", "bug_id": 54536, "is_private": false, "id": 165207, "time": "2013-02-12T16:37:17Z", "creator": "th7ohn@hotmail.com", "creation_time": "2013-02-12T16:37:17Z", "tags": [], "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 54536, "is_private": false, "text": "Thanks for the explanation.\n\nI read a different part of RFC2616 that indicated to me that custom status codes were outside the spec. I see the part you referenced and agree with your interpretation.\n\nGiven the above I think Tomcat should not return a blank page if you use a custom status code. I'll look at getting this patched for the next release.", "id": 165213, "time": "2013-02-12T19:52:11Z", "creator": "markt@apache.org", "creation_time": "2013-02-12T19:52:11Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 54536, "text": "Fixed in trunk and 7.0.x and will be included in 7.0.37 onwards.", "count": 9, "id": 165214, "time": "2013-02-12T20:08:52Z", "creator": "markt@apache.org", "creation_time": "2013-02-12T20:08:52Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 54536, "text": "Please port such an improvement back to Tomcat 6.", "count": 10, "id": 165215, "time": "2013-02-12T20:33:36Z", "creator": "1983-01-06@gmx.net", "creation_time": "2013-02-12T20:33:36Z", "is_private": false}]
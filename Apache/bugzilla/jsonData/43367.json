[{"count": 0, "tags": [], "creator": "erich.hochmuth@dynatrace.com", "text": "Revision 574984 (trunk)\n\nWhen a local variable is added to a method, the max_locals are incremented in\naddLocalVariable (set to slot + size of type).\nHowever, when no other transformations are made, and setMaxLocals() is called,\nthe bytecode is searched for the max variable index, and max_locals set to that\nindex + size of that entry. The old max_locals which was set by adding the field\nis overwritten by this number.\n\nIf the LocalVariableTable for that method exists, the Java VM won't load the\nclass, because the max_locals determined by bcel is smaller than the max locals\ndetermined from the localvariabletable => ClassFormatException.", "id": 108082, "time": "2007-09-12T08:21:06Z", "bug_id": 43367, "creation_time": "2007-09-12T08:21:06Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": 20810, "bug_id": 43367, "text": "Created attachment 20810\nExample how to reproduce the issue.\n\nStart the Reproducer with java -cp bcel.jar:. Reproducer - the example\ninstrument the constructor of it's own class, adds a field, and tries to load\nthe modified class.", "id": 108118, "time": "2007-09-13T03:38:59Z", "creator": "erich.hochmuth@dynatrace.com", "creation_time": "2007-09-13T03:38:59Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 43367, "attachment_id": null, "is_private": false, "id": 145012, "time": "2011-03-15T01:52:26Z", "creator": "dbrosius@apache.org", "creation_time": "2011-03-15T01:52:26Z", "text": "It's a bug certainly, but because local variable is added to method without actually adding an statements in the method that use the variable, and the setMaxLocals only looks at opcodes. It should probably also look at the localvariable table if it exists, and use that."}, {"count": 3, "tags": [], "bug_id": 43367, "attachment_id": null, "is_private": false, "id": 145013, "time": "2011-03-15T02:08:57Z", "creator": "dbrosius@apache.org", "creation_time": "2011-03-15T02:08:57Z", "text": "Actually javac doesn't add entries to the local variable table that you don't use, so perhaps the real fix is to strip unused local variables from the local variable table."}]
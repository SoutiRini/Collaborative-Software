[{"count": 0, "text": "Created attachment 31604\nTestFormat.xlsx\n\nHi,\n\nconsider an excel-file created with excel 2007 (s. attachment) that contain a cell which content is formatted in a way that the special formatting doesn't start at the first character but some positions later. This leads to the exception \n\nException in thread \"main\" java.lang.NullPointerException\n\tat org.apache.poi.xssf.usermodel.XSSFRichTextString.toCTFont(XSSFRichTextString.java:418)\n\tat org.apache.poi.xssf.usermodel.XSSFRichTextString.getFontOfFormattingRun(XSSFRichTextString.java:350)\n\n\nHere is a straightforward program which reproduce this situation where TestFormat.xlsx is the name of the excel file attached.\n\ntry {\n  FileInputStream is = new FileInputStream(\"c:\\\\TestFormat.xlsx\");\n  XSSFWorkbook  workbook = new XSSFWorkbook(is);\n  for(XSSFSheet sheet : workbook)\n  {\n    int lastRow = sheet.getLastRowNum();\n    for(int rowIdx = 0;rowIdx <= lastRow;rowIdx++)\n    {\n      XSSFRow row = sheet.getRow(rowIdx);\n      int lastCell = row.getLastCellNum();\n\n      for(int cellIdx=0;cellIdx <= lastCell; cellIdx++)\n      {\n        System.out.println(\"row \"+rowIdx+\" column \"+cellIdx);\n\n        XSSFCell cell = row.getCell(cellIdx);\n        XSSFRichTextString richText = cell.getRichStringCellValue();\n        int anzFormattingRuns = richText.numFormattingRuns();\n\n        for(int run = 0; run < anzFormattingRuns;run++)\n        {\n          XSSFFont font;\n          font = richText.getFontOfFormattingRun(run);\n          System.out.println(\"run \"+run+ \" font \"+font.getFontName());\n        }\n      }\n    }\n  }\n} catch(java.io.IOException e){\n      System.out.println(\"java.io.IOException: \"+e.getMessage());\n}\n\nIt outputs \nrow 0 column 0\nrow 0 column 1\nrow 0 column 2\nrun 0 font Arial\nrun 1 font Arial\nrow 0 column 3\nException in thread \"main\" java.lang.NullPointerException ...\n\nAs you can see the program crashes at the third column D. But the only difference between the content \"dlgkdflgdfjkl\" of the columns C and D is that in column C the first \"d\" is also bold and in column D not.\n\nI think that r.getRPr() provides a null pointer that is referenced in toCTFont(). Why? Can it be corrected for POI-***-3.10-FINAL if it isn't the problem sitting before the keybord? \n\nFurthermore, wouldn't it be a good idea to check the result of r.getRPr() before it is passed to toCTFont within XSSFRichTextString.getFontOFormattingRun() an similar functions.\n\nThanks in advance\nRoger", "bug_id": 56511, "is_private": false, "id": 175147, "time": "2014-05-11T18:49:42Z", "creator": "roger.maschewski@gmx.de", "creation_time": "2014-05-11T18:49:42Z", "tags": [], "attachment_id": 31604}, {"count": 1, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 179944, "time": "2014-12-22T13:08:50Z", "bug_id": 56511, "creation_time": "2014-12-22T13:08:50Z", "is_private": false, "text": "Fixed via an additional null-check added in r1647308."}]
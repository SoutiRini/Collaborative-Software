[{"count": 0, "tags": [], "creator": "jserna@tid.es", "attachment_id": null, "is_private": false, "id": 16593, "time": "2002-05-23T14:43:38Z", "bug_id": 9351, "creation_time": "2002-05-23T14:43:38Z", "text": "The problem is in org.apache.catalina.connector.http.HttpProcessor the parsing \nof the Host header assumes that its format is:\n\n<host_name>[:port]\n\nwhere host_name mustn't contain any ':' character.\n\nBut with IPv6 addresses (RFC 2736 - Format for literal IPv6 addresses in URL), \na valid address could be:\n\n[3ffe:3328:6:3::2]:80\n\nand so the code:\n\n---\n\n} else if (header.equals(DefaultHeaders.HOST_NAME)) {\n                  int n = value.indexOf(':');\n\n----\n\nwhich assumes ':' only as port separator is not working.\n\nAdditional parsing must be added to this class in order to take into account \nIPv6 Addresses.\n\nJorge Serna"}, {"count": 1, "text": "Can you submit a patch on that topic, of course tested with J2SE 1.4, to \nsee if it actually works?\nA current workaround would be to use a host name resolving as an IPv6 \naddress (for example, I use localhost_ipv6 , which resolves to \"::1\"), but I \nnever tested it on Tomcat...", "bug_id": 9351, "attachment_id": null, "id": 16600, "time": "2002-05-23T16:31:40Z", "creator": "pier@betaversion.org", "creation_time": "2002-05-23T16:31:40Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "jserna@tid.es", "attachment_id": null, "id": 16604, "time": "2002-05-23T17:18:44Z", "bug_id": 9351, "creation_time": "2002-05-23T17:18:44Z", "is_private": false, "text": "I have developed no bug fix yet, but it shouldn't be very difficult to do it \n(it's a simple String parsing). As of now we're using a little workaround which \nis using names instead of IPv6 addresses, and it works fine."}, {"count": 3, "tags": [], "creator": "yamagu@ntt-it.co.jp", "attachment_id": 5762, "id": 34850, "time": "2003-04-10T05:58:41Z", "bug_id": 9351, "creation_time": "2003-04-10T05:58:41Z", "is_private": false, "text": "Created attachment 5762\npatch for org.apache.coyote.http11.Http11Processor"}, {"count": 4, "tags": [], "bug_id": 9351, "attachment_id": 5763, "is_private": false, "id": 34851, "time": "2003-04-10T06:00:47Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-10T06:00:47Z", "text": "Created attachment 5763\ntest case for org.apache.coyote.http11.Http11Processor"}, {"text": "No offense, but I think there is little market for IPv6 in TC right now. As\nsuch, it will not be ported in Tomcat 4.x. Thanks for the patch, anyway.", "tags": [], "bug_id": 9351, "is_private": false, "count": 5, "id": 34907, "time": "2003-04-10T18:37:21Z", "creator": "remm@apache.org", "creation_time": "2003-04-10T18:37:21Z", "attachment_id": null}, {"text": "I have found other problems of IPv6 HTTP/1.1 requests.\n\n\n\n\nWhen hotname is IPv6 address,\n\n\nHttpServletRequest#getRequestURL() and HttpServletResponse#sendRedirect() don't \nwork properly.\n\n\n\n\nI have developed additional patches,\n\n\nand I will post patches and test-cases.\n\n\n-  org.apache.coyote.tomcat4.CoyoteReques\n\n\n-  org.apache.coyote.tomcat5.CoyoteRequest\n\n\n-  org.apache.coyote.tomcat5.CoyoteResponset\n\n\n-  org.apache.catalina.util.URL\n\n\n-  org.apache.tomcat.util.net.URL\n\n\n\n\n\n\nexample of problems:\n\n\n  [Tomcat4 & 5]\n\n\n  When Host header is \"[3ffe:3328:6:3::2]:80\",\n\n\n  HttpServletRequest#getRequestURL() returns \"http://3ffe:3328:6:3::2:80/abc\".\n\n\n  Expected return-value was \"http://[3ffe:3328:6:3::2]:80/abc\".\n\n\n\n\n  [Tomcat4]\n\n\n  When Host header is \"[3ffe:3328:6:3::2]:80\",\n\n\n  HttpServletResponse#sendRedirect() fails to create Location header.\n\n\n  (catches IllegalArgumentException and set status SC_NOT_FOUND.)\n\n\n\n\n  [Tomcat5]\n\n\n  When Host header is \"[3ffe:3328:6:3::2]:80\",\n\n\n  HttpServletResponse#sendRedirect() sets \"http://3ffe:3328:6:3::2:80/abc/\" to \nLocation header.\n\n\n  Expected Location header was \"http://[3ffe:3328:6:3::2]:80/abc/\".\n\n\n", "tags": [], "bug_id": 9351, "is_private": false, "count": 6, "id": 34932, "time": "2003-04-11T05:03:24Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-11T05:03:24Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "yamagu@ntt-it.co.jp", "attachment_id": 5788, "is_private": false, "id": 34933, "time": "2003-04-11T05:07:13Z", "bug_id": 9351, "creation_time": "2003-04-11T05:07:13Z", "text": "Created attachment 5788\npatch for org.apache.coyote.tomcat4.CoyoteReques"}, {"text": "Created attachment 5789\npatch for org.apache.coyote.tomcat5.CoyoteRequest", "tags": [], "bug_id": 9351, "is_private": false, "count": 8, "id": 34934, "time": "2003-04-11T05:07:47Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-11T05:07:47Z", "attachment_id": 5789}, {"count": 9, "tags": [], "bug_id": 9351, "attachment_id": 5790, "is_private": false, "id": 34936, "time": "2003-04-11T05:08:31Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-11T05:08:31Z", "text": "Created attachment 5790\norg.apache.coyote.tomcat5.CoyoteResponset"}, {"count": 10, "tags": [], "creator": "yamagu@ntt-it.co.jp", "attachment_id": 5791, "id": 34937, "time": "2003-04-11T05:09:57Z", "bug_id": 9351, "creation_time": "2003-04-11T05:09:57Z", "is_private": false, "text": "Created attachment 5791\npatch for org.apache.tomcat.util.net.URL"}, {"text": "Created attachment 5792\ntest case for org.apache.tomcat.util.net.URL", "tags": [], "bug_id": 9351, "is_private": false, "count": 11, "id": 34938, "time": "2003-04-11T05:11:29Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-11T05:11:29Z", "attachment_id": 5792}, {"count": 12, "text": "Created attachment 5793\npatch for org.apache.catalina.util.URL", "bug_id": 9351, "attachment_id": 5793, "id": 34939, "time": "2003-04-11T05:12:34Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-11T05:12:34Z", "tags": [], "is_private": false}, {"text": "Created attachment 5794\ntest case for org.apache.catalina.util.URL", "tags": [], "bug_id": 9351, "is_private": false, "count": 13, "id": 34940, "time": "2003-04-11T05:13:02Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-11T05:13:02Z", "attachment_id": 5794}, {"count": 14, "tags": [], "bug_id": 9351, "attachment_id": null, "is_private": false, "id": 34941, "time": "2003-04-11T05:22:26Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-11T05:22:26Z", "text": "I've posted all patches and test-cases I maked.\n\norg.apache.catalina.connector package has same problems,\nbut it was \"deprecated\" sp I have do nothing to it.\n"}, {"count": 15, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "id": 34943, "time": "2003-04-11T06:16:43Z", "bug_id": 9351, "creation_time": "2003-04-11T06:16:43Z", "is_private": false, "text": "Your patches still have bugs in them.  I've committed changes to \no.a.t.u.net.URL (one of the less critical classes) based on a heavily modified \nversion of your patch.  You might want to review it to see some of the \nproblems, and re-submit fixed patches."}, {"count": 16, "text": "I have reviewed comitted o.a.t.u.net.URL\nand I realize that I have misunderstanded URL#getHost()'s sepecification.\n\"URL#getHost() returns IPv6 address enclosed in square brackets.\"\n\no.a.c.u.URL's patch I posted is invalid.\no.a.c.u.URL needs patch same with o.a.t.u.net.URL.\n\nCoyoteRequest's patch I posted is invalid.\nCoyoteRequest needs no patches.\n\nDoes ServletRequest#getServerName() also returns enclosed IPv6 address?\nIf it does,\n CoyoteResponse needs no patches,\n Http11Processor's patch I posted has to be fixed.\n", "bug_id": 9351, "attachment_id": null, "id": 34958, "time": "2003-04-11T11:04:55Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-11T11:04:55Z", "tags": [], "is_private": false}, {"count": 17, "tags": [], "bug_id": 9351, "attachment_id": 5798, "is_private": false, "id": 34960, "time": "2003-04-11T11:07:46Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-11T11:07:46Z", "text": "Created attachment 5798\nfixed patch for org.apache.coyote.http11.Http11Processor. (ServletRequest#getServerName() returns enclosed IPv6 address)"}, {"count": 18, "tags": [], "creator": "yamagu@ntt-it.co.jp", "attachment_id": 5799, "is_private": false, "id": 34961, "time": "2003-04-11T11:11:12Z", "bug_id": 9351, "creation_time": "2003-04-11T11:11:12Z", "text": "Created attachment 5799\nfixed test case for org.apache.coyote.http11.Http11Processor. (serverName is enclosed IPv6 address)"}, {"count": 19, "text": "Created attachment 5800\nfixed test case for o.a.t.u.net.URL (getHost() returns enclosed IPv6 address)", "bug_id": 9351, "attachment_id": 5800, "id": 34962, "time": "2003-04-11T11:15:28Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-04-11T11:15:28Z", "tags": [], "is_private": false}, {"count": 20, "tags": [], "bug_id": 9351, "attachment_id": null, "text": "I have applied the patch to Http11Processor, thanks :)\nAs for o.a.c.u.URL, it does not seem to be used anymore, so I see no reason for\npatching it (t.u.net.URL).", "id": 42146, "time": "2003-08-05T12:38:03Z", "creator": "remm@apache.org", "creation_time": "2003-08-05T12:38:03Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "Hi,\n\nAnnotation processing for Servlets/Listeners/Filters is skipped when:\n- the web app is not extracted (screenshot1), \n- classes do not have packages (screenshot2),\n- for some embedded scenarios (running Tomcat in OSGI environment - screenshot3)\n\nA test web application is attached - test-web-app.war.\n\nI followed the history and the change that introduces that behaviour is made with revision 1210012.\n\n\n\norg.apache.catalina.startup.ContextConfig\n\nThe annotations are processed correctly in all use cases when we have:\n\n1199    URL webinfClasses;\n1200    try {\n1201        webinfClasses = context.getServletContext().getResource(\n1202                                \"/WEB-INF/classes\");\n1203        processAnnotationsUrl(webinfClasses, webXml);\n1204    } catch (MalformedURLException e) {\n1205        log.error(sm.getString(\n1206                                \"contextConfig.webinfClassesUrl\"), e);\n1207    }\n\n\nThe way how they are processed now is assuming that we will have FirDirContext always.\n\n1196    try {\n1197        NamingEnumeration<Binding> listBindings =\n1198                    context.getResources().listBindings(\"/WEB-INF/classes\");\n1199        while (listBindings.hasMoreElements()) {\n1200            Binding binding = listBindings.nextElement();\n1201            if (binding.getObject() instanceof FileDirContext) {\n1202               File webInfCLassDir =\n1203                     new File(\n1204                       ((FileDirContext) binding.getObject()).getDocBase());\n1205               processAnnotationsFile(webInfCLassDir, webXml);\n1206            }\n1207        }\n1208    } catch (NamingException e) {\n1209        log.error(sm.getString(\n1210                            \"contextConfig.webinfClassesUrl\"), e);\n1211    }\n\n\nRegards\nVioleta Georgieva", "is_private": false, "id": 153787, "creator": "violetagg@apache.org", "time": "2012-02-14T21:39:46Z", "bug_id": 52669, "creation_time": "2012-02-14T21:39:46Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 28333\nscreenshot1", "attachment_id": 28333, "id": 153788, "creator": "violetagg@apache.org", "time": "2012-02-14T21:40:29Z", "bug_id": 52669, "creation_time": "2012-02-14T21:40:29Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 52669, "attachment_id": 28334, "id": 153789, "time": "2012-02-14T21:41:01Z", "creator": "violetagg@apache.org", "creation_time": "2012-02-14T21:41:01Z", "is_private": false, "text": "Created attachment 28334\nscreenshot2"}, {"count": 3, "tags": [], "text": "Created attachment 28335\nscreenshot3", "attachment_id": 28335, "id": 153790, "creator": "violetagg@apache.org", "time": "2012-02-14T21:41:35Z", "bug_id": 52669, "creation_time": "2012-02-14T21:41:35Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 52669, "attachment_id": 28336, "is_private": false, "id": 153791, "time": "2012-02-14T21:43:03Z", "creator": "violetagg@apache.org", "creation_time": "2012-02-14T21:43:03Z", "text": "Created attachment 28336\ntest web app"}, {"count": 5, "tags": [], "text": "This has been fixed in trunk and 7.0.x and will be included in 7.0.26 onwards.", "attachment_id": null, "id": 153820, "creator": "markt@apache.org", "time": "2012-02-15T21:37:50Z", "bug_id": 52669, "creation_time": "2012-02-15T21:37:50Z", "is_private": false}, {"count": 6, "tags": [], "text": "Thanks!\nVioleta", "is_private": false, "id": 153835, "creator": "violetagg@apache.org", "time": "2012-02-16T12:23:50Z", "bug_id": 52669, "creation_time": "2012-02-16T12:23:50Z", "attachment_id": null}]
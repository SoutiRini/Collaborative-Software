[{"count": 0, "tags": [], "bug_id": 23881, "attachment_id": null, "text": "SingleSignOn valve and FormAuthenticator fail to authenticate correctly when \nTomcat works as embedded engine using a jaas realm (jboss). SingleSignOn code \nwrongly sets the principal inside request based on his cookie and \nFormAuthenticator just thinks everything is ok. In fact FormAuthenticator has \nto call authenticate again using the 'username' and 'password' stored inside \nthe entry for that ssoId (value of the cookie). One way to fix it is to set \nonly the request REQ_SSOID_NOTE (not the principal too) inside SingleSignOn \nvalve. FormAuthenticator has to make a SingleSignOn lookup, retrieve the \nusername and password and call authenticate. This should happen after checking \n(unsuccessfully) the credentials stored inside the session. This kind of fix \nmade it working for me , although the code is still somewhat not optimal - \n(associate is called way to often, and the same for register , which will reset \nthe cookie)", "id": 45813, "time": "2003-10-17T06:25:54Z", "creator": "viorel@objectsavvy.com", "creation_time": "2003-10-17T06:25:54Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 23881, "attachment_id": null, "text": "also the register method in AuthenticatorBase creates a new cookie for \nSingleSignOn - i guess should check against an already existing cookie (using \nlookup) - and just call method associate in case this one exists. this solves a \npotential memory leak and the logout issue (register is called after every \nsuccessful authenticate with the container realm). ", "id": 45821, "time": "2003-10-17T09:08:35Z", "creator": "viorel@objectsavvy.com", "creation_time": "2003-10-17T09:08:35Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 23881, "attachment_id": 9247, "text": "Created attachment 9247\nPatch w/ diff and one new class", "id": 47940, "time": "2003-11-23T00:01:06Z", "creator": "bstansberry@jboss.com", "creation_time": "2003-11-23T00:01:06Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 23881, "attachment_id": null, "id": 47941, "time": "2003-11-23T00:18:29Z", "creator": "bstansberry@jboss.com", "creation_time": "2003-11-23T00:18:29Z", "is_private": false, "text": "Attached is a proposed patch.  It adds a configurable \nattribute \"requiresReauthentication\" to SingleSignOn.  If \"false\" (the \ndefault), applications will behave as they do now.  If \"true\", each incoming \nrequest will need to be reauthenticated to the Realm.  The various \nauthenticators have been modified to handle this.  In this case the \nSingleSignOnEntry serves as a store of authentication credentials.\n\nIf the 1st webapp a user visits uses FORM or BASIC auth, and then they visit \nanother app that requires DIGEST, the cached username/password from the \nFORM/BASIC authentication will not be sufficient information to do a digest \nauthentication, so the user will be prompted for a digest login.  Possibly we \ncould add a config option to allow a username/password authentication to \noverride the DIGEST auth specified in the web.xml.\n\nSimilarly, if the user first visits a webapp with DIGEST auth, and then visits \none that uses FORM or BASIC, again the cached credentials will not be \nsufficient (no cached password from the digest auth), so they will have to be \nprompted for their username/password.\n\nThe attached patch includes logic that deals with all this and ensures that a \nsingle SSO session is maintained throughout.\n\nOf course, if webapps in a deployment don't mix their authentication schemes, \nnone of the above details are an issue.\n\nThis bug was raised against TC 4; sorry the patch is against TC 5.  I can very \neasily pull together a TC4.1 version if desired.\n\nThis patch also addresses bug 10040."}, {"count": 4, "tags": [], "creator": "remm@apache.org", "text": "I think I'm going to apply this patch. Esp since it has been tested in JB land\nfirst (otherwise, I wouldn't want to commit it so close to a release).", "id": 47961, "time": "2003-11-23T17:45:49Z", "bug_id": 23881, "creation_time": "2003-11-23T17:45:49Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 23881, "attachment_id": null, "text": "I have applied your patch, thanks.", "id": 48023, "time": "2003-11-24T16:53:11Z", "creator": "remm@apache.org", "creation_time": "2003-11-24T16:53:11Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 23881, "attachment_id": 9288, "text": "Created attachment 9288\nPort of the TC5 patch to TC 4.1; includes related fix to 9077 and 10040", "id": 48134, "time": "2003-11-26T04:53:11Z", "creator": "bstansberry@jboss.com", "creation_time": "2003-11-26T04:53:11Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 23881, "attachment_id": null, "text": "*** Bug 4350 has been marked as a duplicate of this bug. ***", "id": 48640, "time": "2003-12-07T19:27:50Z", "creator": "medthomas@ntlworld.com", "creation_time": "2003-12-07T19:27:50Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 23881, "attachment_id": 9694, "text": "Created attachment 9694\nPrevious patch to 4.1 updated to avoid conflict with patch applied today by Mark Thomas", "id": 49659, "time": "2003-12-24T06:44:21Z", "creator": "bstansberry@jboss.com", "creation_time": "2003-12-24T06:44:21Z", "is_private": false}, {"count": 9, "tags": [], "creator": "bstansberry@jboss.com", "text": "Patch attached a moment ago is a zip file which includes a diff plus a new \nclass.  The new class is just the existing SingleSignOnEntry inner class \nextracted out of SingleSignOn.", "id": 49660, "time": "2003-12-24T06:48:03Z", "bug_id": 23881, "creation_time": "2003-12-24T06:48:03Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 23881, "attachment_id": null, "text": "I have applied you patch to TC4.", "id": 49680, "time": "2003-12-24T20:42:42Z", "creator": "medthomas@ntlworld.com", "creation_time": "2003-12-24T20:42:42Z", "is_private": false}]
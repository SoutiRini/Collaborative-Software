[{"count": 0, "tags": [], "creator": "liu_xp2003@sina.com", "text": "Test Steps:\n1. Create one URL HTTP sampler and one thread with longtime loops.\n2. Please checked KeepAlive for the test script.[to see connection change, you can add a Constant Timer]\n3. Chose HttpClient4 implementation and save the test script.\n4. Run the test script and check local socket with target IP connection.[I used netstat command to get result]\n\nExpect Result:\nOne JMeter thread could reuse one TCP Socket when choosing KeepAlive.\n\nActural Result:\nHttpClient4 implementation create a new TCP socket each time.\nAnd HttpClient3.1 implementation can reuse one TCP socket each time when using KeepAlive.", "id": 195534, "time": "2016-12-18T01:46:18Z", "bug_id": 60492, "creation_time": "2016-12-18T01:46:18Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 60492, "attachment_id": null, "id": 195540, "time": "2016-12-18T10:04:05Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-12-18T10:04:05Z", "is_private": false, "text": "Hello,\nCould you provide a test plan showing the issue ?\n\nAre you sure that timer pause does not exceed the keepalivetimeput sent by server ?\nThere are also tunings in jmeter that control socket keepalive based on what server sends in headers.\n\nSee:\n\nhttp://jmeter.apache.org/usermanual/properties_reference.html#httpclient4"}, {"count": 2, "tags": [], "bug_id": 60492, "attachment_id": 34547, "text": "Created attachment 34547\nJMeter Test Scripts", "id": 195604, "time": "2016-12-22T10:15:15Z", "creator": "liu_xp2003@sina.com", "creation_time": "2016-12-22T10:15:15Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 60492, "attachment_id": null, "text": "I am sure that timer pause does not exceed the keepalive timeout.\nPlease compare the different between HttpClient 3.1 and HttpClient 4.", "id": 195605, "time": "2016-12-22T10:20:28Z", "creator": "liu_xp2003@sina.com", "creation_time": "2016-12-22T10:20:28Z", "is_private": false}, {"count": 4, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "In default configuration , JMeter will make the connection live for \"httpclient4.time_to_live\" property which defaults to 2000 (ms).\n\n1/ What is your server's  keepalive timeout ?\nIf higher then it explains your problem.\n\n2/ How did you notice this problem ? \n3/ Is it by the connections being closed ?\n\nIf so have a look at those in jmeter.properties:\nhttpclient4.retrycount\nhttpclient4.idletimeout\n\nHC3.1 is very old now, and if behaviour differ, it does not mean that HC3.1 is right.\n\nThanks for your feedback.", "id": 195609, "time": "2016-12-22T12:42:46Z", "bug_id": 60492, "creation_time": "2016-12-22T12:42:46Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "liu_xp2003@sina.com", "text": "My web server used tomcat 8 with default setting. \nI paid attention to this behaviour duration backend web micro service stress testing.\nI not sure whether it is right for my testing using HttpClient 4, but the behaviour is different with HttpClient 3.1.\n\nThank you for your suggestion. I verified using different value of \"httpclient4.time_to_live\" again.\nWhen I using default value and testing sina web site with one thread, I could see new socket created in a short time. And previous socket was changed to TIME_WAIT.\nC:\\windows\\system32>netstat -na|grep 105:80\n  TCP    192.168.1.111:36577    140.211.11.105:80      TIME_WAIT\n  TCP    192.168.1.111:36578    140.211.11.105:80      TIME_WAIT\n  TCP    192.168.1.111:36581    140.211.11.105:80      TIME_WAIT\n  TCP    192.168.1.111:36583    140.211.11.105:80      FIN_WAIT_1\n  TCP    192.168.1.111:36587    140.211.11.105:80      ESTABLISHED\n\nAfter I changed httpclient4.time_to_live value to 10,000, I restarted JMeter and ran same test script again. I could see new socket created not frequently.\nC:\\windows\\system32>netstat -na|grep 105:80\n  TCP    192.168.1.111:36654    140.211.11.105:80      TIME_WAIT\n  TCP    192.168.1.111:36657    140.211.11.105:80      TIME_WAIT\n  TCP    192.168.1.111:36661    140.211.11.105:80      ESTABLISHED\n\nC:\\windows\\system32>netstat -na|grep 105:80\n  TCP    192.168.1.111:36654    140.211.11.105:80      TIME_WAIT\n  TCP    192.168.1.111:36657    140.211.11.105:80      TIME_WAIT\n  TCP    192.168.1.111:36661    140.211.11.105:80      TIME_WAIT\n  TCP    192.168.1.111:36664    140.211.11.105:80      SYN_SENT\n\nTo simulate end user behaviour, I believe the default setting is reasonable.\nDo you have suggestion about value of httpclient4.time_to_live parameter, when running simulate testing between two server with KeepAlive?", "id": 195649, "attachment_id": null, "bug_id": 60492, "creation_time": "2016-12-24T05:23:17Z", "time": "2016-12-24T05:23:17Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 60492, "attachment_id": null, "text": "(In reply to Liu XP from comment #5)\n> My web server used tomcat 8 with default setting. \n> I paid attention to this behaviour duration backend web micro service stress\n> testing.\n> I not sure whether it is right for my testing using HttpClient 4, but the\n> behaviour is different with HttpClient 3.1.\n> \n> Thank you for your suggestion. I verified using different value of\n> \"httpclient4.time_to_live\" again.\n> When I using default value and testing sina web site with one thread, I\n> could see new socket created in a short time. And previous socket was\n> changed to TIME_WAIT.\n> C:\\windows\\system32>netstat -na|grep 105:80\n>   TCP    192.168.1.111:36577    140.211.11.105:80      TIME_WAIT\n>   TCP    192.168.1.111:36578    140.211.11.105:80      TIME_WAIT\n>   TCP    192.168.1.111:36581    140.211.11.105:80      TIME_WAIT\n>   TCP    192.168.1.111:36583    140.211.11.105:80      FIN_WAIT_1\n>   TCP    192.168.1.111:36587    140.211.11.105:80      ESTABLISHED\n> \n> After I changed httpclient4.time_to_live value to 10,000, I restarted JMeter\n> and ran same test script again. I could see new socket created not\n> frequently.\n> C:\\windows\\system32>netstat -na|grep 105:80\n>   TCP    192.168.1.111:36654    140.211.11.105:80      TIME_WAIT\n>   TCP    192.168.1.111:36657    140.211.11.105:80      TIME_WAIT\n>   TCP    192.168.1.111:36661    140.211.11.105:80      ESTABLISHED\n> \n> C:\\windows\\system32>netstat -na|grep 105:80\n>   TCP    192.168.1.111:36654    140.211.11.105:80      TIME_WAIT\n>   TCP    192.168.1.111:36657    140.211.11.105:80      TIME_WAIT\n>   TCP    192.168.1.111:36661    140.211.11.105:80      TIME_WAIT\n>   TCP    192.168.1.111:36664    140.211.11.105:80      SYN_SENT\n> \n> To simulate end user behaviour, I believe the default setting is reasonable.\n> Do you have suggestion about value of httpclient4.time_to_live parameter,\n> when running simulate testing between two server with KeepAlive?\n\nI suggest you raise the question on user mailing list as it will interest many people and I am not sure to have \"THE\" answer.\n\nClosing as WORKSFORME.", "id": 195732, "time": "2016-12-30T20:56:25Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-12-30T20:56:25Z", "is_private": false}]
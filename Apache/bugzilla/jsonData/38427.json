[{"count": 0, "tags": [], "creator": "kevin.l.janise@accenture.com", "attachment_id": null, "text": "The ServletContextListener is getting notified multiple times when virtual \nhosting is used.\n\nI created an app and deployed it under the Tomcat 5.5.15\\webapps directory \nwhere it worked as expected. \n\nI then deployed the same app using virtual hosting and found that the \nServletContextListener is notified 2 times. If I put a static counter variable \nin it the variable does not get incremented. \n\nA Singleton registry object I created shows that items are getting registered \ninto it 2 times, I'm logging when items are registered in it. But no exception \nis generated. I throw an exception if objects are being bound using the same \nname. It seems there are 2 of them in existence.\n\nHere is the entry I'm using in the server.xml file to set up the virtual \nhosting.\n\n      <Host name=\"test.struts\"\n            appBase=\"C:/Data/Projects/test\"\n            unpackWARs=\"true\"\n            autoDeploy=\"true\"\n            xmlValidation=\"false\"\n            xmlNamespaceAware=\"false\">\n\n         <Alias>www.test.struts</Alias>\n\n         <Context path=\"\" docBase=\"test.struts\" reloadable=\"true\" debug=\"0\">\n             <Resource\n               name=\"jdbc/test\"\n               type=\"javax.sql.DataSource\"\n               password=\"password\"\n               driverClassName=\"com.mysql.jdbc.Driver\"\n               maxIdle=\"2\"\n               maxWait=\"5000\"\n               validationQuery=\"SELECT 1\"\n               username=\"root\"\n               url=\"jdbc:mysql://localhost:3306/test\"\n               maxActive=\"4\"/>\n         </Context>\n      </Host>\n\nI also get the same behavior under the 5.5.15 version. That wasn't an \navailable option I could select when filling in the report.", "id": 85134, "time": "2006-01-27T21:22:00Z", "bug_id": 38427, "creation_time": "2006-01-27T21:22:00Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 38427, "attachment_id": null, "id": 87987, "creation_time": "2006-04-13T20:23:11Z", "time": "2006-04-13T20:23:11Z", "creator": "yoavs@computer.org", "text": "5.5.15 is an available option now, so I'm updating the version.\n\nI wonder if each Host (virtual or not) gets its own classloader: that would\nexplain the behavior you're seeing.  To confirm that hunch, to something like\nSystem.out.println(getClass().getClassloader().toString()) from your Listener. \nAnd if that hunch is confirmed, and you truly want a single object across\nmultiple classloaders, put that object in a different repository (e.g.\ncommon/lib instead of WEB-INF/lib).", "is_private": false}, {"count": 2, "tags": [], "bug_id": 38427, "attachment_id": null, "is_private": false, "id": 124646, "time": "2009-02-03T23:08:31Z", "creator": "markt@apache.org", "creation_time": "2009-02-03T23:08:31Z", "text": "Your context definition is causing multiple deployment of your application - hence the multiple listener notifications.\n\nYou need to use a dir called ROOT or move your docBase outside your appBase.\n\nPlease ask on the users list if your require further assistance with your configuration."}]
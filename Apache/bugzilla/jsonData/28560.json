[{"count": 0, "text": "mod_jk and mod_jk2 both always use the first JSESSIONID cookie for picking the\nsession route and fail if the first one isn't valid.\n\nThis is a problem in the case where you have a domain running tomcat\n(example.com) and a subdomain of that domain (foo.example.com) running tomcat\nwith load balancing with mod_jk[2].\n\nWhat happens is the tomcat at example.com sets a JSESSIONID cookie for the\ndomain example.com. Then when the user accesses foo.example.com the jvmroute\nfrom example.com isn't valid, so mod_jk[2] pick a random clone to forward the\nrequest to. The foo.example.com tomcat clone then sets a new JSESSIONID for\nfoo.example.com .\n\nNow the cookie spec, RFC 2965, says that more than one cookie with the same name\nis valid. If the browser happens to send the foo.example.com JSESSIONID cookie\nbefore the example.com JSESSIONID cookie, things are fine. But if the\nexample.com cookie comes first, then mod_jk[2] fails to see the second\nJSESSIONID cookie. This is the case with IE5 and IE6, which unfortunatly the\nmost common browsers.\n\nNow I thought the cookie spec says the most specific cookie should be sent\nfirst, but what it really says in section 3.3.4 is:\n\n\"[...] they are ordered in the Cookie header such that those with more specific\nPath attributes precede those with less specific.  Ordering with respect to\nother attributes (e.g., Domain) is unspecified.\"\n\nWhile I know what needs to be fixed, my C coding skills are much too weak to\nactually write the patch myself.\n\nmod_jk:\n\njk/native/common/jk_lb_worker.c: get_most_suitable_worker needs to accecpt an\narray of possible session_routes. get_session_route, get_sessionsid, get_cookie\nneed to return an array of matching session ids/cookies.\n\n\nmod_jk2:\n\njk/native2/common/jk_worker_lb.c: jk2_get_most_suitable_worker needs to accept\nan array of all possible jvmRoutes from jk2_request_getSessionRoute\n\njk/native2/common/jk_requtil.c: jk2_request_getSessionRoute,\njk2_requtil_getSessionId, and jk2_requtil_getCookieByName need to return an\narray of possible cookies/jvmroutes.\n\n\nIf you'd like to witness this problem visit the following URLs in order with IE5\nor IE6. The last URL will show all headers where you can see the muliptial\nJSESSIONID headers after you've reloaded it.\n\nhttps://webmail.ufl.edu/\nhttps://test.webmail.ufl.edu/test.jsp\n\nIf you keep reloading you'll notice two jvmroutes. gatormail_p# is for\nwebmail.ufl.edu and gatormail_t# is for test.webmail.ufl.edu. The value of\ngatormail_t# will change randomly as mod_jk distributes requests between the clones.", "creator": "sandymac@apache.org", "attachment_id": null, "id": 56312, "time": "2004-04-23T17:41:49Z", "bug_id": 28560, "creation_time": "2004-04-23T17:41:49Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 28560, "attachment_id": null, "id": 61435, "time": "2004-08-02T06:15:18Z", "creator": "sandymac@apache.org", "creation_time": "2004-08-02T06:15:18Z", "is_private": false, "text": "FYI: This has been fixed in CVS for mod_jk 1. Don't know about mod_jk2."}, {"count": 2, "text": "I also found this to be the case with jk2...but a bit more general.  The first \ncookie with JSESSIONID as a substring of the name is picked up by the \nconnector.  In my case: webpsoft8-83-PORTAL-PSJSESSIONID\n\nIt only seems to happen when the connector is configured to deal with 2+ \ninstances of tomcat using load balancing.  If I use my load balancer setup with \njust 1 instance, it works fine.  \n", "creator": "marcus@roundpeg.com", "attachment_id": null, "id": 63304, "time": "2004-09-09T17:32:18Z", "bug_id": 28560, "creation_time": "2004-09-09T17:32:18Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 28560, "attachment_id": null, "id": 67347, "time": "2004-11-22T15:58:45Z", "creator": "yoavs@computer.org", "creation_time": "2004-11-22T15:58:45Z", "is_private": false, "text": "mod_jk2 is going away and this issue won't be addressed in its code base.  \nBecause it's already been fixed for mod_jk as you have noted, I'm closing the \nissue.  Thanks."}]
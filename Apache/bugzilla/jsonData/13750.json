[{"count": 0, "tags": [], "text": "First of all, I do have a Cookie Manager in my Test Plan, with that out of the\nway I can describe the problem.\n\nA site I am trying to load test uses a strange method of validating cookies and\nautomatic redirection.\n\nA login page is requested, which sends back a cookie and an HTTP error code of\n302 with the \"Location\" header set to a server side program that verifies that\nthe cookie just set has been set to the correct value.\n\nJMeter does the redirect just fine, but the redirected request does not have the\ncookie set in it.\n\nThis affects version 1.8 as well.", "attachment_id": null, "id": 24827, "creation_time": "2002-10-17T19:59:27Z", "time": "2002-10-17T19:59:27Z", "creator": "nathanc@tni.com", "bug_id": 13750, "is_private": false}, {"count": 1, "attachment_id": 3506, "bug_id": 13750, "is_private": false, "id": 24828, "time": "2002-10-17T20:00:30Z", "creator": "nathanc@tni.com", "creation_time": "2002-10-17T20:00:30Z", "tags": [], "text": "Created attachment 3506\nHTTP trace (edited for readability)"}, {"count": 2, "tags": [], "creator": "jsalvata@atg.com", "attachment_id": null, "is_private": false, "id": 26249, "time": "2002-11-14T00:45:53Z", "bug_id": 13750, "creation_time": "2002-11-14T00:45:53Z", "text": "FYI: My site is doing the exact same thing and I'm not experiencing this problem\n(using latest CVS version as of 13th November 2002)."}, {"count": 3, "tags": [], "text": "Unfortunately, our firewall prevents me from connecting to CVS repositories on\noutside.\n\nI can therefore only download released versions of JMeter.\n\nI looked in the source code but couldn't follow the flow of control very well,\nso I couldn't fix it myself. I just wrote my own special purpose utility using\nHTTPUnit, since I didn't need JMeter for profiling purposes, yet.\n\nWithout this bug fixed, I can't profile my site. (The cookie passed back is\nvital to the function of the rest of the site.)", "is_private": false, "bug_id": 13750, "id": 26251, "time": "2002-11-14T01:00:51Z", "creator": "nathanc@tni.com", "creation_time": "2002-11-14T01:00:51Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Been testing. Both 1.8 and current CVS exhibit the behaviour exposed in this\nbug. So my previous assessment was wrong. I'll ASSIGN this to me and try to fix\nit now.", "is_private": false, "id": 28926, "creation_time": "2003-01-07T00:39:08Z", "time": "2003-01-07T00:39:08Z", "creator": "jsalvata@atg.com", "bug_id": 13750, "attachment_id": null}, {"count": 5, "tags": [], "text": "Tsk tsk. I forgot to add a cookie manager :-(\n\nOK. I've reproduced this on 1.8 and verified that it doesn't happen on current\nCVS. Not been able to establish where it was solved -- the 1.8 code looks\ncorrect to me...\n\nMarking this bug as FIXED -- since there's no resultion of \"GONE AWAY\". We need\nto watch out this one on release, though, because I couldn't think of an easy\nway to create a unit test for it.", "is_private": false, "id": 28928, "creator": "jsalvata@atg.com", "time": "2003-01-07T01:11:45Z", "bug_id": 13750, "creation_time": "2003-01-07T01:11:45Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 13750, "is_private": false, "id": 32827, "time": "2003-03-10T09:40:44Z", "creator": "jsalvata@atg.com", "creation_time": "2003-03-10T09:40:44Z", "tags": [], "text": "Bulk-editing to close all bugs reported fixed by 1.8.1."}, {"count": 7, "tags": [], "text": "Sorry it took me so long to re-test this bug after 1.8.1 was released, but it is\nstill there.", "is_private": false, "id": 37637, "creation_time": "2003-05-22T20:30:16Z", "time": "2003-05-22T20:30:16Z", "creator": "nathanc@tni.com", "bug_id": 13750, "attachment_id": null}, {"count": 8, "tags": [], "text": "Working through the same bug with HTTPUnit developers I have a reason for my\nproblem (although not yet a fix).\n\nThe problem comes in because the RFC 2109 states:\n\n4.3.2  Rejecting Cookies\n\n   To prevent possible security or privacy violations, a user agent\n   rejects a cookie (shall not store its information) if any of the\n   following is true:\n\n<snip/>\n\n   * The request-host is a FQDN (not IP address) and has the form HD,\n     where D is the value of the Domain attribute, and H is a string\n     that contains one or more dots.\n\n   Examples:\n\n   * A Set-Cookie from request-host y.x.foo.com for Domain=.foo.com\n     would be rejected, because H is y.x and contains a dot.\n\n\nThe actual unedited Packet Capture includes a Set-Cookie from request-host\ntahitiannoni.devh.web0a.morinda.com for Domain=.morinda.com, and is therefore\nrejected by JMeter because of the rule mentioned.\n\nThe browsers must be ignoring this rule, because it works on IE, Mozilla, and\neven Netscape 4.5.\n\nIn order for JMeter to emulate browsers properly, it should allow for the\ncookies to be set like the browsers, or at least give us the option to turn that\nrejection rule off.", "is_private": false, "id": 37676, "creation_time": "2003-05-23T15:14:53Z", "time": "2003-05-23T15:14:53Z", "creator": "nathanc@tni.com", "bug_id": 13750, "attachment_id": null}, {"count": 9, "tags": [], "creator": "mstover1@apache.org", "attachment_id": null, "is_private": false, "id": 38402, "time": "2003-06-05T00:35:50Z", "bug_id": 13750, "creation_time": "2003-06-05T00:35:50Z", "text": "I don't think that's the reason the cookie isn't being passed in JMeter.  I\nsuspect the problem is the matching of domain names in CookieManager.  JMeter\ncould probably benefit from greatly relaxing the rules of cookie passing.  Would\nthere be any problems with passing all cookies and ignoring domain/path\ninformation in the cookies?  We're not worried about security or privacy here..."}, {"count": 10, "tags": [], "creator": "mhilpert@gmx.de", "attachment_id": null, "id": 48408, "time": "2003-12-03T10:03:06Z", "bug_id": 13750, "creation_time": "2003-12-03T10:03:06Z", "is_private": false, "text": "this still seems to be a problem in the latest 1.9.1 release. more and more \npages use cookies and therefore, a correct cookie handling in JMeter is \nessential. any chance for a new version fixing this?"}, {"count": 11, "tags": [], "text": "I've been testing for this one, and it works well for me, both on 1.9.1 and on\ncurrent CVS.\n\nCan anyone affected by this problem please submit a test case?", "attachment_id": null, "id": 48448, "creator": "jsalvata@atg.com", "time": "2003-12-04T01:23:10Z", "bug_id": 13750, "creation_time": "2003-12-04T01:23:10Z", "is_private": false}, {"count": 12, "tags": [], "text": "I had a similar problem with logging in on a server with this strange login \nmethod. I am using Websphere 4.0. However, I do not think the different \nbehaviour of jmeter and the browsers is related to setting Cookies while \nredirecting in my case. I did also suspect this, but I have tested that setting \ncookies while redirecting works fine. With my server, the behaviour is related \nto the dot in the cookie domain name.\n\nI did find the following: After submitting the login form with the correct \ncredentials to the server, the client receives the following response\n\nHTTP/1.1 200 OK\nServer: WebSphere Application Server/4.0\nContent-Type: text/html\nSet-Cookie: LtpaToken=SOME_VERY_CRYPTIC_LONG_ID;Domain=.192.168.0.3;Path=/\nCache-Control: no-cache=\"set-cookie,set-cookie2\"\nExpires: Thu, 01 Dec 1994 16:00:00 GMT\nContent-Language: de\nContent-Length: 0\n\nThe problem is the dot at the beginning of the Domain \".192.168.0.3\"\nMozilla 1.4 seems to ignore the dot in front of the IP Address (meaning that in \nthe \"manage stored cookies\"-window, the domain of the Cookie is shown \nas \"192.168.0.3\" without the dot.) Also in IE 5.0, the cookie is set. In \njmeter, however, the cookie is not set; preventing the login. \n\nI checked this hypothesis by removing the domain check in the jmeter source \nfile CookieManager.java from release 1.9.1 ($Revision: 1.14.2.1 $ $Date: \n2003/08/17 14:12:37 $) by changing lines 309-311 from\nif (url.getHost().endsWith(cookie.getDomain())\n    && url.getFile().startsWith(cookie.getPath())\n    && (System.currentTimeMillis() / 1000) <= cookie.getExpires())\nto\nif (url.getFile().startsWith(cookie.getPath())\n    && (System.currentTimeMillis() / 1000) <= cookie.getExpires())\n\nand then the login on Websphere works without problems. Of course, this is only \na quick hack and is not proposed as final solution.\n\nThinking about the problem in general (Cookie access checking), my opinion is \nthat relaxing Cookie-checks too much also poses problems: Perhaps somebody \nwants to load-test the behaviour of a site when users are rejected at log-in.", "attachment_id": null, "bug_id": 13750, "id": 48812, "time": "2003-12-10T15:13:33Z", "creator": "fischer@seitenbau.de", "creation_time": "2003-12-10T15:13:33Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 13750, "attachment_id": null, "id": 48894, "time": "2003-12-11T12:26:04Z", "creator": "jsalvata@atg.com", "creation_time": "2003-12-11T12:26:04Z", "is_private": false, "text": "Checked that browsers behave the way Thomas says --even Mozilla does.\n\nIt's clearly a breach of the spec, but hey!\n\nI'll fix this one by removing the leading dot if it's there."}, {"count": 14, "tags": [], "creator": "jsalvata@atg.com", "attachment_id": null, "is_private": false, "id": 48898, "time": "2003-12-11T13:07:46Z", "bug_id": 13750, "creation_time": "2003-12-11T13:07:46Z", "text": "Fixed this, although actually by adding a leading dot whenever it is not there.\nThis helps preventing a mistmatch of host (e.g.) jakarta.apache.org to domain\nache.org."}]
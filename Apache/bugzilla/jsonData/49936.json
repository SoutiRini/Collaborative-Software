[{"count": 0, "tags": [], "creator": "ssmeets@ravn.co.uk", "attachment_id": 26030, "id": 139887, "time": "2010-09-15T20:14:21Z", "bug_id": 49936, "creation_time": "2010-09-15T20:14:21Z", "is_private": false, "text": "Created attachment 26030\npatch\n\nHi,\n\nFor some reason I have some Word documents that have a header/footer that causes the following StringIndexOutOfBoundsException:\nException in thread \"main\" java.lang.StringIndexOutOfBoundsException: String index out of range: -1\n\tat java.lang.String.substring(String.java:1937)\n\tat org.apache.poi.hwpf.usermodel.HeaderStories.getAt(HeaderStories.java:162)\n\tat org.apache.poi.hwpf.usermodel.HeaderStories.getFirstHeader(HeaderStories.java:87)\n\tat org.apache.poi.hwpf.extractor.WordExtractor.getHeaderText(WordExtractor.java:177)\n\tat com.ravn.test.poi.MSDocTester.parse(MSDocTester.java:28)\n\tat com.ravn.test.Tester.main(Tester.java:17)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat com.intellij.rt.execution.application.AppMain.main(AppMain.java:115)\n\nAfter investigation it turns out that prop.getEnd() was smaller then prop.getStart() in one case and in the other case both prop.getStart() and prop.getEnd() were bigger then headerStories.text().length. Therefore I implemented two additional checks in the HeaderStories.java in the getAt method, see attached patch. Could this be added to the next release if approved?\n\nThanks in advance,\nSjoerd"}, {"count": 1, "attachment_id": null, "creator": "apache@gagravarr.org", "is_private": false, "id": 139905, "time": "2010-09-16T12:08:43Z", "bug_id": 49936, "creation_time": "2010-09-16T12:08:43Z", "tags": [], "text": "Any chance you could upload a problem word document that currently breaks? This can then be used as the basis of a unit test to be committed with this patch"}, {"count": 2, "tags": [], "text": "Created attachment 26033\nWordDoc for Junit test", "is_private": false, "bug_id": 49936, "id": 139906, "time": "2010-09-16T13:33:42Z", "creator": "ssmeets@ravn.co.uk", "creation_time": "2010-09-16T13:33:42Z", "attachment_id": 26033}, {"count": 3, "tags": [], "creator": "ssmeets@ravn.co.uk", "attachment_id": 26034, "id": 139907, "time": "2010-09-16T13:34:53Z", "bug_id": 49936, "creation_time": "2010-09-16T13:34:53Z", "is_private": false, "text": "Created attachment 26034\nWordDoc for Junit Test 2"}, {"count": 4, "tags": [], "text": "Attached the two files it was failing on. For some reason I can not get JUnit testing not working, but I belive this should be the test cases:\n\nheaderSubStringErr = HWPFTestDataSamples.openSampleFile(\"Case1.doc\");\nheaderSubStringErr1 = HWPFTestDataSamples.openSampleFile(\"Case2.doc\");\n\npublic void testHeader() {\n  HeaderStories hs = new HeaderStories(headerSubStringErr);\n  assertEquals(\"\",hs.getHeaderText());\n}\n\npublic void testHeader1() {\n  HeaderStories hs = new HeaderStories(headerSubStringErr1);\n  assertEquals(\"\",hs.getHeaderText());\n}", "is_private": false, "bug_id": 49936, "id": 139908, "time": "2010-09-16T13:35:11Z", "creator": "ssmeets@ravn.co.uk", "creation_time": "2010-09-16T13:35:11Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "is_private": false, "id": 139932, "time": "2010-09-17T10:14:30Z", "bug_id": 49936, "creation_time": "2010-09-17T10:14:30Z", "text": "Thanks for the patch and test files. Fix, along with a unit test committed in r998146."}]
[{"count": 0, "tags": [], "creator": "div@yandex.ru", "text": "In old version (Tomcat 4.0.3) and new version (Tomcat 4.1.12) generated different \ncode for iterator.\n\nOriginal code is:\n\npublic class MessageListTag extends BodyTagSupport\n{\n\tprivate static Timer timer = new Timer(MessageListTag.class.getName\n());\n\n\tprotected Iterator iterator = null;\n\n\tprotected Message message = null;\n\n\tprotected String name = null;\n\n\tpublic int doStartTag()\n\t\tthrows JspException\n\t{\n\t\ttimer.start();\n\n        List messages = (List) pageContext.getAttribute(\"messages\");\n\n\t\tif (messages == null)\n\t\t{\n\t\t\treturn SKIP_BODY;\n\t\t}\n\n\t\tif (name == null)\n\t\t{\n\t\t\tname = \"message\";\n\t\t}\n\n\t\titerator = messages.iterator();\n\n\t\tif (iterator.hasNext())\n\t\t{\n            message = (Message) iterator.next();\n\n\t\t\tif (!\"message\".equals(name))\n\t\t\t{\n\t\t\t\tpageContext.setAttribute(\"message\", \nmessage);\n\t\t\t}\n\t\t\tpageContext.setAttribute(name, message);\n\n\t\t\treturn EVAL_BODY_INCLUDE;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn SKIP_BODY;\n\t\t}\n\t}\n\n\tpublic int doAfterBody()\n\t\tthrows JspException\n\t{\n        if (bodyContent != null)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tJspWriter out = getPreviousOut();\n\t\t\t\tout.write(bodyContent.getString());\n\t\t\t\tbodyContent.clearBody();\n\t\t\t}\n\t\t\tcatch (IOException ex)\n\t\t\t{\n\t\t\t\tthrow new JspException(ex);\n\t\t\t}\n\t\t}\n\n\t\tif (iterator.hasNext())\n\t\t{\n\t\t\tmessage = (Message) iterator.next();\n\n\t\t\tif (!\"message\".equals(name))\n\t\t\t{\n\t\t\t\tpageContext.setAttribute(\"message\", \nmessage);\n\t\t\t}\n\t\t\tpageContext.setAttribute(name, message);\n\n            return EVAL_BODY_AGAIN;\n\t\t}\n\t\telse\n\t\t{\n            return SKIP_BODY;\n\t\t}\n\t}\n\n\tpublic int doEndTag()\n\t\tthrows JspException\n\t{\n\t\ttimer.finish();\n\n\t\treturn EVAL_PAGE;\n    }\n\n\tpublic Message getMessage()\n\t{\n\t\treturn message;\n\t}\n\n\tpublic void setName(String name)\n\t{\n\t\tthis.name = name;\n\t}\n}\n\nin Tomcat 4.0.3:\n\n                    try {\n                        int _jspx_eval_forum_messages_0 = \n_jspx_th_forum_messages_0.doStartTag();\n                        if (_jspx_eval_forum_messages_0 != \njavax.servlet.jsp.tagext.Tag.SKIP_BODY) {\n                            try {\n                              if (_jspx_eval_forum_messages_0 != \njavax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE) {\n                              out = pageContext.pushBody();\n                              _jspx_th_forum_messages_0.setBodyContent\n((javax.servlet.jsp.tagext.BodyContent) out);\n                              _jspx_th_forum_messages_0.doInitBody();\n                          }\n                          do {\n                              ru.magroup.portal.forum.Message message = null;\n                              message = (ru.magroup.portal.forum.Message) \npageContext.findAttribute(\"message\");\n                          // end\n                          // HTML // begin [file=\"/forum/threads.jsp\";from=(275,34);to=\n(276,95)]\n                              out.write(\"\\r\\n\\t\\t\\t\\t<div style=\\\"margin-left: 0; margin-top: 0; \nmargin-right: 0; margin-bottom: 0; padding-left:\");\n\n                          // end\n                          // begin [file=\"/forum/threads.jsp\";from=(276,98);to=(276,127)]\n                              out.print( message.getLevel() * 15 + 7 );\n                          // end\n                          // HTML // begin [file=\"/forum/threads.jsp\";from=(276,129);to=\n(276,219)]\n                              out.write(\"; padding-top: 1; padding-right: 4; padding-bottom: \n0; background-color:transparent\\\" id=\\\"t\");\n\n                          // end\n                          // begin [file=\"/forum/threads.jsp\";from=(276,219);to=(276,233)]\n                              /* ----  message:id ---- */\n                              ru.magroup.portal.forum.taglibs.MessageIdTag \n_jspx_th_message_id_0 = new ru.magroup.portal.forum.taglibs.MessageIdTag();\n                              _jspx_th_message_id_0.setPageContext(pageContext);\n                              _jspx_th_message_id_0.setParent\n(_jspx_th_forum_messages_0);\n                              try {\n                              int _jspx_eval_message_id_0 = \n_jspx_th_message_id_0.doStartTag();\n                              if (_jspx_eval_message_id_0 != \njavax.servlet.jsp.tagext.Tag.SKIP_BODY) {\n                              try {\n                              if (_jspx_eval_message_id_0 != \njavax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE) {\n                              out = pageContext.pushBody();\n                              _jspx_th_message_id_0.setBodyContent\n((javax.servlet.jsp.tagext.BodyContent) out);\n                              _jspx_th_message_id_0.doInitBody();\n                          }\n                          do {\n                          // end\n                          // begin [file=\"/forum/threads.jsp\";from=(276,219);to=(276,233)]\n                          } while (_jspx_th_message_id_0.doAfterBody() == \njavax.servlet.jsp.tagext.BodyTag.EVAL_BODY_AGAIN);\n                      } finally {\n                          if (_jspx_eval_message_id_0 != \njavax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE)\n                              out = pageContext.popBody();\n                      }\n\nin Tomcat 4.1.12:\n\n            do {\n              out.write(\"\\r\\n\\t\\t\");\n              out.write(\"<tr bgcolor=\\\"#\");\n              out.print( (odd)?\"dfe4f7\":\"eff1fd\" );\n              out.write(\"\\\">\\r\\n\\t\\t\\t\");\n              out.write(\"<td>\\r\\n\\t\\t\\t\");\n              /* ----  forum:messages ---- */\n              ru.magroup.portal.forum.taglibs.MessageListTag \n_jspx_th_forum_messages_0 = (ru.magroup.portal.forum.taglibs.MessageListTag) \n_jspx_tagPool_forum_messages_name.get\n(ru.magroup.portal.forum.taglibs.MessageListTag.class);\n              _jspx_th_forum_messages_0.setPageContext(pageContext);\n              _jspx_th_forum_messages_0.setParent(_jspx_th_forum_threads_0);\n              _jspx_th_forum_messages_0.setName(\"message\");\n              int _jspx_eval_forum_messages_0 = \n_jspx_th_forum_messages_0.doStartTag();\n              if (_jspx_eval_forum_messages_0 != \njavax.servlet.jsp.tagext.Tag.SKIP_BODY) {\n                ru.magroup.portal.forum.Message message = null;\n                if (_jspx_eval_forum_messages_0 != \njavax.servlet.jsp.tagext.Tag.EVAL_BODY_INCLUDE) {\n                  javax.servlet.jsp.tagext.BodyContent _bc = pageContext.pushBody();\n                  _bc.clear();\n                  out = _bc;\n                  _jspx_th_forum_messages_0.setBodyContent(_bc);\n                  _jspx_th_forum_messages_0.doInitBody();\n                  message = (ru.magroup.portal.forum.Message) \npageContext.findAttribute(\"message\");\n                }\n                do {\n                  out.write(\"\\r\\n\\t\\t\\t\\t\");\n\n\t\t\t\t                  out.write(\"\\r\\n\\t\\t\\t\\t\");\n                  out.write(\"<div style=\\\"margin-left: 0; margin-top: 0; margin-right: 0; \nmargin-bottom: 0; padding-left:\");\n                  out.print( message.getLevel() * 15 + 7 );\n                  out.write(\"; padding-top: 1; padding-right: 4; padding-bottom: 0; \nbackground-color:transparent\\\" id=\\\"t\");\n                  if (_jspx_meth_message_id_0(_jspx_th_forum_messages_0, \npageContext))\n                    return;\n                  out.write(\"\\\" class=\\\"textsmall\\\">\");\n                  out.write(\"<a href=\\\"javascript:ViewMsg('\");\n                  if (_jspx_meth_message_id_1(_jspx_th_forum_messages_0, \npageContext))\n                    return;\n                  out.write(\"');\\\" class=\\\"\");\n                  out.print( (message.isClosed()) ? \"mainmenusub\" : \"mainmenu\" );\n                  out.write(\"\\\">\");\n                  if (_jspx_meth_message_title_0(_jspx_th_forum_messages_0, \npageContext))\n                    return;\n                  out.write(\"</a>&nbsp;/&nbsp;\");\n                  if (_jspx_meth_message_date_0(_jspx_th_forum_messages_0, \npageContext))\n                    return;\n.............\n\nAs you can see, in Tomcat 4.0.3 in first iteration message!=null, but in Tomcat \n4.1.12 in first iteration message=null.", "id": 25258, "time": "2002-10-28T09:06:13Z", "bug_id": 14008, "creation_time": "2002-10-28T09:06:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "div@yandex.ru", "attachment_id": null, "id": 25273, "time": "2002-10-28T15:36:39Z", "bug_id": 14008, "creation_time": "2002-10-28T15:36:39Z", "is_private": false, "text": "I think it is Jasper's bug."}, {"count": 2, "tags": [], "creator": "div@yandex.ru", "attachment_id": 4296, "id": 28748, "time": "2002-12-30T14:57:12Z", "bug_id": 14008, "creation_time": "2002-12-30T14:57:12Z", "is_private": false, "text": "Created attachment 4296\nTest Case for Iteration Tag with NESTED Variable Info"}, {"count": 3, "tags": [], "bug_id": 14008, "attachment_id": null, "text": "See tc attached (it is war-file).\nRunning under the tomcat 4.0 it produces correct output, but under tomcat 4.1.x \n1st element is null.", "id": 28749, "time": "2002-12-30T15:00:28Z", "creator": "div@yandex.ru", "creation_time": "2002-12-30T15:00:28Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 1040, "attachment_id": null, "is_private": false, "id": 1424, "time": "2001-03-20T04:45:15Z", "creator": "werner.droege@mailbox.tu-dresden.de", "creation_time": "2001-03-20T04:45:15Z", "text": "For moving a picture from the client to the server I use the Post-Method with \nenctype=multipart/form-data. This works correctly with ServletExec, but not \nwith Tomcat 3.2.1 for pictures or another data with a volume over 2k Byte.\n\nThe formular is like follows:\n\n<html>\n<body>\n<form method=\"POST\" action=\"http://werner:8080/test/servlet/test\" \nenctype=\"multipart/form-data\">\n<input type=\"file\" name=\"picture\"><br>\n<input type=\"submit\" name=\"store\">\n</form>\n</body>\n</html>\n\nand the servlet code is like follows:\n\nimport java.io.*;\nimport javax.servlet.*;\nimport javax.servlet.http.*;\n\npublic class test extends HttpServlet\n{\n\n    public void init(ServletConfig config)\n     \tthrows ServletException\n    {\n      \tsuper.init(config);\n    }\n\n\n    public void doPost(HttpServletRequest req, HttpServletResponse res)\n        throws ServletException,IOException\n    {\n\n        PrintWriter toClient = res.getWriter();\n\n        res.setContentType(\"text/html\");\n\n\n        int l=req.getContentLength();\n\n        InputStream input=req.getInputStream();\n        byte feld[]=new byte[l];\n\n        input.read(feld);\n\n        OutputStream output=new FileOutputStream(\"data\");\n\n        output.write(feld);\n        output.close();\n\n      \ttoClient.close();\n    }\n}\n\nIf the loaded file has more than 2k, then the req.getInputStream has the \ncorrect length, but only the first 2k are correctly, the content over the 2k \nboundary is zero."}, {"count": 1, "tags": [], "bug_id": 1040, "text": "I don't think InputStream.read(byte []) is guaranteed to read *all* the data \nfrom the input stream.  You might need to put the read inside a loop and keep \nreading until it returns -1 to indicate the end of file.  In any event this \nwon't be addressed for the 3.2.2 release.", "id": 1465, "time": "2001-03-20T13:10:27Z", "creator": "marc.saegesser@apropos.com", "creation_time": "2001-03-20T13:10:27Z", "is_private": false, "attachment_id": null}]
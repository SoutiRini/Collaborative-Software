[{"count": 0, "attachment_id": null, "creator": "arvind.srinivasan@sun.com", "text": "Under certain conditions, the resource cache implementation used by the\nservlet/JSP engine (in org.apache.naming.resource) does not detect that a file\nin its cache has been modified and therefore returns the previous contents of\nthe file.\n\nThis happens only \n * when the file contents are modified but the file length doesn't change\n * until the time the first change in the file is detected after server startup\n   \nTo reproduce the problem, put the attached test.jsp and test.txt into the ROOT\nweb app and then do the following. (I used Tomcat 6's trunk for the test)\n\n% cat test.txt\nabcd\n% telnet . 9080 \nTrying 0.0.0.0...\nConnected to ..\nEscape character is '^]'.\nGET /test.jsp HTTP/1.0\n\nHTTP/1.1 200 OK\nServer: Apache-Coyote/1.1\nSet-Cookie: JSESSIONID=706D6FE8B06687509D42E79DBEE266EF; Path=/\nContent-Type: text/html\nContent-Length: 26\nDate: Wed, 23 May 2007 23:03:05 GMT\nConnection: close\n\n\n\nFile contents=[\nabcd\n\n]\nConnection to . closed by foreign host.\n\n% cat test.txt (change the contents but not the size)\nefgh\n % telnet . 9080 \nTrying 0.0.0.0...\nConnected to ..\nEscape character is '^]'.\nGET /test.jsp HTTP/1.0\n\nHTTP/1.1 200 OK\nServer: Apache-Coyote/1.1\nSet-Cookie: JSESSIONID=2B144247B747F54184114FA82869DE14; Path=/\nContent-Type: text/html\nContent-Length: 26\nDate: Wed, 23 May 2007 23:04:24 GMT\nConnection: close\n\n\n\nFile contents=[\nabcd\n\n]", "id": 103579, "time": "2007-05-23T16:52:35Z", "bug_id": 42503, "creation_time": "2007-05-23T16:52:35Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": 20263, "creator": "arvind.srinivasan@sun.com", "text": "Created attachment 20263\nData file for the test case\n\nPut test.txt in the ROOT web app", "id": 103580, "time": "2007-05-23T16:53:36Z", "bug_id": 42503, "creation_time": "2007-05-23T16:53:36Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 42503, "is_private": false, "text": "Created attachment 20264\nTest case\n\nPut test.jsp in the ROOT web app.", "id": 103581, "time": "2007-05-23T16:54:14Z", "creator": "arvind.srinivasan@sun.com", "creation_time": "2007-05-23T16:54:14Z", "attachment_id": 20264}, {"attachment_id": 20265, "tags": [], "bug_id": 42503, "is_private": false, "count": 3, "id": 103582, "time": "2007-05-23T17:00:19Z", "creator": "arvind.srinivasan@sun.com", "creation_time": "2007-05-23T17:00:19Z", "text": "Created attachment 20265\nPatch that updates the last modified time of the file when it is inserted into the cache\n\nThe problem occurs because the last modified timestamp in the\nFileResourceAttribute of CacheEntry isn't updated at the time the CacheEntry is\nfirst inserted into the cache. The timestamp gets updated when\nProxyDirContext.revalidate() is executed. The window between when the\nCacheEntry was inserted and when ProxyDirContext.revalidate() is called is\nwhere the problem occurs.\n\nThe attached patch fixes this by updating the last modified (and creation)\ntimestamp at the time the resource is created (i.e. inserted into the cache)."}, {"count": 4, "tags": [], "text": "patch applied to trunk\npending vote for 6.0.x", "is_private": false, "id": 112217, "creator": "funkman@joedog.org", "time": "2007-12-26T17:59:28Z", "bug_id": 42503, "creation_time": "2007-12-26T17:59:28Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "markt@apache.org", "text": "The vote passed and the patch has been applied. It will be included in 6.0.16\nonwards.", "id": 112302, "time": "2007-12-30T14:06:06Z", "bug_id": 42503, "creation_time": "2007-12-30T14:06:06Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "If an HTTP sampler (either type) is set to follow redirects, and the server\nreturns a redirect to an invalid URL, then the original sample is included twice\nas a subsample. Thus the overall sample time is double what it should be.\n\nFor example, here is a very simple PHP file that delays 5 seconds and returns a\nbad redirect:\n\n<?php\n// This file published as http://localhost/bad-redirect.php\nsleep(5); // 5 second delay\nheader(\"Location: http://HOST:PORT/\"); // Invalid redirect\nexit;\n?>\n\nA trivial JMeter test plan that fetches this file once yeilds the following\nresult. The test took 5 seconds (timed manually) as expected. But note that the\n\"error\" sub-result appears twice in the results, and the total time shows up as\nten seconds.\n\nIt seems to me that HTTPSamplerBase.followRedirects() needs to be fixed.\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<testResults version=\"1.1\">\n\n<sampleResult timeStamp=\"1150235700594\" dataType=\"text\" threadName=\"Thread Group\n1-1\" label=\"HTTP Request\" time=\"10030\" responseMessage=\"Non HTTP response\nmessage\" responseCode=\"Non HTTP response code\" success=\"false\"><sampleResult\ntimeStamp=\"1150235700594\" dataType=\"text\" threadName=\"\" label=\"Error\"\ntime=\"5015\" responseMessage=\"Non HTTP response message\" responseCode=\"Non HTTP\nresponse code\" success=\"false\"><property xml:space=\"preserve\"\nname=\"samplerData\">GET http://localhost/bad-redirect.php\n</property><binary>java.net.MalformedURLException: For input string: \"PORT\"&#13;\n\tat java.net.URL.&lt;init&gt;(Unknown Source)&#13;\n\tat java.net.URL.&lt;init&gt;(Unknown Source)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.followRedirects(HTTPSamplerBase.java:700)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.resultProcessing(HTTPSamplerBase.java:761)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSampler.sample(HTTPSampler.java:493)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:514)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:503)&#13;\n\tat org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:247)&#13;\n\tat java.lang.Thread.run(Unknown Source)&#13;\n</binary></sampleResult><sampleResult timeStamp=\"1150235700594\" dataType=\"text\"\nthreadName=\"\" label=\"Error\" time=\"5015\" responseMessage=\"Non HTTP response\nmessage\" responseCode=\"Non HTTP response code\" success=\"false\"><property\nxml:space=\"preserve\" name=\"samplerData\">GET http://localhost/bad-redirect.php\n</property><binary>java.net.MalformedURLException: For input string: \"PORT\"&#13;\n\tat java.net.URL.&lt;init&gt;(Unknown Source)&#13;\n\tat java.net.URL.&lt;init&gt;(Unknown Source)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.followRedirects(HTTPSamplerBase.java:700)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.resultProcessing(HTTPSamplerBase.java:761)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSampler.sample(HTTPSampler.java:493)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:514)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:503)&#13;\n\tat org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:247)&#13;\n\tat java.lang.Thread.run(Unknown Source)&#13;\n</binary></sampleResult><property xml:space=\"preserve\" name=\"samplerData\">GET\nhttp://localhost/bad-redirect.php\n</property><binary>java.net.MalformedURLException: For input string: \"PORT\"&#13;\n\tat java.net.URL.&lt;init&gt;(Unknown Source)&#13;\n\tat java.net.URL.&lt;init&gt;(Unknown Source)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.followRedirects(HTTPSamplerBase.java:700)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.resultProcessing(HTTPSamplerBase.java:761)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSampler.sample(HTTPSampler.java:493)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:514)&#13;\n\tat\norg.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:503)&#13;\n\tat org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:247)&#13;\n\tat java.lang.Thread.run(Unknown Source)&#13;\n</binary></sampleResult>\n</testResults>", "is_private": false, "bug_id": 39808, "id": 90169, "time": "2006-06-13T22:41:43Z", "creator": "bennett@thunderguy.com", "creation_time": "2006-06-13T22:41:43Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "sebb@apache.org", "is_private": false, "id": 90207, "time": "2006-06-14T17:08:45Z", "bug_id": 39808, "creation_time": "2006-06-14T17:08:45Z", "tags": [], "text": "Can you try with JMeter 2.2 please?"}, {"count": 2, "tags": [], "bug_id": 39808, "is_private": false, "text": "Created attachment 18469\nTest case: Simple JMeter test plan\n\nThis test plan makes a single HTTP request and displays the results.", "id": 90226, "time": "2006-06-14T23:00:03Z", "creator": "bennett@thunderguy.com", "creation_time": "2006-06-14T23:00:03Z", "attachment_id": 18469}, {"count": 3, "tags": [], "text": "Created attachment 18470\nTest case: PHP file to generate an invalid redirect\n\nThis PHP file generates an invalid redirect. If a JMeter test plan requests\nthis, it will trigger this bug.", "is_private": false, "bug_id": 39808, "id": 90227, "time": "2006-06-14T23:03:03Z", "creator": "bennett@thunderguy.com", "creation_time": "2006-06-14T23:03:03Z", "attachment_id": 18470}, {"count": 4, "tags": [], "bug_id": 39808, "text": "Created attachment 18471\nTest case: output\n\nThis is the XML output generated by the test case. Note the doubled sample\nresult.", "id": 90228, "time": "2006-06-14T23:03:57Z", "creator": "bennett@thunderguy.com", "creation_time": "2006-06-14T23:03:57Z", "is_private": false, "attachment_id": 18471}, {"count": 5, "tags": [], "bug_id": 39808, "attachment_id": null, "is_private": false, "id": 90229, "time": "2006-06-14T23:14:54Z", "creator": "bennett@thunderguy.com", "creation_time": "2006-06-14T23:14:54Z", "text": "The problem still occurs in JMeter 2.2. I have updated the version number in\nthis bug.\n\nI suspect that the problem is in HTTPSamplerBase.followRedirects(), which has\nnot changed since last year."}, {"count": 6, "attachment_id": null, "bug_id": 39808, "is_private": false, "id": 90276, "time": "2006-06-15T21:33:58Z", "creator": "sebb@apache.org", "creation_time": "2006-06-15T21:33:58Z", "tags": [], "text": "What happens is that JMeter tries to follow the redirect, but ends up retrying\nthe initial URL, as it was unable to generate the correct URL to follow.\n\nI'm not quite sure what it should do in the circumstances - it would be better\nif it did not retry the original URL, but it cannot try the new URL.\n\nMaybe it should just generate an invalid sample result. But it won't be able to\nstore the location in the usual place, as it is not a valid URL.\n\nGiven that the server has generated an invalid Location header, I don't think\nthis is a serious problem, so I've downgraded the severity."}, {"count": 7, "tags": [], "bug_id": 39808, "is_private": false, "text": "Sorry, that was wrong - it does not try to follow the original URL, but it does\ngenerate an extra sample.\n\nThis should still be fixed if possible - but of course the server should really\nbe fixed so it generates a valid redirect.", "id": 90277, "time": "2006-06-15T21:44:42Z", "creator": "sebb@apache.org", "creation_time": "2006-06-15T21:44:42Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 39808, "text": "Created attachment 20013\nSuggested patch\n\nPatch to avoid duplicate samples being added, if the URL we are told to\nredirect to is malformed.", "id": 102035, "time": "2007-04-22T09:27:08Z", "creator": "alf@i100.no", "creation_time": "2007-04-22T09:27:08Z", "is_private": false, "attachment_id": 20013}, {"count": 9, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "is_private": false, "id": 102701, "time": "2007-04-30T15:52:08Z", "bug_id": 39808, "creation_time": "2007-04-30T15:52:08Z", "text": "Thanks - applied to SVN in r533872"}]
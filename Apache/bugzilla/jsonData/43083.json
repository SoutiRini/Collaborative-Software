[{"count": 0, "tags": [], "creator": "djohnson@desknetinc.com", "text": "Sshsession is a container task which establishes an SSH connection,\nand optionally any number of local or remote tunnels over that connection, \nthen executes any nested tasks before taking down the connection. \n\nMy purpose in writing it is that we use cvs, and secure all access by only \nallowing cvs connections from localhost, which are tunneled over SSH\nconnections.  Establishing those connections is the only manual step in an  \notherwise automated build process.    \n\nWhile I could use exec to issue the putty command (this is done on  \nwindoze) conditionally if a server is not already accessible at localhost  \nport 2401, it gets more complicated with a passphrase on the keypair being  \nused. \n  \nFurthermore, there was no way to ensure that an existing connection is the \nconnection we should be using, and no way to bring the connection down \nonce we are done with it. \n \nSo I wrote SSHSession, extending SSHBase.  The sshsession task establishes an\nSSH connection with a remote machine running SSH daemon, optionally establishes\nany number of local or remote tunnels over that connection, then executes any\nnested tasks before taking down the connection.\n\nSSHSession is adapted from SSHExec, though all the command execution \nrelated properties and logic were removed.  I added support for defining  \nthe tunnels via properties and/or nested elements.  I only needed local  \nport forwarding, but added remote port forwarding for completeness.    \n\nUsing SSHSession with a local tunnel (2401:localhost:2401) and nested CVS  \ncommands does exactly what we need.  Other uses could involve anything  \nneeding to make a TCP connection to a server not otherwise accessible  \nthrough a firewall, e.g. HTTP <get>, SMTP <mail>, JDBC <sql>...  \n\nBecause I've utilized the existing authentication and connection logic \nfrom SSHExec and SSHBase, the new task is as reliable in that regard as \nSSHExec. I've personally tested only the keypair with passphrase method of \nauthentication, but I tested both local and remote port forwarding. \nI have no server setup to accomodate testing the other authentication  \noptions.\n\nIn the attached svn diff, please find SSHSession.java,   \nsshsession.html, and mods to defaults.properties and optionaltasklist.html", "id": 106570, "time": "2007-08-09T22:54:01Z", "bug_id": 43083, "creation_time": "2007-08-09T22:54:01Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 20634\nSVN Diff providing sshsession task implementation and documentation", "attachment_id": 20634, "bug_id": 43083, "id": 106572, "time": "2007-08-09T22:55:43Z", "creator": "djohnson@desknetinc.com", "creation_time": "2007-08-09T22:55:43Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 43083, "attachment_id": null, "text": "Since JSch 0.1.32, jsch will assign the local TCP port dynamically if \"0\" is\ngiven as the local TCP port number for the local port-forwarding, \nand you can easily get the assigned TCP number by using jsch API.  \n\nSo, will it be nice that sshsession allows us to write following task setting,\n\n  <sshsession host=\"somehost\"\n    username=\"dude\"\n    password=\"yo\"\n    localtunnels=\":localhost:2401\"\n    localport=\"local.port\"\n    >\n    <sequential>\n      <cvs command=\"update ${cvs.parms} ${module}\"\n        cvsRoot=\"${cvs.root}\"\n        dest=\"${local.root}\"\n        port=\"${local.port}\"\n        failonerror=\"true\"\n      />\n    </sequential>\n  </sshsession>\n\n", "id": 106817, "time": "2007-08-16T01:00:51Z", "creator": "ymnk@jcraft.com", "creation_time": "2007-08-16T01:00:51Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43083, "is_private": false, "text": "I think some accommodation for jsch's dynamically assigning the local port in a\nlocal tunnel makes sense.  I would do it via the <localtunnel> embedded element,\nhowever, because the localtunnels parameter is actually a list, so an\naccompanying localport parameter would be inadequate.  I would suggest something\nmore like:\n  <sshsession host=\"somehost\"\n    username=\"dude\"\n    password=\"yo\"\n  >\n    <localtunnel lportproperty=\"local.port\" rhost=\"localhost\" rport=\"2401\"/>\n    <sequential>\n      <cvs  command=\"update ${cvs.parms} ${module}\"\n        cvsRoot=\"${cvs.root}\"\n        dest=\"${local.root}\"\n        port=\"${local.port}\"\n        failonerror=\"true\"\n    />\n    </sequential>\n  </sshsession>\n\nThat way, each <localtunnel> could have EITHER an lport or an lportproperty, and\nthe propertyname could be different for each localtunnel.  Does that work?", "id": 106833, "time": "2007-08-16T12:53:54Z", "creator": "djohnson@desknetinc.com", "creation_time": "2007-08-16T12:53:54Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 43083, "is_private": false, "id": 106848, "time": "2007-08-16T19:49:35Z", "creator": "ymnk@jcraft.com", "creation_time": "2007-08-16T19:49:35Z", "tags": [], "text": "(In reply to comment #3)\n> That way, each <localtunnel> could have EITHER an lport or an lportproperty, \n> and the propertyname could be different for each localtunnel.  Does that \nwork?\n\nI agree with you.  That must be better.\n\nBy the way, as I wrote in the previous comment, that functionality requires\nthe upgrade of the jsch version and it may not be acceptable in this timming.\nIf so, it should be postponed to be added and added to the TODO list.\n"}, {"count": 5, "tags": [], "text": "*** Bug 30582 has been marked as a duplicate of this bug. ***", "attachment_id": null, "bug_id": 43083, "id": 106913, "time": "2007-08-19T10:47:24Z", "creator": "peterreilly@apache.org", "creation_time": "2007-08-19T10:47:24Z", "is_private": false}, {"count": 6, "tags": [], "creator": "djohnson@desknetinc.com", "text": "Can someone who makes decisions such as when a newer version of jsch can be\nrequired weigh in on requiring JSch 0.1.32 or later?  Unless it is decided that\nit is fine to require JSch 0.1.32, I will assume that sshsession is to go in as\nprovided in the attached diff, with the discussed enhancement taking advantage\nof dynamic local port assignment for local tunnels recorded as a TODO for future\nenhancement.\n\nI don't want to delay the acceptance of sshsession by building in a requirement\nfor upgrade of JSch.", "id": 107034, "time": "2007-08-22T08:54:33Z", "bug_id": 43083, "creation_time": "2007-08-22T08:54:33Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "bodewig@apache.org", "text": "I'd say JSCH 0.1.32 is fine by now", "id": 118650, "time": "2008-07-14T08:08:12Z", "bug_id": 43083, "creation_time": "2008-07-14T08:08:12Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "is_private": false, "id": 118699, "time": "2008-07-16T02:55:38Z", "bug_id": 43083, "creation_time": "2008-07-16T02:55:38Z", "text": "comitted with some cosmetic changes as svn revision 677219.\n\nPlease re-open this report or create a new one if you have any enhancements that require more recent versions of JSch.  Given that this is a new task I don't see why we couldn't require the latest version of JSch for it to work."}, {"count": 9, "tags": [], "text": "*** Bug 45740 has been marked as a duplicate of this bug. ***", "attachment_id": null, "bug_id": 43083, "id": 120342, "time": "2008-09-04T05:50:16Z", "creator": "bodewig@apache.org", "creation_time": "2008-09-04T05:50:16Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 40926, "is_private": false, "id": 95579, "creation_time": "2006-11-08T08:49:09Z", "time": "2006-11-08T08:49:09Z", "creator": "christophe.gravier@univ-st-etienne.fr", "text": "Upgrading from 2.0.55 to 2.2.3, I read the doc about new authentification and\nauthorization layers.\n\nAs I have some web areas protected regarding memebership to a ldap group, I\nwanted to upgrad my configuration for those areas to be reachable again.\n\nI successfully configured a protection for a list of ldap users (\"require\nldap-user\" directive). I also be able to let any user of the directory in, using\nthe old \"require user\" and setting \"AuthzLDAPAuthoritative\" to off.\n\nAs I think I get the new architecture well, I went through the configuration of\nldap group based authentification, using \"require ldap-group\" directive.\n\nNevertheless, this is not working. I followed the doc. No message in error.log\nthough (of course, I got some messages if I enter a bad password for example,\nbut nothing if my login/pass are ok).\n\nIt seems that I am authenticated but not authorized (Obviously Apache can't\ncheck my group membership against the directory).\n\nI thought I was misunderstanding something so I asked on the user mailing list.\nAfter some days, nobody ever succeeded in using \"require ldap-group\" directive\n(at least nobody answered). So I chose to fill a bug report, as proposed on user\nsuport page of the web site.\n\nMy configuration is the following:\n<Location \"/DevDSI_trac\">\n       SetEnv TRAC_ENV \"/var/trac/DevDSI\"\n       AuthType Basic\n       AuthName \"DevDSI trac\"\n       AuthBasicProvider ldap\n       AuthLDAPURL\nldap://ist-guizay.univ-st-etienne.fr:389/ou=person,o=istase,c=fr?uid?sub?(objectClass=*)\n       require ldap-group cn=satin,ou=groups,o=istase,c=fr\n</Location> \n\nI am in object with dn \"cn=satin,ou=groups,o=istase,c=fr\", which is a\ngroupeOfUniqueNames declared as follow:\n\ndn: cn=satin,ou=groups,o=istase,c=fr\nobjectClass: groupOfUniqueNames\nuniqueMember: uid=gravier.christophe,ou=person,o=istase,c=fr\nuniqueMember: etc.... \n\nConsequently default AuthLDAP group config is fine for me, and I don't need to\nchange:\n- AuthLDAPGroupAttribute as is it uniqueMember in my case, part of {member,\nuniqueMember}\n- AuthLDAPGroupAttributeIsDN as it is by default to \"on\" (uniqueMemebr and\nmember attribute for group are supposed to be DN by default, and it is my case\non my directory.\n\nMy loaded modules are:\nls -l /etc/apache2/mods-enabled/ | awk '{print $8}'\nalias.load, auth_basic.load, authn_file.load, authnz_ldap.load, authz_host.load,\nauthz_owner.load, authz_user.load, autoindex.load, cgi.load, dav.load,\ndav_svn.load, dir.load, env.load, ldap.load, mime.load, negotiation.load,\nphp4.conf, php4.load, status.load\n\nI am running Apache 2.2.3 on a debian etch (testing) up to date.\n\nFeel free to contact me if you need additional informations.\n\nRegards.", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 40926, "is_private": false, "id": 95586, "attachment_id": null, "creator": "bnicholes@apache.org", "creation_time": "2006-11-08T13:04:40Z", "time": "2006-11-08T13:04:40Z", "text": "Unless you are providing ldap with a login user name and password, mod_ldap \nprobably does not have access to the uniqueMember attribute.  Try setting a \nuser and password using AuthLDAPBindDN and AuthLDAPBindPassword."}, {"count": 2, "tags": [], "bug_id": 40926, "is_private": false, "id": 95607, "creation_time": "2006-11-09T01:01:11Z", "time": "2006-11-09T01:01:11Z", "creator": "christophe.gravier@univ-st-etienne.fr", "text": "I think mod_authz_ldap have access to uniqueMember as I give anonymous right for\nsearch and compare for group membership(testing purpose).\n\nNevertheless, I tried to add those 2 directive to avoid an anonymous bind. The\nresulting configuration is the following:\n<Directory /home/siteweb>\n        AuthName \"Site web en construction\"\n        AuthBasicProvider ldap\n        AuthType basic\n        AuthLDAPURL\nldap://ist-guizay.univ-st-etienne.fr:389/ou=person,o=istase,c=fr?uid\n        AuthLDAPBindDN uid=.... (my manager DN)\n        AuthLDAPBindPassword my_plain_text_text_manager_password\n        require ldap-group cn=groupeProf,ou=groups,o=istase,c=fr\n</Directory>\n\nBut I have still the same problem. No error in error.log, seems like I'm\nauthenticated but not authorized.\n\nI also tried to add the directive AuthLDAPGroupAttribute and\nAuthLDAPGroupAttributeIsDN to their default values (as it matches my\nconfiguration), that means:\n        AuthLDAPGroupAttribute uniqueMember\n        AuthLDAPGroupAttributeIsDN on\n\nBut still the same problem.\n", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 40926, "is_private": false, "text": "I would suggest that you temporarily add the follow configuration so that you \ncan see what is going on with the comparison.  \n\n<Location /cache-info>\nsethandler ldap-status\nOrder deny,allow\nAllow from localhost\n</Location>\n\nIf you hit the /cache-info url, you can drill down into the comparison that \nmod_ldap is performing.  Also set your log level to debug.  These might give \nyou a clue why it isn't working.  I'm not seeing any problem with it in my \ntesting.", "id": 95628, "time": "2006-11-09T11:05:57Z", "creator": "bnicholes@apache.org", "creation_time": "2006-11-09T11:05:57Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "christophe.gravier@univ-st-etienne.fr", "text": "(In reply to comment #3)\n> I would suggest that you temporarily add the follow configuration so that you \n> can see what is going on with the comparison.  \n> \n> <Location /cache-info>\n> sethandler ldap-status\n> Order deny,allow\n> Allow from localhost\n> </Location>\n> \n> If you hit the /cache-info url, you can drill down into the comparison that \n> mod_ldap is performing.  Also set your log level to debug.  These might give \n> you a clue why it isn't working.  I'm not seeing any problem with it in my \n> testing.\n\nAs you did, I made tests on a testing machine and it's working as expected.\nThere a configuration problem, I'll track it down with your suggested tools\n(cache-info and debug).\nHence this is not a bug ;-)\nPlease apologize for the time wasted for a non bug problem :x\n", "id": 95642, "time": "2006-11-10T00:16:28Z", "bug_id": 40926, "creation_time": "2006-11-10T00:16:28Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "text": "Fedora Core 6 running java version\njava version \"1.5.0_04\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_04-b05)\nJava HotSpot(TM) Client VM (build 1.5.0_04-b05, mixed mode, sharing)\n\n\nI have a single thread group that is running 20 loops. Inside it has one If\nController with the If conition (Math.random() < .3).  If I simply put a sampler\nunder the If, things go as expected: the sampler is run roughly 30% of the time\nat random intervals. This is working perfectly.\n\nWhat I want is that if the If condition is met, the sampler will be run 5 times,\nthen we continue through the thread group, and if there are more loops of the\nthread group to run, loop through the thread group again.\n\nI've tried this using Loop Controller, and the results were erratic. I created a\nsimplified test case with just the controllers and two Java samplers that echo\n\"Yo\" and \"Hello\" respectively...\n\nTHREAD GROUP  L=20\n|\n|- IF CONTROLLER (Math.random() < .3.)\n        |\n        | -  \"Yo\"\n        |\n        |- LOOP CONTROLLER  = 5\n                   |\n                   |-- \"hello\"\n\n\nThis is what I get in terms of Yo's and Hello's  (Y and H):\nY Y H H Y Y Y H Y Y\n\nWhat I should get is five hello's after each Yo. \n\n\nI also tried using a simple controller to group everything under the IF, a la\n\nTHREAD GROUP    L=20\n|\n|- IF CONTROLLER (Math.random() < .3.)\n        |\n        |-- SIMPLE\n                 | -  \"Yo\"\n                 |\n                 |- LOOP CONTROLLER = 5\n                            |\n                            |-- \"hello\"\n\n\nAnd got this in the results tree:\nY H H H H H Y H   then  no more\n\nThe first group looks good (5 Hellos for each Yo).  But that second one only has\none Hello, which isn't what I want.", "bug_id": 41612, "attachment_id": null, "id": 99385, "time": "2007-02-14T08:35:43Z", "creator": "jdonnellan@highergear.com", "creation_time": "2007-02-14T08:35:43Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "alf@i100.no", "attachment_id": 20171, "id": 103081, "time": "2007-05-11T04:13:16Z", "bug_id": 41612, "creation_time": "2007-05-11T04:13:16Z", "is_private": false, "text": "Created attachment 20171\nSuggested patch\n\nThe reason for the observed behaviour, is that currently, the condition on the\n\"if controller\" is evaluated for each sample / loop iteration INSIDE the if\ncontroller.\n\nI think that is incorrect. I think the \"if controller\" should only evaluate\nits' condition when the \"if block\" is entered, and if the condition is\nevaluated to true, then all the samplers and controllers inside the \"if block\"\nshould be executed.\n\nThe suggested patch also contains a minor change to ThreadGroupGui, which sets\nthe name of the LoopController for the ThreadGroup, so that it is easier to\ndebug which controllers are executed. This change is not needed to fix this\nbug, so if you do not like it, then just drop that part."}, {"count": 2, "text": "Created attachment 20172\nTest plan which exposed the bug as described in the bug report", "bug_id": 41612, "attachment_id": 20172, "id": 103082, "time": "2007-05-11T04:14:27Z", "creator": "alf@i100.no", "creation_time": "2007-05-11T04:14:27Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "alf@i100.no", "attachment_id": null, "id": 103106, "time": "2007-05-11T09:10:10Z", "bug_id": 41612, "creation_time": "2007-05-11T09:10:10Z", "is_private": false, "text": "(In reply to comment #1)\n> Created an attachment (id=20171) [edit]\n> Suggested patch\n> \n> The reason for the observed behaviour, is that currently, the condition on the\n> \"if controller\" is evaluated for each sample / loop iteration INSIDE the if\n> controller.\n> \n> I think that is incorrect. I think the \"if controller\" should only evaluate\n> its' condition when the \"if block\" is entered, and if the condition is\n> evaluated to true, then all the samplers and controllers inside the \"if block\"\n> should be executed.\n> \n> The suggested patch also contains a minor change to ThreadGroupGui, which sets\n> the name of the LoopController for the ThreadGroup, so that it is easier to\n> debug which controllers are executed. This change is not needed to fix this\n> bug, so if you do not like it, then just drop that part.\n\nAfter thinking about it a bit more, I think I need to test having an IF\ncontroller inside a Loop. I'm not sure that the current suggested patch, with\nthe \"isFirst()\" test is correct."}, {"count": 4, "tags": [], "text": "(In reply to comment #3)\n> \n> After thinking about it a bit more, I think I need to test having an IF\n> controller inside a Loop. I'm not sure that the current suggested patch, with\n> the \"isFirst()\" test is correct.\n\nI have tested more, and the suggested patch seems to be correct.", "is_private": false, "bug_id": 41612, "id": 103152, "time": "2007-05-13T23:45:10Z", "creator": "alf@i100.no", "creation_time": "2007-05-13T23:45:10Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Patch applied (apart from GUI change) - fixed in SVN r551743.", "attachment_id": null, "bug_id": 41612, "id": 104884, "time": "2007-06-28T17:35:22Z", "creator": "sebb@apache.org", "creation_time": "2007-06-28T17:35:22Z", "is_private": false}]
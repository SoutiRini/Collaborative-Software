[{"count": 0, "tags": [], "creator": "co@korem.com", "attachment_id": null, "text": "I'm experiencing multiple problems with the JDBCRealm. I have set up an\napplication that let me setup account online, but with tomcat 3.3, the user\naccount I create cannot be used to authenticate immediately. I need to restart\nthe  server before. I also experienced changes lost. I have found that somewhere\nin JDBCRealm there is a resultset not closed, but I dont know for sure if its\nthe cause of my problems.\n\n/**\n * returns all the roles for a given user.\n *\n * @param username the user name\n * @return the roles array\n */\n    public synchronized String[] getUserRoles(String username) {\n        try {\n            if (!checkConnection())\n                return null;\n            if (preparedRoles == null) {\n                preparedRoles=getPreparedRoles(dbConnection);\n            }\n            preparedRoles.clearParameters();\n            preparedRoles.setString(1, username);\n            ResultSet rs = preparedRoles.executeQuery();\n            // Next we convert the resultset into a String[]\n            Vector vrol = new Vector();\n            while (rs.next()) {\n                vrol.addElement(rs.getString(1).trim());\n            }\n>>>>>>>>>            rs.close();  <<<<<<<<< misssing  ResultSet.close\n            String[] res = new String[vrol.size() > 0 ? vrol.size() : 1];\n            // no roles case\n            if (vrol.size() == 0) {\n                res[0] = \"\";\n                return res;\n            }\n            for (int i = 0; i < vrol.size(); i++)\n                res[i] = (String)vrol.elementAt(i);\n            return res;\n        }\n        catch (SQLException ex) {\n            // Set the connection to null.\n            // Next time we will try to get a new connection.\n            log(sm.getString(\"jdbcRealm.getUserRolesSQLException\", username));\n            close();\n        }\n        return null;\n    }", "id": 8570, "time": "2001-12-04T06:56:19Z", "bug_id": 5265, "creation_time": "2001-12-04T06:56:19Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 5265, "is_private": false, "id": 8585, "attachment_id": null, "creator": "nacho@apache.org", "creation_time": "2001-12-04T17:33:15Z", "time": "2001-12-04T17:33:15Z", "text": "First, Thanks for the catch..,i will patch it soon.. \n\nFor your main problem, are you sure you are commiting the changes to DB?, I'm \nusing the same kind of app with success and without problems..\n\n"}, {"count": 2, "tags": [], "creator": "co@korem.com", "text": "For your information, I use InstantDB database. I've check in the log and I see\nthis :\n\n2001-12-05 08:38:28 - JDBCRealm: Authentification r\u00daussie pour l'utilisateur\nchristian\n2001-12-05 08:38:28 - JDBCRealm: Auth ok, user=christian\n\nbut my code that was working in 3.2.3 do not work in 3.3. Even if authentication\nis successfull, none users are authorized after authentication. \n\n", "id": 8596, "time": "2001-12-05T05:56:08Z", "bug_id": 5265, "creation_time": "2001-12-05T05:56:08Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "nacho@apache.org", "attachment_id": null, "text": "Not reproducible here, when i add ( and commit ) a user i can immediately use \nit for login in tomcat, tested against Oracle..and for the catch, is not that \ngood ;).. from <http://java.sun.com/j2se/1.3/docs/api/java/sql/ResultSet.html>:\n\n\"A ResultSet object is automatically closed when the Statement object that \ngenerated it is closed, re-executed, or used to retrieve the next result from a \nsequence of multiple results.\"\n\n", "id": 9143, "time": "2001-12-22T09:20:59Z", "bug_id": 5265, "creation_time": "2001-12-22T09:20:59Z", "is_private": false}]
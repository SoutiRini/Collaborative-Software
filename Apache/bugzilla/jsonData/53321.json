[{"count": 0, "tags": [], "creator": "abiacco@formatdynamics.com", "is_private": false, "text": "Bug being added per request from mturk\n\nCentos 5.8, x86_64, apache 2.2.22, java 1.6.0_32, tomcat 7.0.27, apr\n1.4.6 (also happens on another machine with apache 2.2.21 and java\n1.6.0_29, rest of the versions are the same)\n\nConnecting apache to tomcat ajp, same machine.\nOnce I upgraded to 1.2.36 I started receiving 503 errors when trying to\naccess my webapps through the loadbalancer worker.\n1.2.32 and 1.2.35 work fine.\nWill work if the worker (app-03) is removed from worker.list (config below)\n\nJk log shows:\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\najp_get_endpoint::jk_ajp_common.c (3154): acquired connection pool\nslot=0 after 0 retries\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\najp_marshal_into_msgb::jk_ajp_common.c (626): ajp marshaling done\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\najp_service::jk_ajp_common.c (2449): processing app-03 with 2 retries\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\najp_send_request::jk_ajp_common.c (1623): (app-03) all endpoints are\ndisconnected.\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\njk_open_socket::jk_connect.c (485): socket TCP_NODELAY set to On\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\njk_open_socket::jk_connect.c (574): timeout 20 set for socket=22\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\njk_open_socket::jk_connect.c (609): trying to connect socket 22 to\n0.0.0.0:0\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\njk_open_socket::jk_connect.c (635): socket 22 [errno=107] connected\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\najp_connection_tcp_send_message::jk_ajp_common.c (1183): sending to\najp13 pos=4 len=5 max=16\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\najp_connection_tcp_send_message::jk_ajp_common.c (1183): 0000    12 34\n00 01 0A 00 00 00 00 00 00 00 00 00 00 00  - .4..............\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\njk_shutdown_socket::jk_connect.c (732): About to shutdown socket 22\n[errno=107]\n[Wed May 23 15:56:32 2012] [32504:1138178368] [debug]\njk_shutdown_socket::jk_connect.c (741): Failed sending SHUT_WR for\nsocket 22 [errno=107]\n[Wed May 23 15:56:32 2012] [32504:1138178368] [info]\najp_connection_tcp_send_message::jk_ajp_common.c (1215): sendfull for\nsocket 22 returned -32 (errno=32)\n[Wed May 23 15:56:32 2012] [32504:1138178368] [info]\najp_handle_cping_cpong::jk_ajp_common.c (902): can't send cping query\n[Wed May 23 15:56:32 2012] [32504:1138178368] [error]\najp_connect_to_endpoint::jk_ajp_common.c (1026): (app-03) cping/cpong\nafter connecting to the backend server failed (errno=32)\n[Wed May 23 15:56:32 2012] [32504:1138178368] [error]\najp_send_request::jk_ajp_common.c (1629): (app-03) connecting to backend\nfailed. Tomcat is probably not started or is listening on the wrong port\n(errno=32)\n[Wed May 23 15:56:32 2012] [32504:1138178368] [info]\najp_service::jk_ajp_common.c (2622): (app-03) sending request to tomcat\nfailed (recoverable), because of error during request sending\n(attempt=1)\n\nhttpd.conf settings are:\n\nJkWorkersFile /path/to/workers.properties\nJkWatchdogInterval 60\nJkLogFile     /path/to/GLOBAL-mod_jk.log\nJkLogLevel    debug\nJkLogStampFormat \"[%a %b %d %H:%M:%S %Y] \"\nJkOptions +ForwardKeySize +ForwardURIProxy -ForwardDirectories\nJkRequestLogFormat \"%w %R %V %B %T %m %U %s\"\nJkShmFile logs/jk-runtime-status\nJkMount /webapp/* loadbalancer\n\nworkers.properties settings are:\n\nworker.list=jkstatus,app-03,loadbalancer\nworker.template.port=8009\nworker.template.type=ajp13\nworker.template.lbfactor=1\nworker.template.connection_pool_timeout=30\nworker.template.connect_timeout=30000\nworker.template.recovery_options=4\nworker.template.reply_timeout=31000\nworker.template.socket_timeout=20\nworker.template.socket_connect_timeout=5000\nworker.template.ping_mode=A\nworker.template.ping_timeout=20000\nworker.app-03.host=127.0.0.1\nworker.app-03.reference=worker.template\nworker.jkstatus.type=status\nworker.loadbalancer.sticky_session=1\nworker.loadbalancer.type=lb\nworker.loadbalancer.balance_workers=app-03\n\nserver.xml settings are:\n\n        <Connector port=\"8009\" protocol=\"AJP/1.3\"\n                        maxThreads=\"1000\" backlog=\"25\"\nmaxPostSize=\"4194304\"\n                        enableLookups=\"false\" connectionTimeout=\"30000\"\nkeepAliveTimeout=\"10000\"\n                        redirectPort=\"8443\" />\n\n# netstat -anop | grep 8009\ntcp        0      0 0.0.0.0:8009                0.0.0.0:*\nLISTEN      30151/jsvc.exec     off (0.00/0/0)", "id": 159465, "time": "2012-05-29T17:11:31Z", "bug_id": 53321, "creation_time": "2012-05-29T17:11:31Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "chris@christopherschultz.net", "is_private": false, "text": "Reference to original thread on tomcat-user mailing list, for reference:\nhttp://markmail.org/thread/tlwvkdsun3rfynw3", "id": 159475, "time": "2012-05-29T20:46:17Z", "bug_id": 53321, "creation_time": "2012-05-29T20:46:17Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 53321, "attachment_id": null, "text": "Fixed in 1.2.37.", "id": 159563, "time": "2012-05-31T14:29:57Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-05-31T14:29:57Z", "is_private": false}]
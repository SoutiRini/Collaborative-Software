[{"count": 0, "tags": [], "bug_id": 14077, "text": "Running Tomcat 4.1.12 on multiprocessor servers we often see classloader errors\nwhen we hit a JSP page that is being compiled for the first time. We have seen\nthis both on Windows 2000 with Sun JDK 1.3.1_01 or 1.3.1_05 and AIX with IBM JDK\n1.3.1.2, but we have never seen this on a single-processor system.\n\nThe symptom looks like the stack traces below--the class name gets mangled in\nthe class compiled from the JSP page.\n\nDeleting the page from the work directory and hitting it again usually works, as\ndoes precompiling the page using jspc.\n\nThis may be related to bug 11379.\n\njava.lang.ClassFormatError: org/apache/jsp/apphead_jsp (Illegal Class name\n\"Collections$4.\")\n at java.lang.ClassLoader.defineClass0(Native Method)\n at java.lang.ClassLoader.defineClass(ClassLoader.java(Compiled Code))\n at org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java(Compiled\nCode))\n at org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java(Compiled\nCode))\n at org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java(Compiled\nCode))\n at\norg.apache.jasper.JspCompilationContext.load(JspCompilationContext.java(Compiled\nCode))\n at\norg.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrapper.java(Compiled\nCode))\n at org.apache.jasper.compiler.Compiler.isOutDated(Compiler.java(Compiled Code))\n at org.apache.jasper.compiler.Compiler.isOutDated(Compiler.java:333)\n at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:472)\n at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:184)\n at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)\n at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\njava.lang.ClassFormatError: org/apache/jsp/apphead_jsp (Illegal UTF8 string in\nconstant pool)\n\tat java.lang.ClassLoader.defineClass0(Native Method)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:486)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:426)\n\tat org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:215)\n\tat org.apache.jasper.servlet.JasperLoader.loadClass(JasperLoader.java:131)\n\tat org.apache.jasper.JspCompilationContext.load(JspCompilationContext.java:504)\n\tat\norg.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrapper.java:145)\n\tat org.apache.jasper.compiler.Compiler.isOutDated(Compiler.java:383)\n\tat org.apache.jasper.compiler.Compiler.isOutDated(Compiler.java:333)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:472)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:184)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:289)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:240)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)", "id": 25355, "time": "2002-10-30T01:02:33Z", "creator": "erich@ucsd.edu", "creation_time": "2002-10-30T01:02:33Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "*** Bug 11379 has been marked as a duplicate of this bug. ***", "is_private": false, "bug_id": 14077, "id": 25367, "time": "2002-10-30T08:17:33Z", "creator": "remm@apache.org", "creation_time": "2002-10-30T08:17:33Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Making this thread safe will require further refactoring of the compiler and\nloader code (unlikely to happen anytime soon).\nIt is always better to rely on precompilation for production deployment (most\nversions of javac leak memory, and other problems).", "is_private": false, "id": 25368, "creator": "remm@apache.org", "time": "2002-10-30T08:20:07Z", "bug_id": 14077, "creation_time": "2002-10-30T08:20:07Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 14077, "is_private": false, "count": 3, "id": 33722, "time": "2003-03-24T22:55:32Z", "creator": "erich@ucsd.edu", "creation_time": "2003-03-24T22:55:32Z", "text": "Worksforme in 4.1.24 with all the Jasper fixes/changes that have gone in since\n4.1.12."}, {"count": 4, "tags": [], "text": "*** Bug 10563 has been marked as a duplicate of this bug. ***", "is_private": false, "id": 50293, "creator": "medthomas@ntlworld.com", "time": "2004-01-08T23:48:03Z", "bug_id": 14077, "creation_time": "2004-01-08T23:48:03Z", "attachment_id": null}]
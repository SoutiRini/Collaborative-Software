[{"count": 0, "tags": [], "text": "Created attachment 30877\nCrash report attached\n\nApache Tomcat/7.0.29\nAPR based Apache Tomcat Native library 1.1.24 using APR version 1.3.9.\n\nTomcat with the APR connector, using HTTPS scheme. The system is under load test with heavy traffic flowing between client and server. It also occurred once when the system was NOT under load. No known test case to reproduce the issue. It happens randomly. \nMore information in case it helps: There are around 100 clients connecting to the server from the same machine. There are 3 such machines on which clients run.\n\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=51813 looks similar but probably not same issue.\n\n#\n# A fatal error has been detected by the Java Runtime Environment:\n#\n#  SIGSEGV (0xb) at pc=0x00007f0df4825e39, pid=1208, tid=139688203269888\n#\n# JRE version: 7.0_03\n# Java VM: OpenJDK 64-Bit Server VM (22.0-b10 mixed mode linux-amd64 compressed oops)\n# Problematic frame:\n# C  [libtcnative-1.so+0x12e39]  Java_org_apache_tomcat_jni_Socket_sendbb+0x59\n#\n# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try \"ulimit -c unlimited\" before starting Java again\n#\n# If you would like to submit a bug report, please include\n# instructions on how to reproduce the bug and visit:\n#   http://icedtea.classpath.org/bugzilla\n# The crash happened outside the Java Virtual Machine in native code.\n# See problematic frame for where to report the bug.\n#\n\n---------------  T H R E A D  ---------------\n\nCurrent thread (0x00007f0c6c151800):  JavaThread \"http-apr-9443-exec-277\" daemon [_thread_in_native, id=6009, stack(0x00007f0bb1b43000,0x00007f0bb1bc4000)]\n\nsiginfo:si_signo=SIGSEGV: si_errno=0, si_code=1 (SEGV_MAPERR), si_addr=0x0000000000000040\n.\n.\n.\nStack: [0x00007f0bb1b43000,0x00007f0bb1bc4000],  sp=0x00007f0bb1bc20d0,  free space=508k\nNative frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)\nC  [libtcnative-1.so+0x12e39]  Java_org_apache_tomcat_jni_Socket_sendbb+0x59\n\n[error occurred during error reporting (printing native stack), id 0xb]\n\nJava frames: (J=compiled Java code, j=interpreted, Vv=VM code)\nJ  org.apache.tomcat.jni.Socket.sendbb(JII)I\nJ  org.apache.coyote.http11.InternalAprOutputBuffer.flushBuffer()V\nJ  org.apache.coyote.http11.AbstractHttp11Processor.action(Lorg/apache/coyote/ActionCode;Ljava/lang/Object;)V\nJ  net.zschech.gwt.comet.server.deflate.DeflaterOutputStream.flush()V\nJ  sun.nio.cs.StreamEncoder.flush()V\nJ  net.zschech.gwt.comet.server.impl.CometServletResponseImpl.tryTerminate()V\nJ  net.zschech.gwt.comet.server.impl.CometServletResponseImpl.initiate()V\nJ  javax.servlet.http.HttpServlet.service(Ljavax/servlet/http/HttpServletRequest;Ljavax/servlet/http/HttpServletResponse;)V\nJ  javax.servlet.http.HttpServlet.service(Ljavax/servlet/ServletRequest;Ljavax/servlet/ServletResponse;)V\nJ  org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(Ljavax/servlet/ServletRequest;Ljavax/servlet/ServletResponse;)V\nJ  org.apache.catalina.core.StandardWrapperValve.invoke(Lorg/apache/catalina/connector/Request;Lorg/apache/catalina/connector/Response;)V\nJ  org.apache.catalina.core.StandardContextValve.invoke(Lorg/apache/catalina/connector/Request;Lorg/apache/catalina/connector/Response;)V\nJ  org.apache.catalina.authenticator.AuthenticatorBase.invoke(Lorg/apache/catalina/connector/Request;Lorg/apache/catalina/connector/Response;)V\nJ  org.apache.catalina.core.StandardHostValve.invoke(Lorg/apache/catalina/connector/Request;Lorg/apache/catalina/connector/Response;)V\nJ  org.apache.catalina.core.StandardEngineValve.invoke(Lorg/apache/catalina/connector/Request;Lorg/apache/catalina/connector/Response;)V\nJ  org.apache.catalina.connector.CoyoteAdapter.service(Lorg/apache/coyote/Request;Lorg/apache/coyote/Response;)V\nJ  org.apache.coyote.http11.AbstractHttp11Processor.process(Lorg/apache/tomcat/util/net/SocketWrapper;)Lorg/apache/tomcat/util/net/AbstractEndpoint$Handler$SocketState;\nJ  org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(Lorg/apache/tomcat/util/net/SocketWrapper;Lorg/apache/tomcat/util/net/SocketStatus;)Lorg/apache/tomcat/util/net/AbstractEndpoint$Handler$SocketState;\nJ  org.apache.tomcat.util.net.AprEndpoint$SocketWithOptionsProcessor.run()V\nJ  java.util.concurrent.ThreadPoolExecutor.runWorker(Ljava/util/concurrent/ThreadPoolExecutor$Worker;)V\nj  java.util.concurrent.ThreadPoolExecutor$Worker.run()V+5\nj  java.lang.Thread.run()V+11\nv  ~StubRoutines::call_stub", "attachment_id": 30877, "id": 170242, "creation_time": "2013-09-24T06:06:46Z", "time": "2013-09-24T06:06:46Z", "creator": "nitinvbhavsar@yahoo.com", "bug_id": 55588, "is_private": false}, {"count": 1, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "id": 170306, "time": "2013-09-27T14:48:32Z", "bug_id": 55588, "creation_time": "2013-09-27T14:48:32Z", "is_private": false, "text": "Both Tomcat and tcnative are out of date. Can you re-try your testing with current versions (current are Tomcat 7.0.42, tcnative 1.1.27). Also, APR 1.3.9 is fairly old. What type of Linux system is this?\n\nAlso, please run 'ulimit -c unlimited' in the shell before launching Tomcat so you can get a core file -- hopefully with a more complete backtrace."}, {"count": 2, "tags": [], "text": "Also, why do you believe this is not the issue covered by bug #51813 ?", "attachment_id": null, "id": 170307, "creation_time": "2013-09-27T14:50:54Z", "time": "2013-09-27T14:50:54Z", "creator": "chris@christopherschultz.net", "bug_id": 55588, "is_private": false}, {"count": 3, "tags": [], "bug_id": 55588, "is_private": false, "text": "The ulimit is currently set to 10000 for this tomcat process. The file handler count has hardly gone beyond 3000. I will test with 'ulimit -c unlimited' to capture core dump in case this occurs again.\n\nThe difference between this issue and bug #51813 is the data between server and client is purely text based wheres the bug you mentioned talks about some issue related to image IO. In my case, there is no image IO.\n\nRegarding using latest version and reproducing:\nThere is no known test case to reproduce the issue. It happened only twice in around 100 load test runs. Sorry but I won't be able to test using the versions mentioned by you.", "id": 170719, "time": "2013-10-21T12:00:13Z", "creator": "nitinvbhavsar@yahoo.com", "creation_time": "2013-10-21T12:00:13Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "nitinvbhavsar@yahoo.com", "attachment_id": null, "id": 171054, "time": "2013-11-05T13:04:37Z", "bug_id": 55588, "creation_time": "2013-11-05T13:04:37Z", "is_private": false, "text": "What could be side effects of running tomcat with 'ulimit -c unlimited' during the test?"}, {"count": 5, "tags": [], "text": "Created attachment 31011\nAnother crash with same error\n\nThere was another crash and I have attached the crash report file hs_err_pid12092.log. There is no change to any of the versions/component/system/environment etc.", "attachment_id": 31011, "id": 171055, "creation_time": "2013-11-05T14:12:41Z", "time": "2013-11-05T14:12:41Z", "creator": "nitinvbhavsar@yahoo.com", "bug_id": 55588, "is_private": false}, {"count": 6, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "id": 171057, "time": "2013-11-05T14:41:06Z", "bug_id": 55588, "creation_time": "2013-11-05T14:41:06Z", "is_private": false, "text": "(In reply to Nitinb from comment #4)\n> What could be side effects of running tomcat with 'ulimit -c unlimited'\n> during the test?\n\nYou might get a very large core file (roughly the size of your JVM process)."}, {"count": 7, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "id": 171063, "time": "2013-11-05T16:55:58Z", "bug_id": 55588, "creation_time": "2013-11-05T16:55:58Z", "is_private": false, "text": "(In reply to Nitinb from comment #5)\n> Created attachment 31011 [details]\n> Another crash with same error\n> \n> There was another crash and I have attached the crash report file\n> hs_err_pid12092.log. There is no change to any of the\n> versions/component/system/environment etc.\n\nExactly what version of tcnative were you running at the time?\n\nI've already mentioned that both your Tomcat and tcnative are out of date, and I believe this issue to have been resolved as bug #51813.\n\nThe reason why that other bug is related to this one is because the output stream is stale and the sendbb function doesn't check for that case. There have been many patches to both Tomcat and tcnative that should handle the issue you describe here. Please upgrade to new versions of both components and re-test."}, {"attachment_id": null, "tags": [], "creator": "chris@christopherschultz.net", "is_private": false, "count": 8, "id": 171849, "time": "2013-12-20T03:28:23Z", "bug_id": 55588, "creation_time": "2013-12-20T03:28:23Z", "text": "Without further information, this bug will be marked as WORKSFORME soon."}, {"count": 9, "tags": [], "text": "After upgrading tomcat to 7.47 and APR to apr-1.4.6 and so far didn't encounter the issue.\nKindly mark it as resolved. I will reopen in case the same issue is encountered.\n\nThanks.", "attachment_id": null, "id": 172018, "creation_time": "2014-01-02T11:50:28Z", "time": "2014-01-02T11:50:28Z", "creator": "nitinvbhavsar@yahoo.com", "bug_id": 55588, "is_private": false}]
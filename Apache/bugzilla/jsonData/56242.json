[{"count": 0, "tags": [], "creator": "chris@christopherschultz.net", "text": "This may not be a Tomcat bug, but I think it best to report it here as it's more likely the Tomcat team will be able to find the root cause.\n\nThe attached web application WAR does nothing other than define a <servlet> that comes out of the box with Velocity and Velocity Tools. The mere presence of this servlet appears to cause the JVM to reject certain Attach API connections -- such as those from jconsole, VisualVM, and other profiling tools.\n\nVisualVM will connect after an error (\"attach: task_for_pid(23490) failed (5)\" in the console, longer stack trace available which basically says \"couldn't connect\") but the JMX tab will be unavailable.\n\nAny help with discovering the root cause of this issue would be greatly appreciated.", "id": 173732, "attachment_id": null, "bug_id": 56242, "creation_time": "2014-03-10T18:03:32Z", "time": "2014-03-10T18:03:32Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 56242, "attachment_id": 31379, "id": 173733, "time": "2014-03-10T18:09:51Z", "creator": "chris@christopherschultz.net", "creation_time": "2014-03-10T18:09:51Z", "is_private": false, "text": "Created attachment 31379\nMinimal web application WAR that reproduces the problem.\n\nI had to remove the following files to reduce the size enough to attach to the BZ issue. They should be trivially-retrievable from ASF's web site(s):\n\ndeleting: WEB-INF/lib/commons-beanutils-1.8.3.jar\ndeleting: WEB-INF/lib/commons-collections-3.2.1.jar\ndeleting: WEB-INF/lib/commons-digester-1.8.jar\ndeleting: WEB-INF/lib/commons-lang-2.4.jar\ndeleting: WEB-INF/lib/commons-logging-1.1.1.jar"}, {"count": 2, "tags": [], "bug_id": 56242, "attachment_id": null, "id": 173734, "time": "2014-03-10T21:11:59Z", "creator": "chris@christopherschultz.net", "creation_time": "2014-03-10T21:11:59Z", "is_private": false, "text": "Might me Mac/JVM specific. Konstantin was unable to reproduce on Windows."}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "If you start Tomcat with -Xverify:none (not something I'd recommend doing) the problem goes away. This looks like a VisualVM bug that is triggered by one of the velocity classes.\n\nAs an alternative, attach VisualVM and then deploy the Velocity app.\n\nFor those wondering how I stumbled across the solution:\n1. Google \"attach: task_for_pid(23490) failed (5)\"\n2. Read through the VisualVm bug reports that finds\n3. Specifically read this one: https://java.net/jira/browse/VISUALVM-326\n4. Experiment with the settings suggested in that report to see which are actually required\n\nI'd recommend opening a VisalVM bug for this.\n\nI concur that this is a Mac specific error.", "id": 173740, "attachment_id": null, "bug_id": 56242, "creation_time": "2014-03-11T09:39:34Z", "time": "2014-03-11T09:39:34Z", "is_private": false}, {"count": 4, "tags": [], "creator": "chris@christopherschultz.net", "text": "I'll give -x:verify:none a try (on the client?) but this also happens with both jconsole and YourKit. Might this be an underlying JVM bug? I didn't try with other versions (e.g. OpenJDK, IBM, or Sun/Oracle Java 6) yet.", "id": 173751, "attachment_id": null, "bug_id": 56242, "creation_time": "2014-03-11T19:55:12Z", "time": "2014-03-11T19:55:12Z", "is_private": false}]
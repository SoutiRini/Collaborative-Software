[{"count": 0, "tags": [], "bug_id": 61000, "attachment_id": 34920, "id": 198329, "time": "2017-04-18T03:30:58Z", "creator": "pkent@janison.com.au", "creation_time": "2017-04-18T03:30:58Z", "is_private": false, "text": "Created attachment 34920\nScript to reproduce the issue\n\nIt appears that every SSL request is creating a new SSL handshake instead of reusing the existing one when HttpClient4 implementation is used when a timer is added. The behaviour is the same with JMeter 3.0, 3.1 and 3.2.\n\nTo test this I've created a JMeter script as follows:\n- 1 Thread Group with the number of threads set to 2 and loop only once.\n- Within the thread group two HTTP Request samplers were added and each has a Constant Timer set to 3000 milliseconds. The HTTP Requests are GET requests to an HTTPS URL of our application.\n- HTTP Request Defaults is set to use the HttpClient4 implementation.\n\nExpected:\nEach iteration in the thread group should create 2 requests and there are 2 users. So in total there would be 4 requests. However since the URL it is hitting is the same, each user should be reusing the HTTPS connection of the previous HTTP Request so only 1 SSL handshake should be created per user.\n\nActual:\nI've used Microsoft Network Monitor 3.4 to see how many SSL Handshakes are being created and I have found that 4 SSL handshakes are made instead of 2.\nInterestingly if I remove the Constant Timer the behaviour is that you have 2 SSL handshakes in total (1 per user) which is what I expect.\n\nI'm using the default configuration with JMeter.\nIs there any reason why the HTTPS connections are not reused?"}, {"count": 1, "tags": [], "text": "I have just tested with the deprecated HttpClient v3.1 implementation and it appears to work as I would have expected which seems to be reusing HTTP requests.\n\nI wonder if there a workaround or setting to produce the behaviour as per HttpClient v3.1 in HttpClient v4?", "attachment_id": null, "id": 198330, "creator": "pkent@janison.com.au", "time": "2017-04-18T04:35:19Z", "bug_id": 61000, "creation_time": "2017-04-18T04:35:19Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 61000, "text": "Hello,\n\nThis is not a bug but a configuration you have to do on these properties:\nhttpclient4.idletimeout=0\nhttpclient4.validate_after_inactivity=1700\nhttpclient4.time_to_live=2000\n\nRead :\nhttp://jmeter.apache.org/usermanual/properties_reference.html\n\n\nDefault values have been improved in 3.2\n\nIf issue persists after changing this, then please reopen with more details.", "id": 198344, "time": "2017-04-19T06:44:42Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-04-19T06:44:42Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "pkent@janison.com.au", "attachment_id": null, "text": "Thanks Philippe, those settings work.\n\nIt would be nice to have a little more in the documentation about this issue.", "id": 198352, "time": "2017-04-19T09:01:21Z", "bug_id": 61000, "creation_time": "2017-04-19T09:01:21Z", "is_private": false}, {"count": 4, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "(In reply to Paul from comment #3)\n> Thanks Philippe, those settings work.\n> \n> It would be nice to have a little more in the documentation about this issue.\n\nThanks for feedback.\nIt's true, you're the 3rd user to think it's an issue.\n\nIf you're willing to contribute it you're welcome :-)\n\nhttp://jmeter.apache.org/building.html\n\nRegards", "id": 198371, "time": "2017-04-19T19:22:19Z", "bug_id": 61000, "creation_time": "2017-04-19T19:22:19Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "rob@tdd.org.uk", "text": "I have apache listening on two ports, 80 and 81. I use port 80 for live\nwebsites, port 81 for test websites.\n\nIf the filename is missing for the URL, then the port value is not set and the\ndefault 80 is used.\n\nI am using the following for my mass host rule\n\nVirtualDocumentRoot /home/sites%p/%0/public_html\n\nI have\n\n/home/sites80/apachebug.tdd.org.uk/public_html\n/home/sites81/apachebug.tdd.org.uk/public_html\n\nif I visit http://apachebug.tdd.org.uk:81 I get the index.html for\nhttp://apachebug.tdd.org.uk\n\nhttp://www.tdd.org.uk:81/index.html returns file not found, expected as it\ndoesn't exit (the directory is actually empty)", "id": 90747, "time": "2006-06-28T23:18:46Z", "bug_id": 39928, "creation_time": "2006-06-28T23:18:46Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 39928, "text": "(In reply to comment #0)\n\nWe are seeing the same problem, in particular when we should be looking for a DirectoryIndex, it looks in the port 80 server's VirtualDocumentRoot, rather than in the port-numbered server we are coming from.", "id": 117449, "time": "2008-06-06T15:05:33Z", "creator": "mengel@fnal.gov", "creation_time": "2008-06-06T15:05:33Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 39928, "attachment_id": null, "is_private": false, "id": 122279, "time": "2008-11-07T08:05:17Z", "creator": "mengel@fnal.gov", "creation_time": "2008-11-07T08:05:17Z", "text": "Okay, so after much confusion, I have a workaround for this.\n\nFirst, you have to use Rewrite based mass virtual hosting, and\nsecond you have to set an environmnent variable (i.e. MY_PORT).\n\nSo instead of:\n  VirtualDocumentRoot /appora/products/web/%0:%p/html\n  VirtualScriptAlias  /appora/products/web/%0:%p/cgi-bin\n\nYou need:\n  RewriteCond %{ENV:MY_PORT} ^$ \n  RewriteRule (.*) $1 [env=MY_PORT:%{SERVER_PORT}]\n  RewriteMap lowercase int:tolower\n  RewriteCond %{REQUEST_URI} !/cgi-bin/\n  RewriteRule ^/(.*)$   /appora/products/web/%{SERVER_NAME}:%{ENV:MY_PORT}/html/$1      \n  RewriteCond %{REQUEST_URI} /cgi-bin/\n  RewriteRule ^/(.*)$   /appora/products/web/%{SERVER_NAME}:%{ENV:MY_PORT}/$1 [T=application/x-httpd-cgi]\n\nThis is the cook book Rewrite based mass virtual hosting, except for the part about setting MY_PORT if it isn't set, and using MY_PORT instead of SERVER_PORT.\n\nBasically, somewhere the SERVER_PORT stuff gets lost when doing things like doing an index.html lookup, but the MY_PORT environment variable doesnt."}]
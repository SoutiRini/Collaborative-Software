[{"count": 0, "tags": [], "creator": "aigner@secaron.de", "attachment_id": null, "id": 100447, "time": "2007-03-15T14:44:37Z", "bug_id": 41852, "creation_time": "2007-03-15T14:44:37Z", "is_private": false, "text": "Hello, \nin StringW the function truncateNicely has following bug:\n\nAny escaped XML tags are handled as single letters. This is at least\nannoying, and can perhaps in some very very special circumstances be used\nto mask data for an injection attack.\n\nThe following change fix that Problem:\n\npublic static String truncateNicely(String str, int lower, int upper, String\nappendToEnd)\n{\n  // strip markup from the string\n  str = XmlW.removeXml(str);\n\n  // unescape temporarely for length handling\n  str = XmlW.unescapeXml(str);\n\n  // quickly adjust the upper if it is set lower than 'lower'\n    if(upper < lower) {\n      upper = lower;\n    }\t\t\n\t\n  // now determine if the string fits within the upper limit\n  // if it does, go straight to return, do not pass 'go' and collect $200\n  if(str.length() > upper) {\n    // the magic location int\n    int loc;\n\n    // first we determine where the next space appears after lower\n    loc = str.lastIndexOf(' ', upper);\n\t\t\t\n    // now we'll see if the location is greater than the lower limit\n    if(loc >= lower) {\n      // yes it was, so we'll cut it off here\n      str = str.substring(0, loc);\n    } else {\n      // no it wasnt, so we'll cut it off at the upper limit\n      str = str.substring(0, upper);\n    }\n\t\n    // the string was truncated, so we append the appendToEnd String\t\t\t\t\n    str = str + appendToEnd;\n  }\n\n  // escape after finished processing string\t\t\n  str = XmlW.escapeXml(str);\n\t\t\n  return str;\n}"}, {"attachment_id": null, "tags": [], "bug_id": 41852, "text": "Makes sense to me. Change applied. \n\nsvn ci -m \"Applying suggested change from bug 41852. \"\nsrc/org/apache/taglibs/string/util/StringW.java\n\nSending        src/org/apache/taglibs/string/util/StringW.java\nTransmitting file data .\nCommitted revision 521371.", "count": 1, "id": 100798, "time": "2007-03-22T10:47:56Z", "creator": "bayard@apache.org", "creation_time": "2007-03-22T10:47:56Z", "is_private": false}]
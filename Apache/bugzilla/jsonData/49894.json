[{"count": 0, "tags": [], "bug_id": 49894, "attachment_id": null, "is_private": false, "id": 139755, "time": "2010-09-08T05:36:28Z", "creator": "rahuld14@yahoo.com", "creation_time": "2010-09-08T05:36:28Z", "text": "Hello Experts,\nI am a newbie in using POI. I am facing two issues while reading and evluating cell values in an Excel document having vlookup function as cell value (something as \"=VLOOKUP(A1,'[Source.XLS]Sheet1'!$A:$B,2,0)\").\nBelow is the detailed information:\n=> I am using poi-3.5-FINAL-20090928.jar.\n=> I need to only read the contents in the excel file (.xls /.xlsx) and evaluate the value of the formula, if any, during runtime\n=> When I execute following code, I get java.lang.RuntimeException: Could not resolve external workbook name 'Source.XLS'. Workbook environment has not been set up:\norg.apache.poi.ss.usermodel.FormulaEvaluator formulaEvalutor = wb.getCreationHelper().createFormulaEvaluator();\nCellValue cellValue=formulaEvaluator.evaluate(cell);//Error is thrown at this line; Cell is an instance of anorg.apache.poi.ss.usermodel.Cell\n=> I checked the threads and found that the evaluator needs to know the name of the external workbook and external sheet. So we need to do something like this:\n             HSSFFormulaEvaluator sourceEvaluator = new HSSFFormulaEvaluator(wb);\n             HSSFFormulaEvaluator refEvaluator = new HSSFFormulaEvaluator(extWb);\n        String[] workbookNames = { wbName, extWbName};//extWbName is not known at compile time\n        HSSFFormulaEvaluator[] evaluators = { sourceEvaluator, refEvaluator}; HSSFFormulaEvaluator.setupEnvironment(workbookNames, evaluators);\n\n*** Question 1: I could not find a solution as to how to know the workbook name (I am sure it must be expecting the complete path to the referred workbook than just the name) at runtime from the vlookup function. Is there a way to do it? I could see that there are APIs like HSSFEvaluationWorkbook - getExternalSheet but these are marked for internal use only.\n\n*** Question 2: Is there a way to get the complete formula in a cell as String (\"as is\") apart from using cell.getCellFormula() as it doesn't work good for something as \"=VLOOKUP(A1,'C:\\[Source.XLS]Sheet1'!$A:$B,2,0)\") - org.apache.poi.hssf.record.SupBookRecord.decodeFileName(String) does not seem to be implemented fully\nIt gives result as VLOOKUP(A1,'[\u0002Source.XLS]Sheet1'!A:B,2,0)"}]
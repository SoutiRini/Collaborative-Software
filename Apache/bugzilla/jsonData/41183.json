[{"count": 0, "tags": [], "bug_id": 41183, "attachment_id": null, "text": "If a live document has internal links to unpublished documents, when viewed an\nerror is thrown. I have been able to create a patch that gets around the issue,\nand will still display notifications upon publication. A better method may\nexist. LinkTarget throws an exception if the target doesn't exist.\nLinkRewritingTransformer looks for null as an indicator of the link existing or\nnot, not exception. Patch catches the exception and keeps the variable at null\nif an exception is thrown. To reproduce, publish only the Home page from the\ndefault publication and view under live.\n\norg.apache.lenya.cms.linking.LinkException: The target doesn't exist!\n\tat org.apache.lenya.cms.linking.LinkTarget.getDocument(LinkTarget.java:62)\n\tat\norg.apache.lenya.cms.cocoon.transformation.LinkRewritingTransformer.startElement(LinkRewritingTransformer.java:212)\n\tat org.apache.cocoon.xml.AbstractXMLPipe.startElement(AbstractXMLPipe.java:95)\n\tat\norg.apache.cocoon.transformation.I18nTransformer.startElement(I18nTransformer.java:1156)\n\tat org.apache.cocoon.xml.AbstractXMLPipe.startElement(AbstractXMLPipe.java:95)\n\tat\norg.apache.cocoon.transformation.AbstractSAXTransformer.startElement(AbstractSAXTransformer.java:466)\n\tat\norg.apache.lenya.cms.cocoon.transformation.MetaDataTransformer.startElement(MetaDataTransformer.java:155)", "id": 96946, "time": "2006-12-15T07:56:47Z", "creator": "rfrovarp@apache.org", "creation_time": "2006-12-15T07:56:47Z", "is_private": false}, {"count": 1, "text": "Created attachment 19264\nProof of concept patch", "bug_id": 41183, "attachment_id": 19264, "id": 96947, "time": "2006-12-15T07:57:10Z", "creator": "rfrovarp@apache.org", "creation_time": "2006-12-15T07:57:10Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "andreas@apache.org", "text": "I introduced LinkTarget.exists() for this purpose, maybe this works:\n(I didn't try it yet)\n\nIndex:\n/Users/nobby/apache/lenya/trunk/src/modules-core/linking/java/src/org/apache/lenya/cms/cocoon/transformation/LinkRewritingTransformer.java\n===================================================================\n---\n/Users/nobby/apache/lenya/trunk/src/modules-core/linking/java/src/org/apache/lenya/cms/cocoon/transformation/LinkRewritingTransformer.java\n(revision 482993)\n+++\n/Users/nobby/apache/lenya/trunk/src/modules-core/linking/java/src/org/apache/lenya/cms/cocoon/transformation/LinkRewritingTransformer.java\n(working copy)\n@@ -36,6 +36,7 @@\n import org.apache.lenya.ac.Policy;\n import org.apache.lenya.ac.PolicyManager;\n import org.apache.lenya.cms.linking.LinkResolver;\n+import org.apache.lenya.cms.linking.LinkTarget;\n import org.apache.lenya.cms.publication.Document;\n import org.apache.lenya.cms.publication.DocumentFactory;\n import org.apache.lenya.cms.publication.DocumentUtil;\n@@ -56,7 +57,7 @@\n  * <p>\n  * This transformer is applied to an XHMTL document. It processes all links\n  * following the {@link LinkResolver} syntax which are denoted by\n- * {@link ResourceType#getLinkAttributeXPaths()}.\n+ * {@link org.apache.lenya.cms.publication.ResourceType#getLinkAttributeXPaths()}.\n  * </p>\n  * <p>\n  * These links are resolved using the following rules:\n@@ -209,8 +210,9 @@\n                         if (linkUriAndQuery.length > 1) {\n                             queryString = linkUriAndQuery[1];\n                         }\n-                        Document targetDocument =\nthis.linkResolver.resolve(doc, linkUri).getDocument();\n-                        if (targetDocument != null) {\n+                        LinkTarget target = this.linkResolver.resolve(doc,\nlinkUri);\n+                        if (target.exists()) {\n+                            Document targetDocument = target.getDocument();\n                             String extension = targetDocument.getExtension();\n                             if (extension.length() > 0) {\n                                 extension = \".\" + extension;\n", "id": 96949, "time": "2006-12-15T08:33:22Z", "bug_id": 41183, "creation_time": "2006-12-15T08:33:22Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 41183, "attachment_id": null, "id": 96959, "time": "2006-12-15T12:14:06Z", "creator": "rfrovarp@apache.org", "creation_time": "2006-12-15T12:14:06Z", "is_private": false, "text": "That did it. Thanks."}, {"count": 4, "tags": [], "creator": "thorsten@apache.org", "attachment_id": null, "is_private": false, "id": 105504, "time": "2007-07-16T01:58:55Z", "bug_id": 41183, "creation_time": "2007-07-16T01:58:55Z", "text": "Renaming Lenya 1.4 to 2.0"}]
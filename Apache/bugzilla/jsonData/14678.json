[{"attachment_id": null, "tags": [], "creator": "janus@area319.de", "text": "Regarding to the preceding discussion on the mailinglist, now the bugreport.\nAs Rasmus Lerdorf said, the problem occurs only if the response is keep-alive\nand chunked and the server delivers per https.\nSo my suggestion is, that there somewhere a problem with mod_ssl, keep-alive\nand/or chunked content.\nYou can see it in my little 'test-suite':\nHTTP-Version: http://xmail.linux-de.org/test/\nHTTPS-Version: https://mail.linux-de.org/test/\n\nThe ssl-version produces some very strange output... most of the time this is\nhappening with php.\nThen you get an header beginning with:\n----start----\n0\n\nHTTP/1.1 200 OK\nDate: Mon, 11 Nov 2002 11:31:32 GMT\nServer: Apache/2.0.43 (Unix) mod_ssl/2.0.43 OpenSSL/0.9.6g\n----snip-----\n\nand some random characters in the document.", "count": 0, "id": 26568, "time": "2002-11-19T13:33:35Z", "bug_id": 14678, "creation_time": "2002-11-19T13:33:35Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "janus@area319.de", "text": "FYI: I've tried setting 'KeepAlive Off' and the problem was solved, so the\nproblem has to do with that.", "count": 1, "id": 26572, "time": "2002-11-19T13:57:19Z", "bug_id": 14678, "creation_time": "2002-11-19T13:57:19Z", "is_private": false}, {"count": 2, "tags": [], "text": "looks like ssl output filter may be sticking the bucket containing\nthe ending chunk in the wrong place\n\nI assume that disabling keepalive caused Apache to use connection close\ninstead of chunking, which avoided the other problem.\n", "is_private": false, "id": 26877, "creation_time": "2002-11-23T18:25:15Z", "time": "2002-11-23T18:25:15Z", "creator": "trawick@apache.org", "bug_id": 14678, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 14678, "is_private": false, "id": 32121, "attachment_id": null, "creator": "dmitri@netilla.com", "creation_time": "2003-02-27T22:35:26Z", "time": "2003-02-27T22:35:26Z", "text": "I have just encountered the same problem, and spent some time trying to figure\nit out.  I have this setup:\n\n\n  +--------+            +---------------+          +-------------------+\n  | client |--- HTTPS-->| apache 2.0.43 |---HTTP-->|Intranet Web Server|\n  +--------+            +---------------+          +-------------------+\n                          reverse proxy\n\n\nSometimes (actually, every time after first request [Mozilla 1.2, HTTP 1.1,\nKeep-Alive on]) I'd see the headers instead of HTML content at top of the page,\nbeginning with a zero, just like the original report.\n\nI installed ssldump and looked at traffic -- from proxy to client, _two_ end\nchunk trailers (zero, CRLF) were sent after the content.  Then I used HTTP to\nconnect to the proxy, and observed the same thing happen with ethereal.  In this\ncase, however, Mozilla parses responses correctly (who knows why).\n\nExcerpt from RFC 2616, section 3.6.1:\n\n\"The chunked encoding is ended by any chunk whose size if zero, followed by the\ntrailer, which is terminated by an empty line.\"\n\nIn my case, the data sent was \"0\\r\\n\\r\\n0\\r\\n\\r\\n\".  I think (if I decipher the\nRFC correctly) that the last chunk is \"0\\r\\n\" and the trailer is empty, and\n\"\\r\\n\" is the empty line.  Thus, \"0\\r\\n\\r\\n\" is left in the client's IN pipe.\n"}, {"count": 4, "tags": [], "bug_id": 14678, "attachment_id": null, "id": 32907, "time": "2003-03-11T04:33:50Z", "creator": "dmitri@netilla.com", "creation_time": "2003-03-11T04:33:50Z", "is_private": false, "text": "This looks like a duplicate of bug 14451 (see comments to this change for details:\nhttp://cvs.apache.org/viewcvs.cgi/httpd-2.0/server/util_filter.c.diff?r1=1.93.2.1&r2=1.93.2.2&only_with_tag=APACHE_2_0_BRANCH)\n\nI put this file into my 2.0.43 tree and voila! that fixed it."}, {"count": 5, "tags": [], "text": "Thanks for tracking that down.\n\n*** This bug has been marked as a duplicate of 14451 ***", "is_private": false, "bug_id": 14678, "id": 41075, "time": "2003-07-21T14:09:39Z", "creator": "jorton@redhat.com", "creation_time": "2003-07-21T14:09:39Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "*** Bug 19429 has been marked as a duplicate of this bug. ***", "is_private": false, "bug_id": 14678, "id": 62741, "time": "2004-08-30T09:36:20Z", "creator": "s.tesch@science-computing.de", "creation_time": "2004-08-30T09:36:20Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Reopening a bug that is closed that long without any new information does not\nmake any sense.\n\n*** This bug has been marked as a duplicate of 14451 ***", "attachment_id": null, "id": 112587, "creator": "rpluem@apache.org", "time": "2008-01-07T08:36:31Z", "bug_id": 14678, "creation_time": "2008-01-07T08:36:31Z", "is_private": false}, {"count": 8, "tags": [], "text": "I have just encountered a similar problem.  I have this setup:\n\n\n  +--------+            +---------------+          +-------------------+\n  | client |--- HTTPS-->| apache 2.0.59 |---HTTP-->| JBoss App Server  |\n  +--------+            +---------------+          +-------------------+\n   (Firefox)            (mod_ssl + mod_jk)\n\n\nWhen browser invokes GET Method on resources provided by the application \nserver (dynamic javascript in our case), the received response is as expected \n\"HTTP/1.1 200 OK\" with the correct body. Following GETs on the same resource \nproduce 304 status code. \n\nReproducibly often but not always the response contains some data. For some \nreason this gets interpretted as a 200 (as shown by the headers) and the \nbrowser displays in error console the following lines (it's a javascript \nresource) :\n\nError: missing ; before statement\nSource File: ...<uri of the resource>...\nLine: 4, Column: 9\nSource Code:\nHTTP/1.1 304 Not Modified\n\nAs reported in \"https://bugzilla.mozilla.org/show_bug.cgi?id=364556\" this \nseems due to some additional characters into body (something \nlike \"0\\r\\n\\r\\n0\\r\\n\\r\\n\" ?). Using Firefox, the loaded resources and browser \nmemory cache are corrupted.\n\nIe6+ seems not to suffer the same problem, it seems to ignore the body when \nthe return status is 304.\n\nUnfortunately this problem occurs on daily basis on our servers, thus limiting \nthe use of our https services for firefox browser.", "is_private": false, "id": 112589, "creation_time": "2008-01-07T08:44:00Z", "time": "2008-01-07T08:44:00Z", "creator": "m.zinna@bravosolution.com", "bug_id": 14678, "attachment_id": null}, {"count": 9, "tags": [], "text": "sorry for empty post: an hasty click. I know This bug has been marked as a \nduplicate of 14451, but even if that bug results fixed in 2.0.45, I still have \nthe problem in 2.0.59, and as described in my previous post it seems more \nsimilar to this \"14678\" than to \"14451\".", "attachment_id": null, "id": 112590, "creator": "m.zinna@bravosolution.com", "time": "2008-01-07T08:49:48Z", "bug_id": 14678, "creation_time": "2008-01-07T08:49:48Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 14678, "attachment_id": null, "is_private": false, "id": 112591, "time": "2008-01-07T08:54:25Z", "creator": "m.zinna@bravosolution.com", "creation_time": "2008-01-07T08:54:25Z", "text": "More information. Verborse log of mod_jk shows that response interpreted as \ncorrected by browser and corrupted one have the same dump at mod_jk level."}, {"count": 11, "tags": [], "text": "More information. Setting KeepAlive=Off fix the problem. \nIt may be that \"Apache\" dirty some buffer when it reuses the same connection.\n\nPutting the following line:\n\nBrowserMatch Firefox nokeepalive\n\n\"Internet Explorer\" works as before and firefox does not use keepalive \nconnections.", "attachment_id": null, "bug_id": 14678, "id": 113040, "time": "2008-01-21T08:19:49Z", "creator": "m.zinna@bravosolution.com", "creation_time": "2008-01-21T08:19:49Z", "is_private": false}, {"count": 12, "tags": [], "text": "Changing back to fixed.  If JBoss is including a response body with some 304 responses, it's in violation of the HTTP standard (RFC 2616) and needs to be fixed.  Not Apache's problem.", "is_private": false, "id": 127241, "creator": "poirier@pobox.com", "time": "2009-05-21T08:06:58Z", "bug_id": 14678, "creation_time": "2009-05-21T08:06:58Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 59378, "attachment_id": 33805, "text": "Created attachment 33805\nFile corrupted after a write\n\nSome docx files that are fine to Word become corrupt after being opened and saved, even without any modifications.\n\nThe attached file exhibits this behavior:\n- The file can be opened fine with Word\n- The file can be opened fine with POI through XWPFDocument\n- On save by POI, the file cannot be opened by Word (the error message indicates that the document is corrupt but can be repaired)\n- On reopen by POI through XWPFDocument, an InvalidFormatException is thrown\n\n    XWPFDocument doc = new XWPFDocument( [ input file ] );\n    ByteArrayOutputStream out = new ByteArrayOutputStream();\n    doc.write(out);\n    out.close();\n    \n    XWPFDocument doc2 = new XWPFDocument(new ByteArrayInputStream(out.toByteArray()));\n\nThis code throws the following exception:\n    org.apache.poi.openxml4j.exceptions.InvalidFormatException: The part /_rels/.rels does not have any content type ! Rule: Package require content types when retrieving a part from a package. [M.1.14]\n    org.apache.poi.POIXMLException: org.apache.poi.openxml4j.exceptions.InvalidFormatException: The part /_rels/.rels does not have any content type ! Rule: Package require content types when retrieving a part from a package. [M.1.14]\n            at org.apache.poi.util.PackageHelper.open(PackageHelper.java:39)\n            at org.apache.poi.xwpf.usermodel.XWPFDocument.<init>(XWPFDocument.java:128)\n            [...]\n    Caused by: org.apache.poi.openxml4j.exceptions.InvalidFormatException: The part /_rels/.rels does not have any content type ! Rule: Package require content types when retrieving a part from a package. [M.1.14]\n            at org.apache.poi.openxml4j.opc.ZipPackage.getPartsImpl(ZipPackage.java:291)\n            at org.apache.poi.openxml4j.opc.OPCPackage.getParts(OPCPackage.java:713)\n            at org.apache.poi.openxml4j.opc.OPCPackage.open(OPCPackage.java:296)\n            at org.apache.poi.util.PackageHelper.open(PackageHelper.java:37)", "id": 190563, "time": "2016-04-26T14:42:51Z", "creator": "thomas.schwery@gmail.com", "creation_time": "2016-04-26T14:42:51Z", "is_private": false}, {"count": 1, "tags": [], "creator": "dominik.stadler@gmx.at", "text": "I tried to reproduce this, but could not, reading the document, then writing it out and reading back in did work fine. Is there anything else that is involved to make it fail?", "id": 191114, "time": "2016-05-19T19:09:02Z", "bug_id": 59378, "creation_time": "2016-05-19T19:09:02Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "thomas.schwery@gmail.com", "text": "It now works.\n\nThe error was caused by the inclusion in my projects of an old Xalan (2.5) library. Upgrading it to Xalan 2.7 solved the error.\n\nSorry for the false report.", "id": 191181, "time": "2016-05-23T12:11:24Z", "bug_id": 59378, "creation_time": "2016-05-23T12:11:24Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 59378, "attachment_id": null, "id": 191375, "time": "2016-06-02T20:10:04Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-06-02T20:10:04Z", "is_private": false, "text": "There is now a unit-test via r1746623 which verifies that it stays fixed."}]
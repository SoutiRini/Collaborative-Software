[{"count": 0, "tags": [], "bug_id": 549, "attachment_id": null, "text": "There is a bug in the StringPool class that we see when we try to resolve\nexternal entities and the top level source is an InputStream instead of a\nSystemID. In other words, using \n\n org.apache.xerces.parsers.DOMParser.parse(new InputSource(InputStream))\n\nFails while\n\n org.apache.xerces.parsers.DOMParser(new InputSource(systemID)) works.\n\nI tracked this down to the StringPool.addSymbol() method.  I believe\nthat since the InputSource(InputStream) never sets it's systemId, it \nis null. So when this is passed into addSymbol() the exception occurs.\n\nIt seems that the null should be a valid value so I fixed this locally\nby patching the code. \n\nOriginally found in version 1_2_0 but also in 1_2_3 and 1_3_0.\n\n\nIn org/apache/xerces/readersDefaultEntityHandler.java, this addSymbol\n(fSystemId) on line 226 hits the bug.\n\n      public int addExternalEntityDecl(int name, int publicId, int systemId, \nboolean isExternal) throws Exception {\n\n!         int entityHandle = fEntityPool.addEntityDecl(name, -1, publicId, \nsystemId, fStringPool.addSymbol(fSystemId), -1, isExternal);\n\n          return entityHandle;\n\n      }\n\n\n\nfSystemId is null which is perfectly acceptable. But when addSymbol(...) tries\nto get the length, a NullPointerException is raised. I believe there are other\ncases where a null could be passed in to addSymbol(). So I added a check to\nmake sure null is acceptable.  NULL_STRING is the index to the null string.\n\n\n diff -cw ./src/org/apache/xerces/utils/StringPool.java ../xerces-\n1_2_3/src/org/apache/xerces/utils/StringPool.java\n*** ./src/org/apache/xerces/utils/StringPool.java\tWed Jan 31 20:11:30 2001\n--- ../xerces-1_2_3/src/org/apache/xerces/utils/StringPool.java\tFri Jan 26 \n17:38:24 2001\n***************\n*** 345,350 ****\n--- 345,352 ----\n          }\n      }\n      public int addSymbol(String str) {\n+         if( str == null )\n+ \t  return NULL_STRING;\n          int slen = str.length();\n          int hashcode = StringHasher.hashString(str, slen);\n          int hc = hashcode % HASHTABLE_SIZE;", "id": 614, "time": "2001-02-08T06:46:18Z", "creator": "blais@odi.com", "creation_time": "2001-02-08T06:46:18Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 549, "text": "\n\n*** This bug has been marked as a duplicate of 4026 ***", "id": 7405, "time": "2001-10-31T14:54:18Z", "creator": "elena@apache.org", "creation_time": "2001-10-31T14:54:18Z", "is_private": false, "attachment_id": null}]
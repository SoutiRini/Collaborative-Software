[{"count": 0, "tags": [], "text": "http://mail-archives.apache.org/mod_mbox/jakarta-dev/201108.mbox/%3CCAOGo0VaUMsYQT1pY-JbGeGPfDPbBiBsPzzN1_7W5b3T9=D=J8Q@mail.gmail.com%3E\n\nToday, I try a load test on a Content Delivery Network (CDN) with HC3.1 vs HC4 with last JMeter trunk (r1173449).\n\n(OpenJDK 6 or Sun JDK 7, GNU/Linux Debian 6.0 64 bits)\n\nMy script :\nTest only static resources (gif, png, jpeg) with direct HTTP Request\n100 users\nRamp up : 100 secs\nDuration test : 300 secs (5min)\nEach iteration execute 39 HTTP requests\nHTTP requests : Keep Alive true\n\n\nI have this issue (on 8 same tests: 4 HC3.1 and 4 HC4.1) :\n\nWith HC3.1 after ramp up period:\n netstat -tplna|grep java|grep ESTA|wc -l\n100\n\nWith HC4.1 at beginning and after ramp up :\nnetstat -tplna| grep java | grep ESTA | wc -l\n1145 (value change between ~1000-1150)\n\nI make a tcp dump and analyze with wireshark.\nWith HC3.1 : 0-42 secs : 43 TCP conversations (inside several HTTP GET and response)\nWith HC4.1 : 0-44 secs : 3011 TCP conversations (inside one HTTP GET and one response)\n\nHTTP conversations show Keep-Alive header (HC3 and HC4)\n\nI suppose that is a close keep alive connection problem with JMeter.", "attachment_id": null, "bug_id": 51863, "id": 149601, "time": "2011-09-21T22:35:05Z", "creator": "milamber@apache.org", "creation_time": "2011-09-21T22:35:05Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 27554\nSimple Test Case\n\nHere a simple test plan.\nIf you keep only 1 http request per iteration (with hc4) : 100 connections established with netstat (after ramp up)\nIf you keep 10 http requests per iteration (with hc4) : more 100 connections established (and more CLOSE_WAIT) before end of ramp up period", "is_private": false, "bug_id": 51863, "id": 149602, "time": "2011-09-21T22:36:58Z", "creator": "milamber@apache.org", "creation_time": "2011-09-21T22:36:58Z", "attachment_id": 27554}, {"id": 149603, "tags": [], "bug_id": 51863, "attachment_id": null, "count": 2, "text": "Thanks.\n\nPatched:\n\nURL: http://svn.apache.org/viewvc?rev=1173915&view=rev\nLog:\nBug 51863 - Lots of ESTABLISHED connections with HttpClient 4 implementation (ws HttpClient 3.1 impl)\n\nModified:\n   jakarta/jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n   jakarta/jmeter/trunk/xdocs/changes.xml", "time": "2011-09-22T00:20:10Z", "creator": "sebb@apache.org", "creation_time": "2011-09-22T00:20:10Z", "is_private": false}]
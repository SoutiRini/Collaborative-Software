[{"attachment_id": null, "tags": [], "creator": "mguillemot@yahoo.fr", "text": "I get now and then a NoClassDefFoundError concerning a tag class (not always the\nsame) after I've restarted the webapp. After a reload, the concerned page is\ndisplayed normally and it doesn't seem to have any consequences. This occurs on\na page with many frames (I've not seen it on any other page, but I call this\npage really more frequently than others) and when it occurs, only 1 frame is\nconcerned.\n\nThe stacktrace from the last case:\n2004-05-13 14:53:38 StandardWrapperValve[jsp]: Servlet.service() for servlet jsp\nthrew exception\njava.lang.NoClassDefFoundError: org.apache.struts.taglib.html.ImgTag\n        at org.apache.jsp.nav.navtop_jsp.class$(navtop_jsp.java:262)\n        at org.apache.jsp.nav.navtop_jsp._jspx_meth_html_img_0(navtop_jsp.java:459)\n        at org.apache.jsp.nav.navtop_jsp._jspx_meth_html_link_0(navtop_jsp.java:440)\n        at org.apache.jsp.nav.navtop_jsp._jspService(navtop_jsp.java:182)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:133)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n        at\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:311)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:301)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:248)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:284)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:204)\n        at\nde.internetzky.util.web.JSPEngineExceptionReporter.doFilter(JSPEngineExceptionReporter.java:45)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:233)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:204)\n        at\nde.internetzky.util.web.SessionsObserver$SessionCreationFilter.doFilter(SessionsObserver.java:77)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:233)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:204)\n        at de.internetzky.jnetz.web.Log4jNDCFilter.doFilter(Log4jNDCFilter.java:68)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:233)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:204)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:257)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n        at\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:245)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:199)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n        at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:184)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:149)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:156)\n        at\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:151)\n        at\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:567)\n        at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\n        at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:206)\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:833)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:732)\n        at\norg.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:619)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:688)\n        at java.lang.Thread.run(Thread.java:536)", "count": 0, "id": 57345, "time": "2004-05-13T13:09:36Z", "bug_id": 28949, "creation_time": "2004-05-13T13:09:36Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 28949, "is_private": false, "id": 57391, "time": "2004-05-14T07:20:35Z", "creator": "remm@apache.org", "creation_time": "2004-05-14T07:20:35Z", "tags": [], "text": "I've never seen this occur with the admin webapp, which seems a good candidate,\nnor with other Struts based webapps.\nPlease submit a test case."}, {"count": 2, "tags": [], "text": "I've got the same problem: \n webapp reloading/starting > page with frames > NoClassDefFoundError: xxxTag \n(after reloading of page everything is OK)\n\nthis happens sporadically (but happens :( )\n\ni know that NoClassDefFoundError: <class> is usually connected with the \nproblem of the visibility of dependent classes of <class> in classloader tree, \nbut in this case it seems to be st. else (i've checked that all required \nclasess was visible).\n\ni don't understand the accidentality of occurrences of this error (various \nframes, various tags) \n\n\n", "is_private": false, "bug_id": 28949, "id": 58386, "time": "2004-05-29T18:56:22Z", "creator": "jb4@centrum.cz", "creation_time": "2004-05-29T18:56:22Z", "attachment_id": null}, {"id": 58387, "tags": [], "bug_id": 28949, "is_private": false, "count": 3, "text": "Hi.\n\nThis also happens to me.  In my case is always seems to happen with TEI \nclasses that are in my custom tag library - and if there are not any TEI \nclasses then another class - also a custom tag class - is not found after \nrestart.  A refresh sorts the problem.\n\nI have posted this issue to the users list a number of times.  The problem \nseems to happen under the following conditions:\n\n-  large custom tag library (mine is custom with 200+ tags)\n-  A number of frames in the browser - one or more of which reference the tag \nlibrary\n-  TEI classes (if present) are always the culprits - and always in order of \nappearance in the tld.\n\nI have now got a servlet doing a load-on-startup of 1 and in its init I do the \nfollowing:\n\nClassLoader cls = this.getClass().getClassLoader();\ncls.loadClass(\"offence.very.TEIClasses);\n\n:)", "time": "2004-05-29T19:10:11Z", "creator": "carl@zero-one.co.za", "creation_time": "2004-05-29T19:10:11Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "I'm having the same issue. A refresh of the offending page loads properly. \nIt's always after a tomcat restart and it can't find one of the classes for a \ncustom tag. ", "is_private": false, "bug_id": 28949, "id": 59240, "time": "2004-06-15T16:33:48Z", "creator": "justinafoster@hotmail.com", "creation_time": "2004-06-15T16:33:48Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Sorry, it still doens't happen for me. The admin webapp appears to work fine,\nwith all its Struts tags and frames.", "is_private": false, "bug_id": 28949, "id": 60801, "time": "2004-07-19T12:29:47Z", "creator": "remm@apache.org", "creation_time": "2004-07-19T12:29:47Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "mguillemot@yahoo.fr", "attachment_id": null, "id": 61548, "time": "2004-08-04T16:12:33Z", "bug_id": 28949, "creation_time": "2004-08-04T16:12:33Z", "is_private": false, "text": "This seems to happen after each restart of the applicaton on one development\ncomputer. It appears only sporadically on other computers. I can't send the\napplication. If you have indications, I can apply them on this computer to help\nsolving this bug."}, {"count": 7, "attachment_id": null, "bug_id": 28949, "is_private": false, "id": 62799, "time": "2004-08-30T19:26:52Z", "creator": "yoavs@computer.org", "creation_time": "2004-08-30T19:26:52Z", "tags": [], "text": "Does it still happen with 5.0.28?"}, {"count": 8, "tags": [], "text": "Yes, it still happens with Tomcat 5.0.28.", "attachment_id": null, "id": 63208, "creation_time": "2004-09-08T13:22:45Z", "time": "2004-09-08T13:22:45Z", "creator": "mguillemot@yahoo.fr", "bug_id": 28949, "is_private": false}, {"count": 9, "tags": [], "text": "Without a test case allowing us to reproduce this problem, this issue will be \nclosed as either INVALID or WORKSFORME.  Please post a WAR file which we can \nreload using the admin webapp that will throw this exception.", "is_private": false, "bug_id": 28949, "id": 64007, "time": "2004-09-21T19:20:10Z", "creator": "yoavs@computer.org", "creation_time": "2004-09-21T19:20:10Z", "attachment_id": null}, {"count": 10, "tags": [], "text": "Hi.\n\nIt is definitely still happening on 5.0.28.\n\nAdditional comments/indicators:\n\n-  Only happens when frames are in use - and more than 1 page separate frames \nare accessing the custom tag libs\n-  Seems to happen when the machine running Tomcat is under fairly heavy \nmemory load\n-  Seems more likely to occur if the custom tag lib defines a large number of \ntags.", "is_private": false, "bug_id": 28949, "id": 64660, "time": "2004-10-06T05:59:12Z", "creator": "carl@zero-one.co.za", "creation_time": "2004-10-06T05:59:12Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 28949, "attachment_id": 12980, "text": "Created attachment 12980\nThis is a war provided by Marc Guillemot which replicates this bug.  The replication works better (or worse) on Windows than Linux.", "id": 64727, "time": "2004-10-07T05:06:44Z", "creator": "michael@michaelmcgrady.com", "creation_time": "2004-10-07T05:06:44Z", "is_private": false}, {"count": 12, "tags": [], "text": "I tried it, and it worked (I'm on Windows). I tried increasing the amount of\nframes too.\nI don't quite see how it would be different from hitting one of the pages with\nab and a high concurrecy.\n\nThis bug doesn't make sense to me overall: it's getting closer to INVALID.", "is_private": false, "bug_id": 28949, "id": 64740, "time": "2004-10-07T11:01:54Z", "creator": "remm@apache.org", "creation_time": "2004-10-07T11:01:54Z", "attachment_id": null}, {"count": 13, "tags": [], "creator": "mguillemot@yahoo.fr", "attachment_id": null, "id": 64746, "time": "2004-10-07T12:56:31Z", "bug_id": 28949, "creation_time": "2004-10-07T12:56:31Z", "is_private": false, "text": "As it is a bug that doesn't happen systematically, I understand that it is for\nyou difficult to accept it as valid. But as I'm not the only one having the\nproblem, I'm sure that it is not a dream (sorry a nighmare) and it sould NOT be\nchanged to INVALID.\n\nAs you can't reproduce it on your computer, perhaps can you give some indication\nto those wo can, so that they to find the cause? What would you look at if you\ncould reproduce it?"}, {"count": 14, "tags": [], "text": "I'd look at the thread-safety of the relevant classloader.  Multiple frames \nmeans multiple more-or-less concurrent hits, and if there's a class that needs \nto be loaded it means multiple concurrent loadClass-type requests.  But you \ndon't want to just synchronized everything on the classloader for no reason, as \nthat's a performance penalty.  However, that can be a useful diagnostic tool:\n\nSo here's one approach, if you have the time and really want to help us out: \nbuild your own Tomcat 5.0.28 having added the synchronized keyword around every \nmethod in every Catalina classloader.  Then try your test and see if the error \ngoes away.  This is just a guess, but that's what I'd try if I were in your \nposition.  It's wild overkill, but you can always strip out the synchronized \nplaces one by one afterwards.\n\nBTW, updating version from 5.0.19 to 5.0.28 on this issue.", "is_private": false, "id": 64748, "creation_time": "2004-10-07T13:01:39Z", "time": "2004-10-07T13:01:39Z", "creator": "yoavs@computer.org", "bug_id": 28949, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "remm@apache.org", "is_private": false, "count": 15, "id": 64750, "time": "2004-10-07T13:12:27Z", "bug_id": 28949, "creation_time": "2004-10-07T13:12:27Z", "text": "If this was the case, then you would get problems for servlet based application\nas well, or for JSPs which use helper classes. Actually, since a frame is only a\nway to do a few concurrent requests, you'd get problems during load tests (for\nex on the date.jsp example).\n\nSyncing everything in the classloader is a bad test IMO. I think it will greatly\naffect the capability of the server to run concurrent stuff, and as a result it\nwill change the behavior of many other components.\n\nLet's not waste time on this."}, {"attachment_id": null, "tags": [], "creator": "mguillemot@yahoo.fr", "text": "For info: \nI've just performed a test on an older computer with Windows 2000. Downloaded\nTomcat 5.0.28 zip version and placed the small test application attached to this\nbug in the webapps dir. I've performed 20 times startup.bat, called the default\npage of the webapp in the browser and then shutdown.bat. In 12 cases everything\nwas correct and in 8 cases one of the frame had the NoClassDefFoundError exception.", "count": 16, "id": 64756, "time": "2004-10-07T14:08:11Z", "bug_id": 28949, "creation_time": "2004-10-07T14:08:11Z", "is_private": false}, {"count": 17, "attachment_id": null, "bug_id": 28949, "is_private": false, "id": 64758, "time": "2004-10-07T14:21:32Z", "creator": "michael@michaelmcgrady.com", "creation_time": "2004-10-07T14:21:32Z", "tags": [], "text": "I am sure this is a bug.  There is just too much documentation and too many\ndisparate reports for that not to be the case.  I am also not sure what\n\"INVALID\" means, but if it means that the bug does not exist, that is not right.\n The bug does exist.  So, I assume \"INVALID\" does not mean that.\n\nI clearly get the undesired behavior both with Marc's test war and with my own\napplication.  \n\nI should mention that I have different frame based pages.  Some of the pages\nhave this problem on a consistent basis.  Others never have this problem.  Why\nthat would be is a mystery to me.  The only apparent difference between the\npages is the number of times the custom taglib is used.  On the page with twelve\nuses of the taglib, the behavior is clear and persistent: nearly everytime but\nnot quite.  Why that should make a difference is not clear to me.  But, that is\nthe only difference I see.\n\n"}, {"count": 18, "attachment_id": 12984, "bug_id": 28949, "is_private": false, "id": 64759, "time": "2004-10-07T14:33:53Z", "creator": "michael@michaelmcgrady.com", "creation_time": "2004-10-07T14:33:53Z", "tags": [], "text": "Created attachment 12984\nI tested Marc's war 7 times and got the error everytime on a Compaq Presario 2500 running XP Home and Tomcat 5.0 as previously indicated."}, {"count": 19, "tags": [], "creator": "mguillemot@yahoo.fr", "text": "Yoav, you mean in all 3:\norg.apache.catalina.loader.StandardClassLoader\norg.apache.catalina.loader.WebappClassLoader\norg.apache.jasper.servlet.JasperLoader\n\nor are there any other class loaders?", "id": 64762, "time": "2004-10-07T14:54:29Z", "bug_id": 28949, "creation_time": "2004-10-07T14:54:29Z", "is_private": false, "attachment_id": null}, {"count": 20, "tags": [], "bug_id": 28949, "attachment_id": null, "id": 64763, "creation_time": "2004-10-07T14:58:37Z", "time": "2004-10-07T14:58:37Z", "creator": "remm@apache.org", "text": "Try Tomcat 5.5.3 first. Then I think you shouldn't get guidance if you expect to\nactually get a fresh look at what this issue could be.", "is_private": false}, {"count": 21, "attachment_id": null, "bug_id": 28949, "is_private": false, "id": 65666, "time": "2004-10-25T19:11:54Z", "creator": "yoavs@computer.org", "creation_time": "2004-10-25T19:11:54Z", "tags": [], "text": "Updates?  Is 5.5.3 better?"}, {"count": 22, "tags": [], "text": "I could only test it on one computer up to now, but it seems better with 5.5.3:\nI wasn't able to reproduce the problem in 20 tests when it appeared ~8 times for\n20 tests with 5.0.28. I have to perform tests on other machines to have a better\nopinion.", "is_private": false, "id": 65816, "creation_time": "2004-10-27T11:23:18Z", "time": "2004-10-27T11:23:18Z", "creator": "mguillemot@yahoo.fr", "bug_id": 28949, "attachment_id": null}, {"count": 23, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 65817, "time": "2004-10-27T12:08:21Z", "bug_id": 28949, "creation_time": "2004-10-27T12:08:21Z", "text": "Then it would indicate that the issue was with StandardClassLoader (which in 5.5\nis replaced by a URL classloader)."}, {"count": 24, "tags": [], "text": "So it seems to work on 5.5 (I tried 5.5.4, couldn't reproduce the error, and \nMarc couldn't reproduce it on 5.5.3).  Given that no one feels like doing \nclassloader work on the 5.0 branch now that 5.5 is stable, I'm closing this \nissue.  Please only reopen this issue if you have a tested patch to the \nclassloader that you can attach to it -- thanks.", "is_private": false, "bug_id": 28949, "id": 67032, "time": "2004-11-17T16:03:56Z", "creator": "yoavs@computer.org", "creation_time": "2004-11-17T16:03:56Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "pbelau1@yahoo.com", "attachment_id": null, "id": 113191, "time": "2008-01-28T06:58:50Z", "bug_id": 44311, "creation_time": "2008-01-28T06:58:50Z", "is_private": false, "text": "mod_proxy working as a forward proxy in Apache 2.2.8 seems to break\nwww.hotels.com. This would appear to be a regression since 2.2.7. I have\nconfirmed  this issue on 3 servers and 3 seperate Apache builds.\n\nhttpd.conf below:\n\nListen 0.0.0.0:9292\nUser daemon\nGroup daemon\nErrorLog logs/error_log\nLogLevel debug\nDefaultType text/html\nHeader unset Accept-Ranges\nRequestHeader unset Range\nHostnameLookups off\nSetEnv proxy-sendcl off\nSetEnv proxy-sendchunked 1\nSetEnv proxy-sendchunks 1\nThreadStackSize 256000\nServerLimit 12\nThreadLimit 512\nThreadsPerChild 512\nMaxRequestsPerChild 5000000\nMaxClients 6000\nKeepAliveTimeout 1\nMaxKeepAliveRequests 100\nProxyRequests On"}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "is_private": false, "id": 113194, "time": "2008-01-28T07:29:54Z", "bug_id": 44311, "creation_time": "2008-01-28T07:29:54Z", "text": "1. There was no 2.2.7 release. Do you talk about the candidate that was\npublished on the dev list for review?\n2. How does it break www.hotels.com?"}, {"count": 2, "tags": [], "bug_id": 44311, "attachment_id": null, "id": 113195, "creation_time": "2008-01-28T07:32:00Z", "time": "2008-01-28T07:32:00Z", "creator": "pbelau1@yahoo.com", "text": "(In reply to comment #1)\n> 1. There was no 2.2.7 release. Do you talk about the candidate that was\n> published on the dev list for review?\n> 2. How does it break www.hotels.com?\n\nSorry, I meant 2.2.6. In Firefox and Opera there is no visible page data. In the\nlogs with debug turned on I'm seeing:\n\n[Mon Jan 28 07:27:21 2008] [debug] mod_proxy_http.c(1822): proxy: HTTP: serving\nURL http://www.hotels.com/\n[Mon Jan 28 07:27:21 2008] [debug] proxy_util.c(1855): proxy: HTTP: has acquired\nconnection for (*)\n[Mon Jan 28 07:27:21 2008] [debug] proxy_util.c(1916): proxy: connecting\nhttp://www.hotels.com/ to www.hotels.com:80\n[Mon Jan 28 07:27:21 2008] [debug] proxy_util.c(2015): proxy: connected / to\nwww.hotels.com:80\n[Mon Jan 28 07:27:21 2008] [debug] proxy_util.c(2172): proxy: HTTP: fam 2 socket\ncreated to connect to *\n[Mon Jan 28 07:27:21 2008] [debug] proxy_util.c(2269): proxy: HTTP: connection\ncomplete to 72.246.51.115:80 (www.hotels.com)\n[Mon Jan 28 07:27:21 2008] [debug] mod_proxy_http.c(1607): proxy: start body send\n[Mon Jan 28 07:27:21 2008] [debug] mod_headers.c(665): headers:\nap_headers_output_filter()\n[Mon Jan 28 07:27:21 2008] [info] [client 127.0.0.1] (104)Connection reset by\npeer: core_output_filter: writing data to the network\n[Mon Jan 28 07:27:21 2008] [debug] mod_proxy_http.c(1696): proxy: end body send\n[Mon Jan 28 07:27:21 2008] [debug] proxy_util.c(1873): proxy: HTTP: has released\nconnection for (*)\n[Mon Jan 28 07:27:21 2008] [info] [client 127.0.0.1] (32)Broken pipe:\ncore_output_filter: writing data to the network\n\n\n\n", "is_private": false}, {"count": 3, "tags": [], "text": "Also, I should not that hotels.com seems to send a redirect depending upon what\ncountry you are from. You can perhaps try this link from  Germany:\n\nhttp://www.hotels.com/?isRedirect=true&js=1&zz=1201533352859\n\n(In reply to comment #1)\n> 1. There was no 2.2.7 release. Do you talk about the candidate that was\n> published on the dev list for review?\n> 2. How does it break www.hotels.com?\n\n", "is_private": false, "bug_id": 44311, "id": 113196, "time": "2008-01-28T07:42:37Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-01-28T07:42:37Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Please post your configuration. I tried to use 2.2.8 as forward proxy and I had\nno hassle reaching www.hotels.com. The messages from the error log indicate that\nyou have a client problem.", "is_private": false, "bug_id": 44311, "id": 113197, "time": "2008-01-28T07:49:52Z", "creator": "rpluem@apache.org", "creation_time": "2008-01-28T07:49:52Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "(In reply to comment #4)\n> Please post your configuration. I tried to use 2.2.8 as forward proxy and I had\n> no hassle reaching www.hotels.com. The messages from the error log indicate that\n> you have a client problem.\n\nMy configuration is posted in the body of the original message. I have been able\nto reproduce this error on 3 different Apache builds running on 3 different\nnetworks. The errors occurs both with Firefox and Opera.\n\n", "attachment_id": null, "bug_id": 44311, "id": 113198, "time": "2008-01-28T07:54:35Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-01-28T07:54:35Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 44311, "is_private": false, "text": "I've succeeded to reproduce this IE 7.0 WinXP SP3RC1", "id": 113199, "time": "2008-01-28T08:25:15Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-01-28T08:25:15Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 44311, "attachment_id": null, "id": 113212, "time": "2008-01-28T09:02:01Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-01-28T09:02:01Z", "is_private": false, "text": "If IE setting \"Use HTTP/1.1 for proxy\" is turned off, work correct.\nI guess something happens in chunked encoding."}, {"count": 8, "tags": [], "bug_id": 44311, "attachment_id": null, "text": "(In reply to comment #3)\n> Also, I should not that hotels.com seems to send a redirect depending upon what\n> country you are from. You can perhaps try this link from  Germany:\n> \n> http://www.hotels.com/?isRedirect=true&js=1&zz=1201533352859\n\nThanks for the link. With the help of the link I was able to reproduce your issue.\nIt is caused by www.hotels.com sending a Connection: Transfer-Encoding header in\nits response. This is IMHO unusual (Transfer-Encoding is a hop-by-hop header\nanyway), but allowed. This causes httpd to remove Transfer-Encoding too early\nduring its internal processing and thus disables it from processing the chunked\nresponse. Please let me know if the patch I will attach in a second fixes your\nproblem. \n\n", "id": 113215, "time": "2008-01-28T09:07:07Z", "creator": "rpluem@apache.org", "creation_time": "2008-01-28T09:07:07Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 44311, "is_private": false, "text": "Created attachment 21438\nPatch against Trunk", "id": 113216, "time": "2008-01-28T09:07:40Z", "creator": "rpluem@apache.org", "creation_time": "2008-01-28T09:07:40Z", "attachment_id": 21438}, {"count": 10, "tags": [], "text": "Thanks a lot for tackling this issue, but must this patch be strictly applied to\ntrunk ? I tried it against 2.2.8 with no success ...\n\n(In reply to comment #9)\n> Created an attachment (id=21438) [edit]\n> Patch against Trunk\n> \n\n", "attachment_id": null, "bug_id": 44311, "id": 113221, "time": "2008-01-28T09:43:23Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-01-28T09:43:23Z", "is_private": false}, {"count": 11, "attachment_id": null, "bug_id": 44311, "is_private": false, "id": 113224, "time": "2008-01-28T11:26:31Z", "creator": "rpluem@apache.org", "creation_time": "2008-01-28T11:26:31Z", "tags": [], "text": "(In reply to comment #10)\n> Thanks a lot for tackling this issue, but must this patch be strictly applied to\n> trunk ? I tried it against 2.2.8 with no success ...\n\nNo, it should work with 2.2.8. I tested it with the link you provided against\n2.2.x (which is currently identical to 2.2.8 with respect to mod_proxy) and\nafterwards everything was fine.\n\n"}, {"count": 12, "tags": [], "bug_id": 44311, "attachment_id": null, "id": 113244, "time": "2008-01-28T17:27:11Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-01-28T17:27:11Z", "is_private": false, "text": "You are right. In my sleepy state, I incorrectly manually applied the patch. It\ndoes indeed fix this issue. Thanks again !\n\n(In reply to comment #11)\n> (In reply to comment #10)\n> > Thanks a lot for tackling this issue, but must this patch be strictly applied to\n> > trunk ? I tried it against 2.2.8 with no success ...\n> \n> No, it should work with 2.2.8. I tested it with the link you provided against\n> 2.2.x (which is currently identical to 2.2.8 with respect to mod_proxy) and\n> afterwards everything was fine.\n> \n> \n\n"}, {"count": 13, "tags": [], "text": "Reopen because no fixes haven't been committed yet", "attachment_id": null, "id": 113267, "creator": "takashi.asfbugzilla@tks.st", "time": "2008-01-29T08:28:06Z", "bug_id": 44311, "creation_time": "2008-01-29T08:28:06Z", "is_private": false}, {"count": 14, "tags": [], "text": "Committed a slightly optimized version to trunk as r616517\n(http://svn.apache.org/viewvc?rev=616517&view=rev).", "attachment_id": null, "id": 113273, "creator": "rpluem@apache.org", "time": "2008-01-29T12:56:49Z", "bug_id": 44311, "creation_time": "2008-01-29T12:56:49Z", "is_private": false}, {"count": 15, "tags": [], "text": "backported to 2.2\nhttp://svn.apache.org/viewvc?view=rev&revision=617686", "attachment_id": null, "bug_id": 44311, "id": 113354, "time": "2008-02-01T15:25:49Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-02-01T15:25:49Z", "is_private": false}]
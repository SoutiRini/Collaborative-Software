[{"count": 0, "tags": [], "text": "Created attachment 27436\nMultiple Range: request lines trace\n\nMultiple Range: request as\n\nRange: bytes=0-1\nRange: 2-3\n\nseems syntactically invalid, so the second Range: should be ignored.\n(RFC 2616,14.16 Content-Range)\n\nApache seems to (correctly) coalesce the request to\n\nRange: bytes=0-1,2-3\n\nwhich IS syntactically correct, and processed accordingly.\n\nOpen issue: how should we handle and/or coalesce multiple Range: lines?\n(classical Set-Cookie: have had the similar problem, having \",\" as data)\n\n\nTrace on httpd.apache.org (Apache/2.3.8) follows:\n\n===========\nRequesting as\n> Range: bytes=0-1\n> Range: bytes=2-3\nyielding only the first Range: being accepted.\n\n===========\n% telnet httpd.apache.org 80\nTrying 140.211.11.131...\nConnected to httpd.apache.org.\nEscape character is '^]'.\nGET http://httpd.apache.org/lists.html HTTP/1.0\nHost: httpd.apache.org\nConnection: close\nRange: bytes=0-1\nRange: bytes=2-3\n\nHTTP/1.1 206 Partial Content\nDate: Fri, 26 Aug 2011 03:38:35 GMT\nServer: Apache/2.3.8 (Unix) mod_ssl/2.3.8 OpenSSL/1.0.0c\nLast-Modified: Mon, 21 Mar 2011 18:52:05 GMT\nETag: \"9b39af-5b7a-49f029fb47f40\"\nAccept-Ranges: bytes\nContent-Length: 109\nVary: Accept-Encoding\nConnection: close\nContent-Type: multipart/byteranges; boundary=4ab6047b55edfcaa2\n\n\n--4ab6047b55edfcaa2\nContent-type: text/html\nContent-range: bytes 0-1/23418\n\n<!\n--4ab6047b55edfcaa2--\nConnection closed by foreign host.\n\n\n===========\nRequesting as\n> Range: bytes=0-1\n> Range: 2-3\nyielding both Range: being accepted.\n\n===========\n% telnet httpd.apache.org 80\nTrying 140.211.11.131...\nConnected to httpd.apache.org.\nEscape character is '^]'.\nGET http://httpd.apache.org/lists.html HTTP/1.0\nHost: httpd.apache.org\nConnection: close\nRange: bytes=0-1\nRange: 2-3\n\nHTTP/1.1 206 Partial Content\nDate: Fri, 26 Aug 2011 03:42:38 GMT\nServer: Apache/2.3.8 (Unix) mod_ssl/2.3.8 OpenSSL/1.0.0c\nLast-Modified: Mon, 21 Mar 2011 18:52:05 GMT\nETag: \"9b39af-5b7a-49f029fb47f40\"\nAccept-Ranges: bytes\nContent-Length: 193\nVary: Accept-Encoding\nConnection: close\nContent-Type: multipart/byteranges; boundary=4ab60563258c1ccb0\n\n\n--4ab60563258c1ccb0\nContent-type: text/html\nContent-range: bytes 0-1/23418\n\n<!\n--4ab60563258c1ccb0\nContent-type: text/html\nContent-range: bytes 2-3/23418\n\nDO\n--4ab60563258c1ccb0--\nConnection closed by foreign host.", "attachment_id": 27436, "id": 148835, "creator": "kabe@sra-tohoku.co.jp", "time": "2011-08-26T04:41:09Z", "bug_id": 51725, "creation_time": "2011-08-26T04:41:09Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 51725, "text": "See the last paragraph of RFC 2616, S4.2.\nMy understanding of that text is that it is the client's responsibility to use multiple occurrences of a request header field only if it is valid to combine them with a comma.\nAs far as httpd: It does combine multiple-occurring fields with a comma without regards to the particular field (Cookie*, Range, whatever).", "id": 149016, "time": "2011-09-04T15:52:27Z", "creator": "trawick@apache.org", "creation_time": "2011-09-04T15:52:27Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 51725, "attachment_id": null, "id": 149018, "time": "2011-09-05T02:26:09Z", "creator": "kabe@sra-tohoku.co.jp", "creation_time": "2011-09-05T02:26:09Z", "is_private": false, "text": "\nThe RFC 2616, S4.2 says\n>   Multiple message-header fields with the same field-name MAY be\n>   present in a message if and only if the entire field-value for that\n>   header field is defined as a comma-separated list [i.e., #(values)].\n\n>   It MUST be possible to combine the multiple header fields into one\n>   \"field-name: field-value\" pair, without changing the semantics of the\n>   message, by appending each subsequent field-value to the first, each\n>   separated by a comma.\n\nSince Range: field-value is defined as\n\t\"bytes=\" 1#( byte-range-spec | suffix-byte-range-spec )\n\nthis isn't splittable into multiple lines.\n\nThere should have been some discussion about this unsplittableness\nduring HTTP/1.1 standard. Recall anyone?\n\n\nI don't think it's feasible to reject \"Range: 2-3\" line in the \ncurrent Apache either, which involves syntax parsing \nBEFORE the header aggregation.\n\nIf nobody comes up with any serious issues (security?), this PR\ncould be closed(wontfix) and left for information purpose."}, {"count": 3, "tags": [], "creator": "wrowe@apache.org", "attachment_id": null, "text": "You are correct, it can't be split between bytes=n-n and n-n lines per spec.\n\nI'm looking right now at clarifications to the spec on this subject.  Unlike\nour recent fix, detecting commas within Content-Length headers, we can't simply\nlook for a comma to determine if the ranges were merged.\n\nA more comprehensive fix is needed in the long term which I am designing for\n2.3 initially; in the short term our advisory will be updated per your feedback.\nThanks for the report.", "id": 149125, "time": "2011-09-09T15:32:52Z", "bug_id": 51725, "creation_time": "2011-09-09T15:32:52Z", "is_private": false}]
[{"count": 0, "attachment_id": null, "bug_id": 22701, "text": "I'm not sure what library is failing here. It could be either tomcat, struts or \ncommon-logging itself. Here is the problem. My application is running under \ntomcat (jakarta-tomcat-4.1.27-LE-jdk14) using struts (jakarta-struts-1.1). I'm \nusing log4j as the logging implementation. I have the following jar files in \nthe application's WEB-INF directory:\n\ncommons-beanutils.jar\ncommons-collections.jar\ncommons-digester.jar\ncommons-fileupload.jar\ncommons-lang.jar\ncommons-logging.jar\ncommons-validator.jar\njakarta-oro.jar\nstruts.jar\n\nlog4j-1.2.8.jar\nrowset.jar\n\nEverything works fine till I try to access my application through https:// \nprotocol. I'm getting the following exception:\n\norg.apache.commons.logging.LogConfigurationException: org.apache.commons.logging\n.LogConfigurationException: org.apache.commons.logging.LogConfigurationException\n: Class org.apache.commons.logging.impl.Log4JLogger does not implement Log\n        at org.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactory\nImpl.java:532)\n        at org.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactory\nImpl.java:272)\n        at org.apache.commons.logging.impl.LogFactoryImpl.getInstance(LogFactory\nImpl.java:246)\n        at org.apache.commons.logging.LogFactory.getLog(LogFactory.java:395)\n        at org.apache.tomcat.util.net.jsse.JSSESupport.<init>(JSSESupport.java:8\n7)\n        at org.apache.tomcat.util.net.jsse.JSSE14Support.<init>(JSSE14Support.ja\nva:99)\n        at org.apache.tomcat.util.net.jsse.JSSE14Factory.getSSLSupport(JSSE14Fac\ntory.java:84)\n        at org.apache.tomcat.util.net.jsse.JSSEImplementation.getSSLSupport(JSSE\nImplementation.java:118)\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.proce\nssConnection(Http11Protocol.java:385)\n        at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java\n:565)\n        at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadP\nool.java:619)\n        at java.lang.Thread.run(Thread.java:534)\nCaused by: org.apache.commons.logging.LogConfigurationException: org.apache.comm\nons.logging.LogConfigurationException: Class org.apache.commons.logging.impl.Log\n4JLogger does not implement Log\n        at org.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor(LogF\nactoryImpl.java:416)\n        at org.apache.commons.logging.impl.LogFactoryImpl.newInstance(LogFactory\nImpl.java:525)\n        ... 11 more\nCaused by: org.apache.commons.logging.LogConfigurationException: Class org.apach\ne.commons.logging.impl.Log4JLogger does not implement Log\n        at org.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor(LogF\nactoryImpl.java:412)\n        ... 12 more\n\nIf I remove the commons-logging.jar from WEB-INF/lib then everything works \nfine. However, no logging is performed in struts actions.\n\nI've seen some postings suggested that only one commons-logging.jar should be \nin the classpath. I know that tomcat has it's own server/lib/commons-\nlogging.jar that is identical (based on the manifest file) to the one that came \nwith struts. In any case, I've tried to copy server/lib/commons-logging.jar \ninto WEB-INF/lib - same result - an exception when https:// is used.\n\nThe only solution that I have is to use log4j directly in actions (as I do in \nBO, DAO layers anyway)\n\nAny ideas ?\nThanks\nPavel", "id": 43248, "time": "2003-08-25T17:06:29Z", "creator": "olgt@yahoo.com", "creation_time": "2003-08-25T17:06:29Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 22701, "attachment_id": null, "text": "This is a tomcat/commons-logging issue.", "id": 43253, "time": "2003-08-25T17:43:00Z", "creator": "dgraham@apache.org", "creation_time": "2003-08-25T17:43:00Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 22701, "is_private": false, "text": "Changed Product to Tomcat, Componenet to Catalina", "id": 43265, "time": "2003-08-25T19:18:49Z", "creator": "olgt@yahoo.com", "creation_time": "2003-08-25T19:18:49Z", "attachment_id": null}, {"count": 3, "attachment_id": null, "bug_id": 22701, "text": "Reassigned to tomcat-dev@jakarta.apache.org ", "id": 43336, "time": "2003-08-26T18:19:23Z", "creator": "olgt@yahoo.com", "creation_time": "2003-08-26T18:19:23Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 22701, "attachment_id": null, "text": "*** Bug 22737 has been marked as a duplicate of this bug. ***", "id": 43789, "time": "2003-09-06T08:13:42Z", "creator": "remm@apache.org", "creation_time": "2003-09-06T08:13:42Z", "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 22701, "is_private": false, "id": 43791, "time": "2003-09-06T08:16:30Z", "creator": "remm@apache.org", "creation_time": "2003-09-06T08:16:30Z", "tags": [], "text": "*** Bug 16189 has been marked as a duplicate of this bug. ***"}, {"count": 6, "attachment_id": null, "bug_id": 22701, "text": "Anecdotally, reverting to Log4j 1.2.7 seems to \"fix\" this issue.  It seems to \nbe something with the combination of Tomcat 4.1.27 and Log4j 1.2.8.  \n\nA coworker's webapp works fine on Tomcat 4.1.24, but dies on 4.1.27.  If you \nreplace the Log4j 1.2.8 jar file with Log4j 1.2.7, (and restart Tomcat) it \nworks fine again.", "id": 44609, "time": "2003-09-24T19:57:52Z", "creator": "wsmoak@apache.org", "creation_time": "2003-09-24T19:57:52Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 22701, "attachment_id": null, "text": "Curiously, the webapp (mentioned in the prior comment) seems to be working fine \nwith Log4j 1.2.8 under Tomcat 4.1.27 on HP-UX.  The JVM's are obviously \ndifferent between the Windows and HP-UX machines, but it's the same version of \nTomcat, down to the .zip file.\n", "id": 44611, "time": "2003-09-24T21:04:04Z", "creator": "wsmoak@apache.org", "creation_time": "2003-09-24T21:04:04Z", "is_private": false}, {"count": 8, "tags": [], "creator": "chadhperry@hotmail.com", "attachment_id": null, "text": "FYI: Seems to work when using Netscape 7.1 but NOT IE 6.0~. Hmmmmm", "id": 44904, "time": "2003-09-30T19:42:44Z", "bug_id": 22701, "creation_time": "2003-09-30T19:42:44Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 22701, "is_private": false, "text": "Get also the same problem. Any news to solve this bug? Even changing the log4j \nversion? (got the 1.13.2.3)", "id": 44942, "time": "2003-10-01T12:01:02Z", "creator": "abeneuneu@nectarine.be", "creation_time": "2003-10-01T12:01:02Z", "attachment_id": null}, {"count": 10, "attachment_id": null, "bug_id": 22701, "text": "we're seeing the same behavior as wendy:\n\ntomcat 4.1.24 + log4j 1.2.7 is fine\ntomcat 4.1.24 + log4j 1.2.8 is fine\ntomcat 4.1.27 + log4j 1.2.7 is fine\ntomcat 4.1.27 + log4j 1.2.8 is broken\n\nbehavior is the same on linux and solaris.  as far as the web browser- same\nbehavior with mozilla 1.0.x and 1.4.x", "id": 44952, "time": "2003-10-01T13:57:47Z", "creator": "rob.myers@gtri.gatech.edu", "creation_time": "2003-10-01T13:57:47Z", "tags": [], "is_private": false}, {"count": 11, "attachment_id": null, "bug_id": 22701, "is_private": false, "id": 44975, "time": "2003-10-02T04:16:35Z", "creator": "bcampbell@servicemagic.com", "creation_time": "2003-10-02T04:16:35Z", "tags": [], "text": "The behavior I'm seeing is similar but somewhat different and seems to indicate \nthat it is not log4j but rather some problem with Tomcat 4.1.27 and commons-\nlogging (class loader issue maybe?????).\n\nI'm developing on windows 2k, jdk 1.4, and Tomcat 4.1.27.  I've had the problem \nwith both log4j 1.2.8 AND 1.2.7. \n\nWhen I removed the log4j jar completely (commons-logging docs say that it will \ntry and use jdk 1.4 logging now) I get the following similar but subtly \ndifferent exception (Note that it is complaining about the Jdk14Logger rather \nthan the log4jLogger).\n\nSEVERE: Error reading request, ignored\norg.apache.commons.logging.LogConfigurationException: \norg.apache.commons.logging.LogConfigurationException: \norg.apache.commons.logging.\nLogConfigurationException: Class org.apache.commons.logging.impl.Jdk14Logger \ndoes not implement Log\n        at org.apache.commons.logging.impl.LogFactoryImpl.newInstance\n(LogFactoryImpl.java:532)\n     ......\n\nFurthermore,  I no longer have the problem when I take commons-logging out of \nmy web app and just access log4j (1.2.8) directly without the extra layer of \nabstraction."}, {"count": 12, "tags": [], "bug_id": 22701, "is_private": false, "text": "This should be fixed in the CVS, but I'm having enough problems reproducing the \nbug to be sure that the fix works.  Clearly, there are a lot of people \ninterested in this that can reproduce it easily.  If I can get some help, I can \nprobably close this before the 4.1.28 release (probably next week).\n\nSteps:\n1) Grab the file from <http://cvs.apache.org/viewcvs/jakarta-tomcat-\nconnectors/util/java/org/apache/tomcat/util/net/jsse/JSSESupport.java?\nrev=1.3.2.3&only_with_tag=coyote_10&content-type=text/vnd.viewcvs-markup> and \nsave it someplace.\n2) javac -classpath $CATALINA_HOME/server/lib/tomcat_util.jar -d \n$CATALINA_HOME/server/classes JSSESupport.java\n    Note: If using a 1.3.x JVM, also include all of the JSSE jars in the \nclasspath.\n3) Restart Tomcat and test (and let me know if it still fails).\n", "id": 44979, "time": "2003-10-02T05:24:31Z", "creator": "william.barker@wilshire.com", "creation_time": "2003-10-02T05:24:31Z", "attachment_id": null}, {"count": 13, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 44980, "time": "2003-10-02T05:39:44Z", "bug_id": 22701, "creation_time": "2003-10-02T05:39:44Z", "is_private": false, "text": "In TC 5.0, the solution was to move commons-logging-api.jar to the system CL,\nand to remove commons-logging.jar. Should this be ported or not ?"}, {"count": 14, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "id": 44981, "time": "2003-10-02T06:13:09Z", "bug_id": 22701, "creation_time": "2003-10-02T06:13:09Z", "is_private": false, "text": "It seems to me that having a static Log should be enough to stop this bug.  \nHowever, I can't really reproduce it, and you committed your \"put commons-\nlogging.jar in the System loader\" long after I committed the patch.  If that's \nthe only way to fix it, then I guess that's the way to go (but I don't have to \nlike it :)."}, {"attachment_id": null, "tags": [], "creator": "remm@apache.org", "text": "I remember more details about my fix.\nIt is probably less needed for TC 4.1. In 5.0, the problem was that Jasper used\ncommons-logging. In 4.1, this is not the case, but I don't know what cleaner fix\nis needed.", "count": 15, "id": 44985, "time": "2003-10-02T07:40:51Z", "bug_id": 22701, "creation_time": "2003-10-02T07:40:51Z", "is_private": false}, {"count": 16, "tags": [], "bug_id": 22701, "is_private": false, "text": "JSSESupport.java in the CVS works well and this bug was solved in my \nenvironment.\n   - Tomcat/4.1.27\n   - log4j/1.2.8\n   - WWW browser/IE6\n\n\nIn my environment, this bug can be reproduced by following steps.\n  1. Access to application by HTTPS (ex. https://localhost:8443/my-application/)\n     Tomcat will work well.\n  2. Wait about 5 minutes.\n  3. Access to application by HTTPS again. (click browser's [reload] button \nseveral times)\n     If JSSESupport.class is genuine 4.1.27, LogConfigurationException will be \nprinted in console.\n", "id": 44988, "time": "2003-10-02T08:25:02Z", "creator": "yamagu@ntt-it.co.jp", "creation_time": "2003-10-02T08:25:02Z", "attachment_id": null}, {"count": 17, "attachment_id": null, "bug_id": 22701, "text": "There's another fix I added in 5.0: resetting the context classloader after\nfinishing processing the request. This will likely fix it, and would explain the\nrandomness.\nI'll mark the bug as fixed.", "id": 44989, "time": "2003-10-02T08:33:57Z", "creator": "remm@apache.org", "creation_time": "2003-10-02T08:33:57Z", "tags": [], "is_private": false}, {"count": 18, "tags": [], "bug_id": 22701, "attachment_id": null, "id": 45095, "time": "2003-10-05T17:57:11Z", "creator": "chadhperry@hotmail.com", "creation_time": "2003-10-05T17:57:11Z", "is_private": false, "text": "FYI:\nUsing tomcat: 4.1.27\n\nKeep this in mind:  Seems this issue occurs \u2018more severe' when one uses non \nstandard ports. E.g. When I use port 8080 for the non-SSL and 8443 for SSL I \ncan\u2019t even switch from 8080 to 8443 in IE 6.0.x  - even with the JSSESupport \npatch provided.\n\nHowever, when I use 80 and 443 it seems to work better, but still have \nintermittent logging exceptions. \n\nNote: with the JSSESupport patch and standard ports I have not had it break \nyet. Just wish I could use the 8080, 8443 combo. \uf04c\n"}, {"count": 19, "tags": [], "bug_id": 22701, "attachment_id": null, "text": "I had same problem with 4.1.27. The patch works fine (javac statement is \nmissing commons-logging.jar), and 4.1.29 also fixed the problem.", "id": 46691, "time": "2003-11-03T19:58:45Z", "creator": "hlee@handysoft.com", "creation_time": "2003-11-03T19:58:45Z", "is_private": false}, {"count": 20, "tags": [], "creator": "harry2377@yahoo.com", "attachment_id": null, "id": 72042, "time": "2005-03-09T07:46:49Z", "bug_id": 22701, "creation_time": "2005-03-09T07:46:49Z", "is_private": false, "text": "I encountered this exception under the following environment\n\nSunOS myserver 5.6 Generic_105181-33 sun4u sparc SUNW,Ultra-4\n\njava version \"1.4.0_02\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.0_02-b02)\nJava HotSpot(TM) Client VM (build 1.4.0_02-b02, mixed mode)\n\nTomcat Version         Tomcat/4.1.18-LE-jdk14\nLog4J version          log4j-1.2.7.jar \nStruts version         1.1\n\nNOTE: I haven't configured any SSL connector\n\nAlthough I have the following configuration under Standalone server config.\n\n<Logger className=\"mywork.webframework.catalina.logger.FileLogger\"\n              prefix=\"catalina\" suffix=\"log\"\n              timestamp=\"true\"/>\n\nwhere \"mywork.webframework.catalina.logger.FileLogger\" is my own class which \nextends \"org.apache.catalina.logger.LoggerBase\" and \nimplements \"org.apache.catalina.LifeCycle\"\n\n\nException Stack Trace\n\norg.apache.commons.logging.LogConfigurationException: \norg.apache.commons.logging.LogConfigurationException: \norg.apache.commons.logging.LogConfigurationException: Class \norg.apache.commons.logging.impl.Log4JCategoryLog does not implement Log\n\tat org.apache.commons.logging.impl.LogFactoryImpl.newInstance\n(LogFactoryImpl.java:555)\n\tat org.apache.commons.logging.impl.LogFactoryImpl.getInstance\n(LogFactoryImpl.java:289)\n\tat org.apache.commons.logging.LogFactory.getLog(LogFactory.java:409)\n\tat org.apache.tomcat.util.log.CommonLogHandler.log\n(CommonLogHandler.java:97)\n\tat org.apache.tomcat.util.log.Log.log(Log.java:198)\n\tat org.apache.tomcat.util.log.Log.log(Log.java:192)\n\tat org.apache.tomcat.util.log.Log.log(Log.java:174)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)\nCaused by: org.apache.commons.logging.LogConfigurationException: \norg.apache.commons.logging.LogConfigurationException: Class \norg.apache.commons.logging.impl.Log4JCategoryLog does not implement Log\n\tat org.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor\n(LogFactoryImpl.java:420)\n\tat org.apache.commons.logging.impl.LogFactoryImpl.newInstance\n(LogFactoryImpl.java:548)\n\t... 8 more\nCaused by: org.apache.commons.logging.LogConfigurationException: Class \norg.apache.commons.logging.impl.Log4JCategoryLog does not implement Log\n\tat org.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor\n(LogFactoryImpl.java:416)\n\t... 9 more"}, {"count": 21, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "There are several comments that indicate that this is fixed in later tomcat 4\nreleases. Please test with the latest release before re-opening.\n\nIf the problem does still occur, providing a simple test WAR will greatly\nincrease the chances of any issue getting fixed.", "id": 72151, "time": "2005-03-10T20:17:19Z", "bug_id": 22701, "creation_time": "2005-03-10T20:17:19Z", "is_private": false}]
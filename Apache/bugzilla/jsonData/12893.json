[{"count": 0, "attachment_id": null, "creator": "sigle@21cn.com", "is_private": false, "id": 23192, "time": "2002-09-21T12:41:10Z", "bug_id": 12893, "creation_time": "2002-09-21T12:41:10Z", "tags": [], "text": "I make a symbol link to ntfs directory,and then request file under that \ndirectory.\n\nwhen the file size smaller than 7169 byte,it success\nwhen the file size lager   than 7788 byte,it fail and i get an log message below\n\n[Sat Sep 21 20:04:32 2002] [info] (22)Invalid argument: core_output_filter: \nwriting data to the network\n\nIt was produce by function core_output_filter() in file server/core.c"}, {"count": 1, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "id": 23195, "time": "2002-09-21T14:39:39Z", "bug_id": 12893, "creation_time": "2002-09-21T14:39:39Z", "is_private": false, "text": "Are you able to run strace on an Apache child process and see which syscall is\nfailing when Apache tries to deliver a file from the NTFS partition?   It is\nprobably sendfile(), but I'm not certain.\n\nThanks!"}, {"count": 2, "tags": [], "creator": "sigle@21cn.com", "attachment_id": null, "id": 23216, "time": "2002-09-22T04:59:38Z", "bug_id": 12893, "creation_time": "2002-09-22T04:59:38Z", "is_private": false, "text": "Thanks Jeff Trawick's concern!\n\nI follow the system call use strace,and get two different results below:\n\n[when success:]\naccept(3, {sin_family=AF_INET, sin_port=htons(1117), sin_addr=inet_addr\n(\"192.168.0.7\")}}, [16]) = 8\ngetsockname(8, {sin_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr\n(\"61.144.189.242\")}}, [16]) = 0\nfcntl64(0x8, 0x3, 0, 0x3)               = 2\nfcntl64(0x8, 0x4, 0x802, 0x4)           = 0\nread(8, \"GET /mot_download/test/mv/Downlo\"..., 8000) = 531\ngettimeofday({1032670086, 614055}, NULL) = 0\nstat64\n(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/W2K_OldTV_20425/DRV/wf2kV\ncap.inf\", {st_mode=S_IFREG|0400, st_size=6807, ...}) = 0\nopen(\"/www/.htaccess\", O_RDONLY)        = -1 ENOENT (No such file or directory)\nopen(\"/www/mot_download/.htaccess\", O_RDONLY) = 9\nfstat64(9, {st_mode=S_IFREG|0644, st_size=638, ...}) = 0\nread(9, \"AuthName \\\"Movie Shop\\\" \\nAuthType \"..., 4096) = 638\nread(9, \"\", 4096)                       = 0\nclose(9)                                = 0\nopen(\"/www/mot_download/test/.htaccess\", O_RDONLY) = -1 ENOENT (No such file or \ndirectory)\nopen(\"/www/mot_download/test/mv/.htaccess\", O_RDONLY) = -1 ENOENT (No such file \nor directory)\nopen(\"/www/mot_download/test/mv/Downloads/.htaccess\", O_RDONLY) = -1 ENOENT (No \nsuch file or directory)\nopen(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/.htaccess\", \nO_RDONLY) = -1 ENOENT (No such file or directory)\nopen\n(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/W2K_OldTV_20425/.htaccess\n\", O_RDONLY) = -1 ENOENT (No such file or directory)\nopen\n(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/W2K_OldTV_20425/DRV/.htac\ncess\", O_RDONLY) = -1 ENOENT (No such file or directory)\nopen\n(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/W2K_OldTV_20425/DRV/wf2kV\ncap.inf/.htaccess\", O_RDONLY) = -1 ENOTDIR (Not a directory)\nopen\n(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/W2K_OldTV_20425/DRV/wf2kV\ncap.inf\", O_RDONLY) = 9\nmmap2(NULL, 6807, PROT_READ, MAP_SHARED, 9, 0) = -1 ENODEV (No such device)\nlseek(9, 0, SEEK_SET)                   = 0\nread(9, \";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\"..., 6807) = 6807\nread(8, 0x8142178, 8000)                = -1 EAGAIN (Resource temporarily \nunavailable)\nwritev(8, [{\"HTTP/1.1 200 OK\\r\\nDate: Sun, 22 S\"..., 7121}], 1) = 7121\nwrite(4, \"192.168.0.7 - - [22/Sep/2002:12:\"..., 151) = 151\nclose(9)                                = 0\npoll([{fd=8, events=POLLIN}], 1, 15000) = 0\ngettimeofday({1032670101, 658442}, NULL) = 0\nshutdown(8, 1 /* send */)               = 0\npoll([{fd=8, events=POLLIN}], 1, 2000)  = 0\nclose(8)                                = 0\nread(5, 0xbffff883, 1)                  = -1 EAGAIN (Resource temporarily \nunavailable)\naccept(3, \n\n\n[when fail:]\naccept(3, {sin_family=AF_INET, sin_port=htons(1116), sin_addr=inet_addr\n(\"192.168.0.7\")}}, [16]) = 8\ngetsockname(8, {sin_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr\n(\"61.144.189.242\")}}, [16]) = 0\nfcntl64(0x8, 0x3, 0, 0x3)               = 2\nfcntl64(0x8, 0x4, 0x802, 0x4)           = 0\nread(8, \"GET /mot_download/test/mv/Downlo\"..., 8000) = 531\ngettimeofday({1032670003, 516172}, NULL) = 0\nstat64\n(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/W2K_OldTV_20425/DRV/wf2kx\nbar.sys\", {st_mode=S_IFREG|0400, st_size=9804, ...}) = 0\nopen(\"/www/.htaccess\", O_RDONLY)        = -1 ENOENT (No such file or directory)\nopen(\"/www/mot_download/.htaccess\", O_RDONLY) = 9\nfstat64(9, {st_mode=S_IFREG|0644, st_size=638, ...}) = 0\nread(9, \"AuthName \\\"Movie Shop\\\" \\nAuthType \"..., 4096) = 638\nread(9, \"\", 4096)                       = 0\nclose(9)                                = 0\nopen(\"/www/mot_download/test/.htaccess\", O_RDONLY) = -1 ENOENT (No such file or \ndirectory)\nopen(\"/www/mot_download/test/mv/.htaccess\", O_RDONLY) = -1 ENOENT (No such file \nor directory)\nopen(\"/www/mot_download/test/mv/Downloads/.htaccess\", O_RDONLY) = -1 ENOENT (No \nsuch file or directory)\nopen(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/.htaccess\", \nO_RDONLY) = -1 ENOENT (No such file or directory)\nopen\n(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/W2K_OldTV_20425/.htaccess\n\", O_RDONLY) = -1 ENOENT (No such file or directory)\nopen\n(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/W2K_OldTV_20425/DRV/.htac\ncess\", O_RDONLY) = -1 ENOENT (No such file or directory)\nopen\n(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/W2K_OldTV_20425/DRV/wf2kx\nbar.sys/.htaccess\", O_RDONLY) = -1 ENOTDIR (Not a directory)\nopen\n(\"/www/mot_download/test/mv/Downloads/W2K_OldTV_020425/W2K_OldTV_20425/DRV/wf2kx\nbar.sys\", O_RDONLY) = 9\nsetsockopt(8, SOL_TCP, TCP_NODELAY, [0], 4) = 0\nsetsockopt(8, SOL_TCP, TCP_CORK, [1], 4) = 0\nwritev(8, [{\"HTTP/1.1 200 OK\\r\\nDate: Sun, 22 S\"..., 314}], 1) = 314\nsendfile(8, 9, [0], 9804)               = -1 EINVAL (Invalid argument)\nsetsockopt(8, SOL_TCP, TCP_CORK, [0], 4) = 0\nsetsockopt(8, SOL_TCP, TCP_NODELAY, [1], 4) = 0\nread(8, 0x81482b0, 8000)                = -1 EAGAIN (Resource temporarily \nunavailable)\nwrite(4, \"192.168.0.7 - - [22/Sep/2002:12:\"..., 151) = 151\nclose(9)                                = 0\npoll([{fd=8, events=POLLIN}], 1, 15000) = 0\ngettimeofday({1032670018, 538115}, NULL) = 0\nshutdown(8, 1 /* send */)               = 0\npoll([{fd=8, events=POLLIN, revents=POLLIN|POLLHUP}], 1, 2000) = 1\nread(8, \"\", 512)                        = 0\nclose(8)                                = 0\nread(5, 0xbffff923, 1)                  = -1 EAGAIN (Resource temporarily \nunavailable)\naccept(3, \n\n"}, {"count": 3, "tags": [], "text": "In the first case, we didn't try sendfile.  In the second case, we did, and\napparently there is some characteristic of your NTFS filesystem that\nprevents sendfile() from working.\n\nsendfile(8, 9, [0], 9804)               = -1 EINVAL (Invalid argument)\n\nI think your workaround is to specify \n\n  --without-sendfile \n\non ./configure invocation.  That will tell APR (and thus Apache) not to \nuse sendfile().\n\nLong term, one of the developers needs to recreate the problem, verify that\nsendfile() simply can't be used with some filesystems, and add a directive\nfor sendfile such as EnableSendfile (analogous to the existing EnableMMap \ndirective).\n", "is_private": false, "id": 23871, "creation_time": "2002-10-04T00:02:41Z", "time": "2002-10-04T00:02:41Z", "creator": "trawick@apache.org", "bug_id": 12893, "attachment_id": null}, {"count": 4, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "is_private": false, "id": 24670, "time": "2002-10-17T01:38:08Z", "bug_id": 12893, "creation_time": "2002-10-17T01:38:08Z", "text": "A directive has been added to disable SendFile on a per-dirctory basis."}]
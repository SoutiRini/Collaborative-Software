[{"count": 0, "tags": [], "creator": "harald.dunkel@aixigo.de", "text": "I am running httpd on a generated httpd.conf file. If the configuration is changed while httpd is running, and then loaded using\n\n\tif httpd -f /my/httpd.conf -t; then\n\t\thttpd -f /my/httpd.conf -k graceful || exit_with_error\n\tfi\n\nthen the exit value of the graceful restart is 0, even though error_log says\n\n[Thu Sep 03 09:12:26 2009] [warn] Init: Session Cache is not configured [hint: SSLSessionCache]\n[Thu Sep 03 09:12:26 2009] [warn] pid file /tomcat/httpd/logs/httpd.pid overwritten -- Unclean shutdown of previous Apache run?\n[Thu Sep 03 09:12:26 2009] [notice] Apache/2.2.13 (Unix) mod_ssl/2.2.13 OpenSSL/0.9.8k configured -- resuming normal operations\n[Thu Sep 03 09:12:43 2009] [notice] Graceful restart requested, doing restart\n(98)Address already in use: make_sock: could not bind to address xx.xx.xx.xx:80\nno listening sockets available, shutting down\nUnable to open logs\n\nThe suggested workaround to check the semantics (\"start httpd as non-root\") doesn't work in scripts, because this _always_ fails either due to bind, or due to the attempted access to reserved port 80/tcp, or it succeeds and keeps an unwanted httpd running with the wrong uid.\n\nI don't expect any miracles, but the exit value of \"httpd -k graceful\" _should_ show whether an httpd with the new configuration is running. Reliability is highly important for us. Silently dying Apaches is a _huge_ problem in our environment.", "id": 130124, "time": "2009-09-03T00:42:56Z", "bug_id": 47778, "creation_time": "2009-09-03T00:42:56Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 47778, "attachment_id": null, "id": 130128, "time": "2009-09-03T06:17:49Z", "creator": "covener@gmail.com", "creation_time": "2009-09-03T06:17:49Z", "is_private": false, "text": "The httpd that's running at this point, to send the graceful restart signal, can't predict/inspect anything about the restarting httpd.  \n\nA 0 exit code means the restart signal was sent, and checking/polling for the status of your httpd is beyond the scope of -k graceful."}, {"count": 2, "text": "I Understand, but the bug is that this procedure is not reliable IRL. Running an httpd I don't want to know whether the signaling mechanism worked, but whether Apache is still alive.\n\nI thought you would be interested in improving Apache? Can't you imagine that the restarting httpd and the running httpd perform some kind of IPC other than just a unidirectional signal?\n\nPlease reconsider.\n\n\nMany thanx\n\nHarri", "bug_id": 47778, "attachment_id": null, "id": 130135, "time": "2009-09-03T07:51:54Z", "creator": "harald.dunkel@aixigo.de", "creation_time": "2009-09-03T07:51:54Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "covener@gmail.com", "text": "Marking as enhancement as the exit code is reasonable, patches welcome.", "id": 130136, "time": "2009-09-03T08:04:48Z", "bug_id": 47778, "creation_time": "2009-09-03T08:04:48Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "poirier@pobox.com", "text": "Looks like this was meant to be enhancement, not blocker.", "id": 130168, "time": "2009-09-06T10:44:58Z", "bug_id": 47778, "creation_time": "2009-09-06T10:44:58Z", "is_private": false, "attachment_id": null}]
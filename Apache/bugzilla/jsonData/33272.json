[{"count": 0, "tags": [], "bug_id": 33272, "attachment_id": null, "id": 70191, "time": "2005-01-27T17:39:19Z", "creator": "frederic.leger@i-bp.banquepopulaire.fr", "creation_time": "2005-01-27T17:39:19Z", "is_private": false, "text": "When used as a reverse proxy and having disk cachin enabled, the page is only \ncached if LogLevel is at least notice.\n\nIn addition, the firt page asked is cached and another request makes the page \nerased from cache.\n\nHere is a way of reproduce:\n\ncurl -H \"Pragma:\" -H \"User-Agent: XMLHTTP_Compress\" -v \nhttp://127.0.0.1:82/Vxxxxxxxxxxxxxx/ibp/ate/skin/default/js/common/collection/Se\nt.js\n\ncurl -H \"Pragma:\" -H \"Accept-Encoding: gzip, deflate\" -H \"User-Agent: \nMozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; .NET CLR 1.0.3705)\" -v \nhttp://127.0.0.1:82/Vxxxxxxxxxxxxxx/ibp/ate/skin/default/js/common/collection/Se\nt.js\n\n\nUsing this two exemples in a loop makes the Reverse Proxy not stopping to \ndownload the same page from remote server.\n\n\nhttpd.conf\n==========================================================================\nServerRoot \"c:/eqxpa2\"\nPidFile logs/httpd.pid\nListen 82\n\n\n# pour debug\nLogLevel info\n\nTimeout 300\nKeepAlive On\nMaxKeepAliveRequests 10000\nKeepAliveTimeout 15\n\n<IfModule mpm_winnt.c>\n\tThreadsPerChild 250\n\tMaxRequestsPerChild  0\n</IfModule>\n\nLoadModule access_module modules/mod_access.so\nLoadModule sspi_auth_module modules/mod_auth_sspi.so\nLoadModule cache_module modules/mod_cache.so\nLoadModule disk_cache_module modules/mod_disk_cache.so\nLoadModule log_config_module modules/mod_log_config.so\nLoadModule proxy_module modules/mod_proxy.so\nLoadModule proxy_http_module modules/mod_proxy_http.so\nLoadModule ssl_module modules/mod_ssl.so\nLoadModule rewrite_module modules/mod_rewrite.so\nLoadModule include_module modules/mod_include.so\nLoadModule headers_module modules/mod_headers.so\nLoadModule setenvif_module modules/mod_setenvif.so\n\n### Section 2: 'Main' server configuration\nSSLSessionCache \"dbm:c:/eqxpa2/logs/ssl_gcache_data\"\n\n### Section 3: Virtual Hosts\n<VirtualHost *:82>\n\tInclude conf/servername.conf\n\tErrorDocument 502 \"<HTML><HEAD><TITLE>Error_502</TITLE><STYLE><!-P\n{color:#ffcc00} H2{color:#ffcc00} H3{color:#a2c8ea}--></STYLE></HEAD><BODY \nBGCOLOR='#2167a9' ONLOAD='if(isNaN(window.clientInformation.retryonerr))\n{window.clientInformation.retryonerr=1;window.location.replace\n(window.location.href)}else{if(window.clientInformation.retryonerr<5)\n{window.clientInformation.retryonerr=\n((window.clientInformation.retryonerr+1));window.location.replace\n(window.location.href)}};'><TABLE COLS=1 WIDTH=100% BORDER=0><TR \nBGCOLOR='#962133'><TD><H2>Echec de l'op\u00e9ration</H2><H3>Une erreur technique est \nsurvenue.</H3><H3>Veuillez recommencer l'op\u00e9ration.</H3><p>Information \u00e0 \ndestination du support technique :</p><p>Erreur proxy 502 (composant EqxPA) sur \nserveur Popix<p><H3></H3></TD></TR></TABLE></BODY></HTML>\"\n\tRequestHeader add TimeReq \"%t\"\n\tLogFormat \"%{%Y-%m-%d %T}t %{TimeReq}i %D %h %u %{JSESSIONID}C %{rl-\nsticky-key}C %{rlnclientipaddr}i %>s %r %B %{Age}o \\\"%{ate-taskInfoOID}o\\\" \\\"%\n{ate-taskOID}o\\\" \\\"%{ate-processId}o\\\" \\\"%{ate-processMapStageId}o\\\" \\\"%{ate-\ndialogId}o\\\" \\\"%{ate-dialogMapStageId}o\\\" \\\"%{ate-dialogActionPerformed}o\\\" \\\"%\n{ate-taskTerminatedList}o\\\" \\\"%{ate-taskTerminated}o\\\" \\\"%{ate-\nlastUserDialogAction}o\\\"\" proxylog\n\tCustomLog \"|'c:/eqxpa2/bin/rotatelogs.exe' 'd:/eqxpalogs/proxy%Y%m%\nd.log' 86400\" proxylog\n\t<LocationMatch HttpSubscriber>\n\t\tAllowOverride None\n\t\tOptions None\n\t\tOrder allow,deny\n\t\tAllow from all\n\t\tAuthName \"EqxPA POPIX\"\n\t\tAuthType SSPI\n\t\tSSPIAuth on\n\t\tSSPIAuthoritative on\n\t\trequire valid-user\n\t\t#require group Defaut\n\t</LocationMatch>\n\n\tSSLProxyEngine on\n\tSSLProxyCACertificateFile conf/keycert/ibwacexx.ssc\n\t#SSLProxyMachineCertificateFile conf/keycert/local.cer\n\n\tProxyVia on\n\tRewriteEngine on\n\tInclude conf/cible_ecole.conf\n\tInclude conf/cible.conf\n\n#\t<IfModule mod_cache.c>\t\t\n\n\t\t#CacheDisable /equinoxe/ibp/ate/portal/index.hta\n\t\tCacheEnable disk /\n\t\t\n\t\t#CacheDisable /eqx_ecole\n\t\t#CacheMaxExpire 604800\n\t\t#CacheDefaultExpire 3600\n\t\t#CacheLastModifiedFactor 2.0\n#\t</IfModule>\n\t\n\n\tCacheSize 50000\n\tCacheRoot \"D:/EqxPACache\"\n\tCacheDirLength 1\n\tCacheDirLevels 1\n\n\t\n\n\tSetEnvIf Request_URI \"\\.css$\"  force-no-vary\n\tSetEnvIf Request_URI \"\\.gif$\"  force-no-vary\n\tSetEnvIf Request_URI \"\\.hta$\"  force-no-vary\n\tSetEnvIf Request_URI \"\\.html$\" force-no-vary\n\tSetEnvIf Request_URI \"\\.jpg$\"  force-no-vary\n\tSetEnvIf Request_URI \"\\.js$\"   force-no-vary=1\n\tSetEnvIf Request_URI \"\\.vbs$\"  force-no-vary\n\n\n\t\n\n</VirtualHost>"}, {"count": 1, "attachment_id": null, "bug_id": 33272, "text": "Seems that the headers files cached are different in the start of the file \n(binary ?).\n\nThe debug log shows these events:\n\n[Tue Feb 01 12:25:31 2005] [info] disk_cache: Storing URL \nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/default/js/common/collection/Se\nt.js?\n[Tue Feb 01 12:25:31 2005] [debug] mod_cache.c(613): cache: Caching url: \nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/default/js/common/collection/Set.js\n[Tue Feb 01 12:25:31 2005] [debug] mod_disk_cache.c(614): disk_cache: Stored \nheaders for URL xxxxxxxxxxxxx/default/js/common/collection/Set.js?\n[Tue Feb 01 12:25:31 2005] [debug] mod_disk_cache.c(685): disk_cache: Body for \nURL xxxxxxxxxxxxxxxxxxxxxxx/default/js/common/collection/Set.js? cached.\n[Tue Feb 01 12:25:31 2005] [debug] proxy_http.c(943): proxy: end body send\n[Tue Feb 01 12:25:39 2005] [debug] mod_cache.c(114): incoming request is asking \nfor a uncached version of \nxxxxxxxxxxxxxxxxxxxxxxxxxxxx/default/js/common/collection/Set.js, but we know \nbetter and are ignoring it\n[Tue Feb 01 12:25:39 2005] [debug] mod_disk_cache.c(400): disk_cache: Recalled \ncached URL info header \nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/default/js/common/collection/Set.js?\n[Tue Feb 01 12:25:39 2005] [debug] mod_disk_cache.c(464): disk_cache: Recalled \nheaders for URL \nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/default/js/common/collection/Set.js?\n[Tue Feb 01 12:25:40 2005] [info] cache_select_url(): Vary header mismatch - \nCached document cannot be used. \\n\n[Tue Feb 01 12:25:40 2005] [debug] proxy_http.c(66): proxy: HTTP: \ncanonicalising URL \nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/default/js/common/collection/S\net.js\n[Tue Feb 01 12:25:40 2005] [debug] mod_proxy.c(416): Trying to run \nscheme_handler", "id": 70301, "time": "2005-02-01T14:33:11Z", "creator": "frederic.leger@i-bp.banquepopulaire.fr", "creation_time": "2005-02-01T14:33:11Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 33272, "attachment_id": null, "text": "This doesn't seem like a bug, but rather the effect of the HTTP Vary Header?", "id": 75848, "time": "2005-06-03T00:40:30Z", "creator": "chip@force-elite.com", "creation_time": "2005-06-03T00:40:30Z", "is_private": false}, {"count": 3, "attachment_id": null, "creator": "slive@apache.org", "is_private": false, "id": 83450, "time": "2005-12-08T20:00:24Z", "bug_id": 33272, "creation_time": "2005-12-08T20:00:24Z", "tags": [], "text": "Vary handling has been much improved in 2.2.  Please try there."}, {"count": 4, "tags": [], "creator": "dodger_web@yahoo.fr", "attachment_id": null, "id": 86402, "time": "2006-03-02T15:55:25Z", "bug_id": 33272, "creation_time": "2006-03-02T15:55:25Z", "is_private": false, "text": "Yes handling was improved but the stange behavior is still here on win32 see \nthis bug: http://issues.apache.org/bugzilla/show_bug.cgi?id=38827, i have \nicluded much details."}]
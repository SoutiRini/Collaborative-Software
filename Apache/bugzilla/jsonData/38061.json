[{"count": 0, "tags": [], "bug_id": 38061, "text": "I obtain an error configuring an errorHandler using a property file.\nIf use a xml file, everything is right.\n\nI noticed tha the problem is in the \"org.apache.log4j.config.PropertySetter\" in\n\"convertArg\" method.\nThe \"if\" sequence don't foreseen to manage the errorHandler parameter\n\nprotected Object convertArg(String val, Class type)\n{\n\tif (val == null)\n\t\treturn null;\n\n\tString v = val.trim();\n\tif (String.class.isAssignableFrom(type))\n\t{\n\t\treturn val;\n\t} else if (Integer.TYPE.isAssignableFrom(type))\n\t{\n\t\treturn new Integer(v);\n\t} else if (Long.TYPE.isAssignableFrom(type))\n\t{\n\t\treturn new Long(v);\n\t} else if (Boolean.TYPE.isAssignableFrom(type))\n\t{\n\t\tif (\"true\".equalsIgnoreCase(v))\n\t\t{\n\t\t\treturn Boolean.TRUE;\n\t\t} else if (\"false\".equalsIgnoreCase(v))\n\t\t{\n\t\t\treturn Boolean.FALSE;\n\t\t}\n\t} else if (Priority.class.isAssignableFrom(type))\n\t{\n\t\treturn OptionConverter.toLevel(v, (Level) Level.DEBUG);\n\t}\n\t/**************************************************************************/\n\t/* BUG FIX                                                                */\n\telse if(ErrorHandler.class.isAssignableFrom(type)) \n\t{ \n\t\t// I copied this line from \"org.apache.log4j.xml.DOMCOnfigurator\" \n\t\t// (method: \"parseErrorHandler\")\n\t\treturn OptionConverter.instantiateByClassName(val,\n\t\t\torg.apache.log4j.spi.ErrorHandler.class,null); \n\t}\n\t/**************************************************************************/\n\treturn null;\n}\n\nBut at the moment it is not possible set rootLogger, any other loggers or backup\nappender.\nIs these future enhancement? Can post the code?\n\nLuca Falcon\n\nMy environment:\n\nthe log4j version is:\n---------------------------------------------------------------------------------------------------\n1.2.13\n\nthis is my log4j.properties:\n---------------------------------------------------------------------------------------------------\nlog_dir=D:/temp/log\nlog4j.debug=true\n\nlog4j.rootLogger                                 = INFO, systemOut\n\nlog4j.appender.systemOut                          = org.apache.log4j.FileAppender\nlog4j.appender.systemOut.errorHandler             =\norg.apache.log4j.varia.FallbackErrorHandler\nlog4j.appender.systemOut.Threshold                = INFO\nlog4j.appender.systemOut.File                     = ${log_dir}/system.log\nlog4j.appender.systemOut.layout                   = org.apache.log4j.PatternLayout\nlog4j.appender.systemOut.layout.ConversionPattern = %d{HH:mm:ss,SSS} %-5p [%t] -\n%m%n\n---------------------------------------------------------------------------------------------------\n\nthis is the output:\n---------------------------------------------------------------------------------------------------\nlog4j:WARN Failed to set property [errorHandler] to value\n\"org.apache.log4j.varia.FallbackErrorHandler\". \nlog4j: Parsing for [root] with value=[INFO, systemOut].\nlog4j: Level token is [INFO].\nlog4j: Category root set to INFO\nlog4j: Parsing appender named \"systemOut\".\nlog4j: Parsing layout options for \"systemOut\".\nlog4j: Setting property [conversionPattern] to [%d{HH:mm:ss,SSS} %-5p [%t] - %m%n].\nlog4j: End of parsing for \"systemOut\".\nlog4j: Setting property [file] to [D:/temp/log/system.log].\nlog4j: Setting property [threshold] to [INFO].\nlog4j: setFile called: D:/temp/log/system.log, true\nlog4j: setFile ended\nlog4j: Parsed \"systemOut\" options.\nlog4j: Finished configuring.\n---------------------------------------------------------------------------------------------------\n\nthis is my test class:\n---------------------------------------------------------------------------------------------------\nimport org.apache.log4j.Logger;\n\npublic class Test\n{\t\n\tpublic static void main(String[] args) throws Exception\n\t{\t\n\t\tLogger logger = Logger.getRootLogger();\n\t\tlogger.error(\"test message\");\n\t}\n}\n---------------------------------------------------------------------------------------------------", "id": 84033, "time": "2005-12-28T12:05:40Z", "creator": "lfalcon@tiscali.it", "creation_time": "2005-12-28T12:05:40Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 38061, "text": "Committed fix in rev 823021.\n\nThe patch original suggested was sufficient to create the error handler, but not to configure it.  Effective use of error handler required being able to specify the attached logger and appender which the generic reflection code in PropertySetter does not handle.", "id": 130960, "time": "2009-10-07T22:26:31Z", "creator": "carnold@apache.org", "creation_time": "2009-10-07T22:26:31Z", "is_private": false, "attachment_id": null}]
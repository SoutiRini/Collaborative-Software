[{"count": 0, "tags": [], "bug_id": 12598, "is_private": false, "text": "Recently due to server loads I decided to turn on KeepAlives for my running\nApache 1.3.26 to help lower some of the loads.\nSince doing this I have noticed that I get alot of processes stuck for extremely\nlong times in state Keepalive per server-status. Currently there is one with an\nSS marking of 1437 and going up.\nEventually Apache will stop responding and I'll have restart it to clear the\nstale keepalives.\nSoftware is Apache 1.3.26, PHP 4.2.2, Ben-SSL 1.48, Mod_Perl 1.27, Mod_gzip\n1.3.19.1a. Linux 2.2.20\nReducing it down to just Apache and PHP and it continues to happen.\nRelevant httpd.conf settings:\nTimeout 300\nKeepAlive On\nKeepAliveTimeout 15\nMaxKeepAliveRequests 100\nOne trend that I have noticed from checking the logs is that the browser making\nthe request is always either MSIE 5.5 or MSIE 6.0. Mozilla doesn't seem to have\nthis problem. Could this be another Microsoft browser problem?\nAn strace of the hung processes produces:\nread(3,\nAny suggestions on correcting the behaviour? Or what other info is needed?", "id": 22771, "time": "2002-09-12T21:18:24Z", "creator": "wallp@earthlink.net", "creation_time": "2002-09-12T21:18:24Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 12598, "attachment_id": null, "id": 23045, "time": "2002-09-18T15:50:23Z", "creator": "jim@apache.org", "creation_time": "2002-09-18T15:50:23Z", "is_private": false, "text": "We will look into it... in the meantime, maybe using browsermatch to downgrade those \nMSIE requests to http/1.0 will provide some temporary help."}, {"count": 2, "tags": [], "bug_id": 12598, "attachment_id": null, "id": 23136, "time": "2002-09-20T06:08:33Z", "creator": "wallp@earthlink.net", "creation_time": "2002-09-20T06:08:33Z", "is_private": false, "text": "Browsermatch works for a little bit but I still have some MSIE browsers some how\nhanging Apache processes in keepalive. Even when using settings like this,\n\nBrowserMatch MSIE nokeepalive downgrade-1.0\nBrowserMatch \"^Mozilla/4.0\" nokeepalive downgrade-1.0 force-response-1.0\n\nI'm currently just running it with KeepAlive Off so that I don't have to restart\nApache every 6 hours to clear the hung processes."}, {"attachment_id": null, "tags": [], "creator": "joe.marlow@dynamex.com", "text": "has this been resolved?  is there a workaround?\n", "count": 3, "id": 39694, "time": "2003-06-30T19:52:16Z", "bug_id": 12598, "creation_time": "2003-06-30T19:52:16Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 12598, "attachment_id": null, "id": 49592, "time": "2003-12-23T10:45:30Z", "creator": "stas-apache@zend.com", "creation_time": "2003-12-23T10:45:30Z", "is_private": false, "text": "I am experiencing it now with Apache/1.3.27, PHP/4.3.3 mod_ssl/2.8.12 on Linux.\nA lot of connections stuck in keepalive, effectively disabling the server."}, {"attachment_id": 9998, "tags": [], "creator": "hanafey@dna.es.dupont.com", "text": "Created attachment 9998\nKeepAlive makes mutiple CGI request very slow", "count": 5, "id": 50686, "time": "2004-01-17T23:38:48Z", "bug_id": 12598, "creation_time": "2004-01-17T23:38:48Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "trawick@apache.org", "text": "Regarding last update from Mike Hanafey:\nYour issue is what Bill Stoddard fixed in 1.3.28, though the initial fix caused\nzombies with suexec :(  1.3.29 has all of that resolved.\n\nRegarding the other reports:\n\nDoes anybody have Apache 1.3 processes stuck in keepalive without using SSL?\n", "count": 6, "id": 50688, "time": "2004-01-18T01:49:32Z", "bug_id": 12598, "creation_time": "2004-01-18T01:49:32Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 12598, "attachment_id": null, "text": "found this same problem as well, able to reproduce always.\n(linux) 1.3.29, mod_ssl-2.8.16-1.3.29, php 4.3.4\n\nI didn't try the Browsermatch directives here but I don't believe it will help \nas there is no further traffic at all between the \"stuck\" ip and the server \nonce in this state, other than tcp keepalives which is how the connection can \nstay established forever or else the tcp keepalive timeout in the kernel would \nclose it. (Give me a reason to try disabling keepalives or something though and \nI will but I'm working off a production system and can't play much now that \nit's working).\n\nSIGALRM to the child doesn't do anything, SIGUSR2 kills it, so the work around \nI've had to do is change this signal to alrm_handler in child_main() in \nhttp_main.c and not define OPTIMIZE_TIMEOUTS.  So, I don't really like this \nbecause it means every time a child reaches KeepAliveTimeout seconds, it dies \nand apache is pretty busy always spawning new children.  (And the error log has \na lot of messages [notice] child pid 28392 exit signal Alarm clock (14) :)\n\nAlso, yes mod_ssl is loaded but the hung processes I've seen were all serving \nfrom http vhosts.  Is it mod_ssl or libphp4 intercepting the SIGALRM?", "id": 52168, "time": "2004-02-11T23:31:19Z", "creator": "mike.bethune@fusepoint.com", "creation_time": "2004-02-11T23:31:19Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 12598, "attachment_id": null, "text": "Server Version: Apache/1.3.31 (Unix) mod_gzip/1.3.26.1a mod_ssl/2.8.17 \nOpenSSL/0.9.6m PHP/4.3.6\nServer Built: May 31 2004 01:31:05\n\nI am still having this problem.  I have a low traffic server (~3000 hits/day) \nwhich has been up for 21 days and has 5 processes that will not leave the \nKeepalive state.  The longest of which has been in Keepalive for 1745052 \nseconds (just over 20 days).  The kernel isn't timing the connection out \nbecause the client is STILL SENDING KEEPALIVES!  I've done quite a bit of \ninvestigation and can't find anything special about the sessions that hang up \n(some are basic html, some image, and some php requests).  I can't find any \ninformation about this with the 1.3.31 build so figured I'd bring it up here.", "id": 68179, "time": "2004-12-09T13:55:36Z", "creator": "dreed@apmsafe.com", "creation_time": "2004-12-09T13:55:36Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "s.serafini@webforma.it", "text": "I also have this problem, but I've found (at least in my case) that it is caused\nby mod-ssl.\n\nIf I enable mod-ssl, this bug reveals itself about once a week; but if I disable\nmod-ssl (with the remaining apache configuration untouched), everything goes ok.\n\nNow, how can we resolve this?\n", "count": 9, "id": 80889, "time": "2005-10-07T10:42:57Z", "bug_id": 12598, "creation_time": "2005-10-07T10:42:57Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 12598, "attachment_id": null, "id": 80890, "time": "2005-10-07T10:51:54Z", "creator": "s.serafini@webforma.it", "creation_time": "2005-10-07T10:51:54Z", "is_private": false, "text": "(In reply to comment #9)\n> If I enable mod-ssl, this bug reveals itself about once a week; but if I disable\n> mod-ssl (with the remaining apache configuration untouched), everything goes ok.\n\nI forgot to tell: this bug reveals itself about once a week enabling mod-ssl,\nalso without using it! Seems to be the simple presence of mod_ssl that triggers\nthis bug..."}, {"count": 11, "tags": [], "bug_id": 12598, "is_private": false, "text": "Although I recently also upgraded several low-level Debian packages (libc, \nssl, etc), last week I tried to enable SSL for my webserver for the first \ntime, and since, I also experience regular \"hangs\" of Apache, when it stops \nresponding to port 80. Any request on port 80 is no longer served, and the \nrequesting client also does not get any \"denied\" type of message. \n\nOver here, it happens roughly once a day.\n\n[Apache/1.3.34 (Debian) PHP/4.3.10-2 mod_ssl/2.8.25 OpenSSL/0.9.8a DAV/1.0.3 \nconfigured]", "id": 84012, "time": "2005-12-27T13:31:19Z", "creator": "herman@ozuzo.net", "creation_time": "2005-12-27T13:31:19Z", "attachment_id": null}]
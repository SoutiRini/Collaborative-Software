[{"count": 0, "tags": [], "creator": "jie.han@163.com", "text": "Created attachment 22833\nI put all PowerPoint shapes in the slide\n\nWhen I use the following code to export the shape to jpeg file, I trace the process and if the shape type is ShapeGroup in the Picuture's draw function \nthe getPictureData() function always get null value\n\n--------------------------\npublic void draw(Graphics2D graphics){\n        AffineTransform at = graphics.getTransform();\n        ShapePainter.paint(this, graphics);\n \n        PictureData data = getPictureData();\n        data.draw(graphics, this);\n\n        graphics.setTransform(at);\n    }\n\n\nBelow is my code:\n---------------------------\nimport java.awt.Color;\nimport java.awt.Graphics2D;\nimport java.awt.Rectangle;\nimport java.awt.image.BufferedImage;\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileNotFoundException;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\n\nimport org.apache.poi.hslf.model.AutoShape;\nimport org.apache.poi.hslf.model.Freeform;\nimport org.apache.poi.hslf.model.Line;\nimport org.apache.poi.hslf.model.MovieShape;\nimport org.apache.poi.hslf.model.OLEShape;\nimport org.apache.poi.hslf.model.Picture;\nimport org.apache.poi.hslf.model.Shape;\nimport org.apache.poi.hslf.model.ShapeGroup;\nimport org.apache.poi.hslf.model.SimpleShape;\nimport org.apache.poi.hslf.model.Slide;\nimport org.apache.poi.hslf.model.Table;\nimport org.apache.poi.hslf.model.TextBox;\nimport org.apache.poi.hslf.usermodel.PictureData;\nimport org.apache.poi.hslf.usermodel.SlideShow;\n\nimport com.sun.image.codec.jpeg.ImageFormatException;\nimport com.sun.image.codec.jpeg.JPEGCodec;\nimport com.sun.image.codec.jpeg.JPEGImageEncoder;\n\npublic class TestShape {\n\tpublic static void main(String... strings) {\n\t\tString path = \"./src/testfiles/demo1.ppt\";\n\t\ttry {\n\t\t\tInputStream is = new FileInputStream(path);\n\t\t\tSlideShow ppt = new SlideShow(is);\n\t\t\tSlide[] slides = ppt.getSlides();\n\t\t\tint i = 0;\n\t\t\t// PPTXMLDump xdump = new PPTXMLDump();\n\t\t\tint shpCount = 0;\n\t\t\tfor (Slide slide : slides) {\n\n\t\t\t\tfor (Shape shp : slide.getShapes()) {\n\t\t\t\t\tRectangle anchor = shp.getAnchor();\n\t\t\t\t\tBufferedImage img = new BufferedImage(anchor.width + 1,\n\t\t\t\t\t\t\tanchor.height + 1, BufferedImage.TYPE_INT_RGB);\n\t\t\t\t\tGraphics2D graphics = img.createGraphics();\n\n\t\t\t\t\tgraphics.translate(-anchor.x, -anchor.y);\n\t\t\t\t\t\n\t\t\t\t\tif (shp instanceof Line) {\n\t\t\t\t\t\t((Line) shp).draw(graphics);\n\t\t\t\t\t} else if (shp instanceof Picture) {\n\t\t\t\t\t\t((Picture) shp).draw(graphics);\n\t\t\t\t\t} else if (shp instanceof TextBox) {\n\t\t\t\t\t\t((TextBox) shp).draw(graphics);\n\t\t\t\t\t} else if (shp instanceof MovieShape) {\n\t\t\t\t\t\t((MovieShape) shp).draw(graphics);\n\t\t\t\t\t} else if (shp instanceof OLEShape) {\n\t\t\t\t\t\t((OLEShape) shp).draw(graphics);\n\t\t\t\t\t} else if (shp instanceof Table) {\n\t\t\t\t\t\t((Table) shp).draw(graphics);\n\t\t\t\t\t} else if (shp instanceof Freeform) {\n\t\t\t\t\t\t((Freeform) shp).draw(graphics);\n\t\t\t\t\t} else if (shp instanceof AutoShape) {\n\t\t\t\t\t\t((AutoShape) shp).draw(graphics);\n\t\t\t\t\t} else if (shp instanceof ShapeGroup) {\n\t\t\t\t\t\t((ShapeGroup) shp).draw(graphics);\n\t\t\t\t\t}\n\t\t\t\t\tTestShape.writeToFile(\"./src/shape/slide-\"\n\t\t\t\t\t\t\t + shp.getShapeId() + \".jpg\", img);\n\t\t\t\t\tSystem.out.println(shp.getClass().getName());\n\t\t\t\t\t// }\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (Exception ex) {\n\t\t\tSystem.out.println(ex.toString());\n\t\t}\n\t}\n\n\tpublic static void writeToFile(String fileName, BufferedImage img) {\n\t\ttry {\n\t\t\tFile file = new File(fileName);\n\t\t\tFileOutputStream out;\n\t\t\tout = new FileOutputStream(file);\n\t\t\tJPEGImageEncoder encoder = JPEGCodec.createJPEGEncoder(out);\n\t\t\tcom.sun.image.codec.jpeg.JPEGEncodeParam param = encoder\n\t\t\t\t\t.getDefaultJPEGEncodeParam(img);\n\t\t\tparam.setQuality(2f, true);\n\t\t\tencoder.setJPEGEncodeParam(param);\n\t\t\tencoder.encode(img);\n\t\t} catch (FileNotFoundException e) {\n\t\t\te.printStackTrace();\n\t\t} catch (ImageFormatException e) {\n\t\t\te.printStackTrace();\n\t\t} catch (IOException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n}", "id": 122208, "time": "2008-11-05T07:30:15Z", "bug_id": 46153, "creation_time": "2008-11-05T07:30:15Z", "is_private": false, "attachment_id": 22833}, {"count": 1, "tags": [], "creator": "yegor@dinom.ru", "text": "Try the latest svn build. Your code works fine with it.\n\nYegor", "id": 122535, "time": "2008-11-16T05:44:01Z", "bug_id": 46153, "creation_time": "2008-11-16T05:44:01Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "maciej-apache@killer-robot.net", "attachment_id": null, "text": "Accessing a URI rewritten with the [P] flag by a proxy set up to require\nauthentication yields a 401 (Authentication Required) and not a 407 (Proxy\nAuthentication Required) response. More generally, mod_rewrite flags every [P]\nrequest it processes as a PROXYREQ_REVERSE; when the request in question is\nalready being handled through the normal proxy, it is more appropriate to leave\nit as PROXYREQ_PROXY. The patch below (against 2.0.49) fixes the issue for me.\n\n\n--- httpd-2.0.49.old/modules/mappers/mod_rewrite.c      Mon Feb  9 14:53:18 2004\n+++ httpd-2.0.49/modules/mappers/mod_rewrite.c  Thu Jun 17 13:34:33 2004\n@@ -1202,8 +1202,11 @@\n                                           \"?\", r->args, NULL);\n             }\n \n-            /* now make sure the request gets handled by the proxy handler */\n-            r->proxyreq = PROXYREQ_REVERSE;\n+            /* now make sure the request gets handled by the proxy handler.\n+               Forward-proxy requests shouldn't get relabeled */\n+            if(PROXYREQ_PROXY != r->proxyreq)\n+               r->proxyreq = PROXYREQ_REVERSE;\n+\n             r->handler  = \"proxy-server\";\n \n             rewritelog(r, 1, \"go-ahead with proxy request %s [OK]\",", "id": 59487, "time": "2004-06-18T17:02:19Z", "bug_id": 29678, "creation_time": "2004-06-18T17:02:19Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "nd@perlig.de", "text": "Fixed already (2.0.50-dev) with bug 28125.", "count": 1, "id": 59489, "time": "2004-06-18T17:37:27Z", "bug_id": 29678, "creation_time": "2004-06-18T17:37:27Z", "is_private": false}]
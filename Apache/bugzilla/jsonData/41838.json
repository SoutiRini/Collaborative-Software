[{"count": 0, "tags": [], "bug_id": 41838, "is_private": false, "text": "When many concurrent threads try to connect to slide using the same user\naccount, an infinite loop may occur in HashMap.put or HashMap.transfer methods.\n\nStack trace of some threads inside JConsole :\n\nName: http-8095-Processor36\nState: RUNNABLE\nTotal blocked: 142  Total waited: 14\n\nStack trace: \njava.util.HashMap.put(HashMap.java:385)\norg.apache.slide.store.ExtendedStore.end(ExtendedStore.java:1029)\norg.apache.slide.transaction.SlideTransaction.delistResource(SlideTransaction.java:377)\norg.apache.slide.store.AbstractStore.delist(AbstractStore.java:1574)\norg.apache.slide.store.AbstractStore.delist(AbstractStore.java:1559)\norg.apache.slide.store.ExtendedStore.retrieveObject(ExtendedStore.java:581)\norg.apache.slide.structure.StructureImpl.retrieve(StructureImpl.java:178)\norg.apache.slide.structure.StructureImpl.retrieve(StructureImpl.java:160)\norg.apache.slide.webdav.method.AbstractWebdavMethod.run(AbstractWebdavMethod.java:387)\norg.apache.slide.webdav.WebdavServlet.service(WebdavServlet.java:155)\njavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:237)\n\u2026\n\nName: http-8095-Processor46\nState: RUNNABLE\nTotal blocked: 44  Total waited: 12\n\nStack trace: \njava.util.HashMap.transfer(HashMap.java:476)\njava.util.HashMap.resize(HashMap.java:455)\njava.util.HashMap.addEntry(HashMap.java:745)\njava.util.HashMap.put(HashMap.java:395)\norg.apache.slide.store.ExtendedStore.end(ExtendedStore.java:1029)\n\n\nThe ExtendedStore.java, line 1029 :\n\nsuspendedLocks.put(txId, locks.get());\n\nMany threads use the same ExtendedStore instance, so the same suspendedLocks\ninstance.\n\nsuspendedLocks is not a synchronized Map.\n\nThe following link\nhttp://blogs.opensymphony.com/plightbo/2005/07/hashmapget_can_cause_an_infini.html\nexplains clearly the behaviour of \"non synchronized Map updated by concurrent\nthreads\".\n\nThe patch is  :\n\nprivate Map suspendedLocks = Collections.synchronizedMap(new HashMap());", "id": 100383, "time": "2007-03-14T07:40:56Z", "creator": "olivier.schmitt@agriculture.gouv.fr", "creation_time": "2007-03-14T07:40:56Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "antoine@apache.org", "attachment_id": null, "is_private": false, "id": 100923, "time": "2007-03-25T14:52:13Z", "bug_id": 41838, "creation_time": "2007-03-25T14:52:13Z", "text": "Hi,\n\nthe code has changed substantially since 2.1. The suspendedLocks hashMap does\nnot exist in the current SVN. Could you download the sources of slide from SVN,\nrebuild and check whether the current version still has these issues ?\n\nRegards,\n\nAntoine"}]
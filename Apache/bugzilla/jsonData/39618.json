[{"count": 0, "attachment_id": null, "creator": "johnha@ccbill.com", "text": "Httpd 2.2.2 is not handling Perl cgi SIGALRMs properly when used with Worker\nMPM.  Something very similar happened in 2.0.55, and was fixed and working again\nin 2.2.0, but in 2.2.2 it's broken again. I *think* the bug is only applicable\nto Worker MPM due to threading Vs. process forking.  The perl CGI sends a\nSIGALRM to it's parent httpd process, which should wait a specified amount of\ntime and send a signal back to the originating process (the cgi).  I think that\nsignal is being sent to the wrong thread, or perhaps not being sent at all.  The\nfollowing cgi code can reproduce this bug.\n\n#!/usr/bin/perl\n$ENV{PERL_SIGNALS} = 'unsafe';\nuse POSIX qw(SIGALRM);\n\nmy $mask = POSIX::SigSet->new(SIGALRM);\nmy $action = POSIX::SigAction->new(sub { die \"Database connection attempt timed\nout\\n\"; }, {flags => 0, safe => 1}, $mask);\nmy $oldaction = POSIX::SigAction->new();\nPOSIX::sigaction(SIGALRM, $action, $oldaction);\n\n\nprint \"Content-type: text/plain\\n\\n\";\neval{\n  #my $sigHandler = set_sig_handler('ALRM', sub { die \"Database connection\nattempt timed out\\n\"; }, {flags => 0, safe => 1});\n  alarm(3);\n  sleep(4);\n  print \"Here\\n\";\n  alarm(0);\n};\nPOSIX::sigaction(SIGALRM, $oldaction);\nalarm(0);\n\nif ($@){\n  print \"Received error (\".$@.\")\\n\";\n}\nelse {\n  print \"No error\\n\";\n}\n\nThe correct output should be \"Recieved error.\" if the .cgi was sent a signal by\nit's parent.  A response of \"No error\" indicates that the .cgi did not recieve\nit's signal callback.\n\nYour help is greatly appreciated.", "id": 89303, "time": "2006-05-19T19:42:02Z", "bug_id": 39618, "creation_time": "2006-05-19T19:42:02Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 39618, "attachment_id": null, "id": 91742, "time": "2006-07-31T17:46:04Z", "creator": "andrew@autobaun.net", "creation_time": "2006-07-31T17:46:04Z", "is_private": false, "text": "Please fix this as soon as possible."}, {"count": 2, "attachment_id": null, "creator": "jorton@redhat.com", "text": "Are you using mod_cgi or mod_cgid?  If the former, does it work with the latter?", "id": 113610, "time": "2008-02-11T03:41:11Z", "bug_id": 39618, "creation_time": "2008-02-11T03:41:11Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 39618, "attachment_id": null, "text": "We don't use either. However, this issue seems to have been fixed as of 2.2.3.", "id": 113635, "time": "2008-02-11T10:06:58Z", "creator": "jasonk@ccbill.com", "creation_time": "2008-02-11T10:06:58Z", "is_private": false}, {"count": 4, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "text": "Marked as fixed as per comment of reporter.", "id": 113639, "time": "2008-02-11T12:19:29Z", "bug_id": 39618, "creation_time": "2008-02-11T12:19:29Z", "is_private": false}]
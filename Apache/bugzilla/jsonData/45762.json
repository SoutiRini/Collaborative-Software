[{"count": 0, "attachment_id": 22541, "creator": "poirier@pobox.com", "text": "Created attachment 22541\nPatch to implement the new feature\n\nThe attached patch adds the ability to log the number of keepalive requests that a connection has served.\n\nIt adds %k to the log format, which logs r->connection->keepalives.\n\n(Compiles without warnings on revision 692451.)\n\nNote: logging r->connection->keepalives reveals a couple of things about keepalive processing that seemed odd to me, but are outside the scope of this bug report.  But briefly, if MaxKeepAliveRequests is set to N, a connection may serve up to N+1 requests.  Also, ->keepalives is not incremented the last time, so if MaxKeepAliveRequests is 3, the logged values will be 1,2,3,3.", "id": 120450, "time": "2008-09-08T05:39:30Z", "bug_id": 45762, "creation_time": "2008-09-08T05:39:30Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 45762, "is_private": false, "id": 120454, "time": "2008-09-08T06:36:29Z", "creator": "covener@gmail.com", "creation_time": "2008-09-08T06:36:29Z", "tags": [], "text": "Can you take the discussion of conn->keepalives/MaxKeepAliveRequests interpretation to dev@httpd?\n\n\nSince it's probably not kosher to re-interpret c->keepalives for anyone who might be looking at it, I think it makes sense to try harder to not log the same value twice:\n\nif (c->keepalive == AP_CONN_CLOSE && c->keepalives > 1)\n // add 1 to what we log\n\nHopefully the confusion could be prevented by revisiting MaxKeepaliveRequests doc and a short hint for the %k doc.  Depending on how MaxKeepaliveRequests doc or implementation is changed, it might also be more consistent to log \"-\" for the first field when c->keepalives==1\n\n"}, {"count": 2, "attachment_id": null, "bug_id": 45762, "is_private": false, "id": 120455, "time": "2008-09-08T06:42:14Z", "creator": "poirier@pobox.com", "creation_time": "2008-09-08T06:42:14Z", "tags": [], "text": "(In reply to comment #1)\n> Can you take the discussion of conn->keepalives/MaxKeepAliveRequests\n> interpretation to dev@httpd?\n\nRight, this isn't the place to hash out how KeepAlive should work.\nI've asked about that on dev@httpd.  If the result of that discussion\nwould lead to simple logging of conn->keepalives looking odd, then we\ncan consider how to clean up what gets logged.\n"}, {"count": 3, "tags": [], "bug_id": 45762, "is_private": false, "text": "Thanks for the feature. Added in revision 693120", "id": 120459, "time": "2008-09-08T07:53:23Z", "creator": "jim@apache.org", "creation_time": "2008-09-08T07:53:23Z", "attachment_id": null}]
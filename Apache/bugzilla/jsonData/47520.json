[{"count": 0, "tags": [], "bug_id": 47520, "text": "Created attachment 23968\nDiff for file XSSFRelation\n\nIn a XSLX you can set one or more mapping rule to define how to exchange data from and to an external XML. This part is called Custom XML Mapping (see http://openxmldeveloper.org/articles/2268.aspx for a pratical example)\n\nThis patch implements the Custom XML mapping part and an XML exporter that, using the mapping saved in an XLSX, exports the data from the worksheets to an XML stream.\n\nThe following example shows how to create an XML with the mapping identified by mapId and prints it to console:\n\n\n int mapId = // your map ID\n XSSFWorkbook wb = // load an XLSX file with mapping informations\t  \n MapInfo mapInfo = null;\n\t\t  \n for(POIXMLDocumentPart p : wb.getRelations()){\n     if(p instanceof MapInfo){\n         mapInfo = (MapInfo) p;\n\t XSSFMap map = mapInfo.getXSSFMapById(mapId);\n\t XSSFExportToXml exporter = new XSSFExportToXml(map);\n\t ByteArrayOutputStream os = new ByteArrayOutputStream();\n         exporter.exportToXML(os,true);\n\t String xml = os.toString(\"UTF-8\");\n         System.out.println(xml);\n    }\n }", "id": 128793, "time": "2009-07-13T08:32:57Z", "creator": "roberto.manicardi@gmail.com", "creation_time": "2009-07-13T08:32:57Z", "is_private": false, "attachment_id": 23968}, {"count": 1, "tags": [], "bug_id": 47520, "attachment_id": 23969, "id": 128794, "time": "2009-07-13T08:33:57Z", "creator": "roberto.manicardi@gmail.com", "creation_time": "2009-07-13T08:33:57Z", "is_private": false, "text": "Created attachment 23969\nNew files (implementation of the exporter and the Custom XML mapping part)"}, {"count": 2, "tags": [], "bug_id": 47520, "attachment_id": null, "text": "Roberto,\n\nThanks for the patch. I gave a quick look and have the following comments: \n\n - Did you make any changes to XSSFFactory?  I guess you did, otherwise workbook.getRelations()  would never return instances of MapInfo. Please re-attach the full diff. \n - Please normalize your code to use org.apache.poi.ss.util.CellReference instead of XSSFCellReference. The latter class is redundant. \n - Can you provide an example based on the posted code so that we include it in the XSSF examples? It would be very handy.\n\nRegards,\nYegor", "id": 128803, "time": "2009-07-13T11:11:39Z", "creator": "yegor@dinom.ru", "creation_time": "2009-07-13T11:11:39Z", "is_private": false}, {"count": 3, "tags": [], "text": "Yegor\n\n> - Did you make any changes to XSSFFactory?  I guess you did, otherwise\n> workbook.getRelations()  would never return instances of MapInfo. Please\n> re-attach the full diff. \n\nXSSFFactory delegates to XSSFRelation the goal of choosing the right relation class to instantiate. The new relation classes were added in the XSSFRelation class\n\n> - Please normalize your code to use org.apache.poi.ss.util.CellReference\n> instead of XSSFCellReference. The latter class is redundant. \n\nMmm, I've reinvented the wheel! :)\nI'll send a new version of the patch\n\n\n>  - Can you provide an example based on the posted code so that we include it in\n> the XSSF examples? It would be very handy.\n\nI've added three XLSX examples in src/testcases/org/apache/poi/hssf/data directory (it's the one where XSSFTestDataSamples searches for test files)\n- Custom XML complex type.xlsx\n- CustomXmlMappings-inverse-order.xlsx\n- CustomXMLMappings.xlsx\n\nYou can find also some examples in the test class org.apache.poi.xssf.extractor.TestXSSFExportToXML\n\n\nThank for your feedback,\nRoberto", "attachment_id": null, "bug_id": 47520, "id": 128834, "time": "2009-07-14T06:22:51Z", "creator": "roberto.manicardi@gmail.com", "creation_time": "2009-07-14T06:22:51Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 47520, "attachment_id": 23979, "id": 128842, "time": "2009-07-14T08:50:18Z", "creator": "roberto.manicardi@gmail.com", "creation_time": "2009-07-14T08:50:18Z", "is_private": false, "text": "Created attachment 23979\nchanged the implementation to use CellReference instead of XSSFCellReference\n\nI've changed the implementation to use CellReference instead of XSSFCellReference and removed the class XSSFCellReference.\n\nI've added some automated conditions to check the output in the test org.apache.poi.xssf.extractor.TestXSSFExportToXML.testMultiTable to verify the output.\n\nI've also changed the test file CustomXML complex types.xlsx to CustomXMLMappings-complex-types.xlsx because I had problems in managing files with spaces in filename (expecially when executing the script to generate the patch)."}, {"count": 5, "tags": [], "bug_id": 47520, "attachment_id": 23980, "text": "Created attachment 23980\nChanges to XSSFRelation\n\nNo changes from the previous, committed just to make sure that the patch is consistent", "id": 128843, "time": "2009-07-14T08:51:41Z", "creator": "roberto.manicardi@gmail.com", "creation_time": "2009-07-14T08:51:41Z", "is_private": false}, {"count": 6, "tags": [], "text": "Roberto,\n\nThanks for the patch, I committed it with a few tweaks in r794539. \n\n - The procedure of getting MapInfo can be simplified. I added XSSFWorkbook.getCustomXMLMappings() which returns a collections of XSSFMap objects. With this change your example looks much simpler:\n\n  //export all xml mappings defined in this workbook\n  XSSFWorkbook wb = ..;\n  for (XSSFMap map : wb.getCustomXMLMappings()) {\n    XSSFExportToXml exporter = new XSSFExportToXml(map);\n\n  }\n\n - I moved XSSFXmlColumnPr and XSSFSingleXmlCell to org.apache.poi.xssf.usermodel.helpers, they are really helper wrappers around XML beans.\n\nOther than that, it is a excellent contribution. \n\nRegards,\nYegor", "is_private": false, "id": 128893, "creator": "yegor@dinom.ru", "time": "2009-07-15T22:56:04Z", "bug_id": 47520, "creation_time": "2009-07-15T22:56:04Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "roberto.manicardi@gmail.com", "attachment_id": null, "id": 128894, "time": "2009-07-15T23:33:57Z", "bug_id": 47520, "creation_time": "2009-07-15T23:33:57Z", "is_private": false, "text": "Yegor,\n\nthank for your work and your support, I'll checkout the last revision!\n\nRegards,\nRoberto"}, {"count": 8, "tags": [], "bug_id": 47520, "attachment_id": null, "id": 128895, "time": "2009-07-16T00:07:18Z", "creator": "roberto.manicardi@gmail.com", "creation_time": "2009-07-16T00:07:18Z", "is_private": false, "text": "Yegor,\n\nthere is an error in the file src/ooxml/testcases/org/apache/poi/xssf/model/TestMapInfo.java\n\n\nthe following piece of code in method testMapInfoExists\n\nfor (XSSFMap map : mapInfo) {\n                    Node xmlSchema = map.getSchema();\n                    assertNotNull(xmlSchema);\n}\n\nshould be substituted by\n\nfor(XSSFMap map: mapInfo.getAllXSSFMaps()){\n                    Node xmlSchema = map.getSchema();\n                    assertNotNull(xmlSchema);\n}\n\n\n(add .getAllXSSFMaps() to mapInfo)\n\notherwhile the code won't compile.\n\nRegards,\nRoberto"}, {"count": 9, "tags": [], "bug_id": 47520, "text": "My bad. I was going to make MapInfo Iterable but reverted this change at the last moment.\n\nFixed in r794563\n\nYegor", "id": 128896, "time": "2009-07-16T00:27:59Z", "creator": "yegor@dinom.ru", "creation_time": "2009-07-16T00:27:59Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "max.valjanski@gmail.com", "attachment_id": null, "id": 128898, "time": "2009-07-16T01:27:21Z", "bug_id": 47520, "creation_time": "2009-07-16T01:27:21Z", "is_private": false, "text": "File names 'CustomXmlMappings.xlsx' and '\nCustomXMLMappings.xlsx' differs on Linux:\n\nTestsuite: org.apache.poi.xssf.extractor.TestXSSFExportToXML\nTests run: 4, Failures: 0, Errors: 1, Time elapsed: 1.143 sec\n\nTestcase: testExportToXML took 0.001 sec\n        Caused an ERROR\nSample file 'CustomXmlMappings.xlsx' not found in data dir '/home/maxcom/svn-checkout/poi/src/testcases/org/apache/poi/hssf/data'\njava.lang.RuntimeException: Sample file 'CustomXmlMappings.xlsx' not found in data dir '/home/maxcom/svn-checkout/poi/src/testcases/org/apache/poi/hssf/data'\n        at org.apache.poi.hssf.HSSFTestDataSamples.openSampleFileStream(HSSFTestDataSamples.java:77)\n        at org.apache.poi.xssf.XSSFTestDataSamples.openSampleWorkbook(XSSFTestDataSamples.java:42)\n        at org.apache.poi.xssf.extractor.TestXSSFExportToXML.testExportToXML(TestXSSFExportToXML.java:46)\n\nTestcase: testExportToXMLInverseOrder took 0.554 sec\nTestcase: testXPathOrdering took 0.218 sec\nTestcase: testMultiTable took 0.354 sec"}, {"count": 11, "tags": [], "text": "Fixed in r794621. \nThere were two tests containing wrong file names: TestXSSFExportToXML and TestMapInfo. \n\nRegards,\nYegor\n\n(In reply to comment #10)\n> File names 'CustomXmlMappings.xlsx' and '\n> CustomXMLMappings.xlsx' differs on Linux:\n> \n> Testsuite: org.apache.poi.xssf.extractor.TestXSSFExportToXML\n> Tests run: 4, Failures: 0, Errors: 1, Time elapsed: 1.143 sec\n> \n> Testcase: testExportToXML took 0.001 sec\n>         Caused an ERROR\n> Sample file 'CustomXmlMappings.xlsx' not found in data dir\n> '/home/maxcom/svn-checkout/poi/src/testcases/org/apache/poi/hssf/data'\n> java.lang.RuntimeException: Sample file 'CustomXmlMappings.xlsx' not found in\n> data dir '/home/maxcom/svn-checkout/poi/src/testcases/org/apache/poi/hssf/data'\n>         at\n> org.apache.poi.hssf.HSSFTestDataSamples.openSampleFileStream(HSSFTestDataSamples.java:77)\n>         at\n> org.apache.poi.xssf.XSSFTestDataSamples.openSampleWorkbook(XSSFTestDataSamples.java:42)\n>         at\n> org.apache.poi.xssf.extractor.TestXSSFExportToXML.testExportToXML(TestXSSFExportToXML.java:46)\n> \n> Testcase: testExportToXMLInverseOrder took 0.554 sec\n> Testcase: testXPathOrdering took 0.218 sec\n> Testcase: testMultiTable took 0.354 sec", "is_private": false, "id": 128903, "creator": "yegor@dinom.ru", "time": "2009-07-16T03:52:35Z", "bug_id": 47520, "creation_time": "2009-07-16T03:52:35Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 47520, "text": "Roberto,\n\nWhere can I find CustomXMLMappings.xlsx I'm trying to run through some of the examples myself.\n\nThank you,\nAndrew", "id": 133739, "time": "2010-01-20T12:15:48Z", "creator": "a.rubalcaba@gmail.com", "creation_time": "2010-01-20T12:15:48Z", "is_private": false, "attachment_id": null}]
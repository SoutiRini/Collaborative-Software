[{"count": 0, "tags": [], "text": "we are using tomcat 4.1.27 as a servlet container (no jsp's). when issuing \nseveral concurrent requests to our servlet we receive a NullPointerException \nfrom CoyoteRequestFacade (see stacktrace below). This is because for some \nreason the CoyoteRequest instance held by the facade gets nulled when several \nrequests are processed by the server. the strange thing is however that the \nfacade itself is still a valid reference. its just the decorated request \ninstance that disappears. \nhow is the requestFacade supposed to behave with regard to a servlet receiving \nconcurrent requests? is it a valid implementation strategy to add attributes to \na HttpServletRequest instance in a filter, then pass the request to the servlet \nand afterwards process the request (and its attributes) again in the filter \nafter the servlet has finished processing the request (after calling getChain\n().doFilter())?\n\nthanks,\nmarkus\n\nStacktrace:\nat org.apache.coyote.tomcat4.CoyoteRequestFacade.setAttribute \n(CoyoteRequestFacade.java: 234)\n    at com.generali.vp.tomcat.AbstractAdapterServlet.sendOutputToBrowser \n(AbstractAdapterServlet.java: 222)\n    at com.generali.vp.tomcat.evpbasis.AbstractEVPServlet.doPost \n(AbstractEVPServlet.java: 154)\n    at javax.servlet.http.HttpServlet.service (HttpServlet.java: 760)\n    at javax.servlet.http.HttpServlet.service (HttpServlet.java: 853)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 247)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 94)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.tomcat.evpbasis.dbvs.filters.UserFilter.doFiltering \n(UserFilter.java: 69)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 92)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at com.generali.vp.tomcat.filters.CommitFilter.doFiltering \n(CommitFilter.java: 53)\n    at com.generali.vp.filters.AbstractFilter.doFilter (AbstractFilter.java: 92)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter \n(ApplicationFilterChain.java: 213)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter \n(ApplicationFilterChain.java: 193)\n    at org.apache.catalina.core.StandardWrapperValve.invoke \n(StandardWrapperValve.java: 256)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt (StandardPipeline.java: 643)\n    at org.apache.catalina.core.StandardPipeline.invoke (StandardPipeline.java: \n480)\n    at org.apache.catalina.core.ContainerBase.invoke (ContainerBase.java: 995)\n    at org.apache.catalina.core.StandardContextValve.invoke \n(StandardContextValve.java: 191)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt (StandardPipeline.java: 643)\n    at org.apache.catalina.core.StandardPipeline.invoke (StandardPipeline.java: \n480)\n    at org.apache.catalina.core.ContainerBase.invoke (ContainerBase.java: 995)\n    at org.apache.catalina.core.StandardContext.invoke (StandardContext.java: \n2416)\n    at org.apache.catalina.core.StandardHostValve.invoke \n(StandardHostValve.java: 180)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt (StandardPipeline.java: 643)\n    at org.apache.catalina.valves.ErrorDispatcherValve.invoke \n(ErrorDispatcherValve.java: 171)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt (StandardPipeline.java: 641)\n    at org.apache.catalina.valves.ErrorReportValve.invoke \n(ErrorReportValve.java: 172)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt (StandardPipeline.java: 641)\n    at org.apache.catalina.core.StandardPipeline.invoke (StandardPipeline.java: \n480)\n    at org.apache.catalina.core.ContainerBase.invoke (ContainerBase.java: 995)\n    at org.apache.catalina.core.StandardEngineValve.invoke \n(StandardEngineValve.java: 174)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt (StandardPipeline.java: 643)\n    at org.apache.catalina.core.StandardPipeline.invoke (StandardPipeline.java: \n480)\n    at org.apache.catalina.core.ContainerBase.invoke (ContainerBase.java: 995)\n    at org.apache.coyote.tomcat4.CoyoteAdapter.service (CoyoteAdapter.java: 223)\n    at org.apache.jk.server.JkCoyoteHandler.invoke (JkCoyoteHandler.java: 263)\n    at org.apache.jk.common.HandlerRequest.invoke (HandlerRequest.java: 360)\n    at org.apache.jk.common.ChannelSocket.invoke (ChannelSocket.java: 604)\n    at org.apache.jk.common.ChannelSocket.processConnection \n(ChannelSocket.java: 562)\n    at org.apache.jk.common.SocketConnection.runIt (ChannelSocket.java: 679)\n    at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run \n(ThreadPool.java: 619)\n    at java.lang.Thread.run (Thread.java: 534)", "attachment_id": null, "id": 60458, "creation_time": "2004-07-12T09:19:04Z", "time": "2004-07-12T09:19:04Z", "creator": "m.mayer@generali.at", "bug_id": 30045, "is_private": false}, {"count": 1, "tags": [], "bug_id": 30045, "attachment_id": null, "id": 67526, "time": "2004-11-28T23:43:52Z", "creator": "markt@apache.org", "creation_time": "2004-11-28T23:43:52Z", "is_private": false, "text": "Can you provide a simple test WAR that demonstrates this error?\n\nMy guess at the moment is that your servlet isn't thread safe and is hanging \non to an old request facade."}, {"count": 2, "tags": [], "bug_id": 30045, "text": "via private mail from the original reporter:\n\n\"The problem was sitting in our code (as always... :-)). Btw you were right \nabout the cause of the problem being the servlets lack of thread safety (it \ntook me ages to find that out though)... \"\n\nResolving this as invalid.", "id": 67550, "time": "2004-11-29T19:06:08Z", "creator": "markt@apache.org", "creation_time": "2004-11-29T19:06:08Z", "is_private": false, "attachment_id": null}]
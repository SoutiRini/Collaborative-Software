[{"count": 0, "tags": [], "bug_id": 51584, "text": "Situation:\n stray text file in my /WEB-INF/classes/...../ directory named \"#SurveyMain.java#\"     ( It was a backup/autosaved source file, and eclipse 'helpfully' deployed it. ) \n\n \n causes crash on startup in tomcat 7.0.6, 7.0.19 and 7.0.20-dev (1151601M). - out of memory.\n\n\nAdded this test to .20-dev:\n\nIndex: org/apache/catalina/startup/ContextConfig.java\n===================================================================\n--- org/apache/catalina/startup/ContextConfig.java\t(revision 1151601)\n+++ org/apache/catalina/startup/ContextConfig.java\t(working copy)\n@@ -1902,6 +1902,7 @@\n                 while (dirs.hasMoreElements()) {\n                     String dir = dirs.nextElement();\n                     URL dirUrl = new URL(url.toString() + '/' + dir);\n+                    System.err.println(\"Processing: \" + url.toString() + '/' + dir);\n                     processAnnotationsJndi(dirUrl, fragment);\n                 }\n                 \n\nPrinted tons of lines\u2026 at startup\u2026\n\n\nProcessing: jndi:/localhost/cldr-apps/WEB-INF/classes/org/unicode/cldr/web/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/#SurveyMain.java#/....\n\nThen crashed as before\u2026\n\njava.lang.OutOfMemoryError: Java heap space\n\tat java.util.Arrays.copyOfRange(Arrays.java:3209)\n\tat java.lang.String.<init>(String.java:215)\n\tat java.lang.StringBuilder.toString(StringBuilder.java:430)\n\tat java.io.UnixFileSystem.resolve(UnixFileSystem.java:93)\n\tat java.io.File.<init>(File.java:312)\n\tat org.apache.naming.resources.FileDirContext.list(FileDirContext.java:871)\n\tat org.apache.naming.resources.FileDirContext.list(FileDirContext.java:304)\n\tat org.apache.naming.resources.ProxyDirContext.list(ProxyDirContext.java:506)\n\tat org.apache.naming.resources.DirContextURLConnection.list(DirContextURLConnection.java:444)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1901)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJndi(ContextConfig.java:1906)\n\n\n\nI think the problem is that the URL generated contains a '#' and so file:// interprets it as a fragment and not as a path.\n\nQuick patch:\n\nIndex: java/org/apache/catalina/startup/ContextConfig.java\n===================================================================\n--- java/org/apache/catalina/startup/ContextConfig.java\t(revision 1151601)\n+++ java/org/apache/catalina/startup/ContextConfig.java\t(working copy)\n@@ -1901,7 +1901,11 @@\n                 Enumeration<String> dirs = dcUrlConn.list();\n                 while (dirs.hasMoreElements()) {\n                     String dir = dirs.nextElement();\n+                    if(dir.startsWith(\"#\")) {\n+                        continue;\n+                    }\n                     URL dirUrl = new URL(url.toString() + '/' + dir);\n+                    //System.err.println(\"Processing: \" + dirUrl.toString());\n                     processAnnotationsJndi(dirUrl, fragment);\n                 }", "id": 148275, "time": "2011-07-29T15:34:27Z", "creator": "srloomis@us.ibm.com", "creation_time": "2011-07-29T15:34:27Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 51584, "attachment_id": null, "id": 148292, "time": "2011-07-31T17:00:49Z", "creator": "markt@apache.org", "creation_time": "2011-07-31T17:00:49Z", "is_private": false, "text": "Thanks for the report.\n\nThe fix needs to be at a lower level than the patch you suggest to address the root cause rather than one of the symptoms.\n\nThe patch has been applied to 7.0.x and will be included in 7.0.20 onwards."}, {"count": 2, "tags": [], "bug_id": 51584, "attachment_id": null, "id": 148312, "time": "2011-08-01T13:48:05Z", "creator": "srloomis@us.ibm.com", "creation_time": "2011-08-01T13:48:05Z", "is_private": false, "text": "(In reply to comment #1)\n> Thanks for the report.\n> \n> The fix needs to be at a lower level than the patch you suggest to address the\n> root cause rather than one of the symptoms.\n\nI don't doubt it at all. \n\n> The patch has been applied to 7.0.x and will be included in 7.0.20 onwards.\n\nThanks! I was surprised to find this was a unique find. But perhaps few people use  vim + eclipse + tomcat.  I don't, but apparently I edited one source file with vim."}, {"count": 3, "tags": [], "text": "Just noting that the fix for this issue (r1152593) was incomplete and caused regression - bug 53257. See further discussion there.", "attachment_id": null, "id": 159154, "creator": "knst.kolinko@gmail.com", "time": "2012-05-18T09:02:24Z", "bug_id": 51584, "creation_time": "2012-05-18T09:02:24Z", "is_private": false}]
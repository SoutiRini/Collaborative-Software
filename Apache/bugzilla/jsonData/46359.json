[{"count": 0, "tags": [], "bug_id": 46359, "attachment_id": 22999, "text": "Created attachment 22999\nTest Case illustrating issue\n\nThe BSF JavaScript Preprocessor is unable to access the Sampler variable in the first iteration, citing the following exception:\n\norg.apache.bsf.BSFException: JavaScript Error: Internal Error: org.mozilla.javascript.EcmaError: ReferenceError: \"sampler\" is not defined.\n\nSteps to Reproduce:\n1-Create a Thread Group set to run for two or more iterations\n2-Add a Sampler to the Thread Group (tested with an HTTP Sampler)\n3-Add a BSF PreProcessor to the Sampler\n4-Use javascript as the BSF Language\n5-Enter a simple script that references the \"sampler\" variable. Tested with OUT.println(\"hello\"); OUT.println(sampler);\n6-Run\n\nExpected Results:\n - All iterations produce console output \"hello\\n[sampler information]\"\n\nActual Results:\n - First Iteration, only \"hello\" is output to console.\n - Log Output: 2008/12/07 12:21:51 WARN  - jmeter.modifiers.BSFPreProcessor: Problem in BSF script org.apache.bsf.BSFException: JavaScr\nipt Error: Internal Error: org.mozilla.javascript.EcmaError: ReferenceError: \"sampler\" is not defined. \n - Second and further iterations \"hello\\n[sampler information]\"\n\nAffects Versions:\n - Trunk revision 722843\n - Release 2.3.2", "id": 123148, "time": "2008-12-07T04:14:22Z", "creator": "NTmatter@gmail.com", "creation_time": "2008-12-07T04:14:22Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 46359, "text": "In version 2.3.2, this issue affects both the Pre and Post Processors. As of the current trunk (722032) this only affects the Pre Processor.", "id": 123150, "time": "2008-12-07T04:52:23Z", "creator": "NTmatter@gmail.com", "creation_time": "2008-12-07T04:52:23Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 46359, "attachment_id": null, "text": "Thanks for the report and test case.\n\nThis appears to be due to a bug in either BSF or Rhino, not JMeter.\n\nIt does not appear to be possible to define a script variable with a null value to Javascript using BSF. Furthermore, any variables which are defined after the null value will also be inaccessible.\n\nThe null variable in this case is \"prev\", so a work-round is to ensure that there is at least one previous sample result.\n\nThe JMeter code can be rearanged to define the \"prev\" variable last, but obviously that is also only a work-round.", "id": 123166, "time": "2008-12-08T07:13:15Z", "creator": "sebb@apache.org", "creation_time": "2008-12-08T07:13:15Z", "is_private": false}, {"count": 3, "tags": [], "creator": "NTmatter@gmail.com", "attachment_id": null, "id": 123169, "time": "2008-12-08T08:48:03Z", "bug_id": 46359, "creation_time": "2008-12-08T08:48:03Z", "is_private": false, "text": "Some research indicates that BSF used to have an issue with registering (but not declaring) a null bean back in mid-2004 (Ref 1). \n\nFrom the snippet below, a quick run of the test case shows that BSF Jexl handles the null \"prev\" object just fine. As BSF Jexl and JS get set up by the same code, it is most likely that the issue lies in or close to Rhino itself.\n\n-- Test Case output --\nBSF Jexl\nContext: false\nVariables: false\nSampler: false\nBSF JS\nContext: false\nVariables: false\n\n-- References --\n(1) Commits fixing BSF issue 20355: http://markmail.org/message/ymna5ppb4556og4k\n"}, {"count": 4, "tags": [], "bug_id": 46359, "attachment_id": null, "text": "As far as I can tell, the problem is in BSF, in the Javascript engine wrapper.\n\nI raised https://issues.apache.org/jira/browse/BSF-22 for the error.", "id": 123175, "time": "2008-12-08T09:57:35Z", "creator": "sebb@apache.org", "creation_time": "2008-12-08T09:57:35Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 46359, "attachment_id": null, "text": "I've added a temporary work-round in r724446 and r724445.\n\nThis is in the current nightlies (from r724447) if you want to try it out.", "id": 123180, "time": "2008-12-08T11:04:44Z", "creator": "sebb@apache.org", "creation_time": "2008-12-08T11:04:44Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 46359, "text": "Please reopen if the fix does not work", "id": 123483, "time": "2008-12-22T07:54:40Z", "creator": "sebb@apache.org", "creation_time": "2008-12-22T07:54:40Z", "is_private": false, "attachment_id": null}]
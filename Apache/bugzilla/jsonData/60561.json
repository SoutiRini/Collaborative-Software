[{"attachment_id": null, "tags": [], "bug_id": 60561, "is_private": false, "count": 0, "id": 195904, "time": "2017-01-09T11:07:24Z", "creator": "guill.sanon@gmail.com", "creation_time": "2017-01-09T11:07:24Z", "text": "Hi,\n\nWhen I create a XSSFWorkbook with a hidden sheet and two visible sheets : \n0 : \"HiddenSheet\"\n1 : \"DataSheet 1\"\n2 : \"DataSheet 2\"\n\nAll modifications done with Excel on the first visible \"DataSheet 1\" are reported on the \"HiddenSheet\". \nModifications done on the third sheet \"DataSheet 2\" has no effect neither on \"HiddenSheet\" or \"DataSheet 1\"\nData wrote on the \"DataSheet 1\" shold not be reported on the \"HiddenSheet\"\n\nI tried to modify with Excel 2007, Excel 2013same problem.\nI tried to generate with Apache POI  3.15 avec 3.16-beta2 same problem. \nUse a very hidden sheet with \"setHiddenSheet(0, 2)\" correct the problem.\n\nTo reproduce generate a workbook with the code below then open the generated file with Excel and modify values in the \"DataSheet 1\". Unhide the \"HiddenSheet\" you will see the modifications you did on the \"DataSheet 1\" copied on the \"HiddenSheet\".\n\nRegards,\n\nExemple code :\n\nimport java.io.FileOutputStream;\nimport java.io.IOException;\n\nimport org.apache.poi.ss.usermodel.Cell;\nimport org.apache.poi.ss.usermodel.Row;\nimport org.apache.poi.ss.usermodel.Sheet;\nimport org.apache.poi.ss.usermodel.Workbook;\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\n\npublic class HiddenSheetTest {\n\n\tpublic static final int ROW_NUMBER = 15;\n\tpublic static final int COLUMN_NUMBER = 10;\n\t\n\tpublic static void main(String[] args) {\n\n        Workbook wb = new XSSFWorkbook(); \n        Sheet hiddenSheet = wb.createSheet(\"HiddenSheet\"); \n        Sheet dataSheet = wb.createSheet(\"DataSheet 1\"); \n        Sheet dataSheet2 = wb.createSheet(\"DataSheet 2\"); \n        populateSheetWithNumber(hiddenSheet, 5);\n        populateSheetWithNumber(dataSheet, 10);\n        populateSheetWithNumber(dataSheet2, 20);\n        // set Active Sheet \"DataSheet\"\n        wb.setActiveSheet(1);\n        \n        // Hide \"hiddenSheet\"\n        wb.setSheetHidden(0, true);\n        try {\n          \tFileOutputStream out = new FileOutputStream(\"WBTest.xlsx\");\n          \twb.write(out);\n        \tout.close();\n\t\t\twb.close();\n\t\t} catch (IOException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n\n\tprivate static void populateSheetWithNumber(Sheet sheet, int number)\n\t{\n\t\tfor(int i = 0; i < ROW_NUMBER; i++)\n\t\t{\n\t\t\tRow row = sheet.createRow(i);\n\t\t\tfor(int j = 0;  j < COLUMN_NUMBER; j++)\n\t\t\t{\n\t\t\t\tCell cell = row.createCell(j);\n\t\t\t\tcell.setCellValue(number);\n\t\t\t}\n\t\t}\n\t}\n}"}, {"count": 1, "tags": [], "bug_id": 60561, "is_private": false, "id": 196179, "creation_time": "2017-01-19T07:11:35Z", "time": "2017-01-19T07:11:35Z", "creator": "onealj@apache.org", "text": "Created attachment 34644\npassing test case\n\nI was unable to reproduce the reported problem using trunk (post 3.16 beta 1).\n\nSee attached passing unit test", "attachment_id": 34644}, {"count": 2, "tags": [], "creator": "onealj@apache.org", "text": "Created attachment 34645\nlonger unit test that more closely resembles original bug report", "id": 196180, "time": "2017-01-19T07:12:14Z", "bug_id": 60561, "creation_time": "2017-01-19T07:12:14Z", "is_private": false, "attachment_id": 34645}, {"count": 3, "tags": [], "creator": "onealj@apache.org", "text": "> All modifications done with Excel on the first visible \"DataSheet 1\" are \n> reported on the \"HiddenSheet\".\n\nThis doesn't make sense. Modifying one sheet should not modify a different sheet unless there are formulas on the second sheet. The only other way this would make sense is if you Ctrl+Click the sheets in Excel to create a sheet [Group], in which case modifications are applied to all selected sheets in that group.\n\nGroup editing is a GUI feature of Excel (not something that is stored in the OOXML format, except perhaps for group state).\n\nI did not see a difference in POI's behavior with respect to the values that were written to the sheets when the hidden sheet was made very hidden.\n\nPlease provide a unit test that demonstrates the problem that you have. If at all possible, test for the problem in POI java code, as this eliminates the variable of Excel's behavior (different versions, macros that run when the workbook is opened).", "id": 196181, "time": "2017-01-19T07:24:57Z", "bug_id": 60561, "creation_time": "2017-01-19T07:24:57Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 60561, "is_private": false, "text": "I tried to reproduce the bug by writting data only with Apache POI without success, data are not copied from the first visible sheet to the hidden sheet.  Sheets are independant and we get what we expected.\n\nBut still the problem is when I open the generate workbook with an external tool (Excel, open Office), I didn't know about Group Editing but it's exactly what is happening here. When I open the generated workbook the \"HiddenSheet\" and the \"DataSheet 1\" are associated. I don't think I did something in the code I pasted in this purpose. As you said it doesn't make sense we don't expected this kind of behavior with the \"simple\" code I pasted. I don't have any macro running and tested with Excel 2007 2013 and Open Office with the same result.\n\nI don't know if it's something related to Apache POI and OOXML Format or something with the softwares that don't support the generated file but I think an unexpected behavior occurs.", "id": 196394, "time": "2017-01-25T12:57:31Z", "creator": "guill.sanon@gmail.com", "creation_time": "2017-01-25T12:57:31Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "onealj@apache.org", "attachment_id": null, "text": "Can you run both unit tests that I attached to this bug and let me know if they pass or fail on your setup?\n\nWhen you tested this bug, did you use the code sample from comment 0 or did you have more complicated code that may be writing the same contents to multiple sheets?\n\nCan you try running this with 3.16 beta 1 or a trunk build [1] to see if it's a problem with your version of POI?\n\n[1] https://builds.apache.org/view/POI/job/POI-DSL-1.6/lastSuccessfulBuild/artifact/", "id": 196404, "time": "2017-01-25T15:05:49Z", "bug_id": 60561, "creation_time": "2017-01-25T15:05:49Z", "is_private": false}, {"attachment_id": 34675, "tags": [], "creator": "guill.sanon@gmail.com", "text": "Created attachment 34675\nUnit test describing the bug (but pass)", "count": 6, "id": 196408, "time": "2017-01-25T16:06:50Z", "bug_id": 60561, "creation_time": "2017-01-25T16:06:50Z", "is_private": false}, {"count": 7, "tags": [], "creator": "guill.sanon@gmail.com", "text": "I have forgotten to mention that your tests pass. I did an other test (see attachments) more relevant with some data wrote in the \"DataSheet\" and it pass too. But when I open the workbook generated by this test I have the \"bug\" (\"HiddenSheet\" and \"DataSheet 1\" are associated, modification on \"Datasheet 1\" impacts \"HiddenSheet\").\n\nI have the same issue with the code posted on \"comment 0\". When I open \"WBTest.xlsx\" the \"HiddenSheet\" and the \"Datasheet 1\" are associated.\n\nI juste tried with the last successful build 3.16-beta2 #125 and same problem.", "id": 196409, "time": "2017-01-25T16:07:04Z", "bug_id": 60561, "creation_time": "2017-01-25T16:07:04Z", "is_private": false, "attachment_id": null}]
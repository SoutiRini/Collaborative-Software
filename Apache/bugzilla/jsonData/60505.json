[{"count": 0, "tags": [], "text": "SVN Rev 1772959 broke the JaCoCo support just recently introduced.\nSVN Rev 1775332 partially fixed that, but missed the session identifiers.", "is_private": false, "id": 195595, "creator": "ts-nospam12@online.de", "time": "2016-12-21T20:41:34Z", "bug_id": 60505, "creation_time": "2016-12-21T20:41:34Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 60505, "attachment_id": 34545, "id": 195596, "time": "2016-12-21T20:49:37Z", "creator": "ts-nospam12@online.de", "creation_time": "2016-12-21T20:49:37Z", "is_private": false, "text": "Created attachment 34545\nPatch fixing this, also upgrading jacoco to V 0.7.8"}, {"count": 2, "tags": [], "bug_id": 60505, "text": "@Felix\n\nI noted you had some trouble with this, so an explanation might be helpfull:\nThe jumble of charcacters inserted after ${jacoco_params} serves as a session identifier.\nAs you noted yourself, ant properties can be set only once, so it will not do concatenating \nthe changing string into ${jacoco_params} - this would yield the same session id for all invokations.\n\nAdditional things fixed:\n- upgraded to jacoco 0.7.8\n- removed the xmlns:if=\"ant:if\" wich is is unavailable in ant < 1.9.1\n\nThings you might want to know for your sonar integration introduced with SVN Rev 1774875:\n- instead of rexecuting the junit task in complete-junit, it might just do to depend on the\ntarget 'coverage' in your target 'sonar'. In addition to executing the unit tests in both headed and headless mode,\nit also exercises the batch tests.\n\n- registration of the jacoco ant tasks has been implemented before in _coverage.prepare, and may be reused by depending\non this target.\n\n- the corresponding namespace registration is already present on the project tag.\n\nI added the html report showing the sessions for illustration.", "id": 195597, "time": "2016-12-21T21:30:45Z", "creator": "ts-nospam12@online.de", "creation_time": "2016-12-21T21:30:45Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 60505, "attachment_id": 34546, "id": 195598, "time": "2016-12-21T21:30:53Z", "creator": "ts-nospam12@online.de", "creation_time": "2016-12-21T21:30:53Z", "is_private": false, "text": "Created attachment 34546\nExample Session Overview produced by invoking 'ant coverage'"}, {"count": 4, "tags": [], "creator": "felix.schumacher@internetallee.de", "is_private": false, "text": "Thanks for your patience on this.\n\nI tried your patch (without specifying an jacocoagent parameter and it includes the starting class (org.apache.jmeter.NewDriver) twice. Is that correct?\n\nCould you explain a bit more detailed, how you expect the build to be run? Do I have to download the jacoco agent by hand? If so, where do you expect us to have it installed?", "id": 195607, "time": "2016-12-22T10:53:51Z", "bug_id": 60505, "creation_time": "2016-12-22T10:53:51Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "ts-nospam12@online.de", "attachment_id": null, "text": "The intended usage is a simple call to the one shot target 'coverage'.\n\nThis would:\n- initialize the parameter 'jacocoagent' via dependency target _coverage.prepare \n- execute the unit tests twice via test_both via dependency target test_both\n- execute the batch tests via dependency target _allbatchtests\n- finaly generate the report via dependency target _coverage.report\n\nIt is possible to do a restricted coverage report by an ant invokation like this:\n\nant -Dtest.case=<Your favorite testcase here> _coverage.prepare junit _coverage.report\n\nor doing a report on gui usage:\n\nant _coverage.prepare run_gui _coverage.report\n\nNote, that this mainly relies on the ant feature of processing dependencies in the order they apear wich might change, but hasn't since its inception.\n\nNote also, that in the current state of affairs it will not be possible to execute the tests once with, and then again without the coverage agent within the same ant run - because of said immutability: once the parameter 'jacoco_params' has been set either to its dummy content or the -agent... spec, it will remain so.\n\nAs for the required jacoco agent lib: This is handled exactly the same way like rat and checkstyle, using the download_jars target:\nYou'll find it in your libs/opt directory after an 'ant download_jars'.\nIts presence is alos checked in _coverage.prepare.\nIts version is managed in the build.properties", "id": 195642, "time": "2016-12-23T17:56:06Z", "bug_id": 60505, "creation_time": "2016-12-23T17:56:06Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 60505, "attachment_id": null, "id": 195646, "time": "2016-12-23T21:00:49Z", "creator": "ts-nospam12@online.de", "creation_time": "2016-12-23T21:00:49Z", "is_private": false, "text": "As for the duplicate main class:\nWhere do you see this? Unless its actually causing problems in your setup (in mine, it doesn't) I assume you are puzzled by the content of the sessionid for the jacoco agent.\n\nThe jacoco sessionId, wich is defaulted by jacoco, may be replaced with an abitrary string. I used this to pass in some of the execution data. This helps to keep track of the tests, that have contributed to a coverage report. Note that the whole content of <jvmarg value=\"${jacoco_params}my custom session identifier\" /> will be passed as one parameter to the jvm, including any spaces.\nTake a look at the Attachment 34546 to see what I mean."}, {"count": 7, "tags": [], "bug_id": 60505, "text": "(In reply to Thomas Schapitz from comment #6)\n> As for the duplicate main class:\n> Where do you see this? Unless its actually causing problems in your setup\n> (in mine, it doesn't) I assume you are puzzled by the content of the\n> sessionid for the jacoco agent.\n\nRun the test and do a \"ps aux | grep NewDriver\". You will see, that NewDriver is set twice.\n\n> \n> The jacoco sessionId, wich is defaulted by jacoco, may be replaced with an\n> abitrary string. I used this to pass in some of the execution data. This\n> helps to keep track of the tests, that have contributed to a coverage\n> report. Note that the whole content of <jvmarg value=\"${jacoco_params}my\n> custom session identifier\" /> will be passed as one parameter to the jvm,\n> including any spaces.\n> Take a look at the Attachment 34546 [details] to see what I mean.", "id": 195665, "time": "2016-12-27T11:09:49Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2016-12-27T11:09:49Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 60505, "text": "I have adapted your new patch and hopefully it works now, as you intended it to work. My local sonar works with the changes.\n\nIf you think, this issue is resolved, you can close it.\n\nAnd again, thanks for you work on this.\n\nDate: Tue Dec 27 11:13:07 2016\nNew Revision: 1776105\n\nURL: http://svn.apache.org/viewvc?rev=1776105&view=rev\nLog:\nant:if can only be used on ant 1.9.x and upwards.\n\nModified:\n    jmeter/trunk/build.xml\n\n\nDate: Tue Dec 27 11:24:00 2016\nNew Revision: 1776106\n\nURL: http://svn.apache.org/viewvc?rev=1776106&view=rev\nLog:\nUpdate jacoco to version 0.7.8.\n\nModified:\n    jmeter/trunk/build.properties\n\nDate: Tue Dec 27 12:24:38 2016\nNew Revision: 1776109\n\nURL: http://svn.apache.org/viewvc?rev=1776109&view=rev\nLog:\nUse coverage target for sonar instead of complete-junit. Based on patch by Thomas Schapitz. Bugzilla Id: 60505\n\nModified:\n    jmeter/trunk/build.xml", "id": 195667, "time": "2016-12-27T12:28:39Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2016-12-27T12:28:39Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 60505, "text": "Thanks for the contribution !\nClosing as resolved.", "id": 195731, "time": "2016-12-30T20:54:42Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-12-30T20:54:42Z", "is_private": false, "attachment_id": null}]
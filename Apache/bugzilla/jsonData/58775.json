[{"count": 0, "tags": [], "creator": "onealj@apache.org", "attachment_id": null, "is_private": false, "id": 187161, "time": "2015-12-28T07:11:35Z", "bug_id": 58775, "creation_time": "2015-12-28T07:11:35Z", "text": "Unit test (adapted from [1])\n\npublic void createManyDataFormats(int numDataFormats) {\n    Workbook wb = new XSSFWorkbook();\n    Sheet sh = wb.createSheet(\"test\");\n    DataFormat formats = wb.createDataFormat();\n    for (int i=0; i<numDataFormats; i++) {\n        Row row = sh.createRow(i);\n        Cell cell = row.createCell(0);\n        CellStyle style = wb.createCellStyle();\n        String formatStr = \"\\\"Format\" + i + \"\\\"0.0\";\n        int formatIndex = formats.getFormat(formatStr);\n        style.setDataFormat(formatIndex);\n        cell.setCellStyle(style);\n        cell.setCellValue(i);\n    }\n    String filename = \"/tmp/dataformat-\" + numDataFormats +\".xlsx\";\n    OutputStream fos = new FileOutputStream(filename);\n    wb.write(fos);\n    fos.close();\n    wb.close();\n}\n\nExcel 2013 (en-US) doesn't report any issues opening dataformat-100.xlsx, but upon opening dataformat-250.xlsx, it reports the following error message:\n\n\"We found a problem with some content in 'dataformat-250.xlsx'. Do you want us to try to recover as much as we can? If you trust the source of this workbook, click Yes.\"\nUpon clicking Yes, it looks like all formats beyond 205 were ignored.\n\nAccording to [2], Microsoft Excel 2007+ supports between 200 and 250 \"number formats in a workbook\", depending on the language version of Excel. POI should restrict workbooks to 250 data formats, with notes in the documentation that Excel may not be able to read workbooks containing over 200 data formats.\n\n[1] http://poi.apache.org/spreadsheet/quick-guide.html#DataFormats\n[2] https://support.office.com/en-us/article/Excel-specifications-and-limits-ca36e2dc-1f09-4620-b726-67c00b05040f#bmworksheetworkbook"}, {"count": 1, "tags": [], "bug_id": 58775, "text": "Added in r1722054.\nUpdated docs in r1722056.\n\nThe default upper limit of 250 data formats per style table can be changed by the user via StylesTable.setMaxNumberOfDataFormats.", "id": 187197, "attachment_id": null, "creator": "onealj@apache.org", "creation_time": "2015-12-29T05:51:01Z", "time": "2015-12-29T05:51:01Z", "is_private": false}, {"count": 2, "tags": [], "text": "Backwards-compatibility note: r1722054 changed the signature of some methods to use short instead of int to represent the number format id. The generated ooxml CTNumFmt stores the number format id as a long, though Excel limits the quantity of number formats to 200-250.\n\nThis implies either number format ids can be sparsely populated among the domain of longs or they left the format open so that the upper limit may increase in a future version of Excel.", "attachment_id": null, "bug_id": 58775, "id": 187198, "time": "2015-12-29T05:56:14Z", "creator": "onealj@apache.org", "creation_time": "2015-12-29T05:56:14Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 23766, "text": "I have tried putting the following in\n$CATALINA_HOME/server/webapps/manager/WEB-INF/web.xml but the SSL config is ignored:\n\n  <security-constraint>\n    <web-resource-collection>\n      <web-resource-name>SSL 4 Login</web-resource-name>\n      <url-pattern>/ssllogin.html</url-pattern>\n      <url-pattern>/sslerror.html</url-pattern>\n    </web-resource-collection>\n    <user-data-constraint>\n      <description>SSL required</description>\n      <transport-guarantee>CONFIDENTIAL</transport-guarantee>\n    </user-data-constraint>\n  </security-constraint>\n\n  <login-config>\n    <auth-method>FORM</auth-method>\n    <realm-name>BlackSailRealm</realm-name>\n    <form-login-config>\n      <form-login-page>/ssllogin.html</form-login-page>\n      <form-error-page>/sslerror.html</form-error-page>\n    </form-login-config>\n  </login-config>\n\nI have the login & error pages in $CATALINA_HOME/server/webapps/manager/\n\nBasically it always stays in non-SSL protocol.", "id": 45486, "time": "2003-10-13T10:56:37Z", "creator": "adam.hardy@cyberspaceroad.com", "creation_time": "2003-10-13T10:56:37Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 23766, "text": "FORM can be implemented as an internal redirection, like welcome files. As a\nresult, it is not subject to constraints. Please do not reopen the report.", "id": 45491, "time": "2003-10-13T12:19:11Z", "creator": "remm@apache.org", "creation_time": "2003-10-13T12:19:11Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "Hi Remy,\nare you saying that as of version 5 tomcat no longer supports the use of SSL to\nencrypt the login form in form-based authentication?\n\nAdam", "is_private": false, "id": 45549, "creator": "adam.hardy@cyberspaceroad.com", "time": "2003-10-13T17:21:28Z", "bug_id": 23766, "creation_time": "2003-10-13T17:21:28Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Yes he is.", "is_private": false, "id": 45592, "creator": "adam.hardy@cyberspaceroad.com", "time": "2003-10-14T11:49:30Z", "bug_id": 23766, "creation_time": "2003-10-14T11:49:30Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 23766, "text": "Remy isn't saying that and it clearly does work. It would be a spec violation \nif it did't. The web.xml below works for me (I was using it to test for a \nprevious bug).\n\nPS. There are plenty examples of how to do this on the web. \n\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n\n<!DOCTYPE web-app\n    PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n    \"http://java.sun.com/dtd/web-app_2_3.dtd\">\n\n<web-app>\n\n    <display-name>Bug 10229</display-name>\n    <description>\n      Test web app for bug 10229.\n    </description>\n\n    <security-constraint>\n\t<web-resource-collection>\n\t<web-resource-name>App</web-resource-name>\n\t    <url-pattern>/protected.jsp</url-pattern>\n\t</web-resource-collection>\n\t<auth-constraint>\n\t    <role-name>tomcat</role-name>\n\t</auth-constraint>\n\t<user-data-constraint>\n\t    <transport-guarantee>CONFIDENTIAL</transport-guarantee>\n\t</user-data-constraint>\n    </security-constraint>\n\n    <security-constraint>\n\t<web-resource-collection>\n\t<web-resource-name>Login pages</web-resource-name>\n\t    <url-pattern>/security/*</url-pattern>\n\t</web-resource-collection>\n\t<user-data-constraint>\n\t    <transport-guarantee>CONFIDENTIAL</transport-guarantee>\n\t</user-data-constraint>\n    </security-constraint>\n\n    <login-config>\n      <auth-method>FORM</auth-method>\n      <realm-name>Example Form-Based Authentication Area</realm-name>\n      <form-login-config>\n        <form-login-page>/security/login.jsp</form-login-page>\n        <form-error-page>/security/error.jsp</form-error-page>\n      </form-login-config>\n    </login-config>\n\n    <security-role>\n      <role-name>tomcat</role-name>\n    </security-role>\n\n</web-app>", "id": 45664, "time": "2003-10-14T18:09:05Z", "creator": "medthomas@ntlworld.com", "creation_time": "2003-10-14T18:09:05Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 23766, "text": "Are you sure this runs under tomcat 5? It's just you've got a servlet 2.4 DTD\nreference. I know tomcat doesn't care, but just checking...\n\nPresuming you're definite about tomcat 5, then pardon my ignorance but what does\nRemy mean? \n\nCheck out my discussion on the tomcat user list:\n\nhttp://marc.theaimsgroup.com/?l=tomcat-user&m=106611364304013&w=2", "id": 45665, "time": "2003-10-14T18:26:38Z", "creator": "adam.hardy@cyberspaceroad.com", "creation_time": "2003-10-14T18:26:38Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "medthomas@ntlworld.com", "is_private": false, "id": 45680, "time": "2003-10-14T21:28:38Z", "bug_id": 23766, "creation_time": "2003-10-14T21:28:38Z", "tags": [], "text": "Of course it works. That is way my comments included the phrase \"The web.xml \nbelow works for me...\".\n\nRemy's point is that you can not directly specify HTTPS for the login form. \nHowever, if you specify (as per my previous example) a transport guarantee of \nCONFIDENTIAL for your webapp (or part of it) and an authentication method of \nFORM the browser will be redirected to use HTTPS for the login form.\n\nGoing back to your original example, your security constraint is missing the \nauth-constraint section. This might be contributing to your confusion."}, {"count": 7, "tags": [], "bug_id": 23766, "attachment_id": null, "text": "The point I am making is that I only want to encrypt the login page. My web.xml\nsnippet, as is, without the auth-constraint, worked in tomcat4. This\nfunctionality seems to have been dropped in tomcat5, due to changes in servlet\n2.4 spec.\n\nBTW as I understand it, the security constraint in your config called 'login\npages' with the url-pattern /security/, is superfluous and has no effect. Do you\nsee what I mean? Take off the SSL transport guarantee from your protected.jsp,\nand your login page will not be encrypted either. ", "id": 45689, "time": "2003-10-14T22:01:29Z", "creator": "adam.hardy@cyberspaceroad.com", "creation_time": "2003-10-14T22:01:29Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 23766, "text": "Right. Now I understand. You want to protect the login form and only the login \nform with SSL. Hmmm. Tricky.\n\nYou are correct, the 'Login pages' constraint in my example is unnecessary. \nThat's what you get for copying stuff verbatim from the web without \nthinking/checking it ;)\n\nIt isn't a case of this functionality being dropped in TC5, more one of the \nspec now being specific about what should happen if elements of the security \nconstraint are not present. This has closed the loop-hole in the spec you have \nbeen making use of.\n\nI have had a look at the spec and I don't think there is a way to do what you \nwant just with web.xml as the login form uses the user-data constraint of the \nrequested page. As I see it you have three options:\n- Use SSL for everything. Simple to implement. Potential performance hit.\n- Authenticate in the clear. Increases security risk. Might be acceptable in \nsome circumstances.\n- Try to force http/https as required through explicit URLs. Messy. Difficult \nto maintain. Wrecks portability of webapp.\n\nAnyway, with regards to the original bug tomcat 5 behaviour is as per the spec \nand Remy's resolution of INVALID is correct. I suggest that any further \ndiscussion of this topic should be on tomcat-user.", "id": 45700, "time": "2003-10-14T23:55:58Z", "creator": "medthomas@ntlworld.com", "creation_time": "2003-10-14T23:55:58Z", "is_private": false, "attachment_id": null}]
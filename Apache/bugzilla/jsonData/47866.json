[{"attachment_id": null, "tags": [], "creator": "david_syer@hotmail.com", "is_private": false, "count": 0, "id": 130503, "time": "2009-09-18T00:23:03Z", "bug_id": 47866, "creation_time": "2009-09-18T00:23:03Z", "text": "It seems that the WebappClassLoader was stopped?\n\n{noformat}\nCaused by: java.lang.NullPointerException\n\tat org.apache.catalina.loader.WebappClassLoader.findResources(WebappClassLoader.java:994)\n\tat java.lang.ClassLoader.getResources(ClassLoader.java:1016)\n{noformat}\n\nAll I did was launch a server add a context and then ask it to load a resource from its classpath.  It's a bit more complicated than that, so I'll try and narrow it down if needed."}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "I can't reproduce this with a simple test case (r817201 & r817204). If you can provide a patch to that test case that demonstrates the issue that would be great.", "id": 130553, "time": "2009-09-21T04:07:31Z", "bug_id": 47866, "creation_time": "2009-09-21T04:07:31Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 47866, "text": "Sorry for the noise. Should be r817201 and r817207", "id": 130554, "time": "2009-09-21T04:08:45Z", "creator": "markt@apache.org", "creation_time": "2009-09-21T04:08:45Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 47866, "is_private": false, "text": "The problem is that if there is an exception in a ServletContextListener, then Tomcat.start() fails to actually start the server and actually actively tries to stop it, destroying the class loader in the process.  Any background threads started by the listener before it failed can then fail in weird ways, for instance throwing the exception reported above.\n\nTwo things you could do to make it more friendly if you feel like it: 1) throw a more informative exception in the WebappClassLoader, 2) throw an exception when Tomcat.start() encounters this kind of problem, and has already called stop().  \n\nI see this in the log:\n\n{noformat}\n2009-09-21 12:56:19,658 ERROR main [org.apache.catalina.core.StandardContext] - <Error listenerStart>\n2009-09-21 12:56:19,658 ERROR main [org.apache.catalina.core.StandardContext] - <Context [] startup failed due to previous errors>\n{noformat}\n\nBut the exception that caused this is not propagated.  This is probably more important than the original NPE.  DO you want to change the bug summary?", "id": 130559, "time": "2009-09-21T04:58:38Z", "creator": "david_syer@hotmail.com", "creation_time": "2009-09-21T04:58:38Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 47866, "text": "That is a deliberate design decision. A context failing to start isn't sufficient for Tomcat to fail to start. This is consistent with trying to deploy an invalid context whilst Tomcat is running. In that case the context will fail to deploy but Tomcat will continue.\n\nYou can use the getState() method to check the state of a context before you use it.", "id": 130570, "time": "2009-09-22T03:00:32Z", "creator": "markt@apache.org", "creation_time": "2009-09-22T03:00:32Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "jcolestock@gmail.com", "attachment_id": null, "text": "While trying to set up SVN access control, I've noticed an oddity.  While trying to verify that all was working and doing some negative path testing, I noticed that I could login, even though I was not a member of the group specified in the \"require ldap-group\" directive.  I've spent a day googling this, but I can't find any answers.  Any help would be greatly appreciated, as this is about to drive me insane.\n\nI'm running CentOS 5.5 final.  $OpenLDAP: slapd 2.3.43 (Jan 21 2009 03:59:37) $\n\nFrom my apache conf: \n\n<Location /svn>\n  DAV svn\n  SVNPath /usr/local/svn\n  AuthType Basic\n  AuthName \"Your Subversion Repository\"\n  AuthBasicProvider ldap\n  AuthzLDAPAuthoritative on\n  AuthLDAPURL \"ldap://<host>:389/dc=jc,dc=com?uid\n  AuthLDAPGroupAttribute memberUid\n  AuthLDAPGroupAttributeIsDN off\n  Require group cn=app,ou=Group,dc=jc,dc=com\n  AuthzSVNAccessFile /etc/subversion/repos.acl\n  Satisfy all\n</Location>\n\nGroup ldif: \n\ndn: cn=app,ou=Group,dc=jc,dc=com\nobjectClass: posixGroup\nobjectClass: top\ncn: app\nuserPassword: {crypt}x\ngidNumber: 1004\ndescription: bob", "id": 137463, "time": "2010-06-08T22:43:55Z", "bug_id": 49409, "creation_time": "2010-06-08T22:43:55Z", "is_private": false}, {"count": 1, "tags": [], "creator": "covener@gmail.com", "is_private": false, "text": "You're config is not using require ldap-group.", "id": 137480, "time": "2010-06-09T06:11:35Z", "bug_id": 49409, "creation_time": "2010-06-09T06:11:35Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "jcolestock@gmail.com", "attachment_id": null, "is_private": false, "id": 137487, "time": "2010-06-09T08:33:22Z", "bug_id": 49409, "creation_time": "2010-06-09T08:33:22Z", "text": "Sorry about that, copied and pasted in the wrong config. I tried it with ldap-group (repasted the proper config and retested same result, it allows me to login even though I'm not a member of the \"app\" group.   I ran slapd with the loglevel of all, and I didn't even see it make a query to check for the members of the group.  \n\n\n<Location /svn>\n  DAV svn\n  SVNPath /usr/local/svn\n  AuthType Basic\n  AuthName \"Your Subversion Repository\"\n  AuthBasicProvider ldap\n  AuthzLDAPAuthoritative on\n  AuthLDAPURL \"ldap://10.10.0.20:389/dc=jc,dc=com?uid\n  AuthLDAPGroupAttribute memberUid\n  AuthLDAPGroupAttributeIsDN off\n  Require ldap-group cn=app,ou=Group,dc=jc,dc=com\n  AuthzSVNAccessFile /etc/subversion/repos.acl\n  Satisfy all\n</Location>"}, {"count": 3, "tags": [], "text": "mod_authz_svn is authoritative by default, so you need:\n\n   AuthzSVNAuthoritative off\n\nto allow mod_authnz_ldap to have a look in.  Does that work as you expect?", "is_private": false, "bug_id": 49409, "id": 137489, "time": "2010-06-09T08:51:39Z", "creator": "jorton@redhat.com", "creation_time": "2010-06-09T08:51:39Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "jcolestock@gmail.com", "attachment_id": null, "text": "Added \" AuthzSVNAuthoritative off\" still will let me login, even though I'm not a member of the group.", "id": 137490, "time": "2010-06-09T09:00:25Z", "bug_id": 49409, "creation_time": "2010-06-09T09:00:25Z", "is_private": false}, {"count": 5, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 137491, "time": "2010-06-09T09:23:38Z", "bug_id": 49409, "creation_time": "2010-06-09T09:23:38Z", "text": "please include LogLevel debug output during the request, and drop the SVN access control if it's not required to reproduce."}, {"count": 6, "tags": [], "text": "Hope this is what you're looking for: \n\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: >>> slap_listener(ldaps:///)\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: connection_get(29): got connid=29\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: connection_read(29): checking for input on id=29\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: connection_get(29): got connid=29\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: connection_read(29): checking for input on id=29\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: connection_read(29): unable to get TLS client DN, error=49 id=29\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: connection_get(29): got connid=29\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: connection_read(29): checking for input on id=29\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: do_bind\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: >>> dnPrettyNormal: <>\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: <<< dnPrettyNormal: <>, <>\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: do_bind: version=3 dn=\"\" method=128\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: send_ldap_result: conn=29 op=0 p=3\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: send_ldap_response: msgid=1 tag=97 err=0\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: do_bind: v3 anonymous bind\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: connection_get(29): got connid=29\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: connection_read(29): checking for input on id=29\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: do_search\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: >>> dnPrettyNormal: <dc=jc,dc=com>\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: <<< dnPrettyNormal: <dc=jc,dc=com>, <dc=jc,dc=com>\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: ==> limits_get: conn=29 op=1 dn=\"[anonymous]\"\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: => bdb_search\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: bdb_dn2entry(\"dc=jc,dc=com\")\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: search_candidates: base=\"dc=jc,dc=com\" (0x00000001) scope=2\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: => bdb_dn2idl(\"dc=jc,dc=com\")\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: => bdb_equality_candidates (objectClass)\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: => key_read\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: <= bdb_index_read: failed (-30989)\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: <= bdb_equality_candidates: id=0, first=0, last=0\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: => bdb_equality_candidates (objectClass)\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: => key_read\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: <= bdb_index_read 27 candidates\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: <= bdb_equality_candidates: id=27, first=6, last=80\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: => bdb_equality_candidates (uid)\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: => key_read\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: <= bdb_index_read 1 candidates\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: <= bdb_equality_candidates: id=1, first=59, last=59\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: bdb_search_candidates: id=1 first=59 last=59\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: => send_search_entry: conn 29 dn=\"uid=jimmyc,ou=People,dc=jc,dc=com\"\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: <= send_search_entry: conn 29 exit.\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: send_ldap_result: conn=29 op=1 p=3\nJun  9 09:57:33 s_localhost@utl01 slapd[15511]: send_ldap_response: msgid=2 tag=101 err=0", "attachment_id": null, "id": 137492, "creation_time": "2010-06-09T10:02:07Z", "time": "2010-06-09T10:02:07Z", "creator": "jcolestock@gmail.com", "bug_id": 49409, "is_private": false}, {"count": 7, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 137496, "time": "2010-06-09T10:48:32Z", "bug_id": 49409, "creation_time": "2010-06-09T10:48:32Z", "text": "I meant the Apache error log, which has a brief message about the authorizaton lookup. I'm not sure your slapd trace is authorization related."}, {"text": "Sorry about that, here you go: \n\n\n[Wed Jun 09 09:57:28 2010] [debug] mod_authnz_ldap.c(390): [client 127.0.0.1] [3701] auth_ldap authenticate: using URL ldap://10.10.0.20:389/dc=jc,dc=com?uid\n[Wed Jun 09 09:57:28 2010] [debug] mod_authnz_ldap.c(489): [client 127.0.0.1] [3701] auth_ldap authenticate: accepting jimmyc\n[Wed Jun 09 09:57:28 2010] [info] [client 127.0.0.1] Access granted: 'jimmyc' GET svn:/", "tags": [], "creator": "jcolestock@gmail.com", "is_private": false, "count": 8, "id": 137497, "time": "2010-06-09T10:52:04Z", "bug_id": 49409, "creation_time": "2010-06-09T10:52:04Z", "attachment_id": null}, {"text": "If that is the complete debug output it is indicative of another authorization hook taking over the authz process, e.g. mod_authz_svn.  Have you verified whether this is reproducible with mod_authz_svn configured?", "tags": [], "creator": "jorton@redhat.com", "is_private": false, "count": 9, "id": 137595, "time": "2010-06-13T08:12:30Z", "bug_id": 49409, "creation_time": "2010-06-13T08:12:30Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 49409, "text": "Ok I think I got it: \n\n<Location /svn>\nDAV svn\nSVNPath /usr/local/svn\nAuthType Basic\nAuthName \"JC SVN Repository\"\nAuthBasicAuthoritative off\nAuthBasicProvider ldap\nAuthzLDAPAuthoritative on\nAuthLDAPGroupAttribute memberUid\nAuthLDAPGroupAttributeIsDN off\nAuthLDAPURL ldap://10.10.0.20/dc=jc,dc=com?uid??(objectclass=*)\nrequire ldap-group cn=dev,ou=Group,dc=jc,dc=com\n</Location>\n\nLooks like it needed the \"AuthBasicAuthoritative off\" directive and removed the \"AuthzSVNAccessFile\" directive..  \n\nThanks for all your help!", "id": 137617, "time": "2010-06-14T09:57:54Z", "creator": "jcolestock@gmail.com", "creation_time": "2010-06-14T09:57:54Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "text": "The user configuration was fixed, not httpd, so this should be marked as Invalid.", "attachment_id": null, "id": 137624, "creation_time": "2010-06-14T12:13:33Z", "time": "2010-06-14T12:13:33Z", "creator": "trawick@apache.org", "bug_id": 49409, "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 49356, "attachment_id": 25495, "id": 137197, "time": "2010-05-28T20:10:25Z", "creator": "icey502@yahoo.com", "creation_time": "2010-05-28T20:10:25Z", "is_private": false, "text": "Created attachment 25495\nScreen shot of a \"good\" and \"broken\" class that caused the exception.  The difference is in the major version.  The code is identical.\n\nIt appears that the javac target is ignoring the \"source\" and \"target\" options that control which version of class files should be produced.  I hope that I am wrong on this one, so I will attach the info that I have seen....\n\nI used both ant 1.7.x and 1.8.x in witnessing the issue.\n\nWe are currently running java 1.5.xx in production, but developing with 1.6.  Hence, we are compiling to the class level using the following syntax in our ant scripts:\n\n       <javac debug=\"on\" \n               fork=\"true\"\n               source=\"1.5\"\n               target=\"1.5\"\n               destdir=\"${build.dir}/classes/<path omitted for IP reasons>\" \n               srcdir=\"${basedir}/src\"\n               classpathref=\"pio.classpath\">....\n\nI have also attempted this:\n\n    <property name=\"ant.build.javac.target\" value=\"1.5\"/>\n    <property name=\"ant.build.javac.source\" value=\"1.5\"/>\n\n...with the same results, that is, we get this error:\n\njava.lang.UnsupportedClassVersionError: Bad version number in .class file....\n\nWe only get this error when building with ant.  I verified that a command-line javac command, run from the jdk1.6 installation from Sun, using \"-source 1.5 -target 1.5\", produces a class having the major version \"49\", whereas the ant task javac with the same settings produces a class with the major version \"50\" on the same code - which, I assume (and I may be wrong) is at the heart of it.  I made a composite screenshot out of it which I will attach to this message.\n\nAny insight is most welcome.\n\nBest Regards,\n\nCory (icey502@yahoo.com)"}, {"count": 1, "tags": [], "creator": "jkf@apache.org", "attachment_id": null, "is_private": false, "id": 137212, "time": "2010-05-30T03:03:18Z", "bug_id": 49356, "creation_time": "2010-05-30T03:03:18Z", "text": "Using the following build file\n\n\n<?xml version=\"1.0\"?>\n<project default=\"test\" name=\"test\">\n\n    <target name =\"test\">\n        <delete dir=\"$basedir}/classes\"/>\n        <mkdir dir=\"${basedir}/classes/5f/\"/>\n        <mkdir dir=\"${basedir}/classes/6f/\"/>\n        <mkdir dir=\"${basedir}/classes/5nf/\"/>\n        <mkdir dir=\"${basedir}/classes/6nf/\"/>\n        <javac debug=\"on\" \n                fork=\"true\"\n                source=\"1.5\"\n                target=\"1.5\"\n                destdir=\"${basedir}/classes/5f/\" \n                srcdir=\"${basedir}/src\"\n                includeantruntime=\"false\"/>\n        <javac debug=\"on\" \n                fork=\"true\"\n                destdir=\"${basedir}/classes/6f/\" \n                srcdir=\"${basedir}/src\"\n            includeantruntime=\"false\"/>\n        <javac debug=\"on\" \n                fork=\"false\"\n                source=\"1.5\"\n                target=\"1.5\"\n                destdir=\"${basedir}/classes/5nf/\" \n                srcdir=\"${basedir}/src\"\n            includeantruntime=\"false\"/>\n        <javac debug=\"on\" \n                fork=\"false\"\n                destdir=\"${basedir}/classes/6nf/\" \n                srcdir=\"${basedir}/src\"\n            includeantruntime=\"false\"/>\n    </target>\n</project>\n\n\nclasses in compiled to version 5: 0000000: cafe babe 0000 0031 \nclasses in compiled to version 6: 0000000: cafe babe 0000 0032\nforking or not does not influence the result.\n\nAre you sure the destination dir did not contain pre-compiled classes or classes? / classes compiled by another target?\n\n\nPlease verify the above build file in your environment, and check whether the problem is reproducible."}, {"count": 2, "tags": [], "bug_id": 49356, "attachment_id": null, "id": 137255, "time": "2010-06-01T13:52:55Z", "creator": "icey502@yahoo.com", "creation_time": "2010-06-01T13:52:55Z", "is_private": false, "text": "Thank you so much for the sanity check.  I verified this morning that ANT is indeed doing the right thing.  It was completely my fault in not cleaning out certain previously compiled classes.  Apologies for wasting your time on that one.\nThanks again and best regards,\nCory"}]
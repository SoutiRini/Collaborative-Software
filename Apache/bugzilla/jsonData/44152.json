[{"attachment_id": null, "tags": [], "creator": "michael@metaparadigm.com", "text": "Build 2.2.6 from tarball, enable extra/httpd-dav.conf and run litmus 0.11\nBuild 2.2.7-dev from branches/2.2, enable extra/httpd-dav.conf and run litmus\n\n2 regressions:\n\n--- /tmp/litmus-2.2.6.txt\t2007-12-29 17:50:28.000000000 +0800\n+++ /tmp/litmus-2.2.x.txt\t2007-12-29 17:50:54.000000000 +0800\n@@ -88,12 +88,12 @@\n 12. notowner_modify....... pass\n 13. notowner_lock......... pass\n 14. copy.................. pass\n-15. cond_put.............. pass\n+15. cond_put.............. FAIL (PUT conditional on lock and etag failed: 412\nPrecondition Failed)\n 16. fail_cond_put......... pass\n 17. cond_put_with_not..... pass\n 18. cond_put_corrupt_token WARNING: PUT failed with 400 not 423\n     ...................... pass (with 1 warning)\n-19. complex_cond_put...... pass\n+19. complex_cond_put...... FAIL (PUT with complex conditional failed: 412\nPrecondition Failed)\n 20. fail_complex_cond_put. pass\n 21. unlock................ pass\n 22. fail_cond_put_unlocked pass\n@@ -113,11 +113,6 @@\n 36. indirect_refresh...... pass\n 37. unlock................ pass\n 38. finish................ pass\n-<- summary for `locks': of 39 tests run: 39 passed, 0 failed. 100.0%\n+<- summary for `locks': of 39 tests run: 37 passed, 2 failed. 94.9%\n -> 1 warning was issued.", "count": 0, "id": 112279, "time": "2007-12-29T05:02:10Z", "bug_id": 44152, "creation_time": "2007-12-29T05:02:10Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 44152, "is_private": false, "text": "Here is the relevant part of the litmus debug log.\n\n2.2.6\n\nSending request headers:\nHEAD /uploads/litmus/lockme HTTP/1.1\nHost: localhost\nUser-Agent: litmus/0.11 neon/0.26.3\nConnection: TE\nTE: trailers\nAuthorization: Basic bWNsYXJrOnNhZ2kxNzcx\nX-Litmus: locks: 16 (fail_cond_put)\n\nSending request-line and headers:\nRequest sent; retry is 1.\n[status-line] < HTTP/1.1 200 OK\n[hdr] Date: Sat, 29 Dec 2007 10:09:11 GMT\nHeader Name: [date], Value: [Sat, 29 Dec 2007 10:09:11 GMT]\n[hdr] Server: Apache/2.2.7-dev (Unix) DAV/2\nHeader Name: [server], Value: [Apache/2.2.7-dev (Unix) DAV/2]\n[hdr] Last-Modified: Sat, 29 Dec 2007 10:09:10 GMT\nHeader Name: [last-modified], Value: [Sat, 29 Dec 2007 10:09:10 GMT]\n[hdr] ETag: \"ec400e-20-4426a008c3d80\"\nHeader Name: [etag], Value: [\"ec400e-20-4426a008c3d80\"]\n\n\n2.2.7-dev\n\nSending request headers:\nHEAD /uploads/litmus/lockme HTTP/1.1\nHost: localhost\nUser-Agent: litmus/0.11 neon/0.26.3\nConnection: TE\nTE: trailers\nAuthorization: Basic bWNsYXJrOnNhZ2kxNzcx\nX-Litmus: locks: 15 (cond_put)\n\nSending request-line and headers:\nRequest sent; retry is 1.\n[status-line] < HTTP/1.1 200 OK\n[hdr] Date: Sat, 29 Dec 2007 12:53:31 GMT\nHeader Name: [date], Value: [Sat, 29 Dec 2007 12:53:31 GMT]\n[hdr] Server: Apache/2.2.7-dev (Unix) DAV/2\nHeader Name: [server], Value: [Apache/2.2.7-dev (Unix) DAV/2]\n[hdr] Last-Modified: Sat, 29 Dec 2007 12:53:31 GMT\nHeader Name: [last-modified], Value: [Sat, 29 Dec 2007 12:53:31 GMT]\n[hdr] ETag: W/\"ec400e-20-4426c4c4f28c0\"\nHeader Name: [etag], Value: [W/\"ec400e-20-4426c4c4f28c0\"]\n", "id": 112280, "time": "2007-12-29T05:08:23Z", "creator": "michael@metaparadigm.com", "creation_time": "2007-12-29T05:08:23Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "michael@metaparadigm.com", "attachment_id": null, "is_private": false, "id": 112281, "time": "2007-12-29T05:11:24Z", "bug_id": 44152, "creation_time": "2007-12-29T05:11:24Z", "text": "Reversing the changes to http_etag.c fixes the problem.\n\nWhich I guess is this CHANGES entry:\n\n *) core: Change etag generation to produce identical results on\n     32-bit and 64-bit platforms.  PR 40064.  [Joe Orton]\n\n"}, {"count": 3, "tags": [], "bug_id": 44152, "attachment_id": 21331, "id": 112282, "time": "2007-12-29T05:22:05Z", "creator": "michael@metaparadigm.com", "creation_time": "2007-12-29T05:22:05Z", "is_private": false, "text": "Created attachment 21331\nhttp_etags change when reversed solves regression"}, {"count": 4, "text": "Just another quick note. From looking at the debug.log with 2.2.6, the\nlast-modified date is 1 second behind the Date header.\n\nWith 2.2.7-dev, the dates are equal.\n\nI'm am unsure how the patch effects the dates to cause the Weak ETag in\n2.2.7-dev as it does not apparently change any date fields only reads them.\n\nI have run the tests many times to ensure it is not a timing issue.\n", "creator": "michael@metaparadigm.com", "is_private": false, "id": 112283, "time": "2007-12-29T05:29:27Z", "bug_id": 44152, "creation_time": "2007-12-29T05:29:27Z", "tags": [], "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 44152, "attachment_id": null, "id": 112284, "time": "2007-12-29T05:51:45Z", "creator": "michael@metaparadigm.com", "creation_time": "2007-12-29T05:51:45Z", "is_private": false, "text": "The date issue and Etag I mentioned is a red herring.\n\nHere the test is succedding on 2.2.7-dev with the 64bit etag patches reversed\n(Dates are equal and ETag is weak - so not related).\n\nMust be one of the 64 bits casts is putting garbage in the Etag making the\ncondition fail.\n\nThis is a successful run on 32bit Linux with the patch reversed.\n\n\n******* Running test 15: cond_put ********\nah_create, for WWW-Authenticate\nRunning pre_send hooks\nauth: Sending 'Basic' response.\nSending request headers:\nHEAD /uploads/litmus/lockme HTTP/1.1\nHost: localhost\nUser-Agent: litmus/0.11 neon/0.26.3\nConnection: TE\nTE: trailers\nAuthorization: Basic bWNsYXJrOnNhZ2kxNzcx\nX-Litmus: locks: 15 (cond_put)\n\nSending request-line and headers:\nRequest sent; retry is 1.\n[status-line] < HTTP/1.1 200 OK\n[hdr] Date: Sat, 29 Dec 2007 13:46:43 GMT\nHeader Name: [date], Value: [Sat, 29 Dec 2007 13:46:43 GMT]\n[hdr] Server: Apache/2.2.7-dev (Unix) DAV/2\nHeader Name: [server], Value: [Apache/2.2.7-dev (Unix) DAV/2]\n[hdr] Last-Modified: Sat, 29 Dec 2007 13:46:43 GMT\nHeader Name: [last-modified], Value: [Sat, 29 Dec 2007 13:46:43 GMT]\n[hdr] ETag: W/\"ec400e-20-a9136c0\"\nHeader Name: [etag], Value: [W/\"ec400e-20-a9136c0\"]\n[hdr] Accept-Ranges: bytes\nHeader Name: [accept-ranges], Value: [bytes]\n[hdr] Content-Length: 32\nHeader Name: [content-length], Value: [32]\n[hdr] Content-Type: text/plain\nHeader Name: [content-type], Value: [text/plain]\n[hdr] \nEnd of headers.\nRunning post_send hooks\nah_post_send (#0), code is 200 (want 401), WWW-Authenticate is (none)\nRequest ends, status 200 class 2xx, error line:\n200 OK\nRunning destroy hooks.\nRequest ends.\nah_create, for WWW-Authenticate\nRunning pre_send hooks\nauth: Sending 'Basic' response.\nSending request headers:\nPUT /uploads/litmus/lockme HTTP/1.1\nHost: localhost\nUser-Agent: litmus/0.11 neon/0.26.3\nConnection: TE\nTE: trailers\nContent-Length: 32\nIf: (<opaquelocktoken:7da06b5a-b614-11dc-89f6-f543e31a2f21> [W/\"ec400e-20-a9136c0\"])\nAuthorization: Basic bWNsYXJrOnNhZ2kxNzcx\nX-Litmus: locks: 15 (cond_put)\n\nSending request-line and headers:\nSending request body:\nBody block (32 bytes):\n[This\nis\na\ntest\nfile\ncalled\nfoo\n\n]\nRequest sent; retry is 1.\n[status-line] < HTTP/1.1 204 No Content\n[hdr] Date: Sat, 29 Dec 2007 13:46:43 GMT\nHeader Name: [date], Value: [Sat, 29 Dec 2007 13:46:43 GMT]\n[hdr] Server: Apache/2.2.7-dev (Unix) DAV/2\nHeader Name: [server], Value: [Apache/2.2.7-dev (Unix) DAV/2]\n[hdr] Content-Length: 0\nHeader Name: [content-length], Value: [0]\n[hdr] Content-Type: text/plain\nHeader Name: [content-type], Value: [text/plain]\n[hdr] \nEnd of headers.\nRunning post_send hooks\nah_post_send (#0), code is 204 (want 401), WWW-Authenticate is (none)\nRequest ends, status 204 class 2xx, error line:\n204 No Content\nRunning destroy hooks.\nRequest ends.\n"}, {"count": 6, "tags": [], "bug_id": 44152, "text": "It appears the problem is mod_dav:dav_fs_getetag routine not being updating to\ncreate 64bit time in the etags.\n\nPlease apply this patch so we can avoid this regression in 2.2.7\n\nI will verify if the same issue is present in trunk (I think it is)", "id": 112285, "time": "2007-12-29T06:36:41Z", "creator": "michael@metaparadigm.com", "creation_time": "2007-12-29T06:36:41Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 44152, "attachment_id": 21332, "id": 112286, "time": "2007-12-29T06:37:35Z", "creator": "michael@metaparadigm.com", "creation_time": "2007-12-29T06:37:35Z", "is_private": false, "text": "Created attachment 21332\nupdate to print 64 bit time in the etag"}, {"count": 8, "tags": [], "bug_id": 44152, "attachment_id": 21333, "id": 112287, "time": "2007-12-29T06:40:30Z", "creator": "michael@metaparadigm.com", "creation_time": "2007-12-29T06:40:30Z", "is_private": false, "text": "Created attachment 21333\nAll fields should be 64bit for parity with http_etag implementation"}, {"count": 9, "text": "Just verified that the same issue is present in trunk 2.3.0-dev.\n\nPatch applies there with 4 lines offset.\n\nI get no litmus failures with this patch applied on both 2.2.7-dev and 2.3.0-dev\n", "creator": "michael@metaparadigm.com", "is_private": false, "id": 112288, "time": "2007-12-29T06:59:53Z", "bug_id": 44152, "creation_time": "2007-12-29T06:59:53Z", "tags": [], "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 44152, "text": "Created attachment 21334\nmissed mtime only case", "id": 112289, "time": "2007-12-29T07:09:30Z", "creator": "michael@metaparadigm.com", "creation_time": "2007-12-29T07:09:30Z", "is_private": false, "attachment_id": 21334}, {"count": 11, "tags": [], "bug_id": 44152, "text": "Thanks for the patch. Committed a slightly modified version of the patch\n(r607437, http://svn.apache.org/viewvc?rev=607437&view=rev) plus a warning to\nthe FileETAG documentation that changing the default could cause breakage with\nconditional WebDAV requests against mod_dav_fs provided backends.", "id": 112290, "time": "2007-12-29T08:08:36Z", "creator": "rpluem@apache.org", "creation_time": "2007-12-29T08:08:36Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 44152, "attachment_id": null, "id": 112291, "time": "2007-12-29T08:22:06Z", "creator": "rpluem@apache.org", "creation_time": "2007-12-29T08:22:06Z", "is_private": false, "text": "Proposed for backport as r607441 (http://svn.apache.org/viewvc?rev=607441&view=rev)."}, {"count": 13, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "text": "Fixed in 2.2.8.", "id": 113015, "time": "2008-01-19T11:50:48Z", "bug_id": 44152, "creation_time": "2008-01-19T11:50:48Z", "attachment_id": null}]
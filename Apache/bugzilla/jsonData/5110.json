[{"count": 0, "tags": [], "bug_id": 5110, "text": "On Tomcat 4.0.1, I'm getting an Error 500 caused by the following exception\nwhen I should get a 403 forbidden error-page.\n\nThe exception : \n\t2001-11-20 16:03:49 HttpProcessor[8080][4] process.invoke\n\tjava.lang.NullPointerException\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.status(ErrorDispatcherValve.\njava:291)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.\njava:180)\n\tat\norg.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:5\n64)\n\tat\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:170\n)\n\tat\norg.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:5\n64)\n\tat\norg.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:462)\n\tat\norg.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:5\n64)\n\tat\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n\tat\norg.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java\n:163)\n\tat\norg.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:5\n66)\n\tat\norg.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n\tat\norg.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat\norg.apache.catalina.connector.http.HttpProcessor.process(HttpProcessor.java:\n1011)\n\tat\norg.apache.catalina.connector.http.HttpProcessor.run(HttpProcessor.java:1106\n)\n\tat java.lang.Thread.run(Thread.java:484)\n\nTo produce this error...............\n\n1) I added <user name=\"junk\"   password=\"junk1\" roles=\"junkrole\" /> to\ntomcat-users.xml.\n\n2)I added the following to /examples/WEB-INF/web.xml (between servlet\nmapping and taglib sections)\n\n   <error-page>\n      <error-code>403</error-code>\n      <location>/examples/jsp/forbidden.jsp</location>\n   </error-page>\n\n3) I added the following /examples/jsp/forbidden.jsp file\n\t<html>\n\t<body>forbidden!</body>\n\t</html>\n\n4)I started Tomcat 4.0.1\n\n5)I went to http://localhost:8080/examples/jsp/security/protected/index.jsp\n\n6) I logged in as used junk with password junk1\n\n7) I was sent to\nhttp://localhost:8080/examples/jsp/security/protected/j_security_check\nThe file catalina_log.2001-11-20.txt contained the exception listed above\n(NullPointerException).\n\n8) I restarted tomcat, and logged in again as role1 (pwd tomcat) without\ndifficulty.\n\nThis was done on a default installation of Tomcat 4.0.1 on a Win2k box.\nI originally discovered this error using JNDIRealm on a Solaris box.", "id": 8289, "time": "2001-11-26T17:02:13Z", "creator": "casey.bragg@algx.com", "creation_time": "2001-11-26T17:02:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 5110, "text": "That has been fixed already, and it occurred when using a sendError before the \nrequest mapping was complete.\nThe fix will be in 4.0.2, and is also in the nightly builds.", "id": 8291, "time": "2001-11-26T17:22:32Z", "creator": "remm@apache.org", "creation_time": "2001-11-26T17:22:32Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 5110, "attachment_id": null, "id": 8333, "time": "2001-11-27T09:08:03Z", "creator": "casey.bragg@algx.com", "creation_time": "2001-11-27T09:08:03Z", "is_private": false, "text": "As of jakarta-tomcat-4.0-20011127 nightly build : \n\nFollowing the same steps I described in the original bug description now \nresults in a 404 error now.  In tomcat-4.0.1 the procedure resulted in a 500 \nerror.   The correct behavior should result in the error handler page specified \nfor 403 errors by the error-page descriptor in web.xml.\n\nThe text of the error tomcat reports : \nHTTP Status 404 - /examples/jsp/security/protected/j_security_check\n--------------------------------------------------------------------------------\ntype Status report\nmessage /examples/jsp/security/protected/j_security_check\ndescription The requested resource \n(/examples/jsp/security/protected/j_security_check) is not available.\n--------------------------------------------------------------------------------\nApache Tomcat/4.1-dev\n\n\n\nFrom localhost_examples_log\n\n2001-11-27 11:00:19 Authenticator[/examples]: Requesting login page normally\n2001-11-27 11:00:19 Authenticator[/examples]:  Calling accessControl()\n2001-11-27 11:00:19 Authenticator[/examples]:  Allow access to login \npage /examples/jsp/security/protected/login.jsp\n2001-11-27 11:00:19 Authenticator[/examples]:  Successfully passed all security \nconstraints\n2001-11-27 11:00:19 StandardContext[/examples]: Mapping contextPath='/examples' \nwith requestURI='/examples/jsp/security/protected/login.jsp' and \nrelativeURI='/jsp/security/protected/login.jsp'\n2001-11-27 11:00:19 StandardContext[/examples]: Decoded \nrelativeURI='/jsp/security/protected/login.jsp'\n2001-11-27 11:00:19 StandardContext[/examples]:   Trying exact match\n2001-11-27 11:00:19 StandardContext[/examples]:   Trying prefix match\n2001-11-27 11:00:19 StandardContext[/examples]:   Trying extension match\n2001-11-27 11:00:19 StandardContext[/examples]:  Mapped to servlet 'jsp' with \nservlet path '/jsp/security/protected/login.jsp' and path info 'null' and \nupdate=true\n2001-11-27 11:00:19 jsp: init\n2001-11-27 11:00:36 Authenticator[/examples]: Security checking request \nPOST /examples/jsp/security/protected/j_security_check\n2001-11-27 11:00:36 Authenticator[/examples]: Authenticating username 'junk'\n2001-11-27 11:00:36 Authenticator[/examples]: Authentication of 'junk' was \nsuccessful\n2001-11-27 11:00:36 Authenticator[/examples]: Redirecting to \noriginal '/examples/jsp/security/protected'\n2001-11-27 11:00:36 Authenticator[/examples]:  Failed authenticate() test\n2001-11-27 11:00:37 Authenticator[/examples]: Security checking request \nGET /examples/jsp/security/protected\n2001-11-27 11:00:37 Authenticator[/examples]:   Checking \nconstraint 'SecurityConstraint[Protected Area]' against \nGET /jsp/security/protected --> true\n2001-11-27 11:00:37 Authenticator[/examples]:  Subject to constraint \nSecurityConstraint[Protected Area]\n2001-11-27 11:00:37 Authenticator[/examples]:  Calling checkUserData()\n2001-11-27 11:00:37 Authenticator[/examples]:   User data constraint has no \nrestrictions\n2001-11-27 11:00:37 Authenticator[/examples]:  Calling authenticate()\n2001-11-27 11:00:37 Authenticator[/examples]: Restore request from \nsession '1893B077F4C291004710C0E058D34324'\n2001-11-27 11:00:37 Authenticator[/examples]: Authenticated 'junk' with \ntype 'FORM'\n2001-11-27 11:00:37 Authenticator[/examples]: Proceed to restored request\n2001-11-27 11:00:37 Authenticator[/examples]:  Calling accessControl()\n2001-11-27 11:00:37 Authenticator[/examples]:  Failed accessControl() test\n2001-11-27 11:00:37 StandardContext[/examples]: Mapping contextPath='/examples' \nwith requestURI='/examples/examples/jsp/forbidden.jsp' and \nrelativeURI='/examples/jsp/forbidden.jsp'\n2001-11-27 11:00:37 StandardContext[/examples]: Decoded \nrelativeURI='/examples/jsp/forbidden.jsp'\n2001-11-27 11:00:37 StandardContext[/examples]:   Trying exact match\n2001-11-27 11:00:37 StandardContext[/examples]:   Trying prefix match\n2001-11-27 11:00:37 StandardContext[/examples]:   Trying extension match\n2001-11-27 11:00:37 StandardContext[/examples]:  Mapped to servlet 'jsp' with \nservlet path '/examples/jsp/forbidden.jsp' and path info 'null' and update=true\n\n\nOutput of http://localhost:8080/examples/jsp/forbidden.jsp\n\t<html>\n\t<body>forbidden!</body>\n\t</html>"}, {"count": 3, "tags": [], "bug_id": 5110, "attachment_id": null, "id": 8335, "time": "2001-11-27T09:11:23Z", "creator": "remm@apache.org", "creation_time": "2001-11-27T09:11:23Z", "is_private": false, "text": "The <error-page> should be relative to the context root. So it should \nbe /jsp/forbidden.jsp"}, {"count": 4, "tags": [], "creator": "remm@apache.org", "is_private": false, "id": 8465, "attachment_id": null, "bug_id": 5110, "creation_time": "2001-11-30T08:35:40Z", "time": "2001-11-30T08:35:40Z", "text": "*** Bug 5197 has been marked as a duplicate of this bug. ***"}]
[{"count": 0, "tags": [], "bug_id": 20376, "text": "For some unknown reason, I found out that MSIE 6.0 with SP 1 not including the \ncummulative patch released on April 2003 send duplicate post requests for any \njsp page. I use IIS with Jakarta ISAPI dll. tomcat version is 4.1.24. \nI found out when trying to debug intermittent server not found errors for a jsp \npage where i know the server is up and running and connection is fine. \nI used TCP trace Etheral where I found out that IE is always posting two \nidentical requests except for the HTTP_REFERER header. \nAfter double checking IIS logs I found out that this is correct where there are \nlots of duplicate enteries.\nIt is not an IE bug because the request comes fine to regular asp pages running \non the same server.\nThis bug is very annoying and completely unpredicatable. Havent' noticed it \nmuch with IE 5.5 or IE 5.0", "id": 38077, "time": "2003-05-30T22:53:13Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-05-30T22:53:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 20376, "text": "Any body has an idea about this bug?", "id": 38175, "time": "2003-06-02T14:26:42Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-06-02T14:26:42Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 20376, "attachment_id": null, "id": 38179, "time": "2003-06-02T14:45:19Z", "creator": "mvdijken@madocke.nl", "creation_time": "2003-06-02T14:45:19Z", "is_private": false, "text": "Could you please post a test case (URL/html) which posts twice? I've been\ndeveloping heavily for IE 6 and haven't found anything to that matter. Also, are\nyou certain there's nothing wrong with the way the form itself is built?"}, {"count": 3, "tags": [], "bug_id": 20376, "text": "The problem with the form was just the way I found out about the problem. But \nactually the problem itself is persistent, even on get requests. \nIt seems like all IE 6 Sp 1 (without the latest cummulative patch ) clients \nthat is accessing Tomcat are doing duplicate requests.\nI think it has something to do with the Jakarta ISAPI.dll that might be the \nproblem.\nSomething to mention is I have a CompressIt plugin installed for IIS but i \ndon't think that can cause any problems. it doesn't with asp pages at least.\n", "id": 38204, "time": "2003-06-02T19:01:41Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-06-02T19:01:41Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 20376, "attachment_id": null, "id": 38241, "time": "2003-06-03T07:09:30Z", "creator": "mvdijken@madocke.nl", "creation_time": "2003-06-03T07:09:30Z", "is_private": false, "text": "Strange indeed, have you tried doing an HTTP GET manually using telnet? The only\nthing I can think of, is that somehow IE must be convinced that the HTTP\nconnection wasn't established correctly. Try the following:\n\ntelnet [servername] 80\\n\nGET /[something.jsp] HTTP/1.1\\n\nHost: [servername]\\n\n\\n\n\\n\n\nNow compare the results from your ASP pages and your JSP pages. If there's a\nsignificant difference please post it back. \n\nAnother thing to try is to have tomcat run standalone as well on port 8080 and\ncheck whether the problem persists (probably not, but at least that places the\nproblem with the coupling between Tomcat and IIS)"}, {"count": 5, "tags": [], "bug_id": 20376, "attachment_id": null, "text": "I followed what you have requested and here is the difference between the two \nFor IIS alone \nGET /admin/account.asp\nHTTP/1.1 302 Object moved\nServer: Microsoft-IIS/5.0\nDate: Mon, 09 Jun 2003 18:07:44 GMT\nLocation: ../index.shtml\nConnection: Keep-Alive\nContent-Length: 135\nContent-Type: text/html\nSet-Cookie: ASPSESSIONIDQQGGQLVQ=NPMOPHDBBEPJAHDCPICDGOBA; path=/\nCache-control: private\n\n<head><title>Object moved</title></head>\n                                        <body><h1>Object Moved</h1>This object \nmay be found <a HREF=\"../index.shtml\">here</a>.</body>\n\nAnd for IIS with Tomcat it is \nGET /jsp/calendar/calendar.jsp\nHTTP/1.1 302\nServer: Microsoft-IIS/5.0\nDate: Mon, 09 Jun 2003 18:06:56 GMT\nSet-Cookie: JSESSIONID=BC7C3F989CA9E8447B631260657A5304; Path=/jsp\nLocation: http://www.brainfuse.com\nContent-Type: text/html;charset=ISO-8859-1\nContent-Length: 0\n\nOne of the few things to notice is :\n1. There is response message after the response code from IIS with Tomcat\n2. There is no Connection:Keep Alive flag \n3. the cookie is pointing to /jsp not to /\nAparently this problem has been eliminated after I installed the latest IE \ncummulative patches from microsoft. But the problem is what about all these \nother clients that are having Win XP and IE 6.0 that DONOT upgrade.\n\nLet me know what you guys think?\n", "id": 38607, "time": "2003-06-09T18:16:33Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-06-09T18:16:33Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 20376, "text": "I executed the test again with a page that doesn't require login in:\nHere are the results from IIS:\nHTTP/1.1 200 OK\nServer: Microsoft-IIS/5.0\nDate: Mon, 09 Jun 2003 18:31:58 GMT\nConnection: Keep-Alive\nContent-Length: 12348\nContent-Type: text/html\nSet-Cookie: ASPSESSIONIDQQGGQLVQ=ABNOPHDBFFOGJKPNOKEPCEJJ; path=/\nCache-control: private\nPage content goes here just html\n\nHere are the results from Tomcat as ISAPI plugin:\nGET /jsp/index.jsp\nHTTP/1.1 200\nServer: Microsoft-IIS/5.0\nDate: Mon, 09 Jun 2003 18:32:20 GMT\nSet-Cookie: JSESSIONID=2BB72CC543D77619DA8376588DC0A800; Path=/jsp\nContent-Type: text/html;charset=ISO-8859-1\nPage content goes here just html\n\nAnd here are the results from Tomcat as Standalone:\nGET /jsp/index.jsp\n<!doctype html public \"-//w3c//dtd html 4.0 \ntransitional//en\" \"http://www.w3.org/TR/REC-html40/strict.dtd\">\n<html>\n\n\nYou will notice when Tomcat as ISAPI, \n1. There is no response code ( I don't think it is a big deal. ) \n2. there is no Content Length ( I think this is a big one ) .\n3. The Content Type is different there is character set appended. \n4. The Keep Alive flag is not there.\n\n\nWhen using Tomcat as a standanlone, there are no headers what so ever, I am not \nsure why but this is the case.\n", "id": 38612, "time": "2003-06-09T18:41:33Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-06-09T18:41:33Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "text": "A few things:\n\n- There IS a response code sent with ISAPI. This would cause trouble, but \ndoesn't since it is there. (The standard OK is an arbitrary string and not \nrequired)\n- The Content length is REQUIRED by the HTTP/1.1 spec. There's a high likeness \nthis would cause trouble with some browsers.\n- The Connection keep-alive missing header only signifies that the browser \nwill have to make a new connection for every resource. That's no problem.\n- The charset is allowed but not required for as far as I know.\n\nI've tried my own install of tomcat for some resources standalone and all \nheaders are nicely sent back. However this is with Tomcat 4.1.18 not like your \n4.1.24. I don't have the time to upgrade my system and the problem doesn't \nexist with Tomcat standalone, so I'll skip that.\n\nI think a Tomcat expert will need to examine this info to see if the problem \nwith the missing content-length always occurs with the ISAPI plugin and if \nthis is the source of the problem. I am not that expert, I only know a little \nabout the HTTP spec and browser/server traffic. Turning this over to anyone \nwho'll take it...", "attachment_id": null, "id": 38660, "creator": "mvdijken@madocke.nl", "time": "2003-06-10T10:26:16Z", "bug_id": 20376, "creation_time": "2003-06-10T10:26:16Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 20376, "attachment_id": null, "text": "How can I change the page so that it tells the content length even though it is \ndynamic. The only way I would think of is to add everything into a StringBuffer \nand then calculate the stringbuffer.\nThere must be an easier way.\nSomebody Please help.", "id": 38685, "time": "2003-06-10T17:49:08Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-06-10T17:49:08Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 20376, "text": "That's explicitly NOT the job of the web developer but one of the servlet\ncontainer. I reckon there must be some problem with either the ISAPI plugin or\nwith that specific version of Tomcat. \n\nAs said before this will have to be looked into by one of the Tomcat developers.", "id": 38711, "time": "2003-06-11T07:03:17Z", "creator": "mvdijken@madocke.nl", "creation_time": "2003-06-11T07:03:17Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 20376, "text": "Ok, I'm not a Windows developer, so I have no clue about the IIS version of \nmod_jk.  However, your tests are flawed if you want someone that could \nunderstand the issues to look at this.  \n\nFirstly, you should test with including a protocol:\n  GET /jsp/calendar/calendar.jsp HTTP/1.0\n\nEven better if you can test with HTTP/1.1 and include a Host header.\n\nMost of the differences you've documented are due to Tomcat thinking that your \nclient doesn't even speak the HTTP/1.0 protocol, and so is trying to talk down \nto you.", "id": 38713, "time": "2003-06-11T07:26:48Z", "creator": "william.barker@wilshire.com", "creation_time": "2003-06-11T07:26:48Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 20376, "attachment_id": null, "text": "I think there were an IE problem that was fixed by the Feburary 2003 update, \nthe issue seems to be related to this bug \n329802 BUG: Proxy Authentication Through IAuthenticate May Fail on Secure URL \nhttp://support.microsoft.com/default.aspx?scid=kb;EN-US;329802\n\n\nThe only thing is I can't see how they are related, the symptoms are the same \nand the fix for the problem described fixes that problem that I had with my IE. \nBut the only explanation is that mod_jk acts as a proxy or even IIS acts as a \nproxy. The problem described is an issue only if the application is using \nIAuthenticate interface. Neither the jsp pages or isapi deal with that if I am \ncorrect. \n So now the question is why MSIE thinks of mod_jk or IIS as a proxy, and if \nthere is any work arounds. \nThis is a significant problem with IIS and MSIE 6 SP 1 which was published by \nMS on all XP machines sold in the past year or so. Imagine if you are doing a \npurchase you are paying for your items with a credit card and all of a sudden \nIE shows dns error.\nAny work around would be appreciated.\n", "id": 38724, "time": "2003-06-11T15:52:13Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-06-11T15:52:13Z", "is_private": false}, {"count": 12, "tags": [], "creator": "sgabriel@brainfuse.com", "attachment_id": null, "text": "Any one is having this problem, I have noticed it on more than one machine so \nfar.\n", "id": 39506, "time": "2003-06-26T18:40:01Z", "bug_id": 20376, "creation_time": "2003-06-26T18:40:01Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 20376, "attachment_id": null, "text": "I think this bug is the problem. this is very critical issue ladies and \ngentleman. Can any body tell me the last version that doesn't have this bug \nand works with AJP 1.3\n\n*** This bug has been marked as a duplicate of 15278 ***", "id": 39720, "time": "2003-07-01T03:40:51Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-07-01T03:40:51Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 20376, "attachment_id": null, "id": 39739, "time": "2003-07-01T13:01:17Z", "creator": "Juergen-Klaus.Muth@abg.ericsson.se", "creation_time": "2003-07-01T13:01:17Z", "is_private": false, "text": "I had the same problem with a self-written webserver.\nDuplicate requests occured in the following cases:\n- POSTs with multiple of 2047 bytes of data\n- the response is written back before all data from the input stream is read\n- the response has a certain length.\n\nI think that the request length header sent by MSIE does not contain the last\nCR LF.\nWhen I read these bytes too, I had no problems anymore.\n\nP.S.:With UTF-8 encoded pages the troubles occured more often."}, {"count": 15, "tags": [], "bug_id": 20376, "attachment_id": null, "id": 39768, "time": "2003-07-01T16:15:23Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-07-01T16:15:23Z", "is_private": false, "text": "Do you have any suggestions how can I fix that on Tomcat?\n"}, {"count": 16, "tags": [], "bug_id": 20376, "attachment_id": null, "id": 39770, "time": "2003-07-01T16:24:20Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-07-01T16:24:20Z", "is_private": false, "text": "Do you have a test case like a jsp page that does this kind of post so that i \ncan find a work around, I tried to create one but it is very hard to \nreplicate, I am working on a mission critical system that cannot tolerate this \nkind of error.\n\nAlso regarding your comments, you mean IE doesn't send the content length in \neach of the scenarios that you mentioned? \nSome of these scenarios seems to be dependant on each other like - the \nresponse is written back before all data from the input stream is read. Why \nwould the webserver do that? is because of the first case?\n\nP.S. I have been going back and forth about this bug for almost four month any \nhelp would be greatly appreciated?"}, {"count": 17, "tags": [], "bug_id": 20376, "attachment_id": null, "text": "Do you think if I use something like Orielley servlet package to read the \nrequest input stream that might be better.\nThanks in advance", "id": 39779, "time": "2003-07-01T16:40:52Z", "creator": "sgabriel@brainfuse.com", "creation_time": "2003-07-01T16:40:52Z", "is_private": false}, {"count": 18, "tags": [], "bug_id": 20376, "text": "Hi! (Sorry for the long delay)\n\nI'm sorry, but I can't send you an example: it is in our product, which is a \nweb based management system. There is one page which always produces the fault. \nI tried to extract it, but when it is not used in the frameset, the error \ndoesn't occur?!?!\n\nTo your question: The webservers read up to the reported content length. The IE\nSOMETIMES(!) adds a CRLF that does not contribute to that length. Depending on \nrequest length, buffers, and maybe the network the IE considers that data as \nsent or not. If not, it complains about a response (and sends the request a \nsecond time).\n\nI had problems again, since I used a plain InputStream and trying to read the 2 \nunreported characters (CRLF) hanged up my application, since sometimes they are \nnot there. So what I do now, i that I create a buffer of <cont-length>+2 bytes \nsize and do a read with that array. If the characters are there, they are read, \nif not, I see it in the return value of my read. But I did that in my web \nserver. If you use Tomcat, then you don't have direct control over that part. \nBut what if you use the ServletInputStream to parse the post data yourself? \nThis might work in Servlets, but in JSPs it might be tricky.\n\nI don't know the O'Reilly package so I can't help you on that.\n\nSo my suggestion would be that you try a read (with timeout!) on the \nInputStream if you can get access and consume the left bytes.\n\nJ\u00fcrgen", "id": 40058, "time": "2003-07-07T11:17:05Z", "creator": "Juergen-Klaus.Muth@abg.ericsson.se", "creation_time": "2003-07-07T11:17:05Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "bug_id": 20376, "text": "As anyone tried a different browser", "id": 50401, "time": "2004-01-12T13:01:35Z", "creator": "ccs@exel.co.uk", "creation_time": "2004-01-12T13:01:35Z", "is_private": false, "attachment_id": null}]
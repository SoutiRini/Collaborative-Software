[{"count": 0, "tags": [], "bug_id": 51910, "attachment_id": null, "text": "I've hit it when testing 7.0.22 RC.\n\n1. Configure Tomcat with NIO connector\n2. Start Tomcat and open Comet chat example\nhttp://localhost:8080/examples/jsp/chat/index.jsp\n3. Type some Nickname and press button to start chat\nThe chat log will be in the second frame at the lower half of the page.\n4. While chat log is active (Browser shows page as being loaded),\nshut down Tomcat.\n5. Observe NPE in the logs:\n\n28.09.2011 15:55:32 org.apache.coyote.AbstractProtocol stop\nINFO: Stopping ProtocolHandler [\"http-nio-8080\"]\n28.09.2011 15:55:33 org.apache.catalina.connector.CoyoteAdapter event\nSEVERE: null\njava.lang.NullPointerException\n        at org.apache.catalina.core.StandardWrapperValve.event(StandardWrapperValve.java:354)\n        at org.apache.catalina.core.StandardContextValve.event(StandardContextValve.java:192)\n        at org.apache.catalina.valves.ValveBase.event(ValveBase.java:226)\n        at org.apache.catalina.core.StandardHostValve.event(StandardHostValve.java:245)\n        at org.apache.catalina.valves.ValveBase.event(ValveBase.java:226)\n        at org.apache.catalina.valves.ValveBase.event(ValveBase.java:226)\n        at org.apache.catalina.core.StandardEngineValve.event(StandardEngineValve.java:138)\n        at org.apache.catalina.connector.CoyoteAdapter.event(CoyoteAdapter.java:211)\n        at org.apache.coyote.http11.Http11NioProcessor.event(Http11NioProcessor.java:131)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.>\n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1554)\n        at org.apache.tomcat.util.net.NioEndpoint.processSocket(NioEndpoint.java:717)\n        at org.apache.tomcat.util.net.NioEndpoint$Poller.cancelledKey(NioEndpoint.java:1026)\n        at org.apache.tomcat.util.net.NioEndpoint$Poller.processKey(NioEndpoint.java:1169)\n        at org.apache.tomcat.util.net.NioEndpoint$Poller.timeout(NioEndpoint.java:1352)\n        at org.apache.tomcat.util.net.NioEndpoint$Poller.run(NioEndpoint.java:1085)\n        at java.lang.Thread.run(Thread.java:662)\n28.09.2011 15:55:33 org.apache.coyote.AbstractProtocol stop\nINFO: Stopping ProtocolHandler [\"ajp-bio-8009\"]", "id": 149906, "time": "2011-09-28T12:05:19Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-09-28T12:05:19Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 51910, "attachment_id": null, "text": "It is reproducible with APR connector as well.\n\n===================\nINFO: Stopping ProtocolHandler [\"http-apr-8080\"]\n28.09.2011 18:31:25 org.apache.catalina.connector.CoyoteAdapter event\nSEVERE: null\njava.lang.NullPointerException\n\tat org.apache.catalina.core.StandardWrapperValve.event(StandardWrapperValve.java:354)\n\tat org.apache.catalina.core.StandardContextValve.event(StandardContextValve.java:192)\n\tat org.apache.catalina.valves.ValveBase.event(ValveBase.java:226)\n\tat org.apache.catalina.core.StandardHostValve.event(StandardHostValve.java:245)\n\tat org.apache.catalina.valves.ValveBase.event(ValveBase.java:226)\n\tat org.apache.catalina.valves.ValveBase.event(ValveBase.java:226)\n\tat org.apache.catalina.core.StandardEngineValve.event(StandardEngineValve.java:138)\n\tat org.apache.catalina.connector.CoyoteAdapter.event(CoyoteAdapter.java:211)\n\tat org.apache.coyote.http11.Http11AprProcessor.event(Http11AprProcessor.java:133)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:513)\n\tat org.apache.tomcat.util.net.AprEndpoint$SocketEventProcessor.run(AprEndpoint.java:1869)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n\tat java.lang.Thread.run(Thread.java:662)\n28.09.2011 18:31:25 org.apache.coyote.AbstractProtocol stop\nINFO: Stopping ProtocolHandler [\"ajp-apr-8009\"]\n===================", "id": 149916, "time": "2011-09-28T14:32:54Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-09-28T14:32:54Z", "is_private": false}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 150019, "time": "2011-10-01T14:13:39Z", "bug_id": 51910, "creation_time": "2011-10-01T14:13:39Z", "text": "Fixed in trunk and 7.0.x and will be included in 7.0.23 onwards."}]
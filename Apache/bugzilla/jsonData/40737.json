[{"count": 0, "tags": [], "bug_id": 40737, "attachment_id": null, "text": "I'm attempting to do a basic rewrite to force all hits to a consistent URI,\ni.e.:   IP-only hits, miXedCase hostnames, http://etc.. hits are all redirected\nto a consistent https://www.example.com/\n\n\nMy server configuration/rewrite rules are as follows:\n\n  ServerName www.example.com\n  RewriteEngine On\n  RewriteCond %{HTTP_HOST} !^%{SERVER_NAME}$ [OR]\n  RewriteCond %{SERVER_PORT] !^443$\n  RewriteRule (.*) https://%{SERVER_NAME}$1 [L,R=301]\n\nAttempting a hit on https://wWw.exAMPLe.COm produces the following log entry\n\n(4) RewriteCond: input='wWw.exAMPLe.COm' pattern='!^%{SERVER_NAME}$' => matched\n(2) rewrite / -> https://www.example.com/\n(2) explicitly forcing redirect with https://www.example.com/\n\nand then we enter into an infinite redirection loop, as the HTTP_HOST will never\nmatch the literal string '%{SERVER_NAME}'. Rewriting the Cond rule as\n\n  RewriteCond %{HTTP_HOST} !^www.example.com$ [OR]\n\nsolves the redirect, as the rule match will fail when the HTTP_HOST properly\nmatches the SERVER_NAME.\n\nEnabling expansion of %{} variables in the CondPattern would allow writing\ngeneric rules (as I attempted above) which could be slurped in at various places\nin the .conf files using Include, without having to customize them for each and\nevery vhost requiring such redirection.\n\n\nThis was all done on a RedHat Enterprise 4 ES (Nahant Update 4) server, with\nFireFox 1.5.0.7 as the client and Apache 2.0.52-28 (most recent up2date\nversion). Problem should be consistent across all version of Apache and mod_rewrite.\n\nThanks for your time.", "id": 94749, "time": "2006-10-11T21:11:11Z", "creator": "mbuchmann@shaw.ca", "creation_time": "2006-10-11T21:11:11Z", "is_private": false}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "id": 94755, "attachment_id": null, "bug_id": 40737, "creation_time": "2006-10-12T02:45:13Z", "time": "2006-10-12T02:45:13Z", "text": "This would create a big performance penalty as it would require to recompile the\nregular expression each time a rule is used. Today they are compiled during\nserver startup."}, {"count": 2, "tags": [], "bug_id": 40737, "attachment_id": null, "text": "Try\n\nRewriteCond %{HTTP_HOST}%{SERVER_NAME} !^(.*)\\1$ \n\ninstead.", "id": 94758, "time": "2006-10-12T03:04:18Z", "creator": "rpluem@apache.org", "creation_time": "2006-10-12T03:04:18Z", "is_private": false}, {"count": 3, "tags": [], "creator": "mbuchmann@shaw.ca", "is_private": false, "id": 94766, "attachment_id": null, "bug_id": 40737, "creation_time": "2006-10-12T08:14:40Z", "time": "2006-10-12T08:14:40Z", "text": "That works perfectly. Thanks!"}]
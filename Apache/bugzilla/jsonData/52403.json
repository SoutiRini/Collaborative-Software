[{"count": 0, "tags": [], "bug_id": 52403, "attachment_id": null, "is_private": false, "id": 152481, "time": "2011-12-31T00:33:19Z", "creator": "parry@plarry.com", "creation_time": "2011-12-31T00:33:19Z", "text": "Server info:\n\nLinux ubuntu-server 3.0.0-14-server #23-Ubuntu SMP Mon Nov 21 20:49:05 UTC 2011 x86_64 x86_64 x86_64 GNU/Linux\nServer version: Apache/2.2.20 (Ubuntu)\nPHP 5.3.6-13ubuntu3.3 with Suhosin-Patch (cli) (built: Dec 13 2011 18:18:37) \n\nI am using the default apache website except that I have the \"FallbackResource /index.php\" configured under <Directory /var/www/>. The fallback to the index.php seems to work great EXCEPT when I request a non-existent PHP file from the webroot directory. Any other file extension works fine in the webroot but any filename with the .php extension gets a 404 error response. If I call that non-existent PHP file from a bogus/non-existent directory, it works.\n\nFor example:\nGET /a.php <--404 Error\nGET /bogus/a.php <--Falls back to /index.php\nGET /a.html <--Falls back to /index.php\n\nSee output below:\n\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\nGET /a.php HTTP/1.1\nHOST: localhost\nConnection: close\n\nHTTP/1.1 404 Not Found\nDate: Sat, 31 Dec 2011 00:21:54 GMT\nServer: Apache/2.2.20 (Ubuntu)\nVary: Accept-Encoding\nContent-Length: 278\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>404 Not Found</title>\n</head><body>\n<h1>Not Found</h1>\n<p>The requested URL /a.php was not found on this server.</p>\n<hr>\n<address>Apache/2.2.20 (Ubuntu) Server at localhost Port 80</address>\n</body></html>\nConnection closed by foreign host.\n\n\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\nGET /nodir/a.php HTTP/1.1\nHOST: localhost\nConnection: close\n\nHTTP/1.1 200 OK\nDate: Sat, 31 Dec 2011 00:22:11 GMT\nServer: Apache/2.2.20 (Ubuntu)\nX-Powered-By: PHP/5.3.6-13ubuntu3.3\nVary: Accept-Encoding\nContent-Length: 25\nConnection: close\nContent-Type: text/html\n\n/nodir/a.php\nlocalhost\nConnection closed by foreign host.\n\n\n\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\nGET /a.html HTTP/1.1 \nHOST: localhost\nConnection: close\n\nHTTP/1.1 200 OK\nDate: Sat, 31 Dec 2011 00:32:38 GMT\nServer: Apache/2.2.20 (Ubuntu)\nX-Powered-By: PHP/5.3.6-13ubuntu3.3\nVary: Accept-Encoding\nContent-Length: 20\nConnection: close\nContent-Type: text/html\n\n/a.html\nlocalhost\nConnection closed by foreign host.\n\n\nThanks,\nParry"}, {"count": 1, "tags": [], "text": "I am able to get this working correctly using mod_rewrite with the following basic lines in .htaccess but would obviously prefer the FallbackResource instead:\n\n(.htaccess in webroot)\nRewriteEngine On\nRewriteCond /var/www/%{REQUEST_FILENAME} !-f\nRewriteCond /var/www/%{REQUEST_FILENAME} !-d\nRewriteRule (.*) index.php\n\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\nGET /a.php HTTP/1.1\nHOST: localhost\nConnection: close\n\nHTTP/1.1 200 OK\nDate: Sat, 31 Dec 2011 02:37:48 GMT\nServer: Apache/2.2.20 (Ubuntu)\nX-Powered-By: PHP/5.3.6-13ubuntu3.3\nVary: Accept-Encoding\nContent-Length: 43\nConnection: close\nContent-Type: text/html\n\n/a.php\nlocalhost\n\nConnection closed by foreign host.", "is_private": false, "id": 152482, "creator": "parry@plarry.com", "time": "2011-12-31T02:40:26Z", "bug_id": 52403, "creation_time": "2011-12-31T02:40:26Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 52403, "attachment_id": 29501, "id": 162847, "time": "2012-10-21T05:51:10Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2012-10-21T05:51:10Z", "is_private": false, "text": "Created attachment 29501\nProposed patch"}, {"count": 3, "text": "Comment on attachment 29501\nProposed patch\n\nGrrr, bugzilla will turn me crazy...\nWhy does it change the bug you are working on by its own ????\n\nThe patch is related to PR53402", "creator": "christophe.jaillet@wanadoo.fr", "attachment_id": 29501, "id": 162848, "time": "2012-10-21T05:54:20Z", "bug_id": 52403, "creation_time": "2012-10-21T05:54:20Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "text": "I believe this is due to mod_dir.c line 366 (https://github.com/apache/httpd/blob/trunk/modules/mappers/mod_dir.c#L366), although I'm not positive.  I'd like to see this fixed, and am willing to contribute, but I'm unsure exactly what change needs to be made.\n\nThe comment says that the (r->finfo.filetype == APR_NOFILE) check means that there is nothing in the filesystem, but that doesn't seem to be the case for nonexistant php files when the request specifies the .php extension.\n\nIs the issue that the filetype should be getting set to APR_NOFILE in this case but isn't?  Or is it the check that is incorrect: is checking for APR_NOFILE not the correct way to check that the file doesn't exist?", "is_private": false, "id": 170650, "creator": "anubis@overthemonkey.com", "time": "2013-10-17T14:21:18Z", "bug_id": 52403, "creation_time": "2013-10-17T14:21:18Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "This (or a very similar) issue causes OSX clients ONLY to fail to connect to virtual hosts configured with any DirectoryIndex line together with a FallbackResource line, unless \"DirectoryIndex disabled\" is used.\n\nThis has been tested with the following clients:\n\nOSX 10.9.4 Firefox 30.0                 - FAILS\nOSX 10.9.4 Safari 7.0.5                 - FAILS\nOSX 10.9.4 command-line telnet port 80  - FAILS\n\nUbuntu 14.04 links (command-line browser) - WORKS\nUbuntu 14.04 command-line telnet port 80  - WORKS\nWindows 7 Firefox 30.0                    - WORKS\n\nAll working machines were VirtualBox VMs inside the OSX boxes. When the page loads, it loads instantly, when it fails, it never connects and eventually times out.\n\nThe following server config shows the problem. Server is Ubuntu 14.04 64 bit, Apache 2.4.7-1ubuntu4 on an AWS EC2 t2.small instance\n\n<VirtualHost *:80>\n        ServerName tdd-deciphered.com\n        ServerAlias tddd.ec2.phase.org\n\n        ServerAdmin webmaster@localhost\n\n#  OSX clients cannot connect when these DirectoryIndex directives are missing\n        DirectoryIndex disabled\n        DirectoryIndex index.php\n\n        DocumentRoot /home/wechsler/repos/tdd-deciphered/web/\n        <Directory />\n                Options +FollowSymLinks\n                AllowOverride None\n        </Directory>\n        <Directory /home/wechsler/repos/tdd-deciphered/web>\n#  OSX clients cannot connect when this directive is used\n#               DirectoryIndex index.html index.php\n                Options +Indexes +FollowSymLinks +MultiViews\n                AllowOverride All\n                Require all granted\n\n                FallbackResource /index.php\n        </Directory>\n\n        ErrorLog ${APACHE_LOG_DIR}/tdd-error.log\n\n        # Possible values include: debug, info, notice, warn, error, crit,\n        # alert, emerg.\n        LogLevel warn\n\n        CustomLog ${APACHE_LOG_DIR}/tdd-access.log combined\n</VirtualHost>\n\nThis particular issue would appear to be a doozy of an edge case", "is_private": false, "id": 176558, "creator": "richard@phase.org", "time": "2014-07-21T09:22:55Z", "bug_id": 52403, "creation_time": "2014-07-21T09:22:55Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "FWIW the OSX problem only happens on *desktop* OSX, it was also tested on iOS devices where it worked fine, and on a Windows 7? laptop it also loaded fine.", "attachment_id": null, "id": 176559, "creator": "richard@phase.org", "time": "2014-07-21T09:31:42Z", "bug_id": 52403, "creation_time": "2014-07-21T09:31:42Z", "is_private": false}]
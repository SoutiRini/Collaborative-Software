[{"count": 0, "tags": [], "creator": "alex@apache.org", "text": "If one Tomcat process is in the process of shutting down, and another\nTomcat process is then launched from the same set of config files\n(same control port) -- *before* the first one has fully shut down --\nthen it is possible to get in a state where the new Tomcat is\n*partially* running, in a sort of undead state -- it is alive, yet\ndoes not work, yet also prevents further Tomcat instances from\nrunning.\n\nThis state is reflected in catalina.out by the error message\n\nStandardServer.await: create[8005]: java.net.BindException: Address already in use\njava.net.BindException: Address already in use\n\tat java.net.PlainSocketImpl.socketBind(Native Method)\n\tat java.net.PlainSocketImpl.bind(PlainSocketImpl.java:405)\n\tat java.net.ServerSocket.<init>(ServerSocket.java:170)\n\tat org.apache.catalina.core.StandardServer.await(StandardServer.java:277)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:794)\n\tat org.apache.catalina.startup.Catalina.execute(Catalina.java:681)\n\tat org.apache.catalina.startup.Catalina.process(Catalina.java:179)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:243)\n\nIt seems to happen when the original instance has shut down its port\n8005 listener, but has not yet closed its port 8080 listener, allowing\nthe second instance to grab 8005 yet fail to open 8080.  This, in\nturn, keeps the third instance from launching at all.  (I may be wrong\nabout the order, but I have a feeling that the theme of the deadlock\nis port socket listeners.)\n\nIn Linux this undead state is also signified by the \"ps\" utility\nshowing 10 Tomcat threads/processes, instead of the usual 30 or so.\n\nThe proper behavior is probably for the second Tomcat to either fail\ngracefully and completely when it fails to establish all its\nlisteners, and/or to wait a moment and try again (perhaps up to a\nminute, at which point it should fail completely).\n\nFixing this (along with the other two RFEs) is important for the implementation\nof a restart script, which is a pretty useful thing for a sysadmin to have.\n\nI have been off the Tomcat team for a while, but if a current developer wants to\npoint me in the right direction, please let me know and I'll see if I can take a\nstab at writing a patch myself.", "id": 21143, "time": "2002-08-15T23:45:35Z", "bug_id": 11755, "creation_time": "2002-08-15T23:45:35Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "alex@apache.org", "attachment_id": null, "id": 21144, "time": "2002-08-15T23:48:05Z", "bug_id": 11755, "creation_time": "2002-08-15T23:48:05Z", "is_private": false, "text": "The two RFEs are bug 11753 and bug 11754 -\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=11753                        \n                                               \nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=11754                        \n                                         \ndealing with synchronous startup script and shutdown script"}, {"count": 2, "tags": [], "bug_id": 11755, "attachment_id": null, "text": "There is a kill option in the shutdown scripts to ensure tomcat is stopped.", "id": 51881, "time": "2004-02-07T15:08:31Z", "creator": "funkman@joedog.org", "creation_time": "2004-02-07T15:08:31Z", "is_private": false}]
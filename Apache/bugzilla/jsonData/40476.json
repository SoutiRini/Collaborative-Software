[{"count": 0, "tags": [], "bug_id": 40476, "attachment_id": null, "id": 93369, "creation_time": "2006-09-11T22:35:52Z", "time": "2006-09-11T22:35:52Z", "creator": "amichai2@amichais.net", "text": "In the server's access log, there is one line that is not an access record that\nshows up a few times:\n\n[Thu Sep 07 03:09:06 2006] [warn] pid file C:/XXX/logs/httpd.pid overwritten --\nUnclean shutdown of previous Apache run?\n\nit looks like it's being written to the wrong log file - it should be in the\nerror log along with the other warnings and errors, not the access log.", "is_private": false}, {"count": 1, "tags": [], "text": "Oops... this happens in version 2.2.3, which is missing from the dropdown\nmenu... dunno if it's in 2.3 HEAD as well.", "is_private": false, "id": 93370, "creator": "amichai2@amichais.net", "time": "2006-09-11T22:38:26Z", "bug_id": 40476, "creation_time": "2006-09-11T22:38:26Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 40476, "attachment_id": 18888, "id": 93801, "time": "2006-09-19T17:28:12Z", "creator": "Tom.Donovan@acm.org", "creation_time": "2006-09-19T17:28:12Z", "is_private": false, "text": "Created attachment 18888\nap_open_logs does not store new stderr - \n\nap_open_logs in server/log.c does not store the new stderr in the static\nvariable stderr_log.  The old handle is closed, or might even be re-used for a\ndifferent file (which is probably what happened to this guy)."}, {"count": 3, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "text": "I don't really follow that patch: stderr_log is a global variable which is\ninitialized once at startup.  It doesn't really matter *which* apr_file_t * that\ndup2 happens against; fd 2 ends up the same anyway. \n\nDo you have a repro case for this, Tom?", "id": 94438, "time": "2006-10-03T11:51:57Z", "bug_id": 40476, "creation_time": "2006-10-03T11:51:57Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "text": "Is it possible that stderr is not fd 2 on Windows? During my investigations for\nPR40651 I saw a comment in the APR documentation about this\n(http://apr.apache.org/docs/apr/group__apr__file__io.html#ga10). So this maybe a\nWindows specific problem. For Unix systems I agree with your analysis.", "id": 94447, "time": "2006-10-03T14:49:47Z", "bug_id": 40476, "creation_time": "2006-10-03T14:49:47Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "as u probably discerened from my original post, this indeed occured on a Windows\n(XP) system. If there's some test u'd like me to run to recreate/diagnose this,\nI'd be glad to help.\n", "attachment_id": null, "id": 94451, "creator": "amichai2@amichais.net", "time": "2006-10-03T15:14:38Z", "bug_id": 40476, "creation_time": "2006-10-03T15:14:38Z", "is_private": false}, {"count": 6, "tags": [], "creator": "wrowe@apache.org", "is_private": false, "text": "There is no 'fd' vis-a-vis unix.  Handles are arbitrarilly assigned.\n\nIt absolutely must be applied for non-pure-posix portability.\nThis looks like a good solution but I don't have a platform to apply\nto at this instant.", "id": 94452, "time": "2006-10-03T15:23:18Z", "bug_id": 40476, "creation_time": "2006-10-03T15:23:18Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "Tom.Donovan@acm.org", "is_private": false, "text": "Yes, the problem happens on Windows.  The stderr filehandle is not 2, as in\nUnix, and a dup() of stderr produces a new (arbitrary) filehandle value.\n\nFor a quick repro: If you start Apache 2.2.3 on Windows with a pre-existing\nhttpd.pid - no \"Unclean shutdown\" message appears in the error log (the write is\nattempted to a closed filehandle).  If you repeat this after applying the patch,\nthe message correctly appears in the error log.\n\nI cannot repro the case where the message appears in the wrong file.  It is just\nconjecture that a previously closed stderr handle got re-used for an access log\nin Amichai's installation.", "id": 94471, "time": "2006-10-04T04:09:28Z", "bug_id": 40476, "creation_time": "2006-10-04T04:09:28Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "Well it seems like an obviously-correct cleanup anyway, so be it:\n\nhttp://svn.apache.org/viewvc?view=rev&rev=467338", "attachment_id": null, "id": 95065, "creator": "jorton@redhat.com", "time": "2006-10-24T07:17:55Z", "bug_id": 40476, "creation_time": "2006-10-24T07:17:55Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 40476, "attachment_id": null, "is_private": false, "id": 107313, "time": "2007-08-27T23:23:01Z", "creator": "wrowe@apache.org", "creation_time": "2007-08-27T23:23:01Z", "text": "Note this was surplanted by a new two-pool approach, maintaining the old\nstderr log pool during the creation of the new stderr log pool, then on\nsuccess tearing down the old one.\n\nThat solution required significant refactoring in apr, lest Tom's issue\npop up, all over again."}]
[{"count": 0, "tags": [], "bug_id": 48323, "attachment_id": null, "id": 132561, "time": "2009-12-01T15:57:28Z", "creator": "alexis.hassler@sewatech.fr", "creation_time": "2009-12-01T15:57:28Z", "is_private": false, "text": "I started Tomcat in security mode. Everything is fine when accessing via an HTTP connector, either directly or via a reverse proxy. If I first access via an AJP connector, I have the following exception :\n\n\tjava.security.AccessControlException: access denied (java.lang.RuntimePermission accessClassInPackage.org.apache.coyote)\n\t\tjava.security.AccessControlContext.checkPermission(AccessControlContext.java:323)\n\t\tjava.security.AccessController.checkPermission(AccessController.java:546)\n\t\tjava.lang.SecurityManager.checkPermission(SecurityManager.java:532)\n\t\tjava.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1512)\n\t\tsun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:298)\n\t\tjava.lang.ClassLoader.loadClass(ClassLoader.java:300)\n\t\tjava.lang.ClassLoader.loadClass(ClassLoader.java:252)\n\t\tjava.lang.ClassLoader.loadClassInternal(ClassLoader.java:320)\n\t\torg.apache.jk.common.JkInputStream.appendHead(JkInputStream.java:283)\n\t\torg.apache.jk.core.MsgContext.action(MsgContext.java:266)\n\t\torg.apache.coyote.Response.action(Response.java:183)\n\t\torg.apache.coyote.Response.sendHeaders(Response.java:379)\n\t\torg.apache.catalina.connector.OutputBuffer.doFlush(OutputBuffer.java:305)\n\t\torg.apache.catalina.connector.OutputBuffer.close(OutputBuffer.java:273)\n\t\torg.apache.catalina.connector.CoyoteOutputStream.close(CoyoteOutputStream.java:104)\n\t\t...\n\nThis exception happens only at the first call. The second call is OK."}, {"attachment_id": null, "tags": [], "creator": "alexis.hassler@sewatech.fr", "text": "OK, I fixed it by adding these three lines in catalina.policy :\n\ngrant { \n  ...\n  permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.coyote\";\n  permission java.util.PropertyPermission \"org.apache.coyote.USE_CUSTOM_STATUS_MSG_IN_HEADER\", \"read\";\n  permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.tomcat.util.buf\";\n};\n\nMaybe it could be provided by default...", "count": 1, "id": 132563, "time": "2009-12-01T16:04:40Z", "bug_id": 48323, "creation_time": "2009-12-01T16:04:40Z", "is_private": false}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "This works for me with the latest 6.0.x. I suspect the fix for bug47963 refactored the code in such a way as to avoid this issue.", "id": 134466, "time": "2010-02-12T23:17:31Z", "bug_id": 48323, "creation_time": "2010-02-12T23:17:31Z", "is_private": false}]
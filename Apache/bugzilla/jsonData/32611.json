[{"count": 0, "tags": [], "creator": "shawn.price@ngc.com", "text": "We are in the process of testing upgrade from Ant 1.4 to 1.6.2.  We had \npreviously developed a custom copy task that overrides Copy.doFileOperation().  \nAfter updating the proper libraries, I attempted to run our applications \nbuild.  What resulted was a ClassCastException (with no message) when \nattempting to get the name of the next destination file name from fileCopyMap \n(from org.apache.tools.ant.taskdefs.Copy) using the source file name.  Due to \nrestrictions on corporate proprietary info, I cannot provide all the source \ncode, but the offending line is:\n\nString destinationFile = (String)fileCopyMap.get(sourceFile);\n\n, which generates the following lines in stack trace (reprinted):\n\n[copy] com.ourapp.tools.ant.build.CustomCopyTask.doFileOperations\n(CustomCopyTask.java.88)\n[copy] org.apache.tools.ant.taskdefs.Copy.execute(Copy.java:421)\n[copy] org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n...\n\nIncidentally, I've done some troubleshooting, and found through fileCopyMap.get\n(sourceFile).getClass().getName() that the type (at least as far was the \nserialization mechanism is concerned) is still java.lang.String.  Can anyone \nhelp me on this", "id": 68200, "time": "2004-12-09T18:55:21Z", "bug_id": 32611, "creation_time": "2004-12-09T18:55:21Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 32611, "text": "The internals of Copy was changed from ant 1.5 to ant 1.6\nto allow a file to be copied to multiple locations.\n\nIt now stores the a String[] in fileCopyMap.\n\nYou need to do:\nString[] destinationFiles = (String[])fileCopyMap.get(sourceFile)\n\n    for (int i = 0; i < destinationFiles.length; i++) {\n                    String destinationFile = destinationFiles[i];\n...\n\nIf you want to use the custom task in both ant 1.5 and ant 1.6 you\nneed to check the type:\n\nObject dFiles = fileCopyMap.get(sourceFile)\nif (dFiles instanceof String) {\n   ... 1.5 code\n} else {\n   ... 1.6 code\n}\n\nSorry about the inconvience.\n\nMarking this as an *WONTFIX*, as there is not much that\ncan be done to fix this.", "id": 68201, "time": "2004-12-09T19:04:46Z", "creator": "peterreilly@apache.org", "creation_time": "2004-12-09T19:04:46Z", "tags": [], "is_private": false}]
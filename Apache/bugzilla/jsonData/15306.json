[{"count": 0, "tags": [], "creator": "agmartin@grupoburke.com", "attachment_id": null, "text": "I've been trying to set up my tomcat 4.1.12 installation as said in the \ndocumentation.\n\nHere are the steps I've followed:\n\nFirst of all, we delete any anoyance entries:\nkeytool -delete  -v -alias tomcat -storepass MYPASSWORD\nkeytool -delete  -v -alias root   -storepass MYPASSWORD\n\nLater on, let's generate the local certificate:\nkeytool -genkey  -v -alias tomcat -storepass MYPASSWORD -keyalg RSA -keysize \n2048 -validity 365 -keypass MYPASSWORD -\ndname \"CN=es.burke.arturo.garcia.martin, OU=Departamento de Desarrollo, \nO=BURKE, L=Madrid, S=MADRID, C=ES\"\n\nThe \"Certificate Signing Request\":\nkeytool -certreq -v -alias tomcat -storepass MYPASSWORD -keyalg RSA -file \ncertreq.csr\n\nGone to Verisign site and requested the new certificate. It came by e-mail.\n\nSaved the generated certificate from Verisign in a file named: \"vstomcat.cer\"\nand saved the \"Root\" certificate from Verisign in a file named: \"verisign.cer\".\nLet's import them:\nkeytool -import  -v -alias root   -storepass MYPASSWORD -trustcacerts -file \nverisign.cer\nkeytool -import  -v -alias tomcat -storepass MYPASSWORD -trustcacerts -file \nvstomcat.cer\n\nPrint out the contents of the store:\nkeytool -list    -v -storepass MYPASSWORD\n\nThe entry in the \"server.xml\" file:\n    <Connector className=\"org.apache.coyote.tomcat4.CoyoteConnector\"\n               port=\"9443\"\n               minProcessors=\"5\"\n               maxProcessors=\"75\"\n               enableLookups=\"true\"\n               acceptCount=\"10\"\n               debug=\"99\"\n               scheme=\"https\"\n               secure=\"true\"\n               useURIValidationHack=\"false\">\n      <Factory className=\"org.apache.coyote.tomcat4.CoyoteServerSocketFactory\"\n               keystoreFile=\"<MY_.keystore>\"\n               keystorePass=\"MYPASSWORD\"\n               clientAuth=\"true\"\n               protocol=\"TLS\" />\n    </Connector>\n\nThe startup:\nBootstrap: Create Catalina server\nERROR [main] (Http11Protocol.java:152) - Error initializing endpoint\njava.io.IOException: Cannot recover key\n\tat org.apache.tomcat.util.net.JSSESocketFactory.initProxy\n(JSSESocketFactory.java:231)\n\tat org.apache.tomcat.util.net.JSSESocketFactory.createSocket\n(JSSESocketFactory.java:127)\n\tat org.apache.tomcat.util.net.PoolTcpEndpoint.initEndpoint\n(PoolTcpEndpoint.java:263)\n\tat org.apache.coyote.http11.Http11Protocol.init(Http11Protocol.java:150)\n\tat org.apache.coyote.tomcat4.CoyoteConnector.initialize\n(CoyoteConnector.java:1002)\n\tat org.apache.catalina.core.StandardService.initialize\n(StandardService.java:579)\n\tat org.apache.catalina.core.StandardServer.initialize\n(StandardServer.java:2245)\n\tat org.apache.catalina.startup.CatalinaService.load\n(CatalinaService.java:234)\n\tat org.apache.catalina.startup.CatalinaService.load\n(CatalinaService.java:256)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.startup.BootstrapService.init\n(BootstrapService.java:231)\n\tat org.apache.catalina.startup.BootstrapService.main\n(BootstrapService.java:297)\nCatalina.start: LifecycleException:  Protocol handler initialization failed: \njava.io.IOException: Cannot recover key\nLifecycleException:  Protocol handler initialization failed: \njava.io.IOException: Cannot recover key\n\tat org.apache.coyote.tomcat4.CoyoteConnector.initialize\n(CoyoteConnector.java:1004)\n\tat org.apache.catalina.core.StandardService.initialize\n(StandardService.java:579)\n\tat org.apache.catalina.core.StandardServer.initialize\n(StandardServer.java:2245)\n\tat org.apache.catalina.startup.CatalinaService.load\n(CatalinaService.java:234)\n\tat org.apache.catalina.startup.CatalinaService.load\n(CatalinaService.java:256)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.startup.BootstrapService.init\n(BootstrapService.java:231)\n\tat org.apache.catalina.startup.BootstrapService.main\n(BootstrapService.java:297)\nBootstrap: Starting service\n.../...\n\n\nWhat's wrong?\nThanks in advance for your kind support.\n\n\n______________________________________________\nArturo Garc\u00eda Mart\u00edn - agmartin@grupoburke.com\neSolutions Consultant - eBusiness Architect\nBURKE, Software y Servicios - +34.91.571.55.50\nhttp://www.burke.es/", "id": 27718, "time": "2002-12-12T11:16:54Z", "bug_id": 15306, "creation_time": "2002-12-12T11:16:54Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 15306, "is_private": false, "id": 42503, "attachment_id": null, "creator": "medthomas@ntlworld.com", "creation_time": "2003-08-10T18:50:31Z", "time": "2003-08-10T18:50:31Z", "text": "I have SSL working happily with 4.1.24 and later on Windows NT, 2000 and XP. \nThis appears to be a configuration problem.\nIf you are still having problems, I suggest you follow this up on the Tomcat-\nUser list.\nThe obvious question is where have you placed your keyfile? I placed mine \n(called .keystore) in the $CATALINA_HOME\\conf directory and set the \nkeystoreFile parameter as keystoreFile=\"conf/.keystore\""}, {"count": 2, "tags": [], "bug_id": 15306, "text": "Seems like the keystore passwd and the tomcat passwd for the keystore have to be \nthe same. That solved the problem for me.\n", "id": 52409, "attachment_id": null, "creator": "ihamp@airberlin.com", "creation_time": "2004-02-17T10:43:07Z", "time": "2004-02-17T10:43:07Z", "is_private": false}]
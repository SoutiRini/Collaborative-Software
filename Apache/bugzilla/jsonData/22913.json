[{"count": 0, "tags": [], "bug_id": 22913, "text": "I am having problems with the GlobalNamingResources.  If I put my two DB\nresource entries into the GlobalNamingResources section and just use\nResource-Links to access them I cannot cast from DataSource to BasicDataSource..\nI need to do this to use this line in my monitoring app: (I can still use the\nDatasources to get talk to the DB, just not recast it from the interface to the\nconcrete class)\n\npageContext.getOut().println(\" jdbc/CommerceDB:  Active: \" +\n((BasicDataSource)ds).getNumActive() + \" Idle: \" +\n((BasicDataSource)ds).getNumIdle() + \"<br>\");\n\nIf I define the resources directly in the Context everything works fine.  ARGH!\n Here is my server.xml snippets:\n\n\t<GlobalNamingResources>\n\t\t<Resource name=\"jdbc/SessionDBGlobal\" auth=\"Container\"\n\t\t\ttype=\"javax.sql.DataSource\"/>\n\t\t<Resource name=\"jdbc/CommerceDBGlobal\" auth=\"Container\"\n\t\t\ttype=\"javax.sql.DataSource\"/>\n\t\t<ResourceParams name=\"jdbc/SessionDBGlobal\">\n\t\t\t<parameter>\n\t\t\t\t<name>factory</name>\n\t\t\t\t<value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxActive</name>\n\t\t\t\t<value>100</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxIdle</name>\n\t\t\t\t<value>5</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxWait</name>\n\t\t\t\t<value>10000</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>username</name>\n\t\t\t\t<value></value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>password</name>\n\t\t\t\t<value></value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>driverClassName</name>\n\t\t\t\t<value>com.inet.tds.TdsDriver</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>url</name>\n\t\t\t\t<value>jdbc:inetdae7a:IPADDR</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>validationQuery</name>\n\t\t\t\t<value>select top 1 name from syscolumns</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>removeAbandoned</name>\n\t\t\t\t<value>true</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>removeAbandonedTimeout</name>\n\t\t\t\t<value>300</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>logAbandoned</name>\n\t\t\t\t<value>true</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>timeBetweenEvictionRunsMillis</name>\n\t\t\t\t<value>60000</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>testOnBorrow</name>\n\t\t\t\t<value>true</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>testWhileIdle</name>\n\t\t\t\t<value>true</value>\n\t\t\t</parameter>\n\t\t</ResourceParams>\n\t\t<ResourceParams name=\"jdbc/CommerceDBGlobal\">\n\t\t\t<parameter>\n\t\t\t\t<name>factory</name>\n\t\t\t\t<value>org.apache.commons.dbcp.BasicDataSourceFactory</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxActive</name>\n\t\t\t\t<value>100</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxIdle</name>\n\t\t\t\t<value>5</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>maxWait</name>\n\t\t\t\t<value>10000</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>username</name>\n\t\t\t\t<value></value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>password</name>\n\t\t\t\t<value></value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>driverClassName</name>\n\t\t\t\t<value>com.inet.tds.TdsDriver</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>url</name>\n\t\t\t\t<value>jdbc:inetdae7a:IPADDR</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>validationQuery</name>\n\t\t\t\t<value>select top 1 name from syscolumns</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>removeAbandoned</name>\n\t\t\t\t<value>true</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>removeAbandonedTimeout</name>\n\t\t\t\t<value>300</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>logAbandoned</name>\n\t\t\t\t<value>true</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>timeBetweenEvictionRunsMillis</name>\n\t\t\t\t<value>60000</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>testOnBorrow</name>\n\t\t\t\t<value>true</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>testWhileIdle</name>\n\t\t\t\t<value>true</value>\n\t\t\t</parameter>\n\t\t</ResourceParams>\n\t</GlobalNamingResources>\n\n---- 8< ---- 8<  ----\n\t\t\t<Host name=\"wwwHOST_NAME.guidestar.net\" debug=\"1\"\n\t\t\t\tappBase=\"/Guidestar/\" unpackWARs=\"true\" autoDeploy=\"true\">\n\t\t\t\t<Logger className=\"org.apache.catalina.logger.FileLogger\"\n\t\t\t\t\tdirectory=\"logs\" prefix=\"wwwHOST_NAME_log.\" suffix=\".txt\"\n\t\t\t\t\ttimestamp=\"true\"/>\n\t\t\t\t<Context path=\"\" reloadable=\"true\"\n\t\t\t\t\tdocBase=\"C:\\GuideStar\\GsMain\\web\"\n\t\t\t\t\tworkDir=\"C:\\GuideStar\\GsMain\\web\\work\\org\\apache\\jsp\"\n\t\t\t\t\tdebug=\"1\">\n\t\t\t\t\t<Manager\n\t\t\t\t\t\tclassName=\"org.apache.catalina.session.JdbcSessionManager\"\n\t\t\t\t\t\tdebug=\"1\" maxInactiveInterval=\"1800\" maxIdleSwap=\"-1\"\n\t\t\t\t\t\tmaxIdleBackup=\"-1\" checkInterval=\"60\"\n\t\t\t\t\t\tuseDirtyFlag=\"true\" reaper=\"yes\">\n\t\t\t\t\t</Manager>\n\t\t\t\t\t<InstanceListener>\n\t\t\t\t\t\torg.apache.catalina.session.JdbcSessionInstanceListener</InstanceListener>\n\t\t\t\t\t<Loader className=\"org.apache.catalina.loader.DevLoader\"\n\t\t\t\t\t\treloadable=\"true\" debug=\"1\"/>\n\t\t\t\t\t<ResourceLink name=\"jdbc/SessionDB\"\n\t\t\t\t\t\tglobal=\"jdbc/SessionDBGlobal\"\n\t\t\t\t\t\ttype=\"javax.sql.DataSource\"/>\n\t\t\t\t\t<ResourceLink name=\"jdbc/CommerceDB\"\n\t\t\t\t\t\tglobal=\"jdbc/CommerceDBGlobal\"\n\t\t\t\t\t\ttype=\"javax.sql.DataSource\"/>\n\t\t\t\t</Context>\n\t\t\t</Host>\n\t\t</Engine>\n\t</Service>\n</Server>", "id": 43679, "time": "2003-09-03T20:36:26Z", "creator": "masque@inetsolve.com", "creation_time": "2003-09-03T20:36:26Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 22913, "attachment_id": null, "text": "I forgot to mention that I use these three lines to get the datasource:\ninitContext = new InitialContext();\njavax.naming.Context envContext =  \n(javax.naming.Context)initContext.lookup(\"java:/comp/env\");\nDataSource ds = (DataSource)envContext.lookupLink(\"jdbc/SessionDB\");", "id": 43728, "time": "2003-09-04T19:37:22Z", "creator": "masque@inetsolve.com", "creation_time": "2003-09-04T19:37:22Z", "is_private": false}, {"count": 2, "tags": [], "creator": "dirk.verbeeck@pandora.be", "text": "Stacktrace of the ClassCastException?\nVersion of DBCP you are using\n\nPS: these kind of issues should first be verified on the commons-user mailing list", "id": 52716, "time": "2004-02-21T13:36:44Z", "bug_id": 22913, "creation_time": "2004-02-21T13:36:44Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "text": "Closing as invalid based on Dirk's comments.\n\nIssues such as this should always be discussed on the relevant mailing list\nbefore creating a bugzilla item.", "id": 71639, "time": "2005-02-28T21:59:54Z", "bug_id": 22913, "creation_time": "2005-02-28T21:59:54Z", "is_private": false, "attachment_id": null}]
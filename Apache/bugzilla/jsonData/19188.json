[{"count": 0, "tags": [], "creator": "Haruyuki.Kawabe@unisys.co.jp", "text": "when specifying the following directives in a Virtual Host context:\n    SSLProxyEngine on\n    ProxyRemote http://other.proxy.server:8080\n    ProxyPass / https://target.server/\n\nThen the first line of the connected stream to other.proxy.server\nshould be like that \"CONNECT target.server:443 HTTP/1.0\" and followed\nby SSL encrypted binary stream, but my apache send SSL encrypted binary\nstream without the CONNECT first line, and the contents of the binary\nstream is \"GET https://target.server/ HTTP/1.0\" (like HTTP proxy protocol.)", "id": 35690, "time": "2003-04-21T07:56:48Z", "bug_id": 19188, "creation_time": "2003-04-21T07:56:48Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 19188, "attachment_id": 11552, "text": "Created attachment 11552\nThis patch has been developped and tested in a reverse proxy configuration. Some tests have been made with Apache and IIS web servers.", "id": 57422, "time": "2004-05-14T16:01:39Z", "creator": "lilas@evidian.com", "creation_time": "2004-05-14T16:01:39Z", "is_private": false}, {"count": 2, "tags": [], "text": "This is a special case configuration - marking it as an enhancement for now.\n", "attachment_id": null, "bug_id": 19188, "id": 57875, "time": "2004-05-21T21:35:47Z", "creator": "minfrin@sharp.fm", "creation_time": "2004-05-21T21:35:47Z", "is_private": false}, {"count": 3, "tags": [], "text": "*** Bug 32155 has been marked as a duplicate of this bug. ***", "attachment_id": null, "bug_id": 19188, "id": 66754, "time": "2004-11-11T20:13:15Z", "creator": "jorton@redhat.com", "creation_time": "2004-11-11T20:13:15Z", "is_private": false}, {"count": 4, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "id": 66755, "time": "2004-11-11T20:16:08Z", "bug_id": 19188, "creation_time": "2004-11-11T20:16:08Z", "is_private": false, "text": "It might be simpler to resolve this by extending mod_proxy_connect."}, {"count": 5, "tags": [], "text": "(In reply to comment #0)\n> when specifying the following directives in a Virtual Host context:\n>     SSLProxyEngine on\n>     ProxyRemote http://other.proxy.server:8080\n>     ProxyPass / https://target.server/\n\nOne way is to use a plug such as the plugdaemon:\nhttp://www.taronga.com/plugdaemon/\n\nMy solution is:\nProxyRemoteMatch www\\.dest\\.com https://$plugserver:$plugport/\n\nI hope that some one from the mod_proxy developer would fix this bug or add\nthese feature ;-)", "attachment_id": null, "bug_id": 19188, "id": 83198, "time": "2005-12-04T11:11:15Z", "creator": "al-bugzillaapache@none.at", "creation_time": "2005-12-04T11:11:15Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 19188, "text": "*** Bug 41926 has been marked as a duplicate of this bug. ***", "id": 104801, "time": "2007-06-28T00:19:22Z", "creator": "jfclere@gmail.com", "creation_time": "2007-06-28T00:19:22Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 19188, "attachment_id": null, "text": "how can it be that this bug is not solved since so long?\n\nWhat happens is that apache connects to the proxy and initiates an SSL\nnegotiation directly with the proxy. That's plain wrong. I would not classify\nthis as simple \"enhancement\" as this behaviour seems to be supported (at least\nyou can configure it) but the protocol used is just the wrong one.\n\nApache should first send \"CONNECT destination.comain.com:443 HTTP/1.0\"\nand then start SSL stuff.\n\nThis is so damn simple to do (I did a micro proxy in perl doing this) that I'm a\nbit dissapointed that the o-so-big and great apache is not working correctly.\n", "id": 109302, "time": "2007-10-12T06:47:53Z", "creator": "kesseler@cetrel.lu", "creation_time": "2007-10-12T06:47:53Z", "is_private": false}, {"count": 8, "tags": [], "creator": "testsk@web.de", "attachment_id": null, "id": 111907, "time": "2007-12-19T07:48:20Z", "bug_id": 19188, "creation_time": "2007-12-19T07:48:20Z", "is_private": false, "text": "Hi there,\nwe have the same problem with several Apaches (2.2.x) in our environment, too.\nHas someone successfully patched Apache' 2.2.x mod_proxy?\nUnfortunately the 2.0 patch is not applicable to 2.2 :-(\n\nGreg who filed bug 41926 never received an answer.\n\nregards\nChris"}, {"count": 9, "tags": [], "text": "I believe I've hit this too:\n\nIn production, I have a hardware load balancer, but in stage, I'm trying to\nsimulate it using httpd and mod_proxy_balancer.\n\nI think I might be getting this error regardless of SSL in use or not.\n\nLB--->PXY and PXY SSL Layer--->App Layer\n\nLB is httpd+mod_proxy_balancer\n\nThe proxy layer is identical, except there are some application level rewrite\nrules in place for SSL, maintenance, denials, etc...\n\nListen *:80\n<VirtualHost *>\n  ...\n  ProxyPass / balancer://pxy_cluster/\n  ProxyPassReverse / balancer://pxy_cluster/\n  ProxyPreserveHost on\n\n  ### mod_proxy balancer\n  <Proxy balancer://pxy_cluster>\n    BalancerMember http://pxy001.tld\n    BalancerMember http://pxy002.tld\n  </Proxy>\n</VirtualHost>\n\n----\nListen *:443\n<VirtualHost *>\n    ...\n\n    ### SSL\n    SSLEngine  On\n    SSLProxyEngine on\n\n    ### mod_proxy balancer\n    <Proxy balancer://pxy_cluster>\n      BalancerMember https://pxy001.tld\n      BalancerMember https://pxy002.tld\n    </Proxy>\n</VirtualHost>\n\n--------\n==> error_log <==\n[Tue Jan 15 01:01:47 2008] [debug] mod_proxy_balancer.c(41): proxy: BALANCER:\ncanonicalising URL //pxy_cluster/\n[Tue Jan 15 01:01:47 2008] [debug] mod_proxy_balancer.c(950): proxy: Entering\nbyrequests for BALANCER (balancer://pxy_cluster)\n[Tue Jan 15 01:01:47 2008] [debug] mod_proxy_balancer.c(517): proxy: BALANCER\n(balancer://pxy_cluster) worker (http://pxy001.tld) rewritten to http://pxy001.tld/\n[Tue Jan 15 01:01:47 2008] [debug] mod_proxy.c(819): Running scheme balancer\nhandler (attempt 0)\n[Tue Jan 15 01:01:47 2008] [debug] mod_proxy_http.c(1693): proxy: HTTP: serving\nURL http://pxy001.tld/\n[Tue Jan 15 01:01:47 2008] [debug] proxy_util.c(1852): proxy: HTTP: has acquired\nconnection for (pxy001.tld)\n[Tue Jan 15 01:01:47 2008] [debug] proxy_util.c(1913): proxy: connecting\nhttp://pxy001.tld/ to pxy001.tld:80\n[Tue Jan 15 01:01:47 2008] [debug] proxy_util.c(2012): proxy: connected / to\npxy001.tld:80\n[Tue Jan 15 01:01:47 2008] [debug] proxy_util.c(2109): proxy: HTTP: backend\nsocket is disconnected.\n[Tue Jan 15 01:01:47 2008] [debug] proxy_util.c(2169): proxy: HTTP: fam 2 socket\ncreated to connect to pxy001.tld\n[Tue Jan 15 01:01:47 2008] [debug] proxy_util.c(2266): proxy: HTTP: connection\ncomplete to 192.168.1.165:80 (pxy001.tld)\n[Tue Jan 15 01:01:48 2008] [debug] mod_proxy_http.c(1478): proxy: start body send\n[Tue Jan 15 01:01:48 2008] [debug] mod_proxy_http.c(1567): proxy: end body send\n[Tue Jan 15 01:01:48 2008] [debug] proxy_util.c(1870): proxy: HTTP: has released\nconnection for (pxy001.tld)\n\n------\nDown stream PXY's access_log (LB-->PXY)\n==> access_log <==\n192.168.1.49 XXXXXXXXXXXXXXXXXXXX [15/Jan/2008:01:03:06 +0000] \"GET / HTTP/1.1\"\n200 108 \"-\" \"Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.8.1.6)\nGecko/20070819 Firefox/2.0.0.6\n\nerror_log from same server had nothing written to it.\n", "attachment_id": null, "bug_id": 19188, "id": 112841, "time": "2008-01-14T17:05:28Z", "creator": "pgollucci@apache.org", "creation_time": "2008-01-14T17:05:28Z", "is_private": false}, {"count": 10, "tags": [], "creator": "lilas@evidian.com", "text": "Created attachment 21410\nPatch for Apache 2.2.8\n\nThis patch as been developped for Apache 2.2.8.\nI have performed some basic test on it, but do not consider it as my final\npatch.\nIf you are interesting in testing it, please give me your feedback.\n\nPhilippe", "id": 113048, "time": "2008-01-22T02:55:31Z", "bug_id": 19188, "creation_time": "2008-01-22T02:55:31Z", "is_private": false, "attachment_id": 21410}, {"count": 11, "tags": [], "creator": "pgollucci@apache.org", "attachment_id": null, "id": 124179, "time": "2009-01-18T16:19:22Z", "bug_id": 19188, "creation_time": "2009-01-18T16:19:22Z", "is_private": false, "text": "CC myself on FreeBSD related bugs"}, {"count": 12, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 134454, "time": "2010-02-12T10:05:17Z", "bug_id": 19188, "creation_time": "2010-02-12T10:05:17Z", "is_private": false, "text": "I reviewed the patch and applied a slightly modified version in r909323. Major functional change: influence forwarding proxy auth by the env var \"proxy-chain-auth\" in the same way as in mod_proxy_http.\n\nConcerning comment #4 by Joe: it seems this doesn not fit nicely into mod_proxy_connect. The functionality is needed during the scheme_handler hook, which is a run first hook. mod_proxy_connect implements the CONNECT method, which means it is raw TCP as a backend protocol. Here we need HTTPS as a backend protocol, but prefix the first request with an HTTP CONNECT rquest.\n\nI plan to propose this for backport to 2.2.x.\n\nThanks for the patch and the patience."}, {"count": 13, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "Created attachment 24975\nBackport of patch applied to 2.3.x in r909323.\n\nThis patch is against 2.2.x head (r909372, Feb 12, 2010). It is a straighforward backport of the fix for 2.3. Feel free to apply and test.", "id": 134461, "time": "2010-02-12T13:29:58Z", "bug_id": 19188, "creation_time": "2010-02-12T13:29:58Z", "is_private": false, "attachment_id": 24975}, {"count": 14, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "Trunk patch has been improved by r910079, r910081, r910124.\n\nBackported to 2.2.x as r910322.\n\nWill be released with 2.2.15 and 2.3.7.\n\nI doubt there will be enough developer interest for backporting to 2.0, since 2.2 is very mature. So closing as fixed.", "id": 134549, "time": "2010-02-16T10:06:18Z", "bug_id": 19188, "creation_time": "2010-02-16T10:06:18Z", "is_private": false, "attachment_id": null}]
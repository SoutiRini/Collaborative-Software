[{"count": 0, "tags": [], "text": "mod_proxy_http prevents adding X-Forwarded-For in forwards proxy, to protect the privacy of the user in (I assume) the situation where Apache is used as an Internet proxy.  We are using Apache as a forwards proxy to control access to internal websites, and in this case adding X-Forwarded-For is very desirable.\n\nCan adding (and even stripping for additional privacy) X-Forwarded-For be made configurable?  The feature could be disabled by default for forwards proxy and enabled by default for reverse proxy to maintain the current behaviour by default.", "attachment_id": null, "id": 129248, "creator": "evanc@nortel.com", "time": "2009-07-29T09:14:43Z", "bug_id": 47601, "creation_time": "2009-07-29T09:14:43Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 47601, "is_private": false, "text": "No, it does not \"prevent\".  Any X-Forwarded-For entries are forwarded.\nYou are asking for it to \"append\" the proxy's client.\n\nReasonable request.  The obvious solution is simple;\n\nRequestHeader append X-Forwarded-For \"%a\"\n\nor\n\nRequestHeader append X-Forwarded-For \"%{REMOTE_ADDR}e\" \n\nQuick testing reveals that neither solution works.\n\nAs utilization blocking dictates, this is needed for larger proxies;\n\nhttp://meta.wikimedia.org/wiki/XFF_project", "id": 129263, "time": "2009-07-29T23:45:27Z", "creator": "wrowe@apache.org", "creation_time": "2009-07-29T23:45:27Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "evanc@nortel.com", "is_private": false, "count": 2, "id": 129270, "time": "2009-07-30T03:08:32Z", "bug_id": 47601, "creation_time": "2009-07-30T03:08:32Z", "text": "\"Prevents\" may not have been exactly the right word, but it seems like we agree on what Apache does now and what it should be able to do.  My hope is that there can be a configuration option just like ProxyVia for managing XFF (with on/off/block capability).\n\nAlso, the current XFF code in mod_proxy_http does not seem to have the correct behaviour when the request already had an XFF (multiple proxies between the client and server).  The XFF format is:\n\nX-Forwarded-For: original-client, first-proxy, second-proxy, etc.\n\nIf I interpret the code correctly, the mod_proxy_http XFF implementation (for reverse proxies) assumes that the current instance is the only proxy, as does the RequestHeader suggestion."}, {"count": 3, "tags": [], "bug_id": 47601, "attachment_id": null, "id": 135193, "time": "2010-03-09T13:47:37Z", "creator": "ostmann@websuche.de", "creation_time": "2010-03-09T13:47:37Z", "is_private": false, "text": "still very important!\n\nWe had to copy mod_proxy_http.c to mod_proxy_http_without_forwarded.c, modify, build and setup.\n\nSimple one options like ProxyVia would be great!"}]
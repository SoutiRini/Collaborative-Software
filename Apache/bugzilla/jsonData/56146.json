[{"count": 0, "tags": [], "bug_id": 56146, "attachment_id": null, "is_private": false, "id": 173308, "time": "2014-02-17T17:01:54Z", "creator": "cquezel@gmail.com", "creation_time": "2014-02-17T17:01:54Z", "text": "When dealing with spreadsheets (tested Excel and LibreOfice) when a function is called with a missing parameter, they sometimes provide a default empty string parameter.\n\nI noticed this with the substitute function:\n\nSUBSTITUTE( text, old_text, new_text, [nth_appearance] )\n\nIn the spreadsheet I was using, the mandatory \"new_text\" parameter was not specified. Excel and LibreOffice both provided a default empty string.\n\nI think the POI behaviour to throw an exception is correct (althought the error message is not very usefull) but, if the goal is to be compatible with Excel, then the behviour should probably be changed.\n\n\tpublic static String coerceValueToString(ValueEval ve) {\n\t\tif (ve instanceof StringValueEval) {\n\t\t\tStringValueEval sve = (StringValueEval) ve;\n\t\t\treturn sve.getStringValue();\n\t\t}\n\t\tif (ve == BlankEval.instance) {\n\t\t\treturn \"\";\n\t\t}\n// Start of patch \n\t\tif (ve == MissingArgEval.instance) {\n\t\t\treturn \"\";\n\t\t}\n// End of patch\n\t\tthrow new IllegalArgumentException(\"Unexpected eval class (\" + ve.getClass().getName() + \")\");\n\t}"}]
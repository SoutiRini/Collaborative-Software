[{"count": 0, "tags": [], "bug_id": 47361, "text": "Hello,\n\nI'm having trouble with apache logging the wrong client IP address in the access logs. It used to log correctly and then one day it\njust starting logging rubbish. It used to log IP address in IPv4 now it logs them in IPv6 and its not even the right IP address and\nI don't have an IPv6 public IP address either only IPv4.\n\nI have tried everything I can to fix the problem. I've uninstalled the rpms and before reinstalling I made sure there were no files\nleft behind by running:\nfile `rpm -qpil httpd-2.0.52-41.ent.centos4.i386.rpm` | grep -v cannot\nfor all the rpms I was about to install.\n\nI've even tried upgrading to a later version but this hasn't fixed the problem.\n\n\nIn my /etc/httpd/conf/httpd.conf file I have this set:\nHostnameLookups Off\nLogFormat \"%h %a\" ipaddresses\nCustomLog logs/access.log.ipaddresses ipaddresses\n\n\nWhen I try to access my webserver from a remote machine on the Internet as well as from a client machine on the LAN all I see in the\nlog files is this:\n[root@wilber httpd]# cat access.log.ipaddresses\na0d8:d2b7:48cc:9ba:b4cc:9ba:98af:d0bf | a0d8:d2b7:48cc:9ba:b4cc:9ba:98af:d0bf\na0d8:d2b7:48cc:9ba:b4cc:9ba:98af:d0bf | a0d8:d2b7:48cc:9ba:b4cc:9ba:98af:d0bf\na0d8:d2b7:48cc:9ba:b4cc:9ba:98af:d0bf | a0d8:d2b7:48cc:9ba:b4cc:9ba:98af:d0bf\na0d8:d2b7:48cc:9ba:b4cc:9ba:98af:d0bf | a0d8:d2b7:48cc:9ba:b4cc:9ba:98af:d0bf\n\n\nIf I edit /etc/httpd/conf/httpd.conf and change:\nListen 80\nto:\nListen 0.0.0.0:80\n\n\nand then restart httpd, my log files look like this instead:\n[root@wilber httpd]# cat access.log.ipaddresses\n98.64.210.183 | 98.64.210.183\n98.64.210.183 | 98.64.210.183\n98.64.210.183 | 98.64.210.183\n98.64.210.183 | 98.64.210.183\n^^ This IP address is being logged regardless if a client is on a private IP range(192.168.X.X) or a client on the public IP range.\n\n\nI have the following version of apache:\n[root@wilber ~]# rpm --query httpd httpd-devel httpd-manual httpd-suexec\nhttpd-2.0.52-41.ent.centos4\nhttpd-devel-2.0.52-41.ent.centos4\nhttpd-manual-2.0.52-41.ent.centos4\nhttpd-suexec-2.0.52-41.ent.centos4\n\n\nSystem details:\n[root@wilber ~]# cat /etc/release\nClarkConnect Community Edition release 4.2\n[root@wilber ~]# cat /etc/redhat-release\nCentOS release 4.2 (Final)\n[root@wilber ~]# uname -a\nLinux wilber.pointclark.net 2.6.18-92.cc4custom #1 SMP PREEMPT Sat Mar 21 22:33:49 EST 2009 i686 i686 i386 GNU/Linux\n[root@wilber ~]# cat /proc/cpuinfo\nprocessor       : 0\nvendor_id       : GenuineIntel\ncpu family      : 15\nmodel           : 2\nmodel name      : Intel(R) Pentium(R) 4 CPU 2.00GHz\nstepping        : 4\ncpu MHz         : 2000.310\ncache size      : 512 KB\nfdiv_bug        : no\nhlt_bug         : no\nf00f_bug        : no\ncoma_bug        : no\nfpu             : yes\nfpu_exception   : yes\ncpuid level     : 2\nwp              : yes\nflags           : fpu vme de pse tsc msr pae mce cx8 apic mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm up\nbogomips        : 4002.36\n\n[root@wilber ~]# df -h\nFilesystem            Size  Used Avail Use% Mounted on\n/dev/hda2              69G   64G  1.4G  98% /\n/dev/hda1             130M   22M  102M  18% /boot\nnone                  252M     0  252M   0% /dev/shm\n/dev/hda3             3.0G   37M  2.8G   2% /var/log/snort\n[root@wilber ~]# free\n             total       used       free     shared    buffers     cached\nMem:        515720     493336      22384          0      35528     234448\n-/+ buffers/cache:     223360     292360\nSwap:      2104472          0    2104472\n[root@wilber ~]#\n\n\n\n\nAny help on how to fix this problem would be greatly appreciated.\n\nTIA.", "id": 127912, "attachment_id": null, "creator": "issues.apache.org@wilber.pointclark.net", "creation_time": "2009-06-12T04:21:02Z", "time": "2009-06-12T04:21:02Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 47361, "text": "Just an idea - did you recently upgrade anything on the system?  Maybe you got a newer glibc whose name resolution works differently.", "id": 127914, "time": "2009-06-12T05:30:04Z", "creator": "poirier@pobox.com", "creation_time": "2009-06-12T05:30:04Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "takashi.asfbugzilla@tks.st", "text": "silent for 3 years and 2.0 retired", "id": 174849, "time": "2014-04-24T16:56:16Z", "bug_id": 47361, "creation_time": "2014-04-24T16:56:16Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 179373, "time": "2014-11-29T20:13:17Z", "bug_id": 57287, "creation_time": "2014-11-29T20:13:17Z", "is_private": false, "text": "When DefaultServlet has file listings enabled, in Tomcat 8.0.15 and 7.0.57 it does not sort the files.\n\nIt lists them in the order provided by the underlying resources implementation. It is a bit harder to see on Windows, where the file system lists the files in a sorted order, but here is a reproduction recipe\n\n1) Unpack apache-tomcat-8.0.15.zip\n2) Add the following lines to webapps/ROOT/WEB-INF/web.xml\n\n  <servlet>\n      <servlet-name>default</servlet-name>\n      <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>\n      <init-param>\n          <param-name>listings</param-name>\n          <param-value>true</param-value>\n      </init-param>\n  </servlet>\n  <servlet-mapping>\n      <servlet-name>default</servlet-name>\n      <url-pattern>/</url-pattern>\n  </servlet-mapping>\n\n3) Delete file\nwebapps/ROOT/index.jsp\n\n4) Create directory\nwebapps/ROOT/WEB-INF/lib/\nand copy there the following file from source code (apache-tomcat-8.0.15-src.zip):\n/test/webapp-fragments/WEB-INF/lib/resources2.jar\n\n5) Start Tomcat and access http://localhost:8080/\n\nActual behaviour:\nNote that files \"resourceB.jsp\" and \"resourceF.jsp\" are listed at the end of the file list, instead of any alphabetical order.\n\nA mention of this issue by a user:\nhttps://stackoverflow.com/questions/27166274/directory-listings-sort-order-in-tomcat-8\n\nExpected behaviour:\nList the files alphabetically.\n\nThough my preference for the sort order is\na) sort case-insensitively\nb) list the directories first\n\nIt could be improved by offering a configurable sort order:\na) by a parameter in the request\nb) by a user cookie\n\nTomcat 7\n=========\nThe same recipe reproduces the issue for Tomcat 7.0.57.\n\nWorkaround\n===========\nDefaultServlet can be configured to generate listing in XML and apply an XSLT transformation to it. XSLT can perform sorting."}, {"count": 1, "text": "+1 to \"dirs first\"\n\nArguments can be had about whether or not sorting should be done case-sensitive of case-insensitive.", "bug_id": 57287, "is_private": false, "id": 179411, "time": "2014-12-01T17:14:53Z", "creator": "chris@christopherschultz.net", "creation_time": "2014-12-01T17:14:53Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "creator": "chris@christopherschultz.net", "text": "I also think that sorting should be optional and not enabled by default: large directories could be problematic for performance and memory usage.\n\nOr maybe there could be a setting that doesn't sort \"directories\" with more than a certain number of items (1k?)", "id": 179413, "time": "2014-12-01T17:21:31Z", "bug_id": 57287, "creation_time": "2014-12-01T17:21:31Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "Created attachment 32248\nBug_57287 patch", "is_private": false, "bug_id": 57287, "id": 179431, "time": "2014-12-02T07:28:06Z", "creator": "otrohov@minsk.ximxim.com", "creation_time": "2014-12-02T07:28:06Z", "attachment_id": 32248}, {"count": 4, "text": "Hi. I added patch with some changes in DefaultServlet. Now by default sorting is Alphabetic ascending, directory first.User can add parameters to http request to configure sorting:\n1. http://localhost:8080/?name=asc\n2. http://localhost:8080/?name=dsc\n3. http://localhost:8080/?size=asc\n4. http://localhost:8080/?size=dsc\n5. http://localhost:8080/?modify=asc\n6. http://localhost:8080/?modify=dsc\n\nPlease tell if you have some suggestion or correction in code. And if you apply this change, where is documentation for this functions?", "bug_id": 57287, "is_private": false, "id": 179432, "time": "2014-12-02T07:34:00Z", "creator": "otrohov@minsk.ximxim.com", "creation_time": "2014-12-02T07:34:00Z", "tags": [], "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 57287, "is_private": false, "text": "1. The code have to pass checkstyle rules (see BUILDING.txt on details on how enable checkstyle). One of rules: no \".*\" imports.\n\n2. I thought of using the same parameters as Apache HTTPD,\nThey use query strings like C=N;O=A\nC column (N name, M last modified, S size, D description - absent in Tomcat)\nO order (A ascending, D descending)\n\nYour parameter naming with a single parameter also looks OK.", "id": 179433, "time": "2014-12-02T07:45:34Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-12-02T07:45:34Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "otrohov@minsk.ximxim.com", "attachment_id": 32249, "id": 179436, "time": "2014-12-02T09:07:50Z", "bug_id": 57287, "creation_time": "2014-12-02T09:07:50Z", "is_private": false, "text": "Created attachment 32249\nsorting list\n\nI refactor import, so checkstyle task passed. So we leave my parameter naming or rename as as Apache HTTPD?"}, {"count": 7, "tags": [], "bug_id": 57287, "attachment_id": null, "text": "(In reply to Oleg Trokhov from comment #6)\n> Created attachment 32249 [details]\n> sorting list\n> \n> I refactor import, so checkstyle task passed. So we leave my parameter\n> naming or rename as as Apache HTTPD?\n\n+1 for query string as Apache HTTPD\n\nRegards,\nVioleta", "id": 179499, "time": "2014-12-04T08:43:00Z", "creator": "violetagg@apache.org", "creation_time": "2014-12-04T08:43:00Z", "is_private": false}, {"count": 8, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 179500, "time": "2014-12-04T11:46:25Z", "bug_id": 57287, "creation_time": "2014-12-04T11:46:25Z", "is_private": false, "text": "It can be more simple, with a single parameter such as\ns=NA\ns=ND\n(sort Name ascending, Name descending)\n\nA shorter parameter name makes it less obvious that the name is English one, better for i18n point of view."}, {"count": 9, "tags": [], "bug_id": 57287, "is_private": false, "text": "Created attachment 32260\nBug 57287v3\n\nNow with patch v3:\n1. \"s=NA\" name=asc\n2. \"s=ND\" name=dsc\n3. \"s=SA\" size=asc\n4. \"s=SD\" size=dsc\n5. \"s=MA\" modify=asc\n6. \"s=MD\" modify=dsc", "id": 179525, "time": "2014-12-05T10:04:22Z", "creator": "otrohov@minsk.ximxim.com", "creation_time": "2014-12-05T10:04:22Z", "attachment_id": 32260}]
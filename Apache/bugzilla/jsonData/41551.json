[{"count": 0, "tags": [], "bug_id": 41551, "attachment_id": null, "id": 99038, "time": "2007-02-06T23:22:42Z", "creator": "xuekun.hu@gmail.com", "creation_time": "2007-02-06T23:22:42Z", "is_private": false, "text": "Hi, \nI'm using Apache2.2.4 (worker+mod_mem_cache). I just used mod_mem_cache to \ncache some little files. However after run severl minutes, I found the file \ncontent sent by mod_mem_cache are incorrect!! \n\nI captured the response package. And I found those error packages are sending  \nthe wrong http headers, like including several headers, wrong ETag value. Seems \nlike memory overflow!! For example, one response are:\n----------------------------------------------------------------------- \nHTTP/1.1 200 OK\nDate: Thu, 25 Jan 2007 11:30:51 GMT\nServer: Apache/2.2.4 (Unix) mod_jk/1.2.15\nLast-Modified: Thu, 01 Jan 1970 00:00:00 GMT\nETag: 2<uwJU@x@)IzNFELwphctT&^r^MvqY\nkP\\k'gZ@Zrs3a-_S+\"A@z%49o[9nyUX^-eR9j1*(lp9B4A3)R]J2?yi:sbVxZJV\n?('9e@tFn$>.cokt;ao/V|^tXj\\UIo-|Xz6YX(nXE9:y/OcK5Yl7]%D3`#s=+;o\ncZci>tNQ+|UUp5RETf>f72<{b*0ICP*gz0>'|2UAY'4VeIfL;?4S>*0t9:V9B|B\nhML1)p?]grrJ/ku4`h/'N(H63PEi@$qfiP<;f,$7a<Ogy7<[rR]!TMZf{c1($]M\n-a_Sb,W`09|)D|NnaD`jHrd*h4ck6]W&xy?sv)]uVZ#u?d!^q/TBM1sD\\&.\"SM/\nAd.W1[2)(2RgwQO.2^wQ|/s?^9np7MiN:9/A|V.xki1C8u164bo6pD,#>Jl2IX,\nZdOG;b4>ET>|%2[6Sv;vE_eLhtFhj\\jlyA@QQKj`k3/ONE=\"7j'Ty.73`w&a-DE\nl%@X&H:T*,x\\@BbVPST!)Tbfjh0RS+yUI@',{sMP\\I'z:M?_\"dQadTN;\"ob&_w`\nEE[)\\wj{'r:&]J|H%%j#W8>)0bZrJzlHH4:vLw[xyrtC]IY9%_pH-R8l(3?V#-N\nfqo,?$R\"<aE6aa1N7iU,,(>,Bv2zk<Z+Gqg'\"O\\nFxV/Zpz3I(_Z|hYi26f!n'X\ntp`fyb!iqrBV7e6(h?6'zKL@PGc$bJsgc1$ZkrHL<tYJ1OFb,_h'5]!$XrMB^]!\n94/>=OObnMgS33U'bg+Uf26dC:!4`8h_n>'w>U0/!mqc6-9yD#gN%.pV3DeJHsE\nKNfI+wCCH]BPin<sChB21XKr1+pgDuWLzHGOkg>Jg0F'q,_I|M^$cnVbi7cU-T$\n=eFc;h(8jov[Adbcy#>-n7G3l!DU!>f!zDx.#q42T1i-Z)H\"4e*M6.`jhLnj0P\"\n+.H[yP'n?b7=KmoTwGCg,@rbV1Qf5n[4rRn\\$7yB^/`zu?='@v3h$RdG7wJQY)K\n1e/&zO5y-w5q(\"?NQmuPa\"PAi.;-Os0NN>Nx/8Qk(kEb/0pILMbRd!Dd>3s80D/\no1s3@\"#iSV0!\"CJlDuDKlkmh41_s+>$*K?F{-i@Uz(+16t#xlqF\"\"\\SZ!-)miPG\nU[PkYIO!Yfuz'tlGNb|`6[983jtwyB?F?A8Xmr*[@+^F|AuW!/o9k:50d)T)Twq\n`f\"n(?ou;(*ZBL-3=9Ue)\\]Y[p1nNEI'lf2lNF3KS4BI()6smg1?q(bc'.0[b&O\nF;=?q=V'&Lyq+_VGke@H*`$32\\d[@3W<DS\"[bV0^-c/wVX\"+F(@#)r*/{5\"LAxH\nIJI#(SXmlmak6+]4n+p-F;]5V&00er+JQ[;hU]GR4+eXJ_]T;Cx*LS!|:m$#3G8\n|vgF]TA_/d!G#Z,5-sTV,^J4UurZ['?,v$5\\IDRcV(]`dN?.H`1@5ll1n7pq7([\n'\\eoDI1&R0#R*`VS8Mjy[q&{q&h<h=1x{CD[w'(5]SQ*)`uty*|(41&:n3%*dRq\nRD9s:61RDRK3XO?n/TIF-dmK]1c0#Vgo@#0XLM1{x4s/w;M':j#GU=.ubloj@N#\nY=fI-2c{{^_?/tOIr$5jq&xpAaT_hc0XqE.Hbge6{76^h@ek/GH@Hi>TBob(;c+\ni,8OS2aTS_dv5j*e^VCE`+UIU&y@S7huO!Xj?mTmz#Z,Ca0W-z2X%HysN[NxO{g\nTDSvcaFVVz_3ms5*uV)bdA^K52p`UKO[HZ<WzVFUUECIcJjD2cIKxxW?{a?Sa/M\nP;kma`)4q#*?'xjO1L-*BUuUjwDOHcUEFE1;oGwzQl!lzko2x5]@62$P{aRY*\"3\no.m\"1oT/q93&{(#M<g)!c^h$F--,Nnk|<.#Q:7L+$e(*@S3xJiFTJuYZ@Wf^\\Q(\ns4GQ#arbPmAg5T{70$KnVbbTsyc4fe'_*xf6W?$ExHU6_;>b4;$oKOX`4j*aApl\nK#?s[/PwP6DkqxZB`Z:j?:Kdt;'^{wCLh|662k_k<pbm|&QbVBlt/LWjeBLKDVS\n{kHTiH@w(1TIxwp\"T2*5u){aMWoOsif4J5?lT\"@C,vAKX!>^,wl`I58FBY3#e@&\n+%1t&m@m4.m6L>q^5l3V',J?FPhC-_$:X,>t#yB\"0!UgEHG.>eVJIzu)K|gJh\"?\nhmXf%bz3pHTzGHQ'A[9:vW-y_Fkunqalva%pu0vo8RBZE*{G1e=c(c-.`N,<J_T\nD'$7I2XJpxgxT&h4mH-t+yr`DGK.8N]_=?ZB)V-84U(L7XrA+'MC|;,k*][XY0L\n!::f@Zm]xAlQo`?FFJ)=>3Sp5Y,FDJLfp;(WST{U]MK$'Z0PbfrE&gk1grzC.l*\n27<X%nau9%&]<IYA+.sA`9C|KLf@o^S2FAgB+]U8MkG_]G5?eg4&{2P#iLKenxT\nfq(1LM,rn1@33.9]xp6;@FJPPFQYD\"@>ED'D%nfkj;-qEK1[d^wV:i,\"NLuylTN\n/E(82(nsb,a`8')I=$jP6?8Z.4IH7NE@@$4l:79J/dCU@`=37bT(Opd\"`n;(dk&\np6*F-#x!W<no$;Di2%s_]SmXlYgfhEiyTcv`0'PB`[[SP@cl:HM5B*[jvAkUvra\nff=fCE0?P2DqySbc{W5E@[-Bj3-S3,TT_o&=ek:sY(8a_HubaCTX+,,3PFL5.Ap\nwWU%^Ohf!9WnizXy|sd.t[qftGmF(.&_fEF6\\s`dvRfAg+R8q(Hv\"9</pre>\n</body>\n</html>\n\nAccept-Ranges: bytes\nContent-Length: 2170\nExpires: Fri, 26 Jan 2007 11:27:58 GMT\nAge: 107\nContent-Type: text/plain; charset=ISO-8859-1\n\nAccept-Ranges: bytes\nContent-Length: 90\nExpires: Fri, 26 Jan 2007 11:27:11 GMT\nAge: 158\nContent-Type: text/plain; charset=ISO-8859-1\n...\n---------------------------------------------------------------------\n\nWhile I also tested Apache2.2.3+mod_mem_cache, Apache2.2.4 without \nmod_mem_cache, Apache2.2.4+mod_disk_cache, all work fine. \nSo, there must something wrong in mod_mem_cache itself.\n\nI compared with mod_mem_cache in 2.2.3 vs. 2.2.4, the big change is using APR \nmemory pool to cache http header, instead of malloc. However I had no idea what \nthe real reason is. \n\nAny thoughts?\n\nThx, Xuekun"}, {"count": 1, "tags": [], "bug_id": 41551, "attachment_id": null, "is_private": false, "id": 101646, "time": "2007-04-12T20:41:44Z", "creator": "covener@gmail.com", "creation_time": "2007-04-12T20:41:44Z", "text": "I am seeing the etag blown away on 2.2.4 and trunk as well, running with a\nsingle child process and no concurrent connections.  This happens _before_\nrevalidation based on Expires or Age (on a particular system/config 4th\nnon-conditional request gets the ETag removed in some way (truncated, random\ngarbage)\n\nI was occasionally seeing the Last-Modified time set to 0 as well, but not able\nto reproduce it as easily."}, {"count": 2, "tags": [], "text": "Created attachment 19948\ndon't use apr_table_copy to store/recall headers\n\nnaive patch to deep copy in/out headers before storing/retrieving from cache.\n\nwhen retrieving, we only bother to do the deep copy to appease pool debugging,\nwho would abort even when the cache pool is longer living, but not an ancester\nof, the request pool.", "attachment_id": 19948, "id": 101656, "creator": "covener@gmail.com", "time": "2007-04-13T05:22:46Z", "bug_id": 41551, "creation_time": "2007-04-13T05:22:46Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 41551, "attachment_id": null, "text": "(In reply to comment #2)\n> Created an attachment (id=19948) [edit]\n> don't use apr_table_copy to store/recall headers\n> naive patch to deep copy in/out headers before storing/retrieving from cache.\n> when retrieving, we only bother to do the deep copy to appease pool debugging,\n> who would abort even when the cache pool is longer living, but not an ancester\n> of, the request pool.\n\nNo. Your patch didn't resolve this issue. The same error still was blown away. ", "id": 101749, "time": "2007-04-16T02:18:52Z", "creator": "xuekun.hu@gmail.com", "creation_time": "2007-04-16T02:18:52Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 41551, "attachment_id": null, "is_private": false, "id": 102585, "time": "2007-04-27T19:37:43Z", "creator": "davi@apache.org", "creation_time": "2007-04-27T19:37:43Z", "text": "Ouch, that's my fault. I naively believed that apr_table_copy copied the table data. We should revert \nrevision 484642 ASAP."}, {"count": 5, "tags": [], "bug_id": 41551, "attachment_id": 20064, "id": 102586, "time": "2007-04-27T19:57:18Z", "creator": "davi@apache.org", "creation_time": "2007-04-27T19:57:18Z", "is_private": false, "text": "Created attachment 20064\ntable copy warning"}, {"count": 6, "text": "Created attachment 20065\ndeep table copy", "creator": "davi@apache.org", "is_private": false, "id": 102587, "time": "2007-04-27T20:14:24Z", "bug_id": 41551, "creation_time": "2007-04-27T20:14:24Z", "tags": [], "attachment_id": 20065}, {"count": 7, "tags": [], "text": "Could you try the above patch and let me know if you still have these errors? Thanks.", "attachment_id": null, "id": 102588, "creator": "davi@apache.org", "time": "2007-04-27T20:15:35Z", "bug_id": 41551, "creation_time": "2007-04-27T20:15:35Z", "is_private": false}, {"count": 8, "text": "(In reply to comment #7)\n> Could you try the above patch and let me know if you still have these errors? \nThanks.\n\nI tried your patch with several hours run, all seems fine. Thanks \n\n", "bug_id": 41551, "attachment_id": null, "id": 102646, "time": "2007-04-29T20:02:13Z", "creator": "xuekun.hu@gmail.com", "creation_time": "2007-04-29T20:02:13Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "text": "Created attachment 20150\ntable copy (clone) function for apr", "attachment_id": 20150, "id": 102963, "creator": "davi@apache.org", "time": "2007-05-08T15:36:35Z", "bug_id": 41551, "creation_time": "2007-05-08T15:36:35Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 41551, "attachment_id": null, "is_private": false, "id": 107281, "time": "2007-08-27T04:48:00Z", "creator": "rpluem@apache.org", "creation_time": "2007-08-27T04:48:00Z", "text": "Backported to 2.2.x as r555626 (http://svn.apache.org/viewvc?\nview=rev&revision=555626)."}]
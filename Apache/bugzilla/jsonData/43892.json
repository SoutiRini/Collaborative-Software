[{"count": 0, "tags": [], "creator": "brian.curnow@gfs.com", "is_private": false, "text": "I've been trying to upgrade our build system to Ant 1.7.0 and I'm running into a\nproblem with the JUnit task. I have a very simple test case where I have a\nsingle class (no methods, constants, just a class) and a single test case with a\nsingle test method which simple does a fail(). I've got the JUnit task setup\nwith haltonerror=true and haltonfailure=false so when running this test I'd\nexpect my build to succeed. It's not. If I set holdonerror=false then it works.\nThe core of the issue seems to be that\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner is returning an\nerror code of 2 (ERRORS) instead of 1 (FAILURES) which is causing the JUnit task\nto treat the failure as an error and fail the build.\n\nI've run my build in debug mode to get the exact command that ant is executing\nand replaced the ant-junit.jar with the one from 1.6.2 and the error code (echo\n%errorlevel%) is correct so this appears to be a regression with 1.7.0.\n\nI've attached a zip containing my project and ant build script. This is run\nagainst a standard 1.7.0 binary distribution.", "id": 110671, "time": "2007-11-17T14:24:54Z", "bug_id": 43892, "creation_time": "2007-11-17T14:24:54Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 21142\nTest case that reproduces the issue", "is_private": false, "id": 110672, "creator": "brian.curnow@gfs.com", "time": "2007-11-17T14:32:58Z", "bug_id": 43892, "creation_time": "2007-11-17T14:32:58Z", "attachment_id": 21142}, {"count": 2, "tags": [], "creator": "brian.curnow@gfs.com", "is_private": false, "text": "I've verified that the test case works fine with Ant 1.6.2 and Ant 1.6.5 with\njunit-4.0.jar in the ANT_HOME/lib directory.", "id": 110673, "time": "2007-11-17T14:33:55Z", "bug_id": 43892, "creation_time": "2007-11-17T14:33:55Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 43892, "attachment_id": null, "is_private": false, "id": 112201, "time": "2007-12-26T07:32:57Z", "creator": "mfv123@hotmail.com", "creation_time": "2007-12-26T07:32:57Z", "text": "We're experiencing this as well. Our issue is not with the haltonerror or\nhaltonfailure attributes since we use the errorproperty and  failureproperty\nattributes. If either get set, we fail the build after creating a <junitreport>.\n\nIn the system output and in the junit report Ant is reporting failures and\nerrors as Errors (Ant 1.7.0 with JUnit 4.4).\n\nFor the following sample test class, Ant reports 3 tests, 0 Failures, 2 Errors\nrather than the expected 1 Failure, 1 Error.\n\npublic class SampleTest\n{\n    public static junit.framework.Test suite() { return new\nJUnit4TestAdapter(SampleTest.class); }\n\n    @Test\n    public void willPass() { assertTrue(true); }\n\n    @Test\n    public void willFail() { assertTrue(false); }\n\n    @Test\n    public void willError() { throw new RuntimeException(\"oops\"); }\n}"}, {"count": 4, "tags": [], "creator": "brian.curnow@gfs.com", "is_private": false, "text": "Created attachment 22469\nPatch for org.apache.tools.ant.taskdefs.options.junit.JUnitTestRunner.java\n\nThis should take care of the problem.\n\nThe issue is that the JUnit4Adapter always returns failures as errors. So there was a method to correctly calculate errors and failures. However, these values were not used when determining the exist code for the runner.", "id": 119998, "time": "2008-08-21T13:05:43Z", "bug_id": 43892, "creation_time": "2008-08-21T13:05:43Z", "attachment_id": 22469}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "is_private": false, "text": "I get correct counts for Mark's testcases with JUnit 4.5 and ant 1.7.1, while the haltonfailure property isn't set correctly.\n\nAfter applying Brian's patch things seem to be alright.  svn revision 688083.\n\nI'm a bit reluctant of adding a test to ant's testsuite since - for the test to make sense - we'd need to run the test under JUnit4.", "id": 120027, "time": "2008-08-22T06:51:07Z", "bug_id": 43892, "creation_time": "2008-08-22T06:51:07Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "Oh, no, Mark's problem is different and only manifests itself if the suite method is used.", "is_private": false, "id": 120028, "creator": "bodewig@apache.org", "time": "2008-08-22T06:52:45Z", "bug_id": 43892, "creation_time": "2008-08-22T06:52:45Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "bodewig@apache.org", "text": "Mark's case passes now as well.  svn revision 688084", "id": 120031, "time": "2008-08-22T07:02:38Z", "bug_id": 43892, "creation_time": "2008-08-22T07:02:38Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 6219, "attachment_id": null, "id": 10297, "creation_time": "2002-02-04T14:15:07Z", "time": "2002-02-04T14:15:07Z", "creator": "marcin_ol@poczta.onet.pl", "text": "FORM authentication does not work, because inside \nFormAuthenticator.authenticate, getUserPrincipal() never returns null - \ninstead, it returns a Principal with empty user name - which is created in \nAjp13Request.setAjpRequest, in this code:\n\n  String remoteUser = ajp.remoteUser().toString();\n  if(remoteUser != null)\n    setUserPrincipal(new Ajp13Principal(remoteUser));\n\nremoteUser.toString() won't return NULL - it will return empty String (because \nin AJP packet, there actually was a field REMOTE_USER, but with length = 0)", "is_private": false}, {"count": 1, "tags": [], "creator": "jonathan_pierce@seagram.com", "text": "Thanks for finding this Marcin.\n\nI've replaced the code with the following and it seems to fix the problem. This \nlooks like the same bug as #5647 and this fix seems to fix both of them.\n\nI'll post the fix to the news group so it gets tested and added by one of the \ncommitters.\n\nReplace from line 115:\n\n// String remoteUser = ajp.remoteUser().toString();\n // if(remoteUser != null)\n //   setUserPrincipal(new Ajp13Principal(remoteUser));\n\nString remoteUser = ajp.remoteUser().toString();\nif ((remoteUser != null) && (! remoteUser.equals (\"\")))\n        {\n            setUserPrincipal(new Ajp13Principal(remoteUser));\n        }\n        else\n        {\n\t\t setUserPrincipal(null);\n\t}\n\n-Jonathan\n\n\n*** This bug has been marked as a duplicate of 5647 ***", "id": 10736, "time": "2002-02-15T00:38:41Z", "bug_id": 6219, "creation_time": "2002-02-15T00:38:41Z", "is_private": false, "attachment_id": null}]
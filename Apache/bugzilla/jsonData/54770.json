[{"count": 0, "tags": [], "text": "As discussed here [1] and here [2], Tomcat needs a set of jarsToScan properties to counteract jarsToSkip properties. General thoughts through the discussions:\n\n> First of all, how does it work? The suggestion is:\n> If jarsToScan matches, scan it\n> else if jarsToSkip matches, skip it\n> else scan it\n\n> three new system properties\n> tomcat.util.scan.DefaultJarScanner.jarsToScan\n> org.apache.catalina.startup.ContextConfig.jarsToScan\n> org.apache.catalina.startup.TldConfig.jarsToScan\n\nDiscussions also indicated general support for the need to be able to have different jarsToScan/jarsToSkip settings per web application, possibly in the form of a /WEB-INF/tomcat.[properties | xml] file, or new settings in /META-INF/context.xml. Such a solution could also be used to accomplish the suggestion at bug 52924.\n\n[1] http://tomcat.markmail.org/thread/qanw2psjsx32feek\n[2] http://tomcat.markmail.org/thread/b5jubhriaovypbfy", "is_private": false, "id": 166232, "creator": "nicholas@nicholaswilliams.net", "time": "2013-03-29T18:18:06Z", "bug_id": 54770, "creation_time": "2013-03-29T18:18:06Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Of course this is an enhancement. By mad for categorizing it incorrectly. I WOULD argue that the priority on this enhancement is high, but it is still an enhancement.", "is_private": false, "id": 166344, "creator": "nicholas@nicholaswilliams.net", "time": "2013-04-02T23:06:24Z", "bug_id": 54770, "creation_time": "2013-04-02T23:06:24Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 54770, "attachment_id": null, "text": "You can read about the Log4j tag library, available since Log4j 2.0.0-beta5, here: http://logging.apache.org/log4j/2.x/log4j-taglib/index.html.\n\nAs Log4j 2 approaches its general availability, this is going to start becoming a bigger issue. At the very least, the log4j*.jar exclusion in the stock catalina.properties needs to be removed from Tomcat 7 and 8. Of course, if there were a jarsToScan property as this bug suggests, it could contain a stock *taglib*.jar or log4j-taglib*.jar inclusion that would negate the need to remove log4j*.jar from the exclusions.\n\nThere was a good deal of discussion about this back on February 21-26, and then it just died. Is there someone willing to pick this up? This is a bigger task than I have the time or Tomcat knowledge to tackle, I'm afraid.", "id": 167281, "time": "2013-05-19T05:36:31Z", "creator": "nicholas@nicholaswilliams.net", "creation_time": "2013-05-19T05:36:31Z", "is_private": false}, {"count": 3, "tags": [], "text": "This has been implemented in trunk for Tomcat 8.\n\nThe changes are non-trivial to back-port. I don't intend proposing a back-port of these changes. The log4j issue can be resolved by a less broad exclusion in jarsToSkip such as log4j-1*.jar (although I note log4j-core.jar shipped with 1.0.x and 1.1.x and is not log4j-2.x specific).\n\nI'll leave this open a little while in case someone wants to look at a back port. In not, I'll change the version to 8.0.x and resolve it as fixed.", "is_private": false, "id": 167818, "creator": "markt@apache.org", "time": "2013-06-14T13:11:06Z", "bug_id": 54770, "creation_time": "2013-06-14T13:11:06Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 54770, "attachment_id": 30562, "id": 168349, "time": "2013-07-07T17:07:44Z", "creator": "nicholas@nicholaswilliams.net", "creation_time": "2013-07-07T17:07:44Z", "is_private": false, "text": "Created attachment 30562\nPatch to keep Log4j 2 JARs from being skipped in Tomcat 7\n\nI've attached a patch to keep the Log4j 2 JARs from being skipped. Can you apply this in trunk and Tomcat 7? Thanks."}, {"count": 5, "tags": [], "bug_id": 54770, "attachment_id": 30566, "id": 168363, "time": "2013-07-07T23:39:43Z", "creator": "nicholas@nicholaswilliams.net", "creation_time": "2013-07-07T23:39:43Z", "is_private": false, "text": "Created attachment 30566\nPatch to keep Log4j 2 JARs from being skipped in Tomcat 8\n\nThe previous patch I attached is sufficient for Tomcat 7. However, it can still result in some unnecessary scanning of Log4j JARs. There's nothing we can do about that in Tomcat 7 without porting this entire change back, but with the new jarsToScan setting in Tomcat 8 we can do this better in trunk.\n\nI have attached a second patch, this one for Tomcat 8 (trunk)."}, {"count": 6, "tags": [], "bug_id": 54770, "attachment_id": null, "id": 168471, "time": "2013-07-10T19:52:15Z", "creator": "markt@apache.org", "creation_time": "2013-07-10T19:52:15Z", "is_private": false, "text": "As discussed previously, thsi has been fixed for 8.0.x and will not be back-ported to 7.0.x.\n\nNick's patches have been applied."}, {"attachment_id": null, "tags": [], "bug_id": 54770, "is_private": false, "count": 7, "id": 168474, "time": "2013-07-10T20:05:04Z", "creator": "nicholas@nicholaswilliams.net", "creation_time": "2013-07-10T20:05:04Z", "text": "Excellent. Thanks!"}]
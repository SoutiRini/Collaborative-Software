[{"count": 0, "tags": [], "bug_id": 42548, "attachment_id": null, "id": 103827, "time": "2007-05-30T12:04:18Z", "creator": "jz-2007@heute-morgen.de", "creation_time": "2007-05-30T12:04:18Z", "is_private": false, "text": "If apache/apr is compiled with pool debugging\n\n#define APR_POOL_DEBUG  0x0f\n// Don't think this matters, just for completeness\n#define ALLOC_STATS\n\nincluding a language negotiated document with \n\n<html>\n<!--#include virtual=\"lang.txt\" -->\n</html>\n\nwhere lang.txt.en and lang.txt.de are the actual files aborts with a log message\n\napr_table_overlay: overlay's pool is not an ancestor of p\n\nThe backtrace of the coredump is\n\n#0  0xb7c8f947 in raise () from /lib/tls/libc.so.6\n#1  0xb7c910c9 in abort () from /lib/tls/libc.so.6\n#2  0xb7df73cb in apr_table_overlay (p=0x80fa350, overlay=0x80f1720, base=0x80b1c60)\n    at tables/apr_tables.c:819\n#3  0x08081219 in ap_internal_fast_redirect (rr=0x80f0a30, r=0x80fa3a8) at\nhttp_request.c:433\n#4  0xb7770925 in handle_multi (r=0x80fa3a8) at mod_negotiation.c:3121\n#5  0x0806f927 in ap_run_type_checker (r=0x80fa3a8) at request.c:74\n#6  0x080716b8 in ap_process_request_internal (r=0x80fa3a8) at request.c:241\n#7  0x08071ed4 in ap_sub_req_method_uri (method=0x8090da3 \"GET\",\nnew_uri=0x80dd210 \"lang.txt\", r=0x80c0810,\n    next_filter=0x80d2360) at request.c:1630\n#8  0x08071f27 in ap_sub_req_lookup_uri (new_uri=0x80dd210 \"lang.txt\",\nr=0x80c0810, next_filter=0x80d2360)\n    at request.c:1642\n#9  0xb77ee3f8 in handle_include (ctx=0x8101e68, f=0x8101cc0, bb=0x8102088) at\nmod_include.c:1668\n#10 0xb77ea040 in includes_filter (f=0x8101cc0, b=0x8101e38) at mod_include.c:3383\n#11 0x0806d7f6 in default_handler (r=0x80c0810) at core.c:3701\n#12 0x08074037 in ap_run_handler (r=0x80c0810) at config.c:157\n#13 0x08077121 in ap_invoke_handler (r=0x80c0810) at config.c:371\n#14 0x08081b88 in ap_process_request (r=0x80c0810) at http_request.c:258\n#15 0x0807ee2e in ap_process_http_connection (c=0x80c0238) at http_core.c:172\n#16 0x0807adb7 in ap_run_process_connection (c=0x80c0238) at connection.c:43\n#17 0x08085b64 in child_main (child_num_arg=<value optimized out>) at prefork.c:640\n#18 0x08085e5a in make_child (s=<value optimized out>, slot=2) at prefork.c:736\n#19 0x08085f1a in startup_children (number_to_start=3) at prefork.c:754\n#20 0x08086984 in ap_mpm_run (_pconf=0x80a17c8, plog=0x80aa858, s=0x80ef678) at\nprefork.c:975\n#21 0x08061d1f in main (argc=134879152, argv=0x0) at main.c:717"}, {"count": 1, "tags": [], "bug_id": 42548, "attachment_id": null, "id": 103829, "time": "2007-05-30T12:37:22Z", "creator": "wrowe@apache.org", "creation_time": "2007-05-30T12:37:22Z", "is_private": false, "text": "The scopes are safe (appropriate), but it seems that fast_internal_redirect\n(which should die anyways) simply needs an apr_pool_join for the new pool.\n\nComments?"}, {"count": 2, "tags": [], "bug_id": 42548, "attachment_id": null, "is_private": false, "id": 103841, "time": "2007-05-30T15:13:52Z", "creator": "rpluem@apache.org", "creation_time": "2007-05-30T15:13:52Z", "text": "Maybe I am confused, but we already have apr_pool_join(r->pool, rr->pool); a few\nlines above which should do the trick. Is it possible that we have a sub-sub\nrequest here and deal with a table of the main request, so that we have two\ngenerations of pools involved here for which the join trick does not work?"}, {"count": 3, "tags": [], "bug_id": 42548, "attachment_id": null, "id": 103855, "time": "2007-05-30T20:31:11Z", "creator": "jz-2007@heute-morgen.de", "creation_time": "2007-05-30T20:31:11Z", "is_private": false, "text": "(In reply to comment #2)\n> Maybe I am confused, but we already have apr_pool_join(r->pool, rr->pool); a few\n> lines above which should do the trick. Is it possible that we have a sub-sub\n> request here and deal with a table of the main request, so that we have two\n> generations of pools involved here for which the join trick does not work?\n\nProbably yes. lang.txt is included (first sub) and the lookup_uri comes from\nlanguage negotiation.\n"}, {"count": 4, "tags": [], "bug_id": 42548, "attachment_id": 30377, "id": 167605, "time": "2013-06-03T05:40:31Z", "creator": "dorian.taylor.lists@gmail.com", "creation_time": "2013-06-03T05:40:31Z", "is_private": false, "text": "Created attachment 30377\nPatch to fix SIGABRT from unrelated pools with POOL_DEBUG on\n\nApply this patch after any patches for CVE-2012-2687."}, {"count": 5, "tags": [], "text": "This doesn't just affect includes; it affects any negotiate attempt from a request that is already a subrequest.\n\nAttached is a trivial patch which simply checks if there's a main request and if so, uses that pool instead.", "is_private": false, "id": 167606, "creator": "dorian.taylor.lists@gmail.com", "time": "2013-06-03T05:43:17Z", "bug_id": 42548, "creation_time": "2013-06-03T05:43:17Z", "attachment_id": null}]
[{"count": 0, "attachment_id": null, "bug_id": 15974, "is_private": false, "id": 29153, "time": "2003-01-10T20:12:05Z", "creator": "tomy@softwaredesign.com.br", "creation_time": "2003-01-10T20:12:05Z", "tags": [], "text": "Hi,\n\nIt seems that when an exception reaches the Jasper from an application, the \ncomponent throws the root cause's stack trace away, keeping only the \nexception's message, which in some cases is not sufficient for the programmer \nto find the problem.\n\nI believe this change (possibly a bug) has been made since early versions of \nTomcat 4.x, as the Tomcat 3.3a shows the complete stack trace.\n\nTo isolate and demonstrate the problem, I've created a simple application, \nwhich consists of a Java class, and a JSP:\n\n-- Java class source code --\n\npackage com.test;\n\npublic class StackTraceTest {\n    public static void throwError() throws Exception {\n        if (1 == 1) throw new Exception(\"just testing\");\n    }\n}\n--\n\n-- JSP source code --\n<% com.test.StackTraceTest.throwError(); %>\n--\n\nOn Tomcat 4.1.18 (think early versions of 4.x does the same), it produces the \nfollowing content, in the browser and in the log:\n\n--\nHTTP Status 500 - \n\ntype Exception report\n\nmessage \n\ndescription The server encountered an internal error () that prevented it from \nfulfilling this request.\n\nexception \n\norg.apache.jasper.JasperException: just testing\n    at org.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:248)\n    at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)\n    at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:260)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(AuthenticatorBase.java:493)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n    at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2415)\n    at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n    at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n    at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n    at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:223)\n    at org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:432)\n    at \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:386)\n    at org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:534)\n    at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:530)\n    at java.lang.Thread.run(Thread.java:479)\n\n\nroot cause \n\njavax.servlet.ServletException: just testing\n    at org.apache.jasper.runtime.PageContextImpl.handlePageException\n(PageContextImpl.java:533)\n    at org.apache.jsp.myError_jsp._jspService(myError_jsp.java:49)\n    at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:137)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n    at org.apache.jasper.servlet.JspServletWrapper.service\n(JspServletWrapper.java:204)\n    at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)\n    at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:260)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(AuthenticatorBase.java:493)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n    at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2415)\n    at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n    at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n    at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n    at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n    at \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:223)\n    at org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:432)\n    at \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:386)\n    at org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:534)\n    at org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:530)\n    at java.lang.Thread.run(Thread.java:479)\n\nApache Tomcat/4.1.18\n--\n\nOn the Tomcat 3.3a, the result is:\n\n--\nError: 500\nLocation: /eadweb/myError.jsp\nInternal Servlet Error:\n\njavax.servlet.ServletException: just testing\n\tat org.apache.jasper.runtime.PageContextImpl.handlePageException\n(Unknown Source)\n\tat myError_2._jspService(myError_2.java:63)\n\tat org.apache.jasper.runtime.HttpJspBase.service(Unknown Source)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java)\n\tat org.apache.tomcat.facade.ServletHandler.doService(Unknown Source)\n\tat org.apache.tomcat.core.Handler.invoke(Unknown Source)\n\tat org.apache.tomcat.core.Handler.service(Unknown Source)\n\tat org.apache.tomcat.facade.ServletHandler.service(Unknown Source)\n\tat org.apache.tomcat.core.ContextManager.internalService(Unknown Source)\n\tat org.apache.tomcat.core.ContextManager.service(Unknown Source)\n\tat org.apache.tomcat.modules.server.Http10Interceptor.processConnection\n(Unknown Source)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(Unknown Source)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(Unknown Source)\n\tat java.lang.Thread.run(Thread.java:479)\nRoot cause:\njava.lang.Exception: just testing\n\tat com.eadweb.StackTraceTest.throwError(StackTraceTest.java:5)\n\tat myError_2._jspService(myError_2.java:53)\n\tat org.apache.jasper.runtime.HttpJspBase.service(Unknown Source)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java)\n\tat org.apache.tomcat.facade.ServletHandler.doService(Unknown Source)\n\tat org.apache.tomcat.core.Handler.invoke(Unknown Source)\n\tat org.apache.tomcat.core.Handler.service(Unknown Source)\n\tat org.apache.tomcat.facade.ServletHandler.service(Unknown Source)\n\tat org.apache.tomcat.core.ContextManager.internalService(Unknown Source)\n\tat org.apache.tomcat.core.ContextManager.service(Unknown Source)\n\tat org.apache.tomcat.modules.server.Http10Interceptor.processConnection\n(Unknown Source)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(Unknown Source)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(Unknown Source)\n\tat java.lang.Thread.run(Thread.java:479)\n\n--\n\nAs you can see, on the 4.1.18 version, the root cause does not show the stack \ntrace entering the \"throwError\" method of the class, as does the 3.3a version. \nIn some cases, it's very important to know the complete root cause's stack \ntrace, as the Tomcat internal's stack trace doesn't give me much information.\n\nThanks,\nTomy Inhauser"}, {"attachment_id": null, "tags": [], "creator": "funkman@joedog.org", "is_private": false, "count": 1, "id": 38230, "time": "2003-06-03T01:31:38Z", "bug_id": 15974, "creation_time": "2003-06-03T01:31:38Z", "text": "Your posted stack trace did show the root cause.  "}, {"count": 2, "tags": [], "bug_id": 15974, "is_private": false, "id": 38275, "attachment_id": null, "creator": "tomy@softwaredesign.com.br", "creation_time": "2003-06-03T15:58:21Z", "time": "2003-06-03T15:58:21Z", "text": "Please, read my original request again:\n\n\"As you can see, on the 4.1.18 version, the root cause does not show the stack \ntrace entering the 'throwError' method of the class, as does the 3.3a version.\"\n\nTomcat gave me *a* root cause, but not *the* root cause I would expect. Take a\ncloser look at the root cause shown on Tomcat 4.1.18. From that, I wouldn't know\nthat the 'throwError' method of my class generated the exception. Compare the\ntwo root causes I gave you:\n\nOn 4.1.x:\n\njavax.servlet.ServletException: just testing\n  at org.apache.jasper.runtime.PageContextImpl.handlePageException\n(PageContextImpl.java:533)\n  at org.apache.jsp.myError_jsp._jspService(myError_jsp.java:49)\n[...]\n\nOn 3.3.x:\n\njava.lang.Exception: just testing\n  at com.eadweb.StackTraceTest.throwError(StackTraceTest.java:5)\n  at myError_2._jspService(myError_2.java:53)\n[...]\n\nWhat's shown on both before the \"_jspService\" line? Is it equal? No! The second\none shows the stack trace for the original root cause before the \"_jspService\".\nThat's why the \"throwError\" method of my class appears on it. In the first one\n(4.1.x), there's no information about my classes, but only about Tomcat's classes.\n\nAs I said, it seems that the original stack trace is lost, and it's very bad,\nbecause knowing which of my classes generated the exception helps me much to fix\nthe problem.\n\nDo you understand the problem now?"}, {"count": 3, "tags": [], "creator": "tomy@softwaredesign.com.br", "text": "It seems like, at some point, the Tomcat's error handling classes did something\nlike this:\n\n[...]\n} catch (Exception ex /* original application exception */) {\n    throw new ServletException(ex.getMessage());\n}\n\nIn this case, the stack trace of the original application exception caught is\nlost, replaced by the ServletException's one.", "id": 38277, "time": "2003-06-03T16:06:01Z", "bug_id": 15974, "creation_time": "2003-06-03T16:06:01Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "huggs@tteam.com", "attachment_id": null, "is_private": false, "id": 43105, "time": "2003-08-21T16:04:04Z", "bug_id": 15974, "creation_time": "2003-08-21T16:04:04Z", "text": "I agree... this is a big problem for me. Hiding exceptions is a bad smell."}, {"count": 5, "tags": [], "text": "I have tested the latest version of tomcat from CVS and this has been fixed.", "is_private": false, "bug_id": 15974, "id": 57574, "time": "2004-05-17T22:37:35Z", "creator": "markt@apache.org", "creation_time": "2004-05-17T22:37:35Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 40783, "text": "When executing the following code using XML Security 1.4.Beta2 you'll get an\nNPE. I think a better error reporting would be something like: cannot resolve URI.\n\nXMLSignature signature = new XMLSignature(testDocument, null,\n\t\t\t\tXMLSignature.ALGO_ID_SIGNATURE_RSA_SHA512,\n\t\t\t\tCanonicalizer.ALGO_ID_C14N_WITH_COMMENTS);\n\nElement signatureElement = signature.getElement();\nElement rootElement = (Element) testDocument.getFirstChild();\nrootElement.appendChild(signatureElement);\n\nTransforms transforms = new Transforms(testDocument);\nsignature.addDocument(\"urn:unknown:uri\", transforms,\n    MessageDigestAlgorithm.ALGO_ID_DIGEST_SHA512);\n\nsignature.addKeyInfo(publicKey);\n\nsignature.sign(privateKey);\n\n\n\nThe NPE stack trace:\n\njava.lang.NullPointerException\n\tat\norg.apache.xml.security.utils.resolver.implementations.ResolverDirectHTTP.engineCanResolve(Unknown\nSource)\n\tat org.apache.xml.security.utils.resolver.ResourceResolver.canResolve(Unknown\nSource)\n\tat org.apache.xml.security.utils.resolver.ResourceResolver.getInstance(Unknown\nSource)\n\tat org.apache.xml.security.utils.resolver.ResourceResolver.getInstance(Unknown\nSource)\n\tat\norg.apache.xml.security.signature.Reference.getContentsBeforeTransformation(Unknown\nSource)\n\tat\norg.apache.xml.security.signature.Reference.dereferenceURIandPerformTransforms(Unknown\nSource)\n\tat org.apache.xml.security.signature.Reference.calculateDigest(Unknown Source)\n\tat org.apache.xml.security.signature.Reference.generateDigestValue(Unknown Source)\n\tat org.apache.xml.security.signature.Manifest.generateDigestValues(Unknown Source)\n\tat org.apache.xml.security.signature.XMLSignature.sign(Unknown Source)", "id": 94922, "time": "2006-10-18T01:46:11Z", "creator": "info@frankcornelis.be", "creation_time": "2006-10-18T01:46:11Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "sean.mullan@oracle.com", "text": "Do you know if this is a regression from 1.3? I don't think it is. In\nany case, the fix is trivial (diffs below), but I'll leave it up to Raul to\ndecide if we can squeeze it in for 1.4.\n\n$ svn diff ResolverDirectHTTP.java\nIndex: ResolverDirectHTTP.java\n===================================================================\n--- ResolverDirectHTTP.java     (revision 433241)\n+++ ResolverDirectHTTP.java     (working copy)\n@@ -262,7 +262,7 @@\n        log.debug(\"I was asked whether I can resolve \" + uriNodeValue);\n \n       if ( uriNodeValue.startsWith(\"http:\") ||\n-                                BaseURI.startsWith(\"http:\")) {\n+                                (BaseURI != null && BaseURI.startsWith(\"http:\"))) {\n          if (log.isDebugEnabled())\n                log.debug(\"I state that I can resolve \" + uriNodeValue);\n \n", "count": 1, "id": 94943, "time": "2006-10-18T11:34:43Z", "bug_id": 40783, "creation_time": "2006-10-18T11:34:43Z", "is_private": false}, {"count": 2, "tags": [], "creator": "raul-info@r-bg.com", "attachment_id": null, "text": "Hi, thanks for noticing.\nThe problem was not url, the problem was the null BaseURI ,i.e. the second\nparameter in the XMLSignature constructor. \nAnyway after one line patch now it is fixed in SVN head. Please take a look.\n\n", "id": 94944, "time": "2006-10-18T11:47:43Z", "bug_id": 40783, "creation_time": "2006-10-18T11:47:43Z", "is_private": false}, {"count": 3, "tags": [], "text": "Closing old bugs. Fixed in 1.4.1", "attachment_id": null, "id": 108396, "creator": "sean.mullan@oracle.com", "time": "2007-09-19T12:19:01Z", "bug_id": 40783, "creation_time": "2007-09-19T12:19:01Z", "is_private": false}]
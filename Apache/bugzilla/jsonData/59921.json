[{"count": 0, "tags": [], "bug_id": 59921, "attachment_id": null, "id": 192770, "time": "2016-08-01T11:44:55Z", "creator": "viktor@szepe.net", "creation_time": "2016-08-01T11:44:55Z", "is_private": false, "text": "Core doc says:\n\nIf multiple (non-regular expression) <Directory> sections match the directory (or one of its parents) containing a document, then the directives are applied in the order of shortest match first, interspersed with the directives from the .htaccess files.\n\nI have two Directory directives with the same path (in realty the second one is in an Include that is used by all vhost configs)\n\n\nRequest URI:\nhttp://subtwo.wp/blog/\n\nMy config:\n    DocumentRoot \"/var/www/subtwo/2\"\n    <Directory \"/var/www/subtwo/2\">\n        # Core permalinks\n        RewriteRule \"^index\\.php$\" - [END]\n        RewriteCond %{REQUEST_FILENAME} !-f\n        RewriteCond %{REQUEST_FILENAME} !-d\n        RewriteRule \"^\" \"index.php\" [END]\n    </Directory>\n\n    <Directory \"/var/www/subtwo/2\">\n        RewriteRule \"^blog/$\" \"/some-url\"\n    </Directory>\n\nEnd up in /some-url:\ninit rewrite engine with requested uri /blog/\npass through /blog/\n[perdir /var/www/subtwo/2/] add path info postfix: /var/www/subtwo/2/blog -> /var/www/subtwo/2/blog/\n[perdir /var/www/subtwo/2/] strip per-dir prefix: /var/www/subtwo/2/blog/ -> blog/\n[perdir /var/www/subtwo/2/] applying pattern '^blog/$' to uri 'blog/'\n[perdir /var/www/subtwo/2/] rewrite 'blog/' -> '/some-url'\n[perdir /var/www/subtwo/2/] trying to replace context docroot /var/www/subtwo/2 with context prefix\n[perdir /var/www/subtwo/2/] internal redirect with /some-url [INTERNAL REDIRECT]\n\n/redir#1] init rewrite engine with requested uri /some-url\n/redir#1] pass through /some-url\n/redir#1] [perdir /var/www/subtwo/2/] strip per-dir prefix: /var/www/subtwo/2/some-url -> some-url\n/redir#1] [perdir /var/www/subtwo/2/] applying pattern '^blog/$' to uri 'some-url'\n/redir#1] [perdir /var/www/subtwo/2/] pass through /var/www/subtwo/2/some-url\n\n\nThe other way around:\n\nConfig:\n    DocumentRoot \"/var/www/subtwo/2\"\n    <Directory \"/var/www/subtwo/2\">\n        RewriteRule \"^blog/$\" \"/some-url\"\n    </Directory>\n\n    <Directory \"/var/www/subtwo/2\">\n        # Core permalinks\n        RewriteRule \"^index\\.php$\" - [END]\n        RewriteCond %{REQUEST_FILENAME} !-f\n        RewriteCond %{REQUEST_FILENAME} !-d\n        RewriteRule \"^\" \"index.php\" [END]\n    </Directory>\n\nEnds up in /index.php:\ninit rewrite engine with requested uri /blog/\npass through /blog/\n[perdir /var/www/subtwo/2/] add path info postfix: /var/www/subtwo/2/blog -> /var/www/subtwo/2/blog/\n[perdir /var/www/subtwo/2/] strip per-dir prefix: /var/www/subtwo/2/blog/ -> blog/\n[perdir /var/www/subtwo/2/] applying pattern '^index\\\\.php$' to uri 'blog/'\n[perdir /var/www/subtwo/2/] add path info postfix: /var/www/subtwo/2/blog -> /var/www/subtwo/2/blog/\n[perdir /var/www/subtwo/2/] strip per-dir prefix: /var/www/subtwo/2/blog/ -> blog/\n[perdir /var/www/subtwo/2/] applying pattern '^' to uri 'blog/'\n[perdir /var/www/subtwo/2/] RewriteCond: input='/var/www/subtwo/2/blog' pattern='!-f' => matched\n[perdir /var/www/subtwo/2/] RewriteCond: input='/var/www/subtwo/2/blog' pattern='!-d' => matched\n[perdir /var/www/subtwo/2/] rewrite 'blog/' -> 'index.php'\n[perdir /var/www/subtwo/2/] add per-dir prefix: index.php -> /var/www/subtwo/2/index.php\n[perdir /var/www/subtwo/2/] strip document_root prefix: /var/www/subtwo/2/index.php -> /index.php\n[perdir /var/www/subtwo/2/] internal redirect with /index.php [INTERNAL REDIRECT]\n\n\nIs this behavior just undocumented or buggy?\nThans."}, {"count": 1, "tags": [], "bug_id": 59921, "text": "https://httpd.apache.org/docs/2.4/sections.html also says:\n\nIf multiple <Directory> sections apply to the same directory they are processed in the configuration file order.", "id": 192771, "time": "2016-08-01T12:05:46Z", "creator": "viktor@szepe.net", "creation_time": "2016-08-01T12:05:46Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 59921, "attachment_id": null, "text": "Does RewriteOptions Inherit change the behavior?", "id": 192772, "time": "2016-08-01T12:44:20Z", "creator": "covener@gmail.com", "creation_time": "2016-08-01T12:44:20Z", "is_private": false}, {"count": 3, "attachment_id": null, "creator": "viktor@szepe.net", "is_private": false, "id": 192784, "time": "2016-08-01T18:01:08Z", "bug_id": 59921, "creation_time": "2016-08-01T18:01:08Z", "tags": [], "text": "(In reply to Eric Covener from comment #2)\n> Does RewriteOptions Inherit change the behavior?\n\nThank you very much for your comment.\nIt solved the two Directory directives problem.\n\nI've noticed that the .htaccess in the same directory overrides the rewite rules.\nI've tried placing RewriteOptions Inherit into the .htaccess file at several places with no success.\nCould it be solved somehow?"}, {"count": 4, "tags": [], "text": "(In reply to Sz\u00e9pe Viktor from comment #3)\n> (In reply to Eric Covener from comment #2)\n> > Does RewriteOptions Inherit change the behavior?\n> \n> Thank you very much for your comment.\n> It solved the two Directory directives problem.\n> \n> I've noticed that the .htaccess in the same directory overrides the rewite\n> rules.\n> I've tried placing RewriteOptions Inherit into the .htaccess file at several\n> places with no success.\n> Could it be solved somehow?\n\nI would have thought it would behave the same -- the htaccess rules replace the matching <Directory> rules unless you tell it to inherit in that rewrite-specific way.", "attachment_id": null, "bug_id": 59921, "id": 192785, "time": "2016-08-01T18:02:59Z", "creator": "covener@gmail.com", "creation_time": "2016-08-01T18:02:59Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 59921, "attachment_id": null, "id": 192789, "time": "2016-08-01T18:56:38Z", "creator": "viktor@szepe.net", "creation_time": "2016-08-01T18:56:38Z", "is_private": false, "text": "> I would have thought it would behave the same -- the htaccess rules replace\n> the matching <Directory> rules unless you tell it to inherit in that\n> rewrite-specific way.\n\nThank you again.\n\nA temporary word-aroung could be to use the DirectoryMatch directive as it will surely override directory rules.\nhttp://httpd.apache.org/docs/2.4/sections.html#merging"}, {"count": 6, "tags": [], "bug_id": 59921, "attachment_id": null, "text": "A strange (for me at least) fact is:\n\nRewrite order is:\n\nDirectoryMatch -> .htaccess -> Directory\n\nBut if any of these matches - regardless of [L] or [END] - rewrite processing stops there.", "id": 192922, "time": "2016-08-05T15:28:18Z", "creator": "viktor@szepe.net", "creation_time": "2016-08-05T15:28:18Z", "is_private": false}]
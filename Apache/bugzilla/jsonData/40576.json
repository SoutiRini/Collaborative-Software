[{"count": 0, "tags": [], "bug_id": 40576, "text": "When caching zero byte file with GDSF removal algorithm and 0 \nMCacheMinObjectSize in mod_mem_cache, Apache will get \u201c[notice] child pid 2230 \nexit signal Floating point exception (8)\u201d.\n\n \n\nSolutions could be \n\n1.\n\ndiff -ru httpd-2.2.2/modules/cache/mod_mem_cache.c httpd-\n2.2.2.new/modules/cache/mod_mem_cache.c\n\n--- httpd-2.2.2/modules/cache/mod_mem_cache.c   2006-04-22 09:53:06.000000000 \n+0800\n\n+++ httpd-2.2.2.new/modules/cache/mod_mem_cache.c       2006-09-01 \n13:12:56.594483296 +0800\n\n@@ -199,7 +199,7 @@\n\n     cache_object_t *obj = (cache_object_t *)a;\n\n     mem_cache_object_t *mobj = obj->vobj;\n\n \n\n-    if (mobj->priority == 0)\n\n+    if (mobj->priority == 0 && mobj->m_len != 0)\n\n         mobj->priority = queue_clock -\n\n                            (long)(mobj->total_refs*1000 / mobj->m_len);\n\n \n\n2. Or set MCacheMinObjectSize greater than 0\n\ndiff -ru httpd-2.2.2/modules/cache/mod_mem_cache.c httpd-\n2.2.2.new/modules/cache/mod_mem_cache.c\n\n--- httpd-2.2.2/modules/cache/mod_mem_cache.c   2006-04-22 09:53:06.000000000 \n+0800\n\n+++ httpd-2.2.2.new/modules/cache/mod_mem_cache.c       2006-09-01 \n13:49:08.233344008 +0800\n\n@@ -98,7 +98,7 @@\n\n static mem_cache_conf *sconf;\n\n \n\n #define DEFAULT_MAX_CACHE_SIZE 100*1024\n\n-#define DEFAULT_MIN_CACHE_OBJECT_SIZE 0\n\n+#define DEFAULT_MIN_CACHE_OBJECT_SIZE 1\n\n #define DEFAULT_MAX_CACHE_OBJECT_SIZE 10000\n\n #define DEFAULT_MAX_OBJECT_CNT 1009\n\n #define DEFAULT_MAX_STREAMING_BUFFER_SIZE 100000\n\n@@ -964,7 +964,8 @@\n\n     if (sscanf(arg, \"%\" APR_SIZE_T_FMT, &val) != 1) {\n\n         return \"MCacheMinObjectSize value must be an integer (bytes)\";\n\n     }\n\n-    sconf->min_cache_object_size = val;\n\n+    if (val > 0)\n\n+       sconf->min_cache_object_size = val;\n\n     return NULL;\n\n }\n\n static const char\n\n \n\nWhich one is better? Any comments?", "id": 93989, "attachment_id": null, "creator": "xuekun.hu@gmail.com", "creation_time": "2006-09-22T07:56:41Z", "time": "2006-09-22T07:56:41Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 40576, "is_private": false, "text": "(In reply to comment #0)\nHi, All\n\nI knew you are all very busy and probaly are busying working on \nmod_disk_cache :-)\n\nI really hope someone could give me some comments since I'm a newbie on \nlearning/reading Apache source code. \n\nThx, Xuekun", "id": 95204, "time": "2006-10-29T21:26:19Z", "creator": "xuekun.hu@gmail.com", "creation_time": "2006-10-29T21:26:19Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 40576, "text": "From a first glance 2) seems to be more reasonable to me as I currently cannot\nsee a reason to cache objects of size 0 :-). Regarding your check of the value\nset by MCacheMinObjectSize you should return an error is the value is invalid.", "id": 95209, "time": "2006-10-30T13:42:32Z", "creator": "rpluem@apache.org", "creation_time": "2006-10-30T13:42:32Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 40576, "text": "(In reply to comment #2)\n> From a first glance 2) seems to be more reasonable to me as I currently cannot\n> see a reason to cache objects of size 0 :-). Regarding your check of the value\n> set by MCacheMinObjectSize you should return an error is the value is invalid.\n\nThanks for comments. I also think 2) is more reasonable :-)\nBased on your comments, I added the error return value. \n\ndiff -ru httpd-2.2.2/modules/cache/mod_mem_cache.c httpd-\n2.2.2.new/modules/cache/mod_mem_cache.c\n--- httpd-2.2.2/modules/cache/mod_mem_cache.c   2006-04-22 09:53:06.000000000 \n+0800\n+++ httpd-2.2.2.new/modules/cache/mod_mem_cache.c       2006-09-01 \n13:49:08.233344008 +0800\n@@ -98,7 +98,7 @@\n static mem_cache_conf *sconf;\n\n #define DEFAULT_MAX_CACHE_SIZE 100*1024\n-#define DEFAULT_MIN_CACHE_OBJECT_SIZE 0\n+#define DEFAULT_MIN_CACHE_OBJECT_SIZE 1\n #define DEFAULT_MAX_CACHE_OBJECT_SIZE 10000\n #define DEFAULT_MAX_OBJECT_CNT 1009\n #define DEFAULT_MAX_STREAMING_BUFFER_SIZE 100000\n@@ -964,7 +964,8 @@\n     if (sscanf(arg, \"%\" APR_SIZE_T_FMT, &val) != 1) {\n         return \"MCacheMinObjectSize value must be an integer (bytes)\";\n     }\n-    sconf->min_cache_object_size = val;\n+    if (val > 0)\n+       sconf->min_cache_object_size = val;\n+    else\n+       return  \"MCacheMinObjectSize value must be an positive integer (bytes)\";\n     return NULL;\n }\n static const char\n", "count": 3, "id": 95220, "time": "2006-10-30T18:23:11Z", "creator": "xuekun.hu@gmail.com", "creation_time": "2006-10-30T18:23:11Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 40576, "is_private": false, "text": "Committed to trunk as r469895\n(http://svn.apache.org/viewvc?view=rev&rev=469895). Thanks.", "id": 95285, "time": "2006-11-01T05:04:48Z", "creator": "rpluem@apache.org", "creation_time": "2006-11-01T05:04:48Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 40576, "text": "*** Bug 41417 has been marked as a duplicate of this bug. ***", "count": 5, "id": 98289, "time": "2007-01-19T14:38:28Z", "creator": "rpluem@apache.org", "creation_time": "2007-01-19T14:38:28Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 40576, "is_private": false, "id": 107605, "time": "2007-09-02T03:00:47Z", "creator": "rpluem@apache.org", "creation_time": "2007-09-02T03:00:47Z", "tags": [], "text": "Proposed for backport as r571936 (http://svn.apache.org/viewvc?rev=571936&view=rev)."}, {"count": 7, "tags": [], "bug_id": 40576, "text": "Backported to 2.2.x as r572628 (http://svn.apache.org/viewvc?rev=572628&view=rev).", "id": 107702, "time": "2007-09-04T07:41:57Z", "creator": "rpluem@apache.org", "creation_time": "2007-09-04T07:41:57Z", "is_private": false, "attachment_id": null}]
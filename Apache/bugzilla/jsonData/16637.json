[{"count": 0, "tags": [], "bug_id": 16637, "attachment_id": null, "is_private": false, "id": 30407, "time": "2003-01-31T13:14:51Z", "creator": "laimis@tic.lt", "creation_time": "2003-01-31T13:14:51Z", "text": "Thank you for fixing the Bug#: 10216 in version 2.0.44. It stopped displaying \nHTTP 200 OK error response in very most cases.\n\nBut there is one more case when this \"error\" response is displayed: when ISAPI \nextension does not include any HTTP header in it response. \n\nWe traced mod_isapi.c and found such a situation:\n\n1. ISAPI extension calls ServerSupportFunction with '200 OK' in buf_data \nparameter, 0 in buf_size parameter, and pointer to a \"null-terminated string \npointing to optional headers or data to be appended and sent with the header\" \n(excerpt from Microsoft MFC Library Reference) in data_type parameter.\n\n2. ServerSupportFunction calls send_response_header function, and it returns \nat line 795:\n\n    /* If only Status was passed, we consumed nothing \n     */\n    if (!head_present)\n        return 0;             /* <- line 795 */\n\n    cid->headers_set = 1;     /* <- line 797 */\n\n3. Line 797, added in version 2.0.44, is not entered, and bug fix code, added \nfor correcting the buggy '200 OK' response, is not entered (line 1597). Line \n1595 returns the value 200, causing the result to run through the core die \nhandler:\n\n    /* Flush the response now, including headers-only responses */\n    if (cid->headers_set) {\n<...>\n        cid->response_sent = 1;\n\n        return OK;  /* NOT r->status or cid->r->status, even if it has \nchanged. */\n    }\n    \n    /* As the client returned no error, and if we did not error out\n     * ourselves, trust dwHttpStatusCode to say something relevant.\n     */\n    if (!ap_is_HTTP_SERVER_ERROR(r->status) && cid->ecb->dwHttpStatusCode) {\n        r->status = cid->ecb->dwHttpStatusCode;\n    }\n\n    /* For all missing-response situations simply return the status.\n     * and let the core deal respond to the client.\n     */\n    return r->status; /* <- line 1595 */\n\n\nRecommendations for solving the problem: move code line 797 four lines above.\n\n\nAnother minor problem, considering the same bug-fix code added, is that HTTP \nstatus code 200 is not logged in 'access.log' for all successful calls of an \nISAPI extension, with exception to the problem described above. These \nresponses are logged normally. :-)\n\nRecommendations for solving problem: insert one line of code in mod_isapi.c, \nline 1582:\n\n        r->status = cid->ecb->dwHttpStatusCode; /* <- line 1582 */\n\n        return OK;  /* NOT r->status or cid->r->status, even if it has \nchanged. */"}, {"count": 1, "tags": [], "bug_id": 16637, "attachment_id": null, "is_private": false, "id": 32034, "time": "2003-02-26T18:54:43Z", "creator": "wrowe@apache.org", "creation_time": "2003-02-26T18:54:43Z", "text": "\n  Actually, there was a small logic error related to the way that some\n  calls were processed in send_response_header.  We believe the new code\n  is cleaner, but it may or may not resolve your issue altogether.\n\n  If you are building Apache yourself, please replace your mod_isapi.c module\n  with the current CVS available from;\n\nhttp://cvs.apache.org/viewcvs.cgi/*checkout*/httpd-2.0/modules/arch/win32/mod_isapi.c?rev=1.88.2.2\n\n  And let us know if the error remains.  I suspect it does.\n\n  One thing you mention is that we call from ServerSupportFunction() ... in\n  fact we have several potential calls from that code - please identify which\n  call to ServerSupportFunction is't working.\n\n  I guess that sending any body, whatsoever should toggle cid->headers_set to\n  1 so that everything else works.\n\n  Let me make certain; are you trying to send a response 200 OK with *no*\n  headers, *AND* no body?\n"}, {"count": 2, "tags": [], "bug_id": 16637, "attachment_id": null, "is_private": false, "id": 90468, "time": "2006-06-22T06:46:57Z", "creator": "wrowe@apache.org", "creation_time": "2006-06-22T06:46:57Z", "text": "\n  Closed 30033, presuming fixed in trunk.\n"}, {"count": 3, "tags": [], "creator": "matt@iamcode.net", "attachment_id": null, "id": 90893, "time": "2006-07-05T13:10:39Z", "bug_id": 16637, "creation_time": "2006-07-05T13:10:39Z", "is_private": false, "text": "Will Rowe has posted a zipfile containing compiled mod_isapi modules which\ninclude the patch correcting this bug (for use with 2.0.58 and 2.2.2), for\ntesting purposes. It is available at:\n\nhttp://people.apache.org/~wrowe/mod_isapi-416293.zip\n\nYou may read his full email to the dev@httpd.apache.org list here:\n\nhttp://marc.theaimsgroup.com/?l=apache-httpd-dev&m=115206683718140&w=2\n\nIf you test this version of mod_isapi, please post your feedback to the\ndev@httpd.apache.org list. Your feedback will help ensure that there are no\nregressions or other issues in this version of mod_isapi."}, {"count": 4, "tags": [], "creator": "wrowe@apache.org", "text": "*** Bug 40067 has been marked as a duplicate of this bug. ***", "id": 91394, "time": "2006-07-18T18:06:54Z", "bug_id": 16637, "creation_time": "2006-07-18T18:06:54Z", "is_private": false, "attachment_id": null}]
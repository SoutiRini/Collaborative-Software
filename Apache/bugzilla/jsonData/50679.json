[{"count": 0, "text": "Version: Tomcat 7.0.6\nComponent: Catalina\nOS: Windows 7 64bit\n\nOverview:\n\nParallel deployment works like a charm in a non-clustered environment. But when deploying a versioned app (APPNAME##VERSION.war) to a farm deployer directory, it seems that the filename encoding of the ## delimiter is not translated correctly to identify the war file on the file system:\n\n## is translated to %23%23\n\nReproduce:\n\n1. Create a version app file\n2. Deploy file to watched farm deployer directory\n\nExpected result:\n- Versioned app is copyied to cluster members and deployed\n\nActual result:\n- Versioned app is NOT copyied to cluster members.\n\ncatalina.log displays the following error messages:\n\n\n[ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO  org.apache.catalina.ha.deploy.FarmWarDeployer- Installing webapp[/Shop##201101261] from C:\\Apache\\Tomcat7\\cluster\\webapps\\Shop##201101261.war\n\n[ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO  org.apache.catalina.ha.deploy.FarmWarDeployer- Cluster wide remove of web app /Shop##201101261\n\n[ContainerBackgroundProcessor[StandardEngine[Catalina]]] ERROR org.apache.catalina.ha.deploy.FarmWarDeployer- Unable to install WAR file\njava.io.FileNotFoundException: C:\\Apache\\Tomcat7\\cluster\\webapps\\Shop%23%23201101261.war (Das System kann die angegebene Datei nicht finden)\n        at java.io.FileInputStream.open(Native Method)\n        at java.io.FileInputStream.<init>(FileInputStream.java:106)\n        at org.apache.catalina.ha.deploy.FileMessageFactory.<init>(FileMessageFactory.java:152)\n        at org.apache.catalina.ha.deploy.FileMessageFactory.getInstance(FileMessageFactory.java:175)\n        at org.apache.catalina.ha.deploy.FarmWarDeployer.install(FarmWarDeployer.java:372)\n        at org.apache.catalina.ha.deploy.FarmWarDeployer.fileModified(FarmWarDeployer.java:468)\n        at org.apache.catalina.ha.deploy.WarWatcher.check(WarWatcher.java:95)\n        at org.apache.catalina.ha.deploy.FarmWarDeployer.backgroundProcess(FarmWarDeployer.java:591)\n        at org.apache.catalina.ha.tcp.SimpleTcpCluster.backgroundProcess(SimpleTcpCluster.java:627)\n        at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1200)\n        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1393)\n        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1403)\n        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1382)\n        at java.lang.Thread.run(Thread.java:662)\n\n[ContainerBackgroundProcessor[StandardEngine[Catalina]]] INFO  org.apache.catalina.startup.HostConfig- Deploying web application archive Shop##201101261.war\n\nRelevant configuration in server.xml:\n\n...\n      <Host name=\"sbwebapp1\" appBase=\"${catalina.base}/cluster/webapps\"\n            unpackWARs=\"true\" autoDeploy=\"true\">\n\n\t     <Cluster className=\"org.apache.catalina.ha.tcp.SimpleTcpCluster\"\n\t               channelSendOptions=\"8\">\n\t\n\t        <Manager className=\"org.apache.catalina.ha.session.DeltaManager\"\n\t                 expireSessionsOnShutdown=\"true\"\n\t                 notifyListenersOnReplication=\"false\"\n\t\t\t\t\t\t\t\t\t stateTransferTimeout=\"5\"/>\n\t\n\t        <Channel className=\"org.apache.catalina.tribes.group.GroupChannel\">\n\t          <Membership className=\"org.apache.catalina.tribes.membership.McastService\"\n\t                      address=\"228.0.0.4\"\n\t                      port=\"45564\"\n\t                      frequency=\"500\"\n\t                      dropTime=\"3000\"/>\n\t          <Receiver className=\"org.apache.catalina.tribes.transport.nio.NioReceiver\"\n\t                    address=\"192.168.222.220\"\n\t                    port=\"4000\"\n\t                    autoBind=\"100\"\n\t                    selectorTimeout=\"5000\"\n\t                    maxThreads=\"6\"/>\n\t\n\t          <Sender className=\"org.apache.catalina.tribes.transport.ReplicationTransmitter\">\n\t            <Transport className=\"org.apache.catalina.tribes.transport.nio.PooledParallelSender\"/>\n\t          </Sender>\n\t          <Interceptor className=\"org.apache.catalina.tribes.group.interceptors.TcpFailureDetector\"/>\n\t          <Interceptor className=\"org.apache.catalina.tribes.group.interceptors.MessageDispatch15Interceptor\"/>\n\t          <Interceptor className=\"org.apache.catalina.tribes.group.interceptors.ThroughputInterceptor\"/>\n\t        </Channel>\n\t\n\t        <Valve className=\"org.apache.catalina.ha.tcp.ReplicationValve\"\n\t                 filter=\".*\\.gif;.*\\.js;.*\\.jpg;.*\\.png;.*\\.htm;.*\\.html;.*\\.css;.*\\.txt;.*\\.swf;.*\\.flv;\"/>\n\t        <Valve className=\"org.apache.catalina.ha.session.JvmRouteBinderValve\"/>\t        \n\t\n\t        <ClusterListener className=\"org.apache.catalina.ha.session.JvmRouteSessionIDBinderListener\"/>\n\t        <ClusterListener className=\"org.apache.catalina.ha.session.ClusterSessionListener\"/>\n\t        \n\t        <Deployer className=\"org.apache.catalina.ha.deploy.FarmWarDeployer\"\n\t                  tempDir=\"${catalina.base}/cluster/temp/\"\n\t                  deployDir=\"${catalina.base}/cluster/webapps/\"\n\t                  watchDir=\"${catalina.base}/cluster/deploy/\"\n\t                  watchEnabled=\"true\"/>        \n\t      </Cluster>\n\n        <!-- Access log processes all example.\n             Documentation at: /docs/config/valve.html\n             Note: The pattern used is equivalent to using pattern=\"common\" -->\n        <Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\"  \n               prefix=\"ajp_access_\" suffix=\".log\"\n               pattern=\"%h %l %u %t &quot;%r&quot; %s %b\" resolveHosts=\"false\"/>             \n\n      </Host>\n...", "bug_id": 50679, "attachment_id": null, "id": 143746, "time": "2011-01-28T03:22:33Z", "creator": "jan.rusch@googlemail.com", "creation_time": "2011-01-28T03:22:33Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "text": "Thanks for your report. Glad to hear parallel deployment is working well.\n\nI have fixed the FarmWarDeployer in 7.0.x and the fix will be included in 7.0.7 onwards.", "id": 143764, "time": "2011-01-28T16:06:19Z", "bug_id": 50679, "creation_time": "2011-01-28T16:06:19Z", "is_private": false, "attachment_id": null}]
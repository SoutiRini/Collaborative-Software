[{"count": 0, "tags": [], "bug_id": 51463, "is_private": false, "text": "Currently the JavaDoc for the Tomcat.setBaseDir method states:\n\n     * Tomcat needs a directory for temp files. This should be the \n     * first method called. \n     * \n     * By default, if this method is not called, we use:\n     *  - system properties - catalina.base, catalina.home \n     *  - $HOME/tomcat.$PORT\n     * ( /tmp doesn't seem a good choice for security ).\n     *   \n     *\n     * TODO: better default ? Maybe current dir ? \n     * TODO: disable work dir if not needed ( no jsp, etc ).\n\n\n\n\n----------------\n\nThe temporary directory of the system as per \"java.io.tmpdir\" (System.getProperties()) should be used.  Use of the current directory (\"user.dir\") as a default isn't really anymore secure since the current working directory may or may not be locked down anyway (ex: many Linux systems default to user directories being browsable by others).\n\nJava 7 will have support in the NIO packages for creating files with permissions at the outset.  For older Java versions there isn't a nice work around other than things that would call platform specific external commands.\n\nPerhaps if catalina.base & catalina.home are not found then check to see if native JNI calls, system exec calls, or Java 7 calls could be made to create the directory structure in the java.io.tmpdir directory.  If not throw a SecureTempDirectoryUnavailableException with JavaDoc or an error message stating that one way to handle the problem is to call setBaseDir on a directory the programmer can trust.", "id": 147685, "time": "2011-07-01T17:29:33Z", "creator": "business2008+issues.apache.org@rodneybeede.com", "creation_time": "2011-07-01T17:29:33Z", "attachment_id": null}, {"count": 1, "attachment_id": null, "bug_id": 51463, "is_private": false, "id": 147686, "time": "2011-07-01T18:31:32Z", "creator": "markt@apache.org", "creation_time": "2011-07-01T18:31:32Z", "tags": [], "text": "Java 7 doesn't help since Tomcat 7 must run on Java 6.\n\nSystem.exec calls are incredibly fragile since they rely on correct OS detection.\n\nJNI requires a native library which (obviously) needs to be built for every platform and adds a lot of overhead for relatively little benefit.\n\nThe current fall-back of using the user's home directory isn't great but it is no worse (and may be slightly better) than using java.io.tmp.\n\nForcing basedir to be set and not starting if it isn't set is probably the best option but that is something that probably needs to wait until Tomcat 8 since changing this now is likely to lead to some unpleasant surprises for current users."}, {"count": 2, "tags": [], "bug_id": 51463, "attachment_id": null, "id": 147687, "time": "2011-07-01T18:41:03Z", "creator": "business2008+issues.apache.org@rodneybeede.com", "creation_time": "2011-07-01T18:41:03Z", "is_private": false, "text": "Agreed.\n\n\n(In reply to comment #1)\n> Java 7 doesn't help since Tomcat 7 must run on Java 6.\n> \n> System.exec calls are incredibly fragile since they rely on correct OS\n> detection.\n> \n> JNI requires a native library which (obviously) needs to be built for every\n> platform and adds a lot of overhead for relatively little benefit.\n> \n> The current fall-back of using the user's home directory isn't great but it is\n> no worse (and may be slightly better) than using java.io.tmp.\n> \n> Forcing basedir to be set and not starting if it isn't set is probably the best\n> option but that is something that probably needs to wait until Tomcat 8 since\n> changing this now is likely to lead to some unpleasant surprises for current\n> users."}, {"count": 3, "tags": [], "bug_id": 51463, "attachment_id": null, "id": 147688, "time": "2011-07-01T18:41:38Z", "creator": "business2008+issues.apache.org@rodneybeede.com", "creation_time": "2011-07-01T18:41:38Z", "is_private": false, "text": "Will Tomcat 8 require Java 7 or later or still have to support Java 6.  Any idea when Tomcat will require Java 7 or later?"}, {"count": 4, "tags": [], "bug_id": 51463, "attachment_id": null, "id": 147689, "time": "2011-07-01T18:52:23Z", "creator": "markt@apache.org", "creation_time": "2011-07-01T18:52:23Z", "is_private": false, "text": "My guess is that the next version of the Servlet spec (i.e. what Tomcat 8 will implement) will require Java 7."}, {"attachment_id": null, "tags": [], "bug_id": 51463, "text": "Coming back to this a major version later than I intended to, the cross-platform capabilities to set permissions for directories aren't what we need to set them reliably.\n\nI've improved the validation of the baseDir for Tomcat 9 but I think that is as far as I can go.", "count": 5, "id": 200171, "time": "2017-08-03T13:42:33Z", "creator": "markt@apache.org", "creation_time": "2017-08-03T13:42:33Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 35156, "attachment_id": null, "is_private": false, "id": 75725, "time": "2005-06-01T14:24:55Z", "creator": "york@perm.dataart.com", "creation_time": "2005-06-01T14:24:55Z", "text": "Sorry for my bad English.\n\nSources:\n1. $Header: /home/cvs/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/\nruntime/PageContextImpl.java,v 1.52 2003/09/02 21:39:59 remm Exp $\n   $Revision: 1.52 $\n   $Date: 2003/09/02 21:39:59 $\n2. $Header: /home/cvs/jakarta-tomcat-catalina/catalina/src/share/org/apache/\ncatalina/core/ApplicationDispatcher.java,v 1.26 2003/09/12 17:04:12 remm Exp $\n   $Revision: 1.26 $\n   $Date: 2003/09/12 17:04:12 $\n\n\nSteps To Reproduce:\n1. Create four JSP:\n---------------------------------------------------------\n------------------------- 1.jsp -------------------------\n<%@ page import=\"java.util.Vector\"%>\n<%@ page errorPage=\"error.jsp\" %>\n<%@ taglib prefix=\"logic\" uri=\"/WEB-INF/tlds/struts-logic.tld\" %>\n\nCONTENT PAGE 1\n\n<%\n  // SOME COLLECTION\n  Vector someCollection1 = new Vector(1);\n  someCollection1.add(\"some value\");\n%>\n\n<%-- Some EVAL_BODY_BUFFERED tag --%>\n<logic:iterate id=\"some_id_1\" collection=\"<%= someCollection1 %>\" >\n  <jsp:include page=\"2.jsp\" />\n</logic:iterate>\n\nCONTENT PAGE 1\n\n---------------------------------------------------------\n------------------------- 2.jsp -------------------------\n<%@ page import=\"java.util.Vector\"%>\n<%@ page errorPage=\"error.jsp\" %>\n<%@ taglib prefix=\"logic\" uri=\"/WEB-INF/tlds/struts-logic.tld\" %>\n\nCONTENT PAGE 2\n<%\n  Vector someCollection2 = new Vector(1);\n  someCollection2.add(\"some value\");\n%>\n\n<%-- Some EVAL_BODY_BUFFERED tag --%>\n<logic:iterate id=\"some_id_2\" collection=\"<%= someCollection2 %>\" ><%\n  // Some throwable statment\n  if(request.getParameter(\"not exist parameter\") == null)\n    throw new Exception();\n%></logic:iterate>\n\nCONTENT PAGE 2\n\n---------------------------------------------------------\n------------------------- 3.jsp -------------------------\n<%@ page import=\"java.util.Vector\"%>\n<%@ taglib prefix=\"logic\" uri=\"/WEB-INF/tlds/struts-logic.tld\" %>\n\n<%\n  Vector someCollection3 = new Vector(1);\n  someCollection3.add(\"some value\");\n%>\n\n<%-- Some EVAL_BODY_BUFFERED tag --%>\n<logic:iterate id=\"some_id_3\" collection=\"<%= someCollection3 %>\" >\n  CONTENT PAGE 3\n</logic:iterate>\n\n---------------------------------------------------------\n----------------------- error.jsp -----------------------\n<%@ page import=\"java.io.PrintWriter\"%>\n<%@ page isErrorPage=\"true\" %>\n\n<pre>\n<%\n  PrintWriter pw;\n  pw = new PrintWriter(out);\n  Exception exc;\n  exc = pageContext.getException();\n  if(exc != null)\n    exc.printStackTrace(pw);\n%>\n</pre>\n---------------------------------------------------------\n\n2. Deploy application.\n3. Open 1.jsp. We receive a IOException instead of Exception from 2.jsp.\n3. Open 3.jsp. We receive a IOException though should not receive exception.\n\nWHY:\nWhen thrown wxceptoin on 2.jsp into ApplicationDispatcher in 465 line was closes \nwriter. Stack trace:\norg.apache.jasper.catalina.core.ApplicationDispatcher.doForward():465\norg.apache.jasper.catalina.core.ApplicationDispatcher.forward():359\norg.apache.jasper.runtime.PageContextImpl.forward():543\norg.apache.jasper.runtime.PageContextImpl.handlePageException():633\norg.apache.jsp._2_jsp._jspService(): if (pageContext != null) pageContext.\nhandlePageException(t);\n\nLater at use EVAL_BODY_BUFFERED tags called method pushBody, which returns \nclosed writer. This is reason of IOExceptions.\nClosed writer - is outs[depth] from PageContextImpl.\nPossible, condition into PageContextImpl.pushBody in line 557 must be:\nif (depth >= outs.length || IS_CLOSED(outs[depth])),\ninstead of\nif (depth >= outs.length)."}, {"count": 1, "text": "Created attachment 15242\n1.jsp", "creator": "york@perm.dataart.com", "attachment_id": 15242, "id": 75726, "time": "2005-06-01T14:26:00Z", "bug_id": 35156, "creation_time": "2005-06-01T14:26:00Z", "tags": [], "is_private": false}, {"count": 2, "text": "Created attachment 15243\n2.jsp", "bug_id": 35156, "attachment_id": 15243, "id": 75727, "time": "2005-06-01T14:26:21Z", "creator": "york@perm.dataart.com", "creation_time": "2005-06-01T14:26:21Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "york@perm.dataart.com", "attachment_id": 15244, "id": 75728, "time": "2005-06-01T14:26:37Z", "bug_id": 35156, "creation_time": "2005-06-01T14:26:37Z", "is_private": false, "text": "Created attachment 15244\n3.jsp"}, {"count": 4, "tags": [], "bug_id": 35156, "text": "Created attachment 15245\nerror.jsp", "id": 75729, "time": "2005-06-01T14:27:00Z", "creator": "york@perm.dataart.com", "creation_time": "2005-06-01T14:27:00Z", "is_private": false, "attachment_id": 15245}, {"count": 5, "tags": [], "creator": "york@perm.dataart.com", "attachment_id": null, "is_private": false, "id": 75731, "time": "2005-06-01T14:30:42Z", "bug_id": 35156, "creation_time": "2005-06-01T14:30:42Z", "text": "Necessary conditions:\n1. Using custom errorPage\n2. Using custom tags, which returned EVAL_BODY_BUFFERED from doStartTag().\n3. Using tag jsp:include."}, {"count": 6, "text": "IOEcxeption stack trace:\njava.io.IOException: Stream closed\nat org.apache.jasper.runtime.BodyContentImpl.ensureOpen(BodyContentImpl.java:\n624)\nat org.apache.jasper.runtime.BodyContentImpl.write(BodyContentImpl.java:179)\nat org.apache.jasper.runtime.BodyContentImpl.write(BodyContentImpl.java:196)\nat org.apache.jsp._1_jsp._jspService(_1_jsp.java:79)\nat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:137)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\nat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:\n210)\nat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)\nat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\nat org.apache.catalina.core.ApplicationFilterChain.\ninternalDoFilter(ApplicationFilterChain.java:284)\nat org.apache.catalina.core.ApplicationFilterChain.\ndoFilter(ApplicationFilterChain.java:204)\nat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.\njava:256)\nat org.apache.catalina.core.StandardValveContext.\ninvokeNext(StandardValveContext.java:151)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\nat org.apache.catalina.core.StandardContextValve.\ninvokeInternal(StandardContextValve.java:245)\nat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.\njava:199)\nat org.apache.catalina.core.StandardValveContext.\ninvokeNext(StandardValveContext.java:151)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\nat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:195)\nat org.apache.catalina.core.StandardValveContext.\ninvokeNext(StandardValveContext.java:151)\nat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:164)\nat org.apache.catalina.core.StandardValveContext.\ninvokeNext(StandardValveContext.java:149)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\nat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:\n156)\nat org.apache.catalina.core.StandardValveContext.\ninvokeNext(StandardValveContext.java:151)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:563)\nat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:972)\nat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:209)\nat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:670)\nat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.\nprocessConnection(Http11Protocol.java:517)\nat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:575)\nat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.\njava:666)\nat java.lang.Thread.run(Thread.java:534)", "bug_id": 35156, "is_private": false, "id": 75732, "time": "2005-06-01T14:32:40Z", "creator": "york@perm.dataart.com", "creation_time": "2005-06-01T14:32:40Z", "tags": [], "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 35156, "is_private": false, "id": 76254, "attachment_id": null, "creator": "p_rudrakshala@yahoo.com", "creation_time": "2005-06-10T08:28:39Z", "time": "2005-06-10T08:28:39Z", "text": "Check bug# 33810. Try with 5.0.30 version and see if your problem goes away."}, {"count": 8, "tags": [], "creator": "yoavs@computer.org", "text": "Assuming problem did go away, since no response given by original poster.", "id": 77517, "attachment_id": null, "bug_id": 35156, "creation_time": "2005-07-21T23:27:42Z", "time": "2005-07-21T23:27:42Z", "is_private": false}, {"count": 9, "tags": [], "creator": "york@perm.dataart.com", "attachment_id": null, "text": "(In reply to comment #8)\n> Assuming problem did go away, since no response given by original poster.\n\nProblem is go away. But the bug is exist in Tomcat 5.0.28.\nAlso the bug is exist in Tomcat 5.5.9. But it is not so critical.\n1. JSP is used.\n2. Deploy application.\n3. Open 1.jsp. We receive a IOException instead of Exception from 2.jsp.\n4. Open 3.jsp. We receive content of 3.jsp.", "id": 77540, "time": "2005-07-22T11:23:12Z", "bug_id": 35156, "creation_time": "2005-07-22T11:23:12Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 35156, "text": "Please do not reopen the report. This issue will not be fixed in 5.0.28\n(obviously), and does not exist in 5.5.x code.", "id": 77541, "attachment_id": null, "creator": "remm@apache.org", "creation_time": "2005-07-22T11:42:44Z", "time": "2005-07-22T11:42:44Z", "is_private": false}, {"count": 11, "tags": [], "creator": "york@perm.dataart.com", "attachment_id": null, "id": 77543, "time": "2005-07-22T12:28:19Z", "bug_id": 35156, "creation_time": "2005-07-22T12:28:19Z", "is_private": false, "text": "(In reply to comment #10)\n> Please do not reopen the report. This issue will not be fixed in 5.0.28\n> (obviously), and does not exist in 5.5.x code.\n\nSorry. Tomcat 5.5.9 is not contan this bug."}]
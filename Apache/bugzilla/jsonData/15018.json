[{"count": 0, "tags": [], "creator": "elkner@linofee.org", "is_private": false, "text": "<taskdef name=\"makepdf\"\n\tclassname=\"org.apache.fop.tools.anttasks.Fop\">\n\t<classpath>\n\t\t<path refid=\"classpath.extensions\"/>\n\t\t<pathelement path=\"${build.class.dir}\"/>\n\t\t<pathelement path=\"${classpath.main}\"/>  <!-- ant stuff -->\n\t</classpath>\n</taskdef>\n\nso classpath contains definitely fop.jar.\n\nBut when running the task, all \nThread.currentThread().getContextClassLoader().getResourceAsStream(RES_PATH + file)\ne.g. with RES_PATH = \"org/apache/fop/conf/\";\nand file = \"config.xml\";\n\nreturn null!\n\nfop.jar definitely contains org/apache/fop/conf/config.xml ...\n\n\nDigging around, I found, that \nThread.currentThread().getContextClassLoader() resolves to the system \nclassloader and not to the antclassloader:\n\nFinding class org.apache.fop.layout.hyphenation.Hyphenator\nClass org.apache.fop.layout.hyphenation.Hyphenator loaded from ant loader\n  [makepdf] 09:54:56,021 [main] DEBUG (Hyphenator.java:84) - ClassLoader:\nsun.misc.Launcher$AppClassLoader@1a457b6\n  [makepdf] 09:54:56,028 [main] DEBUG (Hyphenator.java:86) - ClassLoader2:\norg.apache.tools.ant.AntClassLoader@166afb3\n\n\nproduced by:\n\n  cl = Thread.currentThread().getContextClassLoader();\n  log.debug(\"ClassLoader: \" + (cl != null ? cl.toString() : \"null\"));\n  cl = Hyphenator.class.getClassLoader();\n  log.debug(\"ClassLoader2: \" + (cl != null ? cl.toString() : \"null\"));\n\n\nFrom my understanding, Thread.currentThread().getContextClassLoader()\nshould resolve to the classLoader, which loaded the class, which\nis the AntClassLoader, which should be able to find all resources,\nsince it has the \"extended\" classpath.\n\nOr did I miss something/understood something completely wrong ???\n\n\nBTW: I'm using JDK 1.4.1.", "id": 27313, "time": "2002-12-03T09:07:27Z", "bug_id": 15018, "creation_time": "2002-12-03T09:07:27Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 15018, "attachment_id": null, "id": 27330, "time": "2002-12-03T15:54:53Z", "creator": "bodewig@apache.org", "creation_time": "2002-12-03T15:54:53Z", "is_private": false, "text": "Can org.apache.fop.tools.anttasks.Fop be loaded via the system classloader?\n\nCan the class that is doing\nThread.currentThread().getContextClassLoader().getResourceAsStream(RES_PATH + file)\nbe loaded from the system classloader?\n\nIf so, Ant will load that class from the system classloader (as it delegates) and\nyou run into the problem you describe.  See Bug 6606 and\n<http://jakarta.apache.org/ant/faq.html#delegating-classloader>"}, {"count": 2, "tags": [], "bug_id": 15018, "text": "Well, the mentioned problem (Bug 6606) is unrelated: \n1) fop.jar is not in the system classpath.\n2) Even if fop.jar would be in the system classpath, the sys classloader would\n   be able to find the resource, since it is in the same archive and thus in the \n   sys classpath as well.\n\nThe point is, that ant does not set the ContextClassLoader to the AntClassLoader\nand thus any request from the application itself to a Resource needs to be \nsatisfied by the sys classLoader, which does not know anything about the \n\"extended\" classpath. The request can not be satisfied since the request\nis never delegated to the AntClassLoader since the AntClassLoader is simply\nnot in the chain ...\n\nThus, IMHO, if ant creates a new task (thread), it should set the threads\nContextClassLoader to the AntClassLoader, which will find anything in \nthe \"extended\" classpath, if its delegates (i.e. normally the sys classLoader)\ncan\u00b4t find it.\n\n\nAs a workaround I did:\n  Thread.currentThread()\n    .setContextClassLoader(FOPTaskStarter.class.getClassLoader());\n\nFOPTaskStarter.class.getClassLoader() results in an AntClassLoader.\n\nDoing that everything works as expected. \nAnd since ant loads the Task class, it is actually the clean way\nand the way it should be done.\n\n\n\n\n\n", "id": 27355, "time": "2002-12-03T20:24:13Z", "creator": "elkner@linofee.org", "creation_time": "2002-12-03T20:24:13Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 15018, "attachment_id": null, "id": 92949, "time": "2006-09-03T17:01:46Z", "creator": "peterreilly@apache.org", "creation_time": "2006-09-03T17:01:46Z", "is_private": false, "text": "Marking a duplicate of 36717, as the latter's description is more\ngeneral.\n\n\n*** This bug has been marked as a duplicate of 36717 ***"}]
[{"count": 0, "tags": [], "text": "We are running CentOS 4.5 (2.6.9-55.0.2.ELsmp / httpd-2.0.52-32.2.ent.centos4) using a somewhat \ncomplicated network stack (see ifconfig below). 2 NIC's are using tg3 driver which are bonded using the \nbonding driver, the 8021q driver is also providing a tagged interface on the bonded interface.. \nEverything functions normally however all requests from any source IP always get logged in apache \nusing the same address which always ends in zero.. examples (130.65.159.0, 130.113.73.0). This \naddress is persistant until apache is restarted then a different address is chosen. We have 6 servers \nsetup this way all with different applications / workload all displaying the same symptom. I have tired \nusing Listen parameter both with interface IP and 0.0.0.0:443 without success. Netstat and naturally \ntcpdump both show correct source IP for the requests. \n\nHow does apache derive what goes into %h logging parameter?\nLMK if I can provide further information.\n\nLog example:\n130.65.159.0 - - [21/Oct/2007:09:10:56 -0700] \"GET / HTTP/1.1\" 200 2760 \"-\" \"Java/1.6.0\"\n130.65.159.0 - - [21/Oct/2007:09:10:56 -0700] \"GET / HTTP/1.1\" 200 2760 \"-\" \"Java/1.6.0\"\n130.65.159.0 - - [21/Oct/2007:09:10:56 -0700] \"GET / HTTP/1.1\" 200 2760 \"-\" \"Java/1.6.0\"\n130.65.159.0 - - [21/Oct/2007:09:11:08 -0700] \"GET / HTTP/1.1\" 200 2760 \"-\" \"Java/1.5.0_11\"\n\n#netstat -tanp | grep 443 | grep ESTA\ntcp        0      0 208.158.1.253:443           216.152.173.43:4459         ESTABLISHED 29916/httpd         \ntcp        0      0 208.158.1.253:443           216.152.173.43:4476         ESTABLISHED 29922/httpd       \n\n#ifconfig -a\nbond0     Link encap:Ethernet  HWaddr 00:1A:A0:16:6F:C9  \n          inet addr:192.168.255.68  Bcast:192.168.255.255  Mask:255.255.255.0\n          UP BROADCAST RUNNING MASTER MULTICAST  MTU:1500  Metric:1\n          RX packets:434124526 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:462568842 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:685862759 (654.0 MiB)  TX bytes:3689179262 (3.4 GiB)\n\nbond0.158 Link encap:Ethernet  HWaddr 00:1A:A0:16:6F:C9  \n          inet addr:208.158.1.253  Bcast:208.158.1.255  Mask:255.255.255.0\n          UP BROADCAST RUNNING MASTER MULTICAST  MTU:1500  Metric:1\n          RX packets:429076385 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:457738459 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:3390328017 (3.1 GiB)  TX bytes:3640731689 (3.3 GiB)\n\neth0      Link encap:Ethernet  HWaddr 00:1A:A0:16:6F:C9  \n          UP BROADCAST RUNNING SLAVE MULTICAST  MTU:1500  Metric:1\n          RX packets:412901942 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:462568725 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000 \n          RX bytes:927142678 (884.1 MiB)  TX bytes:3689171774 (3.4 GiB)\n          Interrupt:185 \n\neth1      Link encap:Ethernet  HWaddr 00:1A:A0:16:6F:C9  \n          UP BROADCAST RUNNING SLAVE MULTICAST  MTU:1500  Metric:1\n          RX packets:21222584 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:117 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000 \n          RX bytes:4053687377 (3.7 GiB)  TX bytes:7488 (7.3 KiB)\n          Interrupt:193 \n\nlo        Link encap:Local Loopback  \n          inet addr:127.0.0.1  Mask:255.0.0.0\n          UP LOOPBACK RUNNING  MTU:16436  Metric:1\n          RX packets:119465388 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:119465388 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:613059774 (584.6 MiB)  TX bytes:613059774 (584.6 MiB)", "is_private": false, "bug_id": 43667, "id": 109520, "time": "2007-10-21T09:26:15Z", "creator": "andrewg@anudc.net", "creation_time": "2007-10-21T09:26:15Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "jnicol@bluegecko.net", "attachment_id": null, "id": 114898, "time": "2008-03-23T11:54:37Z", "bug_id": 43667, "creation_time": "2008-03-23T11:54:37Z", "is_private": false, "text": "I'm having similar behavior on CentOS 4.6...\n\nhttpd-2.0.59-1.el4s1.10.el4.centos\n2.6.9-67.0.1.ELsmp\n\nStandard network setup here (no 802.1q), Apache is logging every request with the same IP address (not always ending with a 0 like OP). It changes every restart, so I assume it's the IP of the first client it sees.\n\nHere's a great example, the same client, same real source IP address, logged differently before and after a restart (neither of these IPs are correct):\n\n152.62.85.53 - - [22/Mar/2008:17:49:00 -0400] \"GET /redalert.php HTTP/1.0\" 200 7 \"-\" \"RedAlert\"\n200.255.78.56 - - [22/Mar/2008:18:04:01 -0400] \"GET /redalert.php HTTP/1.0\" 200 7 \"-\" \"RedAlert\"\n\nI've tried both \"Listen 0.0.0.0:80\" and \"Listen 80\". I also have \"NameVirtualHost *:80\" and <VirtualHost *:80>\n\nI turned on 'HostnameLookups On' and it logs the correct reverse lookups, so httpd must know the correct IP addresses somewhere.\n\nCustomLog logs/access_log combined\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" combined\n\nPlease help, this is driving me crazy!\n\nthanks\n\n"}, {"count": 2, "tags": [], "text": "What version of apr-util is being used?", "is_private": false, "bug_id": 43667, "id": 114944, "time": "2008-03-25T06:08:28Z", "creator": "jorton@redhat.com", "creation_time": "2008-03-25T06:08:28Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Sorry, that question should have been: what version of *apr* is being used?", "is_private": false, "bug_id": 43667, "id": 114945, "time": "2008-03-25T06:08:54Z", "creator": "jorton@redhat.com", "creation_time": "2008-03-25T06:08:54Z", "attachment_id": null}, {"count": 4, "text": "apr-util-0.9.13-1\napr-0.9.13-1", "bug_id": 43667, "attachment_id": null, "id": 114958, "time": "2008-03-25T13:21:56Z", "creator": "jnicol@bluegecko.net", "creation_time": "2008-03-25T13:21:56Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "creator": "jorton@redhat.com", "text": "Where is that version of APR packaged from; does it have any patches applied?  (That is not the version in RHEL4)\n\nI'd suspect a bad backport of a patch from APR 1.x is causing this, or something bad in the packaging.", "id": 114973, "time": "2008-03-26T01:39:28Z", "bug_id": 43667, "creation_time": "2008-03-26T01:39:28Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "jnicol@bluegecko.net", "text": "Hi Joe,\n\nThanks a lot for your help! I updated apr and the problem is fixed.\n\n'yum update' did not want to update the package, I presume it didn't consider 0.9.13 -> 0.9.4 to be an upgrade. I had to force it in with 'rpm -e --nodeps apr apr-util' and 'yum install apr apr-util'. Reloaded Apache and all is well! For the record, the new versions are \napr-0.9.4-24.9\napr-util-0.9.4-21\n\nThanks again for pointing me in the right direction!\n\nJonathan", "id": 114994, "time": "2008-03-26T14:26:58Z", "bug_id": 43667, "creation_time": "2008-03-26T14:26:58Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 43667, "is_private": false, "count": 7, "id": 114997, "time": "2008-03-26T15:09:50Z", "creator": "jorton@redhat.com", "creation_time": "2008-03-26T15:09:50Z", "text": "Great.  It would still be useful to know where the broken 0.9.13 package comes from."}]
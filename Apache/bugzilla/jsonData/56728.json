[{"count": 0, "tags": [], "bug_id": 56728, "attachment_id": 31816, "text": "Created attachment 31816\nimplementation of critical section controller\n\nHi folks!\n\nIn my work i have tests with many users and threads, but sometimes i have requests, which shouldn't execute simultaneously on one user.\n\nFor example, users changes settings in his profile, but only one user can change his information simultaneously. In default JMeter doesn't support this behavior.\n\nCritical Section Controller is a simple controller, which create lock with name (let us say his login/username) and other threads will block, if they try to go into the critical section with same name.\n\nFor improvement of this concept we can add policies, such as \"blocking lock\", and \"try lock\" for powerful scenarios.\n\nI tried to use many bicycles with BeanShell, but all BeanShell scripts runs under lock on Interpreter and with named locks i have many deadlocks problems:)\n\nBicycles with jsr223 better, but they are to complex.\n\nThis concept is easy and clearly.", "id": 176416, "time": "2014-07-16T11:30:54Z", "creator": "epikhinm@gmail.com", "creation_time": "2014-07-16T11:30:54Z", "is_private": false}, {"count": 1, "tags": [], "text": "Hello Mikhail,\nThanks for patch.\nI reviewed it rapidly, I think it only works within 1 JVM (so not in distributed test, right ?).\nIt is rather an important limitation.\nImplementing a distributed system might be tricky but would be possible by making slaves ask master for lock.\n\n@dev team what's your opinion on incorporating this as-is and enhancing it for distributed testing later ?\nRegards\nPhilippe M.", "is_private": false, "bug_id": 56728, "id": 176428, "time": "2014-07-16T14:59:40Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-07-16T14:59:40Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 56728, "attachment_id": null, "text": "Yes, this concept work fine with one JVM.\nIf you want to use something like that with multiple jmeter instances, than you need shard your dataset and use it separately.\n\nDistributed mechanism is to slow and have many overheads. I haven't any desire to write my own ZooKeeper / Paxos. It's too slow, too hard.\n\nAnd i don't want to install zookeeper quorum just for named locks for severals tests. It's overhead. It's complicated.\n\nI have many tests with high throughput (>100000rps), but most of tests (99.9%) runs from single machine. And in this case this bicycle works very well.\n\nWe can implement option with multiple modes. Distributed and Single.\n\nBut now, there are no neither one nor the other. Let's use though single mode.\n\nI'll tested this bicycle in non-contention scenario, and 1 native thread can handle ~300000rps on macbook air. It's good performance for this feature.", "id": 176434, "time": "2014-07-16T15:15:23Z", "creator": "epikhinm@gmail.com", "creation_time": "2014-07-16T15:15:23Z", "is_private": false}, {"count": 3, "tags": [], "creator": "epikhinm@gmail.com", "is_private": false, "id": 176435, "attachment_id": null, "bug_id": 56728, "creation_time": "2014-07-16T15:26:41Z", "time": "2014-07-16T15:26:41Z", "text": "And with current architecture any paxos requests will impose serious delays, and using that on high throughput tests, or with many nodes will be very difficult, if not impossible.\n\nJust shard data. Just use simple solution. If you want single dataset, than use redis, it's better for that problem."}, {"count": 4, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "id": 176474, "attachment_id": null, "bug_id": 56728, "creation_time": "2014-07-17T22:18:19Z", "time": "2014-07-17T22:18:19Z", "text": "Hello Mikhail,\nCurrent patch is not working for me with trunk.\nUnlock is never called.\n\nWhat version did you test with ?\nThanks"}, {"count": 5, "tags": [], "bug_id": 56728, "is_private": false, "text": "Created attachment 31828\nCriticalSectionController_v0.2\n\nHello!\nSorry, first patch have a deadlock bug, if you interrupt test.\nI fixed that with that patch.", "id": 176484, "time": "2014-07-18T04:23:39Z", "creator": "epikhinm@gmail.com", "creation_time": "2014-07-18T04:23:39Z", "attachment_id": 31828}, {"count": 6, "tags": [], "text": "Date: Fri Jul 18 16:15:03 2014\nNew Revision: 1611691\n\nURL: http://svn.apache.org/r1611691\nLog:\nBug 56728 - New Critical Section Controller to serialize blocks of a Test\nBugzilla Id: 56728\n\nModified:\n    jmeter/trunk/src/components/org/apache/jmeter/control/CriticalSectionController.java   (props changed)\n    jmeter/trunk/src/components/org/apache/jmeter/control/gui/CriticalSectionControllerGui.java   (props changed)\n\n\nDate: Fri Jul 18 16:13:18 2014\nNew Revision: 1611689\n\nURL: http://svn.apache.org/r1611689\nLog:\nBug 56728 - New Critical Section Controller to serialize blocks of a Test\nBugzilla Id: 56728\n\nAdded:\n    jmeter/trunk/src/components/org/apache/jmeter/control/CriticalSectionController.java   (with props)\n    jmeter/trunk/src/components/org/apache/jmeter/control/gui/CriticalSectionControllerGui.java   (with props)\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages.properties\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages_fr.properties\n    jmeter/trunk/xdocs/changes.xml\n    jmeter/trunk/xdocs/usermanual/component_reference.xml", "is_private": false, "bug_id": 56728, "id": 176494, "time": "2014-07-18T16:22:45Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-07-18T16:22:45Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Hello Mikhail,\nThanks for patch 2, but it was still not working for me and code was strange:\n- Clearing lock map on thread end is wrong for me as it is shared among many threads which may have not ended\n- It was still blocking because lock was taken many times and only released one time\n\n\nI rewrote nearly all the controller but kept GUI class as is.\n\nYou thorough tests are welcome.\n\nRegards\nPhilippe M.\n@philmdot", "attachment_id": null, "bug_id": 56728, "id": 176495, "time": "2014-07-18T16:27:32Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-07-18T16:27:32Z", "is_private": false}, {"count": 8, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 176496, "time": "2014-07-18T16:27:48Z", "bug_id": 56728, "creation_time": "2014-07-18T16:27:48Z", "is_private": false, "text": "Date: Fri Jul 18 16:17:03 2014\nNew Revision: 1611693\n\nURL: http://svn.apache.org/r1611693\nLog:\nBug 56728 - New Critical Section Controller to serialize blocks of a Test\nBugzilla Id: 56728\n\nModified:\n    jmeter/trunk/bin/saveservice.properties"}, {"count": 9, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "id": 176497, "attachment_id": null, "bug_id": 56728, "creation_time": "2014-07-18T16:30:50Z", "time": "2014-07-18T16:30:50Z", "text": "Date: Fri Jul 18 16:19:44 2014\nNew Revision: 1611695\n\nURL: http://svn.apache.org/r1611695\nLog:\nBug 56728 - New Critical Section Controller to serialize blocks of a Test\nBugzilla Id: 56728\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/save/SaveService.java"}, {"count": 10, "tags": [], "creator": "epikhinm@gmail.com", "attachment_id": null, "is_private": false, "id": 176498, "time": "2014-07-18T16:54:22Z", "bug_id": 56728, "creation_time": "2014-07-18T16:54:22Z", "text": "I was lost in broad daylight:) Thanks for your code! You better know JMeter sources."}, {"count": 11, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 176500, "time": "2014-07-18T17:06:01Z", "bug_id": 56728, "creation_time": "2014-07-18T17:06:01Z", "is_private": false, "text": "Date: Fri Jul 18 17:02:56 2014\nNew Revision: 1611713\n\nURL: http://svn.apache.org/r1611713\nLog:\nBug 56728 - New Critical Section Controller to serialize blocks of a Test\nBugzilla Id: 56728\n\nModified:\n    jmeter/trunk/xdocs/usermanual/component_reference.xml"}, {"count": 12, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "id": 176700, "time": "2014-07-26T21:20:54Z", "bug_id": 56728, "creation_time": "2014-07-26T21:20:54Z", "is_private": false, "text": "Date: Sat Jul 26 21:18:27 2014\nNew Revision: 1613724\n\nURL: http://svn.apache.org/r1613724\nLog:\nBug 56728 - New Critical Section Controller to serialize blocks of a Test\nFix javadocs as per sebb notes on dev mailing list\nBugzilla Id: 56728\n\nModified:\n    jmeter/trunk/src/components/org/apache/jmeter/control/gui/CriticalSectionControllerGui.java\n\nDate: Sat Jul 26 21:18:59 2014\nNew Revision: 1613725\n\nURL: http://svn.apache.org/r1613725\nLog:\nBug 56728 - New Critical Section Controller to serialize blocks of a Test\nFix code and javadocs as per sebb notes on dev mailing list\nBugzilla Id: 56728\n\nModified:\n    jmeter/trunk/src/components/org/apache/jmeter/control/CriticalSectionController.java"}, {"count": 13, "tags": [], "text": "*** Bug 43384 has been marked as a duplicate of this bug. ***", "attachment_id": null, "bug_id": 56728, "id": 178827, "time": "2014-10-29T13:39:28Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2014-10-29T13:39:28Z", "is_private": false}]
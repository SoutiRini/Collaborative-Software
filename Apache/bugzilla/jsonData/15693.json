[{"count": 0, "tags": [], "creator": "peter.brant@courts.state.wi.us", "text": "This has been reported a few times before (for example bug 4524).\n\nTo recap:\n\nNetwork connections hang (a connection is made, but then nothing happens) when\nTomcat is running as a service.  The JVM seems to be working normally otherwise\n(threads continue to run, etc.)\n\nThe problem is worst on IBM's 1.3.0 JDK (hangs immediately), better with Sun\n1.3.1+ (non-classic) JVM's, but it still happens (usually after a few hundred to\na couple thousand requests).\n\nFix:\n\nDon't let the start up thread die.  This fixes the problem on all JVM's we've tried.\n\nPatch to org.apache.catalina.startup.BootstrapService follows\n\n*** BootstrapService.java.orig  Thu Dec 19 07:51:48 2002\n--- BootstrapService.java   Fri Dec 27 17:35:53 2002\n***************\n*** 244,250 ****\n          Method method = catalinaService.getClass().getMethod(methodName, null);\n          method.invoke(catalinaService, null);\n          log(\"Service started\");\n! \n      }\n  \n  \n--- 244,260 ----\n        Method method = catalinaService.getClass().getMethod(methodName, null);\n        method.invoke(catalinaService, null);\n        log(\"Service started\");\n!       synchronized(this)\n!       {\n!           try\n!           {\n!               wait();\n!           }\n!           catch (InterruptedException e)\n!           {\n!               // ignore\n!           }\n!       }\n    }\n  \n  \n***************\n*** 253,259 ****\n       */\n      public void stop()\n          throws Exception {\n! \n          log(\"Stopping service\");\n          String methodName = \"stop\";\n          Method method = catalinaService.getClass().getMethod(methodName, null);\n--- 263,272 ----\n     */\n    public void stop()\n        throws Exception {\n!       synchronized(this)\n!       {\n!           notifyAll();\n!       }\n        log(\"Stopping service\");\n        String methodName = \"stop\";\n        Method method = catalinaService.getClass().getMethod(methodName, null);", "id": 28505, "time": "2002-12-28T00:13:01Z", "bug_id": 15693, "creation_time": "2002-12-28T00:13:01Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "Sorry, but I don't see a need to add that code, as I never actually experienced\nany particular problem with Tomcat as a service.", "is_private": false, "id": 28509, "creator": "remm@apache.org", "time": "2002-12-28T08:15:28Z", "bug_id": 15693, "creation_time": "2002-12-28T08:15:28Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "peter.brant@courts.state.wi.us", "text": "That's unfortunate since other people are apparently having the same problem we \ndid.\n\nI'm not sure what particular combination of DLLs, etc. that we have that causes \nit, but the problem has been universal across different versions of Windows (NT \nand various flavors of 2000) and different JVMs/JDKs (IBM 1.3.0 and Sun 1.4.1).\n\nThe technique in the patch has been equally universal in fixing the problem in \nTomcat and other Java servers we wanted to run as services.  We're just now \ndeploying Tomcat, but the technique has been in use successfully on a couple of \nhundred machines for several months.", "id": 28520, "time": "2002-12-28T22:02:53Z", "bug_id": 15693, "creation_time": "2002-12-28T22:02:53Z", "is_private": false, "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "remm@apache.org", "is_private": false, "id": 28523, "time": "2002-12-29T10:40:00Z", "bug_id": 15693, "creation_time": "2002-12-29T10:40:00Z", "tags": [], "text": "I'd like more reports that there's something to fix. Also, your patch is likely\nbad for normal operation (which has been merged with the service code in 5.0.x)."}, {"count": 4, "tags": [], "creator": "mai3116@rit.edu", "attachment_id": null, "id": 30774, "time": "2003-02-05T20:39:30Z", "bug_id": 15693, "creation_time": "2003-02-05T20:39:30Z", "is_private": false, "text": "I am using Sun JDK1.4.1_01, Windows NT SP6, and Apache Tomcat/4.1.18-LE-jdk14 \ninstalled as a service (during installation.)\n\nI wanted to CONFIRM that the apache service does hang after serving an \narbitrary ammount of requests. Nothing is written to the log files, yet \ntomcat.exe continues to run. The connections seem to be accepted, but no data \nis ever returned, and thus the http request just hangs. \n\nThe only way to fix this is to stop and then start the apache service. I have \nno tried out the above patch, but I will be tempted to if there is no \nexplaination for this. \n\nThanks,\nMin"}, {"count": 5, "tags": [], "bug_id": 15693, "text": "An update --\n\nI don't have any confidence that the patch does anything at all for JDK's >= \n1.3.1.  It did fix the problem for IBM's 1.3.0 JDK, but our other production \nJDK - Sun 1.4.1 - continued to hang.\n\nWe _think_ it might be a TCP/IP bug in Windows since we've had similar kinds \nof hangs in Apache2 and Sybase on Windows 2000 SP3 in particular - that was \nthe opinion of Sybase support anyway, but we're not too confident on that \nscore either.\n\nThe only other thing we could think of is that it is somehow related to some \nremote control software (Remote Administrator) we also use.  The machines in \nquestion are pretty much bare otherwise.\n\nIt is a real problem with some Windows configurations (although apparently not \nthe vast majority or there would be many more bug reports), but darned if \nwe've been able to figure it out.\n\n\n\n\n\n", "id": 30775, "time": "2003-02-05T21:09:48Z", "creator": "peter.brant@courts.state.wi.us", "creation_time": "2003-02-05T21:09:48Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 15693, "attachment_id": null, "text": "Having reviewed this report there is nothing to suggest that Tomcat is the \nroot cause of the problem. If you have any further information that suggests \nTomcat is at fault, please reopen the bug with the new information.", "id": 53613, "time": "2004-03-07T18:58:15Z", "creator": "markt@apache.org", "creation_time": "2004-03-07T18:58:15Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "Hello,\n(Finally :o) Upgrading from 2.2, I have either a regression or the same \"behavior change\" as commented in https://bz.apache.org/bugzilla/show_bug.cgi?id=54319.\n\nPlease update based on following details.\n\nThis conf is added to fresh 2.4.23 build with minimal set of modules ( mpm worker )\n# =======BEGIN\nErrorDocument 400 /error/unavailable\nErrorDocument 401 /error/empty\nErrorDocument 403 /error/forbidden\nErrorDocument 404 /error/unavailable\n\nProxyErrorOverride On\nAlias /error \"/tmp/error\"\nProxyPass /error !\n\n<Directory \"/tmp/error\">\n AllowOverride None\n Require all granted\n</Directory>\n\nProxyPass / http://127.0.0.1:1234/\nProxyPassReverse / http://127.0.0.1:1234/\n# ========= END\n\n\"Server\" on 127.0.0.1:1234 responds with status 403, no body.\nThe configuration above works as expected.\n\nIf ProxyPass(Reverse) directives are in a Location block : (rest of configuration unchanged)....\n# =======BEGIN\n <Location />\n     Require all granted\n     ProxyPass http://127.0.0.1:1234/\n     ProxyPassReverse http://127.0.0.1:1234/\n </Location>\n# ========= END\n\n... then an internal requests loop starts until LimitInternalRecursion (10) is reached. Client receives latest 403 response, a status 500 is recorded in access_log.\n\nnote : the same configuration (using Order+Allow instead of Require ) on a fresh minimal build of 2.2.31 works as expected.\n\n++\nN'Alex.", "is_private": false, "bug_id": 60458, "id": 195412, "time": "2016-12-09T00:37:49Z", "creator": "alexandre.schaff@gmail.com", "creation_time": "2016-12-09T00:37:49Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "covener@gmail.com", "attachment_id": 34509, "text": "Created attachment 34509\npotential fix\n\npotential fix, untested. Iterates over server conf to check for ! entries.", "id": 195413, "time": "2016-12-09T01:04:46Z", "bug_id": 60458, "creation_time": "2016-12-09T01:04:46Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 60458, "text": "Are you able to test a patch?", "id": 195414, "time": "2016-12-09T01:05:02Z", "creator": "covener@gmail.com", "creation_time": "2016-12-09T01:05:02Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "alexandre.schaff@gmail.com", "attachment_id": null, "is_private": false, "id": 195420, "time": "2016-12-09T08:55:49Z", "bug_id": 60458, "creation_time": "2016-12-09T08:55:49Z", "text": "(In reply to Eric Covener from comment #2)\n> Are you able to test a patch?\n\nFix applied and tested 2.4.23.\nOn that single test, the behavior is consistent with 2.2 : no more internal loop.\n\nThanks Eric.\n\nNote : component changed from core to mod_proxy."}, {"count": 4, "tags": [], "bug_id": 60458, "text": "If this affects trunk, we should fold in there and then propose a back port to 2.4", "id": 195428, "time": "2016-12-09T13:33:00Z", "creator": "jim@apache.org", "creation_time": "2016-12-09T13:33:00Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 195748, "time": "2016-12-31T00:27:05Z", "bug_id": 60458, "creation_time": "2016-12-31T00:27:05Z", "text": "Fixed in 2.4.25"}, {"count": 6, "attachment_id": null, "bug_id": 60458, "text": "FYI this caused a regression, it may be reverted in the next 2.4 release. After re-reviewing the PR, a better answer may have been \"don't put it in <Location> if you want to have an exception before it.\n\nBug in the fix aside, one of the points of ProxyPass in <Location> is that it's a single proxy rule for a location.  So the server-scoped rules, even exceptions, do not \"come first\".", "id": 196561, "time": "2017-01-30T12:56:14Z", "creator": "covener@gmail.com", "creation_time": "2017-01-30T12:56:14Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "text": "Hello, we upgraded from 2.4.18 to 2.4.25 and now our configuration isn't working anymore.\n\n   ProxyPreserveHost On\n\n   <Proxy balancer://ppp>\n      BalancerMember http://xxx.xx.xx.xx:8080 route=vm_0 ping=5\n      BalancerMember http://xxx.xx.xx.xx:8080 route=vm_1 ping=5\n   </Proxy>\n\n   <Location \"/service\">\n     ProxyPass balancer://ppp/system stickysession=JSESSIONID|jsessionid scolonpathdelim=On\n     ProxyPassReverse balancer://ppp/system\n     ProxyPassReverse http://ppp.local/system\n     ProxyPassReverse https://ppp.local/system\n     ProxyPassReverseCookiePath /system /service\n   </Location>\n\n   ProxyPass /error !\n   ProxyPass /manager !\n   ProxyPass / balancer://asp/ stickysession=JSESSIONID|jsessionid scolonpathdelim=On\n   ProxyPassReverse / balancer://ppp/\n\nWith 2.4.25 all requests are routet through the last ProxyPass, the Location directive is ignored so the rewrite from the context is not happening.\nCan this be due to this change?\n\nIf i put the last ProxyPass in a Location directive like <Location ~ \"^/(?!service)\"> it's also working.\n\nThanks in Advance \nMichael", "is_private": false, "bug_id": 60458, "id": 198171, "time": "2017-04-05T11:12:32Z", "creator": "michael.haas10@gmail.com", "creation_time": "2017-04-05T11:12:32Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 48964, "attachment_id": null, "text": "FcgidPassHeader does not convert headers to the expected environment variable.\n\nExample:\n\nApache directive: FcgidPassHeader Authorization\nExpected CGI environment variable: HTTP_AUTHORIZATION\nActual CGI environment variable: Authorization\n\nReasons I think it's a bug:\n\n1.  Apache provides request headers (fastcgi or not) through environment variables (http2env), uppercased, dash converted to underscore, and prefixed by HTTP_.\n\n2.  It is a common practice (dare I say standard) for web applications to expect request headers be provided through environment variables with a HTTP_ prefix.\n\n3.  FcgidPassHeader and -pass-header (mod_fastcgi equivalent) do not provide the same functionality, which is very important for anyone converting to mod_fcgid.  mod_fastcgi even goes so far to call mod_fcgid's current behavior \"broken\".\n\nhttp://www.fastcgi.com/cvs/mod_fastcgi/fcgi_protocol.c\n(see #ifndef USE_BROKEN_PASS_HEADER)\n\nhttp://www.fastcgi.com/archives/fastcgi-developers/2008-September/000057.html\n\nOther:\n\nLooking through the pre-ASF mod_fcgid mailing list shows this has been proposed before (see http://www.mail-archive.com/mod-fcgid-users@lists.sourceforge.net/msg00163.html), but went nowhere.   I believe the original arguments presented by Christian Seiler sum up the problem quite nicely.", "id": 135546, "time": "2010-03-23T05:51:27Z", "creator": "dude@zaplabs.com", "creation_time": "2010-03-23T05:51:27Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 48964, "attachment_id": null, "text": "FWLIW, the current behavior is fully documented at\n\nhttp://httpd.apache.org/mod_fcgid/mod/mod_fcgid.html#fcgidpassheader\n\nNot all \"standard\" environment variables are prefixed with \"HTTP_\" (CONTENT_TYPE is one example) so it isn't abundantly clear to me that non-standard environment variables should be prefixed with \"HTTP_\".\n\nInterestingly, according to that mod_fastcgi post/patch, mod_fastcgi had similar behavior until 2008.\n\nIt is certainly bad that the header names aren't folded to uppercase when creating the envvar name.\n\nMeanwhile, mod_fcgid users somehow have working configs/apps currently, and any change could break an application.\n\nThis probably needs to be resolved with a directive like FcgidPassHeaderOptions with keywords like CasePreserve/UpCase and HttpPrefix/NoPrefix, with defaults which preserve the current behavior.  At some major release boundary in the future the defaults can change to something more appropriate (definitely fold-to-uppercase, possibly add \"HTTP_\" prefix).", "id": 135555, "time": "2010-03-23T13:00:35Z", "creator": "trawick@apache.org", "creation_time": "2010-03-23T13:00:35Z", "is_private": false}, {"count": 2, "tags": [], "creator": "dude@zaplabs.com", "attachment_id": null, "id": 135566, "time": "2010-03-23T17:36:18Z", "bug_id": 48964, "creation_time": "2010-03-23T17:36:18Z", "is_private": false, "text": "(In reply to comment #1)\n> Meanwhile, mod_fcgid users somehow have working configs/apps currently, and any\n> change could break an application.\n\nI agree.  Preserving the current expected behavior is a must.\n \n> This probably needs to be resolved with a directive like FcgidPassHeaderOptions\n> with keywords like CasePreserve/UpCase and HttpPrefix/NoPrefix, with defaults\n> which preserve the current behavior.  At some major release boundary in the\n> future the defaults can change to something more appropriate (definitely\n> fold-to-uppercase, possibly add \"HTTP_\" prefix).\n\nWould adding a conditional argument to FcgiPassHeader which specifies the environment variable be an acceptable solution?\n\nFcgiPassHeader Authorization\n* define env var 'Authorization', as it currently does.\n\nFcgiPassHeader Authorization X-HTTP_AUTHORIZATION\n* define env var 'X-HTTP_AUTHORIZATION' with Authorization request header value.\n\nThis would allow fcgi spawned applications to be passed any header as it sees fit, without resorting to the additional overhead of mod_rewrite rules."}, {"count": 3, "text": "*** Bug 48982 has been marked as a duplicate of this bug. ***", "creator": "trawick@apache.org", "is_private": false, "id": 135606, "time": "2010-03-24T22:52:05Z", "bug_id": 48964, "creation_time": "2010-03-24T22:52:05Z", "tags": [], "attachment_id": null}, {"count": 4, "text": ">FcgiPassHeader Authorization X-HTTP_AUTHORIZATION\n\nI like that idea, though providing the separate processing option allows easy\ntweaking of all such envvars at once to match mod_fastcgi behavior (and\napparently PHP expectations -- see 48982) (and easy revert to current behavior\nif mod_fcgid defaults change in the future).\n\nThoughts from the crowd?\n\nIs there a case where we need to support something other than\n\na) current mod_fcgid behavior\nb) recent mod_fastcgi behavior plus PHP expectation\n\n?", "bug_id": 48964, "is_private": false, "id": 135607, "time": "2010-03-24T22:57:49Z", "creator": "trawick@apache.org", "creation_time": "2010-03-24T22:57:49Z", "tags": [], "attachment_id": null}, {"count": 5, "text": "(In reply to comment #4)\n> >FcgiPassHeader Authorization X-HTTP_AUTHORIZATION\n> Thoughts from the crowd?\n\nI like this either, I think this optimal 2nd parameter would fit everyone's needs.", "bug_id": 48964, "is_private": false, "id": 135608, "time": "2010-03-24T23:02:19Z", "creator": "erno.kovacs@freemail.hu", "creation_time": "2010-03-24T23:02:19Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 48964, "attachment_id": null, "text": "This sort of overlooks the obvious, passing both Authorization and HTTP_AUTHORIZATION at once?", "id": 135609, "time": "2010-03-24T23:13:56Z", "creator": "wrowe@apache.org", "creation_time": "2010-03-24T23:13:56Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 48964, "attachment_id": null, "id": 135612, "time": "2010-03-25T00:23:11Z", "creator": "trawick@apache.org", "creation_time": "2010-03-25T00:23:11Z", "is_private": false, "text": "How true...  (+1)"}, {"count": 8, "tags": [], "creator": "trawick@apache.org", "attachment_id": 25182, "is_private": false, "id": 135619, "time": "2010-03-25T11:40:28Z", "bug_id": 48964, "creation_time": "2010-03-25T11:40:28Z", "text": "Created attachment 25182\nproposed patch for PR48964\n\nThis patch follows wrowe's suggestion: just add the header twice, once in legacy form and once with the generally-expected munging."}, {"count": 9, "text": "For those in this mini-discussion, do you have interesting use cases that aren't satisfied by Will Rowe's suggestion, which is implemented by https://issues.apache.org/bugzilla/attachment.cgi?id=25182, and which requires no configuration changes?", "creator": "trawick@apache.org", "attachment_id": null, "id": 136144, "time": "2010-04-14T10:07:37Z", "bug_id": 48964, "creation_time": "2010-04-14T10:07:37Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "is_private": false, "id": 136364, "time": "2010-04-23T14:43:25Z", "bug_id": 48964, "creation_time": "2010-04-23T14:43:25Z", "text": "the proposed patch has been committed for future mod_fcgid 2.3.6"}]
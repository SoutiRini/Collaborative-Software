[{"count": 0, "tags": [], "bug_id": 57973, "is_private": false, "id": 183185, "attachment_id": null, "creator": "35490942@qq.com", "creation_time": "2015-05-29T08:42:40Z", "time": "2015-05-29T08:42:40Z", "text": "We found a new defect in the latest POI 3.12 when adding comments for the only A1 cell(There is not any issue for the other cells).\nThe test source code is as below. After running the below source code, it will throw the below exception.\nException in thread \"main\" java.lang.IllegalArgumentException: Multiple cell comments in one cell are not allowed, cell: A1\n\tat org.apache.poi.xssf.usermodel.XSSFDrawing.createCellComment(XSSFDrawing.java:318)\n\tat org.apache.poi.xssf.usermodel.XSSFDrawing.createCellComment(XSSFDrawing.java:52)\n\tat com.tibco.poi.xssf.CellComments.main(CellComments.java:38)\n\n\nimport org.apache.poi.ss.usermodel.*;\nimport org.apache.poi.xssf.usermodel.XSSFSheet;\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\nimport java.io.IOException;\nimport java.io.FileOutputStream;\n\n/**\n * Demonstrates how to work with excel cell comments.\n * <p>\n * Excel comment is a kind of a text shape,\n * so inserting a comment is very similar to placing a text box in a worksheet\n * </p>\n *\n * @author Yegor Kozlov\n */\npublic class CellComments {\n    public static void main(String[] args) throws IOException {\n    \tXSSFWorkbook wb = new XSSFWorkbook();\n\n        CreationHelper factory = wb.getCreationHelper();\n\n        XSSFSheet sheet = wb.createSheet();\n        Drawing drawing = sheet.createDrawingPatriarch();\n        ClientAnchor anchor = factory.createClientAnchor();\n        \n        Cell cell0 = sheet.createRow(0).createCell(0);\n        cell0.setCellValue(\"Cell0\");\n\n        Comment comment0 = drawing.createCellComment(anchor);\n        RichTextString str0 = factory.createRichTextString(\"Hello, World!\");\n        comment0.setString(str0);\n        comment0.setAuthor(\"Apache POI\");\n        cell0.setCellComment(comment0);\n        \n        Cell cell1 = sheet.createRow(3).createCell(5);\n        cell1.setCellValue(\"F4\");\n        Comment comment1 = drawing.createCellComment(anchor);\n        RichTextString str1 = factory.createRichTextString(\"Hello, World!\");\n        comment1.setString(str1);\n        comment1.setAuthor(\"Apache POI\");\n        cell1.setCellComment(comment1);\n\n        Cell cell2 = sheet.createRow(2).createCell(2);\n        cell2.setCellValue(\"C3\");\n\n        Comment comment2 = drawing.createCellComment(anchor);\n        RichTextString str2 = factory.createRichTextString(\"XSSF can set cell comments\");\n        //apply custom font to the text in the comment\n        Font font = wb.createFont();\n        font.setFontName(\"Arial\");\n        font.setFontHeightInPoints((short)14);\n        font.setBoldweight(Font.BOLDWEIGHT_BOLD);\n        font.setColor(IndexedColors.RED.getIndex());\n        str2.applyFont(font);\n\n        comment2.setString(str2);\n        comment2.setAuthor(\"Apache POI\");\n        comment2.setColumn(2);\n        comment2.setRow(2);\n\n        String fname = \"comments.xlsx\";\n        FileOutputStream out = new FileOutputStream(fname);\n        wb.write(out);\n        out.close();\n\n    }\n}"}, {"count": 1, "tags": [], "bug_id": 57973, "is_private": false, "text": "This check was added on-purpose as otherwise you could create invalid Excel workbooks, see bug 56835 for more details.\n\nThe anchor that you specify for comments has setCol/setRow methods which specify where the comment resides in the spreadsheet. When you add multiple comments you need to pass different anchors which specify the actual location of the comment, e.g. by adding the following between the calls to createComment() your code-sample is running fine:\n\n        anchor = factory.createClientAnchor();\n        anchor.setCol1(2);\n        anchor.setCol2(3);\n        anchor.setRow1(1);\n        anchor.setRow2(2);\n\nSee also http://poi.apache.org/spreadsheet/quick-guide.html#CellComments", "id": 183536, "time": "2015-06-15T14:26:48Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-06-15T14:26:48Z", "attachment_id": null}]
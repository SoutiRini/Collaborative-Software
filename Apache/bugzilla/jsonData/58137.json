[{"attachment_id": 32904, "tags": [], "bug_id": 58137, "text": "Created attachment 32904\nTest plan showing issue\n\nIssue found here:\n\nhttp://stackoverflow.com/questions/31401399/jmeter-url-encoded-embedded-resources\n\n\nTo reproduce :\nPut this in <Tomcat>/examples/index.jsp:\n\n<!--\n  Licensed to the Apache Software Foundation (ASF) under one or more\n  contributor license agreements.  See the NOTICE file distributed with\n  this work for additional information regarding copyright ownership.\n  The ASF licenses this file to You under the Apache License, Version 2.0\n  (the \"License\"); you may not use this file except in compliance with\n  the License.  You may obtain a copy of the License at\n\n      http://www.apache.org/licenses/LICENSE-2.0\n\n  Unless required by applicable law or agreed to in writing, software\n  distributed under the License is distributed on an \"AS IS\" BASIS,\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n  See the License for the specific language governing permissions and\n  limitations under the License.\n-->\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0 Transitional//EN\">\n<HTML><HEAD><TITLE>Apache Tomcat Examples</TITLE>\n<META http-equiv=Content-Type content=\"text/html\">\n</HEAD>\n<BODY>\n<P>\n<H3>Apache Tomcat Examples</H3>\n<P></P>\n<ul>\n<img src=\"http://www.ubik-ingenierie.com/wp-content/uploads/2015/03/logo_ubik_ingenierie.png?getItem={someID}\" ></img>\n<li><a href=\"servlets\">Servlets examples</a></li>\n<li><a href=\"jsp\">JSP Examples</a></li>\n</ul>\n</BODY></HTML>\n\nand use attached test plan", "count": 0, "id": 184023, "time": "2015-07-14T19:32:01Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2015-07-14T19:32:01Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 58137, "text": "Author: pmouawad\nDate: Tue Jul 14 21:31:34 2015\nNew Revision: 1691090\n\nURL: http://svn.apache.org/r1691090\nLog:\nBug 58137 - JMeter fails to download embedded URLS that contain illegal characters in URL (it does not escape them)\nBugzilla Id: 58137\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerBase.java\n\nAuthor: pmouawad\nDate: Tue Jul 14 21:32:41 2015\nNew Revision: 1691091\n\nURL: http://svn.apache.org/r1691091\nLog:\nBug 58137 - JMeter fails to download embedded URLS that contain illegal characters in URL (it does not escape them)\nBugzilla Id: 58137\n\nModified:\n    jmeter/trunk/xdocs/changes.xml", "id": 184033, "time": "2015-07-14T21:37:31Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2015-07-14T21:37:31Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 58137, "attachment_id": null, "text": "The problem with fixing this is that it will break any existing tests that rely on the path being pre-encoded.\n\nIn fact the component reference explicitly says:\n\n\"Also please note that the path is not encoded - apart from replacing spaces with %20 - so unsafe characters may need to be encoded to avoid errors such as URISyntaxException.\"\n\nThe fix is wrong, and must be reverted.\n\nHowever, the docs could be updated with info on how to encode the path.", "id": 184048, "time": "2015-07-16T11:40:36Z", "creator": "sebb@apache.org", "creation_time": "2015-07-16T11:40:36Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 58137, "attachment_id": null, "text": "(In reply to Sebb from comment #2)\n> The problem with fixing this is that it will break any existing tests that\n> rely on the path being pre-encoded.\n> \n> In fact the component reference explicitly says:\n> \n> \"Also please note that the path is not encoded - apart from replacing spaces\n> with %20 - so unsafe characters may need to be encoded to avoid errors such\n> as URISyntaxException.\"\n> \n\nIgnore the above: I misread the issue.\n\nHowever, AFAICT the sample JSP uses invalid syntax for the URL, so should not just be unconditionally corrected. Apart from hiding the invalid syntax, it may cause problems for correctly encoded URLs.", "id": 184068, "time": "2015-07-18T11:35:17Z", "creator": "sebb@apache.org", "creation_time": "2015-07-18T11:35:17Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 58137, "text": "A further issue is that this breaks the behaviour of JMeter for file URLs.\n\nAt present, it is possible to use relative file names with the file protocol.\n\nThe current fix makes it impossible to use relative file URLs.\n\nA simple fix is to only apply the additional fix-ups for non-file protocols.\n\nHowever I still think it is wrong to silently correct invalid URLs.", "count": 4, "id": 184144, "time": "2015-07-23T12:48:19Z", "creator": "sebb@apache.org", "creation_time": "2015-07-23T12:48:19Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 58137, "text": "Hi sebb,\nIsn't is an issue not to fix it , as those \"broken/illegal\" URL are ok for browsers.\n\nSee:\nhttp://stackoverflow.com/questions/31401399/jmeter-url-encoded-embedded-resources\n\nUser is happy with fix, so should it really be reverted this way ?\n\nThanks", "id": 184145, "time": "2015-07-23T12:50:18Z", "creator": "support@ubikloadpack.com", "creation_time": "2015-07-23T12:50:18Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "sebb@apache.org", "text": "The fact that the originator of the SO question is happy with the fix only proves that the fix works for their test cases. It does not say anything about other use cases. \n\nAs the SO question itself says, the URL needs to be encoded in the HTML source.\nIf this were done, then the error would disappear.\n\nI don't think it is right to silently correct embedded URLs.\n\nApart from the fact that this hides the problem, any 'fix' applied by JMeter might well cause issues in other cases (as has been seen with file URLs).\n\nThus it is vital that the user is made aware that a fix has been applied to a given URL, and that the user can disable the fix if necessary. And as already noted, the fix must not be applied to file URLs.", "id": 184146, "time": "2015-07-23T13:11:06Z", "bug_id": 58137, "creation_time": "2015-07-23T13:11:06Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 58137, "attachment_id": null, "text": "Theses changes breaks the unit tests when the ant distribution task works.\n\nbatchtest:\n     [echo] Starting HTMLParserTestFile_2 using -X\n   [jmeter] Creating summariser <summary>\n   [jmeter] Created the tree successfully using testfiles/HTMLParserTestFile_2.jmx\n   [jmeter] Starting the test @ Sat Aug 01 18:06:04 WEST 2015 (1438448764996)\n   [jmeter] Waiting for possible Shutdown/StopTestNow/Heapdump message on port 4445\n   [jmeter] summary =      1 in   0.4s =    2.6/s Avg:   248 Min:   248 Max:   248 Err:     0 (0.00%)\n   [jmeter] Tidying up ...    @ Sat Aug 01 18:06:06 WEST 2015 (1438448766076)\n   [jmeter] ... end of run\n   [concat] 2015/08/01 18:06:06 ERROR - jmeter.protocol.http.sampler.HTTPSamplerBase: Error escaping URL:'file:testfiles/HTMLParserTestFile_2_files/style.css', message:Relative path in absolute URI: file://testfiles/HTMLParserTestFile_2_files/style.css \n   [concat] 2015/08/01 18:06:06 ERROR - jmeter.protocol.http.sampler.HTTPSamplerBase: Error escaping URL:'file:testfiles/HTMLParserTestFile_2_files/halfbanner.htm', message:Relative path in absolute URI: file://testfiles/HTMLParserTestFile_2_files/halfbanner.htm \n   [concat] 2015/08/01 18:06:06 ERROR - jmeter.protocol.http.sampler.HTTPSamplerBase: Error escaping URL:'file:testfiles/HTMLParserTestFile_2_files/halfbanner_data/2011-na-234x60.png', message:Relative path in absolute URI: file://testfiles/HTMLParserTestFile_2_files/halfbanner_data/2011-na-234x60.png \n   [concat] 2015/08/01 18:06:06 ERROR - jmeter.protocol.http.sampler.HTTPSamplerBase: Error escaping URL:'file:testfiles/HTMLParserTestFile_2_files/jakarta-logo.gif', message:Relative path in absolute URI: file://testfiles/HTMLParserTestFile_2_files/jakarta-logo.gif \n   [concat] 2015/08/01 18:06:06 ERROR - jmeter.protocol.http.sampler.HTTPSamplerBase: Error escaping URL:'file:testfiles/HTMLParserTestFile_2_files/logo.jpg', message:Relative path in absolute URI: file://testfiles/HTMLParserTestFile_2_files/logo.jpg \n   [concat] 2015/08/01 18:06:06 ERROR - jmeter.protocol.http.sampler.HTTPSamplerBase: Error escaping URL:'file:testfiles/HTMLParserTestFile_2_files/http-config-example.png', message:Relative path in absolute URI: file://testfiles/HTMLParserTestFile_2_files/http-config-example.png \n   [concat] 2015/08/01 18:06:06 ERROR - jmeter.protocol.http.sampler.HTTPSamplerBase: Error escaping URL:'file:testfiles/HTMLParserTestFile_2_files/scoping1.png', message:Relative path in absolute URI: file://testfiles/HTMLParserTestFile_2_files/scoping1.png \n   [concat] 2015/08/01 18:06:06 ERROR - jmeter.protocol.http.sampler.HTTPSamplerBase: Error escaping URL:'file:testfiles/HTMLParserTestFile_2_files/scoping2.png', message:Relative path in absolute URI: file://testfiles/HTMLParserTestFile_2_files/scoping2.png \n   [concat] 2015/08/01 18:06:06 ERROR - jmeter.protocol.http.sampler.HTTPSamplerBase: Error escaping URL:'file:testfiles/HTMLParserTestFile_2_files/scoping3.png', message:Relative path in absolute URI: file://testfiles/HTMLParserTestFile_2_files/scoping3.png \n     [echo] HTMLParserTestFile_2 output files compared OK\n\n\n\n(In reply to Philippe Mouawad from comment #1)\n> Author: pmouawad\n> Date: Tue Jul 14 21:31:34 2015\n> New Revision: 1691090\n> \n> URL: http://svn.apache.org/r1691090\n> Log:\n> Bug 58137 - JMeter fails to download embedded URLS that contain illegal\n> characters in URL (it does not escape them)\n> Bugzilla Id: 58137\n> \n> Modified:\n>    \n> jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/\n> HTTPSamplerBase.java\n> \n> Author: pmouawad\n> Date: Tue Jul 14 21:32:41 2015\n> New Revision: 1691091\n> \n> URL: http://svn.apache.org/r1691091\n> Log:\n> Bug 58137 - JMeter fails to download embedded URLS that contain illegal\n> characters in URL (it does not escape them)\n> Bugzilla Id: 58137\n> \n> Modified:\n>     jmeter/trunk/xdocs/changes.xml", "id": 184269, "time": "2015-08-01T17:07:20Z", "creator": "milamber@apache.org", "creation_time": "2015-08-01T17:07:20Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 58137, "attachment_id": null, "id": 184277, "time": "2015-08-02T13:55:04Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2015-08-02T13:55:04Z", "is_private": false, "text": "With the following changes file urls will not be escaped and all urls that were escaped will be logged as a warning.\n\nDate: Sun Aug  2 13:52:42 2015\nNew Revision: 1693814\n\nURL: http://svn.apache.org/r1693814\nLog:\nBug 58137: Don't escape file protocol urls\nBugzilla Id: 58137\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerBase.java\n\nDate: Sun Aug  2 13:53:18 2015\nNew Revision: 1693815\n\nURL: http://svn.apache.org/r1693815\nLog:\nBug 58137: Warn about urls that had to be escaped.\nBugzilla Id: 58137\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerBase.java"}]
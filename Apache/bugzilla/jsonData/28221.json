[{"count": 0, "tags": [], "bug_id": 28221, "is_private": false, "text": "Hello,\n\nFirst, I'm not sure if this should be assigned to Coyote or Jasper (or possibly \nsomewhere else).\n\nI am running TC v5.0.19 on Win 2k, J2SE v1.4.2_04. I am running TC as \"stand-\nalone\", i.e., as a stand-alone server, using the Coyote HTTP connector, not \nusing Apache.\n\nHere is the issue: The \"JSP servlet\" (I'm referring to the servlet responsible \nfor translating JSPs to Java source code) has a \"scratchdir\" parameter it uses \nto decide where to write the translated Java source code and compiled class \nfiles for a JSP.\n\nIf this \"scratchdir\" value is set (let's say, \"c:\\temp\", for example) then \n*EVERY* JSP, regardless of the virtual host, will be translated to the same \ndirectory (C:\\temp). This is a big problem if two virtual hosts have an \nidentically named JSP (index.jsp, for example) because whichever version of the \nJSP is translated first will be the version served across *ALL* virtual hosts \nwhenever a JSP with that name is requested.\n\nIf \"scratchdir\" is *NOT SET*, on the other hand, then separate directory \nhierarchies are created, one for each virtual host, and there is no problem of \none host grabbing the other's JSPs.\n\nHere is an example...\n\nIn Windows, I have these two lines in my C:\\WINNT\\system32\\drivers\\etc\\hosts \nfile:\n\n   127.0.0.1       xxx.test1.com\n   127.0.0.1       xxx.test2.com\n\nNow, in server.xml I have this:\n\n<Engine name=\"Standalone\" defaultHost=\"xxx.test1.com\" debug=\"0\">\n   <Host name=\"xxx.test2.com\" debug=\"0\"\n         appBase=\"C:\\TestWebSites\\test2\"\n         unpackWARs=\"true\" deployOnStartup='true'\n         autoDeploy=\"false\">\n      <Context path=\"\" docBase=\".\" debug=\"0\" reloadable=\"false\"/>\n   </Host>\n\n   <Host name=\"xxx.test1.com\" debug=\"0\"\n         appBase=\"C:\\TestWebSites\\test1\"\n         unpackWARs=\"true\" deployOnStartup='true'\n         autoDeploy=\"false\">\n      <Context path=\"\" docBase=\".\" debug=\"0\" reloadable=\"false\"/>\n   </Host>\n</Engine>\n\n\nNow, assume both test1 and test2 define an index.jsp in their root contexts \n*AND* the \"scratchdir\" has been set to some directory. If you browse to \nhttp://xxx.test1.com, then test1's version of index.jsp will be compiled and \nplaced in the scratchdir directory. That's fine. If you now browse to \nhttp://xxx.test2.com you will be served with test1's version of index.jsp.\n\nNow, modify test2's version of \"index.jsp\" and go again to \nhttp://xxx.test2.com. You see your modified JSP. Great. Now go to \nhttp://xxx.test1.com. And you still see test2's version of \"index.jsp\"!\n\nI believe the proper behavior should be for a directory to be created which \nreflects the host from which the JSP originates. This is the behavior we see if \nthe \"scratchdir\" attribute is not used.\n\nThe \"scratchdir\" attribute should be used as a base or root directory, below \nwhich a subdirectory hierarchy is created to reflect the host of the JSP being \ncompiled.\n\nA final important point, if I may...I believe (99% sure) the problem described \nhere also occurs for a single <Host> that contains multiple <Context>s where \ntwo or more <Context>s have identically named JSPs. If both <Context>s, for \nexample, have a JSP, \"fred.jsp\", then the \"scratchdir\" will contain whichever \none gets compiled first. It's the same problem except across <Context>s rather \nthan across <Host>s.\n\nI hope all this is clear. Feel free to contact me if you need any additional \ninformation.\n\nThanks...", "id": 55359, "time": "2004-04-06T01:35:28Z", "creator": "tony@absolutejava.com", "creation_time": "2004-04-06T01:35:28Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 28221, "is_private": false, "text": "Yes, you indeed cannot set this globally.", "id": 55369, "time": "2004-04-06T08:51:53Z", "creator": "remm@apache.org", "creation_time": "2004-04-06T08:51:53Z", "attachment_id": null}]
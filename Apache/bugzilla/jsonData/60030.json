[{"count": 0, "tags": [], "creator": "csyperski@gmail.com", "attachment_id": null, "is_private": false, "id": 193270, "time": "2016-08-22T17:12:22Z", "bug_id": 60030, "creation_time": "2016-08-22T17:12:22Z", "text": "Tomcat: 8.5.3\nOS: Ubuntu 16.04 (64-bit)\njava version \"1.8.0_101\"\nJava(TM) SE Runtime Environment (build 1.8.0_101-b13)\nJava HotSpot(TM) 64-Bit Server VM (build 25.101-b13, mixed mode)\n\n\nJSSE implementation that uses OpenSSL seems to have an issue where a request from Internet Explorer 8.x can cause a large portion of the CPU to be consumed until tomcat restart.  \n\nSteps to replicate:\n\n1.  On Ubuntu 16.04, download and extract 8.5.3.  \n2.  Modify the conf/server.xml and add the following connector for SSL configuration:\n\n<Connector port=\"8443\" protocol=\"org.apache.coyote.http11.Http11NioProtocol\" scheme=\"https\" secure=\"true\" maxThreads=\"750\" SSLEnabled=\"true\">\n<SSLHostConfig>\n<Certificate certificateKeyFile=\"xxx.pem\"\ncertificateFile=\"xxx.pem\"\ncertificateChainFile=\"xxx.pem\"\ntype=\"RSA\" />\n</SSLHostConfig>\n</Connector>\n\n3. Start tomcat and navigate using IE8 or IE8 on http://netrenderer.com/index.php to:\nhttps://x.x.x.x:8443/manager/html\n \n\nResult:\nThe CPU hangs at around 70%-100% on a single core until tomcat is started.  \n\nExpected:\nThe page should be rendered without a high CPU load.  \n\nThis is worrying due to the ease of exploitation and large, persistent consumption of resources.  We have tested and replicated using Let's Encrypt and a GoDaddy wildcard ssl cert on multiple machines.  I would suspect this is due to a combination of older ciphers used on IE8."}, {"count": 1, "tags": [], "bug_id": 60030, "attachment_id": null, "id": 193285, "time": "2016-08-23T16:32:52Z", "creator": "remm@apache.org", "creation_time": "2016-08-23T16:32:52Z", "is_private": false, "text": "I had missed the thread dump: http://pastebin.com/n9Rkybwv\n\nThis is not using OpenSSL actually, just plain JSSE with OpenSSL PEMs (thread names are \"https-jsse-nio-8443-*\", if it was using OpenSSL it would be \"https-openssl-nio-8443-*\").\nLike Christopher, I don't see any problem thread that would be using CPU in the dump. Everything seems to be doing nothing and there are a few threads polling as they should.\n\nSo when you're using a keystore for your certificate, you're not running into this issue ?"}, {"count": 2, "text": "I was able to reproduce this on multiple machines (all Ubuntu; all oracle Java 8) using 8.5.3 and I tried two certs and it always caused the high CPU consumption.  Yes, I had the same issue after converting to a keystore as well.  I tried the same exact setup on 8.0.36 and everything worked as expected.  For the time being, I've rolled back to 8.0.36, but would be more than happy to provide any additional information, as it is simple to replicate.", "bug_id": 60030, "attachment_id": null, "id": 193286, "time": "2016-08-23T16:51:17Z", "creator": "csyperski@gmail.com", "creation_time": "2016-08-23T16:51:17Z", "tags": [], "is_private": false}, {"count": 3, "text": "This has been fixed in the following branches:\n- 9.0.x for 9.0.0.M10 onwards\n- 8.5.x for 8.5.5 onwards\n\n8.0.x and earlier are not affected as they do not support SNI.", "bug_id": 60030, "attachment_id": null, "id": 193296, "time": "2016-08-24T10:27:14Z", "creator": "markt@apache.org", "creation_time": "2016-08-24T10:27:14Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 60030, "attachment_id": null, "text": "*** Bug 61089 has been marked as a duplicate of this bug. ***", "id": 198775, "time": "2017-05-13T13:37:02Z", "creator": "remm@apache.org", "creation_time": "2017-05-13T13:37:02Z", "is_private": false}]
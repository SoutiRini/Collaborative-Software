[{"count": 0, "tags": [], "bug_id": 57669, "text": "We received an excel file from an external source and trying to read the file through POI, we are getting the exception below:\n\njava.lang.RuntimeException: Unexpected record type (org.apache.poi.hssf.record.FeatHdrRecord)\n\tat org.apache.poi.hssf.record.aggregates.RowRecordsAggregate.<init>(RowRecordsAggregate.java:97) ~[poi-3.10.1.jar:3.10.1]\n\tat org.apache.poi.hssf.model.InternalSheet.<init>(InternalSheet.java:166) ~[poi-3.10.1.jar:3.10.1]\n\tat org.apache.poi.hssf.model.InternalSheet.createSheet(InternalSheet.java:121) ~[poi-3.10.1.jar:3.10.1]\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:311) ~[poi-3.10.1.jar:3.10.1]\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:264) ~[poi-3.10.1.jar:3.10.1]\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:199) ~[poi-3.10.1.jar:3.10.1]\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:181) ~[poi-3.10.1.jar:3.10.1]\n\nIf the file is opened and saved thereafter, the exception no longer occurs and the file is processed successfully.", "id": 181545, "time": "2015-03-06T08:24:30Z", "creator": "diptesh2007@gmail.com", "creation_time": "2015-03-06T08:24:30Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "text": "Does the problem still occur with POI 3.12 beta 1?", "id": 181546, "time": "2015-03-06T08:39:07Z", "bug_id": 57669, "creation_time": "2015-03-06T08:39:07Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "diptesh2007@gmail.com", "is_private": false, "id": 181547, "time": "2015-03-06T08:55:51Z", "bug_id": 57669, "creation_time": "2015-03-06T08:55:51Z", "tags": [], "text": "Has the bug been fixed in POI 3.12 beta 1? Do you want us to test the same in 3.12 beta 1?"}, {"count": 3, "tags": [], "bug_id": 57669, "is_private": false, "text": "I have tried with the POI 3.12 beta 1 but getting the same error.\nBelow is the error stack trace:\n\njava.lang.RuntimeException: Unexpected record type (org.apache.poi.hssf.record.FeatHdrRecord)\n\tat org.apache.poi.hssf.record.aggregates.RowRecordsAggregate.<init>(RowRecordsAggregate.java:97) ~[poi-3.12-beta1-20150228.jar:3.12-beta1]\n\tat org.apache.poi.hssf.model.InternalSheet.<init>(InternalSheet.java:217) ~[poi-3.12-beta1-20150228.jar:3.12-beta1]\n\tat org.apache.poi.hssf.model.InternalSheet.createSheet(InternalSheet.java:156) ~[poi-3.12-beta1-20150228.jar:3.12-beta1]\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:336) ~[poi-3.12-beta1-20150228.jar:3.12-beta1]\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:288) ~[poi-3.12-beta1-20150228.jar:3.12-beta1]\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:223) ~[poi-3.12-beta1-20150228.jar:3.12-beta1]\n\tat org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:206) ~[poi-3.12-beta1-20150228.jar:3.12-beta1]", "id": 181551, "time": "2015-03-06T09:53:02Z", "creator": "diptesh2007@gmail.com", "creation_time": "2015-03-06T09:53:02Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Created attachment 32547\nProblem file\n\nPlease look into the line number 7491 and 7492", "attachment_id": 32547, "id": 181553, "creator": "diptesh2007@gmail.com", "time": "2015-03-06T10:03:59Z", "bug_id": 57669, "creation_time": "2015-03-06T10:03:59Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 57669, "attachment_id": null, "is_private": false, "id": 181596, "time": "2015-03-09T04:29:32Z", "creator": "diptesh2007@gmail.com", "creation_time": "2015-03-09T04:29:32Z", "text": "The following problem can be fixed in two ways:\n\n1) Modifying the contstructor in RowRecordsAggregate.java:\n\n//include\ncase FeatHdrRecord.sid:\n     continue;\n\n\n2) Modifying the isEndOfRowBlock() API of RecordOrderer.java:\n\n//include\ncase FeatHdrRecord.sid:"}, {"count": 6, "tags": [], "bug_id": 57669, "attachment_id": null, "is_private": false, "id": 181741, "time": "2015-03-13T19:04:51Z", "creator": "apache@gagravarr.org", "creation_time": "2015-03-13T19:04:51Z", "text": "Any chance you could upload a file that shows the problem? We can then use that in a unit test for the fix"}, {"count": 7, "tags": [], "text": "Unfortunately the excel file we received contains confidential information which is the reason why we cannot upload the problem file.", "is_private": false, "bug_id": 57669, "id": 181798, "time": "2015-03-16T07:35:34Z", "creator": "diptesh2007@gmail.com", "creation_time": "2015-03-16T07:35:34Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 57669, "attachment_id": null, "is_private": false, "id": 181799, "time": "2015-03-16T10:43:24Z", "creator": "apache@gagravarr.org", "creation_time": "2015-03-16T10:43:24Z", "text": "I'm very reluctant to try to fix this without a test file. With no test file, it's hard for us to ensure that the fix has worked properly, the correct data is coming back, and there are no side-effects on that file. With no test file, it's impossible for us to ensure that the fix remains into the future as the codebase evolves, and no warning that we might have broken anything\n\nIf you, or someone else, could find a file that shows the problem, then we can use that. Otherwise, perhaps you could talk to whoever generated/gave you the file, and ask them to make another one without the information in? Or perhaps take a hex editor to your file you have, and replace the sensitive text in it?"}, {"count": 9, "tags": [], "creator": "dominik.stadler@gmx.at", "text": "There are a number of similar bugs, all of them happen with files that are not produced by Excel itself and thus are likely slightly broken. Unfortunately a simple stable fix is not always possible, especially here when we do not even have a sample file to work against.", "id": 182795, "time": "2015-05-01T20:49:11Z", "bug_id": 57669, "creation_time": "2015-05-01T20:49:11Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 57669, "attachment_id": null, "is_private": false, "id": 191309, "time": "2016-05-30T06:34:59Z", "creator": "deepeshdrk@gmail.com", "creation_time": "2016-05-30T06:34:59Z", "text": "Hi All,\n\nI am also currently facing the same issue. The code changes that we are planning to do based on the suggestion provided by Diptesh are,\n\ncase HyperlinkRecord.sid:\n     continue;\n\nThe file that we are trying to load which is given the above mentioned is available at .\n\nhttps://www.jse.co.za/_layouts/15/DownloadHandler.ashx?FileName=/Safex/mtmdata/All%20Contract%20Details.xls\n\nPlease let us know will this fix work and what will be the impact of this change.\n\nThanks in Advance.\n\nRegards,\nDeepesh Ramrakhyani."}]
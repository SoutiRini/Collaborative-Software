[{"count": 0, "tags": [], "creator": "bruno@wolff.to", "attachment_id": null, "text": "I am using an external rewritemap program (in perl with STDOUT\ngetting flush by each print statement) with a prefork mpm and I\nam seeing the returned values be returning to the wrong requests.\nOften the first one or two lookups return no value (from rewritelog)\nand after that the returned values often seem to be offset by this\namount with respect to request. Logs from the program indicate that\nit is returning the correct value based on the input it is receiving.\nI have seen this occur in several 2.0.37 snapshots, the latest being\nhttpd-2.0_20020530221254.tar.gz .\nThe following rewrite directives are being used:\nRewritelock /home/httpd/html/robot/lock\nRewritemap blocked prg:/home/httpd/html/robot/check.pl\nA current copy of the program can be found at:\nhttp://wolff.to/robot/check.pl\nI have played with the lockfile (ownership, access rights and\nexistence) and haven't seen any differences in behavior.", "id": 16977, "time": "2002-05-31T03:40:34Z", "bug_id": 9534, "creation_time": "2002-05-31T03:40:34Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 2167\nWorking Fix against 2.0.39, but still needs some work (uses Non-Apache-Constant EAGAIN)", "attachment_id": 2167, "bug_id": 9534, "id": 18471, "time": "2002-06-24T15:07:51Z", "creator": "haegar@sdinet.de", "creation_time": "2002-06-24T15:07:51Z", "is_private": false}, {"count": 2, "tags": [], "text": "I tried this using the current CVS after receiving the update message\nand I am still seeing the problem. I am including an extract from\nmy rewrite log. I changed the script to return the IP address it was\nasked to lookup which should match that of the request. The log makes\nit clear that it doesn't. I also included part of my httpd.conf\nfile relating to the external map. I am running a 2.2 linux kernel.\nIf you need other information, I should be able to probably help. I really would\nlike to see this issue fixed. Thanjs for working on this issue.\nRewriteLock /home/httpd/html/robot/lock\nRewritemap blocked prg:/home/httpd/html/robot/check.pl\n127.0.0.1 - - [24/Jun/2002:12:02:03 --0500] [localhost/sid#81a6cc0][rid#8241120/initial] (5) map lookup OK: map=blocked key=127.0.0.1 -> val=\n127.0.0.1 - - [24/Jun/2002:12:02:05 --0500] [localhost/sid#81a6cc0][rid#8241120/initial] (5) map lookup OK: map=blocked key=127.0.0.1 -> val=OK-127.0.0.1\n64.24.12.167 - - [24/Jun/2002:12:02:11 --0500] [wolff.to/sid#81a6cc0][rid#8247138/initial] (5) map lookup OK: map=blocked key=64.24.12.167 -> val=OK-127.0.0.1\n64.24.12.167 - - [24/Jun/2002:12:02:13 --0500] [wolff.to/sid#81a6cc0][rid#8241120/initial] (5) map lookup OK: map=blocked key=64.24.12.167 -> val=OK-64.24.12.167\n64.24.12.167 - - [24/Jun/2002:12:02:14 --0500] [wolff.to/sid#81a6cc0][rid#8241120/initial] (5) map lookup OK: map=blocked key=64.24.12.167 -> val=OK-64.24.12.167\n127.0.0.1 - - [24/Jun/2002:12:02:18 --0500] [localhost/sid#81a6cc0][rid#8241120/initial] (5) map lookup OK: map=blocked key=127.0.0.1 -> val=OK-64.24.12.167", "attachment_id": null, "bug_id": 9534, "id": 18480, "time": "2002-06-24T17:11:24Z", "creator": "bruno@wolff.to", "creation_time": "2002-06-24T17:11:24Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 9534, "is_private": false, "id": 18482, "attachment_id": null, "creator": "jwoolley@apache.org", "creation_time": "2002-06-24T17:13:45Z", "time": "2002-06-24T17:13:45Z", "text": "This issue is not yet fixed in CVS.  The patch attached to this PR has not yet \nbeen committed.  I've reviewed it, though, and it seems quite on-target.  I'll \ncommit a variant of it (fixing it to use APR_EAGAIN) sometime tonight. \n \n--Cliff "}, {"count": 4, "tags": [], "bug_id": 9534, "is_private": false, "id": 18655, "attachment_id": null, "creator": "bruno@wolff.to", "creation_time": "2002-06-27T14:18:39Z", "time": "2002-06-27T14:18:39Z", "text": "Sorry this took a while. I managed to miss that you had included\nthe patch in the bugzilla entry so that I could use it before it\nwas committed to CVS. I just tried out the patch applied to the\ncurrent CVS (about two hours old) and it seemed to fix my problem.\nThanks."}, {"count": 5, "tags": [], "creator": "haegar@sdinet.de", "text": "Just adding:\nit is not fixed in apache 2.0.40, the same ugly patch from 2.0.39 is still needed.\n", "id": 21395, "attachment_id": null, "bug_id": 9534, "creation_time": "2002-08-20T15:44:52Z", "time": "2002-08-20T15:44:52Z", "is_private": false}, {"count": 6, "text": "Okay, upon further investigation, I believe the correct fix is actually this: \n \nline 3463: \n \n-        ((rc = apr_procattr_io_set(procattr, APR_FULL_BLOCK, \n-                                  APR_FULL_NONBLOCK, \n-                                  APR_FULL_NONBLOCK)) != APR_SUCCESS) || \n+        ((rc = apr_procattr_io_set(procattr, APR_FULL_BLOCK, APR_FULL_BLOCK, \n+                                   APR_NO_PIPE)) != APR_SUCCESS) || \n \n \nIt's because reads are set to nonblocking mode that we're getting hosed here.  \nYou shouldn't have to check for APR_EAGAIN from apr_file_read()... it's only \ngetting returned because we told it to (by setting nonblocking mode).  Oops! \n \nPlease let me know if this fixes it and I'll commit the change. \n \n--Cliff ", "bug_id": 9534, "is_private": false, "id": 21401, "time": "2002-08-20T17:34:50Z", "creator": "jwoolley@apache.org", "creation_time": "2002-08-20T17:34:50Z", "tags": [], "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 9534, "is_private": false, "text": "I tested the suggestion to change the read to blocking and it seemed\nto work correctly. (I had also removed the previous fix for this test.)", "id": 21492, "time": "2002-08-21T17:09:45Z", "creator": "bruno@wolff.to", "creation_time": "2002-08-21T17:09:45Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "jwoolley@apache.org", "text": "Fixed for 2.0.41. \n \nThanks for your feedback! ", "id": 21494, "time": "2002-08-21T17:49:15Z", "bug_id": 9534, "creation_time": "2002-08-21T17:49:15Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 9534, "text": "*** Bug 12175 has been marked as a duplicate of this bug. ***", "id": 21995, "time": "2002-08-29T20:41:54Z", "creator": "slive@apache.org", "creation_time": "2002-08-29T20:41:54Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 92, "text": "The following example is a servlet which opens a session, and then :\r\n1- does nothing\r\n2- include a JSP\r\n3- forward to a JSP\r\n\r\ncases 1 and 3 work fine : a JSESSIONID cookie is set, and the session context is retrieved\r\nproperly on the next requests.\r\nCase 2 fails : the JSESSIONID cookie is not set. And a new session context is created at each request.\r\n\r\nBUG ANALYSIS : \r\n--------------\r\n\r\nWith a debugger, one can see that the SessionInterceptor::beforeBody() method is not called in the\r\ncase 2 (include), but it is called in the other cases. (it is the method which create the JSESSIONID cookie).\r\n\r\nIt seems that the bug comes in the following method : HttpResponseAdapter.notifyEndHeaders(). \r\nThe last test is false in the case of the JSP include. So the\r\ndoBeforeBody is not called. This is not good since the servlet should be capable to work on HTTP headers, open session,...\r\nbefore it includes a JSP.\r\n\r\n\r\n/** Signal that we're done with the headers, and body will follow.\r\n *  Any implementation needs to notify ContextManager, to allow\r\n *  interceptors to fix headers.\r\n */\r\n   public void notifyEndHeaders() throws IOException {\r\n\t   //\tSystem.out.println(\"End headers \" + request.getProtocol());\r\n\t   if (request.getProtocol() == null)\r\n\t   \t// HTTP/0.9 \r\n\t   \treturn;\r\n\r\n\t   // let CM notify interceptors and give a chance to fix\r\n\t   // the headers\r\nBUG >>>\t   if (request.getContext() != null && notIncluded)\r\n\t \trequest.getContext().getContextManager().doBeforeBody(request, this);\r\n\r\n\t   // No action.. \r\n   } \r\n\r\n\r\n\r\n", "id": 72, "time": "2000-09-05T05:59:57Z", "creator": "dev@tomcat.apache.org", "creation_time": "2000-09-05T05:59:57Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 92, "attachment_id": null, "is_private": false, "id": 845, "time": "2001-02-23T17:46:26Z", "creator": "Larry.Isaacs@sas.com", "creation_time": "2001-02-23T17:46:26Z", "text": "This bug is in Tomcat 3.1 and early 3.2 betas.  It is fixed in Tomcat 3.2,\n3.2.1, and 3.2.2.  However, the fix makes RequestDispatcher.include() non-spec\ncompliant because it will always force the response to be committed.\nIt is not yet fixed in Tomcat 3.3."}, {"count": 2, "tags": [], "bug_id": 92, "text": "The notifyEndHeaders() method has be updated in Tomcat 3.3 to fix this bug.\nFixed in Tomcat 3.3", "id": 853, "time": "2001-02-25T20:40:08Z", "creator": "Larry.Isaacs@sas.com", "creation_time": "2001-02-25T20:40:08Z", "is_private": false, "attachment_id": null}]
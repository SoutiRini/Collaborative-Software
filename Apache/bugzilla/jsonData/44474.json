[{"count": 0, "tags": [], "bug_id": 44474, "attachment_id": null, "id": 109949, "time": "2008-02-22T16:41:19Z", "creator": "basant.kukreja@sun.com", "creation_time": "2008-02-22T16:41:19Z", "is_private": false, "text": "Similar to the worker bug,\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=42580\n\nevent mpm also crashes under stress under static workload.\n\nHere is the relevant configuration :\n\n<IfModule event.c>\nListenBackLog     50000\nStartServers         2\nThreadLimit        500\nThreadsPerChild    500\nMinSpareThreads    100\nMaxSpareThreads    1000\nThreadsPerChild    500\nMaxClients         1000\nMaxRequestsPerChild  0\n</IfModule>\n\nListen 192.168.21.1:8000\nListen 192.168.22.1:8000\n\n\nHere is snippet of error log :\n[~/apache/build2/apache2] $ tail -f logs/error_log\n[Fri Feb 22 15:51:50 2008] [info] Server built: Feb 22 2008 14:32:14\n[Fri Feb 22 15:56:13 2008] [notice] child pid 23769 exit signal Segmentation\nfault (11), possible coredump in /export/home/basantk/apache/build2/apache2\n[Fri Feb 22 16:05:58 2008] [notice] child pid 23768 exit signal Segmentation\nfault (11), possible coredump in /export/home/basantk/apache/build2/apache2\n[Fri Feb 22 16:10:15 2008] [notice] child pid 23786 exit signal Segmentation\nfault (11), possible coredump in /export/home/basantk/apache/build2/apache2\n\nSome of the stack traces of crashes are :\n\nCrash 1 :\n----------\nt@503 (l@503) terminated by signal SEGV (Segmentation Fault)\nCurrent function is listener_thread\n 1035               APR_RING_REMOVE(cs, timeout_list);\n(dbx) where\ncurrent thread: t@503\n=>[1] listener_thread(thd = 0x8708c8, dummy = 0x8e5fc0), line 1035 in \"event.c\"\n  [2] dummy_worker(opaque = 0x8708c8), line 142 in \"thread.c\"\n  [3] _thr_setup(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfffffd7ffef5d8f7\n  [4] _lwp_start(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfffffd7ffef5dba0\n\n\nCrash 2 :\n----------\nt@305 (l@305) terminated by signal SEGV (Segmentation Fault)\nCurrent function is ap_update_child_status_from_indexes\n  433       ws = &ap_scoreboard_image->servers[child_num][thread_num];\n(dbx) where\ncurrent thread: t@305\n=>[1] ap_update_child_status_from_indexes(child_num = 80198392, thread_num = 0,\nstatus = 8, r = (nil)), line 433 in \"scoreboard.c\"\n  [2] ap_update_child_status(sbh = 0x2cd6318, status = 8, r = (nil)), line 475\nin \"scoreboard.c\"\n  [3] ap_lingering_close(c = 0x2c78688), line 109 in \"connection.c\"\n  [4] process_socket(p = 0x2c785e8, sock = 0x2cd6028, cs = 0x2cd6320,\nmy_child_num = 0, my_thread_num = 302), line 650 in \"event.c\"\n  [5] worker_thread(thd = 0x71a858, dummy = 0x6df670), line 1151 in \"event.c\"\n  [6] dummy_worker(opaque = 0x71a858), line 142 in \"thread.c\"\n  [7] _thr_setup(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfffffd7ffef5d8f7\n  [8] _lwp_start(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfffffd7ffef5dba0\n\n\nCrash 3 :\n----------\nt@1 (l@1) terminated by signal SEGV (Segmentation Fault)\n0xfffffd7ffef6543a: _read+0x000a:       jae      _read+0x16     [\n0xfffffd7ffef65446, .+0xc ]\nCurrent function is ap_mpm_pod_check\n   54       rc = read(fd, &c, 1);\n(dbx) where\ncurrent thread: t@1\n  [1] _read(0x6, 0xfffffd7fffdff22b, 0x1, 0x0, 0x1, 0xfffffd7fffdff224), at\n0xfffffd7ffef6543a\n  [2] read(0x0, 0x0, 0x0, 0x0, 0x0, 0x0), at 0xfffffd7ffef4f6ad\n=>[3] ap_mpm_pod_check(pod = 0x54f008), line 54 in \"pod.c\"\n  [4] child_main(child_num_arg = 0), line 1510 in \"event.c\"\n  [5] make_child(s = 0x4bb6c8, slot = 0), line 1594 in \"event.c\"\n  [6] perform_idle_server_maintenance(), line 1781 in \"event.c\"\n  [7] server_main_loop(remaining_children_to_start = 0), line 1882 in \"event.c\"\n  [8] ap_mpm_run(_pconf = 0x4b5fc8, plog = 0x4e8158, s = 0x4bb6c8), line 1949 in\n\"event.c\"\n  [9] main(argc = 3, argv = 0xfffffd7fffdff5a8), line 730 in \"main.c\"\n\nfdqueue.c bug in worker also exist in event mpm too. I am verifying if similar\npatch can fix event mpm crashes too."}, {"count": 1, "tags": [], "creator": "basant.kukreja@sun.com", "attachment_id": null, "text": "Ruediger has already checked in the patch in event mpm too.\n (r630348). Thanks to Ruediger.\n\nComment #21 of \nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=44402\n\nIf I won't see any crashes in 10 hours of stress then I will close the bug.\n", "id": 108934, "time": "2008-02-22T16:54:00Z", "bug_id": 44474, "creation_time": "2008-02-22T16:54:00Z", "is_private": false}, {"count": 2, "tags": [], "creator": "nick@webthing.com", "attachment_id": null, "id": 108931, "creation_time": "2008-02-22T17:35:12Z", "time": "2008-02-22T17:35:12Z", "bug_id": 44474, "text": "\n\n*** This bug has been marked as a duplicate of 44402 ***", "is_private": false}, {"count": 3, "tags": [], "text": "I verified that the crashes in event mpm disappear after I applied the fdqueue.c\npatch in event mpm.", "attachment_id": null, "bug_id": 44474, "id": 108143, "time": "2008-02-23T13:15:05Z", "creator": "basant.kukreja@sun.com", "creation_time": "2008-02-23T13:15:05Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 43653, "attachment_id": null, "text": "Sometimes, the HTTP response sent when NIO connector is used is corrupted.\nThe first line of header contains 16Ko of garbage (0x00) and the next ones are OK.\nHTTPS was used during the testing.\n\nDebugging showed that in a call to NioBlockingSelector.write(,,), the variable\nbuf was correct until it went through this code:\nif (socket.getBufHandler().getWriteBuffer() != buf) {\n            socket.getBufHandler().getWriteBuffer().put(buf);\n            buf = socket.getBufHandler().getWriteBuffer();\n        }\nAfter appending a ByteBuffer to another ByteBuffer, one shoud take some extra\nstep to flip the buffer (prepare for read after write)\n\nSee enclosed patch for a fix validated to correct the issue.", "id": 109468, "time": "2007-10-18T10:43:39Z", "creator": "cpierret@sparus-software.com", "creation_time": "2007-10-18T10:43:39Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 43653, "text": "Created attachment 21006\nPatch for issue 43653\n\nTested under Windows 2000, tomcat 6.0.14", "id": 109469, "time": "2007-10-18T10:44:28Z", "creator": "cpierret@sparus-software.com", "creation_time": "2007-10-18T10:44:28Z", "is_private": false, "attachment_id": 21006}, {"count": 2, "tags": [], "bug_id": 43653, "text": "are you able to provide a test case,\nMy spider man intuition tells me the fix should be somewhere else in the code,\nand not in the blocking selector code, but probably in the SecureNioChannel\n\nFilip", "id": 109474, "time": "2007-10-18T11:25:42Z", "creator": "fhanik@apache.org", "creation_time": "2007-10-18T11:25:42Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 43653, "attachment_id": 21007, "text": "Created attachment 21007\nCorrect patch for buffer handling during SSL\n\nThis is the correct patch, the selector shouldn't do anything to the buffer.\nThe bug that happened is caused by the fact that the data from the SSL network\nbuffer gets stuffed into the application buffer", "id": 109479, "time": "2007-10-18T12:22:54Z", "creator": "fhanik@apache.org", "creation_time": "2007-10-18T12:22:54Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 43653, "attachment_id": 21008, "text": "Created attachment 21008\nCorrect patch this time\n\nMust make sure the correct buffer gets written", "id": 109484, "time": "2007-10-18T12:38:15Z", "creator": "fhanik@apache.org", "creation_time": "2007-10-18T12:38:15Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 43653, "text": "Additional info: occurs while sending HTTP/1.1 100 Continue\nSecond and third patch did not fix the issue (reopen).", "id": 109505, "time": "2007-10-19T11:15:12Z", "creator": "cpierret@sparus-software.com", "creation_time": "2007-10-19T11:15:12Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "Created attachment 21012\n\"Tested to work correctly\" patch update\n\nFinally a working patch that is correct ?", "attachment_id": 21012, "bug_id": 43653, "id": 109506, "time": "2007-10-19T11:45:28Z", "creator": "cpierret@sparus-software.com", "creation_time": "2007-10-19T11:45:28Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 43653, "attachment_id": 21015, "text": "Created attachment 21015\nRemainder of the patch\n\nSince the previous patch was applied, this is the remainder", "id": 109514, "time": "2007-10-20T08:43:36Z", "creator": "fhanik@apache.org", "creation_time": "2007-10-20T08:43:36Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 43653, "attachment_id": null, "text": "This was fixed a little while ago and has been included in 6.0.16 onwards.", "id": 115719, "time": "2008-04-19T10:29:10Z", "creator": "markt@apache.org", "creation_time": "2008-04-19T10:29:10Z", "is_private": false}]
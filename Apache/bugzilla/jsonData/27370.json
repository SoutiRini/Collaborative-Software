[{"count": 0, "tags": [], "text": "modules/experimental/cache_storage.c on the one hand allocates a cache\nstructure without resetting the structure's contents which can lead\nto segmentation faults when subsequent functions fail.\nFurthermore it always assumes that info->filename is set which is not the\ncase when mod_disk_cache is used.\nThis combination leads to segmentation faults. Patch follows.", "attachment_id": null, "bug_id": 27370, "id": 53331, "time": "2004-03-02T14:44:27Z", "creator": "ast@domdv.de", "creation_time": "2004-03-02T14:44:27Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 27370, "text": "Created attachment 10638\nfix segfault caused by mod_proxy", "id": 53332, "time": "2004-03-02T14:45:24Z", "creator": "ast@domdv.de", "creation_time": "2004-03-02T14:45:24Z", "is_private": false, "attachment_id": 10638}, {"count": 2, "tags": [], "text": "mod_disk_cache has not (yet) segfaulted for me, but it has been unable to \nserve already cached pages. In the error_log it logs \"Module bug?  Request \nfilename is missing for URI <requested address>\"\n\nThe error seems to be in the same line, hence I'm posting this in this issue \nas well. \n\nHowever, applying this patch it is not serving anything from cache at all (at \nleast, that's how things look according to the logs).\n\nI believe the correct patch to be something akin to this:\n\n    /* Initialize the cache_handle callback functions */\n    h->read_body = &read_body;\n    h->read_headers = &read_headers;\n    h->write_body = &write_body;\n    h->write_headers = &write_headers;\n    h->remove_entity = &remove_entity;\n\n+   // This should set the filename for the request to the datafile in our \ncache, right?\n+   // Ignoring this value in cache_storage.c prevents the diskcache from \nworking.\n+   // Not setting it gives a 404 because the filename is not set.\n+   // This seems to work well, but we need to add a <Directory> Allow from \nAll </Directory>\n+   // to our proxy configuration. Not adding that directive results in a 403.\n+   info->filename = data;\n\n    ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,\n                 \"disk_cache: Serving Cached URL %s\",  dobj->name);\n", "is_private": false, "bug_id": 27370, "id": 60048, "time": "2004-06-29T12:37:42Z", "creator": "bugs.apache@starbase12.cjb.net", "creation_time": "2004-06-29T12:37:42Z", "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "chip@force-elite.com", "text": "Can this be tested after all of the mod_cache changes that we recently have had in CVS?", "id": 62714, "time": "2004-08-30T05:20:02Z", "bug_id": 27370, "creation_time": "2004-08-30T05:20:02Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 27370, "is_private": false, "count": 4, "id": 66899, "time": "2004-11-15T02:48:37Z", "creator": "jerenkrantz@apache.org", "creation_time": "2004-11-15T02:48:37Z", "text": "This is likely fixed in the latest version of httpd 2.0.52.  \n\nMarking as fixed.\n\nThanks!"}]
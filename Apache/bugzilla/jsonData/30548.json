[{"count": 0, "attachment_id": null, "creator": "shalmaneser@ePost.de", "is_private": false, "id": 61726, "time": "2004-08-09T18:26:57Z", "bug_id": 30548, "creation_time": "2004-08-09T18:26:57Z", "tags": [], "text": "When I'm using Ant 1.6.1 from within Netbeans 3.6 to execute one of the\nemma-tasks, I'm seeing the following stacktrace:\n\n<preceding tasks left out....>\ninstrument:\njava.lang.NullPointerException\n       at org.apache.tools.ant.Project.getThreadTask(Project.java:1985)\n       at org.apache.tools.ant.Project.demuxFlush(Project.java:1155)\n       at\norg.apache.tools.ant.DemuxOutputStream.processFlush(DemuxOutputStream.java:186)\n       at\norg.apache.tools.ant.DemuxOutputStream.flush(DemuxOutputStream.java:211)\n       at java.io.PrintStream.flush(PrintStream.java:136)\n       at\nsun.nio.cs.StreamEncoder$CharsetSE.implFlush(StreamEncoder.java:410)\n       at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:152)\n       at java.io.OutputStreamWriter.flush(OutputStreamWriter.java:213)\n       at java.io.BufferedWriter.flush(BufferedWriter.java:230)\n       at java.io.PrintWriter.flush(PrintWriter.java:120)\n       at com.vladium.logging.Logger.cleanup(Logger.java:436)\n       at com.vladium.logging.Logger.pop(Logger.java:364)\n       at com.vladium.emma.Processor.run(Processor.java:60)\n       at com.vladium.emma.instr.instrTask.execute(instrTask.java:77)\n       at com.vladium.emma.emmaTask.execute(emmaTask.java:57)\n       at\norg.apache.tools.ant.UnknownElement.execute(UnknownElement.java:269)\n       at org.apache.tools.ant.Task.perform(Task.java:364)\n       at org.apache.tools.ant.Target.execute(Target.java:301)\n       at org.apache.tools.ant.Target.performTasks(Target.java:328)\n       at org.apache.tools.ant.Project.executeTarget(Project.java:1215)\n       at org.apache.tools.ant.Project.executeTargets(Project.java:1063)\n       at\norg.apache.tools.ant.module.bridge.impl.BridgeImpl.run(BridgeImpl.java:178)\n       at\norg.apache.tools.ant.module.run.TargetExecutor.run(TargetExecutor.java:252)\n       at\norg.netbeans.core.execution.RunClassThread.run(RunClassThread.java:125)\n\nThis seems to happen only in Netbeans, not when I'm calling ANT (1.6.0,\nor 1.6.2)\nfrom the commandline. (didn't try 1.6.1)\n\nThe relevant section in oata.Project is:\n\n  /**\n    * Get the current task associated with a thread, if any\n    *\n    * @param thread the thread for which the task is required.\n    * @return the task which is currently registered for the given\nthread or\n    *         null if no task is registered.\n    */\n   public Task getThreadTask(Thread thread) {\n       Task task = (Task) threadTasks.get(thread); <--- NPE occurs here.\n       if (task == null) {\n           ThreadGroup group = thread.getThreadGroup();\n           while (task == null && group != null) {\n               task = (Task) threadGroupTasks.get(group);\n               group = group.getParent();\n           }\n       }\n       return task;\n   }\n\nFixing this to read.\n   public Task getThreadTask(Thread thread) {\n       Object task = threadTasks.get(thread);  // <-- removed cast\n       if (task == null) {\n           ThreadGroup group = thread.getThreadGroup();\n           while (task == null && group != null) {\n               task = (Task) threadGroupTasks.get(group);   // ????\n               group = group.getParent();\n           }\n       }\n       return (Task) task;  // <-- inserted cast\n   }\n\nSolved the problem for me. \nNote, that there is another probable goof in the line marked with // ?????\nwhich could also be prevented by removing the cast."}, {"count": 1, "tags": [], "bug_id": 30548, "is_private": false, "id": 61982, "creation_time": "2004-08-14T10:16:08Z", "time": "2004-08-14T10:16:08Z", "creator": "shalmaneser@ePost.de", "text": "Well, at least I thought it would solve the problem. But it is recurring.\nNew lead: argument 'thread' might be null. (threadTask is never, because it's\nalways initialized on construction, then never changed)\n\nSince the problem seems hard to stabilize, I'm trying to look at my side first.", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 30548, "is_private": false, "id": 61994, "creation_time": "2004-08-15T05:51:24Z", "time": "2004-08-15T05:51:24Z", "creator": "shalmaneser@ePost.de", "text": "Did the following:\n- upgraded Ant in Netbeans to 1.6.2.\n- patched the getThreadMethod() again, to read:\n\n2020  public Task getThreadTask(Thread thread) {\n2021\ttry\n2022\t{\n2023            Object task = threadTasks.get(thread);\n2024            if (task == null) {\n2025               ThreadGroup group = thread.getThreadGroup();\n2026               while (task == null && group != null) {\n2027                  task = threadGroupTasks.get(group);\n2028                  group = group.getParent();\n2029               }\n2030            }\n2031\t    return (Task) task;\n2032\t}\n2033\tcatch (NullPointerException npe)\n2034\t{\n2035\t    System.out.println(\"NPE in getThreadTask!!\");\n2036\t    npe.printStackTrace();\n2037\t    System.out.println(\"Parameter thread: \" + thread);\n2038\t    System.out.println(\"Map threadTasks: \" + threadTasks);\n2039\t    System.out.println(\"Map threadGroupTasks: \" + threadGroupTasks);\n2040\t    //System.out.println(\"task: \" + task);\n2041            System.out.println(\"this.getClass().getName()\" +\nthis.getClass().getName());\n2042            System.out.println(\"this\" + this);\n2043\t    return null;\n2044     }\n2045  }\n\nNow got as a response:\n\ncoverage:\nNPE in getThreadTask!!\njava.lang.NullPointerException\n        at org.apache.tools.ant.Project.getThreadTask(Project.java:2023)\n        at org.apache.tools.ant.Project.demuxOutput(Project.java:1085)\n        at\norg.apache.tools.ant.DemuxOutputStream.processBuffer(DemuxOutputStream.java:171)\n        at org.apache.tools.ant.DemuxOutputStream.write(DemuxOutputStream.java:146)\n        at org.apache.tools.ant.DemuxOutputStream.write(DemuxOutputStream.java:240)\n        at java.io.PrintStream.write(PrintStream.java:258)\n        at sun.nio.cs.StreamEncoder$CharsetSE.writeBytes(StreamEncoder.java:336)\n        at\nsun.nio.cs.StreamEncoder$CharsetSE.implFlushBuffer(StreamEncoder.java:404)\n        at sun.nio.cs.StreamEncoder$CharsetSE.implFlush(StreamEncoder.java:408)\n        at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:152)\n        at java.io.OutputStreamWriter.flush(OutputStreamWriter.java:213)\n        at java.io.BufferedWriter.flush(BufferedWriter.java:230)\n        at java.io.PrintWriter.flush(PrintWriter.java:120)\n        at com.vladium.logging.Logger._log(Logger.java:483)\n        at com.vladium.logging.Logger.info(Logger.java:195)\n        at com.vladium.emma.data.MergeProcessor._run(MergeProcessor.java:117)\n        at com.vladium.emma.Processor.run(Processor.java:54)\n        at com.vladium.emma.data.mergeTask.execute(mergeTask.java:48)\n        at com.vladium.emma.emmaTask.execute(emmaTask.java:57)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at org.apache.tools.ant.Task.perform(Task.java:364)\n        at org.apache.tools.ant.Target.execute(Target.java:341)\n        at org.apache.tools.ant.Target.performTasks(Target.java:369)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1062)\n        at\norg.apache.tools.ant.module.bridge.impl.BridgeImpl.run(BridgeImpl.java:178)\n        at\norg.apache.tools.ant.module.run.TargetExecutor.run(TargetExecutor.java:252)\n        at org.netbeans.core.execution.RunClassThread.run(RunClassThread.java:125)\nParameter thread: Thread[exec_jeede (coverage)_2,3,exec_jeede (coverage)_2]\nMap threadTasks: null\nMap threadGroupTasks: null\nthis.getClass().getName()org.apache.tools.ant.Project\nthisorg.apache.tools.ant.Project@1a5b607\nNPE in getThreadTask!!\njava.lang.NullPointerException\n        at org.apache.tools.ant.Project.getThreadTask(Project.java:2023)\n        at org.apache.tools.ant.Project.demuxFlush(Project.java:1154)\n        at\norg.apache.tools.ant.DemuxOutputStream.processFlush(DemuxOutputStream.java:185)\n        at org.apache.tools.ant.DemuxOutputStream.flush(DemuxOutputStream.java:210)\n        at java.io.PrintStream.flush(PrintStream.java:136)\n        at sun.nio.cs.StreamEncoder$CharsetSE.implFlush(StreamEncoder.java:410)\n        at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:152)\n        at java.io.OutputStreamWriter.flush(OutputStreamWriter.java:213)\n        at java.io.BufferedWriter.flush(BufferedWriter.java:230)\n        at java.io.PrintWriter.flush(PrintWriter.java:120)\n        at com.vladium.logging.Logger.cleanup(Logger.java:436)\n        at com.vladium.logging.Logger.pop(Logger.java:364)\n        at com.vladium.emma.Processor.run(Processor.java:60)\n        at com.vladium.emma.data.mergeTask.execute(mergeTask.java:48)\n        at com.vladium.emma.emmaTask.execute(emmaTask.java:57)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)\n        at org.apache.tools.ant.Task.perform(Task.java:364)\n        at org.apache.tools.ant.Target.execute(Target.java:341)\n        at org.apache.tools.ant.Target.performTasks(Target.java:369)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1214)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1062)\n        at\norg.apache.tools.ant.module.bridge.impl.BridgeImpl.run(BridgeImpl.java:178)\n        at\norg.apache.tools.ant.module.run.TargetExecutor.run(TargetExecutor.java:252)\n        at org.netbeans.core.execution.RunClassThread.run(RunClassThread.java:125)\nParameter thread: Thread[exec_jeede (coverage)_2,3,exec_jeede (coverage)_2]\nMap threadTasks: null\nMap threadGroupTasks: null\nthis.getClass().getName()org.apache.tools.ant.Project\nthisorg.apache.tools.ant.Project@1a5b607\nsrc\\build.xml [441] java.lang.NullPointerException\nBUILD FAILED (total time: 5 seconds)\n\nSo to the contrary of my earlier musings: threadTasks is null!!\nCurrently I have no Idea how this should happen, if the only\nsetting of this variable in the whole sourcetree seems to be:\n\n165  /** Records the latest task to be executed on a thread (Thread to Task). */\n166  private Hashtable threadTasks = new Hashtable();\n\nIdeas?", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 30548, "is_private": false, "text": "I agree; it doesn't make sense.  Is this still an issue?", "id": 75446, "time": "2005-05-26T21:16:23Z", "creator": "mbenson@apache.org", "creation_time": "2005-05-26T21:16:23Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "t.schapitz@lycos.de", "is_private": false, "id": 75572, "time": "2005-05-29T12:25:04Z", "bug_id": 30548, "creation_time": "2005-05-29T12:25:04Z", "tags": [], "text": "I later on found out, that this had partly to do with the clean up code in the\nant-bridge of NB 3.6.\nLooks like the ant-bridge is trying to prevent memory leaks by forcing some\nof the ANT-Internal variables to 'null' via reflection API.\n(Possible only, if there is no security manager, or security manager permissions\nare set accordingly).\nSo anyway, this isn't ANTs fault, but could be considered a blatand breach of \nANTs isolation by Netbeans...\nThe problem vanished in NB 4.0."}]
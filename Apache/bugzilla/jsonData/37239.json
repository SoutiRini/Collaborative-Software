[{"count": 0, "tags": [], "text": "Hi,\n\nI am not too sure if this is a bug, a caveat or a lack in my knowledge of these \nmatters.\n\nIf I configure a web application with a filter with a filter mapping of \n\n/*\n\nThen I would expect any request that matches the web application context (a la \nJK->Tomcat AJP URI mappings) to be entered into that filter.\n\nI have a web application that will respond to URLs that do not exist using the \nfilter method. Therefore a reques to \n\nhttp://localhost/utilities\n\nWhilst not a folder within the web application file structure, is still mapped \nto the ROOT web application, and should enter the filter with the /utilities \npart of the URL intact.\n\nInstead, Tomcat sees that /utilities is not a folder, and sends a redirect to \nJK for\n\nhttp://localhost/\n\nThis time, my filter is entered into but with just / as the request URI.\n\nIs it correct that Tomcat should not allow the web application to decide (via a \nfilter mapping or servlet mapping even) whether to handle any inbound request \nwhere the mapping is of the type /*\n\nI note that by adding an empty folder of utilities to the web application \ncauses the\n\nhttp://localhost/utilities\n\nto work.\n\nKind regards.\n\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (700): Attempting to map \nURI '/localhost/utilities' from 18 maps\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (718): Attempting to map context URI '/*'\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (755): Found a context match ajp13 -> /\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \nHttpFilterProc::jk_isapi_plugin.c (770): check if [/utilities] is points to the \nweb-inf directory\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \nHttpFilterProc::jk_isapi_plugin.c (788): [/utilities] is a servlet url - should \nredirect to ajp13\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \nwc_get_worker_for_name::jk_worker.c (92): found a worker ajp13\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \nHttpExtensionProc::jk_isapi_plugin.c (920): got a worker for name ajp13\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \najp_get_endpoint::jk_ajp_common.c (2016): time elapsed since last request = 22 \nseconds\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \najp_marshal_into_msgb::jk_ajp_common.c (551): ajp marshaling done\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] ajp_service::jk_ajp_common.c \n(1594): processing with 3 retries\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \najp_connection_tcp_send_message::jk_ajp_common.c (883): sending to ajp13 pos=4 \nlen=466 max=8192 \n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \najp_send_request::jk_ajp_common.c (1199): request body to send 0 - request body \nto resend 0\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \najp_connection_tcp_get_message::jk_ajp_common.c (1007): received from ajp13 \npos=0 len=60 max=8192 \n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \najp_unmarshal_response::jk_ajp_common.c (606): status = 302\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \najp_unmarshal_response::jk_ajp_common.c (613): Number of headers is = 2\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \najp_unmarshal_response::jk_ajp_common.c (669): Header[0] [Location] = []\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \najp_unmarshal_response::jk_ajp_common.c (669): Header[1] [Content-Length] = [0]\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \najp_connection_tcp_get_message::jk_ajp_common.c (1007): received from ajp13 \npos=0 len=2 max=8192 \n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \nHttpExtensionProc::jk_isapi_plugin.c (933): service() returned OK\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] ajp_done::jk_ajp_common.c \n(1942): recycling connection cache slot=0\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \nHttpFilterProc::jk_isapi_plugin.c (687): Filter started\n[Tue Oct 25 10:39:25 2005] [4044:4424] [debug] \nHttpFilterProc::jk_isapi_plugin.c (753): Virtual Host redirection of /localhost/", "is_private": false, "id": 81689, "creator": "allistair.crossley@qas.com", "time": "2005-10-25T11:50:03Z", "bug_id": 37239, "creation_time": "2005-10-25T11:50:03Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "investigation a little more ... for any URL ending with no slash, a server \nshould send a redirect for the path with a trailing slash.\n\ni still don't understand why tomcat feels it needs to strip away the /utilties \nback just back to /\n\nA workaround I found was to restrict the uriworkersmap in JK to \n\n/utilties/*\n\nrathe than \n\n/*\n\nand then in IIS to create virtual a virtual folder to an empty location called\n\nutilities\n\nThis ensures that IIS rewrites the URL to end in a slash.\n\nPotentially there is a bug with Tomcat in stripping the path down in its \nrewrite?", "attachment_id": null, "id": 81703, "creator": "allistair.crossley@qas.com", "time": "2005-10-25T14:23:30Z", "bug_id": 37239, "creation_time": "2005-10-25T14:23:30Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 37239, "attachment_id": null, "id": 95089, "time": "2006-10-25T18:42:25Z", "creator": "markt@apache.org", "creation_time": "2006-10-25T18:42:25Z", "is_private": false, "text": "You don't say what IIS version or JK version you are using but I can't reproduce\nthe URL shortening with JK 1.2.19 and IIS 5.0 on Win 2k.\n\nPlease test with the latest JK and re-open with steps to reproduce if this is\nstill an issue."}]
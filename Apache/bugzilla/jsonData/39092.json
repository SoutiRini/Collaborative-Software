[{"attachment_id": null, "tags": [], "bug_id": 39092, "text": "JMeter uses 1.3 of htmlparser, not the latest version 1.6\n,which has modified many bugs and has strong NodeFilters.\nAnd, just replacing htmlparser.jar in distributed JMeter with latest htmlparser\ndoesn't work because of the use of incompatible API s in\nHtmlParserHTMLParser.java.\nThis makes the use of htmlparser in BeanShell Samper a little difficult.\nThis is why JMeter should UPDATE the htmlparser.\n\nHowever, as htmlparser is under LGPL while JMeter is under\nApache License, we have to make JMeter working well without\nhtmlpaser for updating the donated htmlparser codes\nto the latest, 1.6 .\nThis is why JMeter should ISOLATE the htmlparser.", "count": 0, "id": 87192, "time": "2006-03-24T01:59:17Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-24T01:59:17Z", "is_private": false}, {"count": 1, "tags": [], "creator": "hideaki.kimura@gmail.com", "attachment_id": 17962, "id": 87193, "time": "2006-03-24T02:00:23Z", "bug_id": 39092, "creation_time": "2006-03-24T02:00:23Z", "is_private": false, "text": "Created attachment 17962\na patch for HtmlParserHTMLParser to UPDATE the htmlparser"}, {"count": 2, "tags": [], "bug_id": 39092, "attachment_id": 17963, "text": "Created attachment 17963\na patch for HTMLParser to ISOLATE the htmlparser", "id": 87194, "time": "2006-03-24T02:00:55Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-24T02:00:55Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 39092, "attachment_id": null, "is_private": false, "id": 87195, "time": "2006-03-24T02:08:37Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-24T02:08:37Z", "text": "These patches enable JMeter to work with htmlparser 1.6 and work well\neven if they can't detect htmlparser.jar.\n\nAs for development environment,\nsrc/htmlparser should be deleted and related entries in build.xml or\neclipse.classpath should be removed.\nInstead,\n  filterbuilder.jar\n  htmllexer.jar\n  htmlparser.jar\n  sax2.jar\n  thumbelina.jar\nincluded in the latest htmlparser\n  http://sourceforge.net/project/showfiles.php?group_id=24399&package_id=47712\nshould be included in classpath for compiling.\n\nAs for binary build, htmlparser.jar should be no longer included so that users\ncan install htmlparser as an option."}, {"count": 4, "tags": [], "bug_id": 39092, "is_private": false, "text": "Thanks, I'll take a look at this shortly", "id": 87196, "time": "2006-03-24T02:11:17Z", "creator": "sebb@apache.org", "creation_time": "2006-03-24T02:11:17Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 39092, "text": "There is a significant downside to ask users to download HTMLParser from\nsourceforge. Many users complain about this, so it needs to be documented\nclearly. We've seen this with the Webservice sampler, which requires users\ndownload external jars. I disagree with delete htmlparser in the src directory.\nHtmlparser developers were kind enough to donate a snapshot under apache license\nand I still find it valuable. Instead, we should make it configurable, or get\nrid of JTidy and htmlparser all together. We currently have JTidy, regexp and\nhtmlparser. The original reason for using htmlparser is it's easier to use than\nJTidy and not significantly slower than regexp.\n\nmy 2 cents on the issue. ", "count": 5, "id": 87197, "time": "2006-03-24T02:20:51Z", "creator": "woolfel@yahoo.com", "creation_time": "2006-03-24T02:20:51Z", "is_private": false}, {"count": 6, "tags": [], "creator": "hideaki.kimura@gmail.com", "text": "Thanks for concerning, peter.\n\nExactly, downloading manually is troublesome.\nBut, it still works without htmlparser, apart from the performance down which\ncomes from the low performance of RegexHTMLParser you mentioned.\n\nWho have to download htmlparser manually are only those who put \"retrieve all\"\nin the HTTP Sampler on and also have to care about the performance of HTTP Sampler.\nIn most case, I think, users don't have to do anything more than now.\n\nBut, anyway, the benefit of using donated codes still exists as you say.\nThen... how about to ask htmlparser developers team again?\nIs it too intrusive?\n\n(In reply to comment #5)\n> There is a significant downside to ask users to download HTMLParser from\n> sourceforge. Many users complain about this, so it needs to be documented\n> clearly. We've seen this with the Webservice sampler, which requires users\n> download external jars. I disagree with delete htmlparser in the src directory.\n> Htmlparser developers were kind enough to donate a snapshot under apache license\n> and I still find it valuable. Instead, we should make it configurable, or get\n> rid of JTidy and htmlparser all together. We currently have JTidy, regexp and\n> htmlparser. The original reason for using htmlparser is it's easier to use than\n> JTidy and not significantly slower than regexp.\n> \n> my 2 cents on the issue. \n\n", "id": 87198, "time": "2006-03-24T02:47:50Z", "bug_id": 39092, "creation_time": "2006-03-24T02:47:50Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "sebb@apache.org", "text": "The following property is used to define the parser interface class:\n\nhtmlParser.className\n\nso one should be able to create a new class to use the new API - instead of\nreplacing the existing class as currently proposed.\n\nIf a user wants the new parser, then they just download the new jars, and update\nthe parser property.\n\nOK?", "id": 87199, "time": "2006-03-24T02:49:16Z", "bug_id": 39092, "creation_time": "2006-03-24T02:49:16Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 39092, "is_private": false, "count": 8, "id": 87200, "time": "2006-03-24T02:53:33Z", "creator": "woolfel@yahoo.com", "creation_time": "2006-03-24T02:53:33Z", "text": "As usual, you have great ideas sebb. that sounds like a good solution to me.\npeter"}, {"count": 9, "tags": [], "bug_id": 39092, "text": "One thing is that,\ncompiling current HtmlParserHTMLParser needs htmlparser 1.3\nand that of new HtmlParserHTMLParser needs 1.6.\n\nUnfortunately, it's impossible to make a new HtmlParserHTMLParser which can be\ncompiled with htmlparser 1.6 as well as 1.3 .\nThey are totally incompatible. Only one of them can be in the JMeter source code.", "id": 87201, "time": "2006-03-24T03:08:41Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-24T03:08:41Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 39092, "is_private": false, "count": 10, "id": 87202, "time": "2006-03-24T03:12:22Z", "creator": "sebb@apache.org", "creation_time": "2006-03-24T03:12:22Z", "text": "I think I can get round the compilation problem.\n\nHowever, the problem I have at the moment is that the patch does not work for me.\n\nPlease can you attach the full new parser file?"}, {"attachment_id": 17964, "tags": [], "bug_id": 39092, "text": "Created attachment 17964\na whole source code of new HTMLParserHTMLParser", "count": 11, "id": 87203, "time": "2006-03-24T03:19:29Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-24T03:19:29Z", "is_private": false}, {"count": 12, "tags": [], "creator": "hideaki.kimura@gmail.com", "text": "Created attachment 17965\na whole source code of new HTMLParser", "id": 87204, "time": "2006-03-24T03:20:19Z", "bug_id": 39092, "creation_time": "2006-03-24T03:20:19Z", "is_private": false, "attachment_id": 17965}, {"attachment_id": null, "tags": [], "bug_id": 39092, "text": "Was it in incorrect format? If so, sorry.\nI used WinMerge to make the patches.\nAnyaway, I uploaded the whole file.\n\n(In reply to comment #10)\n> I think I can get round the compilation problem.\n> \n> However, the problem I have at the moment is that the patch does not work for me.\n> \n> Please can you attach the full new parser file?\n\n", "count": 13, "id": 87205, "time": "2006-03-24T03:23:43Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-24T03:23:43Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 39092, "is_private": false, "count": 14, "id": 87223, "time": "2006-03-24T18:16:28Z", "creator": "sebb@apache.org", "creation_time": "2006-03-24T18:16:28Z", "text": "There's a problem with the parsing code - it does not seem to handle BASEREF\ntags properly. They are detected, but the new base is not saved for subsequent tags.\n"}, {"count": 15, "tags": [], "bug_id": 39092, "attachment_id": null, "text": "!!!\nSo so sorry, silly mistake.\nIt just overwrites the pointer, not pointee.\nI'll modify it right now.\n\n(In reply to comment #14)\n> There's a problem with the parsing code - it does not seem to handle BASEREF\n> tags properly. They are detected, but the new base is not saved for \nsubsequent tags.\n\n", "id": 87236, "time": "2006-03-24T22:00:40Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-24T22:00:40Z", "is_private": false}, {"count": 16, "tags": [], "creator": "hideaki.kimura@gmail.com", "text": "Created attachment 17975\na modified source code of new HTMLParserHTMLParser\n\nsorry, what a silly mistake..", "id": 87238, "time": "2006-03-24T22:43:53Z", "bug_id": 39092, "creation_time": "2006-03-24T22:43:53Z", "is_private": false, "attachment_id": 17975}, {"count": 17, "tags": [], "bug_id": 39092, "attachment_id": null, "text": "That works better, though I had to change:\n\nbaseUrl.url = new URL(baseUrl.url, baseHref.getBaseUrl() + \"/\");\n\nto\n\nbaseUrl.url = new URL(baseUrl.url, baseHref.getBaseUrl());\n\nto avoid getting  // in URLs.\n\n==\n\nBy the way, I found I only needed htmlparser.jar for compiling and running.", "id": 87243, "time": "2006-03-25T00:34:24Z", "creator": "sebb@apache.org", "creation_time": "2006-03-25T00:34:24Z", "is_private": false}, {"count": 18, "tags": [], "bug_id": 39092, "attachment_id": null, "is_private": false, "id": 87248, "time": "2006-03-25T10:07:45Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-25T10:07:45Z", "text": "Thanks for pointing out.\n\nAs you said, it seems to need only htmlparser.jar.\nIt worked in my environment, too.\n\nIf you can get round the compilation problem and are going to\nadd a new class instead of replacing it,\nplease discard my changing at HTMLParser.java and remove\nthe isValid() function from new HtmlParserHTMLParser.java\nas well as give it a new name, like HtmlParserHTMLParser16(?) .\n\nI apologize if you have already done or planed it (most likely so...)\n\n\n(In reply to comment #17)\n> That works better, though I had to change:\n> \n> baseUrl.url = new URL(baseUrl.url, baseHref.getBaseUrl() + \"/\");\n> \n> to\n> \n> baseUrl.url = new URL(baseUrl.url, baseHref.getBaseUrl());\n> \n> to avoid getting  // in URLs.\n> \n> ==\n> \n> By the way, I found I only needed htmlparser.jar for compiling and running.\n\n"}, {"count": 19, "tags": [], "creator": "sebb@apache.org", "text": "Created attachment 17977\nhtmlparser source and class\n\nThe attached jar contains my version of the source, and the compiled class.\n\nI've kept the same name as the existing class.\nTo use it:\nReplace the jmeter htmlparser.jar with the SF one.\nPut the htmlparserpaser.jar in the lib directory.\nYou may also need to delete the htmlparserhtmlparser.class file from the Jmeter\nhttp jar.\nI've not decided how best to build/test the new class automatically yet - at\npresent I'm using a separate Eclipse project, which is not ideal.\nBut in the meantime, please try it, and try to break it...", "id": 87249, "time": "2006-03-25T11:39:20Z", "bug_id": 39092, "creation_time": "2006-03-25T11:39:20Z", "is_private": false, "attachment_id": 17977}, {"count": 20, "tags": [], "bug_id": 39092, "text": "> Replace the jmeter htmlparser.jar with the SF one.\n> Put the htmlparserpaser.jar in the lib directory.\n> You may also need to delete the htmlparserhtmlparser.class file from the Jmeter\n> http jar.\nAll right.\nIt worked well, though I need to delete the htmlparserhtmlparser.class as you said.\n\nAnd, I found one more bug of HtmlParserHTMLParser, in Line 163\n   if (tag.getAttribute(\"rel\").equalsIgnoreCase(\"stylesheet\")) {\nshould be\n   if (tag.getAttribute(\"rel\") != null &&\ntag.getAttribute(\"rel\").equalsIgnoreCase(\"stylesheet\")) {\nNPE happens during retrieving http://db.apache.org/ or other sites which have\n\"</link>\" (xhtml).\n\n> I've not decided how best to build/test the new class automatically yet - at\n> present I'm using a separate Eclipse project, which is not ideal.\n> But in the meantime, please try it, and try to break it...\nI agree with you. It's better to think about how to provide this\n, though I feel like asking the htmlparser team again at some day.\n\nThanks, sebb.", "id": 87253, "time": "2006-03-25T13:30:04Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-25T13:30:04Z", "is_private": false, "attachment_id": null}, {"attachment_id": 17978, "tags": [], "bug_id": 39092, "text": "Created attachment 17978\nA jmx file I used for testing the combination of BeanShell Sampler and htmlparser1.6\n\nIncidentally, I would like to show how valuable the combination of\nhtmlparser1.6 and BeanShell Sampler is.\nThe attached jmx file demonstrates it.\nThis jmx accesses www.apache.org and retrieve link-tags by this beanshell\ncodes:\n\nparser = new Parser();\nparser.setInputHTML(new String(ctx.getPreviousResult().getResponseData(),\n\"iso-8859-1\"));\n// pickup apache sites shown on the left.\naTags = parser.parse(new AndFilter(new TagNameFilter(\"td\"), new\nHasAttributeFilter(\"class\", \"navleft\")))\n  .extractAllNodesThatMatch(new LinkRegexFilter(\"http://.*/\"), true);\n# htmlparser's NodeFilters are very cool!\n\nand after that, put them into variables:\nfor(i = 0; i < aTags.size() && i < 10; ++i) {\n  href =  aTags.elementAt(i).getAttribute(\"href\");\n  server = href.substring(\"http://\".length(), href.length() - 1);\n  log.info(\"The server of found site is : \" + server);\n  vars.put(\"SITES_SERVER_\" + (i + 1), server);\n}\n\nand ForEach Controller and parameterized HTTP Sampler calls\neach retrieved URL.\n\nThe above is only an example, this process has unprecedented flexibility,\nmaintainability and easiness to correlate.\nIt hasn't been provided by LoadRunner/Rational or any other test tool!\nI'm so grateful to the developers of htmlparser and BeanShell Sampler.\nReally Exciting!", "count": 21, "id": 87254, "time": "2006-03-25T13:48:02Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-25T13:48:02Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 39092, "is_private": false, "count": 22, "id": 87255, "time": "2006-03-25T14:41:40Z", "creator": "sebb@apache.org", "creation_time": "2006-03-25T14:41:40Z", "text": "(In reply to comment #20)\n> And, I found one more bug of HtmlParserHTMLParser, in Line 163\n>    if (tag.getAttribute(\"rel\").equalsIgnoreCase(\"stylesheet\")) {\n> should be\n>    if (tag.getAttribute(\"rel\") != null &&\n> tag.getAttribute(\"rel\").equalsIgnoreCase(\"stylesheet\")) {\n> NPE happens during retrieving http://db.apache.org/ or other sites which have\n> \"</link>\" (xhtml).\n\nOK.\n\nWe're not interested in end tags - perhaps they should be filtered out.\n\nBTW, why use (tagname.equalsIgnoreCase(\"LINK\")) rather than (tag instanceof\nLinkTag?)\n \n> > I've not decided how best to build/test the new class automatically yet - at\n> > present I'm using a separate Eclipse project, which is not ideal.\n> > But in the meantime, please try it, and try to break it...\n> I agree with you. It's better to think about how to provide this\n> , though I feel like asking the htmlparser team again at some day.\n\nIf they are willing to additionally licence the binary under an ASF-compatible\nlicense, then it would probably solve all the problems..."}, {"count": 23, "tags": [], "text": "> BTW, why use (tagname.equalsIgnoreCase(\"LINK\")) rather than (tag instanceof\n> LinkTag?)\nThat is because LinkTag represents \"A\" tag, not \"LINK\" tag.\nInstead, htmlparser 1.3 has \"LinkTagTag\", but 1.6 doesn't.\n\n> If they are willing to additionally licence the binary under an ASF-compatible\n> license, then it would probably solve all the problems...\nYeah, hoping so.\nAs peter said, I think they are so kind guys.", "is_private": false, "bug_id": 39092, "id": 87256, "time": "2006-03-25T14:59:05Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-03-25T14:59:05Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 39092, "text": "Goood news!\nMr. Derrick Oswald, the lead developer of htmlparser, generously permits \nJMeter project to re-distribute htmlparser.jar.\n\n> You are welcome to use the HTML Parser, in either binary or source code \nform, to be included with JMeter.\n> \n> Sincerely,\n> \n> Derrick Oswald\n> HTML Parser Lead Programmer\n\nThanks for advice, Peter.", "count": 24, "id": 87532, "time": "2006-04-03T15:31:23Z", "creator": "hideaki.kimura@gmail.com", "creation_time": "2006-04-03T15:31:23Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 39092, "text": "I've added a new parser class:  HtmlParserHTMLParser16 to the 2.1 branch\n\nJust set the parser property accordingly, and replace the htmlparser jar with\nversion 1.6 (or later)", "count": 25, "id": 89511, "time": "2006-05-26T00:11:49Z", "creator": "sebb@apache.org", "creation_time": "2006-05-26T00:11:49Z", "is_private": false}]
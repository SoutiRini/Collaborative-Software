[{"count": 0, "tags": [], "bug_id": 45587, "text": "I have following perl script,\n\n\n#!/usr/bin/perl\n\n# Log Server Status\n# Mark J Cox, UK Web Ltd 1996, mark@ukweb.com\n#\n# This script is designed to be run at a frequent interval by something\n# like cron.  It connects to the server and downloads the status\n# information.  It reformats the information to a single line and logs\n# it to a file.  Make sure the directory $wherelog is writable by the\n# user who runs this script.\n#\nrequire 'sys/socket.ph';\n\n$wherelog = \"/var/logs/apache/graph/\";  # Logs will be like \"/var/log/graph/19960312\"\n$server = \"127.0.0.1\";          # Name of server, could be \"www.foo.com\"\n$port = \"80\";                   # Port on server\n$request = \"/status/\";     # Request to send\nsub tcp_connect\n{\n        local($host,$port) =@_;\n        $sockaddr='S n a4 x8';\n        chop($hostname=`hostname`);\n        $port=(getservbyname($port, 'tcp'))[2]  unless $port =~ /^\\d+$/;\n        $me=pack($sockaddr,&AF_INET,0,(gethostbyname($hostname))[4]);\n        $them=pack($sockaddr,&AF_INET,$port,(gethostbyname($hostname))[4]);\n        socket(S,&PF_INET,&SOCK_STREAM,(getprotobyname('tcp'))[2]) ||\n                die \"socket: $!\";\n        bind(S,$me) or return \"bind:$!\";\n        connect(S,$them) or return \"connect:$!\";\n        select(S);\n         $| = 1;\n        select(stdout);\n        return \"\";\n}\n{\n        $year=`date +%y`;\n        chomp($year);\n        $year += ($year < 70) ? 2000 : 1900;\n        $date = $year . `date +%m%d:%H%M%S`;\n        chomp($date);\n        ($day,$time)=split(/:/,$date);\n        $res=&tcp_connect($server,$port);\n        open(OUT,\">>$wherelog$day\");\n        if ($res) {\n                print OUT \"$time:-1:-1:-1:-1:$res\\n\";\n                exit 1;\n        }\n\n        print S \"GET $request\\n\";\n        while (<S>) {\n                $requests=$1 if ( m|^BusyServers:\\ (\\S+)|);\n                $idle=$1 if ( m|^IdleServers:\\ (\\S+)|);\n                $number=$1 if ( m|sses:\\ (\\S+)|);\n                $cpu=$1 if (m|^CPULoad:\\ (\\S+)|);\n        }\n        print OUT \"$time:$requests:$idle:$number:$cpu\\n\";\n}\n\n\nWhen I am running the above script it create a the timestamp file like \n\n120341::::\n\nWhats wrong with this script?\n\nAny one explain me.......", "id": 119541, "attachment_id": null, "creator": "thangaraju.kandasamy@standardchartered.com", "creation_time": "2008-08-07T05:01:47Z", "time": "2008-08-07T05:01:47Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 45587, "attachment_id": null, "text": "This is not a bug with Apache. This is an issue with your script.\nYou should take you query to the user support forums :  \n\nhttp://httpd.apache.org/docs/trunk/faq/\n\nHowever as this is not a script that comes as part of the httpd release your unlikely to get much support for it there.  You should trouble shoot the script yourself a little further, or you could possibly contact Mark Cox, but I think it is highly unlikely he provides support on these.\n\nThis is the line in the script that produces the output -> \n\nprint OUT \"$time:$requests:$idle:$number:$cpu\\n\";\n\n\nI would suggest that you need to investigate if those variables are being populated with any information.\n\n\nTony\n", "id": 119548, "time": "2008-08-07T08:03:14Z", "creator": "tony@pc-tony.com", "creation_time": "2008-08-07T08:03:14Z", "is_private": false}]
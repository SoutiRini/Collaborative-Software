[{"count": 0, "tags": [], "bug_id": 51671, "text": "I do this:\n\nInputStream st = ... // stream with the doc file\nNPOIFSFileSystem fs = new NPOIFSFileSystem(st);\nHWPFDocument doc = new HWPFDocument(fs.getRoot());\nByteArrayOutputStream baos = new ByteArrayOutputStream();\ndoc.write(baos);\n\nI get this:\n\njava.lang.NullPointerException\n\tat org.apache.poi.hwpf.HWPFDocument.deleteEntrySafe(HWPFDocument.java:980)\n\tat org.apache.poi.hwpf.HWPFDocument.write(HWPFDocument.java:951)\n...\n\nIt seems that the HWPFDocument.write relies on the fact that directory.getFileSystem() will return a non-null object. Unfortunately, when using the NPOIFSFileSystem, this is not the case. A workaround would be to add a \n\t\nif (pfs == null) {\n    pfs = new POIFSFileSystem();\n}\n\nThis seems to work for me.", "id": 148662, "time": "2011-08-17T11:52:39Z", "creator": "antoni.mylka@aduna-software.com", "creation_time": "2011-08-17T11:52:39Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "antoni.mylka@aduna-software.com", "attachment_id": 27396, "id": 148663, "time": "2011-08-17T12:03:27Z", "bug_id": 51671, "creation_time": "2011-08-17T12:03:27Z", "is_private": false, "text": "Created attachment 27396\nA patch which adds the if (pfs==null) check"}, {"count": 2, "tags": [], "creator": "antoni.mylka@aduna-software.com", "attachment_id": 27397, "id": 148664, "time": "2011-08-17T12:04:02Z", "bug_id": 51671, "creation_time": "2011-08-17T12:04:02Z", "is_private": false, "text": "Created attachment 27397\na test doc, to be placed in test-data/document"}, {"count": 3, "attachment_id": null, "bug_id": 51671, "is_private": false, "id": 148666, "time": "2011-08-17T14:54:06Z", "creator": "vlsergey@gmail.com", "creation_time": "2011-08-17T14:54:06Z", "tags": [], "text": "Fixed by using new file system, not existing one."}]
[{"count": 0, "tags": [], "bug_id": 45118, "text": "When serving a normal local html static page, Apache 2.2.3 under some circumstances generates 2 consecutive \"Content-type\" headers with conflicting charset attributes. Example : I have 3 similar \"welcome\" pages : \n1) Welcome.html contains a html header line\n<META HTTP-EQUIV=\"Content-Type\" CONTENT=\"text/html; charset=windows-1252\">\n2) Welcome.iso.html is the same with a different header line\n<META HTTP-EQUIV=\"Content-Type\" CONTENT=\"text/html; charset=iso-8859-1\">\n3) Welcome.none.html is the same but does not contain such a META line.\n\nUsing perl's \"lwp-request\" to get the page and see what the server actually gets as HTTP headers I obtain (except that I changed the server's hostname) :\ncase 1 :\ndent:/var/NFS# lwp-request -m GET -Sed http://myserver.mydomain.com/Welcome.html\nGET http://myserver.mydomain.com/Welcome.html --> 200 OK\nConnection: close\nDate: Mon, 02 Jun 2008 22:30:29 GMT\nAccept-Ranges: bytes\nETag: \"186b6-47e5-44d495bec3240\"\nServer: Apache/2.2.3 (Debian) mod_jk/1.2.18 mod_perl/2.0.2 Perl/v5.8.8\nContent-Length: 18405\nContent-Type: text/html; charset=ISO-8859-1\nContent-Type: text/html; charset=windows-1252\nLast-Modified: Thu, 15 May 2008 18:49:37 GMT\nClient-Date: Mon, 02 Jun 2008 22:30:29 GMT\nClient-Peer: 212.85.38.184:80\nClient-Response-Num: 1\nLink: <http://myserver.mydomain.com/astellaska.css>; rel=\"stylesheet\"; type=\"text/css\"\nTitle: MEDICAL AFFAIRS - SCIENTIFIC INFORMATION - WELCOME\nX-Meta-Generator: Microsoft FrontPage 6.0\nX-Meta-Template: C:\\PROGRAMME\\MICROSOFT OFFICE\\OFFICE\\html.dot\n\ncase 2 : \ndent:/var/NFS# lwp-request -m GET -Sed http://myserver.mydomain.com/Welcome.iso.html\nResponse : the same but the 2 Content-Type lines are now :\nContent-Type: text/html; charset=ISO-8859-1\nContent-Type: text/html; charset=iso-8859-1\n\ncase 3 :\ndent:/var/NFS# lwp-request -m GET -Sed http://myserver.mydomain.com/Welcome.none.html\nresponse : only a single Content-Type line :\nContent-Type: text/html; charset=ISO-8859-1\n\nThe server conf file contains a section :\n<IfModule mod_mime.c>\n AddDefaultCharset ISO-8859-1\n[...]\n</IfModule>\n\nIf I take out the AddDefaultCharset, then I get a first Content-Type header with UTF-8 as the default charset, which creates browser display problems with the pages.\nBut what seems to happen is that Apache, upon encountering such a <META HTTP-EQUIV=\"Content-Type\" ..> line in the html page it serves, *adds* this content-type line to the default one, instead of replacing the default one.\nDifferent browsers seems to react differently to the duplicate Content-Type header.", "id": 117273, "time": "2008-06-02T15:49:16Z", "creator": "aw@ice-sa.com", "creation_time": "2008-06-02T15:49:16Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "text": "Have you tried if this also happens with\n1. A later vanilla build version of httpd?\n2. Without mod_perl activated?", "id": 117285, "attachment_id": null, "bug_id": 45118, "creation_time": "2008-06-03T02:13:14Z", "time": "2008-06-03T02:13:14Z", "is_private": false}, {"count": 2, "tags": [], "creator": "nick@webthing.com", "text": "This is lwp behaviour: it parses the <meta> and inserts it as if it were a header.\n(this happens clientside).", "id": 117286, "time": "2008-06-03T03:52:06Z", "bug_id": 45118, "creation_time": "2008-06-03T03:52:06Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 45118, "attachment_id": null, "is_private": false, "id": 117287, "time": "2008-06-03T04:19:43Z", "creator": "aw@ice-sa.com", "creation_time": "2008-06-03T04:19:43Z", "text": "\n(In reply to comment #2)\n\nYou are right, I just verified this with a Telnet session, which does not show the duplicate header. Sorry for the wrong bug report.\nWho would have thunk lwp does such strange things ?\n\nA related question however : as per the original bug report, if I remove the \nAddDefaultCharset iso-8859-1 \nline in the Apache configuration file, then I automatically get a \nContent-Type: text/html; charset=UTF-8\nheader for html documents.\n\nWhere does that come from ?  Does Apache / mod_mime check some attribute of the files served and decides this is UTF-8 ? or is there another configuration parameter that I am missing ?\n\n(please direct me to the appropriate list if this is not the right place for this question)\n"}]
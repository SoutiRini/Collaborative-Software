[{"count": 0, "tags": [], "creator": "huan@huan.pl", "text": "We're using mod_fcgid with Apache mpm_worker on a fairly busy server with 800+ vhosts. Under heavy load mod_fcgid stops working and only restart fixes the problem.\n\nIn error_log we have:\n\n--- CUT ---\n[Thu Feb 16 02:00:36 2012] [info] mod_fcgid: /fcgi/aaaa/public_html/php-fcgi total process count 700 >= 700, skip the spawn request\n[Thu Feb 16 02:00:36 2012] [info] mod_fcgid: /fcgi/bbbb/public_html/php-fcgi total process count 700 >= 700, skip the spawn request\n[Thu Feb 16 02:00:36 2012] [info] mod_fcgid: /fcgi/bbbb/public_html/php-fcgi total process count 700 >= 700, skip the spawn request\n[Thu Feb 16 02:00:36 2012] [info] mod_fcgid: /fcgi/cccc/public_html/php-fcgi total process count 700 >= 700, skip the spawn request\n[Thu Feb 16 02:00:36 2012] [info] mod_fcgid: /fcgi/dddd/public_html/php-fcgi total process count 700 >= 700, skip the spawn request\n[Thu Feb 16 02:00:36 2012] [info] mod_fcgid: /fcgi/eeee/public_html/php-fcgi total process count 700 >= 700, skip the spawn request\n--- CUT ---\n\nBUT 'ps aux' shows no php-cgi processes running and Apache status page shows 0 FastCGI processes running:\n\n--- CUT ---\n                       Apache Server Status for 127.0.0.1\n   \n   Server Version: Apache/2.2.21 (Unix) mod_ssl/2.2.21 OpenSSL/0.9.8o\n          DAV/2 Apache mod_fcgid/2.3.7-dev\n                               \n   Server Built: Dec 13 2011 09:36:32\n     __________________________________________________________________\n   \n   Current Time: Friday, 17-Feb-2012 01:25:42 CET\n   Restart Time: Friday, 17-Feb-2012 00:49:48 CET\n   Parent Server Generation: 1\n   Server uptime: 35 minutes 54 seconds\n   Total accesses: 20738 - Total Traffic: 320.9 MB\n   CPU Usage: u121.26 s2.07 cu0 cs0 - 5.73% CPU load\n   9.63 requests/sec - 152.5 kB/second - 15.8 kB/request\n   164 requests currently being processed, 136 idle workers\n    \nWWWWWWWWWWWW_WWWWWWWWWWW__W_W__WWWWWWWWWWW_W_WWWWW_WWWWWW_W_W_WW\nWWWW_WWWWW_WWWWWWWWWWWWWWWWWW_WWWW_W_______________W__W__W_WW_WW\nWW__WW_WW_W_WW_WWWW__W_WWWWW___WW_____WW_W_W___WW_______WWW_WW__\nW_____W_W_________WW_W__W_W_WWWW_WW_W_W_WW__W_____W___WW___WW_WW\n__WW__W_W_W_WW____W___W___WWW________W_W___WWWWW..WW.W....W..WWW\n..W...W....WWW...W.WWW..W..WW.WWW.WW.W.....W..WW.W..W.WWWW.WWW..\n.W....W.WW.W..W.................................................\n................................................................\n................................................................\n................................................................\n................................................................\n................................................................\n................................................................\n\n[...]\n\nmod_fcgid status:\n\nTotal FastCGI processes: 0\n\n--- CUT ---\n\n\nmod_fcgid configuration:\n--- CUT ---\n<IfModule mod_fcgid.c>\nFcgidProcessTableFile  /var/run/fcgid_shm\nFcgidIPCDir /var/run/fastcgi/sock\nFcgidIdleTimeout 10\nFcgidIdleScanInterval 10\nFcgidFixPathinfo 0\nFcgidErrorScanInterval 3\nFcgidZombieScanInterval 3\nFcgidMaxProcesses 700\nFcgidMaxRequestsPerProcess 500\nFcgidMaxProcessesPerClass 600\nFcgidMinProcessesPerClass 5\nFcgidConnectTimeout 5\nFcgidProcessLifeTime 3600\nFcgidIOTimeout 60\nFcgidPassHeader Authorization\nFcgidMaxRequestInMem 65355000\nFcgidMaxRequestLen 65355000\nFcgidOutputBufferSize 2048000\n</IfModule>\n--- CUT ---\n\nEvery vhost has similar config:\n--- CUT ---\n<IfModule mod_fcgid.c>\nFcgidMaxProcessesPerClass 6\nFcgidMinProcessesPerClass 0\n</IfModule>\n--- CUT ---\n\nmpm_worker config:\n--- CUT ---\n<IfModule mpm_worker_module>\n    StartServers           4\n    ServerLimit          400\n    MinSpareThreads       50\n    MaxSpareThreads      200\n    ThreadLimit           100\n    ThreadsPerChild       100\n    MaxClients           400\n    MaxRequestsPerChild   1000\n    ListenBackLog        810\n</IfModule>\n--- CUT ---", "id": 153867, "time": "2012-02-17T11:03:17Z", "bug_id": 52695, "creation_time": "2012-02-17T11:03:17Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 52695, "is_private": false, "count": 1, "id": 153932, "time": "2012-02-19T22:27:32Z", "creator": "lazy@iq.pl", "creation_time": "2012-02-19T22:27:32Z", "text": "does this happen after a restart ?\n\ncan You post logs from the restart time (17-Feb-2012 00:49:48) ?"}, {"count": 2, "tags": [], "creator": "wrowe@apache.org", "text": "You mention a crash.  Crashes are diagnosed by evaluating the backtrace that\ncan be reported from their core file.  I don't see that attached, please provide.", "id": 153939, "time": "2012-02-20T03:57:58Z", "bug_id": 52695, "creation_time": "2012-02-20T03:57:58Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 52695, "attachment_id": null, "text": "Please also try the current trunk?  This sounds a bit like bug 49902 already\nfixed... let's see what happens with the state of mod_fcgid now.", "id": 154379, "time": "2012-02-29T18:33:41Z", "creator": "wrowe@apache.org", "creation_time": "2012-02-29T18:33:41Z", "is_private": false}, {"count": 4, "tags": [], "creator": "wrowe@apache.org", "text": "No response from submittor, presuming the indicated ticket was the root cause.\n\n*** This bug has been marked as a duplicate of bug 49902 ***", "id": 160189, "time": "2012-06-22T21:43:02Z", "bug_id": 52695, "creation_time": "2012-06-22T21:43:02Z", "is_private": false, "attachment_id": null}]
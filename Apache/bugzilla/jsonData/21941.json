[{"count": 0, "tags": [], "text": "Overview Description:\nThis came up as a problem for me when I was developing a test suite, and wanted \nto have the test data in a sub-package of my source files for the tests.  There \nwere a LOT of test files, and it tripled the build time for the project, having \nthem located there.  I tried adding an exclude for the test data directory, but \nit did not prevent the scanning of the directory.\n\nSteps to reproduce:\n1) Create a directory (the basedir) with a \"src\" sub-directory.\n2) Place the build file below in the basedir you created.\n3) Place the java file below in the \"src\" directory.\n4) Run ant from the basedir with the \"build\" target.\n5) Run ant again from the basedir, comparing the speeds of the \"test_slow\" \nand \"test_fast\" targets.  If the time difference isn't large enough, just \nincrease the number of files in the \"testdir\" directory.\n\nFile: TestProg.java\nimport java.io.File;\n\npublic class TestProg {\n\tprivate static final File testDir = new File(\"src/testdir\");\n\t\n\tpublic static void main(String[] args) throws Exception {\n\t\ttestDir.mkdirs();\n\t\tfor(int i=0; i<20000; i++) {\n\t\t\tFile testFile = new File(testDir, \"test\" + \nInteger.toString(i) + \".txt\");\n\t\t\ttestFile.createNewFile();\n\t\t}\n\t}\n}\n\nFile: build.xml\n<?xml version=\"1.0\"?>\n<project name=\"exclude_bug\" basedir=\".\" default=\"build\">\n  <description>\n    Demonstrates a bug with fileset \"exclude\" support which can cause\n    (among other things) javac tasks to take WAY too long when there\n    are a lot of files excluded.\n  </description>\n\n  <target name=\"build\" description=\"Generates a bunch of files in src/testdir\">\n    <mkdir dir=\"${basedir}/dest\"/>\n    <javac srcdir=\"${basedir}/src\" destdir=\"${basedir}/dest\"/>\n    <java classname=\"TestProg\" classpath=\"${basedir}/dest\"/>\n  </target>\n\n  <target name=\"test_slow\" description=\"Demonstrates that the excluded \ndirectory is still scanned.\">\n    <javac srcdir=\"${basedir}/src\" destdir=\"${basedir}/dest\">\n      <exclude name=\"{$basedir}/src/testdir\"/>\n    </javac>\n  </target>\n  \n  <target name=\"test_fast\" description=\"Shows how quickly the build can be if \nexcluded directories are not scanned.\">\n    <javac srcdir=\"${basedir}/src\" destdir=\"${basedir}/dest\">\n      <include name=\"*.java\"/>\n    </javac>\n  </target>\n</project>", "is_private": false, "id": 41675, "creation_time": "2003-07-28T18:48:15Z", "time": "2003-07-28T18:48:15Z", "creator": "david@carr.name", "bug_id": 21941, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 21941, "attachment_id": null, "is_private": false, "id": 41677, "time": "2003-07-28T18:59:31Z", "creator": "antoine@apache.org", "creation_time": "2003-07-28T18:59:31Z", "text": "Try <exclude name=\"testdir/**\"/>\nthe directory for the exclude should be relative to the source directory.\n\nI resolve your report as INVALID.\n\nCheers,\n\nAntoine"}, {"count": 2, "tags": [], "text": "You were correct in that the line below was wrong:\n<exclude name=\"{$basedir}/src/testdir\"/>\nHowever, when it is replaced with your corrected line, the problem still exists:\n<exclude name=\"testdir/**\"/>", "attachment_id": null, "id": 41684, "creator": "david@carr.name", "time": "2003-07-28T20:14:09Z", "bug_id": 21941, "creation_time": "2003-07-28T20:14:09Z", "is_private": false}, {"count": 3, "tags": [], "text": "I must admit we have this problem too in ant1.6alpha", "attachment_id": null, "id": 41686, "creator": "antoine@apache.org", "time": "2003-07-28T20:52:20Z", "bug_id": 21941, "creation_time": "2003-07-28T20:52:20Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 21941, "attachment_id": null, "id": 41688, "time": "2003-07-28T21:45:07Z", "creator": "jkf@apache.org", "creation_time": "2003-07-28T21:45:07Z", "is_private": false, "text": "Hi, I have had a look into the source code, and will have further looks next\nwednesday (if no-one else has). It seems that the DirectoryScanner only checks\nif the directory couldHoldIncluded for a fast scan. Not if the directory\nisExcluded. Before putting that in a patch I want to make sure that my changes\ndo not exclude everything below a directory because only the directory itself is\nexcluded (or if that should be excluded).\n\ne.g. **/blah vs **/blah/**\n\n"}, {"count": 5, "tags": [], "text": "Martijn, the fix for this problem is on its way. Thanks anyway.\nAntoine", "is_private": false, "id": 41689, "creation_time": "2003-07-28T22:16:03Z", "time": "2003-07-28T22:16:03Z", "creator": "antoine@apache.org", "bug_id": 21941, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 21941, "attachment_id": null, "text": "I have just done a change in CVS which fixes this problem.\nI also have added 3 new testcases for DirectoryScanner which show or control \nthat exclude patterns have priority over include patterns.\n\nI mark the bug as fixed, hoping that my changes are OK.", "id": 41705, "time": "2003-07-29T10:57:06Z", "creator": "antoine@apache.org", "creation_time": "2003-07-29T10:57:06Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 21941, "is_private": false, "text": "Actually, the limitation of my change is that if we have\n<exclude name=\"src/test/**\"/> then src/test will not be scanned.\nBut if we have\n<exclude name=\"**/test/**\"/> then src/test or src/project1/test or \nsrc/project2/test will be scanned.", "id": 41706, "time": "2003-07-29T11:04:07Z", "creator": "antoine@apache.org", "creation_time": "2003-07-29T11:04:07Z", "attachment_id": null}]
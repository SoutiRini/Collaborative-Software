[{"count": 0, "tags": [], "creator": "aaron14.public@gmail.com", "attachment_id": null, "is_private": false, "id": 179699, "time": "2014-12-10T17:58:51Z", "bug_id": 57338, "creation_time": "2014-12-10T17:58:51Z", "text": "When using the ClusterSingleSignOn valve, it looks like the single sign on session state is not synchronized to cluster nodes when they start. The state is instead only replicated at the moment that an action is performed, so any nodes that come online after that action are out of sync.\n\nSee mailing list discussion here: http://www.mail-archive.com/users@tomcat.apache.org/msg115472.html"}, {"count": 1, "tags": [], "bug_id": 57338, "text": "Anyone working on this? If not I'll take a look. My initial thoughts are to make use of one of the ReplicatedMap implementations.", "id": 179778, "time": "2014-12-15T19:59:56Z", "creator": "markt@apache.org", "creation_time": "2014-12-15T19:59:56Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 57338, "is_private": false, "text": "Not yet.\nI've just ClusterSingleSignOn implements ClusterValve.(r1645595)\nI am writing a document of ClusterSingleSignOn now.\n\nIMHO.\nIf using the ReplicatedMap, it may be necessary to add jvmRoute to SSOID.\nIf using SSO cache (ReplicatedMap) of backup node, it will be replicated to the other node.\nSo, It may be necessary that the SSO Cookie is sticky.\n\nFor example, setting the SSO Cookie name(JSESSIONIDSSO) to session_cookie of mod_jk.\nAs a Result, all of the Web applications in the SSO can be used on the same node,\nI think to be able to suppress unnecessary replication.", "id": 179783, "time": "2014-12-16T02:00:44Z", "creator": "kfujino@apache.org", "creation_time": "2014-12-16T02:00:44Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "The biggest problem I can see with ReplicatedMap at this point as that I don't want to / can't replicated the two Maps (cache and reverse) as currently implemented since that means replicating the entire session and a potentially non-serializable Principal.\n\nI'm looking into refactoring the SSO implementation to make this easier.\n\nRegarding adding jvmRoute to the SSO cookie, I see the point you are making and I agree with it. However, I think that point applies irrespective of this bug report and is probably best handled separately.", "id": 179792, "time": "2014-12-16T09:18:52Z", "bug_id": 57338, "creation_time": "2014-12-16T09:18:52Z", "is_private": false}, {"count": 4, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "I have a patch but it is untested. I'm working on that now and hope to be able to commit something in the next 24 hours.", "id": 179801, "time": "2014-12-16T17:34:13Z", "bug_id": 57338, "creation_time": "2014-12-16T17:34:13Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 57338, "is_private": false, "text": "This is currently implemented in trunk (Tomcat 9).\n\nWe need to discuss on the dev list which versions, if any, this can be back-ported to as there were a number of fairly invasive changes made to enable this to be implemented sensibly.", "id": 179807, "time": "2014-12-16T21:58:19Z", "creator": "markt@apache.org", "creation_time": "2014-12-16T21:58:19Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "I've back-ported the fix to 8.0.x and it will be included in 8.0.x onwards. I'll wait for some feedback on that before back-porting it to 7.0.x.", "id": 179874, "time": "2014-12-19T14:56:13Z", "bug_id": 57338, "creation_time": "2014-12-19T14:56:13Z", "is_private": false}, {"count": 7, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 180692, "time": "2015-02-01T19:33:00Z", "bug_id": 57338, "creation_time": "2015-02-01T19:33:00Z", "text": "*** Bug 28039 has been marked as a duplicate of this bug. ***"}, {"count": 8, "tags": [], "bug_id": 57338, "text": "(In reply to Mark Thomas from comment #6)\n> I've back-ported the fix to 8.0.x and it will be included in 8.0.x onwards.\n> I'll wait for some feedback on that before back-porting it to 7.0.x.\n\nJust wondering...has there been any more thought to back-porting this fix to 7.0.x?", "id": 182500, "time": "2015-04-20T14:34:47Z", "creator": "aaron14.public@gmail.com", "creation_time": "2015-04-20T14:34:47Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "It has been long enough now without any issues being reported so I'll start work on the back-port.", "id": 182550, "time": "2015-04-22T09:02:50Z", "bug_id": 57338, "creation_time": "2015-04-22T09:02:50Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 57338, "text": "Fixed in 7.0.x/trunk for 7.0.62 onwards.", "id": 182551, "time": "2015-04-22T10:36:46Z", "creator": "markt@apache.org", "creation_time": "2015-04-22T10:36:46Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "We use Debian Sarge with Apache 2.0.54-2 prebuild in the debian repository.\n\nmod_disk_cache config:\n\nCacheRoot /cacheroot\nCacheSize 1024\nCacheEnable disk /\nCacheDirLevels 5\nCacheDirLength 3\n\nmod_proxy was disabled for the test.\n\nFor this test we used a little testscript (cachetest.cgi):\n\n#!/usr/bin/perl\nuse CGI;\nuse strict;\nmy $cachetime=60;\nmy $foo=localtime();\nprint \"Expires: \".CGI::expires(\"+\".$cachetime.\"s\",\"http\").\"\\n\";\nprint \"Date: \".CGI::expires(0,\"http\").\"\\n\";\nprint \"Last-Modified: \".CGI::expires(0,\"http\").\"\\n\";\nprint \"Cache-Control: max-age=$cachetime\\n\";\nprint qq(Content-type: text/html\n<HTML>\n<BODY>\n$foo\n);\nsleep(5);\nprint qq(\nTest\n</BODY>\n</HTML>\n);\n\nWe cleaned up /cacheroot and restart apache.\n\nWhen we first requested the cgi\nlynx http://localhost/cgi-bin/cachetest.cgi\n\nthe document was cached. The next requests with lynx resulted in the correctly\ncached version. After 60 seconds lynx got an new version and the cache rebuilded\nas expected.\n\nSo far so good. \n\nBUT: When we request the cgi with\nlynx --reload http://localhost/cgi-bin/cachetest.cgi\n\nwe see a non-cached version. Which is correct. But the cache is NOT rebuilded:\nThe next request with  lynx http://localhost/cgi-bin/cachetest.cgi gets the OLD\ncontent of the cache. The reload of the browser only results in a temporarly way\nthrough the cache to the most recent version. But it don't refresh the cache\nitself. \n\nThis behaviour (which is reproducable with Firefox - but easier and more obvious\nwith lynx) doesn't seem correct.", "is_private": false, "id": 74781, "creator": "apache@dimedis.de", "time": "2005-05-12T11:19:24Z", "bug_id": 34888, "creation_time": "2005-05-12T11:19:24Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 34888, "text": "As browsers use different headers for their reload operations we have to\ndistinguish at least two cases here:\n\nBrowser sents the following headers:\n\n1.\n\nPragma: no-cache\nCache-Control: no-cache\n\nThis is the case with lynx --reload and shift reload in Mozilla.\n\n2.\n\nCache-Control: max-age=0\n\nThis is the case when the reload button is pressed in Mozilla.\n\nRegarding 1.\n\nThis has been fixed in the trunk by revision 156480. The fixes are\nin mod_cache.c and cache_util.c. Before the CACHE_SAVE filter was not\nadded in this case.\nIn 2.0.54 the comments in cache_util.c in lines 555 - 558 do not match\nthe code.\n\nRegarding 2.\n\nThis is a regression since 2.0.53 where many fixes to mod_cache have been\nbackported. It works in 2.0.52. This regression was introduced in cache_util.c\nby revisision 105236 and fixed by revision 156401 (trunk).\n\nAs far as I understand RFC 2616 both cases (at least 2.) break RFC compliance\nof mod_cache. Thus I think the according fixes from the trunk should be\nbackported.\n\nMeanwhile I checked with Felix again and the attached quick and dirty\nbackport should be some first aid.\n", "id": 75186, "time": "2005-05-21T23:47:26Z", "creator": "ruediger.pluem@vodafone.com", "creation_time": "2005-05-21T23:47:26Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "ruediger.pluem@vodafone.com", "attachment_id": 15110, "id": 75187, "time": "2005-05-21T23:48:10Z", "bug_id": 34888, "creation_time": "2005-05-21T23:48:10Z", "is_private": false, "text": "Created attachment 15110\nFirst aid quick and dirty backport (against 2.0.54)"}, {"count": 3, "attachment_id": null, "creator": "chip@force-elite.com", "is_private": false, "id": 83285, "time": "2005-12-06T07:42:54Z", "bug_id": 34888, "creation_time": "2005-12-06T07:42:54Z", "tags": [], "text": "I believe this issue is fixed in 2.2.0."}]
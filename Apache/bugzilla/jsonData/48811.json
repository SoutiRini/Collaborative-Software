[{"count": 0, "tags": [], "creator": "trawick@apache.org", "text": "httpd2 -V\n       Server version: Apache/2.2.14 (Linux/SUSE)\n       Server built:   Feb 19 2010 19:43:22\n       Server's Module Magic Number: 20051115:23\n       Server loaded:  APR 1.3.8, APR-Util 1.3.9\n       Compiled using: APR 1.3.8, APR-Util 1.3.9\n       Architecture:   32-bit\n       Server MPM:     Worker\n         threaded:     yes (fixed thread count)\n           forked:     yes (variable process count)\n       Server compiled with....\n        -D APACHE_MPM_DIR=\"server/mpm/worker\"\n        -D APR_HAS_SENDFILE\n        -D APR_HAS_MMAP\n        -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n        -D APR_USE_SYSVSEM_SERIALIZE\n        -D APR_USE_PTHREAD_SERIALIZE\n        -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n        -D APR_HAS_OTHER_CHILD\n        -D AP_HAVE_RELIABLE_PIPED_LOGS\n        -D DYNAMIC_MODULE_LIMIT=128\n        -D HTTPD_ROOT=\"/srv/www\"\n        -D SUEXEC_BIN=\"/usr/sbin/suexec2\"\n        -D DEFAULT_PIDLOG=\"/var/run/httpd2.pid\"\n        -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n        -D DEFAULT_ERRORLOG=\"/var/log/apache2/error_log\"\n        -D AP_TYPES_CONFIG_FILE=\"/etc/apache2/mime.types\"\n        -D SERVER_CONFIG_FILE=\"/etc/apache2/httpd.conf\"\n\nand,\n\ncd /usr/local/src/mod_fcgid\nsvn info\n       Path: .\n       URL: http://svn.apache.org/repos/asf/httpd/mod_fcgid/trunk\n       Repository Root: http://svn.apache.org/repos/asf\n       Repository UUID: 13f79535-47bb-0310-9956-ffa450edef68\n       Revision: 915656\n       Node Kind: directory\n       Schedule: normal\n       Last Changed Author: chrisd\n       Last Changed Rev: 909672\n       Last Changed Date: 2010-02-12 16:49:29 -0800 (Fri, 12 Feb 2010)\n\n> What is the OS\n\nlsb_release -a\n LSB Version:\ncore-2.0-noarch:core-3.2-noarch:core-4.0-noarch:core-2.0-ia32:core-3.2-ia32:core-4.0-ia32:desktop-4.0-ia32:desktop-4.0-noarch:graphics-2.0-ia32:graphics-2.0-noarch:graphics-3.2-ia32:graphics-3.2-noarch:graphics-4.0-ia32:graphics-4.0-noarch\n Distributor ID: SUSE LINUX\n Description:    openSUSE 11.2 (i586)\n Release:        11.2\n Codename:       n/a\n\nuname -rsvo\n Linux 2.6.31.12-12-xen #1 SMP 2010-02-19 18:56:57 +0100 GNU/Linux\n\n\n> and how many instances (processes) of your two apps\n> were running when this message was generated?\n\none each.  although the order doesn't make a difference, in the\nexample following, the 1st invoked app is a single instance of a\npressflow6 site front-page.  The 2nd invoked app is simply the login\npage of a drupal6 site.\n\n> With LogLevel debug,\n\negrep -i Log {pressflow6.conf,drupal6.conf}\n       pressflow6.conf:     LogLevel debug\n       pressflow6.conf:    ErrorLog       /var/log/apache2/pressflow6.error_log\n       pressflow6.conf:    CustomLog      /var/log/apache2/pressflow6.log cached\n       drupal6.conf:    LogLevel debug\n       drupal6.conf:    ErrorLog       /var/log/apache2/drupal6.error_log\n       drupal6.conf:    CustomLog      /var/log/apache2/drupal6.log cached\n\ngrep -i log ./sysconfig.d/global.conf\n       LogLevel debug\n       CustomLog /var/log/apache2/access_log combined\n\n> what messages are written by mod_fcgid to the error log up until the first failure?\n\nwatching,\n\n       tail -f /var/log/apache/{pressflow6,drupal6}*log error_log access_log\n\nINVOKE THE 1st APP\n\n==> pressflow6.log <==\nstaging.loc 10.0.1.206, 127.0.0.1 - - [24/Feb/2010:08:38:47 -0800]\n\"GET / HTTP/1.1\" 302 - \"-\" \"Mozilla/5.0 (X11; U; Linux x86_64; en-US;\nrv:1.9.2.0) Gecko/20100115 SUSE/3.6.0-2.1 Firefox/3.6\"\n\n==> error_log <==\n[Wed Feb 24 08:38:47 2010] [info] mod_fcgid: server\nstaging.loc:/usr/bin/php-cgi5(2750) started\n\n==> pressflow6.log <==\nstaging.loc 10.0.1.206, 127.0.0.1 - - [24/Feb/2010:08:38:48 -0800]\n\"GET /main/ HTTP/1.1\" 403 7866 \"-\" \"Mozilla/5.0 (X11; U; Linux x86_64;\nen-US; rv:1.9.2.0) Gecko/20100115 SUSE/3.6.0-2.1 Firefox/3.6\"\n\n... DISPLAYS CORRECTLY.\nINVOKE THE 2nd APP ... RETURNS @ BROWSER:\n       \"An internal server error occurred. Please try again later.\"\n\n==> error_log <==\n[Wed Feb 24 08:39:11 2010] [warn] mod_fcgid: too much processes,\nplease increase FCGID_MAX_APPLICATION\n[Wed Feb 24 08:39:12 2010] [warn] mod_fcgid: too much processes,\nplease increase FCGID_MAX_APPLICATION\n[Wed Feb 24 08:39:13 2010] [warn] mod_fcgid: too much processes,\nplease increase FCGID_MAX_APPLICATION\n... etc ...", "id": 134863, "time": "2010-02-24T17:16:13Z", "bug_id": 48811, "creation_time": "2010-02-24T17:16:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 25061\nadd debug logging to help understand freelist issue", "is_private": false, "bug_id": 48811, "id": 134891, "time": "2010-02-25T17:18:38Z", "creator": "trawick@apache.org", "creation_time": "2010-02-25T17:18:38Z", "attachment_id": 25061}, {"count": 2, "tags": [], "bug_id": 48811, "text": "Please apply the attached patch, rebuild, and post log messages from mod_fcgid up through the point where trying to start the second application process fails.  \n\nsvn up before applying the patch in case one of the impacted files was changed for some other reason since you last updated.\n\nThanks!", "id": 134892, "time": "2010-02-25T17:19:43Z", "creator": "trawick@apache.org", "creation_time": "2010-02-25T17:19:43Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 48811, "is_private": false, "id": 134898, "creation_time": "2010-02-25T18:16:06Z", "time": "2010-02-25T18:16:06Z", "creator": "chrisd@apache.org", "text": "It sounds like Jeff is following up on this, but I wondered if by any chance I'd caused a regression with a recent change like r905820.  However, I'm not sure I really understand how to reproduce the problem yet ... is there a way to do it without Drupal, for example?  Maybe a simple set of configuration directives which demonstrate the issue?\n\nThe other thought I had was to find out what mod_status is reporting with respect to fcgid processes.  Not sure it'll help, but you never know.", "attachment_id": null}, {"count": 4, "tags": [], "text": "(In reply to comment #2)\n> Please apply the attached patch, rebuild, and post log messages from mod_fcgid\n> up through the point where trying to start the second application process\n> fails.  \n> \n> svn up before applying the patch in case one of the impacted files was changed\n> for some other reason since you last updated.\n> \n> Thanks!\n\nsvn up\nsvn info\n\tPath: .\n\tURL: http://svn.apache.org/repos/asf/httpd/mod_fcgid/trunk\n\tRepository Root: http://svn.apache.org/repos/asf\n\tRepository UUID: 13f79535-47bb-0310-9956-ffa450edef68\n\tRevision: 916374\n\tNode Kind: directory\n\tSchedule: normal\n\tLast Changed Author: chrisd\n\tLast Changed Rev: 909672\n\tLast Changed Date: 2010-02-12 16:49:29 -0800 (Fri, 12 Feb 2010)\n\napply patch\nrebuild, reinstall\n\ninit app1\ndisplays OK\n\n\n==> error_log <==\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(209): before searching for a free entry: first free entry: 4/b6ce3dc4\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 0 at 4 (b6ce3dc4)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 1 at 5 (b6ce4134)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2 at 6 (b6ce44a4)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 3 at 7 (b6ce4814)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2044 at 2048 (b6e9b004)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2045 at 2049 (b6e9b374)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2046 at 2050 (b6e9b6e4)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2047 at 2051 (b6e9ba54)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(227): total free entries: 2048\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(209): after obtaining a free entry: first free entry: 5/b6ce4134\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 0 at 5 (b6ce4134)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 1 at 6 (b6ce44a4)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2 at 7 (b6ce4814)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 3 at 8 (b6ce4b84)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2044 at 2049 (b6e9b374)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2045 at 2050 (b6e9b6e4)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2046 at 2051 (b6e9ba54)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(227): total free entries: 2047\n[Thu Feb 25 10:30:00 2010] [info] mod_fcgid: server pressflow6.site:/usr/bin/php-cgi5(2635) started\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(209): after successfully spawning: first free entry: 5/b6ce4134\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 0 at 5 (b6ce4134)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 1 at 6 (b6ce44a4)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2 at 7 (b6ce4814)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 3 at 8 (b6ce4b84)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2044 at 2049 (b6e9b374)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2045 at 2050 (b6e9b6e4)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(218): free node 2046 at 2051 (b6e9ba54)\n[Thu Feb 25 10:30:00 2010] [debug] fcgid_proctbl_unix.c(227): total free entries: 2047\n\ninit app2\ndisplays OK!? no browser error ...\n\n==> error_log <==\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(209): before searching for a free entry: first free entry: 5/b6ce4134\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 0 at 5 (b6ce4134)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 1 at 6 (b6ce44a4)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 2 at 7 (b6ce4814)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 3 at 8 (b6ce4b84)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 2044 at 2049 (b6e9b374)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 2045 at 2050 (b6e9b6e4)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 2046 at 2051 (b6e9ba54)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(227): total free entries: 2047\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(209): after obtaining a free entry: first free entry: 6/b6ce44a4\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 0 at 6 (b6ce44a4)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 1 at 7 (b6ce4814)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 2 at 8 (b6ce4b84)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 3 at 9 (b6ce4ef4)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 2044 at 2050 (b6e9b6e4)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 2045 at 2051 (b6e9ba54)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(227): total free entries: 2046\n[Thu Feb 25 10:31:59 2010] [info] mod_fcgid: server drupal6.site:/usr/bin/php-cgi5(2697) started\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(209): after successfully spawning: first free entry: 6/b6ce44a4\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 0 at 6 (b6ce44a4)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 1 at 7 (b6ce4814)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 2 at 8 (b6ce4b84)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 3 at 9 (b6ce4ef4)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 2044 at 2050 (b6e9b6e4)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(218): free node 2045 at 2051 (b6e9ba54)\n[Thu Feb 25 10:31:59 2010] [debug] fcgid_proctbl_unix.c(227): total free entries: 2046\n\nreboot\nreverse order -- app2, then app1.  same result, now - both display OK, no error msgs.\n\nconfusion?", "is_private": false, "id": 134900, "creation_time": "2010-02-25T18:38:45Z", "time": "2010-02-25T18:38:45Z", "creator": "pgnet.dev+apache@gmail.com", "bug_id": 48811, "attachment_id": null}, {"count": 5, "attachment_id": null, "bug_id": 48811, "is_private": false, "id": 134902, "time": "2010-02-25T19:03:44Z", "creator": "trawick@apache.org", "creation_time": "2010-02-25T19:03:44Z", "tags": [], "text": ">reboot\n>reverse order -- app2, then app1.  same result, now - both display OK, no error\n>msgs.\n\n>confusion?\n\nI suspect that the insertion of debug code has worked around some undesired code generation.\n\nHere's the crucial logic in modules/fcgid/fcgid_proctbl_unix.c to initialize the free list where I inserted some debug code:\n\n     ptmpnode = g_free_list_header;\n     for (i = 0; i < FCGID_MAX_APPLICATION; i++) {\n         ptmpnode->next_index = ptmpnode - g_proc_array + 1;\n+        if (i < 4 || (i + 4) >= FCGID_MAX_APPLICATION) {\n+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, main_server,\n+                         \"free node %d at %d (prev node %pp)\",\n+                         i, ptmpnode->next_index, ptmpnode);\n+        }\n         ptmpnode++;\n     }\n\nTry editing modules/fcgid/fcgid_proctbl_unix.c to disable just the inserted debug code there, compiling/installing, and trying the test again.  It should look something like\n\n     ptmpnode = g_free_list_header;\n     for (i = 0; i < FCGID_MAX_APPLICATION; i++) {\n         ptmpnode->next_index = ptmpnode - g_proc_array + 1;\n #if 0\n         if (i < 4 || (i + 4) >= FCGID_MAX_APPLICATION) {\n             ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, main_server,\n                          \"free node %d at %d (prev node %pp)\",\n                          i, ptmpnode->next_index, ptmpnode);\n         }\n #endif\n         ptmpnode++;\n     }\n\n\nIf that doesn't cause the bug to reappear, you'll probably need to try to remove one call to log_free_list() at a time until the bug reappears or you're back to the code in svn and/or we get really confused."}, {"attachment_id": null, "tags": [], "creator": "pgnet.dev+apache@gmail.com", "text": "(In reply to comment #3)\n> It sounds like Jeff is following up on this, but I wondered if by any chance\n> I'd caused a regression with a recent change like r905820.  However, I'm not\n> sure I really understand how to reproduce the problem yet ... is there a way to\n> do it without Drupal, for example?  Maybe a simple set of configuration\n> directives which demonstrate the issue?\n\nIn theory, sure.  Would be easier if I had a clue as to what FCGID_MAX_APPLICATION does, how it differs from other config options, and what the guidelines for its value are.  Just haven't gotten there yet ... \n\n> The other thought I had was to find out what mod_status is reporting with\n> respect to fcgid processes.  Not sure it'll help, but you never know.\n\nI'm for using a ouija board, atm :-/  read on ...\n\n(In reply to comment #5)\n> Try editing modules/fcgid/fcgid_proctbl_unix.c to disable just the inserted\n> debug code there ...\n\ndone.  rinse, repeat.\n\nno errors!?\n\n> If that doesn't cause the bug to reappear, you'll probably need to try to\n> remove one call to log_free_list() at a time until the bug reappears or you're\n> back to the code in svn\n\nreverted back to 'clean' svn code.\n\nagain, no errors! argh.\n\n> and/or we get really confused.\n\nok, so i'm there ... \n\natm, i'm guessing that perhaps the 20+ times I'd reproduced this across two boxes, and multiple reboots yesterday were just a local mirage :-/\n\ni am NOT convinced \"it\" went away.  of course, i'm not sure what \"it\" is ...", "count": 6, "id": 134904, "time": "2010-02-25T19:48:04Z", "bug_id": 48811, "creation_time": "2010-02-25T19:48:04Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 48811, "text": ">Would be easier if I had a clue as to what FCGID_MAX_APPLICATION does\n\nIt is the size of an internal table; it is a limit on the number of FastCGI application processes.\n\n>, how it differs from other config options\n\nThis one requires a source code change and recompile in order to the the value.\n\n>, and what the guidelines for its value are.  \n\nThe guideline is \"don't change it from the default\" :)  (It shouldn't need to be customized except for use on sites with thousands of active FastCGI application processes.)\n\nThe reason I've avoided discussing FCGID_MAX_APPLICATION is that misconfiguration of it is not the cause of mod_fcgid failing to create the second application process.\n\n>reverted back to 'clean' svn code.\n>again, no errors! argh.\n\nOkay, so it isn't reproducible at will :(  See if you can live with the debug code until it happens again.  If it shows a free list suddenly disappearing, I guess there's a memory overlay of the free list header.", "id": 134906, "time": "2010-02-25T19:58:59Z", "creator": "trawick@apache.org", "creation_time": "2010-02-25T19:58:59Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "trawick@apache.org", "is_private": false, "id": 136542, "attachment_id": null, "bug_id": 48811, "creation_time": "2010-04-29T16:58:39Z", "time": "2010-04-29T16:58:39Z", "text": "need the special debug logs when reproducing the problem, or some instructions on how we can reliably reproduce it"}, {"attachment_id": null, "tags": [], "creator": "trawick@apache.org", "text": "reopen if this can be reproduced with mod_fcgid 2.3.6 or higher", "count": 9, "id": 141893, "time": "2010-11-21T16:10:08Z", "bug_id": 48811, "creation_time": "2010-11-21T16:10:08Z", "is_private": false}]
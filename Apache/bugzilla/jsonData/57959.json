[{"count": 0, "tags": [], "bug_id": 57959, "attachment_id": null, "is_private": false, "id": 183139, "time": "2015-05-27T19:21:22Z", "creator": "achacha@hotmail.com", "creation_time": "2015-05-27T19:21:22Z", "text": "Tomcat 7 will deadlock when a log file is rotated.  This issue has been fixed in latest tomcat 6 and tomcat 8 but not in tomcat 7.\n\nThe issue is in following code (apache-tomcat-7.0.62-src/java/org/apache/juli/FileHandler.java:188)\n\n\n                } finally {\n                    writerLock.writeLock().unlock();\n                    // Down grade to read-lock. This ensures the writer remains valid\n                    // until the log message is written\n                    writerLock.readLock().lock();\n                }\n            }\n\n\nDespite the comment the order is wrong, you have to acquire a read lock then release write lock to make sure the race condition does not occur.\n\nThe correct way to do it is:\n\n                } finally {\n                    writerLock.readLock().lock();\n                    writerLock.writeLock().unlock();\n                }\n            }\n\nIn tomcat 6 (apache-tomcat-6.0.44-src/java/org/apache/juli/FileHandler.java:187) and tomcat 8 (apache-tomcat-8.0.22-src/java/org/apache/juli/FileHandler.java:186) the order is correct."}, {"count": 1, "text": "Thanks for the report.\nThe fix is provided for Tomcat 7 trunk and will be available with 7.0.63 onwards.\n\nRegards,\nVioleta", "creator": "violetagg@apache.org", "is_private": false, "id": 183153, "time": "2015-05-28T06:59:37Z", "bug_id": 57959, "creation_time": "2015-05-28T06:59:37Z", "tags": [], "attachment_id": null}]
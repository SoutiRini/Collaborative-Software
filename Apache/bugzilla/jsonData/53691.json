[{"attachment_id": 29207, "tags": [], "creator": "rra@blue-elephant-systems.com", "text": "Created attachment 29207\nSample Code\n\nI'm getting an error when opening a spreadsheet processed by POI in MS Excel \"Protected View Office has detected a problem with this file. Editing it may harm your computer\". \n\nThis happens whenever I try to use the HSSFWorkBook's cloneSheet method on a sheet that's using conditional formatting.\n\nPlease find sample code that reproduces this behaviour attached. This code opens the orig.xls, clones the first sheet and then saves to another file. The orig.xls consists of only 2 cells that have conditional formatting defined. When removing the conditional formatting, the cloning does not cause any problems.", "count": 0, "id": 161226, "time": "2012-08-10T11:18:06Z", "bug_id": 53691, "creation_time": "2012-08-10T11:18:06Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 53691, "is_private": false, "text": "Created attachment 29208\nOriginal sheet using conditional formatting", "id": 161227, "time": "2012-08-10T11:19:21Z", "creator": "rra@blue-elephant-systems.com", "creation_time": "2012-08-10T11:19:21Z", "attachment_id": 29208}, {"count": 2, "tags": [], "text": "Created attachment 29209\nExample output causing error in Excel", "is_private": false, "id": 161228, "creator": "rra@blue-elephant-systems.com", "time": "2012-08-10T11:20:01Z", "bug_id": 53691, "creation_time": "2012-08-10T11:20:01Z", "attachment_id": 29209}, {"count": 3, "tags": [], "creator": "superrubiroyd@gmail.com", "attachment_id": null, "is_private": false, "id": 161308, "time": "2012-08-12T19:08:02Z", "bug_id": 53691, "creation_time": "2012-08-12T19:08:02Z", "text": "Hi, I have checked your output file in MS Excel 2007. I have got no errors when I opened this file. Please, say what version of MS Excel you use.\n\nRegards, Evgeniy"}, {"count": 4, "tags": [], "text": "Hello, \n\nI'm using Excel 2010 Home and Business (Version 14.0.6112.5000, 32bit). \n\nI've tried on a Excel 2010 Starter editon as well which produces the same error.\n\nBest Regards\n Ralph", "is_private": false, "id": 161328, "creator": "rra@blue-elephant-systems.com", "time": "2012-08-13T08:48:49Z", "bug_id": 53691, "creation_time": "2012-08-13T08:48:49Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 53691, "is_private": false, "text": "I can confirm this problem with some additional info:\n\nI believe Excel does not alert you to this problem prior to Excel 2010 unless the following (Optional?) security update is installed: http://support.microsoft.com/kb/2501584\n\nYou can click through the error, and the conditional formatting still appears to work properly.\n\nThe issue is specifically with how copying conditional formatting is done, if you clone the sheet with conditional formatting, and then remove all conditional formatting on the cloned sheet using HSSFSheetConditionalFormatting.removeConditionalFormatting(int) before writing the result. The resulting spreadsheet does not cause any Excel alerts, and all other data is copied.\n\nThen, if you attempt to re-copy the conditional formatting using:\n\nHSSFSheetConditionalFormatting cf = sheet.getSheetConditionalFormatting();\nfor (int j = 0; j < scf.getNumConditionalFormattings(); j++) {\n    cf.addConditionalFormatting(scf.getConditionalFormattingAt(j));\n}\n\nThe error when loading the spreadsheet returns.\n\nTested on POI 3.7 3.8 and the latest binary nightly of 3.9beta1\n\nPossibly an issue with how the copy is done in addConditionalFormatting?\n\nDon't have this boiled down to a small test case yet, but can update with one if more test-cases are desired.\n\nThanks,\n--Corey", "id": 162458, "time": "2012-09-28T23:59:41Z", "creator": "corey@teffetalor.com", "creation_time": "2012-09-28T23:59:41Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "dominik.stadler@gmx.at", "is_private": false, "id": 175351, "time": "2014-05-20T14:03:16Z", "bug_id": 53691, "creation_time": "2014-05-20T14:03:16Z", "tags": [], "text": "I took some time to investigate this, still happens on latest trunk (post 3.10-FINAL).\n\nAfter some digging, I found the actual cause, unfortunately BiffViewer did not show details for exactly the one record that was the cause of the problem. \n\nAfter all it turned out to be a simple copy/paste error in CFRuleRecord that is easily fixed.\n\nSo this is finally fixed now via r1596251 together with some enhancements to toString() to make BiffViewer print out more information for these records."}]
[{"count": 0, "tags": [], "bug_id": 23709, "attachment_id": null, "id": 45320, "time": "2003-10-09T21:17:33Z", "creator": "mario.vansteenberghe@pandora.be", "creation_time": "2003-10-09T21:17:33Z", "is_private": false, "text": "Hi, \n\nI'm currently using the FOP library to build a Java print engine which\ntransforms Java AWT/Swing screens into HTML, SVG, PDF, etc... (see\nhttp://javauitransform.sf.net)\n\nWhen I render the following Fo input into SVG, I always get negative rect\nheights for fo:table-cells containing the fo:block element.\n\nI am relative new to this, but to what I've found, negative rect heights are to\nbe reported as an error (see SVG specs v1.0 page 196). Batik squiggle correctly\nreports this error as : \"The attribute 'height' of the element <rect> can not be\nnegative\"\n\nI've temporarily fixed this issue by using my own SVGRenderer and subclassing\nthe SVGUtilities class. I've replaced the SVGUtilities.createRect(...) method by\nSVGUtilities.createAbsoluteRect(...) which creates a rectangle with an absolute\nvalue for the height.\n\nThe following is an example input FO tree :\n\n--------------------------------------------------------------\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<fo:root xmlns:fo=\"http://www.w3.org/1999/XSL/Format\">\n<fo:layout-master-set>\n<fo:simple-page-master margin-right=\"0.5cm\" margin-left=\"0.5cm\"\nmargin-bottom=\"0.5cm\" margin-top=\"1cm\" master-name=\"page\" page-width=\"400pt\">\n<fo:region-body margin-bottom=\"1cm\" margin-top=\"1cm\"/>\n<fo:region-before extent=\"1cm\"/>\n<fo:region-after extent=\"1cm\"/>\n</fo:simple-page-master>\n</fo:layout-master-set>\n<fo:page-sequence master-reference=\"page\">\n<fo:flow flow-name=\"xsl-region-body\">\n<fo:block background-color=\"#ffffff\">\n<fo:table table-layout=\"fixed\" text-align=\"left\" border=\"0pt\">\n<fo:table-column column-number=\"1\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"2\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"3\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"4\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"5\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"6\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"7\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"8\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"9\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"10\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"11\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"12\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"13\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"14\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"15\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"16\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"17\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"18\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"19\" column-width=\"15pt\"/>\n<fo:table-body>\n<fo:table-row>\n<fo:table-cell height=\"20pt\" border=\"0pt\" column-number=\"1\"\nnumber-columns-spanned=\"18\">\n<fo:block background-color=\"#6464dc\">\n<fo:table table-layout=\"fixed\" text-align=\"left\" border=\"0pt\">\n<fo:table-column column-number=\"1\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"2\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"3\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"4\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"5\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"6\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"7\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"8\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"9\" column-width=\"15pt\"/>\n<fo:table-column column-number=\"10\" column-width=\"15pt\"/>\n<fo:table-body>\n<fo:table-row>\n<fo:table-cell height=\"15pt\" border=\"0pt\" column-number=\"1\"/>\n<fo:table-cell height=\"15pt\" border=\"0pt\" column-number=\"2\"/>\n<fo:table-cell height=\"15pt\" border=\"0pt\" column-number=\"3\"/>\n<fo:table-cell height=\"15pt\" border=\"0pt\" column-number=\"4\"/>\n<fo:table-cell height=\"15pt\" border=\"0pt\" column-number=\"5\"/>\n<fo:table-cell height=\"15pt\" border=\"0pt\" column-number=\"6\"/>\n<fo:table-cell height=\"15pt\" border=\"0pt\" column-number=\"7\"/>\n<fo:table-cell height=\"29pt\" border=\"0pt\" column-number=\"8\"\nnumber-columns-spanned=\"2\">\n<fo:block>07</fo:block>\n</fo:table-cell>\n</fo:table-row>\n</fo:table-body>\n</fo:table>\n</fo:block>\n</fo:table-cell>\n</fo:table-row>\n</fo:table-body>\n</fo:table>\n</fo:block>\n</fo:flow>\n</fo:page-sequence>\n</fo:root>\n\n--------------------------------------------------------------\n\nSVG output :\n\n--------------------------------------------------------------\n\n?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<svg contentScriptType=\"text/ecmascript\" width=\"400.0\"\n     xmlns:xlink=\"http://www.w3.org/1999/xlink\" zoomAndPan=\"magnify\"\n     contentStyleType=\"text/css\" height=\"792.0\"\n     preserveAspectRatio=\"xMidYMid meet\" xmlns=\"http://www.w3.org/2000/svg\"\n     version=\"1.0\">\n    <g id=\"Page-1\" style=\"font-family:sanserif;font-size:12\"\n       transform=\"translate(0,0.0)\">\n        <rect width=\"400.0\" x=\"0.0\" height=\"792.0\" y=\"0.0\"\n              style=\"fill:none;stroke:black\"/>\n        <rect width=\"371.654\" x=\"14.173\" height=\"-239.0\" y=\"56.692017\"\n              style=\"stroke:rgb(255,255,255);fill:rgb(255,255,255)\"/>\n        <rect width=\"270.0\" x=\"14.173\" height=\"-29.0\" y=\"266.69202\"\n              style=\"stroke:rgb(100,100,220);fill:rgb(100,100,220)\"/>\n        <text x=\"119.173\" y=\"276.89203\">\n            07\n        </text>\n        <a xlink:href=\"#svgView(viewBox(0, 0.0, 400, 792))\" xlink:type=\"simple\"\n           xlink:actuate=\"onRequest\" xlink:show=\"replace\"\n           xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n            <rect width=\"200.0\" x=\"0.0\" height=\"792.0\" y=\"0.0\"\n                  style=\"fill:blue;visibility:hidden\"/>\n        </a>\n    </g>\n</svg>\n\n--------------------------------------------------------------\n\n\nMany thanks for your support.\n\nKindest regards,\nMario Van Steenberghe (mario.vansteenberghe@pandora.be)"}, {"count": 1, "tags": [], "bug_id": 23709, "attachment_id": null, "text": "Mentioned problem is reproduced when rendering the FO document to SVG, although \nI receive two SVG rects of -29, instead of only one and then one of -239.\n\nDoes anyone know how xsl:fo is supposed to behave if the row-height is not \nexplicitly specified, and the respective heights of the table-cell vary in the \nsame row? ( I see a bunch of cells of 15pt, then suddenly one cell of 29pt? \nAlso, the first SVG rect is the same height as the whole SVG? Page-width isn't \nexplicitly specified - don't know if this could lead to unpredictable results.)\n\nTo the reporter: it's best to ask questions like these on the fop-user list. I \ndon't really know what your intention is, but it seems that fo:block-containers \nwould be more appropriate...", "id": 45381, "time": "2003-10-10T15:47:12Z", "creator": "adelmelle@apache.org", "creation_time": "2003-10-10T15:47:12Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 23709, "attachment_id": null, "text": "ERRATUM\n\nThat's 'page-height' not being explicitly specified in the FO...\n", "id": 45382, "time": "2003-10-10T15:53:12Z", "creator": "adelmelle@apache.org", "creation_time": "2003-10-10T15:53:12Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 23709, "attachment_id": null, "id": 75741, "time": "2005-06-01T17:10:23Z", "creator": "johnfleenor76@yahoo.com", "creation_time": "2005-06-01T17:10:23Z", "is_private": false, "text": "I have the same problem with placing backgrounds on cells.\n\nIn the org.apache.fop.render.AbstractRenderer:123  There is a negative h.  \nif (props.backColor.alpha() == 0) {\n            this.addFilledRect(x, y, w, -h, props.backColor);\n}\n\nI just for svg out put I placed a Math.abs(h) in \norg.apache.fop.render.svg.SVGRenderer:195.\n\nprotected void addRect(int x, int y, int w, int h, float r, float g,\n                           float b, float fr, float fg, float fb) {\n        Element rect = SVGUtilities.createRect(svgDocument, x / 1000f, \npageHeight - (y / 1000f), w / 1000f, Math.abs(h) / 1000f);\n        rect.setAttributeNS(null, \"style\", \"stroke:rgb(\" + ((int)(255 * r)) \n+ \",\" + ((int)(255 * g)) + \",\" + ((int)(255 * b)) + \");fill:rgb(\" + ((int)(255 \n* fr)) + \",\" + ((int)(255 * fg)) + \",\" + ((int)(255 * fb)) + \")\");\n        currentPageG.appendChild(rect);\n}\n\nI have not investagated what imapact changing the -h in the abstract renderer \nwould have on other implemenations of addRect.\n\nJohn Fleenor"}, {"count": 4, "tags": [], "bug_id": 23709, "attachment_id": null, "id": 110768, "time": "2007-11-20T00:43:17Z", "creator": "pascal.sancho@takoma.fr", "creation_time": "2007-11-20T00:43:17Z", "is_private": false, "text": "Fixed in FOP TRUNK rev 584703"}, {"count": 5, "tags": [], "bug_id": 23709, "attachment_id": null, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed", "id": 155902, "time": "2012-04-01T06:47:39Z", "creator": "gadams@apache.org", "creation_time": "2012-04-01T06:47:39Z", "is_private": false}]
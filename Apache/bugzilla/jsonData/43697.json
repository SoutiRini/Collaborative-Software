[{"count": 0, "tags": [], "bug_id": 43697, "attachment_id": null, "text": "the proxy which relay to internet gateway proxy gets DNS error in HTTPS\nconnection. apache 2.2.4 is OK.\n\ndirty fix is here.\n$ diff -u mod_proxy_connect.c.bak mod_proxy_connect.c\n--- mod_proxy_connect.c.bak     2007-09-03 02:42:59.000000000 +0900\n+++ mod_proxy_connect.c 2007-10-25 21:42:00.286125000 +0900\n@@ -124,7 +124,7 @@\n     /* do a DNS lookup for the destination host */\n     err = apr_sockaddr_info_get(&uri_addr, uri.hostname, APR_UNSPEC, uri.port,\n                                 0, p);\n-    if (APR_SUCCESS != err) {\n+    if ((APR_SUCCESS != err) && !proxyname) {\n         return ap_proxyerror(r, HTTP_BAD_GATEWAY,\n                              apr_pstrcat(p, \"DNS lookup failure for: \",\n                                          uri.hostname, NULL));", "id": 109729, "time": "2007-10-25T05:44:22Z", "creator": "nekomaho@gmail.com", "creation_time": "2007-10-25T05:44:22Z", "is_private": false}, {"count": 1, "text": "We need to have the IP address of the hostname to check if we block this host\nfrom proxying. This is also true if we use a remote proxy. Applying your patch\ncauses a segfault.", "bug_id": 43697, "attachment_id": null, "id": 109743, "time": "2007-10-25T11:59:08Z", "creator": "rpluem@apache.org", "creation_time": "2007-10-25T11:59:08Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 43697, "attachment_id": null, "text": "relaying proxy in intranet never resolve internet hostname, but must relay to\ninternet. so, need fix.\n\n$ diff -u mod_proxy_connect.c.bak mod_proxy_connect.c\n--- mod_proxy_connect.c.bak     2007-09-03 02:42:59.000000000 +0900\n+++ mod_proxy_connect.c 2007-10-26 23:22:52.504875000 +0900\n@@ -121,13 +121,15 @@\n     ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,\n          \"proxy: CONNECT: connecting %s to %s:%d\", url, uri.hostname, uri.port);\n\n-    /* do a DNS lookup for the destination host */\n-    err = apr_sockaddr_info_get(&uri_addr, uri.hostname, APR_UNSPEC, uri.port,\n-                                0, p);\n-    if (APR_SUCCESS != err) {\n-        return ap_proxyerror(r, HTTP_BAD_GATEWAY,\n-                             apr_pstrcat(p, \"DNS lookup failure for: \",\n-                                         uri.hostname, NULL));\n+    if (!proxyname || (conf->noproxies->nelts != 0)) {\n+        /* do a DNS lookup for the destination host */\n+        err = apr_sockaddr_info_get(&uri_addr, uri.hostname, APR_UNSPEC, uri.port,\n+                                    0, p);\n+        if ((APR_SUCCESS != err) && (!proxyname && )) {\n+            return ap_proxyerror(r, HTTP_BAD_GATEWAY,\n+                                 apr_pstrcat(p, \"DNS lookup failure for: \",\n+                                             uri.hostname, NULL));\n+        }\n     }\n\n     /* are we connecting directly, or via a proxy? */", "id": 109799, "time": "2007-10-26T07:27:25Z", "creator": "nekomaho@gmail.com", "creation_time": "2007-10-26T07:27:25Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43697, "text": "Could the fix that was originally proposed be reconsidered for inclusion? \n\nIt appears that the restriction to have the IP address in order to check if the host should be blocked from proxying is no longer in place (I'm guessing here so sorry if I'm wrong). \n\nWe also need the behaviour that was requested as we're trying to forward to another proxy server on a private network whose hostnames aren't resolvable.", "id": 148784, "time": "2011-08-23T13:25:37Z", "creator": "ramjisro@yahoo.com", "creation_time": "2011-08-23T13:25:37Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 43697, "is_private": false, "id": 148800, "attachment_id": 27431, "creator": "nekomaho@gmail.com", "creation_time": "2011-08-24T12:20:33Z", "time": "2011-08-24T12:20:33Z", "text": "Created attachment 27431\nmod_proxy_connect.c.patch"}, {"count": 5, "tags": [], "bug_id": 43697, "text": "I've fix the patch. Please confirm it.", "id": 148801, "attachment_id": null, "creator": "nekomaho@gmail.com", "creation_time": "2011-08-24T12:22:26Z", "time": "2011-08-24T12:22:26Z", "is_private": false}, {"count": 6, "text": "Why does this happen only in HTTPS and not in HTTP?\nThis is definitely not consistent.\nIsn't this a a more inherent problem?", "creator": "marc.stern@approach.be", "is_private": false, "id": 155167, "time": "2012-03-21T08:10:01Z", "bug_id": 43697, "creation_time": "2012-03-21T08:10:01Z", "tags": [], "attachment_id": null}, {"count": 7, "text": "Fixed on trunk in r1365001", "creator": "jorton@redhat.com", "attachment_id": null, "id": 160863, "time": "2012-07-24T13:04:37Z", "bug_id": 43697, "creation_time": "2012-07-24T13:04:37Z", "tags": [], "is_private": false}, {"count": 8, "text": "Applied slightly different in r1366693 to 2.4.x.\nReleased with 2.4.3.\nMight get ported back to 2.2.", "bug_id": 43697, "is_private": false, "id": 161583, "time": "2012-08-21T16:16:45Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-08-21T16:16:45Z", "tags": [], "attachment_id": null}]
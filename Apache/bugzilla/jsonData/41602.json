[{"count": 0, "text": "ant attributes do not appear to be thread safe with jython.  See the following \nscript for an example:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project basedir=\".\" default=\"main\" name=\"thread-test\">\n\n  <target name=\"main\">\n        <parallel failonany='false'>\n          <threadtest key=\"one\"></threadtest>\n          <threadtest key=\"two\"></threadtest>\n          <threadtest key=\"three\"></threadtest>\n          <threadtest key=\"four\"></threadtest>\n        </parallel>\n  </target>\n\n  <scriptdef name=\"threadtest\" language=\"jython\">\n       <attribute name=\"key\"/>\n<![CDATA[\nkey = attributes['key']\nproject.log(\"threadtest called with key: \" + key)\n]]>\n  </scriptdef>\n\n</project>", "bug_id": 41602, "attachment_id": null, "id": 99339, "time": "2007-02-13T12:45:43Z", "creator": "josborne@exstream.com", "creation_time": "2007-02-13T12:45:43Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "The script below prints every line one time in random order. I expanded the\nexample to print 100 lines, and every value occurs exactly 100 times in the\noutput, the output is mixed, which is what one should expect when executing 4\nscripts in parallel. Could you please indicate what you get as output and what\nyou would expect?", "attachment_id": null, "id": 99341, "creator": "jkf@apache.org", "time": "2007-02-13T14:39:43Z", "bug_id": 41602, "creation_time": "2007-02-13T14:39:43Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 41602, "text": "I find that a good way to go thread safety tests is through repetitive maths\nwork such as cumulative addition; some operation that only works if threads dont\ninterfere with each other. Then you can look at the result and say \"result as\nexpected\" or \"something went wrong\". It doesnt find the problem, especially once\nyou deploy RMI components across 12 machines, but it does at least indicate when\na problem exists. ", "id": 99364, "time": "2007-02-14T03:14:54Z", "creator": "stevel@apache.org", "creation_time": "2007-02-14T03:14:54Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 41602, "text": "the output that i get is as follows.  If i insert a delay in each task I do not \nget the errors.\n\nBuildfile: par4.xml\n\nmain:\nthreadtest called with key: four\n[threadtest] Traceback (innermost last):\n[threadtest]   File \"<string>\", line 4, in ?\n[threadtest] AttributeError: __getitem__\n[threadtest] Traceback (innermost last):\n[threadtest]   File \"<string>\", line 4, in ?\n[threadtest] AttributeError: __getitem__\n[threadtest] Traceback (innermost last):\n[threadtest]   File \"<string>\", line 4, in ?\n[threadtest] AttributeError: __getitem__\n\nBUILD FAILED\nC:\\Documents and Settings\\JOsborne\\sandbox\\Dialogue\\build\\scripts\\par4.xml:6: \nTraceback (innermost last):\n  File \"<string>\", line 4, in ?\nAttributeError: __getitem__\n\nTraceback (innermost last):\n  File \"<string>\", line 4, in ?\nAttributeError: __getitem__\n\nTraceback (innermost last):\n  File \"<string>\", line 4, in ?\nAttributeError: __getitem__\n\n\nTotal time: 0 seconds\n", "id": 99374, "time": "2007-02-14T06:19:58Z", "creator": "josborne@exstream.com", "creation_time": "2007-02-14T06:19:58Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 41602, "text": "This bug affects also Javascript.\n\nANT script:\n-----------\n\n<target name=\"t13\">\n    <parallel failonany='false'>\n        <t13.sd key=\"one\" />\n        <t13.sd key=\"two\" />\n        <t13.sd key=\"three\" />\n        <t13.sd key=\"four\" />\n    </parallel>\n</target>\n\n<scriptdef name=\"t13.sd\" language=\"javascript\">\n    <attribute name=\"key\" />\n    <![CDATA[\n    var key = attributes.get(\"key\");\n    project.log(\"threadtest called with key: \" + key);\n    ]]>\n</scriptdef>\n\nResults:\n--------\n\nthreadtest called with key: four\nthreadtest called with key: four\nthreadtest called with key: two\nthreadtest called with key: three\n\nComment on results:\n-------------------\n\nYou can see that execution 'four' of t13.sd overwrites the key parameter of execution 'one'.\n\nCause:\n------\n\nEach ScriptDef object as a single ScriptRunnerBase object. This runner is used by any ScriptDefBase pointing to the ScriptDef.\nWhen the same 'scripdef-ined' task is used inside a parallel task,  it creates a race condition where beans of a ScriptDefBase overwrites the beans of another ScriptDefBase .\n\nFix:\n----\n\nI'm not an expert of the ANT codebase, so I cannot suggest a proper fix.\nAnyway I have a quick an dirty patch that seems to fix the problem.", "id": 131827, "time": "2009-11-09T09:10:14Z", "creator": "valentino@miazzo.net", "creation_time": "2009-11-09T09:10:14Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "creator": "valentino@miazzo.net", "attachment_id": 24508, "text": "Created attachment 24508\nproposed path to Proposed patch to src\\main\\org\\apache\\tools\\ant\\taskdefs\\optional\\script\\ScriptDef.java\n\nPatched against ANT 1.7.1 official source distribution.", "id": 131829, "time": "2009-11-09T09:13:59Z", "bug_id": 41602, "creation_time": "2009-11-09T09:13:59Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 41602, "text": "Thanks!\n\nsvn revision 834354", "id": 131836, "time": "2009-11-09T21:29:50Z", "creator": "bodewig@apache.org", "creation_time": "2009-11-09T21:29:50Z", "is_private": false, "attachment_id": null}]
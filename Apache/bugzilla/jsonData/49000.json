[{"count": 0, "tags": [], "creator": "hyandell@amazon.com", "text": "Created attachment 25190\nCode patch that stops the loop parsing the final character if it's an equal sign\n\nCookie values such as the following don't get their last value parsed as an empty value.\n\n\ni.e. this does create a 'bob' cookie key:\n\nCookie: fred=1; jim=2; bob\n\nand this doesn't create a 'bob' cookie key:\n\nCookie: fred=1; jim=2; bob=", "id": 135683, "time": "2010-03-26T19:51:34Z", "bug_id": 49000, "creation_time": "2010-03-26T19:51:34Z", "is_private": false, "attachment_id": 25190}, {"count": 1, "tags": [], "bug_id": 49000, "attachment_id": 25191, "is_private": false, "id": 135684, "time": "2010-03-26T20:09:24Z", "creator": "hyandell@amazon.com", "creation_time": "2010-03-26T20:09:24Z", "text": "Created attachment 25191\nUnit test patch"}, {"count": 2, "tags": [], "creator": "markt@apache.org", "text": "Hmm. Neither of those two cookies are valid since both name and value are mandatory.\n\nTomcat 6 (and probably earlier) has allowed what is referred to in the code as name only cookies. I think this is another candidate for a cookie configuration option in Tomcat 7 (ALLOW_NAME_ONLY_COOKIES ?) that defaults to false and rejects these invalid cookies.\n\nIn terms of what this option does allow, since we are outside the spec, we can choose what we want to allow and disallow. I quite like the current allow 'name' but not 'name=' as the latter looks like an error whilst the first looks an attempt to have a name only cookie.", "id": 135877, "time": "2010-04-04T15:38:49Z", "bug_id": 49000, "creation_time": "2010-04-04T15:38:49Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 49000, "text": "I've definitely seen the appended = sign coming from IE6, IE7 and IE8 clients, both within the body of the Cookie text (where Tomcat handles things) and as the last value (where Tomcat drops the value). \n\nI don't know where Tomcat draws the line between spec beauty and browser reality; I agree with your comment if it's the former.", "id": 135885, "time": "2010-04-05T18:51:02Z", "creator": "hyandell@amazon.com", "creation_time": "2010-04-05T18:51:02Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 49000, "attachment_id": null, "id": 135886, "time": "2010-04-05T19:39:52Z", "creator": "markt@apache.org", "creation_time": "2010-04-05T19:39:52Z", "is_private": false, "text": "What are the use cases for these invalid cookies? What functionality are they supporting?"}, {"count": 5, "attachment_id": null, "bug_id": 49000, "text": "I don't know - I see them coming from IE in logs and, I'm assuming, it's IE deciding the format of how to send them. Use case - not something I can figure out.", "id": 135887, "time": "2010-04-05T19:54:35Z", "creator": "hyandell@amazon.com", "creation_time": "2010-04-05T19:54:35Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 49000, "attachment_id": null, "id": 142688, "time": "2010-12-14T14:40:12Z", "creator": "chris@christopherschultz.net", "creation_time": "2010-12-14T14:40:12Z", "is_private": false, "text": "Henri, what is the behavior of TC when these invalid cookies are received from a client?"}, {"count": 7, "tags": [], "bug_id": 49000, "text": "It doesn't create the last cookie value.", "id": 142695, "time": "2010-12-14T15:07:25Z", "creator": "hyandell@amazon.com", "creation_time": "2010-12-14T15:07:25Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 49000, "is_private": false, "text": "That seems like reasonable behavior to me. If there were some kind of exception or the request was not processed, I'd think this was a bug.\n\nIn this case, I believe Tomcat is spec-compliant.\n\nIf you can provide some research suggesting that this is a common MSIE phenomenon, I'll consider writing a patch for it.", "id": 142703, "time": "2010-12-14T15:59:30Z", "creator": "chris@christopherschultz.net", "creation_time": "2010-12-14T15:59:30Z", "attachment_id": null}, {"count": 9, "tags": [], "creator": "hyandell@amazon.com", "text": "I'm poorly explaining.\n\nTomcat is happy with all of the following:\n\nCookie: fred=1; jim=2; bob\nCookie: fred=1; jim=2; bob; george=3\nCookie: fred=1; jim=2; bob=; george=3\n\nIt isn't happy with:\n\nCookie: fred=1; jim=2; bob=\n\nLooking at logs, I can see that IE6, IE7 and IE8 all sends the bob= type entries. Generally this is fine, unless it's the last item in the semi-colon delimited list, in which case Tomcat drops the cookie entry.\n\nI agree with everything said - if name and value are mandatory then none of the above should be accepted. However, the current Tomcat functionality is such that 3/4 of the options are accepted and anyone relying on this is going to have a very confusing feature where IE traffic sporadically drops a cookie.", "id": 142709, "time": "2010-12-14T17:48:27Z", "bug_id": 49000, "creation_time": "2010-12-14T17:48:27Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "chris@christopherschultz.net", "text": "(In reply to comment #9)\n> Cookie: fred=1; jim=2; bob=; george=3\n\nTomcat is okay with that last one? Okay, then Tomcat is exhibiting inconsistent behavior, and this should be considered a bug.\n\n> Looking at logs, I can see that IE6, IE7 and IE8 all sends the bob= type\n> entries. Generally this is fine, unless it's the last item in the semi-colon\n> delimited list, in which case Tomcat drops the cookie entry.\n\nWould you agree that dropping the bob= cookie altogether no matter where it is in the list is expected, spec-compliant behavior?\n\n> I agree with everything said - if name and value are mandatory then none of the\n> above should be accepted. However, the current Tomcat functionality is such\n> that 3/4 of the options are accepted and anyone relying on this is going to\n> have a very confusing feature where IE traffic sporadically drops a cookie.\n\nAgreed.", "id": 142740, "time": "2010-12-15T09:56:49Z", "bug_id": 49000, "creation_time": "2010-12-15T09:56:49Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "hyandell@amazon.com", "text": "Yes, bob= is fine unless it's on the end of the line and then it's dropped (I just doublechecked with some unit tests as it's been a while since I was digging into this).\n\nI think there are three options:\n\n1) Spec purity. Drop 'key' and drop 'key='.\n2) Closer to the spec. Drop 'key=', keep 'key'.\n3) Backwards compat. Support 'key=' at end of line.\n\nI think that, ideally, it would be a case of TC7 being #1, while Mark's proposed ALLOW_NAME_ONLY_COOKIES feature would continue to support #3. I don't think there's a value in dropping 'key=' and keeping 'key'.", "id": 142754, "time": "2010-12-15T14:28:21Z", "bug_id": 49000, "creation_time": "2010-12-15T14:28:21Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "markt@apache.org", "text": "I've fixed the inconsistent handling. Name only cookies are currently always allowed. I do plan on adding an option to make accepting them configurable with a default of not accepting them.", "id": 143070, "time": "2011-01-04T13:29:19Z", "bug_id": 49000, "creation_time": "2011-01-04T13:29:19Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 49000, "attachment_id": null, "id": 143071, "creation_time": "2011-01-04T14:26:05Z", "time": "2011-01-04T14:26:05Z", "creator": "markt@apache.org", "text": "Option added in 7.0.x and will be in 7.0.6 onwards. I also added a note to the migration guide.", "is_private": false}]
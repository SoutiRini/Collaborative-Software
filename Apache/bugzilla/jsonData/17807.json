[{"count": 0, "attachment_id": null, "creator": "tilman.giese@gmx.de", "is_private": false, "id": 32720, "time": "2003-03-08T15:07:37Z", "bug_id": 17807, "creation_time": "2003-03-08T15:07:37Z", "tags": [], "text": "After running ./build.sh test, I get the following error message:\n\nTestsuite: org.apache.tools.ant.taskdefs.optional.ANTLRTest\nTests run: 13, Failures: 0, Errors: 8, Time elapsed: 63,593 sec\n\nTestcase: test3(org.apache.tools.ant.taskdefs.optional.ANTLRTest):\tCaused an ERROR\nANTLR returned: 1\nfile:///home/work/java/projects/jakarta/jakarta-ant/src/etc/testcases/taskdefs/optional/antlr/antlr.xml:18:\nANTLR returned: 1\n\tat org.apache.tools.ant.taskdefs.optional.ANTLR.execute(ANTLR.java:276)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:227)\n\tat org.apache.tools.ant.Task.perform(Task.java:388)\n\tat org.apache.tools.ant.Target.execute(Target.java:309)\n\tat org.apache.tools.ant.Target.performTasks(Target.java:336)\n\tat org.apache.tools.ant.Project.executeTarget(Project.java:1394)\n\tat org.apache.tools.ant.BuildFileTest.executeTarget(BuildFileTest.java:265)\n\tat org.apache.tools.ant.taskdefs.optional.ANTLRTest.test3(ANTLRTest.java:98)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat junit.framework.TestCase.runTest(TestCase.java:154)\n\tat junit.framework.TestCase.runBare(TestCase.java:127)\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\n\tat junit.framework.TestResult.run(TestResult.java:109)\n\tat junit.framework.TestCase.run(TestCase.java:118)\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\n\tat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:323)\n\tat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTask.executeInVM(JUnitTask.java:861)\n\tat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTask.execute(JUnitTask.java:552)\n\tat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTask.execute(JUnitTask.java:528)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:227)\n\tat org.apache.tools.ant.Task.perform(Task.java:388)\n\tat org.apache.tools.ant.Target.execute(Target.java:309)\n\tat org.apache.tools.ant.Target.performTasks(Target.java:336)\n\tat org.apache.tools.ant.Project.executeTarget(Project.java:1394)\n\tat org.apache.tools.ant.Project.executeTargets(Project.java:1268)\n\tat org.apache.tools.ant.Main.runBuild(Main.java:611)\n\tat org.apache.tools.ant.Main.start(Main.java:198)\n\tat org.apache.tools.ant.Main.main(Main.java:245)\n\nI am currently using antlr 2.7.1 and have not yet tested 2.7.2."}, {"count": 1, "tags": [], "bug_id": 17807, "is_private": false, "id": 32735, "creation_time": "2003-03-09T10:06:24Z", "time": "2003-03-09T10:06:24Z", "creator": "levylambert@tiscali-dsl.de", "text": "I have tried the same test with antlr 2.7.2 and I get errors in the following \ntests : test4, test6 and test9\n\n\nEnvironment : ant CVS Head, Windows 2000\n\n\nThe stack at failure point is the same as the one reported by Tilman Giese\n\n\n", "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "levylambert@tiscali-dsl.de", "is_private": false, "id": 32740, "time": "2003-03-09T17:47:09Z", "bug_id": 17807, "creation_time": "2003-03-09T17:47:09Z", "tags": [], "text": "ANTLRTest.java says that an antlrall.jar is needed and should be built with a \nmkalljar script.\n\n\n\n\nIn antlr2.7.2 I cannot find the script mkalljar\n\n\n\n\nIt looks possible to produce the antlrall.jar with the Makefile of antlr.\n\n\nDoing this under cygwin, there are two problems which I need to report to the \nantlr maintainers.\n"}, {"attachment_id": null, "tags": [], "creator": "levylambert@tiscali-dsl.de", "text": "After a fight with make (of antlr) and with vanishing java files :-( I managed \nto get an antlrall.jar\n\n\nNow I get a different picture.\n\n\nOnly the test10 fails with this result :\n\n\nTestcase: test10 took 0,691 sec\n\n\n\n\n\tFAILED\n\n\n\n\nexpected:<1> but was:<2>\n\n\n\n\nI do not know yet what this means\n\n\n", "count": 3, "id": 32742, "time": "2003-03-09T20:35:17Z", "bug_id": 17807, "creation_time": "2003-03-09T20:35:17Z", "is_private": false}, {"count": 4, "tags": [], "creator": "levylambert@tiscali-dsl.de", "attachment_id": null, "text": "Actually, the two files generated by antlr in test10 are CalcTreeWalker.html and \nCalcParser.html. Strangely, when I run this test10 without junit, I only obtain \nCalcParser.html (which would make the test successful). CalcParser and \nCalcTreeWalker are class names in the file antlr.g, the grammar file used in \ntest10. \n", "id": 32743, "time": "2003-03-09T21:32:26Z", "bug_id": 17807, "creation_time": "2003-03-09T21:32:26Z", "is_private": false}, {"count": 5, "tags": [], "creator": "levylambert@tiscali-dsl.de", "attachment_id": 5242, "text": "Created attachment 5242\npatch for the antlr testcase", "id": 32847, "time": "2003-03-10T11:55:11Z", "bug_id": 17807, "creation_time": "2003-03-10T11:55:11Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 17807, "text": "Created attachment 5243\nthe same patch in a jar file because bugzilla killed my carriage returns", "id": 32848, "time": "2003-03-10T12:01:06Z", "creator": "levylambert@tiscali-dsl.de", "creation_time": "2003-03-10T12:01:06Z", "is_private": false, "attachment_id": 5243}, {"count": 7, "attachment_id": null, "creator": "bodewig@apache.org", "is_private": false, "id": 34230, "time": "2003-04-01T11:05:42Z", "bug_id": 17807, "creation_time": "2003-04-01T11:05:42Z", "tags": [], "text": "If you use \"./configure; make antlrall.jar\" on Unix for ANTLR 2.7.2, things work\nexcept for test10.\n\nI've now fixed test10 but broken test8 (by showing that it doesn't work, at least\nnot for ANTL 2.7.2). "}, {"count": 8, "tags": [], "bug_id": 17807, "text": "Should have been \"make antlr-all.jar\" and use the resulting antlrall.jar, sorry.", "id": 34231, "time": "2003-04-01T11:06:29Z", "creator": "bodewig@apache.org", "creation_time": "2003-04-01T11:06:29Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "For 2.7.1, Tilman, have you followed the comments at the top of the testcase?\n\n", "id": 34232, "time": "2003-04-01T11:08:02Z", "bug_id": 17807, "creation_time": "2003-04-01T11:08:02Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 17807, "text": "I followed the instructions in the testcase and built the antlrall.jar using\nmkalljar and put the antlrall.jar in the classpath. Nevertheless, even with the\nnew testcase test3 still fails with the same error message as weel as ANTLR\n2.7.2 does after using ./configure; make antlrall.jar.", "id": 34238, "time": "2003-04-01T13:33:03Z", "creator": "tilman.giese@gmx.de", "creation_time": "2003-04-01T13:33:03Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 17807, "is_private": false, "id": 34253, "creation_time": "2003-04-01T15:44:15Z", "time": "2003-04-01T15:44:15Z", "creator": "bodewig@apache.org", "text": "With 2.7.2 all tests should pass now (CVS HEAD, that is).\n\nCan you run the test3 target in src/etc/testcases/taskdefs/optional/antlr/antlr.xml\ndirectly (without JUnit in between) and see whether it generates any useful\noutput (maybe throwing in -verbose or *shudder* even -debug)?", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 17807, "text": "It looks like a classpath issue. Apart from antlrall.jar I had a checkstyle.jar\nin the classpath. However, checkstyle includes some of the antlr files, but not\nall. That's why I get a ClassNotFoundException on ANTLRGrammarBehavior. -verbose\nsays that only checkstyle.jar is in the classpath when exeuting antlr. If I\nchange the order and place antlrall.jar before checkstyle.jar test3 works\nwithout any problems.", "id": 34257, "time": "2003-04-01T16:16:56Z", "creator": "tilman.giese@gmx.de", "creation_time": "2003-04-01T16:16:56Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "bodewig@apache.org", "text": "I see.\n\n<antlr> tries to be smart and implicitly adds the jar that it has loaded antl.Tool\nfrom to the CLASSPATH - in your case this has been checkstyle.jar.\n\nCould you check for a class that is in antlrall.jar but not in checkstyle.jar?\nWe could use that one instead.\n\nYou can use a nested <classpath> containing antlrall.jar as a workaround.", "count": 13, "id": 34325, "time": "2003-04-02T12:52:52Z", "bug_id": 17807, "creation_time": "2003-04-02T12:52:52Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 17807, "text": "The case is that the latest version of checkstyle includes the whole antlr.jar\ninto checkstyle.jar so that the antlr testcases work. It seems that older\nversions did not include all files which are necessary to run antlr properly. So\nmaybe we should change antlr.Tool to antlr.ANTLRGrammarParseBehavior which is\nthe class that caused the ClassNotFoundException in my case. This should ensure\nthat for older versions of checkstyle, antlrall.jar is added to the classpath.\nHowever, if you use a new version of checkstyle, checkstyle.jar will be included\nand will work properly. Maybe we should mention that in the docs. ", "id": 34338, "time": "2003-04-02T14:20:04Z", "creator": "tilman.giese@gmx.de", "creation_time": "2003-04-02T14:20:04Z", "is_private": false, "attachment_id": null}, {"count": 15, "attachment_id": null, "creator": "bodewig@apache.org", "is_private": false, "id": 34340, "time": "2003-04-02T14:30:18Z", "bug_id": 17807, "creation_time": "2003-04-02T14:30:18Z", "tags": [], "text": "The manual for the task already contained information about antlrall.jar, I've\nnow updated it to talk about the difference between 2.7.1 and 2.7.2.\n\nCVS HEAD (and thus Ant 1.6 and nightly build 2003-04-03) will use\nantlr.ANTLRGrammarParseBehavior \n\nThanks, I think we can close this report now."}, {"count": 16, "attachment_id": null, "creator": "tilman.giese@gmx.de", "is_private": false, "id": 34344, "time": "2003-04-02T15:03:38Z", "bug_id": 17807, "creation_time": "2003-04-02T15:03:38Z", "tags": [], "text": "Unfortunatley not. Because test8 expects \"Invalid super grammar file\", but antlr\n2.7.2 actually returns \"file non-existant-file.g not found\""}, {"count": 17, "attachment_id": null, "creator": "bodewig@apache.org", "is_private": false, "id": 34353, "time": "2003-04-02T15:40:34Z", "bug_id": 17807, "creation_time": "2003-04-02T15:40:34Z", "tags": [], "text": "Are you using CVS HEAD of testcase, test build file and the task? It works for me.\n\ntest8 expects a BuildException, because of \"Invalid super grammar file\", but\nit doesn't look into the exception message or the log at all.\n\nIt is a call to expectBuildException, not expectSpecificBuildException."}, {"count": 18, "attachment_id": null, "creator": "tilman.giese@gmx.de", "is_private": false, "id": 34355, "time": "2003-04-02T15:49:50Z", "bug_id": 17807, "creation_time": "2003-04-02T15:49:50Z", "tags": [], "text": "Using CVS HEAD, I get the following:\n\nTestcase: test1 took 0,725 sec\nTestcase: test2 took 0,36 sec\nTestcase: test3 took 14,605 sec\nTestcase: test4 took 33,084 sec\nTestcase: test5 took 7,85 sec\nTestcase: test6 took 31,869 sec\nTestcase: test7 took 0,188 sec\nTestcase: test8 took 4,979 sec\n\tFAILED\nShould throw BuildException because: Invalid super grammar file\njunit.framework.AssertionFailedError: Should throw BuildException because:\nInvalid super grammar file\n\tat junit.framework.Assert.fail(Assert.java:47)\n\tat\norg.apache.tools.ant.BuildFileTest.expectSpecificBuildException(BuildFileTest.java:310)\n\tat org.apache.tools.ant.BuildFileTest.expectBuildException(BuildFileTest.java:99)\n\tat org.apache.tools.ant.taskdefs.optional.ANTLRTest.test8(ANTLRTest.java:126)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat junit.framework.TestCase.runTest(TestCase.java:154)\n\tat junit.framework.TestCase.runBare(TestCase.java:127)\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\n\tat junit.framework.TestResult.run(TestResult.java:109)\n\tat junit.framework.TestCase.run(TestCase.java:118)\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\n\tat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:323)\n\tat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTask.executeInVM(JUnitTask.java:861)\n\tat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTask.execute(JUnitTask.java:552)\n\tat\norg.apache.tools.ant.taskdefs.optional.junit.JUnitTask.execute(JUnitTask.java:528)\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:227)\n\tat org.apache.tools.ant.Task.perform(Task.java:388)\n\tat org.apache.tools.ant.Target.execute(Target.java:309)\n\tat org.apache.tools.ant.Target.performTasks(Target.java:336)\n\tat org.apache.tools.ant.Project.executeTarget(Project.java:1394)\n\tat org.apache.tools.ant.Project.executeTargets(Project.java:1268)\n\tat org.apache.tools.ant.Main.runBuild(Main.java:611)\n\tat org.apache.tools.ant.Main.start(Main.java:198)\n\tat org.apache.tools.ant.Main.main(Main.java:245)\n\nTestcase: test8\n"}, {"count": 19, "attachment_id": null, "creator": "bodewig@apache.org", "is_private": false, "id": 34403, "time": "2003-04-03T07:16:52Z", "bug_id": 17807, "creation_time": "2003-04-03T07:16:52Z", "tags": [], "text": "So test8 fails for you because there ain't no exception at all.\n\nAgain, is this CVS HEAD?  Are you absolutely sure 8-)  You may need to bootstrap\nAnt.  What you see is supposed to be fixed with revision 1.21 of ANTLR.java."}, {"count": 20, "tags": [], "creator": "tilman.giese@gmx.de", "attachment_id": null, "text": "Sorry, it was my fault. After bootstrapping again, the testcase passed.", "id": 34439, "time": "2003-04-03T14:15:36Z", "bug_id": 17807, "creation_time": "2003-04-03T14:15:36Z", "is_private": false}]
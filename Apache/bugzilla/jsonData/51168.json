[{"count": 0, "tags": [], "text": "Created attachment 26969\npatch scoreboard.c to use final served response size\n\nI've just noticed that when a request is rewrited by mod_rewrite, its\ntraffic won't be accounted into \"Total Traffic\" by mod_status.\n\nI'm using Apache/2.0.63 on freebsd (stock ports), experiments are\npreformed in the following way:\n\ndd if=/dev/urandom of=10m_file bs=1048576 count=10\ncat > .htaccess\nRewriteEngine On\nRewriteRule ^10m_rw$ 10_file\n^D\n\ncurl -v 'http://192.168.1.1/server-status?auto'  # take a note of\nTotal kBytes field\ncurl -v 'http://192.168.1.1/10m_file' -o 10m_tmp\ncurl -v 'http://192.168.1.1/server-status?auto'  # Total kBytes field\ndo increment about ~10MB\ncurl -v 'http://192.168.1.1/10m_rw' -o 10m_tmp\ncurl -v 'http://192.168.1.1/server-status?auto'  # Total kBytes field\nonly increases a few hundred kB's\n\nI've found the problem is that when scoreboard.c incrementing counters it won't check if the request is being redirected, thus ignoring the new request_rec struct chain pointed by 'next' field. It always use the original request_rec for bytes_sent accounting, which is potentially wrong.\n\nThe patch applied will make scoreboard.c use bytes_sent of final served response as the increment value.", "is_private": false, "bug_id": 51168, "id": 146186, "time": "2011-05-08T05:00:40Z", "creator": "tiberius.teng@gmail.com", "creation_time": "2011-05-08T05:00:40Z", "attachment_id": 26969}]
[{"count": 0, "tags": [], "bug_id": 44623, "attachment_id": null, "id": 114701, "time": "2008-03-18T05:08:04Z", "creator": "kostromin@gmail.com", "creation_time": "2008-03-18T05:08:04Z", "is_private": false, "text": "The client's Accept-Encoding header data is not visible until/unless server sends Content-Encoding header. \nWhen any (even empty) Content-Encoding was sent, Accept-Encoding becomes visible on the next request session.\nI.e. you simply don't know accepted encodings until the second session.\n\nIt makes it impossible to send gzips for single-page requests.\nSites with gzipped cache waste resources decompressing it for single-page requests. Even when they should't.\n\nVerification:\n<?\nheader('Content-Encoding: text/html');\necho $_SERVER['HTTP_ACCEPT_ENCODING'];\n// 1st req - n/a, 2nd - available\n?>\n\nIf you don't believe PHP (despite that it gets all Apache header data properly),\nyou can check Apache HTTP:Accept-Encoding directly. It's empty.\n\n---\nApache 2.2.6\nTested on: Debian, CentOS, FreeBSD"}, {"count": 1, "tags": [], "bug_id": 44623, "attachment_id": null, "id": 114703, "time": "2008-03-18T06:43:19Z", "creator": "nick@webthing.com", "creation_time": "2008-03-18T06:43:19Z", "is_private": false, "text": "That's nonsensical.  In HTTP (and hence in Apache) there's no notion of \"1st request\".  What apache gets is what your browser sends.  Something else in your toolchain is causing what you see."}, {"count": 2, "tags": [], "bug_id": 44623, "text": "\n> there's no notion of \"1st request\"\n\nClient sends: 'Accept-Encoding: gzip,deflate' (1)\nApache sees:  ''\nClient sends: 'Accept-Encoding: gzip,deflate' (2)\nApache sees:  'Accept-Encoding: gzip,deflate'\n\nClients (gecko, msie, opera) headers were verified with sniffer.\nApache checked with %{HTTP:Accept-Encoding} and $_SERVER['HTTP_ACCEPT_ENCODING'].\n\n1st time always empty.\nI can't believe it my local toolchain curse as it was verified on 4 differently configured servers.\n\nI am also well aware that a term such as '1st request' makes little sense protocol-wise.\n\nCan you please confirm that\n<?php echo $_SERVER['HTTP_ACCEPT_ENCODING']?> \nwithout other output shows the header?", "id": 114706, "time": "2008-03-18T07:36:59Z", "creator": "kostromin@gmail.com", "creation_time": "2008-03-18T07:36:59Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "(In reply to comment #2)\nOr (if not trust to php) using your gzip-supported client:\n\nRewriteCond %{HTTP:Accept-Encoding} gzip\nRewriteCond ^(.*)$ http://apache.org/ [L]\nRewriteCond %{HTTP:Accept-Encoding} !gzip\nRewriteRule ^(.*)$ https://issues.apache.org/ [L]\n\n\n", "is_private": false, "bug_id": 44623, "id": 114707, "time": "2008-03-18T07:45:55Z", "creator": "kostromin@gmail.com", "creation_time": "2008-03-18T07:45:55Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Ignore the above. False.\nProxy issues and lack of sleep. Sorry.", "is_private": false, "bug_id": 44623, "id": 114708, "time": "2008-03-18T08:05:56Z", "creator": "kostromin@gmail.com", "creation_time": "2008-03-18T08:05:56Z", "attachment_id": null}]
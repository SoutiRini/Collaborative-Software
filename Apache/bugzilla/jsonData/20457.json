[{"count": 0, "tags": [], "bug_id": 20457, "attachment_id": null, "id": 38283, "time": "2003-06-03T18:12:07Z", "creator": "douglas_reith@yahoo.com.au", "creation_time": "2003-06-03T18:12:07Z", "is_private": false, "text": "(Apologies if duplicate - couldn't find it)\n\nI am starting an Ant build on Sun Solaris which eventually connects to a Visual \nAge workbench running on a Windows 2000 PC using the optional task vajexport.\nThe servlet URL that it creates is incorrect because the destination directory \n(destdir) attribute has the UNIX user.dir appended to the front like so:\n\nhttp://vajhost:2525/servlet/vajexport?\ndeb=false&owr=true&dir=/ant_files/tmp/C:/temp&cls=true&res=true&src=false&dex=tr\nue&include=SystemProj/com/world/hello\n\nHere the problem is: dir=/ant_files/tmp/C:/temp\nWhere it should just be: dir=C:/temp\n\nI tried to replicate on Windows but the error did not appear (could be a \ndifference in Java versions as well).\n\nI tracked it down to this method:\norg.apache.tools.ant.taskdefs.optional.ide\nVAJRemoteUtil.assembleImportExportParams(..blah..)\n\nAnd this line:\nString result =\n            VAJToolsServlet.DIR_PARAM + \"=\"\n            + dir.getAbsolutePath().replace('\\\\', '/') ...etc\n\nWhich I changed to:\nString result =\n            VAJToolsServlet.DIR_PARAM + \"=\"\n            + dir.getPath().replace('\\\\', '/') ...etc\n\nThat is, I've changed the getAbsolutePath() to getPath() after reading the Java \nAPI which states for getAbsolutePath() that:\n\"On UNIX systems, a relative pathname is made absolute by resolving it against \nthe current user directory.\"\n\nNow this fix is obviously a bit of a quick one.. not necessarily the right one.\n\nHere are the UNIX environment details (I've removed sections that are not \nimportant and/or sensitive):\n------- Ant diagnostics report -------\nApache Ant version 1.5.3 compiled on April 16 2003\n\n-------------------------------------------\n Implementation Version (JDK1.2+ only)\n-------------------------------------------\ncore tasks     : 1.5.3\noptional tasks : 1.5.3\n\n-------------------------------------------\n ANT_HOME/lib jar listing\n-------------------------------------------\nant.jar (737884 bytes)\nxml-apis.jar (108484 bytes)\nxercesImpl.jar (885250 bytes)\noptional.jar (671546 bytes)\n\n-------------------------------------------\n System properties\n-------------------------------------------\njava.runtime.name : Java(TM) 2 Runtime Environment, Standard Edition\njava.vm.version : 1.3.0_04\njava.vm.vendor : Sun Microsystems Inc.\njava.vm.name : Java HotSpot(TM) Client VM\nfile.encoding.pkg : sun.io\njava.vm.specification.name : Java Virtual Machine Specification\nuser.dir : /ant_files/tmp\njava.runtime.version : 1.3.0_04\nos.version : 5.8\n\nThanks for your time.\n\nP.S. Spent time solving remote feature problems (import statements, resource \nfiles)... and THEN found bug 10016... should have looked here first!"}, {"count": 1, "tags": [], "bug_id": 20457, "attachment_id": null, "text": "I have had a look at the code.\nI wonder whether the destDir attribute of VAJExport should not be a string, \nrather than a file anyway, because it is or can be a remote location on a server \n?\nOne possibility would be to create a new attribute in VAJExport, which would be \nof string type, and would supersede destDir if it is defined.\n\ndestDir would be marked as deprecated.\n\nThe alternative would be simply to change the type of destDir to String. It \nwould make in the long run cleaner code.", "id": 38332, "time": "2003-06-04T11:01:09Z", "creator": "levylambert@tiscali-dsl.de", "creation_time": "2003-06-04T11:01:09Z", "is_private": false}, {"count": 2, "tags": [], "text": "I agree Antoine,\nCan't really see the advantage of having it as a File object because you will \nalways have to convert it to the URL string. Even if the VAJ service was local \nyou'd still need to connect via the servlet (?)\nVAJExport requires a file because it does the actualy work, but then it is on \nthe remote host...\n", "attachment_id": null, "id": 38418, "creator": "douglas_reith@yahoo.com.au", "time": "2003-06-05T10:05:33Z", "bug_id": 20457, "creation_time": "2003-06-05T10:05:33Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 20457, "text": "Do you think it is OK to change destDir from File to String ?\nImpact:\n the VAJUtil interface\n   void exportPackages(\n        File dest,\n        String[] includePatterns, String[] excludePatterns,\n        boolean exportClasses, boolean exportDebugInfo,\n        boolean exportResources, boolean exportSources,\n        boolean useDefaultExcludes, boolean overwrite);\nwould become\n       void exportPackages(\n        String dest,\n        String[] includePatterns, String[] excludePatterns,\n        boolean exportClasses, boolean exportDebugInfo,\n        boolean exportResources, boolean exportSources,\n        boolean useDefaultExcludes, boolean overwrite);\nthis procedure is called from VAJExport and VAJExportServlet,\nand implemented in VAJLocalUtil and VAJRemoteUtil", "id": 38419, "time": "2003-06-05T11:04:04Z", "creator": "levylambert@tiscali-dsl.de", "creation_time": "2003-06-05T11:04:04Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "I have shied away from changing too much in the VAJ classes, without knowing \nVAJ. So in the end I have just committed your proposed one-liner.\n\nAnd this line:\nString result =\n            VAJToolsServlet.DIR_PARAM + \"=\"\n            + dir.getAbsolutePath().replace('\\\\', '/') ...etc\nWhich I changed to:\nString result =\n            VAJToolsServlet.DIR_PARAM + \"=\"\n            + dir.getPath().replace('\\\\', '/') ...etc\n", "attachment_id": null, "id": 39120, "creator": "levylambert@tiscali-dsl.de", "time": "2003-06-19T21:29:40Z", "bug_id": 20457, "creation_time": "2003-06-19T21:29:40Z", "is_private": false}]
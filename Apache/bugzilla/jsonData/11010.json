[{"count": 0, "tags": [], "bug_id": 11010, "attachment_id": null, "text": "I have found that if I create one Excel sheet without any data and then try to \nread it with eventmodel. It failes.\n\nThe MS Excel opening the file correctly.", "id": 19898, "time": "2002-07-20T22:40:01Z", "creator": "sergeikozello@mail.ru", "creation_time": "2002-07-20T22:40:01Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 2427\nThe XLS file with Unicode sheet name, its creator and reader. All in one ZIP.", "is_private": false, "id": 19919, "creator": "sergeikozello@mail.ru", "time": "2002-07-21T10:57:38Z", "bug_id": 11010, "creation_time": "2002-07-21T10:57:38Z", "attachment_id": 2427}, {"count": 2, "tags": [], "text": "Here is stack from the reader attached above:\n\norg.apache.poi.hssf.record.RecordFormatException: Error reading bytes\n\tat org.apache.poi.hssf.eventmodel.HSSFEventFactory.genericProcessEvents\n(HSSFEventFactory.java:241)\n\tat org.apache.poi.hssf.eventmodel.HSSFEventFactory.processEvents\n(HSSFEventFactory.java:139)\n\tat ExcelReadingTest.main(ExcelReadingTest.java:111)\nException in thread \"main\" ", "attachment_id": null, "id": 19920, "creator": "sergeikozello@mail.ru", "time": "2002-07-21T10:59:32Z", "bug_id": 11010, "creation_time": "2002-07-21T10:59:32Z", "is_private": false}, {"count": 3, "tags": [], "creator": "poi-support@buni.org", "is_private": false, "id": 19922, "attachment_id": null, "bug_id": 11010, "creation_time": "2002-07-21T13:10:18Z", "time": "2002-07-21T13:10:18Z", "text": "This is bad.  This is happening when its trying to get 2 more bytes.  This\nprobably means that BoundSheetRecord is returning a bogus size and we're trying\nto read past the end of the \"Workbook\" stream."}, {"count": 4, "tags": [], "creator": "poi-support@buni.org", "attachment_id": null, "id": 19927, "time": "2002-07-21T13:21:25Z", "bug_id": 11010, "creation_time": "2002-07-21T13:21:25Z", "is_private": false, "text": "One more interesting note, if I open this in Excel then save it back, POI can\nread it.  It also grows to about 14k.  "}, {"text": "(from about 6k)\n", "tags": [], "bug_id": 11010, "is_private": false, "count": 5, "id": 19928, "time": "2002-07-21T13:21:44Z", "creator": "poi-support@buni.org", "creation_time": "2002-07-21T13:21:44Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "just checked...this now happens with *any* workbook created by HSSF (I ran the\n\"org.apache.poi.hssf.dev.HSSF output.xls write\" target and got the same\nproblem!).  They are all openable by both BiffViewer and Excel but not the event\napi.  I can't look into this further right now, perhaps someone can take a\ngander and figure out what is being done differently.  Also check to figure out\nwhether this problem exists in 1.5.x (I don't think it does).\n\nMost likely candidates:\n\nGlen's SSTRecord stuff\nSergi's unicode stuff\n\nWhy?  These most dramatically affect record size calculations (not that the\neffects need to be dramatic) and have modes of operation that change how size is\ncalculated depending on how they're called.\n\nThats my best guess at the moment.", "attachment_id": null, "id": 19929, "creator": "poi-support@buni.org", "time": "2002-07-21T13:42:47Z", "bug_id": 11010, "creation_time": "2002-07-21T13:42:47Z", "is_private": false}, {"count": 7, "tags": [], "creator": "glens@apache.org", "attachment_id": null, "id": 19930, "time": "2002-07-21T13:59:15Z", "bug_id": 11010, "creation_time": "2002-07-21T13:59:15Z", "is_private": false, "text": "Sleep for me then work so I probably will not be able to look at it for another\n16 hours.  There's a lot of tests for the recordsize calculation but it's a\ncomplex beast and it's entirely possible I broke it in some way."}, {"count": 8, "tags": [], "text": "Created attachment 2490\nThis is the dump of the bad (formed by HSSF) and good (opened and saved by Excel). Good and bad from the view of the event API. %)", "is_private": false, "id": 20205, "creator": "sergeikozello@mail.ru", "time": "2002-07-25T19:42:24Z", "bug_id": 11010, "creation_time": "2002-07-25T19:42:24Z", "attachment_id": 2490}, {"text": "I have maid some dump, but still do not have any idea whay this happens. It \nseems that the content is correct in both cases, but many extra zero records in \none case are suitable for getting them 2 bytes (sid) by 2 bytes (size). In \nanother they ends on the first byte of supposed sid word. %(\n\nWhat do you think about it. Could you explain what are these zero records mean?", "tags": [], "bug_id": 11010, "is_private": false, "count": 9, "id": 20206, "time": "2002-07-25T19:45:29Z", "creator": "sergeikozello@mail.ru", "creation_time": "2002-07-25T19:45:29Z", "attachment_id": null}, {"count": 10, "tags": [], "text": "This means that one of the record size calculations is off by 2.  \nOne of the \"getSize()\" in records..  So its miscalculating the record size and\nmisinterperating.", "is_private": false, "bug_id": 11010, "id": 20246, "time": "2002-07-26T12:08:50Z", "creator": "poi-support@buni.org", "creation_time": "2002-07-26T12:08:50Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "But I do not understand a thing: if the record is not last and has incorrect \nlength, then the SID and SIZE of the next record will be shifted and wrong.\nAm I right?\nThe error in size as I see may be only in the last record with non-zero size.\n\nAnd as you can see in the txt file, for the bad book only 1 byte is available \nin the input stream, while it wants to get 2.\n\nAbout zero records: why there are so many zero records after the EOF? Please, \nlook at the files. \nThere are not only 2 bytes not enough. The inner structure is correct (as I see)\n, but the extra zero records are different. :(\n\nWhy so many zero records and what do they mean? What they for in Excel \nstructure?\n\nSorry, if it is silly question, but I really do not understand and want to \nunderstand.", "is_private": false, "id": 20269, "creator": "sergeikozello@mail.ru", "time": "2002-07-26T16:52:21Z", "bug_id": 11010, "creation_time": "2002-07-26T16:52:21Z", "attachment_id": null}, {"text": "Hey.  I'm swamped at the moment and cannot devote sufficent time to this.  Its\nvery serious.  In the next few days here is what I'm going to do:\n\n1. Test the last \"dev\" build (1.7-dev) for this error (I assume it is not present)\n2. Revert patches applied 1 by 1 (locally) until it no longer occurs\n3. Apply back any patches that I confirm are not the cause\n4. Apply that to the CVS repository and ask the patch submitter to correct the\nproblem. \n\nIn the meantime please continue investigating this.\n\n-andy", "tags": [], "bug_id": 11010, "is_private": false, "count": 12, "id": 20270, "time": "2002-07-26T17:04:32Z", "creator": "poi-support@buni.org", "creation_time": "2002-07-26T17:04:32Z", "attachment_id": null}, {"count": 13, "tags": [], "text": "FYI... I've looked at the bound sheet record changes and they appear to be okay\nas far as I can tell.", "attachment_id": null, "bug_id": 11010, "id": 20293, "time": "2002-07-27T01:49:27Z", "creator": "glens@apache.org", "creation_time": "2002-07-27T01:49:27Z", "is_private": false}, {"count": 14, "tags": [], "text": "Okay,  I've just tried this on 1.5.1 and 1.5.0 and got the same problem...  This\nseems to be a long standing issue.", "is_private": false, "bug_id": 11010, "id": 20296, "time": "2002-07-27T12:06:40Z", "creator": "glens@apache.org", "creation_time": "2002-07-27T12:06:40Z", "attachment_id": null}, {"count": 15, "tags": [], "text": "Just a thought...  I noticed the HSSFWorkbook class (line 531) check's if the\nserialized size is < 4096 and sets it equal to 4096 if it is.  Could this be the\nproblem and why is it done?", "is_private": false, "id": 20326, "creator": "glens@apache.org", "time": "2002-07-28T11:41:29Z", "bug_id": 11010, "creation_time": "2002-07-28T11:41:29Z", "attachment_id": null}, {"text": "That may be where the 0s are coming from but that is correct behavior.  The\n\"Workbook\" must be at least 4096.  (Long boring reason if you'd like to hear it\nlet me know).  However the fact that HSSF is reading into this is usually a\nresult of being off by some bytes in calculated size.", "tags": [], "bug_id": 11010, "is_private": false, "count": 16, "id": 20328, "time": "2002-07-28T14:13:53Z", "creator": "poi-support@buni.org", "creation_time": "2002-07-28T14:13:53Z", "attachment_id": null}, {"count": 17, "tags": [], "text": "I've confirmed the last set of patches for unicode stuff caused this I'll back\nthat out and post a note to the author to check this code.", "is_private": false, "bug_id": 11010, "id": 20333, "time": "2002-07-28T22:28:37Z", "creator": "poi-support@buni.org", "creation_time": "2002-07-28T22:28:37Z", "attachment_id": null}, {"text": "Andy, I really dont understand that at all.  How could the last set of changes\nhave cuased this?  I have confirmed that this exists in 1.5.0 and 1.5.1. ", "tags": [], "bug_id": 11010, "is_private": false, "count": 18, "id": 20337, "time": "2002-07-29T00:01:16Z", "creator": "glens@apache.org", "creation_time": "2002-07-29T00:01:16Z", "attachment_id": null}, {"text": "okay there were two sets of problems.  I was having trouble reading files\noutputted by POI in biffviewer (from the head).  backing out the unicode patches\nfixed that. ", "tags": [], "bug_id": 11010, "is_private": false, "count": 19, "id": 20338, "time": "2002-07-29T00:21:48Z", "creator": "poi-support@buni.org", "creation_time": "2002-07-29T00:21:48Z", "attachment_id": null}, {"count": 20, "tags": [], "text": "Created attachment 2519\nThe bug is still alive. Here is my thought and suggestions on it.", "attachment_id": 2519, "bug_id": 11010, "id": 20378, "time": "2002-07-29T19:13:59Z", "creator": "sergeikozello@mail.ru", "creation_time": "2002-07-29T19:13:59Z", "is_private": false}, {"count": 21, "tags": [], "text": "The problem is still alive after the patch was back.\nIn the attach the maker of the BUG and two examples.\nAs I see, it is not the size problem, and not Unicode problem,\nas Glen maked this problem was before.\n\nMy assumption and suggestion on this error are below.\nWhat do you think about it?\n\n\nMy assumption of this error is here:\nFor some reasons we have to make the workbook to be at least 4096 bytes\nbut if we have such workbook we fill the end of it with zeros (many zeros)\n\nIt is not good:\nif the length( all zero records ) % 4 = 1\ne.g.: any zero record would be readed as  4 bytes at once ( 2 - id and 2 - \nsize ).\nAnd the last 1 byte will be readed WRONG ( the id must be 2 bytes )\n\nThe suggestion:\nSo we should better to check if the sid is zero and not to read more data\nThe zero sid shows us that rest of the stream data is a fake to make workbook \ncertain size.\n( As in the sample HSSFEventFactory.java attached )\n", "attachment_id": null, "bug_id": 11010, "id": 20379, "time": "2002-07-29T19:14:51Z", "creator": "sergeikozello@mail.ru", "creation_time": "2002-07-29T19:14:51Z", "is_private": false}, {"count": 22, "tags": [], "creator": "sergeikozello@mail.ru", "attachment_id": null, "id": 20380, "time": "2002-07-29T19:15:24Z", "bug_id": 11010, "creation_time": "2002-07-29T19:15:24Z", "is_private": false, "text": "The attach is a zip file."}, {"count": 23, "tags": [], "bug_id": 11010, "attachment_id": null, "text": "applied, please verify", "id": 21103, "time": "2002-08-15T20:02:18Z", "creator": "poi-support@buni.org", "creation_time": "2002-08-15T20:02:18Z", "is_private": false}, {"count": 24, "tags": [], "text": "Created attachment 2865\nUnicode support for sheet name, format records and \"print titles\" of namerecord", "is_private": false, "id": 21948, "creator": "sergeikozello@mail.ru", "time": "2002-08-29T08:34:27Z", "bug_id": 11010, "creation_time": "2002-08-29T08:34:27Z", "attachment_id": 2865}, {"count": 25, "tags": [], "bug_id": 11010, "attachment_id": null, "text": "In the last attach the checking for zero id in event model, unicode support for \nsheet name and format record.\nAlso there is the aproache to the name record \"print tiltles\". As I found it \ngets the \"Print Titles\" and writes them down, but Excel can't see them. :(\n\nCould you suggest something on this point? May be it is some info in another \nstream to tell Excel to get these \"Print Titles\".\nI am stuck on this...", "id": 21949, "time": "2002-08-29T08:39:58Z", "creator": "sergeikozello@mail.ru", "creation_time": "2002-08-29T08:39:58Z", "is_private": false}, {"count": 26, "tags": [], "creator": "poi-support@buni.org", "is_private": false, "id": 22096, "attachment_id": null, "bug_id": 11010, "creation_time": "2002-09-02T02:14:02Z", "time": "2002-09-02T02:14:02Z", "text": "applied, please crosscheck.  Also PLEASE use \"cvs diff -u\" instead of \"cvs diff\"\nnext time.  (it makes it much easier to verify the patch).  This broke several\n(crappy) asserts in the unit tests...  We used to check for file length (which\nwas really important at one time because if the file length was off...we'd\nscrewed something up)...its not very important anymore and these asserts should\nsimply be removed as file length will change. -Andy"}, {"count": 27, "tags": [], "creator": "sergeikozello@mail.ru", "attachment_id": null, "id": 22204, "time": "2002-09-03T19:29:12Z", "bug_id": 11010, "creation_time": "2002-09-03T19:29:12Z", "is_private": false, "text": "Thanks, I checked and it seems that it is OK.\n\nI will continue to find the classes that has strings and can be unicode or UTF8.\nThe next is Header and Footer Records.\n\nOr may be you have the best idea to work at? :)\n\nAlso, please, help me with NameRecord. I do not know how works: the data is in \nthe Excel file, but MS Excel is not displaying/applying it. :("}, {"count": 28, "tags": [], "text": "list please.  I hate using bugzilla as a mail too.  ", "is_private": false, "bug_id": 11010, "id": 22267, "time": "2002-09-04T13:38:41Z", "creator": "poi-support@buni.org", "creation_time": "2002-09-04T13:38:41Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 28140, "is_private": false, "text": "Originally posted in 28079, but the patch that was applied was different from \nwhat I found.\n\nIn the XML returned in the reponse the following occur:\n\n1) Some servlet paths being written out as null\n<D:principal-collection-set>\n    <D:href>/hab-samplesnull/users</D:href>\n    <D:href>/hab-samplesnull</D:href>\n    <D:href>/hab-samplesnull/roles</D:href>\n</D:principal-collection-set>\n\n2)Some servlet paths being written out with the server URL\n<D:inherited>\n    <D:href>/hab-sampleshttp%3A//localhost%3A8080/files</D:href>\n</D:inherited>\n<D:principal>\n    <D:href>/hab-sampleshttp%3A//localhost%3A8080/roles/HAB_User</D:href>\n</D:principal>\n\nSearching the code I think that the calls to WebdavUtils.getAbsolutePath() in \nAbstractReport, PrincipalMatchReport, PrincipalPropertySearchReport, \nPropertyHelper and PropertyRetrieverImpl should be passing in servlet path not \nthe server URL.\n\nAlso the nulls look like they're coming from calls to \nWebdavUtils.getAbsolutePath() in PropertyHelper that passing null for the \nservlet path.\n\nI think that all references to serverURl need to be changed to servletPath in \nthe above mentioned files, as well as servletPath needs to be passed in to the \nmethods which used null.  Then, all calls to any of those methods would need \nto be checked.  Perhaps replacing all methods that currently take contextPath \nand serverURL should be replaced to take the request.  Then at compile time \nyou can easily find all the callers of those methods.", "id": 55095, "time": "2004-04-01T19:04:02Z", "creator": "Robert_Flaherty@Hyperion.com", "creation_time": "2004-04-01T19:04:02Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 28140, "attachment_id": null, "text": "Could you please verify this bug still exists in the latest version in the\nrelease branch?!", "id": 55130, "time": "2004-04-02T07:12:02Z", "creator": "ozeigermann@c1-fse.de", "creation_time": "2004-04-02T07:12:02Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 28140, "text": "Just tried the new 2.0 release and it looks like many of the serverURL-\n>servletPath issues were resolved.  But there are several still lurking \nabout.  I'm going to attach a sample input/output using Windows Webdav \nsupport.  I would assume that Webdav is consistent with hrefs in that they \nshould be including the contextPath/servletPath everywhere.  Highlights that I \nthink are wrong are:\n\n1) No contextPath/servletPath\n<D:href>/roles/HAB_Admin</D:href>\n\n2) No servletPath\n<D:href>/hab-samples/users/unauthenticated</D:href>\n\n3) Null servletPath\n<D:href>/hab-samplesnull/users</D:href>\n\nThere are 4 occurances of \"null, sConf\" in PropertyHelper which I think is the \nnull problem.\n\nI had suggested before about condensing passing context path and servlet path \ninto just passing in the request.  Many places pass \"String servletPath, \nString contextPath\", whereas the WebdavUtils.getAbsolutePath takes \"String \ncontextPath, String servletPath\".  You know somewhere these are or will be \nreversed.  Conceptually at least these should be reversed as context path \ncomes first, then servlet path.  But, I think converting to request will be \nmuch less error prone.\n\n", "id": 56991, "time": "2004-05-07T15:49:59Z", "creator": "Robert_Flaherty@Hyperion.com", "creation_time": "2004-05-07T15:49:59Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "Robert_Flaherty@Hyperion.com", "text": "Created attachment 11454\nSample input/output of first Windows webdav call", "id": 56992, "time": "2004-05-07T15:52:25Z", "bug_id": 28140, "creation_time": "2004-05-07T15:52:25Z", "is_private": false, "attachment_id": 11454}, {"count": 4, "tags": [], "creator": "luetzkendorf@apache.org", "text": "I have commited fixes for that issue to the cvs head.\n\nI introduced the \"slideContextPath\" as the path prefix of all \nslide uris exposed via webdav, and replaced all uses of the \ncontextPath - servlet path pair with that new slideContextPath.\n\nTestcases now running (as default and as nondefault servlet) are\nfuntional, deltav/functional .\n\nA known issue remains the SEARCH method which I try to resolve next.\n\nRobert, it whould be great you could recheck your cases and \nlet me know if thera are still problems.\n\nRegards, Stefan", "id": 59189, "time": "2004-06-14T12:52:32Z", "bug_id": 28140, "creation_time": "2004-06-14T12:52:32Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 28140, "text": "Tried 2.1M1 version of Slide, using source for PropertyHelper.java\n * $Header: /home/cvspublic/jakarta-\nslide/src/webdav/server/org/apache/slide/webdav/util/PropertyHelper.java,v 1.69 \n2004/05/12 12:50:41 pnever Exp $\n * $Revision: 1.69 $\n * $Date: 2004/05/12 12:50:41 $\n\n1) Some servlet paths being written out as null --- IS STILL NOT FIXED\n   See lines 1840,1872,1877 and 1881 in PropertyHelper.java specified above.\n\n2) HRefs in the following properties are still incorrect.  They are as follows:\n   owner\n   creationuser\n   modificationuser\n\n   See lines 1926, 1936 and 1947 in PropertyHelper.java specified above.\n\n3) Inconsistency with unauthenticated.  Some properties return \n<D:href>contextPath/servletPath/users/unauthenticated</D:href> or \n<D:unauthenticated />.  For example owner and creationuser return \n<D:unauthenticated /> while modificationuser returns \n<D:href>contextPath/servletPath/users/unauthenticated</D:href>.  The request \nused was <?xml version=\"1.0\" encoding=\"utf-8\" ?><D:propfind \nxmlns:D=\"DAV:\"><D:allprop/></D:propfind> on /files as the resource.  Did some \ndigging and found on lines 1922 and 1933 of PropertyHelper.java, NodeProperty \nis null.", "count": 5, "id": 61255, "time": "2004-07-28T16:10:27Z", "creator": "jessica_lee@hyperion.com", "creation_time": "2004-07-28T16:10:27Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 28140, "attachment_id": null, "is_private": false, "id": 64306, "time": "2004-09-28T12:27:07Z", "creator": "luetzkendorf@apache.org", "creation_time": "2004-09-28T12:27:07Z", "text": "Now I would claim that this issue is fixed.\n\nTestcases functional, deltav and bind are passing if servlet is \nnot the dafault one.\ndasl test cases produce the same errors as with the servlet as default,\nso thats not this issue.\n\nStefan."}]
[{"count": 0, "tags": [], "bug_id": 53440, "is_private": false, "text": "On Windows with JDK 6 when establishing a connection over SSL i got the stack posted below with the array ArrayStoreException... This is reproducable and does NOT happen on a JDK 5 installation. \n\nThis happens just at runtime. The code can be compiled with JDK 5 and JDK 6... \n\nExact java version that produces the error:\n> java -version\njava version \"1.6.0_30\"\nJava(TM) SE Runtime Environment (build 1.6.0_30-b12)\nJava HotSpot(TM) Client VM (build 20.5-b03, mixed mode, sharing)\n\nworkaround:\nUse a JDK 1.5\n\n\n\nSTACK-TRACE\n-----------\njava.lang.ArrayStoreException: org.apache.jmeter.util.JsseSSLManager$WrappedX509KeyManager\n\tat org.apache.jmeter.util.JsseSSLManager.createContext(JsseSSLManager.java:241)\n\tat org.apache.jmeter.util.JsseSSLManager.getContext(JsseSSLManager.java:198)\n\tat org.apache.jmeter.util.HttpSSLProtocolSocketFactory.getSSLSocketFactory(HttpSSLProtocolSocketFactory.java:103)\n\tat org.apache.jmeter.util.HttpSSLProtocolSocketFactory.createSocket(HttpSSLProtocolSocketFactory.java:147)\n\tat org.apache.commons.httpclient.HttpConnection.open(HttpConnection.java:707)\n\tat org.apache.commons.httpclient.HttpMethodDirector.executeWithRetry(HttpMethodDirector.java:387)\n\tat org.apache.commons.httpclient.HttpMethodDirector.executeMethod(HttpMethodDirector.java:171)\n\tat org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:397)\n\tat org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:323)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPHC3Impl.sample(HTTPHC3Impl.java:249)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:62)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1060)\n\tat org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1049)\n\tat org.apache.jmeter.threads.JMeterThread.process_sampler(JMeterThread.java:442)\n\tat org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:271)\n\tat java.lang.Thread.run(Unknown Source)\n\n\nBest regards,\npatrick", "id": 160124, "time": "2012-06-20T09:40:24Z", "creator": "patrick.heusser@gmail.com", "creation_time": "2012-06-20T09:40:24Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 53440, "text": "The code in question is:\n\nKeyManager[] managers = managerFactory.getKeyManagers();\n...\nfor (int i = 0; i < managers.length; i++) {\n    if (managers[i] instanceof X509KeyManager) {\n        X509KeyManager manager = (X509KeyManager) managers[i];\n        managers[i] = new WrappedX509KeyManager(manager, keys); // line 241\n    }\n}\n\nNow WrappedX509KeyManager implements X509KeyManager which extends KeyManager.\nI don't see how the code would even compile unless this were true, so an ArrayStoreException should be impossible.\n\nI've tried with java.version=1.6.0_31 on Windows and it works fine for me.\n\nPlease can you provide the simplest possible test script that shows the problem, along with log files for Java 1.5 and 1.6?", "id": 160175, "time": "2012-06-22T01:01:21Z", "creator": "sebb@apache.org", "creation_time": "2012-06-22T01:01:21Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "hi\n\nthx for looking at it.\n\ni had a quick look at the code too. for both java API 1.5 and 1.6 the hierarchy is the same and it compiles with both, but does fail at runtime. so it must be obviously related to the JDK and NOT Jmeter itself. it would be nice, if Jmeter could work \"around\" it. the sampler with the request fails completely, may be a simple try/catch helps.\n\nour server under test asks for a client certificate, even though it's not required in the end. my guess is this causes the failure. \n\nregards,", "attachment_id": null, "bug_id": 53440, "id": 160176, "time": "2012-06-22T06:43:15Z", "creator": "patrick.heusser@gmail.com", "creation_time": "2012-06-22T06:43:15Z", "is_private": false}, {"count": 3, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "We really need to be able to reproduce the issue.\n\nCan you provide a simple test case that exhibits the problem, together with any changes you made to jmeter.properties or system.properties?\n\nAlso, it would be helpful to have the jmeter logs for both runs.\n\nIf necessary, feel free to replace the names of servers etc with place-holders.\n\nAlso, just in case it is a specific issue with Java 1.6.0_30, can you try with the current release, i.e.  1.6.0_33?", "id": 160181, "time": "2012-06-22T14:23:21Z", "bug_id": 53440, "creation_time": "2012-06-22T14:23:21Z", "is_private": false}, {"count": 4, "tags": [], "text": "I've managed now to set up a test with Tomcat. \nIt uses clientAuth=\"true\" and requires a certificate.\n\nI was able to connect to Tomcat with Firefox and with JMeter; no problems were encountered with 1.5.0_22, 1.6.0_33, 1.7.0_05.\n\nThis is looking like a problem with your Java 6 installation, i.e. the bug should be closed as \"WORKSFORME\" unless you can provide a test case that can be repeated by others.", "is_private": false, "bug_id": 53440, "id": 160184, "time": "2012-06-22T16:53:59Z", "creator": "sebb@apache.org", "creation_time": "2012-06-22T16:53:59Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 53440, "is_private": false, "text": "Hello Sebb,\nI think issue is possible because we don't know the real type of array allocated.\n\nTake the following snippet:\n    public static void main(String[] args) {\n        Number[] t = new Integer[5];\n        t[0] = new Long(123);\n    }\n\nLong is a Number but it provokes an ArrayStoreException cause allocated array elements if not a Long array.", "id": 160204, "time": "2012-06-23T21:46:29Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2012-06-23T21:46:29Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "id": 160205, "time": "2012-06-23T21:51:44Z", "bug_id": 53440, "creation_time": "2012-06-23T21:51:44Z", "tags": [], "text": "To be clearer it can happen if SPI does not allocate a KeyManager array but a subclass."}, {"count": 7, "attachment_id": null, "creator": "p.mouawad@ubik-ingenierie.com", "text": "Date: Sat Jun 23 22:06:21 2012\nNew Revision: 1353205\n\nURL: http://svn.apache.org/viewvc?rev=1353205&view=rev\nLog:\nBug 53440 - SSL connection leads to ArrayStoreException on JDK 6 with some KeyManagerFactory SPI\nBugzilla Id: 53440\n\nModified:\n   jmeter/trunk/src/core/org/apache/jmeter/util/JsseSSLManager.java\n   jmeter/trunk/xdocs/changes.xml", "id": 160206, "time": "2012-06-23T22:07:55Z", "bug_id": 53440, "creation_time": "2012-06-23T22:07:55Z", "tags": [], "is_private": false}, {"count": 8, "attachment_id": null, "creator": "p.mouawad@ubik-ingenierie.com", "text": "Hello M. Heusser,\nIt would be helpful if you could confirm that issue is fixed for you using a nightly build that will be generated within hours.\n- http://jmeter.apache.org/nightly.html\nAs I was not able to reproduce it on my configuration.\nThank you\nRegards\nPhilippe", "id": 160207, "time": "2012-06-23T22:16:00Z", "bug_id": 53440, "creation_time": "2012-06-23T22:16:00Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "bug_id": 53440, "is_private": false, "text": "hi jmeter team\n\ni did some more testing with different JVM versions. i found, that my observation is very specific to the version i used (see bug submission). i did tests with the two version listed below, both work OK! \n\nstill, i gonna try your nightly fix. sorry to be a bit slow on that, i'm in a rather restricted environment where it's a bit hard to test such stuff...\n\none note: i'm extremely impressed by the work and commitment that you guys do. respect and thanks a lot! JMeter is a cool tool :-)\n\nJVM WORKS OK: \nD:\\Data\\Rad\\shared\\programs\\Java\\jre6_32bit\\bin>java -version\njava version \"1.6.0_33\"\nJava(TM) SE Runtime Environment (build 1.6.0_33-b03)\nJava HotSpot(TM) Client VM (build 20.8-b03, mixed mode, sharing)\n \nJVM WORKS OK: \nD:\\Data\\Rad\\shared\\programs\\Java\\jdk1.7.0_05_32bit\\bin>java -version\njava version \"1.7.0_05\"\nJava(TM) SE Runtime Environment (build 1.7.0_05-b05)\nJava HotSpot(TM) Client VM (build 23.1-b03, mixed mode)\n\ncheers,\npatrick", "id": 160268, "time": "2012-06-26T17:39:34Z", "creator": "patrick.heusser@gmail.com", "creation_time": "2012-06-26T17:39:34Z", "attachment_id": null}, {"count": 10, "tags": [], "text": "hi guys\n\ni tested the nightly build r1353803 this morning. \n\n=> it was a full success! the exception has gone.\n\nthanks a lot,\npatrick", "is_private": false, "bug_id": 53440, "id": 160281, "time": "2012-06-27T05:58:44Z", "creator": "patrick.heusser@gmail.com", "creation_time": "2012-06-27T05:58:44Z", "attachment_id": null}]
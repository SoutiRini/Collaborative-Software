[{"count": 0, "tags": [], "creator": "drazzib@drazzib.com", "attachment_id": null, "text": "Hi,\n\nApache Mod_Jk fails to build with security hardening cflags [1]. As part as an ongoing effort in Debian, we are trying to build as much as possible \"network\" package with hardening features enabled [2].\n\nCurrent failure is :\n/usr/share/apr-1.0/build/libtool --silent --mode=compile x86_64-linux-gnu-gcc -I/usr/include/apache2 -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Wformat-security -Werror=format-security -DHAVE_CONFIG_H -DUSE_APACHE_MD5 -I ../common -I /include -I /include/unix  -DLINUX=2 -D_FORTIFY_SOURCE=2 -D_GNU_SOURCE -D_REENTRANT -I/usr/include/apr-1.0 -I/usr/include/openssl -I/usr/include/xmltok -pthread   -DHAVE_APR  -I/usr/include/apr-1.0 -I/usr/include/apr-1.0 -g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Wformat-security -Werror=format-security -DHAVE_CONFIG_H   -c mod_jk.c -o mod_jk.lo\nmod_jk.c: In function 'jk_error_exit':\nmod_jk.c:678:5: error: format not a string literal and no format arguments [-Werror=format-security]\nmod_jk.c:684:9: error: format not a string literal and no format arguments [-Werror=format-security]\ncc1: some warnings being treated as errors\n\n[1] \"-Wformat -Wformat-security -Werror=format-security\"\n[2] http://wiki.debian.org/Hardening\n\nRegards,", "id": 153315, "time": "2012-01-31T07:52:05Z", "bug_id": 52564, "creation_time": "2012-01-31T07:52:05Z", "is_private": false}, {"count": 1, "tags": [], "text": "First note, that the format string argument used in those two lines was explicitely sanitized by removing any % character just a few lines above that precisely because we pass it along without arguments.\n\nHow to really fix this? I didn't find a way to tell gcc that this special argument is save. Starting with gcc 4.6 we could use a pragma to switch of format-security checking just for those lines.\n\nWhich gcc version is Debian using? Any better ideas how to correctly signal gcc, that there is no problem here?\n\nIn fact we do not use the ability to pass along arguments to format in jk_error_exit in the code for Apache 2.x, but we do use it in the code for 1.3 and I'm not yet ready to simply drop that feature.\n\nRegards,\n\nRainer", "is_private": false, "id": 153316, "creator": "rainer.jung@kippdata.de", "time": "2012-01-31T10:02:06Z", "bug_id": 52564, "creation_time": "2012-01-31T10:02:06Z", "attachment_id": null}, {"count": 2, "text": "Created attachment 28273\nFix FTBFS with -Werror=format-security", "bug_id": 52564, "attachment_id": 28273, "id": 153483, "time": "2012-02-05T23:30:52Z", "creator": "drazzib@drazzib.com", "creation_time": "2012-02-05T23:30:52Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 52564, "attachment_id": null, "id": 153484, "time": "2012-02-05T23:33:09Z", "creator": "drazzib@drazzib.com", "creation_time": "2012-02-05T23:33:09Z", "is_private": false, "text": "Hi,\n\nFTR, Debian currently use GCC 4.6 (maybe GC 4.7 soon). I've attached a small patch done by tony mancill <tmancill@debian.org> to help fix this.\n\nCould you please consider this for inclusion ?\n\nRegards,"}, {"count": 4, "tags": [], "bug_id": 52564, "attachment_id": null, "is_private": false, "id": 153490, "time": "2012-02-06T07:38:30Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2012-02-06T07:38:30Z", "text": "Thanks for the patch. on't know why I didn't consider that myself.\n\nApplied in r1240904. Will be part of 1.2.33."}]
[{"count": 0, "tags": [], "text": "Created attachment 22552\ninput test case powerpoint file\n\nSee the attached file testcase1in.ppt as the input file to the following test code which tries to substitute the string $$DATE$$ with the current date/time:\n\npackage pptMaker;\n\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport org.apache.poi.hslf.HSLFSlideShow;\nimport org.apache.poi.hslf.usermodel.SlideShow;\nimport org.apache.poi.hslf.model.*;\n\n/**\n * Test file to take an input file, change its contents based on a predefined template\n * string, and write the output\n */\n\npublic class ModifyDate {\n\t\n\tpublic static final String _inputPPTFile = \"/Users/djboulia/Downloads/testcase1in.ppt\";\n\tpublic static final String _outputPPTFile = \"/Users/djboulia/Downloads/testcase1out.ppt\";\n\n\t/**\n\t * @param args\n\t */\n\tpublic static void main(String[] args) throws IOException {\n\t\t SlideShow ppt = new SlideShow(new HSLFSlideShow(_inputPPTFile));\n\n\t\t //get slides \n\t\t  Slide[] slide = ppt.getSlides();\n\t\t  for (int i = 0; i < slide.length; i++){\n\t\t\tSystem.out.println( \"Slide \" + i);\n\t\t\t\n\t\t    Shape[] sh = slide[i].getShapes();\n\t\t    for (int j = 0; j < sh.length; j++){\n\t\t      //name of the shape\n\t\t      String name = sh[j].getShapeName();\n\n\t\t      //shapes's anchor which defines the position of this shape in the slide\n\t\t      java.awt.Rectangle anchor = sh[j].getAnchor();\n\n\t\t      if (sh[j] instanceof Line){\n\t\t        Line line = (Line)sh[j];\n\t\t        //work with Line\n\t\t        System.out.println( \"Found a Line!\");\n\t\t      } else if (sh[j] instanceof AutoShape){\n\t\t        AutoShape shape = (AutoShape)sh[j];\n\t\t        //work with AutoShape\n\t\t        System.out.println( \"Found an AutoShape!\");\n\t\t      } else if (sh[j] instanceof TextBox){\n\t                TextBox shape = (TextBox)sh[j];\n\t                //work with TextBox\n\t                String str = shape.getText();\n\t                               \n\t                System.out.println( \"Found a TextBox!\");\n\t                System.out.println( str );\n\t                \n\t                if (str.indexOf(\"$$DATE$$\") >=0 ) {\n\t                    System.out.println( \"Found $$DATE$$!!\" );\n\t                    java.util.Date now = new java.util.Date();\n\t                    str = str.replaceAll(\"[$][$]DATE[$][$]\", now.toString());\n\t \n\t\t\t\t        if (str.compareTo(shape.getText())!=0) {\n\t\t\t\t\t        shape.setText( str );\n\t\t\t\t        }\n\t                    System.out.println( \"Replacement string is \" + str ); \n\t                }\n\t                \t\t        \n\t\t      } else if (sh[j] instanceof Picture){\n\t\t        Picture shape = (Picture)sh[j];\n\t\t        //work with Picture\n\t\t        System.out.println( \"Found a Picture!\");\n\t\t        \n\t\t      } else {\n\t\t    \t  System.out.println(\"Found unknown shape: \"+name);\n\t\t      }\n\t\t    }\n\t\t  }\n\t\t  \n\t    //save changes in a new file\n\t    FileOutputStream out = new FileOutputStream(_outputPPTFile);\n\t    ppt.write(out);\n\t    out.close();\n\n\t}\n\n}\n\nRunning this on poi-3.1 results in a corrupt PowerPoint file.  (Loading it in Office 2004 on the Mac results in a blank page.)\n\nAfter some investigation, it appears that there are cases where TextRun.changeRichTextRun incorrectly calculates the new length of the paragraph properties when called via setRawText.\n\nThe proposed patch resets the size of the paragraph and character properties to the correct length when setRawText is called which avoids the problem in changeRichTextRun.", "attachment_id": 22552, "bug_id": 45776, "id": 120529, "time": "2008-09-10T14:58:54Z", "creator": "djboulia@gmail.com", "creation_time": "2008-09-10T14:58:54Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 45776, "attachment_id": 22553, "id": 120530, "time": "2008-09-10T14:59:50Z", "creator": "djboulia@gmail.com", "creation_time": "2008-09-10T14:59:50Z", "is_private": false, "text": "Created attachment 22553\npatch for TextRun.setRawText"}, {"count": 2, "tags": [], "bug_id": 45776, "is_private": false, "text": "Thank you for the patch.\n\nApplied with SVN ver r1554077", "id": 171955, "time": "2013-12-29T22:18:29Z", "creator": "kiwiwings@apache.org", "creation_time": "2013-12-29T22:18:29Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "mattiasb@bea.com", "text": "Seems like the imutability rules of nested <reference> elements in the <ant> \ntask does not work like they should (and are documented to work). From the \ndocumentation of the <ant> task:\n\nNested <reference> elements can also be used to copy references from the \ncalling project to the new project, optionally under a different id. References \ntaken from nested elements will override existing references in the new project.\n\nBut given the two files pathref_1/2 (see below) we get:\n\nC:\\Work\\View\\example\\src>c:\\Tools\\apache-ant-1.5.3-1\\bin\\ant -v -f pathref_1.xml\n\nApache Ant version 1.5.3 compiled on April 16 2003\nBuildfile: pathref_1.xml\nDetected Java version: 1.4 in: C:\\Tools\\j2sdk1.4.1_03\\jre\nDetected OS: Windows XP\nparsing buildfile pathref_1.xml with URI = file:C:/Work/View/example/src/pathref\n_1.xml\nProject base dir set to: C:\\Work\\View\\example\\src\nBuild sequence for target `pathref_2' is [init, pathref_2]\nComplete build sequence is [init, pathref_2]\n\ninit:\n     [echo] Path = C:\\Work\\View\\example\\src\\monkey\n\npathref_2:\n      [ant] calling target [default] in build file C:\\Work\\View\\example\\src\\path\nref_2.xml\nparsing buildfile C:\\Work\\View\\example\\src\\pathref_2.xml with URI = file:C:/Work\n/View/example/src/pathref_2.xml\nProject base dir set to: C:\\Work\\View\\example\\src\nBuild sequence for target `init' is [init]\nComplete build sequence is [init]\n\ninit:\nOverriding previous definition of reference to path.id\n     [echo] Path = C:\\Work\\View\\example\\src\\business\n\nBUILD SUCCESSFUL\nTotal time: 1 second\n\nSo, references taken from nested elements will _not_ override existing \nreferences in the new project. Same problem exists in 1.6.alpha from 08/24.\n\npathref_1.xml:\n<project name=\"pathref_1\" default=\"pathref_2\">\n\t<target name=\"init\">\n\t\t<path id=\"path.id\">\n\t\t\t<pathelement location=\"monkey\"/>\n\t\t</path>\n\t\t<property name=\"path.property\" refid=\"path.id\"/>\n\t\t<echo message=\"Path = ${path.property}\"/>\n\t</target>\n\t\n\t<target name=\"pathref_2\" depends=\"init\">\n\t\t<ant antfile=\"pathref_2.xml\" inheritall=\"false\" \ninheritrefs=\"false\">\n\t\t\t<reference refid=\"path.id\"/>\n\t\t</ant>\n\t</target>\n</project>\n\npathref_2.xml:\n<project name=\"pathref_2\" default=\"init\">\n\t<target name=\"init\">\n\t\t<path id=\"path.id\">\n\t\t\t<pathelement location=\"business\"/>\n\t\t</path>\n\t\t<property name=\"path.property\" refid=\"path.id\"/>\n\t\t<echo message=\"Path = ${path.property}\"/>\n\t</target>\n</project>", "id": 43233, "time": "2003-08-25T09:29:52Z", "bug_id": 22690, "creation_time": "2003-08-25T09:29:52Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 22690, "attachment_id": null, "text": "It works if you move the <path> in pathref_2 outside of any target.\n\nThis is inconsistent and should be fixed, I'm just not sure which way (i.e.\nwhether it should always override or never).\n\nThe nested <reference> basically works like a reference defined in the new project\noutside of any target.  As references inside of targets can override those defined\non the outside (references are mutable unlike properties) this behavior is\nsomewhat expected.\n", "id": 43236, "time": "2003-08-25T13:40:23Z", "creator": "bodewig@apache.org", "creation_time": "2003-08-25T13:40:23Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 22690, "attachment_id": null, "text": "OK, thanks for the explanation.\n\nI don't think what I want to do is that strange though (i.e. you might want to \nconsider a way to support it).\n\n1) I want to work with <path>'s and refid=\"...\" and not squeeze the paths into \nproperties, because I like the readability and flexibility.\n\n2) I want to control the paths used in a subproject from a master build file.\n\n3) I want to place path (and other definitions) in the init <target> and not at \ntop level because I want to do consistency checks (using <condition>, <fail>, \netc) of settings before they are used to set other properties, and errors are \npropagated.\n\nThanks for you help.\n", "id": 43356, "time": "2003-08-27T08:41:08Z", "creator": "mattiasb@bea.com", "creation_time": "2003-08-27T08:41:08Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "bodewig@apache.org", "is_private": false, "count": 3, "id": 45594, "time": "2003-10-14T12:14:13Z", "bug_id": 22690, "creation_time": "2003-10-14T12:14:13Z", "text": "For 1.6 we'll stick with documenting the behavior as is.\n\nGiven your list below (3) is no real obstacle in 1.6 as <condition> (and any other\ntask) can be used outside of targets as well."}, {"attachment_id": null, "tags": [], "creator": "mattiasb@bea.com", "is_private": false, "count": 4, "id": 45606, "time": "2003-10-14T13:26:11Z", "bug_id": 22690, "creation_time": "2003-10-14T13:26:11Z", "text": "That's good enough for me. Being able to use any task outside targets is nice \n(for other reasons as well)."}, {"count": 5, "tags": [], "text": "*** Bug 29051 has been marked as a duplicate of this bug. ***", "attachment_id": null, "bug_id": 22690, "id": 58038, "time": "2004-05-25T11:54:10Z", "creator": "bodewig@apache.org", "creation_time": "2004-05-25T11:54:10Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 22690, "text": "Closing this as Stephan has documented the behaviour.\n\"References taken from nested elements will override existing references that\nhave been defined outside of targets in the new project - but not those defined\ninside of targets.\"\n", "id": 94034, "time": "2006-09-23T21:45:28Z", "creator": "peterreilly@apache.org", "creation_time": "2006-09-23T21:45:28Z", "is_private": false, "attachment_id": null}]
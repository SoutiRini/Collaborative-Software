[{"count": 0, "tags": [], "creator": "kpreisser@apache.org", "attachment_id": 30907, "text": "Created attachment 30907\nTest case\n\nWhen writing a binary websocket message with about 25 KB, the client will get corrupted data starting on Offset 0x2000 when running Tomcat with the NIO connector.\n\n\nTo reproduce:\n\n1) Checkout current trunk (r1529816) and apply the attached patch locally. This will modify the Echo example so that the JavaScript sends a Base64-encoded String to Tomcat, and Tomcat will decode it as byte[] array and send it back using a binary websocket message. The JavaScript will then compare each byte and report if differences are found.\n\n2) Start Tomcat using the NIO connector on 64-Bit Windows with a 64-bit JVM.\n\n3) Open the Echo example (http://localhost:8080/examples/websocket/echo.xhtml) with Firefox or Chrome.\n\n4) The page will print lines such as the following:\nOffset 0x2000: Excepted [0x80] but got [0x89]\nOffset 0x2001: Excepted [0xE4] but got [0x50]\nOffset 0x2002: Excepted [0x69] but got [0x4E]\nOffset 0x2003: Excepted [0xDD] but got [0x47]\nOffset 0x2004: Excepted [0x8F] but got [0x0D]\nOffset 0x2005: Excepted [0x9A] but got [0x0A]\n[...]\n\nThis indicates that there were differences between the sent and the received message.\n\n\n5) If you try this with the APR connector, the page will print: \"No errors found.\"\nso with APR the problems don't occur.\n\nIf you try this with the BIO connector (and repeatedly press F5 in Firefox), the page will sometimes print \"No errors found\", but sometimes it will print nothing as then Tomcat did not call the EchoAnnotation#echoMessage method.", "id": 170471, "time": "2013-10-07T16:36:31Z", "bug_id": 55638, "creation_time": "2013-10-07T16:36:31Z", "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "text": "All fixed in trunk. Need to test a little more before back-porting.", "id": 170496, "time": "2013-10-08T21:03:32Z", "bug_id": 55638, "creation_time": "2013-10-08T21:03:32Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 55638, "text": "Autobahn tests pass. CI system looks OK. Changes have been back-ported to 7.0.x", "count": 2, "id": 170497, "time": "2013-10-08T22:42:19Z", "creator": "markt@apache.org", "creation_time": "2013-10-08T22:42:19Z", "is_private": false}]
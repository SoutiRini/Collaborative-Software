[{"count": 0, "tags": [], "bug_id": 33770, "attachment_id": null, "id": 71610, "time": "2005-02-28T14:34:57Z", "creator": "eric.jain@gmail.com", "creation_time": "2005-02-28T14:34:57Z", "is_private": false, "text": "I am unable to retrieve the following file with Ant:\n\n  wget ftp://nlmpubs.nlm.nih.gov/online/mesh/.xmlmesh/desc2005.gz\n\nNote the dot in the path. \"wget\" doesn't have any problems retrieving this file.\nBut with Ant's \"get\" task:\n\n  [get] Getting: ftp://nlmpubs.nlm.nih.gov/online/mesh/.xmlmesh/desc2005.gz\n  [get] Error opening connection sun.net.ftp.FtpProtocolException: PORT :500\nIllegal PORT command, EPSV ALL in effect\n  [get] Error opening connection java.io.FileNotFoundException:\nonline/mesh/.xmlmesh/desc2005.gz\n  [get] Error opening connection java.io.FileNotFoundException:\nonline/mesh/.xmlmesh/desc2005.gz\n  [get] Can't get ftp://nlmpubs.nlm.nih.gov/online/mesh/.xmlmesh/desc2005.gz to\n/work/data/src/mesh.xml.gz\n\nAnd with the \"ftp\" task:\n\n  [ftp] getting files\n  [ftp] 0 files retrieved\n\nHere is the corresponding fragment from the build.xml:\n\n  <ftp\n    server=\"${host}\"\n    userid=\"anonymous\"\n    password=\"anonymous\"\n    action=\"get\"\n    depends=\"yes\"\n    passive=\"yes\"\n    preservelastmodified=\"yes\"\n  >\n      <fileset dir=\".\">\n        <include name=\"${path}\"/>\n      </fileset>\n  </ftp>"}, {"count": 1, "tags": [], "bug_id": 33770, "text": "Some considerations:\nthe ftp task is lacking the remotedir attribute\n\nwhen I try to download the indicated file using ncftp / ftp in passive mode I\ncontinously get Data connection timed out\n\nThe get task also fails under linux with the same error report.\n\nEthereal traces show the following:\n-> 21:EPSV\n<- 21:229 Entering Extended Passive Mode (|||40111|)\n-> 40111:SYN\n-> 21:ACK\n-> 40111:SYN\n-> 40111:SYN\n(Remote host does not react on the sent SYN packets on the port the remote host\nproposed to be used)\n-> 21:EPRT\n<- 21:500 Illegal port command, EPSV ALL in effect\n-> 21:EPRT\n<- 21:500 Illegal port command, EPSV ALL in effect\n\nSo basically the remote host has accepted and entered the EPSV state, but does\nnot act accordingly. (accepts an connection on port 40111)\n\nClosing this bug, as this is probably a network configuration error at the\nremote site.", "id": 71800, "time": "2005-03-03T22:32:55Z", "creator": "jkf@apache.org", "creation_time": "2005-03-03T22:32:55Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 33770, "text": "(In reply to comment #1)\n\n> So basically the remote host has accepted and entered the EPSV state, but does\n> not act accordingly. (accepts an connection on port 40111)\n\nThis may be confusing, I mean:\n\nThe host proposes to use port 40111, but subsequently does not accept the\nconnection to port 40111.\n\n", "id": 71801, "time": "2005-03-03T22:42:41Z", "creator": "jkf@apache.org", "creation_time": "2005-03-03T22:42:41Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 33770, "attachment_id": null, "text": "Thanks for looking into this. The ftp task does indeed work if I use the\nremotedir attribute:\n\n  <ftp\n    server=\"nlmpubs.nlm.nih.gov\"\n    userid=\"anonymous\"\n    password=\"anonymous\"\n    action=\"get\"\n    depends=\"yes\"\n    remotedir=\"/online/mesh/.xmlmesh\"\n    preservelastmodified=\"yes\"\n  >\n      <fileset dir=\".\">\n        <include name=\"desc2005.gz\"/>\n      </fileset>\n  </ftp>\n\nBut then why doesn't the following work?\n\n  <ftp\n    server=\"nlmpubs.nlm.nih.gov\"\n    userid=\"anonymous\"\n    password=\"anonymous\"\n    action=\"get\"\n    depends=\"yes\"\n    remotedir=\"/online\"\n    preservelastmodified=\"yes\"\n  >\n      <fileset dir=\".\">\n        <include name=\"mesh/.xmlmesh/desc2005.gz\"/>\n      </fileset>\n  </ftp>\n\n->\n\n  [ftp] getting files\n  [ftp] 0 files retrieved\n\n\nRegarding the \"get\" task: If wget works, shouldn't the get task be able to work\nas well - even if the server is flaky?\n", "id": 71811, "time": "2005-03-04T10:41:55Z", "creator": "eric.jain@gmail.com", "creation_time": "2005-03-04T10:41:55Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 33770, "attachment_id": null, "id": 71851, "time": "2005-03-04T23:29:51Z", "creator": "jkf@apache.org", "creation_time": "2005-03-04T23:29:51Z", "is_private": false, "text": "The problem for get is, that because the (configuration of) the server is flaky\nthe server gets into a state it doesn't get out of anymore, the libraries get is\nusing try to back out of the EPSV ALL by doing an EPRT (which is illegal after\nEPSV ALL, as of that moment the data port returned by EPSV ALL must be used). If\nwget doesn't get the server into that state wget will work fine, but any client\ntrying to use EPSV ALL will lock the server without chance of correcting the\nsituation.\n\nthat the ftp task is not working - even when the passive mode is off -\nhas to do with the .xmlmesh directory in combination with a check on following\nsymlinks.\n\nthe ftp list command issued by the jakarta commons net  ftpclient class does not\nreturn the directory starting with . so that the verification on symlinks fails\n(which is done because the case sensitivity of the file system has not been\nprobed yet?!)\n\nI fixed the FTP task so that it will generally stop probing for symlinks just\nbecause the check on case sensitivity has not been performed yet.\nFurthermore I 'll fix the FTP task so that it will \"guess\" the hidden file to\nnot be a symlink instead of failing.\n"}]
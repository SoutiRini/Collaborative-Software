[{"count": 0, "tags": [], "text": "If I use the junit task with a timeout and the unit test task\nexceeds the timeout value, the ant prints a failure msg but\nthere is no failure status dumped to the xml log of the unit\ntest. Here is an example:\n\n\nApache 939>ant\nBuildfile: build.xml\n\nbuild:\n\nrun:\n    [junit] Running TestTimeout\n\nBUILD FAILED\n\nD:\\usr\\local\\Java\\Apache\\build.xml:25: Test TestTimeout failed\n\nTotal time: 11 seconds\nApache 940>ls -l TEST-TestTimeout.xml\n-rw-r--r--   1 Administ Administ        0 Jul  7 17:32 TEST-TestTimeout.xml\n\n// build.xml\n<?xml version=\"1.0\"?>\n\n<project name=\"UnitTests\" default=\"run\" basedir=\".\">\n    <property name=\"ant.dir\" value=\"jakarta-ant-1.3\" />\n\n    <!-- The base classpath for the junit tests -->\n    <path id=\"test.classpath\">\n        <pathelement path=\".\" />\n        <pathelement path=\"${ant.dir}/lib/ant.jar\" />\n        <pathelement path=\"${ant.dir}/lib/crimson.jar\" />\n        <pathelement path=\"${ant.dir}/lib/optional.jar\" />\n        <pathelement path=\"${ant.dir}/lib/junit.jar\" />\n    </path>\n\n    <target name=\"build\">\n        <available property=\"junit.present\" \nclassname=\"junit.framework.TestCase\" />\n        <javac srcdir=\".\">\n           <include name=\"TestTimeout.java\" />\n        </javac>\n    </target>\n\n    <target name=\"run\" depends=\"build\">\n        <junit printsummary=\"yes\" haltonfailure=\"yes\" fork=\"true\"\n            timeout=\"10000\"\n        >\n            <classpath>\n                <path refid=\"test.classpath\" />\n            </classpath>\n            <formatter type=\"xml\" usefile=\"true\" />\n\n            <test name=\"TestTimeout\" />\n        </junit>\n    </target>\n</project>\n\n// TestTimeout.java\nimport junit.framework.TestCase;\nimport junit.framework.TestSuite;\n\npublic class TestTimeout extends TestCase\n{\n    public TestTimeout(String name)\n    {\n        super(name);\n    }\n\n    protected void setUp() throws Exception\n    {\n    }\n\n    public void testSleep() throws Exception\n    {\n       Thread.currentThread().sleep(15*1000);\n    }\n\n    public static void main(java.lang.String[] args)\n    {\n        System.setErr(System.out);\n        TestSuite suite = new TestSuite(TestTimeout.class);\n        junit.textui.TestRunner.run(suite);\n    }\n\n}", "attachment_id": null, "id": 3490, "creator": "Scott_Stark@displayscape.com", "time": "2001-07-07T20:51:47Z", "bug_id": 2499, "creation_time": "2001-07-07T20:51:47Z", "is_private": false}, {"count": 1, "tags": [], "creator": "sbailliez@apache.org", "text": "This is unfortunately a problem...since the VM used to run the test is the one \nthat logs to the file, when the Ant VM that contains the watchdog thread will \nkill the VM, there will be no way to log into the file the status :-(\nUnless I'm missing something but this is definitely why it should be \ninteresting to receive events via RMI or something and thus the listener will \nnot be in the same VM as the TestCase.", "id": 4192, "time": "2001-07-31T13:59:25Z", "bug_id": 2499, "creation_time": "2001-07-31T13:59:25Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "bodewig@apache.org", "is_private": false, "count": 2, "id": 4294, "time": "2001-08-06T02:19:20Z", "bug_id": 2499, "creation_time": "2001-08-06T02:19:20Z", "text": "As Stephane points out, there is no simple fix as Ant doesn't have access to the\noutput a formatter may create when it kills a test - changed the severity to\nenhancement as it will need some major changes to the task's framework that\nwon't make it into the next release."}, {"count": 3, "tags": [], "bug_id": 2499, "text": "*** Bug 14225 has been marked as a duplicate of this bug. ***", "id": 25682, "time": "2002-11-05T13:01:20Z", "creator": "bodewig@apache.org", "creation_time": "2002-11-05T13:01:20Z", "is_private": false, "attachment_id": null}, {"attachment_id": 3749, "tags": [], "creator": "jkf@apache.org", "is_private": false, "count": 4, "id": 25729, "time": "2002-11-05T22:23:28Z", "bug_id": 2499, "creation_time": "2002-11-05T22:23:28Z", "text": "Created attachment 3749\nPatch to ensure file output is generated with an error when test times out"}, {"count": 5, "tags": [], "bug_id": 2499, "text": "Looks as if Martijn had found an easy fix that Stephane and I have missed, thanks.\n\nPatch has been applied in CVS.", "id": 25762, "time": "2002-11-06T10:51:12Z", "creator": "bodewig@apache.org", "creation_time": "2002-11-06T10:51:12Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 2499, "attachment_id": null, "text": "This is what I'm looking for but... it doesn't appear to be in ant 1.6 was it\nskipped ? ", "id": 84242, "time": "2006-01-05T05:28:30Z", "creator": "nigel@stsoftware.com.au", "creation_time": "2006-01-05T05:28:30Z", "is_private": false}, {"count": 7, "tags": [], "creator": "mbenson@apache.org", "text": "SVN history (imported from CVS) shows that this was in Ant 1.6.0 ...", "id": 84268, "time": "2006-01-05T16:14:15Z", "bug_id": 2499, "creation_time": "2006-01-05T16:14:15Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 45766, "text": "watchdog_interval can be set to number of seconds for watchdog thread. The code seems to indicate that if default value is used (0) that maintenance happens in HttpExtensionProc\n\n        if (!watchdog_interval)\n            wc_maintain(logger);\n\n\nhowever\n\nstatic DWORD WINAPI watchdog_thread(void *param)\n{\n    if (JK_IS_DEBUG_LEVEL(logger)) {\n        jk_log(logger, JK_LOG_DEBUG,\n               \"Watchdog thread initialized\");\n    }\n    while (is_inited) {\n        Sleep(watchdog_interval * 1000);\n        if (!is_inited)\n            break;\n        // debug\n        if (JK_IS_DEBUG_LEVEL(logger)) {\n            jk_log(logger, JK_LOG_DEBUG,\n                   \"Watchdog thread running\");\n        }\n        wc_maintain(logger);\n    }\n    return 0;\n}\n\nstarts anyway creating gigabytes of log if in debug. I modified the code to:\n\nstatic DWORD WINAPI watchdog_thread(void *param)\n{\n    if (JK_IS_DEBUG_LEVEL(logger)) {\n        jk_log(logger, JK_LOG_DEBUG,\n               \"Watchdog thread initialized\");\n    }\n    // check if no watchdog\n    if (watchdog_interval == 0) break;\n    while (is_inited) {\n        Sleep(watchdog_interval * 1000);\n        if (!is_inited)\n            break;\n        // debug\n        if (JK_IS_DEBUG_LEVEL(logger)) {\n            jk_log(logger, JK_LOG_DEBUG,\n                   \"Watchdog thread running\");\n        }\n        wc_maintain(logger);\n    }\n    return 0;\n}\n\nwhich resolves the issue. I believe that was the original intent not to start the watchdog thread. Probably the best would be not to start the thread in the first place, by modifying tail end of init_jk\n\n    if (rc) {\n        HANDLE wt;\n        DWORD  wi;\n        wt = CreateThread(NULL, 0, watchdog_thread, NULL, 0, &wi);\n        jk_log(logger, JK_LOG_INFO, \"%s initialized\", (VERSION_STRING) );\n    }\n    return rc;\n}\n\n\nto \n\n    if ((rc) && (watchdog_interval)) {\n        HANDLE wt;\n        DWORD  wi;\n        wt = CreateThread(NULL, 0, watchdog_thread, NULL, 0, &wi);\n        jk_log(logger, JK_LOG_INFO, \"%s initialized\", (VERSION_STRING) );\n    }\n    return rc;\n\nbut i have not tested this change yet.", "id": 120474, "time": "2008-09-08T13:06:03Z", "creator": "zdenek@datacrunch.net", "creation_time": "2008-09-08T13:06:03Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 45766, "text": "I tested the modification of tail end of init_jk from:\n\n    if (rc) {\n        HANDLE wt;\n        DWORD  wi;\n        wt = CreateThread(NULL, 0, watchdog_thread, NULL, 0, &wi);\n        jk_log(logger, JK_LOG_INFO, \"%s initialized\", (VERSION_STRING) );\n    }\n    return rc;\n}\n\n\nto:\n\n    if ((rc) && (watchdog_interval)) {\n        HANDLE wt;\n        DWORD  wi;\n        wt = CreateThread(NULL, 0, watchdog_thread, NULL, 0, &wi);\n        jk_log(logger, JK_LOG_INFO, \"%s initialized\", (VERSION_STRING) );\n    }\n    return rc;\n\nand it appears to work properly. Please review and update code if appropriate.", "id": 120525, "time": "2008-09-10T11:59:06Z", "creator": "zdenek@datacrunch.net", "creation_time": "2008-09-10T11:59:06Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 45766, "text": "Patch applied. Thanks.", "id": 120531, "time": "2008-09-10T22:48:09Z", "creator": "mturk@apache.org", "creation_time": "2008-09-10T22:48:09Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 60256, "attachment_id": 34373, "id": 194423, "time": "2016-10-14T13:14:33Z", "creator": "tallison@mitre.org", "creation_time": "2016-10-14T13:14:33Z", "is_private": false, "text": "Created attachment 34373\nTriggering embedded object\n\nOn TIKA-2115, Thomas Galla recently reported an OOM reading an embedded OLE10Native object.  I suspect something is going wrong with reading the length in OLE10Native's initialization code.\n\nEmbedded .bin file attached.\n\nCode to reproduce:\n\n        POIFSFileSystem fs = new POIFSFileSystem(getResourceAsStream(\"/test-documents/ole_1_0_oom.bin\"));\n        Ole10Native ole = Ole10Native.createFromEmbeddedOleObject(fs);"}, {"count": 1, "text": "triggering doc and \"ignored\" test stub added to TestOle10Native in r1764890.", "bug_id": 60256, "is_private": false, "id": 194424, "time": "2016-10-14T13:23:18Z", "creator": "tallison@mitre.org", "creation_time": "2016-10-14T13:23:18Z", "tags": [], "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 60256, "text": "The ole10Native object looks like a list of urls and keys...Corrupt data?\n\nShould we add a length check in Ole10Native and call it a day?\n\n        if (dataSize > data.length-ofs) {\n            throw new Ole10NativeException(\"calculated data size > input byte array-offset\");\n        }\n        dataBuffer = new byte[dataSize];", "id": 194427, "time": "2016-10-14T13:58:16Z", "creator": "tallison@mitre.org", "creation_time": "2016-10-14T13:58:16Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "tallison@mitre.org", "attachment_id": null, "is_private": false, "id": 194429, "time": "2016-10-14T14:41:37Z", "bug_id": 60256, "creation_time": "2016-10-14T14:41:37Z", "text": "Y, this OLE object has no size NativeDataSize, which is required according to.  We're reading the actual data \"ybut\" as the length.\n\nI'll add the size check and close this out.\n\n[1] https://msdn.microsoft.com/en-us/library/dd942053.aspx"}, {"count": 4, "text": "r1764927 \n\nI added a length check.  We'll now get an exception for the embedded object because it is corrupt.  Please re-open if I've misunderstood the OLE10Native format.", "bug_id": 60256, "is_private": false, "id": 194431, "time": "2016-10-14T15:01:02Z", "creator": "tallison@mitre.org", "creation_time": "2016-10-14T15:01:02Z", "tags": [], "attachment_id": null}]
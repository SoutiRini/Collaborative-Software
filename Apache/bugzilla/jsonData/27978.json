[{"count": 0, "tags": [], "bug_id": 27978, "attachment_id": null, "id": 54729, "time": "2004-03-26T11:54:14Z", "creator": "mistadl@bigfoot.com", "creation_time": "2004-03-26T11:54:14Z", "is_private": false, "text": "URLTag showed a strange behavior\n\n\n\n\nAn URLTag was nested inside of a BodyTagSupport based Tag, another URLTag was \npositioned before.\n\n\n\n\nWhen there were 2 URLTags and 1 of it nested, the output of both was written \nbefore the BodyTag output instead of: one output before and one nested.\n\n\n\n\n\n\njsp:\n\n\n\n\n<%@taglib uri=\"http://jakarta.apache.org/taglibs/io-1.0\" prefix=\"io\" %>\n\n\n<%@taglib uri=\"http://testtags\" prefix=\"tt\" %>\n\n\n\n\n<io:request url=\"file:/C:/foo.txt\" />\n\n\n\n\n<tt:writebodycontent>\n\n\n\tahead\n\n\n\t\t<io:request url=\"file:/C:/foo.txt\" />\n\n\n\tafter\n\n\n</tt:writebodycontent>\n\n\n\n\n---\n\n\n\n\nOutput: \n\n\n\n\n[content of foo.txt] [content of foo.txt] (writebodycontent: ahead after ) \n\n\n\n\nthis is incorrect. The second \"[content of foo.txt]\" must be nested between \n\"ahead after\", i.e. inside of the output of the writebodycontent tag. If only \none URLTag output is used, the nesting works. If two, no more. This is the bug.\n\n\n\n\n\n\n---\n\n\n\n\ntemporary Resolution: Changed readURL() method in URLTag.java to avoid class \ncasting of the java.io.Writer\n\n\n\n\nAfter this the output was as expected:\n\n\n\n\n[content of foo.txt] (writebodycontent: ahead [content of foo.txt] after ) \n\n\n\n\n\n\n---\n\n\n\n\nAttachment 1: \n\n\nChanged readURL() method in URLTag.java\n\n\ndemonstration purpose: avoiding cast to JSPWriter to java.io.Writer \n\n\n\n\n\n\n    protected void readURL() throws IOException, JspException {\n\n\n        Tag parent = getParent();\n\n\n        if ( writer == null && parent instanceof PipeConsumer ) {\n\n\n            PipeConsumer consumer = (PipeConsumer) parent;\n\n\n            consumer.setReader( getURLReader() );\n\n\n        }\n\n\n        else {\n\n\n            if ( writer == null ) {\n\n\n                writer = pageContext.getOut();\n\n\n            }\n\n\n\n\n            Reader reader = getURLReader();\n\n\n            try {\n\n\n\n\n                //PipeHelper.pipe( reader, writer );\n\n\n\n\n\t\t\t\t// code of PipeHelper inserted here\n\n\n\t\t\t\tchar[] buffer = new char[ 50000 ];\n\n\n\t\t\t\ttry {\n\n\n\t\t\t\t\twhile (true) {\n\n\n\t\t\t\t\t\tint size = reader.read( buffer );\n\n\n\t\t\t\t\t\tif ( size <= 0 ) {\n\n\n\t\t\t\t\t\t\treturn;\n\n\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t//writer.write( buffer, 0, size );\n\n\n\t\t\t\t\t\t\n\n\n\t\t\t\t\t\t//this is the difference. Class cast avoided\n\n\n\t\t\t\t\t\tpageContext.getOut().write( buffer, 0, size );\n\n\n\t\t\t\t\t}\n\n\n\t\t\t\t}\n\n\n\t\t\t\tfinally {\n\n\n\t\t\t\t\ttry {\n\n\n\t\t\t\t\t\treader.close();\n\n\n\t\t\t\t\t}\n\n\n\t\t\t\t\tcatch (Exception e) {\n\n\n\t\t\t\t\t}\n\n\n\t\t\t\t}\n\n\n            } catch (Exception ex) {\n\n\n\t\t\t\tpageContext.getOut().print(ex.toString());\n\n\n            }\n\n\n        }\n\n\n    }\n\n\n\n\n\n\n---\n\n\n\n\nAttachment 2: \n\n\nwritebodycontent Tag used for demonstration\n\n\n\n\n\n\npackage test;\n\n\n\n\nimport javax.servlet.jsp.*;\n\n\nimport javax.servlet.jsp.tagext.*;\n\n\nimport java.io.*;\n\n\n\n\npublic class WriteBodyContentTag extends BodyTagSupport {\n\n\n\n\n    public int doStartTag() {\n\n\n        return EVAL_BODY_BUFFERED;\n\n\n    }\n\n\n\n\n    public int doEndTag() throws JspException {\n\n\n\n\n        if( (bodyContent == null) ) {\n\n\n            return EVAL_PAGE;\n\n\n        }\n\n\n\n\n        try {\n\n\n\t\t\tgetBodyContent().getEnclosingWriter().print (\n\n\n\t\t\t\t\"(writebodycontent: \"+ bodyContent.getString() + \")\");\n\n\n\t\t\t\n\n\n        } catch (IOException e) {\n\n\n            throw new JspException(e.toString());\n\n\n        }\n\n\n        \n\n\n        return SKIP_BODY;\n\n\n    }\n\n\n}\n\n\n\n\n\n\n---\n\n\nAttachment 3:\n\n\nTLD for writebodycontent Tag\n\n\n\n\n\n\n\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n\n<!DOCTYPE taglib PUBLIC \"-//Sun Microsystems, Inc.//DTD JSP Tag Library 1.1//EN\" \n\n\n\"http://java.sun.com/j2ee/dtds/web-jsptaglibrary_1_1.dtd\">\n\n\n<taglib>\n\n\n  <tlibversion>1.0</tlibversion>\n\n\n  <jspversion>1.1</jspversion>\n\n\n  <uri>http://testtags</uri>\n\n\n  <tag>\n\n\n    <name>writebodycontent</name>\n\n\n    <tagclass>test.WriteBodyContentTag</tagclass>\n\n\n    <bodycontent>JSP</bodycontent>\n\n\n    <info>Simply write out bodycontent</info>\n\n\n  </tag>\n\n\n</taglib>"}, {"count": 1, "tags": [], "creator": "bayard@apache.org", "attachment_id": null, "id": 132407, "time": "2009-11-29T19:39:00Z", "bug_id": 27978, "creation_time": "2009-11-29T19:39:00Z", "is_private": false, "text": "Resolving. Taglib has been retired."}]
[{"count": 0, "tags": [], "text": "In our test-cases we would like to handle \n\nEndpoint.onClose(Session session, CloseReason closeReason) {}\n\nBut looks the code isn't reachable.\n\nWsSession does:\n\n  state = State.CLOSED_SENT;\n\n...\n\n  sendCloseMessage(closeReasonMessage);\n\nWhere we have the code like in WsRemoteEndpointImplBase.startMessageBlock:\n\n    FutureToSendHandler f2sh = new FutureToSendHandler(wsSession);\n    startMessage(opCode, payload, last, f2sh);\n    try {\n        if (timeout == -1) {\n            f2sh.get();\n        } else {\n            f2sh.get(timeout, TimeUnit.MILLISECONDS);\n    }\n\nThat f2sh.get() does this:\n\n    wsSession.registerFuture(this);\n\nwhere:\n\n    if (isOpen()) {\n         futures.put(f2sh, f2sh);\n\n    }\nis false because our state is State.CLOSED_SENT not like:\n\n    state == State.OPEN || state == State.SENDING_CLOSED\n\nTherefore we never get result from that Future and our onClose() test fail.\n\nYou can find more info in the bug57489, especially https://bz.apache.org/bugzilla/show_bug.cgi?id=58624#c13 and its attachment.\n\nThe related Spring Integration JIRA: https://jira.spring.io/browse/INT-3909.\n\nThank you in advance!", "attachment_id": null, "id": 188481, "creation_time": "2016-02-16T17:54:09Z", "time": "2016-02-16T17:54:09Z", "creator": "abilan@pivotal.io", "bug_id": 59014, "is_private": false}, {"count": 1, "tags": [], "bug_id": 59014, "attachment_id": null, "is_private": false, "id": 188713, "time": "2016-02-23T13:50:28Z", "creator": "markt@apache.org", "creation_time": "2016-02-23T13:50:28Z", "text": "I've added the referenced test case to 9.0.x and 8.0.x. It passes with 9.0.x but not 8.0.x. I'm looking at a fix now."}, {"count": 2, "tags": [], "text": "Fixed in 8.0.x and 7.0.x. The fix will be included in 8.0.33 and 7.0.69 onwards.", "attachment_id": null, "id": 188715, "creation_time": "2016-02-23T15:01:33Z", "time": "2016-02-23T15:01:33Z", "creator": "markt@apache.org", "bug_id": 59014, "is_private": false}, {"count": 3, "tags": [], "creator": "abilan@pivotal.io", "attachment_id": null, "id": 188717, "time": "2016-02-23T15:16:06Z", "bug_id": 59014, "creation_time": "2016-02-23T15:16:06Z", "is_private": false, "text": "Thank you, Mark, for the fix!\n\nI would like to know if I can test it from my perspective against the 8.0.33 BUILD-SNAPSHOT.\n\nFrom other side let us know when you are going to release those maintenance versions."}, {"count": 4, "tags": [], "text": "There are no automatic snapshots although we can trigger one manually if that would be easier than you building from source.\n\n8.0.x releases on a roughly monthly release cycle. I tend to start preparation at the start of the month with the release being generally available some time in the second week.", "attachment_id": null, "bug_id": 59014, "id": 188718, "time": "2016-02-23T15:18:36Z", "creator": "markt@apache.org", "creation_time": "2016-02-23T15:18:36Z", "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 59014, "text": "Fair enough, Mark!\n\nWe definitely can wait for middle of March for the release. That is fully upfront in time with all our Spring release train in the May around Spring Boot 1.4.\n\nMeanwhile I really would like to ask you about BUILD-SNAPSHOT. Not sure that check out the full Tomcat source code and build it locally would be easier for me :-).\n\nThank you again!", "id": 188720, "time": "2016-02-23T15:26:11Z", "creator": "abilan@pivotal.io", "creation_time": "2016-02-23T15:26:11Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "text": "It has been a while since I ran the snapshot publishing script. It is currently running and looks OK so far. Give it about 15 mins and you should have a complete 8.0.x snapshot of the current trunk under:\nhttps://repository.apache.org/content/groups/snapshots/org/apache/tomcat/\n\nLet us know how you get on with it.", "attachment_id": null, "id": 188721, "creation_time": "2016-02-23T15:39:45Z", "time": "2016-02-23T15:39:45Z", "creator": "markt@apache.org", "bug_id": 59014, "is_private": false}, {"count": 7, "tags": [], "creator": "abilan@pivotal.io", "attachment_id": null, "id": 188722, "time": "2016-02-23T16:01:20Z", "bug_id": 59014, "creation_time": "2016-02-23T16:01:20Z", "is_private": false, "text": "Well, Mark, looks like we are really good with the fix:\n\n:spring-integration-websocket:compileTestJava                                                                                      \nDownload https://repository.apache.org/content/groups/snapshots/org/apache/tomcat/embed/tomcat-embed-websocket/8.0-SNAPSHOT/tomcat-embed-websocket-8.0-20160223.155055-9.pom\nDownload https://repository.apache.org/content/groups/snapshots/org/apache/tomcat/embed/tomcat-embed-core/8.0-SNAPSHOT/tomcat-embed-core-8.0-20160223.154911-17.pom\nDownload https://repository.apache.org/content/groups/snapshots/org/apache/tomcat/embed/tomcat-embed-websocket/8.0-SNAPSHOT/tomcat-embed-websocket-8.0-20160223.155055-9.jar\nDownload https://repository.apache.org/content/groups/snapshots/org/apache/tomcat/embed/tomcat-embed-core/8.0-SNAPSHOT/tomcat-embed-core-8.0-20160223.154911-17.jar\n:spring-integration-websocket:processTestResources                                         \n:spring-integration-websocket:testClasses                 \n:spring-integration-websocket:testAll                                                                                      \nDownload https://repository.apache.org/content/groups/snapshots/org/apache/tomcat/embed/tomcat-embed-logging-log4j/8.0-SNAPSHOT/tomcat-embed-logging-log4j-8.0-20160223.155143-17.pom\nDownload https://repository.apache.org/content/groups/snapshots/org/apache/tomcat/embed/tomcat-embed-logging-log4j/8.0-SNAPSHOT/tomcat-embed-logging-log4j-8.0-20160223.155143-17.jar\n                                                                                                                           \nBUILD SUCCESSFUL\n               \nTotal time: 1 mins 11.597 secs\n\n\nThank you very much!\n\nCheers,\nArtem"}, {"count": 8, "tags": [], "creator": "violetagg@apache.org", "text": "*** Bug 59177 has been marked as a duplicate of this bug. ***", "id": 189456, "time": "2016-03-14T11:04:02Z", "bug_id": 59014, "creation_time": "2016-03-14T11:04:02Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "saleems@dunnsolutions.com", "text": "This was reported by a user for TC 3.3. I have found it on 3.2.3 on HPUX as \nwell. The attached code works perfectly on TC 3.2.3 on Win NT 4 SP 6. Fails \nalways (i.e. HttpSessionBindingListener objects never get an unbound event) \nwhen sessions expire on HPUX. \n\nThe following two JSP's demonstrate the bug. Install them in any web-\napplication. Open Monitor.jsp in a browser (it refreshes every 5 secs). Open \nSessionTest.jsp in another (Monitor should now show the new session) and then \nclose the \"SessionTest\" browser window. After \"session-timeout\" minutes, the \nrow should vanish in the \"Monitor\" browser. It does on Windows. It does not on \nHPUX.\n\nThank you.\n\n----------- Begin Monitor.jsp --------------------------\n<%@ page import=\"java.util.Map, java.util.Iterator\" %>\n<html><head>\n<title>Test Monitor</title>\n<META http-equiv=\"Refresh\" content=\"5\">\n</head>\n<body>\n<h1>Monitor</h1>\nCurrent time is <%= new java.util.Date().toString() %>\n<h2>Bound objects</h2>\n<table border = \"1\">\n<tr><th>Session ID</th><th>Object Info</th></tr>\n<%\nServletContext context = this.getServletConfig().getServletContext();\nMap map = (Map)context.getAttribute(\"VALID_SESSIONS\");\nif (map != null) {\n  for (Iterator iter = map.keySet().iterator(); iter.hasNext() ; ) {\n    Object key = iter.next();\n    Object val = map.get(key);\n%>\n<tr><td><%= key %></td><td><%= val %></td></tr>\n<%\n  }\n}\n%>\n</table>\n</body>\n----------- End Monitor.jsp --------------------------\n----------- Begin SessionTest.jsp --------------------------\n<%@ page import=\"java.util.Map, java.util.Date, java.util.Hashtable, \njava.util.Iterator\" %>\n<html>\n<head><title>Session Test</title></head>\n<body>\n<h1>Session Test</h1>\n<%!\nclass SessionSquatter implements HttpSessionBindingListener {\n  private Date myDate;\n  private String myId;\n  SessionSquatter(String id) {\n    this.myDate = new Date();\n    this.myId = id;\n  }\n  public String toString() {\n    return  \"Squatter for session \" + myId + \" created at \" + myDate.toString();\n  }\n  public void valueBound(HttpSessionBindingEvent event) {\n    bound(myId, this);\n  }\n  public void valueUnbound(HttpSessionBindingEvent event) {\n    unbound(myId);\n  }\n}\n%>\n<%!\nprivate void bound(String id, SessionSquatter squatter) {\n  ServletContext context = this.getServletConfig().getServletContext();\n  Map map = (Map)context.getAttribute(\"VALID_SESSIONS\");\n  if (map == null) {\n    map = new Hashtable(10);\n    context.setAttribute(\"VALID_SESSIONS\", map);\n  }\n  map.put(id, squatter);\n  System.out.println(\"+++   Bound! \" + toString());\n}\n%>\n<%!\nprivate void unbound(String id) {\n  ServletContext context = this.getServletConfig().getServletContext();\n  Map map = (Map)context.getAttribute(\"VALID_SESSIONS\");\n  if (map == null) { return; }\n  map.remove(id);\n  System.out.println(\"--- Unbound! \" + toString());\n}\n%>\n<%\nServletContext context = this.getServletConfig().getServletContext();\nMap map = (Map)context.getAttribute(\"VALID_SESSIONS\");\nif (map == null) {\n  map = new Hashtable(10);\n  context.setAttribute(\"VALID_SESSIONS\", map);\n}\nString sessionId = session.getId();\nSessionSquatter squatter = new SessionSquatter(sessionId);\nsession.setAttribute(\"SQUATTER\", squatter);\n%>\nSession <%= sessionId %> contains <%= squatter.toString() %>.\n<br/><a href=\"javascript:window.close()\">Close this window.</a><br/>\n</body>\n</html>\n----------- End SessionTest.jsp --------------------------", "id": 16610, "attachment_id": null, "bug_id": 9367, "creation_time": "2002-05-23T20:58:15Z", "time": "2002-05-23T20:58:15Z", "is_private": false}, {"count": 1, "tags": [], "creator": "sriramnrn@gmail.com", "text": "I was able to reproduce this on Tomcat 3.3.2 (JDK 1.5.0, Windows XP, Firefox\n1.5.0.6).", "id": 93426, "attachment_id": null, "bug_id": 9367, "creation_time": "2006-09-12T17:04:53Z", "time": "2006-09-12T17:04:53Z", "is_private": false}, {"count": 2, "tags": [], "creator": "sriramnrn@gmail.com", "attachment_id": null, "text": "I modified the test JSPs to print the time when the binding and unbinding happens.\n\nHere are the results.\n\nI believe this is a more corerct test, and that Tomcat 3.3.2 does not have this\nproblem.\n\n==========================================================================\n2006-09-13 15:26:12 - Ctx() : Compiling: /SessionTest.jsp to SessionTest_1\n+++   Bound! SessionTest_2@1c5ddc9Wed Sep 13 15:26:15 GMT+05:30 2006\n2006-09-13 15:26:57 - Ctx() : Status code:404 request:R(  + /favicon.ico + null)\n msg:null\n2006-09-13 15:28:48 - Ctx() : Status code:404 request:R(  + /favicon.ico + null)\n msg:null\n2006-09-13 15:36:31 - Ctx() : Status code:404 request:R(  + /favicon.ico + null)\n msg:null\n--- Unbound! SessionTest_2@1c5ddc9Wed Sep 13 17:51:52 GMT+05:30 2006\n==========================================================================", "id": 93682, "time": "2006-09-17T13:20:54Z", "bug_id": 9367, "creation_time": "2006-09-17T13:20:54Z", "is_private": false}]
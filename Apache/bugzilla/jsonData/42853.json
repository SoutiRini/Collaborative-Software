[{"count": 0, "tags": [], "bug_id": 42853, "attachment_id": null, "id": 105275, "time": "2007-07-11T01:25:20Z", "creator": "bram@apache.as.avontuur.org", "creation_time": "2007-07-11T01:25:20Z", "is_private": false, "text": "Software used: tomcat-connectors version 1.2.23 (self-compiled) or 1.2.18 \n(shipped with debian/etch), in combination with apache-2.2.3 and tomcat-5.0.28\n\nAfter an upgrade of both apache and mod_jk, mod_jk no longer passes the \nrewritten path to tomcat, instead it sends the path as it was before \nmod_rewrite had its way with it.\n\nI solved the problem by downgrading to mod_jk-1.2.15, built from source.\n\nThe problem was tricky to discover, as mod_jk actually logged the rewritten \npath when I enabled logging at loglevel debug (thus proving that mod_rewrite \nhad already done its job). However, a tcp snooping session with wireshark \nrevealed that it would actually send a GET request for the original, non-\nrewritten path.\n\nAn example of the non-working situation:\n\nURL entered at the browser: http://site/snoppel\n\nmod_rewrite logs it as rewritten to: http://site/dynamic/snoppel.trp\n\nThis is what shows up in mod_jk.log:\n\n[Tue Jul 10 14:45:48 2007] [15809:30912] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (508): Attempting to map URI '/dynamic/\nsnoppel.trp' from 1 maps\n[Tue Jul 10 14:45:48 2007] [15809:30912] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (520): Attempting to map context URI '/*'\n[Tue Jul 10 14:45:48 2007] [15809:30912] [debug] \nmap_uri_to_worker::jk_uri_worker_map.c (534): Found a wildchar match mysite -> /\n*\n\nWhich seems to indicate that it will request '/dynamic/snoppel.trp' from \ntomcat. But wireshark snooping the ajp13 protocol reveals a 'REQ:GET /snoppel \nHTTP/1.1. Which happens not to exist, and thus a HTTP 404 is returned.\n\nAs mentioned, downgrading to tomcat-connectors-1.2.15 (as it was before the \nsystem upgrade) fixes this problem."}, {"count": 1, "tags": [], "bug_id": 42853, "attachment_id": null, "id": 105284, "time": "2007-07-11T05:18:57Z", "creator": "markt@apache.org", "creation_time": "2007-07-11T05:18:57Z", "is_private": false, "text": "This is a result of the fix for CVE-2007-1860\nhttp://tomcat.apache.org/security-jk.html and the changing of the default\nJkOptions +ForwardXXXX setting.\n\nA substantial volume of debate followed on the dev list which concluded with the\nadditional of a new JkOptions +ForwardURIProxy\n\nThis new option addresses the security issues of CVE-2007-1860 whilst allowing\nmodules like mod_rewrite to work correctly. This new option was made the default.\n\nThese changes will be in 1.2.24 onwards or can be obtained by building from the\nlatest source."}]
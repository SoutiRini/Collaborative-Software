[{"count": 0, "tags": [], "bug_id": 45510, "text": "I have a backend server(windows) and a reverse proxy(apache 2.2.9). It works almost well, but sometimes cause \"Proxy error\".\n\nI found some error log that may be relating to this problem.\n\n[Thu Jul 31 11:58:45 2008] [error] [client xxx.xxx.xxx.xxx] (104)Connection reset by peer: proxy: error reading status line from remote server 192.168.1.100, referer: http://example.com/apps/\n[Thu Jul 31 11:58:45 2008] [error] [client xxx.xxx.xxx.xxx] proxy: Error reading from remote server returned by /example.gif, referer: http://example.com/apps/\n\nand the config is here;\n\nProxyRequests Off\n<Location /apps/>\n    ProxyPass               http://192.168.1.100/\n    ProxyPassReverse        http://192.168.1.100/\n</Location>\n\nI have investigated the cause, and I think this problem happens right after the backend server closes connections by keep-alive timeout.\n\nIs there any way to solve this problem?", "id": 119164, "time": "2008-07-30T21:37:01Z", "creator": "yneko@yamamaya.com", "creation_time": "2008-07-30T21:37:01Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "yneko@yamamaya.com", "text": "It seems the problem happens more frequently when using with SSL.\ni.e.\n  Backend server(HTTP) <==> (TTTP)Proxy(HTTPS) <==> (HTTPS)Browser", "id": 119165, "time": "2008-07-30T22:29:46Z", "bug_id": 45510, "creation_time": "2008-07-30T22:29:46Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "rpluem@apache.org", "text": "Please set the loglevel to debug and share the results.", "id": 119166, "time": "2008-07-30T22:58:05Z", "bug_id": 45510, "creation_time": "2008-07-30T22:58:05Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 45510, "attachment_id": null, "text": "(In reply to comment #2)\n\nOK, Here is the debug log;\n\nHere is the debug log;\n\n## the previous access (success)\n[Thu Jul 31 15:48:31 2008] [debug] proxy_util.c(2102): proxy: connecting http://192.168.1.100/example.gif to 192.168.1.100:80\n[Thu Jul 31 15:48:31 2008] [debug] proxy_util.c(2195): proxy: connected /example.gif to 192.168.1.100:80\n[Thu Jul 31 15:48:31 2008] [debug] mod_proxy_http.c(1779): proxy: header only\n[Thu Jul 31 15:48:31 2008] [debug] proxy_util.c(2062): proxy: HTTP: has released connection for (192.168.1.100)\n[Thu Jul 31 15:48:31 2008] [info] [client xxx.xxx.xxx.xxx] Connection closed to child 3 with unclean shutdown (server example.com:443)\n\n... wait 3 minutes to the backend server gets keep-alive timeouts ...\n\n## now all connections to the backend has been closed by peer.\n## try to access again\n[Thu Jul 31 15:51:29 2008] [info] [client xxx.xxx.xxx.xxx] Connection to child 4 established (server example.com:443)\n[Thu Jul 31 15:51:29 2008] [info] Seeding PRNG with 144 bytes of entropy\n[Thu Jul 31 15:51:29 2008] [debug] ssl_engine_kernel.c(1752): OpenSSL: Handshake: start\n\n... long long SSL related log ...\n\n[Thu Jul 31 15:51:29 2008] [info] Initial (No.1) HTTPS request received for child 4 (server example.com:443)\n[Thu Jul 31 15:51:29 2008] [debug] mod_proxy_http.c(56): proxy: HTTP: canonicalising URL //192.168.1.100/example.gif\n[Thu Jul 31 15:51:29 2008] [debug] proxy_util.c(1488): [client xxx.xxx.xxx.xxx] proxy: http: found worker http://192.168.1.100/ for http://192.168.1.100/example.gif\n[Thu Jul 31 15:51:29 2008] [debug] mod_proxy.c(966): Running scheme http handler (attempt 0)\n[Thu Jul 31 15:51:29 2008] [debug] mod_proxy_http.c(1909): proxy: HTTP: serving URL http://192.168.1.100/example.gif\n[Thu Jul 31 15:51:29 2008] [debug] proxy_util.c(2044): proxy: HTTP: has acquired connection for (192.168.1.100)\n[Thu Jul 31 15:51:29 2008] [debug] proxy_util.c(2102): proxy: connecting http://192.168.1.100/example.gif to 192.168.1.100:80\n[Thu Jul 31 15:51:29 2008] [debug] proxy_util.c(2195): proxy: connected /example.gif to 192.168.1.100:80\n[Thu Jul 31 15:51:29 2008] [error] [client xxx.xxx.xxx.xxx] (104)Connection reset by peer: proxy: error reading status line from remote server 192.168.1.100\n[Thu Jul 31 15:51:29 2008] [debug] mod_proxy_http.c(1415): [client xxx.xxx.xxx.xxx] proxy: NOT Closing connection to client although reading from backend server 192.168.1.100 failed.\n[Thu Jul 31 15:51:29 2008] [error] [client xxx.xxx.xxx.xxx] proxy: Error reading from remote server returned by /apps/example.gif\n[Thu Jul 31 15:51:29 2008] [debug] proxy_util.c(2062): proxy: HTTP: has released connection for (192.168.1.100)\n[Thu Jul 31 15:51:29 2008] [info] [client xxx.xxx.xxx.xxx] Connection closed to child 4 with unclean shutdown (server example.com:443)\n", "id": 119167, "time": "2008-07-31T00:13:36Z", "creator": "yneko@yamamaya.com", "creation_time": "2008-07-31T00:13:36Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "rpluem@apache.org", "is_private": false, "count": 4, "id": 119170, "time": "2008-07-31T03:35:30Z", "bug_id": 45510, "creation_time": "2008-07-31T03:35:30Z", "text": "What is your backend server? An IIS?"}, {"count": 5, "tags": [], "creator": "yneko@yamamaya.com", "attachment_id": null, "is_private": false, "id": 119177, "time": "2008-07-31T04:52:26Z", "bug_id": 45510, "creation_time": "2008-07-31T04:52:26Z", "text": "(In reply to comment #4)\n> What is your backend server? An IIS?\n\nYes, an IIS, maybe Windows 2003 Server.\nThe backend works normally. No error occurs when accessing directly."}, {"count": 6, "tags": [], "bug_id": 45510, "text": "*Sigh*. This looks like a resurrection of the famous PR3770. Thus I will mark this bug as a duplicate of PR 37770. We should continue our discussion there. Can you please setup a network sniffer and sniff port 80 and IP 192.168.1.100 between your reverse proxy and you backend while reproducing the bug?\n\n*** This bug has been marked as a duplicate of bug 37770 ***", "id": 119197, "time": "2008-07-31T13:14:59Z", "creator": "rpluem@apache.org", "creation_time": "2008-07-31T13:14:59Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 45510, "text": "From this issue . I met other root cause on network config is MTU configuration.this hope for help you all", "id": 193674, "time": "2016-09-13T10:03:15Z", "creator": "teerapat.phet@gmail.com", "creation_time": "2016-09-13T10:03:15Z", "is_private": false, "attachment_id": null}]
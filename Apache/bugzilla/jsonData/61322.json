[{"attachment_id": null, "tags": [], "bug_id": 61322, "text": "After code change in 60319, connector attributes will be reported as -1 when an Executor is in use.\n\nBut in Http11Processor.disableKeepAlive(), we still use endpoint.getMaxThreads() to get max threads allowed, and when use a Executor, this returns -1, and disableKeepAlive() always return false in this case.\n\nThis issue exist from 7.0.73 to 7.0.79.\n\n\nThanks.", "count": 0, "id": 199919, "time": "2017-07-21T08:54:36Z", "creator": "song6295@gmail.com", "creation_time": "2017-07-21T08:54:36Z", "is_private": false}, {"count": 1, "tags": [], "text": "I found this issue in some of my customer environment, our application use 200 threads, and some customer have more than 300 clients, so about 100+ client can't connect to server.\n\nAfter some check, I found all thread blocked on keep-alive state and trying to read next request from socket.", "attachment_id": null, "bug_id": 61322, "id": 199920, "time": "2017-07-21T08:59:14Z", "creator": "song6295@gmail.com", "creation_time": "2017-07-21T08:59:14Z", "is_private": false}, {"count": 2, "tags": [], "text": "Another issue I found:\nWith below server configuration:\n<Executor name=\"tomcatThreadPool\" namePrefix=\"http-exec-\" maxThreads=\"4\" minSpareThreads=\"2\"/>\n<Connector executor=\"tomcatThreadPool\"  maxThreads=\"2\" />\n\nFrom document of Connector.executor, if I use Executor in Connector(so not use internalExecutor), maxThreads and other thread pool related properties will ignored(so return -1), but I found Connector's service thread count still limited by Connector.maxThreads.\ne.g. in above example, the executor has 4 threads, but in my test, only 2 clients connected and both keep alived and no more client can connect.\n\nPlease also help to check this issue. I use 7.0.75 in my tests.", "attachment_id": null, "id": 199921, "creator": "song6295@gmail.com", "time": "2017-07-21T09:13:24Z", "bug_id": 61322, "creation_time": "2017-07-21T09:13:24Z", "is_private": false}, {"count": 3, "tags": [], "text": "Thanks for the report.\n\nBoth issues are fixed in:\n- 8.0.x for 8.0.46 onwards\n- 7.0.x for 7.0.80 onwards\n\nNote since this affects the BIO connector, it does not apply to 8.5.x onwards.", "is_private": false, "bug_id": 61322, "id": 199983, "time": "2017-07-24T13:50:25Z", "creator": "markt@apache.org", "creation_time": "2017-07-24T13:50:25Z", "attachment_id": null}]
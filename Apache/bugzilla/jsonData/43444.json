[{"count": 0, "attachment_id": null, "creator": "daniel.spilker@hamburg.de", "text": "When deploying a webapp contain some TLDs and containing custom JAXP stuff, \nthe web app is not completely removed when undeploying.\n\nThe problem is that org.apache.catalina.startup.TldConfig has a static member \ntldDigester which uses a SAXParser. In my case a parser from the web app is \nbeing used. So since the parser (its class is loaded with the \nWebAppClassLoader) will be referenced from the TldConfig class (which is \nloaded with the StandardClassLoader) the web app class loader never gets \ncollected which leads to a full permspace after a few redeploys.\n\nHow to reproduce:\nCreate a WAR containing an empty web.xml and jstl-1.1.2.jar, standard-\n1.1.2.jar (both from Jakarta Taglibs project), xercesImpl-2.9.0.jar and xml-\napis-2.9.0.jar (both from Xerces project). Run a tomcat containing just the \nmanager web app. Deploy the WAR. Undeploy the WAR. Take a heap dump (e.g. \nusing jmap). Analyse the dump (e.g. using jhat). Browse to the class of \norg.apache.catalina.startup.TldConfig. See that it is being loaded by the \nStandardClassLoader. Browse to the object pointed to by the tldDigester static \nmember. Jump to the object pointed to by the parser instance member. In this \nexample it is an org.apache.xerces.jaxp.SAXParserImpl. Jump the class of this \nobject. See that it is being loaded by the WebAppClassLoader. This is why the \nWebAppClassloader will never be collected.\n\nI am using JDK 1.6.0_02.", "id": 108469, "time": "2007-09-21T04:49:52Z", "bug_id": 43444, "creation_time": "2007-09-21T04:49:52Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 43444, "attachment_id": null, "text": "Sorry, but I can not attach the WAR described above since I can not compress \nit to be smaller than 1000kb.", "id": 108470, "time": "2007-09-21T04:55:23Z", "creator": "daniel.spilker@hamburg.de", "creation_time": "2007-09-21T04:55:23Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 43444, "attachment_id": null, "id": 108471, "time": "2007-09-21T05:19:26Z", "creator": "daniel.spilker@hamburg.de", "creation_time": "2007-09-21T05:19:26Z", "is_private": false, "text": "An easy fix would be to make the tldDigester member in TldConfig not static. \nThis would cost some extra cycles when deploying applications, but that would \nbe OK for me if it fixes a memory leak."}, {"count": 3, "tags": [], "bug_id": 43444, "attachment_id": null, "text": "\n\n*** This bug has been marked as a duplicate of bug 29936 ***", "id": 115888, "time": "2008-04-25T12:18:14Z", "creator": "markt@apache.org", "creation_time": "2008-04-25T12:18:14Z", "is_private": false}]
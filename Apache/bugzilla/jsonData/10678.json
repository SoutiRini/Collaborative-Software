[{"count": 0, "tags": [], "bug_id": 10678, "attachment_id": null, "id": 19309, "time": "2002-07-11T09:45:32Z", "creator": "tk@westend.com", "creation_time": "2002-07-11T09:45:32Z", "is_private": false, "text": "Hello,\n\nI am using Apache 2.0.39, but unfortunately the REMOTE_USER environment \nvariable gets lost, when limiting access by means of .htaccess. In \ncontrast to this it is possible to limit the access in the httpd.conf file.\n\nworks:\n  Virtual Host Config:\n    <Location /dir>\n        AuthType Basic\n        AuthName Test\n        AuthUserFile /path/to/file\n        Require valid-user\n    </Location>\n\ndoesn't work:\n  .htaccess:\n        AuthType Basic\n        AuthName Test\n        AuthUserFile /path/to/file\n        Require valid-user\n\nIs there a special reason, why the REMOTE_USER variable is dropped in\nthe second case and how can I avoid this behaviour? When trying to access\na Document in \"/dir\" one is asked for password as usual, but even a simple\nShell-script just writing the environment to a file, does not show the\nREMOTE_USER variable. The script was configured using AddHandler and\nAction.\n\nAddHandler testhandler .test\nAction testhandler /cgi-bin/testscript\n\n\"testscript\" contains: \n#!/bin/sh\necho -e \"Content-Type: text/plain\\n\\nhello world\\n\";\nset > /tmp/testscript-output\n\nThanks in advance!\n\nCiao,\nThomas"}, {"count": 1, "text": "It works with Apache 1.3.26 so it's not an usage problem.", "creator": "ch@lathspell.de", "attachment_id": null, "id": 19312, "time": "2002-07-11T10:02:44Z", "bug_id": 10678, "creation_time": "2002-07-11T10:02:44Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "text": ".htaccess isn't the problem.  It seems more to be in the use of AddHandler and \nAction.\n\nIf a similar simple script exists in the directory and is executable under the \nExecCGI rules, then REMOTE_USER is passed:\n.htaccess:\n    AuthType Basic\n    AuthName Test\n    AuthUserFile /path/to/password/file\n\n    Require valid user (or Require user name)\n\nThen a script in that directory like this shows the environment variable:\n\ntest.cgi:\n#!/bin/sh\necho \"Content-Type: text/plain\"\necho\necho \"Remote User: $REMOTE_USER\"\n\nHowever, identifying such a script in an Action or Script directive causes the \nvariable to be lost somewhere, as in this as well as the case originally \noutlined:\n\nhttpd.conf:\nScript PUT /path/to/the/above/script\n\n.htaccess:\n   AuthType Basic\n   AuthName \"no REMOTE_USER\"\n   AuthUserFile /path/to/password/file\n\n   <Limit PUT>\n      Require user name\n   </Limit>\n\nand the variable REMOTE_USER does not appear.\n\n\n\n", "is_private": false, "bug_id": 10678, "id": 19492, "time": "2002-07-14T06:20:05Z", "creator": "josmhinkle@netscape.net", "creation_time": "2002-07-14T06:20:05Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 10678, "attachment_id": null, "id": 19752, "time": "2002-07-18T08:44:09Z", "creator": "tk@westend.com", "creation_time": "2002-07-18T08:44:09Z", "is_private": false, "text": "A further interesting effect occurs when using two .htaccess files.\n\n1.)\n\nhtdocs/.htaccess:\nAuthType Basic\nAuthName Test\nAuthUserFile /home/test/htdocs/.htpasswd\nRequire user b\nAddHandler test-script .sh\nAction  test-script /cgi-bin/test.cgi\n\ncgi-bin/.htaccess:\n#empty\n\nWhen trying to access a document test.sh. The server asks for user b's \npassword, but the REMOTE_USER variable doesn't exist.\n\n\n2.)\n\nhtdocs/.htaccess:\nAddHandler test-script .sh\nAction  test-script /cgi-bin/test.cgi\n\ncgi-bin/.htaccess:\nAuthType Basic\nAuthName Test\nAuthUserFile /home/test/.htpasswd\nRequire user a\n\nThe server asks for user a's password and the REMOTE_USER variable is\nshown.\n\nTo my mind this behavious is wrong because two .htaccess files are consulted,\nbut not fully applied. "}, {"count": 4, "tags": [], "bug_id": 10678, "attachment_id": null, "id": 20862, "time": "2002-08-10T01:44:05Z", "creator": "mjd-apache-bugzilla+@plover.com", "creation_time": "2002-08-10T01:44:05Z", "is_private": false, "text": "This may be the same bug as #11602.\n"}, {"count": 5, "tags": [], "text": "I encountered the same problem when moving from 1.3.12 to 2.046. As suggested \nby Joseph M. Hinkle, this has to do with mod_action, NOT .htaccess. \n\nMy config is as follows (Apache 2.046, Windows NT 4.0)\n\nAction etat-ge-tdb /cgi-bin/tdb.cgi\nAddHandler etat-ge-tdb .tdb\n\nIn my Apache 1.3.12 config, there was no access limit on the script \"tdb.cgi\".\nSome of my *.tdb files had access limits, and in those cases the REMOTE_USER \nwas appropriately passed to tdb.cgi. Now it now longer works with Apache 2. My \nworkaround was to add a \"require valid-user\" directive for /cgi-bin/tdb.cgi, \nbut this is not fully satisfactory since it is no longer possible to have \nanonymous access for some of my *.tdb files.\n\nNote : in Apache 1.3.12, I used MIME types instead of AddHandler; but this is \nnot the cause of the problem (Action with MIME types in Apache 2.046 still \ndoes not transmit the REMOTE_USER).", "is_private": false, "bug_id": 10678, "id": 39005, "time": "2003-06-18T07:41:24Z", "creator": "laurent.dami@justice.ge.ch", "creation_time": "2003-06-18T07:41:24Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 10678, "is_private": false, "count": 6, "id": 40668, "time": "2003-07-14T21:10:47Z", "creator": "nd@perlig.de", "creation_time": "2003-07-14T21:10:47Z", "text": "The problem is fixed in 2.1. The remote user of the original request will be\npassed via REDIRECT_REMOTE_USER to the script, which is even more logical than\nthe old behaviour. If you want to get REMOTE_USER direcly, you should protect\nthe script itself (which works already fine).\n\nI'll propose it for backport to 2.0 stable branch.\n\nThanks for using Apache!"}, {"count": 7, "tags": [], "bug_id": 10678, "attachment_id": null, "text": "*** Bug 11602 has been marked as a duplicate of this bug. ***", "id": 40670, "time": "2003-07-14T21:13:23Z", "creator": "nd@perlig.de", "creation_time": "2003-07-14T21:13:23Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 10678, "attachment_id": null, "is_private": false, "id": 41634, "time": "2003-07-28T10:40:23Z", "creator": "nd@perlig.de", "creation_time": "2003-07-28T10:40:23Z", "text": "*** Bug 21927 has been marked as a duplicate of this bug. ***"}, {"count": 9, "tags": [], "text": "This was fixed in 2.0.48-dev. If the target script is not protected, it will get\nthe REDIRECT_REMOTE_USER env variable, containing the original user.\nSupplying r->user to an unprotected script is wrong (even in 1.3.x) and\ntherefore not supported.", "is_private": false, "id": 41635, "creator": "nd@perlig.de", "time": "2003-07-28T10:42:49Z", "bug_id": 10678, "creation_time": "2003-07-28T10:42:49Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 10678, "attachment_id": null, "id": 59898, "time": "2004-06-25T19:28:25Z", "creator": "nd@perlig.de", "creation_time": "2004-06-25T19:28:25Z", "is_private": false, "text": "*** Bug 29812 has been marked as a duplicate of this bug. ***"}]
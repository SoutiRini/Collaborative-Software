[{"count": 0, "tags": [], "creator": "edsonrichter@hotmail.com", "attachment_id": null, "text": "I've found this interesting \"mal functioning\" in a application where I just copied the mapping portion of web.xml for a new created servlet, but forgot to change de URI.\n\nTomcat deployed the application without any warning, but when running the application only the last referenced servlet was working (like if the mapping of the first has been overwritten by the last in the XML file).\n\nI made additional tests using annotations in servlets, and the behavior of having more than one servlet with same mapping causes random access to one or another (I cannot determine a predictable way).\n\nIn order to prevent breaking existing applications, I would like to have just a \"big warning\" in the log at startup and/or deployment of the application that have more than one servlet mapped to same URL.\n\nExamples of the problem:\n\nExample 1: Web.xml\n...\n  <servlet>\n    <servlet-name>PrintDacteServlet</servlet-name>\n    <servlet-class>br.com.simfreteV1.web.PrintDacteServlet</servlet-class>\n  </servlet>\n  <servlet>\n    <servlet-name>CotacaoReportServlet</servlet-name>\n    <servlet-class>br.com.simfreteV1.web.CotacaoReportServlet</servlet-class>\n  </servlet>\n  <servlet-mapping>\n    <servlet-name>PrintDacteServlet</servlet-name>\n    <url-pattern>/secure/relatorios/Action</url-pattern>\n  </servlet-mapping>\n  <servlet-mapping>\n    <servlet-name>CotacaoReportServlet</servlet-name>\n    <url-pattern>/secure/relatorios/Action</url-pattern>\n  </servlet-mapping>\n...\n\n\nExample 2: annotations in java servlet files\n\n@WebServlet(name = \"PdfReportPrint\", urlPatterns = {\"/secure/relatorios/doReport\"})\npublic class PdfReportPrint extends AbstractBaseServlet {\n...\n\n\n@WebServlet(name = \"PrintBoletoServlet\", urlPatterns = {\"/secure/relatorios/doReport\"})\npublic class PrintBoletoServlet extends HttpServlet {\n...", "id": 164474, "time": "2013-01-08T12:58:37Z", "bug_id": 54387, "creation_time": "2013-01-08T12:58:37Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 54387, "attachment_id": null, "id": 164502, "time": "2013-01-08T21:49:54Z", "creator": "markt@apache.org", "creation_time": "2013-01-08T21:49:54Z", "is_private": false, "text": "Hmm.\n\nBefore we do anything on this I'd like to get some feedback from the Servlet EG as to what the expected behaviour is here. My personal view is that it should not be allowed and the web application should fail to start.\n\nhttp://java.net/jira/browse/SERVLET_SPEC-53"}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 164553, "creation_time": "2013-01-10T08:13:05Z", "time": "2013-01-10T08:13:05Z", "bug_id": 54387, "text": "The EG has confirmed that deployment should fail.", "is_private": false}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "This has been fixed in trunk and 7.0.x and will be included in 7.0.35 onwards.", "id": 164560, "time": "2013-01-10T12:09:35Z", "bug_id": 54387, "creation_time": "2013-01-10T12:09:35Z", "is_private": false}, {"count": 4, "tags": [], "creator": "loic.albertin@ow2.org", "attachment_id": null, "text": "Hi Mark,\n\nI totally agree with the fact that an URL should be mapped to only one Servlet.\nBut, I'd like to have your point of view and maybe the one of the Servlet EG about the following case.\n\nLet's imagine that we have a Servlet annotated with @WebServlet(\"/an/url\") and a web.xml descriptor that define the same Servlet class with a different logical name mapped to the same URL through a Servlet mapping.\n\nFrom my point of view this is actually the \"same\" Servlet which is mapped to this URL and it doesn't contradict the updated paragraph in the Servlet specification [1].\n\nWith the current Tomcat implementation this case will lead to a deployment failure. My proposed solution is that when different Servlet names with the same Servlet class are mapped to a same URL the first one defined will be chosen. This will lead to prefer the one defined in the web descriptor over annotations.\nSo, what do you think?\n\nThanks & regards,\nLo\u00efc\n\n\n[1] \"If the effective web.xml (after merging information from fragments and annotations) contains any url-patterns that are mapped to multiple servlets then the deployment must fail.\"", "id": 167385, "time": "2013-05-23T16:20:54Z", "bug_id": 54387, "creation_time": "2013-05-23T16:20:54Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 54387, "text": "My understanding is that\n\nScenario 1:\n\nServletA -> /my/path/to/servlet\nServletB -> /my/path/to/servlet\n\nRule: same path to different servlets = failure.\n\n\nScenario 2:\n\nServletA -> /my/path/to/servlet1\nServletA -> /my/path/to/servlet2\n\nRule: same servlet to different paths: success.\n\n\n\nRegards,\n\nEdson", "id": 167386, "time": "2013-05-23T16:54:01Z", "creator": "edsonrichter@hotmail.com", "creation_time": "2013-05-23T16:54:01Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 54387, "text": "(In reply to comment #4)\n> \n> Let's imagine that we have a Servlet annotated with @WebServlet(\"/an/url\")\n> and a web.xml descriptor that define the same Servlet class with a different\n> logical name mapped to the same URL through a Servlet mapping.\n> \n\n\nIn Servlet Spec 3.0, 8.1.1 @WebServlet\n\nThere is an explicit statement that these are two different servlets.\n\n\"\nIf the same servlet class is declared in the deployment\ndescriptor under a different name, a new instance of the servlet MUST be\ninstantiated.\n\"\n\nRegards\nVioleta", "id": 167387, "time": "2013-05-23T18:57:49Z", "creator": "violetagg@apache.org", "creation_time": "2013-05-23T18:57:49Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 54387, "attachment_id": null, "id": 167646, "time": "2013-06-04T07:47:45Z", "creator": "loic.albertin@ow2.org", "creation_time": "2013-06-04T07:47:45Z", "is_private": false, "text": "Hi Violeta,\n\nthank you for that clarification, I agree with you. \nI missed this statement in the specification.\n\nThanks again.\nRegards,\nLo\u00efc"}, {"count": 8, "tags": [], "bug_id": 54387, "text": "I want to understand more..\n\nhaving following configuration in deployment descriptor\n\n<servlet>\n\t<servlet-name>sn1</servlet-name>\n\t<servlet-class>com.servlets.urlpatterns.Servlet1</servlet-class>\n</servlet>\n<servlet-mapping>\n\t<servlet-name>sn1</servlet-name>\n\t<url-pattern>/s</url-pattern>\n</servlet-mapping>\n\n<servlet>\n\t<servlet-name>sn2</servlet-name>\n\t<servlet-class>com.servlets.urlpatterns.Servlet1</servlet-class>\n</servlet>\n<servlet-mapping>\n\t<servlet-name>sn2</servlet-name>\n\t<url-pattern>/s</url-pattern>\n</servlet-mapping>\n\nwhy should the server startup / app deployment fail? what makes the difference?\n\nAny how both the servlets sn1 and sn2 are referring to same Servlet1", "id": 171682, "time": "2013-12-10T13:35:34Z", "creator": "javahopper@gmail.com", "creation_time": "2013-12-10T13:35:34Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 54387, "text": "(In reply to Abdul Aziz from comment #8)\n> \n> Any how both the servlets sn1 and sn2 are referring to same Servlet1\n\nOnce you use \n<servlet-class>com.servlets.urlpatterns.Servlet1</servlet-class>\nthe servlets will point to one and the same class.\n\nBut you need to specify different url-patterns that's the case.", "id": 171684, "time": "2013-12-10T13:44:32Z", "creator": "violetagg@apache.org", "creation_time": "2013-12-10T13:44:32Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 54387, "text": "(In reply to Violeta Georgieva from comment #9)\n> (In reply to Abdul Aziz from comment #8)\n> > \n> > Any how both the servlets sn1 and sn2 are referring to same Servlet1\n> \n> Once you use \n> <servlet-class>com.servlets.urlpatterns.Servlet1</servlet-class>\n> the servlets will point to one and the same class.\n> \n> But you need to specify different url-patterns that's the case.\n\nCorrect!! My Question is, Why should the server start-up fail?\n\nWhat difference would it make if I try to access either of the servlet's with same url pattern?\n\nI agree its foolish doing so.. But failure during server up doesn't make sense, Right?\n\nEarlier versions of Tomcat used to support this (prior to 7.0.35)\n\nHowever server start-up should fail, if same url pattern refers to different servlets say\n\n<servlet>\n\t<servlet-name>sn1</servlet-name>\n\t<servlet-class>com.servlets.urlpatterns.Servlet1</servlet-class>\n</servlet>\n<servlet-mapping>\n\t<servlet-name>sn1</servlet-name>\n\t<url-pattern>/s</url-pattern>\n</servlet-mapping>\n\n<servlet>\n\t<servlet-name>sn2</servlet-name>\n\t<servlet-class>com.servlets.urlpatterns.Servlet2</servlet-class>\n</servlet>\n<servlet-mapping>\n\t<servlet-name>sn2</servlet-name>\n\t<url-pattern>/s</url-pattern>\n</servlet-mapping>", "id": 171685, "time": "2013-12-10T15:04:48Z", "creator": "javahopper@gmail.com", "creation_time": "2013-12-10T15:04:48Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Call to action: Make testcrypto configurable\n\nOriginal post to the APR Dev list:\n\nHi guys,\n\nI've switched my Windows CI from APR Util 1.5.x\nto the 1.6.x branch. Little did I know it would\ndemand NSS even though I built with OpenSSL.\n\nThis is the pertinent excerpt from the log [1],\nthe full build log (large text) can be found here [2]\nand last but not least, this is the build script [3],\nnote that I tried to set -DAPU_HAVE_NSS=OFF out of good\nsport, but it was in vain.\n\nCould you tell me what might be improved in the\nCMakeLists.txt so as the test run doesn't look for NSS?\n\nIs there anything else fishy about it? Perhaps the root\ncause is entirely different.\n\nThank you for any pointers\n\n\nCheers\n\nKarm\n\n[1] https://www.hastebin.com/umitizokor.lua\n[2] https://ci.modcluster.io/job/apr-util-windows/15/label=w2k12r2/consoleText\n[3]\nhttps://github.com/modcluster/ci.modcluster.io/blob/6a01bf9f015224271078336eebab4e258b8f9196/windows/apr-util/build.bat#L28\n\nMichal Karm Babacek\n\n--\nSent from my Hosaka Ono-Sendai Cyberspace 7", "attachment_id": null, "bug_id": 61636, "id": 201534, "time": "2017-10-19T09:08:40Z", "creator": "michal.babacek@gmail.com", "creation_time": "2017-10-19T09:08:40Z", "is_private": false}, {"count": 1, "tags": [], "text": "I'll add a conf option.", "is_private": false, "bug_id": 61636, "id": 201535, "time": "2017-10-19T09:24:25Z", "creator": "michal.babacek@gmail.com", "creation_time": "2017-10-19T09:24:25Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Created attachment 35441\nPatch for testcrypto.c", "is_private": false, "bug_id": 61636, "id": 201540, "time": "2017-10-19T11:46:31Z", "creator": "michal.babacek@gmail.com", "creation_time": "2017-10-19T11:46:31Z", "attachment_id": 35441}, {"count": 3, "tags": [], "creator": "michal.babacek@gmail.com", "attachment_id": null, "text": "Regarding the patch: attachment 35441 (GitHub branch [1])\n\nThe default behavior remains the same, see [2].\nThree new env props can be optionally set, APU_TEST_NSS=on|off, APU_TEST_OPENSSL=on|off, APU_TEST_COMMONCRYPTO=on|off\n\nHere is an example with my build where I have only OpenSSL crypto available (apr_crypto_openssl dlls):\n\n> C:\\Users\\karm\\source\\apr-util\\karm-vs\\Debug (1.6.x)\n> \u03bb set APU_TEST_NSS=off & set APU_TEST_COMMONCRYPTO=off & set \"PATH=C:\\tmp\\apr\\bin\\;C:\\tmp\\libexpat-R_2_2_0-64\\bin\\;C:\\tmp\\OpenSSL_1_0_2h-64\\bin\\;%PATH%\" & .\\testall.exe -v testcrypto\n> testcrypto          : SUCCESS\n> /Error 730061 occurred attempting to reach memcached on localhost:11211.  Skipping apr_memcache tests...\n> /Error 730061 occurred attempting to reach Redis on localhost:6379.  Skipping apr_redis tests...\n> All tests passed.\n\nLegit? WDYT?\n\nCheers\nKarm\n\n[1] https://github.com/Karm/apr-util/tree/1.6.x-BZ-61636\n[2] http://www.mergely.com/T2Hd0zGd/", "id": 201541, "time": "2017-10-19T11:49:21Z", "bug_id": 61636, "creation_time": "2017-10-19T11:49:21Z", "is_private": false}, {"count": 4, "attachment_id": null, "creator": "michal.babacek@gmail.com", "is_private": false, "id": 201545, "time": "2017-10-20T00:26:05Z", "bug_id": 61636, "creation_time": "2017-10-20T00:26:05Z", "tags": [], "text": "Passing build: https://ci.modcluster.io/job/apr-util-windows/16/label=w2k12r2/consoleText\nBuild script: https://github.com/modcluster/ci.modcluster.io/tree/master/windows/apr-util"}, {"count": 5, "tags": [], "bug_id": 61636, "attachment_id": 35441, "text": "Comment on attachment 35441\nPatch for testcrypto.c\n\nReviewing the patch, I'd rather see us inspect APU_HAVE_NSS, APU_HAVE_OPENSSL,\nAPU_HAVE_COMMONCRYPTO as emitted from the configure phase in our private or public headers. We don't rely on envvars elsewhere in the test framework.", "id": 201635, "time": "2017-10-24T14:13:26Z", "creator": "wrowe@apache.org", "creation_time": "2017-10-24T14:13:26Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 61636, "is_private": false, "text": "actually get_nss_driver() and get_openssl_driver() can test what apr-util is capable doing, can't we use those to find what we can test?\nMay with a flag checking APU_HAVE_NSS, APU_HAVE_OPENSSL,\nAPU_HAVE_COMMONCRYPTO in case we run the against what we have just compiled...", "id": 201636, "time": "2017-10-24T14:54:14Z", "creator": "jfclere@gmail.com", "creation_time": "2017-10-24T14:54:14Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "michal.babacek@gmail.com", "text": "I'll post a different patch that won't use env props then...\n\nI'm gonna explore get_*driver first, because APU_HAVE_* smells of #ifdefs, IIUC.", "id": 201637, "time": "2017-10-24T15:08:34Z", "bug_id": 61636, "creation_time": "2017-10-24T15:08:34Z", "is_private": false, "attachment_id": null}]
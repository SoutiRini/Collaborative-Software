[{"count": 0, "tags": [], "text": "A couple of weeks ago I found that sometimes there is problem with launching ant\nwhen the path which is utilized to lookup the \"jars\" contains some blanks. I\ninvestigated it and changed the code of ant-launcher a little bit. Now the path\nis converted to URI and then back to URL, so we can forget about white spaces\nand any other error-prone characters. It works perfectly for me - I think it can\nbe useful for others too.\n\n*************************************************************\nChanges in file org.apache.tools.ant.launch.Launcher.java:\n1)\nimport java.net.URLEncoder;\n2)\n    private void run(String[] args) throws LaunchException, MalformedURLException {\n//..\n        // now update the class.path property\n        StringBuffer baseClassPath\n            = new StringBuffer(System.getProperty(\"java.class.path\"));\n        if (baseClassPath.charAt(baseClassPath.length() - 1)\n                == File.pathSeparatorChar) {\n            baseClassPath.setLength(baseClassPath.length() - 1);\n        }\n//--------------- my modifications -------------------\n        URL[] tempJars = new URL[numJars] ;\n        int count = 0;\n        for(URL _url: jars)\n        {        \t         \t\n        \tFile _file = null;        \t\n        \t_file = new File(_url.getFile());\n            tempJars[count++] = _file.toURI().toURL();        \t\n        }                \n        \n        \n        System.arraycopy(tempJars, 0, jars, 0, tempJars.length);        \n//----------------- end of modifications ------------------------        \n        for (int i = 0; i < jars.length; ++i) {\n            baseClassPath.append(File.pathSeparatorChar);\n            baseClassPath.append(Locator.fromURI(jars[i].toString()));\n        }\n\n//..\n}", "is_private": false, "bug_id": 39295, "id": 87894, "time": "2006-04-13T10:18:00Z", "creator": "wherka@o2.pl", "creation_time": "2006-04-13T10:18:00Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 39295, "is_private": false, "id": 87895, "creation_time": "2006-04-13T10:21:27Z", "time": "2006-04-13T10:21:27Z", "creator": "wherka@o2.pl", "text": "Created attachment 18091\nLauncher.java - fixed the \"white spaces in path\" problem\n\nChanges from line #235 to #246", "attachment_id": 18091}, {"count": 2, "tags": [], "bug_id": 39295, "is_private": false, "id": 87899, "creation_time": "2006-04-13T11:18:26Z", "time": "2006-04-13T11:18:26Z", "creator": "kevin.jackson@it.fts-vn.com", "text": "It looks like you've used Java5 (indeed Java 1.4+) code here.  This means that\nAnt cannot be compiled on Java 1.2 compilers.\n\ntoURI() is the easiest way of encoding the space character as %20, but it's only\navailable in Java 1.4+.  For the 'enhanced' for loop, that limits the code even\nfurther to Java 1.5+\n\nI'll look into the underlying problem (spaces in path), but if you'd like to\nsubmit code that will compile under JDK 1.2 that would be great\n\nThanks for the bug report and the code.\nKev", "attachment_id": null}, {"count": 3, "tags": [], "text": "Have you verfied against ant HEAD, I think we fixed this some time ago.", "attachment_id": null, "bug_id": 39295, "id": 87950, "time": "2006-04-13T19:14:15Z", "creator": "jkf@apache.org", "creation_time": "2006-04-13T19:14:15Z", "is_private": false}, {"count": 4, "tags": [], "text": "(In reply to comment #2 and #3)\n> Have you verfied against ant HEAD, I think we fixed this some time ago.\n\nKev: Indeed I'm working on Java 1.5 - if this problem still exist I will change \nit according to 1.2 spec, but first I will check the HEAD since Martijn \nreported that it has been already fixed.\n\nMartijn: I suppose you're right, but I did not use dev code. I will check it \nsoon - just after Easter.\n\nBTW: I must say that ANT is my favourite batch-processing tool - it's SIMPLY \nTHE BEST!\n\n", "attachment_id": null, "bug_id": 39295, "id": 88098, "time": "2006-04-14T20:13:34Z", "creator": "wherka@o2.pl", "creation_time": "2006-04-14T20:13:34Z", "is_private": false}, {"count": 5, "tags": [], "creator": "mbenson@apache.org", "attachment_id": null, "id": 88100, "time": "2006-04-14T20:38:18Z", "bug_id": 39295, "creation_time": "2006-04-14T20:38:18Z", "is_private": false, "text": "batch processing tool?  Ant is a build tool... ;) (I abuse it this way too!)"}, {"count": 6, "tags": [], "bug_id": 39295, "attachment_id": null, "text": "I saw the last changes related to this bug - unfortunately they didn't fix it at\nall :-(\nI've made the test and it looked the same as previously... but they give us one\nadvantage - now we need to change one line only to make this working properly.\n\nLauncher.java[line#272(\"baseClassPath.append(Locator.fromURI(jars[i].toString()));)\"]\nto:\n************ FIX ********************\n\"baseClassPath.append(jars[i].toString());\"\n************ FIX ********************\n_______________________________________________________________________________\nSince the paths of \"jars\" have been already encoded in addPath(..) we cannot do\nthis once again here...\n_______________________________________________________________________________\n\nResult of the test with the version from repository:\n//-----------------------------------------------------\nC:\\Program Files\\tools test 2\\ant\\bin>ant\njava.lang.IllegalArgumentException\n        at java.net.URI.create(URI.java:842)\n        at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:585)\n        at org.apache.tools.ant.launch.Locator.fromURI(Locator.java:160)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:272)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:100)\nCaused by: java.net.URISyntaxException: Illegal character in path at index 16:\nfile:/C:/Program Files/Java/jdk1.5.0_05/lib/tools.jar\n        at java.net.URI$Parser.fail(URI.java:2809)\n        at java.net.URI$Parser.checkChars(URI.java:2982)\n        at java.net.URI$Parser.parseHierarchical(URI.java:3066)\n        at java.net.URI$Parser.parse(URI.java:3014)\n        at java.net.URI.<init>(URI.java:578)\n        at java.net.URI.create(URI.java:840)\n//-----------------------------------------------------\n.. and after my change:\n//-----------------------------------------------------\nC:\\Program Files\\tools test 2\\ant\\bin>ant\nBuildfile: build.xml\n     [echo] [windir]    : C:\\WINDOWS\n     [echo] [temp.dir]  : C:\\WINDOWS\\temp\n\ntest:\n     [echo] splash:  file:///C:\\Program Files/tools test 2/ant/images/winzip.jpg\n     [echo] 10:57:27 AM\n     [exec] Result: 1\n\nBUILD SUCCESSFUL\nTotal time: 7 seconds\n//-----------------------------------------------------\n\nI hope it will not harm the processing on the other OSes.\n", "id": 88414, "time": "2006-04-24T09:20:59Z", "creator": "wherka@o2.pl", "creation_time": "2006-04-24T09:20:59Z", "is_private": false}, {"count": 7, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "id": 88420, "time": "2006-04-24T11:31:31Z", "bug_id": 39295, "creation_time": "2006-04-24T11:31:31Z", "is_private": false, "text": "Can you try the current SVN ant.\nI implemently something similar to your request.\nIt uses Locator.encodeURI implemented in\nant 1.7, instead of File.toURI\n\nI have tested on linux.\nexport CLASSPATH=\"/home/preilly/a space\"\npreilly@backpack:~/tmp/a > ant -f x.xml\n\nWhere there is a jar in \"a space\" that is\nneeded by x.xml.\n"}, {"count": 8, "tags": [], "bug_id": 39295, "attachment_id": null, "text": "(In reply to comment #7)\n> Can you try the current SVN ant.\n> I implemently something similar to your request.\n> It uses Locator.encodeURI implemented in\n> ant 1.7, instead of File.toURI\n> \n> I have tested on linux.\n> export CLASSPATH=\"/home/preilly/a space\"\n> preilly@backpack:~/tmp/a > ant -f x.xml\n> \n> Where there is a jar in \"a space\" that is\n> needed by x.xml.\n> \n\nIndeed it was implemented this way, but please try to put JAVA environment in\nWindows' default location (C:\\Program Files\\Java\\..) and you'll get this error\nfor sure.\nI have just investigated it once again - in fact I gave the workaround not the\nreal solution... it works but I can give you a better one.\nThe real problem was encoding of \"tools.jar\" - it hasn't been encoded at all, so\nif you've installed JDK somewhere in \"spacing\" location you get into trouble as\nI did.\n\n\nNew refined fix:\nLauncher.java - line#258 \"jars[jars.length - 1] = toolsJar.toURL();\" should be\nchanged to:\n**************** FIX ***********************\n if (toolsJar != null) {\n        \ttry {\n        \t\tjars[jars.length - 1] = new\nURL(Locator.encodeURI(toolsJar.toURL().toString()));\n            } catch (UnsupportedEncodingException ex) {\n                throw new MalformedURLException(ex.toString());\n            }\n        }\n**************** FIX ***********************", "id": 88425, "time": "2006-04-24T12:44:07Z", "creator": "wherka@o2.pl", "creation_time": "2006-04-24T12:44:07Z", "is_private": false}, {"count": 9, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "is_private": false, "id": 88436, "time": "2006-04-24T14:17:10Z", "bug_id": 39295, "creation_time": "2006-04-24T14:17:10Z", "text": "Opps, Sorry, I did not read our previous message correctly.\nI have made the change now (after extracting the fileToURL code\nto a method). Thanks for reporting the problem and showing\nthe solution!\n\nPeter"}, {"count": 10, "tags": [], "creator": "wherka@o2.pl", "attachment_id": null, "id": 88437, "time": "2006-04-24T14:25:40Z", "bug_id": 39295, "creation_time": "2006-04-24T14:25:40Z", "is_private": false, "text": "(In reply to comment #9)\n> Opps, Sorry, I did not read our previous message correctly.\n> I have made the change now (after extracting the fileToURL code\n> to a method). Thanks for reporting the problem and showing\n> the solution!\n> \n> Peter\n\nYou're welcome :-)\n\nBTW: I'm gonna play around ANT since I found it very useful and powerfull tool,\nso I suppose I will be sending some code (fixes or extensions) from time to time..\n"}, {"count": 11, "tags": [], "text": "*** Bug 39037 has been marked as a duplicate of this bug. ***", "is_private": false, "bug_id": 39295, "id": 88768, "time": "2006-05-03T16:54:40Z", "creator": "peterreilly@apache.org", "creation_time": "2006-05-03T16:54:40Z", "attachment_id": null}]
[{"attachment_id": null, "tags": [], "bug_id": 55518, "text": "Please add a warning in the reference docs for the JDBC Sampler that not using bind variables in the query keeps the cursors in the database open (until end of test) \nExecuting a query (without bind, ie question marks) too often in a test can cause an error on the database, because of the way JDBC Prepared/Callable-Statement objects are being cached in Jmeter.\nThere is no problem in JMeter (or in the jdbc lib) and it turned out te be in our script. But it took us a day to debug...", "count": 0, "id": 169884, "time": "2013-09-03T13:14:45Z", "creator": "shautvast@gmail.com", "creation_time": "2013-09-03T13:14:45Z", "is_private": false}, {"count": 1, "tags": [], "text": "I'm not sure I follow why using bind should make a difference.\nIf it does matter, it seems to me that this may be a bug in JMeter.\n\nWould you be able to provide sample a simple test plan that shows the difference?", "attachment_id": null, "id": 169905, "creation_time": "2013-09-04T16:46:30Z", "time": "2013-09-04T16:46:30Z", "creator": "sebb@apache.org", "bug_id": 55518, "is_private": false}, {"count": 2, "tags": [], "bug_id": 55518, "attachment_id": null, "is_private": false, "id": 169936, "time": "2013-09-05T20:34:16Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-09-05T20:34:16Z", "text": "@sebb I don't think it's a bug of JMeter, it's more a feature and due to the PreparedStatement cache per connection. See perConnCache in AbstractJDBCTestElement.\n\nIf users don't use ? , then you will have one query per different value. As statements are closed only at end of test, this lead @sander test to saturate cursors.\n\nSo we could add this warning, but should we change this behaviour ?"}, {"count": 3, "tags": [], "creator": "sebb@apache.org", "is_private": false, "text": "Thanks for the explanation. Sorry I did not pick that up earlier.\n\nIt's certainly worth warning users that Prepared and Callable statements are cached, and so they should be used sparingly.\n\nIt does not make sense to drop the cache entirely, so the best we can do is either limit the number of entries somehow (drop the oldest one?) or add some way for the user to drop specific statements or perhaps limit how many times they are used.\n\nAll of this is a bit complicated, and this is the first report we have had, so I think clearer documentation may be enough unless we get more reports - and a use case as to how the strategy could be improved.", "id": 169938, "time": "2013-09-05T22:36:44Z", "bug_id": 55518, "creation_time": "2013-09-05T22:36:44Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Date: Sun Sep  8 21:00:28 2013\nNew Revision: 1520926\n\nURL: http://svn.apache.org/r1520926\nLog:\nBug 55518 - Add ability to limit number of cached PreparedStatements per connection when \"Prepared Select Statement\", \"Prepared Update Statement\" or \"Callable Statement\" query type is selected\nBugzilla Id: 55518\n\nModified:\n    jmeter/trunk/bin/jmeter.properties\n    jmeter/trunk/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/AbstractJDBCTestElement.java\n    jmeter/trunk/xdocs/changes.xml\n\n\nDate: Sun Sep  8 21:01:26 2013\nNew Revision: 1520927\n\nURL: http://svn.apache.org/r1520927\nLog:\nBug 55518 - Add ability to limit number of cached PreparedStatements per connection when \"Prepared Select Statement\", \"Prepared Update Statement\" or \"Callable Statement\" query type is selected\nDocumentation\nBugzilla Id: 55518\n\nModified:\n    jmeter/trunk/xdocs/usermanual/component_reference.xml", "is_private": false, "id": 169965, "creator": "p.mouawad@ubik-ingenierie.com", "time": "2013-09-08T21:02:02Z", "bug_id": 55518, "creation_time": "2013-09-08T21:02:02Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "Hello Sander,\nWe fixed the issue by adding a LRU Map with a default size of 100 and a property to configure it jdbcsampler.maxopenpreparedstatements.\nCould you give jenkins nightly build a try and give us feedback ?\nThanks", "id": 169966, "time": "2013-09-08T21:04:43Z", "bug_id": 55518, "creation_time": "2013-09-08T21:04:43Z", "is_private": false}]
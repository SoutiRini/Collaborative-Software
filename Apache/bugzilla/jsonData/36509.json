[{"count": 0, "attachment_id": null, "bug_id": 36509, "text": "Example: \n\nhttp://localhost/~alex/testsite/blahblahblah\n\nI have a .htaccess file in /home/alex/public_html/testsite that reads:\n\nRewriteEngine On\n#RewriteBase /~alex/testsite\nRewriteRule ^(.*?)$ url-handler.php\n\nNow according to the manual:\n\n\"The RewriteBase directive explicitly sets the base URL for per-directory\nrewrites. As you will see below, RewriteRule can be used in per-directory config\nfiles (.htaccess). There it will act locally, i.e., the local directory prefix\nis stripped at this stage of processing and your rewriting rules act only on the\nremainder. At the end it is automatically added back to the path.\"\n\nIf I leave the RewriteBase uncommented, I get this: \"The requested URL\n/home/alex/public_html/testsite/url-handler.php was not found on this server.\"\n\nSeems like some funny behaviour. Please correct me if I am wrong but this setup\nworks flawlessly with addresses without the ~ as far as I can tell.\n\nCheers", "id": 79417, "time": "2005-09-05T20:04:29Z", "creator": "alex@weej.com", "creation_time": "2005-09-05T20:04:29Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "nd@perlig.de", "text": "Maybe I'm misunderstanding you, but with this setup:\n\nRewriteEngine On\n#RewriteBase /~alex/testsite\nRewriteRule ^(.*?)$ url-handler.php\n\nmod_rewrite /of course/ takes the absolute path as URL - as documented. The\nabsolute path itself is expanded by mod_userdir, some time before mod_rewrite in\nyour .htaccess starts to work.", "id": 79422, "time": "2005-09-06T06:58:11Z", "bug_id": 36509, "creation_time": "2005-09-06T06:58:11Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "Hi\n\nWhat is causing the problem then? The virtual path is expanding from\n/~alex/testsite/blahblah to /home/alex/public_html/testsite/blahblah\n\nBut that doesn't make any sense, because there is no\n/home/alex/public_html/home/alex/public_html/testsite/blahblah\n\nDo you see what is happening?\n\nAre you suggesting this may be a bug with mod_userdir instead?\n\nAs I said before, this setup works fine if I use the virtual path\n/alex/testsite/blahblah instead.\n\nThanks", "attachment_id": null, "id": 79430, "creation_time": "2005-09-06T12:54:38Z", "time": "2005-09-06T12:54:38Z", "creator": "alex@weej.com", "bug_id": 36509, "is_private": false}, {"count": 3, "tags": [], "bug_id": 36509, "attachment_id": null, "text": "Your description is a bit ambigious. What exactly is the .htaccess now? Please\npaste it here, then we have a reasonable basis for discussions :)", "id": 79445, "time": "2005-09-06T15:01:32Z", "creator": "nd@perlig.de", "creation_time": "2005-09-06T15:01:32Z", "is_private": false}, {"count": 4, "attachment_id": null, "creator": "alex@weej.com", "text": "ok:\n\nfile:///home/alex/public_html/testsite/.htaccess:\n\n    RewriteEngine On\n    RewriteRule ^(.*?)$ url-handler.php\n\nwhen I request http://localhost/~alex/testsite/blahblah, I am told, by *Apache\nthrough the error page*, that \"The requested URL\n/home/alex/public_html/testsite/url-handler.php was not found on this server.\"\n\nThis \"URL\" would correspond to\nhttp://localhost/home/alex/public_html/testsite/url-handler.php, which would map\nto\nfile:///var/www/localhost/htdocs/home/alex/public_html/testsite/url-handler.php\nwhich doesn't exist. (My apologies, I got this wrong before.)\n\nSeeing as the CWD is file:///home/alex/public_html/testsite, I am expecting\napache to find file:///home/alex/public_html/testsite/url-handler.php and not\nfile:///var/www/localhost/htdocs/home/alex/public_html/testsite/url-handler.php.\n\nYes, I can set the RewriteBase explicitly to /~alex/testsite but this should be\nimplied anyway, and as far as I can tell it works exactly as expected on any\nvirtual path that doesn't contain a ~.\n\nIs this irregular behaviour or is this just a user error?\n\nThanks", "id": 79453, "time": "2005-09-06T16:23:42Z", "bug_id": 36509, "creation_time": "2005-09-06T16:23:42Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "creator": "nd@perlig.de", "attachment_id": null, "text": "Ok, so it's a user error ;-)\n\nThe request is processed as follows (unimportant parts left out):\n1. run mod_userdir -> resolve ~alex/testsite/blah to\n/home/alex/public_html/testsite/blah\n2. find the .htaccess files\n3. execute mod_rewrite found in .htaccess, which strips the .htaccess path from\nthe requested *filename* before matching the regexes\n(/home/alex/public_html/testsite/foo -> foo), applies the rules (foo ->\nurlhandler.php) and prefixes the result with rewritebase if the result is not\nalready an absolute url path (begins with a slash) (urlhandler.php ->\n<prefix>/urlhandler.php)\n\nIf explicitly set, the prefix is clear. If not set (from RewriteBase docs):\n| By default this prefix is the corresponding filepath itself.\n\nso, the last transformation is urlhandler.php ->\n/home/alex/public_html/testsite/urlhandler.php, which is treated as new URL. An\ninternal redirect to this url is issued and you get the 404.", "id": 79484, "time": "2005-09-07T06:35:24Z", "bug_id": 36509, "creation_time": "2005-09-07T06:35:24Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 36509, "attachment_id": null, "text": "Thanks for your explanation, but is this really expected behaviour?\n\n\"By default this prefix is the corresponding filepath itself.\"\n\nWhy are filepaths being used as request URIs? Unless you have DocumentRoot set\nat / then this is never going to find any files, surely?\n\nOK I copied the exact files in ~alex/public_html/testsite into\n/var/www/localhost/htdocs/alex/testsite and requested\nhttp://localhost/alex/testsite/blah\n\nIt works!\n\nHowever, following the same logic you applied (excuse copy and paste :P):\n\n\"1. run mod_userdir (doesn't happen)\n1a. resolve /alex/testsite/blah to\n/var/www/localhost/htdocs/testsite/blah\n2. find the .htaccess files\n3. execute mod_rewrite found in .htaccess, which strips the .htaccess path from\nthe requested *filename* before matching the regexes\n(/var/www/localhost/htdocs/testsite/foo -> foo), applies the rules (foo ->\nurlhandler.php) and prefixes the result with rewritebase if the result is not\nalready an absolute url path (begins with a slash) (urlhandler.php ->\n<prefix>/urlhandler.php)\n\n\"If explicitly set, the prefix is clear. If not set (from RewriteBase docs):\n| By default this prefix is the corresponding filepath itself.\n\n\"so, the last transformation is urlhandler.php ->\n/var/www/localhost/htdocs/testsite/urlhandler.php, which is treated as new URL. An\ninternal redirect to this url is issued and you get the 404.\" (No, it's 200 OK I\nswear!)\n\nThis logic has got to be wrong, because as far as I can see and proven by the\nfact that it works, the \"prefix\" is the original virtual path up as far as the\nRewriteRule directive (\"/alex/testsite/\"). So this would explain why it is\n200ing /alex/testsite/url-handler.php ->\n/var/www/localhost/htdocs/alex/testsite/url-handler.php\n\nPlease don't close this bug just yet! I'm sure something dodgy is going on!\n\nThanks for your time Andr\u00e9.\n\nAlex", "id": 79498, "time": "2005-09-07T11:17:29Z", "creator": "alex@weej.com", "creation_time": "2005-09-07T11:17:29Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 36509, "text": "Oops that was very sloppy, excuse me I just got out of bed :(\n\nWherever I said /var/www/localhost/htdocs/testsite I meant\n/var/www/localhost/htdocs/alex/testsite.\n\nMy bad.", "id": 79499, "time": "2005-09-07T11:21:33Z", "creator": "alex@weej.com", "creation_time": "2005-09-07T11:21:33Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "text": "The reason for this strange default is a technical one. .htaccess files are\nbound to the directory they are located in and not to a particular URI.\nFurthermore, mod_rewrite has no chance to determine which URI was actually used\n*as the base URI* for this directory. That's the reason, RewriteBase was\nintroduced at all (and makes only sense in .htaccess files / <Directory> sections).\n\nIf I would write a new mod_rewrite, I'd abstain from this default and would just\nmake RewriteBase mandatory ;).", "attachment_id": null, "id": 79521, "creation_time": "2005-09-07T14:58:09Z", "time": "2005-09-07T14:58:09Z", "creator": "nd@perlig.de", "bug_id": 36509, "is_private": false}, {"count": 9, "tags": [], "creator": "alex@weej.com", "attachment_id": null, "id": 79546, "time": "2005-09-07T17:02:51Z", "bug_id": 36509, "creation_time": "2005-09-07T17:02:51Z", "is_private": false, "text": "I still don't understand why it works on its own without mod_userdir though.\n\nSorry if it seems I am being stupid, but it seems like a conflict somehow. Can\nanyone else comment?"}, {"count": 10, "attachment_id": null, "bug_id": 36509, "text": "Ah. Hmm. Are sure, that there is no mod_userdir active? I mean, somethings maps\n~alex/ to /home/alex/public_html in the first place. This is typically\nmod_userdir (in the main httpd.conf). Can you attach the main config?", "id": 79550, "time": "2005-09-07T17:18:03Z", "creator": "nd@perlig.de", "creation_time": "2005-09-07T17:18:03Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "creator": "alex@weej.com", "attachment_id": null, "id": 79575, "time": "2005-09-07T20:00:39Z", "bug_id": 36509, "creation_time": "2005-09-07T20:00:39Z", "is_private": false, "text": "Yeah mod_userdir is active but when I try this .htaccess file anywhere not\ninvolving mod_userdir it works!\n\nFor example:\n\nhttp://localhost/alex/testsite/blah\nDocumentRoot is file:///var/www/localhost/htdocs\n.htaccess files are checked in all parent directories up to\nfile:///var/www/localhost/htdocs/alex/testsite/.htaccess.\nRewriteRule is found in the last .htaccess file.\nmod_rewrite matches the request for \"blah\" and replaces with \"url-handler.php\"\nas per the RewriteRule\nmod_rewrite tags replacement file onto the end of the current path:\n\"file:///var/www/localhost/htdocs/alex/testsite/\" + \"urlhandler.php\"\nrequest is made for file:///var/www/localhost/htdocs/alex/testsite/url-handler.php\n200 OK\n\nNow, with: http://localhost/~alex/testsite/blah\nDocumentRoot is file:///var/www/localhost/htdocs\nBut mod_userdir is enabled... what happens here?\n...\n...\n!?\n(something obviously messes up here)\nrequest is somehow made for\nfile:///var/www/localhost/htdocs/home/alex/public_html/home/alex/public_html/testsite/url-handler.php\n\nFrom the error log:\n\n[Wed Sep 07 18:58:07 2005] [error] [client 192.168.0.2] File does not exist:\n/var/www/localhost/htdocs/home\n\nHope you can figure this out better than I can!\n\nCheers Andr\u00e9\n\nAlex"}, {"count": 12, "attachment_id": null, "bug_id": 36509, "text": "Yeah, this is voodoo and I'll just have to live with it. I think I get it now\nanyway. Cheers.", "id": 80497, "time": "2005-09-27T01:19:35Z", "creator": "alex@weej.com", "creation_time": "2005-09-27T01:19:35Z", "tags": [], "is_private": false}]
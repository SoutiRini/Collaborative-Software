[{"count": 0, "tags": [], "bug_id": 31826, "text": "Hello,\n\nWould it be possible to create some sort of mechanism to catalina, that allows\n(http)requests to be executed inside an AccessControlContext that would have\ncustom DomainCombiner associated to it. At the moment (when security manager is\nturned on) servlets (and jsp pages), filters, requestdispacthers, etc. are\nexecuted within AccessControlContext with instance of\njavax.security.auth.SubjectDomainCombiner. It seems that at the moment there is\nno \"single point\" where one could say that use instance of this domain combiner\nwhen SecurityUtils.execute(...) performs Subject.doAsPrivileged(....) call.\n\nIf I have understood java security correctly there is at least two extension\npoint. One extension point is java.security.Policy and second is subclassing\n(Subject)DomainCombiner. Running catalina with custom Policy is peace of cake\nbut this domain combiner stuff seems need some adjustments to catalina codebase\n(I attach a proposal / example patch to this RFE).\n\nIn the proposal / example SecurityUtil.execute(..) has been modified so that if\ncurrent webapplication's (whose HttpServletRequest is being processed)\nWebappClassLoader (at some level in the classloader hierarcy) contains a\nreference to AccessControlContextFactory then SecurityUtil request a instance of\nAccessControlContext from that particular factory and instead of calling\nSubject.doAsPrivileged(...) it calls AccessController.doPrivileged(pea,\ncustomAccessControlContext). It is up to AccessControlContextFactory provider\nhow it creates an AccessControlContext. Only requirement would be that context\ncontains a instance (or subclass) of SubjectDomainCombiner.\nJust a brief summary of modifications that this proposal patch contains:\n\n* jakarta-tomcat-catalina/catalina/build.xml:\nexclude org.apache.catalina.security.spi.AccessControlContextFactory from\ncatalina.jar and copy it to common/classes so that Webappclassloader sees it, so\nthat webapplication specific accesscontrolcontextfactory implementation can\nreside in that particular webapp's /WEB-INF/[lib|classes] repository.\n\n* StandardContext.java:\nsetter and getter methods for accessControlContextFactoryName parameter\n(<Context ...accessControlContextFactoryName=\"fully.qualified.classname\" ..../>\n\n* webapploader.java:\nfew lines of code to create an instance of AccessControlContextFactory (if\ncurrent StandardContext has accessControlContextFactoryName attribute set) and\nassociate it to web applications WebappClassLoader.\n\nAs I mentioned this is just a proposal / example and I do realize that this\npatch contains some nasty cross package references (between catalina.security\ncatalina.loader and catalina.core).", "id": 65427, "time": "2004-10-21T12:00:06Z", "creator": "jukka.junnila@uta.fi", "creation_time": "2004-10-21T12:00:06Z", "is_private": false, "attachment_id": null}, {"attachment_id": 13167, "tags": [], "creator": "jukka.junnila@uta.fi", "is_private": false, "count": 1, "id": 65428, "time": "2004-10-21T12:03:34Z", "bug_id": 31826, "creation_time": "2004-10-21T12:03:34Z", "text": "Created attachment 13167\nAccessControlContextFactory proposal patch"}, {"count": 2, "tags": [], "bug_id": 31826, "attachment_id": null, "text": "Modificiations of this magnitude must be discussed on the tomcat-dev mailing \nfirst.  Bugzilla is not a discussion forum.  Please post your thoughts and \nideas on tomcat-dev.\n\nPlease make sure to include use-cases for this, i.e. what does it solve that \ncan't be done with Tomcat now and why someone would need it.  We are in \nsomewhat of an anti-bloat trend, removing unnecessary/unused stuff in favor or \nsimplicity, efficiency, and maintainability.", "id": 65825, "time": "2004-10-27T13:34:37Z", "creator": "yoavs@computer.org", "creation_time": "2004-10-27T13:34:37Z", "is_private": false}, {"count": 3, "tags": [], "creator": "yoavs@computer.org", "text": "I haven't seen any discussion on tomcat-dev, so I guess you've lost interest \n(which is OK).", "id": 66350, "time": "2004-11-03T15:20:52Z", "bug_id": 31826, "creation_time": "2004-11-03T15:20:52Z", "is_private": false, "attachment_id": null}]
[{"attachment_id": null, "tags": [], "bug_id": 13907, "is_private": false, "count": 0, "id": 25070, "time": "2002-10-23T20:45:56Z", "creator": "aditya@zapatec.com", "creation_time": "2002-10-23T20:45:56Z", "text": "Under 4.0.3 with the default catalina.policy and -security, JSPs in each context have \nread access to files in that context. Under 4.1.12 this behaviour seems to be broken.\n\nA test.jsp fails under 4.1.12 with the following error when run with the security \nmanager:\n\norg.apache.jasper.JasperException: access denied (java.io.FilePermission \n/usr/local/tomcat/webapps/examples/test2.new read)\n\nthe following is the content of the test JSP:\n\n<%\nString fullPath = pageContext.getServletContext().getRealPath(\"/test2.new\");\nout.println(\"Path: \" + fullPath);\njava.io.File foo = new java.io.File(fullPath);\nif (foo.exists())\n        out.println(\"Exists: \" + fullPath);\n        else {\n                out.println(\"does not exist\");\n        }\n\n%>"}, {"count": 1, "tags": [], "creator": "jfarcand@apache.org", "text": "That's the proper behaviour. You need to grant your app in catalina.policy file:\n\n\n// The permissions granted to the context WEB-INF/classes directory\n grant codeBase \"file:${catalina.home}/webapps/examples/-\" {\n      permission java.io.FilePermission \"<<ALL FILES>>, \"read\";\n };\n\nLook at your catalina.policy file :-)\n\n-- Jeanfrancois", "id": 25073, "time": "2002-10-23T21:20:00Z", "bug_id": 13907, "creation_time": "2002-10-23T21:20:00Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "aditya@zapatec.com", "text": "uh, according to the comments in catalina.policy (in two different places) and the \nbehaviour in 4.0.3 (and I see no change in either the comments or the release notes \nabout this changing in 4.1.12) the security manager is supposed to give read \npermissions on the webapp to each context. So is there documentation missing or is \nit a bug?:\n\n// ========== WEB APPLICATION PERMISSIONS \n=====================================\n\n\n// These permissions are granted by default to all web applications\n// In addition, a web application will be given a read FilePermission\n// and JndiPermission for all files and directories in its document root.\n\n\n// This file contains a default set of security policies to be enforced (by the\n// JVM) when Catalina is executed with the \"-security\" option.  In addition\n// to the permissions granted here, the following additional permissions are\n// granted to the codebase specific to each web application:\n//\n// * Read access to the document root directory\n", "id": 25074, "time": "2002-10-23T21:31:25Z", "bug_id": 13907, "creation_time": "2002-10-23T21:31:25Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 13907, "text": "You are correct.  The behavior should be for the container to programmatically \ngrant a file read permission for a context's codebase in the context's docBase \ndirectory (and all subdirectories).  You do not need to explicitly grant the \neach app a file read permission explicitly, unless you need to read outside of \nthe docBase directory.  I can confirm that Tomcat 4.0.2b1 - 4.0.5 behaves this \nway, and I believe 4.1.x is supposed to.  If not, it's a bug.", "count": 3, "id": 25075, "time": "2002-10-23T21:43:05Z", "creator": "ruvinsky@yahoo.com", "creation_time": "2002-10-23T21:43:05Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 13907, "text": "I just tested the jsp you posted with a fresh build of Tomcat 4.1 from\nthe CVS head (What will be Tomcat 4.1.13) and Jasper 2.  The FilePermission\nread for the context directory is being granted automatically and the JSP works.\n\nThis must be a problem in your local system configuration.\nCheck the unix file ownerhsip and permissions for test2.new.\nAlso try running Tomcat with java property -Djava.security.debug=access,failure\ndefined and then check the security manager debug output.\n\nOne final note, I would not grant the permission\njava.io.FilePermission \"<<ALL FILES>>, \"read\";\nto a web application, I would consider that a security risk.\n", "id": 25108, "time": "2002-10-24T10:03:46Z", "creator": "glenn@apache.org", "creation_time": "2002-10-24T10:03:46Z", "is_private": false, "attachment_id": null}]
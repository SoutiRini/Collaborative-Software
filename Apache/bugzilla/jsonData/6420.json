[{"count": 0, "text": "exchanging mod_jk.so from TC 3.3 version to 4.0.2 connectors package version\n-> loadbalanced ajp13 workers do not work anymore\n\nHi,\n\nI just ran into a problem with the loadbalancing stuff.\n\nI built mod_jk.so from the 4.0.2 connector package and replaced my\nmod_jk.so (TC3.3 Version) with this one in apache/libexec (1.3.19).\n\nBy just changing a link back and forth between the two versions, I tested\nour TC3.3 based application against the two versions of mod_jk.\nIf this is not enough and I am missing something, please let me know.\nOtherwise exactly the same setup\n\nAll works perfectly with the new mod_jk when I use normal ajp13 workers\n(one webapp), but fails when I use a loadbalancing worker pointing to\nanother webapp on a different Tomcat instance.\n\nNote, We use the loadbalancer just for switching tomcats. Only one\ninstance of the two loadbalanced Tomcats is active most of the time.\n(by changing the lbvalue)\n\nHere the relevant parts of my mod_jk.log.\n\n\nThe initialisation phase (reading the workers seems identical)\n\napachectl graceful..\n\nmod_jk.log 4.0.2 distribution  and 3.3\n\n[Tue Feb 12 15:26:45 2002]  [jk_uri_worker_map.c (383)]:\njk_uri_worker_map_t::uri_worker_map_open, rule map size is 12\n[Tue Feb 12 15:26:45 2002]  [jk_uri_worker_map.c (308)]: Into\njk_uri_worker_map_t::uri_worker_map_open, match rule\n/einsurance/=loadbalancer was added\n[Tue Feb 12 15:26:45 2002]  [jk_uri_worker_map.c (170)]: Into\njk_uri_worker_map_t::uri_worker_map_alloc\n[Tue Feb 12 15:26:45 2002]  [jk_uri_worker_map.c (362)]: Into\njk_uri_worker_map_t::uri_worker_map_open\n[Tue Feb 12 15:26:45 2002]  [jk_uri_worker_map.c (332)]: Into\njk_uri_worker_map_t::uri_worker_map_open, exact rule\n/einsurance=loadbalancer was added\n\n... (another 10 workers of type ajp13)\n\nhere the initialisation:  Loadbalancer loadbalances ajp13-01 and ajp13-02\n\n[Tue Feb 12 15:26:45 2002]  [jk_uri_worker_map.c (395)]: Into\njk_uri_worker_map_t::uri_worker_map_open, there are 12 rules\n[Tue Feb 12 15:26:45 2002]  [jk_uri_worker_map.c (409)]:\njk_uri_worker_map_t::uri_worker_map_open, done\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (88)]: Into wc_open\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (222)]: Into build_worker_map,\ncreating 8 workers\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (228)]: build_worker_map, creating\nworker loadbalancer\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (148)]: Into wc_create_worker\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (162)]: wc_create_worker, about to\ncreate instance loadbalancer of lb\n[Tue Feb 12 15:26:45 2002]  [jk_lb_worker.c (540)]: Into lb_worker_factory\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (171)]: wc_create_worker, about to\nvalidate and init loadbalancer\n[Tue Feb 12 15:26:45 2002]  [jk_lb_worker.c (411)]: Into\njk_worker_t::validate\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (148)]: Into wc_create_worker\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (162)]: wc_create_worker, about to\ncreate instance ajp13-01 of ajp13\n[Tue Feb 12 15:26:45 2002]  [jk_ajp13_worker.c (108)]: Into\najp13_worker_factory\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (171)]: wc_create_worker, about to\nvalidate and init ajp13-01\n[Tue Feb 12 15:26:45 2002]  [jk_ajp_common.c (1174)]: Into\njk_worker_t::validate\n[Tue Feb 12 15:26:45 2002]  [jk_ajp_common.c (1194)]: In\njk_worker_t::validate for worker ajp13-01 contact is tomcathost:9009\n[Tue Feb 12 15:26:45 2002]  [jk_ajp_common.c (1222)]: Into jk_worker_t::init\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (187)]: wc_create_worker, done\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (187)]: wc_create_worker, done\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (148)]: Into wc_create_worker\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (162)]: wc_create_worker, about to\ncreate instance ajp13-02 of ajp13\n[Tue Feb 12 15:26:45 2002]  [jk_ajp13_worker.c (108)]: Into\najp13_worker_factory\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (171)]: wc_create_worker, about to\nvalidate and init ajp13-02\n[Tue Feb 12 15:26:45 2002]  [jk_ajp_common.c (1174)]: Into\njk_worker_t::validate\n[Tue Feb 12 15:26:45 2002]  [jk_ajp_common.c (1194)]: In\njk_worker_t::validate for worker ajp13-02 contact is tomcathost:9019\n[Tue Feb 12 15:26:45 2002]  [jk_ajp_common.c (1222)]: Into jk_worker_t::init\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (187)]: wc_create_worker, done\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (187)]: wc_create_worker, done\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (238)]: build_worker_map, removing\nold loadbalancer worker\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (228)]: build_worker_map, creating\nworker ajp12-01\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (148)]: Into wc_create_worker\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (162)]: wc_create_worker, about to\ncreate instance ajp12-01 of ajp12\n[Tue Feb 12 15:26:45 2002]  [jk_ajp12_worker.c (268)]: Into\najp12_worker_factory\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (171)]: wc_create_worker, about to\nvalidate and init ajp12-01\n[Tue Feb 12 15:26:45 2002]  [jk_ajp12_worker.c (185)]: Into\njk_worker_t::validate\n[Tue Feb 12 15:26:45 2002]  [jk_ajp12_worker.c (197)]: In\njk_worker_t::validate for worker ajp12-01 contact is tomcathost:9007\n[Tue Feb 12 15:26:45 2002]  [jk_worker.c (187)]: wc_create_worker, done\n\n\nThis was the initialisation and now the difference when I access it:\n\n\n3.3 version of mod_jk:\n\n[Tue Feb 12 15:28:32 2002]  [jk_uri_worker_map.c (368)]: Attempting to map\nURI '/einsurance/doEntry.do'\n[Tue Feb 12 15:28:32 2002]  [jk_uri_worker_map.c (391)]:\njk_uri_worker_map_t::map_uri_to_worker, Found a context match loadbalan\ncer -> /einsurance/\n[Tue Feb 12 15:28:32 2002]  [jk_worker.c (123)]: Into wc_get_worker_for_name\nloadbalancer\n[Tue Feb 12 15:28:32 2002]  [jk_worker.c (127)]: wc_get_worker_for_name,\ndone  found a worker\n[Tue Feb 12 15:28:32 2002]  [jk_lb_worker.c (471)]: Into\njk_worker_t::get_endpoint\n[Tue Feb 12 15:28:32 2002]  [jk_lb_worker.c (300)]: Into\njk_endpoint_t::service\n[Tue Feb 12 15:28:32 2002]  [jk_ajp13_worker.c (865)]: Into\njk_worker_t::get_endpoint\n[Tue Feb 12 15:28:32 2002]  [jk_ajp13_worker.c (775)]: Into\njk_endpoint_t::service\n[Tue Feb 12 15:28:32 2002]  [jk_ajp13.c (403)]: Into ajp13_marshal_into_msgb\n[Tue Feb 12 15:28:32 2002]  [jk_ajp13.c (537)]: ajp13_marshal_into_msgb -\nDone\n[Tue Feb 12 15:28:32 2002]  [jk_connect.c (108)]: Into jk_open_socket\n[Tue Feb 12 15:28:32 2002]  [jk_connect.c (115)]: jk_open_socket, try to\nconnect socket = 38\n[Tue Feb 12 15:28:32 2002]  [jk_connect.c (124)]: jk_open_socket, after\nconnect ret = 0\n[Tue Feb 12 15:28:32 2002]  [jk_connect.c (132)]: jk_open_socket, set\nTCP_NODELAY to on\n[Tue Feb 12 15:28:32 2002]  [jk_connect.c (140)]: jk_open_socket, return, sd\n= 38\n[Tue Feb 12 15:28:32 2002]  [jk_ajp13_worker.c (189)]: In\njk_endpoint_t::connect_to_tomcat, connected sd = 38\n[Tue Feb 12 15:28:32 2002]  [jk_ajp13_worker.c (206)]: sending to ajp13 #436\n[Tue Feb 12 15:28:32 2002]  [jk_ajp13_worker.c (645)]: send_request 2:\nrequest body to send 0 - request body to resend 0\n[Tue Feb 12 15:28:34 2002]  [jk_ajp13_worker.c (258)]: received from ajp13\n#82\n\n\n\n4.0.2 version of mod_jk:\n\n[Tue Feb 12 15:27:02 2002]  [jk_uri_worker_map.c (464)]: Attempting to map\nURI '/einsurance/doEntry.do'\n[Tue Feb 12 15:27:02 2002]  [jk_uri_worker_map.c (489)]:\njk_uri_worker_map_t::map_uri_to_worker, Found a context match\nloadbalancer -> /einsurance/\n[Tue Feb 12 15:27:02 2002]  [jk_worker.c (132)]: Into wc_get_worker_for_name\nloadbalancer\n[Tue Feb 12 15:27:02 2002]  [jk_worker.c (136)]: wc_get_worker_for_name,\ndone  found a worker\n[Tue Feb 12 15:27:02 2002]  [jk_lb_worker.c (487)]: Into\njk_worker_t::get_endpoint\n[Tue Feb 12 15:27:02 2002]  [jk_lb_worker.c (306)]: Into\njk_endpoint_t::service\n[Tue Feb 12 15:27:02 2002]  [jk_ajp_common.c (1345)]: Into\njk_worker_t::get_endpoint\n[Tue Feb 12 15:27:02 2002]  [jk_ajp_common.c (1075)]: Into\njk_endpoint_t::service\n[Tue Feb 12 15:27:02 2002]  [jk_ajp_common.c (280)]: Into\najp_marshal_into_msgb\n[Tue Feb 12 15:27:02 2002]  [jk_uri_worker_map.c (447)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Tue Feb 12 15:27:02 2002]  [jk_uri_worker_map.c (464)]: Attempting to map\nURI '/einsurance/doEntry.do'\n[Tue Feb 12 15:27:02 2002]  [jk_uri_worker_map.c (489)]:\njk_uri_worker_map_t::map_uri_to_worker, Found a context match\nloadbalancer -> /einsurance/\n[Tue Feb 12 15:27:02 2002]  [jk_worker.c (132)]: Into wc_get_worker_for_name\nloadbalancer\n[Tue Feb 12 15:27:02 2002]  [jk_worker.c (136)]: wc_get_worker_for_name,\ndone  found a worker\n[Tue Feb 12 15:27:02 2002]  [jk_lb_worker.c (487)]: Into\njk_worker_t::get_endpoint\n[Tue Feb 12 15:27:02 2002]  [jk_lb_worker.c (306)]: Into\njk_endpoint_t::service\n[Tue Feb 12 15:27:02 2002]  [jk_ajp_common.c (1345)]: Into\njk_worker_t::get_endpoint\n[Tue Feb 12 15:27:02 2002]  [jk_ajp_common.c (1075)]: Into\njk_endpoint_t::service\n[Tue Feb 12 15:27:02 2002]  [jk_ajp_common.c (280)]: Into\najp_marshal_into_msgb\n[Tue Feb 12 15:27:02 2002]  [jk_uri_worker_map.c (447)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n[Tue Feb 12 15:27:02 2002]  [jk_uri_worker_map.c (464)]: Attempting to map\nURI '/einsurance/doEntry.do'\n[Tue Feb 12 15:27:02 2002]  [jk_uri_worker_map.c (489)]:\njk_uri_worker_map_t::map_uri_to_worker, Found a context match\nloadbalancer -> /einsurance/\n[Tue Feb 12 15:27:02 2002]  [jk_worker.c (132)]: Into wc_get_worker_for_name\nloadbalancer\n[Tue Feb 12 15:27:02 2002]  [jk_worker.c (136)]: wc_get_worker_for_name,\ndone  found a worker\n[Tue Feb 12 15:27:02 2002]  [jk_lb_worker.c (487)]: Into\njk_worker_t::get_endpoint\n[Tue Feb 12 15:27:02 2002]  [jk_lb_worker.c (306)]: Into\njk_endpoint_t::service\n[Tue Feb 12 15:27:02 2002]  [jk_ajp_common.c (1345)]: Into\njk_worker_t::get_endpoint\n[Tue Feb 12 15:27:02 2002]  [jk_ajp_common.c (1075)]: Into\njk_endpoint_t::service\n[Tue Feb 12 15:27:02 2002]  [jk_ajp_common.c (280)]: Into\najp_marshal_into_msgb\n[Tue Feb 12 15:27:02 2002]  [jk_uri_worker_map.c (447)]: Into\njk_uri_worker_map_t::map_uri_to_worker\n\n\nthanks for looking into this\n\nBest Regards,\nHans", "creator": "hans.schmid@einsurance.de", "is_private": false, "id": 10636, "time": "2002-02-13T09:26:38Z", "bug_id": 6420, "creation_time": "2002-02-13T09:26:38Z", "tags": [], "attachment_id": null}, {"count": 1, "text": "getting the lastest Version ans a fresh recompile fixed the problem.\nLoadbalancing works great with Tomcat 3.3\n\nThanks", "bug_id": 6420, "is_private": false, "id": 10854, "time": "2002-02-18T14:19:29Z", "creator": "hans.schmid@einsurance.de", "creation_time": "2002-02-18T14:19:29Z", "tags": [], "attachment_id": null}]
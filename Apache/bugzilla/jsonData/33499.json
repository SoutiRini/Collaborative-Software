[{"count": 0, "attachment_id": null, "bug_id": 33499, "is_private": false, "id": 70781, "time": "2005-02-10T19:59:30Z", "creator": "rici@ricilake.net", "creation_time": "2005-02-10T19:59:30Z", "tags": [], "text": "PHP calls ap_set_content_type for generated content with an explicit content-type header. It calls it \nonce at the beginning of the handler in order to set the content-type to the default (usually text/html) \nand then calls it again if the php script sends a Content-Type header.\n\nap_set_content_type attaches filters configured by AddOutputFilterByType when it is called. \nConsequently, PHP generated pages will have both the text/html output filters and the output filters for \nthe actual content type added.\n\nAs Nick Kew says in response to bug 31226, \"AddOutputFilterbyType is known to be broken.\" Fixing \nthis problem does not appear to me to be easy; I would recommend documenting ap_set_content_type \nin include/http_protocol.h to add a warning that ap_set_content_type should not be called twice for the \nsame request.\n\nI'm submitting this bug by way of documentation."}, {"count": 1, "attachment_id": null, "bug_id": 33499, "is_private": false, "id": 75868, "time": "2005-06-03T01:12:43Z", "creator": "chip@force-elite.com", "creation_time": "2005-06-03T01:12:43Z", "tags": [], "text": "I think PHP should change their behavoir, and only call ap_set_content_type when\nthey are ready to send the headers."}, {"count": 2, "attachment_id": null, "bug_id": 33499, "text": "I can't entirely agree with either of you.  Different modules may need to use  \nap_set_content_type without reference to each other.   AddOutputFilterbyType \nadds a malevolent interaction that breaks modularity. \n \nTime to propose removing AddOutputFilterbyType altogether for 2.1? ", "id": 76529, "time": "2005-06-19T16:19:29Z", "creator": "nick@webthing.com", "creation_time": "2005-06-19T16:19:29Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "nick@webthing.com", "is_private": false, "text": "*** Bug 45799 has been marked as a duplicate of this bug. ***", "id": 120576, "time": "2008-09-13T06:06:54Z", "bug_id": 33499, "creation_time": "2008-09-13T06:06:54Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 33499, "text": "This is fixed in trunk by moving the directive to mod_filter.  Won't backport - use mod_filter directly instead.", "id": 145288, "time": "2011-03-26T11:12:52Z", "creator": "nick@webthing.com", "creation_time": "2011-03-26T11:12:52Z", "is_private": false, "attachment_id": null}]
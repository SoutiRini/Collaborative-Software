[{"count": 0, "tags": [], "bug_id": 50315, "attachment_id": 26330, "text": "Created attachment 26330\ntwo .xlsx files, one's autofilter created by POI, the other one's created manually.\n\nSteps to Reproduce: \nAfter using the following code to generate a XLSX file, if you open that generated file (I attached here as \"AutofilterGeneratedWithPOI.xlsx\" in the zip file) and click autofilter to sort any of the columns, MS Excel would crash. However, if you delete the autofilter and using Excel to add it back again (I attached here as \"AutofilterGeneratedWithinExcel.xlsx\"), everything would work just fine. I recreated this scenario on two boxes and two separated projects.\n\nActual Results: \nExcel Application Crashes.\n\nBuild Date & Platform: \nWindows XP, NetBean, Excel 2007, 10/28/2011\n\nAdditional Builds and Platforms:\nWindows XP, RAD 7.5 11/15/2011, samething happens.\n\n#####################################################################\n\nimport java.io.FileOutputStream;\n\nimport org.apache.poi.ss.util.CellRangeAddress;\nimport org.apache.poi.xssf.usermodel.XSSFRow;\nimport org.apache.poi.xssf.usermodel.XSSFSheet;\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\n\n\npublic class RptJobController {\n\n\tpublic static void main(String args[]) \n\t{\t\n\t\tFileOutputStream fileOut = null;\n\t\ttry {\n\t\t\tXSSFWorkbook wb = new XSSFWorkbook();\n\t\t\tfileOut = new FileOutputStream(\"c:\\\\workbook.xlsx\");\n\t\t\tXSSFSheet sheet = wb.createSheet(\"new sheet\");\n\t\t\t// Create a row and put some cells in it.\n\t\t\tXSSFRow row = sheet.createRow((short) 0);\n\t\t\t// Create a cell and put a value in it.\n\t\t\trow.createCell(0).setCellValue(\"irrelevant\");\n\t\t\trow.createCell(1).setCellValue(\"Number\");\n\t\t\trow.createCell(2).setCellValue(\"String\");\n\n\t\t\trow = sheet.createRow((short) 1);\n\t\t\trow.createCell(1).setCellValue(1);\n\t\t\trow.createCell(2).setCellValue(\"This is a string\");\n\n\t\t\trow = sheet.createRow((short) 2);\n\t\t\trow.createCell(1).setCellValue(2);\n\t\t\trow.createCell(2).setCellValue(\"This is a string\");\n\n\t\t\trow = sheet.createRow((short) 3);\n\t\t\trow.createCell(1).setCellValue(3);\n\t\t\trow.createCell(2).setCellValue(\"This is a string\");\n\n\t\t\tsheet.setAutoFilter(CellRangeAddress.valueOf(\"B1:C1\"));\n\t\t\tsheet.autoSizeColumn((short) 2);\n\t\t\twb.write(fileOut);\n\t\t\tfileOut.close();\n\t\t} catch (Exception ex) {\n\n\t\t}\t\n\t}\n}", "id": 141926, "time": "2010-11-22T11:13:33Z", "creator": "duanxingjian@gmail.com", "creation_time": "2010-11-22T11:13:33Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 50315, "attachment_id": null, "text": "*** Bug 50314 has been marked as a duplicate of this bug. ***", "id": 141928, "time": "2010-11-22T11:21:26Z", "creator": "duanxingjian@gmail.com", "creation_time": "2010-11-22T11:21:26Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 50315, "attachment_id": null, "id": 142307, "time": "2010-12-02T10:28:47Z", "creator": "yegor@dinom.ru", "creation_time": "2010-12-02T10:28:47Z", "is_private": false, "text": "Fixed in r1041407\n\nIt turned out that autofilters must be registered in workbook.xml. Without registering Excel recognizes the autofilter but crashes when you try to use it.\n\nYegor"}]
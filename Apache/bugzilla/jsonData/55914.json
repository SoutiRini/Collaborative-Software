[{"count": 0, "tags": [], "bug_id": 55914, "attachment_id": 31138, "id": 171855, "time": "2013-12-20T12:35:57Z", "creator": "chriswaddi007@gmail.com", "creation_time": "2013-12-20T12:35:57Z", "is_private": false, "text": "Created attachment 31138\nresult of pstack on core file generated\n\nhello,\ni'm working on Solaris 10 and i've upgraded my apache from 2.2.23 to 2.4.7. Since then, i have children crashing after a graceful restart. It does not appear after each graceful restart but sometimes. When it occurs, each time i have a request in my access log, a child is crashing. Doing a normal restart is never causing this problem.\n\nHere is a extract of the error log (with LogLevel warn):\n\n[Thu Dec 19 15:51:34.905734 2013] [mpm_worker:notice] [pid 24913:tid 1] AH00297: SIGUSR1 received.  Doing graceful restart\n[Thu Dec 19 15:51:36.050587 2013] [mpm_worker:notice] [pid 24913:tid 1] AH00292: Apache/2.4.7 (Unix) mod_auth_kerb/5.4 OpenSSL/0.9.8k configured -- resuming normal operations\n[Thu Dec 19 15:51:36.050644 2013] [core:notice] [pid 24913:tid 1] AH00094: Command line: '/local/products/sslproxy/bin/httpd'\n[Thu Dec 19 15:51:36.050729 2013] [mpm_worker:warn] [pid 24913:tid 1] AH00291: long lost child came home! (pid 24915)\n[Thu Dec 19 15:52:29.076927 2013] [core:notice] [pid 24913:tid 1] AH00052: child pid 3773 exit signal Segmentation fault (11)\n[Thu Dec 19 15:53:29.093903 2013] [core:notice] [pid 24913:tid 1] AH00052: child pid 3771 exit signal Segmentation fault (11)\n[Thu Dec 19 15:54:30.111803 2013] [core:notice] [pid 24913:tid 1] AH00052: child pid 5049 exit signal Segmentation fault (11)\n[Thu Dec 19 15:55:30.129161 2013] [core:notice] [pid 24913:tid 1] AH00052: child pid 5844 exit signal Segmentation fault (11)\n\ni put the LogLevel to trace8 level to see what's happening just before the crash:\n[Thu Dec 19 18:01:07.144950 2013] [core:trace6] [pid 12540:tid 27] core_filters.c(527): [client 136.10.10.10:38372] core_output_filter: flushing because of FLUSH bucket\n[Thu Dec 19 18:01:07.147988 2013] [core:trace6] [pid 12540:tid 27] core_filters.c(527): [client 136.10.10.10:38372] core_output_filter: flushing because of FLUSH bucket\n[Thu Dec 19 18:01:07.164183 2013] [proxy:debug] [pid 12540:tid 27] proxy_util.c(2035): AH00943: http: has released connection for (eur-lex.europa.eu)\n[Thu Dec 19 18:01:07.164434 2013] [proxy_http:trace2] [pid 12540:tid 27] mod_proxy_http.c(1793): [client 136.10.10.10:38372] end body send\n[Thu Dec 19 18:01:07.200666 2013] [core:notice] [pid 24913:tid 1] AH00051: child pid 12484 exit signal Segmentation fault (11), possible coredump in /local/products/sslproxy\n[Thu Dec 19 18:01:07.200864 2013] [core:trace4] [pid 24913:tid 1] mpm_common.c(530): mpm child 12484 (gen 3/slot 1) exited\n[Thu Dec 19 18:01:08.209248 2013] [core:trace4] [pid 24913:tid 1] mpm_common.c(530): mpm child 12545 (gen 3/slot 1) started\n\nAnd i did a pstack on the core file generated. I will put it in attachment.\n\n\nDespite the traces put in place, i do not know what is causing this problem. Can  \nyou help me on this topic? I have to find the root cause otherwise i will have to go back to apache 2.2.\n\nThanks for your help ."}, {"count": 1, "tags": [], "bug_id": 55914, "attachment_id": null, "id": 171857, "time": "2013-12-20T13:19:40Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2013-12-20T13:19:40Z", "is_private": false, "text": "Could it be this problem:\n\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=50335\n\nIn that case the following two patches should help:\n\nhttp://svn.apache.org/viewvc?view=revision&revision=1534321\nhttp://svn.apache.org/viewvc?view=revision&revision=1550061\n\nDid you change any LoadModule items in configuration before doing the graceful restart?\n\nAnother possible crash I'm aware of is when using both mod_logio and mod_status. In this case explicitely setting \"ExtendedStatus Off\" should fix it.\n\nAre there any non-standard modules active?\n\nNot very likely but also possible:\n\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=54357\n\nRegards,\n\nRainer"}, {"count": 2, "tags": [], "bug_id": 55914, "attachment_id": null, "id": 171882, "time": "2013-12-22T11:47:11Z", "creator": "chriswaddi007@gmail.com", "creation_time": "2013-12-22T11:47:11Z", "is_private": false, "text": "What i can tell you is that it appears \"randomly\" only after a graceful restart. I did not change any LoadModule items before the restart and i'm not using mod_logio. The server was not stressed when it happened Concerning the modules , only standard modules are used except mod_auth_kerb. But i was already using it  with apache 2.2 release without problem.\n\n\nDetails of Loaded Modules:\n core_module (static)\n so_module (static)\n http_module (static)\n access_compat_module (shared)\n actions_module (shared)\n alias_module (shared)\n authn_core_module (shared)\n auth_basic_module (shared)\n auth_kerb_module (shared)\n authn_file_module (shared)\n authnz_ldap_module (shared)\n authz_core_module (shared)\n authz_groupfile_module (shared)\n authz_host_module (shared)\n authz_owner_module (shared)\n authz_user_module (shared)\n autoindex_module (shared)\n socache_shmcb_module (shared)\n slotmem_shm_module (shared)\n cgid_module (shared)\n dir_module (shared)\n env_module (shared)\n expires_module (shared)\n headers_module (shared)\n imagemap_module (shared)\n include_module (shared)\n info_module (shared)\n lbmethod_byrequests_module (shared)\n ldap_module (shared)\n log_config_module (shared)\n logio_module (shared)\n mime_magic_module (shared)\n mpm_worker_module (shared)\n mime_module (shared)\n negotiation_module (shared)\n proxy_module (shared)\n proxy_balancer_module (shared)\n proxy_connect_module (shared)\n proxy_http_module (shared)\n rewrite_module (shared)\n setenvif_module (shared)\n speling_module (shared)\n ssl_module (shared)\n status_module (shared)\n unique_id_module (shared)\n unixd_module (shared)\n\nI compiled with the following line:\n./configure --prefix=/local/products/revproxy --with-ldap \\\n--with-ssl=/usr/local/ssl \\\n--enable-mods-shared=\\\n\"all ssl ldap cache proxy authn_alias file_cache authnz_ldap charset_lite \\\ndav_lock cache_disk imagemap\" \\\n--with-included-apr \\\n--enable-nonportable-atomics=yes \\\n--enable-mpms-shared=all"}, {"count": 3, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "is_private": false, "id": 171883, "time": "2013-12-22T12:41:05Z", "bug_id": 55914, "creation_time": "2013-12-22T12:41:05Z", "text": "(In reply to Christophe WEIDEMANN from comment #2)\n> What i can tell you is that it appears \"randomly\" only after a graceful\n> restart. I did not change any LoadModule items before the restart and i'm\n> not using mod_logio.\n\nBut your below list of loaded modules shows mod_lgio an mod_status, so you should try whether explicitely setting\n\nExtendedStatus Off\n\nhelps (or disable loading mod_logio and check whether it actually vanished from the list of loaded modules).\n\n> The server was not stressed when it happened Concerning\n> the modules , only standard modules are used except mod_auth_kerb. But i was\n> already using it  with apache 2.2 release without problem.\n\nApart from the mod_logio problem I think it should not be the mod_ssl problem I cited, because you pstack output isn't a good fit for that problem. You might want to check a few crashes though, whether the pstack results are consistent (so that it is clear we are looking at the right debug info).\n\nIn addition to disable mod_logio or ExtendedStatus Off, suggest you try the tweo patches I mentioned:\n\nhttp://svn.apache.org/viewvc?view=revision&revision=1534321\nhttp://svn.apache.org/viewvc?view=revision&revision=1550061\n\nThat bug is not about restarts but about a pool lifecycle problem so I can't rule out that it might also manifest during a restart. Both patches are for mod_proxy_http and are very small, so easy to apply.\n\nRegards,\n\nRainer"}, {"count": 4, "tags": [], "bug_id": 55914, "attachment_id": null, "id": 172122, "time": "2014-01-06T19:46:16Z", "creator": "bash@intelerad.com", "creation_time": "2014-01-06T19:46:16Z", "is_private": false, "text": "We are experiencing the same issue with httpd-2.4.7. A graceful restart results in the child segfaulting, in this case it happens to be a mod_jk(1.2.37) child (if there is such a thing).\n\nWe have both mod_logio and mod_status loaded.\n\nWe were able to work around the problem by setting the ExtendedStatus directive to 'off'."}, {"count": 5, "tags": [], "bug_id": 55914, "attachment_id": null, "id": 172163, "time": "2014-01-08T09:51:11Z", "creator": "millennium.bug@gmail.com", "creation_time": "2014-01-08T09:51:11Z", "is_private": false, "text": "There is no debug output and no coredumps.\nI sometimes get \"failed to open stream: HTTP request failed!\"\nand segmentation fault. \nversion: httpd-2.4.7\nDisabling mod_logio and mod_status with ExtendedStatus=Off does not help in my case."}, {"count": 6, "tags": [], "creator": "n.akhnin@ftc.ru", "attachment_id": null, "text": "I'm experiencing the same issue with httpd-2.4.12, segfaulting after each graceful restart. And work around the problem by setting the ExtendedStatus directive to 'off' are worked for me too. Both of mod_logio and mod_status are loaded.", "id": 183901, "time": "2015-07-06T06:38:51Z", "bug_id": 55914, "creation_time": "2015-07-06T06:38:51Z", "is_private": false}]
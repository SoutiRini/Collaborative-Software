[{"count": 0, "tags": [], "creator": "digant@yahoo-inc.com", "attachment_id": null, "text": "Hi,\n\nWhen I use Jmeter with TLS client cert, it creates a new connection for every request, though I have keep alive on.\n\nWhen I tried to test the same it Apache httpClient directly, I noticed that we need to have one special setting in httpclinet configuration \n\n\".setUserTokenHandler(new NoopUserTokenHandler())\", \n\nin order to make httpclinet use the same connection. \n\nI was wondering if there is there any way to override httpClient configuration in Jmeter?\n\nI tried to used Jmeter 2.13 and Jmeter 3.0 and found the same issue with both.\n\nPlease suggest.", "id": 197217, "time": "2017-02-23T00:52:50Z", "bug_id": 60768, "creation_time": "2017-02-23T00:52:50Z", "is_private": false}, {"count": 1, "tags": [], "creator": "support@ubikloadpack.com", "attachment_id": null, "text": "(In reply to digant from comment #0)\n> Hi,\n> \n> When I use Jmeter with TLS client cert, it creates a new connection for\n> every request, though I have keep alive on.\n> \n> When I tried to test the same it Apache httpClient directly, I noticed that\n> we need to have one special setting in httpclinet configuration \n> \n> \".setUserTokenHandler(new NoopUserTokenHandler())\", \n\nAre you sure NoopUserTokenHandler does what you think ?\nIMO, it does exactly the contrary which is to return a null state.\n\nCan you give more details on:\n- your test plan ? Cookie Manager , pause times between request ? \n- What makes you think a new connection is created for every request ?\n\nIf you're using 3.1, did you modify properties:\nhttpclient4.idletimeout=0\nhttpclient4.time_to_live=2000\nhttpclient4.validate_after_inactivity=2000\n\nWhich controls lifetime of connections ?\nI would suggest you increase for example this one to a higher value  :\nhttpclient4.validate_after_inactivity\n\nThere is also a known issue where httpclient4.time_to_live does not correclty validate connection, could you in this case download nightly build and check:\n- http://jmeter.apache.org/nightly.html\n\nThanks\n\n\n> \n> in order to make httpclinet use the same connection. \n> \n> I was wondering if there is there any way to override httpClient\n> configuration in Jmeter?\n> \n> I tried to used Jmeter 2.13 and Jmeter 3.0 and found the same issue with\n> both.\n> \n> Please suggest.", "id": 197227, "time": "2017-02-23T13:20:38Z", "bug_id": 60768, "creation_time": "2017-02-23T13:20:38Z", "is_private": false}, {"count": 2, "tags": [], "creator": "digant@yahoo-inc.com", "attachment_id": 34777, "id": 197263, "creation_time": "2017-02-25T08:21:01Z", "time": "2017-02-25T08:21:01Z", "bug_id": 60768, "text": "Created attachment 34777\nTest file\n\nYes, Adding NoopUserTokenHandler helps.\n\nHere are the requested details:\n\n- your test plan ? Cookie Manager , pause times between request ?\n  \n  Attached the test plan. I have not removed the hostname and enpoint details, as I can not share those values. \n  There is a default cookie manager for the test.\n  There is no pause between requests. This test tries to get maximum output from server.\n  \n- What makes you think a new connection is created for every request ?\n  Run the test with with thread (with forever loop), with keep alive on. This test should try to use the same connection (as there is no pause between requests). You can verify the connection details by running command in your mac:\n   netstat  | grep \"*.https\"\n\n   It could have output like:\n   tcp4       0   1253  unknown-xx-xx-xx.12345 hostabcd.xyz...https ESTABLISHED\n   \n   Here 12345 is the connection id. Running above command quickly should not change the connection id.\n\n- More details:\n  TLS cert used is TLSv1.2\n  Only changed configuration in Jmeter are:\n    System.properties file:\n        javax.net.ssl.keyStore=<location_of_jks file>\n        javax.net.ssl.keyStorePassword=<password>\n\nI have tested my test case with nightly build also without any success.\n\nPlease let me know, if any more details are required.", "is_private": false}, {"count": 3, "tags": [], "bug_id": 60768, "text": "Attached the test plan. I have removed the hostname and enpoint details, as I can not share those values.", "id": 197264, "time": "2017-02-25T08:21:53Z", "creator": "digant@yahoo-inc.com", "creation_time": "2017-02-25T08:21:53Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 60768, "text": "Thanks for provided information.\nAs per previous comment, since you didn't amend :\n\nhttpclient4.time_to_live=2000\n\nJmeter will use a new connection every 2 seconds.\nIs it what you're observing or is creation rate higher ? \n\ncan you first try to increase this value:\n\nhttpclient4.time_to_live\n\nThanks", "id": 197265, "time": "2017-02-25T09:33:23Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-02-25T09:33:23Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 60768, "attachment_id": null, "id": 197436, "time": "2017-03-03T18:13:36Z", "creator": "digant@yahoo-inc.com", "creation_time": "2017-03-03T18:13:36Z", "is_private": false, "text": "Hi Philippe,\n\nThanks for the info.\n\nUsing httpclient4.time_to_live with higher value works fine (works well with jmeter 3.0 and jmeter 3.1).\n\nthis ticket can be closed."}]
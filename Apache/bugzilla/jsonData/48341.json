[{"count": 0, "tags": [], "bug_id": 48341, "attachment_id": null, "is_private": false, "id": 132625, "time": "2009-12-06T13:54:55Z", "creator": "dvander@alliedmods.net", "creation_time": "2009-12-06T13:54:55Z", "text": "Every few hours mod_fcgid suddenly tries spawning tons and tons of processes and our web server (no - the entire box) becomes unresponsive. This seems to have been happening for around a year.\n\nAfter one of these spasms it starts crashing Apache. For example:\n\n(gdb) bt\n#0  0x00007f5745f91da8 in bucket_ctx_cleanup (thectx=<value optimized out>) at fcgid_bridge.c:174\n#1  0x00007f574a55d62d in run_cleanups (cref=0x12f7318) at memory/unix/apr_pools.c:2306\n#2  0x00007f574a55e0b7 in apr_pool_destroy (pool=0x12f72f8) at memory/unix/apr_pools.c:774\n#3  0x00007f574a55e265 in apr_pool_clear (pool=0x12ef2b8) at memory/unix/apr_pools.c:728\n#4  0x0000000000446dd4 in worker_thread (thd=0xfb88a8, dummy=<value optimized out>) at worker.c:897\n#5  0x00007f5749ef0fc7 in start_thread () from /lib/libpthread.so.0\n#6  0x00007f5749a625ad in clone () from /lib/libc.so.6\n#7  0x0000000000000000 in ?? ()\n(gdb) p *ctx\n$1 = {ipc = {connect_timeout = 3, communation_timeout = 60, ipc_handle_info = 0x0, request = 0x12f7378}, buffer = 0x0, procnode = 0x0, active_time = 0,\n  has_error = 0}\n(gdb) f 0\n#0  0x00007f5745f91da8 in bucket_ctx_cleanup (thectx=<value optimized out>) at fcgid_bridge.c:174\n174         ++ctx->procnode->requests_handled;\n(gdb) p ctx.procnode\n$2 = (fcgid_procnode *) 0x0\n\nIf there's anything I can do to help diagnose this please let me know. I'm going through old versions of mod_fcgid to find a regression range."}, {"count": 1, "tags": [], "bug_id": 48341, "attachment_id": null, "text": "Even though it has been happening for a long time, you're using the recent mod_fcgid 2.3.4 or later level from svn, right?\n\nBy chance do you have FCGIWrapper/FcgidWrapper defined in any .htaccess files?  (That code currently isn't thread-safe.)\n\nHave you checked other cores to see if the backtrace is the same?", "id": 132626, "time": "2009-12-06T15:05:28Z", "creator": "trawick@apache.org", "creation_time": "2009-12-06T15:05:28Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 48341, "attachment_id": null, "is_private": false, "id": 132627, "time": "2009-12-06T15:42:17Z", "creator": "dvander@alliedmods.net", "creation_time": "2009-12-06T15:42:17Z", "text": "(In reply to comment #1)\n> Even though it has been happening for a long time, you're using the recent\n> mod_fcgid 2.3.4 or later level from svn, right?\n\nYes - sorry, I should clarify. The \"spasms\" started a long time ago but I only recently noticed crashes. I was using the latest copy from svn, but I've now downgraded to mod_fcgid-2.2 to try and bisect.\n\n> By chance do you have FCGIWrapper/FcgidWrapper defined in any .htaccess files? \n> (That code currently isn't thread-safe.)\n\nNope.\n\n> Have you checked other cores to see if the backtrace is the same?\n\nThey all look the same."}, {"count": 3, "tags": [], "bug_id": 48341, "attachment_id": null, "is_private": false, "id": 132644, "time": "2009-12-07T05:44:46Z", "creator": "trawick@apache.org", "creation_time": "2009-12-07T05:44:46Z", "text": "This particular crash (trying to dereference ctx->procnode when NULL) was introduced a few weeks ago, after the release of mod_fcgid-2.3.4.  It is now fixed in r887923.\n\nhttp://svn.apache.org/viewvc?diff_format=h&view=revision&revision=887923\n\nIt wouldn't explain crashes with older levels of mod_fcgid.  Please re-open this PR if you still get a crash right around the same place after applying the update, or open a new PR if you get a different problem symptom.  Thanks!"}]
[{"count": 0, "tags": [], "creator": "isaac@shabtay.com", "attachment_id": null, "text": "The following task:\n\n\t<zip destfile=\"C:/temp/me.zip\" whenempty=\"skip\">\n\t\t<fileset dir=\"C:/temp\" includes=\"d**\"/>\n\t</zip>\n\nWorks well. The following, though:\n\n\t<zip destfile=\"C:/temp/me2.zip\" whenempty=\"skip\">\n\t\t<resources>\n\t\t\t<fileset dir=\"C:/temp\" includes=\"d**\"/>\n\t\t</resources>\n\t</zip>\n\nDoesn't:\n\n1) Ant emits message:\n\nWarning: skipping zip archive C:\\temp\\me2.zip because no files were included.\n\n2) Ant actually goes ahead and creates the archive, but the archive is corrupted and doesn't contain what it's supposed to contain. Each file beginning with \"d\" is actually inserted into the ZIP file as an empty directory.", "id": 140832, "time": "2010-10-19T14:14:16Z", "bug_id": 50115, "creation_time": "2010-10-19T14:14:16Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "I've tried to create an AntUnit test from your description but must be missing\nsomething.  The test added with svn revision 1026991 passes.\n\nWhen you say that Ant doesn't create a zip in the first case, this means\nthere are no files with names that start with \"d\" at all, right?  Where do\nthe files in the second example come from?", "id": 140983, "time": "2010-10-25T05:21:25Z", "bug_id": 50115, "creation_time": "2010-10-25T05:21:25Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 50115, "text": "Sorry for the unclear description before. Here's a more detailed explanation:\n\n1) Create directory D:/temp (or whatever, up to you, I'll use D:/temp in this text)\n\n2) Create a file named D:/temp/test1.txt with some text in it.\n\n3) Create a directory named D:/temp/test2 with nothing in it.\n\n4) Execute both \"demo-good\" and \"demo-bad\" in this antfile:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project name=\"bug\">\n   <target name=\"demo-good\">\n      <zip destfile=\"D:/temp/good.zip\" whenempty=\"skip\">\n         <fileset dir=\"D:/temp\" includes=\"test**\"/>\n      </zip>\n   </target>\n   <target name=\"demo-bad\">\n      <zip destfile=\"D:/temp/bad.zip\" whenempty=\"skip\">\n         <resources>\n            <fileset dir=\"D:/temp\" includes=\"test**\"/>\n         </resources>\n      </zip>\n   </target>\n</project>\n\n\nWhen executing \"demo-good\", you'll get a \"good.zip\" file containing the file \"test1.txt\" and a directory called \"test2\".\n\nWhen executing \"demo-bad\", you'll get a warning message from Ant, saying that the archive has been skipped; however, the archive itself *is* created. Its contents are wrong, though; the directory \"test2\" will not exist there.\n\nI had another testcase a while ago that showed a corrupt archive but I can't find it anywhere. Nevertheless, \"demo-bad\" will demonstrate the problem I believe.", "id": 141117, "time": "2010-10-27T23:55:57Z", "creator": "isaac@shabtay.com", "creation_time": "2010-10-27T23:55:57Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 50115, "attachment_id": null, "id": 141239, "time": "2010-10-29T11:23:20Z", "creator": "bodewig@apache.org", "creation_time": "2010-10-29T11:23:20Z", "is_private": false, "text": "I see the same bogus warning message and will look into fixing it.\n\nThat you don't get test2 in the second case is correct, in a way.  <fileset> is\na set of files not dirs.  For historical reasons some task (including zip)\nprovide special handling for filesets where they also consult directories\nmatched by the patterns, but as a general rule you should assume only files\nwill be in it - and that's what you get when you wrap it into <resources>.\n\nIn order to include empty directories as well, you must use a union\nof the fileset and a dirset.  Non-empty directories (or rather directories\ncontaining files matched by the fileset) will be included since the zip task\nadds the parent directories for files by default."}, {"count": 4, "tags": [], "bug_id": 50115, "text": "when looking at the whenempty=\"fail\" case this becomes even more severe -\nthe task fails unless some non-empty filesets are there.\n\nFixed with svn revision 1028813 - the message, that is.\n\nfilesets inside a resources container still won't return directories.", "id": 141240, "time": "2010-10-29T11:53:49Z", "creator": "bodewig@apache.org", "creation_time": "2010-10-29T11:53:49Z", "is_private": false, "attachment_id": null}]
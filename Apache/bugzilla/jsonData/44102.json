[{"count": 0, "tags": [], "creator": "tears.the@gmail.com", "attachment_id": null, "text": "I tried to use XMLCipher to load a EncryptedKey element into EncryptedKey \nobject.\n \n<xenc:EncryptedKey xmlns:xenc=\"http://www.w3.org/2001/04/xmlenc#\" Id=\"KEK\" \nRecipient=\"demo\"> \n  <xenc:EncryptionMethod Algorithm=\"http://www.w3.org/2001/04/xmlenc#rsa-\n1_5\" /> \n  <ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n    <ds:KeyName>demo</ds:KeyName> \n  </ds:KeyInfo>\n  <xenc:CipherData>\n   <xenc:CipherValue>a+CJUHCF1q4bSa5dL6oxpcHzsi2Y00dIAPB3cs=</xenc:CipherValue> \n  </xenc:CipherData>\n  <xenc:ReferenceList>\n    <xenc:DataReference URI=\"#ED\"></xenc:DataReference>\n  </xenc:ReferenceList>\n  <xenc:CarriedKeyName>datakey</xenc:CarriedKeyName>\n</xenc:EncryptedKey>\n\n \nIt's ok to load, however, when I try to call the getRecipient() function, it \nreturn null.\nAfter I traced the program, I found the problem is caused by the following code \nin XMLCipher.newEncryptedKey(ELement) function:\n \n        try {\n            result.setId (element.getAttributeNS(\n                    null, EncryptionConstants._ATT_ID));\n            result.setType(new URI(\n                    element.getAttributeNS(\n                        null, EncryptionConstants._ATT_TYPE)).toString());\n            result.setMimeType(element.getAttributeNS(\n                    null, EncryptionConstants._ATT_MIMETYPE)); \n            result.setEncoding(new URI(\n                    element.getAttributeNS(\n                        null, Constants._ATT_ENCODING)).toString());\n            result.setRecipient (element.getAttributeNS(\n                    null, EncryptionConstants._ATT_RECIPIENT));\n        } catch (URI.MalformedURIException mfue) {\n            // do nothing\n        }\n\n \nThe problem is caused by calling new URI() of _ATT_TYPE & _ATT_ENCODING and \nthese 2 parameters are not required for EncryptedKey.\nit throws MalformedURIException so the recipient is never been set.\n\n\n\nHere is the test code:\n\nimport java.io.*;\nimport org.w3c.dom.*;\nimport org.xml.sax.*;\nimport javax.xml.parsers.*;\nimport javax.crypto.*;\n\nimport org.apache.xml.security.utils.*;\nimport org.apache.xml.security.encryption.*;\n\n/**\n *\n * @author  justy.wong\n */\npublic class TestXMLCipher {\n    \n    /** Creates a new instance of TestXMLCipher */\n    public TestXMLCipher() {\n    }\n    \n    /**\n     * @param args the command line arguments\n     */\n    public static void main(String[] args) throws Exception {\n        if (args.length < 1) {\n            System.out.println(\"usage : java TestXMLCipher <xml_filename>\");\n            System.exit(1);\n        }\n        \n        org.apache.xml.security.Init.init();\n        \n        FileInputStream fin = new FileInputStream(args[0]);\n        \n        DocumentBuilderFactory builderFactory = \nDocumentBuilderFactory.newInstance();\n        builderFactory.setNamespaceAware (true);\n        DocumentBuilder builder = builderFactory.newDocumentBuilder();\n        Document document = builder.parse(fin); \n        \n        XMLCipher keyCipher = XMLCipher.getInstance();\n        keyCipher.init(XMLCipher.UNWRAP_MODE, null);\n        \n        NodeList ekList = document.getElementsByTagNameNS\n(EncryptionConstants.EncryptionSpecNS, EncryptionConstants._TAG_ENCRYPTEDKEY);\n        for (int i =0; i<ekList.getLength(); i++) {\n            EncryptedKey ek = keyCipher.loadEncryptedKey(document, (Element) \nekList.item(i));\n            System.out.println(\"recipient = \" + ek.getRecipient());\n        }\n    }\n    \n}", "id": 111887, "time": "2007-12-18T23:24:31Z", "bug_id": 44102, "creation_time": "2007-12-18T23:24:31Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 44102, "attachment_id": 21288, "id": 111888, "creation_time": "2007-12-18T23:25:35Z", "time": "2007-12-18T23:25:35Z", "creator": "tears.the@gmail.com", "text": "Created attachment 21288\nTest code", "is_private": false}, {"count": 2, "tags": [], "bug_id": 44102, "text": "Created attachment 21289\ntest data", "id": 111889, "time": "2007-12-18T23:28:01Z", "creator": "tears.the@gmail.com", "creation_time": "2007-12-18T23:28:01Z", "is_private": false, "attachment_id": 21289}, {"count": 3, "tags": [], "creator": "sean.mullan@oracle.com", "attachment_id": null, "is_private": false, "id": 111955, "time": "2007-12-20T11:08:43Z", "bug_id": 44102, "creation_time": "2007-12-20T11:08:43Z", "text": "Fixed in trunk."}]
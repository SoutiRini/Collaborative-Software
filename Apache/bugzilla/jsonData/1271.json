[{"count": 0, "tags": [], "bug_id": 1271, "text": "A Vector is used in an logic:iterate tag to populate a html:select, It gives an \nArrayOutOfBounds, (stack at end).  I checked the size of the Vector, initially \n500 elements, did some chopping and got to 165, which worked, 166 did not, \nrepeatedly, tomcat restart, problem still remains.\n\nUsing tomcat-3.2.2b2 & struts-1.0-b1, jasper version I believe what comes with \ntc3222b2\n\nheres the stack:\n\nRoot cause:\njava.lang.ArrayIndexOutOfBoundsException\n        at java.lang.System.arraycopy(Native Method)\n        at java.lang.String.getChars(String.java:553)\n        at org.apache.jasper.runtime.BodyContentImpl.write\n(BodyContentImpl.java:182)\n        at org.apache.jasper.runtime.BodyContentImpl.write\n(BodyContentImpl.java:192)\n        at org.apache.jasper.runtime.BodyContentImpl.print\n(BodyContentImpl.java:334)\n        at org.apache.struts.util.ResponseUtils.writePrevious\n(ResponseUtils.java:181)\n        at org.apache.struts.taglib.logic.IterateTag.doAfterBody\n(IterateTag.java:352)\n        at \njsp.coursesets._0002fjsp_0002fcoursesets_0002fupdateNamedCourseSetPutForm_0002ej\nspupdateNamedCourseSetPutForm_jsp_48._jspService\n(_0002fjsp_0002fcoursesets_0002fupdateNamedCourseSetPutForm_0002ejspupdateNamedC\nourseSetPutForm_jsp_48.java:714)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:119)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.jasper.servlet.JspServlet$JspServletWrapper.service\n(JspServlet.java:177)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:318)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:391)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.tomcat.core.ServletWrapper.doService\n(ServletWrapper.java:405)\n        at org.apache.tomcat.core.Handler.service(Handler.java:287)\n        at org.apache.tomcat.core.ServletWrapper.service\n(ServletWrapper.java:372)\n        at org.apache.tomcat.facade.RequestDispatcherImpl.doInclude\n(RequestDispatcherImpl.java:400)\n        at org.apache.tomcat.facade.RequestDispatcherImpl.include\n(RequestDispatcherImpl.java:270)\n        at org.apache.jasper.runtime.PageContextImpl.include\n(PageContextImpl.java:414)\n        at \n_0002fCourseSetsUpdateNamedInputMenu_0002ejspCourseSetsUpdateNamedInputMenu_jsp_\n0._jspService\n(_0002fCourseSetsUpdateNamedInputMenu_0002ejspCourseSetsUpdateNamedInputMenu_jsp\n_0.java:89)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:119)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.jasper.servlet.JspServlet$JspServletWrapper.service\n(JspServlet.java:177)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:318)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:391)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.tomcat.core.ServletWrapper.doService\n(ServletWrapper.java:405)\n        at org.apache.tomcat.core.Handler.service(Handler.java:287)\n        at org.apache.tomcat.core.ServletWrapper.service\n(ServletWrapper.java:372)\n        at org.apache.tomcat.facade.RequestDispatcherImpl.doForward\n(RequestDispatcherImpl.java:222)\n        at org.apache.tomcat.facade.RequestDispatcherImpl.forward\n(RequestDispatcherImpl.java:162)\n        at org.apache.struts.action.ActionServlet.processActionForward\n(ActionServlet.java:1697)\n        at org.apache.struts.action.ActionServlet.process\n(ActionServlet.java:1540)\n        at org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:491)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:740)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.tomcat.core.ServletWrapper.doService\n(ServletWrapper.java:405)\n        at org.apache.tomcat.core.Handler.service(Handler.java:287)\n        at org.apache.tomcat.core.ServletWrapper.service\n(ServletWrapper.java:372)\n        at org.apache.tomcat.core.ContextManager.internalService\n(ContextManager.java:797)\n        at org.apache.tomcat.core.ContextManager.service\n(ContextManager.java:743)\n        at \norg.apache.tomcat.service.http.HttpConnectionHandler.processConnection\n(HttpConnectionHandler.java:213)\n        at org.apache.tomcat.service.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:416)\n        at org.apache.tomcat.util.ThreadPool$ControlRunnable.run\n(ThreadPool.java:498)\n        at java.lang.Thread.run(Thread.java:484)", "id": 1791, "time": "2001-04-09T09:50:51Z", "creator": "andy_brook@mcgraw-hill.com", "creation_time": "2001-04-09T09:50:51Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 1271, "text": "Further test show that by changing the size of the element that is written, \nmore of them can be written before the same problem occurs.\n\nEg, writing in the order of 15K spread over 280 elements work ok, but 15.5K \nbreaks.  writing 8.8K spread over 476 elements works ok but 477 fails.  \nThere seems to be some non-linear correlation between element count and size \nthereof", "id": 1824, "time": "2001-04-10T04:19:51Z", "creator": "andy_brook@mcgraw-hill.com", "creation_time": "2001-04-10T04:19:51Z", "is_private": false, "attachment_id": null}, {"count": 2, "text": "It sounds like this might actually be a Tomcat bug.  Do you have a test page \nthat can be used to reproduce the situation?  You can upload such a page as an \nattachment to this error report.\n", "bug_id": 1271, "attachment_id": null, "id": 1937, "time": "2001-04-19T15:46:33Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2001-04-19T15:46:33Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "andy_brook@mcgraw-hill.com", "attachment_id": 101, "id": 1946, "time": "2001-04-20T03:00:05Z", "bug_id": 1271, "creation_time": "2001-04-20T03:00:05Z", "is_private": false, "text": "Created attachment 101\nTest case JSP file illustrating bug.  sources for referenced classes to follow."}, {"count": 4, "tags": [], "creator": "andy_brook@mcgraw-hill.com", "attachment_id": 102, "id": 1947, "time": "2001-04-20T03:01:16Z", "bug_id": 1271, "creation_time": "2001-04-20T03:01:16Z", "is_private": false, "text": "Created attachment 102\nSimple value holder java source, default package"}, {"attachment_id": 103, "tags": [], "bug_id": 1271, "text": "Created attachment 103\nEncompassing 'model' class, comprising of a vector (of ValueHolders) and a code, default package", "count": 5, "id": 1948, "time": "2001-04-20T03:02:20Z", "creator": "andy_brook@mcgraw-hill.com", "creation_time": "2001-04-20T03:02:20Z", "is_private": false}, {"count": 6, "tags": [], "creator": "andy_brook@mcgraw-hill.com", "text": "The test jsp code shows pretty well how the problem arises, as well as building \nthe two Java classes youll also need to create a 'doStuff' action to get the \npage to load...\n\nhappy hunting.\na.", "id": 1949, "time": "2001-04-20T03:05:17Z", "bug_id": 1271, "creation_time": "2001-04-20T03:05:17Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 1271, "text": "The tail end of the stack frame of the problem is as follows:\n\norg.apapche.jasper.runtime.BodyContentImpl.write:182\n^\norg.apapche.jasper.runtime.BodyContentImpl.write:192\n^\norg.apapche.jasper.runtime.BodyContentImpl.print:334\n^\nResponseUtils.writePrevious:181\n^\nIterateTag.doAfterBody:368\n\nFault description (BodyContentImpl.write:182)\nDuring the write method the s.getChars(x,y,z) call to transfer the contents\nof String s into the char buffer cb results in an IndexOutOfBounds\n\nException occurs because the 'bufferSize' checked for earlier in the method \ndoesnt bear a relation to the length of the array we are writing to (cb is of \nlength 24576) thus only 77chars are left to write the 120char String.  Kaboom.\n\nIm thinking the exception is caught way up the stack, havent gone there yet.", "id": 1953, "time": "2001-04-20T09:34:18Z", "creator": "andy_brook@mcgraw-hill.com", "creation_time": "2001-04-20T09:34:18Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 1271, "text": "A buglet seems to have got into the reAllocBuff method of jaspers \nBodyContentImpl.  This is definitely in Tomcat 3 but not sure about 4 or who to \nforward this to...\n\n  The first IF incorrectly assigns a *2 value to bufferSize.\n\nHeres a snippet of what the code should look like:\n\nif (len <= Constants.DEFAULT_BUFFER_SIZE) {\n    tmp = new char [bufferSize + Constants.DEFAULT_BUFFER_SIZE];\n    bufferSize += Constants.DEFAULT_BUFFER_SIZE;\n}", "count": 8, "id": 2039, "time": "2001-04-23T03:32:42Z", "creator": "andy_brook@mcgraw-hill.com", "creation_time": "2001-04-23T03:32:42Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 1271, "attachment_id": null, "text": "The buffer size calculation was changed recently to improve performance.  By\ndoubling the buffer size the number of reallocs and copies are reduced for large\nbuffers.  Unfortunately, I botched the change and got the bufferSize variable\nand the actual buffer size out of sync.  This is fixed in 3.2.2.  Tomcat 3.3.\nand 4.0 do not have the problem.", "id": 2048, "time": "2001-04-23T12:07:40Z", "creator": "marc.saegesser@apropos.com", "creation_time": "2001-04-23T12:07:40Z", "is_private": false}]
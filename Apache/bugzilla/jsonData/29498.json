[{"count": 0, "tags": [], "bug_id": 29498, "attachment_id": null, "is_private": false, "id": 59024, "time": "2004-06-10T15:18:45Z", "creator": "wojtowij@trustedcs.com", "creation_time": "2004-06-10T15:18:45Z", "text": "That fix for proxypass, took out the use of the parsed uri data in the\nrequest structure, \nand instead opted to parse out the FTP request explicitly.  This is fine,\nbut the patch in question didn't account for the case where an ftp request\nmight be of the form ftp://user@ftp.site.org\n\nIt also seems to hardcode the ftp sites port to 21 which is probably\nacceptable, \nfor most people, and doesn't pull the port from the URI.\n\nI have a patch fix that uses adds parsing for the username and the port\nnumber\nfrom the request.  This patch has been tested with mozilla and works fine,\nbut I.E. doesn't work for some reason.  Did authenticated FTP proxying ever\nwork with mod_proxy and Internet Explorer?\n\nFrom William Rowe:\n> Microsoft, in it's all seeing all knowing benevolence, broke from RFC2616\n> and no longer allows proto:user@password mechanics in IE (at least,\n> in HTTP.)  This was done for the users of the world assaulted daily by\n> http://ebay.example.com@reallynastyhackers.example.net/ URL's.\n> Although many of us think this is a *presentation* problem, they decided\n> that it is a vulnerability and crippled the feature.\n>\n> Your patch sounds great, and it quite possibly did work in the past,\n> but we don't expect to see this work from IE anymore, at least, not\n> when it uses http proxy.\n\nHere's the patch that fixes everything except IE:\n\n--- proxy_ftp.c\t2004-05-28 15:15:15.960934000 -0400\n+++ proxy_ftp.c.new\t2004-05-28 15:14:27.480934000 -0400\n@@ -558,14 +558,25 @@\n         return HTTP_BAD_REQUEST;\n     urlptr += 3;\n     destport = 21;\n+    /* strip out the username */\n+    if ((strp = strchr(urlptr, '@')) != NULL)\n+\turlptr = strp + 1;\n     strp = strchr(urlptr, '/');\n     if (strp == NULL) {\n         desthost = ap_pstrdup(p, urlptr);\n         urlptr = \"/\";\n     }\n     else {\n-        char *q = ap_palloc(p, strp - urlptr + 1);\n-        memcpy(q, urlptr, strp - urlptr);\n+        char *q, *portptr;\n+\n+        if ((portptr = strstr(urlptr, \":\")) != NULL)\n+        {\n+            q = ap_palloc(p, portptr - urlptr + 1);\n+            destport = atoi(portptr);\n+        }\n+        else\n+            q = ap_palloc(p, strp - urlptr + 1);\n+        memcpy(q, urlptr, (portptr ? portptr : strp) - urlptr);\n         q[strp - urlptr] = '\\0';\n         urlptr = strp;\n         desthost = q;"}, {"count": 1, "tags": [], "creator": "mss@apache.org", "text": "Apache HTTP Server 1.3.x is not supported anymore and no bugs will be fixed in the old codebase (cf. <http://mail-archives.apache.org/mod_mbox/httpd-announce/201002.mbox/%3C20100203000334.GA19021@infiltrator.stdlib.net%3E>). Since this bug seems to affect only 1.3.x, I'm closing it as WONTFIX.\n\nIf this bug still affects you in a recent version (version 2.2.x or the upcoming version 2.4), please open a new bug.\n\nThank you for reporting the bug.", "id": 145151, "time": "2011-03-21T10:58:51Z", "bug_id": 29498, "creation_time": "2011-03-21T10:58:51Z", "is_private": false, "attachment_id": null}]
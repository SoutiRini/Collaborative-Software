[{"attachment_id": null, "tags": [], "bug_id": 51391, "is_private": false, "count": 0, "id": 147225, "time": "2011-06-17T10:50:07Z", "creator": "prad.kp@gmail.com", "creation_time": "2011-06-17T10:50:07Z", "text": "I have a macro enabled excel file which is getting corrupted during workbook.write\n\nThe excel file being used is version MS office 2002(10.6866.6867)SP3\n\nThere are no exception thrown from POI. However few macros are getting emptied during the download.\n\nThe file contains\n 8 charts\n 33 Sheets\n 1 User Form\n 19 Macros\n\nOut of this 3 macros getting emptied when interfaced with POI(3.6). Also tried testing with POI 3.7 binaries which is corrupting a few charts and sheets as well along with the Macros.\n\nThe download has been tested in Windows XP\\Windows Vista\\Red Hat Linux ES. The behavior is the same.\n\nOther simular template files are getting downloaded without issues. \n\nIt will be great if any know issues related to macros interface with POI. Curretly this is a blocker for the application development to proceed any further.\n\nThanks in advance.\nRegards,\nPradeep"}, {"count": 1, "tags": [], "bug_id": 51391, "is_private": false, "text": "You must set the \"preserve nodes\" flag to true when opening a macro containing workbook that you wish to write out again later\n\nSee the java docs, eg\nhttp://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFWorkbook.html#HSSFWorkbook(org.apache.poi.poifs.filesystem.POIFSFileSystem,%20boolean)", "id": 147226, "time": "2011-06-17T10:58:28Z", "creator": "apache@gagravarr.org", "creation_time": "2011-06-17T10:58:28Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "prad.kp@gmail.com", "text": "Dear Nick,\n\nThe implementaion calls following constructor. To my \n\n//passed ByteArrayInputStream, preseve node true.\nnew HSSFWorkbook(inp, true);", "id": 147244, "time": "2011-06-18T11:59:24Z", "bug_id": 51391, "creation_time": "2011-06-18T11:59:24Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "text": "Dear Nick,\n\nThe implementaion calls following constructor create workbook object.\n\n//passed ByteArrayInputStream, preseve node true.\nnew HSSFWorkbook(inp, true);\n\nAny further inputs?\n\nThanks & Regards,\nPradeep", "is_private": false, "bug_id": 51391, "id": 147245, "time": "2011-06-18T12:01:11Z", "creator": "prad.kp@gmail.com", "creation_time": "2011-06-18T12:01:11Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 51391, "is_private": false, "count": 4, "id": 147269, "time": "2011-06-20T10:21:12Z", "creator": "prad.kp@gmail.com", "creation_time": "2011-06-20T10:21:12Z", "text": "(In reply to comment #1)\n> You must set the \"preserve nodes\" flag to true when opening a macro containing\n> workbook that you wish to write out again later\n> See the java docs, eg\n> http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFWorkbook.html#HSSFWorkbook(org.apache.poi.poifs.filesystem.POIFSFileSystem,%20boolean)\n\nDear Nick,\n\nThe implementaion calls following constructor create workbook object.\n\n//passed ByteArrayInputStream, preseve node true.\nnew HSSFWorkbook(inp, true);\n\nAny further inputs?\n\nThanks & Regards,\nPradeep"}, {"count": 5, "tags": [], "bug_id": 51391, "text": "Please upload the input file with macros. Without the problematic file we can't do much to help you.\n\nYegor\n\n(In reply to comment #4)\n> (In reply to comment #1)\n> > You must set the \"preserve nodes\" flag to true when opening a macro containing\n> > workbook that you wish to write out again later\n> > See the java docs, eg\n> > http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFWorkbook.html#HSSFWorkbook(org.apache.poi.poifs.filesystem.POIFSFileSystem,%20boolean)\n> \n> Dear Nick,\n> \n> The implementaion calls following constructor create workbook object.\n> \n> //passed ByteArrayInputStream, preseve node true.\n> new HSSFWorkbook(inp, true);\n> \n> Any further inputs?\n> \n> Thanks & Regards,\n> Pradeep", "id": 147281, "time": "2011-06-20T16:47:45Z", "creator": "yegor@dinom.ru", "creation_time": "2011-06-20T16:47:45Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "prad.kp@gmail.com", "attachment_id": null, "is_private": false, "id": 147312, "time": "2011-06-21T06:54:12Z", "bug_id": 51391, "creation_time": "2011-06-21T06:54:12Z", "text": "Dear Yegor,\n\nThe file containg issue with workbook.write is intellectual property of my customer so I will not be able to share. So I am marking the bug as resolved.\n\nThanks & Regards,\nPradeep\n\n(In reply to comment #5)\n> Please upload the input file with macros. Without the problematic file we can't\n> do much to help you.\n> \n> Yegor\n> \n> (In reply to comment #4)\n> > (In reply to comment #1)\n> > > You must set the \"preserve nodes\" flag to true when opening a macro containing\n> > > workbook that you wish to write out again later\n> > > See the java docs, eg\n> > > http://poi.apache.org/apidocs/org/apache/poi/hssf/usermodel/HSSFWorkbook.html#HSSFWorkbook(org.apache.poi.poifs.filesystem.POIFSFileSystem,%20boolean)\n> > \n> > Dear Nick,\n> > \n> > The implementaion calls following constructor create workbook object.\n> > \n> > //passed ByteArrayInputStream, preseve node true.\n> > new HSSFWorkbook(inp, true);\n> > \n> > Any further inputs?\n> > \n> > Thanks & Regards,\n> > Pradeep"}, {"count": 7, "tags": [], "creator": "apache@gagravarr.org", "is_private": false, "text": "You may be able to use the Microsoft Binary File Format Validator to identify what's wrong with the file, and potentially share that without revealing the file details. I'm told that the tool will be released publicly very soon now... See \nhttp://blogs.msdn.com/b/officeinteroperability/archive/2011/02/16/microsoft-office-binary-file-format-validation.aspx for details on it.", "id": 147320, "time": "2011-06-21T12:55:12Z", "bug_id": 51391, "creation_time": "2011-06-21T12:55:12Z", "attachment_id": null}]
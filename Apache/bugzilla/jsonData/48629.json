[{"count": 0, "tags": [], "bug_id": 48629, "attachment_id": 24898, "text": "Created attachment 24898\npatch\n\nroleNested introduced with Tomcat 6.0.24 works well with roleSearch=\"(member={0})\", but not with roleSearch=\"(member={1})\"\n\nFrom tomcat doc :\n\"Use {0} to substitute the distinguished name (DN) of the user, and/or {1} to substitute the username.\"\n\n\nI've attached a patch to change line :\nfilter = roleFormat.format(new String[] { groupDN });\ninto :\nfilter = roleFormat.format(new String[] { groupDN, groupDN });\n\nLike that it handles both {0} and {1}.\n\nRegards,\n\nGabriel.", "id": 133977, "time": "2010-01-27T13:35:47Z", "creator": "glandon@piti.pf", "creation_time": "2010-01-27T13:35:47Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 48629, "text": "This has been fixed in trunk and proposed for 6.0.x.\n\nMany thanks for the patch.", "id": 134048, "time": "2010-01-30T15:10:38Z", "creator": "markt@apache.org", "creation_time": "2010-01-30T15:10:38Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "I do not think that this patch is good.\n\nSee, groupDN is a full distinguished name of a role, while in your case {1} was just a name. Does it work for your configuration?\n\nhttp://tomcat.apache.org/tomcat-6.0-doc/realm-howto.html#JNDIRealm\n\nFor reference, previous discussion:\nhttp://markmail.org/message/cv3i6set7yte57yr\n\n\nIn any case,\n1) If your configuration works when you do\nroleSearch=\"(member={1})\" when {1} is a DN of a group,\n then I think we would better provide a separate attribute to specify search filter for the nested roles.\n\n\nE.g.,\nroleSearch=\"(member={1})\" roleNestedSearch=\"(member={0})\"\nwhere {0} in the second case is a group DN, as it is now.\n\n\nWe can default roleNestedSearch to be the same as roleSearch when roleNested=\"true\",  and to default roleNested=\"true\" when roleNestedSearch is explicitly specified.\n\n\n2) If you need unqualified rolename,\nit can be obtained, but the patch will be more complicated.\n\nIn the code we have\n  Set<String> newGroupDNs = new HashSet<String>(groupMap.keySet());\n  ..\n  for (String groupDN : newGroupDNs) {\n  ..\n  groupMap.put(dname, name);\n\nWe should replace Set<String> newGroupDNs  with\n  Map<String,String> newGroups = new HashMap<String,String>(groupMap);\n\nPerform iteration over entrySet of the map:\n  for (Map.Entry<String,String> newGroup : newGroups.entrySet()) {\n\nThen, newGroup.getKey() will give us the groupDN and newGroup.getValue() will give us the group name.\n\n\n\n3) It would be nice to update realm-howto.html with documentation on using the roleNested=\"true\". It is not documented yet.  Can you propose a patch for /webapps/docs/realm-howto.xml,  or at least describe your configuration so that it can be provided as an example there?", "id": 134050, "time": "2010-01-30T15:58:10Z", "bug_id": 48629, "creation_time": "2010-01-30T15:58:10Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 48629, "attachment_id": null, "id": 134110, "time": "2010-02-01T10:02:22Z", "creator": "glandon@piti.pf", "creation_time": "2010-02-01T10:02:22Z", "is_private": false, "text": "I think having roleNestedSearch=\"(member={0})\" is a very good idea. Like that it should work for all kind of configurations.\n\n\nFor the moment I've switched to the \"member={0}\" instead of \"member={1}\", so I can use tomcat 6.0.24 in production.\n\n\nHere's my conf (for a Domino 8.5) :\n<Realm className=\"org.apache.catalina.realm.JNDIRealm\"\n    connectionName=\"CN=XXXXXX,O=XXXXX\" \n    connectionPassword=\"XXXXXX\" \n    connectionURL=\"ldap://127.0.0.1:389\" \n    roleName=\"cn\" \n    roleNested=\"true\" \n    roleSearch=\"(member={0})\" \n    roleSubtree=\"true\" \n    userSearch=\"(uid={0})\" \n    userSubtree=\"true\"/>\n\nI'm not sure my english is good enough to update the doc..."}, {"count": 4, "tags": [], "bug_id": 48629, "attachment_id": 24916, "id": 134111, "time": "2010-02-01T10:30:40Z", "creator": "glandon@piti.pf", "creation_time": "2010-02-01T10:30:40Z", "is_private": false, "text": "Created attachment 24916\nadd roleNested entry in doc\n\nHere's a small patch to add the roleNested entry in the doc.\nMaybe it should be nice to add an example also."}, {"count": 5, "tags": [], "creator": "felix.schumacher@internetallee.de", "attachment_id": 24953, "text": "Created attachment 24953\nbring {1} to work in JNDIRealm with nested roles\n\nMade the corrections proposed by Konstantin Kolinko.", "id": 134364, "time": "2010-02-09T06:28:21Z", "bug_id": 48629, "creation_time": "2010-02-09T06:28:21Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 48629, "attachment_id": null, "text": "Thanks for the patch.\n\nI have applied it to trunk and proposed it for 6.0.x.", "id": 135169, "time": "2010-03-08T18:01:55Z", "creator": "markt@apache.org", "creation_time": "2010-03-08T18:01:55Z", "is_private": false}, {"count": 7, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Thanks again for the patch. It has been applied to 6.0.x and will be includedin 6.0.27 onwards.", "id": 136003, "time": "2010-04-11T08:51:36Z", "bug_id": 48629, "creation_time": "2010-04-11T08:51:36Z", "is_private": false}]
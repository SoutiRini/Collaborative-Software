[{"count": 0, "tags": [], "bug_id": 43893, "text": "Deploy the attached WAR file under a vanilla installation of Tomcat 6.0.14, \nthen send the following WebDAV request (I simply pasted it in netcat, maybe \ntelnet will work too if you don't have netcat):\n\nPROPFIND /webdav/file.txt HTTP/1.1\nContent-Type: text/xml; charset=utf-8\nUser-Agent: Jakarta Commons-HttpClient/3.0\nHost: localhost:8080\nDepth: 0\n\nDon't forget to press enter twice at the end. Observe the result:\n\n<?xml version=\"1.0\" encoding=\"utf-8\" ?>\n<multistatus xmlns=\"DAV:\"><response><href>/webdav/file.txt/file.txt</href>\n<propstat><prop><creationdate>2007-11-18T07:42:14Z</creationdate>\n<displayname><![CDATA[file.txt]]></displayname>\n<getlastmodified>Sun, 18 Nov 2007 07:42:14 GMT</getlastmodified>\n<getcontentlength>0</getcontentlength>\n<getcontenttype>text/plain</getcontenttype>\n<getetag>W/\"0-1195371734000\"</getetag>\n<resourcetype/><source></source>\n<supportedlock><lockentry><lockscope><exclusive/></lockscope><locktype><write/\n></locktype></lockentry><lockentry><lockscope><shared/></\nlockscope><locktype><write/></locktype></lockentry></supportedlock>\n</prop>\n<status>HTTP/1.1 200 OK</status>\n</propstat>\n</response>\n</multistatus>\n\nNote in particular the incorrect value in <href>/webdav/file.txt/file.txt</\nhref>, paths are being duplicated.\n\nThis wouldn't usually be a big problem as many WebDAV clients don't rely so \nmuch on this \"href\" value, but the Apache slide-webdavlib client library relies \non it and breaks if it's incorrect, so any WebDAV enabled applications using \nthis library will not work with Tomcat 6. That's the only reason I marked this \nbug as major, apologies if it's a wrong classification.", "id": 110674, "time": "2007-11-18T00:04:05Z", "creator": "grnch@gmx.net", "creation_time": "2007-11-18T00:04:05Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 43893, "text": "Created attachment 21143\nminimal webapp demonstrating the bug", "id": 110675, "time": "2007-11-18T00:05:40Z", "creator": "grnch@gmx.net", "creation_time": "2007-11-18T00:05:40Z", "is_private": false, "attachment_id": 21143}, {"attachment_id": 21144, "tags": [], "creator": "grnch@gmx.net", "text": "Created attachment 21144\nsimple patch that fixes the problem\n\nIt seems the call to request.getServletPath() is superfluous in this context,\nas the \"path\" variable already contains the path of the resource relative to\nthe servlet context path (i.e. it includes getServletPath() already), so simply\nomitting getServletPath() solves the issue.", "count": 2, "id": 110676, "time": "2007-11-18T00:08:20Z", "bug_id": 43893, "creation_time": "2007-11-18T00:08:20Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 43893, "text": "There are a few subtle differences if you map to '/' rather than '/*'. There\nmight other slight difference is you map to /edit/*. I'll work on getting these\nfixed.\n\nThe patch you suggests breaks the ability to have different urls for editing and\nviewing by mapping to /edit/* or similar.\n\nI am unable to reproduce the duplicate file name you show in your report. I'm\nnot sure why. I also don't get the <getcontentlength>, <getcontenttype> and\n<getetag> tags. Could you confirm this result with your provided test case?\n\nThanks,\n\nMark", "count": 3, "id": 110744, "time": "2007-11-19T15:29:33Z", "creator": "markt@apache.org", "creation_time": "2007-11-19T15:29:33Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 43893, "attachment_id": null, "is_private": false, "id": 110752, "time": "2007-11-20T00:09:36Z", "creator": "grnch@gmx.net", "creation_time": "2007-11-20T00:09:36Z", "text": "Hello Mark, thanks for looking into this.\n\nYou are absolutely right, it does work fine when the servlet is mapped with /*, \nit only fails with / mapping. The reason I used / is because I do want the \nredirects to be generated, but I can use /* as a workaround for now, thanks!\n\nI'm surprised though that you can't reproduce it with the / mapping. I can \nreliably reproduce it here every time, I just tried again to make sure, here is \na transcript of the steps:\n\n<unpack freshly downloaded apache-tomcat-6.0.14.tar.gz into c:\\apache-\ntomcat-6.0.14, and download webdav.war from this bug report to C:\\webdav.war>\n\nC:\\>set CATALINA_HOME=c:\\apache-tomcat-6.0.14\n\nC:\\>copy webdav.war %CATALINA_HOME%\\webapps\n        1 file(s) copied.\n\nC:\\>%CATALINA_HOME%\\bin\\catalina.bat start\nUsing CATALINA_BASE:   c:\\apache-tomcat-6.0.14\nUsing CATALINA_HOME:   c:\\apache-tomcat-6.0.14\nUsing CATALINA_TMPDIR: c:\\apache-tomcat-6.0.14\\temp\nUsing JRE_HOME:        c:\\Java\\jdk-1.6.0\n\nC:\\>nc localhost 8080\nPROPFIND /webdav/file.txt HTTP/1.1\nContent-Type: text/xml; charset=utf-8\nUser-Agent: Jakarta Commons-HttpClient/3.0\nHost: localhost:8080\nDepth: 0\n\nHTTP/1.1 207 Multi-Status\nServer: Apache-Coyote/1.1\nContent-Type: text/xml;charset=UTF-8\nContent-Length: 732\nDate: Tue, 20 Nov 2007 07:45:33 GMT\n\n<?xml version=\"1.0\" encoding=\"utf-8\" ?>\n<multistatus xmlns=\"DAV:\"><response><href>/webdav/file.txt/file.txt</href>\n<propstat><prop><creationdate>2007-11-18T07:42:14Z</creationdate>\n<displayname><![CDATA[file.txt]]></displayname>\n<getlastmodified>Sun, 18 Nov 2007 07:42:14 GMT</getlastmodified>\n<getcontentlength>0</getcontentlength>\n<getcontenttype>text/plain</getcontenttype>\n<getetag>W/\"0-1195371734000\"</getetag>\n<resourcetype/><source></source>\n<supportedlock><lockentry><lockscope><exclusive/></lockscope><locktype><write/\n></locktype></lockentry><lockentry><lockscope><share\nd/></lockscope><locktype><write/></locktype></lockentry></supportedlock>\n</prop>\n<status>HTTP/1.1 200 OK</status>\n</propstat>\n</response>\n</multistatus>\n\n\nThat \"nc\" command above is netcat from Cygwin, which I have in the PATH.\n\nEven though the attached patch turned out to be too naive, it does show the \nexact line in the code where I observed the path duplication with a debugger, \nwhen WebdavServlet is mapped to / url prefix.\n"}, {"count": 5, "tags": [], "bug_id": 43893, "text": "(In reply to comment #3)\n> The patch you suggests breaks the ability to have different urls for editing \nand\n> viewing by mapping to /edit/* or similar.\n\nFor what its worth, I've since discovered that the patch also broke even basic \nfunctionality, like deleting files with the Microsoft Web Folders client, so it \nwas definitely wrong.\n", "id": 110847, "time": "2007-11-20T06:45:13Z", "creator": "grnch@gmx.net", "creation_time": "2007-11-20T06:45:13Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 43893, "text": "How much of an issue is it if you have to map to '/*' rather than '/' ?\n\nThe way WebDAV is coded at the minute I can't see an easy to get it to work\ncorrectly with a mapping of '/'. I am tempted to just amend the docs accordingly. \n\nTo get the correct behaviour the servlet needs to know how it is mapped and\nthere is no easy way to get this. It is available in the Tomcat internals but I\nreally don't want to go down that road.", "id": 110967, "time": "2007-11-21T15:54:14Z", "creator": "markt@apache.org", "creation_time": "2007-11-21T15:54:14Z", "is_private": false, "attachment_id": null}, {"count": 7, "text": "Oh, not a big issue at all, don't bother with it if it's not trivial to fix, it \nnow works great for my purposes. The real issue I guess is that I didn't even \nknow it was supposed to be mapped to /*, I simply mapped it to / as usual for \nother servlets, so as you said it just needs to be documented better. Feel free \nto WONTFIX this bug.\n", "bug_id": 43893, "is_private": false, "id": 110974, "time": "2007-11-21T23:34:32Z", "creator": "grnch@gmx.net", "creation_time": "2007-11-21T23:34:32Z", "tags": [], "attachment_id": null}, {"count": 8, "tags": [], "creator": "markt@apache.org", "text": "As per #6 and #7, I am marking this as WONTFIX.\n\nThe JavaDoc for trunk has been updated and I have proposed the updated docs for\nbackport to 6.0.x.", "id": 111028, "time": "2007-11-23T11:07:14Z", "bug_id": 43893, "creation_time": "2007-11-23T11:07:14Z", "is_private": false, "attachment_id": null}]
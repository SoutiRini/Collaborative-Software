[{"count": 0, "tags": [], "creator": "p_samson@yahoo.com", "attachment_id": null, "is_private": false, "id": 34186, "time": "2003-03-31T15:01:51Z", "bug_id": 18525, "creation_time": "2003-03-31T15:01:51Z", "text": "Suppose a i18n:bundle with localeRef=\"theRef\", and\nthe attribute for 'theRef' is not defined. The most\nappropriate Locale is determined as expected, and\nmemorized as an attribute in the http session.\nBut _locale is also set. So when this bundle will be\nreused by a second http session (another workstation),\nthen in findBundle() _locale is not null and used.\nConsequences for the second http session:\n- the browser preferences are ignored,\n- the session attribute is not set (which thows a null\npointer exception in my code, but it's up to me)\n\nWorkaround: add locale=\"<%=null%>\"\n\nI think that in findBundle(), _locale should never be\nset, but a local variable used instead, as done for\n_bundle in MessageTag.getBundle().\n\nNote: this bug may be similar to #16932\n(i18n:message uses wrong resource bundle)."}, {"attachment_id": null, "tags": [], "creator": "gareth.jones@vianet.co.uk", "is_private": false, "count": 1, "id": 35109, "time": "2003-04-14T11:55:23Z", "bug_id": 18525, "creation_time": "2003-04-14T11:55:23Z", "text": "I've experienced the same problem. It's caused by tag pooling (we're using \ntomcat 4.1, it doesn't happen in tomcat 3.3), the bundle tag does not reset \nits state at the end of a request, keeping the _locale set to the value it had \nat the end of the first request. I fixed it for us by adding a call to the \nrelease() method at the end of the doEndTag() method. "}, {"count": 2, "tags": [], "bug_id": 18525, "is_private": false, "text": "Thanks Gareth for your comments.\nEven if it works, I don't believe that a call to release() is the correct \ndesign. As I suggested in my report, I'm convinced that _locale should not be \nset in findBundle(). My implemented and working fix in findBundle() is :\n        // Add a local variable to keep _locale unchanged.\n        // Replace any further reference to _locale by this new variable\n        // in this method.\n        Locale locale = _locale;\n\nAdditional note:\nI had to create my own version of the i18n library to fix this bug.\nI don't want to blame anyone but I expected an action and there is none, more \nthan 2 months after the opening. It's the same for my other bugs #18521, 18523 \nand 18524.\nJust wonder if anybody is taking care of this library. tdawson seems dead.\nPlease inform the community :)", "id": 38663, "time": "2003-06-10T11:08:49Z", "creator": "p_samson@yahoo.com", "creation_time": "2003-06-10T11:08:49Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "p_samson@yahoo.com", "attachment_id": null, "is_private": false, "id": 55443, "time": "2004-04-07T09:26:50Z", "bug_id": 18525, "creation_time": "2004-04-07T09:26:50Z", "text": "Additional fix:\n\nBecause of the reuse mecanism, any internal member variable has to be\ninitialized. So add this code at the very beginning of doStartTag()\nin BundleTag.java\n\n    \t// initialize internal member variables\n    \t_bundle = null;\n\nThis will fix a MissingResourceException on a MessageTag\nafter a session time-out.\n\nNote: to confirm my previous fix, member variables associated with attributes\n(such as _locale) must be read-only in the tag processing. Only the JSP\ncontainer is allowed to write them through setXXX() methods.\n"}, {"count": 4, "tags": [], "bug_id": 18525, "is_private": false, "text": "Created attachment 11730\nBundleTag patch", "id": 58558, "time": "2004-06-02T15:47:55Z", "creator": "p_samson@yahoo.com", "creation_time": "2004-06-02T15:47:55Z", "attachment_id": 11730}, {"count": 5, "tags": [], "bug_id": 18525, "text": "Patrick,\n\n>I don't want to blame anyone but I expected an action and there is none, more \n>than 2 months after the opening. It's the same for my other bugs #18521, 18523 \n>and 18524.\n>Just wonder if anybody is taking care of this library. tdawson seems dead.\n\nThe I18N is not \"dead\", but most of its features were made obsolete by JSTL's\nFormat taglib.\n\n>Please inform the community :)\n\nYes, we might be creating a new category for obsolete taglibs.\n\n\n\nAnyway, I have applied your fixes. Thanks.", "id": 58710, "time": "2004-06-04T04:51:20Z", "creator": "nagoya@felipeal.net", "creation_time": "2004-06-04T04:51:20Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 18525, "text": "*** Bug 16932 has been marked as a duplicate of this bug. ***", "id": 59208, "time": "2004-06-15T03:16:31Z", "creator": "nagoya@felipeal.net", "creation_time": "2004-06-15T03:16:31Z", "is_private": false, "attachment_id": null}]
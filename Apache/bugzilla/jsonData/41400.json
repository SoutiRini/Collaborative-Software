[{"count": 0, "tags": [], "bug_id": 41400, "text": "While trying to track down why the antunit tests for the xml-attribute-expansion\nwasnt working, I came to the conclusion that properties get expanded in the process.\n\nthat is, ifyou have\n<property name=\"one\" value=\"1\" />\n<property name=\"prop\" value=\"$${one}\" />\n  (so that prop==${one})\nwhen you test the value, you get a match against the contents of ${one}\n<au:assertPropertyEquals property name=\"prop\" value=\"1\" />\n\nPossibly more of a general purpose macro problem than anything else.", "id": 98214, "time": "2007-01-18T04:17:43Z", "creator": "stevel@apache.org", "creation_time": "2007-01-18T04:17:43Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "vladimir_egorov@yahoo.com", "text": "As mentioned above, this is a generic macrodef problem (back in 1.6.5)\nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=42046", "id": 101424, "time": "2007-04-04T08:05:37Z", "bug_id": 41400, "creation_time": "2007-04-04T08:05:37Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 41400, "attachment_id": 24783, "text": "Created attachment 24783\nFixed double property expansion in macrodefs.\n\nWith this patch the assertion fails as expected,\nbecause the property is not expanded twice anymore.", "id": 133231, "time": "2009-12-30T11:36:03Z", "creator": "machisuji@googlemail.com", "creation_time": "2009-12-30T11:36:03Z", "is_private": false}, {"count": 3, "tags": [], "creator": "machisuji@googlemail.com", "text": "Bug fixed by attached patch.", "id": 133232, "time": "2009-12-30T11:38:37Z", "bug_id": 41400, "creation_time": "2009-12-30T11:38:37Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "mbenson@apache.org", "text": "(Reopening to avoid loss)", "id": 133283, "time": "2010-01-03T09:03:13Z", "bug_id": 41400, "creation_time": "2010-01-03T09:03:13Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 41400, "attachment_id": null, "text": "*** Bug 42046 has been marked as a duplicate of this bug. ***", "id": 133322, "time": "2010-01-04T21:14:54Z", "creator": "bodewig@apache.org", "creation_time": "2010-01-04T21:14:54Z", "is_private": false}, {"count": 6, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 133325, "time": "2010-01-04T22:00:18Z", "bug_id": 41400, "creation_time": "2010-01-04T22:00:18Z", "is_private": false, "text": "After applying the patch one of Ant's tests (propertyhelper-test, testLoadProperties) fails:\n\nExpected property 'object2' to have value 'java.lang.Object@178acba' but was 'java.lang.Object@178acba'\nat line 124 , column 65\n\nand it is not obvious to me where the current test relies on double expansion.  The problem may as well be inside AntUnit.\n\nGiven that we are only days away from Ant 1.8.0, I'd prefer to defer looking into it until Ant 1.8.1."}, {"count": 7, "tags": [], "text": "(In reply to comment #6)\n> After applying the patch one of Ant's tests (propertyhelper-test,\n> testLoadProperties) fails:\n> \n> Expected property 'object2' to have value 'java.lang.Object@178acba' but was\n> 'java.lang.Object@178acba'\n> at line 124 , column 65\n> \n> and it is not obvious to me where the current test relies on double expansion. \n> The problem may as well be inside AntUnit.\n> \n> Given that we are only days away from Ant 1.8.0, I'd prefer to defer looking\n> into it until Ant 1.8.1.\n\nSorry that I haven't run the tests before even sending in the patch.\nI still couldn't get the tests running because for some reason junit.framework.TestCase isn't found and so all the tests fail.\n\nJUnit is definitely in the classpath, though. :/\n\n\nI recognize that error message. When I tried to fix the bug first I made\na change directly in MacroInstance.java which was rather a hack to see what was happening.\nWhen a return value in macroSubs() started with $ I just added another one. :D\nThe result were error messages like that one you got.\nThat is during the comparison of the values the property wasn't double-expanded but then again in the output, I think.", "attachment_id": null, "bug_id": 41400, "id": 133326, "time": "2010-01-04T22:51:34Z", "creator": "machisuji@googlemail.com", "creation_time": "2010-01-04T22:51:34Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 41400, "attachment_id": null, "text": "First of all, thank you for the patch, Markus - no need to apologize.\n\nThe best way to run Ant's tests (IMHO) is to put junit.jar into lib/optional in Ant's source tree and run \"./build.sh test\".\n\nMaking the code avoid the double expansion inside of MacroInstance may be cleaner but I doubt it can be done without help from UnknownElement or RuntimeConfigurable, we'll see.\n\nFrom the error message (the only one I've seen, BTW) it looks as if the two objects actually are the same but <equals> would fail to see that.", "id": 133361, "time": "2010-01-05T21:11:33Z", "creator": "bodewig@apache.org", "creation_time": "2010-01-05T21:11:33Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 41400, "attachment_id": null, "text": "I now managed to run the tests on a linux machine. On windows dozens of tests failed because some files could not be deleted or something.\nAnyway, in revision 900143 the propertyhelper-tests does not fail.\n\nActually my patch does not break any tests anymore.\nThe same tests failed before and after my patch.\n\nNow given the following file:\n\n<project name=\"Macros\" default=\"testBug\" basedir=\".\" \n\txmlns:au=\"antlib:org.apache.ant.antunit\">\n  <property name=\"one\" value=\"1\"/>\n  <property name=\"prop\" value=\"$${one}\"/>\n\n  <macrodef name=\"echotest\">\n    <attribute name=\"message\" />\n    <sequential>\n      <echo message=\"@{message}\" />\n    </sequential>\n  </macrodef>\n\n  <target name=\"testBug\">\n\t<echo message=\"$${builddir}\" />\n\t<echotest message=\"$${builddir}\"/>\n\t<au:assertPropertyEquals name=\"prop\" value=\"1\"/>\n  </target>\n</project>\n\nAfter the patch I get the following output:\n\nmarkus@Bunker-12:~$ ant -f macros.xml\nBuildfile: /home/markus/macros.xml\n\ntestBug:\n     [echo] ${builddir}\n     [echo] ${builddir}\n\nBUILD FAILED\n/home/markus/macros.xml:16: Expected property 'prop' to have value '1' but was '${one}'\n\nWhat puzzles me is that the output from testBug is also correct without my patch. It wasn't earlier (bug #42046), though.\nI wonder if it only works because of a 'workaround' or 'by accident'.\n\nI got to take a look into the source of AntUnit, I thought au:assertPropertyEquals was also simply a macrodef.", "id": 133656, "time": "2010-01-17T08:50:31Z", "creator": "machisuji@googlemail.com", "creation_time": "2010-01-17T08:50:31Z", "is_private": false}, {"count": 10, "tags": [], "creator": "machisuji@googlemail.com", "attachment_id": null, "id": 133657, "time": "2010-01-17T08:57:31Z", "bug_id": 41400, "creation_time": "2010-01-17T08:57:31Z", "is_private": false, "text": "Damn it I'm sorry. ^^\nAs you already said in response to my comment on bug #42046\nyou could still reproduce that bug.\nI couldn't, but only because I wrote ${BUILDdir} insetad of ${BASEdir} ...\nMy bad. *facepalm*\n\nNow that this is clear, my comment above boils down to this:\n\nMy patch doesn't seem to break any tests in revision 900143, which should be the latest as of now."}, {"count": 11, "tags": [], "text": "Hello,\n\nI was wondering what the state is of this bug. When will it be released in an ant version, and which version will this be?\n\nTiA!", "attachment_id": null, "bug_id": 41400, "id": 142443, "time": "2010-12-07T04:44:14Z", "creator": "a.broekhuis@gmail.com", "creation_time": "2010-12-07T04:44:14Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 41400, "attachment_id": null, "text": "Just hit this bug in 1.8.2. Nasty in my case as the variable being expanded was sometimes defined and sometimes not, making it very hard to track down.\n\nAny chance this patch will be included in a future release?", "id": 149109, "time": "2011-09-08T16:36:41Z", "creator": "greg.allen@nomura.com", "creation_time": "2011-09-08T16:36:41Z", "is_private": false}, {"count": 13, "tags": [], "creator": "bodewig@apache.org", "text": "\n\n*** This bug has been marked as a duplicate of bug 42046 ***", "id": 151601, "time": "2011-11-17T16:10:10Z", "bug_id": 41400, "creation_time": "2011-11-17T16:10:10Z", "is_private": false, "attachment_id": null}]
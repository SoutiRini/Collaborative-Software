[{"count": 0, "tags": [], "creator": "yann.grostete@alcatel-lucent.fr", "attachment_id": null, "id": 109297, "time": "2007-10-12T02:28:04Z", "bug_id": 43610, "creation_time": "2007-10-12T02:28:04Z", "is_private": false, "text": "Platform : RedHat ES 4, Apache 2.2.4, libapr-1.so.0.2.8,\nlibtcnative-1.so.0.1.6, Tomcat 5.5.23, Axis 1.4\n\nOverview description:\n---------------------\nA C# client sends, by default, a soap request in two parts :\nRequest-Line/Headers and then the body.\nIf the request is sent on a slow network, the request fails (See the\nstacktrace below).\n\nAxisFault\nfaultCode: {http://schemas.xmlsoap.org/soap/envelope/}Server.userException\nfaultSubcode:\nfaultString: java.io.IOException: Socket read failed\nfaultActor:\nfaultNode:\nfaultDetail:\n   {http://xml.apache.org/axis/}stackTrace:java.io.IOException: Socket\nread failed\n   at org.apache.coyote.ajp.AjpAprProcessor.read(AjpAprProcessor.java:1035)\n   at\norg.apache.coyote.ajp.AjpAprProcessor.readMessage(AjpAprProcessor.java:1156)\n   at\norg.apache.coyote.ajp.AjpAprProcessor.receive(AjpAprProcessor.java:1088)\n   at\norg.apache.coyote.ajp.AjpAprProcessor$SocketInputBuffer.doRead(AjpAprProcessor.java:1226)\n   at org.apache.coyote.Request.doRead(Request.java:419)\n   at\norg.apache.catalina.connector.InputBuffer.realReadBytes(InputBuffer.java:265)\n   at org.apache.tomcat.util.buf.ByteChunk.substract(ByteChunk.java:370)\n   at\norg.apache.catalina.connector.InputBuffer.readByte(InputBuffer.java:274)\n   at\norg.apache.catalina.connector.CoyoteInputStream.read(CoyoteInputStream.java:105)\n   at\ncom.sun.org.apache.xerces.internal.impl.XMLEntityManager$RewindableInputStream.read(XMLEntityManager.java:2622)\n   at\ncom.sun.org.apache.xerces.internal.impl.XMLEntityManager.setupCurrentEntity(XMLEntityManager.java:1033)\n   at\ncom.sun.org.apache.xerces.internal.impl.XMLVersionDetector.determineDocVersion(XMLVersionDetector.java:184)\n   at\ncom.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:798)\n   at\ncom.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:764)\n   at\ncom.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:148)\n   at\ncom.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1242)\n   at javax.xml.parsers.SAXParser.parse(SAXParser.java:375)\n   at\norg.apache.axis.encoding.DeserializationContext.parse(DeserializationContext.java:227)\n   at org.apache.axis.SOAPPart.getAsSOAPEnvelope(SOAPPart.java:696)\n   at org.apache.axis.Message.getSOAPEnvelope(Message.java:435)\n   at\norg.apache.axis.server.AxisServer.initSOAPConstants(AxisServer.java:345)\n   at org.apache.axis.server.AxisServer.invoke(AxisServer.java:279)\n   at\norg.apache.axis.transport.http.AxisServlet.doPost(AxisServlet.java:699)\n   at\ncom.alcatel.unifiedlogin.AlcUnifiedLoginServletWS.doPost(AlcUnifiedLoginServletWS.java:106)\n   at javax.servlet.http.HttpServlet.service(HttpServlet.java:710)\n   at\norg.apache.axis.transport.http.AxisServletBase.service(AxisServletBase.java:327)\n   at javax.servlet.http.HttpServlet.service(HttpServlet.java:803)\n   at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:269)\n   at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:188)\n   at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:210)\n   at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:174)\n   at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\n   at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:117)\n   at\norg.apache.catalina.authenticator.SingleSignOn.invoke(SingleSignOn.java:393)\n   at\norg.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:542)\n   at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:108)\n   at\norg.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:151)\n   at\norg.apache.coyote.ajp.AjpAprProcessor.process(AjpAprProcessor.java:444)\n   at\norg.apache.coyote.ajp.AjpAprProtocol$AjpConnectionHandler.process(AjpAprProtocol.java:472)\n   at\norg.apache.tomcat.util.net.AprEndpoint$Worker.run(AprEndpoint.java:1286)\n   at java.lang.Thread.run(Thread.java:595)\n\n\nSteps to reproduce:\n--------------------\n\n   1) Send soap request headers with 'Expect: 100-continue' header\n\nPOST /UnifiedLogin/services/AlcMpc HTTP/1.1\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; MS Web Services Client\nProtocol 2.0.50727.832)\nContent-Type: text/xml; charset=utf-8\nSOAPAction: \"getTopologyAndUserInformation\"\nHost: srvecc.aouch.alcatel.com\nContent-Length: 428\nExpect: 100-continue\nConnection: Close\n\n   2) Wait for 'HTTP/1.1 100 Continue' response\n   3) Wait 100 milliseconds\n   4) Send the soap body\n\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\nxmlns:xsd=\"http://www.w3.org/2001/XMLSchema\">\n<soap:Body><in0 xmlns=\"http://mpc.alcatel.com\">\n<parameter\nxmlns=\"http://types.mpc.alcatel.com\">16C636164756C6F5162747865727E2D696C6C6562702132333430213138393636383531313433383</parameter></in0>\n</soap:Body>\n</soap:Envelope>\n\n   5) Wait for the response, you should get something like that\n\nHTTP/1.1 500 Internal Server Error\nDate: Thu, 13 Sep 2007 07:28:32 GMT\nServer: Apache\nSet-Cookie: JSESSIONID=896692451D3787425D67734FEF50A658.exttomcat1;\nPath=/UnifiedLogin\nConnection: close\nTransfer-Encoding: chunked\nContent-Type: text/xml;charset=utf-8\n\n207\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soapenv:Envelope\nxmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"\nxmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"\nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n<soapenv:Body>\n<soapenv:Fault>\n<faultcode>soapenv:Server.userException</faultcode>\n<faultstring>java.io.IOException: Socket read failed</faultstring>\n<detail><ns1:hostname\nxmlns:ns1=\"http://xml.apache.org/axis/\">srvecc.aouch.alcatel.com</ns1:hostname></detail>\n</soapenv:Fault>\n</soapenv:Body>\n</soapenv:Envelope>\n0\n\nActual Results:\n   Soap requests fail on slow network.\n\nExpected Results:\n   Soap request should not failed, AjpAprProcessor.read(int n) method\nshould wait for body part."}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 111326, "time": "2007-12-01T11:32:21Z", "bug_id": 43610, "creation_time": "2007-12-01T11:32:21Z", "is_private": false, "text": "I assume you are using mod_proxy_ajp\n\nUsing:\n - httpd 2.2.4 with mod_proxy_ajp\n - Tomcat 5.5.X (latest from svn)\n - Native connector 1.1.10\n - Windows XP OS\n\nI cannot reproduce this problem. I have a very simple test client that connects\nto httpd, sends the headers, waits for the 100-continue and then sends the body\nand this works. I have manually stepped through the code so the delay between\nthe 100-continue and sending the request body is much more than 100ms.\n\nMy guess would be an old bug or odd behaviour from your soap client.\n\nI suggest you try the following:\n - upgrade to native connector 1.1.10\n - upgrade to Tomcat 5.5.25\n\nIf you still see the issue then try a simple test client. I can provide you with\nthe source for the one I use if that helps."}]
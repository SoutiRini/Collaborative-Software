[{"count": 0, "tags": [], "bug_id": 48381, "attachment_id": 24700, "text": "Created attachment 24700\nWebapp for demonstrating the bug\n\nOverview:\nIf the attribute name in the <Host> configuration contains upper case letters\nand you use a case-sensitive file system than the configuration files are\nlooked up in the wrong directory (hostname converted to lower case)\n\nRFC 1035 (DNS) says in section 2.3.1.:\nNote that while upper and lower case letters are allowed in domain\nnames, no significance is attached to the case.  That is, two names with\nthe same spelling but different case are to be treated as if identical.\n\nLet us suppose we have this configuration in the server.xml:\n\n<Engine name=\"Catalina\" defaultHost=\"Tux\">\n\n      <Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\"\n             resourceName=\"UserDatabase\"/>\n\n      <Host name=\"Tux\"  appBase=\"webapps\"\n            unpackWARs=\"true\" autoDeploy=\"true\"\n            xmlValidation=\"false\" xmlNamespaceAware=\"false\">\n      </Host>\n</Engine>\n\nThe expected behavior is, that the configuration files are searched under\n$CATALINA_BASE/conf/[engine_name]/[host_name] which is in our case\n$CATALINA_BASE/conf/Catalina/Tux\n\nInstead Tomcat converts silently Tux to tux and searches under\n$CATALINA_BASE/conf/Catalina/tux\n\nSteps to reproduce:\n1. Configure the server.xml with a hostname which contains upper case letters. See above.\n2. Deploy the webapp tomcatbug\n   cd webapps\n   unzip tomcatbug.zip\n   cd tomcatbug\n   ant all\n3. Create a file $CATALINA_BASE/conf/Catalina/Tux/tomcatbug.xml with this content\n   <Context>\n    <Resource name=\"bean/MyBeanFactory\" auth=\"Container\"\n            type=\"MyBean\"\n            factory=\"org.apache.naming.factory.BeanFactory\"\n            bar=\"23\"/> \n   </Context>\n4. Start tomcat and browse to http://Tux:8080/tomcatbug/TomcatBug\n\nActual result:\n<html>\n<head>\n<title>Tomcat Bug</title>\n</head>\n<body>\n<h1>Tomcat Bug</h1>\njavax.naming.NamingException: Cannot create resource instance\n    at org.apache.naming.factory.ResourceEnvFactory.getObjectInstance(ResourceEnvFactory.java:114)\n    at javax.naming.spi.NamingManager.getObjectInstance(NamingManager.java:304)\n    at org.apache.naming.NamingContext.lookup(NamingContext.java:793)\n    at org.apache.naming.NamingContext.lookup(NamingContext.java:140)\n    at org.apache.naming.NamingContext.lookup(NamingContext.java:781)\n    at org.apache.naming.NamingContext.lookup(NamingContext.java:153)\n    at TomcatBug.doGet(TomcatBug.java:29)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:617)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)\n    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:849)\n    at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)\n    at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:454)\n    at java.lang.Thread.run(Thread.java:619)\n</body>\n</html>\n\nExpected result:\n<html>\n<head>\n<title>Tomcat Bug</title>\n</head>\n<body>\n<h1>Tomcat Bug</h1>\nfoo = Default Foo, bar = 23\n</body>\n</html>\n\nAs a workaround you should not use upper case letters in hostnames. \nThis should be written in the documentation.", "id": 132778, "time": "2009-12-11T12:44:32Z", "creator": "jens.apel@web.de", "creation_time": "2009-12-11T12:44:32Z", "is_private": false}, {"attachment_id": 24701, "tags": [], "bug_id": 48381, "is_private": false, "count": 1, "id": 132779, "time": "2009-12-11T12:52:16Z", "creator": "jens.apel@web.de", "creation_time": "2009-12-11T12:52:16Z", "text": "Created attachment 24701\nThis patch is for the documentation (use lower case hostnames)"}, {"count": 2, "tags": [], "bug_id": 48381, "is_private": false, "text": "Created attachment 24702\nHoastnames are no longer lower case internally\n\nThis patch might have several side effects and the core developers \nmost likely had their reasons for converting hostnames to lower case internally.", "id": 132780, "time": "2009-12-11T12:56:17Z", "creator": "jens.apel@web.de", "creation_time": "2009-12-11T12:56:17Z", "attachment_id": 24702}, {"attachment_id": null, "tags": [], "bug_id": 48381, "is_private": false, "count": 3, "id": 132793, "time": "2009-12-13T15:09:01Z", "creator": "markt@apache.org", "creation_time": "2009-12-13T15:09:01Z", "text": "Treating host names in a case sensitive manner is likely to break things and is not consistent with RFC 1035.\n\nI have updated the docs for trunk, 6.0.x and 5.5.x."}]
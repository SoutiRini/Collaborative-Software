[{"count": 0, "tags": [], "creator": "janb@webtide.com", "is_private": false, "id": 184158, "creation_time": "2015-07-24T10:00:56Z", "time": "2015-07-24T10:00:56Z", "bug_id": 58178, "text": "Created attachment 32935\nProject demonstrating the problem\n\nIf a custom tag uses the jstl <catch> tag, then the exception is saved into the page attributes, but is not actually available to other tags via EL expressions.\n\nIf, however, the <catch> tag is used directly in a jsp page, then the exception is propagated into the var and visible to subsequent El expressions.\n\n\nI'm attaching a small project that contains a taglib that demonstrates the problem. The project contains 2 jsps:\n\n1. no-tagtest.jsp that uses the <catch> and other jstl tags directly in the jsp\n2. tagtest.jsp that references a custom tag that uses the <catch> and other jstl tags.\n\nThe problem seems to be that when a custom tag uses any other tags, then the page context is an instance of JspContextWrapper. When resolving el expressions, the JspContextWrapper.getElContext() returns an ELContext for the rootContext, rather than the page context. In this example, the <catch> tag saves the exception as an attribute named \"error\" in the page context attributes (the page context will be an instance of JspContextWrapper). However, when the \"error\" variable is referenced later in an EL expression, the EL mechanism has a page context that is the root context of the JspContextWrapper and thus can't resolve that variable.", "attachment_id": 32935}, {"attachment_id": null, "tags": [], "bug_id": 58178, "is_private": false, "count": 1, "id": 184305, "time": "2015-08-04T16:54:53Z", "creator": "markt@apache.org", "creation_time": "2015-08-04T16:54:53Z", "text": "There is also a similar issue with EL and imports.\n\nThe page context issue should be fixable by wrapping the root ELContext. I'm not sure that the imports issue is as easy to fix. It might end up needed a new ELContext per tag instance that uses EL and that is going to get expensive (i.e. slow down JSP pages).\n\nMore thought required."}, {"count": 2, "tags": [], "bug_id": 58178, "text": "I've dug into this a little more and I think this is fixable for both the reported use case and the import use case by wrapping the ELContext. I'm working on some test cases and a fix.", "id": 184377, "time": "2015-08-06T10:15:45Z", "creator": "markt@apache.org", "creation_time": "2015-08-06T10:15:45Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 58178, "attachment_id": null, "id": 184386, "time": "2015-08-06T15:27:45Z", "creator": "markt@apache.org", "creation_time": "2015-08-06T15:27:45Z", "is_private": false, "text": "The PageContext part of this has been fixed in trunk, 8.0.x (for 8.0.25 onwards) and 7.0.x (for 7.0.64 onwards).\n\nThe import part of this only affects 8.0.x onwards."}, {"attachment_id": null, "tags": [], "bug_id": 58178, "is_private": false, "count": 4, "id": 184393, "time": "2015-08-06T18:27:40Z", "creator": "markt@apache.org", "creation_time": "2015-08-06T18:27:40Z", "text": "Import part fixed in trunk and 8.0.x (for 8.0.25 onwards)."}, {"count": 5, "tags": [], "creator": "psurana@zimbra.com", "is_private": false, "id": 185705, "creation_time": "2015-10-09T07:15:45Z", "time": "2015-10-09T07:15:45Z", "bug_id": 58178, "text": "Hello Mark, \nIs there way to patch the fix to 8.0.23? \nCould you please let us know the class/java files need to replaced in 8.0.23 to make this work?", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 58178, "text": "The patches for 8.0.x are r1694503 and r1694548.\n\nI would not recommend copying class files from one version to another. If you really want to patch this in 8.0.23 then you need to checkout the 8.0.23 tag, apply the two patches above and then build your patched version of 8.0.23 from source.\n\nI'd recommend not pathcing and upgrading to 8.0.latest instead.", "count": 6, "id": 185706, "time": "2015-10-09T07:23:31Z", "creator": "markt@apache.org", "creation_time": "2015-10-09T07:23:31Z", "is_private": false}, {"count": 7, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 197499, "creation_time": "2017-03-07T10:56:19Z", "time": "2017-03-07T10:56:19Z", "bug_id": 58178, "text": "See also http://tomcat.markmail.org/thread/cnqkckysilwhpyip for a discussion on a follow-up issue and r1785823, r1785826 and r1785827", "is_private": false}]
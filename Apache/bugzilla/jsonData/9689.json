[{"count": 0, "tags": [], "bug_id": 9689, "attachment_id": null, "id": 17398, "time": "2002-06-07T11:29:38Z", "creator": "solomon@conceptshopping.com", "creation_time": "2002-06-07T11:29:38Z", "is_private": false, "text": "Apache 2.0.36 core dumps on certain configuration errors.\n\nplatform:\n    SunOS concept 5.7 Generic_106541-14 sun4u sparc SUNW,Ultra-60\n\nConfigured with\n    ./configure --enable-ssl\n\nIn ssl.conf, I mistakenly had two SSLCertificateFile lines.\n    SSLCertificateFile /usr/local/apache2/conf/www.crt\n    SSLCertificateFile /usr/local/apache2/conf/www.key\n(the second one was supposed to be SSLCertificateKeyFile).\n\nI started it from apachectl via \"startssl\" which invokes httpd with -DSSL\nand it core-dumped.\n\nHere's the stack trace:\n\n#0  apr_file_write (thefile=0x0, buf=0x1427c8, nbytes=0xffbed71c)\n    at readwrite.c:225\n#1  0xff33fb14 in apr_file_puts (\n    str=0x1427c8 \"Apache:mod_ssl:Error: Private key not found.\\n\", thefile=0x0)\n    at readwrite.c:340\n#2  0xff33fc94 in apr_file_printf (fptr=0x0, \n    format=0x2d <Address 0x2d out of bounds>) at readwrite.c:409\n#3  0x3c9e0 in ssl_pphrase_Handle (s=0xb76d0, p=0xee110)\n    at ssl_engine_pphrase.c:442\n#4  0x36aa8 in ssl_init_Module (p=0xb4028, plog=0xec108, ptemp=0xee110, \n    base_server=0xb76d0) at ssl_engine_init.c:281\n#5  0x5dd24 in ap_run_post_config (pconf=0xb4028, plog=0xec108, ptemp=0xee110, \n    s=0xb76d0) at config.c:129\n#6  0x62918 in main (argc=2, argv=0xffbefa24) at main.c:579\n\nIgnore the \"<Address 0x2d out of bounds>\", which appears to be gdb confused by\nvarargs.  The key point is the call at ssl_engine_pphrase.c:442:\n\n    apr_file_printf(writetty,\n        \"Apache:mod_ssl:Error: Pass phrase incorrect.\\n\");\n\nAt this ponit, writetty is NULL.  The only assignment to writetty is at line\n581 in ssl_pipe_child_create, and this function has never been called.\nThe only call to ssl_pipe_child_create is in ssl_pphrase_Handle_CB.\nThere are no direct calls to this function, but it's passed as an argument\nto SSL_read_PrivateKey and thence to modssl_PEM_read_bio_PrivateKey\nwhich is a macro for PEM_read_bio_PrivateKey, which is also a macro (in ssl)\nfor PEM_ASN1_read_bio.  Burried deep in the file ssleay.txt, which is included\nwith the openssl sources, I found this:\n\n    If the data is encrypted, 'cb' will be called to prompt for a password.\n\nApparently, in my case, the data is not encrypted, so \"cb\" (in this case\nssl_pphrase_Handle_CB) is never called, so writetty is never initialized.\n\nFix:  I'm not exactly sure.  This logic is too convoluted for me to follow.\n\nWork-around:  Don't make mistakes in the .conf files :-)."}, {"count": 1, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "text": "This problem was fixed in 2.0.39.  Unfortunately, it didn't appear in\nCHANGES and the person who fixed it was not aware of this PR.  See the\ndescription of revision 1.42 here:\n\nhttp://cvs.apache.org/viewcvs.cgi/httpd-2.0/modules/ssl/ssl_engine_pphrase.c\n\nThanks for your report, and thanks for using Apache!\n", "id": 18297, "time": "2002-06-21T12:21:29Z", "bug_id": 9689, "creation_time": "2002-06-21T12:21:29Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 35987, "attachment_id": null, "id": 77977, "time": "2005-08-03T00:52:56Z", "creator": "msunde@actional.com", "creation_time": "2005-08-03T00:52:56Z", "is_private": false, "text": "If I add a presetdef for java, then the jspc task breaks. There may be a few \nother optional tasks that break due to this.\n\nNotice that the output below does not contain much in the way of information \nfor diagnosing the problem. I put the log level to debug and I still didn't get \nmuch in the way of information.\n\nNote: I have since worked around the problem in my build.\n\n------------------------------------------------------------------\nInvestigation\n------------------------------------------------------------------\n\nAfter a little investigation it turns out that JasperC.java attempts to create \nthe \"java\" task:\n   Java java = (Java) (getProject().createTask(\"java\"));\n\nA bit further on in ComponentHelper.java we end up with a ClassCastException on \nthe following line:\n   Task task = (Task) createComponent(taskType);\n\ncreateComponent returns a PreSetDef$PreSetDefinition which can not be casted to \na Task.\n\nThis bug is similar to: http://issues.apache.org/bugzilla/show_bug.cgi?id=33433\n\nBTW, debugging the code showed that there is a field called \"cause\" with the \nsame name in BuildException as the Throwable base class. I don't know if this \nwill cause confusion.\n\n------------------------------------------------------------------\nOutput\n------------------------------------------------------------------\n\nBuildfile: build.xml\n\nall:\nTrying to override old definition of task java\n     [jspc] Compiling 1 source fileD:\\antBug\\build\n\nBUILD FAILED\nD:\\antBug\\build.xml:23: Error running jsp compiler:\n\nTotal time: 1 second\n\n------------------------------------------------------------------\nbuild.xml\n------------------------------------------------------------------\n\n<?xml version=\"1.0\"?>\n<project name=\"test\" default=\"all\" basedir=\".\">\n\n<target name=\"all\">\n<!-- Comment out the PresetDef to get the jspc task working.-->\n\t<presetdef name=\"java\">\n\t\t<java failonerror=\"${failonerror}\"/>\n\t</presetdef>\n\n\t<mkdir dir=\"src\"/>\n\t<mkdir dir=\"build\"/>\n\t<mkdir dir=\"classes\"/>\n\t<touch file=\"src/test.jsp\"/>\n\n\t<property name=\"classesDir\" location=\"classes\"/>\n\n\t<path id=\"jsp.classpath\">\n\t\t<pathelement \n\t\t\tlocation=\"${classesDir}/org.apache.jasper.jar\"/>\n\t\t<pathelement location=\"${classesDir}/javax.servlet.jar\"/>\n\t</path>\n\n    \t<jspc  \tsrcdir=\"src\"\n    \t\tdestdir=\"build\">\n    \t\t<classpath refid=\"jsp.classpath\"/>\n    \t\t<include name=\"**\\/*.jsp\" />\n    \t</jspc>\n</target>\n\n</project>"}, {"count": 1, "tags": [], "creator": "alexeys@inventigo.com", "text": "I think it would be nice so implement <presetdef> by storing default parameters inside project. project.createTaks() could just set default parameters before returning the task object.", "id": 77978, "time": "2005-08-03T00:57:46Z", "bug_id": 35987, "creation_time": "2005-08-03T00:57:46Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 35987, "attachment_id": null, "id": 77985, "time": "2005-08-03T08:43:59Z", "creator": "jan@materne.de", "creation_time": "2005-08-03T08:43:59Z", "is_private": false, "text": "neat idea for that\n\nI mean I had read on the dev-list that the createTask() shouldnt be used any \nmore ... long time ago I read that ... mmh, havent found any in the archive. \nMaybe I\u00b4m wrong here."}, {"count": 3, "tags": [], "bug_id": 35987, "attachment_id": null, "id": 77993, "time": "2005-08-03T10:47:31Z", "creator": "stevel@apache.org", "creation_time": "2005-08-03T10:47:31Z", "is_private": false, "text": "I believe we have fixed this in all ant tasks in the CVS_HEAD codebase, but are\nstill vulnerable to any third party task copying our old createTask(\"java\")\nstyle of creation, and so breaking. "}, {"count": 4, "tags": [], "creator": "peterreilly@apache.org", "text": "It is the same as 33433 - Steve's fix for that bug\nmodified JasperC as described by Steve - so the current\ncvs ant HEAD is ok.\n\nI think I better put in a *strong* warning in\nthe presetdef page that one is not meant to\nuse a preexisting task name. The example in\nthe manual suggested that one can do that, however\nthe example actually uses a different namespace.\n\n*** This bug has been marked as a duplicate of 33433 ***", "id": 77995, "time": "2005-08-03T11:26:31Z", "bug_id": 35987, "creation_time": "2005-08-03T11:26:31Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "bug_id": 35987, "text": "(In reply to comment #4)\n\nSorry for the confusion, I couldn't find HEAD binaries to test against.", "id": 78011, "time": "2005-08-03T16:05:23Z", "creator": "msunde@actional.com", "creation_time": "2005-08-03T16:05:23Z", "tags": [], "is_private": false}]
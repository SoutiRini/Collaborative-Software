[{"count": 0, "tags": [], "bug_id": 37381, "attachment_id": null, "id": 82178, "time": "2005-11-07T14:02:01Z", "creator": "carl@zero-one.co.za", "creation_time": "2005-11-07T14:02:01Z", "is_private": false, "text": "I have certain JSP pages where no buffer is required - or rather a buffer of 0\nIS required - being set via: <%@ page buffer=\"none\" %>.  On this implementation\na security check is performed (session based) and if it fails, I do a\npageContext.forward(\"/somepath/jsp\").  Works file, except on the pages where <%@\npage buffer=\"none\" %> is specified.  \n\nException details:\n\nIllegal to clear() when buffer size == 0\njava.lang.IllegalStateException\nat org.apache.jasper.runtime.JspWriterImpl.clear(JspWriterImpl.java:144)\n    at org.apache.jasper.runtime.PageContextImpl.doForward(PageContextImpl.java:646)\n    at org.apache.jasper.runtime.PageContextImpl.forward(PageContextImpl.java:637)\n    at com.unysen.security.SecurityCheckTag.doStartTag(SecurityCheckTag.java:179)\n\nWould it not be safe to do a:\n\nif (pageContext.getOut().getBufferSize() > 0)\n  JspWriterImpl.clear();\n\nNot sure if this is required by the JSP spec or not, but seems like a logical\ncheck to make :)\n\nThanks."}, {"count": 1, "tags": [], "bug_id": 37381, "attachment_id": null, "is_private": false, "id": 82937, "time": "2005-11-28T21:55:42Z", "creator": "yoavs@computer.org", "creation_time": "2005-11-28T21:55:42Z", "text": "Does this happen in 5.5.12 as well?"}, {"attachment_id": 17095, "tags": [], "bug_id": 37381, "is_private": false, "count": 2, "id": 83051, "time": "2005-12-01T02:00:27Z", "creator": "carl@zero-one.co.za", "creation_time": "2005-12-01T02:00:27Z", "text": "Created attachment 17095\nSimple test case to reproduce the error"}, {"count": 3, "tags": [], "bug_id": 37381, "text": "Yes it does.  just did a test using a very simple JSP - same err:\n\njava.lang.IllegalStateException: Illegal to clear() when buffer size == 0\n\torg.apache.jasper.runtime.JspWriterImpl.clear(JspWriterImpl.java:146)\n\torg.apache.jasper.runtime.PageContextImpl.doForward(PageContextImpl.java:669)\n\torg.apache.jasper.runtime.PageContextImpl.forward(PageContextImpl.java:660)\n\torg.apache.jsp.respbufftest_jsp._jspService(org.apache.jsp.respbufftest_jsp:45)\n\torg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:97)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:322)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:264)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\nnote The full stack trace of the root cause is available in the Apache\nTomcat/5.5.12 logs.\n\nJSP used to get the above has been attached for you convenience.", "id": 83052, "time": "2005-12-01T02:00:42Z", "creator": "carl@zero-one.co.za", "creation_time": "2005-12-01T02:00:42Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 37381, "attachment_id": 17145, "is_private": false, "id": 83215, "time": "2005-12-05T01:39:35Z", "creator": "carl@zero-one.co.za", "creation_time": "2005-12-05T01:39:35Z", "text": "Created attachment 17145\nPatch to PageContextImpl to fix the bug\n\nPatch created from Eclipse/SVN to fix the problem."}, {"count": 5, "tags": [], "bug_id": 37381, "attachment_id": null, "id": 94356, "time": "2006-10-01T20:21:06Z", "creator": "markt@apache.org", "creation_time": "2006-10-01T20:21:06Z", "is_private": false, "text": "This is not a Tomcat bug, this is a whitespace issue in your JSP.\n\n<%@ page language=\"java\" contentType=\"text/html; charset=ISO-8859-1\"\n    pageEncoding=\"ISO-8859-1\" buffer=\"none\" %>\n<%\n\tpageContext.forward(\"forward.jsp\");\n%>\nwill throw an exception.\n\n<%@ page language=\"java\" contentType=\"text/html; charset=ISO-8859-1\"\n    pageEncoding=\"ISO-8859-1\" buffer=\"none\" %><%\n\tpageContext.forward(\"forward.jsp\");\n%>\nwill not throw the exception."}]
[{"count": 0, "tags": [], "bug_id": 8306, "is_private": false, "text": "We have been noticing that Apache has been pausing and not accepting requests \nover the last few months (End of Jan time frame)  If left alone the Apache \nprocess begins to start accepting requests again (takes anywhere from 1 min to \n5 minutes, and never longer than 5 minutes)\n\nI have seen this with with Apache 1.3.23, 1.3.24  \nI am running Linux RedHat 6.2 with 2.2.19-6.2.12smp kernel. \n\nThis problem comes and goes as quickly as it starts. Hereis my http config:\n\n httpd -V\nServer version: Apache/1.3.24 (Unix)\nServer built:   Apr 15 2002 17:05:43\nServer's Module Magic Number: 19990320:11\nServer compiled with....\n -D HAVE_MMAP\n -D HAVE_SHMGET\n -D USE_SHMGET_SCOREBOARD\n -D USE_MMAP_FILES\n -D HAVE_FCNTL_SERIALIZED_ACCEPT\n -D HAVE_SYSVSEM_SERIALIZED_ACCEPT\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D HTTPD_ROOT=\"/etc/httpd\"\n -D SUEXEC_BIN=\"/usr/sbin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/httpd.scoreboard\"\n -D DEFAULT_LOCKFILE=\"logs/httpd.lock\"\n -D DEFAULT_XFERLOG=\"logs/access_log\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n -D ACCESS_CONFIG_FILE=\"conf/access.conf\"\n -D RESOURCE_CONFIG_FILE=\"conf/srm.conf\"\n\nIf there is anything else that you need please drop me an email.", "id": 14073, "time": "2002-04-19T18:06:29Z", "creator": "hribnak@nucleus.com", "creation_time": "2002-04-19T18:06:29Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 8306, "attachment_id": null, "text": "Could you try playing with the value of the AcceptMutex directive and see if\nit makes the problem go away.  See:\nhttp://httpd.apache.org/docs/mod/core.html#acceptmutex\nIt looks like good values for your system are\nAcceptMutex fnctl\nor\nAcceptMutex sysvsem\n", "id": 14096, "time": "2002-04-19T21:40:17Z", "creator": "slive@apache.org", "creation_time": "2002-04-19T21:40:17Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 8306, "is_private": false, "id": 14097, "time": "2002-04-19T21:44:00Z", "creator": "slive@apache.org", "creation_time": "2002-04-19T21:44:00Z", "tags": [], "text": "Also, this may be a dupe of bug 8117, but I'm not sure so I'll leave it for now."}, {"count": 3, "attachment_id": null, "creator": "hribnak@nucleus.com", "text": "I have added AcceptMutex sysvsem  as the other AcceptMutex fnctl does not \nwork  at all I get the following when started apache:\n\nRequested serialization method 'fnctl' not  available\n\n\nI am still having the parent httpd process pausing. I had it happen 2 times so \nfar today for about 1 min each time (one at 3am MST and one at 1:26 pm)\n\nSo the AcceptMutex sysvsem did not help at all.\n", "id": 14145, "time": "2002-04-20T23:06:06Z", "bug_id": 8306, "creation_time": "2002-04-20T23:06:06Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 8306, "attachment_id": null, "text": "That was a typo on my part.  It should be\nAcceptMutex fcntl\nas in\n-D HAVE_FCNTL_SERIALIZED_ACCEPT\nfrom your httpd -V output.", "id": 14146, "time": "2002-04-20T23:26:41Z", "creator": "slive@apache.org", "creation_time": "2002-04-20T23:26:41Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 8306, "is_private": false, "text": "I am trying the AcceptMutex fcntl  now to see how this works.  If this does \nnot work where do we go from here?\n\nI also had an HTTPD  lockup a few mins ago (server load ramped up to 190), \nwhen doing a killall httpd (under linux) all httpd processes were killed \nexcept 1, I had to do multiple kill -9 <process id> before it would die (is \nthis the same issue with the pausing perhaps? this happens once in a while as \nwell..\n", "id": 14197, "time": "2002-04-21T20:25:40Z", "creator": "hribnak@nucleus.com", "creation_time": "2002-04-21T20:25:40Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "hribnak@nucleus.com", "text": "Setting httpd to use AcceptMutex fcntl also has no affect, I had 3 pauses after \nadding this. \n\nWhere do we go from here? Also is this the same bug I noticed on the bug list \nas ", "id": 14321, "time": "2002-04-22T15:48:51Z", "bug_id": 8306, "creation_time": "2002-04-22T15:48:51Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 8306, "attachment_id": null, "text": "Can you give us a backtrace on one of the \"paused\" processes please?   \nSee http://httpd.apache.org/dev/debugging.html  \nThanks! ", "id": 14338, "time": "2002-04-22T17:36:20Z", "creator": "jwoolley@apache.org", "creation_time": "2002-04-22T17:36:20Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 8306, "attachment_id": null, "text": "I will try and get this, over the last 4 days this pausing has been happening \nin the early morning hours, unless it happens during the day this will be hard \nto do.  I will monitor this during the day, and hope to see it happening so I \ncan get the backtrace.\n\n", "id": 14340, "time": "2002-04-22T17:45:18Z", "creator": "hribnak@nucleus.com", "creation_time": "2002-04-22T17:45:18Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 8306, "attachment_id": null, "is_private": false, "id": 14659, "time": "2002-04-24T19:15:02Z", "creator": "hribnak@nucleus.com", "creation_time": "2002-04-24T19:15:02Z", "text": "Update:  \n\nPausing has not occured since April 22 at 6:45 am, no changes had been done \nSince Sat or Sunday (when changing from sysv to fcntl"}, {"count": 10, "tags": [], "bug_id": 8306, "is_private": false, "text": "The server resumed pausing again, I managed to get the following live trace I \ndid a where a few times.. HOPE this helps!!!\n\ngdb httpd 28168\nGNU gdb 19991004\nCopyright 1998 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-redhat-linux\"...(no debugging symbols found)...\n\n/home/cvsroot/CVSROOT/28168: No such file or directory.\nAttaching to program: /usr/sbin/httpd, Pid 28168\nReading symbols from /lib/libpam.so.0...(no debugging symbols found)...done.\nReading symbols from /lib/libdl.so.2...done.\nReading symbols from /lib/libcrypt.so.1...done.\nReading symbols from /lib/libresolv.so.2...done.\nReading symbols from /lib/libm.so.6...done.\nReading symbols from /lib/libnsl.so.1...done.\nReading symbols from /lib/libdb.so.3...done.\nReading symbols from /lib/libc.so.6...done.\nReading symbols from /lib/ld-linux.so.2...done.\nReading symbols from /lib/libnss_files.so.2...done.\nReading symbols from /usr/lib/gconv/ISO8859-1.so...done.\n0x401800de in __select () from /lib/libc.so.6\n(gdb) where\n#0  0x401800de in __select () from /lib/libc.so.6\n#1  0x401c314c in ?? () from /lib/libc.so.6\n#2  0x813d249 in ap_child_terminate ()\n#3  0x813d903 in main ()\n#4  0x400eb9cb in __libc_start_main (main=0x813d5bc <main>, argc=1, \nargv=0xbffffb14, \n    init=0x8062b4c <_init>, fini=0x816b96c <_fini>, rtld_fini=0x4000aea0 \n<_dl_fini>, \n    stack_end=0xbffffb0c) at ../sysdeps/generic/libc-start.c:92\n(gdb) where\n#0  0x401800de in __select () from /lib/libc.so.6\n#1  0x401c314c in ?? () from /lib/libc.so.6\n#2  0x813d249 in ap_child_terminate ()\n#3  0x813d903 in main ()\n#4  0x400eb9cb in __libc_start_main (main=0x813d5bc <main>, argc=1, \nargv=0xbffffb14, \n    init=0x8062b4c <_init>, fini=0x816b96c <_fini>, rtld_fini=0x4000aea0 \n<_dl_fini>, \n    stack_end=0xbffffb0c) at ../sysdeps/generic/libc-start.c:92\n(gdb) where\n#0  0x401800de in __select () from /lib/libc.so.6\n#1  0x401c314c in ?? () from /lib/libc.so.6\n#2  0x813d249 in ap_child_terminate ()\n#3  0x813d903 in main ()\n#4  0x400eb9cb in __libc_start_main (main=0x813d5bc <main>, argc=1, \nargv=0xbffffb14, \n    init=0x8062b4c <_init>, fini=0x816b96c <_fini>, rtld_fini=0x4000aea0 \n<_dl_fini>, \n    stack_end=0xbffffb0c) at ../sysdeps/generic/libc-start.c:92\n(gdb) where\n#0  0x401800de in __select () from /lib/libc.so.6\n#1  0x401c314c in ?? () from /lib/libc.so.6\n#2  0x813d249 in ap_child_terminate ()\n#3  0x813d903 in main ()\n#4  0x400eb9cb in __libc_start_main (main=0x813d5bc <main>, argc=1, \nargv=0xbffffb14, \n    init=0x8062b4c <_init>, fini=0x816b96c <_fini>, rtld_fini=0x4000aea0 \n<_dl_fini>, \n    stack_end=0xbffffb0c) at ../sysdeps/generic/libc-start.c:92\n(gdb) where\n#0  0x401800de in __select () from /lib/libc.so.6\n#1  0x401c314c in ?? () from /lib/libc.so.6\n#2  0x813d249 in ap_child_terminate ()\n#3  0x813d903 in main ()\n#4  0x400eb9cb in __libc_start_main (main=0x813d5bc <main>, argc=1, \nargv=0xbffffb14, \n    init=0x8062b4c <_init>, fini=0x816b96c <_fini>, rtld_fini=0x4000aea0 \n<_dl_fini>, \n    stack_end=0xbffffb0c) at ../sysdeps/generic/libc-start.c:92\n(gdb) where\n#0  0x401800de in __select () from /lib/libc.so.6\n#1  0x401c314c in ?? () from /lib/libc.so.6\n#2  0x813d249 in ap_child_terminate ()\n#3  0x813d903 in main ()\n#4  0x400eb9cb in __libc_start_main (main=0x813d5bc <main>, argc=1, \nargv=0xbffffb14, \n    init=0x8062b4c <_init>, fini=0x816b96c <_fini>, rtld_fini=0x4000aea0 \n<_dl_fini>, \n    stack_end=0xbffffb0c) at ../sysdeps/generic/libc-start.c:92\n(gdb) where\n#0  0x401800de in __select () from /lib/libc.so.6\n#1  0x401c314c in ?? () from /lib/libc.so.6\n#2  0x813d249 in ap_child_terminate ()\n#3  0x813d903 in main ()\n#4  0x400eb9cb in __libc_start_main (main=0x813d5bc <main>, argc=1, \nargv=0xbffffb14, \n    init=0x8062b4c <_init>, fini=0x816b96c <_fini>, rtld_fini=0x4000aea0 \n<_dl_fini>, \n    stack_end=0xbffffb0c) at ../sysdeps/generic/libc-start.c:92\n(gdb) quit\n", "id": 15178, "time": "2002-04-30T18:48:25Z", "creator": "hribnak@nucleus.com", "creation_time": "2002-04-30T18:48:25Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 8306, "attachment_id": null, "is_private": false, "id": 15258, "time": "2002-05-01T17:20:58Z", "creator": "hribnak@nucleus.com", "creation_time": "2002-05-01T17:20:58Z", "text": "Any updated information on this?  This is continually happening even today I \nwould like to get a resolution to this matter as soon as humanly possible.\n\nThanks"}, {"count": 12, "tags": [], "bug_id": 8306, "attachment_id": null, "is_private": false, "id": 15935, "time": "2002-05-11T06:18:44Z", "creator": "hribnak@nucleus.com", "creation_time": "2002-05-11T06:18:44Z", "text": "Maybe this will help.  Tonight we had a pause again. I did a netstat -n and \nfound an IP hitting every IP on the server (port 80)\n\nCould that be the cause of the problem?\n\ntcp        0      0 20x.115.x.20:80       213.219.39.141:57590    SYN_RECV    \ntcp        0      0 20x.115.x.29:80       213.219.39.141:9237     SYN_RECV    \ntcp        0      0 20x.115.x.31:80       213.219.39.141:664      SYN_RECV    \ntcp        0      0 20x.115.x.39:80       213.219.39.141:53603    SYN_RECV    \ntcp        0      0 20x.115.x.41:80       213.219.39.141:31441    SYN_RECV    \ntcp        0      0 20x.115.x.82:80       213.219.39.141:31442    SYN_RECV    \ntcp        0      0 20x.115.x.83:80       213.219.39.141:32930    SYN_RECV    \ntcp        0      0 20x.115.x.85:80       213.219.39.141:16899    SYN_RECV    \ntcp        0      0 20x.115.x.2:80        213.219.39.141:12062    SYN_RECV    \ntcp        0      0 20x.115.x.65:80       213.219.39.141:10552    SYN_RECV    \ntcp        0      0 20x.115.x.68:80       213.219.39.141:17598    SYN_RECV    \ntcp        0      0 20x.115.x.72:80       213.219.39.141:9975     SYN_RECV    \ntcp        0      0 20x.115.x.79:80       213.219.39.141:27075    SYN_RECV    \ntcp        0      0 20x.115.x.20:80       213.219.39.141:43589    SYN_RECV    \ntcp        0      0 20x.115.x.29:80       213.219.39.141:58426    SYN_RECV    \ntcp        0      0 20x.115.x.31:80       213.219.39.141:48969    SYN_RECV    \ntcp        0      0 20x.115.x.20:80       213.219.39.141:2718     SYN_RECV    \ntcp        0      0 20x.115.x.29:80       213.219.39.141:47633    SYN_RECV    \ntcp        0      0 20x.115.x.2:80        213.219.39.141:4223     SYN_RECV    \ntcp        0      0 20x.115.x.31:80       213.219.39.141:35287    SYN_RECV    \ntcp        0      0 20x.115.x.39:80       213.219.39.141:47163    SYN_RECV    \ntcp        0      0 20x.115.x.41:80       213.219.39.141:24175    SYN_RECV    \ntcp        0      0 20x.115.x.82:80       213.219.39.141:6949     SYN_RECV    \ntcp        0      0 20x.115.x.83:80       213.219.39.141:4794     SYN_RECV    \ntcp        0      0 20x.115.x.85:80       213.219.39.141:16426    SYN_RECV    \ntcp        0      0 20x.115.x.39:80       213.219.39.141:24768    SYN_RECV    \ntcp        0      0 20x.115.x.41:80       213.219.39.141:17975    SYN_RECV    \ntcp        0      0 20x.115.x.83:80       213.219.39.141:28495    SYN_RECV    \ntcp        0      0 20x.115.x.82:80       213.219.39.141:14731    SYN_RECV    \ntcp        0      0 20x.115.x.85:80       213.219.39.141:60559    SYN_RECV    \ntcp        0      0 20x.115.x.2:80        213.219.39.141:37863    SYN_RECV    \ntcp        0      0 20x.115.x.68:80       213.219.39.141:58453    SYN_RECV    \ntcp        0      0 20x.115.x.65:80       213.219.39.141:19288    SYN_RECV    \ntcp        0      0 20x.115.x.72:80       213.219.39.141:2499     SYN_RECV    \ntcp        0      0 20x.115.x.79:80       213.219.39.141:944      SYN_RECV    \ntcp        0      0 20x.115.x.65:80       213.219.39.141:14411    SYN_RECV    \ntcp        0      0 20x.115.x.68:80       213.219.39.141:2924     SYN_RECV    \ntcp        0      0 20x.115.x.72:80       213.219.39.141:13744    SYN_RECV    \ntcp        0      0 20x.115.x.79:80       213.219.39.141:24918    SYN_RECV   "}, {"count": 13, "attachment_id": null, "creator": "jwoolley@apache.org", "text": "Yep, that'd do it... sounds like a classic syn flood Denial of Service attack.  \nAnd there's nothing Apache can do about it... I believe you can configure Linux \nto cope better in this particular situation.", "id": 15936, "time": "2002-05-11T06:44:31Z", "bug_id": 8306, "creation_time": "2002-05-11T06:44:31Z", "tags": [], "is_private": false}, {"count": 14, "tags": [], "bug_id": 8306, "text": "Well lets hope this is all that it is.. I have done the following to my Linux \nserver\n\necho 1   >/proc/sys/net/ipv4/tcp_syncookies\n\n", "id": 15937, "time": "2002-05-11T07:31:01Z", "creator": "hribnak@nucleus.com", "creation_time": "2002-05-11T07:31:01Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Add a boolean property to org.apache.log4j.net.JMSAppender that will specify if messages should be sent in persistent delivery mode.  In high-volume applications, persistent delivery (currently the default) can cause performance problems on the JMS server.\n\nSuggested code changes:\n\n...\nboolean persistentDelivery = false;  // add getters/setters\n...\n\n\n  /**\n     This method called by {@link AppenderSkeleton#doAppend} method to\n     do most of the real appending work.  */\n  public void append(LoggingEvent event) {\n    if(!checkEntryConditions()) {\n      return;\n    }\n\n    try {\n      ObjectMessage msg = topicSession.createObjectMessage();\n      if(locationInfo) {\n\tevent.getLocationInformation();\n      }\n      msg.setObject(event);\n\n      /****** Enhancement - check for persistent delivery ******/\n      msg.setJMSDeliveryMode(persistentDelivery ? \n           DeliveryMode.PERSISTENT : DeliveryMode.NON_PERSISTENT);\n      /****** End of enhancement ******/\n\n      topicPublisher.publish(msg);\n    } catch(JMSException e) {\n      errorHandler.error(\"Could not publish message in JMSAppender [\"+name+\"].\", e,\n\t\t\t ErrorCode.GENERIC_FAILURE);\n    } catch(RuntimeException e) {\n      errorHandler.error(\"Could not publish message in JMSAppender [\"+name+\"].\", e,\n\t\t\t ErrorCode.GENERIC_FAILURE);\n    }\n  }", "is_private": false, "id": 136629, "creator": "vandezuma@gmail.com", "time": "2010-05-04T13:04:21Z", "bug_id": 49247, "creation_time": "2010-05-04T13:04:21Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 49247, "is_private": false, "text": "Just discovered, you have to also set the delivery mode on the topicSender:\n\nin activateOptions():\n\n     topicPublisher = topicSession.createPublisher(topic); //existing\n     \n     topicPublisher.setDeliveryMode(this.persistentDelivery ? \n    \t\t  DeliveryMode.PERSISTENT : DeliveryMode.NON_PERSISTENT);", "id": 136630, "time": "2010-05-04T14:17:12Z", "creator": "vandezuma@gmail.com", "creation_time": "2010-05-04T14:17:12Z", "attachment_id": null}]
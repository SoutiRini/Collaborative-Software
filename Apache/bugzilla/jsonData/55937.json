[{"count": 0, "tags": [], "bug_id": 55937, "text": "Created attachment 31162\ncatalina and localhost logs\n\nI am trying to deploy a web app as the ROOT application for Tomcat 7, running on Ubuntu 12 with Amazon EC2. I experienced the problem with 7.0.35, 7.0.42, and 7.0.49.\n\n1) When I use auto-deploy using the Tomcat Deployer 'deploy' ant task to a non-ROOT context name, such as /360Site, everything works as expected - war file is uploaded, decompressed to directory, and is immediately available.\n\n2) When I use the manager HTML interface to upload the ROOT.war file by clicking the 'Select WAR file to upload' and then clicking 'deploy', everything works as expected.\n\nHowever, 3) When I do exactly the same thing as #1 (tomcat auto deploy) but just change the 'path' variable from /360Store to /ROOT, here is what happens:\n* WAR file appears in the webapps directory, but does not get expanded.\n* The webapp is not running (I get a blank page when I go to the URL in the browser)\n* I see these entries in the catalina.<date>.log (after doing the auto-deploy:\n\n\nDec 27, 2013 3:34:03 PM org.apache.catalina.startup.HostConfig deleteRedeployResources\nINFO: Undeploying context []\nDec 27, 2013 3:34:03 PM org.apache.catalina.loader.WebappClassLoader clearReferencesJdbc\nSEVERE: The web application [] registered the JDBC driver [com.mysql.jdbc.Driver] but failed to unregister it when the web application was stopped. To prevent a memory leak, the JDBC Driver has been forcibly unregistered.\nDec 27, 2013 3:34:03 PM org.apache.catalina.startup.HostConfig deployWAR\nINFO: Deploying web application archive /var/lib/tomcat7/webapps/ROOT.war\nDec 27, 2013 3:34:04 PM org.apache.catalina.startup.ContextConfig init\nSEVERE: Exception fixing docBase for context []\njava.util.zip.ZipException: error in opening zip file\n\tat java.util.zip.ZipFile.open(Native Method)\n\tat java.util.zip.ZipFile.<init>(ZipFile.java:215)\n\tat java.util.zip.ZipFile.<init>(ZipFile.java:145)\n\tat java.util.jar.JarFile.<init>(JarFile.java:153)\n\tat java.util.jar.JarFile.<init>(JarFile.java:90)\n\tat sun.net.www.protocol.jar.URLJarFile.<init>(URLJarFile.java:93)\n\tat sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:69)\n\tat sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:88)\n\tat sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:122)\n\tat sun.net.www.protocol.jar.JarURLConnection.getJarFile(JarURLConnection.java:89)\n\tat org.apache.catalina.startup.ExpandWar.expand(ExpandWar.java:113)\n\tat org.apache.catalina.startup.ContextConfig.fixDocBase(ContextConfig.java:722)\n\tat org.apache.catalina.startup.ContextConfig.init(ContextConfig.java:843)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:387)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)\n\tat org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:402)\n\tat org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:110)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:139)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:901)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:877)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)\n\tat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:983)\n\tat org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1660)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:724)\n\nDec 27, 2013 3:34:04 PM org.apache.catalina.core.StandardContext resourcesStart\nSEVERE: Error starting static Resources\njava.lang.IllegalArgumentException: Invalid or unreadable WAR file : error in opening zip file\n\tat org.apache.naming.resources.WARDirContext.setDocBase(WARDirContext.java:138)\n\tat org.apache.catalina.core.StandardContext.resourcesStart(StandardContext.java:5055)\n\tat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5235)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:901)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:877)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)\n\tat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:983)\n\tat org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1660)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:724)\n\nDec 27, 2013 3:34:04 PM org.apache.catalina.core.StandardContext startInternal\nSEVERE: Error in resourceStart()\nDec 27, 2013 3:34:04 PM org.apache.catalina.core.StandardContext startInternal\nSEVERE: Error getConfigured\nDec 27, 2013 3:34:04 PM org.apache.catalina.core.StandardContext startInternal\nSEVERE: Context [] startup failed due to previous errors\nDec 27, 2013 3:34:14 PM org.apache.catalina.startup.HostConfig deleteRedeployResources\nINFO: Undeploying context []\nDec 27, 2013 3:34:14 PM org.apache.catalina.startup.HostConfig deployWAR\nINFO: Deploying web application archive /var/lib/tomcat7/webapps/ROOT.war\nDec 27, 2013 3:34:14 PM org.apache.catalina.startup.ContextConfig init\nSEVERE: Exception fixing docBase for context []\njava.util.zip.ZipException: error in opening zip file\n\tat java.util.zip.ZipFile.open(Native Method)\n\tat java.util.zip.ZipFile.<init>(ZipFile.java:215)\n\tat java.util.zip.ZipFile.<init>(ZipFile.java:145)\n\tat java.util.jar.JarFile.<init>(JarFile.java:153)\n\tat java.util.jar.JarFile.<init>(JarFile.java:90)\n\tat sun.net.www.protocol.jar.URLJarFile.<init>(URLJarFile.java:93)\n\tat sun.net.www.protocol.jar.URLJarFile.getJarFile(URLJarFile.java:69)\n\tat sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:88)\n\tat sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:122)\n\tat sun.net.www.protocol.jar.JarURLConnection.getJarFile(JarURLConnection.java:89)\n\tat org.apache.catalina.startup.ExpandWar.expand(ExpandWar.java:113)\n\tat org.apache.catalina.startup.ContextConfig.fixDocBase(ContextConfig.java:722)\n\tat org.apache.catalina.startup.ContextConfig.init(ContextConfig.java:843)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:387)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)\n\tat org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:402)\n\tat org.apache.catalina.util.LifecycleBase.init(LifecycleBase.java:110)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:139)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:901)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:877)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)\n\tat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:983)\n\tat org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1660)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:724)\n\nDec 27, 2013 3:34:14 PM org.apache.catalina.core.StandardContext resourcesStart\nSEVERE: Error starting static Resources\njava.lang.IllegalArgumentException: Invalid or unreadable WAR file : error in opening zip file\n\tat org.apache.naming.resources.WARDirContext.setDocBase(WARDirContext.java:138)\n\tat org.apache.catalina.core.StandardContext.resourcesStart(StandardContext.java:5055)\n\tat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5235)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:901)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:877)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)\n\tat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:983)\n\tat org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1660)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:724)\n\nDec 27, 2013 3:34:14 PM org.apache.catalina.core.StandardContext startInternal\nSEVERE: Error in resourceStart()\nDec 27, 2013 3:34:14 PM org.apache.catalina.core.StandardContext startInternal\nSEVERE: Error getConfigured\nDec 27, 2013 3:34:14 PM org.apache.catalina.core.StandardContext startInternal\nSEVERE: Context [] startup failed due to previous errors\nDec 27, 2013 3:34:21 PM org.apache.catalina.startup.HostConfig deployWAR\nINFO: Deploying web application archive /var/lib/tomcat7/webapps/ROOT.war\nDec 27, 2013 3:34:21 PM org.apache.catalina.startup.HostConfig deployWAR\nSEVERE: Error deploying web application archive /var/lib/tomcat7/webapps/ROOT.war\njava.lang.IllegalArgumentException: addChild:  Child name '' is not unique\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:887)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:877)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:633)\n\tat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:983)\n\tat org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:548)\n\tat org.apache.catalina.startup.HostConfig.check(HostConfig.java:1468)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.tomcat.util.modeler.BaseModelMBean.invoke(BaseModelMBean.java:301)\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:819)\n\tat com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:801)\n\tat org.apache.catalina.manager.ManagerServlet.check(ManagerServlet.java:1447)\n\tat org.apache.catalina.manager.ManagerServlet.deploy(ManagerServlet.java:679)\n\tat org.apache.catalina.manager.ManagerServlet.doPut(ManagerServlet.java:437)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:650)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:728)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n\tat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n\tat org.apache.catalina.filters.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:108)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:222)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:611)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:953)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:408)\n\tat org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1041)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:603)\n\tat org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:310)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:724)\n\n\n\n\n\n* After the auto-deploy fails, I can go into the HTML manager page and click the 'start' button, and the webapp does successfully start (tested the URL in the browser), but the WAR file still does not get unpacked into a directory.\n\n\nDoing the exact same thing to a different server running Tomcat 6.0.24 works correctly as expected.\n\nAny ideas here? Here is what I've ruled out so far:\n* I don't think it's a file permission issue (tomcat7 is the owner of the webapps directory, and everything works fine when run through the manager HTML interface).\n* The \"Child name '' is not unique\" sounded promising, but I could not find any duplicate ROOT webapps - there is no ROOT.war file or directory in the webapps directory prior to running the auto-deploy; there is no ROOT.xml file in the conf/Catalina/localhost directory, nor are there any context elements defined in the server.xml file.\n* I don't think that the .war file is corrupt - I can manually unzip the .war file in the webapps from the command line using the 'unzip' command, and as I pointed out in #2 above, everything works fine when it is uploaded using the manager HTML interface.\n\nIf it would help to spin up a temporary new Ubuntu deployment and provide credentials to reproduce the problem, I'd be happy to do that.", "id": 171947, "time": "2013-12-27T15:41:22Z", "creator": "jsb_apache@360works.com", "creation_time": "2013-12-27T15:41:22Z", "is_private": false, "attachment_id": 31162}, {"count": 1, "tags": [], "text": "\n> When I do exactly the same thing as #1 (tomcat auto deploy)\n> but just change the 'path' variable from /360Store to /ROOT\n\n\"ROOT\" is base file name for the default webapp. Its context path is \"\" (an empty string), it is not \"/ROOT\", see [1].\n\nWhat if you specify path=\"\" or path=\"/\" ?\n\n[1] http://tomcat.apache.org/tomcat-7.0-doc/config/context.html#Naming\n[2] http://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html#Deploy_A_New_Application_Remotely", "attachment_id": null, "bug_id": 55937, "id": 171950, "time": "2013-12-28T11:14:44Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2013-12-28T11:14:44Z", "is_private": false}, {"count": 2, "tags": [], "creator": "jsb_apache@360works.com", "attachment_id": null, "id": 171951, "time": "2013-12-28T14:05:16Z", "bug_id": 55937, "creation_time": "2013-12-28T14:05:16Z", "is_private": false, "text": "Thank you Konstantin, this did fix the problem!\n\nOne request - could the error reporting be improved? Maybe in the log file it could have a line stating something like 'ROOT is not a valid contact path'?\n\nUsing the name /ROOT did work in Tomcat 6 - which is what I was migrating from. I expect that others who are moving from Tomcat 6 to a later version might make the same mistake."}, {"count": 3, "tags": [], "text": "This has been fixed in 8.0.x for 8.0.0 onwards.\n\nNote that in Tomcat 8, attempting to deploy to /ROOT deploys the WAR as the ROOT web application but reports that the deployment has failed. After this fix the deployment is still to the ROOT web application but the deployer now reports a successful deployment to \"/\".\n\nAlso note that the automatic deployment improvements back-ported to 7.0.x for 7.0.50 may have changed the behaviour for 7.0.x.", "is_private": false, "bug_id": 55937, "id": 172207, "time": "2014-01-09T11:41:18Z", "creator": "markt@apache.org", "creation_time": "2014-01-09T11:41:18Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 55937, "text": "The behaviour had indeed changed in 7.0.50.\n\nI have applied the fix from 8.0.x to 7.0.x and this will be included in 7.0.51 onwards.", "count": 4, "id": 172208, "time": "2014-01-09T11:56:35Z", "creator": "markt@apache.org", "creation_time": "2014-01-09T11:56:35Z", "is_private": false}, {"count": 5, "tags": [], "text": "Thank you Mark!!", "attachment_id": null, "bug_id": 55937, "id": 172225, "time": "2014-01-09T16:58:37Z", "creator": "jsb_apache@360works.com", "creation_time": "2014-01-09T16:58:37Z", "is_private": false}]
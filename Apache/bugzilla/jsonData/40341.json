[{"count": 0, "tags": [], "bug_id": 40341, "text": "Hi!\n\nAfter upgrading to apache 2.0.59 I experience a rather weird problem.\nDuring retrieval of some files (like one generated in the example below) the\nconnection gets terminated, leaving a log message complaining that EOF was\nfound. Please note, that the file was gotten from /dev/zero, so it can't contain\nan EOF character.\n\n# dd if=/dev/zero bs=1k count=20 | hexdump -C > foo.txt\n20+0 records in\n20+0 records out\n20480 bytes transferred in 0.001 secs (20480000 bytes/sec)\n# \n\n$ wget -O - http://localhost/foo.txt\n--11:00:01--  http://localhost/foo.txt\n           => `-'\nResolving localhost... 127.0.0.1, ::1\nConnecting to localhost|127.0.0.1|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 386,547,056,641 (360G) [text/plain]\n\n 0% [                                                                          \n              ] 0             --.--K/s             00000000  00 00 00 00 00 00\n00 00  00 00 00 00 00 00 00 00  |................|\n*\n00005000\n 0% [                                                                          \n              ] 90            --.--K/s             \n\n11:00:01 (17.58 KB/s) - Connection closed at byte 90. Retrying.\n\n--11:00:02--  http://localhost/foo.txt\n  (try: 2) => `-'\nConnecting to localhost|127.0.0.1|:80... connected.\nHTTP request sent, awaiting response... 206 Partial Content\nLength: 386,547,056,641 (360G), 386,547,056,551 (360G) remaining [text/plain]\n\n 0% [                                                                          \n              ] 90            --.--K/s             \n\n11:00:02 (0.00 B/s) - Connection closed at byte 90. Retrying.\n\n[Tue Aug 29 10:27:07 2006] [info] [client 15.195.185.75] (70014)End of file\nfound: core_output_filter: writing data to the network\n\nWith some other files, and all clean 7-bit files, the connection doesn't get\nterminated, but rather the worker crashes with a SIGSEGV. Let's see:\n\n# dd if=/dev/urandom bs=1k count=10 | uuencode kwak > bleb.txt\n10+0 records in\n10+0 records out\n10240 bytes transferred in 0.009 secs (1137777 bytes/sec)\n#\n\n$ wget -O - http://localhost/bleb.txt\n--11:09:07--  http://localhost/bleb.txt\n           => `-'\nResolving localhost... 127.0.0.1, ::1\nConnecting to localhost|127.0.0.1|:80... connected.\nHTTP request sent, awaiting response... No data received.\nRetrying.\n\n--11:09:08--  http://localhost/bleb.txt\n  (try: 2) => `-'\nConnecting to localhost|127.0.0.1|:80... failed: Connection refused.\nConnecting to localhost|::1|:80... failed: Connection refused.\nResolving localhost... 127.0.0.1, ::1\nConnecting to localhost|127.0.0.1|:80... failed: Connection refused.\nConnecting to localhost|::1|:80... failed: Connection refused.\n$\n\n# gdb /usr/pkg/sbin/httpd\nGNU gdb 5.3nb1\nCopyright 2002 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386--netbsdelf\"...(no debugging symbols found)...\n(gdb) run -X\nStarting program: /usr/pkg/sbin/httpd -X\n(no debugging symbols found)...(no debugging symbols found)...(no debugging\nsymbols found)...(no debugging symbols found)...\n(no debugging symbols found)...(no debugging symbols found)...(no debugging\nsymbols found)...(no debugging symbols found)...\n(no debugging symbols found)...(no debugging symbols found)...(no debugging\nsymbols found)...(no debugging symbols found)...\n(no debugging symbols found)...(no debugging symbols found)...(no debugging\nsymbols found)...(no debugging symbols found)...\n(no debugging symbols found)...(no debugging symbols found)...(no debugging\nsymbols found)...(no debugging symbols found)...\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to LWP 1]\n0xbbba4b31 in apr_bucket_alloc () from /usr/pkg/lib/libaprutil-0.so.0\n(gdb) bt\n#0  0xbbba4b31 in apr_bucket_alloc () from /usr/pkg/lib/libaprutil-0.so.0\n#1  0xbbba3546 in apr_bucket_simple_copy () from /usr/pkg/lib/libaprutil-0.so.0\n#2  0xbbba337b in apr_bucket_shared_copy () from /usr/pkg/lib/libaprutil-0.so.0\n#3  0x080dc000 in default_handler ()\n#4  0x080c7308 in ap_run_handler ()\n#5  0x080c7882 in ap_invoke_handler ()\n#6  0x0809cc0f in ap_process_request ()\n#7  0x080980c9 in ap_process_http_connection ()\n#8  0x080d1ca4 in ap_run_process_connection ()\n#9  0x080d1fb9 in ap_process_connection ()\n#10 0x080c5c1f in child_main ()\n#11 0x080c5de0 in make_child ()\n#12 0x080c5e4d in startup_children ()\n#13 0x080c65f3 in ap_mpm_run ()\n#14 0x080cc1e7 in main ()\n#15 0x080661a6 in ___start ()\n(gdb) c\nContinuing.\n\nProgram terminated with signal SIGSEGV, Segmentation fault.\nThe program no longer exists.\n(gdb) \n\nThe problem exists with http-std.conf standard configuration, as well as with\nany other. My apache's version and configuration is below: (It's a standard\nbuild from pkgsrc)\n\n$ httpd -V \nServer version: Apache/2.0.59\nServer built:   Jul 29 2006 00:52:17\nServer's Module Magic Number: 20020903:12\nServer loaded:  APR 0.9.12, APR-UTIL 0.9.12\nCompiled using: APR 0.9.12, APR-UTIL 0.9.12\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/prefork\"\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses disabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/usr/pkg\"\n -D SUEXEC_BIN=\"/usr/pkg/bin/suexec\"\n -D DEFAULT_PIDLOG=\"/var/run/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"/var/run/apache_runtime_status\"\n -D DEFAULT_LOCKFILE=\"/var/run/accept.lock\"\n -D DEFAULT_ERRORLOG=\"/var/log/httpd/error.log\"\n -D AP_TYPES_CONFIG_FILE=\"etc/httpd/mime.types\"\n -D SERVER_CONFIG_FILE=\"etc/httpd/httpd.conf\"\n$", "id": 92647, "time": "2006-08-29T09:13:28Z", "creator": "lkundrak@skosi.org", "creation_time": "2006-08-29T09:13:28Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 40341, "text": "UPDATE: after recompilation of both apr and apache am i no longer able to\nreproduce the bug", "id": 92651, "time": "2006-08-29T09:38:13Z", "creator": "lkundrak@skosi.org", "creation_time": "2006-08-29T09:38:13Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "(In reply to comment #1)\n> UPDATE: after recompilation of both apr and apache am i no longer able to\n> reproduce the bug\n\nNot true anymore...", "attachment_id": null, "id": 92666, "creator": "lkundrak@skosi.org", "time": "2006-08-29T12:09:03Z", "bug_id": 40341, "creation_time": "2006-08-29T12:09:03Z", "is_private": false}, {"count": 3, "tags": [], "text": "This looks very broken.  The 20K file is being reported as 360G in size!?\n\nCan you build 2.0.59 from the source tarball (rather than using the NetBSD pkg\nsystem), run the freshly-installed httpd using e.g.:\n\n gdb /path/to/httpd -X\n\nand reproduce it like that?", "attachment_id": null, "id": 92682, "creator": "jorton@redhat.com", "time": "2006-08-29T17:53:26Z", "bug_id": 40341, "creation_time": "2006-08-29T17:53:26Z", "is_private": false}, {"count": 4, "tags": [], "text": "No feedback; assuming resolved or moot.", "attachment_id": null, "id": 123519, "creator": "nick@webthing.com", "time": "2008-12-26T10:19:47Z", "bug_id": 40341, "creation_time": "2008-12-26T10:19:47Z", "is_private": false}]
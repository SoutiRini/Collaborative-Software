[{"count": 0, "tags": [], "text": "I have an excel file merge program that is experiencing a FormulaParseException when copying valid formula to a new workbook.\nI believe it is a parser bug when the name contains a digit followed by an underscore. See the program output at the end.\nThe program flow is:\n1. create new empty sheets with same names in target workbook\n2. copy Name definitions from source workbook\n3. copy cells' contents, including formulae from old sheet to new sheet\nIf I change the Name names to remove the digit/underscore condition the exception does not occur. e.g. if the name \"DA6_LEO_WBS_Number\" is changed to \"DA6xLEO_WBS_Number\" then the program continues to successful completion. I have a workaround that changes the Name names when copyinf Name definitions and making the Name references in formulae when copying cells.\n------------------------------------output-------------------------\ncopying name DA6_LEO_WBS_Number as 'DA6 LEO WBS MOPDR'!$A$1:$A$24\nCopying data for sheet DA6 LEO WBS MOPDR\nCopying data for sheet DA6 LEO Mat MOPDR\nException in thread \"main\" org.apache.poi.ss.formula.FormulaParseException: Parse error near char 9 '_' in specified formula 'INDEX(DA6_LEO_WBS_Name,MATCH($A3,DA6_LEO_WBS_Number,0))'. Expected ',' or ')'\n        at org.apache.poi.ss.formula.FormulaParser.expected(FormulaParser.java:217)\n        at org.apache.poi.ss.formula.FormulaParser.Arguments(FormulaParser.java:1049)\n        at org.apache.poi.ss.formula.FormulaParser.function(FormulaParser.java:929)\n        at org.apache.poi.ss.formula.FormulaParser.parseNonRange(FormulaParser.java:551)\n        at org.apache.poi.ss.formula.FormulaParser.parseRangeable(FormulaParser.java:423)\n        at org.apache.poi.ss.formula.FormulaParser.parseRangeExpression(FormulaParser.java:266)\n        at org.apache.poi.ss.formula.FormulaParser.parseSimpleFactor(FormulaParser.java:1112)\n        at org.apache.poi.ss.formula.FormulaParser.percentFactor(FormulaParser.java:1072)\n        at org.apache.poi.ss.formula.FormulaParser.powerFactor(FormulaParser.java:1059)\n        at org.apache.poi.ss.formula.FormulaParser.Term(FormulaParser.java:1410)\n        at org.apache.poi.ss.formula.FormulaParser.additiveExpression(FormulaParser.java:1510)\n        at org.apache.poi.ss.formula.FormulaParser.concatExpression(FormulaParser.java:1494)\n        at org.apache.poi.ss.formula.FormulaParser.comparisonExpression(FormulaParser.java:1451)\n        at org.apache.poi.ss.formula.FormulaParser.unionExpression(FormulaParser.java:1431)\n        at org.apache.poi.ss.formula.FormulaParser.parse(FormulaParser.java:1552)\n        at org.apache.poi.ss.formula.FormulaParser.parse(FormulaParser.java:174)\n        at org.apache.poi.hssf.model.HSSFFormulaParser.parse(HSSFFormulaParser.java:72)\n        at org.apache.poi.hssf.usermodel.HSSFCell.setCellFormula(HSSFCell.java:588)\n        at workbookmerge.ExcelUtil.copyCell(ExcelUtil.java:124)\n        at workbookmerge.ExcelUtil.copyRow(ExcelUtil.java:58)\n        at workbookmerge.ExcelUtil.copySheets(ExcelUtil.java:35)\n        at workbookmerge.ExcelUtil.copySheets(ExcelUtil.java:23)\n        at workbookmerge.Main.main(Main.java:166)", "is_private": false, "id": 138986, "creator": "TonyHarvey@aol.com", "time": "2010-08-08T21:00:18Z", "bug_id": 49725, "creation_time": "2010-08-08T21:00:18Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "yegor@dinom.ru", "text": "Fixed in r984823.\n\nJunit added. \n\nYegor", "id": 139074, "time": "2010-08-12T11:15:08Z", "bug_id": 49725, "creation_time": "2010-08-12T11:15:08Z", "is_private": false, "attachment_id": null}]
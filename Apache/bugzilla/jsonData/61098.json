[{"count": 0, "text": "Created attachment 34995\nThe attached document gets corrupted after adding custom attributes\n\nFollowing code is used to add custom attributes to the attached document\n\nprivate String updateWordDocContent(String tempOutputFile) {\n\t\tFile inputFile = null;\n\t\tFile outputFile = null;\n\t\tFileInputStream fileIStream = null;\n\t\tFileOutputStream fileOStream = null;\n\t\tHWPFDocument wordDoc = null;\n\n\t\ttry {\n\t\t\tSystem.out.println(\"updateWordDocContent() \");\n\t\t\t// APACHE POI\n\t\t\tinputFile = new File(tempOutputFile);\n\t\t\tfileIStream = new FileInputStream(inputFile);\n\n\t\t\twordDoc = new HWPFDocument(fileIStream);\n\t\t\t  \n\n\t\t\tDocumentSummaryInformation docSummary = wordDoc.getDocumentSummaryInformation();\n\t\t\tSystem.out.println(docSummary.toString());\n\t\t\tCustomProperties cp = docSummary.getCustomProperties();\n\t\t\tif (cp == null)\n\t\t\t\tcp = new CustomProperties();\n\t\t\tcp.put(\"Product\", \"\");\n\t\t\tcp.put(\"Author\", \"Sean Smith\");\n\t\t\tcp.put(\"OS\", \"Linux\");\n\t\t\tcp.put(\"Comments\", \"Code for POI Word With Doc\");\n\t\t\tcp.put(\"extension\", \"Super OTX\");\n\t\t\tdocSummary.setCustomProperties(cp);\n\t\t\tfileIStream.close();\n\n\t\t\toutputFile = new File(tempOutputFile+\"-customPro\"+System.nanoTime()+\".doc\");\n\t\t\tfileOStream = new FileOutputStream(outputFile);\n\n\t\t\twordDoc.write(fileOStream);\n\t\t\tfileOStream.flush();\n\t\t\tfileOStream.close();\n\n\t\t\treturn tempOutputFile;\n\n\t\t} catch (Exception e) {\n\t\t\tDfLogger.error(this, \"Error: \" + e.getMessage(), null, e);\n\t\t\te.printStackTrace();\n\t\t\t \n\t\t} finally {\n\t\t\tif (fileIStream != null) {\n\t\t\t\ttry {\n\t\t\t\t\tfileIStream.close();\n\t\t\t\t\tfileIStream = null;\n\t\t\t\t} catch (Exception ex) {\n\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (fileOStream != null) {\n\t\t\t\ttry {\n\t\t\t\t\tfileOStream.flush();\n\t\t\t\t\tfileOStream.close();\n\t\t\t\t\tfileOStream = null;\n\t\t\t\t} catch (Exception ex) {\n\t\t\t\t\t// I G N O R E //\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}", "creator": "ravi.nerella@hotmail.com", "attachment_id": 34995, "id": 198787, "time": "2017-05-15T15:51:49Z", "bug_id": 61098, "creation_time": "2017-05-15T15:51:49Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 61098, "text": "I don't even need to add the custom property, a simple reading of the file and writing out again into another file makes the resulting file corrupted when opened with Microsoft Word.\n\nAlso doing a HWPFTestDataSamples.writeOutAndReadBack(wordDoc) also fails with some error message, so it seems something is already corrupted either when loading or when writing that document.", "count": 1, "id": 201135, "time": "2017-09-26T12:15:41Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2017-09-26T12:15:41Z", "is_private": false}]
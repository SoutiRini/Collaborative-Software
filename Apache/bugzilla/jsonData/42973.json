[{"count": 0, "tags": [], "bug_id": 42973, "text": "Steps to reproduce the problem:\n\n- build clean (revision 559539)\n- start Lenya\n- go to the default publication and login as lenya\n- import the example pages\n- go to site tab\n- submit the tutorial via menu\n- try to rollback to previous revision\n\nyou get:\n\nNo transition found for event [checkExecutionConditions] in state [start]!\n\n- login as alice\n- go to site tab\n- submit and publish a document via workflow overview\n- try to rollback to previous revision\n\nyou get:\n\nUnable to roll back!org.apache.lenya.workflow.WorkflowException: The event\n[edit] cannot be invoked on the document", "id": 105944, "time": "2007-07-25T11:57:27Z", "creator": "mangst@inventec.ch", "creation_time": "2007-07-25T11:57:27Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 42973, "is_private": false, "text": "(In reply to comment #0)\n> Steps to reproduce the problem:\n> \n> - build clean (revision 559539)\n> - start Lenya\n> - go to the default publication and login as lenya\n> - import the example pages\n> - go to site tab\n> - submit the tutorial via menu\n> - try to rollback to previous revision\n> \n> you get:\n> \n> No transition found for event [checkExecutionConditions] in state [start]!\n\ni think that behaviour basically correct, though highly confusing, and we should\ndo something about it.\nwhat happens is this: when you submit a document, you cannot edit it anymore\n(since it is now in review state). when you check the \"Edit\" menu, you will see\nthat all editors are now greyed out until the document has either been published\nor rejected.\nso we should disable the rollback usecase in \"review\" as well. wdyt?\n\n\n> - login as alice\n> - go to site tab\n> - submit and publish a document via workflow overview\n> - try to rollback to previous revision\n> \n> you get:\n> \n> Unable to roll back!org.apache.lenya.workflow.WorkflowException: The event\n> [edit] cannot be invoked on the document\n\nto be expected. alice does not have the \"edit\" role. again, the menu item should\nbe greyed out.\n\ni'm upping it to \"critical\" so that it gets fixed before the RC.", "id": 106027, "time": "2007-07-29T11:03:45Z", "creator": "nettings@apache.org", "creation_time": "2007-07-29T11:03:45Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 42973, "text": "fixed in trunk. please test.\n", "id": 106032, "time": "2007-07-29T16:13:55Z", "creator": "nettings@apache.org", "creation_time": "2007-07-29T16:13:55Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 42973, "is_private": false, "text": "i was wrong. the usability issue is fixed, but your second observation is still\nvalid (it crops up even when the user does have edit permissions). additionally,\ni'm seeing this after a rollback:\n\nException during commit or rollback: org.apache.lenya.transaction.LockException:\nCannot commit transaction: The object [node\nlenya://lenya/pubs/default/content/authoring/fc806920-3dd3-11dc-9b31-c4d00ed994f8/en]\nwas modified after it has been locked. (see logfiles for details)\n\nthe interesting thing is that the rollback seems to succeed nonetheless.\n\nbtw: we still seem to have no initial revision and no clean initial state.\nshould we do something about it? state [start] strikes me as kludgy...\n", "id": 106034, "time": "2007-07-29T17:21:52Z", "creator": "nettings@apache.org", "creation_time": "2007-07-29T17:21:52Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 42973, "is_private": false, "text": "When rolling back it changes the workflow state. I would expect it to change to\nauthoring, as it is a rollback. However, if a revision is selected that was in\nreview state, it changes the state to review upon rollback. ", "id": 106152, "time": "2007-08-01T09:21:51Z", "creator": "rfrovarp@apache.org", "creation_time": "2007-08-01T09:21:51Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 42973, "text": "hmmm. i looked at Rollback.java, and it does invoke a workflow transition with\nevent \"edit\". must be something subtle, or at least not obvious enough for me to\nspot it. but i'm not very clueful about the repository and revision control stuff...\n", "id": 106214, "time": "2007-08-02T13:56:42Z", "creator": "nettings@apache.org", "creation_time": "2007-08-02T13:56:42Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 42973, "attachment_id": null, "text": "fixed target milestone. please have a look at this issue if you have a minute.", "id": 106218, "time": "2007-08-02T14:05:09Z", "creator": "nettings@apache.org", "creation_time": "2007-08-02T14:05:09Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 42973, "text": "(In reply to comment #3)\n\n> btw: we still seem to have no initial revision and no clean initial state.\n> should we do something about it? state [start] strikes me as kludgy...\n\nThe error message (\"no transition found ...\") Markus mentioned is not related to\nthe workflow, but to the state machine used to ensure the correct execution\norder of the Usecase methods.\n\n", "id": 106236, "time": "2007-08-03T01:18:03Z", "creator": "andreas@apache.org", "creation_time": "2007-08-03T01:18:03Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 42973, "attachment_id": null, "text": "(In reply to comment #7)\n> (In reply to comment #3)\n> \n> > btw: we still seem to have no initial revision and no clean initial state.\n> > should we do something about it? state [start] strikes me as kludgy...\n> \n> The error message (\"no transition found ...\") Markus mentioned is not related to\n> the workflow, but to the state machine used to ensure the correct execution\n> order of the Usecase methods.\n\nah, i see. sorry for spreading confusion. can you reproduce the issue?\n\n", "id": 106242, "time": "2007-08-03T01:50:04Z", "creator": "nettings@apache.org", "creation_time": "2007-08-03T01:50:04Z", "is_private": false}, {"count": 9, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "id": 106243, "time": "2007-08-03T01:55:27Z", "bug_id": 42973, "creation_time": "2007-08-03T01:55:27Z", "is_private": false, "text": "(In reply to comment #8)\n>  can you reproduce the issue?\n\nYes. I guess it is because the revision controller circumvents the transaction\nhandling. Maybe it just writes files. This would explain the behaviour: The\ndocument is changed even though the transaction couldn't be committed, and the\nunit of work thinks that someone else has changed it. I'm currently taking a\nlook at it."}, {"count": 10, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "id": 106249, "time": "2007-08-03T04:44:05Z", "bug_id": 42973, "creation_time": "2007-08-03T04:44:05Z", "is_private": false, "text": "It should work now - please test."}]
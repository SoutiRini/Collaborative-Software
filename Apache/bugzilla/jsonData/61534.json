[{"attachment_id": 35333, "tags": [], "creator": "felix.schumacher@internetallee.de", "text": "Created attachment 35333\nCatch AssertionError on assertions and use them to fill in the failure message\n\nAfter seeing Philippes commits for JDBC tests that used groovy for assertions. I thought how much shorter those assertions could be, if he could have written:\n\ndef list = vars.getObject('result')\nassert list.size() == 1\nassert list[0]['AUTHOR'] == '...'\n\ninstead of the current version\n\ndef list = vars.getObject('result');\nif (list.size()==1) {\n       def map = list.get(0);\n       if(map.get('AUTHOR').equals('Philip K. Dick')) {\n               AssertionResult.setFailure(false);\n       } else {\n               AssertionResult.setFailure(true);\n               AssertionResult.setFailureMessage(\"Expected first row AUTHOR to be equal to 'Philip K. Dick'\");\n       }\n} else {\n       AssertionResult.setFailure(true);\n       AssertionResult.setFailureMessage('Expected 1 row in result, got:'+list.size());\n}", "count": 0, "id": 200937, "time": "2017-09-18T19:40:37Z", "bug_id": 61534, "creation_time": "2017-09-18T19:40:37Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 61534, "attachment_id": null, "id": 200940, "time": "2017-09-18T19:45:09Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-09-18T19:45:09Z", "is_private": false, "text": "Great idea !"}, {"count": 2, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "Author: pmouawad\nDate: Mon Oct 23 12:08:24 2017\nNew Revision: 1813001\n\nURL: http://svn.apache.org/viewvc?rev=1813001&view=rev\nLog:\nBug 61534 - Convert AssertionError to a failed assertion in the JSR223Assertion allowing users to use assert in their code\nPatch by Felix Schumacher\nBugzilla Id: 61534\n\nModified:\n    jmeter/trunk/src/components/org/apache/jmeter/assertions/JSR223Assertion.java\n    jmeter/trunk/xdocs/changes.xml", "id": 201589, "time": "2017-10-23T12:08:42Z", "bug_id": 61534, "creation_time": "2017-10-23T12:08:42Z", "is_private": false}, {"count": 3, "tags": [], "creator": "felix.schumacher@internetallee.de", "attachment_id": null, "text": "This \"fix\" was needed, as a result of r1775911, which changed a catch clause in JMeterThread#processAssertion from Error to JMeterError. Therefore this patch brings back part of the behaviour from 3.1 back.\n\nI wonder if we should revert or at least extend the catch clause in JMeterThread#processAssertion instead of JSR223Assertion, only.", "id": 203137, "time": "2018-01-07T14:03:02Z", "bug_id": 61534, "creation_time": "2018-01-07T14:03:02Z", "is_private": false}, {"count": 4, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "Hi Felix,\nI think we should restore the 3.1 behaviour \nRegards", "id": 203138, "time": "2018-01-07T14:04:26Z", "bug_id": 61534, "creation_time": "2018-01-07T14:04:26Z", "is_private": false}, {"count": 5, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "(In reply to Philippe Mouawad from comment #4)\n> Hi Felix,\n> I think we should restore the 3.1 behaviour \nas you proposed. \nI have seen on SO a person complaining about this.\n> Regards", "id": 203139, "time": "2018-01-07T14:04:58Z", "bug_id": 61534, "creation_time": "2018-01-07T14:04:58Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "felix.schumacher@internetallee.de", "text": "(In reply to Philippe Mouawad from comment #4)\n> Hi Felix,\n> I think we should restore the 3.1 behaviour \n> Regards\n\nI tend to add AssertionError to JMeterError, as normal programs should not catch Error (most are low level errors we can't handle correctly). That way, we could get rid of catching ThreadDeath, too.", "count": 6, "id": 203140, "time": "2018-01-07T14:29:31Z", "bug_id": 61534, "creation_time": "2018-01-07T14:29:31Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 61534, "text": "One other thing, or rather two.\n\nIf we add AssertionError to the JMeterError catch clause, the failed assertions will be marked as error instead of failure and (more importantly) log stacktraces to jmeter.log.\n\nSo my questions are:\n\nShould we log those assertion failures at all, or at debug level, only?\n\nIs an AssertionError an error or a failure in respect to Assertions?", "id": 203358, "time": "2018-01-19T11:21:46Z", "creator": "felix.schumacher@internetallee.de", "creation_time": "2018-01-19T11:21:46Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "felix.schumacher@internetallee.de", "attachment_id": 35685, "text": "Created attachment 35685\nCatch AssertionError on assertions and use them to fill in the failure message\n\nThis patch reverts the previous one and places the logic to catch AssertionErrors higher up in the stack.\n\nThis fixes an regression introduced by r1775911 and reduces the noise in jmeter.log introduced by thoses AssertionErrors.", "id": 203359, "time": "2018-01-19T11:26:28Z", "bug_id": 61534, "creation_time": "2018-01-19T11:26:28Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "felix.schumacher@internetallee.de", "text": "Will be included in 4.0.\n\nDate: Thu Jan 25 21:22:58 2018\nNew Revision: 1822229\n\nURL: http://svn.apache.org/viewvc?rev=1822229&view=rev\nLog:\nConvert AssertionError to a failed assertion for all kind of assertions.\n\nFixing a regression introduced in 3.2. ThreadDeath has not to be catched anymore,\nas we are not using Error in the catch clause (which was the case before r1775911\nthat introduced this regression).\n\nBugzilla Id: 61534\n\nModified:\n    jmeter/trunk/src/components/org/apache/jmeter/assertions/JSR223Assertion.java\n    jmeter/trunk/src/core/org/apache/jmeter/threads/JMeterThread.java\n    jmeter/trunk/xdocs/changes.xml", "count": 9, "id": 203489, "time": "2018-01-25T21:24:40Z", "bug_id": 61534, "creation_time": "2018-01-25T21:24:40Z", "is_private": false}]
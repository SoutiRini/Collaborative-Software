[{"count": 0, "tags": [], "text": "Hi.\n\nThere is a big problem with apache server when having big number of vhosts. \nCurrently I have more than 10000 vhosts defined and when starting httpd it \nstat()ing each DocumentRoot entry.\n\nstat()ing these takes very long time (even several minutes if there is bigger load \non the server).\n\nIs so many stat() calls really needed for apache? I guess that in config \nverification mode (-t) that would be OK but it's a waste of time for normal \nstartup.", "is_private": false, "id": 95822, "creator": "arekm@maven.pl", "time": "2006-11-14T04:16:44Z", "bug_id": 40970, "creation_time": "2006-11-14T04:16:44Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 40970, "is_private": false, "id": 95947, "attachment_id": null, "creator": "slive@apache.org", "creation_time": "2006-11-17T16:16:10Z", "time": "2006-11-17T16:16:10Z", "text": "Doesn't directly answer your question, but if you have 10000 vhosts, you should\nreally be using mod_vhost_alias.\n\nJoshua."}, {"count": 2, "tags": [], "text": "I need custom settings per vhost. Also mod_vhost_alias doesn't allow to use some \nexternal file for vhost->directory mapping itp (like example.com->/home/something/\n5323/). In other words - it's too limited.", "is_private": false, "id": 95949, "creator": "arekm@maven.pl", "time": "2006-11-17T16:22:17Z", "bug_id": 40970, "creation_time": "2006-11-17T16:22:17Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 40970, "attachment_id": null, "id": 95962, "time": "2006-11-18T15:39:00Z", "creator": "slive@apache.org", "creation_time": "2006-11-18T15:39:00Z", "is_private": false, "text": "Custom settings can be set with <Directory> sections (other than a few\nvery-specific things like suexec and obviously SSL).  For more complicated\nmapping you use either symlinks or mod_rewrite.\n\nDynamic vhosting doesn't solve all problems, but you'd need a very compelling\nreason not to use it with 10000 virtual hosts."}, {"count": 4, "tags": [], "bug_id": 40970, "text": "Hm, if httpd doesn't do any stat() for <Directory> then I'll guess that some \nmod_rewrite or mod_vhost_alias and 10000 <Directory> entries (yeah, I need to set \nall of these) would save me a lot of stat() calls.\n\nI would love to see module that provides virtual hosting in such way:\n/etc/httpd/vhosts/example.org/documentroot symlink to /somewhere/1212\n/etc/httpd/vhosts/example.org/vhost.conf - configuration file for virtual host\n/etc/httpd/vhosts/www.example.org symlink to example.org\nusing that way I could easily create virtual hosts and change configuration on the \nfly without any need for apache reload thus avoiding all stat() problems. Also \nreloading takes huuuuge amount of time (30 seconds to several minutes) and when \nthat happens server is not responding to new requests. Using runtime vhost.conf \nfile that is read and cached on first request to vhost (+ invalidated once per X \nseonds if mtime has changed) the reload problem would be easy to avoid.", "id": 95965, "time": "2006-11-18T16:21:48Z", "creator": "arekm@maven.pl", "creation_time": "2006-11-18T16:21:48Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 40970, "text": "Take it to the users list.  People will be able to help you there if you are\nspecific about what kinds of config customizations you need to do for the\nvarious vhosts.\n\nI'll leave the original report open because I seem to recall other people\nrequesting the same thing.  In fact, a quick search reveals that this was fixed\nat one point in 1.3.  I'm not sure why it is different in 2.0:\nhttp://mail-archives.apache.org/mod_mbox/httpd-cvs/199906.mbox/%3C19990624163855.13932.qmail@hyperreal.org%3E\n", "id": 95969, "time": "2006-11-18T20:05:54Z", "creator": "slive@apache.org", "creation_time": "2006-11-18T20:05:54Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "arekm@maven.pl", "attachment_id": null, "id": 97003, "time": "2006-12-17T14:09:57Z", "bug_id": 40970, "creation_time": "2006-12-17T14:09:57Z", "is_private": false, "text": "I've applied such patch to my httpd copy. That directory check was doing more harm \nthan help.\n\n--- server/core.c.org   2006-11-22 12:37:15.991248750 +0100\n+++ server/core.c       2006-11-22 12:39:30.535657250 +0100\n@@ -1129,7 +1129,7 @@\n     /* XXX Shouldn't this be relative to ServerRoot ??? */\n     if (apr_filepath_merge((char**)&conf->ap_document_root, NULL, arg,\n                            APR_FILEPATH_TRUENAME, cmd->pool) != APR_SUCCESS\n-        || !ap_is_directory(cmd->pool, arg)) {\n+        ) {\n         if (cmd->server->is_virtual) {\n             ap_log_perror(APLOG_MARK, APLOG_STARTUP, 0,\n                           cmd->pool,\n"}, {"count": 7, "tags": [], "bug_id": 40970, "attachment_id": null, "id": 133131, "time": "2009-12-27T03:02:02Z", "creator": "nick@webthing.com", "creation_time": "2009-12-27T03:02:02Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of bug 41887 ***"}]
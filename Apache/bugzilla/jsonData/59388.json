[{"count": 0, "attachment_id": 33812, "bug_id": 59388, "is_private": false, "id": 190601, "time": "2016-04-27T14:31:52Z", "creator": "orlandi.m70@gmail.com", "creation_time": "2016-04-27T14:31:52Z", "tags": [], "text": "Created attachment 33812\nIn the attachment a xlsx file with two cells and one of them created by POI.\n\nI insert a comment on a cell and set its visibile property to true value (by coding with POI). Then I open the file and see the dialog whith comment up. But if I just drag or click on the cell which contains the comment, the dialog disappears and therefore having a different behaviour respect to setting visible property to true by using menu."}, {"count": 1, "tags": [], "creator": "onealj@apache.org", "text": "Could you unzip the OOXML file and diff the Excel-created comment and POI-created comment? This should be the first step to determining what POI is doing incorrectly.", "id": 190602, "time": "2016-04-27T14:43:30Z", "bug_id": 59388, "creation_time": "2016-04-27T14:43:30Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 59388, "is_private": false, "id": 190605, "time": "2016-04-27T15:45:13Z", "creator": "orlandi.m70@gmail.com", "creation_time": "2016-04-27T15:45:13Z", "tags": [], "text": "POI created OOXML:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<comments xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><authors><author/></authors><commentList><comment ref=\"B2\" authorId=\"0\"><text><t>Commento visibile</t></text></comment></commentList></comments>\n\n\nEXCEL created OOXML:\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<comments xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><authors><author>Author</author></authors><commentList><comment ref=\"B2\" authorId=\"0\"><text><r><rPr><b/><sz val=\"9\"/><color indexed=\"81\"/><rFont val=\"Tahoma\"/><charset val=\"1\"/></rPr><t>Author:</t></r><r><rPr><sz val=\"9\"/><color indexed=\"81\"/><rFont val=\"Tahoma\"/><charset val=\"1\"/></rPr><t xml:space=\"preserve\">\ncommento visibile</t></r></text></comment></commentList></comments>\n\n\nActuaally they look really different. I cannot find any property to set other additional attribute."}, {"count": 3, "tags": [], "text": "(In reply to Javen O'Neal from comment #1)\n> Could you unzip the OOXML file and diff the Excel-created comment and\n> POI-created comment? This should be the first step to determining what POI\n> is doing incorrectly.\n\nPOI created OOXML:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<comments xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><authors><author/></authors><commentList><comment ref=\"B2\" authorId=\"0\"><text><t>Commento visibile</t></text></comment></commentList></comments>\n\n\nEXCEL created OOXML:\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<comments xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"><authors><author>Author</author></authors><commentList><comment ref=\"B2\" authorId=\"0\"><text><r><rPr><b/><sz val=\"9\"/><color indexed=\"81\"/><rFont val=\"Tahoma\"/><charset val=\"1\"/></rPr><t>Author:</t></r><r><rPr><sz val=\"9\"/><color indexed=\"81\"/><rFont val=\"Tahoma\"/><charset val=\"1\"/></rPr><t xml:space=\"preserve\">\ncommento visibile</t></r></text></comment></commentList></comments>\n\n\nActuaally they look really different. I cannot find any property to set other additional attribute.", "is_private": false, "bug_id": 59388, "id": 190606, "time": "2016-04-27T16:04:06Z", "creator": "orlandi.m70@gmail.com", "creation_time": "2016-04-27T16:04:06Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 59388, "text": "Hi,\n\ncomparing two XML files, a POI-generated one and an Excel-generated one, it seems that the different behaviour is due to the \\xl\\drawingsvmlDrawing1.vml file. The Excel-generated one has an additional line apparently specifying the visibility, <x:Visible/>:\n\n<!-- ... -->\n<x:ClientData ObjectType=\"Note\">\n      <x:MoveWithCells/>\n      <x:SizeWithCells/>\n      <x:Anchor>10, 0, 10, 0, 11, 0, 13, 0</x:Anchor>\n      <x:AutoFill>False</x:AutoFill>\n      <x:Row>0</x:Row>\n      <x:Column>0</x:Column>\n      <x:Visible/>\n   </x:ClientData> \n<!-- ... -->\n\nIf I unzip the POI-generated file, I add that line in the drawingsvmlDrawing1.vml file and then I open the file again, the comment visibility behaviour is preserved as expected.\n\nThank you.", "id": 190745, "time": "2016-05-05T10:09:03Z", "creator": "orlandi.m70@gmail.com", "creation_time": "2016-05-05T10:09:03Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 59388, "text": "Can you post some sample-code how you populate the comment? \n\nThe class XSSFVMLDrawing allows access to the low-level API CTShape and CTClientData which encapsulates the \"visible\" attribute.", "count": 5, "id": 191113, "time": "2016-05-19T19:01:51Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-05-19T19:01:51Z", "is_private": false}, {"count": 6, "tags": [], "creator": "orlandi.m70@gmail.com", "text": "Here's the code:\n\n/* ... */\n\nXSSFWorkbook w = new XSSFWorkbook();\nw.createSheet();\n\nComment commentToInsert = null;\n\nClientAnchor anchorForComment = w.getCreationHelper().createClientAnchor();\nanchorForComment.setAnchorType(3);\nanchorForComment.setCol1(1);\nanchorForComment.setCol2(4);\nanchorForComment.setRow1(1);\nanchorForComment.setRow2(4);\nanchorForComment.setDx1(100);\nanchorForComment.setDx2(400);\nanchorForComment.setDy1(100);\nanchorForComment.setDy2(400);\n\nDrawing drawingForComments = w.getSheetAt(0).createDrawingPatriarch();\ncommentToInsert = drawingForComments.createCellComment(anchorForComment);\ncommentToInsert.setString(w.getCreationHelper().createRichTextString(\"Hi!\"));\n\nw.getSheetAt(0).createRow(0).createCell(0).setCellComment(commentToInsert);\n\n//Setting cell comment visibility\nw.getSheetAt(0).getRow(0).getCell(0).getCellComment().setVisible(true);\n\n/* ... */", "id": 191252, "time": "2016-05-25T10:19:43Z", "bug_id": 59388, "creation_time": "2016-05-25T10:19:43Z", "is_private": false, "attachment_id": null}]
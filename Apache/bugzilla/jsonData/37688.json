[{"count": 0, "tags": [], "bug_id": 37688, "is_private": false, "text": "When using a beanshell script, Ant shows a special behavior together with\nreferences.\nTo have beanshell, I used bsf-2.3.0.jar and bsh-2.0b4.jar in the ${ant.home}/lib\ndirectory.\n\n\n<?xml version=\"1.0\"?>\n<project name=\"antbug\">\n\n  <macrodef name=\"compileMapper\" >\n    <attribute name=\"objDir\" />\n    <attribute name=\"id\" default=\"compileMapperID\" />\n    <sequential>\n      <mapper id=\"@{id}\">\n        <chainedmapper  >\n          <flattenmapper/>\n          <globmapper from=\"*\" to=\"@{objDir}/*.o\"/>\n        </chainedmapper>\n      </mapper>\n    </sequential>\n  </macrodef>\n\n  <target name=\"failes\">\n      <script language=\"beanshell\"><![CDATA[\n      // nothing\n      ]]></script>\n      <!-- throws java.lang.ClassCastException:\norg.apache.tools.ant.types.Mapper -->\n      <compileMapper objDir=\".\" />\n  </target>\n\n  <target name=\"works\">\n      <compileMapper objDir=\".\" />\n  </target>\n\n  <target name=\"override\" >\n      <script language=\"beanshell\"><![CDATA[\n      // nothing\n      ]]></script>\n      <!-- Overriding previous definition of reference to anID -->\n      <path id=\"anID\">\n        <fileset dir=\".\" includes=\"*.ant\" />\n      </path>\n  </target>\n\n  <target name=\"noOverride\" >\n      <path id=\"anID\">\n        <fileset dir=\".\" includes=\"*.ant\" />\n      </path>\n  </target>\n\n</project>", "id": 82959, "time": "2005-11-29T11:54:32Z", "creator": "vidl@mysunrise.ch", "creation_time": "2005-11-29T11:54:32Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 17074\nAnt build file to reproduce the bug", "is_private": false, "bug_id": 37688, "id": 82960, "time": "2005-11-29T11:56:08Z", "creator": "vidl@mysunrise.ch", "creation_time": "2005-11-29T11:56:08Z", "attachment_id": 17074}, {"count": 2, "tags": [], "bug_id": 37688, "text": "Just changing the name of bug as it is a general script/reference problem.\nIt is most likely related to the way references are processed - they are\nlooked at both at xml parse time (when they are unknown elements) and\nat run time where they get resolved.\n\nThere are a large number of bugs associated with this behaviour - some\nget fixed by hacks but a large number remain.\n\nPersonally I think that the way refernces are handled should be looked\nat - so that they are processed at runtime. However I cannot see any way to\ndo this in a backward compatible fashion.", "id": 83131, "time": "2005-12-02T10:50:07Z", "creator": "peterreilly@apache.org", "creation_time": "2005-12-02T10:50:07Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "text": "I have added a workaround in ant 1.7.\nA new attribute \"setbeans\" has been added to the \n<script> task. This is by default \"true\". However\nif is set to false, only the \"project\" and \"self\"\nvariables will be set.\n", "id": 92929, "time": "2006-09-02T23:06:48Z", "bug_id": 37688, "creation_time": "2006-09-02T23:06:48Z", "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 37688, "is_private": false, "id": 94599, "time": "2006-10-06T14:22:50Z", "creator": "peterreilly@apache.org", "creation_time": "2006-10-06T14:22:50Z", "tags": [], "text": "A proper fix has been done, there\nis now no need for the setbeans attribute.\nI am leaving it in to allow <script> to be\nused without populating it with lots of properties, references\nand targets."}]
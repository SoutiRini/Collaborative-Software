[{"count": 0, "tags": [], "bug_id": 4457, "attachment_id": null, "is_private": false, "id": 7209, "time": "2001-10-26T10:55:38Z", "creator": "groboclown@users.sourceforge.net", "creation_time": "2001-10-26T10:55:38Z", "text": "The Parser is able to late bind unknown tags to tasks, but fails on binding \nunknown tags to datatypes.\n\nExample:  Say I have a defined task \"loadtypes\" which loads user-defiend \ndatatypes and tasks into the Project instance when executed; in this example \nlet's say data-type \"mytype\" and task \"mytask\".  The Ant target may look like:\n    <target name=\"main\" >\n        <loadtypes />\n        <mytask />\n        <mytype id=\"a_mytype\" />\n    </target>\n\nThe output log for this target would look like:\n:\n +User task: myttask     com.mycompany.MyTask\n +User datatype: mytype     com.mycompany.MyType\n:\n[mytype] Could not create task of type: mytype. Common solutions are adding the \ntask to defaults.properties and executing bin/bootstrap\n\nBUILD FAILED\n\n/run.ant.xml:26: Could not create task of type: mytype. Common solutions are to \nuse taskdef to declare your task, or, if this is an optional task, to put the \noptional.jar in the lib directory of your ant installation (ANT_HOME).\n        at org.apache.tools.ant.UnknownElement.makeTask(UnknownElement.java:153)\n\n        at org.apache.tools.ant.UnknownElement.maybeConfigure(UnknownElement.jav\na:83)\n        at org.apache.tools.ant.Task.perform(Task.java:216)\n        at org.apache.tools.ant.Target.execute(Target.java:184)\n        at org.apache.tools.ant.Target.performTasks(Target.java:202)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:603)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:562)\n        at org.apache.tools.ant.Main.runBuild(Main.java:454)\n        at org.apache.tools.ant.Main.start(Main.java:153)\n        at org.apache.tools.ant.Main.main(Main.java:176)\n\nThe solution is an extention to the current UnknownElement class and \nTaskAdapter class:\n\nFor UnknownElement, extend the \"makeTask( ... )\" method to include:\n        if (task == null) {\n            Object type = project.createDataType(ue.getTag());\n            if (type == null) {\n                log(\"Could not create task of type: \" + elementName + \" Common \nsolutions\" +\n                    \" are adding the task to defaults.properties and executing \nbin/bootstrap\",\n                    Project.MSG_DEBUG);\n                throw new BuildException(\"Could not create task of type: \" + \nelementName +\n                                         \". Common solutions are to use taskdef \nto declare\" +\n                                         \" your task, or, if this is an \noptional task,\" +\n                                         \" to put the optional.jar in the lib \ndirectory of\" +\n                                         \" your ant installation (ANT_HOME).\", \nlocation);\n            }\n            TaskAdapter adaptTask = new TaskAdapter();\n            adaptTask.setProxy( type );\n            adaptTask.setIsDataType( true );\n            task = adaptTask;\n        }\nAlso, the inner task needs to have it's project set around where the location \nis set.\n\n\nAnd extend the TaskAdapter class to have two new methods, a new field:\n    boolean isDatatype = false;\n\n    public boolean isDataType() {\n        return this.isDatatype;\n    }\n    \n    public void setIsDataType( boolean on ) {\n        this.isDatatype = on;\n    }\n\n\nAnd also extend the execute method a tad:\n\n            if( executeM == null ) {\n                if (!this.isDatatype) {\n                    log(\"No execute in \" + proxy.getClass(), Project.MSG_ERR);\n                    throw new BuildException(\"No execute in \" + proxy.getClass\n());\n                }\n            } else {\n                executeM.invoke(proxy, null);\n            }\n\nAlso, the TaskAdapter needs to catch NoSuchMethodExceptions."}, {"count": 1, "tags": [], "bug_id": 4457, "attachment_id": null, "id": 7246, "time": "2001-10-29T06:41:43Z", "creator": "bodewig@apache.org", "creation_time": "2001-10-29T06:41:43Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of 4143 ***"}]
[{"count": 0, "tags": [], "creator": "brectanu@gmail.com", "text": "Hello,\n\nI was playing with some odd configs today and noticed that using RewriteRule in\na Location block is matching on the full filesystem path and not the URL path\n(minuse the prefix) as expected.  I have not used this before, but so I am not\nsure here, but the docs for mod_rewrite seem to state that the RE should match\non the URL path minus the Location prefix.\n\nSo given physical path \"/path/to/docs/foo/bar\", DocumentRoot \"path/to/docs\" and\nRequest \"http://big.com/foo/baz/boo.html\"\n\n<Location /foo>\n  RewriteEngine On\n  RewriteRule ^baz/(.*) /bar/$1 [R,L]\n</Location>\n\nThe above does not match as per the docs, but instead against\n'/path/to/docs/foo/baz/boo.html' and fails.\n\nRewriteLog (3) Output:\n[perdir /foo/] add path info postfix: /path/to/docs/foo/baz ->\n/path/to/docs/foo/baz/boo.html\n[perdir /foo/] applying pattern '^baz/(.*)' to uri '/path/to/docs/foo/baz/boo.html'\n\n\nHere is the complete httpd.conf I used (sanitized):\n\n### httpd.conf\nLoadModule rewrite_module modules/mod_rewrite.so\n\nPidFile /path/to/logs/httpd.pid\nErrorLog /path/to/logs/error_log\nLogLevel Debug\nRewriteLog \"/path/to/logs/rewrite_log\"\nRewriteLogLevel 3\n\nListen 80\nServerName localhost\nDocumentRoot \"/path/to/docs\"\n\n<Location /foo>\n  RewriteEngine On\n  RewriteRule ^baz/(.*) /bar/$1 [R,L]\n</Location>", "id": 90400, "time": "2006-06-20T15:39:27Z", "bug_id": 39843, "creation_time": "2006-06-20T15:39:27Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "brectanu@gmail.com", "text": "heh, and before I get corrected on this, I meant to type:\n  RewriteRule ^baz/(.*) bar/$1 [R,L]\nnot \n  RewriteRule ^baz/(.*) /bar/$1 [R,L]\n\nso that it redirects from /foo/baz to /foo/bar.  But, that does not really\nmatter for the issue at hand.", "count": 1, "id": 90404, "time": "2006-06-20T15:50:24Z", "bug_id": 39843, "creation_time": "2006-06-20T15:50:24Z", "is_private": false}, {"count": 2, "attachment_id": null, "creator": "slive@apache.org", "is_private": false, "id": 90408, "time": "2006-06-20T20:37:55Z", "bug_id": 39843, "creation_time": "2006-06-20T20:37:55Z", "tags": [], "text": "Where do you see docs implying the prefix will be stripped?\n\nIn general, using mod_rewrite directives inside <Location> is almost never\nnecessary and can produce unpredictable results.  It should probably just be\ndocumented as unsupported."}, {"count": 3, "tags": [], "bug_id": 39843, "text": "I agree, not that useful really.  But it *is* documented to work in mod_rewrite\ndocs.\n\nhttp://httpd.apache.org/docs/2.2/mod/mod_rewrite.html#rewriterule\n\nAlong with many examples at the end of RewriteRule section, there is also a note\nstating:\n\n\"Note: Pattern matching in per-directory context\n\nNever forget that Pattern is applied to a complete URL in per-server\nconfiguration files. However, in per-directory configuration files, the\nper-directory prefix (which always is the same for a specific directory) is\nautomatically removed for the pattern matching and automatically added after the\nsubstitution has been done. This feature is essential for many sorts of\nrewriting - without this, you would always have to match the parent directory,\nwhich is not always possible.\n\nThere is one exception: If a substitution string starts with ``http://'', then\nthe directory prefix will not be added ,and an external redirect (or proxy\nthroughput, if using flag P) is forced!\"\n\n\n", "id": 90411, "time": "2006-06-20T21:00:48Z", "creator": "brectanu@gmail.com", "creation_time": "2006-06-20T21:00:48Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 39843, "attachment_id": null, "is_private": false, "id": 90412, "time": "2006-06-20T21:03:25Z", "creator": "brectanu@gmail.com", "creation_time": "2006-06-20T21:03:25Z", "text": "Aslo note that that note states *one* exception, but the examples show that it\nis only added back if there is no leading '/'.  So, the exception is actually\nthe rule in most cases."}, {"count": 5, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "is_private": false, "id": 90440, "time": "2006-06-21T13:58:56Z", "bug_id": 39843, "creation_time": "2006-06-21T13:58:56Z", "text": "There's your confusion: When the docs refer to per-directory configuration, they\nmean <Directory> sections and .htaccess files, not <Location> sections.\n\nUnless someone can see a good reason for using RewriteRule in <Location>, I'll\nchange this to a doc bug and suggest just noting that it is unsupported."}, {"count": 6, "tags": [], "bug_id": 39843, "text": "I've now clarified this somewhat in the docs.", "id": 90797, "time": "2006-06-30T19:05:14Z", "creator": "slive@apache.org", "creation_time": "2006-06-30T19:05:14Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 9247, "attachment_id": null, "text": "Hi\n\nI have the following configuration:\n\n- Sun Netra X1\n- Solaris 9EA\n- gcc 3.1 in 64bit mode\n- apache 2.0.36\n\nWhen trying to build the binaries I do the following:\n\n./configure --prefix=/usr/local/apache2\n\nThis creates the Makefiles and prepares everething. But when compiling, I get \nan error in the directory:\n\nsrclib/apr/atomic/solaris_sparc\n\nThe error occures while linking. I discovered, that the Makefile in this \ndirectory contains the following line:\n\nASFLAGS += -K pic -P -D_ASM -D__STDC__=0 -xarch=v8plus\n\nwhich forces the assembler to build v8plus code, which can not be linked by the \n64 bit linker. I've changed this line as follows:\n\nASFLAGS += -K pic -P -D_ASM -D__STDC__=0 -xarch=v9\n\nWhith whis adaption the compilation takes place without errors and apache seems \nto work propperly.\n\nCould you please update the configure script, so that it takes care of the \nsolaris 64bit environment.\n\nPeter", "id": 16403, "time": "2002-05-20T12:38:39Z", "creator": "peter.eggimann@switzerland.org", "creation_time": "2002-05-20T12:38:39Z", "is_private": false}, {"count": 1, "tags": [], "creator": "pier@betaversion.org", "attachment_id": null, "id": 17570, "time": "2002-06-11T11:35:48Z", "bug_id": 9247, "creation_time": "2002-06-11T11:35:48Z", "is_private": false, "text": "This happens as well with the Forte Developer Tools C/C++ compiler \nwhen 64-bits mode is enabled...\n\nIt looks like configure forces the architecture to be \"v8plus\" in lines around \n382 to 390...\n\nThe \"problem\" is that V8+ is a 32-bit based architecture (dunno how to \ndefine this, but it produces 32 bit ELF binaries).\n\nTo check if the user wants a 32 or 64 bits compile, we should check if -\nm64 is enabled in CFLAGS for GCC or -xarch=v9 is enabled for Sun's CC. \nMore than this, I dunno! :)"}, {"count": 2, "tags": [], "bug_id": 9247, "attachment_id": null, "text": "Hmm... this actually belongs to APR, not httpd...", "id": 17571, "time": "2002-06-11T12:09:01Z", "creator": "pier@betaversion.org", "creation_time": "2002-06-11T12:09:01Z", "is_private": false}, {"count": 3, "tags": [], "creator": "pier@betaversion.org", "text": "Reassigning to correct owners...", "id": 17574, "time": "2002-06-11T12:15:17Z", "bug_id": 9247, "creation_time": "2002-06-11T12:15:17Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "pier@betaversion.org", "attachment_id": null, "id": 17575, "time": "2002-06-11T12:15:56Z", "bug_id": 9247, "creation_time": "2002-06-11T12:15:56Z", "is_private": false, "text": "Reassigning to correct order (part 2)"}, {"count": 5, "tags": [], "bug_id": 9247, "attachment_id": null, "text": "This patch is _UGLY_ but fixes the problem and allows building using a \n64 bits compiler, when CFLAGS contain either \"-m64\" (GCC) or \"-xarch=\nv9\" (Sun CC).\n\n$ cvs diff -u3 configure.in \nIndex: configure.in\n=========================================================\n==========\nRCS file: /home/cvspublic/apr/configure.in,v\nretrieving revision 1.452\ndiff -u -3 -r1.452 configure.in\n--- configure.in        10 Jun 2002 18:51:13 -0000      1.452\n+++ configure.in        11 Jun 2002 12:08:16 -0000\n@@ -380,15 +380,27 @@\n                   apr_atomic_sparc_compile=apr_atomic_sparc_no_support.lo\n                   ;;\n                 *)\n+                  AC_MSG_CHECKING([APR atomics architecture for Solaris])\n+                  _TMP_ARC=\"v8plus\"\n+                  for _TMP_VAL in $CFLAGS ; do\n+                    if test \"$_TMP_VAL\" = \"-m64\" ; then\n+                      _TMP_ARC=\"v9\"\n+                    elif test \"$_TMP_VAL\" = \"-xarch=v9\" ; then\n+                      _TMP_ARC=\"v9\"\n+                    fi\n+                  done\n+                  AC_MSG_RESULT([Sparc-$_TMP_ARC])\n                   if test -n \"$is_gnu_as\"; then\n-                    ASFLAGS=\"-xarch=v8plus -K PIC\"\n+                    ASFLAGS=\"-xarch=$_TMP_ARC -K PIC\"\n                     ASCPPFLAGS=\"-traditional-cpp -D_ASM -D__STDC__=0\"\n                     ASCPP=\"gcc -E\"\n                   else \n-                    ASFLAGS=\"-K pic -P -D_ASM -D__STDC__=0 -xarch=v8plus\"\n+                    ASFLAGS=\"-K pic -P -D_ASM -D__STDC__=0 -xarch=\n$_TMP_ARC\"\n                     ASCPPFLAGS=\"\"\n                     ASCPP=\"cat\"\n                   fi\n+                  unset _TMP_VAL\n+                  unset _TMP_ARC\n                   ;;\n                 esac\n             else\n", "id": 17576, "time": "2002-06-11T12:17:28Z", "creator": "pier@betaversion.org", "creation_time": "2002-06-11T12:17:28Z", "is_private": false}, {"count": 6, "tags": [], "creator": "jfclere@gmail.com", "attachment_id": null, "id": 22165, "time": "2002-09-03T14:12:53Z", "bug_id": 9247, "creation_time": "2002-09-03T14:12:53Z", "is_private": false, "text": "-KV9 would be for the Fujitsu compiler."}, {"count": 7, "tags": [], "creator": "jorton@redhat.com", "text": "The SPARC-specific atomic stuff was removed a while back because of licensing\nissues, there should be no problems with apr 0.9.4 (or httpd 2.0.48).\n", "id": 48730, "time": "2003-12-09T12:49:01Z", "bug_id": 9247, "creation_time": "2003-12-09T12:49:01Z", "is_private": false, "attachment_id": null}]
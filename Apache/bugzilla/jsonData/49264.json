[{"count": 0, "attachment_id": null, "bug_id": 49264, "is_private": false, "id": 136721, "time": "2010-05-07T06:06:30Z", "creator": "patrick.hagelkruys@gmail.com", "creation_time": "2010-05-07T06:06:30Z", "tags": [], "text": "when i pass an base64 encoded certificate to appendX509Certificate the function crashes. This problem exists since i upgraded to the trunk version (before it, i used version 1.3.1 of xml-sec). \n\nI have fixed the code by removing the ArrayJanitor and releasing the charX509 by myself:\n\nvoid DSIGKeyInfoX509::appendX509Certificate(const XMLCh * base64Certificate) {\n\n/* ... some code */\n\nX509Holder * h;\nXSECnew(h, X509Holder);\nm_X509List.push_back(h);\nh->mp_encodedX509 = b64Txt->getNodeValue();\nh->mp_cryptoX509 = XSECPlatformUtils::g_cryptoProvider->X509();\nchar * charX509 = XMLString::transcode(h->mp_encodedX509);\n//ArrayJanitor<char> j_charX509(charX509);   //removed\nh->mp_cryptoX509->loadX509Base64Bin(charX509, (unsigned int) strlen(charX509));\nXMLString::release(&charX509);  //added instead of ArrayJanitor\n}\n\nI am using xerces-c 2.8, i have not tried this code with the xerces-c-3. \n\nMaybe someone can verify this crash :)"}, {"attachment_id": null, "tags": [], "creator": "cantor.2@osu.edu", "text": "There are a ton of cases in the code where an ArrayJanitor (which performs a delete []) is used to dispose of results allocated inside Xerces. Technically that requires using XMLString::release, but in practice they're the same most of the time.\n\nUnless you're using a custom memory manager in Xerces, I think it's a platform-specific problem that doesn't show up very often, but it is a bug.\n\nThe problem with fixing them all easily is that unlike my own code, which has auto_ptr-like classes for Xerces results, this code I inherited maintenance of does not. So explicitly freeing results introduces lots of exception-handling based leak possibilities, so it takes a lot of time to fix.\n\nI may just port over my code for fixing this and start using it instead of ArrayJanitor.", "count": 1, "id": 136733, "time": "2010-05-07T13:01:50Z", "bug_id": 49264, "creation_time": "2010-05-07T13:01:50Z", "is_private": false}, {"count": 2, "tags": [], "text": "Initial fix:\nhttp://svn.apache.org/viewvc?view=revision&revision=943263\n\nLeaving open so I can fix any remaining broken uses of the ArrayJanitor class.", "is_private": false, "id": 136790, "creation_time": "2010-05-11T16:10:40Z", "time": "2010-05-11T16:10:40Z", "creator": "cantor.2@osu.edu", "bug_id": 49264, "attachment_id": null}, {"count": 3, "text": "I am getting the following error message:\nxmlsec\\src\\utils\\xsecautoptr.hpp(54) : error C2065: 'nullptr' : undeclared identifier\n\nI am using the visual studio 9 Project (visual studio 2005). To handle that error I added following defines above the XSECAutoPtrChar class\n\n#ifndef nullptr\n#define nullptr 0\n#endif\n\nafterwards the library compiles and links without errors, and the appendX509Certificate Function not longer crashes", "bug_id": 49264, "is_private": false, "id": 136808, "time": "2010-05-12T08:45:39Z", "creator": "patrick.hagelkruys@gmail.com", "creation_time": "2010-05-12T08:45:39Z", "tags": [], "attachment_id": null}, {"count": 4, "tags": [], "creator": "cantor.2@osu.edu", "text": "My mistake, I left my \"newer\" C++-isms in the code when I ported it. I switched it back to NULL in svn.", "id": 136815, "time": "2010-05-12T10:19:44Z", "bug_id": 49264, "creation_time": "2010-05-12T10:19:44Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "cantor.2@osu.edu", "is_private": false, "text": "Theoretically complete replacement of incorrect Janitor usage, plus replacing explicit release calls with macro for older Xerces versions.\n\nhttp://svn.apache.org/viewvc?view=revision&revision=957190", "id": 137846, "time": "2010-06-23T09:34:19Z", "bug_id": 49264, "creation_time": "2010-06-23T09:34:19Z", "attachment_id": null}]
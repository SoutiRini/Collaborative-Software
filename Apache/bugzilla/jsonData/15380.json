[{"count": 0, "attachment_id": null, "creator": "andrew.calverley@dcc.govt.nz", "text": "We are running Apache httpd 2.0.43 on HP-UX 11.0 and nearly every day there are \nhttpd processes which are [supposedly] consuming a lot of CPU resource.  Having \nsaid that there appears to be not appreciable impact on response times for \nother requests.\nThe httpd processes in question show up at the head of a \"top\" list.  The same \nprocesses are indentifiable in a server-status page with a status of \"G\" \n{gracefully finishing).  Typically the server-status page shows that the last \nrequests where GETS for file system gifs and that there are substantial number \nof seconds (eg. 252506) since a request was last actioned on that process.\n\nI have determined that I can kill the processes without any apparent harm to \nother the web server processes.  I cannot stop them with a reset of the web \nserver &, as this is a production environment, I haven't tried complete stop to \nsee the effect of that.\n\nAndrew Calverley\nIS Technical Support\nDunedin City Council\nDunedin\nNew Zealand", "id": 27852, "time": "2002-12-15T21:41:53Z", "bug_id": 15380, "creation_time": "2002-12-15T21:41:53Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "creator": "jstrehlau@aspecta.com", "is_private": false, "id": 29062, "time": "2003-01-09T11:01:05Z", "bug_id": 15380, "creation_time": "2003-01-09T11:01:05Z", "tags": [], "text": "We have the same problem. Using \"apachectl graceful\" does not solve the \nproblem, \"apachectl restart\" kills the process successfully. It seems that this \nproblem only appears in our testing environment, though the production \nenvironment is nearly the same. The problem appeared in httpd 2.0.39, too. It \nwas the reason why we have updated apache."}, {"count": 2, "tags": [], "creator": "trawick@apache.org", "text": "Please run tusc on a process with high CPU and see what it is doing w.r.t. \nsyscalls.\n\nSee this document if you aren't familiar with tusc.\n\nhttp://h21007.www2.hp.com/dspp/tech/tech_TechDocumentDetailPage_IDX/1,1701,2894,00.html\n\nIf the high CPU process isn't making syscalls (i.e., looping in user space),\nyou'll need to attach to it with a debugger and get a backtrace.\n\nThanks!\n", "id": 31143, "time": "2003-02-12T15:27:40Z", "bug_id": 15380, "creation_time": "2003-02-12T15:27:40Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "andrew.calverley@dcc.govt.nz", "text": "I have 3 such processes in this state right now (which I will forceably \nterminate).\n\nPrior to that running tusc on each process (ie tusc <pid>) gives output the \nsame for each pid similar to below (until I do a Ctrl-C):\n\n# tusc 29187\n( Attached to process 29187 (\"/www/bin/httpd -d /www -k start\") [32-bit] )\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. [running]\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\n...\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\nsendfile(78, 80, 0, 520, 0x7f7f0ce0, 0) .................. = 0\n( Detaching from process 29187 (\"/www/bin/httpd -d /www -k start\") )\n\nAndrew Calverley\nIS Technical Support\nDunedin City Council\nDunedin\nNew Zealand", "id": 31369, "time": "2003-02-16T21:17:11Z", "bug_id": 15380, "creation_time": "2003-02-16T21:17:11Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 15380, "is_private": false, "text": "Thanks for the info...\n\nYou need to add\n\n\"EnableSendfile Off\" \n\nto your\n\n<Directory />\n\ncontainer to work around this problem.\n\nSomebody mentioned this problem to me a few days ago (HP-UX sendfile returning\n0).  HP-UX doesn't document it to return 0 in this condition, and Apache/APR\ndoesn't handle it.\n\nThe person who mentioned this to me, who works for HP by the way, thought it\nmight be related to related to resetting a network adapter.  He was going to\ncontact the appropriate HP-UX engineers, but I haven't heard back.\n\nWhen there is a resolution (bug fix to HP-UX or some amendment to their doc so\nwe know what to do when it returns 0 in this case) we may need to change our code.\n", "id": 31370, "time": "2003-02-16T21:34:02Z", "creator": "trawick@apache.org", "creation_time": "2003-02-16T21:34:02Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 15380, "is_private": false, "text": "Actually, \"EnableSendfile Off\" doesn't have to be in <Directory />.\nSee the doc for more info on where it can be used:\n\nhttp://httpd.apache.org/docs-2.0/mod/core.html#enablesendfile", "id": 31371, "time": "2003-02-16T21:37:48Z", "creator": "trawick@apache.org", "creation_time": "2003-02-16T21:37:48Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 15380, "is_private": false, "count": 6, "id": 31421, "time": "2003-02-17T10:41:09Z", "creator": "jstrehlau@aspecta.com", "creation_time": "2003-02-17T10:41:09Z", "text": "\"EnableSendfile\" is not available in an httpd version before 2.0.44. HP uses \nversion 2.0.43 and until now there is no newer release.\n"}, {"count": 7, "attachment_id": null, "creator": "trawick@apache.org", "text": "Comments regarding the last update by jstrehlau@aspecta.com:\n\nIf you are limited to running binaries made available by HP, it is\ndifficult for us to be helpful to you.  The problem you are \nexperiencing is almost certainly caused by a bug in HP-UX, which of \ncourse you are free to bother them about and perhaps use as a reason \nthey should provide a binary of 2.0.44.  Even if it is not an HP-UX\ncode bug, it is certainly a doc bug.\n\nThe only work-around I can think of with 2.0.43 is to run everything\nthrough mod_include (but that doesn't sound very cool).  The best bet \nis to build your own Apache with --disable-sendfile on the configure \ninvocation or use Apache >= 2.0.44 and put \"EnableSendfile Off\" in the \nconf file.\n", "id": 31834, "time": "2003-02-24T04:26:32Z", "bug_id": 15380, "creation_time": "2003-02-24T04:26:32Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 15380, "attachment_id": null, "text": "Can you please post any updates ?.", "id": 33259, "time": "2003-03-16T16:17:48Z", "creator": "madhusudan_mathihalli@hp.com", "creation_time": "2003-03-16T16:17:48Z", "is_private": false}, {"count": 9, "attachment_id": null, "creator": "andrew.calverley@dcc.govt.nz", "text": "I have, just last night, upgraded to Apache 2.0.44 in our production \nenvironment and put \"EnableSendFile Off\" in httpd.conf & so will be monitoring \nthis over the next few days.\n\nAndrew Calverley\nIS Technical Support\nDunedin City Council\nDunedin\nNew Zealand", "id": 33374, "time": "2003-03-18T20:53:07Z", "bug_id": 15380, "creation_time": "2003-03-18T20:53:07Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "bug_id": 15380, "is_private": false, "text": "Following the upgrade to Apache 2.0.44 & putting \"EnableSendFile Off\" in the \nhttpd.conf  we have had no recurrance of the run away httpd processes in 2.5 \ndays - so this is looking good.  \n\nI should point out that I did not build the httpd server with the \"--disable-\nsendfile\" configuration option.\n\nThanks for the help/advice on this issue.\n\nAndrew Calverley\nIS Technical Support\nDunedin City Council\nDunedin\nNew Zealand", "id": 33571, "time": "2003-03-20T21:18:31Z", "creator": "andrew.calverley@dcc.govt.nz", "creation_time": "2003-03-20T21:18:31Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 22133, "attachment_id": null, "is_private": false, "id": 42148, "time": "2003-08-05T12:44:58Z", "creator": "ernst.matthias@gmail.com", "creation_time": "2003-08-05T12:44:58Z", "text": "A JSP Fragment in a tag file that does EL may lead to problematic Java code.\n\nJSP Fragments of tag files are compiled into inner classes:\n\n  public final class com_coremedia_jsp_NewsTicker_body_tag\n    extends javax.servlet.jsp.tagext.SimpleTagSupport\n  {\n    ...\n\n    private class com_coremedia_jsp_NewsTicker_body_tagHelper\n      extends org.apache.jasper.runtime.JspFragmentHelper\n    {\n      ...\n      public void invoke0( java.io.Writer out ) \n        throws Throwable\n      {\n         ...\n        \nout.write((java.lang.String)org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate(\"${rows}\",\njava.lang.String.class, (PageContext)getJspContext(), null, false)); <<<<<<\n         ...\n      }\n    }\n\nBoth javac 1.3 and Eclipse's JDT compiler flag the call to #getJspContext as\ninvalid as this method is both inherited and defined in the enclosing class: \n\n  com_coremedia_jsp_NewsTicker_body_tag.java:206: getJspContext() is inherited  \n  from org.apache.jasper.runtime.JspFragmentHelper and hides method in outer  \n  class org.apache.jsp.tag.web.com_coremedia_jsp_NewsTicker_body_tag.  An  \n  explicit 'this' qualifier must be used to select the desired instance.\n\nJavac 1.4.2 accepts this code and calls the inherited method.\n\nFrom my interpretation of the JLS, 1.4.2's behaviour seems correct and is the\nintended one, but the code won't be compilable with javac 1.3."}, {"attachment_id": null, "tags": [], "creator": "ernst.matthias@gmail.com", "text": "The following patch resolves _this specific_ problem but there might be other\nimplicit calls to 'this' lurking around:\n\n====\n//coremedia/thirdparty/apache/jakarta-jasper2/src/share/org/apache/jasper/compiler/JspUtil.java#2\n-\n/home/mernst/p4/main/thirdparty/apache/jasper2/src/share/org/apache/jasper/compiler/JspUtil.java\n====\n@@ -534,7 +534,7 @@\n          */\n        String jspCtxt = null;\n        if (isTagFile)\n-           jspCtxt = \"getJspContext()\";\n+           jspCtxt = \"this.getJspContext()\";\n        else\n            jspCtxt = \"pageContext\";\n", "count": 1, "id": 42149, "time": "2003-08-05T12:50:17Z", "bug_id": 22133, "creation_time": "2003-08-05T12:50:17Z", "is_private": false}, {"count": 2, "tags": [], "creator": "ernst.matthias@gmail.com", "attachment_id": null, "id": 42235, "time": "2003-08-06T08:11:59Z", "bug_id": 22133, "creation_time": "2003-08-06T08:11:59Z", "is_private": false, "text": "You can switch eclipse's compiler's \"compliance\" to 1.4 (what a multifaced beast !). Then it'll \ncompile that code.\n\nThe issue with 1.3 remains. How important is Jdk 1.3 compliance rated, by the way ?\n "}, {"count": 3, "attachment_id": null, "bug_id": 22133, "is_private": false, "id": 42239, "time": "2003-08-06T10:23:28Z", "creator": "remm@apache.org", "creation_time": "2003-08-06T10:23:28Z", "tags": [], "text": "Ok, so your patch resolves JDK 1.3 compatibility then ?\nJDK 1.3 compatibility is important. the whole J2EE requires 1.4 now, but the web\ntier can (and should) still attempt to work with 1.3."}, {"count": 4, "tags": [], "bug_id": 22133, "attachment_id": null, "id": 42240, "time": "2003-08-06T10:32:18Z", "creator": "ernst.matthias@gmail.com", "creation_time": "2003-08-06T10:32:18Z", "is_private": false, "text": "Well, my patch resolves the issue for this particular call to #getJspContext(). In general all \nunqualified method calls that resolve to methods in both SimpleTagSupport and \nJspFragmentHelper will be flagged by the 1.3.1 compiler. Looks like 'getParentTag()' might be \nanother candidate. Will check out."}, {"count": 5, "tags": [], "bug_id": 22133, "attachment_id": null, "id": 42389, "time": "2003-08-08T10:26:21Z", "creator": "remm@apache.org", "creation_time": "2003-08-08T10:26:21Z", "is_private": false, "text": "I have applied your patch, and it will be included in 5.0.7. Thanks.\nReopen the bug if you find other occurances of this bug."}]
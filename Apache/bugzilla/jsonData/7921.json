[{"count": 0, "attachment_id": null, "creator": "foobar@web.de", "is_private": false, "id": 13177, "time": "2002-04-10T13:09:14Z", "bug_id": 7921, "creation_time": "2002-04-10T13:09:14Z", "tags": [], "text": "./configure --with-mpm=perchild\nmake\nmake install\n/usr/local/apache2/bin/apachectl start\n/usr/local/apache2/bin/apachectl stop\n\n$> cat /usr/local/apache2/logs/error_log\n...\n...\n[Wed Apr 10 14:58:40 2002] [emerg] (13)Permission denied: apr_proc_mutex_lock\nfailed. Attempting to shutdown process gracefully.\n[Wed Apr 10 14:58:40 2002] [emerg] (13)Permission denied: apr_proc_mutex_unlock\nfailed. Attempting to shutdown process gracefully.\n[Wed Apr 10 14:58:41 2002] [emerg] (13)Permission denied: apr_proc_mutex_lock\nfailed. Attempting to shutdown process gracefully.\n[Wed Apr 10 14:58:41 2002] [emerg] (13)Permission denied: apr_proc_mutex_unlock\nfailed. Attempting to shutdown process gracefully.\n[Wed Apr 10 14:58:41 2002] [emerg] (13)Permission denied: apr_proc_mutex_lock\nfailed. Attempting to shutdown process gracefully.\n...\n...\n\n$> strace -f -o ../foo.log /usr/local/apache2/bin/httpd\n\nfoo.log is attached ..."}, {"count": 1, "tags": [], "text": "Created attachment 1513\nstrace output", "attachment_id": 1513, "bug_id": 7921, "id": 13179, "time": "2002-04-10T13:11:27Z", "creator": "foobar@web.de", "creation_time": "2002-04-10T13:11:27Z", "is_private": false}, {"count": 2, "text": "Created attachment 1514\nconfigure output", "bug_id": 7921, "is_private": false, "id": 13181, "time": "2002-04-10T13:25:43Z", "creator": "foobar@web.de", "creation_time": "2002-04-10T13:25:43Z", "tags": [], "attachment_id": 1514}, {"attachment_id": null, "tags": [], "bug_id": 7921, "is_private": false, "count": 3, "id": 13413, "time": "2002-04-12T20:23:12Z", "creator": "maxes2@chat.ru", "creation_time": "2002-04-12T20:23:12Z", "text": "attach, pls, Your httpd.conf"}, {"attachment_id": null, "tags": [], "bug_id": 7921, "text": "i use the default httpd.conf from the apache2.0.35-src-package\nonly change the ServerName, ServerAdmin and Port to 8080", "count": 4, "id": 13422, "time": "2002-04-12T21:54:09Z", "creator": "foobar@web.de", "creation_time": "2002-04-12T21:54:09Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 7921, "is_private": false, "text": "Created attachment 1539\nhttpd.conf", "id": 13423, "time": "2002-04-12T21:57:27Z", "creator": "foobar@web.de", "creation_time": "2002-04-12T21:57:27Z", "attachment_id": 1539}, {"count": 6, "tags": [], "bug_id": 7921, "attachment_id": null, "is_private": false, "id": 14143, "time": "2002-04-20T20:21:06Z", "creator": "jim@apache.org", "creation_time": "2002-04-20T20:21:06Z", "text": "Which platform and mutex are you using?"}, {"count": 7, "tags": [], "text": "linux\n kernel 2.4.18\n libc   2.2.5", "is_private": false, "id": 14166, "creator": "foobar@web.de", "time": "2002-04-21T08:31:52Z", "bug_id": 7921, "creation_time": "2002-04-21T08:31:52Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "You are trying to use SYS V Semaphores for your locking, but that can't work\nwith perchild.  The docs are not clear about this, because I just found the\nproblem earlier this week.  Basically, for all of the other MPMs, we create the\nsemaphore and then change the permissions on the semaphore so that the child\nprocesses can attach to it.  That works for the other MPMs, because they have a\nsinlge uid/gid for all of the child processes.  Perchild doesn't have that, it\nhas multiple uid/gid combinations, so we would have to make the permissions very\nlax in order to allow all of the uid/gid's to bind to the semaphore.  Rather\nthan open the security that much, it is much better to just use a fcntl locking\nmechanism.\n\nThis can be accomplished by adding:\n\nAcceptMutex fcntl\n\nto your config file.", "is_private": false, "id": 18876, "creator": "rbb@apache.org", "time": "2002-07-02T19:59:10Z", "bug_id": 7921, "creation_time": "2002-07-02T19:59:10Z", "attachment_id": null}, {"text": "*** Bug 8904 has been marked as a duplicate of this bug. ***", "tags": [], "bug_id": 7921, "attachment_id": null, "count": 9, "id": 18895, "time": "2002-07-02T21:53:29Z", "creator": "rbb@apache.org", "creation_time": "2002-07-02T21:53:29Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 7921, "attachment_id": null, "is_private": false, "id": 33524, "time": "2003-03-20T08:48:02Z", "creator": "dobradovic@gmx.de", "creation_time": "2003-03-20T08:48:02Z", "text": "Hi!\n\nI'm afraid the switch to \"fcntl\" didn't solve my problem. When I had \"default\"\nit tried at least to start the child with the correct uid/gid, now it starts 4\napache processes as root, and one of them tries to handle my request to the\nvirtual host. It's somewhat weired, as I get a \"permission denied\" then...\n\nThe vhost is this:\n>>>>>\n<VirtualHost [IP]>\n        DocumentRoot /home/kiw/htdocs\n        ServerName mydomain.tld\n        ServerPath /home/kiw/htdocs\n        ScriptAlias /cgi-bin/ /home/kiw/htdocs/cgi-bin/\n        AssignUserID kiw users\n        ErrorLog /var/log/apache2/kiw-error_log\n        CustomLog /var/log/apache2/kiw-access_log combined\n</VirtualHost>\n<<<<<\n\nAnd the section from the main conf-file is this:\n>>>>>\n<IfModule perchild.c>\n        NumServers           1\n        StartThreads         2\n        MinSpareThreads      1\n        MaxSpareThreads      4\n        MaxThreadsPerChild  10\n        MaxRequestsPerChild  0\n        AcceptMutex default\n        ChildPerUserID kiw users 1\n</IfModule>\n<<<<<\n\nPlatform is Linux on x86, Apache is 2.0.44.\nIt obviously starts up fine, but I don't get a process with the appropriate\nuid/gid and a permission denied when trying to access the website:\n>>>>>\n[Thu Mar 20 09:42:51 2003] [error] [client 217.84.193.150] client denied by\nserver configuration: /home/kiw/htdocs/\n<<<<<\n\nThe directory is world-readable/-accessible."}, {"count": 11, "attachment_id": null, "bug_id": 7921, "is_private": false, "id": 33622, "time": "2003-03-21T21:13:49Z", "creator": "dobradovic@gmx.de", "creation_time": "2003-03-21T21:13:49Z", "tags": [], "text": "Ok, I had a bad morning this day.\nMy distribution set up the default permissions unaccessible on /, that's why\nthat error occured.\nperchild principally works fine now with \"AcceptMutex fcntl\", but the processes\nare somewaht irritating. I get only one root-process in \"top\", but three with\n\"ps -ax\", where I cant see the owners. But it should only be wo, as NumServers\nis set to 1. I guess the default non-virtual host is still running senselessly? :(\nI'll try playing around, but it works fine as it should and I'm happy. :)"}]
[{"count": 0, "tags": [], "bug_id": 59664, "attachment_id": null, "is_private": false, "id": 191403, "time": "2016-06-06T08:45:48Z", "creator": "else.liujian@huawei.com", "creation_time": "2016-06-06T08:45:48Z", "text": "The questions same with Bug 53717,but i think the class BufferReader should be improve.\n\nOS\uff1aWin7 SP1\nTomcat\uff1a7.0.69 (Win7 and Suse11) \nJDK\uff1a1.8.0_65-b17\n\n\nI code a win32 program and use winhttp5.1 API,to send HTTPs request to Tomcat,the Body is Unicode content.\n\nOn Tomcat,JSP use BufferedReader to get it\n\nThe problem is:\n\nThe first times to do \"read(cbuf,0,1024);\",it return 0.\n\n0 means the stream is ended. \n\nBecause the first batch data is only 1 Byte,but Unicode need 2 bytes to encode.\n\nit seems the same with Bug 53717.\n\nThat means BufferedReader can not used actually\nBecause when I coding JSP,i don't know how the Body will be split.\nI not know the protocol is HTTPs or HTTP\n\ni think the return of BufferedReader.read() should append a new enumeration when character lacked."}, {"count": 1, "tags": [], "bug_id": 59664, "attachment_id": null, "id": 191431, "time": "2016-06-06T19:04:59Z", "creator": "markt@apache.org", "creation_time": "2016-06-06T19:04:59Z", "is_private": false, "text": "Bugzilla is not a support forum. Please use the Tomcat users' mailing list for assistance.\n\nThere are multiple reasons I am resolving this as invalid.\n- The statement in the bug report \"0 means the stream is ended\" is incorrect\n- With blocking IO (as available from a JSP) a zero length read is not possible\n- BufferedReader is a Java SE class, not a Tomcat class\n- A simple test case that sends UTF-8 data byte by byte over TLS works as expected with both 7.0.x trunk and 9.0.x trunk"}, {"count": 2, "tags": [], "text": "Thanks for your reply.\n\nI know that not issue for Tomcat.\n\nI follow you suggest.\nJudge the return value of read()  is an effective way.\nthe return is 0,sleep() and read() again later,I test OK now.\n\nAnd I test another way, use ready()\nIf ready() return false, sleep() and read() again later,but it lead to endless loop!\n\n\nIt to easy to be cheated by BufferReader,and the j2se doc is so obscure too.", "attachment_id": null, "bug_id": 59664, "id": 191441, "time": "2016-06-07T08:05:32Z", "creator": "else.liujian@huawei.com", "creation_time": "2016-06-07T08:05:32Z", "is_private": false}, {"count": 3, "tags": [], "text": "Hi:\n\nsorry about the issuss\n\ni see the code of the org.apache.catalina.connector.InputBuffer\n    public int available() {\n        int available = 0;\n        if (state == BYTE_STATE) {\n            available = bb.getLength();\n        } else if (state == CHAR_STATE) {\n            available = cb.getLength();\n        }\n        if (available == 0) {\n            coyoteRequest.action(ActionCode.AVAILABLE, null);\n            available = (coyoteRequest.getAvailable() > 0) ? 1 : 0;\n        }\n        return available;\n    }\n\n    public boolean ready()\n        throws IOException {\n\n        if (closed) {\n            throw new IOException(sm.getString(\"inputBuffer.streamClosed\"));\n        }\n\n        return (available() > 0);\n    }\n\n\nyou see,if only one byte in 'bb',the 'ready()' will return 'true'\nBut for 'Unicode',only one byte can not read success\n\nSo, we can not use 'ready()' to get 'Reader' is available or not\n\ni think 'ready()' of 'Reader' should imporve", "attachment_id": null, "bug_id": 59664, "id": 195472, "time": "2016-12-13T12:16:38Z", "creator": "else.liujian@huawei.com", "creation_time": "2016-12-13T12:16:38Z", "is_private": false}, {"count": 4, "tags": [], "text": "If you wish to re-open this bug, please provide a clear test-case where Tomcat fails to behave in a way that is expected. Your test case should be an SSCCE[1] and clearly demonstrate that Tomcat is behaving incorrectly with respect to the HTTP or other specifications which govern its operation.\n\nAssertions that Tomcat might not behave properly under certain circumstances are not adequate: you must provide code that should operate properly but does not due to a problem with Tomcat.\n\n[1] http://sscce.org/", "attachment_id": null, "bug_id": 59664, "id": 195474, "time": "2016-12-13T15:15:49Z", "creator": "chris@christopherschultz.net", "creation_time": "2016-12-13T15:15:49Z", "is_private": false}]
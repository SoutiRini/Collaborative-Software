[{"count": 0, "tags": [], "creator": "jasnell@us.ibm.com", "attachment_id": null, "is_private": false, "id": 18702, "time": "2002-06-28T07:16:05Z", "bug_id": 10312, "creation_time": "2002-06-28T07:16:05Z", "text": "I've added a custom JNDI resource factory to the server.xml:\n\n  <Resource auth=\"Container\" \n    name=\"test\" \n    type=\"com.ibm.test.Test\" />\n  <ResourceParams name=\"test\">\n    <parameter>\n      <name>factory</name>\n      <value>com.ibm.test.TestFactory</value>\n    </parameter>\n  </ResourceParams>\n\nAnd I've added the appropriate lines to my web.xml:\n\n  <resource-ref>\n    <res-ref-name>test</res-ref-name>\n    <res-type>com.ibm.test.Test</res-type>\n    <res-auth>Container</res-auth>\n  </resource-ref>\n\nThen, when I run my code:\n\n  InitialContext ctx = new InitialContext();\n  Test test = (Test)ctx.lookup(\"java:comp/env/test\");\n\nI get an error stating that the resource instance could not be created.  After \ndigging through the code, I found the following problem:\n\nIn org.apache.naming.factory.ResourceFactory, the following code returns a null \nwhen it should return the value of the factory resource param.\n\n  RefAddr factoryRefAddr = ref.get(Constants.FACTORY);\n\nDigging in a bit further, it would appear as if the ResourceParams are not \nbeing properly set at all for resources in the server.xml.  While they appear \nto be parsed and digested well enough, they never seem to make it to the \ncontext."}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "Fixing this bug in 4.0.x is quite complex.\nWhat happens is that the definition from web.xml (which is empty) overrides the\ndefinition from server.xml (that one had the parameters).\n\nAs a workaround, you should remove the resource definition from web.xml.\n\n4.1.x has fixed that problem (but the changes were relatively extensive, so\nthat's why I'm reluctant to try to port the fix), and I recommend trying out the\nupcoming second beta of it once it's out (it should be within a week if\neverything goes well).", "id": 18949, "time": "2002-07-03T15:07:24Z", "bug_id": 10312, "creation_time": "2002-07-03T15:07:24Z", "is_private": false}]
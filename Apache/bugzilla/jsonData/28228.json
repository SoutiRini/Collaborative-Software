[{"count": 0, "tags": [], "text": "This is the \"formal\" enhancement request for a <classloader>\ntask. In it's actual form, it has been introduced in the developer's \nmailing list. \n(see: http://marc.theaimsgroup.com/?l=ant-dev&m=108055794609605&w=2)\n\nI would like to reactivate and extend the current \"sleeping\" <classloader>\ntask with a patch that is able to \n\na) append classpath entries to existing classloaders, \nb) explicitely create classloaders,\nc) put the actual path of a classloader into a property and\nd) log a simple report about the currently classloaders.\n\nCurrently it supports URLClassLoader and AntClassLoader. It is \ndesigned to simply support custom extensions for any arbitrary \nClassLoader.\n\nAdvantages \n----------\nAs classpathes can completely managed from inside the build.xml, \nthis task can help\n1. to avoid the need to either change Ant's default installation \n   by adding or removing jars to or from Ant's lib dir \n   or manage the classpath in the launching script and\n2. to avoid classpath-problems with custom tasks \n   (especially if they should - for whatever reason - be used \n    as jars in the same buildfile as they were created).\n\nb) and c) can be used to easily sync other task's classpathes and \nd) might be helpful to debug some classpath problems and understand classloader\nbehaviour ;-)\n\nDisadvantages\n-------------\nThe most frequent raised objection is, that adding classpathes to existing\nparent classloaders in a delegation hierarchy may lead to situations where \none class is loaded by two different classloaders in a delegation hierarchy\nat the same time. This will most likely cause linkage errors and mysterious \nfailures.\n(See: http://marc.theaimsgroup.com/?l=ant-dev&m=106389211508059&w=2\n  and http://marc.theaimsgroup.com/?l=ant-dev&m=104080215031773&w=2)\nAnother point is the risk of security loopholes if URLs are used as classpath \nentries.\n\nBoth objections are reasonable but IMHO, the advantages outweigh them.\n* The aforesaid potential risks are described in the task documentation.\n* As this task is new, it can not endanger existing builds. \n* Advanced users have the possibility to break the above-mentioned\n  requirements.\n  \nRegards,\nRainer\n\nP.S. Adding this task to the external task list is dissatisfying IMHO,\n     as it shoots the major advantage (1.) down.", "is_private": false, "id": 55378, "creation_time": "2004-04-06T11:14:11Z", "time": "2004-04-06T11:14:11Z", "creator": "rainer@noacks.net", "bug_id": 28228, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 28228, "text": "Created attachment 11152\nnew files for proposed patch", "id": 55379, "time": "2004-04-06T11:17:48Z", "creator": "rainer@noacks.net", "creation_time": "2004-04-06T11:17:48Z", "is_private": false, "attachment_id": 11152}, {"count": 2, "attachment_id": 11153, "creator": "rainer@noacks.net", "is_private": false, "id": 55380, "time": "2004-04-06T11:19:34Z", "bug_id": 28228, "creation_time": "2004-04-06T11:19:34Z", "tags": [], "text": "Created attachment 11153\nchanges (diff) for proposed patch"}, {"count": 3, "tags": [], "bug_id": 28228, "is_private": false, "id": 55383, "creation_time": "2004-04-06T11:40:39Z", "time": "2004-04-06T11:40:39Z", "creator": "rainer@noacks.net", "text": "oops, i've seen, that the first attachment can not be opened.\nit's the patch.tar.gz resulting from the patch.xml.\nhow should i contribute it? what is the correct classification/mine-type?\nsorry,\nRainer", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 28228, "is_private": false, "id": 55499, "creation_time": "2004-04-07T21:11:57Z", "time": "2004-04-07T21:11:57Z", "creator": "rainer@noacks.net", "text": "Created attachment 11178\nnew files for proposed patch (with correct mimetype,sorry) replaces attach_id #11152", "attachment_id": 11178}, {"count": 5, "attachment_id": 11179, "creator": "rainer@noacks.net", "text": "Created attachment 11179\nnew files for proposed patch (last try with now - hopefully - correct mime-type)", "id": 55500, "time": "2004-04-07T21:22:56Z", "bug_id": 28228, "creation_time": "2004-04-07T21:22:56Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "creator": "peter.reilly@corvil.com", "is_private": false, "id": 57150, "attachment_id": null, "bug_id": 28228, "creation_time": "2004-05-11T08:27:00Z", "time": "2004-05-11T08:27:00Z", "text": "It looks like some files are missing for the tar.gz file:\nthe classloaders in the o.a.t.a.taskdefs.classloader\npackage:\nAntClassLoaderAdapter\nSimpleClassLoaderAdapter\nURLClassLoaderAdapter\n"}, {"count": 7, "tags": [], "bug_id": 28228, "is_private": false, "id": 57384, "creation_time": "2004-05-14T00:29:37Z", "time": "2004-05-14T00:29:37Z", "creator": "rainer@noacks.net", "text": "oops. peter, you're right.\nsorry, I didn't noticed that.\nmay i send you the 3 files as a zip?\nregards,\nrainer", "attachment_id": null}, {"count": 8, "attachment_id": null, "creator": "peter.reilly@corvil.com", "text": "Just attach them to the bugzilla report.\nCheers,\nPeter.", "id": 57395, "time": "2004-05-14T09:59:23Z", "bug_id": 28228, "creation_time": "2004-05-14T09:59:23Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "bug_id": 28228, "is_private": false, "text": "Created attachment 11562\nagain: new files for proposed patch. replaces attachment from 04/07/04 21:22", "id": 57479, "time": "2004-05-15T10:15:51Z", "creator": "rainer@noacks.net", "creation_time": "2004-05-15T10:15:51Z", "attachment_id": 11562}, {"count": 10, "tags": [], "bug_id": 28228, "text": "Created attachment 11563\nmodified diff (if also required), replaces attachment from 04/06/04 11:19", "id": 57481, "time": "2004-05-15T10:42:38Z", "creator": "rainer@noacks.net", "creation_time": "2004-05-15T10:42:38Z", "is_private": false, "attachment_id": 11563}, {"count": 11, "tags": [], "creator": "gabriele.garuglieri@infoblu.it", "attachment_id": null, "is_private": false, "id": 70354, "time": "2005-02-02T10:49:47Z", "bug_id": 28228, "creation_time": "2005-02-02T10:49:47Z", "text": "I added a vote for this enhancement that i find really useful and, at least for\nmy needs, works like a charm.\nActually i extracted the patch and built it as a separate package that i plan to\nuse for our internal build system, but i hope to see it soon on afficial Ant\nrelease so that i won't have to carry around an additional jar.\nI'm aware of the security risks that it exposes, but, once well documented, i\nthink the advantages largely override them.\nI maintained all the code comments and ownership, so i hope Rainer has nothing\ncontrary to what i did.\nRegards,  Gabriele."}, {"count": 12, "tags": [], "creator": "peterreilly@apache.org", "text": "I am looking at this again.\nIt would be nice to make a number of changes:\n\n1) the task import sun.import sun.misc.Launcher and import sun.misc.URLClassPath.\n   It would be better not to import sun.* classes in non-optional tasks. A\n   solution to this would be make the report function a seperate optional task.\n\n2) the task could check if a jar or directort is already in a in the classpath\n   I found when testing that it is easy to get into a situation where the\n   classpath will have the same jar file many times - due to calls to\n   <classloader> with using netbeans\n\n3) the doc could state that use of this task in ides that do not\n   have a separate jvm for a run of ant will cause issues - the\n   classpath will be retained by the ide and used in the next\n   ant build run\n", "id": 75799, "attachment_id": null, "bug_id": 28228, "creation_time": "2005-06-02T16:08:23Z", "time": "2005-06-02T16:08:23Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 28228, "text": "A new version of this functionality is available as an external task for trial \npurposes on\n\nhttp://jtools.org/ant-classloadertask/\n\nThis version solves some delegation hierarchy problems (see \nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=35436) and follows peter's \nsuggestions. The report functionality is removed into a separate task.\nBecause I've also used the functionality in other contexts, I've separated the \ncustomisation framework from the Ant specific classes to increase it's \nreusability.\n\nAs I'm not perfectly happy with this implementation (a little bit too \nsophisticated IMHO) I will think about some simplification before providing an \nupdated patch.\n\nAny comments welcome!\n\nCheers\n\nRainer\n", "id": 79420, "time": "2005-09-05T22:14:13Z", "creator": "rainer@noacks.net", "creation_time": "2005-09-05T22:14:13Z", "is_private": false, "attachment_id": null}, {"count": 14, "tags": [], "bug_id": 28228, "text": "*** Bug 37223 has been marked as a duplicate of this bug. ***", "id": 81893, "time": "2005-10-28T14:54:24Z", "creator": "meinc@web.de", "creation_time": "2005-10-28T14:54:24Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "stevel@apache.org", "text": "What are we going to do with this. Something for Ant1.7? \n\nBeing able to patch the classloader can screw up IDEs, but its nice for adding\nantlibs on the fly", "count": 15, "id": 89236, "time": "2006-05-18T10:03:15Z", "bug_id": 28228, "creation_time": "2006-05-18T10:03:15Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "bodewig@apache.org", "text": "*** Bug 8722 has been marked as a duplicate of this bug. ***", "count": 16, "id": 122473, "time": "2008-11-14T06:23:14Z", "bug_id": 28228, "creation_time": "2008-11-14T06:23:14Z", "is_private": false}, {"count": 17, "attachment_id": null, "creator": "mfrasca@zonnet.nl", "text": "I came across this request while trying to solve a problem I was having with the ftp task: the class implementing the task itself is loaded, but a library on which the task relies is not found.  I am executing a ant.jar (java -jar ant.jar) so I can't specify the classpath (I know I can invoke the Main class from that jar adding all jars I need to the classpath, but I like the compact invocation form).\n\nI tried the classloader thing described here (actually the version in SVN) but it does not do much about my issue, at least not until I add some code that would hack the global classpath, adding the jars there, not the ant classloader.\n\nwould it be an idea to add an option (maybe a reserved name?) to have this task alter the global classpath?\n\na working way to alter the classpath (it's what I've been successfully using) is described here: http://forums.sun.com/thread.jspa?threadID=300557&start=49", "id": 130935, "time": "2009-10-07T04:31:45Z", "bug_id": 28228, "creation_time": "2009-10-07T04:31:45Z", "tags": [], "is_private": false}, {"count": 18, "tags": [], "bug_id": 28228, "text": "I've tried to integrate this patch with current master, the result is here: https://github.com/gagern/ant/compare/28228-classloader\n\nI've noticed this while working on bug #47003. I must say, however, that this is a rather big change in this patch here. So far I haven't gotten it to compile yet. And I don't fully understand it either.\n\n(In reply to Mario Frasca from comment #17)\n> a working way to alter the classpath (it's what I've been successfully\n> using) is described here:\n> http://forums.sun.com/thread.jspa?threadID=300557&start=49\n\nUnfortunately that page is not available any more.", "id": 179357, "time": "2014-11-29T01:20:24Z", "creator": "Martin.vGagern@gmx.net", "creation_time": "2014-11-29T01:20:24Z", "is_private": false, "attachment_id": null}]
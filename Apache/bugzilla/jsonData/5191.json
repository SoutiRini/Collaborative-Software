[{"count": 0, "tags": [], "creator": "asudell@acm.org", "text": "When the inner loop in org.apache.jasper.compiler.JspReader detects a partial \nmatch and continues the outter loop, it doesn't reset the file position.  If \nthe trailing characters of the partial match are actually the leading characters \nof a full match, the full match will be missed.\n\nHere's an example.  If a JSP author accidentially types a closing comment with \nan extra dash (<%-- blah ....  ---%>), when Parser$Comment searches for the end \ncomment, the failed partial match aginst \"---\" leaves the mark beyond the second \ndash, and the close comment is missed, resulting in a ParseException.\n\nI'll admit that's pretty obscure.  And it's not 100% clear from the JSP spec \nthat a leading space is not required for the close comment.  But it dosen't hurt \nto be kind to the JSP author.\n\nI did my testing aginst the head of the tomcat_32 branch.  But the same code \nexists in 3.3 as well as 4.0.\n\nThe exception thrown in the above example is \norg.apache.jasper.compiler.ParseException: Unterminated <%-- tag\n        at org.apache.jasper.compiler.Parser$Comment.accept(Parser.java:412)\n        at org.apache.jasper.compiler.Parser.parse(Parser.java:1077)\n        at org.apache.jasper.compiler.Parser.parse(Parser.java:1042)\n        at org.apache.jasper.compiler.Parser.parse(Parser.java:1038)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:209)\n        at org.apache.jasper.servlet.JspServlet.doLoadJSP(JspServlet.java:612)\n        at \norg.apache.jasper.servlet.JasperLoader12.loadJSP(JasperLoader12.java:146)\n        at org.apache.jasper.servlet.JspServlet.loadJSP(JspServlet.java:542)\n        at \norg.apache.jasper.servlet.JspServlet$JspServletWrapper.loadIfNecessary(JspServle\nt.java:258)\n        at \norg.apache.jasper.servlet.JspServlet$JspServletWrapper.service(JspServlet.java:2\n68)\n        at \norg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:429)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:500)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at \norg.apache.tomcat.core.ServletWrapper.doService(ServletWrapper.java:405)\n        at org.apache.tomcat.core.Handler.service(Handler.java:287)\n        at \norg.apache.tomcat.core.ServletWrapper.service(ServletWrapper.java:372)\n        at \norg.apache.tomcat.core.ContextManager.internalService(ContextManager.java:806)\n        at \norg.apache.tomcat.core.ContextManager.service(ContextManager.java:752)\n        at \norg.apache.tomcat.service.http.HttpConnectionHandler.processConnection(HttpConne\nctionHandler.java:213)\n        at \norg.apache.tomcat.service.TcpWorkerThread.runIt(PoolTcpEndpoint.java:416)\n        at \norg.apache.tomcat.util.ThreadPool$ControlRunnable.run(ThreadPool.java:501)\n        at java.lang.Thread.run(Thread.java:479)\n\nThere's a simple patch that I'll attach that covers my example and failes to \nbreak any of the JSP tests in watchdog.", "id": 8449, "time": "2001-11-29T17:36:05Z", "bug_id": 5191, "creation_time": "2001-11-29T17:36:05Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "asudell@acm.org", "text": "Created attachment 852\nJSPReader.skipUtil() patch to reset the mark on partial matchs", "id": 8450, "time": "2001-11-29T17:38:14Z", "bug_id": 5191, "creation_time": "2001-11-29T17:38:14Z", "is_private": false, "attachment_id": 852}, {"attachment_id": null, "tags": [], "bug_id": 5191, "is_private": false, "count": 2, "id": 9779, "time": "2002-01-22T04:26:06Z", "creator": "william.barker@wilshire.com", "creation_time": "2002-01-22T04:26:06Z", "text": "This has now been applied to the CVS HEAD, and will shortly appear in 3.3.1-B1.\n\nThanks for the contribution!"}]
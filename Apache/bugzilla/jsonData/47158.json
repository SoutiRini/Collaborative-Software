[{"count": 0, "tags": [], "text": "\"Double-Checked Locking\" pattern is heavily used in this class, but the usage of it in AccessLogValve has some issues of race condition judging by this article: http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html\n\nBased by this article, I think these variables in this class should be declared as volatile to get rid of race condition: \n\nprivate volatile long currentMillis;\n\nprivate volatile  Date currentDate;", "is_private": false, "id": 126803, "creator": "xxd82329@gmail.com", "time": "2009-05-05T15:12:45Z", "bug_id": 47158, "creation_time": "2009-05-05T15:12:45Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 47158, "is_private": false, "text": "I agree with your analysis for currentMIllis.\n\nI disagree with your analysis for currentDate. I think we can remove all the places this is updated except getDate() and still have the same functionality.\n\nI also think dateStamp needs to be volatile.\n\nPatch for the above has been committed to trunk and proposed for 6.0.x.", "id": 127654, "time": "2009-06-04T08:39:30Z", "creator": "markt@apache.org", "creation_time": "2009-06-04T08:39:30Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 47158, "text": "The patch has been applied to 6.0.x and will be in 6.0.21 onwards.\n\nFilip noted in his review comments that there is also a thread safety issue around log file rotation. This still needs to be fixed.", "count": 2, "id": 127923, "time": "2009-06-12T15:38:41Z", "creator": "markt@apache.org", "creation_time": "2009-06-12T15:38:41Z", "is_private": false}, {"count": 3, "tags": [], "text": "The remaining threading issues have been fixed and will also be in 6.0.21", "is_private": false, "id": 131594, "creator": "markt@apache.org", "time": "2009-11-02T13:58:48Z", "bug_id": 47158, "creation_time": "2009-11-02T13:58:48Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 45154, "text": "Created attachment 22092\nPatch for Tomcat 6.0.16\n\nWe upgraded to Tomcat 6.0 to take advantage of NIO.\nWe have a couple servlets which use SSL for secure download\nof very large files and needed it to scale.\n\nDisappointed that the sendfile functionality didn't work\nwith NIO when using SSL, I dug in until I got something to\nwork.\n\nI'm attaching a patch.\n\nThe part that I'm least comfortable was the change to SecureNioChannel\nbecause I didn't know why the check was there to begin with.", "id": 117450, "time": "2008-06-06T16:16:23Z", "creator": "mmcclain@uplogix.com", "creation_time": "2008-06-06T16:16:23Z", "is_private": false, "attachment_id": 22092}, {"count": 1, "tags": [], "creator": "fhanik@apache.org", "text": "\nHi Mr McClain,\nthe benefit of sendfile is that you can transfer data from one channel to another without reading the data into the java heap.\nthis is not possible with SSL, since you have to do the encryption in memory, so the effort is wasted, and doing it this way, you will be wasting poller CPU cycles on SSL encryption, potentially slowing down the system's reaction time to IO events.\n\nso the transferTo is supposed to read from the one buffer to another without reading data into memory (the java heap), this effort doesn't work with NIO ssl.\n\nwhat would have to be done here, is that we moved the send file to a separate thread, but it still wouldn't be a true send file.\n\nFilip", "id": 120003, "time": "2008-08-21T16:15:10Z", "bug_id": 45154, "creation_time": "2008-08-21T16:15:10Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "mmcclain@uplogix.com", "text": "I understand what you're saying about doing too much\nin the poller thread.\n\nI was trying to accomplish handling hundreds of clients\nthat could simultaneously download a 200 MB file without\ntying up a separate thread per client on blocking I/O.\n\nAnd I hoped the NIO mechanism would additionally use\nless RAM.\n\nUnfortunately, from the servlet layer we only have\naccess to an OutputStream.", "id": 120005, "time": "2008-08-21T18:05:15Z", "bug_id": 45154, "creation_time": "2008-08-21T18:05:15Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "creator": "markt@apache.org", "is_private": false, "id": 122317, "time": "2008-11-08T18:01:01Z", "bug_id": 45154, "creation_time": "2008-11-08T18:01:01Z", "tags": [], "text": "Changing this to an enhancement since there isn't anything broken here. Patches along the lines of Filip's suggestion welcome."}, {"count": 4, "tags": [], "creator": "fhanik@apache.org", "text": "Proposal for inclusion and performance improvement is added here\n  http://svn.apache.org/viewvc?rev=720724&view=rev\n  http://svn.apache.org/viewvc?rev=720728&view=rev \nThe important thing is to never call a blocking method within the poller\n\nProposal for inclusion in 6.0.x branch has been created.", "id": 122881, "time": "2008-11-26T12:35:27Z", "bug_id": 45154, "creation_time": "2008-11-26T12:35:27Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "fhanik@apache.org", "is_private": false, "id": 124058, "time": "2009-01-14T16:21:16Z", "bug_id": 45154, "creation_time": "2009-01-14T16:21:16Z", "tags": [], "text": "This has been fixed in 6.0.x and will be included in 6.0.19 onwards."}]
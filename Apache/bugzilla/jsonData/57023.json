[{"count": 0, "tags": [], "creator": "jeromep3000@gmail.com", "is_private": false, "id": 178131, "attachment_id": null, "bug_id": 57023, "creation_time": "2014-09-26T16:54:56Z", "time": "2014-09-26T16:54:56Z", "text": "Hello,\n\nI'm trying to use mod_socache_shmcb but it generates error when adding file bigger than 11k.\n\n[Fri Sep 26 18:38:57.777274 2014] [cache:debug] [pid 2998] mod_cache.c(210): [client 10.11.12.20:57770] AH00750: Adding CACHE_SAVE filter for /logo_ig.png, referer: http://10.11.12.13/\n[Fri Sep 26 18:38:57.777315 2014] [cache:debug] [pid 2998] mod_cache.c(220): [client 10.11.12.20:57770] AH00751: Adding CACHE_REMOVE_URL filter for /logo_ig.png, referer: http://10.11.12.13/\n[Fri Sep 26 18:38:57.777764 2014] [cache:debug] [pid 2998] cache_storage.c(664): [client 10.11.12.20:57770] AH00698: cache: Key for entity /logo_ig.png?(null) is http://jpa.com:80/logo_ig.png?, referer: http://10.11.12.13/\n[Fri Sep 26 18:38:57.777782 2014] [cache:debug] [pid 2998] mod_cache.c(1330): [client 10.11.12.20:57770] AH00769: cache: Caching url: /logo_ig.png, referer: http://10.11.12.13/\n[Fri Sep 26 18:38:57.777786 2014] [cache:debug] [pid 2998] mod_cache.c(1336): [client 10.11.12.20:57770] AH00770: cache: Removing CACHE_REMOVE_URL filter., referer: http://10.11.12.13/\n[Fri Sep 26 18:38:57.795933 2014] [socache_shmcb:debug] [pid 2998] mod_socache_shmcb.c(490): AH00831: socache_shmcb_store (0x68 -> subcache 8)\n[Fri Sep 26 18:38:57.796175 2014] [socache_shmcb:error] [pid 2998] AH00844: inserting socache entry larger (12379) than subcache data area (12280)\n[Fri Sep 26 18:38:57.796210 2014] [socache_shmcb:error] [pid 2998] AH00833: can't store an socache entry!\n[Fri Sep 26 18:38:57.796243 2014] [cache_socache:warn] [pid 2998] (28)No space left on device: [client 10.11.12.20:57770] AH02386: could not write to cache, ignoring: http://jpa.com:80/logo_ig_fr.png?, referer: http://10.11.12.13/\n[Fri Sep 26 18:38:57.796326 2014] [socache_shmcb:debug] [pid 2998] mod_socache_shmcb.c(552): AH00837: socache_shmcb_remove (0x68 -> subcache 8)\n[Fri Sep 26 18:38:57.796368 2014] [socache_shmcb:debug] [pid 2998] mod_socache_shmcb.c(566): AH00839: leaving socache_shmcb_remove successfully\n\nThe message \"(28)No space left on device\" is strange because I have plenty of space left.\n\nConfig is as follow:\n\n<IfModule mod_cache.c>\n        CacheMaxExpire 86400\n        <IfModule mod_cache_socache.c>\n                CacheSocache shmcb\n                CacheSocacheMaxSize 1000000\n                CacheEnable socache /\n        </IfModule>\n</IfModule>\n\n\nAnother strange thing, there is no \"Shared Memory Segments\" used when with 'ipcs -a' (even as root), so impossible to know where shmcb stores the cache."}, {"count": 1, "tags": [], "bug_id": 57023, "is_private": false, "text": "Try to set CacheSocache like this:\n\nCacheSocache shmcb:/path/to/datafile(2048000) \n\nThe number in braces in size of the cache in bytes.\n\nNote that according to documentation, you should also be able to cache the files which are too big for shared memory cache into disk cache:\n\nhttpd.apache.org/docs/2.4/en/mod/mod_cache_socache.html", "id": 178225, "time": "2014-10-02T11:42:05Z", "creator": "jkaluza@redhat.com", "creation_time": "2014-10-02T11:42:05Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 57023, "is_private": false, "text": "Ok thank you.\n\nDo you know how 'subcache_data_size' is calculated ?\n\nAnd do you know if each subcache can contain more than one entity ?", "id": 178238, "time": "2014-10-02T15:59:24Z", "creator": "jeromep3000@gmail.com", "creation_time": "2014-10-02T15:59:24Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 57023, "is_private": false, "text": "I've tried the fall back configuration below :\n\n\n        CacheMaxExpire 86400\n\n        CacheRoot /var/tests/kache/apache_2.4/cache/\n\n        CacheSocache shmcb\n        CacheSocacheMaxSize 1000000\n\n        CacheQuickHandler off\n\n        CacheDirLevels 3\n        CacheDirLength 1\n        CacheMinFileSize 1\n\n        <Location />\n                CacheEnable socache\n                CacheEnable disk\n        </Location>\n\n\nBut when I have this message : AH00844: inserting socache entry larger (13945) than subcache data area (12280) , I supposed that the cache on disk will be used but it isn't.\n\n\n\n[Fri Oct 03 12:43:22.670949 2014] [authz_core:debug] [pid 5048] mod_authz_core.c(828): [client 10.151.27.181:21064] AH01628: authorization result: granted (no directives), referer: http://jpa.com/env.html\n[Fri Oct 03 12:43:22.671010 2014] [cache:debug] [pid 5048] mod_cache.c(502): [client 10.151.27.181:21064] AH00757: Adding CACHE_SAVE filter for /style/css/manual-print.css, referer: http://jpa.com/env.html\n[Fri Oct 03 12:43:22.671026 2014] [cache:debug] [pid 5048] mod_cache.c(536): [client 10.151.27.181:21064] AH00759: Adding CACHE_REMOVE_URL filter for /style/css/manual-print.css, referer: http://jpa.com/env.html\n[Fri Oct 03 12:43:22.671129 2014] [cache:debug] [pid 5048] cache_storage.c(664): [client 10.151.27.181:21064] AH00698: cache: Key for entity /style/css/manual-print.css?(null) is http://jpa.com:80/style/css/manual-print.css?, referer: http://jpa.com/env.html\n[Fri Oct 03 12:43:22.671156 2014] [cache:debug] [pid 5048] mod_cache.c(1330): [client 10.151.27.181:21064] AH00769: cache: Caching url: /style/css/manual-print.css, referer: http://jpa.com/env.html\n[Fri Oct 03 12:43:22.671164 2014] [cache:debug] [pid 5048] mod_cache.c(1336): [client 10.151.27.181:21064] AH00770: cache: Removing CACHE_REMOVE_URL filter., referer: http://jpa.com/env.html\n[Fri Oct 03 12:43:22.671544 2014] [socache_shmcb:debug] [pid 5048] mod_socache_shmcb.c(490): AH00831: socache_shmcb_store (0x68 -> subcache 8)\n[Fri Oct 03 12:43:22.671558 2014] [socache_shmcb:error] [pid 5048] AH00844: inserting socache entry larger (13945) than subcache data area (12280)\n[Fri Oct 03 12:43:22.671564 2014] [socache_shmcb:error] [pid 5048] AH00833: can't store an socache entry!\n[Fri Oct 03 12:43:22.671573 2014] [cache_socache:warn] [pid 5048] (28)No space left on device: [client 10.151.27.181:21064] AH02386: could not write to cache, ignoring: http://jpa.com:80/style/css/manual-print.css?, referer: http://jpa.com/env.html\n[Fri Oct 03 12:43:22.671620 2014] [socache_shmcb:debug] [pid 5048] mod_socache_shmcb.c(552): AH00837: socache_shmcb_remove (0x68 -> subcache 8)\n[Fri Oct 03 12:43:22.671628 2014] [socache_shmcb:debug] [pid 5048] mod_socache_shmcb.c(566): AH00839: leaving socache_shmcb_remove successfully\n\n\n\nAnd when I use \"CacheEnable disk\" alone, the cache on disk works :\n\n\n[Fri Oct 03 12:57:24.958615 2014] [cache_disk:debug] [pid 5113] mod_cache_disk.c(1350): [client 10.151.27.181:21211] AH00737: commit_entity: Headers and body for URL http://jpa.com:80/style/css/manual-print.css? cached., referer: http://jpa.com/env.html\n\n\n\nAm I doing it wrong or is the fall back configuration not possible ?", "id": 178261, "time": "2014-10-03T11:04:59Z", "creator": "jeromep3000@gmail.com", "creation_time": "2014-10-03T11:04:59Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "christophe.jaillet@wanadoo.fr", "is_private": false, "id": 178274, "attachment_id": null, "bug_id": 57023, "creation_time": "2014-10-03T18:38:40Z", "time": "2014-10-03T18:38:40Z", "text": "(In reply to John Jerome from comment #2)\n> Ok thank you.\n> \n> Do you know how 'subcache_data_size' is calculated ?\n> \n\nSee http://svn.apache.org/viewvc/httpd/httpd/trunk/modules/cache/mod_socache_shmcb.c?revision=1595426&view=markup#l338\n\nYou can also set loglevel to debug in order to get information logged (see link above at line 444)"}, {"count": 5, "tags": [], "bug_id": 57023, "text": "Hi,\n\ncould you try http://svn.apache.org/r1629508\nThis increase the average size of \"small object\".\n\nWith this patch, subcache_data_size goes from 12280 to 64768.", "id": 178294, "time": "2014-10-05T20:15:53Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2014-10-05T20:15:53Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 57023, "is_private": false, "text": "(In reply to Christophe JAILLET from comment #5)\n> Hi,\n> \n> could you try http://svn.apache.org/r1629508\n> This increase the average size of \"small object\".\n> \n> With this patch, subcache_data_size goes from 12280 to 64768.\n\nThank you for your help Christophe, but unfortunately I won't be able to test the patch right now (maybe in a few weeks).\n\nI managed to increase the subcache_data_size with the info given by Jan : CacheSocache shmcb:/path/to/datafile(2048000) \n\n\nMy problem now is with the fall back configuration because it seems that the CacheEnable directive is exclusive.", "id": 178302, "time": "2014-10-06T09:46:51Z", "creator": "jeromep3000@gmail.com", "creation_time": "2014-10-06T09:46:51Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 57023, "is_private": false, "text": "Using:\nCacheSocache shmcb:/path/to/datafile(10485760)\nI got a subcache_data_size of 61424 I needed.\n\n\nHaving \"disk\" enabled for / and \"socache\" for /*.svg I can see this kind of things for a file of 600 kB\n```\nmod_cache_socache.c(394): AH02347: URL 'http://localhost/webfont.svg?' body larger than limit, ignoring (143732 > 102400)\nmod_cache.c(1332): AH00769: cache: Caching url: /webfont.svg\nmod_cache.c(1338): AH00770: cache: Removing CACHE_REMOVE_URL filter.\nmod_cache.c(1731): AH00777: cache: CACHE filter was added twice, or was added where the cache has been bypassed and will be ignored: /webfont.svg\nmod_cache_disk.c(1350): AH00737: commit_entity: Headers and body for URL http://localhost/webfont.svg? cached.\n```\n\nI don't know if my configuration really requested to \"cache twice\", but the end result is what I'd expect: cache_disk relaying cache_socache\n\nThis 102400 seems hardcoded somewhere.\n\n**but**\ntrying to access a 75 kB file (greater than subcache_data_size but lower than 102400), I get:\n\n```\ncache_storage.c(664): AH00698: cache: Key for entity /style.css?(null) is http://localhost/style.css?\nmod_socache_shmcb.c(527): AH00835: socache_shmcb_retrieve (0x68 -> subcache 104)\nmod_socache_shmcb.c(883): AH00851: shmcb_subcache_retrieve found no match\nmod_socache_shmcb.c(537): AH00836: leaving socache_shmcb_retrieve successfully\nmod_cache_socache.c(494): (70015)Could not find specified socket in poll list.: AH02352: Key not found in cache: http://localhost/style.css?\nmod_cache.c(502): AH00757: Adding CACHE_SAVE filter for /style.css\nmod_cache.c(525): AH00758: Replacing CACHE with CACHE_SAVE filter for /style.css\nmod_cache.c(536): AH00759: Adding CACHE_REMOVE_URL filter for /style.css\nmod_cache.c(1332): AH00769: cache: Caching url: /style.css\nmod_cache.c(1338): AH00770: cache: Removing CACHE_REMOVE_URL filter.\nmod_cache.c(1731): AH00777: cache: CACHE filter was added twice, or was added where the cache has been bypassed and will be ignored: /style.css\nmod_socache_shmcb.c(490): AH00831: socache_shmcb_store (0x68 -> subcache 104)\nAH00844: inserting socache entry larger (76169) than subcache data area (61424)\nAH00833: can't store an socache entry!\n(28)No space left on device: AH02386: could not write to cache, ignoring: http://localhost/style.css?\nmod_socache_shmcb.c(552): AH00837: socache_shmcb_remove (0x68 -> subcache 104)\nmod_socache_shmcb.c(566): AH00839: leaving socache_shmcb_remove successfully\n```\n\ncache_disk does *NOT* relay the socache (Apache 2.4.10)\n(Although I understand it's not the main issue of this bug report)", "id": 185717, "time": "2015-10-11T01:04:26Z", "creator": "raphael.droz@gmail.com", "creation_time": "2015-10-11T01:04:26Z", "attachment_id": null}]
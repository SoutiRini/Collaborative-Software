[{"count": 0, "attachment_id": null, "creator": "alf@i100.no", "is_private": false, "id": 101855, "time": "2007-04-18T03:58:15Z", "bug_id": 42156, "creation_time": "2007-04-18T03:58:15Z", "tags": [], "text": "In the HTTP Request GUI, there is a checkbox for each parameter value, \"Encode?\".\nEven if this is unchecked, the HTTP Request using HTTP Client urlencodes the\nvalue when doing a HTTP POST request, which is incorrect.\n\nThe reason is that the HTTPClient PostMethod class addParameter method, which is\ncalled in HTTPSampler2.java, assumes that the value is not alread URL encoded.\nSo the HTTPClient PostMethod always urlencodes the parameter names and values\nbefore they are sent.\n\nSo if you have a parameter named test, with value \"%2Ftest%3D\", and do a POST\nrequest, the POST body will contain \"%252Ftest%253D\", because the already\nurlencoded value is urlencoded once more.\n\nIf you are using a HTTP Request (i.e the HTTPSampler.java), you will see that\n\"%2Ftest%3D\" is sent, because the getQueryString of HTTPSamplerBase takes into\nconsideration the value of httpargument.isAlwaysEncoded()."}, {"count": 1, "tags": [], "bug_id": 42156, "attachment_id": 19986, "text": "Created attachment 19986\nSuggested patch\n\nThis patch urldecodes parameter value if the httpargument.isAlwaysEncode is\nfalse, so that when it is added to the httpclient postmethod, where it is\nurlencoded, the value will be correct.\n\nThere is also an commented out section, which uses the\nHTTPSamplerBase.getQueryString to construct the post body. If this alternative\nis used, then HTTPSampler and HTTPSampler2 will always send the same POST body.\n\nI do not know which alternative you prefer.\n\nThe patch also contains more unit tests for\nTestHTTPSamplersAgainstHttpMirrorServer, it contains the new tests suggested in\npatch for bug 42139, plus some more, to expose this bug.\nSo if this patch for this bug is applied, then bug 42139 should just be closed.\n\nIf only the unit tests are applied, then you will see that one test will fail\nfor HTTPSampler2, the one with \ntitleValue =\n\"%2FwEPDwULLTE2MzM2OTA0NTYPZBYCAgMPZ%2FrA%2B8DZ2dnZ2dnZ2d%2FGNDar6OshPwdJc%3D\";", "id": 101856, "time": "2007-04-18T04:09:30Z", "creator": "alf@i100.no", "creation_time": "2007-04-18T04:09:30Z", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 19987\nUpdated suggested patch\n\nI just had to remove to System.out.println lines, which accidential made it\ninto my first suggested patch.", "is_private": false, "bug_id": 42156, "id": 101857, "time": "2007-04-18T04:12:59Z", "creator": "alf@i100.no", "creation_time": "2007-04-18T04:12:59Z", "attachment_id": 19987}, {"count": 3, "tags": [], "bug_id": 42156, "attachment_id": null, "text": "Thanks! Applied to SVN r530147 - I ignored the \nTestHTTPSamplersAgainstHttpMirrorServer part as I'd already applied bug 42139.", "id": 101895, "time": "2007-04-18T13:37:33Z", "creator": "sebb@apache.org", "creation_time": "2007-04-18T13:37:33Z", "is_private": false}]
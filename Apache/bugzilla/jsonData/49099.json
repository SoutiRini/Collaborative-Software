[{"count": 0, "tags": [], "bug_id": 49099, "attachment_id": null, "is_private": false, "id": 136063, "time": "2010-04-12T15:48:23Z", "creator": "igor@fedulov.com", "creation_time": "2010-04-12T15:48:23Z", "text": "Simple test:\n1. Download latest tomcat 6.0.26\n2. Utar it and start it up\n3. Head over to http://localhost:8080/ to verify that it's working\n4. Now change the URL to something like http://localhost:8080/%foo and you get error 400 as expected but nothing is logged in access log:\n\nhttp://localhost:8080/%foo\n\n\n\nGET /%foo HTTP/1.1\n\nHost: localhost:8080\n\nUser-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.9) Gecko/20100401 Ubuntu/9.10 (karmic) Firefox/3.5.9\n\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n\nAccept-Language: en-us,en;q=0.5\n\nAccept-Encoding: gzip,deflate\n\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\n\nKeep-Alive: 300\n\nConnection: keep-alive\n\n\n\nHTTP/1.1 400 Bad Request\n\nServer: Apache-Coyote/1.1\n\nContent-Length: 0\n\nDate: Mon, 12 Apr 2010 19:44:57 GMT\n\nConnection: close\n\n\n5. Now change the URL to legitimate, i.e.: http://localhost:8080/%29 and you get 404 as expected and it's also logged in access log as expected.\n\nhttp://localhost:8080/%29\n\n\n\nGET /%29 HTTP/1.1\n\nHost: localhost:8080\n\nUser-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.9) Gecko/20100401 Ubuntu/9.10 (karmic) Firefox/3.5.9\n\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\n\nAccept-Language: en-us,en;q=0.5\n\nAccept-Encoding: gzip,deflate\n\nAccept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7\n\nKeep-Alive: 300\n\nConnection: keep-alive\n\n\n\nHTTP/1.1 404 Not Found\n\nServer: Apache-Coyote/1.1\n\nContent-Type: text/html;charset=utf-8\n\nContent-Length: 964\n\nDate: Mon, 12 Apr 2010 19:43:45 GMT\n\n\nSo for admin of the server there is no way to see if there is a DDoS attack going on on the box because there is nothing written to the log files, nothing at all."}, {"count": 1, "attachment_id": null, "bug_id": 49099, "text": "This is working as designed. Bad urls are rejected before they reach the access log valve.", "id": 136065, "time": "2010-04-12T15:56:39Z", "creator": "markt@apache.org", "creation_time": "2010-04-12T15:56:39Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "text": "So what are the solutions from preventing DDoS attack if server doesn't log malformed request attempts, not even the originating IP? You don't consider this as a problem?", "attachment_id": null, "bug_id": 49099, "id": 136068, "time": "2010-04-12T16:27:51Z", "creator": "igor@fedulov.com", "creation_time": "2010-04-12T16:27:51Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "text": "There is currently no way within Tomcat to log the malformed requests. There are a couple of options for addressing this. The ideal would include adding entries to the access log, if any, but that is going to be more complex than the simple solution of using Tomcat's standard logging. I'll kick off a discussion on the dev list about how this might be done.", "count": 3, "id": 136443, "time": "2010-04-27T08:53:26Z", "bug_id": 49099, "creation_time": "2010-04-27T08:53:26Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 49099, "text": "I have applied a fix for trunk (7.0.x) which will be included in 7.0.0 onwards and proposed the same fix for 6.0.x\n\nThere wasn't complete agreement on the dev list on the right way to go for this so there may be some tweaks before we reach a final solution.", "id": 137272, "time": "2010-06-02T11:15:29Z", "creator": "markt@apache.org", "creation_time": "2010-06-02T11:15:29Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "bug_id": 49099, "is_private": false, "id": 137277, "time": "2010-06-02T11:23:44Z", "creator": "igor@fedulov.com", "creation_time": "2010-06-02T11:23:44Z", "tags": [], "text": "Excellent, thank you Mark!"}, {"count": 6, "attachment_id": null, "bug_id": 49099, "is_private": false, "id": 141343, "time": "2010-11-02T14:13:11Z", "creator": "markt@apache.org", "creation_time": "2010-11-02T14:13:11Z", "tags": [], "text": "This has been fixed in 6.0.x and will be included in 6.0.30 onwards."}]
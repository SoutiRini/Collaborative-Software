[{"count": 0, "tags": [], "bug_id": 51982, "attachment_id": null, "id": 150269, "time": "2011-10-06T19:56:21Z", "creator": "lmeyer@vmware.com", "creation_time": "2011-10-06T19:56:21Z", "is_private": false, "text": "This report appears similar to some others, like 39203 and particularly 51489. But I believe the following configuration demonstrates a specific problem simply and is in fact a bug - feel free to prove me wrong:\n\n<Proxy balancer://cluster >\nBalancerMember http://localhost:8080\n</Proxy>\n\nProxyPass / balancer://cluster/\n# option 1\nProxyPassReverse / http://localhost:8080/\n# option 2\nProxyPassReverse / balancer://cluster/\n\nOption 1 and 2 should both correctly rewrite Location: headers from the backend. Option 1 does, but option 2 adds an extra / - so if the request was http://www.example.com/foo and the backend returns a Location: http://localhost:8080/foo/ then the rewritten result will be http://www.example.com//foo/ (with two slashes). Aside from looking/being incorrect, any cookies with path /foo (as is common with backend applications) won't match this path and thus the browser won't send them after the redirect.\n\nSome things to note:\n1. The behavior is no different with:\nProxyPassReverse / balancer://cluster\n(i.e. without the trailing /)\n\n2. This works fine if you do the following instead:\nProxyPass /foo balancer://cluster/foo\nProxyPassReverse /foo balancer://cluster\n... however, the goal here is to proxy / (perhaps with exceptions) so there is no way to eliminate the trailing slashes.\n\n3. You can try other combinations of adding/removing trailing slashes to your heart's content - I have not found one that both proxies to the correct backend location (without adding/removing a slash) and rewrites Location correctly. The only workaround is to ProxyPassReverse each of the individual BalancerMembers, which is what the balancer:// construct is intended to avoid."}, {"count": 1, "tags": [], "creator": "sven.peters@aapt.com.au", "attachment_id": null, "id": 151503, "time": "2011-11-15T02:24:18Z", "bug_id": 51982, "creation_time": "2011-11-15T02:24:18Z", "is_private": false, "text": "I ran into this problem too and didn't find a workaround yet.\nMy config\n\n# Works perfect\n\nProxyPass / http://localhost:9381/\nProxyPassReverse / http://localhost:9381/\n\n# Doesn't work when receiving Redirects / Location from the backend. An extra leading '/' is added.\n#\n# ProxyPass / balancer://balancer/\n# ProxyPassReverse / balancer://balancer/\n\n<Proxy balancer://balancer/>\n        BalancerMember http://localhost:9381/ retry=1\n        BalancerMember http://localhost:9382/ retry=1 status=D\n</Proxy>\n\nAny workaround is appreciated."}, {"count": 2, "tags": [], "bug_id": 51982, "attachment_id": null, "text": "This bug also exists in apache 2.2.12 and 2.2.22", "id": 158234, "time": "2012-04-20T21:39:00Z", "creator": "carlo.timmers@dsm.com", "creation_time": "2012-04-20T21:39:00Z", "is_private": false}, {"count": 3, "tags": [], "creator": "carlo.timmers@dsm.com", "text": "(In reply to comment #2)\n> This bug also exists in apache 2.2.12 and 2.2.22\n\nPatch available in https://issues.apache.org/bugzilla/show_bug.cgi?id=51489 solved the issue for me.", "id": 158235, "time": "2012-04-20T21:54:20Z", "bug_id": 51982, "creation_time": "2012-04-20T21:54:20Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 51982, "attachment_id": null, "text": "Does somebody have a patch for 2.2.22 for this?\n\nThe above patch seems to be for an older version and the logic seemed to have changed (I only checked .21 and .22).", "id": 158694, "time": "2012-05-01T06:00:58Z", "creator": "sven.peters@aapt.com.au", "creation_time": "2012-05-01T06:00:58Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 51982, "text": "The workaround to this problem is to put multiple ProxyPassReverse directives, one for each balancer member\n\nProxyPass / balancer://balancer/\nProxyPassReverse / http://localhost:9381/\nProxyPassReverse / http://localhost:9382/\n\nDoes anybody know if this is fixed in a later version of Httpd?  If so which versions?", "id": 166404, "attachment_id": null, "creator": "asindwani@hotmail.com", "creation_time": "2013-04-05T02:54:42Z", "time": "2013-04-05T02:54:42Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 51982, "attachment_id": 30179, "id": 166531, "time": "2013-04-11T16:31:12Z", "creator": "wrowe@apache.org", "creation_time": "2013-04-11T16:31:12Z", "is_private": false, "text": "Created attachment 30179\nhttpd-2.2 backport of proxy doubleslash fixes r1386576, r1386578\n\nFolks, please test the attached backport before I submit it to STATUS."}, {"count": 7, "tags": [], "text": "William, your changes for the httpd-2.2 proxy double slash tested successfully. Thanks.", "attachment_id": null, "bug_id": 51982, "id": 166539, "time": "2013-04-11T20:47:37Z", "creator": "samsonb2003@yahoo.com", "creation_time": "2013-04-11T20:47:37Z", "is_private": false}, {"count": 8, "tags": [], "creator": "wrowe@apache.org", "text": "Added to 2.2 STATUS for review.", "id": 166554, "time": "2013-04-12T19:36:11Z", "bug_id": 51982, "creation_time": "2013-04-12T19:36:11Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 51982, "attachment_id": null, "text": "This is now committed for inclusion in a future 2.2.25", "id": 166761, "time": "2013-04-22T15:56:41Z", "creator": "wrowe@apache.org", "creation_time": "2013-04-22T15:56:41Z", "is_private": false}, {"count": 10, "tags": [], "creator": "cweekly@gmail.com", "text": "I don't think the backport was applied successfully in 2.2.26. That is, I believe this issue remains unresolved in 2.2.26. (I ran into it on 2.2.22, and found identical behavior in 2.2.26.) I ended up migrating to 2.4(.9) where it is in fact resolved.\n\nI don't have time to recreate my 2.2.26 conf details here, but I can attest we saw this exact problem: extra slash introduced in Location header of redirect response from proxied apps, when proxying to a balancer (vs directly to a particular member -- which didn't meet our needs). \n\nSorry for not having more rigorous details to reprod, but for anyone reading this experiencing frustration, may I heartily recommend biting the bullet and upgrading to 2.4. In the end our conf is cleaner and more concise, and mod_proxy_balancer + mod_rewrite are working in perfect harmony to route requests to one of multiple load-balanced apps behind a given apache. \n\nI'm reopening this to draw attention to it, but sorry in advance for not having time to discuss it much further.", "id": 174103, "time": "2014-03-26T12:49:08Z", "bug_id": 51982, "creation_time": "2014-03-26T12:49:08Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "guoh0115@gmail.com", "attachment_id": null, "text": "When the application is deployed as \"unpackWAR=false\", sometimes I try to download a js file which is over than 2MB, ERR_CONTENT_LENGTH_MISMATCH will be thrown on the front end, I use Chrome.\n\nI checked accesslog and found the file's content length is less than it is when the exception thrown.\n\nHere's the stacktrace I found in the log file:\n\njava.io.IOException: Stream closed\n         at java.util.zip.InflaterInputStream.ensureOpen(InflaterInputStream.java:67)\n         at java.util.zip.InflaterInputStream.read(InflaterInputStream.java:142)\n         at org.apache.catalina.webresources.AbstractArchiveResource$JarInputStreamWrapper.read(AbstractArchiveResource.java:255)\n         at java.io.BufferedInputStream.read1(BufferedInputStream.java:273)\n         at java.io.BufferedInputStream.read(BufferedInputStream.java:334)\n         at java.io.FilterInputStream.read(FilterInputStream.java:107)\n         at org.apache.catalina.servlets.DefaultServlet.copyRange(DefaultServlet.java:2125)\n         at org.apache.catalina.servlets.DefaultServlet.copy(DefaultServlet.java:1971)\n         at org.apache.catalina.servlets.DefaultServlet.serveResource(DefaultServlet.java:968)\n        at org.apache.catalina.servlets.DefaultServlet.doGet(DefaultServlet.java:398)", "id": 195171, "time": "2016-11-24T02:58:46Z", "bug_id": 60410, "creation_time": "2016-11-24T02:58:46Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 60410, "text": "Hi,\n\nCan you test with the latest Tomcat 8 version (8.0.39)?\nCan you provide a simple example that reproduces the issue?\nDo you see this problem with other browsers?\n\n\nThanks,\nVioleta", "id": 195173, "time": "2016-11-24T08:20:00Z", "creator": "violetagg@apache.org", "creation_time": "2016-11-24T08:20:00Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 60410, "text": "I usually take about 5-10s to download the js file, and the more time it took, the easier the error occured.\n\nI cannot deploy on tomcat 8.0.39, here's the error log, do you have any idea?\n\norg.apache.catalina.startup.ContextConfig.processServletContainerInitializers Failed to detect ServletContainerInitializers for context with name [/imsp]\n java.io.FileNotFoundException: JAR entry !/META-INF/services/javax.servlet.ServletContainerInitializer not found in D:\\apache-tomcat-8.0.39\\temp\\jar_cache4125440539893731259.tmp\n\tat sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:140)\n\tat sun.net.www.protocol.jar.JarURLConnection.getInputStream(JarURLConnection.java:150)\n\tat java.net.URL.openStream(URL.java:1037)\n\tat org.apache.catalina.startup.WebappServiceLoader.parseConfigFile(WebappServiceLoader.java:162)\n\tat org.apache.catalina.startup.WebappServiceLoader.load(WebappServiceLoader.java:136)\n\tat org.apache.catalina.startup.ContextConfig.processServletContainerInitializers(ContextConfig.java:1631)\n\tat org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1140)\n\tat org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:783)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:307)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:95)\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)\n\tat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5213)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:753)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:729)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:717)\n\tat org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:940)\n\tat org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1816)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n\tat java.lang.Thread.run(Thread.java:744)", "id": 195195, "time": "2016-11-25T03:24:13Z", "creator": "guoh0115@gmail.com", "creation_time": "2016-11-25T03:24:13Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 60410, "attachment_id": null, "id": 195196, "time": "2016-11-25T03:28:33Z", "creator": "guoh0115@gmail.com", "creation_time": "2016-11-25T03:28:33Z", "is_private": false, "text": "I only changed unpackWARs to false in server.xml.\n\n <Host name=\"localhost\"  appBase=\"webapps\"\n            unpackWARs=\"false\" autoDeploy=\"true\">"}, {"count": 4, "tags": [], "bug_id": 60410, "attachment_id": null, "id": 195197, "time": "2016-11-25T04:00:56Z", "creator": "guoh0115@gmail.com", "creation_time": "2016-11-25T04:00:56Z", "is_private": false, "text": "I debuged, spring-web-4.2.5.RELEASE.jar is in our app. so tomcat cannot load /META-INF/services/javax.servlet.ServletContainerInitializer from the jar file when unpackWAR=false"}, {"count": 5, "tags": [], "bug_id": 60410, "text": "I've fixed the issue that prevents SCIs from being processed with 8.0.39. The fix will be in 8.0.40 onwards. You'll need to build 8.0.x from source (not as difficuly as you might think) to test it.\n\nI'm still looking for possible causes of the original problem.", "id": 195230, "time": "2016-11-26T09:50:41Z", "creator": "markt@apache.org", "creation_time": "2016-11-26T09:50:41Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "I've found the likely cause. If close is called multiple times on a JarInputStreamWrapper then it is possible that this error could occur. I should have a fix for this shortly.", "id": 195252, "time": "2016-11-27T18:40:10Z", "bug_id": 60410, "creation_time": "2016-11-27T18:40:10Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 60410, "text": "Fixed in:\n- trunk for 9.0.0.M14 onwards\n- 8.5.x for 8.5.9 onwards\n- 8.0.x for 8.0.40 onwards\n\n7.0.x and earlier was not affected.", "id": 195263, "time": "2016-11-28T11:16:16Z", "creator": "markt@apache.org", "creation_time": "2016-11-28T11:16:16Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 60410, "attachment_id": null, "id": 195328, "time": "2016-12-02T03:50:56Z", "creator": "guoh0115@gmail.com", "creation_time": "2016-12-02T03:50:56Z", "is_private": false, "text": "When will it be released?"}, {"count": 9, "tags": [], "bug_id": 60410, "attachment_id": null, "id": 196140, "time": "2017-01-18T11:09:34Z", "creator": "nahurso@gmail.com", "creation_time": "2017-01-18T11:09:34Z", "is_private": false, "text": "Is there any workaround if using Tomcat 8.0.39 and unpackWars=false?"}]
[{"count": 0, "tags": [], "creator": "knobi@knobisoft.de", "text": "When changing the activation state using \"Edit all members\", instead of logging the new state, the old state is logged. This is massively confusing.\n\nTo solve this problem, the code changing the state needs to be moved before the logging statement:\n\n--- common/jk_status.c-orig\t2014-06-24 16:54:51.000000000 +0200\n+++ common/jk_status.c\t2014-06-24 16:55:19.000000000 +0200\n@@ -3601,10 +3601,10 @@\n                     if (rv == JK_TRUE) {\n                         i = jk_lb_get_activation_code(arg);\n                         if (i != wr->activation && i >= 0 && i <= JK_LB_ACTIVATION_MAX) {\n+                            wr->activation = i;\n                             jk_log(l, JK_LOG_INFO,\n                                    \"Status worker '%s' setting 'activation' for sub worker '%s' of lb worker '%s' to '%s'\",\n                                    w->name, wr->name, name, jk_lb_get_activation(wr, l));\n-                            wr->activation = i;\n                             rc = 1;\n                             sync_needed = JK_TRUE;\n                         }\n\nWhile working on this, I found that logging both old and new state would be much more useful, like in:\n\n[Tue Jun 24 16:49:55.412 2014] [28769:140012450096896] [info] commit_all_members::jk_status.c (3607): Status worker 'jkmanager' setting 'activation' for sub worker 'censored' of lb worker 'secret' from 'ACT' to 'DIS'\n\nA patch for this format change is appended.", "id": 176015, "time": "2014-06-24T15:01:08Z", "bug_id": 56667, "creation_time": "2014-06-24T15:01:08Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 56667, "text": "Created attachment 31749\nmodify output of activation change logging", "id": 176016, "attachment_id": 31749, "creator": "knobi@knobisoft.de", "creation_time": "2014-06-24T15:15:50Z", "time": "2014-06-24T15:15:50Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 56667, "is_private": false, "count": 2, "id": 176339, "time": "2014-07-10T21:42:51Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2014-07-10T21:42:51Z", "text": "Thanks for the report. I fixed the wrong log message in r1609574, but also took the opportunity to add logging of old and new values to all 22 log statements in status worker that trigger on attribute changes.\n\nThose are the changes r1609566, r1609575 and r1609576.\n\nIt would be nice, if you could give it a try.\n\nRegards,\n\nRainer"}, {"count": 3, "tags": [], "creator": "knobi@knobisoft.de", "text": "Hi Rainer,\n\n thanks. Sorry for the stupid question: how can I check out the current source for mod_jk? Likely a FAQ, I know ...\n\nMartin", "id": 176638, "time": "2014-07-24T09:30:25Z", "bug_id": 56667, "creation_time": "2014-07-24T09:30:25Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "The sources are in subversion, so it would be\n\nsvn checkout http://svn.apache.org/repos/asf/tomcat/jk/trunk\n\nThe mod_jk sources are in the sub directory \"native\".\n\nNow since this is native code, autotools are needed to generate the configure script. You can either run the script buildconf.sh in the native directory if you have the tools installed.\n\nOr you can use\n\nhttp://people.apache.org/~rjung/mod_jk-dev/tomcat-connectors-1.2.41-dev-1613051-src.tar.gz\n\nwhich was created by myself a few minutes ago using the script tools/jkrelease.sh (tools is directly under trunk) and can be build just like a release - but it is a dev snapshot, not a release! Under http://people.apache.org/~rjung/mod_jk-dev/ you will also find checksum and signature files.\n\nRegards,\n\nRainer", "id": 176639, "time": "2014-07-24T09:49:56Z", "bug_id": 56667, "creation_time": "2014-07-24T09:49:56Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "knobi@knobisoft.de", "is_private": false, "text": "Hi Rainer,\n\n just found out myself. Should have asked earlier :-)\n\nSure, I am aware that this is a development snapshot. I will use it with utmost care.\n\nThanks\nMartin", "id": 176640, "time": "2014-07-24T09:56:12Z", "bug_id": 56667, "creation_time": "2014-07-24T09:56:12Z", "attachment_id": null}]
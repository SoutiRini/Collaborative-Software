[{"count": 0, "attachment_id": null, "bug_id": 49669, "text": "Overview\nThe class javax.security.auth.Policy has a static member contextClassLoader that can refer to the WebappClassLoader of an application. If that happens, the web application cannot be garbage collected after undeploy.\n\nSteps to reproduce\nCreate a web application that uses Axis 1 as SOAP server. Deploy the web application in Tomcat. Make a SOAP call to the webapplication. Undeploy the web application. Wait an hour.\nMake a memory dump using jmap, and inspect the memory using jhat.\n\nActual results\nThe WebappClassLoader for the web application is still present. Its \"reference chains from rootset\" shows a reference like this:\nSystem Class Reference :\n--> class javax.security.auth.Policy (84 bytes) (static field contextClassLoader:)\n--> org.apache.catalina.loader.WebappClassLoader@0xeb52ba60 (165 bytes) \n\nExpected results\nThere is no WebappClassLoader for this web application anymore.\n\nBuild date & platform\nDownloaded Core tar.gz from http://tomcat.apache.org/download-70.cgi", "id": 138738, "time": "2010-07-29T10:19:23Z", "creator": "ArjenCornelis.Knibbe@Getronics.com", "creation_time": "2010-07-29T10:19:23Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 49669, "text": "Thanks for the report. I have added protection for this to the JreMemoryLeakPreventionListener and it will be included in 7.0.3 onwards.", "id": 139392, "time": "2010-08-23T16:37:02Z", "creator": "markt@apache.org", "creation_time": "2010-08-23T16:37:02Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "Reviewing the fix, which is r988296 plus r988429, and whether this should be proposed for 6.0.x, I do not understand the following:\n\nThere are two Policy classes in JDK 1.6:\n(1) java.security.Policy\n(2) javax.security.auth.Policy (@deprecated as of JDK version 1.4 -- Replaced by java.security.Policy)\n\nThe contextClassLoader field is in (2), but the fix preloads (1) and not (2).\n\nSo,\n- how does this fix the issue?\n- why the issue was observed in the first place? Does Axis 1 make a call to the deprecated class?", "id": 140471, "time": "2010-10-04T20:29:30Z", "bug_id": 49669, "creation_time": "2010-10-04T20:29:30Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 49669, "attachment_id": null, "text": "Yep, bad import. Fixed in trunk and will be in 7.0.4 onwards.\n\nI also proposed a back-port of all the changes to this listener that haven't yet made it into tc6.", "id": 140475, "time": "2010-10-05T03:39:12Z", "creator": "markt@apache.org", "creation_time": "2010-10-05T03:39:12Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "ctolkmit@tng.de", "attachment_id": null, "id": 18155, "time": "2002-06-20T09:48:00Z", "bug_id": 10052, "creation_time": "2002-06-20T09:48:00Z", "is_private": false, "text": "Given the following setup:\n\n<VirtualHost somehost>\nServerName thisserver\nRewriteEngine On\nRewriteRule ^/gbuch$ http://someotherserver/guestbook/11/$gbuch/ [P]\nRewriteRule ^/gbuch/(.*) http://someotherserver/guestbook/11/$gbuch/$1 [P]\n</VirtualHost>\n\n<VirtualHost somehost>\nServerName someotherserver\nJkMount /guestbook/* tomcat \nJkMount /guestbook tomcat \n</VirtualHost>\n\n(whereas tomcat is a working mod_jk setup)\n\nWhen I do a \nlynx  -mime_header http://www.kaicity-festival.de/gbuch | head\n\nI get \n--- snip ---\nHTTP/1.1 200 \n\nDate: Thu, 20 Jun 2002 09:19:04 GMT\nServer: Apache/1.3.26 (Unix) mod_jk/1.1.0 mod_gzip/1.3.19.1a PHP/4.1.1 \nmod_perl/1.24_01 mod_ssl/2.8.9 OpenSSL/0.9.6\nContent-Type: text/html; charset=iso-8859-1\nX-Cache: MISS from thisserver\nConnection: close\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n<html>\n--- snap ---\n\nNote the empty line between 'HTTP/1.1 200' and 'Date: '\nThis obviously confuses serveral browsers.\n\nWhen I use the proxy/* files from the 1.3.19 version of httpd I get:\n\n--- snip ---\nHTTP/1.0 200 \nDate: Thu, 20 Jun 2002 09:32:16 GMT\nServer: Apache/1.3.26 (Unix) mod_jk/1.1.0 mod_gzip/1.3.19.1a PHP/4.1.1 \nmod_perl/1.24_01 mod_ssl/2.8.9 OpenSSL/0.9.6\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n<html>\n--- snap ---\n\nwhich of course works fine.\n\nSo I think there is some kind of bug in mod_proxy.\nI was not able to reproduce it by proxying to a page that was not mod_jk/Tomcat \n3.2.x generated.\n\nBest regards,\nCarsten"}, {"count": 1, "tags": [], "bug_id": 10052, "attachment_id": null, "text": "I think the problem is that the trailing CRLF is not handled in ap_proxy_read_response_line in  proxy_util.c. Here is a patch that works fine for me:    --- proxy_util.c.orig   Tue Jun 25 16:00:48 2002  +++ proxy_util.c        Tue Jun 25 16:01:48 2002  @@ -1572,6 +1572,7 @@ int ap_proxy_table_replace(table *base,   int ap_proxy_read_response_line(BUFF *f, request_rec *r, char *buffer, int size, int *backasswards,  int *major, int *minor) {         long len;  +    char *value, *end;         len = ap_getline(buffer, size-1, f, 0);       if (len == -1) {  @@ -1610,6 +1611,11 @@ int ap_proxy_read_response_line(BUFF *f,           buffer[12] = '\\0';           r->status = atoi(&buffer[9]);           buffer[12] = ' ';  +  +       /* RIEK This eliminates trailing WTs AND CRLF*/  +       value = &buffer[12];  +       for (end = &value[strlen(value) - 1]; end > value && ap_isspace(*end); --end)  +                   *end = '\\0';            r->status_line = ap_pstrdup(r->pool, &buffer[9]);      ", "id": 18543, "time": "2002-06-25T14:21:05Z", "creator": "riek@de.alcove.com", "creation_time": "2002-06-25T14:21:05Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 10052, "attachment_id": 2180, "text": "Created attachment 2180\nNow in readable from: patch that eliminates trailing CRLF in statusline", "id": 18549, "time": "2002-06-25T14:51:03Z", "creator": "riek@de.alcove.com", "creation_time": "2002-06-25T14:51:03Z", "is_private": false}, {"count": 3, "tags": [], "creator": "ctolkmit@tng.de", "attachment_id": null, "id": 18600, "time": "2002-06-26T09:57:22Z", "bug_id": 10052, "creation_time": "2002-06-26T09:57:22Z", "is_private": false, "text": "the patch works for me too :-) thank you!"}, {"count": 4, "tags": [], "bug_id": 10052, "text": "This is actually a manifestation of bug # 11668 - the problem is that mod_proxy\ninserts a blank line when proxying any page whose status line is of the form\n\"HTTP/1.1 NNN \", where \"NNN\" is a status code.\n\nWhile this patch clearly works, I think that the patch attached to # 11668 is a\nbetter solution.\n\nHowever, I never would have been able to track down which function was\nmisbehaving had I not found this bug, and the patch attached to it, which\npointed me in the right direction.\n\n*** This bug has been marked as a duplicate of 11668 ***", "id": 36695, "time": "2003-05-05T14:30:43Z", "creator": "martin@snowplow.org", "creation_time": "2003-05-05T14:30:43Z", "is_private": false, "attachment_id": null}]
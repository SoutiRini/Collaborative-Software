[{"count": 0, "tags": [], "bug_id": 53009, "attachment_id": 28520, "text": "Created attachment 28520\njava program to generate docx file\n\nunable to create a simple header and footer text if creating a new document. Using a simple test program, the header and footer xml prints the xml content twice. I am also including the patch but I am not sure what side effect it has by commenting part of the code out.\n\nLet me know! thanks!", "id": 155426, "time": "2012-03-30T22:32:32Z", "creator": "rngo@tk20.com", "creation_time": "2012-03-30T22:32:32Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 53009, "attachment_id": 28521, "id": 155427, "time": "2012-03-30T22:33:52Z", "creator": "rngo@tk20.com", "creation_time": "2012-03-30T22:33:52Z", "is_private": false, "text": "Created attachment 28521\ncommented 2nd write to the xml"}, {"count": 2, "tags": [], "bug_id": 53009, "attachment_id": null, "id": 164590, "time": "2013-01-11T21:51:50Z", "creator": "mike.mccullough@gmail.com", "creation_time": "2013-01-11T21:51:50Z", "is_private": false, "text": "I have noticed the same problems as well, and can provide some additional information where the problem likely occurs. Within XWPFHeaderFooterPolicy, the code for creating of a footer looks like:\n\npublic XWPFFooter createFooter(Enum type, XWPFParagraph[] pars) throws IOException {\n        XWPFRelation relation = XWPFRelation.FOOTER;\n        String pStyle = \"Footer\";\n        int i = getRelationIndex(relation);\n        FtrDocument ftrDoc = FtrDocument.Factory.newInstance();\n        XWPFFooter wrapper = (XWPFFooter)doc.createRelationship(relation, XWPFFactory.getInstance(), i);\n\n        CTHdrFtr ftr = buildFtr(type, pStyle, wrapper, pars);\n        wrapper.setHeaderFooter(ftr);\n\n        OutputStream outputStream = wrapper.getPackagePart().getOutputStream();\n        ftrDoc.setFtr(ftr);\n\n        XmlOptions xmlOptions = commit(wrapper);\n\n        assignFooter(wrapper, type);\n        ftrDoc.save(outputStream, xmlOptions);\n        outputStream.close();\n        return wrapper;\n    }\n\nThe important line of code is:\n\nftrDoc.save(outputStream, xmlOptions);\n\nwhich provides the first line of XML to be saved (e.g., saved in footer1.xml).\n\nThe footer will additionally be saved with the final write() function within the POIXMLDocument. Since a header or footer is considered to be a org.apache.poi.openxml4j.opc.PackagePart, the write() function will iterate through all package parts and save them as well.\n\nThe onSave(Set<PackagePart> alreadySaved) function in POIXMLDocumentPart calls commit() in the first line of the function. Within the overriden implementation of commit() in the XWPFFooter class, the penultimate line has:\n\nsuper._getHdrFtr().save(out, xmlOptions);\n\nwhich will cause the second line of the XML footer information to be written as well."}, {"count": 3, "tags": [], "bug_id": 53009, "text": "I ended up creating a new header footer policy class (that extends the default) and doesn't call ftrDoc.save() . That approach works, but it would be nice if the default worked out of the box and didn't require a workaround.", "id": 165494, "time": "2013-02-26T18:08:15Z", "creator": "akochnev@gmail.com", "creation_time": "2013-02-26T18:08:15Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 53009, "text": "Alex' workaround works fine, however the same must be done for the header by removing the appropriate hdrDoc.save()", "id": 169630, "time": "2013-08-21T08:53:49Z", "creator": "benoit.duffez@gmail.com", "creation_time": "2013-08-21T08:53:49Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 53009, "attachment_id": 34370, "text": "Created attachment 34370\nmylyn/context/zip", "id": 194386, "time": "2016-10-13T01:14:10Z", "creator": "jmarkmurphy@apache.org", "creation_time": "2016-10-13T01:14:10Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 53009, "attachment_id": null, "id": 194387, "time": "2016-10-13T01:17:14Z", "creator": "jmarkmurphy@apache.org", "creation_time": "2016-10-13T01:17:14Z", "is_private": false, "text": "corrected with r1764563"}]
[{"count": 0, "tags": [], "bug_id": 14861, "attachment_id": null, "id": 27005, "time": "2002-11-26T16:07:09Z", "creator": "tcastelle@generali.fr", "creation_time": "2002-11-26T16:07:09Z", "is_private": false, "text": "We are using an apache 2.0.43 as a reverse proxy with many virtual hosts and we\nare using mod_ssl for some of them. \n\nIt seems to work fine, but on each HTTPS request, we have this error in the\nerror log :\n\n[Tue Nov 26 15:19:43 2002] [error] (20014)Error string not specified yet: Cannot\nstore SSL session to DBM file `/var/log/www/proto/run/ssl_scache'\n\nThe directory /var/log/www/proto/run/ exists and have the correct rights, it\ncan't figure what is this error about...\n\nHere is our configuration file (almost a standard one) :\n\nAddType application/x-x509-ca-cert .crt\nAddType application/x-pkcs7-crl    .crl\n\nSSLPassPhraseDialog  builtin\n\nSSLSessionCache         dbm:/var/log/www/proto/run/ssl_scache\nSSLSessionCacheTimeout  300\n\nSSLMutex  file:/var/log/www/proto/run/ssl_mutex\n\nSSLRandomSeed startup builtin\nSSLRandomSeed connect builtin\n\nSSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL\n\nSSLCertificateFile /usr/local/www/proto/conf/ssl.crt/server.crt\n\nSSLCertificateKeyFile /usr/local/www/proto/conf/ssl.key/server.key\n\nSSLCertificateChainFile /usr/local/www/proto/conf/ssl.crt/verisign.crt\n\nCustomLog /var/log/www/proto/logs/ssl_request.log \\\n          \"%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \\\"%r\\\" %b\"\n\nThank you for helping !\n\nThomas."}, {"count": 1, "tags": [], "creator": "tcastelle@generali.fr", "attachment_id": null, "is_private": false, "id": 27244, "time": "2002-12-02T14:08:35Z", "bug_id": 14861, "creation_time": "2002-12-02T14:08:35Z", "text": "I have some news about this problem. I found it was, on Solaris 8, because we\ncompiled Apache in 64 bit (with CFLAGS=\"-m64\" ./configure)\n\nYou can try it with the testdbm executable in srclib/apr-util/test\n\nWith a 32-bit compilation :\n# ./configure\n...\n# cd srclib/apr-util/test\n# make\n...\n# ./testdbm auto foo\nGenerating data: OK\nTesting retrieval: OK\n\nWith a 64-bit compilation :\n# CFLAGS=\"-m64\" ./configure\n...\n# cd srclib/apr-util/test\n# make\n...\n# ./testdbm auto foo\nGenerating data: ABCDEFGHIJ: testdbm: store: failed\nAPR Error 20014 - Error string not specified yet\nAPR_DB Error 22 - I/O error occurred.\n\nI must say that we HAVE to compile it in 64-bit because of a #$*!/# bug in\nsolaris (limit of 255 opened file descriptors by process in 32 bits !!)\n\nCan you look at this issue ?\n\nThanks a lot for your help !\n\nThomas."}, {"count": 2, "tags": [], "bug_id": 14861, "text": "\n  Apache 2.0.44 will be along soon now, and should address your problem.\n", "id": 27262, "time": "2002-12-02T17:07:11Z", "creator": "wrowe@apache.org", "creation_time": "2002-12-02T17:07:11Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "text": "Well, I don't want to bother but... are you sure ? Because the current CVS\nsnapshot (2002/12/02) does not seem to solve the problem.\n\nHope you're right...", "attachment_id": null, "bug_id": 14861, "id": 27308, "time": "2002-12-03T08:25:19Z", "creator": "tcastelle@generali.fr", "creation_time": "2002-12-03T08:25:19Z", "is_private": false}, {"count": 4, "tags": [], "text": "I just verified this problem with 64-bit build on AIX.  It turns out that\nthe sdbm support is busted when int and size_t are different.\n\napr_datum_t is (char *, apr_size_t) and apr_sdbm_datum_t is (char *, int),\nand the CONVERT_DATUM and RETURN_DATUM macros in apr_dbm_sdbm.c assume that\nthe structures can be copied just by casting instead of copying member-by-\nmember.\n\nI'll attach a patch that gets \"testdbm auto foo\" working, but I haven't\ntested the firstkey/nextkey support.\n\nA better fix may be to define apr_sdbm_datum_t to (char *, apr_size_t).\nI didn't have time/patience at the moment to make sure that doesn't\naffect the file format, which would be really bad news.\n\nIf you can test the patch with a 64-bit build on Solaris, at least we\ncan know that the root cause of the failure is the same, and hopefully it \ngets mod_ssl working for you.\n\nThanks!", "attachment_id": null, "bug_id": 14861, "id": 27321, "time": "2002-12-03T13:18:51Z", "creator": "trawick@apache.org", "creation_time": "2002-12-03T13:18:51Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 14861, "attachment_id": 4018, "id": 27322, "time": "2002-12-03T13:19:59Z", "creator": "trawick@apache.org", "creation_time": "2002-12-03T13:19:59Z", "is_private": false, "text": "Created attachment 4018\nfix sdbm support for builds where sizeof(int) != sizeof(size_t)"}, {"count": 6, "tags": [], "bug_id": 14861, "text": "Your patch works also with a 64-bit build on Solaris, thanks a lot !\nI close this bug...\n\n\n\n\n\n", "id": 27325, "time": "2002-12-03T14:31:02Z", "creator": "tcastelle@generali.fr", "creation_time": "2002-12-03T14:31:02Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "text": "Thanks so much for the quick feedback!!\n\nI'm reopening the bug until a fix is committed.  I'd like to get some feedback\nfrom other developers before committing the patch you tested.", "id": 27328, "time": "2002-12-03T14:41:47Z", "bug_id": 14861, "creation_time": "2002-12-03T14:41:47Z", "is_private": false}, {"count": 8, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "text": "fix finally committed; sorry for the delay!!", "id": 29924, "time": "2003-01-23T11:44:56Z", "bug_id": 14861, "creation_time": "2003-01-23T11:44:56Z", "is_private": false}]
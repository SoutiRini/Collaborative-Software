[{"count": 0, "tags": [], "text": "This patch add support for percentages and table-units in property values \nand for calculations that involves these values in property expressions.\n\nThe patch contain the follow changes to the property sub-system:\n\n- Add a small interface: Numeric which describe the public \n  methods for all types of numerics.\n- Make all the length subclasses implement Numeric and Length\n- Clean out NumericProperty so it represent an absolute numeric.\n- Add class RelativeNumericProperty which represent an exression tree which\n  involve relative numeric operand(s).\n- Adds a NumericOp class with static calculus methods that does the \n  calculation if the operand(s) are absolute or create an expression node\n  so the evaluation will be done when getValue() or getNumericValue() is\n  called.\n\nAnd the following changes to the layout subsystem:\n\n- Add getters for block and referenceArea dimensions and tableUnits to FObj.\n- Override getter for block, referenceArea and tableUnits in the fo's\n  that define new values for such areas.\n- Make the LMs assign values for block, referenceArea and tableUnits \n  just before curLM.getNextBreakPoss() is called.\n- Delay evaluation of the final call to Length.getValue() until\n  layouting is in progress and the base value are available.\n\nPlease note that I'm a bit confused about the exact definition of the areas,\nblocks and boxes that are described under 'percentage' for each property in\nthe spec so it is quite likely that the values assigned in the LMs are\nincorrect and/or the properties uses the wrong area/block/box when resolving \na relative length. I still hope that the patch shows a valid approach for\nadding support for relative lengths.\n\nIt is likely that more getters must be defined in FObj, f.ex. for the \npadding area.\n\nAfter applying the patch the following files should be removed:\n\nsrc/java/org/apache/fop/fo/properties/LinearCombinationLength.java\nsrc/java/org/apache/fop/fo/properties/MixedLength.java", "attachment_id": null, "bug_id": 26778, "id": 51934, "time": "2004-02-08T20:42:16Z", "creator": "bckfnn@worldonline.dk", "creation_time": "2004-02-08T20:42:16Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bckfnn@worldonline.dk", "text": "Created attachment 10273\nA unified diff against HEAD.", "id": 51935, "time": "2004-02-08T20:43:02Z", "bug_id": 26778, "creation_time": "2004-02-08T20:43:02Z", "is_private": false, "attachment_id": 10273}, {"count": 2, "tags": [], "bug_id": 26778, "attachment_id": null, "id": 52281, "time": "2004-02-14T22:05:20Z", "creator": "spepping@apache.org", "creation_time": "2004-02-14T22:05:20Z", "is_private": false, "text": "Finn,\n\nI have only just started to understand this, but I found a problem when running\nthe fo file which I will attach next.\n\nException in thread \"main\" java.lang.NullPointerException\n\tat org.apache.fop.fo.expr.NumericOp.addition(NumericOp.java:73)\n\tat\norg.apache.fop.fo.properties.IndentPropertyMaker.compute(IndentPropertyMaker.java:117)\n\tat org.apache.fop.fo.properties.PropertyMaker.compute(PropertyMaker.java:588)\n\tat org.apache.fop.fo.properties.PropertyMaker.findProperty(PropertyMaker.java:274)\n\tat org.apache.fop.fo.properties.PropertyMaker.findProperty(PropertyMaker.java:283)\n\tat org.apache.fop.fo.properties.PropertyMaker.get(PropertyMaker.java:305)\n\tat org.apache.fop.fo.PropertyList.get(PropertyList.java:282)\n\tat org.apache.fop.fo.PropertyList.get(PropertyList.java:268)\n\tat org.apache.fop.fo.PropertyManager.getMarginProps(PropertyManager.java:332)\n\tat org.apache.fop.fo.pagination.RegionBody.getViewportRectangle(RegionBody.java:90)\n\tat\norg.apache.fop.layoutmgr.PageLayoutManager.makeRegionViewport(PageLayoutManager.java:832)\n\tat\norg.apache.fop.layoutmgr.PageLayoutManager.createPageAreas(PageLayoutManager.java:805)\n\tat\norg.apache.fop.layoutmgr.PageLayoutManager.createPage(PageLayoutManager.java:744)\n\tat\norg.apache.fop.layoutmgr.PageLayoutManager.makeNewPage(PageLayoutManager.java:464)\n\tat org.apache.fop.layoutmgr.PageLayoutManager.doLayout(PageLayoutManager.java:216)\n\tat org.apache.fop.layoutmgr.PageLayoutManager.run(PageLayoutManager.java:204)\n\tat org.apache.fop.layoutmgr.LayoutManagerLS.format(LayoutManagerLS.java:113)\n\tat org.apache.fop.apps.Document.foPageSequenceComplete(Document.java:348)\n\tat\norg.apache.fop.fo.FOTreeHandler.notifyPageSequenceComplete(FOTreeHandler.java:533)\n\tat org.apache.fop.fo.FOTreeHandler.endPageSequence(FOTreeHandler.java:219)\n\tat org.apache.fop.fo.pagination.PageSequence.end(PageSequence.java:353)\n\tat org.apache.fop.fo.FOTreeBuilder.endElement(FOTreeBuilder.java:235)\n\tat\norg.apache.fop.tools.ProxyContentHandler.endElement(ProxyContentHandler.java:126)\n\tat org.apache.xerces.parsers.AbstractSAXParser.endElement(Unknown Source)\n\nelementName: \"fo:region-body\"\nparent elementName: \"fo:simple-page-master\"\npropId = 212: PR_START_INDENT\ncorresponding: 136, PR_MARGIN_LEFT (in lr_tb)\n\nRetrieving the corresponding property of the parent FO\n\nThe property is a RelativeNumericProperty:\n\nmain[1] print prop\n prop = \"(4000mpt +20.0%)\"\n\nmain[1] dump prop\n prop = {\n    operation: 1\n    op1: instance of org.apache.fop.fo.properties.FixedLength(id=685)\n    op2: instance of org.apache.fop.fo.properties.PercentLength(id=684)\n    dimension: 1\n    org.apache.fop.fo.properties.Property.specVal: null\n}\n\nPropertyList:\nmain[1] print this\n this = \"{master-name=simpleA4, margin=[(4000mpt +20.0%)]}\"\n\nIn IndentPropertyMaker.compute\n   RelativeNumericProperty.getNumeric() returns null\n\nIn NumericOp.addition:\nmain[1] locals\nMethod arguments:\nop1 = instance of org.apache.fop.fo.properties.FixedLength(id=773)\nop2 = null\n"}, {"count": 3, "tags": [], "text": "Created attachment 10362\nThe fo file that shows the problem", "is_private": false, "bug_id": 26778, "id": 52282, "time": "2004-02-14T22:07:13Z", "creator": "spepping@apache.org", "creation_time": "2004-02-14T22:07:13Z", "attachment_id": 10362}, {"count": 4, "tags": [], "creator": "mm@arcus.com.au", "text": "I am not a XSL-FO expert but is this valid, eg.\n    <fo:simple-page-master master-name=\"simpleA4\" margin=\"4pt+20%\">\nFor \"margin-...\" properties percentages in expressions apply to the margins of \nthe enclosing block. Does a \"simple-page-master\" have an enclosing block with \nvalid margins? If not the above expression cannot be resolved.\n\nOf course, even if that is the case FOP shouldn't throw a NPE.", "id": 52287, "time": "2004-02-15T02:32:12Z", "bug_id": 26778, "creation_time": "2004-02-15T02:32:12Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "Good catch Simon, thanks for taking time to look at it. The NPE is due to a \nmissing implementation of getNumeric() in RelativeNumericProperty (which should \ncontain \"return this;\").\n\nI would guess that your example are using margins in a page context, so I have \nmade it return 20% of the page width. But margin-[top,bottom] also used page-\nwidth but they should be using page-height as their base and that isn't handled \ncorrectly yet.\n\nI'll attach a new patch which fixes the bugs you found and also merges the \ndifferent getters in FObj into a single getLayoutDimension().\n", "attachment_id": null, "bug_id": 26778, "id": 52297, "time": "2004-02-15T16:41:45Z", "creator": "bckfnn@worldonline.dk", "creation_time": "2004-02-15T16:41:45Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 26778, "text": "Created attachment 10366\nUnified diff against HEAD (version 2).", "id": 52298, "time": "2004-02-15T16:46:02Z", "creator": "bckfnn@worldonline.dk", "creation_time": "2004-02-15T16:46:02Z", "is_private": false, "attachment_id": 10366}, {"count": 7, "tags": [], "creator": "spepping@apache.org", "attachment_id": null, "is_private": false, "id": 52309, "time": "2004-02-15T20:46:51Z", "bug_id": 26778, "creation_time": "2004-02-15T20:46:51Z", "text": "Finn,\n\nI see you also solved another problem, viz. that fo:layout-master-set\ndid not return a proper IPD. However, I am not happy with your\nsolution. During the layout process, you feed the page dimensions back\ninto the FO tree, in PageLayoutManager.createPageAreas. I think it\nwould be a better design if, in order to resolve the percent-based\nproperties, you would not climb the FO tree but the Area tree. That\navoids feeding back results from the Area tree into the FO tree.\n\nThe XSL spec says (XSL-PR/slice3.html#section-N1208-Conceptual-Procedure):\n\n'The formatting object supplies parameters to its children based on the\ntraits of areas already in the area tree, possibly including areas\ngenerated by the formatting object or its ancestors.'\n\nHolding those parameters in the FO tree is one solution. Extracting\nthem from the area tree layed out up to that point is another\nsolution, which has the advantage that it does not load the FO tree\nwith information that it does not need to have."}, {"count": 8, "tags": [], "creator": "bckfnn@worldonline.dk", "attachment_id": null, "is_private": false, "id": 53024, "time": "2004-02-26T15:58:24Z", "bug_id": 26778, "creation_time": "2004-02-26T15:58:24Z", "text": "Further discussions on fop-dev:\n\nhttp://marc.theaimsgroup.com/?l=fop-dev&m=107688130007968&w=2\nhttp://marc.theaimsgroup.com/?l=fop-dev&m=107687318301307&w=2\nhttp://marc.theaimsgroup.com/?l=fop-dev&m=107627414405846&w=2"}, {"count": 9, "tags": [], "bug_id": 26778, "text": "Applied.", "id": 53025, "time": "2004-02-26T15:59:07Z", "creator": "bckfnn@worldonline.dk", "creation_time": "2004-02-26T15:59:07Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 26778, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed", "id": 155869, "time": "2012-04-01T06:45:42Z", "creator": "gadams@apache.org", "creation_time": "2012-04-01T06:45:42Z", "is_private": false, "attachment_id": null}]
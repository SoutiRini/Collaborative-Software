[{"count": 0, "text": "I tested rev 574843 Event MPM.\nWhile downloading a file, a graceful restart/stop kill a connection \nimmediately.\n\nI tested rev 327944 (before async write was merged) too, and no problem.", "creator": "takashi.asfbugzilla@tks.st", "attachment_id": null, "id": 108054, "time": "2007-09-12T03:00:52Z", "bug_id": 43359, "creation_time": "2007-09-12T03:00:52Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "See event.c line 1220 (on rev 574462).\nBefore async write was merged, process_socket was blocked.\nAfter merged, it isn't blocked.\nAs a result, worker thread doesn't care whether any downloading continue.", "attachment_id": null, "id": 108905, "creator": "takashi.asfbugzilla@tks.st", "time": "2007-10-02T08:36:10Z", "bug_id": 43359, "creation_time": "2007-10-02T08:36:10Z", "is_private": false}, {"count": 2, "tags": [], "text": "Not only worker thread but listener thread also needs to be patched.\nEven if workers are alive if listener thread has exited workers can't get \ntheir jobs.", "attachment_id": null, "bug_id": 43359, "id": 108923, "time": "2007-10-02T16:55:00Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-10-02T16:55:00Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43359, "attachment_id": null, "id": 109031, "time": "2007-10-05T09:54:39Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-10-05T09:54:39Z", "is_private": false, "text": "(In reply to comment #1)\n> See event.c line 1220 (on rev 574462).\n> Before async write was merged, process_socket was blocked.\n> After merged, it isn't blocked.\n> As a result, worker thread doesn't care whether any downloading continue.\n\nThat's wrong.\nThe worker threads exit after the listener thread exits."}, {"count": 4, "tags": [], "bug_id": 43359, "text": "Created attachment 20925\n[incomplete] listener thread stop only listening\n\nThis patch makes:\n\nIf graceful stop/restart performs, listener thread stops listening sockets, and\ncontinue to poll sockets that was already accepted.\n\nBut this patch is incomplete... Listener is still alive when there's no\nclients. I can't find how to know how many clients remains.", "id": 109032, "time": "2007-10-05T09:56:11Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-10-05T09:56:11Z", "is_private": false, "attachment_id": 20925}, {"count": 5, "tags": [], "creator": "takashi.asfbugzilla@tks.st", "is_private": false, "text": "Created attachment 20932\nfor trunk, implement a connection counter\n\nThis seems to work.", "id": 109045, "time": "2007-10-06T00:01:09Z", "bug_id": 43359, "creation_time": "2007-10-06T00:01:09Z", "attachment_id": 20932}, {"count": 6, "tags": [], "text": "Perhaps tie the apr_atomic_dec32() into a cleanup function,  on connection pool?\n\nusing apr_pool_cleanup_register:\nhttp://apr.apache.org/docs/apr/1.2/group___pool_cleanup.html#g6bdb28224dfe08160cbe3ba6b22dcbd7", "is_private": false, "id": 109046, "creator": "chip@force-elite.com", "time": "2007-10-06T00:40:05Z", "bug_id": 43359, "creation_time": "2007-10-06T00:40:05Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "takashi.asfbugzilla@tks.st", "attachment_id": null, "id": 109051, "time": "2007-10-06T09:00:39Z", "bug_id": 43359, "creation_time": "2007-10-06T09:00:39Z", "is_private": false, "text": "(In reply to comment #6)\n> Perhaps tie the apr_atomic_dec32() into a cleanup function,  on connection \npool?\n\nvery Good idea"}, {"count": 8, "tags": [], "text": "Created attachment 20941\nconn counter using conn pool\n\nThe connecton counter is decremented on a cleanup function on connection pool.", "is_private": false, "id": 109115, "creator": "takashi.asfbugzilla@tks.st", "time": "2007-10-08T02:58:29Z", "bug_id": 43359, "creation_time": "2007-10-08T02:58:29Z", "attachment_id": 20941}, {"count": 9, "tags": [], "bug_id": 43359, "attachment_id": null, "id": 109134, "time": "2007-10-08T11:41:53Z", "creator": "chip@force-elite.com", "creation_time": "2007-10-08T11:41:53Z", "is_private": false, "text": "I think the patch is almost perfect. I think apr_thread_join should still be\ncalled for the listener thread though?  In join_workers, I think you should\nstill join() on the listener, after all the worker threads are joined?"}, {"attachment_id": null, "tags": [], "bug_id": 43359, "text": "(In reply to comment #9)\n> I think the patch is almost perfect\nnot perfect I think.\nI don't understand the code about scoreboard and \nperform_idle_server_maintenance enough.\n\n> I think apr_thread_join should still be\n> called for the listener thread though?\n\nThe workers never exit before the listener exits at graceful stop/restart,\nbut at ungraceful stop/restart the workers can.\nAnd even at graceful, should apr_thread_join.\nLooking back, I just wanted to suppress \"[debug] the listener thread didn't \nexit\".\nI've reverted partially join_workers().", "count": 10, "id": 109183, "time": "2007-10-10T00:47:18Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2007-10-10T00:47:18Z", "is_private": false}, {"count": 11, "text": "Created attachment 20950\nfor trunk", "creator": "takashi.asfbugzilla@tks.st", "attachment_id": 20950, "id": 109184, "time": "2007-10-10T01:07:20Z", "bug_id": 43359, "creation_time": "2007-10-10T01:07:20Z", "tags": [], "is_private": false}, {"count": 12, "tags": [], "creator": "sf@sfritsch.de", "is_private": false, "text": "Committed in r1137182, thanks for the patch", "id": 147246, "time": "2011-06-18T13:21:48Z", "bug_id": 43359, "creation_time": "2011-06-18T13:21:48Z", "attachment_id": null}]
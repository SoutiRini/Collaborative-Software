[{"count": 0, "tags": [], "creator": "andreas@manticore-projects.com", "text": "Created attachment 31297\nCNB_01_all.xls reproduces the bug\n\nDear All,\n\nthe method shift rows always fails for me:\n\nException in thread \"main\" java.lang.RuntimeException: Could not find\n'internal references' EXTERNALBOOK\n        at\norg.apache.poi.hssf.model.LinkTable.checkExternSheet(LinkTable.java:433)\n        at\norg.apache.poi.hssf.model.InternalWorkbook.checkExternSheet(InternalWorkbook.java:1796)\n        at\norg.apache.poi.hssf.usermodel.HSSFSheet.shiftRows(HSSFSheet.java:1494)\n        at\norg.apache.poi.hssf.usermodel.HSSFSheet.shiftRows(HSSFSheet.java:1343)\n\n\nThe code is extremely simple:\n\nimport java.io.*;\nimport org.apache.poi.hssf.usermodel.*;\n\n/**\n *\n * @author are\n */\npublic class ExcelToolsBug {\n        public static void main(String[] args) throws FileNotFoundException,\nIOException {\n                String fileName=\"CNB_01_all.xls\";\n                int rowOffset = 11;\n                String sheetName = \"MBR302\";\n\n                File file = new File(fileName);\n                InputStream inputStream = new FileInputStream(file);\n                final HSSFWorkbook workbook = new HSSFWorkbook(inputStream);\n\n                HSSFSheet sheet = workbook.getSheet(sheetName);\n                for (int r = 0; r < 100; r++) {\n                        sheet.shiftRows(rowOffset+1, sheet.getLastRowNum(), 1, true, true);\n                }\n        }\n}\n\nI attached the Excel-File, which reproduces the problem. It was created with LibreOffice Version: 4.1.4.2 Build ID: Gentoo official package. I also tried to open/save that file with Excel and the same problem occurred afterwards. \n\nPlease can\nanyone help me on that? I do not understand unfortunately the purpose\nand the functionality of the method \"checkExternSheet\".\n\nThank you and best regards\nAndreas", "id": 172962, "time": "2014-02-09T10:26:01Z", "bug_id": 56123, "creation_time": "2014-02-09T10:26:01Z", "is_private": false, "attachment_id": 31297}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "text": "(In reply to andreas from comment #0)\n> Please can\n> anyone help me on that? I do not understand unfortunately the purpose\n> and the functionality of the method \"checkExternSheet\".\n\nThe comment for the code which calls checkExternSheet is:\n\n       // Update any formulas on this sheet that point to\n       //  rows which have been moved\n\n\nAt first glance, it looks like the table that maps between sheet names and indexes for formulas has ended up confused, and/or that there's a bug in our logic for handling that on some edge case.\n\nA few things you could try:\n * Step into LinkTable in a debugger, and see what it does know about, and if the ids and names match what the normal names are\n * Try deleting a sheet in Excel, saving, and seeing if that fixes it\n * Try adding a sheet in in Excel, saving, and seeing that fixes it", "id": 172968, "time": "2014-02-09T23:14:17Z", "bug_id": 56123, "creation_time": "2014-02-09T23:14:17Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "andreas@manticore-projects.com", "text": "(In reply to Nick Burch from comment #1)\n\n> The comment for the code which calls checkExternSheet is:\n> \n>        // Update any formulas on this sheet that point to\n>        //  rows which have been moved\n\nYes, clear. But what is the exact purpose of the failing function?\nPlease note, there is no reference to any other worksheet or workbook. All the formula refer to the single worksheet only.\n\n> At first glance, it looks like the table that maps between sheet names and\n> indexes for formulas has ended up confused, and/or that there's a bug in our\n> logic for handling that on some edge case.\n\n \n> A few things you could try:\n>  * Step into LinkTable in a debugger, and see what it does know about, and\n> if the ids and names match what the normal names are\n\nSeems to be very likely. Unfortunately I am on travel an can not pull the full maven-repository at the moment.\n\n>  * Try deleting a sheet in Excel, saving, and seeing if that fixes it\n>  * Try adding a sheet in in Excel, saving, and seeing that fixes it\n\nI tried this with various combinations a thousand times in order to understand what is going on. I've created new workbooks from scratch, I copied existing worksheets over, I copied ranges, I inserted sheets etc etc. The only hint I can give:\n\n1) one single sheet seems to work but (mostly), but simple reformatting can sometimes break it (e.g. change width of several columns at once)\n2) as soon as you add another worksheet it breaks the new worksheet, but also the first (formerly working) one", "id": 172969, "time": "2014-02-10T08:17:14Z", "bug_id": 56123, "creation_time": "2014-02-10T08:17:14Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 56123, "attachment_id": null, "is_private": false, "id": 189382, "time": "2016-03-11T22:00:04Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-03-11T22:00:04Z", "text": "*** Bug 59059 has been marked as a duplicate of this bug. ***"}]
[{"count": 0, "tags": [], "bug_id": 61364, "attachment_id": null, "text": "We had an issue that prevented us from deleting certain JSPs in an embedded Tomcat.\nThe cause of that seems to be that an InputStream is not closed after trying to figure out the encoding of a .jsp file.\n\nFrom our point of view this seems to affect at least Tomcat 8.5.16 with following classes involved:\n\norg.apache.jasper.compiler.ParserController:\n> 321: InputStream inStream = JspUtil.getInputStream(absFileName, jar, ctxt);\n> 322: EncodingDetector encodingDetector = new EncodingDetector(inStream);\n=> The InputStream is retrieved and passed to the EncodingDetector.\n\n\norg.apache.jasper.compiler.EncodingDetector:\n> 96:  XMLStreamReader xmlStreamReader = XML_INPUT_FACTORY.createXMLStreamReader(stream);\n=> The EncodingDetector creates an XMLStreamReader on its static XML_INPUT_FACTORY.\n\n\nAs a workaround we configured the JspConfig like this to prevent the detection of the encoding:\n\n> <jsp-config>\n>   <jsp-property-group>\n>     <url-pattern>*.jsp</url-pattern>\n>     <is-xml>false</is-xml>\n>   </jsp-property-group>\n> </jsp-config>", "id": 200117, "time": "2017-07-31T10:07:00Z", "creator": "peter.stockli@alphabot.com", "creation_time": "2017-07-31T10:07:00Z", "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "text": "For anyone trying to reproduce this, you'll need to disable resource caching for the associated Context.\n\nIt is also a lot easier to reproduce on Windows since Windows prevents deletion of locked files.\n\nThis has been fixed in :\n- trunk for 9.0.0.M26 onwards\n- 8.5.x for 8.5.20 onwards\n\nMany thanks for the report and the analysis to pin-point the issue.", "id": 200133, "time": "2017-08-01T12:12:22Z", "bug_id": 61364, "creation_time": "2017-08-01T12:12:22Z", "is_private": false, "attachment_id": null}]
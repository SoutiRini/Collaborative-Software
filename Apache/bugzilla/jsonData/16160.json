[{"count": 0, "tags": [], "text": "We are using IIS server in front of a Tomcat4(Apache Tomcat/4.1.12-LE-jdk14)\nserver using the JK connector. We have a problem with uploads which fail with a\n\"Stream ended unexpectedly\" (the upload package is jakarta commons fileupload\nprovided with struts1.1b).\nThe upload works fine when accessing tomcat directly.\nNot sure if the following exception has anything to with this problem but I am\nproviding it here:\n\nJan 15, 2003 8:55:35 AM org.apache.jk.common.HandlerRequest invoke\nSEVERE: Error decoding request \njava.lang.NumberFormatException\n\tat org.apache.tomcat.util.buf.Ascii.parseInt(Ascii.java:195)\n\tat org.apache.tomcat.util.buf.ByteChunk.getInt(ByteChunk.java:439)\n\tat org.apache.tomcat.util.buf.MessageBytes.getInt(MessageBytes.java:629)\n\tat org.apache.jk.common.HandlerRequest.decodeHeaders(HandlerRequest.java:628)\n\tat org.apache.jk.common.HandlerRequest.decodeRequest(HandlerRequest.java:446)\n\tat org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:344)\n\tat org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:563)\n\tat org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:535)\n\tat org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:638)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)\n\n\nThe exception we get when uploading is:\n\njavax.servlet.ServletException: Processing of multipart/form-data request\nfailed. Stream ended unexpectedly\n    at\norg.apache.struts.upload.CommonsMultipartRequestHandler.handleRequest(CommonsMultipartRequestHandler.java:245)\n    at org.apache.struts.util.RequestUtils.populate(RequestUtils.java:934)\n    at\norg.apache.struts.action.RequestProcessor.processPopulate(RequestProcessor.java:779)\n    at org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:246)\n    at org.apache.struts.action.ActionServlet.process(ActionServlet.java:1292)\n    at org.apache.struts.action.ActionServlet.doPost(ActionServlet.java:510)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n    at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n    at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n    at com.opensymphony.module.sitemesh.filter.PageFilter.parsePage(Unknown Source)\n    at com.opensymphony.module.sitemesh.filter.PageFilter.doFilter(Unknown Source)\n    at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:213)\n    at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n    at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2396)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:223)\n    at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:256)\n    at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:361)\n    at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:563)\n    at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:535)\n    at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:638)\n    at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n    at java.lang.Thread.run(Thread.java:536)\n\nroot cause\n\norg.apache.commons.fileupload.FileUploadException: Processing of\nmultipart/form-data request failed. Stream ended unexpectedly\n    at org.apache.commons.fileupload.FileUpload.parseRequest(FileUpload.java:462)\n    at org.apache.commons.fileupload.FileUpload.parseRequest(FileUpload.java:304)\n    at\norg.apache.struts.upload.CommonsMultipartRequestHandler.handleRequest(CommonsMultipartRequestHandler.java:234)\n    at org.apache.struts.util.RequestUtils.populate(RequestUtils.java:934)\n    at\norg.apache.struts.action.RequestProcessor.processPopulate(RequestProcessor.java:779)\n    at org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:246)\n    at org.apache.struts.action.ActionServlet.process(ActionServlet.java:1292)\n    at org.apache.struts.action.ActionServlet.doPost(ActionServlet.java:510)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n    at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n    at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n    at com.opensymphony.module.sitemesh.filter.PageFilter.parsePage(Unknown Source)\n    at com.opensymphony.module.sitemesh.filter.PageFilter.doFilter(Unknown Source)\n    at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:213)\n    at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n    at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:260)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2396)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:223)\n    at org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:256)\n    at org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:361)\n    at org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:563)\n    at org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:535)\n    at org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:638)\n    at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n    at java.lang.Thread.run(Thread.java:536)", "is_private": false, "id": 29502, "creator": "pps@architekt.ro", "time": "2003-01-16T08:03:11Z", "bug_id": 16160, "creation_time": "2003-01-16T08:03:11Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "bfolkens@yahoo.com", "attachment_id": null, "text": "Also fails under RedHat 7.3 and Tomcat 4.1.17-LE-jdk14\nusing Apache/2.0.43 (Unix) & mod_jk2/2.0.0", "id": 30267, "time": "2003-01-29T14:56:17Z", "bug_id": 16160, "creation_time": "2003-01-29T14:56:17Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 16160, "attachment_id": null, "text": "Can you add a test case for this?, a war containing all the items needed to \nreproduce it would be very usefull..", "id": 30691, "time": "2003-02-04T21:34:28Z", "creator": "nacho@apache.org", "creation_time": "2003-02-04T21:34:28Z", "is_private": false}, {"count": 3, "tags": [], "creator": "mturk@apache.org", "attachment_id": null, "text": "Fixed in the CVS.\nThis was too the duplicate of #15278.\n", "id": 53212, "time": "2004-02-29T07:25:04Z", "bug_id": 16160, "creation_time": "2004-02-29T07:25:04Z", "is_private": false}]
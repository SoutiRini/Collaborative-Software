[{"count": 0, "tags": [], "creator": "fedd@sql.ru", "attachment_id": 26977, "text": "Created attachment 26977\nJSP script reproduces the bug. Uncomment lines 46, 47 to see the real problem.\n\nHello, \n\nThis is observed in Tomcat 6.0.26, Java 1.6 (Netbeans 6.9.1 bundle).\n\nThe MapELResolver getType method returns the class of the kept object instead of Object.class. The Java specification says, \"If the base object is a map, [getType] returns the most general acceptable type for a value in this map\", which should mostly be Object.class.\n\nThis makes impossible, for example, 1) to set a String value to a map expression, if previously that key was mapped to an Integer; 2) if we are putting an Integer to the value which is currently the String, the Integer gets coerced to the String (according to org.apache.el.parser.AstValue implementation, see lines 153-157.)\n\nThe attached JSP script reproduces this bug.\n\nI couldn't figure out whether it is connected with bug 44637 (seems that request was reverse to mine).\n\nThanks!", "id": 146204, "time": "2011-05-09T11:18:04Z", "bug_id": 51177, "creation_time": "2011-05-09T11:18:04Z", "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Thanks for the test case. I am looking at this now.\n\nAs an aside, the test JSP is invalid. You can't use hm.int since int is not a valid Java identifier (it is a reserved word). Tomcat 6 lets you get away with this. Tomcat 7 doesn't (unless you explicitly disable the check). This doesn't affect the validity of this bug report. Replacing \"int\" with \"integer\" allows the JSP to execute.", "id": 146214, "time": "2011-05-09T15:51:42Z", "bug_id": 51177, "creation_time": "2011-05-09T15:51:42Z", "is_private": false}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Fixed in 7.0.x for 7.0.14 onwards.\n\nProposed for 6.0.x.", "id": 146220, "time": "2011-05-09T16:32:40Z", "bug_id": 51177, "creation_time": "2011-05-09T16:32:40Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 51177, "text": "ListELResolver.getType() has the same issue", "id": 146224, "time": "2011-05-09T18:35:53Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-05-09T18:35:53Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 51177, "text": "Also fixed in 7.0.x for 7.0.14 and proposed for 6.0.x", "id": 146225, "time": "2011-05-09T18:44:50Z", "creator": "markt@apache.org", "creation_time": "2011-05-09T18:44:50Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Fixed in 6.0.x and will be included in 6.0.33 onwards.", "id": 146239, "time": "2011-05-10T08:43:21Z", "bug_id": 51177, "creation_time": "2011-05-10T08:43:21Z", "is_private": false}, {"count": 6, "tags": [], "creator": "fedd@sql.ru", "attachment_id": null, "text": "Thanks (if it's appropriate to thank here)!", "id": 146326, "time": "2011-05-15T07:51:46Z", "bug_id": 51177, "creation_time": "2011-05-15T07:51:46Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 39093, "attachment_id": null, "id": 87207, "time": "2006-03-24T08:50:42Z", "creator": "paul@mediamens.nl", "creation_time": "2006-03-24T08:50:42Z", "is_private": false, "text": "I've found something that appears to be a bug in TC 5.5.16 . After a small \ncheck, it however, also occured in TC 5.5.15, so it might even be older.\nTomcat 4.0.6 (using JDK 1.4), however, did *not* have this problem.\n\nI've got the following class/package structure:\n\n1: nl.hhv.merlin.gui.editor.EditButtons\n2: nl.hhv.merlin.gui.Editor\n3: nl.hhv.merlin.gui.editor2.EditButtons\n\nNote that packagename of the first class is equal to the fully qualified\nname of the second class (except for caps/nocaps). This should be no problem\nright?!? At least it never was until now.\n\nNow I have a JSP that simply does:\n\n<%\n  nl.hhv.merlin.gui.editor.EditButtons buttons = null;\n%>\n\nEclipse has no problems with this JSP, and happily accepts it, why shouldn't\nit? Looks fine to me to :-) But Tomcat 5.5.16 gives me the following error:\n\n  Generated servlet error:\n  nl.hhv.merlin.gui.editor cannot be resolved to a type\n\nWhen I change my JSP to:\n\n<%\n  nl.hhv.merlin.gui.editor2.EditButtons buttons = null;\n%>\n\nTomcat compiles the JSP without any problems. Note that the 2nd EditButtons\nclass is an EXACT copy of the first.\n\nI've tried to reproduce the same issue with different class and package-names, \nbut then it seems to work!?!?\n\nAnyway, I've attached a small ZIP which can be unpacked into the TC webapps \ndir, to try this out yourselves. It also contains the Java sources. Check out \nthe remarks in index.jsp for more weirdness :-)\n\nThe provided class files have been compiled using Eclipse 3.1.2 (so not the JDK \ncompiler). I'm running TC on Java 1.5.0_06.\n\nKind regards,\nPaul Hamer"}, {"count": 1, "tags": [], "bug_id": 39093, "attachment_id": 17966, "id": 87208, "time": "2006-03-24T08:53:42Z", "creator": "paul@mediamens.nl", "creation_time": "2006-03-24T08:53:42Z", "is_private": false, "text": "Created attachment 17966\nTC webapp to test this yourselves"}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 87242, "time": "2006-03-24T22:58:39Z", "bug_id": 39093, "creation_time": "2006-03-24T22:58:39Z", "is_private": false, "text": "Thanks for the test case. It makes looking at bugs like this so much quicker.\n\nMy environment:\nWindows Home SP2 + all patches\nJava 1.5.0_04\nTomcat 5.5.HEAD and 5.5.15\n\nI can't reproduce this. I confirmed the suspect code was present in the JSP by\nreviewing the source code generated in the work directory. The JSP was compilied\nwith the Eclipse 3.1.2 compilier.\n\nThis looks like a problem with your environment."}, {"count": 3, "tags": [], "creator": "paul@mediamens.nl", "attachment_id": null, "is_private": false, "id": 89615, "time": "2006-05-31T13:08:14Z", "bug_id": 39093, "creation_time": "2006-05-31T13:08:14Z", "text": "I've finally been able to narrow down this problem. It appears that it occurs \nONLY when the classes are in the Java classpath, and NOT (as in most cases) in \nthe WEB-INF/classes directory. I'll attach a new ZIP in a minute.\n\nMeanwhile, I've also migrated to Tomcat 5.5.17, but the problem remains.\n\nJust unpack the zip (mytest2.zip) into your tomcat/webapps directory. The \nindex.jsp will now compile fine, just to prove it actually works :-)\n\nNow, here we go:\n- Stop Tomcat\n- Rename the mytest/WEB-INF/classes dir to mytest/WEB-INF/klasses .\n  This will prevent Tomcat from picking it up.\n- Now add the mytest/WEB-INF/klasses dir to the Java classpath. My new \nclasspath then is:\n  C:\\Program Files\\Tomcat5.5\\bin\\bootstrap.jar;C:\\Program Files\\Tomcat5.5\n\\webapps\\mytest\\WEB-INF\\klasses\n- Restart Tomcat\n- Make sure you \"touch\" index.jsp to force re-compilation.\n- Visit index.jsp\n\net voila... there you have it:\n\n> gui.editor cannot be resolved to a type\n\nWhen I then (keep Tomcat running) delete the WEB-INF/klasses/gui/Editor.class \nfile, and re-visit the index.jsp, it suddenly compiles!\n\nGo figure :-)\n\nMy environment:\nWindows XP Pro SP2 + all patches\nJava 1.5.0_04\nTomcat 5.5.16 + 5.5.17\n\nHope this helps to finally locate this bug. Would help me a lot. I've already \ngot many applications out in the field using these classes, so renaming them is \nnot really an option :-(\n\nThanx!\nPaul Hamer\n"}, {"count": 4, "tags": [], "bug_id": 39093, "is_private": false, "text": "Created attachment 18378\nNew test-it-yourself TC webapp\n\nGoes with my reply above", "id": 89616, "time": "2006-05-31T13:09:36Z", "creator": "paul@mediamens.nl", "creation_time": "2006-05-31T13:09:36Z", "attachment_id": 18378}, {"count": 5, "tags": [], "text": "Created attachment 18379\nsorry, previous zip did not contain the sources", "attachment_id": 18379, "bug_id": 39093, "id": 89618, "time": "2006-05-31T13:16:48Z", "creator": "paul@mediamens.nl", "creation_time": "2006-05-31T13:16:48Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 39093, "attachment_id": null, "id": 92836, "time": "2006-09-01T02:28:08Z", "creator": "markt@apache.org", "creation_time": "2006-09-01T02:28:08Z", "is_private": false, "text": "If you mess with the classpath like this you are asking for trouble and are on\nyour own. See http://tomcat.apache.org/tomcat-5.5-doc/class-loader-howto.html\nfor an explanation of why it isn't as simple as justing adding stuff to your\nclasspath.\n\nAlso, be aware that the Tomcat startup scripts may over-write your classpath anyway."}, {"count": 7, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "is_private": false, "id": 127704, "time": "2009-06-06T10:08:37Z", "bug_id": 39093, "creation_time": "2009-06-06T10:08:37Z", "text": "In Tomcat 6.0.20, I cannot reproduce this issue as is (by deploying the web application from attachment 18379), but I can if I move the class files from WEB-INF/classes into ${catalina.home}/lib\n\nThus, the issue does exist, but is not observed with web applications, because different class loaders behave differently.\n\nMy environment:\n- Windows XP Prof. SP3\n- JRE 1.6.0_13-b03\n- Tomcat 6.0.20\n\nA workaround is to pack the classes into a jar file.\n\n*** This bug has been marked as a duplicate of bug 47323 ***"}]
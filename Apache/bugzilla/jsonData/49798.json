[{"count": 0, "tags": [], "text": "Hello ;\n\nWhen I do an 'apache2ctl gracefull', I get following warning in my apache error.log:\n\n[Sun Aug 22 14:46:00 2010] [warn] long lost child came home! (pid 10436)\n\nAfter some avestigations, I found that it's the'mod_log_config' module that cause this issue when we use Piped Log. To show, the problem:\n\n\n'ps aux' result before do the gracefull:\n\nroot      8511  0.1  0.4   6824  4256 ?        Ss   14:18   0:03 /usr/sbin/apache2 -k start\nroot     10502  0.0  0.0   1748   500 ?        S    14:46   0:00 /bin/sh -c /var/www/ispcp/engine/ispcp-apache-logger\nwww-data 10503  0.0  0.2   6192  2324 ?        S    14:46   0:00 /usr/sbin/apache2 -k start\nroot     10504  0.0  0.2   4532  2984 ?        S    14:46   0:00 /usr/bin/perl /var/www/ispcp/engine/ispcp-apache-logger\nwww-data 10505  0.0  0.2   6824  2188 ?        S    14:46   0:00 /usr/sbin/apache2 -k start\nwww-data 10506  0.0  0.2 228236  2856 ?        Sl   14:46   0:00 /usr/sbin/apache2 -k start\nwww-data 10507  0.0  0.2 228236  2860 ?        Sl   14:46   0:00 /usr/sbin/apache2 -k start\n\nHere, you can see my main Piped Log script process (pid 10502) and the second (pid 10504) that is the background process from (pid 10436).\n\nWhen I do the graceful, I get the following:\n\n[Sun Aug 22 14:52:50 2010] [notice] SIGUSR1 received.  Doing graceful restart\n[Sun Aug 22 14:52:51 2010] [notice] Stopping ispCP Apache logger (pid 10504)\n[Sun Aug 22 14:52:51 2010] [notice] Apache/2.2.16 (Debian) mod_fcgid/2.3.5 configured -- resuming normal operations\n[Sun Aug 22 14:52:51 2010] [warn] long lost child came home! (pid 10502)\n[Sun Aug 22 14:52:51 2010] [notice] Starting ispCP Apache logger (pid 10579)\n\nNote: Log lines for the logger come from my logging script (Added to show the problem).\n\nAfter the gracefull, my 'px aux' result is like this:\n\nroot      8511  0.1  0.4   6824  4256 ?        Ss   14:18   0:03 /usr/sbin/apache2 -k start\nroot     10577  0.0  0.0   1748   500 ?        S    14:52   0:00 /bin/sh -c /var/www/ispcp/engine/ispcp-apache-logger\nwww-data 10578  0.0  0.2   6192  2324 ?        S    14:52   0:00 /usr/sbin/apache2 -k start\nroot     10579  0.0  0.2   4532  2984 ?        S    14:52   0:00 /usr/bin/perl /var/www/ispcp/engine/ispcp-apache-logger\nwww-data 10580  0.0  0.2   6824  2188 ?        S    14:52   0:00 /usr/sbin/apache2 -k start\nwww-data 10581  0.0  0.2 228236  2856 ?        Sl   14:52   0:00 /usr/sbin/apache2 -k start\nwww-data 10582  0.0  0.2 228236  2860 ?        Sl   14:52   0:00 /usr/sbin/apache2 -k start\n\nOk, it's just a warn but I think that should be solved.  I've tried with alternative syntax (Shell not involved at all) and the same problem occurs on the main process.\n\nMy system:\n\nroot@ispcp:/etc/apache2/sites-available# uname -a\nLinux ispcp 2.6.32-5-686 #1 SMP Sat Jul 24 02:27:10 UTC 2010 i686 GNU/Linux\n\nThe involved SHELL:\nroot@ispcp:/etc/apache2/sites-available# ls -la /bin/sh\nlrwxrwxrwx 1 root root 4 21 ao\u00fbt  07:11 /bin/sh -> dash\n\nThe Apache information:\nroot@ispcp:/etc/apache2/sites-available# apache2ctl -V\nServer version: Apache/2.2.16 (Debian)\nServer built:   Jul 24 2010 20:24:16\nServer's Module Magic Number: 20051115:24\nServer loaded:  APR 1.4.2, APR-Util 1.3.9\nCompiled using: APR 1.4.2, APR-Util 1.3.9\nArchitecture:   32-bit\nServer MPM:     Worker\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=128\n -D HTTPD_ROOT=\"/etc/apache2\"\n -D SUEXEC_BIN=\"/usr/lib/apache2/suexec\"\n -D DEFAULT_PIDLOG=\"/var/run/apache2.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"mime.types\"\n -D SERVER_CONFIG_FILE=\"apache2.conf\"\n\n\nThank a lot if you can solve this problem.\n\nNote: Sorry for my poor English, I'm french.\n\nNote2: not 2.2.16 version is selectable here , why ?", "is_private": false, "bug_id": 49798, "id": 139323, "time": "2010-08-22T09:11:00Z", "creator": "l.declercq@nuxwin.com", "creation_time": "2010-08-22T09:11:00Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "l.declercq@nuxwin.com", "attachment_id": null, "id": 139324, "time": "2010-08-22T09:16:32Z", "bug_id": 49798, "creation_time": "2010-08-22T09:16:32Z", "is_private": false, "text": "I want say graceful, not gracefull (sorry)."}, {"count": 2, "attachment_id": null, "creator": "l.declercq@nuxwin.com", "is_private": false, "id": 139329, "time": "2010-08-22T09:34:44Z", "bug_id": 49798, "creation_time": "2010-08-22T09:34:44Z", "tags": [], "text": "Forgot the first description and read this:\n\nWhen I do an 'apache2ctl graceful', I get following warning in my apache\nerror.log:\n\n[Sun Aug 22 14:46:00 2010] [warn] long lost child came home! (pid 10436)\n\nAfter some avestigations, I found that it's the'mod_log_config' module that\ncause this issue when we use Piped Log. To show, the problem:\n\n\n'ps aux' result before do the gracefull:\n\nroot      8511  0.1  0.4   6824  4256 ?        Ss   14:18   0:03\n/usr/sbin/apache2 -k start\nroot     10502  0.0  0.0   1748   500 ?        S    14:46   0:00 /bin/sh -c\n/var/www/ispcp/engine/ispcp-apache-logger\nwww-data 10503  0.0  0.2   6192  2324 ?        S    14:46   0:00\n/usr/sbin/apache2 -k start\nroot     10504  0.0  0.2   4532  2984 ?        S    14:46   0:00 /usr/bin/perl\n/var/www/ispcp/engine/ispcp-apache-logger\nwww-data 10505  0.0  0.2   6824  2188 ?        S    14:46   0:00\n/usr/sbin/apache2 -k start\nwww-data 10506  0.0  0.2 228236  2856 ?        Sl   14:46   0:00\n/usr/sbin/apache2 -k start\nwww-data 10507  0.0  0.2 228236  2860 ?        Sl   14:46   0:00\n/usr/sbin/apache2 -k start\n\nHere, you can see my main Piped Log script process (pid 10502) and the second\n(pid 10504) that is the background process from the first (/bin/sh -c ; pid 10502).\n\nWhen I do the graceful, I get the following:\n\n[Sun Aug 22 14:52:50 2010] [notice] SIGUSR1 received.  Doing graceful restart\n[Sun Aug 22 14:52:51 2010] [notice] Stopping ispCP Apache logger (pid 10504)\n[Sun Aug 22 14:52:51 2010] [notice] Apache/2.2.16 (Debian) mod_fcgid/2.3.5\nconfigured -- resuming normal operations\n[Sun Aug 22 14:52:51 2010] [warn] long lost child came home! (pid 10502)\n[Sun Aug 22 14:52:51 2010] [notice] Starting ispCP Apache logger (pid 10579)\n\nNote: Log lines for the logger come from my logging script (Added to show the\nproblem).\n\nAfter the gracefull, my 'px aux' result is like this:\n\nroot      8511  0.1  0.4   6824  4256 ?        Ss   14:18   0:03\n/usr/sbin/apache2 -k start\nroot     10577  0.0  0.0   1748   500 ?        S    14:52   0:00 /bin/sh -c\n/var/www/ispcp/engine/ispcp-apache-logger\nwww-data 10578  0.0  0.2   6192  2324 ?        S    14:52   0:00\n/usr/sbin/apache2 -k start\nroot     10579  0.0  0.2   4532  2984 ?        S    14:52   0:00 /usr/bin/perl\n/var/www/ispcp/engine/ispcp-apache-logger\nwww-data 10580  0.0  0.2   6824  2188 ?        S    14:52   0:00\n/usr/sbin/apache2 -k start\nwww-data 10581  0.0  0.2 228236  2856 ?        Sl   14:52   0:00\n/usr/sbin/apache2 -k start\nwww-data 10582  0.0  0.2 228236  2860 ?        Sl   14:52   0:00\n/usr/sbin/apache2 -k start\n\nOk, it's just a warn but I think that should be solved.  I've tried with\nalternative syntax (Shell not involved at all) and the same problem occurs on\nthe main process.\n\nMy system:\n\nroot@ispcp:/etc/apache2/sites-available# uname -a\nLinux ispcp 2.6.32-5-686 #1 SMP Sat Jul 24 02:27:10 UTC 2010 i686 GNU/Linux\n\nThe involved SHELL:\nroot@ispcp:/etc/apache2/sites-available# ls -la /bin/sh\nlrwxrwxrwx 1 root root 4 21 ao\u00fbt  07:11 /bin/sh -> dash\n\nThe Apache information:\nroot@ispcp:/etc/apache2/sites-available# apache2ctl -V\nServer version: Apache/2.2.16 (Debian)\nServer built:   Jul 24 2010 20:24:16\nServer's Module Magic Number: 20051115:24\nServer loaded:  APR 1.4.2, APR-Util 1.3.9\nCompiled using: APR 1.4.2, APR-Util 1.3.9\nArchitecture:   32-bit\nServer MPM:     Worker\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=128\n -D HTTPD_ROOT=\"/etc/apache2\"\n -D SUEXEC_BIN=\"/usr/lib/apache2/suexec\"\n -D DEFAULT_PIDLOG=\"/var/run/apache2.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"mime.types\"\n -D SERVER_CONFIG_FILE=\"apache2.conf\"\n\n\nThank a lot if you can solve this problem.\n\nNote: Sorry for my poor English, I'm french.\n\nNote2: not 2.2.16 version is selectable here , why ?"}, {"count": 3, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 139338, "time": "2010-08-22T11:19:46Z", "bug_id": 49798, "creation_time": "2010-08-22T11:19:46Z", "is_private": false, "text": "Use \"||process args\" to launch the external logger process without invoking the shell/command interpreter. See the other issue 49768.\n\n*** This bug has been marked as a duplicate of bug 49768 ***"}, {"count": 4, "tags": [], "bug_id": 49798, "is_private": false, "text": "Sorry but it's not the same issue. I've already tried to execute without involving the SHELL. I'll try again and show you the logs result...", "id": 139345, "time": "2010-08-22T12:36:49Z", "creator": "l.declercq@nuxwin.com", "creation_time": "2010-08-22T12:36:49Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 49798, "is_private": false, "text": "Apache configuration:\n\nCustomLog \"|| /var/www/ispcp/engine/ispcp-apache-logger\" ispcplog\n\nAs you can see, the Shell is not involved here.\n\nps aux result before do the graceful:\n\nroot     15016  0.0  0.2   4532  2984 ?        S    18:39   0:00 /usr/bin/perl /var/www/ispcp/engine/ispcp-apache-logger\nwww-data 15017  0.0  0.2   6192  2300 ?        S    18:39   0:00 /usr/sbin/apache2 -k start\nwww-data 15018  0.0  0.2   6824  2164 ?        S    18:39   0:00 /usr/sbin/apache2 -k start\nwww-data 15019  0.0  0.2 228236  2840 ?        Sl   18:39   0:00 /usr/sbin/apache2 -k start\nwww-data 15020  0.0  0.2 228236  2844 ?        Sl   18:39   0:00 /usr/sbin/apache2 -k start\n\n\nps aux resulter after the graceful:\n\nroot     15089  8.0  0.2   4532  2988 ?        S    18:42   0:00 /usr/bin/perl /var/www/ispcp/engine/ispcp-apache-logger\nwww-data 15090  1.0  0.2   6192  2304 ?        S    18:42   0:00 /usr/sbin/apache2 -k start\nwww-data 15091  0.0  0.2   6824  2132 ?        S    18:42   0:00 /usr/sbin/apache2 -k start\nwww-data 15092  2.0  0.2 228236  2844 ?        Sl   18:42   0:00 /usr/sbin/apache2 -k start\nwww-data 15093  1.0  0.2 228236  2844 ?        Sl   18:42   0:00 /usr/sbin/apache2 -k start\n\nNow, the corresponding error logs:\n\n\n[Sun Aug 22 18:42:21 2010] [notice] SIGUSR1 received.  Doing graceful restart\n[Sun Aug 22 18:42:23 2010] [notice] Apache/2.2.16 (Debian) mod_fcgid/2.3.5 configured -- resuming normal operations\n[Sun Aug 22 18:42:23 2010] [warn] long lost child came home! (pid 15016)\n[Sun Aug 22 18:42:23 2010] [notice] Starting ispCP Apache logger (pid 15089)\n\n\nAs you can see, the process 15016 (my logger script) that is launch by apache cause the error with graceful.\n\nI hope you understand my sentence now.", "id": 139346, "time": "2010-08-22T12:46:26Z", "creator": "l.declercq@nuxwin.com", "creation_time": "2010-08-22T12:46:26Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "l.declercq@nuxwin.com", "attachment_id": null, "id": 139347, "time": "2010-08-22T12:50:10Z", "bug_id": 49798, "creation_time": "2010-08-22T12:50:10Z", "is_private": false, "text": "Updated to 2.2.16"}, {"count": 7, "attachment_id": null, "creator": "l.declercq@nuxwin.com", "is_private": false, "id": 139356, "time": "2010-08-23T01:39:30Z", "bug_id": 49798, "creation_time": "2010-08-23T01:39:30Z", "tags": [], "text": "Confirmed here: http://publib.boulder.ibm.com/httpserv/ihsdiag/errorlog.html#lostchildhome\n\nI'm not a crasy man..."}]
[{"attachment_id": null, "tags": [], "bug_id": 47420, "is_private": false, "count": 0, "id": 128253, "time": "2009-06-24T16:44:06Z", "creator": "abedwardsw@gmail.com", "creation_time": "2009-06-24T16:44:06Z", "text": "During load testing of a bind,add,search,delete request I noticed connections to the LDAP server we're being left open until the first full GC occured.\n\nUpon further investigation I believe I have tracked the bug down.   I have tested with the new code and it is now closing the connections properly.\n\nIn the Class org.apache.jmeter.protocol.ldap.sampler.LDAPExtSampler\nMethod Name: addTest\n\nold code:\n\n        try {\n            res.sampleStart();\n            ctx = ldap.createTest(dirContext, getUserAttributes(), getBaseEntryDN());\n        } finally {\n            res.sampleEnd();\n        }\n\n\nnew code:\n\n        try {\n            res.sampleStart();\n            DirContext ctx = ldap.createTest(dirContext, getUserAttributes(), getBaseEntryDN());\n            ctx.close();\n        } finally {\n            res.sampleEnd();\n        }"}, {"count": 1, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "This is deliberate.\n\nYou need to call bind at the start of a test sequence, and unbind at the end.", "id": 128290, "time": "2009-06-25T11:21:31Z", "bug_id": 47420, "creation_time": "2009-06-25T11:21:31Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 47420, "text": "(In reply to comment #1)\n> This is deliberate.\n> \n> You need to call bind at the start of a test sequence, and unbind at the end.\n\nsorry, didn't mention in my email that I AM calling bind/unbind.\n\nWhen the new user is created, it creates a separate context which needs to be closed.   The code appears to be missing this close.\n\nMy test sequence is\n\nThreads1\nLoops 5000\n\nThread Bind\nAdd\nSearch\nDelete\nThread Unbind\n\nIf only doing searches or deletes, there is no thread leak.  Only in the add/create.", "id": 128291, "time": "2009-06-25T11:31:35Z", "creator": "abedwardsw@gmail.com", "creation_time": "2009-06-25T11:31:35Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 47420, "text": "OK, understood. Thanks for the report.\n\nFixed in SVN:\n\nURL: http://svn.apache.org/viewvc?rev=788812&view=rev\nLog:\nBug 47420 - LDAP extended request not closing connections during add request", "id": 128330, "time": "2009-06-26T11:46:18Z", "creator": "sebb@apache.org", "creation_time": "2009-06-26T11:46:18Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Currently, the PDF library of FOP uses getBytes in various places. The behaviour\nof this functions depends on current locale. If the locale is not compatible\nwith ASCII, an invalid PDF will be generated (eg. with default locale IBM-1047).\n\nTo fix this, the getBytes call are replaced with a call to PDFDocument.encode.\nPatch is made for the 0.93 version. As the pdf library in the trunk version is\nthe same, the patch should also be applied there.\n\ndiff -urN fop-orig/fop-0.93/src/java/org/apache/fop/pdf/PDFDocument.java\nfop-brz/fop-0.93/src/java/org/apache/fop/\npdf/PDFDocument.java\n--- fop-orig/fop-0.93/src/java/org/apache/fop/pdf/PDFDocument.java     \n2007-01-03 21:44:52.000000000 +0100\n+++ fop-brz/fop-0.93/src/java/org/apache/fop/pdf/PDFDocument.java      \n2007-01-11 18:14:07.000000000 +0100\n@@ -849,7 +849,7 @@\n\n         getProfile().verifyPDFVersion();\n\n-        byte[] pdf = (\"%PDF-\" + getPDFVersionString() + \"\\n\").getBytes();\n+        byte[] pdf = encode(\"%PDF-\" + getPDFVersionString() + \"\\n\");\n         stream.write(pdf);\n         this.position += pdf.length;\n\n@@ -870,9 +870,9 @@\n         try {\n             MessageDigest digest = MessageDigest.getInstance(\"MD5\");\n             DateFormat df = new\nSimpleDateFormat(\"yyyy'-'MM'-'dd'T'HH':'mm':'ss'.'SSS\");\n-            digest.update(df.format(new Date()).getBytes());\n+            digest.update(encode(df.format(new Date())));\n             //Ignoring the filename here for simplicity even though it's\nrecommended by the PDF spec\n-            digest.update(String.valueOf(this.position).getBytes());\n+            digest.update(encode(String.valueOf(this.position)));\n             digest.update(getInfo().toPDF());\n             byte[] res = digest.digest();\n             String s = PDFText.toHex(res);\ndiff -urN fop-orig/fop-0.93/src/java/org/apache/fop/pdf/PDFRectangle.java\nfop-brz/fop-0.93/src/java/org/apache/fop\n/pdf/PDFRectangle.java\n--- fop-orig/fop-0.93/src/java/org/apache/fop/pdf/PDFRectangle.java    \n2007-01-03 21:44:49.000000000 +0100\n+++ fop-brz/fop-0.93/src/java/org/apache/fop/pdf/PDFRectangle.java     \n2007-01-11 18:20:50.000000000 +0100\n@@ -79,7 +79,7 @@\n      * @return the PDF\n      */\n     public byte[] toPDF() {\n-        return toPDFString().getBytes();\n+        return PDFDocument.encode(toPDFString());\n     }\n\n     /**\ndiff -urN fop-orig/fop-0.93/src/java/org/apache/fop/pdf/PDFStream.java\nfop-brz/fop-0.93/src/java/org/apache/fop/pd\nf/PDFStream.java\n--- fop-orig/fop-0.93/src/java/org/apache/fop/pdf/PDFStream.java       \n2007-01-03 21:44:44.000000000 +0100\n+++ fop-brz/fop-0.93/src/java/org/apache/fop/pdf/PDFStream.java 2007-01-11\n18:21:19.000000000 +0100\n@@ -57,7 +57,7 @@\n      */\n     public void add(String s) {\n         try {\n-            data.getOutputStream().write(s.getBytes());\n+            data.getOutputStream().write(PDFDocument.encode(s));\n         } catch (IOException ex) {\n             //TODO throw the exception and catch it elsewhere\n             ex.printStackTrace();", "is_private": false, "id": 98364, "creation_time": "2007-01-22T07:03:55Z", "time": "2007-01-22T07:03:55Z", "creator": "martin.koegler@brz.gv.at", "bug_id": 41434, "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "jeremias@apache.org", "is_private": false, "id": 102711, "time": "2007-05-01T02:42:15Z", "bug_id": 41434, "creation_time": "2007-05-01T02:42:15Z", "tags": [], "text": "Thank you for this patch, Martin. I've just applied it. Sorry for the delay.\nhttp://svn.apache.org/viewvc?view=rev&rev=533986"}, {"count": 2, "tags": [], "creator": "gadams@apache.org", "attachment_id": null, "id": 155951, "time": "2012-04-01T06:50:10Z", "bug_id": 41434, "creation_time": "2012-04-01T06:50:10Z", "is_private": false, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed"}]
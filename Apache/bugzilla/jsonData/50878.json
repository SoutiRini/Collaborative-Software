[{"count": 0, "tags": [], "text": "apr_stat() function is used to get information for a given file. It has four parameters: the first parameter is a apr_finfo_t struct, which is used to hold the return value, and the third parameter is used to tell apr_stat which information is required by the caller. If caller uses some specific value as the third parameter, like APR_FINFO_DEV and APR_FINFO_TYPE, only some fields of apr_finfo_t struct are filled, but not all. If caller uses APR_FINFO_NORM as the third paramter, all fields of apr_finfo_t will be filled. \n\n\nIn the bug report https://issues.apache.org/bugzilla/show_bug.cgi?id=45464, the reporter says that misusing of APR_FIFO_NORM as the third parameter causes apr_stat() to return redundant values, which are not used in the calling context, and this brings obvious delay in the reporter's using context. \n\nI check all apr_stat function call with APR_FINFO_NORM as the third parameter in the latest 2.2.17 httpd version, and find that in some places, only part of return value are used, not all, so they should not use APR_FINFO_NORM as the third parameter. I list places I find, and give out my fixing suggestions. I think that my fixing suggestion will keep the function of codes, and bring a better performance. \n\n./modules/dav/fs/repos.c:462:    rv = apr_stat(&src_finfo, src, APR_FINFO_NORM, p);\n\nfixing suggestion:\n\nrv = apr_stat(&src_finfo, src, APR_FINFO_DEV, p);\n\n\n===============================================================================\n\n./modules/dav/fs/repos.c:483:    rv = apr_stat(&dst_state_finfo, dst, APR_FINFO_NORM, p);\n\nfixing suggestion:\nrv = apr_stat(&dst_state_finfo, dst, APR_FINFO_TYPE | APR_FINFO_DEV, p);\n\n===============================================================================\n\n./srclib/apr/test/sendfile.c:149:    rv = apr_stat(&finfo, fname, APR_FINFO_NORM, p);\n\nfixing suggestion:\n\nrv = apr_stat(&finfo, fname, APR_FINFO_SIZE, p);\n\n\n===============================================================================\n./srclib/apr/test/testlfs.c:136:                       apr_stat(&finfo, TESTFN, APR_FINFO_NORM, p));\n\nfixing suggestion:\n\n apr_stat(&finfo, TESTFN, APR_FINFO_SIZE , p));", "attachment_id": null, "id": 144763, "creator": "songlinhai0543@gmail.com", "time": "2011-03-05T22:21:35Z", "bug_id": 50878, "creation_time": "2011-03-05T22:21:35Z", "is_private": false}]
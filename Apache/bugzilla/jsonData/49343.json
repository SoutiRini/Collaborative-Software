[{"count": 0, "tags": [], "bug_id": 49343, "attachment_id": null, "text": "AbstractReplicatedMap#init() is as follows.\n=====\nprotected void init(....) {\n    \n    ...skip...\n    this.rpcChannel = new RpcChannel(this.mapContextName, channel, this);\n    //add this map as a message listener\n    this.channel.addChannelListener(this);\n    //listen for membership notifications\n    this.channel.addMembershipListener(this);\n    \n    try {\n        //broadcast our map, this just notifies other members of our existence\n        broadcast(MapMessage.MSG_INIT, true);\n        //transfer state from another map\n        transferState();\n        //state is transferred, we are ready for messaging\n        broadcast(MapMessage.MSG_START, true);\n    } catch (ChannelException x) {\n        log.warn(\"Unable to send map start message.\");\n        throw new RuntimeException(\"Unable to start replicated map.\",x);\n    }\n}\n=====\n\nWhen ChannelException is thrown after this(AbstractReplicatedMap) is added to channel, \nRuntimeException is thrown.\nAnd AbstractReplicatedMap#init() is called from the constructor of \nAbstractReplicatedMap(LazyReplicatedMap or ReplicatedMap). \n\nIn a word, no one can remove this(AbstractReplicatedMap) added to channel.\n\nAs a result, trivial memory leak and IllegalArgumentException(\"Listener already exists:...) are caused. \n\n\nBest regards.", "id": 137135, "time": "2010-05-26T07:47:12Z", "creator": "kfujino@apache.org", "creation_time": "2010-05-26T07:47:12Z", "is_private": false}, {"attachment_id": 25485, "tags": [], "bug_id": 49343, "is_private": false, "count": 1, "id": 137136, "time": "2010-05-26T07:50:26Z", "creator": "kfujino@apache.org", "creation_time": "2010-05-26T07:50:26Z", "text": "Created attachment 25485\nAbstractReplicatedMap's patch\n\nI made a patch.\nThis patch contains the same fix about RpcChannel."}, {"count": 2, "tags": [], "bug_id": 49343, "attachment_id": null, "text": "Fixed in trunk and proposed for 6.0.x.", "id": 137137, "time": "2010-05-26T08:08:53Z", "creator": "kfujino@apache.org", "creation_time": "2010-05-26T08:08:53Z", "is_private": false}, {"count": 3, "tags": [], "creator": "kfujino@apache.org", "text": "This fix applied to 6.0, will be in 6.0.30 onwards.", "id": 138644, "time": "2010-07-22T22:36:18Z", "bug_id": 49343, "creation_time": "2010-07-22T22:36:18Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "attachment_id": null, "creator": "dparker33@austin.rr.com", "text": "When a multipart form submit is done (file upload), and there is a parameter\nlike this: \n\nContent-Disposition: form-data; name=\"clientName\"\nContent-Type: text/plain; charset=US-ASCII\nContent-Transfer-Encoding: 8bit\n\nThe header parse fails and the variable name becomes a concatenation of some of\nthe contents of the second and third lines.\n\nThe issue surfaced when I tried to use the Apache Java HTTPClient to upload a\nfile to my websh server. \n\nI have a tcl test client that shows working and non working variants. I also\nhave a modified version of formdata.c that has some extra logging to show what\nis going on, and a partial fix (it still has issues, but it is good enough to\nlet me continue). I also have outputs form the client, and the logging to help\nunderstand the issue. If I can't submit these via bugzilla, please email me and\nI will deliver the goods.\n\nBTW, thanks for a nice tool. I am using it to build a RESTful service for\ndistributed management applications.", "id": 107241, "time": "2007-08-24T17:30:16Z", "bug_id": 43212, "creation_time": "2007-08-24T17:30:16Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "dparker33@austin.rr.com", "attachment_id": 20704, "is_private": false, "id": 107242, "time": "2007-08-24T17:34:31Z", "bug_id": 43212, "creation_time": "2007-08-24T17:34:31Z", "text": "Created attachment 20704\nThis is the test script. It tries the same upload sequence with different header formats"}, {"count": 2, "tags": [], "creator": "dparker33@austin.rr.com", "attachment_id": 20705, "is_private": false, "id": 107243, "time": "2007-08-24T17:35:36Z", "bug_id": 43212, "creation_time": "2007-08-24T17:35:36Z", "text": "Created attachment 20705\nhacked up formdata.c that has more logging and a partial fix (you will have to update the relevant .h file because a function signature changed).\r\nThe changes are in mimeGetParamFromContDisp"}, {"count": 3, "tags": [], "creator": "dparker33@austin.rr.com", "attachment_id": 20706, "is_private": false, "id": 107244, "time": "2007-08-24T17:36:16Z", "bug_id": 43212, "creation_time": "2007-08-24T17:36:16Z", "text": "Created attachment 20706\nThis is the send output from the test script, showing the requests and responses"}, {"count": 4, "tags": [], "bug_id": 43212, "is_private": false, "id": 107245, "creation_time": "2007-08-24T17:37:04Z", "time": "2007-08-24T17:37:04Z", "creator": "dparker33@austin.rr.com", "text": "Created attachment 20707\nThis is a log except showing the extended log output while the test client was running. This matches the send.out", "attachment_id": 20707}, {"count": 5, "attachment_id": null, "creator": "ronnie.brunner@netcetera.ch", "text": "I'll look at it in a couple of days. The attachments are OK I don't need more\ninfo this stage. Thanks.", "id": 107251, "time": "2007-08-25T00:44:49Z", "bug_id": 43212, "creation_time": "2007-08-25T00:44:49Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 43212, "text": "I fixed our strchrchr, which creates the problem of the garbeled variable name,\nwhen the headers contain a semicolon.\n\nIn addition to the patch below, I'll also submit the patched webutl.c (note that\nformdata.c needs not to be modified with my patch.)\n\n--- webutl.c    (revision 533622)\n+++ webutl.c    (working copy)\n@@ -60,6 +60,7 @@\n \n /* ----------------------------------------------------------------------------\n  * strchrchr -- strchr for c0 first, or c1 if c0 fails. tag reports which trig.\n+ * returns earlier match!\n  * ------------------------------------------------------------------------- */\n char *strchrchr(const char *cs, const char c0, const char c1, char *tag)\n {\n@@ -70,17 +71,31 @@\n \n     if (cs != NULL) {\n \n-       res = strchr(cs, c0);\n+      char *res0 = NULL;\n+      char *res1 = NULL;\n+    \n+      res0 = strchr(cs, c0);\n+      res1 = strchr(cs, c1);\n \n-       if (res != NULL)\n+      if (res0 != NULL) {\n+       if (res1 != NULL) {\n+         if (res1 > res0) {\n+           res = res0;\n            *tag = 0;\n-       else {\n-\n-           res = strchr(cs, c1);\n-\n-           if (res != NULL)\n-               *tag = 1;\n+         } else {\n+           res = res1;\n+           *tag = 1;\n+         }\n+       } else {\n+         res = res0;\n+         *tag = 0;\n        }\n+      } else {\n+       if (res1 != NULL) {\n+         res = res1;\n+         *tag = 1;\n+       }\n+      }\n     }\n     return res;\n }\n\nCan you please check if your porblem is also solved by my webutl.c patch instead\nof your formdata.c patch? (I already have some additional tests and I think this\nsolves the issue, but before I commit, I'd like a confirmation from you, since\nyou brought the issue up.)", "id": 107292, "time": "2007-08-27T09:15:03Z", "creator": "ronnie.brunner@netcetera.ch", "creation_time": "2007-08-27T09:15:03Z", "is_private": false, "attachment_id": null}, {"count": 7, "attachment_id": 20714, "creator": "ronnie.brunner@netcetera.ch", "is_private": false, "id": 107293, "time": "2007-08-27T09:16:17Z", "bug_id": 43212, "creation_time": "2007-08-27T09:16:17Z", "tags": [], "text": "Created attachment 20714\nsrc/generic/webutl.c with bug fix for mutlipart formdata parsing"}, {"count": 8, "attachment_id": null, "creator": "dparker33@austin.rr.com", "is_private": false, "id": 107312, "time": "2007-08-27T22:22:32Z", "bug_id": 43212, "creation_time": "2007-08-27T22:22:32Z", "tags": [], "text": "That worked just fine, thanks very much!\n\nPlease let me know how to get it to you and I'll send you some windows binaries,\nif you want them. I am using both Linux and windows, because we need to develop\non both, and I have have noted that you don't have a windows build environment.\nIf you do a new release, send me mail and I'll build it for you.\n"}, {"count": 9, "tags": [], "bug_id": 43212, "is_private": false, "text": "Changes committed (including tests). Thanks for the hint on Windows binaries.\nI'll  get back to you on that when I'm ready for a next release...", "id": 107326, "time": "2007-08-28T03:58:41Z", "creator": "ronnie.brunner@netcetera.ch", "creation_time": "2007-08-28T03:58:41Z", "attachment_id": null}]
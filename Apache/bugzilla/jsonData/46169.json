[{"count": 0, "tags": [], "bug_id": 46169, "attachment_id": null, "text": "The just released mod_jk 1.2.27 provides the new extension \"use_server_errors\" to use Apache httpd's ErrorDocument instead of Tomcat's default error pages or <error-page> definitions in the webapp.\n\nI configured the extension in uriworkermap.properties:\n/appname*=worker1;use_server_errors=400\n\nErrorDocument und JkMountFile directives are in an Apache <VirtualHost>.\n\nHere is what I tried so far on my way to this bug report:\n- no <error-page> in web.xml = Tomcats default 404 page\n- <error-page> in web.xml using an empty file in my webapp as\n  location = Empty page\n- experiment with fail_on_status extension, which does work. This uriworkermap entry results in httpd's 503 ErrorDocument: /appname*=worker1;use_server_errors=400;fail_on_status=-404\n\nI had to compile mod_jk from source and so I took a peek at the source and added some debug logging in jk_ajp_common.c/ajp_process_callback() and jk_uri_worker_map.c/uri_worker_map_add() to dig a little deeper.\n\nNote: I'm far from grasping the whole mod_jk and so the following analysis might be completely off, but maybe I'm on the right track and we can progress from here.\n\nThe logging seems to confirm that my configuration is processed correctly but I found two issues and stopped there:\n1. In ajp_process_callback() the value of r->extension.use_server_error_pages is 0 and not 404 as i expected.\nThe response from Tomcat is therefore not blocked here and send to the client.\n2. If I hard code r->extension.use_server_error_pages = 404 in ajp_process_callback() the response is blocked but apperently httpd does not pick up and send it's ErrorDocument so the client waits with a blank window (and seems to get a http status code 200).\n\nVersion information:\n====================\n- Tomcat: 6.0.18\n- mod_jk: 1.2.27 (compiled from source, only configure option was\n--with-apxs=/path/to/apxs)\n- httpd: 1.3.34\n- JDK: 1.6.0_07\n- OS: Linux Debian 4.0 \"Etch\" Stable", "id": 122280, "time": "2008-11-07T08:16:08Z", "creator": "s.hilbig@gmail.com", "creation_time": "2008-11-07T08:16:08Z", "is_private": false}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "The feature is currently not implemented for httpd 1.3, only for 2.0 and 2.2.\nWe'll look into it. If it is simple, we'll backport it, if not that might be another good reason to finally leave httpd 1.3 behind you.\n\nThanks for reporting the issue.", "id": 122283, "time": "2008-11-07T09:21:49Z", "bug_id": 46169, "creation_time": "2008-11-07T09:21:49Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 46169, "attachment_id": 22842, "text": "Created attachment 22842\nPatch making use_server_errors work with httpd 1.3\n\nPatch based on version 1.2.27.", "id": 122289, "time": "2008-11-07T09:40:18Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-11-07T09:40:18Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 46169, "attachment_id": null, "id": 122290, "time": "2008-11-07T09:44:56Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-11-07T09:44:56Z", "is_private": false, "text": "You can test the patch, it is small and I committed it right now as revision r712207.\n\nWill be part of 1.2.28.\n\nNevertheless consider upgrading to httpd 2.2 ;)\n"}, {"count": 4, "tags": [], "bug_id": 46169, "text": "This is a test - please ignore. Sorry for the noise.\n\nworker1\n", "id": 122291, "time": "2008-11-07T09:59:43Z", "creator": "markt@apache.org", "creation_time": "2008-11-07T09:59:43Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 46169, "attachment_id": null, "id": 122331, "time": "2008-11-10T01:44:22Z", "creator": "s.hilbig@gmail.com", "creation_time": "2008-11-10T01:44:22Z", "is_private": false, "text": "(In reply to comment #3)\n> You can test the patch, it is small and I committed it right now as revision\n> r712207.\n> \n> Will be part of 1.2.28.\n\nI just integrated and tested the patch and it works as expected.\n\n> Nevertheless consider upgrading to httpd 2.2 ;)\n\nWe're not only considering but already planning the upgrade :)\nBut that will take some time and we needed to integrate Tomcat sooner, so thanks a lot for the quick response and patch!"}, {"count": 6, "tags": [], "bug_id": 46169, "text": "r1=123456\n\nMore bz/svn testing. Again, sorry for the noise/", "id": 123255, "time": "2008-12-12T04:16:02Z", "creator": "markt@apache.org", "creation_time": "2008-12-12T04:16:02Z", "is_private": false, "attachment_id": null}, {"count": 7, "attachment_id": null, "bug_id": 46169, "text": "Hopefully the last if my testing:\n\nr1=\n\nr1", "id": 123258, "time": "2008-12-12T06:40:04Z", "creator": "markt@apache.org", "creation_time": "2008-12-12T06:40:04Z", "tags": [], "is_private": false}]
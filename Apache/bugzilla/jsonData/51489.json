[{"count": 0, "tags": [], "bug_id": 51489, "text": "Created attachment 27275\nFix additional slash added by ProxyPassReverse in LoadBalancer setup\n\nWhen Apache is used as reverse proxy in a load balancer setup, the option 'ProxyPassReverse' adds an additional slash between the server name and the path in the Location: header sent to the web browser.\n\nUsed configuration (for reproduction of this issue):\n\n<Proxy balancer://196f045aca6adc82a0b6eea93ed286a1>\n\tBalancerMember http://server-1.local status=-SE\n\tBalancerMember http://server-2.local status=-SE\n</Proxy>\n<VirtualHost 10.8.16.33:80>\n\tServerName frontend.local\n\n\t<Location />\n\t\tProxyPass balancer://196f045aca6adc82a0b6eea93ed286a1/\n\t\tProxyPassReverse balancer://196f045aca6adc82a0b6eea93ed286a1/\n\t</Location>\n</VirtualHost>\n\nApparently there is no way to alter the configuration to prevent the addition of the slash.", "id": 147836, "time": "2011-07-08T16:16:23Z", "creator": "micha@lenk.info", "creation_time": "2011-07-08T16:16:23Z", "is_private": false, "attachment_id": 27275}, {"count": 1, "tags": [], "bug_id": 51489, "attachment_id": null, "text": "I found out that I have no issue at all if the config consistently uses a slash after the load balancer id.\n\n<Proxy balancer://196f045aca6adc82a0b6eea93ed286a1/>\n    BalancerMember http://server-1.local/ status=-SE\n    BalancerMember http://server-2.local/ status=-SE\n</Proxy>\n<VirtualHost 10.8.16.33:80>\n    ServerName frontend.local\n\n    <Location />\n\tProxyPass balancer://196f045aca6adc82a0b6eea93ed286a1/\n\tProxyPassReverse balancer://196f045aca6adc82a0b6eea93ed286a1/\n    </Location>\n</VirtualHost>\n\nSo, please consider the case as solved and the patch as void.", "id": 148750, "time": "2011-08-22T13:15:23Z", "creator": "micha@lenk.info", "creation_time": "2011-08-22T13:15:23Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 51489, "text": "No, consistently using a slash after the load balancer id does *not* help: In this case every backend request gets an additional slash before the path. Maybe we should fix *this* issue then...", "count": 2, "id": 150670, "time": "2011-10-17T16:50:01Z", "creator": "micha@lenk.info", "creation_time": "2011-10-17T16:50:01Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 51489, "text": "Please test\n\n<Proxy balancer://196f045aca6adc82a0b6eea93ed286a1>\n    BalancerMember http://server-1.local/ status=-SE\n    BalancerMember http://server-2.local/ status=-SE\n</Proxy>\n\nDoes this then result in doubled-slashes?", "id": 150686, "time": "2011-10-17T19:05:06Z", "creator": "wrowe@apache.org", "creation_time": "2011-10-17T19:05:06Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "yes", "attachment_id": null, "id": 150703, "creator": "micha@lenk.info", "time": "2011-10-18T08:51:55Z", "bug_id": 51489, "creation_time": "2011-10-18T08:51:55Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 51489, "text": "Does somebody have a patch for 2.2.22 for this?\n\nThe above patch seems to be for an older version and the logic seemed to have changed (I only checked .21 and .22).", "id": 158692, "time": "2012-05-01T05:47:53Z", "creator": "sven.peters@aapt.com.au", "creation_time": "2012-05-01T05:47:53Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 51489, "attachment_id": null, "id": 158743, "time": "2012-05-02T15:40:29Z", "creator": "micha@lenk.info", "creation_time": "2012-05-02T15:40:29Z", "is_private": false, "text": "I can work on an updated patch (added to my TODO list), but I will need some\ntime for it due to a lot of other things keeping me busy at the moment..."}, {"count": 7, "tags": [], "bug_id": 51489, "attachment_id": null, "id": 160997, "time": "2012-07-30T09:14:26Z", "creator": "micha@lenk.info", "creation_time": "2012-07-30T09:14:26Z", "is_private": false, "text": "I just tried to reproduce the issue again with Apache 2.4.2. Now the directive\ndoesn't work at all in a load balancer setup. :("}, {"count": 8, "attachment_id": null, "bug_id": 51489, "text": "This tiny patch for Apache 2.4.2 makes the ProxyPassReverse work again in a load balancer setup, however, the initially reported bug with the additional slash is then still unfixed:\n\n--- a/modules/proxy/proxy_util.c\n+++ b/modules/proxy/proxy_util.c\n@@ -852,6 +852,7 @@ PROXY_DECLARE(const char *) ap_proxy_location_reverse_map(request_rec *r,\n             (balancer = ap_proxy_get_balancer(r->pool, sconf, real, 1))) {\n             int n, l3 = 0;\n             proxy_worker **worker = (proxy_worker **)balancer->workers->elts;\n+            real += strlen(BALANCER_PREFIX);\n             const char *urlpart = ap_strchr_c(real, '/');\n             if (urlpart) {\n                 if (!urlpart[1])", "id": 160999, "time": "2012-07-30T10:25:26Z", "creator": "micha@lenk.info", "creation_time": "2012-07-30T10:25:26Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "creator": "micha@lenk.info", "attachment_id": null, "id": 161011, "time": "2012-07-30T18:03:38Z", "bug_id": 51489, "creation_time": "2012-07-30T18:03:38Z", "is_private": false, "text": "Ok, issue from last comment is already fixed in trunk via PR #45434."}, {"count": 10, "tags": [], "bug_id": 51489, "attachment_id": 29145, "text": "Created attachment 29145\nFix for Apache 2.4.2 (including fix for PR #45434)\n\nUsing gdb I just figured out what went wrong. Attached you can find my patch that made all things work for me using Apache 2.4.2.\n\nI also tried to craft a test case for this issue, but for whatever reason the test harness does not fail (maybe related to the intense usage of non-default ports in the test setup).", "id": 161034, "time": "2012-07-31T15:52:37Z", "creator": "micha@lenk.info", "creation_time": "2012-07-31T15:52:37Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 51489, "attachment_id": null, "text": "Ah, I missed this bug before, sorry.  Yes, this is fixed for the next 2.4.x release, I'll update CHANGES to ref this bug since it's a different bug to the 2.2 issue, and a regression.", "id": 161484, "time": "2012-08-17T13:56:18Z", "creator": "jorton@redhat.com", "creation_time": "2012-08-17T13:56:18Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 51489, "attachment_id": null, "id": 161495, "time": "2012-08-17T14:51:17Z", "creator": "micha@lenk.info", "creation_time": "2012-08-17T14:51:17Z", "is_private": false, "text": "I fear you got me wrong. The changeset you committed in SVN rev. 1374264 should be reverted, as the bug that got fixed in branch httpd-2.4.x by SVN rev. 1365604 is PR 45434 only. The issue that I reported in PR 51489 is *not* fixed by changing the CHANGES file only (as in SVN rev. 1374264).\n\nOr did I miss anything?"}, {"count": 13, "tags": [], "bug_id": 51489, "attachment_id": null, "text": "Oh, I see.  Sorry, no, I missed the point.", "id": 161496, "time": "2012-08-17T14:53:57Z", "creator": "jorton@redhat.com", "creation_time": "2012-08-17T14:53:57Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 51489, "text": "Created attachment 29248\nFix additional slash in load balancer setups\n\nI've just rewritten the patch to catch the problem more precisely.", "id": 161497, "time": "2012-08-17T15:09:10Z", "creator": "micha@lenk.info", "creation_time": "2012-08-17T15:09:10Z", "is_private": false, "attachment_id": 29248}, {"count": 15, "tags": [], "bug_id": 51489, "text": "The patch from previous comment is based on branch httpd-2.4.x, SVN rev. 1374290.", "id": 161498, "time": "2012-08-17T15:10:11Z", "creator": "micha@lenk.info", "creation_time": "2012-08-17T15:10:11Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 51489, "attachment_id": null, "text": "See:\n\nhttp://svn.apache.org/viewvc?view=revision&revision=1386576\nhttp://svn.apache.org/viewvc?view=revision&revision=1386578", "id": 162232, "time": "2012-09-17T13:24:38Z", "creator": "jim@apache.org", "creation_time": "2012-09-17T13:24:38Z", "is_private": false}]
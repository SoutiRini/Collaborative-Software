[{"count": 0, "tags": [], "bug_id": 12606, "attachment_id": null, "id": 22785, "time": "2002-09-13T06:16:33Z", "creator": "AdnanMukhtar@hotmail.com", "creation_time": "2002-09-13T06:16:33Z", "is_private": false, "text": "the new optimization in jasper2 sometimes creates multiple declarations of the \nsame variable name in the generated servlet - jsp compilation fails.\n\nIt happened for me on strut's <logic:iterate> tags. the two variables were \nthe \"id\" and the \"indexId\" attribute of the tag:\n\nGENERATED SERVLET (snippett):\n\n  public void _jspService(...) throws ... {\n\n    JspFactory _jspxFactory = null;\n    ...\n    JspWriter _jspx_out = null;\n\n    /* FIRST DECL *********************************/\n    org.sureguidance.Comment _jspx_comment_1 = null;\n    java.lang.Integer _jspx_commentIndex_1 = null;\n    /**********************************************/\n\n    try {\n      _jspxFactory = JspFactory.getDefaultFactory();\n      response.setContentType(\"text/html;charset=ISO-8859-1\");\n      pageContext = _jspxFactory.getPageContext(this, request, response,\n                        null, true, 8192, true);\n      ...\n            do {\n              out.write(\"\\n    \");\n              /* ----  logic:iterate ---- */\n              /* SECOND DECL *********************************/\n              org.sureguidance.Comment _jspx_comment_1 = comment;\n              java.lang.Integer _jspx_commentIndex_1 = commentIndex;\n              /**********************************************/\n\nnote that in the second decl, the variables \"comment\" and \"commentIndex\"\nwere not defined previously in the servlet: cause for another compilation \nerror.\n\n\nJSP:\n\n...\n<div class=\"LeftSubNavStyle\">\n  <logic:iterate id=\"section\"\n      name=\"chapter\"\n      property=\"sectionsList\"\n      type=\"org.sureguidance.Section\"\n      indexId=\"sectionIndex\">\n    <logic:iterate id=\"comment\"\n        name=\"section\"\n        property=\"commentsList\"\n        type=\"org.sureguidance.Comment\"\n        indexId=\"commentIndex\">\n      <bean:define id=\"commentAnchor\" name=\"comment\" property=\"anchor\"\n        type=\"java.lang.String\"/>\n      <logic:notEqual name=\"comment\" property=\"subject\" value=\"\">\n        <b><bean:write name=\"comment\" property=\"index\"/>.</b>\n\nnote that \"section\" and \"sectionIndex\" do not have this problem ????\n\ncontact me if you need complete code and the error page.\n\nthanx,\nyou guys rock!!!"}, {"count": 1, "text": "Created attachment 3037\nleftNav_jsp.java", "bug_id": 12606, "is_private": false, "id": 22787, "time": "2002-09-13T06:19:38Z", "creator": "AdnanMukhtar@hotmail.com", "creation_time": "2002-09-13T06:19:38Z", "tags": [], "attachment_id": 3037}, {"count": 2, "tags": [], "bug_id": 12606, "attachment_id": 3038, "text": "Created attachment 3038\nleftNav.jsp", "id": 22788, "time": "2002-09-13T06:20:50Z", "creator": "AdnanMukhtar@hotmail.com", "creation_time": "2002-09-13T06:20:50Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 12606, "attachment_id": null, "id": 22790, "time": "2002-09-13T07:58:50Z", "creator": "ykaya@alexsys.be", "creation_time": "2002-09-13T07:58:50Z", "is_private": false, "text": "I have the same problem with this code:\n\n<logic:iterate id=\"c\" name=\"contact\" property=\"contacts\">\n  <tr>\n    <td>\n      <bean:write name=\"c\" property=\"name\"/>\n      <br><bean:message key=\"prompt.tel\"/> : <bean:write name=\"c\" \nproperty=\"phone\"/>\n      <br><bean:message key=\"prompt.fax\"/> :  <bean:write name=\"c\" \nproperty=\"fax\"/>\n      <br><bean:message key=\"prompt.email\"/> :<a href=\"mailto:<bean:write \nname=\"c\" property=\"email\"/>\"><bean:write name=\"c\" property=\"email\"/></a>\n    </td>\n    <td>\n    <logic:iterate id=\"element\" name=\"c\" property=\"titles\">\n\t<bean:write name=\"element\" property=\"\"/>\n\t<br>\n    </logic:iterate>\n    </td>\n  </tr>\n</logic:iterate>\n\nIt seems that the problem happens in nested iteration tags. I think the local \nvariable is declared as global, so when trying to redeclare the variable during \niteration, an error happens."}, {"count": 4, "tags": [], "creator": "jan.luehe@sun.com", "attachment_id": null, "is_private": false, "id": 22841, "time": "2002-09-13T17:37:11Z", "bug_id": 12606, "creation_time": "2002-09-13T17:37:11Z", "text": "Fixed in tomcat_4_branch.\n\nFix should show up in nightly build (if there is any), or will be\nreflected in the next Tomcat release.\n\nIf there is no nightly build, and until the next release,\nyou can build the two Jasper JARs yourself\n(by checking out and compiling the files in the \n\n  tomcat_4_branch/jakarta-tomcat-jasper/jasper2\n  \ncvs repository) and copy them into the common/lib directory of your Tomcat\nbuild (replacing the ones that are already present there). Make sure your\nTomcat build does not contain jasper-compiler.jar and jasper-runtime.jar\nfiles in any other location."}]
[{"count": 0, "tags": [], "bug_id": 51161, "text": "I am using the maven-antrun-plugin 1.6 with the <input> task and the default input handler. When I enter input, it throws a BuildException, \"Failed to read input from Console\". The root exception is:\n\n\njava.io.IOException: Stream closed\n        at java.io.BufferedInputStream.getBufIfOpen(BufferedInputStream.java:145)\n        at java.io.BufferedInputStream.read(BufferedInputStream.java:308)\n        at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:264)\n        at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:306)\n        at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:158)\n        at java.io.InputStreamReader.read(InputStreamReader.java:167)\n        at java.io.BufferedReader.fill(BufferedReader.java:136)\n        at java.io.BufferedReader.readLine(BufferedReader.java:299)\n        at java.io.BufferedReader.readLine(BufferedReader.java:362)\n\n\nI was able to fix this issue by wrapping the input stream in KeepAliveInputStream as follows:\n\n    public void handleInput(InputRequest request) throws BuildException {\n        String prompt = getPrompt(request);\n        BufferedReader r = null;\n        try {\n            r = new BufferedReader(new InputStreamReader(new KeepAliveInputStream(getInputStream())));\n            do {\n                System.err.print(prompt + \": \");\n                System.err.flush();\n                try {\n                    String input = r.readLine();\n                    request.setInput(input);\n                } catch (IOException e) {\n                    throw new BuildException(\"Failed to read input from\"\n                                             + \" Console.\", e);\n                }\n            } while (!request.isInputValid());\n        } finally {\n            if (r != null) {\n                try {\n                    r.close();\n                } catch (IOException e) {\n                    throw new BuildException(\"Failed to close input.\", e);\n                }\n            }\n        }\n    }", "id": 146170, "attachment_id": null, "creator": "kldavis4@gmail.com", "creation_time": "2011-05-06T18:50:47Z", "time": "2011-05-06T18:50:47Z", "is_private": false}, {"count": 1, "tags": [], "creator": "nicolas.lalevee@hibnet.org", "attachment_id": null, "is_private": false, "id": 146952, "time": "2011-06-08T08:41:14Z", "bug_id": 51161, "creation_time": "2011-06-08T08:41:14Z", "text": "I am not that used to write pom.xml file. Could you provide a piece of pom.xml which reproduce the bug please ?"}, {"count": 2, "tags": [], "text": "The following pom will generate the error:\n\n\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <groupId>org.help</groupId>\n    <artifactId>Test</artifactId>\n    <version>1.0-SNAPSHOT</version>\n    <packaging>jar</packaging>\n    <name>Test</name>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-antrun-plugin</artifactId>\n                <version>1.6</version>\n                <executions>\n                    <execution>\n                        <id>configure-resources</id>\n                        <phase>generate-resources</phase>\n                        <configuration>\n                            <target>\n                                <input message=\"Enter Foo Property\" addproperty=\"foo.property\" defaultvalue=\"FOO\"/>\n                                <input message=\"Enter Bar Property\" addproperty=\"bar.property\" defaultvalue=\"BAR\"/>\n                            </target>\n                        </configuration>\n                        <goals>\n                            <goal>run</goal>\n                        </goals>\n                    </execution>\n                </executions>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\nexecute 'mvn generate-sources'", "attachment_id": null, "id": 146958, "creator": "kldavis4@gmail.com", "time": "2011-06-08T12:17:30Z", "bug_id": 51161, "creation_time": "2011-06-08T12:17:30Z", "is_private": false}, {"count": 3, "tags": [], "text": "Sorry for the late follow up, but I cannot reproduce the error. I tried with both maven 2 and maven 3. Here is what I got:\n\nhibou@hibpro ~/dev/ant/svn/core/trunk/tmp $ mvn generate-sources       \n[INFO] Scanning for projects...\n[INFO]                                                                         \n[INFO] ------------------------------------------------------------------------\n[INFO] Building Test 1.0-SNAPSHOT\n[INFO] ------------------------------------------------------------------------\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 0.135s\n[INFO] Finished at: Sun Jul 24 13:52:29 CEST 2011\n[INFO] Final Memory: 2M/81M\n[INFO] ------------------------------------------------------------------------\nhibou@hibpro ~/dev/ant/svn/core/trunk/tmp $ mvn2 generate-sources      \n[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Building Test\n[INFO]    task-segment: [generate-sources]\n[INFO] ------------------------------------------------------------------------\n[INFO] No goals needed for project - skipping\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESSFUL\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: < 1 second\n[INFO] Finished at: Sun Jul 24 13:52:36 CEST 2011\n[INFO] Final Memory: 2M/81M\n[INFO] ------------------------------------------------------------------------", "is_private": false, "bug_id": 51161, "id": 148104, "time": "2011-07-24T11:54:32Z", "creator": "nicolas.lalevee@hibnet.org", "creation_time": "2011-07-24T11:54:32Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 51161, "text": "Ok, sorry about that. If you run 'mvn generate-sources' it doesn't run the ant plugin. Please run it with 'mvn compile'. That should trigger the problem.", "id": 148189, "attachment_id": null, "creator": "kldavis4@gmail.com", "creation_time": "2011-07-26T18:33:43Z", "time": "2011-07-26T18:33:43Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 51161, "text": "reproduced and fixed. Thanks for your report.", "id": 148194, "attachment_id": null, "creator": "nicolas.lalevee@hibnet.org", "creation_time": "2011-07-26T22:03:09Z", "time": "2011-07-26T22:03:09Z", "is_private": false}]
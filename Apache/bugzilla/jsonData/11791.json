[{"count": 0, "attachment_id": null, "bug_id": 11791, "text": "in merge_env_dir_configs the following code exists:\n\n    arr = apr_table_elts(add->unsetenv);\n    elts = (const apr_table_entry_t *)arr->elts;\n\nhowever the definition of apr_table_elts just returns what is passed. This means\nthat arr is set to NULL if add->unsetenv is NULL. At this point arr->elts causes\na dereference through a NULL pointer and segfaults the server. from dbx:\n\n(/tool/lang8.1/SUNWspro/bin/../WS6U1/bin/sparcv9/dbx) where                 \ncurrent thread: t@5\n=>[1] merge_env_dir_configs(p = 0x1b0d68, basev = 0x1239d0, addv = 0x1b88f8),\nline 114 in \"mod_env.c\"\n\n(/tool/lang8.1/SUNWspro/bin/../WS6U1/bin/sparcv9/dbx) print *add\n*add = {\n    vars     = 0x1b8900\n    unsetenv = (nil)\n}\n\n\nThis only seems to occour when a .htaccess contains a SetEnv directive or any of\nthe subdirectories contain a .htaccess with a SetEnv directive, ie:\n\nif\nSetEnv foo bla exists in /foo/.htaccess\nGET /foo/ HTTP/1.0\nsegfaults\n\nSetEnv foo bla exists in /foo/bla/.htaccess\nGET /foo/ HTTP/1.0\nsegfaults\n\nSetEnv foo bla exists in /foo/bla/a/.htaccess\nGET /foo/ HTTP/1.0\nsucceeds.\n\nhowever if there is no SetEnv in /foo/.htaccess\nGET /foo/ HTTP/1.0\nsucceeds. /foo/.htaccess may contain other directives and remains unaffected.\n\nthis also only seems to apply if an index doesnt exist, ie mod_autoindex will\nreturn a directory index.\n\nthis was tested under solaris 8, SUN cc:\ncc: Sun WorkShop 6 update 1 C 5.2 2000/09/11\n\nI have server configs, binaries and core files of this in action that I am able\nto provide.", "id": 21202, "time": "2002-08-17T16:51:55Z", "creator": "timh@rd.bbc.co.uk", "creation_time": "2002-08-17T16:51:55Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "timh@rd.bbc.co.uk", "attachment_id": null, "id": 21204, "time": "2002-08-17T17:05:42Z", "bug_id": 11791, "creation_time": "2002-08-17T17:05:42Z", "is_private": false, "text": "a fix seems to be replacing \nres->unsetenv = NULL;\nwith\nres->unsetenv = apr_table_make(p, 10);\n"}, {"count": 2, "tags": [], "bug_id": 11791, "attachment_id": null, "text": "This PR has been fixed in the latest CVS HEAD. A check was put in to avoid\naccessing the structure if the value was NULL.\n\nThank you for reporting this issue.", "id": 21674, "time": "2002-08-24T19:04:55Z", "creator": "rederpj@remulak.net", "creation_time": "2002-08-24T19:04:55Z", "is_private": false}]
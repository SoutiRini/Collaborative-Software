[{"count": 0, "tags": [], "creator": "nettings@apache.org", "attachment_id": null, "id": 94123, "time": "2006-09-26T15:28:23Z", "bug_id": 40609, "creation_time": "2006-09-26T15:28:23Z", "is_private": false, "text": "try the following on zones:\nlog in as user lenya.\nadd user lenya to the reviewers group (don't know if that's important).\ngo to site overview, select page \"document type examples\".\nopen \"ac authoring\" tab.\nas an inheritable credential, add { group:edit, role:edit, deny}.\nas an inheritable credential, add { group:admin, role:edit: grant}.\n\nvoila:\n\nThe undefined value has no properties.\n\norg.apache.cocoon.ProcessingException: Error calling continuation at [EcmaError]\n-\nfile:/export/home/lenya/src/lenya-trunk/build/lenya/webapp/lenya/usecases/usecases.js:268:0\nat\nfile:/export/home/lenya/src/lenya-trunk/build/lenya/webapp/lenya/usecases/usecases.js:268\nat <map:call> -\nfile:/export/home/lenya/src/lenya-trunk/build/lenya/webapp/lenya/usecases/usecase.xmap:97:39\nat <map:mount> -\nfile:/export/home/lenya/src/lenya-trunk/build/lenya/webapp/sitemap.xmap:580:113\n\ncause: ConversionError: The undefined value has no properties.\n(file:/export/home/lenya/src/lenya-trunk/build/lenya/webapp/lenya/usecases/usecases.js;\nline 268)\n\n\nunfortunately, this leaves you locked out. admin cannot even view this page\nanymore, let alone repair settings via the gui."}, {"count": 1, "tags": [], "bug_id": 40609, "is_private": false, "text": "If you switch the rights then it will work again. \n\nI do not consider this a bug, but a feature. Proofs that the ac is working in\nlocking out the ones that you define. \n\nIf you did not got locked out then we need to worry. ", "id": 94124, "time": "2006-09-26T15:36:39Z", "creator": "thorsten@apache.org", "creation_time": "2006-09-26T15:36:39Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 40609, "is_private": false, "text": "again:\n\nlog in as user lenya.\ngo to site overview, select page \"document type examples\".\nopen \"ac authoring\" tab.\nas an inheritable credential, add { group:edit, role:edit, deny}.\npress \"add\".\nas an inheritable credential, add { group:admin, role:edit: grant}.\npress \"add\". pooof.\n\n\nthe problems are these:\n\n\nthe usecase permissions for tab.acLive are \"admin/grant\".\nlenya (as an admin) should be able to commit the second change, even\nafter taking away the edit permission for one of its own group\naccreditables, as changing ac calls for the \"admin\" role (which was\nnever touched). that seems like a big bug.\n\nthe user does not get a meaningful error message, and lenya throws an\nexception. that is perhaps a small bug, but it needs to be fixed.\n\nafter the entire transaction (which only touched the *edit* role), user\nlenya can no longer *view* the page. \"world\" should still be able to\nview the page, and lenya is \"world\". plus the *view* role was never\ntouched as well in the entire test case. that looks like another mother\nof a bug.\n\nand even if this all is due to some misconception of mine (which might\nwell be the case), it would be a lot more polite to point out my errors\nin understanding and give me a chance to close the bug than marking it\nas invalid without giving it more that a passing glance. i may be alone\nin this, but for me, ac is serious stuff. if i'm totally not grokking\nit, that's at least a serious documentation issue.\n", "id": 94159, "time": "2006-09-27T11:43:27Z", "creator": "nettings@apache.org", "creation_time": "2006-09-27T11:43:27Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 40609, "attachment_id": null, "text": "(In reply to comment #2)\n<some ranting/>\n\napologies for venting my anger like this in bugzilla. that is clearly\ninappropriate. the technical issue stands, however.\n", "id": 94202, "time": "2006-09-28T07:15:53Z", "creator": "nettings@apache.org", "creation_time": "2006-09-28T07:15:53Z", "is_private": false}, {"count": 4, "tags": [], "creator": "thorsten@apache.org", "attachment_id": null, "id": 94213, "time": "2006-09-28T10:07:09Z", "bug_id": 40609, "creation_time": "2006-09-28T10:07:09Z", "is_private": false, "text": "http://svn.apache.org/viewvc/lenya/trunk/src/modules-core/ac-impl/java/src/org/apache/lenya/ac/impl/PolicyAuthorizer.java?view=markup\n protected boolean authorizePolicy(\n        Identity identity,\n        Request request,\n        String webappUrl)\n...\nCredential[] credentials = policy.getCredentials(identity);\n        for (int i = 0; i < credentials.length; i++) {\n\t\t\tCredential credential = credentials[i];\n\t\t\tfor (int j = 0; j < roles.length; j++) {\n                            Role role = roles[j];\n                            if (credential.contains(role)){\n                                    String method=credential.getMethod();\n                                    if (method.equals(CredentialImpl.GRANT)){\n                                        authorized=true;\n                                    }\n                                    out=true;\n                                    break;\n                                }\n\t\t\t}\n                        if(out)\n                            break;\n\t\t}\n        saveRoles(request, roles);\n        return authorized;\n...\n\nWrite now we follow with above code \nhttp://lenya.apache.org/docs/1_4/reference/ac.html#Concept\n\"When a credential is found which assigns the role r to the accreditable a,\nreturn the method of the credential.\"\n\nThe problem is that the request right now *does not* attach the requested role\n(but all possible roles for the user) to the request. Meaning the above looks\ninto role[] and test each role. If we find a deny then we return false. \n\nWhat this bug report means is to extend this method to test each role[] and if\nit is denyied then remove the role[it] from the array. If we traversed all roles\nand roles.length == 0 then we return false otherwise true (authorised with a\nrole that did not got denied).\n"}, {"count": 5, "tags": [], "bug_id": 40609, "text": "i changed the summary, because my inital guess was wrong.\nthe ac data is not corrupted. instead there is a bug in the ac role resolver (as\ndescribed above by thorsten).", "id": 94312, "time": "2006-09-30T08:28:48Z", "creator": "nettings@apache.org", "creation_time": "2006-09-30T08:28:48Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 40609, "attachment_id": null, "id": 95750, "time": "2006-11-13T01:24:20Z", "creator": "andreas@apache.org", "creation_time": "2006-11-13T01:24:20Z", "is_private": false, "text": "(In reply to comment #2)\n\n> log in as user lenya.\n> go to site overview, select page \"document type examples\".\n> open \"ac authoring\" tab.\n> as an inheritable credential, add { group:edit, role:edit, deny}.\n> press \"add\".\n> as an inheritable credential, add { group:admin, role:edit: grant}.\n> press \"add\". pooof.\n\nThis works now."}, {"count": 7, "text": "Renaming Lenya 1.4 to 2.0", "bug_id": 40609, "attachment_id": null, "id": 105512, "time": "2007-07-16T01:58:59Z", "creator": "thorsten@apache.org", "creation_time": "2007-07-16T01:58:59Z", "tags": [], "is_private": false}]
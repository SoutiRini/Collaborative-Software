[{"count": 0, "tags": [], "bug_id": 19958, "is_private": false, "text": "We are having problems reading the ServletInputStream in\nTomcat 5.0.2. The data read is not what is expected.\n\nThe enclosed webapp example works fine in Tomcat 4.0.6 and\n4.1.24 .. but does NOT using 5.0.2 !!\n\nThe intent is to continue reading the request's input stream\nafter Tomcat has read the headers. For example we are having\nproblems parsing multipart/form-data posts and anything else\nthat contains data after the headers.\n\nThe enclosed zip file contains a webapp that can be used to\nduplicable the failure. I have enclosed log output the example\nwebapp produces from TC4.1 and TC5.0.\n\nI will post the zip file in a moment.\n\n1. unzip the enclised test.zip info c:\\ .. that is what the\n   server.xml files assume anyway\n\n2. test under TC4.1.24\n\n\ta. copy the tc41-server.xml to the tc41 config folder as server.xml\n\tb. start tc4.1.24\n\tc. start IE\n\td. ping http://server:8080/test/test\n\te. a form show be showing\n\tf. use the browse button and select the enclosed test.jpg file\n\tg. click submit\n\th. exit IE\n\ti. stop TC\n\tj. examine the log file (i have enclosed sample output in tc41.log)\n\t\n3. test under TC5.0.2\n\n\ta. copy the tc50-server.xml to the tc50 config folder as server.xml\n\tb. start tc5.0.2\n\tc. start IE\n\td. ping http://server:8080/test/test\n\te. a form show be showing\n\tf. use the browse button and select the enclosed test.jpg file\n\tg. click submit\n\th. exit IE\n\ti. stop TC\n\tj. examine the log file (i have enclosed sample output in tc50.log)\n\n4. compare the two log files .. note that the data read using TC5 is bad.", "id": 37258, "time": "2003-05-15T16:06:39Z", "creator": "lkarpel@eloquent.com", "creation_time": "2003-05-15T16:06:39Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "lkarpel@eloquent.com", "is_private": false, "id": 37259, "attachment_id": 6364, "bug_id": 19958, "creation_time": "2003-05-15T16:09:38Z", "time": "2003-05-15T16:09:38Z", "text": "Created attachment 6364\nExample webapp that demontrates the specified problem."}, {"count": 2, "tags": [], "creator": "remm@apache.org", "text": "I completely rewrote input handling based on the model used for output, and it\nis now much faster (and memory efficient). Maybe there are bugs that slipped\nthrough my tests, though (so I'll look into the report).", "id": 37264, "attachment_id": null, "bug_id": 19958, "creation_time": "2003-05-15T17:41:45Z", "time": "2003-05-15T17:41:45Z", "is_private": false}, {"text": "The workaround I'm using right now is to wrap request.getInputStream() with a\nBufferedInputStream. \n\nI'm also looking at that bug (but I'm not as good as Remy ;-) )\n\n-- Jeanfrancois", "tags": [], "bug_id": 19958, "is_private": false, "count": 3, "id": 37266, "time": "2003-05-15T17:56:10Z", "creator": "jfarcand@apache.org", "creation_time": "2003-05-15T17:56:10Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 19958, "attachment_id": null, "id": 37281, "time": "2003-05-15T19:49:02Z", "creator": "remm@apache.org", "creation_time": "2003-05-15T19:49:02Z", "is_private": false, "text": "I could reproduce the bug. The problem was that the input stream was incorrectly\nusing read() from the input buffer (instead, it should use readByte(); you can\npretty much imagine what was going on from there).\nNote that using readLine with the input stream is very inefficient (what it\nactually does is byte by byte reading). I'm not sure this can be optimized,\nunless I add marking support to byte reading (not sure if it's worth it).\n\nIronically, I tested the readLine() method of the reader a lot more (probably\nbecause it looks totally nasty ;-) ).\n\nThanks for the test case. If all bug reports were like that, maybe there would\nbe zero open bugs in BZ ..."}, {"count": 5, "tags": [], "creator": "lkarpel@eloquent.com", "attachment_id": null, "text": "I have tested against the latest nightlies and all is now ok .. thanks.", "id": 37701, "time": "2003-05-23T21:55:43Z", "bug_id": 19958, "creation_time": "2003-05-23T21:55:43Z", "is_private": false}]
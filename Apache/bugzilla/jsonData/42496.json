[{"attachment_id": null, "tags": [], "bug_id": 42496, "is_private": false, "count": 0, "id": 103543, "time": "2007-05-23T08:14:15Z", "creator": "thorsten@apache.org", "creation_time": "2007-05-23T08:14:15Z", "text": "Javier Puerto has done some JMeter tests against the default pub.\n\nBottom line is everything is fine if only one user is creating content, as soon\nthere is another user creating documents lenya is failing. Meaning we have a\nproblem with concurrence."}, {"count": 1, "attachment_id": 20247, "creator": "thorsten@apache.org", "is_private": false, "id": 103544, "time": "2007-05-23T08:14:59Z", "bug_id": 42496, "creation_time": "2007-05-23T08:14:59Z", "tags": [], "text": "Created attachment 20247\nlenyaJMeterTest"}, {"count": 2, "tags": [], "bug_id": 42496, "attachment_id": 20248, "text": "Created attachment 20248\nLog for the jmeter test run", "id": 103545, "time": "2007-05-23T08:15:38Z", "creator": "thorsten@apache.org", "creation_time": "2007-05-23T08:15:38Z", "is_private": false}, {"count": 3, "attachment_id": 20249, "bug_id": 42496, "text": "Created attachment 20249\njmeter user", "id": 103546, "time": "2007-05-23T08:16:08Z", "creator": "thorsten@apache.org", "creation_time": "2007-05-23T08:16:08Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 42496, "is_private": false, "text": "Can we add the test files to modules/development/tests/jmeter/?", "id": 103549, "time": "2007-05-23T08:22:26Z", "creator": "andreas@apache.org", "creation_time": "2007-05-23T08:22:26Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "andreas@apache.org", "text": "The log contains an error about a particular entity in an i18n catalogue:\n\nCaused by: org.xml.sax.SAXParseException: The entity \"iexcl\" was referenced, but\nnot declared.\n", "id": 103550, "time": "2007-05-23T08:36:47Z", "bug_id": 42496, "creation_time": "2007-05-23T08:36:47Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 42496, "text": "Would it be possible to provide an English version of the test case? TIA!", "count": 6, "id": 103551, "time": "2007-05-23T08:39:34Z", "creator": "andreas@apache.org", "creation_time": "2007-05-23T08:39:34Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 42496, "is_private": false, "count": 7, "id": 103552, "time": "2007-05-23T08:53:32Z", "creator": "andreas@apache.org", "creation_time": "2007-05-23T08:53:32Z", "text": "Am I right that one has to create the users admin1 and admin2?"}, {"attachment_id": null, "tags": [], "bug_id": 42496, "is_private": false, "count": 8, "id": 103553, "time": "2007-05-23T08:55:42Z", "creator": "thorsten@apache.org", "creation_time": "2007-05-23T08:55:42Z", "text": "Yes you need to create both user. Will attach the access files."}, {"count": 9, "tags": [], "bug_id": 42496, "text": "Created attachment 20250\njmeter user admin 1 to 5 (passwd: levi)", "id": 103554, "time": "2007-05-23T08:57:49Z", "creator": "thorsten@apache.org", "creation_time": "2007-05-23T08:57:49Z", "is_private": false, "attachment_id": 20250}, {"count": 10, "attachment_id": null, "creator": "andreas@apache.org", "text": "It looks like the sitetree is modified without locking its repository node ...", "id": 103599, "time": "2007-05-24T02:48:21Z", "bug_id": 42496, "creation_time": "2007-05-24T02:48:21Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 42496, "attachment_id": null, "id": 103601, "time": "2007-05-24T02:55:36Z", "creator": "andreas@apache.org", "creation_time": "2007-05-24T02:55:36Z", "is_private": false, "text": "Well, I don't see much we can do about this besides making the usecases in\nquestion pessimistic."}, {"count": 12, "tags": [], "bug_id": 42496, "text": "Setting the create usecase to pessimistic avoids the exception. Of course the\ndocuments aren't created anymore.", "id": 103616, "time": "2007-05-24T05:52:05Z", "creator": "andreas@apache.org", "creation_time": "2007-05-24T05:52:05Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "creator": "thorsten@apache.org", "attachment_id": null, "id": 103619, "time": "2007-05-24T05:59:13Z", "bug_id": 42496, "creation_time": "2007-05-24T05:59:13Z", "is_private": false, "text": "(In reply to comment #12)\n> Setting the create usecase to pessimistic avoids the exception. Of course the\n> documents aren't created anymore.\n\njeje.\n\nJavier and I talked about it and a possible fix is to introduce a cue. \nadmin 1 and 2 are trying to create content at the time. Instead directly\nallowing it, each creation goes into a cue and lenya will process it one after\nthe other.\n\nBTW Daisy is the only CMS that did not made any problems with concurrence. I\nstill have not found enough time to look in their repository implementation, but\nI think it is worthwhile."}, {"count": 14, "tags": [], "text": "(In reply to comment #13)\n\n> Javier and I talked about it and a possible fix is to introduce a cue. \n> admin 1 and 2 are trying to create content at the time. Instead directly\n> allowing it, each creation goes into a cue and lenya will process it one after\n> the other.\n\nThe problem with queues is that they're not suitable for interactive scenarios\nwhen the same resources are affected. Imagine that two people would like to\ncreate a document with the same URL. When using a queue, you have no chance to\ngive feedback to the user. IMO pessimistic offline lock is more suitable in this\nsituation.", "attachment_id": null, "bug_id": 42496, "id": 103620, "time": "2007-05-24T06:08:21Z", "creator": "andreas@apache.org", "creation_time": "2007-05-24T06:08:21Z", "is_private": false}, {"count": 15, "tags": [], "text": "With the pessimistic usecases, I still get two types of exceptions when running\nthe app in the debugger:\n\n- indexer is busy (we have to avoid this)\n- document not referenced in site structure (apparently inconsistent data)", "is_private": false, "bug_id": 42496, "id": 103622, "time": "2007-05-24T06:48:26Z", "creator": "andreas@apache.org", "creation_time": "2007-05-24T06:48:26Z", "attachment_id": null}, {"count": 16, "attachment_id": null, "bug_id": 42496, "is_private": false, "id": 103624, "time": "2007-05-24T07:07:50Z", "creator": "thorsten@apache.org", "creation_time": "2007-05-24T07:07:50Z", "tags": [], "text": "(In reply to comment #14)\n...\n> The problem with queues is that they're not suitable for interactive scenarios\n> when the same resources are affected. Imagine that two people would like to\n> create a document with the same URL. When using a queue, you have no chance to\n> give feedback to the user. IMO pessimistic offline lock is more suitable in this\n> situation.\n\nActually there is a chance but it costs a call more. Before sending to the cue\nthe cue needs to be validated that the same URL is not already in it. If not in\nthe cue the user gets a message that his document is in the cue. If it is in the\ncue then she gets the message to choose another name.\n\nThe only thing that needs changes is the forward after creation. I think a nice\najax dialog would be nice, like telling the user to stand by or do other stuff\nmeanwhile. Using notifications as soon the new doc is out of the cue the user\ngets feedback.\n\n"}, {"count": 17, "tags": [], "bug_id": 42496, "attachment_id": null, "is_private": false, "id": 103626, "time": "2007-05-24T07:30:55Z", "creator": "andreas@apache.org", "creation_time": "2007-05-24T07:30:55Z", "text": "(In reply to comment #16)\n\nYou mean you'd combine a queue (asynchronous) with request-based user\ninteraction (synchronous)? I'm not quite sure how this should be implemented in\na reasonable way - would you add a loop to the usecase which waits for the\nqueued task to be executed?"}, {"count": 18, "tags": [], "bug_id": 42496, "is_private": false, "text": "(In reply to comment #17)\n> You mean you'd combine a queue (asynchronous) with request-based user\n> interaction (synchronous)? I'm not quite sure how this should be implemented in\n> a reasonable way - would you add a loop to the usecase which waits for the\n> queued task to be executed?\n\nThe \"flow\" would be:\na) user requests ...?lenya.usecase=sitemanagement.create and submits\nb) doCheckExecutionConditions() checks whether the url is in the cue, if not it\nlocks it in the cue and we hit doExecute() (-> go on with c)). If in the cue\naddErrorMessage(\"path-already-exists\", params);\nc) Instead doing setDefaultTargetURL(document.getCanonicalWebappURL()); like\nright now we can send him to an ajax based cue overview (which gets updated in\nreal time from the cue worker). In combination (or alternatively) we can use a\ncheckbox to request a notification from the worker as soon he has done the document.\n\nThe cue must be serializable and further keep state of the operation (log\nerror/success). After a cue item is finished we write to the sitetree.\n\nTo answer: \"would you add a loop to the usecase which waits for the queued task\nto be executed\" No, since the execution is to put it in the cue. The only\ndownside is that the user is not be able to see directly the new page.\n", "id": 103633, "time": "2007-05-24T08:14:45Z", "creator": "thorsten@apache.org", "creation_time": "2007-05-24T08:14:45Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 42496, "text": "When setting the create usecase to pessimistic and applying the patch 20269 for\nbug 42510, I can run the test with a clean log. Some of the documents aren't\ncreated, though (when the sitetree repo node is locked by another thread).", "count": 19, "id": 103634, "time": "2007-05-24T08:17:57Z", "creator": "andreas@apache.org", "creation_time": "2007-05-24T08:17:57Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 42496, "text": "(In reply to comment #18)\n> (In reply to comment #17)\n> > You mean you'd combine a queue (asynchronous) with request-based user\n> > interaction (synchronous)? I'm not quite sure how this should be implemented in\n> > a reasonable way - would you add a loop to the usecase which waits for the\n> > queued task to be executed?\n> \n> The \"flow\" would be:\n> a) user requests ...?lenya.usecase=sitemanagement.create and submits\n> b) doCheckExecutionConditions() checks whether the url is in the cue, if not it\n> locks it in the cue and we hit doExecute() (-> go on with c)). If in the cue\n> addErrorMessage(\"path-already-exists\", params);\n> c) Instead doing setDefaultTargetURL(document.getCanonicalWebappURL()); like\n> right now we can send him to an ajax based cue overview (which gets updated in\n> real time from the cue worker). In combination (or alternatively) we can use a\n> checkbox to request a notification from the worker as soon he has done the\ndocument.\n\nOK, I see what you mean.\n\n> The cue must be serializable and further keep state of the operation (log\n> error/success). After a cue item is finished we write to the sitetree.\n\nThat would mean we'd have to implement a full featured command pattern and a\npersistent queue, which is serious business. Certainly nothing for 1.4, I'd even\nsay we should postpone it to 1.5 or later.\n", "count": 20, "id": 103635, "time": "2007-05-24T08:22:07Z", "creator": "andreas@apache.org", "creation_time": "2007-05-24T08:22:07Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 42496, "text": "I'd suggest we display a sane error message instead of the \"repository node was\nchanged\" exception and add an entry to the FAQ, advicing to set the usecase to\npessimistic to avoid the error. Any changes to the command execution can be\ndiscussed in a different issue or mailing list thread. WDYT?", "count": 21, "id": 103636, "time": "2007-05-24T08:25:15Z", "creator": "andreas@apache.org", "creation_time": "2007-05-24T08:25:15Z", "is_private": false}, {"count": 22, "attachment_id": null, "bug_id": 42496, "is_private": false, "id": 103640, "time": "2007-05-24T08:40:04Z", "creator": "thorsten@apache.org", "creation_time": "2007-05-24T08:40:04Z", "tags": [], "text": "Why do not set it by default to pessimistic?\n\nI agree with your comments, display a message that explains that the doc could\nnot create out of high traffic (something in this direction) sounds good.\n\nYeah, regarding command execution that should go in a bug after discussing it on\ndev.\n\nNice working with you. :)"}, {"count": 23, "tags": [], "bug_id": 42496, "is_private": false, "text": "(In reply to comment #22)\n> Why do not set it by default to pessimistic?\n\nThe problem with pessimistic usecases is that they create persistent locks,\nwhich lead to the infamous \"checked out by another user\" issue. This makes sense\nfor editing (because the losing the changes is expensive), but IMO for creating\ndocs optimistic behaviour is sufficient. But fortunately it's is up to the\nintegrator to decide that. Maybe you'd like to raise the question on the dev or\nuser list.\n\n> I agree with your comments, display a message that explains that the doc could\n> not create out of high traffic (something in this direction) sounds good.\n\nOK, I'll try to take care of this.\n\n> Yeah, regarding command execution that should go in a bug after discussing it on\n> dev.\n> \n> Nice working with you. :)\n\nWith you too :)\n\nBTW, the test case is great, it also brought the \"indexer is busy\" issue up.\nThanks a lot to Javier!\n\n", "id": 103641, "time": "2007-05-24T08:49:41Z", "creator": "andreas@apache.org", "creation_time": "2007-05-24T08:49:41Z", "attachment_id": null}, {"count": 24, "attachment_id": null, "creator": "rfrovarp@apache.org", "text": "*** Bug 43136 has been marked as a duplicate of this bug. ***", "id": 109483, "time": "2007-10-18T12:34:22Z", "bug_id": 42496, "creation_time": "2007-10-18T12:34:22Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 59258, "attachment_id": null, "text": "As you know, unfortunately and despite all the warnings and best practices we wrote, a lot of users still use GUI Mode when Load Testing.\nThis is an issue when Listener such as View Results Tree or View Results in Table are used.\n\nThis ends usually with \"abnormal and wrong\" slow response times before an OOM occurs.\n\nThis issue is one of the major factor for JMeter being felt as \"unstable\" I think.\n\nI propose the following solution that I have already developed\n\nAdd 2 user properties:\n#view.results.table.max_rows=5000\n#view.results.tree.max_nodes=5000\n\nIn the \"View Results Tree \" , when number of nodes in the tree reaches the max, we remove the first node in the Tree.\nIn the \"View Results in Table\" , when number of rows in the table reaches the max, we remove the first row in the table.\n\nSo we limit this way the number of nodes and rows in those listeners.", "id": 189868, "time": "2016-03-31T21:08:58Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-03-31T21:08:58Z", "is_private": false}, {"count": 1, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Created attachment 33716\nPatch for the issue", "id": 189869, "time": "2016-03-31T21:19:44Z", "bug_id": 59258, "creation_time": "2016-03-31T21:19:44Z", "is_private": false, "attachment_id": 33716}, {"count": 2, "tags": [], "bug_id": 59258, "attachment_id": null, "text": "Philippe, are you aware that both removals are \"remove the first element out of arraylist\"? Those seem to be pathological cases.\n\nObjectTableModel stores model in ArrayList, while DefaultTreeModel stores model in Vector.\n\nHave you tested which overhead creates that node removal?\nI'm not fond of running long operations under synchronization.", "id": 189871, "time": "2016-03-31T22:27:50Z", "creator": "sitnikov.vladimir@gmail.com", "creation_time": "2016-03-31T22:27:50Z", "is_private": false}, {"count": 3, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "text": "(In reply to Vladimir Sitnikov from comment #2)\n> Philippe, are you aware that both removals are \"remove the first element out\n> of arraylist\"? Those seem to be pathological cases.\n\nCan you clarify what you mean ?\n\n\n> \n> ObjectTableModel stores model in ArrayList, while DefaultTreeModel stores\n> model in Vector.\n> \n> Have you tested which overhead creates that node removal?\nNo.\nAs for me anyway Load Testing in GUI mode is evil.\nI am just here protecting JMeter from OOM\n\n> I'm not fond of running long operations under synchronization.\nWhat other solution do we have ?\nDo this only protection part every N Inserts ?", "id": 189875, "time": "2016-04-01T07:03:25Z", "bug_id": 59258, "creation_time": "2016-04-01T07:03:25Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "sebb@apache.org", "is_private": false, "id": 189877, "time": "2016-04-01T08:19:19Z", "bug_id": 59258, "creation_time": "2016-04-01T08:19:19Z", "tags": [], "text": "I think Vladimir means that removal of the first element of those data structures is an expensive operation.\n\nTherefore the 'cure' might cause other problems.\n\nAs to the solution, my preference is to not try to fix it through code.\n\nHowever of course it would be quite cheap to start dropping entries when a limit is reached."}, {"count": 5, "tags": [], "bug_id": 59258, "text": "(In reply to Sebb from comment #4)\n> I think Vladimir means that removal of the first element of those data\n> structures is an expensive operation.\n\nOk I agree\n\n> \n> Therefore the 'cure' might cause other problems.\n> \n> As to the solution, my preference is to not try to fix it through code.\n\nWhat do you propose then ?\n> \n> However of course it would be quite cheap to start dropping entries when a\n> limit is reached.\n\nIsn't it what my patch does ?\nIf it's cheap , then why not do it this way ?", "id": 189878, "time": "2016-04-01T08:25:17Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-04-01T08:25:17Z", "is_private": false, "attachment_id": null}, {"text": "(In reply to Philippe Mouawad from comment #5)\n> (In reply to Sebb from comment #4)\n> > I think Vladimir means that removal of the first element of those data\n> > structures is an expensive operation.\n> \n> Ok I agree\n> \n> > \n> > Therefore the 'cure' might cause other problems.\n> > \n> > As to the solution, my preference is to not try to fix it through code.\n> \n> What do you propose then ?\n\nContinue with education.\n\n> > \n> > However of course it would be quite cheap to start dropping entries when a\n> > limit is reached.\n> \n> Isn't it what my patch does ?\n> If it's cheap , then why not do it this way ?\n\nSorry, meant to write 'samples' not 'entries' - i.e. don't add another entry if the list is full. That should be cheap and solves the OOM.", "tags": [], "bug_id": 59258, "is_private": false, "count": 6, "id": 189879, "time": "2016-04-01T08:57:17Z", "creator": "sebb@apache.org", "creation_time": "2016-04-01T08:57:17Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 59258, "attachment_id": null, "text": "(In reply to Sebb from comment #6)\n> (In reply to Philippe Mouawad from comment #5)\n> > (In reply to Sebb from comment #4)\n> > > I think Vladimir means that removal of the first element of those data\n> > > structures is an expensive operation.\n> > \n> > Ok I agree\n> > \n> > > \n> > > Therefore the 'cure' might cause other problems.\n> > > \n> > > As to the solution, my preference is to not try to fix it through code.\n> > \n> > What do you propose then ?\n> \n> Continue with education.\n\nUnfortunately, I am not sure it's enough.\n> \n> > > \n> > > However of course it would be quite cheap to start dropping entries when a\n> > > limit is reached.\n> > \n> > Isn't it what my patch does ?\n> > If it's cheap , then why not do it this way ?\n> \n> Sorry, meant to write 'samples' not 'entries' - i.e. don't add another entry\n> if the list is full. That should be cheap and solves the OOM.\n\nYes that's another way to fix it.\nBut if you take a long running test:\n- I suppose user would be more interested in last samples than old ones\n- He might think JMeter is stuck, which ends up the same from User perception : \"JMeter is unstable, my test is stuck ....\"", "id": 189880, "time": "2016-04-01T09:01:37Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-04-01T09:01:37Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 59258, "text": "Hi sebb,\nJust to illustrate, first question now on stackoverflow:\nhttp://stackoverflow.com/questions/tagged/jmeter\n\nJmeter freezes with a CPU of 100%\n\n\nSearch in it and on our mailing list, I bet you give tens of entries", "id": 189881, "time": "2016-04-01T09:04:50Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-04-01T09:04:50Z", "is_private": false, "attachment_id": null}, {"count": 9, "tags": [], "creator": "sebb@apache.org", "is_private": false, "text": "(In reply to Philippe Mouawad from comment #8)\n> Hi sebb,\n> Just to illustrate, first question now on stackoverflow:\n> http://stackoverflow.com/questions/tagged/jmeter\n> \n> Jmeter freezes with a CPU of 100%\n> \n> \n> Search in it and on our mailing list, I bet you give tens of entries\n\nYes, there probably are.\nThere are lots of entries about other common problems which would be solved if people read the manual.\n\nI agree that if we can make a simple change to JMeter that makes it easier to use and does not compromise performance then we should consider doing it.\n\nHowever in this case any changes are likely to be intrusive, so the trade-off is not worth it.\n\nAlso, the test will still reach saturation earlier than it would do if they had not used the Listener, so they are then going to complain that JMeter does not scale. I think it's just postponing the problem.", "id": 189883, "time": "2016-04-01T09:57:04Z", "bug_id": 59258, "creation_time": "2016-04-01T09:57:04Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 59258, "text": "(In reply to Sebb from comment #9)\n> (In reply to Philippe Mouawad from comment #8)\n> > Hi sebb,\n> > Just to illustrate, first question now on stackoverflow:\n> > http://stackoverflow.com/questions/tagged/jmeter\n> > \n> > Jmeter freezes with a CPU of 100%\n> > \n> > \n> > Search in it and on our mailing list, I bet you give tens of entries\n> \n> Yes, there probably are.\n> There are lots of entries about other common problems which would be solved\n> if people read the manual.\n\nYes, but if we can make it OOTB then why not\n> \n> I agree that if we can make a simple change to JMeter that makes it easier\n> to use and does not compromise performance then we should consider doing it.\n> \n> However in this case any changes are likely to be intrusive, so the\n> trade-off is not worth it.\n\nI don't share this opinion. \n> \n> Also, the test will still reach saturation earlier than it would do if they\n> had not used the Listener, so they are then going to complain that JMeter\n> does not scale. \n\nBut that won't be true. While currently saying that JMeter does not scale with GUI Mode + View Results Tree is not strictly wrong.\n\n\n>I think it's just postponing the problem.\n\n\nAs a conclusion , maybe Vladimir has a brilliant idea that could help here.\nIf not then I suggest 2 options:\n- We use my patch and accept drawback\n- We use your option (drop additional sampler) AND add a warning message on GUI to say that this is in place", "id": 189885, "time": "2016-04-01T11:25:07Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-04-01T11:25:07Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 59258, "text": "(In reply to Philippe Mouawad from comment #10)\n> (In reply to Sebb from comment #9)\n> > (In reply to Philippe Mouawad from comment #8)\n> > > Hi sebb,\n> > > Just to illustrate, first question now on stackoverflow:\n> > > http://stackoverflow.com/questions/tagged/jmeter\n> > > \n> > > Jmeter freezes with a CPU of 100%\n> > > \n> > > \n> > > Search in it and on our mailing list, I bet you give tens of entries\n> > \n> > Yes, there probably are.\n> > There are lots of entries about other common problems which would be solved\n> > if people read the manual.\n> \n> Yes, but if we can make it OOTB then why not\n\nBecause of the disadvantages.\n\n> > \n> > I agree that if we can make a simple change to JMeter that makes it easier\n> > to use and does not compromise performance then we should consider doing it.\n> > \n> > However in this case any changes are likely to be intrusive, so the\n> > trade-off is not worth it.\n> \n> I don't share this opinion.\n\nAre you saying that the changes are not intrusive, or that even though they are intrusive, it's worth the disadvantages?\n\n> > \n> > Also, the test will still reach saturation earlier than it would do if they\n> > had not used the Listener, so they are then going to complain that JMeter\n> > does not scale. \n> \n> But that won't be true. \n\nOn the contrary, it is true that using one of these Listeners will reduce the max throughput that JMeter can achieve.\nMaybe not in all tests, but it will be important in some.\n\nUsing extra storage can affect the max possible throughput.\nUsing extra processing to implement the limiting also affects the max throughput.\n\n> While currently saying that JMeter does not scale\n> with GUI Mode + View Results Tree is not strictly wrong.\n\nNot sure what that means.\n\n> \n> >I think it's just postponing the problem.\n> \n> \n> As a conclusion , maybe Vladimir has a brilliant idea that could help here.\n\nMaybe.\n\n> If not then I suggest 2 options:\n> - We use my patch and accept drawback\n\n-1\n\n> - We use your option (drop additional sampler) AND add a warning message on\n> GUI to say that this is in place\n\nEven though I suggested it, I don't think it's a viable idea.", "id": 189886, "time": "2016-04-01T11:48:24Z", "creator": "sebb@apache.org", "creation_time": "2016-04-01T11:48:24Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "is_private": false, "text": "Created attachment 33718\nPatch that does not add SampleResults anymore and displays a warning", "id": 189896, "time": "2016-04-01T19:20:29Z", "bug_id": 59258, "creation_time": "2016-04-01T19:20:29Z", "attachment_id": 33718}, {"count": 13, "tags": [], "bug_id": 59258, "text": "Created attachment 33719\nScreenshot showing the warning on ViewResultsTree", "id": 189897, "time": "2016-04-01T19:21:33Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-04-01T19:21:33Z", "is_private": false, "attachment_id": 33719}, {"count": 14, "tags": [], "bug_id": 59258, "text": "Created attachment 33720\nScreenshot showing the warning on ViewResultsTable", "id": 189898, "time": "2016-04-01T19:22:05Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-04-01T19:22:05Z", "is_private": false, "attachment_id": 33720}, {"count": 15, "tags": [], "bug_id": 59258, "text": "(In reply to Sebb from comment #11)\n> (In reply to Philippe Mouawad from comment #10)\n> > (In reply to Sebb from comment #9)\n> > > (In reply to Philippe Mouawad from comment #8)\n> > > > Hi sebb,\n> > > > Just to illustrate, first question now on stackoverflow:\n> > > > http://stackoverflow.com/questions/tagged/jmeter\n> > > > \n> > > > Jmeter freezes with a CPU of 100%\n> > > > \n> > > > \n> > > > Search in it and on our mailing list, I bet you give tens of entries\n> > > \n> > > Yes, there probably are.\n> > > There are lots of entries about other common problems which would be solved\n> > > if people read the manual.\n> > \n> > Yes, but if we can make it OOTB then why not\n> \n> Because of the disadvantages.\n> \n> > > \n> > > I agree that if we can make a simple change to JMeter that makes it easier\n> > > to use and does not compromise performance then we should consider doing it.\n> > > \n> > > However in this case any changes are likely to be intrusive, so the\n> > > trade-off is not worth it.\n> > \n> > I don't share this opinion.\n> \n> Are you saying that the changes are not intrusive, or that even though they\n> are intrusive, it's worth the disadvantages?\n\nEven if they are intrusive it's worth the disadvantage.\nWithout protection : Results are KO and JMeter crashes\nWith protection : Results are KO, user is informed and JMeter does not crash\n\n> \n> > > \n> > > Also, the test will still reach saturation earlier than it would do if they\n> > > had not used the Listener, so they are then going to complain that JMeter\n> > > does not scale. \n> > \n> > But that won't be true. \n> \n> On the contrary, it is true that using one of these Listeners will reduce\n> the max throughput that JMeter can achieve.\n> Maybe not in all tests, but it will be important in some.\n> \n> Using extra storage can affect the max possible throughput.\n> Using extra processing to implement the limiting also affects the max\n> throughput.\n> \n> > While currently saying that JMeter does not scale\n> > with GUI Mode + View Results Tree is not strictly wrong.\n> \n> Not sure what that means.\n\nCurrently, if someone uses GUI mode with View Results Tree for load testing, JMeter does not scale. Although this is against best practices we documented, this is possible.\nWith protection it is not anymore.\n\n> \n> > \n> > >I think it's just postponing the problem.\n> > \n> > \n> > As a conclusion , maybe Vladimir has a brilliant idea that could help here.\n> \n> Maybe.\n> \n> > If not then I suggest 2 options:\n> > - We use my patch and accept drawback\n> \n> -1\n> \n> > - We use your option (drop additional sampler) AND add a warning message on\n> > GUI to say that this is in place\n> \n> Even though I suggested it, I don't think it's a viable idea.\n\nI implemented the 2 options , I attached the patch. \nFrankly I think it is an improvement. \nI am really tired of seeing people fall into this trap too easily.", "id": 189899, "time": "2016-04-01T19:24:59Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-04-01T19:24:59Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "This PR (https://github.com/apache/jmeter/pull/179) is a first try to base protection on memory estimation.\nMemory estimation of SampleResult is too positive I think, it does only take into account the AssertionResult and SampleResult response data, not the properties size. This could be improved.", "id": 189918, "time": "2016-04-03T12:40:59Z", "bug_id": 59258, "creation_time": "2016-04-03T12:40:59Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "bug_id": 59258, "text": "\n\n*** This bug has been marked as a duplicate of bug 60687 ***", "id": 197550, "time": "2017-03-08T21:01:31Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2017-03-08T21:01:31Z", "is_private": false, "attachment_id": null}]
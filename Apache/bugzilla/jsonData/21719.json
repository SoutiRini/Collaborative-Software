[{"count": 0, "tags": [], "bug_id": 21719, "attachment_id": null, "id": 40946, "time": "2003-07-18T19:48:06Z", "creator": "swaltner@lsil.com", "creation_time": "2003-07-18T19:48:06Z", "is_private": false, "text": "I've been trying to get mod_auth_ldap running on a Solaris server with limited\nsuccess. Every time I add the LDAP configuration to httpd.conf, the httpd\nprocess crashes on startup, even when checking the httpd.conf syntax. I append\nthe following to the very end of the default httpd.conf file to configure\nmod_auth_ldap (except for the obfuscated LDAP URL).\n\n<Directory /tmp/apache-2.0.46/cgi-bin/ldap>\nAuthName \"LDAP Protected Page\"\nAuthType Basic\nAuthLDAPEnabled on\nAuthLDAPAuthoritative on\nAuthLDAPURL ldap://hostname/basedn\nrequire valid-user\n</Directory>\n\ngdb shows a backtrace of:\n\n#0  0xfef32f68 in strlen () from /usr/lib/libc.so.1\n#1  0xff1ca758 in apr_pstrdup (a=0x17fbe8, s=0x286f626a <Address 0x286f626a out\nof bounds>) at apr_strings.c:114\n#2  0x00044c18 in mod_auth_ldap_parse_url (cmd=0xffbffb38, config=0x1d2148, \n    url=0x1d2230 \"ldap://hostname/basedn\") at mod_auth_ldap.c:794\n#3  0x000783e0 in invoke_cmd (cmd=0x161e98, parms=0xffbffb38, mconfig=0x1d2148,\nargs=0x1c441a \"\")\n    at config.c:703\n#4  0x00078a20 in ap_walk_config_sub (current=0x1c43c8, parms=0xffbffb38,\nsection_vector=0x1d1df0)\n    at config.c:1082\n#5  0x00078ac0 in ap_walk_config (current=0x1c43c8, parms=0xffbffb38,\nsection_vector=0x1d1df0) at config.c:1121\n#6  0x00089bf8 in dirsection (cmd=0xffbffb38, mconfig=0x1bdaf0, arg=0x1d1f7d \"\")\nat core.c:1674\n#7  0x000783e0 in invoke_cmd (cmd=0x13287c, parms=0xffbffb38, mconfig=0x1bdaf0, \n    args=0x1c4250 \"/home/backuppc/apache-2.0.46/cgi-bin/backuppc>\") at config.c:703\n#8  0x00078a20 in ap_walk_config_sub (current=0x1c4230, parms=0xffbffb38,\nsection_vector=0x1bcbe8)\n    at config.c:1082\n#9  0x00078ac0 in ap_walk_config (current=0x1c4230, parms=0xffbffb38,\nsection_vector=0x1bcbe8) at config.c:1121\n#10 0x00079594 in ap_process_config_tree (s=0x1834d0, conftree=0x1c4230,\np=0x17fbe8, ptemp=0x1b9cd0)\n    at config.c:1594\n#11 0x0007bcb8 in main (argc=3, argv=0xffbffc7c) at main.c:581\n\nI don't believe this is related to bug 18756 since that sounds like it's tied to\nthe caching functions of mod_ldap. I haven't activated LDAP caching on my\nconfiguration. The only chage to the default httpd.conf file is changing the\nport number to 8000 and the <Directory> clause shown above.\n\nI'm using the following software on my web server:\nSolaris 9 04/03 (with Recommended Patch bundle from May 1, 2003)\nGCC 3.3\nGNU Make 3.80\nApache 2.0.47\nOpenSSL 0.9.7b\nOpenLDAP 2.1.22\n\nI installed the software as follows:\ncd /tmp/openssl-0.9.7b\n./Configure --prefix=/tmp/test solaris-sparcv8-gcc\nmake\nmake install\ncd /tmp/openldap-2.1.22\n./configure --prefix=/tmp/test --disable-slapd\nmake depend\nmake\nmake install\n(create links in /usr/local/lib and /usr/local/include to files in /tmp/test/*)\ncd /tmp/httpd-2.0.47\n./configure --prefix=/tmp/test-apache --enable-ssl --with-ssl=/tmp/test\n--with-ldap --enable-ldap --enable-auth-ldap --enable-so\nmake\nmake install\n\nRunning the same commands on a Linux system (RedHat ???, Kernel 2.2.12-20)\ntields a working setup, which makes it appear os though mod_auth_ldap is not\ncompatible with Solaris."}, {"count": 1, "tags": [], "bug_id": 21719, "is_private": false, "id": 44910, "creation_time": "2003-09-30T22:26:25Z", "time": "2003-09-30T22:26:25Z", "creator": "wsun@movaz.com", "text": "Created attachment 8403\nSame problem on RedHat 9", "attachment_id": 8403}, {"count": 2, "attachment_id": null, "creator": "swaltner@lsil.com", "text": "I confirmed this same problem on the latest release of Apache, so I have updated the Version tag.\n\nSince this hasn't seemed to spark any work on resolution, I started working on debugging the error. I'm \nhaving trouble getting ddd/gdb to trace into apr_ldap_url.c and ldap_url_parse_ext() where the bug \nappears to be. I've gotten as far as tracking down the problem to what happens inside mod_auth_ldap \nat line 702:\n\nresult = apr_ldap_url_parse(url, &(urld));\n\nThis function is returning bogus data, leading to a segmentation fault a few lines later on.\n\nI do find it odd that Way Sun has seen this problem on Linux. I am running the same software on a \nRedhat 6.1 system and the mod_auth_ldap module is working fine.\n\nI'm beginning to suspect it's something broken in linking process between httpd and the functions from \napr_ldap_util.c inside the libaprutil.so.0 library. I was thinking it was a big/little endian error, but since \nWay found this same problem on x86 Linux, that doesn't make sense.", "id": 56936, "time": "2004-05-06T16:41:59Z", "bug_id": 21719, "creation_time": "2004-05-06T16:41:59Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 21719, "text": "Oops, forgot to add the ddd screenshot I took. http://homepage.mac.com/swaltner/corrupted.gif is \ntake right after the apr_ldap_url_parse function returns. It also shows the URL that goes into the \nfunction. You can see the values coming from the APR function are bogus.", "id": 56937, "time": "2004-05-06T16:44:28Z", "creator": "swaltner@lsil.com", "creation_time": "2004-05-06T16:44:28Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "minfrin@sharp.fm", "attachment_id": null, "text": "apr_ldap_url_parse() is just a macro for the ldap_utl_parse() method defined in\nthe LDAP C SDK.\n\nThe macro behaves in one of two ways, depending on whether the SDK you are using\nhas this function natively or not.\n\nIn order to determine whether the segfault is in apr-util, or whether the\nsegfault is inside your LDAP SDK, I need to know the compile time value of\nAPR_HAS_LDAP_URL_PARSE when you build Apache.\n\nThe relevant construct is in include/apr_ldap_url.h in apr-util around line 22.\n", "id": 57802, "time": "2004-05-21T14:45:41Z", "bug_id": 21719, "creation_time": "2004-05-21T14:45:41Z", "is_private": false}, {"count": 5, "attachment_id": null, "creator": "minfrin@sharp.fm", "text": "One more thing: Can you send the context of this line in your stacktrace:\n\n#2  0x00044c18 in mod_auth_ldap_parse_url (cmd=0xffbffb38, config=0x1d2148, \n    url=0x1d2230 \"ldap://hostname/basedn\") at mod_auth_ldap.c:794\n\nThere are 5 references to apr_pstrdup() within this function, I need to know\nwhich one caused the segfault.\n", "id": 57803, "time": "2004-05-21T14:48:50Z", "bug_id": 21719, "creation_time": "2004-05-21T14:48:50Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 21719, "attachment_id": null, "id": 57865, "time": "2004-05-21T20:12:35Z", "creator": "swaltner@lsil.com", "creation_time": "2004-05-21T20:12:35Z", "is_private": false, "text": "The fix for this appears to be to upgrade to the latest release of OpenLDAP. I\nhave successfully compiled and run Apache httpd 2.0.49 on Solaris 9 with the\nmod_auth_ldap module on two different systems. I've also received a couple\ne-mails from other admins at work saying that upgrading to the latest OpenLDAP\nrelease fixed the problem.\n\nI suspect this bug can be closed. There was a report from Way Sun that the same\nthing happened on RedHat 9, but I haven't been able to confirm with him whether\nor not the problem is fixed on RedHat by using a newer release of OpenLDAP."}, {"count": 7, "tags": [], "bug_id": 21719, "text": "I'll close this for now then, if you have further hassles and suspect mod_ldap,\njust reopen this bug.\n", "id": 57889, "time": "2004-05-22T01:27:17Z", "creator": "minfrin@sharp.fm", "creation_time": "2004-05-22T01:27:17Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 21719, "attachment_id": null, "id": 57890, "time": "2004-05-22T01:29:45Z", "creator": "minfrin@sharp.fm", "creation_time": "2004-05-22T01:29:45Z", "is_private": false, "text": "In that case I'll close this bug. If you have any further hassles and suspect\nmod_ldap*, just reopen it again."}]
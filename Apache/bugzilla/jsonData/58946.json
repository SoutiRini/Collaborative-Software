[{"count": 0, "text": "JavaDoc for ServletRequest.getParameterMap(), both ours and the one at Oracle site [1] says:\n\n\"Returns: an immutable java.util.Map containing [...]\"\n\nThe problem is that this immutability is not enforced by org.apache.catalina.core.ApplicationHttpRequest class that is used to implement included or forwarded requests.\n\nNote that org.apache.catalina.util.ParameterMap class used for usual (not forwarded) requests does enforce immutability. An example of message from that class is shown below.\n\n\nReproducible with current Tomcat 8.0-dev.\n\nSteps to reproduce\n--------------------\n1. Put the following two JSPs into ROOT web application:\n\ntest.jsp\n[[[\n<%@page contentType=\"text/plain;charset=UTF-8\" import=\"java.util.*\"%>\n<%\nRequestDispatcher rd = request.getRequestDispatcher(\"test2.jsp\");\nrd.forward(request, response);\n%>\n]]]\n\ntest2.jsp\n[[[\n<%@page contentType=\"text/plain;charset=UTF-8\" import=\"java.util.*\"%>\n<%\nMap map = request.getParameterMap();\nmap.put(\"foo\", \"bar\");\n%>\n<%= map %>\n]]]\n\n2. Call\nhttp://localhost:8080/test.jsp?z=a\n\nActual:\n--------\nThe following response is observed:\n[[[\n{foo=bar, z=[Ljava.lang.String;@3877a5}\n]]]\n\nExpected:\n---------\nIf I call the test2.jsp application directly, the behaviour is as expected:\n\nhttp://localhost:8080/test2.jsp?z=a\n\nHTTP Status 500 - An exception occurred processing JSP page /test2.jsp at line 4\n\nroot cause\n\njava.lang.IllegalStateException: No modifications are allowed to a locked ParameterMap\n\torg.apache.catalina.util.ParameterMap.put(ParameterMap.java:164)\n\torg.apache.jsp.test2_jsp._jspService(test2_jsp.java:115)\n\n------------------------\n\nI noticed this issue while performing code review,\ninspired by a thread started 2016-01-19 on users mailing list [2].\n\n[1] http://docs.oracle.com/javaee/7/api/javax/servlet/ServletRequest.html#getParameterMap--\n\n[2] http://tomcat.markmail.org/thread/3hq4fghtoxcj44i5", "creator": "knst.kolinko@gmail.com", "is_private": false, "id": 188065, "time": "2016-01-30T12:05:04Z", "bug_id": 58946, "creation_time": "2016-01-30T12:05:04Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 58946, "attachment_id": null, "text": "Fixed in 9.0.x for 9.0.0.M3, 8.0.x for 8.0.32, 7.0.x for 7.0.68 and 6.0.x for 6.0.44.", "id": 188100, "time": "2016-02-01T09:43:15Z", "creator": "markt@apache.org", "creation_time": "2016-02-01T09:43:15Z", "is_private": false}]
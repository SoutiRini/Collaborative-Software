[{"count": 0, "tags": [], "bug_id": 44900, "is_private": false, "text": "Created attachment 21877\nA testcase to reproduce problem\n\nHi, I'm migrating an app from Ant 1.6.1 to Ant 1.7.0, and I have problems with exec tasks. Ant execute task without passing arguments to process!\n\nFor example, I have this task definition:\n\n<project name=\"permision\" default=\"permision\"  basedir=\".\">\n        <property name=\"timeout\" value=\"120000\" />\n        <target name=\"permision\">\n                <echo message=\"Modify directories permissions ${path}, mask ${dirMask}\" />\n                <exec executable=\"chmod\" \n                          timeout=\"${timeout}\"\n                          failonerror=\"true\">            \n                        <arg line=\"-R ${dirMask} ${path}\" />\n                </exec>\n                <echo message=\"Modify files permissions ${path}, mask ${fileMask}\" />\n                <exec executable=\"/data/bin/ant/permisions.sh\" \n                          timeout=\"${timeout}\"\n                          failonerror=\"true\">\n                          \n                        <arg line=\"${path} ${fileMask}\" />         \n                </exec>\n        </target>\n</project>\n\nAn easy one, and works ok with Ant 1.6, as you can see in logs:\n\n(...)\n23 Apr 2008 17:31:10 [INFO ] Modify directories permissions /data/servers/ftp, mask 755\n23 Apr 2008 17:31:10 [DEBUG] Task \"echo\"finished\n23 Apr 2008 17:31:10 [DEBUG] Task \"exec\" started\n23 Apr 2008 17:31:10 [DEBUG] Current OS is AIX\n23 Apr 2008 17:31:10 [DEBUG] Executing 'chmod' with arguments:\n'-R'\n'755'\n'/data/servers/ftp'\n\nThe ' characters around the executable and arguments are\nnot part of the command.\n23 Apr 2008 17:31:10 [DEBUG] Execute:Java13CommandLauncher: Executing 'chmod' with arguments:\n'-R'\n'755'\n'/data/servers/ftp\n\nThe ' characters around the executable and arguments are\nnot part of the command.\n23 Apr 2008 17:31:10 [INFO ]\n(...)\n\n\nWith Ant 1.7.0 I get this log:\n\n24 Apr 2008 15:49:42 [DEBUG] Task \"echo\" started\n24 Apr 2008 15:49:42 [INFO ] Modify directories permissions /data/servers/ftp, mask 777\n24 Apr 2008 15:49:42 [DEBUG] Task \"echo\"finished\n24 Apr 2008 15:49:42 [DEBUG] Task \"exec\" started\n24 Apr 2008 15:49:42 [DEBUG] Current OS is AIX\n24 Apr 2008 15:49:42 [DEBUG] Executing 'chmod'\nThe ' characters around the executable and arguments are\nnot part of the command.\n24 Apr 2008 15:49:42 [DEBUG] Execute:Java13CommandLauncher: Executing 'chmod'\nThe ' characters around the executable and arguments are\nnot part of the command.\n24 Apr 2008 15:49:42 [INFO ] Usage: chmod [-R] [-f] [-h] {u|g|o|a ...} {+|-|=} {r|w|x|X|s|t ...} File ...\n24 Apr 2008 15:49:42 [INFO ]  chmod [-R] [-f] [-h] OctalNumber File ...\n24 Apr 2008 15:49:42 [INFO ]  Changes the permission codes for files or directories.\n24 Apr 2008 15:49:42 [ERROR] Task \"exec\" finished with error (null)\n24 Apr 2008 15:49:42 [ERROR] Target \"permision\" finished with error (null)\n/data/bin/ant/permisions.xml:8: exec returned: 255\n   at org.apache.tools.ant.taskdefs.ExecTask.runExecute(ExecTask.java:636)\n   at org.apache.tools.ant.taskdefs.ExecTask.runExec(ExecTask.java:662)\n   at org.apache.tools.ant.taskdefs.ExecTask.execute(ExecTask.java:487)\n   at sun.reflect.GeneratedMethodAccessor16.invoke(Unknown Source)\n   at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n   at java.lang.reflect.Method.invoke(Method.java:618)\n   at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)\n   at org.apache.tools.ant.Task.perform(Task.java:348)\n   at org.apache.tools.ant.Target.execute(Target.java:357)\n   at org.apache.tools.ant.Target.performTasks(Target.java:385)\n   at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)\n   at org.apache.tools.ant.Project.executeTarget(Project.java:1298)\n   at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n   at org.apache.tools.ant.Project.executeTargets(Project.java:1181)\n   at com.sbd.hardist.util.ant.AntProcess.execute(AntProcess.java:157)\n\nAnt task isn't receiving parameters!\n\nThis task are executed using Ant's java api. If I execute task manually, all goes ok too. And if I use deprecated <exec command, all goes fine too!\n\nI'm using java 1.5.", "id": 116004, "time": "2008-04-29T01:18:28Z", "creator": "ettikx@gmail.com", "creation_time": "2008-04-29T01:18:28Z", "attachment_id": 21877}, {"count": 1, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "id": 116007, "time": "2008-04-29T02:01:44Z", "bug_id": 44900, "creation_time": "2008-04-29T02:01:44Z", "is_private": false, "text": "Thanks for the rar file.\n\nI have changed the summary to reflect the fact that\nthis is seem only when using the java api.\n\nThere is a number of problems with the .rar file.\n\n1) it is a rar file - use tar.gz or zip\n2) it is not selfcontained - the launch.sh and build.sh\n   refer to jar files in variosu places, also they use /usr/bin/sh\n   which is not a normal localtion for sh.\n3) sh build.sh works, but sh launch.sh looks for files outside\n   the directory and fails.\n\nnew launch.sh\n-------\nCLASSPATH=$ANT_HOME/lib/ant.jar:$ANT_HOME/lib/ant-antlr.jar:$ANT_HOME/ant-launcher.jar:commons-lang.jar:log4j.jar:.\njava -cp $CLASSPATH TestAnt\n-------\nnew build.sh\n------------\nCLASSPATH=$ANT_HOME/lib/ant.jar:$ANT_HOME/lib/ant-antlr.jar:$ANT_HOME/lib/ant-launcher.jar:commons-lang.jar:log4j.jar:.\njavac -Xlint:unchecked -cp $CLASSPATH Log4jAntListener.java\njavac -Xlint:unchecked -cp $CLASSPATH AntProcess.java\njavac -Xlint:unchecked -cp $CLASSPATH TestAnt.java\n--------\n\nI copied in log4j.jar (shudder) and commons-lang.jar into the directory.\n\nThe failure when running launch is:\n\n[preilly@localhost bug44900-exec]$ sh launch.sh\nlog4j:ERROR setFile(null,true) call failed.\njava.io.FileNotFoundException: /tests/testant/testant.log (No such file or directory)\n        at java.io.FileOutputStream.openAppend(Native Method)\n        at java.io.FileOutputStream.<init>(FileOutputStream.java:177)\n        at java.io.FileOutputStream.<init>(FileOutputStream.java:102)\n        at org.apache.log4j.FileAppender.setFile(FileAppender.java:290)\n        at org.apache.log4j.RollingFileAppender.setFile(RollingFileAppender.java:194)\n        at org.apache.log4j.FileAppender.activateOptions(FileAppender.java:164)\n        at org.apache.log4j.config.PropertySetter.activate(PropertySetter.java:257)\n        at org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:133)\n        at org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:97)\n        at org.apache.log4j.PropertyConfigurator.parseAppender(PropertyConfigurator.java:689)\n        at org.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:647)\n        at org.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:544)\n        at org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:440)\n        at org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:476)\n        at org.apache.log4j.helpers.OptionConverter.selectAndConfigure(OptionConverter.java:471)\n        at org.apache.log4j.LogManager.<clinit>(LogManager.java:125)\n        at org.apache.log4j.Logger.getLogger(Logger.java:105)\n        at TestAnt.main(TestAnt.java:7)\nException in thread \"main\" java.lang.IllegalArgumentException: build file not found! /Harvest/pruebas/Xavi/bugant/permisions.xml\n        at AntProcess.setBuild(AntProcess.java:79)\n        at AntProcess.<init>(AntProcess.java:42)\n        at TestAnt.main(TestAnt.java:17)\n"}, {"count": 2, "tags": [], "creator": "ettikx@gmail.com", "attachment_id": null, "is_private": false, "id": 116010, "time": "2008-04-29T02:17:43Z", "bug_id": 44900, "creation_time": "2008-04-29T02:17:43Z", "text": "Hi,\n\n1) ok.\n2) /usr/bin/sh is the normal location for sh in AIX.\n3) ops, it searches for task xml, its hardcoded in TestAnt.java. And the same with log4j, the location of log file it's in log4j.properties.\n\nSo, must I create another testcase with changes, or you can do the changes manually?\n\nthanks.\n\n\n(In reply to comment #1)\n> Thanks for the rar file.\n> \n> I have changed the summary to reflect the fact that\n> this is seem only when using the java api.\n> \n> There is a number of problems with the .rar file.\n> \n> 1) it is a rar file - use tar.gz or zip\n> 2) it is not selfcontained - the launch.sh and build.sh\n>    refer to jar files in variosu places, also they use /usr/bin/sh\n>    which is not a normal localtion for sh.\n> 3) sh build.sh works, but sh launch.sh looks for files outside\n>    the directory and fails.\n> \n> new launch.sh\n> -------\n> CLASSPATH=$ANT_HOME/lib/ant.jar:$ANT_HOME/lib/ant-antlr.jar:$ANT_HOME/ant-launcher.jar:commons-lang.jar:log4j.jar:.\n> java -cp $CLASSPATH TestAnt\n> -------\n> new build.sh\n> ------------\n> CLASSPATH=$ANT_HOME/lib/ant.jar:$ANT_HOME/lib/ant-antlr.jar:$ANT_HOME/lib/ant-launcher.jar:commons-lang.jar:log4j.jar:.\n> javac -Xlint:unchecked -cp $CLASSPATH Log4jAntListener.java\n> javac -Xlint:unchecked -cp $CLASSPATH AntProcess.java\n> javac -Xlint:unchecked -cp $CLASSPATH TestAnt.java\n> --------\n> \n> I copied in log4j.jar (shudder) and commons-lang.jar into the directory.\n> \n> The failure when running launch is:\n> \n> [preilly@localhost bug44900-exec]$ sh launch.sh\n> log4j:ERROR setFile(null,true) call failed.\n> java.io.FileNotFoundException: /tests/testant/testant.log (No such file or\n> directory)\n>         at java.io.FileOutputStream.openAppend(Native Method)\n>         at java.io.FileOutputStream.<init>(FileOutputStream.java:177)\n>         at java.io.FileOutputStream.<init>(FileOutputStream.java:102)\n>         at org.apache.log4j.FileAppender.setFile(FileAppender.java:290)\n>         at\n> org.apache.log4j.RollingFileAppender.setFile(RollingFileAppender.java:194)\n>         at org.apache.log4j.FileAppender.activateOptions(FileAppender.java:164)\n>         at\n> org.apache.log4j.config.PropertySetter.activate(PropertySetter.java:257)\n>         at\n> org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:133)\n>         at\n> org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:97)\n>         at\n> org.apache.log4j.PropertyConfigurator.parseAppender(PropertyConfigurator.java:689)\n>         at\n> org.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:647)\n>         at\n> org.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:544)\n>         at\n> org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:440)\n>         at\n> org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:476)\n>         at\n> org.apache.log4j.helpers.OptionConverter.selectAndConfigure(OptionConverter.java:471)\n>         at org.apache.log4j.LogManager.<clinit>(LogManager.java:125)\n>         at org.apache.log4j.Logger.getLogger(Logger.java:105)\n>         at TestAnt.main(TestAnt.java:7)\n> Exception in thread \"main\" java.lang.IllegalArgumentException: build file not\n> found! /Harvest/pruebas/Xavi/bugant/permisions.xml\n>         at AntProcess.setBuild(AntProcess.java:79)\n>         at AntProcess.<init>(AntProcess.java:42)\n>         at TestAnt.main(TestAnt.java:17)\n> \n\n"}, {"count": 3, "tags": [], "creator": "peterreilly@apache.org", "attachment_id": null, "is_private": false, "id": 116011, "time": "2008-04-29T02:30:15Z", "bug_id": 44900, "creation_time": "2008-04-29T02:30:15Z", "text": "It would be better for you to make a new tarball.\n\nPeter\n"}, {"count": 4, "tags": [], "bug_id": 44900, "attachment_id": 21879, "text": "Created attachment 21879\nnew testcase to make it more self-contained", "id": 116012, "time": "2008-04-29T02:37:54Z", "creator": "ettikx@gmail.com", "creation_time": "2008-04-29T02:37:54Z", "is_private": false}, {"count": 5, "tags": [], "text": "(In reply to comment #3)\n> It would be better for you to make a new tarball.\n> \n> Peter\n> \n\nHi,\n\nI made a new testcase.\nNow it's a zip, it has log4j and commons-logging jars. And location of logs, task xml and classpath are self-contained.\n\nI kept /usr/bin/sh as it's the default location of sh in aix, please change it to match your instalation.\n\nhope it's all ok now ;)", "attachment_id": null, "id": 116013, "creation_time": "2008-04-29T02:40:11Z", "time": "2008-04-29T02:40:11Z", "creator": "ettikx@gmail.com", "bug_id": 44900, "is_private": false}, {"count": 6, "text": "Now I get:\nException in thread \"main\" java.lang.NoClassDefFoundError: org/apache/tools/ant/launch/AntMain\n        at java.lang.ClassLoader.defineClass1(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:621)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124)\n        at java.net.URLClassLoader.defineClass(URLClassLoader.java:260)\n        at java.net.URLClassLoader.access$000(URLClassLoader.java:56)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:195)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:307)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:289)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:252)\n        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:320)\n        at org.apache.tools.ant.Project.initProperties(Project.java:308)\n        at org.apache.tools.ant.Project.init(Project.java:295)\n        at AntProcess.execute(AntProcess.java:47)\n        at TestAnt.main(TestAnt.java:26)\nCaused by: java.lang.ClassNotFoundException: org.apache.tools.ant.launch.AntMain\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:200)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:307)\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:289)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:252)\n        at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:320)\n        ... 16 more\n\n", "bug_id": 44900, "attachment_id": null, "id": 116015, "time": "2008-04-29T03:04:25Z", "creator": "peterreilly@apache.org", "creation_time": "2008-04-29T03:04:25Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "creator": "ettikx@gmail.com", "attachment_id": 21880, "is_private": false, "id": 116016, "time": "2008-04-29T03:12:56Z", "bug_id": 44900, "creation_time": "2008-04-29T03:12:56Z", "text": "Created attachment 21880\nfixed testcase's classpath"}, {"count": 8, "tags": [], "text": "Sorry, wrong classpath :( try again with new..\n\nI tested it in windows (with xcopy), and xcopy it's executed without parameters:\n\n29 abr 2008 12:11:46 [DEBUG] - Target \"permision\" started\n29 abr 2008 12:11:46 [DEBUG] - Task \"echo\" started\n29 abr 2008 12:11:46 [INFO ] - Modify directories permissions testfolder, mask 755\n29 abr 2008 12:11:46 [DEBUG] - Task \"echo\"finished \n29 abr 2008 12:11:46 [DEBUG] - Task \"exec\" started\n29 abr 2008 12:11:46 [DEBUG] - Current OS is Windows XP\n29 abr 2008 12:11:46 [DEBUG] - Executing 'xcopy'\nThe ' characters around the executable and arguments are\nnot part of the command.\n29 abr 2008 12:11:46 [DEBUG] - Execute:Java13CommandLauncher: Executing 'xcopy'\nThe ' characters around the executable and arguments are\nnot part of the command.\n29 abr 2008 12:11:46 [INFO ] - 0 archivos copiados\n29 abr 2008 12:11:46 [INFO ] - N\u00a3mero de par metros no v lido\n29 abr 2008 12:11:46 [ERROR] - Task \"exec\" finished with error (null)\n29 abr 2008 12:11:46 [ERROR] - Target \"permision\" finished with error (null)\nC:\\testcase\\permisions.xml:8: exec returned: 4\n\tat org.apache.tools.ant.taskdefs.ExecTask.runExecute(ExecTask.java:636)\n\tat org.apache.tools.ant.taskdefs.ExecTask.runExec(ExecTask.java:662)\n\tat org.apache.tools.ant.taskdefs.ExecTask.execute(ExecTask.java:487)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\n(In reply to comment #6)\n> Now I get:\n> Exception in thread \"main\" java.lang.NoClassDefFoundError:\n> org/apache/tools/ant/launch/AntMain\n>         at java.lang.ClassLoader.defineClass1(Native Method)\n>         at java.lang.ClassLoader.defineClass(ClassLoader.java:621)\n>         at\n> java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124)\n>         at java.net.URLClassLoader.defineClass(URLClassLoader.java:260)\n>         at java.net.URLClassLoader.access$000(URLClassLoader.java:56)\n>         at java.net.URLClassLoader$1.run(URLClassLoader.java:195)\n>         at java.security.AccessController.doPrivileged(Native Method)\n>         at java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n>         at java.lang.ClassLoader.loadClass(ClassLoader.java:307)\n>         at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:289)\n>         at java.lang.ClassLoader.loadClass(ClassLoader.java:252)\n>         at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:320)\n>         at org.apache.tools.ant.Project.initProperties(Project.java:308)\n>         at org.apache.tools.ant.Project.init(Project.java:295)\n>         at AntProcess.execute(AntProcess.java:47)\n>         at TestAnt.main(TestAnt.java:26)\n> Caused by: java.lang.ClassNotFoundException:\n> org.apache.tools.ant.launch.AntMain\n>         at java.net.URLClassLoader$1.run(URLClassLoader.java:200)\n>         at java.security.AccessController.doPrivileged(Native Method)\n>         at java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n>         at java.lang.ClassLoader.loadClass(ClassLoader.java:307)\n>         at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:289)\n>         at java.lang.ClassLoader.loadClass(ClassLoader.java:252)\n>         at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:320)\n>         ... 16 more\n> \n\n", "is_private": false, "bug_id": 44900, "id": 116017, "time": "2008-04-29T03:15:34Z", "creator": "ettikx@gmail.com", "creation_time": "2008-04-29T03:15:34Z", "attachment_id": null}, {"count": 9, "text": "Hi,\nI can reproduce the problem now.\n\n- I need to comment out the second exec (the\n  permissions one) as it uses ksh, and it\n  it not relevant to the bug.\n\nOn ant-1.6.5 things work, on ant-1.7.0 they do not.\n\n", "bug_id": 44900, "attachment_id": null, "id": 116018, "time": "2008-04-29T03:30:52Z", "creator": "peterreilly@apache.org", "creation_time": "2008-04-29T03:30:52Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "text": "works fine when using ProjectHelper2 rather than projectHelperImpl which has bencome unused since 1.3 or something like that.", "attachment_id": null, "id": 172085, "creation_time": "2014-01-05T14:27:33Z", "time": "2014-01-05T14:27:33Z", "creator": "bodewig@apache.org", "bug_id": 44900, "is_private": false}]
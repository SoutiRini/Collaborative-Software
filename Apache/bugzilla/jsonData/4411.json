[{"count": 0, "text": "Hi;\n\nbefore all, thank you so much for the FTP task which makes my life easier.\nI have an heavy use of this task, and I discovered some weird behavior when \nhandling remote files within nested directory from the remoteDir.\n\nI took a look a the code, and eventually discovered the bug in the\nprotected void scandir(String dir, String vpath, boolean fast)\nmethod from class\norg.apache.tools.ant.taskdefs.optional.net.FTP\n\nThe bug is due to a confusion between file name and relative path name. Here is \nthe fix that I propose. I've tested it and it seems to be allright now.\n\nDo not hesitate to ask for anything, but please fix the bug in the next release \nbecause I'm working with my own version of optional.jar and it's not very \ncomfortable.\n\nBests regards,\nEdouard Mercier\n\n\n\n        protected void scandir(String dir, String vpath, boolean fast) {\n            try {\n                if (!ftp.changeWorkingDirectory(dir)) {\n                    return;\n                }\n\n                FTPFile[] newfiles = ftp.listFiles();\n                if (newfiles == null) {\n                    ftp.changeToParentDirectory();\n                    return;\n                }\n\n                for (int i = 0; i < newfiles.length; i++) {\n                    FTPFile file = newfiles[i];\n                    if (!file.getName().equals(\".\") && !file.getName().equals\n(\"..\")) {\n                        if (file.isDirectory()) {\n                            String name = vpath+file.getName();\n\t\t\t\t\t\t\tif (isIncluded(name)) {\n\t\t\t\t\t\t\t\tif (!isExcluded\n(name)) {\n\t\t\t\t\t\t\t\t\n\tdirsIncluded.addElement(name);\n\t\t\t\t\t\t\t\t\tif \n(fast) {\n\t\t\t\t\t\t\t\t\t\n\tscandir(file.getName(), name+File.separator, fast);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\n\tdirsExcluded.addElement(name);\n\t\t\t\t\t\t\t\t\tif \n(fast && couldHoldIncluded(name)) {\n\t\t\t\t\t\t\t\t\t\n\tscandir(file.getName(), name+File.separator, fast);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\n\tdirsNotIncluded.addElement(name);\n\t\t\t\t\t\t\t\tif (fast && \ncouldHoldIncluded(name)) {\n\t\t\t\t\t\t\t\t\tscandir\n(file.getName(), name+File.separator, fast);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (!fast) {\n\t\t\t\t\t\t\t\tscandir\n(file.getName(), name+File.separator, fast);\n\t\t\t\t\t\t\t}\n                        } else {\n                            if (file.isFile()) {\n                                String name = vpath + file.getName();\n\t\t\t\t\t\t\t\tif (isIncluded\n(name)) {\n\t\t\t\t\t\t\t\t\tif (!\nisExcluded(name)) {\n\t\t\t\t\t\t\t\t\t\n\tfilesIncluded.addElement(name);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\n\tfilesExcluded.addElement(name);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\n\tfilesNotIncluded.addElement(name);\n\t\t\t\t\t\t\t\t}\n                            }\n                        }\n                    }\n                }\n                ftp.changeToParentDirectory();\n            } catch (IOException e) {\n                throw new BuildException(\"Error while communicating with FTP \nserver: \", e);\n            }\n        }\n    }", "bug_id": 4411, "attachment_id": null, "id": 7137, "time": "2001-10-25T00:26:50Z", "creator": "emercier@openup.fr", "creation_time": "2001-10-25T00:26:50Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "bodewig@apache.org", "text": "Any chance you could provide the patch as an attachement using \"cvs diff -u\" or\nsimilar?", "id": 7253, "time": "2001-10-29T07:21:34Z", "bug_id": 4411, "creation_time": "2001-10-29T07:21:34Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 4411, "attachment_id": 778, "text": "Created attachment 778\nThe FTP.java source correcting the bug", "id": 7713, "time": "2001-11-09T04:38:55Z", "creator": "emercier@openup.fr", "creation_time": "2001-11-09T04:38:55Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 4411, "attachment_id": null, "text": "What else should I say?\nYes, I have also developed an additional feature for this FTP task, which \nenables to create a Java property file listing all the remotely listed files on \nthe server, instead of the default file when \"listing\" action is asked for.\nI think this feature is really useful.", "id": 7714, "time": "2001-11-09T04:42:00Z", "creator": "emercier@openup.fr", "creation_time": "2001-11-09T04:42:00Z", "is_private": false}, {"count": 4, "tags": [], "creator": "sbailliez@apache.org", "text": "Edouard, as Stefan says, the fact that you post the whole file or a simple \nsnippet makes it difficult to see what are the real changes you did.\n\nAs we don't even know what is your reference source, it makes it even more \ndifficult to do a diff. Plus in the whole file you added a loop to print out \nstatements in french that you commented. statements are commented but the loop \nremains.\n\nIf you don't know how to deal with cvs, please identify *clearly* the lines you \nchanged. As far as I can see the changes are related to the case \"if \n(file.isDirectory())\" where you moved up the vpath + file.getName() and you \nadded a\n\nif (fast && couldHoldIncluded(name)) {\n  scandir(file.getName(), name+File.separator, fast);\n}\n\nyou did a change in listFiles as well.\n\nPlease confirm this ASAP with the motivation.\n", "id": 8013, "time": "2001-11-16T15:09:21Z", "bug_id": 4411, "creation_time": "2001-11-16T15:09:21Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "text": "I don't think that a bug in an optional task should be a blocker, much less\nif the original reporter has lost interest in it.", "id": 13007, "time": "2002-04-08T12:08:44Z", "bug_id": 4411, "creation_time": "2002-04-08T12:08:44Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 4411, "attachment_id": null, "text": "Hello to all;\n\nI did not lose interest to that bug!\nWhat do you expect me to do in order to fix that bug? By the way, I remind you \nthat this is an actual bug at the beginning, even if I eventually talk about a \npossible extension of the ftp task...\n\nWhy did I not send just the CVS difference with the current \norg.apache.tools.ant.taskdefs.optional.net.FTP\n class? Because, I currently do not benefit from a connection to the CVS \nserver, for I am behind a fierce firewall.\n\nBut, as you can see, I also sent an attachment which the complete class.\n\nI am pretty interested in any Ant further development. Besides, I have \ndeveloped a task that integrates Jindent. I am currently developing a task that \ngenerates AntDoc for an Ant script. I do not think I am lazy, so just tell me \nwhat to do in order to close that bug, and I will do my best !\n\nBest regards,\n\nEdouard", "id": 13590, "time": "2002-04-15T07:30:05Z", "creator": "emercier@openup.fr", "creation_time": "2002-04-15T07:30:05Z", "is_private": false}, {"count": 7, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 13605, "time": "2002-04-15T09:59:01Z", "bug_id": 4411, "creation_time": "2002-04-15T09:59:01Z", "is_private": false, "text": "I am glad you haven't lost interest, it just looked that way as you didn't respond\nto Stephane's question.\n\nYou can easily download the latest CVS version from the webcvs frontend, patch it\nso it does what you want and create a plain \"diff -u\".  The problem with\nsubmitting the whole file is, that the change itself is rather difficult to track.\n\nI've just diffed your file (ignoring whitespace changes) against the latest CVS\nversion and have found some changes that don't seem to be related to what you want\nat all - so please help me understanding your changes.\n\nThe format of the listFile method is the way (some) people want it, so if you\nwant a different format, you should make that a new option.\n\nIf I understand your patch correctly, FTP right now will not look at the\ndirectory part of a file name when matching includes/excludes, which you now\nenable.  Correct?\n\nYou also add a new conditional scandir call inside the part that handles\nexcluded directories.\n\nI think you are correct and have committed a change to that effect - could you\nplease see whether nightly build 2002-04-16 works as expected?\n "}, {"count": 8, "tags": [], "creator": "emercier@openup.fr", "attachment_id": null, "id": 13660, "time": "2002-04-15T17:39:13Z", "bug_id": 4411, "creation_time": "2002-04-15T17:39:13Z", "is_private": false, "text": "OK, after a close look at the org.apache.tools.ant.taskdefs.optional.net.FTP \nclass, I come tot the conclusion that there is no more bug concerning the \nscandir method. The bug has been fixed meanwhile by someone who forgot to close \nthat bug #4411.\n\nSorry for the disturbance. Thank you for your work.\n\nStephane, my error was to have forgotten to remove my specific listing format, \nso do not take this into account.\n\nEdouard"}, {"count": 9, "tags": [], "bug_id": 4411, "attachment_id": null, "text": "I was the one who fixed the bug just yesterday 8-)\n\nI didn't close the report because I wanted you to verify I had fixed it.  Thanks.", "id": 13721, "time": "2002-04-16T06:02:33Z", "creator": "bodewig@apache.org", "creation_time": "2002-04-16T06:02:33Z", "is_private": false}, {"count": 10, "text": "*** Bug 8434 has been marked as a duplicate of this bug. ***", "bug_id": 4411, "attachment_id": null, "id": 14614, "time": "2002-04-24T11:47:43Z", "creator": "bodewig@apache.org", "creation_time": "2002-04-24T11:47:43Z", "tags": [], "is_private": false}]
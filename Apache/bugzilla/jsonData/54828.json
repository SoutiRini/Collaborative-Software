[{"count": 0, "tags": [], "bug_id": 54828, "attachment_id": null, "id": 166525, "time": "2013-04-11T00:12:30Z", "creator": "wiml@omnigroup.com", "creation_time": "2013-04-11T00:12:30Z", "is_private": false, "text": "Apache 2.4.4 will segfault if you have a log field containing the request's END time (LogFormat \"... %{end:msec}t ...\") and you send it an invalid request. Several 400-series errors seem to do the trick:\n  - 404 not found\n  - 400 bad request after sending a MOVE with no Destination:\n  - 403 unauthorized\n\nThe crash is completely repeatable.\n\nThe crash is in get_request_end_time(). It successfully retrieves 'log_request_state *state' from the request record, but state is NULL, and Apache crashes when it tries to read state->request_end_time. Here's the backtrace:\n\n\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: KERN_INVALID_ADDRESS at address: 0x0000000000000000\n0x0000000100068d6d in get_request_end_time ()\n(gdb) bt\n#0  0x0000000100068d6d in get_request_end_time ()\n#1  0x0000000100068e9d in log_request_time ()\n#2  0x0000000100069ea0 in process_item ()\n#3  0x000000010006a188 in config_log_transaction ()\n#4  0x000000010006a407 in multi_log_transaction ()\n#5  0x000000010002aa45 in ap_run_log_transaction ()\n#6  0x000000010003c60a in eor_bucket_cleanup ()\n#7  0x0000000100465661 in run_cleanups ()\n#8  0x00000001004644c5 in apr_pool_destroy ()\n#9  0x000000010003c753 in eor_bucket_destroy ()\n#10 0x000000010003ded0 in remove_empty_buckets ()\n#11 0x000000010003de75 in send_brigade_nonblocking ()\n#12 0x000000010003df4c in send_brigade_blocking ()\n#13 0x000000010003d87a in ap_core_output_filter ()\n#14 0x0000000100022153 in ap_pass_brigade ()\n#15 0x000000010005b9a8 in ap_process_request ()\n#16 0x000000010005744f in ap_process_http_sync_connection ()\n#17 0x000000010005754a in ap_process_http_connection ()\n#18 0x000000010001995a in ap_run_process_connection ()\n#19 0x0000000100019e2b in ap_process_connection ()\n#20 0x00000001000e24d8 in child_main ()\n#21 0x00000001000e25e4 in make_child ()\n#22 0x00000001000e2c5d in prefork_run ()\n#23 0x000000010001c4d1 in ap_run_mpm ()\n#24 0x000000010000d978 in main ()\n\n(Actually I first hit this on SSL connections, so there were a few SSL-related stack frames in there, but turning off SSL and using plain HTTP does not affect the crash.)"}, {"count": 1, "tags": [], "bug_id": 54828, "attachment_id": null, "id": 166596, "time": "2013-04-14T11:19:15Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2013-04-14T11:19:15Z", "is_private": false, "text": "Fixed for trunk in r1467765.\nWill propose for backport to 2.4.x.\n\nCould you please verify the patch?\nIt is available at\n\n    http://people.apache.org/~rjung/patches/httpd-2_4-request_end_time.patch\n\nor\n\n    http://svn.apache.org/viewvc?view=revision&revision=r1467765\n\nThanks!\n\nRainer"}, {"count": 2, "tags": [], "bug_id": 54828, "attachment_id": null, "text": "The patch applies cleanly to 2.4.4 and fixes the crash, at least for the causes I had isolated earlier. Thanks!", "id": 166638, "time": "2013-04-15T22:37:46Z", "creator": "wiml@omnigroup.com", "creation_time": "2013-04-15T22:37:46Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 54828, "attachment_id": null, "text": "Fixed in 2.4.x in r1467981. Will be part of 2.4.5.", "id": 166645, "time": "2013-04-16T07:45:51Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2013-04-16T07:45:51Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 54828, "attachment_id": null, "text": "Fixed in v2.4.5.", "id": 166960, "time": "2013-04-30T14:10:46Z", "creator": "minfrin@sharp.fm", "creation_time": "2013-04-30T14:10:46Z", "is_private": false}]
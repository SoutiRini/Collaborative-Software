[{"count": 0, "tags": [], "bug_id": 48155, "text": "1. (ENHANCEMENT) Added method \"getMessageHeaders()\" to BaseJMSSubscriber class to create String representation of the JMS Message Header variables.\n\n    /**\n     * Returns a String with the JMS Message Header values.\n     * \n     * @param message JMS Message\n     * @return String with message header values.\n     */\n    public static String getMessageHeaders(Message message) {\n        final StringBuffer response = new StringBuffer(256);\n        try {\n            response.append(\"JMS Message Header Attributes:\");\n            response.append(\"\\n   Correlation ID: \");\n            response.append(message.getJMSCorrelationID());\n\n            response.append(\"\\n   Delivery Mode: \");\n            if (message.getJMSDeliveryMode() == DeliveryMode.PERSISTENT) {\n                response.append(\"PERSISTENT\");\n            } else {\n                response.append(\"NON-PERSISTENT\");\n            }\n\n            final Destination destination = message.getJMSDestination();\n\n            response.append(\"\\n   Destination: \");\n            response.append((destination == null ? null : destination\n                .toString()));\n\n            response.append(\"\\n   Expiration: \");\n            response.append(new Date(message.getJMSExpiration()));\n\n            response.append(\"\\n   Message ID: \");\n            response.append(message.getJMSMessageID());\n\n            response.append(\"\\n   Priority: \");\n            response.append(message.getJMSPriority());\n\n            response.append(\"\\n   Redelivered: \");\n            response.append(message.getJMSRedelivered());\n\n            final Destination replyTo = message.getJMSReplyTo();\n            response.append(\"\\n   Reply to: \");\n            response.append((replyTo == null ? null : replyTo.toString()));\n\n            response.append(\"\\n   Timestamp: \");\n            response.append(new Date(message.getJMSTimestamp()));\n\n            response.append(\"\\n   Type: \");\n            response.append(message.getJMSType());\n\n            response.append(\"\\n\\n\");\n        } catch (JMSException e) {\n            e.printStackTrace();\n        }\n        return new String(response);\n    }\n\n2. (DEFECT) SubscriberSampler.sampleWithListener() does not call\n\n   result.setDataType(SampleResult.TEXT);\n\nso the result data is not displayed in the Response Data pane.\n\n3. (DEFECT) Same problem exists with SubscriberSampler.sampleWithReceive() \n\n4. (ENHANCEMENT) Add call getMessageHeaders() to SubscriberSampler.onMessage() so that JMS Message Header info can be displayed in Response Data pane:\n\n   this.BUFFER.append(getMessageHeaders(message));\n   this.BUFFER.append(\"JMS Message Text:\\n\\n\");\n   this.BUFFER.append(content);\n\n5. (DEFECT) ReceiveSubscriber() constructor is using mix of local and instance variable to try to create TopicSession and TopicSubscriber resulting in NPE.  Use the instance variables instead, remove the local variables.\n\n6. (ENHANCEMENT) modify ReceiveSubscriber.run() to add JMS Header to data buffer:\n\n   synchronized (this) {\n      this.buffer.append(BaseJMSSampler.getMessageHeaders(message));\n      this.buffer.append(\"JMS Message Text:\\n\\n\");\n      this.buffer.append(text);\n      count(1);\n   }\n\n7 (DEFECT) PublisherSampler.sample() is missing call to result.setDataType(SampleResult.TEXT) and add calls to set the Request Data and Result values:\n\n    public SampleResult sample() {\n        SampleResult result = new SampleResult();\n        \n        // REQUIRED TO DISPLAY IN REQEST / RESPONSE PANES\n        result.setDataType(SampleResult.TEXT);\n        result.setSampleLabel(getName());\n        if (this.PUB == null) {\n            this.initClient();\n        }\n        int loop = this.getIterationCount();\n        if (this.PUB != null) {\n            result.sampleStart();\n            for (int idx = 0; idx < loop; idx++) {\n                String tmsg = this.getMessageContent();\n                this.PUB.publish(tmsg);\n                this.BUFFER.append(tmsg);\n            }\n            result.sampleEnd();\n            String content = this.BUFFER.toString();\n            result.setBytes(content.getBytes().length);\n            result.setResponseCode(\"message published successfully\");\n            result.setResponseMessage(loop + \" messages published\");\n            result.setSuccessful(true);\n            // SET RESPONSE PANE DATA TO N/A\n            result.setResponseData(\"Not Applicable\".getBytes());\n            // SET REQUEST PANE DATA\n            result.setSamplerData(content);\n            result.setSampleCount(loop);\n            this.BUFFER.setLength(0);\n        }\n        return result;\n    }", "id": 131773, "time": "2009-11-06T11:35:47Z", "creator": "martinrleon@yahoo.com", "creation_time": "2009-11-06T11:35:47Z", "is_private": false, "attachment_id": null}, {"count": 1, "text": "Created attachment 24503\nProposed patches", "bug_id": 48155, "is_private": false, "id": 131782, "time": "2009-11-06T19:19:13Z", "creator": "martinrleon@yahoo.com", "creation_time": "2009-11-06T19:19:13Z", "tags": [], "attachment_id": 24503}, {"count": 2, "tags": [], "bug_id": 48155, "text": "Thanks for the suggestions.\n\nUnfortunately they cannot be applied as they stand, as the source code has changed, and the changes are provided as full source files which no longer provide sensible differences.\n\nPlease can you provide the changes as patches in unified difference format?\n\nIdeally against the current version in SVN, but even differences from the source you based your changes on would probably be OK.", "id": 131944, "time": "2009-11-13T14:41:29Z", "creator": "sebb@apache.org", "creation_time": "2009-11-13T14:41:29Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "martinrleon@yahoo.com", "text": "I'm a newbie to submitting patch suggestions.  I am attaching a ZIP file with the original and fixed files in separate folders.  If you need me to do more, please let me know.  I want to contribute in whatever way I can.  Thank you for such a great tool!  I am still learning it, but I see it as a very valuable tool, thank you very much!", "id": 131949, "time": "2009-11-13T17:12:23Z", "bug_id": 48155, "creation_time": "2009-11-13T17:12:23Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 48155, "text": "Created attachment 24531\nPatches with original source", "id": 131950, "time": "2009-11-13T17:13:50Z", "creator": "martinrleon@yahoo.com", "creation_time": "2009-11-13T17:13:50Z", "is_private": false, "attachment_id": 24531}, {"attachment_id": null, "tags": [], "creator": "martinrleon@yahoo.com", "is_private": false, "count": 5, "id": 131951, "time": "2009-11-13T17:23:00Z", "bug_id": 48155, "creation_time": "2009-11-13T17:23:00Z", "text": "I re-read your response, what is a \"unified different format\"?  Can you point me to a URL explaining how to do this?\n\nThe files I provided can be \"diff\"d against each other.  They are the original 2.3.4 source and the fixed source files.\n\nPlease let me know if you want me to do something different."}, {"count": 6, "tags": [], "bug_id": 48155, "text": "(In reply to comment #5)\n> I re-read your response, what is a \"unified different format\"?  Can you point\n> me to a URL explaining how to do this?\n\nhttp://www.apache.org/dev/contributors.html#patches", "id": 131952, "time": "2009-11-13T18:50:47Z", "creator": "sebb@apache.org", "creation_time": "2009-11-13T18:50:47Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "martinrleon@yahoo.com", "attachment_id": 24532, "text": "Created attachment 24532\nProposed patches\n\nThanks for guide on patches.  Here's the resulting patch file.", "id": 131954, "time": "2009-11-13T19:50:25Z", "bug_id": 48155, "creation_time": "2009-11-13T19:50:25Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "sebb@apache.org", "is_private": false, "count": 8, "id": 131964, "time": "2009-11-14T14:09:36Z", "bug_id": 48155, "creation_time": "2009-11-14T14:09:36Z", "text": "(In reply to comment #7)\n> Created an attachment (id=24532) [details]\n> Proposed patches\n> \n> Thanks for guide on patches.  Here's the resulting patch file.\n\nUnfortunately the patch appears to have been made by comparing your version against the current code in trunk. As your changes were not made to the current code, this means that several recent changes would be lost if the patches were applied.\n\nWhat's needed is a patch file showing exactly what you changed, i.e. the changes need to be against whatever you started with, which I think was 2.3.4?\n\nAlternatively, redo your changes to the current code in trunk, and produce a new patch for that."}, {"count": 9, "tags": [], "bug_id": 48155, "is_private": false, "text": "Created attachment 24538\nProposed patches against current revision\n\nOne more time....  Thanks for your patience with a rookie!", "id": 131969, "time": "2009-11-14T15:26:49Z", "creator": "martinrleon@yahoo.com", "creation_time": "2009-11-14T15:26:49Z", "attachment_id": 24538}, {"count": 10, "tags": [], "bug_id": 48155, "text": "Is there anything else I need to do to get this patch to be in an acceptable format?\n\n(In reply to comment #8)\n> (In reply to comment #7)\n> > Created an attachment (id=24532) [details] [details]\n> > Proposed patches\n> > \n> > Thanks for guide on patches.  Here's the resulting patch file.\n> \n> Unfortunately the patch appears to have been made by comparing your version\n> against the current code in trunk. As your changes were not made to the current\n> code, this means that several recent changes would be lost if the patches were\n> applied.\n> \n> What's needed is a patch file showing exactly what you changed, i.e. the\n> changes need to be against whatever you started with, which I think was 2.3.4?\n> \n> Alternatively, redo your changes to the current code in trunk, and produce a\n> new patch for that.", "id": 132699, "time": "2009-12-09T14:43:21Z", "creator": "martinrleon@yahoo.com", "creation_time": "2009-12-09T14:43:21Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "sebb@apache.org", "text": "The patch is a lot better, but still makes some unnecessary changes, for example:\n\n-    private final TopicConnection CONN;\n+    private TopicConnection CONN = null;\n\nand related changes in the static {} block.\n\nIt's important that the variable (and others like it) remains final, otherwise it may not be published correctly across threads.\n\nHowever, I think I can work round those changes; the other changes look OK.", "id": 132736, "time": "2009-12-10T14:58:50Z", "bug_id": 48155, "creation_time": "2009-12-10T14:58:50Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 48155, "text": "Applied to SVN:\n\nURL: http://svn.apache.org/viewvc?rev=889456&view=rev\nLog:\nBug 48155 - Multiple problems / enhancements with JMS protocol classes\n\nI made one or two other changes, for example responseCode should be \"200\" for OK, not a text message.\n\nThe code will be in nightly builds after r889456 - please re-open the bug if there are any problems.", "id": 132737, "time": "2009-12-10T15:02:47Z", "creator": "sebb@apache.org", "creation_time": "2009-12-10T15:02:47Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "creator": "martinrleon@yahoo.com", "text": "My first open source bug patch!  Woohoo!\n\nThanks for the free lessons.  Hopefully I'll be able to contribute more in the future.\n\n(In reply to comment #12)\n> Applied to SVN:\n> \n> URL: http://svn.apache.org/viewvc?rev=889456&view=rev\n> Log:\n> Bug 48155 - Multiple problems / enhancements with JMS protocol classes\n> \n> I made one or two other changes, for example responseCode should be \"200\" for\n> OK, not a text message.\n> \n> The code will be in nightly builds after r889456 - please re-open the bug if\n> there are any problems.", "id": 132742, "time": "2009-12-10T18:21:30Z", "bug_id": 48155, "creation_time": "2009-12-10T18:21:30Z", "is_private": false, "attachment_id": null}]
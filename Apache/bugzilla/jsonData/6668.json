[{"count": 0, "tags": [], "bug_id": 6668, "attachment_id": null, "is_private": false, "id": 11139, "time": "2002-02-25T21:16:27Z", "creator": "craig.setera@kingland.com", "creation_time": "2002-02-25T21:16:27Z", "text": "We've been debugging a problem in our application related to the port being \nsent during a redirect.  In our case, both the host and port requested will be \nmapped on the way into and out of our network.  We obviously need our redirects \nto be sent with the correct server and port set, but we were seeing only the \nhost being sent back correctly in the redirect response.\n\nAfter some time debugging, it seems that there is a bug in the parseHeaders() \nmethod of org.apache.catalina.connector.http.HttpProcessor.  In that method, \nthe \"host\" HTTP header is processed to set the server name and port.  According \nto the HTTP 1.1 Spec (section 14.23) \"A \"host\" without any trailing port \ninformation implies the default port for the service request (e.g., 80 for an \nHTTP URL)\".  The parse headers code does not appear to set the server port if \nthe \":\" is not found in the header and therefore the port remains the original \nport specified on the connector.\n\nIt would seem that the current handling of the no-colon case should be changed \nto something like this:\n               if (n < 0) {\n                \tif (connector.getScheme().equals(\"http\")) {\n                \t\trequest.setServerPort(80);\n                \t} else if (connector.getScheme().equals(\"https\")) {\n                \t\trequest.setServerPort(443);\n                \t}\n                \t\n                    if (proxyName != null)\n                        request.setServerName(proxyName);\n                    else\n                        request.setServerName(value);\n                } else { ...\n\nAfter patching the source locally, this solves our proxy redirection problems.  \nIt may be that bugzilla bug #5762 is related to this, although it is kind of \nhard to tell."}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 11280, "time": "2002-02-28T04:26:48Z", "bug_id": 6668, "creation_time": "2002-02-28T04:26:48Z", "is_private": false, "text": "Very good report, and thanks for the patch. I've applied it on both branches, so\nit will be included in 4.0.3.\nYou are probably right about bug 5762 (I'll mark it as a duplicate)."}, {"count": 2, "tags": [], "text": "*** Bug 5762 has been marked as a duplicate of this bug. ***", "attachment_id": null, "id": 11282, "creator": "remm@apache.org", "time": "2002-02-28T04:27:33Z", "bug_id": 6668, "creation_time": "2002-02-28T04:27:33Z", "is_private": false}, {"count": 3, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 14750, "time": "2002-04-25T15:57:09Z", "bug_id": 6668, "creation_time": "2002-04-25T15:57:09Z", "text": "*** Bug 8519 has been marked as a duplicate of this bug. ***"}, {"count": 4, "tags": [], "text": "*** Bug 8588 has been marked as a duplicate of this bug. ***", "is_private": false, "bug_id": 6668, "id": 14977, "time": "2002-04-29T07:10:04Z", "creator": "remm@apache.org", "creation_time": "2002-04-29T07:10:04Z", "attachment_id": null}]
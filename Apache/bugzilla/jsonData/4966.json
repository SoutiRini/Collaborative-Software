[{"count": 0, "tags": [], "bug_id": 4966, "attachment_id": null, "id": 8087, "time": "2001-11-20T03:05:49Z", "creator": "andreas.bielk@codesense.com", "creation_time": "2001-11-20T03:05:49Z", "is_private": false, "text": "Setup: \nWe have a servlet that is called (GET) by a shell-script every minute, always with the same URL. Every 25th reqeust or so, tomcat seems to fail parsing the querystring. The server is not under heavy load, the shell-script is the only client.\n\nCode (servlet):\n  protected void doGet(HttpServletRequest request, HttpServletResponse response)\n  throws ServletException, IOException\n  {    \n    // get requests and features\n    String templateName = request.getParameter(URL_TEMPLATE);\n    String hintString = request.getParameter(URL_FORMAT);\n\n    // check template\n    if (templateName == null || templateName.equals(\"\"))\n    {\n      // debug f\u00f6r felet p\u00e5 prod6\n      SystemLog.debug(\"Template missing in request [\"+request.getParameter(URL_TEMPLATE)+\"] in [\"+request.getQueryString()+\"]\");\n      error(\"Template missing in request\",request,response);\n      return;\n    }\n\nOutput (SystemLog.debug is a simple System.out.println):\nDEBUG msg:Template missing in request [null] in [t=billerud_day&f=pngm]"}, {"count": 1, "tags": [], "bug_id": 4966, "attachment_id": null, "id": 8161, "time": "2001-11-21T13:29:20Z", "creator": "remm@apache.org", "creation_time": "2001-11-21T13:29:20Z", "is_private": false, "text": "Have you checked in the access logs that all the requests were indeed \nspecifying the parameters ?"}, {"count": 2, "tags": [], "bug_id": 4966, "text": "I created a simple servlet accessing the request parameters, with debug code \nlike:\nString foo = req.getParameter(\"foo\");\nif (foo == null) {\n   System.out.println(\"No foo in URL:\" + req.getRequestURL());\n}\n\nI then used ab to hammer the servlet (called S3, and added to the examples \nwebapp) on:\nhttp://127.0.0.1:8080/examples/servlet/S3?dfsds=dasdfas&foo=bar&fsdiuwe=qfebwejh\n\nWith concurrency set to 50 and 5000 requests, I didn't get a single failure.", "id": 8485, "time": "2001-11-30T23:31:16Z", "creator": "remm@apache.org", "creation_time": "2001-11-30T23:31:16Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 4966, "attachment_id": null, "id": 8498, "time": "2001-12-01T05:16:22Z", "creator": "andreas.bielk@codesense.com", "creation_time": "2001-12-01T05:16:22Z", "is_private": false, "text": "Missed the 2001-11-21 comment. As you can see in the output, the querystring\nis correct, the accesslogs are correct and all requests are identical. The load is always the same, beacause the servlet is called from a shellscript, a request is finished when the next is done.\n\nWe don\u00b4t see this problem with Tomcat 3.2.3.\n\nI\u00b4ll do some more tests with some other JVMs (now we are running IBM 1.3)."}, {"count": 4, "tags": [], "bug_id": 4966, "attachment_id": null, "id": 8500, "time": "2001-12-01T09:55:48Z", "creator": "remm@apache.org", "creation_time": "2001-12-01T09:55:48Z", "is_private": false, "text": "That's great, but if I can't reproduce the problem, I can't fix it.\nDo you see anything which would make my test case different than your \nsituation ?"}, {"count": 5, "tags": [], "bug_id": 4966, "text": "I\u00b4ll create a testcase and run it on some more platforms, I\u00b4ll get back to you when I can get it to fail in predictable way.\n\n", "id": 8506, "time": "2001-12-02T05:42:11Z", "creator": "andreas.bielk@codesense.com", "creation_time": "2001-12-02T05:42:11Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 4966, "is_private": false, "id": 8578, "creation_time": "2001-12-04T13:34:49Z", "time": "2001-12-04T13:34:49Z", "creator": "andreas.bielk@codesense.com", "text": "Ok, I ran some tests today with both IBM1.3 (Linux) and Sun1.3.1 (Linux) with the following code :\n\n  protected void doGet(HttpServletRequest request, HttpServletResponse response)\n    throws ServletException, IOException\n  {\n    // get requests and features\n    String templateName = request.getParameter(\"t\");\n\n    if (templateName == null || templateName.equals(\"\"))\n    {\n      // sout parameter and QueryString\n      System.out.println((new Date())+\" Parameter missing in request [\" + request.getParameter(\"t\") + \"] in [\" + request.getQueryString() + \"]\");\n\n      // did we get ANY params?\n      Enumeration enum = request.getParameterNames();\n      while(enum.hasMoreElements())\n      {\n        String name = (String)enum.nextElement();\n        String[] sarr = request.getParameterValues(name);\n        for(int i1 = 0; i1 < sarr.length; i1++)\n        {\n          String s = sarr[i1];\n          System.out.println(\" --> \" + name + \" = \" + s);\n        }\n      }\n    }\n\n    response.setContentType(\"text/plain\");\n    java.io.PrintWriter out = response.getWriter();\n    out.println(\"TomcatTestServlet\");\n    out.close();\n  }\n\nThe testcase was called 8 times/h for 8h and failed (IBM):\nTue Dec 04 11:04:33 GMT+01:00 2001 Parameter missing in request [null] in [t=billerud_day&f=pngm]\nTue Dec 04 12:14:34 GMT+01:00 2001 Parameter missing in request [null] in [t=billerud_day&f=pngm]\nTue Dec 04 17:12:36 CET 2001 Parameter missing in request [null] in [t=billerud_day&f=pngm]\n\ne.g. neither the parameter \"t\" or \"f\" have been proparly parsed. The result with Sun1.3 was the same (failed 4 times in 8h). It\u00b4s really tricky to find the cause when it\u00b4s so hard to reproduce (all bugs of the kind \"sometime fails\" are)! If I have time i\u00b4ll try to run some tests on a w2k tomorrow.\n\nAny thoughts?", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 4966, "text": "Sorry, the:\n\nTue Dec 04 17:12:36 CET 2001 Parameter missing in request [null] in [t=billerud_day&f=pngm]\n\nis from the Sun1.3. Just me copy:ing and paste:ing..", "id": 8579, "time": "2001-12-04T13:36:52Z", "creator": "andreas.bielk@codesense.com", "creation_time": "2001-12-04T13:36:52Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 4966, "text": "Maybe, but I cannot see any difference between your test and my test, which \ndidn't cause any single failures over thousands of requests (with a high \nconcurrency level).", "id": 8582, "time": "2001-12-04T17:16:33Z", "creator": "remm@apache.org", "creation_time": "2001-12-04T17:16:33Z", "is_private": false, "attachment_id": null}]
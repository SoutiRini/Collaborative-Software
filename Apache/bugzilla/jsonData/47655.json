[{"count": 0, "tags": [], "text": "Created attachment 24111\nexception 1\n\nErrors appeared after stopping and starting tomcat.", "attachment_id": 24111, "bug_id": 47655, "id": 129536, "time": "2009-08-06T07:31:59Z", "creator": "o2shopsupport@razorfish.com", "creation_time": "2009-08-06T07:31:59Z", "is_private": false}, {"count": 1, "tags": [], "creator": "o2shopsupport@razorfish.com", "attachment_id": 24112, "id": 129537, "time": "2009-08-06T07:32:57Z", "bug_id": 47655, "creation_time": "2009-08-06T07:32:57Z", "is_private": false, "text": "Created attachment 24112\nexception 2"}, {"count": 2, "tags": [], "creator": "o2shopsupport@razorfish.com", "text": "Created attachment 24113\nexception 3", "id": 129538, "time": "2009-08-06T07:33:35Z", "bug_id": 47655, "creation_time": "2009-08-06T07:33:35Z", "is_private": false, "attachment_id": 24113}, {"count": 3, "tags": [], "creator": "o2shopsupport@razorfish.com", "text": "We use tomcats for hosting web services. Because the NPEs a web service client resends the soap message. The calls are processed two times, which cause failures.\nRestarting tomcat can solve the issue, but not always. First occured after a normal restart, there were no changes in the deployed applications.\n\nTo contact us please use the provided e-mail address.\n\nRegards,\nBertalan Kis", "id": 129539, "time": "2009-08-06T07:41:47Z", "bug_id": 47655, "creation_time": "2009-08-06T07:41:47Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 129549, "time": "2009-08-06T15:14:17Z", "bug_id": 47655, "creation_time": "2009-08-06T15:14:17Z", "is_private": false, "text": "That looks very much like the application is holding onto a copy of the response object and trying to use it when Tomcat thinks the request is complete and has recycled the response object for use with a following request.\n\nTry setting the system property:\norg.apache.catalina.connector.RECYCLE_FACADES=true\n\nThis forces the facades to be recycled more thoroughly. You'll probably still see NPEs but they should occur where a request/response is used in an invalid manner."}, {"count": 5, "attachment_id": null, "bug_id": 47655, "text": "Thanks for the advice. We will try this option, but it will need to go through our release process, which is slow. It can be released in several weeks from now.", "id": 129592, "time": "2009-08-10T02:55:11Z", "creator": "o2shopsupport@razorfish.com", "creation_time": "2009-08-10T02:55:11Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "creator": "markt@apache.org", "text": "No response in three months, assume it was an app issue.", "id": 132214, "time": "2009-11-22T14:21:04Z", "bug_id": 47655, "creation_time": "2009-11-22T14:21:04Z", "is_private": false, "attachment_id": null}, {"count": 7, "attachment_id": null, "bug_id": 47655, "is_private": false, "id": 134091, "time": "2010-02-01T01:24:22Z", "creator": "o2shopsupport@razorfish.com", "creation_time": "2010-02-01T01:24:22Z", "tags": [], "text": "Sorry for not updating the ticket.\nAs I mentioned there is a very slow release process here. We could apply the suggested org.apache.catalina.connector.RECYCLE_FACADES=true system property last thursday.\nUnfortunatelly it wasn't solved the issue, we see the same excpetions in the logs."}, {"count": 8, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 134106, "time": "2010-02-01T09:09:41Z", "bug_id": 47655, "creation_time": "2010-02-01T09:09:41Z", "is_private": false, "text": "As per #4 this still looks like an app issue rather than a Tomcat one. Please follow up on the users list. You'll want to include an up to date stack trace."}, {"count": 9, "tags": [], "text": "Looking at all the three stack traces (from the Description and Comment 1, Comment 2), all of them occur only if in MimeHeaders class methods headers[i] occurs to be null.\n\nThat is particularly visible from the third stack trace, that points to \norg.apache.tomcat.util.http.MimeHeaders.clear(MimeHeaders.java:130)\n\nMimeHeaders.headers[i] equal to null can be only if MimeHeaders.count has a wrong value, or if a new MimeHeaderField was assigned to a wrong cell in the array, or to a wrong array when the array was expanded. That can only occur if MimeHeaders.createHeader() or MimeHeaders.removeHeader(int) were called concurrently by multiple threads.\n\n\nMimeHeaders class is not safe for multithreading. Therefore response.setHeader(...), response.addHeader(...) methods are not thread-safe.\n\nThus, if several threads add/set headers asynchronously, you will see this error.\n\nThis behavior conforms to the specification - see chapter SRV.2.3.3.3 in Java Servlet Specification 2.5.  It says \"Implementations of the request and response objects are not guaranteed to be thread safe.\"", "attachment_id": null, "bug_id": 47655, "id": 134162, "time": "2010-02-02T22:25:48Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-02-02T22:25:48Z", "is_private": false}]
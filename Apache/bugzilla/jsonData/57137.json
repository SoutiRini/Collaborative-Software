[{"count": 0, "tags": [], "creator": "simak.mi@gmail.com", "attachment_id": null, "is_private": false, "id": 178721, "time": "2014-10-24T14:19:35Z", "bug_id": 57137, "creation_time": "2014-10-24T14:19:35Z", "text": "I'm using JmxRemoteLifecycleListener with SSL on CentOS 6.5, results in the following error on startup:\n\u043e\u043a\u0442 24, 2014 6:00:17 PM org.apache.catalina.startup.Catalina load\nINFO: Initialization processed in 1313 ms\n\u043e\u043a\u0442 24, 2014 6:00:17 PM org.apache.catalina.mbeans.JmxRemoteLifecycleListener createServer\nSEVERE: The JMX connector server could not be created or failed to start for the Platform server\njava.io.IOException: Cannot bind to URL [rmi://localhost:7222/jmxrmi]: javax.naming.CommunicationException [Root exception is java.rmi.ConnectIOException: error during JRMP connection establishment; nested exception is: \n\tjavax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target]\n\tat javax.management.remote.rmi.RMIConnectorServer.newIOException(RMIConnectorServer.java:826)\n\tat javax.management.remote.rmi.RMIConnectorServer.start(RMIConnectorServer.java:431)\n\tat org.apache.catalina.mbeans.JmxRemoteLifecycleListener.createServer(JmxRemoteLifecycleListener.java:313)\n\tat org.apache.catalina.mbeans.JmxRemoteLifecycleListener.lifecycleEvent(JmxRemoteLifecycleListener.java:259)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:117)\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)\n\tat org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:402)\n\tat org.apache.catalina.util.LifecycleBase.setState(LifecycleBase.java:347)\n\tat org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:724)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:689)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:321)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:455)\nCaused by: javax.naming.CommunicationException [Root exception is java.rmi.ConnectIOException: error during JRMP connection establishment; nested exception is: \n\tjavax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target]\n\tat com.sun.jndi.rmi.registry.RegistryContext.bind(RegistryContext.java:143)\n\tat com.sun.jndi.toolkit.url.GenericURLContext.bind(GenericURLContext.java:226)\n\tat javax.naming.InitialContext.bind(InitialContext.java:419)\n\tat javax.management.remote.rmi.RMIConnectorServer.bind(RMIConnectorServer.java:643)\n\tat javax.management.remote.rmi.RMIConnectorServer.start(RMIConnectorServer.java:426)\n\t... 15 more\nCaused by: java.rmi.ConnectIOException: error during JRMP connection establishment; nested exception is: \n\tjavax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\n\tat sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:304)\n\tat sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.java:202)\n\tat sun.rmi.server.UnicastRef.newCall(UnicastRef.java:341)\n\tat sun.rmi.registry.RegistryImpl_Stub.bind(Unknown Source)\n\tat com.sun.jndi.rmi.registry.RegistryContext.bind(RegistryContext.java:137)\n\t... 19 more\nCaused by: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\n\tat sun.security.ssl.Alerts.getSSLException(Alerts.java:192)\n\tat sun.security.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1884)\n\tat sun.security.ssl.Handshaker.fatalSE(Handshaker.java:276)\n\tat sun.security.ssl.Handshaker.fatalSE(Handshaker.java:270)\n\tat sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1341)\n\tat sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:153)\n\tat sun.security.ssl.Handshaker.processLoop(Handshaker.java:868)\n\tat sun.security.ssl.Handshaker.process_record(Handshaker.java:804)\n\tat sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1016)\n\tat sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312)\n\tat sun.security.ssl.SSLSocketImpl.writeRecord(SSLSocketImpl.java:702)\n\tat sun.security.ssl.AppOutputStream.write(AppOutputStream.java:122)\n\tat java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)\n\tat java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)\n\tat java.io.DataOutputStream.flush(DataOutputStream.java:123)\n\tat sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:229)\n\t... 23 more\nCaused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\n\tat sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:385)\n\tat sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:292)\n\tat sun.security.validator.Validator.validate(Validator.java:260)\n\tat sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:326)\n\tat sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:231)\n\tat sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:126)\n\tat sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1323)\n\t... 34 more\nCaused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\n\tat sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:196)\n\tat java.security.cert.CertPathBuilder.build(CertPathBuilder.java:268)\n\tat sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:380)\n\t... 40 more\n\n\u043e\u043a\u0442 24, 2014 6:00:17 PM org.apache.catalina.core.StandardService startInternal\nINFO: Starting service Catalina\n\nThe relevant configuration from server.xml:\n\n<Listener className=\"org.apache.catalina.mbeans.JmxRemoteLifecycleListener\" \n        rmiRegistryPortPlatform=\"7222\" rmiServerPortPlatform=\"7223\" />\n\nand java properties:\n\n-Dcom.sun.management.jmxremote.password.file=$CATALINA_BASE/conf/jmxremote.password \n-Dcom.sun.management.jmxremote.access.file=$CATALINA_BASE/conf/jmxremote.access \\\n-Djavax.net.ssl.keyStore=$CATALINA_BASE/conf/STORE.jks \\\n-Djavax.net.ssl.keyStorePassword=PASSWORD \\\n-Dcom.sun.management.jmxremote.registry.ssl=true \\\n-Dcom.sun.management.jmxremote.ssl=true \\\n-Dcom.sun.management.jmxremote.ssl.need.client.auth=false \\\n-Djava.rmi.server.hostname=HOST\n\nIf com.sun.management.jmxremote.ssl is changed to false everything works as expected except without SSL. On Windows 7 everything works."}, {"attachment_id": null, "tags": [], "creator": "chris@christopherschultz.net", "text": "(In reply to M1xa1L from comment #0)\n> On Windows 7 everything works.\n\nAre you running the same JVM on both platforms? Have you customized your system's cacerts in either case?", "count": 1, "id": 178723, "time": "2014-10-24T15:04:00Z", "bug_id": 57137, "creation_time": "2014-10-24T15:04:00Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 57137, "attachment_id": null, "is_private": false, "id": 178724, "time": "2014-10-24T16:04:27Z", "creator": "simak.mi@gmail.com", "creation_time": "2014-10-24T16:04:27Z", "text": "(In reply to Christopher Schultz from comment #1)\n> (In reply to M1xa1L from comment #0)\n> > On Windows 7 everything works.\n> \n> Are you running the same JVM on both platforms? Have you customized your\n> system's cacerts in either case?\n\nYes, i'm running the same JMV on both platforms:\nJava version \"1.7.0_51\"\nJava(TM) SE Runtime Environment (build 1.7.0_51-b13)\nJava HotSpot(TM) 64-Bit Server VM (build 24.51-b03, mixed mode)\n\nI didn't customize my system's cacerts. \nI'm using self-signed certificate in keystore."}, {"count": 3, "tags": [], "bug_id": 57137, "attachment_id": null, "is_private": false, "id": 178735, "time": "2014-10-24T20:25:18Z", "creator": "markt@apache.org", "creation_time": "2014-10-24T20:25:18Z", "text": "Bugzilla is not a support forum.\n\nThe error you are seeing is indicative of a configuration problem. Please follow up on the Tomcat users' mailing list for further assistance."}]
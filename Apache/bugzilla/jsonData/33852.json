[{"count": 0, "attachment_id": null, "bug_id": 33852, "text": "using apache with mod_ssl (OpenSSL 0.9.7), mod_rewrite, mod_proxy as a\ntransparent proxy to convert HTTP to HTTPS, apache crashes under load when\nSSLProxyVerify is set to \"required\". load is defined as 10 or more simultaneous\nrequests to the same VirtualHost.\n\n--- httpd.conf ---\n\nServerRoot  \"C:/Program Files/Apache Group/Apache2\"\nTimeout 600\nKeepAlive On\nMaxKeepAliveRequests 300\nKeepAliveTimeout 15\nListen 80\nNameVirtualHost *:80\nPidFile logs/httpd.pid\nThreadsPerChild 72\n\nLoadModule access_module modules/mod_access.so\n#LoadModule actions_module modules/mod_actions.so\n#LoadModule alias_module modules/mod_alias.so\nLoadModule asis_module modules/mod_asis.so\nLoadModule auth_module modules/mod_auth.so\n#LoadModule auth_anon_module modules/mod_auth_anon.so\n#LoadModule auth_dbm_module modules/mod_auth_dbm.so\n#LoadModule auth_digest_module modules/mod_auth_digest.so\n#LoadModule autoindex_module modules/mod_autoindex.so\n#LoadModule cern_meta_module modules/mod_cern_meta.so\n#LoadModule cgi_module modules/mod_cgi.so\n#LoadModule dav_module modules/mod_dav.so\n#LoadModule dav_fs_module modules/mod_dav_fs.so\nLoadModule dir_module modules/mod_dir.so\nLoadModule env_module modules/mod_env.so\n#LoadModule expires_module modules/mod_expires.so\n#LoadModule file_cache_module modules/mod_file_cache.so\n#LoadModule headers_module modules/mod_headers.so\n#LoadModule imap_module modules/mod_imap.so\nLoadModule include_module modules/mod_include.so\nLoadModule info_module modules/mod_info.so\n#LoadModule isapi_module modules/mod_isapi.so\nLoadModule log_config_module modules/mod_log_config.so\nLoadModule mime_module modules/mod_mime.so\n#LoadModule mime_magic_module modules/mod_mime_magic.so\nLoadModule proxy_module modules/mod_proxy.so\nLoadModule proxy_connect_module modules/mod_proxy_connect.so\nLoadModule proxy_http_module modules/mod_proxy_http.so\nLoadModule proxy_ftp_module modules/mod_proxy_ftp.so\nLoadModule negotiation_module modules/mod_negotiation.so\nLoadModule rewrite_module modules/mod_rewrite.so\nLoadModule setenvif_module modules/mod_setenvif.so\n#LoadModule speling_module modules/mod_speling.so\nLoadModule status_module modules/mod_status.so\nLoadModule unique_id_module modules/mod_unique_id.so\n#LoadModule userdir_module modules/mod_userdir.so\n#LoadModule usertrack_module modules/mod_usertrack.so\n#LoadModule vhost_alias_module modules/mod_vhost_alias.so\nLoadModule ssl_module modules/mod_ssl.so\n\nServerName ohetestisg1\nServerAdmin root@ohetestisg1\nDirectoryIndex index.html\nDefaultType text/plain\nErrorLog logs/error.log\nLogLevel debug\nLogFormat \"%{Referer}i -> %U\" referer\nLogFormat \"%{User-agent}i\" agent\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %b %D\" common_isg\n#LogFormat \"%h %l %u %t %U %>s %b %D\" common_isg\nLogFormat \"%h %l %u %t \\\"%r\\\" %>s %b %D \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" combined\nCustomLog logs/access.log common_isg\nAddDefaultCharset ISO-8859-1\nLanguagePriority en da nl et fr de el it ja kr no pl pt pt-br ltz ca es sv tw\n# DocumentRoot \"\"\nUseCanonicalName on\nTypesConfig conf/mime.types\nHostnameLookups Off\nServerSignature off\nExtendedStatus on\n<Directory \"/\">\n  AllowOverride None\n  Options FollowSymLinks\n</Directory>\nSSLRandomSeed startup builtin\nSSLSessionCache dbm:logs/ssl_scache\nSSLSessionCacheTimeout 30\nSSLMutex default\n\n<VirtualHost *:80>\nservername ohetestisg1\n\n<Location /server-status>\n    SetHandler server-status\n    Order deny,allow\n    Allow from all\n</Location>\n\n<Location /server-info>\n    SetHandler server-info\n    Order deny,allow\n    Allow from all\n</Location>\n</virtualhost>\n\n<VirtualHost *:80>\n  ServerName vmediassl\n  SSLProxyEngine On\n\n  SSLProxyMachineCertificateFile \"C:\\stunnel\\ohetestisg1.pem\"\n  SSLProxyCACertificateFile \"C:\\stunnel\\css-ca-cert.pem\"\n  SSLProxyVerify require\n  SSLProxyVerifyDepth 1\n\n  CustomLog logs/vmediassl_access.log common_isg\n  ErrorLog logs/vmediassl_error.log\n  RewriteLog logs/vmediassl_rewrite.log\n  RewriteLogLevel 1\n  RewriteEngine on\n RewriteRule ^/(.*) https://10.162.130.233:444/$1 [P]\n</VirtualHost>\n\n<VirtualHost *:80>\n  ServerName vaccessssl\n  ServerAlias vproxy\n  ServerAlias vclientssl\n  SSLProxyEngine On\n\n  SSLProxyMachineCertificateFile \"C:\\stunnel\\ohetestisg1.pem\"\n  SSLProxyCACertificateFile \"C:\\stunnel\\css-ca-cert.pem\"\n  SSLProxyVerify require\n  SSLProxyVerifyDepth 1\n \n  CustomLog logs/vaccessssl_access.log common_isg\n  ErrorLog logs/vaccessssl_error.log\n  RewriteLog logs/vaccessssl_rewrite.log\n  RewriteLogLevel 1\n  RewriteEngine on\n  RewriteRule ^/(.*) https://10.162.130.253/$1 [P]\n</VirtualHost>\n\n<VirtualHost *:80>\n  ServerName voheosdmssl\n  SSLProxyEngine On\n\n  SSLProxyMachineCertificateFile \"C:\\stunnel\\ohetestisg1.pem\"\n  SSLProxyCACertificateFile \"C:\\stunnel\\css-ca-cert.pem\"\n  SSLProxyVerify require\n  SSLProxyVerifyDepth 1\n  \n  CustomLog logs/voheosdmssl_access.log common_isg\n  ErrorLog logs/voheosdmssl_error.log\n  RewriteLog logs/voheosdmssl_rewrite.log\n  RewriteLogLevel 1\n  RewriteEngine on\n  RewriteRule ^/(.*) https://10.162.130.234:447/$1 [P]\n</VirtualHost>", "id": 71841, "time": "2005-03-04T21:59:15Z", "creator": "vasudha.upadhyaya@convergys.com", "creation_time": "2005-03-04T21:59:15Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "text": "Can you get a backtrace out of the crash?", "id": 72986, "time": "2005-03-29T16:36:55Z", "bug_id": 33852, "creation_time": "2005-03-29T16:36:55Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Created attachment 14597\nback trace of the apache crash \n\nThe back trace file was a big one and i couldn't upload the whole file, these\nare around 2000 lines before the apache crash. If the whole file is needed then\nI can save the back trace file into different files and upload them.", "is_private": false, "id": 73115, "creator": "vasudha.upadhyaya@convergys.com", "time": "2005-03-30T22:51:32Z", "bug_id": 33852, "creation_time": "2005-03-30T22:51:32Z", "attachment_id": 14597}, {"count": 3, "tags": [], "text": "Sorry, I was asking for a gdb backtrace from the process, not a tcpdump.  If you\nadd:\n\n  CoreDumpDirectory /tmp\n\nto the httpd.conf, and make sure to run \"ulimit -c unlimited\" before starting\nthe server, you should get core files in /tmp after a crash.  Then run:\n\n  gdb /path/to/httpd /tmp/core.<pid>\n\nfor a particular core file, and enter\n\n  backtrace full \n\nat the (gdb) prompt to get the backtrace.  Attach the output of that command to\nthis bug report.", "attachment_id": null, "id": 73116, "creator": "jorton@redhat.com", "time": "2005-03-30T22:55:33Z", "bug_id": 33852, "creation_time": "2005-03-30T22:55:33Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 33852, "attachment_id": null, "id": 75835, "time": "2005-06-03T00:14:14Z", "creator": "chip@force-elite.com", "creation_time": "2005-06-03T00:14:14Z", "is_private": false, "text": "Waiting for Backtrace info."}, {"count": 5, "tags": [], "creator": "slive@apache.org", "is_private": false, "text": "No response from submitter.", "id": 83447, "time": "2005-12-08T19:55:00Z", "bug_id": 33852, "creation_time": "2005-12-08T19:55:00Z", "attachment_id": null}]
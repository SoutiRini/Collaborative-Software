[{"count": 0, "tags": [], "bug_id": 43274, "attachment_id": null, "id": 107528, "time": "2007-08-31T02:20:00Z", "creator": "ckohrn@tng.de", "creation_time": "2007-08-31T02:20:00Z", "is_private": false, "text": "We have a XSL/FO script that just embeds a SVG file using <fo:external-\ngraphic>. The PDF rendered with FOP-0.20.5rc contains the SVG, correctly like \ndisplayed with the batik viewer gui.\n\nThe PDF rendered with FOP-0.93 or 0.94 contains the SVG, but the colors aren't \ndisplayed correctly: The SVG seems to be invisible.\n\nAfter patching one file, the problem seems to be solved. Even with more complex \nXSL/FO scripts the results of the patched FOP-0.94 look fine.\n\nIt looks like the 0.94 uses inherited color values in some cases, misleadingly.\n\n\n\n--------- input.xsl ------------\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<!DOCTYPE xsl:stylesheet []>\n<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" \nxmlns:fo=\"http://www.w3.org/1999/XSL/Format\" version=\"1.0\">\n  <xsl:template match=\"/\">\n    <fo:root xmlns:fo=\"http://www.w3.org/1999/XSL/Format\">\n      <xsl:call-template name=\"layout-master-set\"/>\n      <fo:page-sequence master-reference=\"one\">\n        <fo:flow flow-name=\"xsl-region-body\">\n          <xsl:call-template name=\"gfx\"/>\n        </fo:flow>\n      </fo:page-sequence>\n    </fo:root>\n  </xsl:template>\n  <xsl:template name=\"layout-master-set\">\n    <fo:layout-master-set>\n      <fo:simple-page-master master-name=\"one\">\n        <fo:region-body margin-bottom=\"20pt\" margin-left=\"12mm\" margin-\nright=\"25pt\" />\n      </fo:simple-page-master>\n    </fo:layout-master-set>\n  </xsl:template>\n  <xsl:template name=\"gfx\">\n    <fo:block>\n      <fo:external-graphic content-width=\"222pt\">\n        <xsl:attribute name=\"src\">/data/home/ckohrn/Desktop/manipulated.svg</\nxsl:attribute>\n      </fo:external-graphic>\n    </fo:block>\n  </xsl:template>\n</xsl:stylesheet>\n\n\n--------- manipulated.svg ------------\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!-- Generator: Adobe Illustrator 10, SVG Export Plug-In . SVG Version: 3.0.0 \nBuild 76)  -->\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.0//EN\"    \"http://www.w3.org/TR/2001/\nREC-SVG-20010904/DTD/svg10.dtd\" [\n\t<!ENTITY ns_flows \"http://ns.adobe.com/Flows/1.0/\">\n\t<!ENTITY ns_svg \"http://www.w3.org/2000/svg\">\n\t<!ENTITY ns_xlink \"http://www.w3.org/1999/xlink\">\n]>\n<svg  xmlns=\"&ns_svg;\" xmlns:xlink=\"&ns_xlink;\" xmlns:a=\"http://ns.adobe.com/\nAdobeSVGViewerExtensions/3.0/\"\n\t width=\"117.524902\" height=\"69.405273\" viewBox=\"0 0 117.524902 \n69.405273\"\n\t overflow=\"visible\" enable-background=\"new 0 0 117.524902 69.405273\" \nxml:space=\"preserve\">\n\t<g id=\"Dimension_Layer\">\n\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" fill=\"#FFFFFF\" \nd=\"M57.727539,16.092773v-0.513672l-3.995117-0.001465\n\t\t\tL53.711914,4.447754l-\n7.166992,0.004395L46.52832,1.648438H19.372559v2.757324l-5.233887-\n0.031738V0.233398l-2.798828,0.005859\n\t\t\tl0.017578,15.389648l-4.234375-\n0.030762v0.463379h0.5625v24.6875l-0.5625,0.00293v0.530273l3.943359-\n0.001953v9.045898h2.029785\n\t\t\th2.342285h38.138672l-0.032227-\n9.061523l4.09375,0.015625v-0.46875h-0.3125V16.108398L57.727539,16.092773z \nM24.435547,40.749023\n\t\t\th-1l-0.03125-24.65625l1.03125-0.015625V40.749023z \nM41.269043,40.787109l-1.010254-0.017578l0.004883-24.661133\n\t\t\tl1.015625-0.015625L41.269043,40.787109z\"/>\n\t\t\t<path fill=\"none\" stroke=\"#000000\" stroke-width=\"0.15\" \nstroke-linejoin=\"round\" stroke-miterlimit=\"1\" d=\"M103.759766,49.632812\n\t\t\t\t\"/>\n\t\t<g>\n\t\t\t<path fill=\"none\" stroke=\"#000000\" stroke-width=\"0.15\" \nstroke-linejoin=\"round\" stroke-miterlimit=\"1\" d=\"M106.358398,50.322266\n\t\t\t\t\"/>\n\t\t</g>\n\t\t<path d=\"M5.669434,2.990723c0,1.56543-1.269043,2.833984-\n2.834961,2.833984C1.269043,5.824707,0,4.556152,0,2.990723\n\t\t\tc0-1.566406,1.269043-2.834961,2.834473-\n2.834961C4.400391,0.155762,5.669434,1.424316,5.669434,2.990723z\"/>\n\t\t<g>\n\t\t\t<path fill=\"#FFFFFF\" d=\"M1.834473,4.408691v-\n0.60791h0.852051V2.344727L1.90625,2.784668L1.598633,2.224609l1.099609-0.639648\n\t\t\t\tH3.45459v2.21582h0.699707v0.60791H1.834473z\"/>\n\t\t</g>\n\t</g>\n</svg>\n\n\n----------- fop-0.94-org.apache.fop.svg.PDFGraphics2D.patch --------------\nIndex: PDFGraphics2D.java\n===================================================================\n--- PDFGraphics2D.java  (Revision 570024)\n+++ PDFGraphics2D.java  (Arbeitskopie)\n@@ -719,13 +719,15 @@\n         }\n\n         c = getColor();\n-        if (graphicsState.setColor(c)) {\n+        graphicsState.setColor(c);\n+        // if (graphicsState.setColor(c)) {\n             applyColor(c, false);\n-        }\n+        // }\n         c = getBackground();\n-        if (graphicsState.setBackColor(c)) {\n+        graphicsState.setBackColor(c);\n+        // if (graphicsState.setBackColor(c)) {\n             applyColor(c, true);\n-        }\n+        // }\n\n         Paint paint = getPaint();\n         if (graphicsState.setPaint(paint)) {\n@@ -1718,13 +1720,15 @@\n         }\n\n         c = getColor();\n-        if (graphicsState.setColor(c)) {\n+        graphicsState.setColor(c);\n+        // if (graphicsState.setColor(c)) {\n             applyColor(c, true);\n-        }\n+        // }\n         c = getBackground();\n-        if (graphicsState.setBackColor(c)) {\n+        graphicsState.setBackColor(c);\n+        // if (graphicsState.setBackColor(c)) {\n             applyColor(c, false);\n-        }\n+        // }\n\n         Paint paint = getPaint();\n         if (graphicsState.setPaint(paint)) {"}, {"count": 1, "tags": [], "creator": "dev@cumiskey.com", "attachment_id": null, "text": "Maybe I am doing something wrong here but I am unable to find any discernible\ndifference when viewing the pdf output with acrobat reader with or without the\npatch.\n\nAdrian.\n", "id": 107559, "time": "2007-08-31T09:34:38Z", "bug_id": 43274, "creation_time": "2007-08-31T09:34:38Z", "is_private": false}, {"count": 2, "tags": [], "creator": "ckohrn@tng.de", "attachment_id": null, "text": "Tested again: The result of the clean 0.94 is an empty PDF page. The resulting \npage of the patched 0.94 contains a small black circle with a white '1' in it.", "id": 107561, "time": "2007-08-31T09:56:58Z", "bug_id": 43274, "creation_time": "2007-08-31T09:56:58Z", "is_private": false}, {"count": 3, "tags": [], "creator": "ckohrn@tng.de", "attachment_id": null, "id": 107574, "time": "2007-08-31T14:19:39Z", "bug_id": 43274, "creation_time": "2007-08-31T14:19:39Z", "is_private": false, "text": "Next test now at home, using another machine than at work. Test procedure:\n\nchk@mainframe fop-0_94 # ./fop -fo ~/Desktop/input.fo -pdf ~/Desktop/out.pdf\n\nThe PDF rendered with the unpatched FOP contains just a blank page and has a \nsize of 5335 bytes. After patching the resulting document contains 5338 bytes, \nand contains a \"'1' in a circle\" in the left upper corner.\n\n\n--------- input.fo ----------\n<fo:root xmlns:fo=\"http://www.w3.org/1999/XSL/Format\">\n  <fo:layout-master-set>\n    <fo:simple-page-master master-name=\"one\">\n      <fo:region-body margin-bottom=\"20pt\" margin-left=\"12mm\"\n margin-right=\"25pt\"/>\n    </fo:simple-page-master>\n  </fo:layout-master-set>\n  <fo:page-sequence master-reference=\"one\">\n    <fo:flow flow-name=\"xsl-region-body\">\n      <fo:block>\n        <fo:external-graphic content-width=\"222pt\"\n src=\"/home/chk/Desktop/manipulated.svg\"/>\n      </fo:block>\n    </fo:flow>\n  </fo:page-sequence>\n</fo:root>\n"}, {"count": 4, "tags": [], "text": "Created attachment 20764\npatch file\n\nI have now verified the problem and cleaned up the patch.\n\nAdrian.", "is_private": false, "bug_id": 43274, "id": 107687, "time": "2007-09-04T03:23:58Z", "creator": "dev@cumiskey.com", "creation_time": "2007-09-04T03:23:58Z", "attachment_id": 20764}, {"count": 5, "tags": [], "creator": "adelmelle@apache.org", "attachment_id": null, "text": "\nPatch applied. See: http://svn.apache.org/viewvc?rev=572763&view=rev\n\nThanks for the input.", "id": 107718, "time": "2007-09-04T11:12:44Z", "bug_id": 43274, "creation_time": "2007-09-04T11:12:44Z", "is_private": false}, {"count": 6, "tags": [], "creator": "gadams@apache.org", "attachment_id": null, "id": 156283, "time": "2012-04-01T07:08:17Z", "bug_id": 43274, "creation_time": "2012-04-01T07:08:17Z", "is_private": false, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed"}]
[{"attachment_id": null, "tags": [], "creator": "mtb19@columbia.edu", "is_private": false, "count": 0, "id": 31493, "time": "2003-02-18T03:07:31Z", "bug_id": 17148, "creation_time": "2003-02-18T03:07:31Z", "text": "I'm only guessing this is in mod_dir...it could be in mod_rewrite or something\nentirely different for all I know.\n\nHere's how to reproduce:\n\n1. run a webserver on port 8080:\n\n    Listen 8080\n\n2. create a cgi-directory with the following properties\n\n    Options +ExecCGI\n    AddHandler cgi-script .cgi\n    DirectoryIndex index.html ... index.cgi\n\n3. create a file called index.cgi in that directory:\n\n- - - - - - - - %< CUT HERE >% - - - - - - - -\n#!/bin/sh                                                                       \necho 'Content-type: text/html'\necho\necho '<pre>'\necho \"\\$SCRIPT_URI = $SCRIPT_URI\"\necho '</pre>'\n\nexit 0\n- - - - - - - - %< CUT HERE >% - - - - - - - -\n\n4. Navigate to that file on your server. For example:\n\n    lynx -source http://somehost.somedomain:8080/cgi-bin/index.cgi\n\nYou should see the following output:\n\n<pre>\n$SCRIPT_URI = http://somehost.somedomain:8080/cgi-bin/index.cgi\n</pre>\n\n5. Now navigate to just the CGI directory and let DirectoryIndex resolve to\nindex.cgi for you. For example:\n\n    lynx -source http://somehost.somedomain:8080/cgi-bin/\n\nYou should now see the following output:\n\n<pre>\n$SCRIPT_URI = http://somehost.somedomain/cgi-bin/\n</pre>\n\n6. Notice how the port is missing in the second output.\n\nAnother way to see this is when running PHP in Apache. The\n$_SERVER['SCRIPT_URI'] entry will be missing the port number for any script\narrived at through DirectoryIndex resolution.\n\nI have not tried experimenting with any of the Rewrite* directives. I have not\ntried this in Apache 1.x."}, {"count": 1, "text": "I should have noted that this happens on any non standard port (not just 8080).", "bug_id": 17148, "is_private": false, "id": 31494, "time": "2003-02-18T03:10:29Z", "creator": "mtb19@columbia.edu", "creation_time": "2003-02-18T03:10:29Z", "tags": [], "attachment_id": null}, {"count": 2, "text": "This may also be related to bug #17148.", "bug_id": 17148, "attachment_id": null, "id": 41991, "time": "2003-08-02T04:45:05Z", "creator": "mtb19@columbia.edu", "creation_time": "2003-08-02T04:45:05Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "mtb19@columbia.edu", "attachment_id": null, "id": 41993, "time": "2003-08-02T04:46:11Z", "bug_id": 17148, "creation_time": "2003-08-02T04:46:11Z", "is_private": false, "text": "Oops...I meant bug #17149. :-/"}, {"count": 4, "text": "This is still a major pain in the butt, but I haven't seen any activity or\ncomment on this one. I'm changing the component to be what I believe is more\naccurate.", "bug_id": 17148, "is_private": false, "id": 60751, "time": "2004-07-17T16:28:05Z", "creator": "mtb19@columbia.edu", "creation_time": "2004-07-17T16:28:05Z", "tags": [], "attachment_id": null}, {"count": 5, "text": "Perhaps this isn't mod_rewrite's fault after all. From mod_rewrite (2.0.50):\n\n    1125     /*\n    1126      *  create the SCRIPT_URI variable for the env\n    1127      */\n    1128 \n    1129     /* add the canonical URI of this URL */\n    1130     thisserver = ap_get_server_name(r);\n    1131     port = ap_get_server_port(r);\n    1132     if (ap_is_default_port(port, r)) {\n    1133         thisport = \"\";\n    1134     }\n    1135     else {\n    1136         apr_snprintf(buf, sizeof(buf), \":%u\", port);\n    1137         thisport = buf;\n    1138     }\n\nThis looks pretty simple. As far as I can tell, ap_get_server_port is defined in\nserver/core.c, and ap_is_default_port is a macro defined in include/httpd.h\nwhich expands to: \"(port == ap_run_default_port(r))\". Unfortunately, I'm not\nvery adept at internal Apache development, and ap_run_default_port is defined\nvia some hook function macro magic that I don't fully understand.\n\nCan anyone verify what the output of \"ap_get_server_port(r)\" and\n\"ap_is_default_port(port, r)\" are in this context (i.e., when browsing to an\nimplied file via DirectoryIndex a la the above)?", "bug_id": 17148, "attachment_id": null, "id": 60755, "time": "2004-07-17T17:03:06Z", "creator": "mtb19@columbia.edu", "creation_time": "2004-07-17T17:03:06Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 17148, "is_private": false, "text": "doesn't really look like a mod_rewrite problem to me", "id": 62698, "time": "2004-08-30T03:55:47Z", "creator": "chip@force-elite.com", "creation_time": "2004-08-30T03:55:47Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 17148, "is_private": false, "text": "Doesn't look like a problem at all. It's perfectly fine because port 80 is the default port\nfor the http scheme.", "id": 104244, "time": "2007-06-08T17:32:24Z", "creator": "davi@apache.org", "creation_time": "2007-06-08T17:32:24Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 17148, "attachment_id": null, "text": "Davi, you closed the bug without actually reading any of the comments or\nunderstanding it. This has nothing to do with port 80. This has to do with using\na non-standard port (see comment #1) and DirectoryIndex.\n\nPlease run through the examples yourself before just blindly closing bugs\nwithout actually taking the time to understand them.", "id": 104252, "time": "2007-06-08T22:04:27Z", "creator": "mtb19@columbia.edu", "creation_time": "2007-06-08T22:04:27Z", "is_private": false}, {"count": 9, "text": "Yes, I may have initially misunderstood. This has to do with internal redirects,\nand since internal redirects \"have no ports\", the default port is 80 for the sub\nrequest. I don't think it's worth propagating this down the sub request, since\nit's another request.", "bug_id": 17148, "attachment_id": null, "id": 104253, "time": "2007-06-08T22:35:07Z", "creator": "davi@apache.org", "creation_time": "2007-06-08T22:35:07Z", "tags": [], "is_private": false}, {"count": 10, "tags": [], "creator": "davi@apache.org", "attachment_id": null, "id": 104255, "time": "2007-06-08T23:32:15Z", "bug_id": 17148, "creation_time": "2007-06-08T23:32:15Z", "is_private": false, "text": "I can't reproduce the problem with 2.0.60-dev. If more information appears later,\nplease re-open the bug.\n\n[davi@montefiori 2.0.x]$ lynx -source http://localhost:8080/cgi-bin/\n<pre>\n$SCRIPT_URI = http://localhost:8080/cgi-bin/\n</pre>"}]
[{"count": 0, "tags": [], "creator": "youngm@gmail.com", "is_private": false, "text": "I've recently upgraded to Tomcat 7 and used to run with metadata-complete=\"true\" in my web.xml.  With Servlet 3 I decided I'd try some of the annotation features.  When I turned off metadata-complete I got a VerifyError trying to load one of my classes.  This class is meant to only work on Tomcat 6 so the fact Tomcat 7 cannot load this class is expected.  What is not expected is that Tomcat 7 doesn't just ignore the error and continue scanning for annotations.  Looking in ContextConfig.checkHandlesTypes() I checks for virtually every type of loading failure except VerifyError.  Perhaps VerifyError should be added to this list?\n\njava.lang.VerifyError: class org.lds.stack.tomcat.decrypt.DecryptingStandardContext overrides final method start.()V\n\tat java.lang.ClassLoader.defineClass1(Native Method)\n\tat java.lang.ClassLoader.defineClassCond(ClassLoader.java:631)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:615)\n\tat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:141)\n\tat java.net.URLClassLoader.defineClass(URLClassLoader.java:283)\n\tat java.net.URLClassLoader.access$000(URLClassLoader.java:58)\n\tat java.net.URLClassLoader$1.run(URLClassLoader.java:197)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:190)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:306)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:247)\n\tat java.lang.Class.forName0(Native Method)\n\tat java.lang.Class.forName(Class.java:247)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1665)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1523)\n\tat org.apache.catalina.startup.ContextConfig.checkHandlesTypes(ContextConfig.java:2006)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsStream(ContextConfig.java:1969)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsJar(ContextConfig.java:1858)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotationsUrl(ContextConfig.java:1826)\n\tat org.apache.catalina.startup.ContextConfig.processAnnotations(ContextConfig.java:1812)\n\tat org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1306)\n\tat org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:896)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:322)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:89)\n\tat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5103)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:812)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:787)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:607)\n\tat org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:633)\n\tat org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:558)\n\tat org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:468)\n\tat org.apache.catalina.startup.HostConfig.start(HostConfig.java:1322)\n\tat org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:311)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:89)\n\tat org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:379)\n\tat org.apache.catalina.util.LifecycleBase.setState(LifecycleBase.java:324)\n\tat org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:1041)\n\tat org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:774)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)\n\tat org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:1033)\n\tat org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:291)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)\n\tat org.apache.catalina.core.StandardService.startInternal(StandardService.java:443)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)\n\tat org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:727)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:621)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:597)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:322)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:450)", "id": 148278, "time": "2011-07-29T19:25:49Z", "bug_id": 51586, "creation_time": "2011-07-29T19:25:49Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 148293, "time": "2011-07-31T17:10:48Z", "bug_id": 51586, "creation_time": "2011-07-31T17:10:48Z", "is_private": false, "text": "Thanks for the report. I expanded the exception handle most eventualities. If an unhandled exception happens now, the Tomcat instance will have much bigger problems than a failed annotation scan (and is probably on its way to crashing).\n\nThe fix is in 7.0.x and will be included in 7.0.20 onwards."}]
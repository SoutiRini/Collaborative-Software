[{"count": 0, "tags": [], "text": "Apache bench (ab) currently doesn't allow a limit on the number of requests per keep-alive tcp connection. The only options are a new connection per request, or c connections over which all n requests are sent (for n/c requests per connection). Unfortunately this does not mirror real-world traffic, as most HTTP clients (browsers) will make ~4 requests per tcp connection.", "attachment_id": null, "id": 143603, "creator": "johneagl@yahoo-inc.com", "time": "2011-01-24T19:53:11Z", "bug_id": 50644, "creation_time": "2011-01-24T19:53:11Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 50644, "attachment_id": 26542, "is_private": false, "id": 143604, "time": "2011-01-24T19:55:01Z", "creator": "johneagl@yahoo-inc.com", "creation_time": "2011-01-24T19:55:01Z", "text": "Created attachment 26542\nPatch to enable limiting the number of requests per keep-alive connection\n\nAttached is a patch to add a flag to apachebench to allow the specification of the number of requests per keep-alive connection to better simulate real-world clients."}, {"count": 2, "tags": [], "text": "Comment on attachment 26542\nPatch to enable limiting the number of requests per keep-alive connection\n\nObsoleting patch -- comments do not match style and an additional bugfix is present (to limit number of spurious requests).", "attachment_id": 26542, "id": 143606, "creator": "johneagl@yahoo-inc.com", "time": "2011-01-24T20:03:55Z", "bug_id": 50644, "creation_time": "2011-01-24T20:03:55Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 50644, "text": "Created attachment 26543\nPatch to enable limiting the number of requests per keep-alive connection\n\nSecond patch to add user-configurable limit on number of requests per connection. Obsoletes prior patch as prior patch had different comment style and contained a bugfix unrelated to this bug.", "id": 143607, "time": "2011-01-24T20:05:05Z", "creator": "johneagl@yahoo-inc.com", "creation_time": "2011-01-24T20:05:05Z", "is_private": false, "attachment_id": 26543}, {"count": 4, "tags": [], "bug_id": 50644, "text": "With a large number of requests, this makes my machine run out of ports because too many connections are in TIME_WAIT:\n\nab -n 100000 -c 40 -k -m 2  http://localhost/\nThis is ApacheBench, Version 2.3 <$Revision: 1125877 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking localhost (be patient)\nCompleted 10000 requests\nCompleted 20000 requests\nCompleted 30000 requests\nCompleted 40000 requests\nCompleted 50000 requests\n\nTest aborted after 10 failures\n\napr_socket_connect(): Cannot assign requested address (99)\nTotal of 56404 requests completed\n\n\nThe problem probably appears because now ab closes the connections first while without that option, httpd closes the connections first.", "id": 147385, "time": "2011-06-22T21:14:51Z", "creator": "sf@sfritsch.de", "creation_time": "2011-06-22T21:14:51Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "Nils.Hildebrand@BAMF.Bund.de", "text": "Hi,\n\nwe have a GIS-application running on Tomcat 5.5. As webserver we are using Apache httpd 2.2 connected to tomcat via ajp (mod_proxy_ajp).\n\nOS is Linux (CentOS 5.5 x86_64).\n\nAs database we use a oracle-db release 10.2. Connection works fine with ojdbc5/6.jar - even the old ojdbc14.jar works.\n\nThe application worked fine with Tomcat 5.5.28, sun jdk 1.5_22 and oracle jdk 6u22 until we tried to upgrade to tomcat 5.5.31.\n\nAfter the upgrade we get - in certain situations a:\njava.io.IOException: org.hibernatespatial.helper.FinderException: Couldn't get at the OracleSpatial Connection object from the PreparedStatement.\n\nAfter looking through the Tomcat 5.5 changelogs we stumbled across a change made in 5.5.30: Upgrade to DBCP 1.3.\n\nWe tried to narrow down the problem by downgrading to Tomcat 5.5.29 - the error was gone. Then Upgrade to 5.5.30: The error is back.\n\nWe took a closer look at the db-connector: oracle.jdbc.driver.OracleDriver was in use, so we changed this to oracle.jdbc.OracleDriver - nevertheless - the error remains.\n\nWhen looking at DBCP we found on http://commons.apache.org/dbcp/: \n\nDBCP 1.4 binaries should be used by applications running under JDK 1.6.\nDBCP 1.3 should be used when running under JDK 1.4 or 1.5.\"\n\nNow Tomcat should run with jdk 1.5 and jdk 1.6 (and worked fine with the dbcp 1.2.x as it seems). This seems to be a bug here.\n\nSince jdk 1.5 has reached EoL I think a proper solution would be to update dbcp to 1.4 in Tomcat 5.5 - or fix dbcp 1.3 so it is compatible with jdk 1.6. Else the statement that 5.5 runs with jdk 1.5 or higher is no longer true.\n\nI could not test our current application with Tomcat 5.5.31 and jdk 1.5 since it is compiled now against jdk 1.6 and won't work with jdk 1.5 any longer. \n\n\nKind regards\n\nNils", "id": 141958, "time": "2010-11-24T07:06:03Z", "bug_id": 50326, "creation_time": "2010-11-24T07:06:03Z", "is_private": false, "attachment_id": null}, {"count": 1, "text": "(In reply to comment #0)\n> DBCP 1.4 binaries should be used by applications running under JDK 1.6.\n> DBCP 1.3 should be used when running under JDK 1.4 or 1.5.\"\n> \n> Now Tomcat should run with jdk 1.5 and jdk 1.6 (and worked fine with the dbcp\n> 1.2.x as it seems). This seems to be a bug here.\n\nThis analysis is incorrect since the JDK limitations of DBCP 1.2 are identical to DBCP 1.3 (it is related to the JDBC version supported by the JRE).\n\n> Since jdk 1.5 has reached EoL I think a proper solution would be to update dbcp\n> to 1.4 in Tomcat 5.5\n\nThat is not possible since DBCP 1.4 requires Java 6 but the minimum Java version for Tomcat 5.5.x is Java 1.4 and that will not be changed.\n\n> - or fix dbcp 1.3 so it is compatible with jdk 1.6.\n\nThat is simply not possible. Hence why there is DBCP 1.3 and DBCP 1.4.\n\n> Else the statement that 5.5 runs with jdk 1.5 or higher is no longer true.\n\nThe statement that 5.5 runs on a 1.4 or higher jre is perfectly true. There is nothing stopping DBCP 1.2 or 1.3 running on Java 6. However, JDBC 4 features will not be available and any attempt to use them will result in an exception.\n\n> I could not test our current application with Tomcat 5.5.31 and jdk 1.5 since\n> it is compiled now against jdk 1.6 and won't work with jdk 1.5 any longer.\n\nThat shouldn't stop you testing it with 5.5.31 running on a 1.6 jre.\n\nI suspect you have hit either a DBCP bug or a hibernate bug around the relationship between physical and pooled connections and what is exposed via prepared statement objects. The Commons users list is probably the best place to get help debugging this. It certainly isn't a Tomcat bug.", "bug_id": 50326, "attachment_id": null, "id": 141959, "time": "2010-11-24T07:24:10Z", "creator": "markt@apache.org", "creation_time": "2010-11-24T07:24:10Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 141960, "time": "2010-11-24T07:46:17Z", "bug_id": 50326, "creation_time": "2010-11-24T07:46:17Z", "is_private": false, "text": "Note, that if you are unsatisfied by DBCP version bundled in Tomcat, you can use any other version of DBCP libraries directly, as well as any other pool\nimplementation.  Hint: use \"factory\" attribute on the <Resource> element. For DBCP the value will be \"org.apache.commons.dbcp.BasicDataSourceFactory\".\n\nAsk on the users mailing list if you have further questions."}, {"count": 3, "text": "(In reply to comment #1)\n> (In reply to comment #0)\n> > DBCP 1.4 binaries should be used by applications running under JDK 1.6.\n> > DBCP 1.3 should be used when running under JDK 1.4 or 1.5.\"\n> > \n> > Now Tomcat should run with jdk 1.5 and jdk 1.6 (and worked fine with the dbcp\n> > 1.2.x as it seems). This seems to be a bug here.\n> [...]\n\n> That is simply not possible. Hence why there is DBCP 1.3 and DBCP 1.4.\n> \n> > Else the statement that 5.5 runs with jdk 1.5 or higher is no longer true.\n> \n> The statement that 5.5 runs on a 1.4 or higher jre is perfectly true. There is\n> nothing stopping DBCP 1.2 or 1.3 running on Java 6. However, JDBC 4 features\n> will not be available and any attempt to use them will result in an exception.\n\nWhy did it work then with DBCP 1.2 and not DBCP 1.3?\nYes - this might be a DBCP 1.3 bug (as you hinted).\n\n> > I could not test our current application with Tomcat 5.5.31 and jdk 1.5 since\n> > it is compiled now against jdk 1.6 and won't work with jdk 1.5 any longer.\n> \n> That shouldn't stop you testing it with 5.5.31 running on a 1.6 jre.\n\nThat's what I did first - and got the error.\n \n> I suspect you have hit either a DBCP bug or a hibernate bug around the\n> relationship between physical and pooled connections and what is exposed via\n> prepared statement objects.\n\nPropably a DBCP 1.3. bug - the prepared-statement was there with dbcp 1.2, too - and there is no bug with 5.5.29.\n\n> The Commons users list is probably the best place\n> to get help debugging this. It certainly isn't a Tomcat bug.\n\nNot directly - but somehow this is related to 5.5. > 29, so Tomcat needs feedback when this is resolved.\n\nI will try to track this down...\n\nWhy not include DBCP 1.3 and DBCP 1.4 with Tomcat 5.5?\n\nThe next comment hinted that one could do that and change the factory-setting...", "bug_id": 50326, "attachment_id": null, "id": 141961, "time": "2010-11-24T08:35:13Z", "creator": "Nils.Hildebrand@BAMF.Bund.de", "creation_time": "2010-11-24T08:35:13Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "Nils.Hildebrand@BAMF.Bund.de", "attachment_id": null, "id": 141962, "time": "2010-11-24T08:37:10Z", "bug_id": 50326, "creation_time": "2010-11-24T08:37:10Z", "is_private": false, "text": "(In reply to comment #2)\n> Note, that if you are unsatisfied by DBCP version bundled in Tomcat, you can\n> use any other version of DBCP libraries directly, as well as any other pool\n> implementation.  Hint: use \"factory\" attribute on the <Resource> element. For\n> DBCP the value will be \"org.apache.commons.dbcp.BasicDataSourceFactory\".\n> \n> Ask on the users mailing list if you have further questions.\n\nGreat - I will try that next - after upgrading to Tomcat 5.5.31 again.\n\n\nKind regards\n\nNils"}, {"count": 5, "tags": [], "creator": "Nils.Hildebrand@BAMF.Bund.de", "text": "Hi,\n\nI traced the problem further down.\nI exchanged DBCP 1.3/Tomcat with DBCB 1.4 Commons - the error remains.\nAfter Downgrade to DBCP 1.2.2 Commons the error is gone.\n\nSee https://issues.apache.org/jira/browse/DBCP-350 for the corresponding bug-report for DBCP.\n\nUntil that is resolved the error is inherited by Tomcat 5.5 as well (from 5.5.30 on).\n\nLooking at the bug-tracker for dbcp 1.3.1 there seem to be more Oracle-DB-related problems - perhaps this is a seldom combination?\n\nSo until then - woraround is:\nAfter Upgrade/Installation of Tomcat > 5.5.30:\nDowngrade to DBCP 1.2.2 if you encounter oracle-db-problems.\n\nI will provide a link in the WiKi for the downgrade procedure after I figured out how to edit the WiKi.\n\nKind regards\n\nNils", "id": 142403, "time": "2010-12-06T10:01:29Z", "bug_id": 50326, "creation_time": "2010-12-06T10:01:29Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "Nils.Hildebrand@BAMF.Bund.de", "attachment_id": null, "id": 142509, "time": "2010-12-09T05:25:47Z", "bug_id": 50326, "creation_time": "2010-12-09T05:25:47Z", "is_private": false, "text": "Hi,\n\nthis seems to be a DB-access-right related problem The big question is now why the problem did not exist prior to dbcp 1.3.\n\nSo with regards to Tomcat the status of this bug-report can be set to \"irrelevant/closed\" or something like that.\n\nI will track this problem further in DBCP (see URL).\n\n\nKind regards\n\nNils"}, {"count": 7, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 142511, "time": "2010-12-09T05:31:03Z", "bug_id": 50326, "creation_time": "2010-12-09T05:31:03Z", "is_private": false, "text": "Thanks for keeping us informed."}, {"count": 8, "tags": [], "creator": "Nils.Hildebrand@BAMF.Bund.de", "attachment_id": null, "id": 148546, "time": "2011-08-11T09:21:19Z", "bug_id": 50326, "creation_time": "2011-08-11T09:21:19Z", "is_private": false, "text": "http://gis.stackexchange.com/questions/13105/any-known-problems-after-tomcat-upgrade-using-oracle-locator\n\nI updated the case with the DBCP-developers as well.\n\nThis looks like a problem in hibernate."}, {"count": 9, "tags": [], "creator": "Nils.Hildebrand@BAMF.Bund.de", "text": "Updated Version to 5.5.33 - the problem still exists there.", "id": 148547, "time": "2011-08-11T09:23:20Z", "bug_id": 50326, "creation_time": "2011-08-11T09:23:20Z", "is_private": false, "attachment_id": null}, {"count": 10, "text": "The analysis shows this is a hibernate issue, not a Tomcat or a DBCP issue.", "bug_id": 50326, "attachment_id": null, "id": 148549, "time": "2011-08-11T09:27:10Z", "creator": "markt@apache.org", "creation_time": "2011-08-11T09:27:10Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 50326, "attachment_id": null, "text": "We have been through this. This is a bug in tomcat because tomcat uses dbcp and dbcp uses hibernate. So you can set this to confirmed and to \"depends on\" the dbcp-bug associated with this. I will keep an eye on the dbcp-side as well and keep you updated with this bug-id. When it gets fixed in dbcp you can fix it in tomcat as well.\n\n\"Resolved\" means there is no bug in tomcat any more. This is not true.\ntomcat.dbcp is affected. This is a standard tomcat component (derived from commons.dbcp).", "id": 148551, "time": "2011-08-11T09:44:42Z", "creator": "Nils.Hildebrand@BAMF.Bund.de", "creation_time": "2011-08-11T09:44:42Z", "is_private": false}, {"count": 12, "tags": [], "creator": "Nils.Hildebrand@BAMF.Bund.de", "attachment_id": null, "id": 148554, "time": "2011-08-11T09:49:03Z", "bug_id": 50326, "creation_time": "2011-08-11T09:49:03Z", "is_private": false, "text": "p.s.\n\nI know you don't want to concentrate on 5.5 any longer - but I think this important for the stability of Tomcat."}, {"count": 13, "tags": [], "creator": "Nils.Hildebrand@BAMF.Bund.de", "text": "Follow the DBCP-link... Hybernate uses DBCP not vice versa. Hybernate is not part of Tomcat.", "id": 148560, "time": "2011-08-11T11:40:42Z", "bug_id": 50326, "creation_time": "2011-08-11T11:40:42Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Created attachment 33278\nAttached the Standalone Java code to display the sheet name for the 2 different template file names.\n\nTeam,\n\nI'm trying to read the excel 2007 file (available in the attachment B4Save.xlsx), but its giving the null pointer exception in the  Decryptor.getDataStream . \n\nBut the same file can open and resave(Not changing anything and save with the same/ different filename AfterSave.xlsx) in the windows system was working file in the attached java code.\n\nTo reproduce this issue swap the comments in the java code line 17 and 18 with the file placed in the appropriate folders.\n\nUsed the latest stable jar file poi-bin-3.13-20150929.zip\nhttp://mirrors.sonic.net/apache/poi/release/bin/poi-bin-3.13-20150929.zip\n\nPlease do the needful from your end and let me know if you requires any more details related to this issue.\n\nThe issue was given below:\njava.lang.NullPointerException\n\tat org.apache.poi.poifs.crypt.CryptoFunctions.getCipher(CryptoFunctions.java:202)\n\tat org.apache.poi.poifs.crypt.CryptoFunctions.getCipher(CryptoFunctions.java:182)\n\tat org.apache.poi.poifs.crypt.standard.StandardDecryptor.getCipher(StandardDecryptor.java:122)\n\tat org.apache.poi.poifs.crypt.standard.StandardDecryptor.getDataStream(StandardDecryptor.java:135)\n\tat org.apache.poi.poifs.crypt.Decryptor.getDataStream(Decryptor.java:92)\n\tat StandAloneExcel.main(StandAloneExcel.java:36)", "attachment_id": 33278, "id": 186405, "creator": "prakash.chakravarthi@schawk.com", "time": "2015-11-16T21:10:44Z", "bug_id": 58616, "creation_time": "2015-11-16T21:10:44Z", "is_private": false}, {"count": 1, "tags": [], "creator": "dominik.stadler@gmx.at", "text": "I could make it work by adding the following BEFORE the call to dfs.getDataStream():\n\n        dec.verifyPassword(null);\n\nCan you verify if this makes it work for you as well?", "id": 186911, "attachment_id": null, "bug_id": 58616, "creation_time": "2015-12-12T13:18:43Z", "time": "2015-12-12T13:18:43Z", "is_private": false}, {"count": 2, "tags": [], "creator": "prakash.chakravarthi@schawk.com", "attachment_id": null, "text": "Hi Dominik,\n\nThanks for your help. \n\nBy adding the dec.verifyPassword(null); before the dfs.getDataStream(); resolves that particular line issue. But its giving the \"error in opening zip file\"  wb = new XSSFWorkbook(fileLocation);.\n\nCan you please help to resolve this issue. The expected output for this jave code to read that Excel sheet and print the SheetName.\n\nPlease find below the details error message after adding the line dec.verifyPassword(null); as suggested by you in the previous comments.\n\n\n==================================================================================\nFileLocation:C:\\ExcelProb\\B4Save.xlsx\norg.apache.poi.openxml4j.exceptions.InvalidOperationException: Can't open the specified file: 'C:\\ExcelProb\\B4Save.xlsx'\n\tat org.apache.poi.openxml4j.opc.ZipPackage.<init>(ZipPackage.java:112)\n\tat org.apache.poi.openxml4j.opc.OPCPackage.open(OPCPackage.java:225)\n\tat org.apache.poi.openxml4j.opc.OPCPackage.open(OPCPackage.java:187)\n\tat org.apache.poi.POIXMLDocument.openPackage(POIXMLDocument.java:84)\n\tat org.apache.poi.xssf.usermodel.XSSFWorkbook.<init>(XSSFWorkbook.java:318)\n\tat StandAloneExcel.main(StandAloneExcel.java:40)\nCaused by: java.util.zip.ZipException: error in opening zip file\n\tat java.util.zip.ZipFile.open(Native Method)\n\tat java.util.zip.ZipFile.<init>(Unknown Source)\n\tat java.util.zip.ZipFile.<init>(Unknown Source)\n\tat java.util.zip.ZipFile.<init>(Unknown Source)\n\tat org.apache.poi.openxml4j.util.ZipSecureFile.<init>(ZipSecureFile.java:105)\n\tat org.apache.poi.openxml4j.opc.internal.ZipHelper.openZipFile(ZipHelper.java:175)\n\tat org.apache.poi.openxml4j.opc.ZipPackage.<init>(ZipPackage.java:110)\n\t... 5 more\n\n\n====================================================================================\nJava code\n====================================================================================\nimport java.io.FileInputStream;\nimport java.io.FileNotFoundException;\n\nimport org.apache.poi.poifs.crypt.Decryptor;\nimport org.apache.poi.poifs.crypt.EncryptionInfo;\nimport org.apache.poi.poifs.filesystem.OfficeXmlFileException;\nimport org.apache.poi.poifs.filesystem.POIFSFileSystem;\nimport org.apache.poi.xssf.usermodel.XSSFSheet;\nimport org.apache.poi.xssf.usermodel.XSSFWorkbook;\n\n\npublic class StandAloneExcel {\n\n\t/**\n\t * @param args\n\t */\n//\t public static String excelfilename = \"C:\\\\ExcelProb\\\\AfterSave.xlsx\";\n\t public static String excelfilename = \"C:\\\\ExcelProb\\\\B4Save.xlsx\";\n\t\n\t\n\tpublic static void main(String[] args) {\n\t\t\n\t\tXSSFWorkbook wb;\n\t    XSSFSheet sheet;\n\t\tPOIFSFileSystem pfs;\n\t\tString fileLocation;\n\t\n\t\tfileLocation=excelfilename;\n\t\tSystem.out.println(\"FileLocation:\"+fileLocation);\n\n\t\ttry{\n\t\t\t\n                pfs = new POIFSFileSystem(new FileInputStream(fileLocation));                \n                EncryptionInfo info = new EncryptionInfo(pfs);\t\t\t   \n\t\t\t    Decryptor dec = Decryptor.getInstance(info);\t\n\t\t\t    \n\t\t\t    dec.verifyPassword(null);\n\t\t\t    dec.getDataStream(pfs);\n\t\t\t    \n                wb = new XSSFWorkbook(fileLocation);                \n\t            sheet = wb.getSheetAt(0);\t           \n\t            System.out.println(\"Sheet  Name\"+ sheet.getSheetName());\n\n\t\t}catch(OfficeXmlFileException e){\n\t\t\ttry{\n\t\t\t\te.printStackTrace();\n\t\t\twb = new XSSFWorkbook(new FileInputStream(fileLocation));\t\t   \n\t\t\tsheet = wb.getSheetAt(0);\t\t\t\n\t\t\t System.out.println(\"Sheet  Name\"+ sheet.getSheetName());\n\n\t\t\t}catch(FileNotFoundException ex)\n\t\t    {\n\t\t\t\tex.printStackTrace();\n\t\t\t\tSystem.out.println(\" Exception:\" + ex);\n\t\t\t\t\n\t\t\t\n\t\t    }\n\t\t\tcatch(Exception ex){\n\t\t\t\tex.printStackTrace();\n            }\n\t\t}catch(Exception e){\n\t\t\te.printStackTrace();\n\t\t\n\t\t}\n\n\t}\n\n}\n\n====================================================================================", "id": 186936, "time": "2015-12-14T16:07:11Z", "bug_id": 58616, "creation_time": "2015-12-14T16:07:11Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 58616, "attachment_id": null, "id": 186961, "time": "2015-12-15T13:13:31Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2015-12-15T13:13:31Z", "is_private": false, "text": "This exception indicates that the file that you try to process is not an actual xlsx-file. The XLSX-Formatted files are actually zip-files with XML-files inside. Can you check if this is the case? Maybe you actually have an .xls (older Excel file format) file that has an incorrect file extension?"}, {"count": 4, "tags": [], "bug_id": 58616, "attachment_id": null, "id": 186987, "time": "2015-12-16T20:17:21Z", "creator": "prakash.chakravarthi@schawk.com", "creation_time": "2015-12-16T20:17:21Z", "is_private": false, "text": "Hi Dominik,\n\nThanks for the analysis. I also tries to open it in the ZIP files extractor it doesn't extract. Its giving the file damaged/ corrupted. \nFor the noraml working version of the apache POI extract the xlsx file by the zip extractor and read the content.\n\nNow the unknown areas was the same file opened by the Windows office and is their any way Apache POI can support to open this file problematically.\n\nThanks,\nPrakash"}, {"count": 5, "tags": [], "creator": "dominik.stadler@gmx.at", "text": "Sorry but I do not really understand your last comment, can you describe again what works and what not? Maybe by providing a sample XLSX file and the java code that you use to test it?", "id": 187135, "attachment_id": null, "bug_id": 58616, "creation_time": "2015-12-27T08:55:27Z", "time": "2015-12-27T08:55:27Z", "is_private": false}, {"count": 6, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "text": "FYI, the NullPointerException which was initially reported here should be fixed via r1722406", "id": 187270, "time": "2015-12-30T20:32:26Z", "bug_id": 58616, "creation_time": "2015-12-30T20:32:26Z", "is_private": false}, {"count": 7, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "text": "Sorry, the correct SVN revision is r1722407", "id": 187271, "time": "2015-12-30T20:33:39Z", "bug_id": 58616, "creation_time": "2015-12-30T20:33:39Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 58616, "attachment_id": null, "id": 192613, "time": "2016-07-24T19:36:54Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2016-07-24T19:36:54Z", "is_private": false, "text": "I think the original issues reported here have been fixed since some time and there was no response on the last questions for a long time. Please report new issues if there is still anything that looks like a bug."}]
[{"count": 0, "tags": [], "bug_id": 60882, "attachment_id": null, "id": 197745, "time": "2017-03-17T13:21:36Z", "creator": "per.landberg@polago.se", "creation_time": "2017-03-17T13:21:36Z", "is_private": false, "text": "When Tomcat 8.5.12 process an incoming request that has a path that maps to a servlet with a wildcard-mapping. The following exception is thrown:\n\njava.lang.NullPointerException\n        at org.apache.catalina.core.ApplicationMapping.getServletMapping(ApplicationMapping.java:62)\n        at org.apache.catalina.core.ApplicationContext.getRequestDispatcher(ApplicationContext.java:486)\n        at org.apache.catalina.core.ApplicationContextFacade.getRequestDispatcher(ApplicationContextFacade.java:222)\n\nI'm able to reproduce the behavior using the default ROOT web-app that is part of the tomcat distribution with two small changes:\n\nAdd a servlet-mapping in web.xml:\n\n <servlet-mapping>\n        <servlet-name>default</servlet-name>\n        <url-pattern>/static/*</url-pattern>\n</servlet-mapping>\n\nReplace the index.jsp page with the following lines:\n\n<%@ page language=\"java\"%>\n<%\n   javax.servlet.RequestDispatcher d = request.getServletContext().getRequestDispatcher(\"/static\");\n   out.println(d);\n%>\n\nAccessing http://localhost:8080/ with a browser presents an error page and the following log message in the localhost log:\n\norg.apache.catalina.core.StandardWrapperValve.invoke Servlet.service() for servlet [jsp] in context with path [] threw exception [An exception occurred processing JSP page /index.jsp at line 3\n\n1: <%@ page language=\"java\"%>\n2: <%\n3:    javax.servlet.RequestDispatcher d = request.getServletContext().getRequestDispatcher(\"/static\");\n4:    out.println(d);\n5: %>\n\n\nStacktrace:] with root cause\n java.lang.NullPointerException\n        at org.apache.catalina.core.ApplicationMapping.getServletMapping(ApplicationMapping.java:62)\n        at org.apache.catalina.core.ApplicationContext.getRequestDispatcher(ApplicationContext.java:486)\n        at org.apache.catalina.core.ApplicationContextFacade.getRequestDispatcher(ApplicationContextFacade.java:222)\n        at org.apache.jsp.index_jsp._jspService(index_jsp.java:112)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:742)\n        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:443)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:385)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:329)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:742)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n        at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:192)\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:165)\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:198)\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:140)\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:80)\n        at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:624)\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:87)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:341)\n        at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:783)\n        at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n        at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:798)\n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1441)\n        at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n        at java.lang.Thread.run(Thread.java:745)\n\nIf I substitute \"/static\" with \"/other\" or \"/static/\" everything works correctly.\nWhen using Tomcat 8.5.11, the \"/static\" path works as expected so the behavior is introduced in Tomcat 8.5.12.\n\nI tried to debug the request using a debugger and found that the code fails in the following snippet in ApplicationMapping:\n\n                    case PATH:\n                        mapping = new MappingImpl(mappingData.pathInfo.toString().substring(1),\n                                mappingData.wrapperPath.toString() + \"/*\",\n                                mappingData.matchType, servletName);\n                        break;\n\nand the reason for the NPE is that mappingData.pathInfo is null.\n\nSince I'm not familiar with tomcat internals I don't know if the code should check for null or if the switch case is wrong. There is a another case (EXACT:) that maybe should have matched instead. \n\nI hope the description is enough to reproduce the NPE."}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "*** Bug 60878 has been marked as a duplicate of this bug. ***", "id": 197747, "time": "2017-03-17T13:28:07Z", "bug_id": 60882, "creation_time": "2017-03-17T13:28:07Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 60882, "attachment_id": null, "id": 197752, "time": "2017-03-17T15:18:40Z", "creator": "markt@apache.org", "creation_time": "2017-03-17T15:18:40Z", "is_private": false, "text": "Fixed in:\n- trunk for 9.0.0.M19 onwards\n- 8.5.x for 8.5.13 onwards\n\n8.0.x and earlier is not affected."}]
[{"count": 0, "tags": [], "bug_id": 59735, "attachment_id": null, "is_private": false, "id": 191841, "time": "2016-06-20T13:06:34Z", "creator": "joakim.edenholm@gmail.com", "creation_time": "2016-06-20T13:06:34Z", "text": "The removal of deprecated methods in org.apache.catalina.session.StandardSession breaks memcached-session-manager. At the very least, the method exclude(String) is needed. Others may be needed as well, I have not investigated what happens when exclude is restored.\n\nI have captured this stack trace:\n20-Jun-2016 10:37:59.616 INFO [ContainerBackgroundProcessor[StandardEngine[Catalina].StandardHost[localhost].StandardContext[]]] de.javakaffee.web.msm.MemcachedSessionService.updateExpirationInMemcached Could not update expiration in memcached for session CFC46B06D3867A23FECF4A4042E43771-n2\n java.lang.NoSuchMethodError: org.apache.catalina.session.StandardSession.exclude(Ljava/lang/String;)Z\n\tat de.javakaffee.web.msm.MemcachedBackupSession.exclude(MemcachedBackupSession.java:597)\n\tat de.javakaffee.web.msm.JavaSerializationTranscoder.writeAttributes(JavaSerializationTranscoder.java:121)\n\tat de.javakaffee.web.msm.JavaSerializationTranscoder.serializeAttributes(JavaSerializationTranscoder.java:100)\n\tat de.javakaffee.web.msm.TranscoderService.serializeAttributes(TranscoderService.java:151)\n\tat de.javakaffee.web.msm.BackupSessionService.updateExpiration(BackupSessionService.java:132)\n\tat de.javakaffee.web.msm.MemcachedSessionService.updateExpirationInMemcached(MemcachedSessionService.java:1606)\n\tat de.javakaffee.web.msm.MemcachedBackupSessionManager.backgroundProcess(MemcachedBackupSessionManager.java:575)\n\tat org.apache.catalina.core.StandardContext.backgroundProcess(StandardContext.java:5543)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1374)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1346)\n\tat java.lang.Thread.run(Thread.java:745)\n\nI am filing this bug report because the following commit message mentions the possibility of postponing removal of methods until Tomcat 9. If this problem is insufficient reason to restore necessary methods, I will open a bug with memcached-session-manager instead of this.\n\nhttps://github.com/apache/tomcat80/commit/a5fe49b5f5003d9da41b2ce4cd4a1065f2214a49\n\n\nSteps to reproduce:\n1) Install and start memcached.\n2) Install Tomcat 8.5.3\n3) Place memcached-session-manager-1.9.3.jar and memcached-session-manager-tc8-1.9.3.jar in $CATALINA_HOME/lib\n4) Configure memcached-session-manager in your context.xml (substitute localhost:11211 with your memcached host and port):\n    <Manager className=\"de.javakaffee.web.msm.MemcachedBackupSessionManager\"\n        memcachedNodes=\"n1:localhost:11211\"\n        requestUriIgnorePattern=\".*\\.(ico|png|gif|jpg|css|js)$\"\n        />\n5) Visit a page which creates a new session and then wait a few seconds for the background thread to trigger."}, {"count": 1, "tags": [], "bug_id": 59735, "text": "The intention is to look at any problems on a case by case bases.\n\nIn this case, the change is security related (CVE-2016-0714) and the new method is available in the latest release of all supported Tomcat versions so I'm leaning towards not adding this back in 8.5.x. However, if this creates problems for memcached, please feel free to re-open this issue and we can take another look.\n\nNote that the method was also removed in 9.0.x and will not be restored there.", "id": 191842, "time": "2016-06-20T13:18:50Z", "creator": "markt@apache.org", "creation_time": "2016-06-20T13:18:50Z", "is_private": false, "attachment_id": null}]
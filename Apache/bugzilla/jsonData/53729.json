[{"count": 0, "tags": [], "creator": "tmp120210@gmail.com", "attachment_id": null, "id": 161463, "time": "2012-08-16T13:27:47Z", "bug_id": 53729, "creation_time": "2012-08-16T13:27:47Z", "is_private": false, "text": "In my xlsx file I have a value at M17, many formulas uses it for counting.\nThis value is referenced as $M$17 with two dollar signs (to avoid auto modification if generated cells).\nWhen I am trying to shift rows up, calling sheet.shiftRows(18, 100, -3);\nAll formulas references in shifting rows were updated correctly, but $M$17 was  replaced with #REF! sign. I think it is a defect, cause it should be still $M$17.\n\nSeems like POI doesn't know about $ sign and updates reference to M17 to M14, which leads to error."}, {"count": 1, "tags": [], "bug_id": 53729, "text": "I can confirm this bug, also for HSSF in POI 3.8.\n\nJava source code I use for the test:\n\n\tprivate static void poiBugTest1() throws IOException {\n\t\tfinal String filename = \"d:\\\\temp\\\\POI_Bug_Test.xls\";\n\t\tWorkbook wb = new HSSFWorkbook(new FileInputStream(filename), true);\n\t\tSystem.out.println(\"WB geladen\");\n\n\t\tSheet sh = wb.getSheet(\"Tab1\");\n\t\tsh.shiftRows(0, sh.getPhysicalNumberOfRows(), 1);\n\n\t\tOutputStream outStream = new FileOutputStream(filename);\n\t\twb.write(outStream);\n\t\toutStream.close();\n\t\tSystem.out.println(\"WB geschrieben\");\n\t}\n\nThe used XLS file is added as attachment.\nAfter execution of the above code the reference in 'Second'!A1 has changed from \"=Tab1!A$3\" to \"=Tab1!A$4\".\n\nI changed the bug importance to \"critical\" because shiftRows() destroys working XLS sheets and this can be a silent destruction nobody recognises.", "id": 161836, "attachment_id": null, "creator": "twapache@online.de", "creation_time": "2012-08-30T12:30:04Z", "time": "2012-08-30T12:30:04Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 53729, "attachment_id": 29304, "is_private": false, "id": 161837, "time": "2012-08-30T12:31:55Z", "creator": "twapache@online.de", "creation_time": "2012-08-30T12:31:55Z", "text": "Created attachment 29304\nTestcase input file"}, {"count": 3, "tags": [], "bug_id": 53729, "is_private": false, "id": 161845, "attachment_id": 29307, "creator": "twapache@online.de", "creation_time": "2012-08-30T13:40:12Z", "time": "2012-08-30T13:40:12Z", "text": "Created attachment 29307\nProposed bug fix\n\nI think the bug can be fixed by changing org.apache.poi.ss.formula.FormulaShifter to check for absolute references. The attached patch does exactly this (it bases on the poi trunk but the source file did not change since poi 3.8).\nI only did a quick check with my own test case, it works. I did NOT test the modifications to AreaRef. A POI expert for this stuff should have a closer look.\n\nAlso TODO is a recalculation of the formula because the base data has changed (is shifted!). Current solution is to call workbook.setForceFormulaRecalculation(true); manually when you use shiftRows() and are not sure about absolute references."}, {"count": 4, "tags": [], "creator": "twapache@online.de", "attachment_id": 29308, "id": 161846, "time": "2012-08-30T13:45:24Z", "bug_id": 53729, "creation_time": "2012-08-30T13:45:24Z", "is_private": false, "text": "Created attachment 29308\nCompiled class of the patch\n\nThis is the compiled class of my proposed bug fix. You can use this and replace the class (poi.jar\\org\\apache\\poi\\ss\\formula\\FormulaShifter.class) in your used poi.jar (you should create a copy of poi.jar with a speaking prefix and use this new jar) to have a quick fix available."}, {"count": 5, "tags": [], "creator": "dominik.stadler@gmx.at", "is_private": false, "text": "Hmm, when I do the shifting in LibreOffice, the reference is also changed from \"=Tab1!A$3\" to \"=Tab1!A$4\", so it seems POI behaves the same way as this one, are you sure the $-sign works this way also for shifting complete rows? As far as I know $-sign mostly is used when you copy formulas or drag formulas across multiple cells, not when you actually insert new rows.", "id": 171943, "time": "2013-12-26T18:32:10Z", "bug_id": 53729, "creation_time": "2013-12-26T18:32:10Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 188418, "time": "2016-02-14T20:23:18Z", "bug_id": 53729, "creation_time": "2016-02-14T20:23:18Z", "is_private": false, "text": "No update for a long time, therefore I am closing this, please reopen with more information if this is still a problem for you."}]
[{"count": 0, "attachment_id": null, "creator": "matt@thebishops.org", "text": "If one runs perforce tasks against a disconnected server, the exceptions that\nare thrown in the thread that tries to communicate with this unavailable server\nthrow exceptions that are not handled by Ant.\n\nThis is especially painful in an integrated IDE ant feature, as the exception\ncannot be handled gracefully as a BuildException.  The fix is simply to move the\ncreation of the input reader in P4HandlerAdaptor into the try block just below it.\n\nPatch is forthcoming.", "id": 33478, "time": "2003-03-19T18:23:55Z", "bug_id": 18154, "creation_time": "2003-03-19T18:23:55Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 5420\nPatch to fix this bug.", "is_private": false, "bug_id": 18154, "id": 33479, "time": "2003-03-19T18:27:45Z", "creator": "matt@thebishops.org", "creation_time": "2003-03-19T18:27:45Z", "attachment_id": 5420}, {"count": 2, "tags": [], "creator": "levylambert@tiscali-dsl.de", "attachment_id": null, "text": "Matt, can you explain exactly in which case your patch is useful ?\nI have just tried to reproduce your problem with or without patch. \nIn any case, there are no build exceptions for the case where the box where the \nPerforce server is living is down. Here is the verbose output for <p4label/>\n\nBuild sequence for target `p4label' is [p4label]\nComplete build sequence is [p4label, ]\n\np4label:\n  [p4label] P4Label exec:\n  [p4label] View not set, assuming //depot/...\n  [p4label] Executing 'p4' with arguments:\n  [p4label] 'label'\n  [p4label] '-i'\n  [p4label] \n  [p4label] The ' characters around the executable and arguments are\n  [p4label] not part of the command.\n  [p4label] Perforce client error:\n  [p4label] \tConnect to server failed; check $P4PORT.\n  [p4label] \tTCP connect to 192.0.2.4:1666 failed.\n  [p4label] \tconnect: 192.0.2.4:1666: WSAETIMEDOUT\n  [p4label] Executing 'p4' with arguments:\n  [p4label] 'labelsync'\n  [p4label] '-l'\n  [p4label] 'NightlyBuild:20030319:2153'\n  [p4label] \n  [p4label] The ' characters around the executable and arguments are\n  [p4label] not part of the command.\n  [p4label] Perforce client error:\n  [p4label] \tConnect to server failed; check $P4PORT.\n  [p4label] \tTCP connect to 192.0.2.4:1666 failed.\n  [p4label] \tconnect: 192.0.2.4:1666: WSAETIMEDOUT\n", "id": 33490, "time": "2003-03-19T20:52:19Z", "bug_id": 18154, "creation_time": "2003-03-19T20:52:19Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 18154, "text": "Created attachment 7564\nFix to remove unnecessary Exception throwing, plus handle multiline errors.", "id": 41730, "time": "2003-07-29T18:53:00Z", "creator": "matt@thebishops.org", "creation_time": "2003-07-29T18:53:00Z", "is_private": false, "attachment_id": 7564}, {"count": 4, "tags": [], "bug_id": 18154, "text": "Fixed the title to match the bug better.", "id": 41731, "time": "2003-07-29T18:54:10Z", "creator": "matt@thebishops.org", "creation_time": "2003-07-29T18:54:10Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 18154, "text": "1) what about renaming the bug report :\n\nSuppress exception throwing from SimpleP4OutputHandler\n\nthis would be more appropriate with regards to the contents of the patch\n\n2) why do you want to suppress throwing BuildException's from \nSimpleP4OutputHandler ?\n\nCan you explain in which case these exceptions are a problem ?\n\nIf we commit your change, there might be a lot of tasks which will not fail and \nwhere a real problem has occured.\n\nAntoine", "id": 41752, "time": "2003-07-30T07:43:20Z", "creator": "antoine@apache.org", "creation_time": "2003-07-30T07:43:20Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "antoine@apache.org", "is_private": false, "count": 6, "id": 41753, "time": "2003-07-30T08:03:57Z", "bug_id": 18154, "creation_time": "2003-07-30T08:03:57Z", "text": "My proposition : change SimpleP4OutputHandler so that it is only going to throw \nbuild exceptions if the attribute failonerror of P4Base is set to true (the \ndefault). If failonerror is set to false, then the error message would be logged \nwith Project.MSG_ERR as you suggested in your patch.\n\nOn top of that, one could add a new Perforce property called p4.failonerror \nwhich, if set, would contain the default value for failonerror.\n\nSo :\n<property name=\"p4.failonerror\" value=\"false\"/> at the top of a build file\nwould disable exception throwing from SimpleP4OutputHandler.\n\nAlternatively or parallel, you would be able to add the \"failonerror\" attribute \nfor problem tasks.\n\nIs this OK ?"}, {"count": 7, "attachment_id": null, "creator": "matt@thebishops.org", "is_private": false, "id": 41787, "time": "2003-07-30T15:22:13Z", "bug_id": 18154, "creation_time": "2003-07-30T15:22:13Z", "tags": [], "text": "You have a good point, I forgot there's no build listener that kills a build by default when a task \nlogs an error.\n\nThe problem with SimpleP4OutputHandler throwing an exception is that many P4 errors are \nmultiline, so if we throw on the detection of the first line of an error, the rest of the message from \nP4 is lost.  It might be better for the handler to set an error state on P4Base (along with a \nmessage), so that when the execCommand finishes, it can throw the entire message in a \nBuildException from P4Base.\n\nI can give this a try if the idea has merit."}, {"count": 8, "tags": [], "text": "Yes, the idea has merit.\nYou can move the throwing of exceptions to :\n\nP4Base#execP4Command(String command, P4Handler handler)\n\nTry also to retain my suggestion to throw exceptions only if failonerror=true.\n\nCheers,\n\nAntoine", "is_private": false, "id": 41788, "creation_time": "2003-07-30T15:33:42Z", "time": "2003-07-30T15:33:42Z", "creator": "antoine@apache.org", "bug_id": 18154, "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 18154, "text": "Created attachment 7598\nPart 1 of 2", "id": 41806, "time": "2003-07-30T22:57:25Z", "creator": "matt@thebishops.org", "creation_time": "2003-07-30T22:57:25Z", "is_private": false, "attachment_id": 7598}, {"count": 10, "tags": [], "bug_id": 18154, "is_private": false, "text": "Created attachment 7599\nPart 2 of 2", "id": 41807, "time": "2003-07-30T22:57:43Z", "creator": "matt@thebishops.org", "creation_time": "2003-07-30T22:57:43Z", "attachment_id": 7599}, {"count": 11, "tags": [], "creator": "matt@thebishops.org", "attachment_id": null, "text": "The two patches submitted 7/30 should be applied together.  The patch I \nsubmitted on 7/29 should not be used.", "id": 41808, "time": "2003-07-30T22:58:25Z", "bug_id": 18154, "creation_time": "2003-07-30T22:58:25Z", "is_private": false}, {"count": 12, "attachment_id": null, "creator": "antoine@apache.org", "is_private": false, "id": 41829, "time": "2003-07-31T09:15:34Z", "bug_id": 18154, "creation_time": "2003-07-31T09:15:34Z", "tags": [], "text": "Changed name of the bug report."}, {"attachment_id": null, "tags": [], "creator": "antoine@apache.org", "is_private": false, "count": 13, "id": 41830, "time": "2003-07-31T09:28:20Z", "bug_id": 18154, "creation_time": "2003-07-31T09:28:20Z", "text": "Patches committed, thanks.\nThe next thing that should be done would be to change the Perforce tasks which \ndo not use the SimpleP4OutputHandler to make their handler inherit from \nSimpleP4OutputHandler, making sure that the exceptions/logging behavior is \nhomogeneous.\nI am thinking for instance of P4Submit."}, {"count": 14, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "Antoine, you say \"patches committed\" at the end.  Can we close this report?", "id": 44674, "time": "2003-09-25T13:33:42Z", "bug_id": 18154, "creation_time": "2003-09-25T13:33:42Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 18154, "text": "I would like to change something in <p4submit/>, so I do not want to close this\nreport yet.", "id": 44681, "time": "2003-09-25T14:17:59Z", "creator": "antoine@apache.org", "creation_time": "2003-09-25T14:17:59Z", "is_private": false, "attachment_id": null}, {"count": 16, "attachment_id": null, "creator": "bodewig@apache.org", "text": "OK, changed summary.\n\nIs this still a Major Severity thing?", "id": 44685, "time": "2003-09-25T14:31:48Z", "bug_id": 18154, "creation_time": "2003-09-25T14:31:48Z", "tags": [], "is_private": false}, {"count": 17, "attachment_id": null, "creator": "antoine@apache.org", "text": "I have changed p4submit in the ANT_16_BRANCH and in HEAD so that it uses also\nSimpleP4OutputHandler (by making its output handler a derived class of\nSimpleP4OutputHandler and calling super.process(line) in the process routine.\n\nThe same can be done for p4change/p4counter/p4fstat/p4label\n", "id": 44720, "time": "2003-09-25T21:00:55Z", "bug_id": 18154, "creation_time": "2003-09-25T21:00:55Z", "tags": [], "is_private": false}, {"count": 18, "tags": [], "bug_id": 18154, "is_private": false, "text": "I think that all these commands should have\n\nutil.match(\"/error/i\", line)\n\ninstead of\n\nutil.match(\"/error/\", line)\n\nThis is particularly true for p4change, as the Perforce server will return e.g.:\n\nError in change specification.\nError detected at line 13.\nSyntax error in ''.\n\nand this error text is not detected or reported by the p4change task.  The only indication that something went wrong is \"p4.change was not set\" in -verbose mode.", "id": 149135, "time": "2011-09-09T19:33:34Z", "creator": "apache@timbojones.net", "creation_time": "2011-09-09T19:33:34Z", "attachment_id": null}, {"count": 19, "attachment_id": null, "creator": "apache@timbojones.net", "is_private": false, "id": 149136, "time": "2011-09-09T19:45:37Z", "bug_id": 18154, "creation_time": "2011-09-09T19:45:37Z", "tags": [], "text": "I retract my last suggestion.  The final line in that multi-line error message should trigger the match, but it does not.  P4change fails silently if there is an error in the changelist description."}, {"count": 20, "tags": [], "bug_id": 18154, "text": "Perforce Ant tasks have been removed in Ant 1.9.0.\nUsers of Perforce Ant Tasks are advised to use the tasks supplied by Perforce Inc.", "id": 165922, "time": "2013-03-18T01:44:23Z", "creator": "antoine@apache.org", "creation_time": "2013-03-18T01:44:23Z", "is_private": false, "attachment_id": null}]
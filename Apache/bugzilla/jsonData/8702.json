[{"attachment_id": null, "tags": [], "creator": "jtulley@novell.com", "is_private": false, "count": 0, "id": 15252, "time": "2002-05-01T16:18:50Z", "bug_id": 8702, "creation_time": "2002-05-01T16:18:50Z", "text": "One of my submissions for Ant on NetWare was missed or I missed submitting it.  \nrunant.pl needs some NetWare-specific code.  It is a major thing for NetWare, \nsince it will be the way in which to run Ant on NetWare.  The patch does two \nthings:  1) sets the path separator to \";\" on NetWare (the same as on dos, \ncygwin, and MSWin32)    2) Deals with some command-line length limitations on \nNetWare by leaving the classpath unexpanded.  If the classpath is passed in as \nsimply a variable, Java will expand it, and the final total length can be \ngreater than 512 characters.  With a perl-based expansion of the classpath, \nthis limit is quite often surpassed, making the command fail.\n\nHere is the diff -u patch:\n\nIndex: runant.pl\n===================================================================\nRCS file: /home/cvspublic/jakarta-ant/src/script/runant.pl,v\nretrieving revision 1.4\ndiff -u -r1.4 runant.pl\n--- runant.pl\t10 Jan 2002 14:18:42 -0000\t1.4\n+++ runant.pl\t30 Apr 2002 23:40:01 -0000\n@@ -55,11 +55,18 @@\n my $JAVACMD = $ENV{JAVACMD};\n $JAVACMD = \"java\" if $JAVACMD eq \"\";\n \n+my $onnetware = 0;\n+if ($^O eq \"NetWare\")\n+{\n+  $onnetware = 1;\n+}\n+\n #ISSUE: what java wants to split up classpath varies from platform to platform \n #and perl is not too hot at hinting which box it is on.\n-#here I assume \":\" 'cept on win32 and dos. Add extra tests here as needed.\n+#here I assume \":\" 'cept on win32, dos, and netware. Add extra tests here as \nneeded.\n my $s=\":\";\n-if(($^O eq \"MSWin32\") || ($^O eq \"dos\") || ($^O eq \"cygwin\"))\n+if(($^O eq \"MSWin32\") || ($^O eq \"dos\") || ($^O eq \"cygwin\") ||\n+   ($onnetware == 1))\n         {\n         $s=\";\";\n         }\n@@ -71,6 +78,13 @@\n         print \"warning: no initial classpath\\n\" if ($debug);\n         $localpath=\"\";\n         }\n+if ($onnetware == 1)\n+{\n+# avoid building a command line bigger than 512 characters - make localpath\n+# only include the \"extra\" stuff, and add in the system classpath as an \nexpanded\n+# variable. \n+  $localpath=\"\";\n+} \n \n #add jar files. I am sure there is a perl one liner to do this.\n my $jarpattern=\"$HOME/lib/*.jar\";\n@@ -117,7 +131,18 @@\n \n #construct arguments to java\n my @ARGS;\n-push @ARGS, \"-classpath\", \"$localpath\", \"-Dant.home=$HOME\";\n+if ($onnetware == 1)\n+{\n+# make classpath literally $CLASSPATH; and then the contents of $localpath\n+# this is to avoid pushing us over the 512 character limit\n+# even skip the ; - that is already in $localpath\n+  push @ARGS, \"-classpath\", \"\\$CLASSPATH$localpath\";\n+}\n+else\n+{\n+  push @ARGS, \"-classpath\", \"$localpath\";\n+}\n+push @ARGS, \"-Dant.home=$HOME\";\n push @ARGS, @ANT_OPTS;\n push @ARGS, \"org.apache.tools.ant.Main\", @ANT_ARGS;\n push @ARGS, @ARGV;"}, {"attachment_id": 1752, "tags": [], "bug_id": 8702, "text": "Created attachment 1752\npatch file to fix this problem", "count": 1, "id": 15253, "time": "2002-05-01T16:20:56Z", "creator": "jtulley@novell.com", "creation_time": "2002-05-01T16:20:56Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 8702, "text": "Thanks Jeff, patch will be in 1.5beta2", "id": 15339, "time": "2002-05-02T15:42:23Z", "creator": "bodewig@apache.org", "creation_time": "2002-05-02T15:42:23Z", "is_private": false, "attachment_id": null}]
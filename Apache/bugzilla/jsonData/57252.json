[{"count": 0, "tags": [], "bug_id": 57252, "attachment_id": 32224, "id": 179254, "time": "2014-11-24T15:00:26Z", "creator": "awilkinson@pivotal.io", "creation_time": "2014-11-24T15:00:26Z", "is_private": false, "text": "Created attachment 32224\nSmall app to reproduce the problem\n\nIf an error is sent as part of some asynchronous processing, for example:\n\n@WebServlet(value = \"/async\", asyncSupported=true)\npublic class AsyncServlet extends HttpServlet {\n       \n\tprotected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {\n\t\tfinal AsyncContext context = request.startAsync();\n\t\tcontext.start(new Runnable() {\n\t\t\t@Override\n\t\t\tpublic void run() {\n\t\t\t\ttry {\n\t\t\t\t\tresponse.sendError(500);\n\t\t\t\t} catch (IOException e) {\n\t\t\t\t}\n\t\t\t\tcontext.complete();\n\t\t\t}\n\t\t});\n\t}\n}\n\nTomcat 7.0.57 renders its default error page rather than the configured custom error page. The same behaviour is also exhibited in recent 8.0.x releases. It's perhaps worth noting that Tomcat 7.0.55 renders an entirely blank page in this scenario.\n\nMy expectation is that the custom error page is used and, FWIW, this is what Jetty does.\n\nI have attached a war that can be used to reproduce the problem. /sync can be used to confirm that the custom error page is working. /async will reproduce the problem described above."}, {"id": 179447, "tags": [], "bug_id": 57252, "attachment_id": null, "count": 1, "text": "FYI. I am currently working on this but my test cases have identified a further concurrency issue with the error handling that I am going to have to fix first.", "time": "2014-12-02T15:07:42Z", "creator": "markt@apache.org", "creation_time": "2014-12-02T15:07:42Z", "is_private": false}, {"id": 179508, "tags": [], "bug_id": 57252, "attachment_id": null, "count": 2, "text": "Proposed fix:\nhttps://github.com/markt-asf/tomcat/commit/5e195b2f06dba1be3f90b0a9d1f67604af905e47\n\nI'll commit this once the svn server returns to read/write", "time": "2014-12-04T13:35:05Z", "creator": "markt@apache.org", "creation_time": "2014-12-04T13:35:05Z", "is_private": false}, {"id": 179528, "tags": [], "bug_id": 57252, "attachment_id": null, "count": 3, "text": "Test case created and fix applied to trunk, 8.0.x (for 8.0.16) and 7.0.x for (7.0.58).", "time": "2014-12-05T11:46:16Z", "creator": "markt@apache.org", "creation_time": "2014-12-05T11:46:16Z", "is_private": false}]
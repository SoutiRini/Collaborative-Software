[{"count": 0, "tags": [], "creator": "fhanik@apache.org", "attachment_id": null, "text": "The following JSP\n\n<%\n  session.invalidate();\n  session = request.getSession();\n  session.invalidate();\n  session = request.getSession();\n%>\nDone!\n\n\nGenerates this response from Apache Tomcat\nHTTP/1.x 200 OK\n\nServer: Apache-Coyote/1.1\n\nSet-Cookie: JSESSIONID=8C65C3AB20B8BBD157866668B67983B1; Path=\"\"; HttpOnly\n\nSet-Cookie: JSESSIONID=498BD2E8B22C5121143B7305A0ECB249; Path=\"\"; HttpOnly\n\nSet-Cookie: JSESSIONID=49F58AE7833522293F8EAD2AB2D13F19; Path=\"\"; HttpOnly\n\nContent-Type: text/html;charset=ISO-8859-1\n\nContent-Length: 7\n\nDate: Tue, 20 Apr 2010 15:38:47 GMT", "id": 136266, "time": "2010-04-20T11:40:39Z", "bug_id": 49158, "creation_time": "2010-04-20T11:40:39Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 49158, "attachment_id": null, "id": 136267, "time": "2010-04-20T12:37:28Z", "creator": "fhanik@apache.org", "creation_time": "2010-04-20T12:37:28Z", "is_private": false, "text": "Test case added\nhttp://svn.apache.org/viewvc/tomcat/trunk/test/org/apache/tomcat/util/http/TestBug49158.java?view=log"}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "48913 has a proposed patch. I'll look at committing it today.\n\n*** This bug has been marked as a duplicate of bug 48913 ***", "id": 136268, "time": "2010-04-20T13:12:34Z", "bug_id": 49158, "creation_time": "2010-04-20T13:12:34Z", "is_private": false}, {"count": 3, "tags": [], "creator": "fhanik@apache.org", "attachment_id": null, "text": "Fixed in trunk in SVN r935998", "id": 136270, "time": "2010-04-20T13:14:26Z", "bug_id": 49158, "creation_time": "2010-04-20T13:14:26Z", "is_private": false}, {"count": 4, "tags": [], "creator": "fhanik@apache.org", "attachment_id": null, "id": 136272, "time": "2010-04-20T13:16:20Z", "bug_id": 49158, "creation_time": "2010-04-20T13:16:20Z", "is_private": false, "text": "(In reply to comment #2)\n> 48913 has a proposed patch. I'll look at committing it today.\n> \n> *** This bug has been marked as a duplicate of bug 48913 ***\n\nDidn't see this until I had committed my patch. The patch in 48913 doesn't seem to capture the changeSessionId use case. But both patches do the same thing"}, {"count": 5, "tags": [], "bug_id": 49158, "attachment_id": null, "id": 136274, "time": "2010-04-20T13:17:04Z", "creator": "fhanik@apache.org", "creation_time": "2010-04-20T13:17:04Z", "is_private": false, "text": "*** Bug 48913 has been marked as a duplicate of this bug. ***"}, {"count": 6, "tags": [], "bug_id": 49158, "attachment_id": null, "id": 136867, "time": "2010-05-14T15:00:36Z", "creator": "markt@apache.org", "creation_time": "2010-05-14T15:00:36Z", "is_private": false, "text": "This has been fixed in 6.0.x and will be included in 6.0.27 onwards."}, {"count": 7, "tags": [], "text": "Filip,\n\nYour change doesn't actually do exactly what you think it does.\n\nYour code - below - Response.java, line 992:\n\n        for (int i = 0; i < n; i++) {\n            if (headers.getName(i).toString().equals(headername)) {\n                if (headers.getValue(i).toString().startsWith(startsWith)) {\n-->                 headers.setValue(sb.toString());                      \n                    set = true;\n                }\n            }\n        }\n\nYes, setValue(contents) appears to be a logical call... however, that call is actually setValue(name), and the returned contents are meant to be the reference to the header (to which you can then add the value).\n\nThe result of that call is to add a header named, say: \n\n  JSESSIONID=54EDEDA814975EB485C2D9D660346717; Domain=.domain.com; Path=/\n\nThis doesn't actually appear to result in any additional response header (presumably because the format was invalid, or the value was never set), and it doesn't change the value of the existing Set-Cookie header.  The following code appears to work fine instead:\n\n\n        for (int i = 0; i < n; i++) {\n            if (headers.getName(i).toString().equals(headername)) {\n                if (headers.getValue(i).toString().startsWith(startsWith)) {\n-->                 headers.getValue(i).setString(sb.toString());\n                    set = true;\n                }\n            }\n        }\n\nNote that you could probably optimise this (and avoid the set=true / later addHeader() call by calling instead:\n\n  headers.setValue(name).setString(sb.toString())\n\nThis is proving to be critical to us (we manually invalidate sessions first time around when we haven't seen them before - to guard against sessions being presented from search engines), and we currently end up in an invalidation loop as the second JSESSIONID is never actually presented back to the browser.", "is_private": false, "id": 138567, "creator": "dconnard69@gmail.com", "time": "2010-07-20T10:14:30Z", "bug_id": 49158, "creation_time": "2010-07-20T10:14:30Z", "attachment_id": null}, {"count": 8, "tags": [], "creator": "rainer.jung@kippdata.de", "attachment_id": null, "id": 138571, "time": "2010-07-20T10:48:17Z", "bug_id": 49158, "creation_time": "2010-07-20T10:48:17Z", "is_private": false, "text": "Thanks for the feedback.\n\nThis has been noticed independently a few days ago (see https://issues.apache.org/bugzilla/show_bug.cgi?id=49598) and has been fixed in in r964733.\n\nWe just now started voting for releasing 6.0.29 which will contain the fix."}]
[{"count": 0, "tags": [], "bug_id": 40008, "text": "Encountering Ptg 0x1a currently makes POI throw an exception, failing to load\nthe entire document.", "id": 91088, "time": "2006-07-11T01:51:11Z", "creator": "trejkaz@trypticon.org", "creation_time": "2006-07-11T01:51:11Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "jheight@apache.org", "attachment_id": null, "text": "Interesting, this ptd is listed in the developers guide as being deleted and no\nlonger used. Was the file that caused this error generated using excel?", "id": 91599, "time": "2006-07-26T11:21:07Z", "bug_id": 40008, "creation_time": "2006-07-26T11:21:07Z", "is_private": false}, {"count": 2, "tags": [], "creator": "trejkaz@trypticon.org", "attachment_id": null, "text": "Supposedly it was.  I don't have my hands on the file itself, the error came \nfrom a customer site.  Could it be that it came from an earlier version of \nExcel?", "id": 91609, "time": "2006-07-26T13:15:05Z", "bug_id": 40008, "creation_time": "2006-07-26T13:15:05Z", "is_private": false}, {"count": 3, "tags": [], "text": "Is the problem still reproducible with poi-3.1-beta1? \n\nYegor", "attachment_id": null, "id": 116740, "creation_time": "2008-05-17T06:24:52Z", "time": "2008-05-17T06:24:52Z", "creator": "yegor@dinom.ru", "bug_id": 40008, "is_private": false}, {"count": 4, "tags": [], "bug_id": 40008, "text": "I am willing to assume that the problem in its original form no longer occurs, because:\n\n\t\t\tcase AttrPtg.sid:                \n\t\t\tcase 0x1a:        return new AttrPtg(in); // 0x19\n\nThough I'm not sure why this would work, I don't have source data to prove otherwise, so I'm assuming this was fixed whenever that line of code was added.\n\nI can't set the version it was fixed in so I'm setting it to NEW so someone with permission can.", "id": 131536, "time": "2009-11-01T14:57:47Z", "creator": "trejkaz@trypticon.org", "creation_time": "2009-11-01T14:57:47Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 40008, "text": "From the documentation, Ptg 0x1A seems to be only used until BIFF4, where it was known as \"tSheet\".  It seems most likely that the original source of this error was a problem elsewhere in the Ptg deserialization logic that caused an mis-aligned read.\n\nI made sure that no example files on hand disagree with this conclusion.  The code you mentioned (which apparent handles Ptg 0x1A) has been removed in svn r832975 (it was originally added in svn r615859 as part of the fix for bug 42618).\n\n\nNote - problems like this are harder to reproduce after svn r709235.  In that change, formulas no longer get eagerly converted to Ptg arrays.  Now this only happens when the calling Cell.getCellFormula() and during formula evaluation.  So if the original problem were still present, it may not surface until you access the formula in the offending cell.  For enhanced testing, the following modification can be made to Formula.java (forcing every formula to be deserialized to Ptg arrays):  \n\n\n--- src/java/org/apache/poi/ss/formula/Formula.java     (revision 832596)\n+++ src/java/org/apache/poi/ss/formula/Formula.java     (working copy)\n@@ -77,7 +77,9 @@\n        public static Formula read(int encodedTokenLen, LittleEndianInput in, int totalEncodedLen) {\n\n                byte[] byteEncoding = new byte[totalEncodedLen];\n                in.readFully(byteEncoding);\n-               return new Formula(byteEncoding, encodedTokenLen);\n+               Formula result = new Formula(byteEncoding, encodedTokenLen);\n+               result.getTokens();\n+               return result;\n        }\n\n\nI ran all the junits with this additional change in place, to make sure that Ptg 0x1a is not referenced in any existing sample file.  (Incidentally there still seems to be examples of Ptg 0x00)", "id": 131718, "time": "2009-11-04T19:00:24Z", "creator": "josh@apache.org", "creation_time": "2009-11-04T19:00:24Z", "is_private": false, "attachment_id": null}]
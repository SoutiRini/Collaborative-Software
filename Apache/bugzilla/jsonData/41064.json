[{"count": 0, "tags": [], "creator": "julien.kirch@bnpparibas.com", "text": "Hi, I have a parsing error when trying to read an excel file\n\nEnvironment : jdk 1.4.2 under Windows XP SP1, error identical under poi\n2.0, 2.5.1 and 3.0-alpha2-20060616, parsing an a file created with excel\n2002 (containing some french characters) :\n\nHSSFWorkbook hssfWorkbook = new HSSFWorkbook(new POIFSFileSystem(new\nBufferedInputStream(new FileInputStream(\"MyFile.xls\"))));\n\nCode worked a few days ago but failed since some changes in the excel file\n\nError is at\njava.lang.StringIndexOutOfBoundsException: String index out of range: 14172\nat java.lang.String.checkBounds(String.java:287)\nat java.lang.String.<init>(String.java:319)\nat org.apache.poi.util.StringUtil.getFromCompressedUnicode(StringUtil.java:163)\n\noriginal cause is in StringUtil : \"return new String(string, offset, len, \"ISO-\n8859-1\");\" where string.length - offset > len\n\nAs in all other cases len = string.length - offest  I tried to force the len \nvalue but it gives me a \norg.apache.poi.hssf.record.RecordFormatException: Unhandled Continue Record\n\tat \norg.apache.poi.hssf.record.RecordFactory.createRecords(RecordFactory.java:185)\nso I'm stucked for now\t\n\t\nInitial stacktrace : \n\t\njava.lang.reflect.InvocationTargetException\n\tat sun.reflect.GeneratedConstructorAccessor9.newInstance(Unknown Source)\n\tat \nsun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:274)\n\tat \norg.apache.poi.hssf.record.RecordFactory.createRecord(RecordFactory.java:213)\n\tat \norg.apache.poi.hssf.record.RecordFactory.createRecords(RecordFactory.java:149)\n\tat \norg.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:183)\n\tat \norg.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:152)\n\tat \ncom.bnpparibas.grp.framework.testing.testpack.TestPackReader.<init>(TestPackReader.java:114)\n\tat \ncom.bnpparibas.grp.framework.testing.testpack.TestPackReaderTest.testTestPack(TestPackReaderTest.java:13)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat \nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat \nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat junit.framework.TestCase.runTest(TestCase.java:154)\n\tat junit.framework.TestCase.runBare(TestCase.java:127)\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\n\tat junit.framework.TestResult.run(TestResult.java:109)\n\tat junit.framework.TestCase.run(TestCase.java:118)\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\n\tat junit.textui.TestRunner.doRun(TestRunner.java:116)\n\tat \ncom.intellij.rt.execution.junit.IdeaTestRunner.doRun(IdeaTestRunner.java:69)\n\tat junit.textui.TestRunner.doRun(TestRunner.java:109)\n\tat \ncom.intellij.rt.execution.junit.IdeaTestRunner.startRunnerWithArgs(IdeaTestRunner.java:24)\n\tat \ncom.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:118)\n\tat com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:40)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat \nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat \nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat com.intellij.rt.execution.application.AppMain.main(AppMain.java:90)\nCaused by: java.lang.StringIndexOutOfBoundsException: String index out of \nrange: 14172\n\tat java.lang.String.checkBounds(String.java:287)\n\tat java.lang.String.<init>(String.java:319)\n\tat \norg.apache.poi.util.StringUtil.getFromCompressedUnicode(StringUtil.java:163)\n\tat \norg.apache.poi.hssf.record.StringRecord.fillFields(StringRecord.java:89)\n\tat org.apache.poi.hssf.record.Record.<init>(Record.java:55)\n\tat org.apache.poi.hssf.record.StringRecord.<init>(StringRecord.java:51)\n\t... 32 more\n\norg.apache.poi.hssf.record.RecordFormatException: Unable to construct record \ninstance, the following exception occured: null\n\tat \norg.apache.poi.hssf.record.RecordFactory.createRecord(RecordFactory.java:226)\n\tat \norg.apache.poi.hssf.record.RecordFactory.createRecords(RecordFactory.java:149)\n\tat \norg.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:183)\n\tat \norg.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:152)\n\tat \ncom.bnpparibas.grp.framework.testing.testpack.TestPackReader.<init>(TestPackReader.java:114)\n\tat \ncom.bnpparibas.grp.framework.testing.testpack.TestPackReaderTest.testTestPack(TestPackReaderTest.java:13)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat \nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat \nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:40)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat \nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat \nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat com.intellij.rt.execution.application.AppMain.main(AppMain.java:90)\n\n\nProcess finished with exit code -1", "id": 96331, "time": "2006-11-29T01:42:23Z", "bug_id": 41064, "creation_time": "2006-11-29T01:42:23Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "julien.kirch@bnpparibas.com", "attachment_id": null, "id": 96332, "time": "2006-11-29T01:44:18Z", "bug_id": 41064, "creation_time": "2006-11-29T01:44:18Z", "is_private": false, "text": "Error in description :\n\noriginal cause is in StringUtil : \"return new String(string, offset, len, \"ISO-\n8859-1\");\" where string.length - offset < len"}, {"count": 2, "attachment_id": 19279, "bug_id": 41064, "text": "Created attachment 19279\nFile to reproduce the problem\n\nI tried to remove as much unused data as possible from the file but failed to\nreduce it to a minimal one.", "id": 97010, "time": "2006-12-18T02:25:47Z", "creator": "julien.kirch@bnpparibas.com", "creation_time": "2006-12-18T02:25:47Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": 19297, "bug_id": 41064, "text": "Created attachment 19297\nPatch proposal\n\nI tried to fix the problem by limiting the read String then by adding the\nfollowing ContinueRecord\n\nIt don't break any current testcase and fix my problem", "id": 97145, "time": "2006-12-21T02:42:14Z", "creator": "julien.kirch@bnpparibas.com", "creation_time": "2006-12-21T02:42:14Z", "tags": [], "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 41064, "text": "Thanks for this, patch applied", "id": 111422, "time": "2007-12-04T08:56:01Z", "creator": "apache@gagravarr.org", "creation_time": "2007-12-04T08:56:01Z", "tags": [], "is_private": false}]
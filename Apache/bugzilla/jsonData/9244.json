[{"count": 0, "tags": [], "bug_id": 9244, "is_private": false, "text": "2.0.36 fails to compile on a RedHat 7.0 box I was upgrading for a friend.\nInitially the compiler was egc-2.91.6 with binutils-2.5. After I got the error, \nI checked on the version of the compiler and binutils, and upgraded those to \ngcc-3.1 and binutils 2.12. It appears that something is not getting linked \nproperly. I have 2.0.36 compiled perfectly on my Slackware 8 box that has the \nsame release of gcc and binutils, so I think that can be ruled out. This will \nbe a mainstream production system, so I am reluctant to use the CVS HEAD branch \nfor this system.\n\n/bin/sh /root/new/httpd-2.0.36/srclib/apr/libtool --silent --mode=link gcc  -g -\nO2 -pthread -DNO_DBM_REWRITEMAP    -DLINUX=2 -D_REENTRANT -D_XOPEN_SOURCE=500 -\nD_BSD_SOURCE -D_SVID_SOURCE -DAP_HAVE_DESIGNATED_INITIALIZER   -I. -\nI/root/new/httpd-2.0.36/os/unix -I/root/new/httpd-2.0.36/server/mpm/prefork -\nI/root/new/httpd-2.0.36/modules/http -I/root/new/httpd-2.0.36/modules/proxy -\nI/root/new/httpd-2.0.36/include -I/root/new/httpd-2.0.36/srclib/apr/include -\nI/root/new/httpd-2.0.36/srclib/apr-util/include -I/root/new/httpd-\n2.0.36/modules/dav/main -I/root/new/httpd-2.0.36/srclib/apr-util/xml/expat/lib -\nexport-dynamic    -o httpd  modules.lo   modules/mappers/mod_so.la \nserver/mpm/prefork/libprefork.la server/libmain.la \nos/unix/libos.la /root/new/httpd-2.0.36/srclib/pcre/libpcre.la /root/new/httpd-\n2.0.36/srclib/apr-util/libaprutil.la /root/new/httpd-\n2.0.36/srclib/apr/libapr.la -lm -lcrypt -lnsl -lresolv -ldl -lz -lgdbm -\nldb /root/new/httpd-2.0.36/srclib/apr-util/xml/expat/lib/libexpat.la\nserver/.libs/libmain.al(config.lo): In function `ap_method_is_limited':\n/root/new/httpd-2.0.36/server/config.c:389: undefined reference to \n`ap_method_number_of'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x1f8): undefined reference to \n`ap_send_error_response'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x200): undefined reference to \n`ap_set_keepalive'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x20c): undefined reference to \n`ap_make_etag'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x210): undefined reference to \n`ap_set_etag'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x218): undefined reference to \n`ap_meets_conditions'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x224): undefined reference to \n`ap_method_register'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x228): undefined reference to \n`ap_method_registry_init'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x22c): undefined reference to \n`ap_make_method_list'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x230): undefined reference to \n`ap_copy_method_list'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x234): undefined reference to \n`ap_method_list_do'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x238): undefined reference to \n`ap_method_list_vdo'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x23c): undefined reference to \n`ap_method_in_list'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x240): undefined reference to \n`ap_method_list_add'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x244): undefined reference to \n`ap_method_list_remove'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x248): undefined reference to \n`ap_clear_method_list'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x24c): undefined reference to \n`ap_set_content_type'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x26c): undefined reference to \n`ap_index_of_response'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x270): undefined reference to \n`ap_get_status_line'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x274): undefined reference to \n`ap_setup_client_block'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x278): undefined reference to \n`ap_should_client_block'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x27c): undefined reference to \n`ap_get_client_block'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x280): undefined reference to \n`ap_discard_request_body'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x2a0): undefined reference to \n`ap_method_number_of'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x2a4): undefined reference to \n`ap_method_name_of'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x2e0): undefined reference to \n`ap_byterange_filter'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x2e4): undefined reference to \n`ap_http_header_filter'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x310): undefined reference to \n`ap_internal_redirect'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x314): undefined reference to \n`ap_internal_redirect_handler'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x318): undefined reference to \n`ap_internal_fast_redirect'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x328): undefined reference to \n`ap_allow_methods'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x32c): undefined reference to \n`ap_allow_standard_methods'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0x330): undefined reference to \n`ap_die'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0xd08): undefined reference to \n`ap_basic_http_header'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0xd0c): undefined reference to \n`ap_send_http_trace'\nserver/.libs/libmain.al(exports.lo)(.data.rel+0xd10): undefined reference to \n`ap_send_http_options'\nserver/.libs/libmain.al(protocol.lo): In function `read_request_line':\n/root/new/httpd-2.0.36/server/protocol.c:671: undefined reference to \n`ap_method_number_of'\nserver/.libs/libmain.al(protocol.lo): In function `ap_read_request':\n/root/new/httpd-2.0.36/server/protocol.c:819: undefined reference to \n`ap_make_method_list'\n/root/new/httpd-2.0.36/server/protocol.c:913: undefined reference to \n`ap_send_error_response'\n/root/new/httpd-2.0.36/server/protocol.c:941: undefined reference to \n`ap_http_input_filter_handle'\n/root/new/httpd-2.0.36/server/protocol.c:945: undefined reference to `ap_die'\n/root/new/httpd-2.0.36/server/protocol.c:934: undefined reference to \n`ap_send_error_response'\n/root/new/httpd-2.0.36/server/protocol.c:935: undefined reference to \n`ap_discard_request_body'\nserver/.libs/libmain.al(core.lo): In function `ap_custom_response':\n/root/new/httpd-2.0.36/server/core.c:1106: undefined reference to \n`ap_index_of_response'\nserver/.libs/libmain.al(core.lo): In function `set_error_document':\n/root/new/httpd-2.0.36/server/core.c:1129: undefined reference to \n`ap_index_of_response'\n/root/new/httpd-2.0.36/server/core.c:1134: undefined reference to \n`ap_index_of_response'\nserver/.libs/libmain.al(core.lo): In function `ap_limit_section':\n/root/new/httpd-2.0.36/server/core.c:1477: undefined reference to \n`ap_method_number_of'\n/root/new/httpd-2.0.36/server/core.c:1486: undefined reference to \n`ap_method_register'\nserver/.libs/libmain.al(core.lo): In function `core_override_type':\n/root/new/httpd-2.0.36/server/core.c:3098: undefined reference to \n`ap_set_content_type'\nserver/.libs/libmain.al(core.lo): In function `default_handler':\n/root/new/httpd-2.0.36/server/core.c:3159: undefined reference to \n`ap_allow_standard_methods'\n/root/new/httpd-2.0.36/server/core.c:3166: undefined reference to \n`ap_discard_request_body'\n/root/new/httpd-2.0.36/server/core.c:3178: undefined reference to \n`ap_send_http_options'\n/root/new/httpd-2.0.36/server/core.c:3208: undefined reference to `ap_set_etag'\n/root/new/httpd-2.0.36/server/core.c:3211: undefined reference to \n`ap_meets_conditions'\nserver/.libs/libmain.al(request.lo): In function `make_sub_request':\n/root/new/httpd-2.0.36/server/request.c:1525: undefined reference to \n`ap_make_method_list'\n/root/new/httpd-2.0.36/server/request.c:1528: undefined reference to \n`ap_copy_method_list'\nserver/.libs/libmain.al(request.lo): In function `ap_sub_req_method_uri':\n/root/new/httpd-2.0.36/server/request.c:1622: undefined reference to \n`ap_method_number_of'\nserver/.libs/libmain.al(util_script.lo): In function \n`ap_scan_script_header_err_core':\n/root/new/httpd-2.0.36/server/util_script.c:574: undefined reference to \n`ap_set_content_type'\n/root/new/httpd-2.0.36/server/util_script.c:496: undefined reference to \n`ap_meets_conditions'\nserver/.libs/libmain.al(util_xml.lo): In function `ap_xml_parse_input':\n/root/new/httpd-2.0.36/server/util_xml.c:75: undefined reference to \n`ap_setup_client_block'\n/root/new/httpd-2.0.36/server/util_xml.c:85: undefined reference to \n`ap_should_client_block'\n/root/new/httpd-2.0.36/server/util_xml.c:106: undefined reference to \n`ap_get_client_block'\ncollect2: ld returned 1 exit status", "id": 16396, "time": "2002-05-20T08:26:56Z", "creator": "robbat2@orbis-terrarum.net", "creation_time": "2002-05-20T08:26:56Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 9244, "attachment_id": null, "text": "I forget to add my configure options:\n\n./configure --enable-deflate --enable-mime-magic \\\n--enable-expires --enable-headers \\\n--enable-unique-id --enable-http --enable-dav \\\n--enable-info --enable-cgi --disable-cgid \\\n--enable-speling --enable-rewrite \\\n--enable-so --enable-mods-shared=most", "id": 16397, "time": "2002-05-20T08:28:36Z", "creator": "robbat2@orbis-terrarum.net", "creation_time": "2002-05-20T08:28:36Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 9244, "attachment_id": null, "id": 16431, "time": "2002-05-20T19:20:18Z", "creator": "jwoolley@apache.org", "creation_time": "2002-05-20T19:20:18Z", "is_private": false, "text": "What do you get for ./httpd -l and ./httpd -V ?  \n  \nWith your ./configure arguments, configure says:  \n  \nchecking which MPM to use... prefork  \nchecking whether to enable mod_http... shared (most)  \nchecking whether to enable mod_mime... shared (most)  \n  \nmod_http should never be shared!!  \n  \nWhat's happened is that by explicitly specifying --enable-http, you've tricked \nit into allowing --enable-mods-shared=most to cause mod_http to be built as a \nshared module (DSO), which you can't do.  The link failures are because the \nsymbols exported from mod_http are missing.  Get rid of the --enable-http \nfrom the ./configure line and then mod_http will go back to being statically \ncompiled like it's supposed to be and it will work.  We should try to find \nsome way to detect this misconfiguration and either fix it automatically or \nat least fail more gracefully.  \n  "}, {"count": 3, "tags": [], "bug_id": 9244, "is_private": false, "text": "Here is a patch that seems to work for me:\nIt is patterned after a similar fragment for the mod_so DSO.\n\n--- httpd-2.0.36/modules/http/config2.m4        Wed Oct  3 10:47:51 2001\n+++ httpd-2.0.36-new/modules/http/config2.m4    Mon May 20 13:14:41 2002\n@@ -4,8 +4,15 @@\n\n http_objects=\"http_core.lo http_protocol.lo http_request.lo\"\n\n+dnl mod_http should only be built as a static DSO\n+if test \"$enable_http\" = \"yes\"; then\n+    enable_http=\"static\"\n+elif test \"$enable_http\" = \"shared\"; then\n+    AC_MSG_ERROR([mod_http can not be built as a shared DSO])\n+fi\n+\n dnl mod_http freaks out when built as a DSO\n-APACHE_MODULE(http, HTTP protocol handling, $http_objects, , static)\n+APACHE_MODULE(http, HTTP protocol handling, $http_objects, , $enable_http)\n APACHE_MODULE(mime, mapping of file-extension to MIME, , , yes)\n\n APACHE_MODPATH_FINISH\n", "id": 16437, "time": "2002-05-20T20:43:16Z", "creator": "robbat2@orbis-terrarum.net", "creation_time": "2002-05-20T20:43:16Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 9244, "attachment_id": null, "is_private": false, "id": 16438, "time": "2002-05-20T20:52:15Z", "creator": "jwoolley@apache.org", "creation_time": "2002-05-20T20:52:15Z", "text": "yeah, I was actually just now working on a patch almost identical, also based on the one \nfrom mod_so.  you actually don't need the: \n-APACHE_MODULE(http, HTTP protocol handling, $http_objects, , static) \n+APACHE_MODULE(http, HTTP protocol handling, $http_objects, , $enable_http) \npart, since by now you've guaranteed that $enable_http == \"static\". \n \nI'll commit this change in a few minutes. \n \nThanks! "}]
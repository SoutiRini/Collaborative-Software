[{"count": 0, "tags": [], "text": "Created attachment 30871\nUnsynchronized getting wrapper from RuntimeContext\n\nThe following code has concurrent issue.\n\n        JspRuntimeContext rctxt = ctxt.getRuntimeContext();\n        JspServletWrapper wrapper = rctxt.getWrapper(wrapperUri);\n\n        synchronized (rctxt) {\n            if (wrapper == null) {\n\n               ....\nIt creates duplicated JspServletWrapper in this scenario,\n\nA.jsp --> C.tag\nB.jsp --> C.tag\n\nA.jsp and B.jsp are both compiling and come to the given lines.\nTwo threads all get null from JspRuntimeContext(JspServletWrapper == null).\nSo two instances of JspServletWrapper was created.", "attachment_id": 30871, "id": 170209, "creator": "xshao@ebay.com", "time": "2013-09-22T10:00:36Z", "bug_id": 55582, "creation_time": "2013-09-22T10:00:36Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 55582, "attachment_id": 30871, "is_private": false, "id": 170210, "time": "2013-09-22T10:01:10Z", "creator": "xshao@ebay.com", "creation_time": "2013-09-22T10:01:10Z", "text": "Comment on attachment 30871\nUnsynchronized getting wrapper from RuntimeContext\n\n>Index: java/org/apache/jasper/compiler/TagFileProcessor.java\n>===================================================================\n>--- java/org/apache/jasper/compiler/TagFileProcessor.java\t(revision 1507186)\n>+++ java/org/apache/jasper/compiler/TagFileProcessor.java\t(working copy)\n>@@ -533,9 +533,11 @@\n> \n>         JspCompilationContext ctxt = compiler.getCompilationContext();\n>         JspRuntimeContext rctxt = ctxt.getRuntimeContext();\n>-        JspServletWrapper wrapper = rctxt.getWrapper(wrapperUri);\n>+        \n> \n>         synchronized (rctxt) {\n>+        \tJspServletWrapper wrapper = rctxt.getWrapper(wrapperUri);\n>+        \t\n>             if (wrapper == null) {\n>                 wrapper = new JspServletWrapper(ctxt.getServletContext(), ctxt\n>                         .getOptions(), tagFilePath, tagInfo, ctxt"}, {"text": "Thanks for the report. This has been fixed in 8.0.x (for 8.0.0-RC4 onwards) and 7.0.x (for 7.0.44 onwards).", "tags": [], "creator": "markt@apache.org", "attachment_id": null, "count": 2, "id": 170226, "time": "2013-09-23T13:57:43Z", "bug_id": 55582, "creation_time": "2013-09-23T13:57:43Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 39704, "text": "Tomcat 5.5.17. When specifying in TOMCAT/conf/context.xml a loader tag, context\nwith privileged=\"true\" are not properly setup.\n\nFor example with this TOMCAT/conf/context.xml:\n[quote]\n<!-- The contents of this file will be loaded for each web application -->\n<Context>\n    <!-- Default set of monitored resources -->\n    <WatchedResource>WEB-INF/web.xml</WatchedResource>\n    <!-- * ADD THIS *  -->\n\t <Loader />\n    <!-- Uncomment this to disable session persistence across Tomcat restarts-->\n    <!--\n    <Manager pathname=\"\" />\n    -->\n\n</Context>\n[/quote]\n\ngives the following error at startup:\nERROR Exception starting filter BalancerFilter -\norg.apache.catalina.core.StandardContext.filterStart(StandardContext.java:3604)\njava.lang.NoClassDefFoundError: org/apache/tomcat/util/digester/Digester\n\tat org.apache.webapp.balancer.RulesParser.createDigester(RulesParser.java:65)\n\tat org.apache.webapp.balancer.RulesParser.<init>(RulesParser.java:43)\n\tat org.apache.webapp.balancer.BalancerFilter.init(BalancerFilter.java:79)\n\tat\norg.apache.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:223)\n\tat\norg.apache.catalina.core.ApplicationFilterConfig.setFilterDef(ApplicationFilterConfig.java:304)\n\tat\norg.apache.catalina.core.ApplicationFilterConfig.<init>(ApplicationFilterConfig.java:77)\n\tat org.apache.catalina.core.StandardContext.filterStart(StandardContext.java:3600)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:4193)\n\tat org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:759)\n\tat org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:739)\n\tat org.apache.catalina.core.StandardHost.addChild(StandardHost.java:524)\n\tat org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:904)\n\tat org.apache.catalina.startup.HostConfig.deployDirectories(HostConfig.java:867)\n\tat org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:474)\n\tat org.apache.catalina.startup.HostConfig.start(HostConfig.java:1122)\n\tat org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:310)\n\tat\norg.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1021)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:718)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1013)\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:442)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:450)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:709)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:551)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\n\tat java.lang.reflect.Method.invoke(Unknown Source)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:294)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:432)\nERROR Error filterStart -\norg.apache.catalina.core.StandardContext.start(StandardContext.java:4194)\nERROR Context [/balancer] startup failed due to previous errors -\norg.apache.catalina.core.StandardContext.start(StandardContext.java:4215)\n\nNote that this is a default install w/o any custom webapps just with the empty\nloader tag added.\n\nIt seems that the digester rules do not handle this case appropriately.", "id": 89690, "time": "2006-06-02T09:48:13Z", "creator": "costin.leau@gmail.com", "creation_time": "2006-06-02T09:48:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "costin.leau@gmail.com", "attachment_id": null, "id": 89691, "time": "2006-06-02T09:48:29Z", "bug_id": 39704, "creation_time": "2006-06-02T09:48:29Z", "is_private": false, "text": "It might be related to : http://issues.apache.org/bugzilla/show_bug.cgi?id=38223"}, {"count": 2, "tags": [], "text": "Just out of curiosity, why would you specify an empty Loader tag?  Do you have a\nreal use-case with an actual custom loader that causes this?", "attachment_id": null, "id": 90259, "creator": "yoavs@computer.org", "time": "2006-06-15T19:00:22Z", "bug_id": 39704, "creation_time": "2006-06-15T19:00:22Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 39704, "attachment_id": null, "text": "I am using a custom classloader; the empty tag is just for demonstration\npurposes: i.e. no matter if you specify a classloader or not, just having the\ntag produces an error.", "id": 90292, "time": "2006-06-16T07:09:33Z", "creator": "costin.leau@gmail.com", "creation_time": "2006-06-16T07:09:33Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 39704, "attachment_id": null, "id": 92285, "creation_time": "2006-08-17T07:44:55Z", "time": "2006-08-17T07:44:55Z", "creator": "costin.leau@gmail.com", "text": "Is there a reason why this bug is still marked as NEEDINFO? What other\ninformation is required?", "is_private": false}, {"count": 5, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 92381, "time": "2006-08-22T01:44:18Z", "bug_id": 39704, "creation_time": "2006-08-22T01:44:18Z", "is_private": false, "text": "*** Bug 40272 has been marked as a duplicate of this bug. ***"}, {"count": 6, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 92383, "time": "2006-08-22T02:02:38Z", "bug_id": 39704, "creation_time": "2006-08-22T02:02:38Z", "is_private": false, "text": "*** Bug 36852 has been marked as a duplicate of this bug. ***"}, {"count": 7, "tags": [], "bug_id": 39704, "attachment_id": null, "id": 92384, "time": "2006-08-22T02:04:46Z", "creator": "markt@apache.org", "creation_time": "2006-08-22T02:04:46Z", "is_private": false, "text": "Problem is due to the way custom loaders are handled on start-up. I can\nre-produce it and am working on a fix."}, {"count": 8, "attachment_id": null, "creator": "markt@apache.org", "text": "*** Bug 37054 has been marked as a duplicate of this bug. ***", "id": 92706, "time": "2006-08-30T03:41:00Z", "bug_id": 39704, "creation_time": "2006-08-30T03:41:00Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "bug_id": 39704, "text": "With so many duplicates a brief re-cap seems in order. The bug only occurs if:\n- Context is specified in server.xml with privilegded=\"false\" and a Loader tag\n\nI haven't found any other combinations that fail.\n\nNote that this issue is a side-effect of fixing embedding bug\nhttp://jira.jboss.com/jira/browse/JBAS-1688", "id": 92777, "time": "2006-08-31T02:17:48Z", "creator": "markt@apache.org", "creation_time": "2006-08-31T02:17:48Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 39704, "text": "(In reply to comment #9)\n> With so many duplicates a brief re-cap seems in order. The bug only occurs if:\n> - Context is specified in server.xml with privilegded=\"false\" and a Loader tag\n> \n> I haven't found any other combinations that fail.\n> \n> Note that this issue is a side-effect of fixing embedding bug\n> http://jira.jboss.com/jira/browse/JBAS-1688\n\nThis issue appears also when deploying an application using Eclipse WTP with a\ncontext.xml containing a custom loader that ends up in conf\\Catalina\\localhost,\nresulting in failure to load system libraries.", "id": 92785, "time": "2006-08-31T08:14:56Z", "creator": "nickarls@gmail.com", "creation_time": "2006-08-31T08:14:56Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 39704, "attachment_id": null, "id": 92786, "time": "2006-08-31T08:29:43Z", "creator": "costin.leau@gmail.com", "creation_time": "2006-08-31T08:29:43Z", "is_private": false, "text": "(In reply to comment #9)\n> With so many duplicates a brief re-cap seems in order. The bug only occurs if:\n> - Context is specified in server.xml with privilegded=\"false\" and a Loader tag\n> \n> I haven't found any other combinations that fail.\n> \n> Note that this issue is a side-effect of fixing embedding bug\n> http://jira.jboss.com/jira/browse/JBAS-1688\n\nBug http://issues.apache.org/bugzilla/show_bug.cgi?id=40272 is not a duplicate -\nas Nicklas pointed out when specifying a classloader (be it custom or the one\nused by default by Tomcat) which Eclipse WTP does, the classloader is not\nproperly set.\nI suspect the digester rules are not properly set for this case (as it was the\ncase of this bug).\n"}, {"count": 12, "tags": [], "bug_id": 39704, "text": "I have a fix that works for Loaders defined in server.xml. I'll test the Eclipse\nWTP case as well.", "id": 92788, "time": "2006-08-31T10:50:12Z", "creator": "markt@apache.org", "creation_time": "2006-08-31T10:50:12Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 39704, "attachment_id": null, "id": 92837, "creation_time": "2006-09-01T03:10:28Z", "time": "2006-09-01T03:10:28Z", "creator": "markt@apache.org", "text": "The latest release of WTP (1.5.0) doesn't appear, at least for me, to create a\ncustom loader. However, it does define the context in server.xml and if a custom\nloader were configured this bug would occur. My proposed fix will address this\nsituation so all versions of WTP should be fine once the fix is in place.", "is_private": false}, {"count": 14, "tags": [], "text": "Fixed in SVN and will be in 5.5.19 onwards.", "attachment_id": null, "id": 92875, "creator": "markt@apache.org", "time": "2006-09-01T11:28:29Z", "bug_id": 39704, "creation_time": "2006-09-01T11:28:29Z", "is_private": false}, {"count": 15, "attachment_id": null, "bug_id": 39704, "is_private": false, "id": 92890, "time": "2006-09-01T13:39:15Z", "creator": "remm@apache.org", "creation_time": "2006-09-01T13:39:15Z", "tags": [], "text": "The report is actually invalid: conf/context.xml will be processed first, then\nthe context.xml inside the context will be processed. As a result, the Loader\nwill be always created with privileged set to \"false\", since this is its value\nin conf/context.xml. The workaround is to have your custom Loader disregard the\nparent CL which is passed to it, and then retrieve the right one later on.\n\nThe only solution is to merge the XML files before parsing (instead of doing the\nsuccessive processing), but it's a bit difficult to do ..."}, {"count": 16, "tags": [], "bug_id": 39704, "attachment_id": null, "id": 93012, "creation_time": "2006-09-05T06:09:39Z", "time": "2006-09-05T06:09:39Z", "creator": "nickarls@gmail.com", "text": "Marks version was working for me (the WTP case) but the latest svn-version fails\nstartup silently with\n\n5.9.2006 9:10:45 org.apache.coyote.http11.Http11BaseProtocol init\nINFO: Initializing Coyote HTTP/1.1 on http-8080\n5.9.2006 9:10:45 org.apache.catalina.startup.Catalina load\nINFO: Initialization processed in 1275 ms\n5.9.2006 9:10:45 org.apache.catalina.core.StandardService start\nINFO: Starting service Catalina\n5.9.2006 9:10:45 org.apache.catalina.core.StandardEngine start\nINFO: Starting Servlet Engine: Apache Tomcat/5.5\n5.9.2006 9:10:45 org.apache.catalina.core.StandardHost start\nINFO: XML validation disabled\nlog4j:WARN No appenders could be found for logger\n(org.apache.catalina.startup.TldConfig).\nlog4j:WARN Please initialize the log4j system properly.\n5.9.2006 9:10:45 org.apache.catalina.core.StandardContext start\nSEVERE: Error listenerStart\n5.9.2006 9:10:45 org.apache.catalina.core.StandardContext start\nSEVERE: Context [/Concept] startup failed due to previous errors", "is_private": false}, {"count": 17, "tags": [], "bug_id": 39704, "text": "A better fix has just been commited. See\nhttp://marc.theaimsgroup.com/?l=tomcat-dev&m=115759391916655&w=2", "id": 93122, "time": "2006-09-07T01:56:41Z", "creator": "markt@apache.org", "creation_time": "2006-09-07T01:56:41Z", "is_private": false, "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 39704, "attachment_id": null, "id": 93132, "time": "2006-09-07T08:45:16Z", "creator": "nickarls@gmail.com", "creation_time": "2006-09-07T08:45:16Z", "is_private": false, "text": "(In reply to comment #17)\n> A better fix has just been commited. See\n> http://marc.theaimsgroup.com/?l=tomcat-dev&m=115759391916655&w=2\n\nThe WTP case still fails to load the context with the custom classloader for me."}, {"count": 19, "tags": [], "bug_id": 39704, "attachment_id": null, "text": "Did set useSystemClassLoaderAsParent=\"false\" on the custom loader? Without this\nyou will see the old behaviour.", "id": 93141, "time": "2006-09-07T11:29:34Z", "creator": "markt@apache.org", "creation_time": "2006-09-07T11:29:34Z", "is_private": false}, {"count": 20, "tags": [], "creator": "nickarls@gmail.com", "text": "(In reply to comment #19)\n> Did set useSystemClassLoaderAsParent=\"false\" on the custom loader? Without this\n> you will see the old behaviour.\n\nThat did the difference. It seems to be working now. ", "id": 93182, "time": "2006-09-08T05:56:08Z", "bug_id": 39704, "creation_time": "2006-09-08T05:56:08Z", "is_private": false, "attachment_id": null}, {"count": 21, "tags": [], "bug_id": 39704, "attachment_id": null, "id": 93206, "time": "2006-09-08T10:52:58Z", "creator": "markt@apache.org", "creation_time": "2006-09-08T10:52:58Z", "is_private": false, "text": "Great. Thanks for the confirmation."}]
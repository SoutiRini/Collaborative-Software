[{"count": 0, "tags": [], "creator": "bryantscott@gmail.com", "attachment_id": 21655, "text": "Created attachment 21655\napr_memcache.c patch for correctly parsing rusage in stats data\n\nThe stat_read_rtime in file apr_memcache.c isn't correctly parsing the rusage times returned by memcached.  The times are returned as secs.usecs.  The code attempts to handle this, but fails because the return value from apr_strtok returns the full secs.usecs string rather than NULL when trying to parse the time string with the default colon separator.  Thus the code within the subsequent if block to try to parse with the dot separator never gets executed.  The end result is to always return zero rusage times.\n\nI simply added dot to the separator list.  I also removed the if block since it is no longer needed.  Patch file generated with diff -u against revision 587284 of apr_util.c is attached and also included below.\n\n--- apr_memcache_old.c\n+++ apr_memcache.c\n@@ -1517,15 +1517,11 @@\n     char *tok;\n     char *secs;\n     char *usecs;\n-    const char *sep = \":\";\n+    const char *sep = \":.\";\n \n     buf[len-2] = '\\0';\n \n     secs = apr_strtok(buf, sep, &tok);\n-    if (secs == NULL) {\n-        sep = \".\";\n-        secs = apr_strtok(buf, sep, &tok);\n-    }\n     usecs = apr_strtok(NULL, sep, &tok);\n     if (secs && usecs) {\n         return apr_time_make(atoi(secs), atoi(usecs));", "id": 114511, "time": "2008-03-11T15:12:45Z", "bug_id": 44587, "creation_time": "2008-03-11T15:12:45Z", "is_private": false}, {"count": 1, "tags": [], "creator": "bojan@rexursive.com", "attachment_id": null, "text": "Committed, thanks for the patch!", "id": 119003, "time": "2008-07-24T17:49:20Z", "bug_id": 44587, "creation_time": "2008-07-24T17:49:20Z", "is_private": false}]
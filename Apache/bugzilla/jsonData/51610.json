[{"count": 0, "attachment_id": null, "bug_id": 51610, "text": "With current trunk. Steps to reproduce:\n\n1. Start Tomcat 7\n\n2. Go to webapps/examples/WEB-INF/web.xml and uncomment <filter-mapping> for \"Timing Filter\" (line 75).\n\n3. Wait several seconds. The examples webapp is reloaded, but fails to start. \n\nThis happens because there is a typo. The <filter-name> value should be\ns/Timing Filter/Timing filter/.\n\nThere is stack trace in the logs:\n\n[[[\n04.08.2011 8:09:39 org.apache.catalina.startup.HostConfig checkResources\nWARNING: Error during context [/examples] restart\njava.lang.IllegalArgumentException: Filter mapping specifies an unknown filter name Timing Filter\n\tat org.apache.catalina.core.StandardContext.validateFilterMap(StandardContext.java:2950)\n\tat org.apache.catalina.core.StandardContext.addFilterMap(StandardContext.java:2915)\n\tat org.apache.catalina.deploy.WebXml.configureContext(WebXml.java:1206)\n\tat org.apache.catalina.startup.ContextConfig.webConfig(ContextConfig.java:1343)\n\tat org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:896)\n\tat org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:322)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:89)\n\tat org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5103)\n\tat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:145)\n\tat org.apache.catalina.startup.HostConfig.checkResources(HostConfig.java:1279)\n\tat org.apache.catalina.startup.HostConfig.check(HostConfig.java:1360)\n\tat org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:294)\n\tat org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n\tat org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:89)\n\tat org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1240)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1398)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1408)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1387)\n\tat java.lang.Thread.run(Thread.java:662)\n]]]\n\n4. Go to web.xml and edit it once again. E.g. re-comment the mapping, or correct the typo.\n\n5. Wait several seconds. Here is an issue:\n\nEXPECTED: The examples webapp should reload successfully.\nACTUAL: Reload fails. The following is printed in the logs:\n\n04.08.2011 8:09:59 org.apache.catalina.startup.HostConfig checkResources\nINFO: Reloading context [/examples]\n04.08.2011 8:09:59 org.apache.catalina.util.LifecycleBase start\nINFO: The start() method was called on component [StandardEngine[Catalina].StandardHost[localhost].StandardContext[/examples]] after start() had already been called. The second call will be ignored.\n\n\n6. Stop Tomcat. Here is the second issue:\n\nEXPECTED: Successful shutdown\nACTUAL: \n[[[\n04.08.2011 8:14:10 org.apache.catalina.startup.Catalina stop\nSEVERE: Catalina.stop\norg.apache.catalina.LifecycleException: An invalid Lifecycle transition was attempted ([before_stop]) for component [StandardEngine[Catalina].StandardHost[localhost].StandardContext[/examples]] in state [STARTING_PREP]\n\tat org.apache.catalina.util.LifecycleBase.invalidTransition(LifecycleBase.java:387)\n\tat org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:212)\n\tat org.apache.catalina.core.ContainerBase.stopInternal(ContainerBase.java:1072)\n\tat org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:225)\n\tat org.apache.catalina.core.ContainerBase.stopInternal(ContainerBase.java:1072)\n\tat org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:225)\n\tat org.apache.catalina.core.StandardService.stopInternal(StandardService.java:502)\n\tat org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:225)\n\tat org.apache.catalina.core.StandardServer.stopInternal(StandardServer.java:748)\n\tat org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:225)\n\tat org.apache.catalina.startup.Catalina.stop(Catalina.java:694)\n\tat org.apache.catalina.startup.Catalina$CatalinaShutdownHook.run(Catalina.java:847)\n]]]\n\nThis exception at shutdown happens only if examples webapp was correct when Tomcat started, but was broken afterwards. If it was already broken at startup time, nothing happens.\n\n7. Here is the third issue: when the above happens the shutdown sequence is apparently aborted abnormally.\n\nEXPECTED: \"INFO: Stopping ProtocolHandler [\"http-bio-8080\"]\" etc. messages\nACTUAL: There are no messages after the \"SEVERE: Catalina.stop\" one that I cited above.", "id": 148373, "time": "2011-08-04T04:28:49Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-08-04T04:28:49Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 51610, "is_private": false, "id": 148410, "time": "2011-08-05T14:44:52Z", "creator": "markt@apache.org", "creation_time": "2011-08-05T14:44:52Z", "tags": [], "text": "I can reproduce this and am close to having a fix. One thing I will say is that the expected behaviour once deployment fails is that the context will stay in the failed state until it is undeployed. Trying to figure out what is a recoverable error and what is not is way too hard and we need to avoid repeated re-deployment attempts."}, {"count": 2, "attachment_id": null, "bug_id": 51610, "is_private": false, "id": 148417, "time": "2011-08-05T16:32:02Z", "creator": "markt@apache.org", "creation_time": "2011-08-05T16:32:02Z", "tags": [], "text": "Fixed in 7.0.x and will be in 7.0.20 onwards."}]
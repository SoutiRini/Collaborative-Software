[{"attachment_id": 32722, "tags": [], "bug_id": 57900, "is_private": false, "count": 0, "id": 182873, "time": "2015-05-07T16:09:17Z", "creator": "Diego.SantaCruz@spinetix.com", "creation_time": "2015-05-07T16:09:17Z", "text": "Created attachment 32722\nPatch to fix the key not found issue with GDBM\n\nThe GDBM backend returns an error on apr_dbm_fetch() and apr_dbm_delete() when the key does not exist.\n\nThis is different from the DB, SDBM and NDBM backends which return no error when the key does not exist.\n\nA consequence of this is that code which checks the error code on these calls starts to fail when apr-util is built with GDBM (but not Berkeley), like httpd's dav_fs locking (see bug #42977).\n\nThe GDBM documentation states that gdbm_errno is set to GDBM_ITEM_NOT_FOUND for fetch and delete when the key is not found, but set_error() in apr_dbm_gdbm.c does not special case this.\n\nI experienced this with apr-util 1.5.2 but the code has not changed in the 1.5.x branch (just checked) nor in apr's trunk.\n\nI attach a patch which fixes the problem (tested with mod_dav_fs in Apache httpd 2.4.6)."}]
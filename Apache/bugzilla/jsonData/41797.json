[{"count": 0, "tags": [], "creator": "tuomas.kiviaho@iki.fi", "attachment_id": null, "id": 100204, "time": "2007-03-09T01:08:21Z", "bug_id": 41797, "creation_time": "2007-03-09T01:08:21Z", "is_private": false, "text": "ClassNotFoundException is thrown from function mapper when it is (re)mapping a\ngiven class/method name pair back to method instance. This may happen due to\nserialization.\n\nPatch is simply to replace used Class.forName with ReflectionUtil.forName \n\njava.lang.ClassNotFoundException: \n\tat java.net.URLClassLoader$1.run(URLClassLoader.java:200)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:188)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:306)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:251)\n\tat java.lang.ClassLoader.loadClassInternal(ClassLoader.java:319)\n\tat java.lang.Class.forName0(Native Method)\n\tat java.lang.Class.forName(Class.java:164)\n\tat\norg.apache.el.lang.FunctionMapperImpl$Function.getMethod(FunctionMapperImpl.java:147)\n\tat\norg.apache.el.lang.FunctionMapperImpl.resolveFunction(FunctionMapperImpl.java:53)\n\tat org.apache.el.parser.AstFunction.getValue(AstFunction.java:71)\n\tat org.apache.el.ValueExpressionImpl.getValue(ValueExpressionImpl.java:186)\n\tat com.sun.facelets.el.TagValueExpression.getValue(TagValueExpression.java:71)"}, {"count": 1, "tags": [], "bug_id": 41797, "attachment_id": 19687, "text": "Created attachment 19687\nFunctionMapperImpl", "id": 100205, "time": "2007-03-09T01:11:07Z", "creator": "tuomas.kiviaho@iki.fi", "creation_time": "2007-03-09T01:11:07Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 41797, "attachment_id": null, "id": 101002, "time": "2007-03-26T23:06:59Z", "creator": "tuomas.kiviaho@iki.fi", "creation_time": "2007-03-26T23:06:59Z", "is_private": false, "text": "NPE is thrown from function mapper when externalizing second time. First time\nloses reference to originating method and second time ignores the fact that\nmethod may indeed still be null.\n\nPatch is to prefer non-transient fields filled during externalization over\nmethod itself.\n\nCaused by: java.lang.NullPointerException\n at\norg.apache.el.lang.FunctionMapperImpl$Function.writeExternal(FunctionMapperImpl.java:123)\n at java.io.ObjectOutputStream.writeExternalData(ObjectOutputStream.java:1421)\n at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1390)\n at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)\n at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)\n at java.util.HashMap.writeObject(HashMap.java:1000)\n at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source)\n at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n at java.lang.reflect.Method.invoke(Method.java:597)\n at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:945)\n at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1461)\n at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)\n at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)\n at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)\n at org.apache.el.lang.FunctionMapperImpl.writeExternal(FunctionMapperImpl.java:74)\n at java.io.ObjectOutputStream.writeExternalData(ObjectOutputStream.java:1421)\n at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1390)\n at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)\n at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)\n at org.apache.el.ValueExpressionImpl.writeExternal(ValueExpressionImpl.java:256)\n at java.io.ObjectOutputStream.writeExternalData(ObjectOutputStream.java:1421)\n at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1390)\n at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)\n at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)\n at\ncom.sun.facelets.el.TagValueExpression.writeExternal(TagValueExpression.java:128)"}, {"count": 3, "tags": [], "text": "Comment on attachment 19687\nFunctionMapperImpl\n\nIndex:\nC:/cygwin/home/kivtuo/scm/tomcat/tc6.0.x/jasper/src/share/org/apache/el/lang/Fu\nnctionMapperImpl.java\n===================================================================\n---\nC:/cygwin/home/kivtuo/scm/tomcat/tc6.0.x/jasper/src/share/org/apache/el/lang/Fu\nnctionMapperImpl.java\t     (revision 416976)\n+++\nC:/cygwin/home/kivtuo/scm/tomcat/tc6.0.x/jasper/src/share/org/apache/el/lang/Fu\nnctionMapperImpl.java\t     (working copy)\n@@ -119,9 +119,9 @@\n\t public void writeExternal(ObjectOutput out) throws IOException {\n\t     out.writeUTF((this.prefix != null) ? this.prefix : \"\");\n\t     out.writeUTF(this.localName);\n-\t     out.writeUTF(this.m.getDeclaringClass().getName());\n-\t     out.writeUTF(this.m.getName());\n-\t    \nout.writeObject(ReflectionUtil.toTypeNameArray(this.m.getParameterTypes()));\n+\t     out.writeUTF((this.owner != null) ? this.owner :\nthis.m.getDeclaringClass().getName());\n+\t     out.writeUTF((this.name != null) ? this.name : this.m.getName());\n+\t     out.writeObject((this.types != null) ? this.types :\nReflectionUtil.toTypeNameArray(this.m.getParameterTypes()));\n\t }\n\n\t /*\n@@ -143,7 +143,7 @@\n\t public Method getMethod() {\n\t     if (this.m == null) {\n\t\t try {\n-\t\t     Class t = Class.forName(this.owner);\n+\t\t     Class t = ReflectionUtil.forName(this.owner);\n\t\t     Class[] p = ReflectionUtil.toTypeArray(this.types);\n\t\t     this.m = t.getMethod(this.name, p);\n\t\t } catch (Exception e) {", "attachment_id": 19687, "id": 101003, "creation_time": "2007-03-26T23:09:26Z", "time": "2007-03-26T23:09:26Z", "creator": "tuomas.kiviaho@iki.fi", "bug_id": 41797, "is_private": false}, {"count": 4, "tags": [], "creator": "m.hiemstra@minihouse.com", "attachment_id": null, "text": "Over 6 months later!!!! this bug STILL exists in Tomcat 6.0.14. Implement the\nfix by Tuomas Kiviaho. It really works.", "id": 108197, "time": "2007-09-14T05:25:22Z", "bug_id": 41797, "creation_time": "2007-09-14T05:25:22Z", "is_private": false}, {"count": 5, "tags": [], "creator": "funkman@joedog.org", "text": "Patch attached was applied - marking as fixed - please confirm.\n\nCommitted revision 578466.", "id": 108497, "time": "2007-09-22T11:06:14Z", "bug_id": 41797, "creation_time": "2007-09-22T11:06:14Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 41797, "attachment_id": null, "text": "The patch editing feature that I used wasn't as clear as it should have been.\nThis issue is now only partially completed, that is the CNFE has been fixed, but\nNPE still remains. Comment number #3 is the result of patch edition containing\nboth aspects.", "id": 108500, "time": "2007-09-22T11:29:02Z", "creator": "tuomas.kiviaho@iki.fi", "creation_time": "2007-09-22T11:29:02Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 41797, "attachment_id": null, "text": "Applied the other patch too  - Thanks!\n\nCommitted revision 578610.\n", "id": 108509, "time": "2007-09-23T16:34:49Z", "creator": "funkman@joedog.org", "creation_time": "2007-09-23T16:34:49Z", "is_private": false}, {"count": 8, "tags": [], "creator": "tuomas.kiviaho@iki.fi", "attachment_id": null, "text": "I verified the issue but could not test against a build since there doesn't seem\nto be CI oriented mavenization (neither for snapshots nor real versions?). Hence\nI don't feel comfortable marking this closed myself without actually testing it\nfirst with a build common for all.", "id": 108528, "time": "2007-09-24T06:09:07Z", "bug_id": 41797, "creation_time": "2007-09-24T06:09:07Z", "is_private": false}, {"count": 9, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 113236, "time": "2008-01-28T14:06:47Z", "bug_id": 41797, "creation_time": "2008-01-28T14:06:47Z", "is_private": false, "text": "*** Bug 42866 has been marked as a duplicate of this bug. ***"}, {"count": 10, "tags": [], "bug_id": 41797, "attachment_id": null, "text": "Fixed in 6.0.15 (6.0.16). I am changing status from VERIFIED to CLOSED.", "id": 128974, "time": "2009-07-18T06:44:14Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2009-07-18T06:44:14Z", "is_private": false}]
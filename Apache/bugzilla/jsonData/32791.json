[{"count": 0, "tags": [], "creator": "spremi@yahoo.com", "is_private": false, "id": 68774, "creation_time": "2004-12-21T20:38:48Z", "time": "2004-12-21T20:38:48Z", "bug_id": 32791, "text": "I started using xmlvalidate task on v1.6.2 yesterday.\n\nIt appears that the task validates the XML file against the specified XSD when\nonly one file is being validated.\n\nIf more that one file is given as input e.g thru <fileset> the task consistently\nfails on the second file.\n\nTried on latest nightly as well.\n(I am using lastet JRE available from SUN)\n\nSee the errors & sample ANT project below:\n\n====== ERRORS ======\nD:\\wrk\\test\\ant>ant\nBuildfile: build.xml\n\nval_works:\n     [echo] ::: Validate XML file one-by-one\n[xmlvalidate] 1 file(s) have been successfully validated.\n[xmlvalidate] 1 file(s) have been successfully validated.\n\nval_not_works:\n     [echo] ::: Validate XML file(s)\n[xmlvalidate] D:\\wrk\\test\\ant\\test-2.xml:3:9: cvc-elt.1: Cannot find the\ndeclaration of element 'parent'.\n\nBUILD FAILED\nD:\\wrk\\test\\ant\\build.xml:93: D:\\wrk\\test\\ant\\test-2.xml is not a valid XML\ndocument.\n\nTotal time: 0 seconds\nD:\\wrk\\test\\ant>\n\n========= build.xml =========\n\n<?xml version=\"1.0\"?>\n\n<project    name    = \"test\"\n            default = \"all\"\n            basedir = \".\">\n\n    <target name        = \"val_works\"\n            description = \"Validate the XML files against specified XSD.\">\n\n        <echo message = \"::: Validate XML file one-by-one\" />\n\n        <xmlvalidate\n            lenient     = \"no\"\n            failonerror = \"yes\"\n            warn        = \"yes\"\n            file        = \"test-1.xml\">\n\n            <attribute\n                name    = \"http://xml.org/sax/features/validation\"\n                value   = \"true\" />\n\n            <attribute\n                name    = \"http://apache.org/xml/features/validation/schema\"\n                value   = \"true\" />\n\n            <attribute\n                name    =\n\"http://apache.org/xml/features/validation/schema-full-checking\"\n                value   = \"true\" />\n\n            <property\n                name    =\n\"http://apache.org/xml/properties/schema/external-noNamespaceSchemaLocation\"\n                value   = \"test.xsd\" />\n\n        </xmlvalidate>\n\n        <xmlvalidate\n            lenient     = \"no\"\n            failonerror = \"yes\"\n            warn        = \"yes\"\n            file        = \"test-2.xml\">\n\n            <attribute\n                name    = \"http://xml.org/sax/features/validation\"\n                value   = \"true\" />\n\n            <attribute\n                name    = \"http://apache.org/xml/features/validation/schema\"\n                value   = \"true\" />\n\n            <attribute\n                name    =\n\"http://apache.org/xml/features/validation/schema-full-checking\"\n                value   = \"true\" />\n\n            <property\n                name    =\n\"http://apache.org/xml/properties/schema/external-noNamespaceSchemaLocation\"\n                value   = \"test.xsd\" />\n\n        </xmlvalidate>\n\n    </target>\n\n    <target name        = \"val_not_works\"\n            description = \"Validate the XML files against specified XSD.\">\n\n        <echo message = \"::: Validate XML file(s)\" />\n\n        <xmlvalidate\n            lenient     = \"no\"\n            failonerror = \"yes\"\n            warn        = \"yes\">\n\n            <attribute\n                name    = \"http://xml.org/sax/features/validation\"\n                value   = \"true\" />\n\n            <attribute\n                name    = \"http://apache.org/xml/features/validation/schema\"\n                value   = \"true\" />\n\n            <attribute\n                name    =\n\"http://apache.org/xml/features/validation/schema-full-checking\"\n                value   = \"true\" />\n\n            <property\n                name    =\n\"http://apache.org/xml/properties/schema/external-noNamespaceSchemaLocation\"\n                value   = \"test.xsd\" />\n\n            <fileset\n                dir         = \"${basedir}\"\n                includes    = \"test-*.xml\" />\n\n        </xmlvalidate>\n\n    </target>\n\n    <target name    = \"all\"\n            depends = \"val_works, val_not_works\">\n\n    </target>\n\n</project>\n\n========= test.xsd =========\n<?xml version = \"1.0\" encoding = \"UTF-8\" standalone = \"yes\" ?>\n\n<xsd:schema\n    xmlns:xsd           = \"http://www.w3.org/2001/XMLSchema\"\n    elementFormDefault  = \"qualified\">\n\n    <xsd:element\n        name    = \"parent\"\n        type    = \"Parent\" />\n\n\n    <xsd:complexType\n        name    = \"Parent\">\n\n        <xsd:sequence>\n            <xsd:element\n                name        = \"child\"\n                type        = \"xsd:string\"\n                minOccurs   = \"0\"\n                maxOccurs   = \"unbounded\" />\n        </xsd:sequence>\n\n    </xsd:complexType>\n\n\n\n</xsd:schema>\n\n========= test-1.xml =========\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n\n<parent>\n    <child>a</child>\n    <child>b</child>\n    <child>c</child>\n    <child>d</child>\n</parent>\n\n========= test-2.xml =========\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n\n<parent>\n    <child>e</child>\n    <child>f</child>\n    <child>g</child>\n    <child>h</child>\n</parent>", "attachment_id": null}, {"count": 1, "tags": [], "creator": "spremi@yahoo.com", "is_private": false, "id": 68775, "creation_time": "2004-12-21T20:40:20Z", "time": "2004-12-21T20:40:20Z", "bug_id": 32791, "text": "Created attachment 13814\nAnt project illustrating the behavior", "attachment_id": 13814}, {"count": 2, "tags": [], "bug_id": 32791, "attachment_id": null, "text": "I have the same probleme with the fileset when it returns more than one file. \nIt seem to be like an inputstream, can be read only one time... and work only \non the very first file of fileset and not on others.\n\nWhen does the bugg will be corrected, not appear in change 1.6.3beta1 ?", "id": 74084, "time": "2005-04-25T15:01:21Z", "creator": "romain.schmocker@arcaciel.com", "creation_time": "2005-04-25T15:01:21Z", "is_private": false}, {"count": 3, "tags": [], "creator": "stevel@apache.org", "text": "Seems to me the underlying cause to this is we createOne parser and hand it all\nfiles to validate. \n\nWe should move to one parser instance per file.", "id": 74675, "time": "2005-05-10T17:03:53Z", "bug_id": 32791, "creation_time": "2005-05-10T17:03:53Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 32791, "attachment_id": null, "text": "Fixed in CVS_HEAD, with a test case to catch regression. ", "id": 74680, "time": "2005-05-10T18:35:49Z", "creator": "stevel@apache.org", "creation_time": "2005-05-10T18:35:49Z", "is_private": false}, {"count": 5, "tags": [], "creator": "homer.pichler@gmx.net", "text": "There is a performance problem when validating a lots of XML files against\na large schema that can be fixed with a xerces2 \"grammar-pool\". See\nhttp://www-128.ibm.com/developerworks/xml/library/x-perfap3.html#N1017A\n\nI took the CVS source of XMLValidate.java, removed the XmlConstants lookup\nto make it compilable under ant 1.6.5 and added a grammar pool. This did\nspeed up our validation of 6500 files from 5 minutes to 1 minute and allows\nus to stay with ant 1.6.5 and replacing only XMLValidate in ant-nodeps.jar.\nPerhaps other people find it useful and the cache becomes an official\n(perhaps optional) feature of the next ant release.\n\nregards,\nMichael Pichler", "id": 86598, "time": "2006-03-08T10:28:48Z", "bug_id": 32791, "creation_time": "2006-03-08T10:28:48Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 32791, "is_private": false, "id": 86599, "attachment_id": 17847, "creator": "homer.pichler@gmx.net", "creation_time": "2006-03-08T10:32:30Z", "time": "2006-03-08T10:32:30Z", "text": "Created attachment 17847\nant 1.6.5 compat. xmlvalidatetask + grammar pool"}, {"count": 7, "tags": [], "bug_id": 32791, "is_private": false, "id": 86605, "attachment_id": null, "creator": "mbenson@apache.org", "creation_time": "2006-03-08T14:41:51Z", "time": "2006-03-08T14:41:51Z", "text": "Please supply changes as patches in unified diff format.\n\nThanks!"}, {"count": 8, "tags": [], "bug_id": 32791, "attachment_id": 17893, "text": "Created attachment 17893\npatch for XMLValidateTask 1.6.5\n\ndiff -u XMLValidateTask_165.jav XMLValidateTask.java\n\nIncorporates ant CVS changes to XMLValidateTask.java for compilation\nagainst ant 1.6.5 distribution files.\n\nAdds a schema pool cache (to speed up comparison of many files) which is\nonly active when usePool=\"true\". Default is false, because error messages\non faulty xsd files are swallowed by the pool leading to strange errors.", "id": 86800, "time": "2006-03-14T15:11:38Z", "creator": "homer.pichler@gmx.net", "creation_time": "2006-03-14T15:11:38Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 32791, "is_private": false, "id": 86801, "attachment_id": 17894, "creator": "homer.pichler@gmx.net", "creation_time": "2006-03-14T15:13:43Z", "time": "2006-03-14T15:13:43Z", "text": "Created attachment 17894\nas before w/o gzip compression. Sorry."}]
[{"count": 0, "tags": [], "creator": "lianggt08@sei.pku.edu.cn", "is_private": false, "text": "The fix revision 412780 was aimed to remove an resource leak bug on the  \nPrintWriter object \"writer \"in the method \"cacheContext\" of the file \n\"/tomcat/tc6.0.x/trunk/java/org/apache/catalina/manager/HTMLManagerServlet.java\" , but it is incomplete. \n\nWhen the statements at lines 309-540 throw any eception, the objects \"writer\"can \nnot be closed as expected. The best way to close such resource object is putting  \nsuch close operations in the finaly block of a try-catch-finally structure.\n\nThe buggy code in the head revision is copied  as bellows:\n\n public void list(HttpServletRequest request,\n                     HttpServletResponse response,\n                     String message) throws IOException {\n\n        if (debug >= 1)\n            log(\"list: Listing contexts for virtual host '\" +\n                host.getName() + \"'\");\n\n308        PrintWriter writer = response.getWriter();\n\n        // HTML Header Section\n        writer.print(Constants.HTML_HEADER_SECTION);\n\u3002\u3002\u3002\u3002\u3002\n\n        // Finish up the response\n        writer.flush();\n541        writer.close();\n    }", "id": 153967, "time": "2012-02-21T10:06:34Z", "bug_id": 52722, "creation_time": "2012-02-21T10:06:34Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 52722, "attachment_id": null, "id": 154768, "time": "2012-03-09T20:24:51Z", "creator": "markt@apache.org", "creation_time": "2012-03-09T20:24:51Z", "is_private": false, "text": "r412780 had nothing to do with resolving a resource leak.\n\nThere is no \"cacheContext\" method in the quoted class.\n\nHaving tracked down the correct code, there is no leak here. The container *always* closing the Stream/Writer regardless of whether the app does or not."}, {"count": 2, "tags": [], "bug_id": 52722, "attachment_id": null, "id": 154815, "time": "2012-03-12T08:11:28Z", "creator": "lianggt08@sei.pku.edu.cn", "creation_time": "2012-03-12T08:11:28Z", "is_private": false, "text": "The buggy method is \"list()\" at line 300 in the file \"/tomcat/tc6.0.x/trunk/java/org/apache/catalina/manager/HTMLManagerServlet.java\" (head revision 1226777)\n\nplease reconsider this resource leak. \n\nWhen the statements at lines 309-540 throw any eception, the objects\n\"writer\"can not be closed as expected. \n\nYou said that \"The container\n*always* closing the Stream/Writer regardless of whether the app does or not\", what is about your stated \"container\"? How to guaranteeing its normal execution? what if any other caller invokes this method ?"}, {"count": 3, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "My statements in comment 1 are correct. If you don't understand them, the users list is the place to ask for an explanation, not Bugzilla.", "id": 154817, "time": "2012-03-12T08:37:22Z", "bug_id": 52722, "creation_time": "2012-03-12T08:37:22Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "jackie.qq.zhang@gmail.com", "is_private": false, "text": "Hi, Apache httpd,\n\nI experienced the following mutex generation error:\n\n[core:emerg] [pid 30875:tid 140406146557696] (28)No space left on device: AH00023: Couldn't create the rewrite-map mutex\n285 AH00016: Configuration Failed\n\nIt's weird because I don't have \"rewrite-map\" related configuration in my httpd.conf, I even do not know what is a rewrite-map mutex, and what it's used for. Also, I checked my disk space and filesystem quota but I have plenty of space.\n\nI tried hard to modify my httpd.conf to make it work but failed. Then, I searched on the Internet and figured out it's because of orphan semaphores due to unclean shutdown.\n\nBut, I was surprised to see so many people experienced the same problem. Just randomly grab some of them:\n\nhttp://comments.gmane.org/gmane.linux.uml.user/14270\nhttp://rackerhacker.com/2007/08/24/apache-no-space-left-on-device-couldnt-create-accept-lock/\nhttp://forum.directadmin.com/showthread.php?t=43938&page=1\nhttp://blog.mohammadzadeh.info/index.php/apache-no-space-left-on\nhttp://linuxwindowsmaster.com/fixing-apache-%E2%80%9Cno-space-left-on-device-couldn%E2%80%99t-create-accept-lock%E2%80%9D-errors/\n(and many many others)\n \nEven users suspected this's a bug and filed a bugzilla report:\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=26265\n\nReading these posts, we can find that the problem confused even misled users to check \"disk space\", \"quota limit\", etc.(the same as I), and \"took me several hours\", \"completely stumped\", etc (also the same).\n\nI strongly suggest to make the message more explicit and useful to users, and let users check their semaphore limit directly. Most of users including me do not know what does a mutex failure mean.\n\n---------\n\nThe same thing applies to scoreboard creation failures. I used to get the error message which takes me a lot of time to fix. The message is like:\n\n[core:crit] [pid 15657:tid 140370438330112] (12)Cannot allocate memory: AH00004: Unable to create or access scoreboard (anonymous shared memory failure)\n\nSimilarly, I never configured scoreboard related stuff, and I don't know what a scoreboard is and what is it used for.\n\n(Searching on Internet, you can also find many users have the same problem!) \n\nIt's not intuitive to users why setting a upper limit would cause shared memory problem, if they do not understand the scoreboard mechanism used for IPC.\n\nSo, I suggest to tell users something like \"Reduce the ServerLimit and ThreadLimit settings, or clean the shared memory to increase the limit\" in addition to the scoreboard creation failure message. \n\nThanks you very much!\n\nBest regards,\nJackie Zhang", "id": 164617, "time": "2013-01-14T09:16:30Z", "bug_id": 54415, "creation_time": "2013-01-14T09:16:30Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Hi, Eric, \n\nI noticed the severity is changed from \"major\" to \"Enhancement\". \n\nOk, let me see whether I have time to help the cases. I guess it's easy to modify the log message but have to make sure its correct under all the abnormal cases.\n\nBest,\nJackie", "attachment_id": null, "id": 164625, "creator": "jackie.qq.zhang@gmail.com", "time": "2013-01-14T19:07:05Z", "bug_id": 54415, "creation_time": "2013-01-14T19:07:05Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 54415, "is_private": false, "text": "Created attachment 29856\nTo pinpoint the root cause of the scoreboard generation error", "id": 164651, "time": "2013-01-16T06:20:26Z", "creator": "jackie.qq.zhang@gmail.com", "creation_time": "2013-01-16T06:20:26Z", "attachment_id": 29856}, {"count": 3, "tags": [], "text": "Hi, \n\nThis's the patch for the \"scoreboard\" problem.\n\nThe basic idea is to remind users of checking the two relevant configuration options, i.e., \"ServerLimt\" and \"ThreadLimit\". These two directives decides the scoreboard size, c.f., \"AP_DECLARE(int) ap_calc_scoreboard_size(void)\", in \"server/scoreboard.c\".\n\nAlso, I intentional notify the different between anonymous scoreboard which is in memory and file-based scoreboard which is on disk.\n\nThanks,\nJackie", "is_private": false, "id": 164652, "creator": "jackie.qq.zhang@gmail.com", "time": "2013-01-16T06:21:22Z", "bug_id": 54415, "creation_time": "2013-01-16T06:21:22Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Created attachment 29857\nArticulate the root cause of mutex generation failure", "is_private": false, "bug_id": 54415, "id": 164653, "time": "2013-01-16T06:29:00Z", "creator": "jackie.qq.zhang@gmail.com", "creation_time": "2013-01-16T06:29:00Z", "attachment_id": 29857}, {"attachment_id": null, "tags": [], "bug_id": 54415, "is_private": false, "count": 5, "id": 164654, "time": "2013-01-16T06:29:49Z", "creator": "jackie.qq.zhang@gmail.com", "creation_time": "2013-01-16T06:29:49Z", "text": "Hi, this patch is for mutex one. Hope it makes sense.\n\nThanks,\nJackie"}, {"count": 6, "tags": [], "bug_id": 54415, "attachment_id": null, "id": 164684, "time": "2013-01-16T22:07:14Z", "creator": "mike.rumph@oracle.com", "creation_time": "2013-01-16T22:07:14Z", "is_private": false, "text": "Hello Jackie,\n\nIt looks like the patch to \"Articulate the root cause of mutex generation failure\" will need a small correction:\n\nBecause of the added field in line 394, the format string in line 390 will require an additional %s.\n\nThanks,\n\nMike"}, {"count": 7, "tags": [], "bug_id": 54415, "attachment_id": 29863, "id": 164710, "time": "2013-01-17T18:47:06Z", "creator": "jackie.qq.zhang@gmail.com", "creation_time": "2013-01-17T18:47:06Z", "is_private": false, "text": "Created attachment 29863\nArticulate the root cause of mutex generation failure (updated!)\n\nYes, exactly, Mike!\nThanks a lot for the sharp shot. GCC keeps silent this time :-(\n\nHere's the refined one.\n\nThanks a lot!\nJackie"}, {"attachment_id": null, "tags": [], "bug_id": 54415, "is_private": false, "count": 8, "id": 203319, "time": "2018-01-17T14:38:39Z", "creator": "apache_bugzilla@valgronda.com", "creation_time": "2018-01-17T14:38:39Z", "text": "The logs are really misleading. Applying the proposed patches would be highly appreciated."}]
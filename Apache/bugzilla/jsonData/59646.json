[{"count": 0, "tags": [], "creator": "petr.sumbera@oracle.com", "attachment_id": null, "id": 191333, "time": "2016-05-31T14:05:51Z", "bug_id": 59646, "creation_time": "2016-05-31T14:05:51Z", "is_private": false, "text": "I have several core files from our customers. Both customers are on sparc.\n\n0007fc30df5fb0a1 mod_proxy.so`proxy_handler+0x744(4c4f5f3e90, 4c4f5f3e90, 4c4f5f964e, 7fc30e501c000, \n4c4f5a37b8, 7fc30e4f073a0)\n0007fc30df5fb1f1 ap_run_handler+0x4c(4c4f5f3e90, c, 4, 100200a18, 4c4f5a14b0, 100200)\n0007fc30df5fb2a1 ap_invoke_handler+0x14c(4c4f5f3e90, 0, 1c, 0, 0, 0)\n0007fc30df5fb371 httpd`ap_process_async_request+0x2c4(4c4f5f3e90, 4, 100033, 100193, 1001932b8, 2)\n0007fc30df5fb441 ap_process_http_connection+0x8c(4c4f5f0210, 0, 1, 100193000, 100193, 100000)\n0007fc30df5fb4f1 ap_run_process_connection+0x4c(4c4f5f0210, 2, 4c4f5a1a28, 100201280, 4c4f5a1a48, 100201)\n0007fc30df5fb5a1 mod_mpm_event.so`process_socket+0x2b0(4c4f5a9908, 1, 4c4f5efe80, 4c4f5f0188, 80000000, \n4c4f5f0210)\n0007fc30df5fb671 mod_mpm_event.so`worker_thread+0x2e4(4c4f5a9908, 4c4f5efe80, 7fc30e5e00220, 18, 0, \n7fc30e4812000)\n0007fc30df5fb751 libc.so.1`_lwp_start(0, 0, 0, 0, 0, 0)\n\n> mod_proxy.so`proxy_handler+0x744::dis\nmod_proxy.so`proxy_handler+0x71c:       st        %o0, [%fp + 0x7db]\nmod_proxy.so`proxy_handler+0x720:       ldx       [%sp + 0x8c7], %o5\nmod_proxy.so`proxy_handler+0x724:       ld        [%o5 + 0xc], %i0\nmod_proxy.so`proxy_handler+0x728:       add       %l2, 0x1, %l2\nmod_proxy.so`proxy_handler+0x72c:       cmp       %l2, %i0\nmod_proxy.so`proxy_handler+0x730:       bl,pt     %icc, -0x1dc  <mod_proxy.so`proxy_handler+0x554>\nmod_proxy.so`proxy_handler+0x734:       sra       %l2, 0x0, %g4\nmod_proxy.so`proxy_handler+0x738:       mov       -0x1, %l7\nmod_proxy.so`proxy_handler+0x73c:       brz,pn    %l0, +0xc     <mod_proxy.so`proxy_handler+0x748>\nmod_proxy.so`proxy_handler+0x740:       ld        [%sp + 0x8e3], %l2\nmod_proxy.so`proxy_handler+0x744:       ld        [%l0], %l7\nmod_proxy.so`proxy_handler+0x748:       ldx       [%sp + 0x8d7], %o7\nmod_proxy.so`proxy_handler+0x74c:       sra       %l2, 0x0, %l3\nmod_proxy.so`proxy_handler+0x750:       add       %i5, 0x1e8, %l6\nmod_proxy.so`proxy_handler+0x754:       mov       %i1, %o5\nmod_proxy.so`proxy_handler+0x758:       clr       %o4\nmod_proxy.so`proxy_handler+0x75c:       stx       %l3, [%sp + 0x8bf]\nmod_proxy.so`proxy_handler+0x760:       mov       0x7, %o3\nmod_proxy.so`proxy_handler+0x764:       mov       0x489, %o1\nmod_proxy.so`proxy_handler+0x768:       stx       %o7, [%sp + 0x8b7]\nmod_proxy.so`proxy_handler+0x76c:       sra       %l7, 0x0, %o2\n\n> $r ! grep l0 \n%g0 = 0x0000000000000000                 %l0 = 0x0000000000114c00 \n\nI cannot reproduce the issue myself. But by fiddling with the code and compiler I was able to localize the place where it cores:\n\nhttp://svn.apache.org/viewvc/httpd/httpd/tags/2.4.12/modules/proxy/mod_proxy.c?view=markup#l1161\n\n1161 \t        ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r, APLOGNO(01143)\n1162 \t                      \"Running scheme %s handler (attempt %d)\",\n1163 \t                      scheme, attempts);\n\nParticularly APLOG_MARK consist from:\n\n#define APLOG_MARK     __FILE__,__LINE__,APLOG_MODULE_INDEX\n\nand APLOG_MODULE_INDEX is:\n\n(aplog_module_index ? *aplog_module_index : APLOG_NO_MODULE)\n\nmod_proxy.so`proxy_handler+0x738:       mov       -0x1, %l7\nmod_proxy.so`proxy_handler+0x73c:       brz,pn    %l0, +0xc     <mod_proxy.so`proxy_handler+0x748>\nmod_proxy.so`proxy_handler+0x740:       ld        [%sp + 0x8e3], %l2\nmod_proxy.so`proxy_handler+0x744:       ld        [%l0], %l7\n\nCustomers also reported that Apache 2.2 works in the same scenario.\nWhere 2.2 seems to have:\n\n#define APLOG_MARK     __FILE__,__LINE__\n\nAny idea?"}, {"count": 1, "tags": [], "creator": "petr.sumbera@oracle.com", "attachment_id": null, "id": 191916, "time": "2016-06-23T14:50:49Z", "bug_id": 59646, "creation_time": "2016-06-23T14:50:49Z", "is_private": false, "text": "It turned out that this is compiler error. mod_proxy built with newer compiler version fixed the issue."}]
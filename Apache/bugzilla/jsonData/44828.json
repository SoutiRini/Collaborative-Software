[{"count": 0, "tags": [], "bug_id": 44828, "attachment_id": null, "text": "SVG snippet like the following:\n\n<text>\n<tspan font-size=\"0.5in\" x=\"1in\" y=\"251in\" font-family=\"Avenir LT 35 Light\">Avenir LT 35 Light : lte50336.ttf</tspan>\n<tspan font-size=\"0.5in\" x=\"1in\" y=\"252in\" font-family=\"Avenir LT 35 Light\">\n                      The Quick Red Fox Jumped Over The Lazy Dog\n                    </tspan>\n</text>\n\nWill cause batik to throw the following exception:\n\norg.w3c.dom.DOMException: file:/home/djoyce/Desktop/Batik_Font_Testing/fonts/fontsampler.svg:\nThe attribute \"font-family\" represents an invalid CSS value (\"Avenir LT 35 Light\").\nOriginal message:\nThe \"font-family\" property does not support integer values.\n\tat org.apache.batik.css.engine.CSSEngine.getCascadedStyleMap(CSSEngine.java:784)\n\tat org.apache.batik.css.engine.CSSEngine.getComputedStyle(CSSEngine.java:876)\n\tat org.apache.batik.bridge.CSSUtilities.getComputedStyle(CSSUtilities.java:82)\n\tat org.apache.batik.bridge.CSSUtilities.convertDisplay(CSSUtilities.java:564)\n\tat org.apache.batik.bridge.SVGTextElementBridge.fillAttributedStringBuffer(SVGTextElementBridge.java:881)\n\tat org.apache.batik.bridge.SVGTextElementBridge.fillAttributedStringBuffer(SVGTextElementBridge.java:936)\n\tat org.apache.batik.bridge.SVGTextElementBridge.buildAttributedString(SVGTextElementBridge.java:856)\n\tat org.apache.batik.bridge.SVGTextElementBridge.computeLaidoutText(SVGTextElementBridge.java:636)\n\tat org.apache.batik.bridge.SVGTextElementBridge.buildGraphicsNode(SVGTextElementBridge.java:292)\n\tat org.apache.batik.bridge.GVTBuilder.buildGraphicsNode(GVTBuilder.java:224)\n\tat org.apache.batik.bridge.GVTBuilder.buildComposite(GVTBuilder.java:171)\n\tat org.apache.batik.bridge.GVTBuilder.build(GVTBuilder.java:82)\n\tat org.apache.batik.swing.svg.GVTTreeBuilder.run(GVTTreeBuilder.java:96)\n\n\nAnd instead of using the specified font, a default system font will be used. Font Family names can contain punctuation AND numerical digits, batik needs to properly handle these cases. This is the correct font family as reported by the operating system. It seems batik is being a little too specific when verifying attribute values for font-family.\n\nFrom the w3c:\n\nhttp://www.w3.org/TR/REC-CSS2/fonts.html#font-family-prop", "id": 115618, "time": "2008-04-15T14:59:36Z", "creator": "daniel.a.joyce@gmail.com", "creation_time": "2008-04-15T14:59:36Z", "is_private": false}, {"count": 1, "tags": [], "creator": "daniel.a.joyce@gmail.com", "text": "\n> <text>\n> <tspan font-size=\"0.5in\" x=\"1in\" y=\"251in\" font-family=\"Avenir LT 35\n> Light\">Avenir LT 35 Light : lte50336.ttf</tspan>\n> <tspan font-size=\"0.5in\" x=\"1in\" y=\"252in\" font-family=\"Avenir LT 35 Light\">\n>                       The Quick Red Fox Jumped Over The Lazy Dog\n>                     </tspan>\n> </text>\n\nQuick Update:\n\nsurrounding the attribute value of font-family with single quotes fixes this exception\n\nfont-family=\"'Avenir LT 35 Light'\"\n\nBut this still seems weird.", "id": 115619, "time": "2008-04-15T15:26:10Z", "bug_id": 44828, "creation_time": "2008-04-15T15:26:10Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 44828, "attachment_id": null, "text": "You are correct that quotes shouldn't be required for this font family name (but can be used to work around the bug).", "id": 115620, "time": "2008-04-15T15:37:52Z", "creator": "cam@apache.org", "creation_time": "2008-04-15T15:37:52Z", "is_private": false}, {"count": 3, "tags": [], "creator": "daniel.a.joyce@gmail.com", "attachment_id": null, "id": 115621, "time": "2008-04-15T15:44:23Z", "bug_id": 44828, "creation_time": "2008-04-15T15:44:23Z", "is_private": false, "text": "\n(In reply to comment #2)\n> You are correct that quotes shouldn't be required for this font family name\n> (but can be used to work around the bug).\n> \n\nI don't know alot about the internals of batik, but it seems to try and map everything to a CSS style for internal storage, from a cursory glance at the code base. So it converts the font-family into a @font-face CSS element.\n\nIn a @font-face element, font-families with spaces in them SHOULD be single quoted\n\nSo perhaps what is happening, is that batik is barfing on \n@font-face: Some Font Name With Digits 123 \n\nWhich technical under w3c should still be okay, as commas are used to seperate multi fonts. But perhaps batik's css compliance is overly strict.\n\nAnd single quoting injects the quotes, so batik is then processing...\n\n@font-face: 'Some Font Name With Digits 123'\n\nAnd batik's overly strict CSS impl is then ok with that."}, {"count": 4, "tags": [], "bug_id": 44828, "attachment_id": null, "id": 115622, "time": "2008-04-15T16:46:52Z", "creator": "cam@apache.org", "creation_time": "2008-04-15T16:46:52Z", "is_private": false, "text": "I think the issue is that in org.apache.batik.css.engine.value.css2.FontFamilyManager.createValue() it is assumed that (non-generic, non-quoted) a font family name is parsed just as a sequence of CSS \"identifier\" tokens, when in fact they it should be parsed as a sequence of any token (except the ones listed in the spec as needing to be quoted (such as brackets, braces, etc.))."}, {"count": 5, "tags": [], "bug_id": 44828, "attachment_id": null, "id": 140288, "time": "2010-09-29T05:14:27Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-09-29T05:14:27Z", "is_private": false, "text": "This will be fixed by another ongoing bug (see bug 49968 comment 3).\n\n*** This bug has been marked as a duplicate of bug 49968 ***"}, {"count": 6, "tags": [], "bug_id": 44828, "attachment_id": null, "text": "(In reply to comment #5)\n> This will be fixed by another ongoing bug (see bug 49968 comment 3).\n> \n> *** This bug has been marked as a duplicate of bug 49968 ***\n\nHumm, maybe I could have marked this issue to depend on that bug instead (specially because usually newer bugs are marked duplicate of older ones), but I guess the duplication notation is reasonable in this case (as it will be fixed by that and also because the patch and further information is lying there). :-)", "id": 140290, "time": "2010-09-29T05:47:54Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-09-29T05:47:54Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 44680, "text": "I'm working with POI 3.0.2-FINAL, and I met a stressful problem when trying to autosize a column where there's a FONT apply to. I obtain that ugly exception:\n\njava.lang.ClassCastException: org.apache.poi.hssf.record.StyleRecord\n    at org.apache.poi.hssf.model.Workbook.getExFormatAt(Workbook.java:665)\n    at org.apache.poi.hssf.usermodel.HSSFCell.getCellStyle(HSSFCell.java:896)\n    at org.apache.poi.hssf.usermodel.HSSFSheet.autoSizeColumn(HSSFSheet.java:1690)\n\nHere an abstract of the code producing that stack:\n\nprivate static HSSFCellStyle _BOLD_STYLE = null;\n    private static HSSFFont _BOLD_FONT = null;\n   \n    private HSSFCellStyle getBoldStyle() {\n        if (null == _BOLD_STYLE) {\n            _BOLD_STYLE = _wb.createCellStyle();\n            _BOLD_STYLE.setFont(getBoldFont());\n        }\n        return _BOLD_STYLE;\n    }\n   \n    private HSSFFont getBoldFont() {\n        if (null == _BOLD_FONT) {\n            _BOLD_FONT = _wb.createFont();\n            _BOLD_FONT.setFontHeightInPoints((short)10);\n            _BOLD_FONT.setColor(HSSFFont.COLOR_NORMAL);\n            _BOLD_FONT.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);\n        }\n        return _BOLD_FONT;\n    }\n\nThen during usage:\n\nHSSFCell c = null;\n        _curCellIndex = -1;\n        r = _sheet.createRow(++_curRowIndex);\n        c = r.createCell(++_curCellIndex);\n        final HSSFRichTextString ref = new HSSFRichTextString(\"R\u00e9f\u00e9rence\");\n        c.setCellValue(ref);\n        c.setCellStyle(getBoldStyle());\n          \nThis is done somthing like 13times for \"headers\" in my sheet.\n\nAnd once the page is created, I call this:\n\nprivate void layout() {\n        _sheet.setColumnWidth((short)0, (short)2500);\n        _sheet.setColumnWidth((short)1, (short)2500);\n       \n        for (short i = 2; i < 30; ++i) {\n            _sheet.autoSizeColumn(i);\n        }\n    }\n\nThen autoSizeColumn fire that strange exception.\nThis example is run under jdk_1.4.2_11, but the dev environnement is jdk1.6.0 (don't think it touch that).", "id": 114987, "time": "2008-03-26T09:16:29Z", "creator": "t.lecavelier@laposte.net", "creation_time": "2008-03-26T09:16:29Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 44680, "attachment_id": null, "is_private": false, "id": 114989, "time": "2008-03-26T10:17:56Z", "creator": "t.lecavelier@laposte.net", "creation_time": "2008-03-26T10:17:56Z", "text": "Not related to JDK: same exception with jdk1.4.2 and jdk1.6.0."}, {"count": 2, "attachment_id": null, "bug_id": 44680, "is_private": false, "id": 115012, "time": "2008-03-27T04:42:44Z", "creator": "t.lecavelier@laposte.net", "creation_time": "2008-03-27T04:42:44Z", "tags": [], "text": "Just to precise: autoSizeColumn works perfectly when no Style is applied to a cell scanned by the autoSizeColumn.\nThere's no problem to apply a font *after* the autoSizeColum."}, {"count": 3, "tags": [], "bug_id": 44680, "attachment_id": null, "is_private": false, "id": 115034, "time": "2008-03-27T09:47:38Z", "creator": "yegor@dinom.ru", "creation_time": "2008-03-27T09:47:38Z", "text": "Can you post a fully working example? It would me much easier  for me to diagnose the problem.\n\nI can't reproduce the problem from the supplied pieces of code. \n\nRegards,\nYegor"}, {"count": 4, "tags": [], "creator": "t.lecavelier@laposte.net", "is_private": false, "id": 115072, "creation_time": "2008-03-28T06:41:51Z", "time": "2008-03-28T06:41:51Z", "bug_id": 44680, "text": "(In reply to comment #3)\n\nI tried to write a new project, illustrating the problem, but the sample project works just fine... If I rerun the original project, the problem is still here: that looks like a race condition. \nSince the code contains confidential information, I'll try to fork it and mess the content to post here a working project containing the problem. I hope I could do it next week.\n\nThank you for your attention.", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 44680, "attachment_id": null, "is_private": false, "id": 115241, "time": "2008-04-02T03:33:12Z", "creator": "yegor@dinom.ru", "creation_time": "2008-04-02T03:33:12Z", "text": "Since it is not reproducible I'm resolving it.\n\nYegor"}, {"count": 6, "tags": [], "text": "Hello,\n\nIt's seems that this bug occurs when you put one cellStyle to two workbook \n\nJust consider the exemple above, the error should take place at line \"cell.setCellStyle(cellStyle)\" :\n\n// Create\nFileOutputStream os = new FileOutputStream(\"d:\\\\tst.xls\");\nHSSFWorkbook workbook = new HSSFWorkbook();\nHSSFSheet sheet =workbook.createSheet(\"test\");\nHSSFCell cell = sheet.createRow(0).createCell((short)0);\ncell.setCellValue(new HSSFRichTextString(\"test\"));\nHSSFCellStyle cellStyle = workbook.createCellStyle();\ncellStyle.setFillForegroundColor(HSSFColor.GREY_25_PERCENT.index);\ncellStyle.setFillPattern(HSSFCellStyle.SOLID_FOREGROUND);\ncell.setCellStyle(cellStyle);\nsheet.autoSizeColumn((short)0);\nworkbook.write(os);\nos.close(); \n\n// re create\nos = new FileOutputStream(\"d:\\\\tst2.xls\");\nworkbook = new HSSFWorkbook();\nsheet =workbook.createSheet(\"test\");\ncell = sheet.createRow(0).createCell((short)0);\ncell.setCellValue(new HSSFRichTextString(\"test\"));\ncell.setCellStyle(cellStyle);\nsheet.autoSizeColumn((short)0);\n\n\n\n\n\n", "attachment_id": null, "id": 115877, "creator": "Benjamin.LEROUX@sgam.com", "time": "2008-04-25T09:09:04Z", "bug_id": 44680, "creation_time": "2008-04-25T09:09:04Z", "is_private": false}, {"count": 7, "tags": [], "creator": "apache@gagravarr.org", "is_private": false, "text": "You can only use a cell style with the workbook that created it!", "id": 115878, "time": "2008-04-25T09:12:34Z", "bug_id": 44680, "creation_time": "2008-04-25T09:12:34Z", "attachment_id": null}]
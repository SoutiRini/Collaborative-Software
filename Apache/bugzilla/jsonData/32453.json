[{"attachment_id": null, "tags": [], "bug_id": 32453, "text": "Vignette Application Portal 7.1 (is a webapp) running on tomcat 4.1.27 (Vignette\nsupported platform !) tries to obtain a portlet applications (also a webapp)\nServletContext using the getContext method. Both applications have crossContext\nset to true. This call returns null and Vignette claims it is a bug in tomcat.\n\nVignette provided me with a demo (including setup instructions) showing the\nbehaviour stated.\n\nYou can find it at http://public.sinnerschrader.com/vap/tomcat_bug.zip\n\nI have tried running VAP 7.1 on tomcat 5.0.27 and the behaviour observed with\ntomcat 4.1 still shows up, so the demo (which I have not yet tried myself)\nshould fail on tomcat 5.0 as well.\n\nPS: They are unable to communicate directly. Hence, my role in this game is to\nact as the message deliveryman.\n\nregards\nAndreas", "count": 0, "id": 67624, "time": "2004-11-30T17:37:58Z", "creator": "a.steffan@s2neueinformatik.de", "creation_time": "2004-11-30T17:37:58Z", "is_private": false}, {"count": 1, "tags": [], "creator": "a.steffan@s2neueinformatik.de", "attachment_id": 13598, "id": 67625, "time": "2004-11-30T17:40:04Z", "bug_id": 32453, "creation_time": "2004-11-30T17:40:04Z", "is_private": false, "text": "Created attachment 13598\nDemo including source and instructions"}, {"count": 2, "tags": [], "bug_id": 32453, "attachment_id": null, "id": 67628, "time": "2004-11-30T17:56:57Z", "creator": "remm@apache.org", "creation_time": "2004-11-30T17:56:57Z", "is_private": false, "text": "I have zero interest in fixing this issue, sorry. I expect it to be invalid."}, {"count": 3, "tags": [], "bug_id": 32453, "attachment_id": null, "id": 67629, "time": "2004-11-30T17:58:19Z", "creator": "yoavs@computer.org", "creation_time": "2004-11-30T17:58:19Z", "is_private": false, "text": "And as I've indicated no the mailing list, I share Remy's opinion.  My \ngetContext calls work just fine when crossContext is true."}, {"count": 4, "tags": [], "text": "There's some \"magic\" to make the test fail. Like this global class which uses\nthe servlet context instances from the other context to do the getContext to\nitself (I don't know if you're get the idea, it's quite convoluted).\n\n-> I'm spending zero time on trying to unmangle the tricks used which cause this\n\"bug\"", "attachment_id": null, "bug_id": 32453, "id": 67634, "time": "2004-11-30T18:05:37Z", "creator": "remm@apache.org", "creation_time": "2004-11-30T18:05:37Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 32453, "text": "It didn't fail on tomcat 5.0. I never teted for 4", "count": 5, "id": 67635, "time": "2004-11-30T18:17:46Z", "creator": "funkman@joedog.org", "creation_time": "2004-11-30T18:17:46Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 32453, "attachment_id": null, "text": "(In reply to comment #5)\n> It didn't fail on tomcat 5.0. I never teted for 4\n\nThanks you for your lightning fast responses. I hope you don't mind me directing\nVignettes attention here.\n\nI have not yet tested the demo on tomcat 5 myself, but I have seen VAP 7.1\nfailing on tomcat 5.0 in exactly the same way it fails on tomcat 4.1. The demo\nwas supposed to demonstrate this behaviour. Maybe it does things a little\ndiffrent, and hence, does not fail on tomcat 5.0 like the portal product does.\n\nI'll ask Vignette for further input now.\n\nStay tuned (It might take some time until I get back with another message\npackage)\n\nregards and thanks so far\nAndreas\n", "id": 67643, "time": "2004-11-30T18:59:25Z", "creator": "a.steffan@s2neueinformatik.de", "creation_time": "2004-11-30T18:59:25Z", "is_private": false}, {"count": 7, "attachment_id": null, "bug_id": 32453, "text": "I have tested on TC4 and I do see the messages in stdout indicating a bug. \nI'll fire up my debugger and see if I can work out what is going on. This \nisn't top of my todo list right now so don't expect an instant response.", "id": 67737, "time": "2004-12-01T22:36:44Z", "creator": "markt@apache.org", "creation_time": "2004-12-01T22:36:44Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 32453, "attachment_id": null, "text": "In summary, this is what I see happening:\n\n1. The deployer adds the TestServlet2 context in StandardHostDeployer.addChild\n()\n\n2. StandardHost(ContainerBase).addChildInternal() starts the child (the \ncontext) and then adds the child to StandardHost(ContainerBase).children once \nit has started.\n\n3. Starting the context calls the context listener(s) for the context. As part \nof the context listener for TestServlet2, a cross-context call to getContext\n(\"/TestServlet2\") is made from the context for TestServlet1. Because this is \ncross-context, a call is made to StandardHost.map() to determine the context. \nThis requires the context for TestServlet2 to exist in StandardHost\n(ContainerBase).children.\n\nAnd here we have the problem. When the call is made to StandardHost.map(), the \nTestServlet2 context hasn't been added to StandardHost(ContainerBase).children \nso it fails.\n\nThe spec requires that contentInitialized() is called once the context is \nready to process requests but the context can't actually serve any requests \nuntil it is added to StandardHost(ContainerBase).children because until this \nhappens no request can be mapped to the context. The call to the context \nlistener is being made too soon.\n\nI haven't given any thought about what (if anything) can be done to fix this. \nAny ideas anyone? If we can identify a solution, I am happy to spend the time \nimplementing it.", "id": 67744, "time": "2004-12-02T00:02:33Z", "creator": "markt@apache.org", "creation_time": "2004-12-02T00:02:33Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 32453, "text": "Hallo Mark,\n\nVignette also did some more research. We found that tomcat 4 and 5 behave quite\ndiffrent, and that behaviour also depends on whether apps are wired to server.xml\nor not. I hope to be back with a new \"message package\" soon.\n\nthanks for your efforts\nAndreas\n", "id": 67752, "time": "2004-12-02T01:06:35Z", "creator": "a.steffan@s2neueinformatik.de", "creation_time": "2004-12-02T01:06:35Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 32453, "attachment_id": null, "text": "I have ported Remy's patch from TC5.5.x for this issue and the test case now \nworks correctly.", "id": 68884, "time": "2004-12-23T00:29:17Z", "creator": "markt@apache.org", "creation_time": "2004-12-23T00:29:17Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 32453, "text": "(In reply to comment #10)\n> I have ported Remy's patch from TC5.5.x for this issue and the test case now \n> works correctly.\n\nIs there a way to see the diffs for this patch?", "count": 11, "id": 72528, "time": "2005-03-16T20:32:04Z", "creator": "shane_frensley@yahoo.com", "creation_time": "2005-03-16T20:32:04Z", "is_private": false}, {"count": 12, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 72529, "time": "2005-03-16T21:11:41Z", "bug_id": 32453, "creation_time": "2005-03-16T21:11:41Z", "is_private": false, "text": "http://marc.theaimsgroup.com/?l=tomcat-dev&m=110375813714548&w=2"}]
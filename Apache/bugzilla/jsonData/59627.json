[{"count": 0, "attachment_id": null, "bug_id": 59627, "is_private": false, "id": 191231, "time": "2016-05-24T17:00:25Z", "creator": "dhardik007@gmail.com", "creation_time": "2016-05-24T17:00:25Z", "tags": [], "text": "request.getRequestURL() method replaces the value of host header in the URL before returning the value but it does not check if the value is in correct hostname format.\n\nConsider the following example:\n\nGET /getReqURL/getURL HTTP/1.1\nHost: localhost:8888\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:44.0) Gecko/20100101 Firefox/44.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nConnection: close\nCache-Control: max-age=0\n\nIn the above request, request.getRequestURL() returns http://localhost:8888/getReqURL/getURL\n\nIf the above request is modified and host header is changed to:\n\nGET /getReqURL/getURL HTTP/1.1\nHost: <script>alert(1)</script>\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:44.0) Gecko/20100101 Firefox/44.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nConnection: close\nCache-Control: max-age=0\n\nrequest.getRequestURL() will return the following:\n<script>alert(1)</script>/getReqURL/getUR\n\nAs per RFC2616 does not specify restrictions for a valid host header, this results in lack of trust in value of request.getRequestURL()\n\nWhy this is a security issue:\n\nMany web applications which uses the servlet API may depend on request.getRequestURL() for internal URL redirection or displaying the complete request URL path.\n\nex: response.write(\"Complete Request URL\" : request.getRequestURL() );\nThis can result in an XSS if the Host header is modified."}, {"count": 1, "tags": [], "bug_id": 59627, "text": "It is up to you to do the appropriate filtering when writing back any user data. Same for getHeader, etc etc etc, the list is virtually endless.\n\nPlease never attempt to report possible security issues through BZ, Tomcat has a dedicated security mailing list where confidentiality can be maintained.\nhttp://tomcat.apache.org/security.html", "id": 191232, "time": "2016-05-24T18:02:08Z", "creator": "remm@apache.org", "creation_time": "2016-05-24T18:02:08Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "There is another reason this issue is invalid. It can only happen with a malicious client.\n\nA normal client will never connect to a server while sending a host header for something that it can't resolve to an IP address. It takes a malicious client to do that. If an attacker has managed to install a malicious client on a vicim's PC it is game over before the first byte is sent to the server.\n\nIf the attacker has installed this on their own machine then they are free to attack themselves - and we don't care about that.", "id": 191235, "time": "2016-05-24T18:36:44Z", "bug_id": 59627, "creation_time": "2016-05-24T18:36:44Z", "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Hi,\n\nafter images have been removed from a powerpoint file, they are sometimes not really deleted. This causes the calculation of the offset in SlideShow.addPicture to fail. Attached is a patch that bases the calculation on the actual data contained in the file.\n\nHTH, David.", "attachment_id": null, "id": 124480, "creator": "erwin94@gmx.net", "time": "2009-01-29T08:52:31Z", "bug_id": 46627, "creation_time": "2009-01-29T08:52:31Z", "is_private": false}, {"count": 1, "tags": [], "creator": "erwin94@gmx.net", "attachment_id": 23193, "is_private": false, "id": 124481, "time": "2009-01-29T08:53:23Z", "bug_id": 46627, "creation_time": "2009-01-29T08:53:23Z", "text": "Created attachment 23193\npatch that fixes the problem for me."}, {"attachment_id": null, "tags": [], "creator": "yegor@dinom.ru", "is_private": false, "count": 2, "id": 124521, "time": "2009-01-30T06:01:55Z", "bug_id": 46627, "creation_time": "2009-01-30T06:01:55Z", "text": "Can you attach a problem ppt file with removed images? The suggested fix looks good but I don't want to commit it without a unit test.\n\nThanks,\nYegor"}, {"count": 3, "tags": [], "bug_id": 46627, "is_private": false, "text": "Sorry, I am having trouble reproducing this problem on a new ppt file. The one that causes problems for me I cannot submit because of company policy, but this happened before on several files, so this does not seem to be an isolated incident. I will try again to reproduce the problem when I have more time (in about a week or so).\n\nbye, David.", "id": 124577, "time": "2009-02-01T08:30:41Z", "creator": "erwin94@gmx.net", "creation_time": "2009-02-01T08:30:41Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "is_private": false, "id": 124578, "time": "2009-02-01T08:49:05Z", "bug_id": 46627, "creation_time": "2009-02-01T08:49:05Z", "text": "I suspect it can be reproduced with PictureTypeZero.ppt or PictureLengthZero.ppt from our collection of test files:\n\nhttp://svn.apache.org/repos/asf/poi/trunk/src/scratchpad/testcases/org/apache/poi/hslf/data/\n\nCan check it and post sample code that causes the problem? \n\nThese two files contain invalid images, the first one contains images with unknown type=0, the second one contains images with zero length, i.e. only header and no data.\n\nYegor"}, {"count": 5, "tags": [], "text": "You are correct, PictureLengthZero.ppt exposes the problem. Simply adding any picture, like the following code does, should result in an invalid image in the resulting ppt:\n\n   SlideShow ppt = new SlideShow( new ByteArrayInputStream( readFile( args[ 0 ] ) ) );\n\n   int index = ppt.addPicture( readFile( args[ 1 ] ), Picture.PNG );\n   Picture picture = new Picture( index );\n   ppt.getSlides()[0].addShape( picture );\n\n   ByteArrayOutputStream result = new ByteArrayOutputStream();\n   ppt.write( result );\n\n   FileOutputStream os = new FileOutputStream( \"output.ppt\" );\n   os.write( result.toByteArray() );\n   os.close();\n\nreadFile is a simple function that returns the bytes contained in a file. After applying the patch this works for me.\n\n\nbye, David.\n", "is_private": false, "bug_id": 46627, "id": 124730, "time": "2009-02-09T04:58:50Z", "creator": "erwin94@gmx.net", "creation_time": "2009-02-09T04:58:50Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "text": "Fixed in r743080\n\nThanks,\nYegor", "id": 124763, "time": "2009-02-10T11:55:36Z", "bug_id": 46627, "creation_time": "2009-02-10T11:55:36Z", "is_private": false}]
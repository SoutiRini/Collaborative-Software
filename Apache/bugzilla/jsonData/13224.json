[{"count": 0, "tags": [], "bug_id": 13224, "attachment_id": null, "is_private": false, "id": 23787, "time": "2002-10-02T21:43:15Z", "creator": "mark.odonohue@cytopia.com.au", "creation_time": "2002-10-02T21:43:15Z", "text": "After looking a bit more carefully, it seems that defining Names and using them\nin a cell (as =A_Name) causes the following failue in 1.8.0 (and it seems 1.6.X\nonwards)  - this does not cause a problem with 1.5.1.\n\nI've attached a slightly modified worksheet.xls example, (Im not sure of the\nattach policy here).  The process is to take a worksheet in excel.\n\nTo reproduce:\n\n1. Add a defined name.          (In excel Menu Insert/Names/Define)          I\ninserted Control_Header as a reference to a cell with the string 'Test' in it\n(something like Sheet1!$A$4).\n\n2. Add reference to name.\n       I add a cell with '=Control_Header' in it.\n\n3. Run the ReadWriteWorkbook example, to get the following error (I'd modified\nmine to take the filename as a variable).\n\n\nCheers\n\nMark\n\n\npidgy:~/download/tmp/poi/test> java ReadWriteWorkbook workbook2.xls\njava.lang.reflect.InvocationTargetException\n   at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)   \nat\nsun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:42)\n   at\nsun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:30)\n   at java.lang.reflect.Constructor.newInstance(Constructor.java:263)\n   at org.apache.poi.hssf.record.RecordFactory.createRecord(RecordFactory.java:252)\n   at org.apache.poi.hssf.record.RecordFactory.createRecords(RecordFactory.java:190)\n   at org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:181)\n   at org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:153)\n   at ReadWriteWorkbook.main(ReadWriteWorkbook.java:26)"}, {"count": 1, "tags": [], "bug_id": 13224, "is_private": false, "text": "Created attachment 3323\nexcel spreadsheet with =Names cell that reproduces the problem", "id": 23788, "time": "2002-10-02T21:44:46Z", "creator": "mark.odonohue@cytopia.com.au", "creation_time": "2002-10-02T21:44:46Z", "attachment_id": 3323}, {"count": 2, "tags": [], "bug_id": 13224, "text": "Clean up your classpath.  That stack trace generally means you've got two\nversions of POI trampling on one another.", "id": 23802, "time": "2002-10-03T00:31:14Z", "creator": "poi-support@buni.org", "creation_time": "2002-10-03T00:31:14Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 13224, "attachment_id": null, "id": 23807, "time": "2002-10-03T05:15:06Z", "creator": "mark.odonohue@cytopia.com.au", "creation_time": "2002-10-03T05:15:06Z", "is_private": false, "text": "\nIn not sure who is wrong, possibly the excel document.\n\nIn the document at : http://sc.openoffice.org/excelfileformat.pdf\n\nIt defines \"Name\" type as:\n\n3.10.2 tName (23H, 43H, 63H) This token contains the one-based index to a NAME\nrecord ($5.39). In BIFF2-BIFF4 this could be the index to an EXTERNNAME record\n($5.23) too. From BIFF5 on an external name is represented by the token tNameX\n($3.10.11). Default class: tNameR. Token tName, BIFF2: \n\nOffset Size Contents \n0      2    One-based index to NAME record ($5.39) or EXTERNNAME record ($5.23) \n2      5    Not used\n\n\n\nOffset in formula is 22 when it gets to NamePtg\n 22 67\n 23 1\n 24 0\n 25 0\n 26 0\n(end of array)\n\n67 == 43Hex\nbytes 23 - 24 would be the offset\nbytes 25-26 would be the (seemingly compulsary) 0 on the end.\n\n\nBut NamePtg (constructor) expects three fields:\n\n        field_1_ixti        = LittleEndian.getShort(data, offset);\n        field_2_label_index = LittleEndian.getShort(data, offset + 2);\n        field_3_zero        = LittleEndian.getShort(data, offset + 4);\n\nThe fields being declared as:\n\n    private short             field_1_ixti;   // unknown function\n    private short             field_2_label_index;\n    private short             field_3_zero;   // reserved must be 0\n\n\nPerhaps for Name type 0x43 differs from type 0x23.\n\nI've created a patch:\n\n     public NamePtg(byte [] data, int offset)\n     {\n         offset++;\n-        field_1_ixti        = LittleEndian.getShort(data, offset);\n-        field_2_label_index = LittleEndian.getShort(data, offset + 2);\n-        field_3_zero        = LittleEndian.getShort(data, offset + 4);\n+        if (data.length >= offset + 6) {\n+            field_1_ixti        = LittleEndian.getShort(data, offset);\n+            field_2_label_index = LittleEndian.getShort(data, offset + 2);\n+            field_3_zero        = LittleEndian.getShort(data, offset + 4);\n+        }\n+        else {\n+            field_1_ixti        = 0;\n+            field_2_label_index = LittleEndian.getShort(data, offset );\n+            field_3_zero        = LittleEndian.getShort(data, offset + 2);\n+        }\n     }\n \n\nAnd now it reads this field (and the rest of the spreadsheet with included\ngraphics) - So this works for me, but will leave it to you to work out if this\nis the \"correct\" solution.\n\n\n\n(will also include as an attachement).\n"}, {"count": 4, "tags": [], "creator": "mark.odonohue@cytopia.com.au", "attachment_id": null, "text": "\nHi Oliver,\n\nIt's definately *not* a CLASSPATH problem - of that Im sure :-).\n\nCheers\n\nMark\n\npidgy:~/download/tmp/jakarta-poi/test> echo $CLASSPATH\n/home/odonohue/download/tmp/jakarta-poi/build/jakarta-poi-examples-1.9.0-dev-20021003.jar:/home/odonohue/download/tmp/jakarta-poi/build/jakarta-poi-1.9.0-dev-20021003.jar:/home/odonohue/download/tmp/jakarta-poi/build/jakarta-poi-contrib-1.9.0-dev-20021003.jar:/home/odonohue/download/tmp/jakarta-poi/build/jakarta-poi-scratchpad-1.9.0-dev-20021003.jar:/home/odonohue/download/tmp/jakarta-poi/lib/core/commons-logging-1.0.jar:/home/odonohue/download/tmp/jakarta-poi/lib/endorsed/xalan-2.2.0.jar:/home/odonohue/download/tmp/jakarta-poi/lib/endorsed/xerces-2.0.0.jar:/home/odonohue/download/tmp/jakarta-poi/lib/endorsed/xml-apis.jar:/home/odonohue/download/tmp/jakarta-poi/lib/optional/log4j-core.jar:.\n", "id": 23810, "time": "2002-10-03T05:24:29Z", "bug_id": 13224, "creation_time": "2002-10-03T05:24:29Z", "is_private": false}, {"count": 5, "tags": [], "creator": "mark.odonohue@cytopia.com.au", "attachment_id": 3329, "id": 23811, "time": "2002-10-03T05:25:33Z", "bug_id": 13224, "creation_time": "2002-10-03T05:25:33Z", "is_private": false, "text": "Created attachment 3329\npatch to handle \"=Name\" formula (it works, but Im no expert in excel so please check)"}, {"count": 6, "tags": [], "creator": "avik@apache.org", "attachment_id": null, "id": 46304, "time": "2003-10-27T03:40:35Z", "bug_id": 13224, "creation_time": "2003-10-27T03:40:35Z", "is_private": false, "text": "Fixed in latest CVS. Testcase added. Should work in 2.0pre3. Will certainly to\ninto 2.0pre4"}]
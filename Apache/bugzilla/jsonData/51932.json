[{"count": 0, "tags": [], "bug_id": 51932, "attachment_id": null, "id": 149996, "time": "2011-09-30T21:02:22Z", "creator": "ronald.chen@elasticpath.com", "creation_time": "2011-09-30T21:02:22Z", "is_private": false, "text": "When JMeter makes an http request and the reponse has a cache-control header, it will crash when there are multiple directives.\n\nFor example JMeter will crash when trying to parse the header:\ncache-control: public, max-age=86400, no-transform\n\nThe exception thrown with JMeter 2.5:\njava.lang.NumberFormatException: For input string: \"86400, no-transform\"\n    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)\n    at java.lang.Long.parseLong(Long.java:419)\n    at java.lang.Long.parseLong(Long.java:468)\n    at org.apache.jmeter.protocol.http.control.CacheManager.setCache(CacheManager.java:161)\n    at org.apache.jmeter.protocol.http.control.CacheManager.saveDetails(CacheManager.java:113)\n    at org.apache.jmeter.protocol.http.sampler.HTTPJavaImpl.sample(HTTPJavaImpl.java:589)\n    at org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:62)\n    at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.downloadPageResources(HTTPSamplerBase.java:1155)\n    at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.resultProcessing(HTTPSamplerBase.java:1394)\n    at org.apache.jmeter.protocol.http.sampler.HTTPAbstractImpl.resultProcessing(HTTPAbstractImpl.java:244)\n    at org.apache.jmeter.protocol.http.sampler.HTTPJavaImpl.sample(HTTPJavaImpl.java:592)\n    at org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:62)\n    at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.followRedirects(HTTPSamplerBase.java:1308)\n    at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.resultProcessing(HTTPSamplerBase.java:1379)\n    at org.apache.jmeter.protocol.http.sampler.HTTPAbstractImpl.resultProcessing(HTTPAbstractImpl.java:244)\n    at org.apache.jmeter.protocol.http.sampler.HTTPJavaImpl.sample(HTTPJavaImpl.java:592)\n    at org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:62)\n    at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:999)\n    at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:985)\n    at org.apache.jmeter.threads.JMeterThread.process_sampler(JMeterThread.java:381)\n    at org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:274)\n    at java.lang.Thread.run(Thread.java:662)\n\nI checked trunk and code didn't change for the parsing of cache-control.\n\nIt is still in there as of svn rev 1166165 /jakarta/jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\n\nThe code does not split on commas at all.  The existing code will work if max-age happens to be the last cache directive, but as you can see in the repo case it is not.\n\nMultiple cache directives are part of the HTTP spec:\nhttp://stackoverflow.com/questions/4762377/cache-control-headers-repeated-valid-or-not-nginx"}, {"count": 1, "tags": [], "bug_id": 51932, "is_private": false, "text": "Thanks for the report.\n\nFixed in SVN:\n\nURL: http://svn.apache.org/viewvc?rev=1177871&view=rev\nLog:\nBug 51932 - CacheManager does not handle cache-control header with any attributes after max-age\n\nModified:\n   jakarta/jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/control/CacheManager.java\n   jakarta/jmeter/trunk/test/src/org/apache/jmeter/protocol/http/control/TestCacheManager.java\n   jakarta/jmeter/trunk/xdocs/changes.xml", "id": 149997, "time": "2011-09-30T22:45:35Z", "creator": "sebb@apache.org", "creation_time": "2011-09-30T22:45:35Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 50854, "text": "When running under a security manager, in 7.0.x (and also around 6.0.29+), the Sessions List options in the Tomcat Manager may display an error under certain conditions.\n\nCONDITION 1:\n\nAPR enabled, catalina.base == catalina.home:\n\n- Encountered exception org.apache.jasper.JasperException: javax.servlet.ServletException: java.lang.NoClassDefFoundError: org/apache/catalina/ha/session/DeltaSession\n\nThis permission is required:\n    permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.ha.*\";\n\nCONDITION 2:\n\nRegardless of APR, if catalina.base != catalina.home and catalina.home is the location of the webapps/manager application, this error displays:\n\nFAIL - Encountered exception org.apache.jasper.JasperException: An exception occurred processing JSP page /WEB-INF/jsp/sessionsList.jsp at line 99\n\n96: \t\t\t<tbody>\n97: <% Iterator iter = activeSessions.iterator();\n98:    while (iter.hasNext()) {\n99:    \tSession currentSession = (Session) iter.next();\n100:    \tString currentSessionId = JspHelper.escapeXml(currentSession.getId());\n101: %>\n102: \t\t\t\t<tr>\n\nThis is because the policy file assumes there is a per-instance webapps/manager application in catalina.base, as opposed to a shared one in catalina.home.\n\nSuggested fix, in catalina.policy, replace ...\n\n// The Manager application needs access to the following packages to support the\n// session display functionality\ngrant codeBase \"file:${catalina.base}/webapps/manager/-\" {\n    permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina\";\n    permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.manager\";\n    permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.manager.util\";\n    permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.ha.*\";\n};\n\n... with ...\n\n// The Manager application needs access to the following packages to support the\n// session display functionality\ngrant codeBase \"file:${catalina.home}/webapps/manager/-\" {\n    permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina\";\n    permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.manager\";\n    permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.manager.util\";\n    permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.ha.*\";\n};\n\n// If using a per instance webapps directory, i.e. ${catalina.base}/webapps,\n// then the following permission will need to be uncommented\n// grant codeBase \"file:${catalina.base}/webapps/manager/-\" {\n//     permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina\";\n//     permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.manager\";\n//     permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.manager.util\";\n//     permission java.lang.RuntimePermission \"accessClassInPackage.org.apache.catalina.ha.*\";\n// };\n\n* In the above, I've used the same commented-out approach as the one for the \"file:${catalina.base}/lib/-\" permissions for consistency, but the catalina.base permissions could also be left uncommented if most installations copy the default webapps folder into each instance and use it from there, to make larger deployments easier.\n\nBest Regards,\nNeale Rudd", "id": 144675, "time": "2011-03-02T10:06:46Z", "creator": "neale@metawerx.net", "creation_time": "2011-03-02T10:06:46Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 144854, "time": "2011-03-09T06:39:22Z", "bug_id": 50854, "creation_time": "2011-03-09T06:39:22Z", "is_private": false, "text": "Thanks for the report.\n\nThis has been fixed in trunk and will be included in 7.0.11 onwards."}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": 26758, "id": 144908, "time": "2011-03-10T07:16:26Z", "bug_id": 50854, "creation_time": "2011-03-10T07:16:26Z", "is_private": false, "text": "Created attachment 26758\nPatch for tc6.0.x\n\nIssue 1 can not occur in 6.0.x - the relevant changes were never pack-ported from 7.0.x\n\nPatch that covers issue 2 is attached and has been proposed for 6.0.x"}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 147099, "time": "2011-06-14T11:27:52Z", "bug_id": 50854, "creation_time": "2011-06-14T11:27:52Z", "is_private": false, "text": "Fixed in 6.0.x and will be included in 6.0.33 onwards."}]
[{"count": 0, "tags": [], "bug_id": 48325, "attachment_id": null, "text": "We have seen this error in logs from customer sites, which prevent getting the text out (HeaderFooter only has API for getLeft(), getCenter() and getRight(), and all three throw the exception:\n\nCaused by: java.lang.IllegalStateException: bad text 'Page &P of &N'.\n    at org.apache.poi.hssf.usermodel.HeaderFooter.splitParts(HeaderFooter.java:77)\n    at org.apache.poi.hssf.usermodel.HeaderFooter.getLeft(HeaderFooter.java:87)\n    at com.nuix.data.file.office.poi.PoiExcelFileReader$SheetReader.createNextReader(SourceFile:273)\n    at com.nuix.util.LazyCompositeReader.isReaderAvailable(SourceFile:93)\n    at com.nuix.util.LazyCompositeReader.read(SourceFile:40)\n    at com.nuix.util.LazyCompositeReader.read(SourceFile:42)\n    at com.nuix.data.util.CachingReaderFactory.readFully(SourceFile:201)\n    at com.nuix.data.util.CachingReaderFactory.createReader(SourceFile:104)\n    ... 14 more\n\nWe have seen the same thing with '&A' as well.\n\nThis is a regression from before 3.5 beta 6, when these methods used to silently return null instead.  However I'm not sure that returning null is correct either - what would make the most sense is to match the behaviour of Excel in this situation, which is presumably to treat all the text as if it's the left or the center (but which?)", "id": 132570, "time": "2009-12-01T19:41:07Z", "creator": "trejkaz@trypticon.org", "creation_time": "2009-12-01T19:41:07Z", "is_private": false}, {"count": 1, "tags": [], "creator": "trejkaz@trypticon.org", "text": "Created attachment 24668\nSample file\n\nSample file attached, was created using an XLS file output from POI but then mangling the footer to have the problem described.\n\nTest case would look something like this (though there is a small amount of our own utility method calls up the top):\n\n    @Test\n    public void testIllegalFooterText() throws Exception\n    {\n        HSSFWorkbook wb = loadWorkbook(getDataFile(\"office/illegal-footer-text.xls\"));\n        HSSFSheet sh = wb.getSheetAt(0);\n        HSSFFooter f = sh.getFooter();\n\n        // The legal form of the footer would have been \"&CBlahBlah Blah Blah  \" but something\n        // left the &C off.  In this case it was me and a hex editor.  In the cases we have seen\n        // in the wild it's probably some idiot who thought they knew how to add a footer but didn't.\n\n        assertEquals(\"Left text should be empty\", \"\", f.getLeft());\n        assertEquals(\"Right text should be empty\", \"\", f.getRight());\n        assertEquals(\"Center text should contain the illegal value\", \"BlahBlah blah blah  \", f.getCenter());\n    }", "id": 132615, "time": "2009-12-03T19:20:09Z", "bug_id": 48325, "creation_time": "2009-12-03T19:20:09Z", "is_private": false, "attachment_id": 24668}, {"attachment_id": 24669, "tags": [], "bug_id": 48325, "text": "Created attachment 24669\nProposed patch\n\nPatch which makes that test pass.", "count": 2, "id": 132616, "time": "2009-12-03T19:21:22Z", "creator": "trejkaz@trypticon.org", "creation_time": "2009-12-03T19:21:22Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 48325, "is_private": false, "count": 3, "id": 140014, "time": "2010-09-21T07:33:35Z", "creator": "apache@gagravarr.org", "creation_time": "2010-09-21T07:33:35Z", "text": "Thanks for the patch and test, applied in r999320."}]
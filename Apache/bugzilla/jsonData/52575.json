[{"count": 0, "tags": [], "bug_id": 52575, "attachment_id": 28248, "is_private": false, "id": 153349, "time": "2012-02-01T22:45:47Z", "creator": "cs.fra.community@sungard.com", "creation_time": "2012-02-01T22:45:47Z", "text": "Created attachment 28248\nignoreMissingWorkbooks.patch - Patch to implement this feature\n\nIn our project we have one XLS file referencing > 10 other XLS files.\nSetting up a workbook environment works as expected and a formular recalculation works.\n\nIn our project, we sometimes do not have all referenced XLS files but want to recalculate those values for which we have the referenced XLS files.\nFor those situations we are absolutly fine with the cached values which exists already in the main XLS.\n\nThis might be a quite dedicated setup: Therefore I introduced a system property to change the behavoir:\nThe old behavoir is to fail as before.\nSetting the property to true issues an INFO log message and continues with the cached value.\n\n\nCurrently I'm a little bit unhappy about the brute-force approach to get the cell type to access the cached value - but I didn't found another way to handle it.\n\n\nPlease let me know your thoughts - Feel free to take this patch as an insipration for a feature request and implement it in a more POI-standard way.\n\nI have not signed any kind of NDA from Microsoft and used only the public availible documentation about the XLS file format."}, {"count": 1, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "is_private": false, "id": 153391, "time": "2012-02-03T08:46:48Z", "bug_id": 52575, "creation_time": "2012-02-03T08:46:48Z", "text": "Thanks for the patch. There two things to do before check it in svn:\n\n1. It lacks a unit test(s). Can you write sample code that demonstrates that the code throws  WorkbookNotFoundException if IGNORE_MISSING_WORKBOOKS=false and uses cached formula values otherwise. If the test requires input workbooks then attached them along with the test.\n\n2. What about loading IGNORE_MISSING_WORKBOOKS from a poi.properties file? First lookup poi.properties in the classpath and then load default config bundled in the jar. \nMy concern is that in many environments users cannot change JVM system properties, for example, think of a web application that cannot change JVM settings of the server (Tomcat or whatever). With poi.properties, you can simply put in the classpath (WEB-INF/classes) and POI will initialize from it  -  pretty much like log4j searches its config file. \n\nRegards,\nYegor"}, {"count": 2, "tags": [], "bug_id": 52575, "is_private": false, "text": "Thanks for the feedback Yegor.\n\nProviding a test with workbook is quite simple.\n\nRE 2.: I tried to keep the impact as low as possible.\nIs there some poi.properties infrastructure? I didn't noticed something like this.", "id": 153400, "time": "2012-02-03T11:50:48Z", "creator": "cs.fra.community@sungard.com", "creation_time": "2012-02-03T11:50:48Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "(In reply to comment #2)\n> Thanks for the feedback Yegor.\n> \n> Providing a test with workbook is quite simple.\n> \n> RE 2.: I tried to keep the impact as low as possible.\n> Is there some poi.properties infrastructure? I didn't noticed something like\n> this.\n\nNo, for now poi.properties exists only in my dreams :)\n\nYegor", "attachment_id": null, "bug_id": 52575, "id": 153401, "time": "2012-02-03T11:54:55Z", "creator": "yegor@dinom.ru", "creation_time": "2012-02-03T11:54:55Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 52575, "is_private": false, "text": "On the settings thing, might it be worth copying what ExtractorFactory does for the usermodel vs event streaming setting?", "id": 153402, "time": "2012-02-03T12:13:56Z", "creator": "apache@gagravarr.org", "creation_time": "2012-02-03T12:13:56Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "cs.fra.community@sungard.com", "attachment_id": 28271, "id": 153481, "time": "2012-02-05T22:48:58Z", "bug_id": 52575, "creation_time": "2012-02-05T22:48:58Z", "is_private": false, "text": "Created attachment 28271\nIgnoreWorkbooks with Testcases\n\nAttached a new patch containing the original one (with some simplifications) and testcases.\nThe attached XLS are also required for the testcase execution.\n\nI would like to keep track of the \"configuration infrastructure\" in a different ticket.\nI will post a patch within another bug."}, {"count": 6, "tags": [], "bug_id": 52575, "is_private": false, "text": "Created attachment 28272\nZIP of the XLS (2003) sheets to execute the testcases", "id": 153482, "time": "2012-02-05T22:51:03Z", "creator": "cs.fra.community@sungard.com", "creation_time": "2012-02-05T22:51:03Z", "attachment_id": 28272}, {"text": "Applied in r1240903 with minor tweaks:\n - you forgot to implement getCachedFormulaResultType() in ForkedEvaluationCell\n - I changed the unit test to utilize POI infrastructure to read test files: instead of direct reading from FileInputStream it is recommended to use HSSFTestDataSamples.openSampleWorkbook (filename)\n - added a prefix to the test files and put them in ./test-data/spreadsheet. I would like to keep all spreadsheet samples in the same directory and avoid extra sub-folders. \n\nRegards,\nYegor\n\n(In reply to comment #4)\n> On the settings thing, might it be worth copying what ExtractorFactory does for\n> the usermodel vs event streaming setting?\n\n(In reply to comment #6)\n> Created attachment 28272 [details]\n> ZIP of the XLS (2003) sheets to execute the testcases", "tags": [], "bug_id": 52575, "attachment_id": null, "count": 7, "id": 153492, "time": "2012-02-06T07:49:42Z", "creator": "yegor@dinom.ru", "creation_time": "2012-02-06T07:49:42Z", "is_private": false}, {"count": 8, "tags": [], "text": "I think that the simplest (and the best) solution would be to add a setter for this property right in the formula evaluator. The client code would look as follows:\n\nFormulaEvaluator ev = workbook.getCreationHelper().createFormulaEvaluator();\nev.setIgnoreMissingWorkbooks(true);\n\nThis way this setting can be changed in a very flexible way. \n\nYegor\n\n(In reply to comment #4)\n> On the settings thing, might it be worth copying what ExtractorFactory does for\n> the usermodel vs event streaming setting?", "attachment_id": null, "id": 153493, "creator": "yegor@dinom.ru", "time": "2012-02-06T07:59:09Z", "bug_id": 52575, "creation_time": "2012-02-06T07:59:09Z", "is_private": false}, {"count": 9, "tags": [], "creator": "yegor@dinom.ru", "attachment_id": null, "id": 153528, "time": "2012-02-07T08:10:28Z", "bug_id": 52575, "creation_time": "2012-02-07T08:10:28Z", "is_private": false, "text": "I removed configuring IGNORE_MISSING_WORKBOOKS from a system property and added a public setter HSSFFormulaEvaluator.setIgnoreMissingWorkbooks(boolean ignore).\n\nClient code:\n\nHSSFFormulaEvaluator evaluator = workbook.getCreationHelper().createFormulaEvaluator();\nevaluator.setIgnoreMissingWorkbooks(true); \n\nFor now setIgnoreMissingWorkbooks is in HSSF only because evaluation across multiple workbooks is not yet implemented in XSSF. \n\nYegor"}, {"count": 10, "tags": [], "text": "(In reply to comment #9)\n> I removed configuring IGNORE_MISSING_WORKBOOKS from a system property and added\n> a public setter HSSFFormulaEvaluator.setIgnoreMissingWorkbooks(boolean ignore).\nOk, this makes my patch submission unnecessary. \nThanks :)", "is_private": false, "id": 153529, "creator": "cs.fra.community@sungard.com", "time": "2012-02-07T08:24:29Z", "bug_id": 52575, "creation_time": "2012-02-07T08:24:29Z", "attachment_id": null}]
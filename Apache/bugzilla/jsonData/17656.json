[{"count": 0, "attachment_id": null, "bug_id": 17656, "text": "Overview Description:\n\n    Use of the common scheme and secure attributes in Connector server.xml\n    configuration for CoyoteConnector HTTP/1.1 is ignored in the released\n    4.1.18 build. This used to work as expected in 4.1.10, (see below).\n\n    Our hosting architecture employs external SSL acceleration hardware in\n    front of standalone Tomcat servers and needs to pass scheme and secure\n    information to our webapps. To do this, we specify the following in\n    the server.xml file:\n\n    <Connector className=\"org.apache.coyote.tomcat4.CoyoteConnector\"\n               port=\"8543\" minProcessors=\"8\" maxProcessors=\"128\"\n               enableLookups=\"false\" acceptCount=\"64\" debug=\"0\"\n               connectionTimeout=\"300000\" scheme=\"https\" secure=\"true\"\n               useURIValidationHack=\"false\" disableUploadTimeout=\"true\"/>\n\n    The specification of \"https\" and \"true\" no longer is effective in\n    setting the standard Servlet 2.3 ServletRequest.getScheme() and\n    ServletRequest.isSecure() return values. Instead, \"http\" and false are\n    always returned, respectively.\n\n    Because the static Connector configuration information is no longer\n    propagated to our web application servlets, our application fails to\n    run properly.\n\nSteps to Reproduce:\n\n    1. configure Tomcat 4.1.18 to use standalone CoyoteConnector.\n    2. specify Connector scheme attribute as something other than \"http\"\n       and/or set secure attribute to \"false\".\n    3. access the standard request getScheme() and/or isSecure() methods in\n       a servlet registered to the Connector.\n\nActual Results:\n\n    ServletRequest.getScheme() will return \"http\" and\n    ServletRequest.isSecure() will return false when accessed from the\n    servlet.\n\nExpected Results:\n\n    ServletRequest.getScheme() and ServletRequest.isSecure() should reflect\n    what is specified in the Connector configuration.\n\nAdditional Information:\n\n    It appears that this problem was introduced in 4.1.13 while making the\n    following change to\n    coyote/src/java/org/apache/coyote/tomcat4/CoyoteAdapter.java and other\n    files:\n\n    -----------------------\n    revision 1.10\n    date: 2002/09/29 17:07:44;  author: nacho;  state: Exp;  lines: +9 -14\n    Bug#12998 HTTPS gets changed to HTTP://servername:443\n    Reported by marcus.kellermann at bentley.com\n\n    The processor (HTTP11 or ajp13) should set the scheme and port prior\n    to this point, in an ajp13 connection doesnt make sense to get the\n    secure flag from the connector secure flag.\n    -----------------------\n\n    In prior versions of this file, settings for the request scheme was\n    always copied from the Connector/CoyoteConnector configuration. With\n    this change, the Processor is now responsible for setting the request\n    information correctly. In our case, the Http11Processor cannot know\n    about the external hardware and fails to upgrade the logical connection\n    to https/secure.", "id": 32438, "time": "2003-03-05T06:27:55Z", "creator": "rwatler@finali.com", "creation_time": "2003-03-05T06:27:55Z", "tags": [], "is_private": false}, {"count": 1, "text": "Created attachment 5173\nproposed patch, (tested on 4.1.18 ported forward)", "bug_id": 17656, "attachment_id": 5173, "id": 32518, "time": "2003-03-06T00:17:50Z", "creator": "rwatler@finali.com", "creation_time": "2003-03-06T00:17:50Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 17656, "text": "Patch applied.  Thanks Much.", "id": 33652, "time": "2003-03-23T09:07:33Z", "creator": "william.barker@wilshire.com", "creation_time": "2003-03-23T09:07:33Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "id": 34550, "time": "2003-04-04T18:35:08Z", "bug_id": 17656, "creation_time": "2003-04-04T18:35:08Z", "is_private": false, "text": "*** Bug 18706 has been marked as a duplicate of this bug. ***"}, {"count": 4, "tags": [], "bug_id": 17656, "attachment_id": null, "text": "*** Bug 20919 has been marked as a duplicate of this bug. ***", "id": 39114, "time": "2003-06-19T20:09:28Z", "creator": "william.barker@wilshire.com", "creation_time": "2003-06-19T20:09:28Z", "is_private": false}, {"count": 5, "tags": [], "creator": "der.kleine.bruder@gmx.de", "text": "Maybe I misunderstood the comments, but it seems that the bug is still\ncontained in version 4.1.24.\n\n", "id": 41142, "time": "2003-07-22T09:44:32Z", "bug_id": 17656, "creation_time": "2003-07-22T09:44:32Z", "is_private": false, "attachment_id": null}]
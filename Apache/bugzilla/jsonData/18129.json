[{"count": 0, "attachment_id": null, "creator": "mcsherry@qualcomm.com", "text": "Noticed this when I updated from 1.5.1 to 1.5.2.  I narrowed the problem a \nbit...  Under JVM 1.2, it doesn't hang. However, it does NOT set the lock \nto 'locked' when using the -verbose switch on the command line.  Drop the '-\nverbose' option and it works as expected w/ JVM 1.2.\n\nUsing 1.5.2 w/ JVM 1.3, I consistently get hangs when the task attempts to set \nthe label status to 'locked'.  I see that there are 13 child processes spawned \nat this point.  Using the P4 command line, I can verify that all of the files \nwere added to the label.  The task never terminates (at least not after \nseveral minutes of waiting).  If I do NOT attempt to set the label status \nto 'locked', the task works fine.\n\nThanks,\nMike", "id": 33392, "time": "2003-03-19T01:25:15Z", "bug_id": 18129, "creation_time": "2003-03-19T01:25:15Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 5414\nfixes the problem of locking in verbose mode", "is_private": false, "bug_id": 18129, "id": 33401, "time": "2003-03-19T08:19:42Z", "creator": "levylambert@tiscali-dsl.de", "creation_time": "2003-03-19T08:19:42Z", "attachment_id": 5414}, {"count": 2, "attachment_id": null, "creator": "levylambert@tiscali-dsl.de", "text": "I have tried to reproduce your bug in the following environment :\nant 1.5.2 + Win2K + Perforce P4/NTX86/2000.2/19837 (2001/01/03).\nI have tried with JDK 1.3.0_02 and with J2SDK1.4.1_01. Perforce never hangs for \nme. \nMy understanding is that Perforce tasks are executed through the Execute.java \nclass. The blocking command in Execute.java is        waitFor(process); in line \n455 of Execute.java.\nOne difference in Perforce between ant1.5.1 and ant 1.5.2 is the class \nP4HandlerAdapter. \nsee http://issues.apache.org/bugzilla/show_bug.cgi?id=16544\nI submitted a patch for this class because Perforce was hanging on Win2k when \nPerforce would only produce output on stderr. I hope that this patch is not \ncausing problems on Linux. \n\n\n\nI reproduced the fact that in verbose mode the label does not get locked.\nI also found a fix for this problem (see attached file above)", "id": 33408, "time": "2003-03-19T08:46:51Z", "bug_id": 18129, "creation_time": "2003-03-19T08:46:51Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "creator": "mcsherry@qualcomm.com", "text": "Antoine: I confirmed that your P4HandlerAdapter fix works properly under WinXP \nusing JVM 1.3.  I performed the same tests on Solaris 2.8 using JVM 1.3 and \n1.4 -- it works there as well.  Appears this is isolated to my Linux platform \nusing JVM 1.3.1_07-b02 or JVM 1.4.0_02-b02.\n\nAnother possibility exists -- the P4 client is 2002.2, but the server is \n2002.1.  They're upgrading the server this weekend, so I can investigate that \npossibility next week.  Maybe there's some strange external behavior causing \nthis issue.", "id": 33474, "time": "2003-03-19T17:36:25Z", "bug_id": 18129, "creation_time": "2003-03-19T17:36:25Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 18129, "text": "Could you try the patch of P4Label.java which I have attached to be able to run \nyour build in verbose mode with JDK 1.3 ? Or would you like me to email you \nan \"optional.jar\" ?\n\nMaybe the patch could fix your problem. I do not know exactly what is \nhappening, but the label spec read with p4 label -o is somewhat corrupted by \nlogging. My patch simply does the logging of the label spec after it gets \ncopied to a string buffer, rather than before.\n\nThe difference in version of Perforce client and server is not a likely \ncandidate as a cause of your problem. Perforce does not seem to have stringent \nrequirements concerning the matching of client and server. Furthermore, your \nbuild works fine under JDK 1.2, with the same combination of P4 client and \nserver.\n\nThis leaves two main suspects : the JDK (bug in JDK 1.3 and 1.4 on Linux ???) \nand ant, specifically P4Label.java and the code of P4Base.java, \nP4HandlerAdapter.java, Execute.java which run Perforce for us.\n", "id": 33477, "time": "2003-03-19T18:01:01Z", "creator": "levylambert@tiscali-dsl.de", "creation_time": "2003-03-19T18:01:01Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 18129, "text": "might be related to http://nagoya.apache.org/bugzilla/show_bug.cgi?id=18956\nI have fixed P4HandlerAdapter.java because of this bug report.\nCan you try to download a nightly build and see if it fixes your problem.", "id": 35451, "time": "2003-04-17T17:21:43Z", "creator": "levylambert@tiscali-dsl.de", "creation_time": "2003-04-17T17:21:43Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "Antoine,\n\nThe fix made in the 1.6alpha nightly build works.  Thanks!\n\nRegards,\nMike", "is_private": false, "bug_id": 18129, "id": 35572, "time": "2003-04-18T17:44:33Z", "creator": "mcsherry@qualcomm.com", "creation_time": "2003-04-18T17:44:33Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "cwang@kenwoodusa.com", "text": "Running httpd-2.2.0-1 on CentOS 4.3 (rebuilt source rpm package).  Found a bug\nwith mod_proxy_balancer module where it does not treat a URL the same as\nmod_proxy module would.\n\nUsing Apache as a reverse proxy with mod_proxy module passing this directive to\na single backend server works just fine:\n\nProxyPass /KenwoodAccess/ http://172.20.111.33:80/KenwoodAccess/\n\nThis next example is a WORKING configuration for mod_proxy_balancer. No errors\nare generated in Apache and passes to the backend servers:\n\nProxyPass /KenwoodAccess balancer://KWA_cluster lbmethod=byrequests\nstickysession=JSESSIONID nofailover=off\n<Proxy balancer://KWA_cluster>\n        BalancerMember http://172.20.111.33:80/KenwoodAccess smax=15 loadfactor=1\n        BalancerMember http://172.20.111.34:80/KenwoodAccess smax=15 loadfactor=1\n        #BalancerMember http://test.kenwoodaccess.com/noworkers.html smax=15\nloadfactor=80\n</Proxy>\n\nWhere the bug happens:\n\nProxyPass /KenwoodAccess/ balancer://KWA_cluster lbmethod=byrequests\n*NOTE: The trailing slash in the first option.\n\nThis will generate an error message in Apache logs:\n\n[Mon Apr 03 17:04:55 2006] [warn] proxy: No protocol handler was valid for the\nURL /site/images/buts/forgotpassword.gif. If you are using a DSO version of\nmod_proxy, make sure the proxy submodules are included in the configuration\nusing LoadModule.\n\nThis error message seems to be misleading when passing options using the\ntrailing slash.  How I am interpreting it is mod_proxy_balancer doesn't want to\ncall on other mod_proxy submodules properly.\n\nGoogling shows that people resolved this Apache error message by adding\n'LoadModule' for the submodules of mod_proxy (ie: mod_proxy_connect,\nmod_proxy_http, etc.).  This is not the case with me, since Apache shows these\nsubmodules as loaded:\n\nhttpd -M\n proxy_module (shared)\n proxy_connect_module (shared)\n proxy_ftp_module (shared)\n proxy_http_module (shared)\n proxy_ajp_module (shared)\n proxy_balancer_module (shared)\n\nThis has been troubleshooted down to trailing slashes as the culprit for\nmod_proxy_balancer and mod_proxy Proxypass directive works just fine with\ntrailing slashes.", "id": 87572, "time": "2006-04-04T18:12:14Z", "bug_id": 39203, "creation_time": "2006-04-04T18:12:14Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 87577, "time": "2006-04-04T21:17:14Z", "bug_id": 39203, "creation_time": "2006-04-04T21:17:14Z", "is_private": false, "text": "\n\n> ProxyPass /KenwoodAccess/ http://172.20.111.33:80/KenwoodAccess/\n\nand\n\n> ProxyPass /KenwoodAccess/ balancer://KWA_cluster lbmethod=byrequests\n\nare different cases. In the first case you have a trailing slash at both ends in\nthe second case you do not have this.\n\n\n> This will generate an error message in Apache logs:\n> \n> [Mon Apr 03 17:04:55 2006] [warn] proxy: No protocol handler was valid for the\n> URL /site/images/buts/forgotpassword.gif. If you are using a DSO version of\n> mod_proxy, make sure the proxy submodules are included in the configuration\n> using LoadModule.\n\nPlease specify the request that leads to this error message.\n\nPlease set also the LogLevel to debug and attach the output of your error_log file."}, {"count": 2, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 87580, "time": "2006-04-04T22:11:53Z", "bug_id": 39203, "creation_time": "2006-04-04T22:11:53Z", "is_private": false, "text": "*** Bug 39206 has been marked as a duplicate of this bug. ***"}, {"count": 3, "tags": [], "bug_id": 39203, "attachment_id": null, "text": "I had the same issue, and this does not necessarily mean that is not a bug but I\nhave at least discovered a workaround.\n\nIn my case, within a certain Virtual Host I pass all requests to the Load\nBalancer. This received the same errors when configured as follows:\n\nProxyPass / balancer://cluster nofailover=On\nProxyPassReverse / balancer://cluster\n<Proxy balancer://cluster>\n  BalancerMember ajp://10.0.1.102:8009\n  BalancerMember ajp://10.0.1.103:8009\n</Proxy>\n\nBut works if the configuration is changed to this:\n\nProxyPass / balancer://cluster/ nofailover=On\nProxyPassReverse / balancer://cluster/\n<Proxy balancer://cluster/>\n  BalancerMember ajp://10.0.1.102:8009/\n  BalancerMember ajp://10.0.1.103:8009/\n</Proxy>\n", "id": 89273, "time": "2006-05-18T22:12:17Z", "creator": "takezo@gmail.com", "creation_time": "2006-05-18T22:12:17Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 39203, "attachment_id": null, "text": "I agree that the error message is misleading, but this problem is not limited to\nmod_proxy_balancer and the balancer scheme but also occurs with\n\nProxyPass / http://www.somewhere.com\n\n(it must be ProxyPass / http://www.somewhere.com/)\n\nSo the problem is really a misconfiguration on the user side that I mark as a\nWONTFIX.", "id": 89475, "time": "2006-05-25T12:30:45Z", "creator": "rpluem@apache.org", "creation_time": "2006-05-25T12:30:45Z", "is_private": false}, {"count": 5, "tags": [], "creator": "bobsiegen@googlemail.com", "text": "(In reply to comment #4)\n> ProxyPass / http://www.somewhere.com\n> \n> (it must be ProxyPass / http://www.somewhere.com/)\n> \n> So the problem is really a misconfiguration on the user side that I mark as a\n> WONTFIX.\n\nMay be the manual should be updated, too, because three or four examples\nprovided under the ProxyPass directive are using such invalid syntax.", "id": 89478, "time": "2006-05-25T12:53:54Z", "bug_id": 39203, "creation_time": "2006-05-25T12:53:54Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 39203, "attachment_id": null, "text": "(In reply to comment #5)\n> \n> May be the manual should be updated, too, because three or four examples\n> provided under the ProxyPass directive are using such invalid syntax.\n\nOk, agreed, but strictly speaking only the balancer example is wrong. \n\nProxyPass /example http://backend.example.com\n\nis correct again. The basic rule for this is:\n\nIf the left side of ProxyPass ends with a / the right side must also end with a\n/. If the right side of ProxyPass ends with a / but the left side does not this\nwill cause // in the URL send to the backend which usually does not harm, but to\nplay safe both sides really should end in the same manner. Maybe an idea for a\nsanity check that issues a warning to the error log during the configuration\nparsing of the ProxyPass directives if this is not the case.", "id": 89484, "time": "2006-05-25T13:23:17Z", "creator": "rpluem@apache.org", "creation_time": "2006-05-25T13:23:17Z", "is_private": false}, {"count": 7, "tags": [], "creator": "rpluem@apache.org", "text": "I have added a note to the documentation regarding trailing slashes: r409455\n(http://svn.apache.org/viewvc?rev=409455&view=rev)", "id": 89499, "time": "2006-05-25T20:15:51Z", "bug_id": 39203, "creation_time": "2006-05-25T20:15:51Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 39203, "attachment_id": null, "text": "backported to 2.2\n<http://svn.apache.org/viewvc?rev=663989&view=rev>", "id": 117438, "time": "2008-06-06T08:54:07Z", "creator": "takashi.asfbugzilla@tks.st", "creation_time": "2008-06-06T08:54:07Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 39203, "attachment_id": null, "text": "I think this is still a problem, because you cannot achieve the same behavior using the balancer as you can without using it:\n\nNot using balancer\n\n    ProxyPass /MyService http://example.com:20000/MyService                        \n    ProxyPassReverse /MyService http://example.com:20000/MyService\n\nthis sends a request for /MyService?wsdl to http://example.com:2000/MyService?wsdl\n\nUsing the balancer\n\n    ProxyPass /MyService balancer://playlist_service_balancer\n\n    <Proxy balancer://playlist_service_balancer>\n      BalancerMember http://example.com:10000/MyService\n      BalancerMember http://example.com:20000/MyService\n\n      ProxySet lbmethod=byrequests\n    </Proxy>\n\nThere are no trailing slashing at all, yet this sends a request for /MyService?wsdl to http://example.com:2000/MyService/, forcing a trailing slash.", "id": 119230, "time": "2008-08-01T10:29:46Z", "creator": "nick.stielau@gmail.com", "creation_time": "2008-08-01T10:29:46Z", "is_private": false}, {"count": 10, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 119233, "time": "2008-08-01T13:36:44Z", "bug_id": 39203, "creation_time": "2008-08-01T13:36:44Z", "is_private": false, "text": "Try using\n\nProxyPass /MyService balancer://playlist_service_balancer/MyService\n\n    <Proxy balancer://playlist_service_balancer>\n      BalancerMember http://example.com:10000/\n      BalancerMember http://example.com:20000/\n\n      ProxySet lbmethod=byrequests\n    </Proxy>"}]
[{"count": 0, "tags": [], "bug_id": 37790, "attachment_id": null, "id": 83232, "time": "2005-12-05T16:25:18Z", "creator": "nick@webthing.com", "creation_time": "2005-12-05T16:25:18Z", "is_private": false, "text": "The following code was sent to me as a test case.  It blocks for a long time!  \n  \nint test(request_rec *r) {  \n        ap_log_error(APLOG_MARK, APLOG_NOTICE | APLOG_NOERRNO, 0, r->server,  \n\"Return an error\");  \n        return HTTP_FORBIDDEN;  \n}  \nstatic void register_hooks(apr_pool_t *p)  \n{  \n    ap_hook_post_read_request(test, NULL, NULL, APR_HOOK_MIDDLE);  \n}  \n \nWhen run, it blocks in ap_discard_request_body, called from ap_die. \n \nThe bug seems to be that it's trying to read input before attaching the \nHTTP_IN filter.  The patch attached fixes it, though I'm not sure it's \noptimal."}, {"count": 1, "tags": [], "creator": "nick@webthing.com", "attachment_id": 17151, "text": "Created attachment 17151\nPatch\n\nAttach HTTP input filter before discarding request body.", "id": 83233, "time": "2005-12-05T16:27:17Z", "bug_id": 37790, "creation_time": "2005-12-05T16:27:17Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 37790, "attachment_id": null, "is_private": false, "id": 83637, "time": "2005-12-14T11:07:57Z", "creator": "nick@webthing.com", "creation_time": "2005-12-14T11:07:57Z", "text": "Fixed  r356764 "}]
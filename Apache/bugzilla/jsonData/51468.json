[{"count": 0, "tags": [], "text": "Hi, I've got Jens' code ( see https://issues.apache.org/bugzilla/show_bug.cgi?id=14766 ) completed and working. My implementation uses Java regex for matching the URLs to redirect and regex capturing groups for substitutions into redirection URLs.\n\nThis sort of functionality looks quite demanded, and googling shows several in-house implementations of Redirect Valves existing out there...\n\nIs my implementation of any interest to the project? If yes, what are my next steps?", "attachment_id": null, "bug_id": 51468, "id": 147712, "time": "2011-07-03T20:42:33Z", "creator": "ushakov@int.com.ru", "creation_time": "2011-07-03T20:42:33Z", "is_private": false}, {"count": 1, "attachment_id": null, "creator": "bugzilla@pidster.com", "text": "Create a patch and attach it to the bug, if someone takes an interest in it, it might get committed.", "id": 147713, "time": "2011-07-03T21:38:59Z", "bug_id": 51468, "creation_time": "2011-07-03T21:38:59Z", "tags": [], "is_private": false}, {"count": 2, "attachment_id": 27246, "creator": "ushakov@int.com.ru", "is_private": false, "id": 147714, "time": "2011-07-04T03:24:28Z", "bug_id": 51468, "creation_time": "2011-07-04T03:24:28Z", "tags": [], "text": "Created attachment 27246\nA proposed implementation for a Redirect valve\n\nThe main code of the proposed valve implementation."}, {"count": 3, "attachment_id": 27247, "creator": "ushakov@int.com.ru", "text": "Created attachment 27247\nThe .properties file in English", "id": 147715, "time": "2011-07-04T03:25:36Z", "bug_id": 51468, "creation_time": "2011-07-04T03:25:36Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "ushakov@int.com.ru", "attachment_id": 27248, "is_private": false, "id": 147716, "time": "2011-07-04T03:26:16Z", "bug_id": 51468, "creation_time": "2011-07-04T03:26:16Z", "text": "Created attachment 27248\nThe .properties file in Russian"}, {"count": 5, "tags": [], "creator": "ushakov@int.com.ru", "attachment_id": 27247, "is_private": false, "id": 147717, "time": "2011-07-04T03:27:09Z", "bug_id": 51468, "creation_time": "2011-07-04T03:27:09Z", "text": "Comment on attachment 27247\nThe .properties file in English\n\nTo be merged with the corresponding properties file in the existing package."}, {"count": 6, "tags": [], "bug_id": 51468, "text": "A few questions:\n\n1. Why a Valve and not a Filter?\n2. Why not use urlrewrite like everyone else?", "id": 147757, "time": "2011-07-05T14:45:04Z", "creator": "chris@christopherschultz.net", "creation_time": "2011-07-05T14:45:04Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "ushakov@int.com.ru", "attachment_id": null, "is_private": false, "id": 147780, "time": "2011-07-05T20:54:22Z", "bug_id": 51468, "creation_time": "2011-07-05T20:54:22Z", "text": "(In reply to comment #6)\n\nWell, there is nothing wrong about UrlRewriteFilter except it is a filter :)  It looks perfect and mature, but it is good for webapp-level tasks rather than container-level tasks.\n\nA filter being a part of a webapp belongs to the responsibility of a developer, while there may be quite a variety of redirection tasks that belong to the administration domain. So one of the motivations for a valve is separation of responsibilities of a developer and an administrator.\n\nAnother motivation is that there may be quite a lot of various redirection tasks common for different webapps at a server, which might be better taken care of in a centralized manner with a valve...\n\nRegards,\nSergey"}, {"count": 8, "attachment_id": null, "creator": "chris@christopherschultz.net", "is_private": false, "id": 147781, "time": "2011-07-05T21:50:20Z", "bug_id": 51468, "creation_time": "2011-07-05T21:50:20Z", "tags": [], "text": "(In reply to comment #7)\n> Well, there is nothing wrong about UrlRewriteFilter except it is a filter :) \n> It looks perfect and mature, but it is good for webapp-level tasks rather than\n> container-level tasks.\n\nTomcat 7 can use Filters at the container level. Configure them just as you configure Valves, except that you use <Filter> instead of <Valve>."}, {"count": 9, "tags": [], "text": "(In reply to comment #8)\n> Tomcat 7 can use Filters at the container level. Configure them just as you\n> configure Valves, except that you use <Filter> instead of <Valve>.\n\nWhere did that come from? It is news to me.\n\nFilters can be defined in the global web.xml, the host level web.xml or an app's web.xml (although you do get one instance per application).\n\nI am struggling to see the benefit of this Valve compared to the urlrewrite, particularly given the features that urlrewrite has compared to this patch.", "is_private": false, "bug_id": 51468, "id": 147782, "time": "2011-07-05T21:54:52Z", "creator": "markt@apache.org", "creation_time": "2011-07-05T21:54:52Z", "attachment_id": null}, {"count": 10, "attachment_id": null, "creator": "chris@christopherschultz.net", "is_private": false, "id": 147784, "time": "2011-07-05T22:33:53Z", "bug_id": 51468, "creation_time": "2011-07-05T22:33:53Z", "tags": [], "text": "(In reply to comment #9)\n> (In reply to comment #8)\n> > Tomcat 7 can use Filters at the container level. Configure them just as you\n> > configure Valves, except that you use <Filter> instead of <Valve>.\n> \n> Where did that come from? It is news to me.\n\nI thought filters could be configured in <Context> elements in META-INF/context.xml, hence the (slight) push to re-write Valves as Filters so they would be more portable.\n\n> I am struggling to see the benefit of this Valve compared to the urlrewrite,\n> particularly given the features that urlrewrite has compared to this patch.\n\nI completely agree.\n\nI'm sure it would be useful for /some/ people to incorporate all kinds of things from other projects into Tomcat, but it's not really appropriate if they already exist, are well-known, and well-supported."}, {"count": 11, "tags": [], "bug_id": 51468, "text": "(In reply to comment #9)\n> I am struggling to see the benefit of this Valve compared to the urlrewrite,\n> particularly given the features that urlrewrite has compared to this patch.\n\nWell, let's consider a task of mapping/redirecting a Tomcat app to a virtual directory at a front-end server.\n\nTo start with, it is an administrative task, not a developer's one, so the app's WEB-INF does not look the right place to set it up. The server admin is not likely to be happy tinkering with the war file or the unpacked folder every time the developer issues a new version of the app.\n\nThe next place to consider for a filter is the the global web.xml or host-level web.xml. This is likely to do the job, but the fact that the appropriate filter is going to be instantiated in multiple useless copies for every app, makes the whole construct strange-looking too.\n\nSo a valve looks the most straightforward approach to do the job...\n\n(In reply to comment #10)\n> I'm sure it would be useful for /some/ people to incorporate all kinds of\n> things from other projects into Tomcat, but it's not really appropriate if they\n> already exist, are well-known, and well-supported.\n\nWell, to my mind it's not incorporating existing functionality from other projects into Tomcat, but rather adding something new and missing. This first implementation maybe does not look great, but it may eventually get more flesh, as new requirements get outlined by the practice...", "id": 147788, "time": "2011-07-06T04:41:47Z", "creator": "ushakov@int.com.ru", "creation_time": "2011-07-06T04:41:47Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 51468, "text": "Just one more word regarding reluctance to incorporate existing mature functionality into Tomcat.\n\nI would personally be happy to use UrlRewrite for the mentioned tasks if this filter gets the Valve interface implemented one day... Or maybe gets a wrapper to implement the Valve interface...\n\nBut can we expect this? There may be a potential obstacle on that way that Filter is a standard and container-independent concept, while Valve is specific for Tomcat...", "id": 147804, "time": "2011-07-06T22:31:04Z", "creator": "ushakov@int.com.ru", "creation_time": "2011-07-06T22:31:04Z", "is_private": false, "attachment_id": null}, {"count": 13, "attachment_id": null, "creator": "chris@christopherschultz.net", "is_private": false, "id": 147805, "time": "2011-07-07T03:28:22Z", "bug_id": 51468, "creation_time": "2011-07-07T03:28:22Z", "tags": [], "text": "(In reply to comment #12)\n> Just one more word regarding reluctance to incorporate existing mature\n> functionality into Tomcat.\n> \n> I would personally be happy to use UrlRewrite for the mentioned tasks if this\n> filter gets the Valve interface implemented one day... Or maybe gets a wrapper\n> to implement the Valve interface...\n\nI'd honestly be happy if my earlier assertion that <Filter> could be used in place of a <Valve> were true. I'll look into what that would take to accomplish. Maybe a Valve implementation wrapper around the Filter interface.\n\nThat shouldn't actually be that hard, honestly. I'll look into it.\n\nLet's move this discussion onto the dev list and out of BZ."}]
[{"count": 0, "tags": [], "creator": "poelman@traffic4u.nl", "attachment_id": null, "id": 132618, "time": "2009-12-04T00:11:23Z", "bug_id": 48338, "creation_time": "2009-12-04T00:11:23Z", "is_private": false, "text": "After filling a sheet with data I try to invoke the sheets autoSizeColumn method on a certain column but get \"IllegalArgumentException: Invalid substring range\".\n\n------------------------------------\nStackTrace:\n------------------------------------\njava.lang.IllegalArgumentException: Invalid substring range\n at java.text.AttributedString.addAttribute(AttributedString.java:332)\n at org.apache.poi.xssf.usermodel.helpers.ColumnHelper.copyAttributes(ColumnHelper.java:447)\n\tat org.apache.poi.xssf.usermodel.helpers.ColumnHelper.getColumnWidth(ColumnHelper.java:369)\n\tat org.apache.poi.xssf.usermodel.XSSFSheet.autoSizeColumn(XSSFSheet.java:307)\n\tat org.apache.poi.xssf.usermodel.XSSFSheet.autoSizeColumn(XSSFSheet.java:290)\n\tat [object where sheet.autoSizeColumn([columnIndex]) is called]\n------------------------------------\n\nAfter testing different columns I came to the conclusion this only happens on that specific column, even unfilled columns can be autosized. I searched for the reason inside the cells of that column and discovered this happens only in a specific situation. If the cell is filled with a RichTextString created with an empty String and a Font (or XSSFFont) applied the column with this cell in it can't be autosized. Example:\n\n********** Code **********\nXSSFWorkbook wb = new XSSFWorkbook();\nXSSFSheet sheet = new wb.createSheet(\"Test\");\nCreationHelper ch = wb.getCreationHelper();\n\nXSSFRow row = sheet.createRow(0);\nXSSFCell cell = row.createCell(0);\n\nXSSFFont font = wb.createFont();\nRichTextString rts = ch.createRichtTextString(\"\");\nrts.applyFont(font);\ncell.setCellValue(rts);\n**************************\n\nThe code above does not work unless I invoke ch.createRichtextString(x) where x is a non empty String. So my fix atm is: ch.createRichTextString(s.isEmpty()? \"\" : s); where s is the String."}, {"count": 1, "tags": [], "creator": "yegor@dinom.ru", "text": "Fixed in r887160\n\nYegor", "id": 132620, "time": "2009-12-04T03:24:54Z", "bug_id": 48338, "creation_time": "2009-12-04T03:24:54Z", "is_private": false, "attachment_id": null}]
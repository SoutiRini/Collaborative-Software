[{"count": 0, "tags": [], "creator": "hmacias@ubiquitysoftware.com", "text": "When dealing with duplicated zipentries, Zip checks modification times before\noverwriting the zipentry. If you specify duplicate=\"add\", zipentries will be\noverwriten only if the present zipentry is older than the one you're trying to add.\n\nIn some situations it would be nice to override this behaviour and force zip to\noverwrite zipentries even if the file you're adding is older than the zipentry\nin the zip file.\n\nThe following patch should do the trick (please shout if there is a better way\nof submitting patch suggestions):\n\nIndex: src/main/org/apache/tools/ant/taskdefs/Zip.java\n\n===================================================================\n\n--- src/main/org/apache/tools/ant/taskdefs/Zip.java\t(revision 384498)\n\n+++ src/main/org/apache/tools/ant/taskdefs/Zip.java\t(working copy)\n\n@@ -1130,11 +1130,15 @@\n\n                 resources = selectFileResources(resources);\n             }\n \n-            newerResources[i] =\n-                ResourceUtils.selectOutOfDateSources(this,\n+            if(duplicate.equals(\"overwrite\")){\n+                newerResources[i] = resources;\n+            } else {\n+                newerResources[i] =\n+                    ResourceUtils.selectOutOfDateSources(this,\n                                                      resources,\n                                                      myMapper,\n                                                      getZipScanner());\n+            }\n             needsUpdate = needsUpdate || (newerResources[i].length > 0);\n \n             if (needsUpdate && !doUpdate) {\n@@ -1647,7 +1651,7 @@\n\n          * @see EnumeratedAttribute#getValues()\n          */\n         public String[] getValues() {\n-            return new String[] {\"add\", \"preserve\", \"fail\"};\n+            return new String[] {\"add\", \"preserve\", \"fail\", \"overwrite\"};\n         }\n     }", "id": 86664, "time": "2006-03-10T10:47:11Z", "bug_id": 38918, "creation_time": "2006-03-10T10:47:11Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 38918, "attachment_id": 17862, "id": 86665, "time": "2006-03-10T10:48:08Z", "creator": "hmacias@ubiquitysoftware.com", "creation_time": "2006-03-10T10:48:08Z", "is_private": false, "text": "Created attachment 17862\nZIp.java patch\n\ndoh! didn't see the \"add attachment\" before..."}, {"count": 2, "tags": [], "creator": "hmacias@ubiquitysoftware.com", "attachment_id": null, "text": "Just to clarify, the proposed patch would add a 'duplicate' value.\n\nCurrently the duplicate attribute in <zip> supports \"add\", \"preserve\" and \"fail\".\n\nAfter the patch, the attribute would support \"add\", \"preserve\", \"fail\" and\n\"overwrite\".", "id": 86666, "time": "2006-03-10T10:50:40Z", "bug_id": 38918, "creation_time": "2006-03-10T10:50:40Z", "is_private": false}, {"count": 3, "tags": [], "creator": "mbenson@apache.org", "text": "This patch really isn't making sense with me... maybe if you attached a testcase\nI would understand what it's supposed to accomplish.  Also, OSS projects get\nhappy when patches are accompanied by tests... :)", "id": 87800, "time": "2006-04-11T21:47:13Z", "bug_id": 38918, "creation_time": "2006-04-11T21:47:13Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 38918, "text": "*** Bug 22930 has been marked as a duplicate of this bug. ***", "id": 129333, "time": "2009-07-31T06:26:30Z", "creator": "bodewig@apache.org", "creation_time": "2009-07-31T06:26:30Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "text": "the use-case is \"always replace existing archive entries with the local files even if the archive entries seem to be newer, leave all other archive entries alone\"", "id": 129334, "time": "2009-07-31T06:28:20Z", "bug_id": 38918, "creation_time": "2009-07-31T06:28:20Z", "is_private": false}]
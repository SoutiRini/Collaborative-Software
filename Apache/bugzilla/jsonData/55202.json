[{"count": 0, "tags": [], "bug_id": 55202, "attachment_id": 30540, "text": "Created attachment 30540\nPatch for BeanShellAssertionGui\n\nProblem Statement:\nIn my daily work i used BeanShell elements extensively and i find them to be very powerful giving the edge to jmeter over the other test frameworks. However, writing Java or Python code in JTextArea is really painful and error prone (and it can hurt the eyes too).\n\nProposal:\nI would like to propose to Jmeter Dev Community to include rsyntaxtextarea-2.0.7.jar library that can do syntax highlighting, code folding, undo typing, and redo typing. The library is published under BSD license and more details can be found here: http://fifesoft.com/rsyntaxtextarea/\nThe jar file needs to be compiled from source (It is very easy to do. Took me only 5 minutes to compile and add it to jmeter project in eclipse)\n\nImplementation change Proposal:\nThe following is the list of files that i changed to make Syntax Highlighting work:\nM       src/protocol/java/org/apache/jmeter/protocol/java/control/gui/BeanShellSamplerGui.java\nM       src/components/org/apache/jmeter/assertions/gui/BeanShellAssertionGui.java\n?       src/core/org/apache/jmeter/testbeans/gui/textarea.properties\nM       src/core/org/apache/jmeter/testbeans/gui/TextAreaEditor.java\nM       src/core/org/apache/jmeter/testbeans/gui/WrapperEditor.java\nM       src/core/org/apache/jmeter/testbeans/gui/GenericTestBeanCustomizer.java\n\nI also had to add the following in build.properties\nrsyntaxtextarea.version     = 2.0.7\nrsyntaxtextarea.jar         = rsyntaxtextarea-${rsyntaxtextarea.version}.jar\nrsyntaxtextarea.md5         = a4bdaabc88ff5464002a43c654bbf856\n\nthe following in .classpath\n<classpathentry kind=\"lib\" path=\"lib/rsyntaxtextarea-2.0.7.jar\"/>\n\nAnd the following in build.xml\n      <include name=\"${lib.dir}/${rsyntaxtextarea.jar}\"/>\n  </patternset>\n...\n    <pathelement location=\"${lib.dir}/${xstream.jar}\"/>\n      <pathelement location=\"${lib.dir}/${rsyntaxtextarea.jar}\"/>\n...\n\nImplementation Details TextAreaEditor.java and textarea.properties:\nInstead of JTextArea, textUI uses RSyntaxTextArea. In order to have numbers for lines i also changes the scroller to RTextScrollPane.\nTo support different languages from BSF and JSR elements new private field languageProperties is added. This field keeps mapping between different languages and syntaxes available in SyntaxConstants interface. Mappings are defined in textarea.properties file Also the TextAreaEditor implements  PropertyChangeListener so that propertyChange events can be captured. In summary:\n\npublic class TextAreaEditor extends PropertyEditorSupport implements FocusListener, PropertyChangeListener {\n\n    private RSyntaxTextArea textUI;\n\n    private RTextScrollPane scroller;\n   \n    private Properties languageProperties;\n...\n    private final void init() {// called from ctor, so must not be overridable\n        textUI = new RSyntaxTextArea(20,20);\n        textUI.discardAllEdits();\n        textUI.setSyntaxEditingStyle(SyntaxConstants.SYNTAX_STYLE_JAVA);\n        textUI.setCodeFoldingEnabled(true);\n        textUI.setAntiAliasingEnabled(true);\n        textUI.addFocusListener(this);\n        textUI.setWrapStyleWord(true);\n        textUI.setLineWrap(true);\n        scroller = new RTextScrollPane(textUI);\n        scroller.setFoldIndicatorEnabled(true);\n        languageProperties = JMeterUtils.loadProperties(\"org/apache/jmeter/testbeans/gui/textarea.properties\");\n    }\n...\n    @Override\n    public void propertyChange(PropertyChangeEvent evt){\n        Object source = evt.getSource();\n        if (source instanceof ComboStringEditor && source !=null){\n            ComboStringEditor cse = (ComboStringEditor)source;\n            String lang = cse.getAsText().toLowerCase();\n            if (languageProperties.containsKey(lang)){\n                textUI.setSyntaxEditingStyle(languageProperties.getProperty(lang));\n            }\n            else{\n                textUI.setSyntaxEditingStyle(SyntaxConstants.SYNTAX_STYLE_NONE);\n            }\n           \n        }\n    }\n\nImplementation Details BeanShellAssertionGui.java and BeanShellSamplerGui.java\nThis is not a java bean element so direct change was applied:\n\n    private RSyntaxTextArea scriptField;// script area\n    ...\n    private JPanel createScriptPanel() {\n        scriptField = new RSyntaxTextArea(20,20);\n        scriptField.setSyntaxEditingStyle(SyntaxConstants.SYNTAX_STYLE_JAVA);\n        scriptField.setCodeFoldingEnabled(true);\n        scriptField.setAntiAliasingEnabled(true);\n        scriptField.setLineWrap(true);\n        scriptField.setWrapStyleWord(true);\n        ...\n        JPanel panel = new JPanel(new BorderLayout());\n        panel.add(label, BorderLayout.NORTH);\n        panel.add(new RTextScrollPane(scriptField), BorderLayout.CENTER);\n\n\nImplementation Details GenericTestBeanCustomizer.java\nChanges made here were necessary to enable Syntax Highlighting changes when different language is selected in ComboBox in BSF and JSR elements.\n\n    GenericTestBeanCustomizer(BeanInfo beanInfo) {\n        super();\n        ...\n        // Added in the \"for\" loop for descriptors\n            //Find the index of textAreaEditor\n            if (propertyEditor instanceof TextAreaEditor)\n            {\n                textAreaEditorIndex = i;\n            }\n\n            //Figure out the index of scriptLanguage ComboBOx\n            if (name.equals(\"scriptLanguage\")){\n                scriptLanguageIndex=i;\n            }\n        ...\n\n        // This is after the for loop. In case of BSF and JSR elements i want to add textAreaEditor as\n        // a listener to scriptLanguage ComboBox.\n        String beanName = this.beanInfo.getBeanDescriptor().getName();\n        if (beanName.startsWith(\"BSF\") || beanName.startsWith(\"JSR223\")){\n                WrapperEditor we = (WrapperEditor) editors[scriptLanguageIndex];\n                TextAreaEditor tae = (TextAreaEditor) editors[textAreaEditorIndex];\n                we.addChangeListener(tae);\n        }\n        ...\n\nImplementation Details WrapperEditor.java\nIn the GenericTestBeanCustomizer constructor i used e.addChangeListener(tae) to add listener to comboBox. Consequently, WrapperEditor class had to be modified, thus addChangeListener method is added that will do actual listener adding on the guiEditor\n\n    public void addChangeListener(PropertyChangeListener listener){\n        guiEditor.addPropertyChangeListener(listener);\n    }\n\nConclusion\nI found Syntax Highlighting to significantly improve look and feel of Scripting elements in Jmeter. Especially revording was to find that RSyntaxTextArea has integrated undo/redo. It is available by simply right clicking in the TextArea.\nNevertheless, all the changes proposed are cosmetic and up to you to decide if it would be worth changing in Jmeter.\n\nBest Regards", "id": 168298, "time": "2013-07-05T17:54:31Z", "creator": "vlahovic74@gmail.com", "creation_time": "2013-07-05T17:54:31Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 30541\nPatch for BeanShellSamplerGui.java", "attachment_id": 30541, "id": 168299, "creator": "vlahovic74@gmail.com", "time": "2013-07-05T17:56:44Z", "bug_id": 55202, "creation_time": "2013-07-05T17:56:44Z", "is_private": false}, {"count": 2, "tags": [], "creator": "vlahovic74@gmail.com", "attachment_id": 30542, "text": "Created attachment 30542\nPatch for GenericTestBeanCusomizer.java", "id": 168300, "time": "2013-07-05T17:58:12Z", "bug_id": 55202, "creation_time": "2013-07-05T17:58:12Z", "is_private": false}, {"count": 3, "tags": [], "creator": "vlahovic74@gmail.com", "is_private": false, "text": "Created attachment 30543\nPatch for TextAreaEditor.java", "id": 168301, "time": "2013-07-05T17:58:49Z", "bug_id": 55202, "creation_time": "2013-07-05T17:58:49Z", "attachment_id": 30543}, {"count": 4, "tags": [], "creator": "vlahovic74@gmail.com", "is_private": false, "text": "Created attachment 30544\nPatch for WrapperEditor.java", "id": 168302, "time": "2013-07-05T17:59:31Z", "bug_id": 55202, "creation_time": "2013-07-05T17:59:31Z", "attachment_id": 30544}, {"count": 5, "tags": [], "text": "Created attachment 30545\nbuild.properties file that includes rsyntaxtextarea.jar", "attachment_id": 30545, "id": 168303, "creator": "vlahovic74@gmail.com", "time": "2013-07-05T18:00:31Z", "bug_id": 55202, "creation_time": "2013-07-05T18:00:31Z", "is_private": false}, {"count": 6, "tags": [], "creator": "vlahovic74@gmail.com", "text": "Created attachment 30546\nMapping between ComboBox elements and Syntaxes", "id": 168304, "time": "2013-07-05T18:02:16Z", "bug_id": 55202, "creation_time": "2013-07-05T18:02:16Z", "is_private": false, "attachment_id": 30546}, {"count": 7, "tags": [], "creator": "vlahovic74@gmail.com", "attachment_id": 30547, "text": "Created attachment 30547\nPatch for ant build file to include rsysntaxtextarea.jar", "id": 168305, "time": "2013-07-05T18:04:15Z", "bug_id": 55202, "creation_time": "2013-07-05T18:04:15Z", "is_private": false}, {"count": 8, "tags": [], "text": "Created attachment 30548\nScreenShot of Syntax Highlight in jmeter", "attachment_id": 30548, "id": 168306, "creator": "vlahovic74@gmail.com", "time": "2013-07-05T18:07:17Z", "bug_id": 55202, "creation_time": "2013-07-05T18:07:17Z", "is_private": false}, {"count": 9, "tags": [], "creator": "vlahovic74@gmail.com", "text": "Created attachment 30549\nRSyntaxTextArea.patch contains the full patch of all java files", "id": 168308, "time": "2013-07-05T19:10:56Z", "bug_id": 55202, "creation_time": "2013-07-05T19:10:56Z", "is_private": false, "attachment_id": 30549}, {"count": 10, "tags": [], "creator": "milamber@apache.org", "text": "Thanks for your contribution, seems to be a very cool improvement.\n\nCan you confirm than the file textarea.properties is under Apache License 2 or upload a new version with the AL2 Header, please.\n\n@Sebb, the component RSyntaxTextArea is distributed under a \"modified BSD license.\"\nSee: http://fifesoft.com/rsyntaxtextarea/RSyntaxTextArea.License.txt\nIt's seems be compliant with the AL2, I think.\n\nThe only change (compare to BSD license) is :\n    * Neither the name of the author nor the names of its contributors may\n      be used to endorse or promote products derived from this software\n      without specific prior written permission.\n\n\nFor memory, the license compliant with AL2 (BSD is included)\nhttp://www.apache.org/legal/resolved.html#category-a\n\n\n==\nThe LICENSE and NOTICE files must modify to include the mention of RSyntaxTextArea's license. (I can do this)", "id": 168309, "time": "2013-07-05T19:13:57Z", "bug_id": 55202, "creation_time": "2013-07-05T19:13:57Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "id": 168310, "time": "2013-07-05T19:25:53Z", "bug_id": 55202, "creation_time": "2013-07-05T19:25:53Z", "is_private": false, "text": "(In reply to Milamber from comment #10)\n\n> @Sebb, the component RSyntaxTextArea is distributed under a \"modified BSD\n> license.\"\n> See: http://fifesoft.com/rsyntaxtextarea/RSyntaxTextArea.License.txt\n> It's seems be compliant with the AL2, I think.\n> \n> The only change (compare to BSD license) is :\n>     * Neither the name of the author nor the names of its contributors may\n>       be used to endorse or promote products derived from this software\n>       without specific prior written permission.\n> \n> \n> For memory, the license compliant with AL2 (BSD is included)\n> http://www.apache.org/legal/resolved.html#category-a\n\nThat seems OK, but IANAL.\n\n> ==\n> The LICENSE and NOTICE files must modify to include the mention of\n> RSyntaxTextArea's license. (I can do this)\n\nObviously the new license needs including in LICENSE (or as a separate file linked from it).\n\nAre you sure that the NOTICE file needs updating?\nIt's important not to add anything to NOTICE that is not strictly required.\nThis may need asking on the legal-discuss list."}, {"count": 12, "tags": [], "creator": "vlahovic74@gmail.com", "text": "I will add the header to the file. No problem.\nDo you require unit test too? Documentation updates?", "id": 168311, "time": "2013-07-05T19:27:13Z", "bug_id": 55202, "creation_time": "2013-07-05T19:27:13Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "creator": "vlahovic74@gmail.com", "text": "Created attachment 30550\nAdding mapping between languages and available syntaxes", "id": 168312, "time": "2013-07-05T19:35:04Z", "bug_id": 55202, "creation_time": "2013-07-05T19:35:04Z", "is_private": false, "attachment_id": 30550}, {"count": 14, "tags": [], "bug_id": 55202, "attachment_id": null, "is_private": false, "id": 168313, "time": "2013-07-05T19:35:50Z", "creator": "milamber@apache.org", "creation_time": "2013-07-05T19:35:50Z", "text": "(In reply to Sebb from comment #11)\n> (In reply to Milamber from comment #10)\n> \n\n> > ==\n> > The LICENSE and NOTICE files must modify to include the mention of\n> > RSyntaxTextArea's license. (I can do this)\n> \n> Obviously the new license needs including in LICENSE (or as a separate file\n> linked from it).\n> \n> Are you sure that the NOTICE file needs updating?\n\nI prefer, because in Mvnrepository site, the indicated license is LGPL, but perhaps it's a doc's bug. In official site, the license is clearly indicated.\n\nhttp://mvnrepository.com/artifact/com.fifesoft/rsyntaxtextarea/2.0.7\n\n> It's important not to add anything to NOTICE that is not strictly required.\n> This may need asking on the legal-discuss list."}, {"count": 15, "tags": [], "bug_id": 55202, "attachment_id": null, "text": "(In reply to Marko from comment #12)\n> I will add the header to the file. No problem.\n> Do you require unit test too? Documentation updates?\n\nTest unit doesn't seems needed because this is only an visual improvement.\n\nIn the docs, some screenshots must be update, but I can do this too.\n\nNow It's time for me to test your patch :-)", "id": 168315, "time": "2013-07-05T19:39:49Z", "creator": "milamber@apache.org", "creation_time": "2013-07-05T19:39:49Z", "is_private": false}, {"count": 16, "tags": [], "text": "(In reply to Milamber from comment #14)\n> (In reply to Sebb from comment #11)\n> > (In reply to Milamber from comment #10)\n> > \n> \n> > Are you sure that the NOTICE file needs updating?\n> \n> I prefer, because in Mvnrepository site, the indicated license is LGPL, but\n> perhaps it's a doc's bug. In official site, the license is clearly indicated.\n\nThat's not sufficient reason to add anything to the NOTICE file.\n\nIt looks like the code is built using Ant, not Maven, so maybe it was uploaded by a 3rd party who got the pom wrong.\n\nBut clearly we cannot depend on the jar from Maven Central.\n\n> http://mvnrepository.com/artifact/com.fifesoft/rsyntaxtextarea/2.0.7\n> \n> > It's important not to add anything to NOTICE that is not strictly required.\n> > This may need asking on the legal-discuss list.", "is_private": false, "id": 168316, "creator": "sebb@apache.org", "time": "2013-07-05T19:56:03Z", "bug_id": 55202, "creation_time": "2013-07-05T19:56:03Z", "attachment_id": null}, {"count": 17, "tags": [], "creator": "milamber@apache.org", "attachment_id": null, "id": 168319, "time": "2013-07-05T20:48:47Z", "bug_id": 55202, "creation_time": "2013-07-05T20:48:47Z", "is_private": false, "text": "\n\nThanks. Committed in last trunk.\n(some changes in your patch: de-tabulation: prefer spaces for indentation, alphabetical order in jars listing, remove unused imports, formatting code)\n\nDocs screenshots to do (tomorrow)\n\n\nURL: http://svn.apache.org/r1500124\nLog:\nBug 55202 - Proposal to add RSyntaxTextArea for BeanShell, BSF, and JSR223 elements\nBugzilla Id: 55202\n\nAdded:\n    jmeter/trunk/src/core/org/apache/jmeter/testbeans/gui/textarea.properties   (with props)\nModified:\n    jmeter/trunk/LICENSE\n    jmeter/trunk/build.properties\n    jmeter/trunk/build.xml\n    jmeter/trunk/eclipse.classpath\n    jmeter/trunk/res/maven/ApacheJMeter_parent.pom\n    jmeter/trunk/src/components/org/apache/jmeter/assertions/gui/BeanShellAssertionGui.java\n    jmeter/trunk/src/core/org/apache/jmeter/testbeans/gui/GenericTestBeanCustomizer.java\n    jmeter/trunk/src/core/org/apache/jmeter/testbeans/gui/TextAreaEditor.java\n    jmeter/trunk/src/core/org/apache/jmeter/testbeans/gui/WrapperEditor.java\n    jmeter/trunk/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/BeanShellSamplerGui.java\n    jmeter/trunk/xdocs/changes.xml"}, {"count": 18, "tags": [], "creator": "milamber@apache.org", "text": "URL: http://svn.apache.org/r1500390\nLog:\nGet rsyntaxtextarea jar file from official binary zip\nBugzilla Id: 55202\n\nModified:\n    jmeter/trunk/build.properties\n    jmeter/trunk/build.xml", "id": 168339, "time": "2013-07-07T09:19:30Z", "bug_id": 55202, "creation_time": "2013-07-07T09:19:30Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "creator": "milamber@apache.org", "text": "URL: http://svn.apache.org/r1500408\nLog:\nUpdate docs with new screenshots\nBugzilla Id: 55202\n\nAdded:\n    jmeter/trunk/docs/images/screenshots/beanshell_assertion.png   (with props)\n    jmeter/trunk/xdocs/images/screenshots/beanshell_assertion.png   (with props)\nModified:\n    jmeter/trunk/docs/images/screenshots/beanshell_listener.png\n    jmeter/trunk/docs/images/screenshots/beanshell_postprocessor.png\n    jmeter/trunk/docs/images/screenshots/beanshell_preprocessor.png\n    jmeter/trunk/docs/images/screenshots/beanshellsampler.png\n    jmeter/trunk/docs/images/screenshots/bsf_assertion.png\n    jmeter/trunk/docs/images/screenshots/bsf_listener.png\n    jmeter/trunk/docs/images/screenshots/bsf_postprocessor.png\n    jmeter/trunk/docs/images/screenshots/bsf_preprocessor.png\n    jmeter/trunk/docs/images/screenshots/bsfsampler.png\n    jmeter/trunk/docs/images/screenshots/bsh_assertion.png\n    jmeter/trunk/docs/images/screenshots/jsr223-sampler.png\n    jmeter/trunk/docs/images/screenshots/mongodb-script.png\n    jmeter/trunk/docs/images/screenshots/timers/beanshell_timer.png\n    jmeter/trunk/docs/images/screenshots/timers/bsf_timer.png\n    jmeter/trunk/xdocs/images/screenshots/beanshell_listener.png\n    jmeter/trunk/xdocs/images/screenshots/beanshell_postprocessor.png\n    jmeter/trunk/xdocs/images/screenshots/beanshell_preprocessor.png\n    jmeter/trunk/xdocs/images/screenshots/beanshellsampler.png\n    jmeter/trunk/xdocs/images/screenshots/bsf_assertion.png\n    jmeter/trunk/xdocs/images/screenshots/bsf_listener.png\n    jmeter/trunk/xdocs/images/screenshots/bsf_postprocessor.png\n    jmeter/trunk/xdocs/images/screenshots/bsf_preprocessor.png\n    jmeter/trunk/xdocs/images/screenshots/bsfsampler.png\n    jmeter/trunk/xdocs/images/screenshots/bsh_assertion.png\n    jmeter/trunk/xdocs/images/screenshots/jsr223-sampler.png\n    jmeter/trunk/xdocs/images/screenshots/mongodb-script.png\n    jmeter/trunk/xdocs/images/screenshots/timers/beanshell_timer.png\n    jmeter/trunk/xdocs/images/screenshots/timers/bsf_timer.png\n    jmeter/trunk/xdocs/usermanual/component_reference.xml", "id": 168343, "time": "2013-07-07T11:32:54Z", "bug_id": 55202, "creation_time": "2013-07-07T11:32:54Z", "is_private": false, "attachment_id": null}, {"count": 20, "tags": [], "bug_id": 55202, "is_private": false, "id": 168344, "attachment_id": null, "creator": "milamber@apache.org", "creation_time": "2013-07-07T11:36:50Z", "time": "2013-07-07T11:36:50Z", "text": "\nSeems everything is ok. I close it."}, {"count": 21, "tags": [], "bug_id": 55202, "attachment_id": null, "text": "Thanks. Great feature.\nThere is still a little one, in JDBC Sampler syntax highlight is done on Java not SQL.", "id": 168345, "time": "2013-07-07T13:21:42Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2013-07-07T13:21:42Z", "is_private": false}, {"count": 22, "tags": [], "creator": "sebb@apache.org", "text": "URL: http://svn.apache.org/r1501306\nLog:\nAdd syntax color for scripts elements (BeanShell, BSF, and JSR223) with RSyntaxTextArea\nJDBC now uses SQL language format\nBugzilla Id: 55202\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/testbeans/gui/TextAreaEditor.java\n    jmeter/trunk/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/JDBCTestElementBeanInfoSupport.java", "id": 168419, "time": "2013-07-09T14:51:23Z", "bug_id": 55202, "creation_time": "2013-07-09T14:51:23Z", "is_private": false, "attachment_id": null}, {"count": 23, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Date: Thu Sep 26 06:44:29 2013\nNew Revision: 1526398\n\nURL: http://svn.apache.org/r1526398\nLog:\nBug 55202 - Add syntax color for scripts elements (BeanShell, BSF, and JSR223) and JDBC elements with RSyntaxTextArea\nAdd missing configuration properties in jmeter.properties\nBugzilla Id: 55202\n\nModified:\n    jmeter/trunk/bin/jmeter.properties\n\n\nDate: Thu Sep 26 06:46:36 2013\nNew Revision: 1526400\n\nURL: http://svn.apache.org/r1526400\nLog:\nBug 55202 - Add syntax color for scripts elements (BeanShell, BSF, and JSR223) and JDBC elements with RSyntaxTextArea\nAdd a way to disable undo feature in JSyntaxtTextArea, thanks Robert Futrell\nBugzilla Id: 55202\n\nModified:\n    jmeter/trunk/bin/jmeter.properties\n    jmeter/trunk/src/core/org/apache/jmeter/gui/util/JSyntaxTextArea.java", "id": 170279, "time": "2013-09-26T06:47:19Z", "bug_id": 55202, "creation_time": "2013-09-26T06:47:19Z", "is_private": false, "attachment_id": null}, {"count": 24, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Date: Thu Sep 26 19:39:31 2013\nNew Revision: 1526656\n\nURL: http://svn.apache.org/r1526656\nLog:\nBug 55202 - Add syntax color for scripts elements (BeanShell, BSF, and JSR223) and JDBC elements with RSyntaxTextArea\nFixed bad configuration\nBugzilla Id: 55202\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/gui/util/JSyntaxTextArea.java", "id": 170296, "time": "2013-09-26T19:42:46Z", "bug_id": 55202, "creation_time": "2013-09-26T19:42:46Z", "is_private": false, "attachment_id": null}]
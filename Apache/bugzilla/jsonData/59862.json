[{"count": 0, "attachment_id": 34041, "bug_id": 59862, "text": "Created attachment 34041\nModifies ClassPathEntry inner class in StandardJarScanner.java to use name of last JAR specified by path of given URL.\n\nStandardJarScanner.java does not match nested JARs (jars within jars) to patterns defined by the system property tomcat.util.scan.StandardJarScanFilter.jarsToSkip. The proposed change will allow nested JARs to be matched and should not modify filtering of non-nested JARs.", "id": 192395, "time": "2016-07-15T07:53:10Z", "creator": "terence@tmbsw.com", "creation_time": "2016-07-15T07:53:10Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "violetagg@apache.org", "is_private": false, "id": 192455, "attachment_id": null, "bug_id": 59862, "creation_time": "2016-07-17T15:16:57Z", "time": "2016-07-17T15:16:57Z", "text": "Hi,\n\nThanks for the report and the patch.\nThis has been fixed in\n- 9.0.x for 9.0.0.M10 onwards,\n- 8.5.x for 8.5.5 onwards and\n- 8.0.x for 8.0.37 onwards\n\nRegards,\nVioleta"}, {"count": 2, "tags": [], "bug_id": 59862, "is_private": false, "text": "Hi,\n\nI was too fast in applying the patch.\nCan you provide a simple example that demonstrates the issue?\n\nThanks,\nVioleta", "id": 192458, "time": "2016-07-17T16:42:33Z", "creator": "violetagg@apache.org", "creation_time": "2016-07-17T16:42:33Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "terence@tmbsw.com", "attachment_id": 34049, "id": 192467, "time": "2016-07-17T22:31:53Z", "bug_id": 59862, "creation_time": "2016-07-17T22:31:53Z", "is_private": false, "text": "Created attachment 34049\nJar scanner issue demonstration project.\n\nTo demonstrate the issue, build, change to the target directory and execute the resulting jar:\n\n    java -jar jar-scanner-bugzilla-59862-1.0.0.jar\n\nTo capture the output in a file:\n\n    java -jar jar-scanner-bugzilla-59862-1.0.0.jar > tomcat.log 2>&1\n\nTo test the patch, uncomment line 68 and rebuild.\n\nThanks.\n\n-Terence"}, {"count": 4, "attachment_id": null, "bug_id": 59862, "text": "Why is this necessary? J2EE doesn't support jars-within-jars, does it? Scanning jars-within-jars would be non-spec-compliant.", "id": 192496, "time": "2016-07-18T16:56:54Z", "creator": "chris@christopherschultz.net", "creation_time": "2016-07-18T16:56:54Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "text": "Does J2EE specifically prohibit scanning nested JARs? If not, then there would be nothing \"non-spec-compliant\" about doing so.\n\nTomcat already scans nested JARS. The proposed modification allows users to limit which nested JARS are scanned using the existing Tomcat \"jarsToSkip\" feature. IMHO, this is the expected behavior of that feature.\n\nNested JARs are used extensively (e.g. Spring Boot). The proposed modification allows for faster startup in that type of environment by changing one line in an existing Tomcat class that supports an existing Tomcat feature.", "is_private": false, "bug_id": 59862, "id": 192497, "time": "2016-07-18T18:03:38Z", "creator": "terence@tmbsw.com", "creation_time": "2016-07-18T18:03:38Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 59862, "is_private": false, "text": "It was me that voiced concerns over this that led to the original commits being reverted. I've now found the time to come back to this.\n\nAs far as the Servlet spec is concerned, JARs are located in WEB-INF/lib and those JARs are not checked to see if they contain nested JARs.\n\nHowever, the container is free to provide any mechanism it sees fit to augment the web application's class-path. Tomcat does this in a variety of ways but many of them boil down to providing a URL to a JAR to add to the class path. That URL can point to a JAR file within another JAR if you take advantage of the JarWarResourceSet (the outer JAR is treated as a WAR).\n\nHaving had a chance to work through the implications of the proposed patch I'm happy that there are no issues. I'll get it re-applied.", "id": 193043, "time": "2016-08-11T21:37:22Z", "creator": "markt@apache.org", "creation_time": "2016-08-11T21:37:22Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 59862, "attachment_id": null, "text": "Fix restored for:\n- 9.0.x for 9.0.0.M10 onwards,\n- 8.5.x for 8.5.5 onwards and\n- 8.0.x for 8.0.37 onwards", "id": 193048, "time": "2016-08-11T21:47:36Z", "creator": "markt@apache.org", "creation_time": "2016-08-11T21:47:36Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 59862, "is_private": false, "text": "Thanks for looking into this, Mark. I appreciate your diligence and objectivity.", "id": 193080, "time": "2016-08-13T19:59:05Z", "creator": "terence@tmbsw.com", "creation_time": "2016-08-13T19:59:05Z", "attachment_id": null}]
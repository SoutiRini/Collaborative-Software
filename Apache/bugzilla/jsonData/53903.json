[{"count": 0, "tags": [], "bug_id": 53903, "text": "When starting an embeeded tomcat with an webapp with\n- web.xml with servlet api3 version\n- a ServletContextListener implementation with @WebListener Annotation\n\nthen the ServletContextlistener is ignored (it wont be registered).\n\nThe same Listener works if added manually to web.xml with a <listener>-Tag", "id": 162285, "time": "2012-09-19T14:38:29Z", "creator": "manuelhartl@gmail.com", "creation_time": "2012-09-19T14:38:29Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 53903, "text": "Please provide a test case to reproduce this. Make sure you are using addWebapp() and not addContext()", "id": 162311, "time": "2012-09-21T07:46:28Z", "creator": "markt@apache.org", "creation_time": "2012-09-21T07:46:28Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "manuelhartl@gmail.com", "text": "The code snippet for starting:\n\n\t\tTomcat tomcat = new Tomcat();\n\t\ttomcat.setPort(9000);\n\t\ttomcat.setBaseDir(\".\");\n\t\ttomcat.enableNaming();\n\n\t\t\n\t\tContext ctx = tomcat.addWebapp(\"/\", docBase.getAbsolutePath());\n\t\tctx.setConfigFile(new File(\"/META-INF/context.xml\").toURI().toURL());\n\t\ttomcat.start();\n\t\ttomcat.getServer().await();\n\nthe web.xml:\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txmlns=\"http://java.sun.com/xml/ns/javaee\" xmlns:web=\"http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd\"\n\txsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd\"\n\tversion=\"3.0\" metadata-complete=\"false\">\n\t<display-name>ssms configuration app</display-name>\n \n\t<!-- Change to \"Production\" when you are ready to deploy -->\n\t<context-param>\n\t\t<param-name>javax.faces.DEFAULT_SUFFIX</param-name>\n\t\t<param-value>.xhtml</param-value>\n\t</context-param>\n\t<context-param>\n\t\t<param-name>javax.faces.PROJECT_STAGE</param-name>\n\t\t<param-value>Development</param-value>\n\t</context-param>\n\t\n\t<context-param>\n\t\t<param-name>org.richfaces.skin</param-name>\n\t\t<param-value>classic</param-value>\n\t</context-param>\n\t\n\t<context-param>\n    \t<param-name>javax.faces.FACELETS_SKIP_COMMENTS</param-name>\n    \t<param-value>true</param-value>\n\t</context-param>\n\n\t<context-param>\n\t\t<param-name>createTempFiles</param-name>\n\t\t<param-value>false</param-value>\n\t</context-param>\n\t\n\t<context-param>\n\t\t<param-name>maxRequestSize</param-name>\n\t\t<param-value>1000000</param-value>\n\t</context-param>\n\t\n\t<context-param>\n\t\t<param-name>javax.faces.INTERPRET_EMPTY_STRING_SUBMITTED_VALUES_AS_NULL</param-name>\n\t\t<param-value>true</param-value>\n\t</context-param>\n \n\t<!-- Welcome page -->\n\t<welcome-file-list>\n\t\t<welcome-file>resources/index.xhtml</welcome-file>\n\t</welcome-file-list>\n \n\t<!-- JSF mapping -->\n\t<servlet>\n\t\t<servlet-name>Faces Servlet</servlet-name>\n\t\t<servlet-class>javax.faces.webapp.FacesServlet</servlet-class>\n\t\t<load-on-startup>1</load-on-startup>\n\t</servlet>\n \n\t<!-- Map these files with JSF -->\n\t<servlet-mapping>\n\t\t<servlet-name>Faces Servlet</servlet-name>\n\t\t<url-pattern>*.xhtml</url-pattern>\n\t</servlet-mapping>\n\t\n\t<error-page> \n\t    <exception-type>java.lang.Throwable</exception-type> \n\t    <location>/resources/error.xhtml</location> \n\t</error-page>\n\t\n\t<error-page> \n\t    <error-code>500</error-code> \n\t    <location>/resources/error.xhtml</location> \n\t</error-page>\n\t\n\t<error-page> \n\t    <error-code>503</error-code> \n\t    <location>/resources/error.xhtml</location> \n\t</error-page>\n\t<listener>\n\t\t<listener-class>org.jboss.weld.environment.servlet.Listener</listener-class>\n\t</listener>\n\t<resource-env-ref>\n\t\t<resource-env-ref-name>BeanManager</resource-env-ref-name>\n\t\t<resource-env-ref-type>javax.enterprise.inject.spi.BeanManager</resource-env-ref-type>\n\t</resource-env-ref>\t\n</web-app>\n\nAn example ContextListener (that should throw an exception during webapp-startup):\npackage de.flexsecure.test.tomcat.embedded;\n\nimport javax.servlet.ServletContextEvent;\nimport javax.servlet.ServletContextListener;\nimport javax.servlet.annotation.WebListener;\n\n@WebListener\npublic class ContextListener implements ServletContextListener {\n\t\n\t@Override\n\tpublic final void contextInitialized(ServletContextEvent event) {\n\t\tthrow new RuntimeException(\"must happen\");\n\t}\n\n\t@Override\n\tpublic void contextDestroyed(ServletContextEvent sce) {\n\t\t\n\t}\n\n}", "id": 162314, "time": "2012-09-21T08:35:29Z", "bug_id": 53903, "creation_time": "2012-09-21T08:35:29Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "is_private": false, "id": 162318, "time": "2012-09-21T09:14:16Z", "bug_id": 53903, "creation_time": "2012-09-21T09:14:16Z", "text": "Where is the listener class located? If it isn't in WEB-INF/classes and it isn't in a JAR on the class path, you'll probably need:\n\n((StandardJarScanner) ctx.getJarScanner()).setScanAllDirectories(true);"}, {"count": 4, "tags": [], "creator": "manuelhartl@gmail.com", "attachment_id": null, "is_private": false, "id": 162319, "time": "2012-09-21T10:01:51Z", "bug_id": 53903, "creation_time": "2012-09-21T10:01:51Z", "text": "thank you very much - my Problem is resolved.\n\nmaybe it makes sense to add this to a documentation? (or FAQ)?"}, {"count": 5, "tags": [], "bug_id": 53903, "text": "Not an issue. The behaviour of the JarScanner is documented. Suggestions for documentation patches welcome.", "id": 162439, "time": "2012-09-27T18:45:51Z", "creator": "markt@apache.org", "creation_time": "2012-09-27T18:45:51Z", "is_private": false, "attachment_id": null}]
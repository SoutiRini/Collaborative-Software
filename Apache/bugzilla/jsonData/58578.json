[{"text": "I've run into a NullPointerException when the AccessLogValve is configured to log a cookie:\n\n02-Nov-2015 18:19:45.461 SEVERE [ajp-nio-8009-exec-1] org.apache.coyote.ajp.AbstractAjpProcessor.process Error processing request\n java.lang.NullPointerException\n        at org.apache.catalina.connector.Request.parseCookies(Request.java:2948)\n        at org.apache.catalina.connector.Request.convertCookies(Request.java:2963)\n        at org.apache.catalina.connector.Request.getCookies(Request.java:1992)\n        at org.apache.catalina.valves.AbstractAccessLogValve$CookieElement.addElement(AbstractAccessLogValve.java:1335)\n        at org.apache.catalina.valves.AbstractAccessLogValve.log(AbstractAccessLogValve.java:639)\n        at org.apache.catalina.core.AccessLogAdapter.log(AccessLogAdapter.java:51)\n        at org.apache.catalina.core.ContainerBase.logAccess(ContainerBase.java:1043)\n        at org.apache.catalina.connector.CoyoteAdapter.postParseRequest(CoyoteAdapter.java:893)\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:513)\n        at org.apache.coyote.ajp.AbstractAjpProcessor.process(AbstractAjpProcessor.java:844)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:668)\n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1517)\n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1474)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n        at java.lang.Thread.run(Thread.java:745)\n\n02-Nov-2015 18:19:45.464 WARNING [ajp-nio-8009-exec-1] org.apache.catalina.connector.CoyoteAdapter.log Exception while attempting to add an entry to the access log\n java.lang.NullPointerException\n        at org.apache.catalina.connector.Request.parseCookies(Request.java:2948)\n        at org.apache.catalina.connector.Request.convertCookies(Request.java:2963)\n        at org.apache.catalina.connector.Request.getCookies(Request.java:1992)\n        at org.apache.catalina.valves.AbstractAccessLogValve$CookieElement.addElement(AbstractAccessLogValve.java:1335)\n        at org.apache.catalina.valves.AbstractAccessLogValve.log(AbstractAccessLogValve.java:639)\n        at org.apache.catalina.core.AccessLogAdapter.log(AccessLogAdapter.java:51)\n        at org.apache.catalina.core.StandardEngine.logAccess(StandardEngine.java:342)\n        at org.apache.catalina.connector.CoyoteAdapter.log(CoyoteAdapter.java:675)\n        at org.apache.coyote.ajp.AbstractAjpProcessor.process(AbstractAjpProcessor.java:853)\n        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:668)\n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1517)\n        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1474)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n        at java.lang.Thread.run(Thread.java:745)\n\nHere's the valve configuration:\n\n        <Valve className=\"org.apache.catalina.valves.AccessLogValve\"\n          directory=\"logs\" prefix=\"access.log.\" suffix=\"\"\n          pattern=\"%h %l %u %t &quot;%r&quot; %s %b &quot;%{Referer}i&quot; &quot;%{User-Agent}i&quot; %{JSESSIONID}c %D %I\"/>\n\nRedHat has posted an article with the same exception noted: https://access.redhat.com/solutions/1992003.  Unfortunately, the information is hidden behind a paywall I don't have access to.  However I searched Bugzilla and can find no evidence that they submitted a ticket upstream.\n\nThanks.", "tags": [], "bug_id": 58578, "attachment_id": null, "count": 0, "id": 186226, "time": "2015-11-03T17:33:49Z", "creator": "cpjunk@yeroc.ca", "creation_time": "2015-11-03T17:33:49Z", "is_private": false}, {"count": 1, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "From what I see the context is null, so this means this is about requests that have not been mapped but are access logged anyway.\n\nThis should be fixed in r1712358 that will be in Tomcat 8.0.29. Tomcat 7 is likely not affected.\n\nThe cookie processor is associated with contexts in Tomcat 8+, so cookie processing will not occur for unmapped requests and they will appear as if they had no cookies. If this is somehow important (I do not think so at the moment), then another \"generic\" cookie processor will have to exist for these kind of situations.", "id": 186227, "time": "2015-11-03T18:01:37Z", "bug_id": 58578, "creation_time": "2015-11-03T18:01:37Z", "attachment_id": null}]
[{"count": 0, "attachment_id": null, "bug_id": 47408, "is_private": false, "id": 128171, "time": "2009-06-23T04:56:52Z", "creator": "peter.sylvester@edelweb.fr", "creation_time": "2009-06-23T04:56:52Z", "tags": [], "text": "The ssl_log_cxerror routine in ssl_engine_log.c may receive a NULL pointer\nas a certificate (caused foir exemple by some recent change in openssl.\nthat reurn a NULL pointer to a call to X509_STORE_CTX_get_current_cert\nin some new logic concerning policy checks. \n\nThe routine could either simply return in case of a NULL parameter\nor issue a static error message.\n\nAlternatively the few callers could be fixed not to call the routine."}, {"count": 1, "attachment_id": null, "bug_id": 47408, "is_private": false, "id": 128173, "time": "2009-06-23T05:23:37Z", "creator": "jorton@redhat.com", "creation_time": "2009-06-23T05:23:37Z", "tags": [], "text": "Can you give more details on what's changed in OpenSSL?\n\nInvoking the callback in a case where X509_STORE_CTX_get_current_cert() would return NULL seems non-sensical.  What is the function supposed to verify?"}, {"count": 2, "tags": [], "creator": "peter.sylvester@edelweb.fr", "attachment_id": null, "text": "In crypto/x509/x509_vfy.c : the call back is called explicitely with\nno certficate under two circumstances:\n\n- When there is no acceptable explicit certficationpolicy found.\n\n- To notify the active policy.\n\nin the check_policy routine which is invoked after presenting \neach certficate in the chain to the callback, the callback is called\nagain.\n\n \tif (ret == -2)\n\t\t{\n\t\tctx->current_cert = NULL;\n\t\tctx->error = X509_V_ERR_NO_EXPLICIT_POLICY;\n\t\treturn ctx->verify_cb(0, ctx);\n\t\t}\n\n\tif (ctx->param->flags & X509_V_FLAG_NOTIFY_POLICY)\n\t\t{\n\t\tctx->current_cert = NULL;\n\t\tctx->error = X509_V_OK;\n\t\tif (!ctx->verify_cb(2, ctx))\n\t\t\treturn 0;\n\t\t}\n\nThe \"previous\" cert had already be presented to the verify callback, so it was\nalready logged by apache.", "id": 128181, "time": "2009-06-23T06:41:04Z", "bug_id": 47408, "creation_time": "2009-06-23T06:41:04Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 47408, "attachment_id": null, "text": "So far as I can tell, that policy verification code is only going to get invoked if the caller has explicitly enabled policy checking:\n\n        if (!bad_chain && (ctx->param->flags & X509_V_FLAG_POLICY_CHECK))\n                ok = ctx->check_policy(ctx);\n\nand this is not done by default, nor can be enabled via mod_ssl.  Am I missing something?", "id": 128183, "time": "2009-06-23T06:57:27Z", "creator": "jorton@redhat.com", "creation_time": "2009-06-23T06:57:27Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 47408, "attachment_id": null, "text": "No, you are not missing anything. Currently, the segfault only occurs if\nthe policycheck flag is enabled by some magic.\n\nut since openssl doesn't seem to guarantee anymore that the point is non null,\none might be prepared to that in a simular way as the cxerror log is\nprepared not to get issuer, subject, and serial.\n\nit is a suggestion to be more robust. So the status should\nprobably better 'enhancement'.", "id": 128195, "time": "2009-06-23T08:19:10Z", "creator": "peter.sylvester@edelweb.fr", "creation_time": "2009-06-23T08:19:10Z", "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 47408, "text": "Fixed with r1157712.", "id": 148607, "time": "2011-08-15T05:17:26Z", "creator": "asfbugz@velox.ch", "creation_time": "2011-08-15T05:17:26Z", "tags": [], "is_private": false}]
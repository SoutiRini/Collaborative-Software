[{"count": 0, "tags": [], "bug_id": 35584, "attachment_id": null, "is_private": false, "id": 76901, "time": "2005-07-01T20:56:41Z", "creator": "mike@hackerjoe.com", "creation_time": "2005-07-01T20:56:41Z", "text": "I am not sure, is this a bug or a mistake. \n\nWhen a CGI executes I was under the assumption that it exec under the permission\nof the SuexecUserGroup directive.\n\nI created a test script test.cgi;\n#!/bin/sh\n\n$ENV{'PATH'} = '/bin:/usr/bin';\nprint  \"Content-type: text/html\\n\\n\";\nprint \"Hello World\";\nprint `whoami`;\nprint `echo *`;\nprint `touch /sites/yuma3/hacker.txt`;\nprint `cat /etc/group`;\nprint `ls -la /sites/somefilename/`;\n#print  `ping 65.182.97.130`;\nexit;\n\nWhen `whoami` is printed it says Apache.\n\n\nI compiled apache and suexec from a src.rpm on a RHES4 box\n\nApache ver is 2.0.52\n\n# ./suexec -V\n -D AP_DOC_ROOT=\"/sites\"\n -D AP_GID_MIN=10000\n -D AP_HTTPD_USER=\"apache\"\n -D AP_LOG_EXEC=\"/var/log/httpd/suexec.log\"\n -D AP_SAFE_PATH=\"/usr/local/bin:/usr/bin:/bin\"\n -D AP_UID_MIN=10000\n -D AP_USERDIR_SUFFIX=\"/gi-bin\"\n\nand also\nI ajexred the userdir and sill got the same results.\n# ./suexec -V\n -D AP_DOC_ROOT=\"/sites\"\n -D AP_GID_MIN=10000\n -D AP_HTTPD_USER=\"apache\"\n -D AP_LOG_EXEC=\"/var/log/httpd/suexec.log\"\n -D AP_SAFE_PATH=\"/usr/local/bin:/usr/bin:/bin\"\n -D AP_UID_MIN=10000\n -D AP_USERDIR_SUFFIX=\"sites\"\n\nThe suexec states that every thing is going as planed\n\n[2005-07-01 09:15:57]: uid: (10001/michealt) gid: (10182/10182) cmd: test.cgi\n[2005-07-01 09:16:31]: uid: (10001/michealt) gid: (10182/10182) cmd: test.cgi\n[2005-07-01 09:16:40]: uid: (10001/michealt) gid: (10182/10182) cmd: test.cgi\n[2005-07-01 09:47:13]: uid: (10001/michealt) gid: (10182/10182) cmd: test.cgi\n[2005-07-01 09:47:13]: uid: (10001/michealt) gid: (10182/10182) cmd: test.cgi\n[2005-07-01 09:47:13]: uid: (10001/michealt) gid: (10182/10182) cmd: test.cgi\n[2005-07-01 09:47:14]: uid: (10001/michealt) gid: (10182/10182) cmd: test.cgi\n[2005-07-01 09:47:14]: uid: (10001/michealt) gid: (10182/10182) cmd: test.cgi\n\n\nvhost config\n\n<VirtualHost *:80>\nAddType application/x-httpd-php .php\nAddHandler cgi-script .cgi\nServerAdmin support(...at....)brinkster(....dot...)com\nServerName michealt\nDocumentRoot /sites/yuma3/michealt/home/public_html\n#ServerAlias michealt\n#SuexecUserGroup michealt ausr_michealt\nScriptAlias /cgi-bin/ /sites/somedirectoryname/michealt/home/cgi-bin/\n<Directory /sites/somedirectoryname/michealt/home/public_html>\n   AddHandler type-map var\n   PerlResponseHandler ModPerl::Registry\n   PerlOptions +ParseHeaders\n   Options  +Includes\n   Allow from all\n   DirectoryIndex index.html index.php index.htm default.htm default.html\ndefault.php\n</Directory>\n<Directory /sites/somedirectoryname/michealt/home/cgi-bin>\n   AddOutputFilter Includes .shtml .cgi .pl\n   AddHandler type-map var\n   SetHandler perl-script\n   PerlResponseHandler ModPerl::Registry\n   PerlOptions +ParseHeaders\n   Options +ExecCGI +Includes\n   Allow from all\n   DirectoryIndex index.html index.php index.htm default.htm default.html\ndefault.php\n</Directory>\n</VirtualHost>"}, {"count": 1, "tags": [], "bug_id": 35584, "is_private": false, "text": "Strange. Is suexec setuid root?", "id": 78478, "time": "2005-08-14T12:24:49Z", "creator": "nd@perlig.de", "creation_time": "2005-08-14T12:24:49Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 35584, "is_private": false, "id": 81312, "time": "2005-10-18T13:04:29Z", "creator": "cono@uaportal.com", "creation_time": "2005-10-18T13:04:29Z", "tags": [], "text": "I have the same problem.\n\nSome CGI wrote files in other mode:\n if ($out_filename){\n    my $outdir=$out_filename;  #check dir\n    $outdir=~ s/[^\\/]*$//;\n    mkpath($outdir,0);\n    open(OUTFILE,\">$out_filename\") || die_c(\"Can't open out [$out_filename] file\");\n    print OUTFILE $page;\n    close(OUTFILE);\n }\n\nSometimes this code wrote files in ua:ua 0600 privilagies, sometimes in ua:ua 0644.\nApache config:\n\nAddHandler cgi-script .cgi\n\n<VirtualHost 217.20.163.57:*>\nServerName www.uaportal.com\nDocumentRoot /data/uaportal_site/public_html\nServerAdmin admin@uaportal.com\nErrorLog /backup2/apache_logs/uaportal_site/error.log\nCustomLog /backup2/apache_logs/uaportal_site/access.log combined\n<Directory \"/\">\n  AllowOverride All\n</Directory>\n#LogFormat \"%s \\\"%r\\\" %{referer}i %h %t\"\n#TransferLog /data/uaportal_site/logs/access.log\nServerAlias uaportal.com\nScriptAlias /cgi-bin-cd/ \"/data/uaportal_site/cgi-bin-cd/\"\n#<Directory /data/uaportal_site/cgi-bin-cd/>\n#  CharsetDisable on\n#</Directory>\nSuexecUserGroup ua ua\nRedirect /TV http://tv.uaportal.com\nRedirect /Auto http://auto.uaportal.com\nRedirect /friends http://friends.uaportal.com\nRedirect /Personal http://personal.uaportal.com\nRedirect /sub http://www.uaportal.com\nRedirect /sub/friends http://friends.uaportal.com\nRedirect /sub/personal http://personal.uaportal.com\n    <IfModule mod_fastcgi.c>\n        <Location /cgi_bin/*.fcgi>\n            SetHandler fastcgi-script\n        </Location>\n    </IfModule>\n\n#### FOR AWSTATS\nAlias /awstatsclasses \"/usr/local/awstats/wwwroot/classes/\"\nAlias /awstatscss \"/usr/local/awstats/wwwroot/css/\"\nAlias /awstatsicons \"/usr/local/awstats/wwwroot/icon/\"\n#ScriptAlias /awstats/ \"/usr/local/awstats/wwwroot/cgi-bin/\"\nAlias /awstats \"/usr/local/awstats/wwwroot\"\n#####\n\n</VirtualHost>"}, {"count": 3, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 81348, "time": "2005-10-18T21:01:50Z", "bug_id": 35584, "creation_time": "2005-10-18T21:01:50Z", "is_private": false, "text": "(In reply to comment #2)\n> I have the same problem.\n\n[..cut..]\n \n> \n> Sometimes this code wrote files in ua:ua 0600 privilagies, sometimes in ua:ua\n0644.\n\n[..cut..]\n\nSorry, but this is not the same problem. Your files get written with the correct\nuid/gid in both cases. Different umasks seem to be used when executing your\nscript (077 in the first case 022 in the second case)."}, {"count": 4, "tags": [], "bug_id": 35584, "attachment_id": null, "text": "No response from original poster.", "id": 83435, "time": "2005-12-08T19:26:15Z", "creator": "slive@apache.org", "creation_time": "2005-12-08T19:26:15Z", "is_private": false}]
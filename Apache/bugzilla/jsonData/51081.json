[{"count": 0, "attachment_id": 26900, "bug_id": 51081, "is_private": false, "id": 145844, "time": "2011-04-18T22:11:59Z", "creator": "thangaraj@gmail.com", "creation_time": "2011-04-18T22:11:59Z", "tags": [], "text": "Created attachment 26900\nFix for RotateLogs.exe to overwrite logs having less granular time formatted names\n\nProblem:\nRotateLogs.exe with less granular time formatted names keep growing thereby exhausting disk space. \n\n\nReproduction Steps:\n\n1. Edit httpd.conf file to contain following lines\n\nLogLevel debug\nErrorLog  \"|| bin/rotatelogs.exe logs/error-%Z.log 1M\"\n\n\n2. Run Apache for few hours.\n\nActual Result-  Log file size grows beyond 1 MB\n\nExpected Result- Log files should not grow beyond 1 MB, it should get overwitten.\n\nSolution:\nReset nAppend flag in RotateLogs.c such that size based rotation will overwrite existing file thereby honoring the given Size limit as stated in http://httpd.apache.org/docs/2.2/programs/rotatelogs.html\nCopying HTML exerpt here: When using strftime(3) filename formatting, be sure the log file format has enough granularity to produce a different file name each time the logs are rotated. Otherwise rotation will overwrite the same file instead of starting a new one. For example, if logfile was \"/var/logs/errorlog.%Y-%m-%d\" with log rotation at 5 megabytes, but 5 megabytes was reached twice in the same day, the same log file name would be produced and log rotation would keep writing to the same file."}, {"count": 1, "tags": [], "bug_id": 51081, "attachment_id": null, "id": 145868, "time": "2011-04-19T11:15:14Z", "creator": "wrowe@apache.org", "creation_time": "2011-04-19T11:15:14Z", "is_private": false, "text": "I'd vote -1 on this patch.\n\nrotatelogs is designed to be nondestructive, and you propose to add destructive\nbehavior to the log records."}, {"count": 2, "tags": [], "text": "(In reply to comment #1)\n> I'd vote -1 on this patch.\n> \n> rotatelogs is designed to be nondestructive, and you propose to add destructive\n> behavior to the log records.\n\nthis alarmed me as well, if you don't add reasonable granularity to the filename, letting it grow until someone notices is better than truncating it periodically.", "is_private": false, "id": 145870, "creation_time": "2011-04-19T13:03:58Z", "time": "2011-04-19T13:03:58Z", "creator": "covener@gmail.com", "bug_id": 51081, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 51081, "attachment_id": null, "id": 145871, "time": "2011-04-19T13:27:44Z", "creator": "thangaraj@gmail.com", "creation_time": "2011-04-19T13:27:44Z", "is_private": false, "text": "(In reply to comment #2)\n> (In reply to comment #1)\n> > I'd vote -1 on this patch.\n> > \n> > rotatelogs is designed to be nondestructive, and you propose to add destructive\n> > behavior to the log records.\n> this alarmed me as well, if you don't add reasonable granularity to the\n> filename, letting it grow until someone notices is better than truncating it\n> periodically.\n\nAppreciate your comments.\n\nThis path provides the best of both worlds - non-destructive and destructive modes of operation. \n\nIf users don't like destructive mode - they can use large file size option.\nIf users like me don't want Server disk space to be exhausted and prefer log overwriting they can use small file size as option with less granular time format (as mentioned in docs: http://httpd.apache.org/docs/2.2/programs/rotatelogs.html).\n\nIf Rotatelogs is meant to be non-destructive always - I'm trying to understand then why do we even have filesize option?"}, {"text": "> If Rotatelogs is meant to be non-destructive always - I'm trying to understand\n> then why do we even have filesize option?\n\nrotatelogs file size option is intended to allow the user to roll over at a given\nlimit, for archival purposes; not to destroy the log.  I would suggest that if\nyou want a destructive / sampling behavior as opposed to a record of operations,\nthen a new utility would be more appropriate than modifying rotatelogs.\n\nBased on two committers negative feedback to destructive operation, I'm going\nto mark this INVALID for now as the documentation is very clear, but further\nhttpd developer comments are welcome.\n\n\"When using strftime(3) filename formatting, be sure the log file format has enough granularity to produce a different file name each time the logs are rotated. Otherwise rotation will overwrite the same file instead of starting a new one. For example, if logfile was /var/logs/errorlog.%Y-%m-%d with log rotation at 5 megabytes, but 5 megabytes was reached twice in the same day, the same log file name would be produced and log rotation would keep writing to the same file.\"", "tags": [], "bug_id": 51081, "is_private": false, "count": 4, "id": 145872, "time": "2011-04-19T13:36:01Z", "creator": "wrowe@apache.org", "creation_time": "2011-04-19T13:36:01Z", "attachment_id": null}]
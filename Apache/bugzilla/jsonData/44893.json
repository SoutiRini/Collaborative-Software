[{"count": 0, "tags": [], "text": "The HSSFSheet method autoSizeColumn() explicitly ignored text in merged cells, and doesn't take indentation into consideration when calculating the preferred width of a column.  The included patch does the following:\n\nWhen it encounters a merged region in the column it will use the text of the left-most cell in that row of the merged region as the base for calculating width.  \n\nOn merged regions that do not span columns, this should always set the correct column width.  \n\nOn regions that span columns, the total width needed for the text of the merged region is divided by the number of columns the region spans, and that fraction of the width is used for the width of the current column.  The width of other columns in the merged region are not effected, so the total width of all the columns would not be properly set unless you called autoSizeColumn on every column in the merged region.  This approach can sometimes result in the combined widths of the spanned columns being greater that what is necessary to display the text in the merged region, but it is the only solution that I could think of that would provide consistent results.\n\nIf the HSSFStyle of the cell contains indentation, the width of the indentation is added to the calculated width necessary to display the text of the cell.", "is_private": false, "bug_id": 44893, "id": 115976, "time": "2008-04-28T11:46:30Z", "creator": "mhall@lakeland.net", "creation_time": "2008-04-28T11:46:30Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 44893, "attachment_id": 21871, "id": 115977, "time": "2008-04-28T11:47:13Z", "creator": "mhall@lakeland.net", "creation_time": "2008-04-28T11:47:13Z", "is_private": false, "text": "Created attachment 21871\nPatch to HSSFSheet.java"}, {"count": 2, "tags": [], "text": "What else do I need to do to get this patch added to the POI trunk?", "attachment_id": null, "bug_id": 44893, "id": 116235, "time": "2008-05-05T06:11:54Z", "creator": "mhall@lakeland.net", "creation_time": "2008-05-05T06:11:54Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 44893, "attachment_id": null, "id": 116236, "time": "2008-05-05T06:58:08Z", "creator": "yegor@dinom.ru", "creation_time": "2008-05-05T06:58:08Z", "is_private": false, "text": "Thanks for the patch. However, Excel does ignore merged cells when auto-sizing columns. See a similar bug report #43902.\nIf you have a test case demonstrating it is not so, please re-open and attach a sample xls and test code.\n\nI applied only the fix with indentation. \n\nYegor\n\t\n\n"}, {"count": 4, "tags": [], "creator": "mhall@lakeland.net", "attachment_id": null, "text": "I did notice that Excel seemed to ignore merged cells also, I didn't realize this would be a barrier for POI.  Is there a possibility of implementing this feature in some way that clearly denotes that it is not the same way Excel does it?  I can't be the only one who's needed to do this with POI.\n\nThanks for including the indentation bits anyway, its better than nothing.", "id": 116237, "time": "2008-05-05T07:13:42Z", "bug_id": 44893, "creation_time": "2008-05-05T07:13:42Z", "is_private": false}, {"count": 5, "tags": [], "text": "(In reply to comment #4)\n> I did notice that Excel seemed to ignore merged cells also, I didn't realize\n> this would be a barrier for POI.  Is there a possibility of implementing this\n> feature in some way that clearly denotes that it is not the same way Excel does\n> it?  I can't be the only one who's needed to do this with POI.\n> \n> Thanks for including the indentation bits anyway, its better than nothing.\n> \n\nWell, it's not a barrier for POI. I wrote autoSizeColumn to mimic Excel and this is why I didn't apply the first part of your patch.\n\nI think we can extend it and add autoSizeColumn(boolean useMergedCells). Default behavior is to ignore merged cells. \n\nThis way all will be happy :)\n\nRegards,\nYegor  ", "attachment_id": null, "bug_id": 44893, "id": 116241, "time": "2008-05-05T07:33:36Z", "creator": "yegor@dinom.ru", "creation_time": "2008-05-05T07:33:36Z", "is_private": false}, {"count": 6, "tags": [], "text": "Created attachment 21926\nAdded boolean flag to turn on use of merged columns in autosize\n\nChanged POI to create extra method signature: HSSFSheet#autoSizeColumn(short column, boolean useMergedCells)\n\nSo that the default behavior can be to ignore them, to preserve backwards compatibility, while giving developers the option to use them when desirable.", "is_private": false, "bug_id": 44893, "id": 116295, "time": "2008-05-06T06:50:06Z", "creator": "mhall@lakeland.net", "creation_time": "2008-05-06T06:50:06Z", "attachment_id": 21926}, {"count": 7, "attachment_id": null, "bug_id": 44893, "is_private": false, "id": 116296, "time": "2008-05-06T06:50:55Z", "creator": "mhall@lakeland.net", "creation_time": "2008-05-06T06:50:55Z", "tags": [], "text": "Reopened for new patch which provides an alternate method to auto-size using the content of merged cells."}, {"count": 8, "tags": [], "text": "Yegor,\n    Will this second patch be applied to POI?  I don't want to commit my application to using a modified POI if it won't be included in future versions.", "is_private": false, "id": 116429, "creator": "mhall@lakeland.net", "time": "2008-05-09T12:12:12Z", "bug_id": 44893, "creation_time": "2008-05-09T12:12:12Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 44893, "attachment_id": null, "id": 116475, "time": "2008-05-11T02:04:17Z", "creator": "yegor@dinom.ru", "creation_time": "2008-05-11T02:04:17Z", "is_private": false, "text": "Thanks for the patch. I applied it.\n\nYegor"}, {"attachment_id": null, "tags": [], "bug_id": 44893, "is_private": false, "count": 10, "id": 116557, "time": "2008-05-13T05:36:27Z", "creator": "mhall@lakeland.net", "creation_time": "2008-05-13T05:36:27Z", "text": "Thanks Yegor.  Will this make it into the final 3.1 release, or will it have to wait until the one after?"}, {"count": 11, "tags": [], "text": "(In reply to comment #10)\n> Thanks Yegor.  Will this make it into the final 3.1 release, or will it have to\n> wait until the one after?\n> \n\nYes, it will go in 3.1-final. ", "is_private": false, "id": 116558, "creator": "yegor@dinom.ru", "time": "2008-05-13T06:01:01Z", "bug_id": 44893, "creation_time": "2008-05-13T06:01:01Z", "attachment_id": null}]
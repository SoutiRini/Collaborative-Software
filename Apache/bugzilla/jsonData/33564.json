[{"count": 0, "text": "If Servlet Init Params are set in the DD for a jsp, the jsp cannot access those\nparams.\n\n*** DD:\n<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"\n         version=\"2.4\">\n\n    <servlet>\n     <jsp-file>/jspApp1.jsp</jsp-file>\n     <init-param>\n       <param-name>jspJspParm1</param-name>\n       <param-value>jspJspValue1</param-value>\n     </init-param>\n     <init-param>\n       <param-name>jspJspParm2</param-name>\n       <param-value>jspJspValue2</param-value>\n     </init-param>\n    </servlet>\n</web-app>\n\n*** JSP:\n<%@ page import=\"java.util.*\" %>\n<%!\n  public void jspInit() {\n    try {\n      System.out.println(\"Enter: jspInit()\");\n      ServletConfig sc = getServletConfig();\n      Enumeration e = sc.getInitParameterNames();\n      while (e.hasMoreElements()) \n        System.out.println(\"ServletConfig Param Name:\" + e.nextElement());\n\n      System.out.println(\"Exit: jspInit()\");\n    } catch (Exception e) {}\n  }\n%>\n<html><body bgcolor=black><font color=pink size=+2>\n<%= \"In _jspService()\" %>\n<%\n  Enumeration e = config.getInitParameterNames();\n  while (e.hasMoreElements()) \n    out.println(\"<p>ServletConfig Param Name:\" + e.nextElement());\n\n  out.println(\"<p>Exit: _jspService()\");\n%>\n</font></body></html>\n\n*** Output to Browser:\nIn _jspService()\nServletConfig Param Name:fork\nServletConfig Param Name:xpoweredBy\nExit: _jspService() \n\n*** Output to Catalina.out\nEnter: jspInit()\nServletConfig Param Name:fork\nServletConfig Param Name:xpoweredBy\nExit: jspInit()", "creator": "bruce.evans@sun.com", "attachment_id": null, "id": 70936, "time": "2005-02-14T17:20:50Z", "bug_id": 33564, "creation_time": "2005-02-14T17:20:50Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 33564, "attachment_id": null, "id": 70937, "time": "2005-02-14T17:38:20Z", "creator": "remm@apache.org", "creation_time": "2005-02-14T17:38:20Z", "is_private": false, "text": "I don't see why having a jsp-file would allow you to not use a servlet-mapping."}, {"count": 2, "tags": [], "bug_id": 33564, "attachment_id": null, "is_private": false, "id": 70955, "time": "2005-02-14T22:05:46Z", "creator": "b_basham@yahoo.com", "creation_time": "2005-02-14T22:05:46Z", "text": "I too have experienced this bug with Tomcat v5.0.28.\nThis is a bug on init. params. in the ServletConfig object for a JSP page.\nIt has nothing to do with servlet-mappings as you seem to indicate.\nI am reopening this bug."}, {"count": 3, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "text": "Your deployment descriptor isn't valid.  The <servlet> element is required to \nhave a <servlet-name> sub-element.  At that point, the init parameters will be \navailable to that servlet.  Of course, since your servlet isn't mapped, a \ntotally different servlet will service requests to /myapp/jspApp1.jsp.", "id": 70957, "time": "2005-02-14T22:25:43Z", "bug_id": 33564, "creation_time": "2005-02-14T22:25:43Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 33564, "attachment_id": null, "id": 70965, "time": "2005-02-14T23:03:52Z", "creator": "bruce.evans@sun.com", "creation_time": "2005-02-14T23:03:52Z", "is_private": false, "text": "Remy and William, as far as I can tell, you both are shooting from the hip.\nIt is clear that neither one of you have tried to implement this to verify it.\nIf you do not want to write some code (or copy) to verify, please provide a\nDD that you believe would fix the problem and I will verify it.\nI have also created a servlet and servlet-mapping in my DD and it does not\nmake any difference.  In fact, I don't see any tie between a Servlet and the\nJSP.  I can put the JSP URL in and no Servlet is accessed except for the JSP\nservlet.\n\nAs far as having a <servlet-name> element in the DD, it is not required,\notherwise I would have gotten an error when the DD was parsed."}, {"count": 5, "tags": [], "bug_id": 33564, "attachment_id": null, "id": 70966, "time": "2005-02-14T23:06:22Z", "creator": "remm@apache.org", "creation_time": "2005-02-14T23:06:22Z", "is_private": false, "text": "This is not our work to do. If you need help, please post on tomcat-user. Please\ndo not reopen the report."}, {"count": 6, "tags": [], "text": "Remy,\nI'm sorry, but your responses are un-acceptable.  If you are in a position to\ndetermine if a report is a bug or not, you need to give the detail that supports\nyour decision.  I am a customer using this product and I am receiving sub-standard\nsupport.  In the time it would have taken you to write an understandable response,\nyou have just prolonged this.  If you do not know the answer to this, then please\ndefer on responding.", "is_private": false, "id": 70971, "creator": "bruce.evans@sun.com", "time": "2005-02-14T23:46:12Z", "bug_id": 33564, "creation_time": "2005-02-14T23:46:12Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 33564, "is_private": false, "id": 70972, "attachment_id": null, "creator": "yoavs@computer.org", "creation_time": "2005-02-15T00:07:28Z", "time": "2005-02-15T00:07:28Z", "text": "Un-acceptable? ;)  If you were paying Remy before, I suggest you don't do so \nanymore.  Heck, fire him ;)  Please...  Now, a bit more seriously:\n\nAs far as I know servlet-name is a require child of the servlet element in the \nServlet Specification v2.4.  If you look at SRV.13.3, on page 127 of the spec \nv2.4, there's no minOccurs=\"0\" in the XSD.  So here are a couple of things to \ntry with regards to your deployment descriptor:\n1. Validate it using an external tool like XMLSpy.\n2. Add <servlet-name>BlahBlah</servlet-name> to your <servlet> element, and \nthen a corresponding <servlet-mapping> element for BlahBlah in your deployment \ndescriptor.  Restart Tomcat and see if the behavior changes: whether it does \nor doesn't, you can report your findings and at least contradict Remy/William \nwith some evidence rather than \"you're shooting from the hip.\"\n\nAnother thing that would be helpful is to post a simple WAR we can use to \nreproduce your testing.\n\nYet another good practice is to use a stable release for testing: 5.5.4 is not \na stable Tomcat release IIRC.  5.5.7 is, meaning it passed the TCKs.  If I \nwere you, I would (re)test against a stable release.\n\nTo Bryan's comment: 5.0.x and 5.5.x are different branches of Tomcat with \nsignificant relevant code changes.  The same advice I gave Bruce above is \napplicable to you as well.  If you could post a WAR of your test setup so that \nwe may reproduce your tests, that'd be good too."}, {"count": 8, "tags": [], "bug_id": 33564, "is_private": false, "id": 70978, "attachment_id": null, "creator": "william.barker@wilshire.com", "creation_time": "2005-02-15T01:27:10Z", "time": "2005-02-15T01:27:10Z", "text": "(In reply to comment #7)\n> Un-acceptable? ;)  If you were paying Remy before, I suggest you don't do so \n> anymore.  Heck, fire him ;)  Please...  Now, a bit more seriously:\nUrm, I think that they tried that already ;-).\n\nHaving a spare minute, tried this on 5.5.7 with a valid deployment descriptor, \nand to nobody's surprise Tomcat worked as expected.\n\nAs Remy so nicely tried to point out, if you want unpaid consulting help to \nfix your bugs, the place to look is tomcat-user.\n\n"}, {"count": 9, "tags": [], "bug_id": 33564, "attachment_id": null, "id": 70981, "time": "2005-02-15T02:36:44Z", "creator": "jfarcand@apache.org", "creation_time": "2005-02-15T02:36:44Z", "is_private": false, "text": "(In reply to comment #7)\n> Un-acceptable? ;)  If you were paying Remy before, I suggest you don't do so \n> anymore.  Heck, fire him ;)  Please...  Now, a bit more seriously:\n> \n> As far as I know servlet-name is a require child of the servlet element in the \n> Servlet Specification v2.4.  If you look at SRV.13.3, on page 127 of the spec \n> v2.4, there's no minOccurs=\"0\" in the XSD.  So here are a couple of things to \n> try with regards to your deployment descriptor:\n> 1. Validate it using an external tool like XMLSpy.\n> 2. Add <servlet-name>BlahBlah</servlet-name> to your <servlet> element, and \n> then a corresponding <servlet-mapping> element for BlahBlah in your deployment \n> descriptor.  Restart Tomcat and see if the behavior changes: whether it does \n> or doesn't, you can report your findings and at least contradict Remy/William \n> with some evidence rather than \"you're shooting from the hip.\"\n> \n> Another thing that would be helpful is to post a simple WAR we can use to \n> reproduce your testing.\n> \n> Yet another good practice is to use a stable release for testing: 5.5.4 is not \n> a stable Tomcat release IIRC.  5.5.7 is, meaning it passed the TCKs.  If I \n> were you, I would (re)test against a stable release.\n> \n> To Bryan's comment: 5.0.x and 5.5.x are different branches of Tomcat with \n> significant relevant code changes.  The same advice I gave Bruce above is \n> applicable to you as well.  If you could post a WAR of your test setup so that \n> we may reproduce your tests, that'd be good too.\n\nInstead of XML Spy, just turn on XML validation ;-):\n\n      <Host name=\"localhost\" appBase=\"webapps\"\n       unpackWARs=\"true\" autoDeploy=\"true\"\n       xmlValidation=\"true\" xmlNamespaceAware=\"false\">\n\n(xmlValidation == true). \n\n\n\n"}, {"count": 10, "text": "Created attachment 14288\nThis webapp demonstrates the bug.\n\nThe web.xml file has been fixed to include the <servlet-name> declaration. \nThis did not fix the bug that we are seeing.  PLEASE: let's concentrate on the\nbug at hand: a servlet definition with a jsp-file element does not seem to\nassign the declared init. params. to the JSP instance at init-time nor at\nrequest-time.\n-Bryan", "creator": "b_basham@yahoo.com", "is_private": false, "id": 71012, "time": "2005-02-15T17:27:00Z", "bug_id": 33564, "creation_time": "2005-02-15T17:27:00Z", "tags": [], "attachment_id": 14288}, {"count": 11, "tags": [], "creator": "b_basham@yahoo.com", "is_private": false, "text": "Comment on attachment 14288\nThis webapp demonstrates the bug.\n\nI have now tested this webapp on two stable versions: 5.0.28 and 5.5.7.", "id": 71013, "time": "2005-02-15T17:41:11Z", "bug_id": 33564, "creation_time": "2005-02-15T17:41:11Z", "attachment_id": 14288}, {"count": 12, "tags": [], "creator": "b_basham@yahoo.com", "is_private": false, "text": "Created attachment 14289\nNew webapp with new behavior.\n\nHello again,\n\nWe are getting closer.\tBruce discovered that the 'fork' and 'xpoweredBy' init\nparams are coming from the JSP invoker servlet defined in conf/web.xml.  So...\nit seems clear that Tomcat is using this servlet definition rather than our\nservlet definition.\n\nSo, I concluded that I needed a servlet mapping (to override the primary JSP\ninvoker mapping).  So in this WAR file I have added a servlet-mapping element\nfor the /index.jsp servlet.  Now... I am seeing both sets of init params in my\nJSP page.  Is that really how it should work?  Should every JSP page include\nthe init params for the JSP invoker?  This seems odd, but easily worked-around.\n\n\n-Bryan", "id": 71016, "time": "2005-02-15T18:13:49Z", "bug_id": 33564, "creation_time": "2005-02-15T18:13:49Z", "attachment_id": 14289}, {"count": 13, "tags": [], "bug_id": 33564, "attachment_id": null, "is_private": false, "id": 71020, "time": "2005-02-15T18:21:56Z", "creator": "yoavs@computer.org", "creation_time": "2005-02-15T18:21:56Z", "text": "That's not surprising (to us at least), because a <servlet> tag is nice by \nitself but doesn't mean anything, seeing as how it's never used because it \ndoesn't match any URL-pattern.  So your JSP page still matches the JSPServlet \nbecause of its *.jsp mapping.  This is what the initial responses to this \nissue (the ones dismissed as \"shooting from the hip\" ;)) meant.\n\nYou have a couple of options, by the way.  You can precisely map \nyour \"servlet.\"  You can customize Tomcat's JSPServlet (or a copy of it) to \nfit your needs.  You can use application-level parameters, the ones that go \nunder the <web-app> element in web.xml and not in a <servlet> tag.  You can \nuse resource or env-entry references to accomplish these same things.  Pretty \nmuch any of these are better than the approach of declaring a <servlet> tag \nfor a JSP page.\n\nAnd of course, none of these are a Tomcat bug, and the initial responses \n(although possibly curt, or simply expecting a high level of knowledge from \nthe reader) were right on."}, {"count": 14, "tags": [], "creator": "b_basham@yahoo.com", "attachment_id": null, "text": "Thanks for the more detailed response.\n\nMay I ask a question:  Why would my JSP config object have *both* my params\n*and* the params from the JSP invoker?  I would expect one set or the other, but\nI would not expect both combined into one set of init params for both servlet\ndefinitions.\nJust curious.\n\nThanks,\nBryan\n", "id": 71027, "time": "2005-02-15T19:05:06Z", "bug_id": 33564, "creation_time": "2005-02-15T19:05:06Z", "is_private": false}]
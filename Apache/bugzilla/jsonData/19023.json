[{"count": 0, "tags": [], "text": "Set up Apache 2.0.45 or earlier to function as a proxy server.\nBlock more than one site with the NoProxy directive.\nMake the proxy serve a URL which does not match the blocked sites.\nObserve Apache die.\n\nThe problem was identified to routine ap_proxy_checkproxyblock. It has 3 nested\nloops. If the innermost loop is run to completion, uri_addr is set to NULL,\nwhich is then used on the next iteration of the outer loop. The patch below\nfixes the problem.\n\n--- proxy_util.c\t14 Apr 2003 09:49:53 -0000\t1.3\n+++ proxy_util.c\t14 Apr 2003 14:21:42 -0000\t1.4\n@@ -1015,10 +1015,12 @@\n                              apr_sockaddr_t *uri_addr)\n {\n     int j;\n+\tapr_sockaddr_t * src_uri_addr = uri_addr;\n     /* XXX FIXME: conf->noproxies->elts is part of an opaque structure */\n     for (j = 0; j < conf->noproxies->nelts; j++) {\n         struct noproxy_entry *npent = (struct noproxy_entry *)\nconf->noproxies->elts;\n         struct apr_sockaddr_t *conf_addr = npent[j].addr;\n+\t\turi_addr = src_uri_addr;\n         ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,\n                      \"proxy: checking remote machine [%s] against [%s]\",\nuri_addr->hostname, npent[j].name);\n         if ((npent[j].name && ap_strstr_c(uri_addr->hostname, npent[j].name))", "is_private": false, "bug_id": 19023, "id": 35175, "time": "2003-04-15T09:22:42Z", "creator": "sami.tikka@f-secure.com", "creation_time": "2003-04-15T09:22:42Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 19023, "is_private": false, "text": "Err... my mistake... The bug happens when iterating the conf->noproxies table,\nwhich is initialized from ProxyBlock directive, not NoProxy like I claimed\nbefore. Otherwise the previous report is accurate.", "id": 35176, "time": "2003-04-15T09:29:11Z", "creator": "sami.tikka@f-secure.com", "creation_time": "2003-04-15T09:29:11Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 19023, "attachment_id": null, "text": "Patch applied to v2.0.46 and v2.1.0\n", "id": 35229, "time": "2003-04-15T16:11:52Z", "creator": "minfrin@sharp.fm", "creation_time": "2003-04-15T16:11:52Z", "is_private": false}]
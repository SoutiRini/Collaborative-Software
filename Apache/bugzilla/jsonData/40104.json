[{"count": 0, "tags": [], "bug_id": 40104, "attachment_id": null, "is_private": false, "id": 91549, "time": "2006-07-24T17:09:26Z", "creator": "darryl@darrylmiles.org", "creation_time": "2006-07-24T17:09:26Z", "text": "org.apache.jasper.JasperException: Exception in JSP: /WEB-INF/template/debug.jspf:4\n\n1: <%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\"\npageEncoding=\"UTF-8\" isErrorPage=\"true\"%>\n2: <%@ taglib uri=\"http://java.sun.com/jsp/jstl/core\" prefix=\"c\" %>\n3: <%@ taglib uri=\"http://java.sun.com/jsp/jstl/fmt\" prefix=\"fmt\" %>\n4: <%@ taglib prefix=\"g\" uri=\"http://domain.com/taglibs/generic-0.1\" %>\n5: <jsp:directive.page import=\"java.io.*\"/>\n6: <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">\n7: <html>\n\nStacktrace:\n        at\norg.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:510)\n        at\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:375)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:314)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:264)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n...SNIP...\n\n\nThe exception correctly reports the point of the error:\n/WEB-INF/template/debug.jspf:4\n\nBut the 7 lines of context are actually from the file\n/WEB-INF/template/errorpage.jsp\n\n\njasper/jasper2/src/share/org/apache/jasper/servlet/JspServletWrapper.java:471 uses:\n\n              // Read both files in, so we can inspect them\n              String[] jspLines = readFile\n                  (this.ctxt.getResourceAsStream(this.ctxt.getJspFile()));\n\n              String[] javaLines = readFile\n                  (new FileInputStream(this.ctxt.getServletJavaFileName()));\n\nIs that correctly picking up the context from the exception information ?\n\nThe page debuig.jspf is added to a master page with:\n\n<%@ include file=\"/WEB-INF/template/debug.jspf\" %>\n\n\nThe exception looks like it created here:\n\nreturn new JasperException(\n                                           \"Exception in JSP: \" +\ndetail.getJspFileName() + \":\" +\n                                           jspLineNumber + \"\\n\\n\" + buffer +\n\"\\n\\nStacktrace:\", ex);\n\nThat uses detail.getJspFileName() not this.ctxt.getServletJavaFileName().\n\nI'm thinking both cases should use detail.getJspFileName().\n\n\nI have ErrorPages setup to /WEB-INF/template/errorpage.jsp."}, {"count": 1, "tags": [], "bug_id": 40104, "text": "Opps not this.ctxt.getServletJavaFileName().\n\nI meant to say I think this.ctxt.getJspFile() should be detail.getJspFileName()\n(or the equalvalent of)", "id": 91550, "time": "2006-07-24T17:13:42Z", "creator": "darryl@darrylmiles.org", "creation_time": "2006-07-24T17:13:42Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "This has been fixed in svn and will be included in 5.5.21 onwards.", "is_private": false, "id": 98044, "creator": "markt@apache.org", "time": "2007-01-14T14:49:07Z", "bug_id": 40104, "creation_time": "2007-01-14T14:49:07Z", "attachment_id": null}]
[{"count": 0, "tags": [], "text": "when using redhat, everything worked fine and\nhttps://www.privasphere.com/index_de.jsp got decoded correctly by MSIE or recent\nmozilla.\n\nafter moving to debian (latest stable), it no longer works:\nhttp://bugs.privasphere.com:8443/index_de.jsp (took away ssl and compression to\nmake it better sniffable).\nThe browsers think it is ISO-8859-1 and only after a manual change to UTF-8, the\numlauts show up correctly (for one page only).\n\nAs per all the bugs referenced in\nhttp://jakarta.apache.org/tomcat/faq/misc.html#tomcat5CharEncoding\nand the discussion in\nhttp://marc.theaimsgroup.com/?l=tomcat-user&m=108905503431227&w=2\nI did try to add \n<<useBodyEncodingForURI=\"true\"\nURIEncoding=\"UTF-8\">>\nto my server.xml with no effect.\n\non Redhat, my System.getProperty(\"file.encoding\") yields ISO-8859-1\nwhile on Debian first, it was ANSI_X3.4-1968, then I successively on the\noperating system level with /etc/environments and inside the servlet init()\n(System.setProperty(\"file.encoding\", ...)), I set it to ISO-8859-1 and UTF-8 -\nno effect.\n\nIs there another way to influence the HTTP header's?\nOn debian, I still get\n<<HTTP/1.1 200 OK\nContent-Type: text/html;charset=ISO-8859-1\nContent-Length: 6078\nDate: Thu, 18 Nov 2004 18:35:11 GMT\nServer: Apache-Coyote/1.1>>\n\nWhile on the redhat server (I'll only be able to sniff without SSL tomorrow), I\nsuspect this to be UTF-8?\nOr are there other reasons the browser could miss the page encoding albeit the\nbrowser-view-source shows no relevant differences in the page source?\n\nI fear that this bug gets closed invalid immediately as many before, but\nhopefully, it leads to some insight that could enhance the documentation or FAQ\nsuch that less people will not fall into this trap (so probably, this is an RFE)", "is_private": false, "bug_id": 32296, "id": 67164, "time": "2004-11-18T20:00:04Z", "creator": "hauser@acm.org", "creation_time": "2004-11-18T20:00:04Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 32296, "attachment_id": null, "is_private": false, "id": 67165, "time": "2004-11-18T20:10:12Z", "creator": "yoavs@computer.org", "creation_time": "2004-11-18T20:10:12Z", "text": "Why would you file a bug against Tomcat if the behavior change is clearly due \nto an OS change?  And please (this is at least the third time I'm asking you \nspecifically this) stop using Bugzilla as a discussion forum.  Only open \nBugzilla issues when you have a WAR or other simple test case ready to attach \nthat conclusively demonstrates a specific Tomcat bug.  For question, \ndiscussions, design ideas, workarounds for different platforms, etc, use the \nmailing list please.  Thank you."}, {"count": 2, "tags": [], "bug_id": 32296, "attachment_id": null, "is_private": false, "id": 67166, "time": "2004-11-18T20:12:35Z", "creator": "hauser@acm.org", "creation_time": "2004-11-18T20:12:35Z", "text": "in the tomcat source, I see that org.apache.coyote.Response.reset() defaults to\norg.apache.coyote.Constants.DEFAULT_CHARACTER_ENCODING\n\ni.e. public static final String DEFAULT_CHARACTER_ENCODING=\"ISO-8859-1\";\n\nso, why would that be different on RedHat (if the HTTP header really is the\nthing that drives the browser's encoding choice)?"}, {"count": 3, "tags": [], "bug_id": 32296, "attachment_id": null, "is_private": false, "id": 67167, "time": "2004-11-18T20:16:50Z", "creator": "hauser@acm.org", "creation_time": "2004-11-18T20:16:50Z", "text": "apologies, a Mid-air collision. 2 comments\n- my test-case is even easier than a WAR: two URLs\n- sure, the \"behavior change is clearly due to an OS change\", but as far as I\nunderstand, tomcat aspires to be portable, so one would hope to find hints on\nsuch issues in the config documentation ---> RFE"}, {"count": 4, "tags": [], "text": "Removing myself from the CC list.\n\nPlease don't add people to the CC list without at least first checking that \nthat is what they want. Added to which, adding a tomcat comitter is pretty \npointless as we get all the bugzilla mail anyway.", "attachment_id": null, "id": 67186, "creator": "markt@apache.org", "time": "2004-11-18T23:39:42Z", "bug_id": 32296, "creation_time": "2004-11-18T23:39:42Z", "is_private": false}, {"count": 5, "tags": [], "creator": "hauser@acm.org", "attachment_id": null, "id": 67201, "time": "2004-11-19T09:33:15Z", "bug_id": 32296, "creation_time": "2004-11-19T09:33:15Z", "is_private": false, "text": "so a Redhat HTTP header analysis: \n<<HTTP/1.1 200 OK Content-Type: text/html Connection: close Vary:\nAccept-Encoding Date: Fri, 19 Nov 2004 08:09:12 GMT Server: Apache-Coyote/1.1>>\ne.g. by \"tcpflow -i eth0 port 8443\" or http://livehttpheaders.mozdev.org shows:\n\n==> under Redhat no \"charset=...\" is sent at all, thus it appears that in this\ncase, the browsers decide upon the encoding stated in the page content\n\nTherefore, please document which environment variable drives coyote's HTTP\nheader Content-Type charset."}, {"count": 6, "tags": [], "text": "That has no place in our docs.  It's not a Tomcat issue.  Please don't reopen \nthis item.", "is_private": false, "bug_id": 32296, "id": 67224, "time": "2004-11-19T15:52:19Z", "creator": "yoavs@computer.org", "creation_time": "2004-11-19T15:52:19Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Finally solved it at least partially on the jsp level since I couldn't convince\ntomcat to do it:\neach jsp needs a \n  <%@ page contentType=\"text/html; charset=UTF-8\" %>\n\nif I only do  <%@ page contentType=\"text/html\" %> it remains on ISO-8859-1 as\nbefore.\n\nThe remaining problem is that the contents coming from the DB are now wrong\nwhile the static jsp content is correct (the jsp's being saved as UTF)\nIf I also set <%@ page pageEncoding=\"ISO-8859-1\" %> on each page, the static and\nDB content are now the same again, but unfortunately, both wrong while the http\nheader is correct.\n\n--------\nAnyway, I have also removed struts from my app and built a comparably small\nwar-File (0.5 MB) I am willing to share if anybody is interested.\n\nAlso, if others run into that issue too, here a log of some futile attempts to\nsolve it within tomcat:\n- as per void\norg.apache.catalina.util.CharsetMapper.addCharsetMappingFromDeploymentDescriptor(String\n\n locale, String charset), it appeared, that the redhat locale is not present in\napache.catalina.util.CharsetMapperDefault.properties \n\n- setting in the catalina.sh \nexport CHARMAP=\"UTF-8\"\nexport LANG=dummy\nexport LC_ALL=du_MY\nexport LANGUAGE=du\n\nto intentionally creating the suspected \"miss\" did not do it.\n\n- migrating the web.xml to http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd and\nadding\n</welcome-file-list>\n<locale-encoding-mapping-list>\n<locale-encoding-mapping><locale>en</locale><encoding>UTF-8</encoding></locale-encoding-mapping>\n...\ndidn't apparently solve it either.\n\n- since I use struts with redirect, setting for a single page \n        response.setHeader(\"Content-Type\", \"text/html;charset=UTF-8\");\ndidn't help either.\n\n- exchanging the CharsetMapperDefault.properties in the catalina.jar with an\nutf-ed verison didn't help either.\n\n- exchanging the Constants.class in the tomcat-coyote.jar with\nDEFAULT_CHARACTER_ENCODING=\"UTF-8\" didn't help either.\n\n- exchanging the LocaleToCharsetMap.class in the tomcat-coyote.jar an utf-ed\nverison didn't help either.", "is_private": false, "bug_id": 32296, "id": 67226, "time": "2004-11-19T16:05:18Z", "creator": "hauser@acm.org", "creation_time": "2004-11-19T16:05:18Z", "attachment_id": null}, {"count": 8, "tags": [], "text": "now, I got it to work, albeit in an ugly way:\nin void org.apache.coyote.http11.Http11Processor.prepareResponse()\ninstead of\n                headers.setValue(\"Content-Type\").setString(contentType);\ndo \n                if (contentType.startsWith(\"text/html\")) {\n                    headers.setValue(\"Content-Type\").setString(\n                            \"text/html;charset=UTF-8\");\n                } else {\n                    headers.setValue(\"Content-Type\").setString(contentType);\n                }\n\nand then replace that class in tomcat-http11.jar and all works fine (obviously\nonly for a site that serves all html pages in UTF-8).\n\nConclusion: Either it is a bug, or there must be another option to determine the\ncharset of the HTTP header that is not really obviously documented.", "attachment_id": null, "id": 67245, "creator": "hauser@acm.org", "time": "2004-11-19T18:38:40Z", "bug_id": 32296, "creation_time": "2004-11-19T18:38:40Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 32296, "attachment_id": null, "is_private": false, "id": 67255, "time": "2004-11-19T19:39:44Z", "creator": "markt@apache.org", "creation_time": "2004-11-19T19:39:44Z", "text": "A few comments that might help (although this is really a tomcat-user \ndiscussion and has no place on bugzilla)\n\n- useBodyEncodingForURI=\"true\" URIEncoding=\"UTF-8\" affect request processing \nand have nothing to do with the content-type sent to the browser\n\n- have you read the spec, specifically the errata\n\"http://www.jcp.org/aboutJava/communityprocess/maintenance/jsr053/errata_1_2_a_\n20020321.html\"?  As you will see, Tomcat is implementing the spec.\n\nI think you need to set both the content-type AND the page encoding. If you \nwish to discuss further, I am happy to discuss this but ONLY on the tomcat-\nuser mailing list."}, {"text": "in Struts, using <controller contentType=\"text/html;\ncharset=UTF-8\"> in my struts-config.xml as per Bug 32396\n\nMore also in\nhttp://www.mail-archive.com/tomcat-user%40jakarta.apache.org/msg141816.html", "tags": [], "bug_id": 32296, "is_private": false, "count": 10, "id": 67467, "time": "2004-11-25T21:22:30Z", "creator": "hauser@acm.org", "creation_time": "2004-11-25T21:22:30Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "see also Bug 34291 for a related issue", "attachment_id": null, "id": 73270, "creator": "hauser@acm.org", "time": "2005-04-04T20:13:14Z", "bug_id": 32296, "creation_time": "2005-04-04T20:13:14Z", "is_private": false}]
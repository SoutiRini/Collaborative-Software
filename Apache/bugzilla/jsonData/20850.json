[{"count": 0, "tags": [], "text": "posting data to tomcat I get the strangest error returned - sometimes.\nfirst of all this problem does not occur in tomcat 3.2\nIf I send several POSTs of data to tomcat in rapid succession (sequential, not \nsimultaneous) the first POST will process correctly, then mostly the second and \nsubsequent posts fail, but in a curious way. my servlet doPost method is called \nand I can process the header info just fine, but as soon as I try to grab the \ndata stream:\nBufferedInputStream cDataIn =  new BufferedInputStream(request.getInputStream\n());\nByteArrayOutputStream bo = new ByteArrayOutputStream();\n\t\t\t\tbyte[] buf = new byte[1];\n\t\t\t\tint len;\n\t\t\t\twhile((len = cDataIn.read(buf))!= -1 )\n\t\t\t\t{\n\t\t\t\t\tbo.write(buf);\n\t\t\t\t}\n\t\t\t\tbo.close();\n//-------------------------------------\ntomcat throws this error:\n java.net.SocketTimeoutException: Read timed out\n\tat java.net.SocketInputStream.socketRead0(Native Method)\n\tat java.net.SocketInputStream.read(SocketInputStream.java:116)\n\tat org.apache.coyote.http11.InternalInputBuffer.fill\n(InternalInputBuffer.java:777)\n\tat \norg.apache.coyote.http11.InternalInputBuffer$InputStreamInputBuffer.doRead\n(InternalInputBuffer.java:807)\n\tat org.apache.coyote.http11.filters.IdentityInputFilter.doRead\n(IdentityInputFilter.java:158)\n\tat org.apache.coyote.http11.InternalInputBuffer.doRead\n(InternalInputBuffer.java:742)\n\tat org.apache.coyote.Request.doRead(Request.java:431)\n\tat org.apache.coyote.tomcat4.CoyoteInputStream.readBytes\n(CoyoteInputStream.java:199)\n\tat org.apache.coyote.tomcat4.CoyoteInputStream.read\n(CoyoteInputStream.java:156)\n\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:183)\n\tat java.io.BufferedInputStream.read1(BufferedInputStream.java:222)\n\tat java.io.BufferedInputStream.read(BufferedInputStream.java:277)\n\tat java.io.FilterInputStream.read(FilterInputStream.java:90)\n\tat manifest.server.savefile.doPost(savefile.java:180)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:760)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:256)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:191)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2415)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat4.CoyoteAdapter.service\n(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:594)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:392)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:565)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:619)\n\tat java.lang.Thread.run(Thread.java:536)\n//----------------------------------------------\nAND returns via the http response this file to the sending client (including \nall the garbage)\n<html><head><title>Apache Tomcat/4.1.24 - Error report</title><STYLE><!--H1\n{font-family : sans-serif,Arial,Tahoma;color : white;background-color : \n#0086b2;} H3{font-family : sans-serif,Arial,Tahoma;color : white;background-\ncolor : #0086b2;} BODY{font-family : sans-serif,Arial,Tahoma;color : \nblack;background-color : white;} B{color : white;background-color : #0086b2;} HR\n{color : #0086b2;} --></STYLE> </head><body><h1>HTTP Status 501 - Method ?\n?\u0002??\u0011?&amp;_?Z?O?\u0013\u0002?4??m??f\t?\u0001????L??\u0018?Xe9??g??L?J6Ch\u0013?\u0004?????\u0013?\u000b??&amp;\u0013\u0004?h?\nMU???([?d2F\u0002=??`?????\u001c??x??\u0013?Z?\\/k;u7?Q9\u0015?HQ[sG&amp;6\u001d?FI??\u0013?c??U??\u001a????LL?hT?\n\u0019:???\u0019?B7?\u0014Y%???z\u001a\u0006?\u0013\u000e7v?9\u0016??????U?bR5\u0019y?ez?4??\u001ce?a????)??h\f?`\u0002\u0001?\u001d?Sz???y??\n&quot;??Yer7?S.?\u0002????K\u0003????*c\\\\@5~Q[?\u001b\u0005k???????????xf?L4??f3?\u0007^??yL\u001b???E/?%??#??\nPOST is not defined in RFC 2068 and is not supported by the Servlet API \n</h1><HR size=\"1\" noshade><p><b>type</b> Status report</p><p><b>message</b> \n<u>Method ?\n?\u0002??\u0011?&amp;_?Z?O?\u0013\u0002?4??m??f\t?\u0001????L??\u0018?Xe9??g??L?J6Ch\u0013?\u0004?????\u0013?\u000b??&amp;\u0013\u0004?h?\nMU???([?d2F\u0002=??`?????\u001c??x??\u0013?Z?\\/k;u7?Q9\u0015?HQ[sG&amp;6\u001d?FI??\u0013?c??U??\u001a????LL?hT?\n\u0019:???\u0019?B7?\u0014Y%???z\u001a\u0006?\u0013\u000e7v?9\u0016??????U?bR5\u0019y?ez?4??\u001ce?a????)??h\f?`\u0002\u0001?\u001d?Sz???y??\n&quot;??Yer7?S.?\u0002????K\u0003????*c\\\\@5~Q[?\u001b\u0005k???????????xf?L4??f3?\u0007^??yL\u001b???E/?%??#??\nPOST is not defined in RFC 2068 and is not supported by the Servlet API \n</u></p><p><b>description</b> <u>The server does not support the functionality \nneeded to fulfill this request (Method ?\n?\u0002??\u0011?&amp;_?Z?O?\u0013\u0002?4??m??f\t?\u0001????L??\u0018?Xe9??g??L?J6Ch\u0013?\u0004?????\u0013?\u000b??&amp;\u0013\u0004?h?\nMU???([?d2F\u0002=??`?????\u001c??x??\u0013?Z?\\/k;u7?Q9\u0015?HQ[sG&amp;6\u001d?FI??\u0013?c??U??\u001a????LL?hT?\n\u0019:???\u0019?B7?\u0014Y%???z\u001a\u0006?\u0013\u000e7v?9\u0016??????U?bR5\u0019y?ez?4??\u001ce?a????)??h\f?`\u0002\u0001?\u001d?Sz???y??\n&quot;??Yer7?S.?\u0002????K\u0003????*c\\\\@5~Q[?\u001b\u0005k???????????xf?L4??f3?\u0007^??yL\u001b???E/?%??#??\nPOST is not defined in RFC 2068 and is not supported by the Servlet \nAPI ).</u></p><HR size=\"1\" noshade><h3>Apache Tomcat/4.1.24</h3></body></html>\n\n//------------------------------------------------\nI have captured the POSTs in transit and I dont see any differences between \nones that work and ones that dont.\nI hope this can be resolved quickly.\nthis is also a bug in the new v5.0.2 Alpha release!!!!!\n\nsome interesting points. I have tried sending POSTS via the inet.ocx control in \na similar fashion without problem (but the control sux and is entirely \ninadequate for my purposes). I am sending data directly via the wininet.dll \nspecifically utilising the sendrequestex api function call.\nas far as the client is concerned it has sent data to tomcat.\nI reiterate  - this works perfectly in tomcat 3.2.\nTomcat 5.0.2 Alpha breaks but usually manages 2 fast sequential POSTS before \nthrowing this error:\n java.net.SocketTimeoutException: Read timed out\n\tat java.net.SocketInputStream.socketRead0(Native Method)\n\tat java.net.SocketInputStream.read(SocketInputStream.java:116)\n\tat org.apache.coyote.http11.InternalInputBuffer.fill\n(InternalInputBuffer.java:777)\n\tat \norg.apache.coyote.http11.InternalInputBuffer$InputStreamInputBuffer.doRead\n(InternalInputBuffer.java:807)\n\tat org.apache.coyote.http11.filters.IdentityInputFilter.doRead\n(IdentityInputFilter.java:158)\n\tat org.apache.coyote.http11.InternalInputBuffer.doRead\n(InternalInputBuffer.java:742)\n\tat org.apache.coyote.Request.doRead(Request.java:457)\n\tat org.apache.coyote.tomcat5.InputBuffer.realReadBytes\n(InputBuffer.java:320)\n\tat org.apache.tomcat.util.buf.ByteChunk.substract(ByteChunk.java:415)\n\tat org.apache.coyote.tomcat5.InputBuffer.read(InputBuffer.java:335)\n\tat org.apache.coyote.tomcat5.CoyoteInputStream.read\n(CoyoteInputStream.java:211)\n\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:183)\n\tat java.io.BufferedInputStream.read1(BufferedInputStream.java:222)\n\tat java.io.BufferedInputStream.read(BufferedInputStream.java:277)\n\tat java.io.FilterInputStream.read(FilterInputStream.java:90)\n\tat manifest.server.savefile.doPost(savefile.java:180)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:763)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat org.apache.catalina.servlets.InvokerServlet.serveRequest\n(InvokerServlet.java:466)\n\tat org.apache.catalina.servlets.InvokerServlet.doPost\n(InvokerServlet.java:216)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:763)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:856)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:288)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:206)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:263)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:561)\n\tat org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1018)\n\tat org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:196)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:561)\n\tat org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1018)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2748)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:186)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:149)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:561)\n\tat org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1018)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:163)\n\tat org.apache.catalina.core.StandardValveContext.invokeNext\n(StandardValveContext.java:151)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:561)\n\tat org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:1018)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service\n(CoyoteAdapter.java:199)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:630)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:463)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:568)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:631)\n\tat java.lang.Thread.run(Thread.java:536)", "is_private": false, "id": 38997, "creation_time": "2003-06-18T04:16:01Z", "time": "2003-06-18T04:16:01Z", "creator": "eacott@hardlight.com.au", "bug_id": 20850, "attachment_id": null}, {"count": 1, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "is_private": false, "id": 38999, "time": "2003-06-18T05:12:48Z", "bug_id": 20850, "creation_time": "2003-06-18T05:12:48Z", "text": "It goes without saying that if you could provide a test case, it would help a \nlot in discovering the problem.\n\nIt would also be helpful if you could re-test with setting \ndisableUploadTimeout=\"false\" on the Connector (since this affects the \"Read \nTimeout\" that you are seeing)."}, {"count": 2, "tags": [], "bug_id": 20850, "attachment_id": null, "text": "If you notice the response: HTTP Status 501 - Method ?\n?\u0002??\u0011?&amp;_?Z?O?\u0013\u0002?4??m??f\t?\u0001????L??\u0018?Xe9??g??\nYou'd see that the problem was that Tomcat didn't interpret the method name\nright (the binary content of your request was apparently read instead, hence the\n\"garbage\"). My opinion right now is that your request (or only some of them) is\nnot valid. At least you'll have to produce a valid request example if you want\nto keep the bug open (or of course, you can investigate and try to see what's\nwrong).", "id": 39001, "time": "2003-06-18T06:29:11Z", "creator": "remm@apache.org", "creation_time": "2003-06-18T06:29:11Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 20850, "attachment_id": null, "text": "aaargh - my bad,\nI was calling HttpEndRequest after the data POST but BEFORE receiving the \ntomcat response for the post!\nstill doesnt explain why it works sometimes, very reliably in some cases.\ndata was already sent prior to the HttpEndRequest, and the servlet doPOST \nmethod already well under way so I dont understand how this can be a \nmisinterpretation of what method to call. an unexpected situation serverside I \nagree, perhaps now it can be handled a bit better anyway.\n\n\n", "id": 39020, "time": "2003-06-18T11:42:35Z", "creator": "eacott@hardlight.com.au", "creation_time": "2003-06-18T11:42:35Z", "is_private": false}, {"count": 4, "tags": [], "text": "*** Bug 20851 has been marked as a duplicate of this bug. ***", "attachment_id": null, "bug_id": 20850, "id": 39261, "time": "2003-06-23T07:40:28Z", "creator": "remm@apache.org", "creation_time": "2003-06-23T07:40:28Z", "is_private": false}, {"count": 5, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 39262, "time": "2003-06-23T07:44:18Z", "bug_id": 20850, "creation_time": "2003-06-23T07:44:18Z", "text": "As I said, unless you are very careful about closing the connection after each\nrequest, you could end up with part of a previous request (here, some binary\ndata) being interpreted as part of the next request HTTP header. So it becomes\nquite random. I think Coyote is quite conservative in the request delimitation\nhandling, but there are situations where it can't be made to work consistently\nwhen dealing with a slightly broken client."}]
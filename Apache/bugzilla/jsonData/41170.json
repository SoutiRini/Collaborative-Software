[{"count": 0, "tags": [], "bug_id": 41170, "attachment_id": null, "id": 96872, "time": "2006-12-13T07:36:46Z", "creator": "conod@hotmail.com", "creation_time": "2006-12-13T07:36:46Z", "is_private": false, "text": "In modjk (latest version i could find ) for IIS there is a possible bug in \nfunction:\n\nstatic int JK_METHOD start_response(jk_ws_service_t *s,\n                                    int status,\n                                    const char *reason,\n                                    const char *const *header_names,\n                                    const char *const *header_values,\n                                    unsigned int num_of_headers)\n{\n\nIt creates a response buffer and it works fine if there are headers to send:\n\n            if (num_of_headers) {\n                             ...\n            else {\nhowever if there are no headers to send it merely sends a single crlf in the \nheader buffer. \n                headers_str = crlf;\n            }\n}\n\nThe description for HSE_REQ_SEND_RESPONSE_HEADER at:\nhttp://msdn.microsoft.com/library/default.asp?url=/library/en-\nus/iissdk/html/ad17aeb4-bb70-4755-83a2-c4cec7fa5ecb.asp\n\n\"If you append your own headers to the server-generated headers, you must \nterminate the header string with an extra carriage return and linefeed.\"\n\nalso seems to mean that once you have no headers to send then you need to make \nsure you terminate the header by adding an extra crlf (double crlf) as per the \nRFC\n\nSo sending a single crlf would not be valid (browsers will ignore error this \nbut we ran into an app called documentum that crashes while parsing the header.)\n\nOddly enough IIS copes with and seems to correct the header (at least in Win2K3 \nSP1) except in one case and that is where another ISAPI filter is chained on \nand in the NOTIFY_SEND_RESPONSE and that filter READS the www-authenticate \nheader!!! then IIS passes the buffer that mod_jk sends it transparently and the \nclient sees the header with a single crlf.\n\nAppending an additional crlf when there is no header seems to take care of the \nproblem.\n\nHope this is enough detail please feel free to contact me !\n\nall the Best\nCon\n\n\n\n\n."}, {"count": 1, "tags": [], "bug_id": 41170, "attachment_id": null, "id": 100889, "time": "2007-03-25T09:23:11Z", "creator": "yoavs@computer.org", "creation_time": "2007-03-25T09:23:11Z", "is_private": false, "text": "Con, we've had a few mod_jk releases since your bug post.  Can you please\nconfirm that this issue still happens with the latest mod_jk (1.2.21 I believe)\nand Tomcat (6.0.10 or 5.5.23)?"}, {"count": 2, "attachment_id": null, "creator": "Tim.Whittington@orionhealth.com", "text": "I don't believe this is a bug in the IIS connector.\nThe docs for HSE_REQ_SEND_RESPONSE_HEADER indicate (in classic IIS style) that if you supply your own headers, you need to provide the CRLF that terminates the message header (as per http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html#sec4) as well as the CRLF terminating each header - i.e. for no headers, you would supply a CRLF\\0 string.\n\nThis is what the code does now (and what it looked like doing in 2006).", "id": 133290, "time": "2010-01-03T23:32:14Z", "bug_id": 41170, "creation_time": "2010-01-03T23:32:14Z", "tags": [], "is_private": false}, {"count": 3, "text": "Noone has noticed this causing an issue since the report, and the code seems correct on inspection, so I'm closing this for now.", "bug_id": 41170, "is_private": false, "id": 142141, "time": "2010-11-29T14:04:08Z", "creator": "timw@apache.org", "creation_time": "2010-11-29T14:04:08Z", "tags": [], "attachment_id": null}]
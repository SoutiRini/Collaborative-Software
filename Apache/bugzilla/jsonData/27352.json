[{"count": 0, "tags": [], "bug_id": 27352, "attachment_id": null, "id": 53298, "time": "2004-03-02T00:31:14Z", "creator": "ast@domdv.de", "creation_time": "2004-03-02T00:31:14Z", "is_private": false, "text": "Let's assume we have a request to http://httpd.apache.org/\n\nNow let's convert httpd.apache.org to other representations:\n\nhttpd.apache.org = 209.237.227.195\n209.237.227.195  = 0xd1ede3c3\n0xd1ede3c3       = 3522028483\n\nSo from the browser's point of view all the following is identical:\n\nhttp://httpd.apache.org/\nhttp://209.237.227.195/\nhttp://3522028483/\n\nThe latter is where fix_hostname() in server/vhost.c misbehaves.\nIt calls apr_parse_addr_port() to split host and port number.\napr_parse_addr_port() itself decides as the host is a pure number\nthat it must be a port number which is then naturally illegal as\nit is greater than 65535. As apr_parse_addr_port() now returns\nan error fix_hostname() fails and returns HTTP_BAD_REQUEST.\n\nThere are two ways to fix this. Either treat the number as a hostname\nwhich will cause differing views between browser and server or use\nsuch a number as an IP if it is within a valid IP range. The latter\nshould be preferred but it has security implications as long as\nthe decimal number is not converted back into standard dotted notation.\nThese implications are simply that nearly all configurations detect\nIPs only in the dotted notation and there will be lots of side effects\nif e.g. scripts would get the decimal IP representation instead of the\ndotted one. And for security considerations think especially of the\nimplications for mod_proxy.\n\nA side effect of this misbehaviour seems to be that the ErrorDocument\ndirective doesn't work in this case."}, {"count": 1, "tags": [], "creator": "slive@apache.org", "attachment_id": null, "is_private": false, "id": 53300, "time": "2004-03-02T04:11:15Z", "bug_id": 27352, "creation_time": "2004-03-02T04:11:15Z", "text": "\"Bad Request\" seems like perfect handling to me.\n\nRFC2396 doesn't seem to allow that notation for an IP address in a URI,\nand it certainly isn't legal as an Internet hostname.  Allowing that sort\nof thing to pass through would, as you've noted, have all sorts of potential\nsecurity implications."}, {"count": 2, "tags": [], "bug_id": 27352, "text": "Amen.\n\nSome browser do support those squeezed IP address notations, but there's nowhere\na standard for them. From a pov of an URI, they are simply illegal.", "id": 53305, "time": "2004-03-02T05:19:40Z", "creator": "nd@perlig.de", "creation_time": "2004-03-02T05:19:40Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "ast@domdv.de", "attachment_id": null, "is_private": false, "id": 53310, "time": "2004-03-02T09:35:16Z", "bug_id": 27352, "creation_time": "2004-03-02T09:35:16Z", "text": "That this kind of IPs won't be handled is fair enough.\n\nThere is, however, still the problem, that the ErrorDocument\ndirective does NOT work in this case."}, {"text": "The ErrorDocument problem is located in server/protocol.c, line 972:\n\n    if (r->status != HTTP_OK) {\n        ap_send_error_response(r, 0);\n        ap_run_log_transaction(r);\n        return r;\n    }\n\nap_send_error_response doesn't handle other custom error documents than\nstrings. Either ap_die() should be called (I don't know if this is possible\nat this point) or it must be documented that:\n\nErrorDocument 400 \"string\"\n\nis the only valid option for error type 400. There is already a restriction\nfor 401 type errors in the documentation so just documenting the 400\nrestriction would be ok.\n", "tags": [], "bug_id": 27352, "attachment_id": null, "count": 4, "id": 53337, "time": "2004-03-02T17:22:32Z", "creator": "ast@domdv.de", "creation_time": "2004-03-02T17:22:32Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 27352, "is_private": false, "text": "Well, accepting as documentation bug.\n\nThe point is, there are some errors where custom error document cannot apply,\nbecause it's an too early stage. We need to figure out some good examples and\ndrop a note on the errordocument docs.\n\nErrorDocument 400 /local/url usually works fine - you've just hit such a\nproblematic case.", "id": 53340, "time": "2004-03-02T19:31:23Z", "creator": "nd@perlig.de", "creation_time": "2004-03-02T19:31:23Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 27352, "is_private": false, "text": "I've added a note to ErrorDocument.\n\n(But this same issue affects lots of other directives.  When a bad request is\nreceived, almost nothing from the config file is applied.  We're not going to go\nthrough and note this on every directive affected.)", "id": 74401, "time": "2005-05-03T21:10:58Z", "creator": "slive@apache.org", "creation_time": "2005-05-03T21:10:58Z", "attachment_id": null}]
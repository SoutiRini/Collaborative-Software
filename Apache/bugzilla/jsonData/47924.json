[{"count": 0, "tags": [], "text": "Created attachment 24328\nstandalone quickfix for testing\n\nThe method getCellComment() located at HSSFCell may return a wrong comment if\nmore comments have been added later.\n\nProblem: The method HSSFCell.findCellComment() makes an assumption about\n         the ordering of text records that is probably wrong.\n         Line 1084\n         \" //find the next TextObjectRecord which holds the comment's text\n           //the order of TXO matches the order of NoteRecords: i-th TXO record \n             corresponds to the i-th NoteRecord\"         \n\nSteps to reproduce:\n\n- create an excel sheet with some cell comments\n- close and re-open it\n- add a new comment to a cell above(!) the existing comments\n- go through existing cells and output the result of cell.getCellComment()\n\nSome comments will not match these you typed in in excel.\n\n\nSolution proposal: \n==================\nMatch objectId of text record with note's shape Id for\na correct assignment.\n\nReplace list by a map in line 1057\n      Map<Integer, TextObjectRecord> noteTxo = \n                       new HashMap<Integer, TextObjectRecord>();\nChange line 1089\n      noteTxo.put(cmo.getObjectId(), (TextObjectRecord) rec);\n\nChange line 1065\n      TextObjectRecord txo = noteTxo.get(note.getShapeId());\n\nWARNING: This is a new assumption. I did not verify this under all\ncircumstances or against documentation. But in my environment it runs fine.\n\nFor those being in a hurry I attach a standalone quick fix hack (works without\npatching the jar).", "attachment_id": 24328, "id": 130768, "creator": "Karl.Eilebrecht@freenet.de", "time": "2009-10-01T04:31:08Z", "bug_id": 47924, "creation_time": "2009-10-01T04:31:08Z", "is_private": false}, {"count": 1, "tags": [], "text": "Karl,\n\nA very good catch, thanks!\n\nThe logic to match NoteRecord and TextObjectRecord should not rely on the order of records, instead it should match them by objectId, as you suggested. I easily reproduced the bug in Excel 2003 and Excel 2007. \n\nP.S. I wrote this code some years ago when the Excel spec was closed. Most of it was derived by trial and error and hence can be not optimal.\n\nRegards,\nYegor", "attachment_id": null, "id": 131498, "creation_time": "2009-10-29T09:56:05Z", "time": "2009-10-29T09:56:05Z", "creator": "yegor@dinom.ru", "bug_id": 47924, "is_private": false}]
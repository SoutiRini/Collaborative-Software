[{"count": 0, "tags": [], "bug_id": 57070, "text": "This .htaccess file causes a NULL dereference in ssl_var_lookup_ssl, when visited over a non-HTTPS connection:\n\n<If \"%{SSL_CLIENT_S_DN_Email} != ''\">\n</If>\n\nBacktrace:\n\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  ssl_var_lookup_ssl (p=0x7f4f140028f8, r=0x7f4f14002970, var=0x7f4f1400e0b4 \"CLIENT_S_DN_Email\", c=<optimized out>) at ssl_engine_vars.c:344\n344\t    ssl = sslconn->ssl;\nMissing separate debuginfos, use: debuginfo-install nss-pam-ldapd-0.8.13-4.fc20.x86_64 nss_nonlocal-2.1-1.x86_64\n(gdb) bt\n#0  ssl_var_lookup_ssl (p=0x7f4f140028f8, r=0x7f4f14002970, var=0x7f4f1400e0b4 \"CLIENT_S_DN_Email\", c=<optimized out>) at ssl_engine_vars.c:344\n#1  0x00007f4f537d6ce7 in ap_expr_eval_word ()\n#2  0x00007f4f537d71f6 in ap_expr_eval_comp ()\n#3  0x00007f4f537d74a0 in ap_expr_eval ()\n#4  0x00007f4f537d7e98 in ap_expr_exec_ctx ()\n#5  0x00007f4f537d81d8 in ap_expr_exec_re ()\n#6  0x00007f4f537d25be in ap_if_walk ()\n#7  0x00007f4f537d28e2 in ap_process_request_internal ()\n#8  0x00007f4f537ee9e8 in ap_process_async_request ()\n#9  0x00007f4f537eecd4 in ap_process_request ()\n#10 0x00007f4f537eb692 in ap_process_http_connection ()\n#11 0x00007f4f537e34d0 in ap_run_process_connection ()\n#12 0x00007f4f513e353b in process_socket (bucket_alloc=0x7f4f140008e8, my_thread_num=25, my_child_num=2, sock=0x7f4f40014290, p=0x7f4f40014208, \n    thd=0x7f4f554fc120) at worker.c:619\n#13 worker_thread (thd=0x7f4f554fc120, dummy=<optimized out>) at worker.c:978\n#14 0x00007f4f5225aee5 in start_thread (arg=0x7f4f367ec700) at pthread_create.c:309\n#15 0x00007f4f51d85b8d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:111\n(gdb) info locals\nsslconn = 0x0\nresult = 0x0\nxs = <optimized out>\nsk = <optimized out>\nssl = <optimized out>", "id": 178356, "time": "2014-10-09T02:53:17Z", "creator": "andersk@mit.edu", "creation_time": "2014-10-09T02:53:17Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 57070, "text": "Can you please try the following patch?\n\nIndex: ssl_engine_vars.c\n===================================================================\n--- ssl_engine_vars.c   (revision 1630015)\n+++ ssl_engine_vars.c   (working copy)\n@@ -73,7 +73,9 @@\n static const char *expr_var_fn(ap_expr_eval_ctx_t *ctx, const void *data)\n {\n     char *var = (char *)data;\n-    return ssl_var_lookup_ssl(ctx->p, ctx->c, ctx->r, var);\n+    SSLConnRec *sslconn = myConnConfig(ctx->c);\n+\n+    return sslconn ? ssl_var_lookup_ssl(ctx->p, ctx->c, ctx->r, var) : \"\";\n }\n\n static int ssl_expr_lookup(ap_expr_lookup_parms *parms)", "id": 178359, "time": "2014-10-09T06:35:52Z", "creator": "rpluem@apache.org", "creation_time": "2014-10-09T06:35:52Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 57070, "text": "(In reply to Ruediger Pluem from comment #1)\n> -    return ssl_var_lookup_ssl(ctx->p, ctx->c, ctx->r, var);\n> +    SSLConnRec *sslconn = myConnConfig(ctx->c);\n> +\n> +    return sslconn ? ssl_var_lookup_ssl(ctx->p, ctx->c, ctx->r, var) : \"\";\n\nYeah, that fixes the crash.", "id": 178360, "time": "2014-10-09T07:38:30Z", "creator": "andersk@mit.edu", "creation_time": "2014-10-09T07:38:30Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 57070, "text": "Committed to trunk as r1630947.", "id": 178385, "time": "2014-10-10T17:56:15Z", "creator": "rpluem@apache.org", "creation_time": "2014-10-10T17:56:15Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "christophe.jaillet@wanadoo.fr", "attachment_id": null, "text": "Backported in 2.4.x in r1650659\n\nWill be part of 2.4.11", "id": 180248, "time": "2015-01-09T21:21:12Z", "bug_id": 57070, "creation_time": "2015-01-09T21:21:12Z", "is_private": false}]
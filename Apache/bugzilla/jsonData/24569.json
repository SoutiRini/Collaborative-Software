[{"count": 0, "tags": [], "text": "Running ant's task cvschangelog creates an output file that doesn't contain the \n<prevrevision> tag for all of the files.  Some files have this information and \nsome do not.  The files that have this information, will generate a valid link \nafter the <xslt> task is run.  \n\nWe have the same problems with Java source code as well as the Delphi code and \nwith Ant v1.5.4 and Ant 1.6Beta.\n\nI've also run a cvs log on both of these entries and can't see anything that \nwould cause this difference in code xml generation.\n-----------------------------------------------------------------------\nSample ant change log target:\n-----------------------------------------------------------------------\n\n<target name=\"clientChangeLog\" depends=\"JVMv1.4Test, init\" \n description=\"Create CVS Change Log for the Delphi Client Components\">\n\t\t\n<cvschangelog dir=\"${root.dir}\\xinsure_client\\auto\\src\\delphi\"\n\t\t\t\tdestfile=\"${templogfile}\"\n\t\t\t\tdaysinpast=\"${daysToCheck}\"/>\n\t\t\n    <echo>XML file created - converting to HTML</echo>\n    <delete file=\"${localDir}/${clientoutfile}\"/>\n\n    <!-- xslt requires version Java v1.4 -->\n    <xslt in=\"${templogfile}\" \n          out=\"${localDir}/${clientoutfile}\"\n          style=\"${ant.home}\\etc\\changelog.xsl\">\n        <param name=\"title\" expression=\"Client Change Log - Last ${daysToCheck} \nDays\"/>\n        <param name=\"module\" \nexpression=\"xinsure/xinsure_client/auto/src/delphi\"/>\n        <param name=\"cvsweb\" expression=\"http://localhost/cgi-\nbin/viewcvs/viewcvs.cgi/\"/>       \n    </xslt>\n\n</target>\n\n-----------------------------------------------------------------------\nSample cvschangelog result - first file listed doesn't have the \n<prerevision> tag, second file does.\n-----------------------------------------------------------------------\n<changelog>\n  <entry>\n\t<date>2003-11-06</date>\n\t<time>15:44</time>\n\t<author><![CDATA[khusby]]></author>\n\t<file>\n\t\t<name>info3/InfoThinDaapi.pas</name>\n\t\t<revision>1.255</revision>\n\t</file>\n\t<msg><![CDATA[Bug 3252 correct problem of A transactions showing on the \nCurrent tab of a policy when those transactions are Closed.]]></msg>\n  </entry>\n  <entry>\n\t<date>2003-11-07</date>\n\t<time>23:23</time>\n\t<author><![CDATA[khusby]]></author>\n\t<file>\n\t\t<name>info3/InfoThinDaapi.pas</name>\n\t\t<revision>1.256</revision>\n\t\t<prevrevision>1.255</prevrevision>\n\t</file>\n\t<msg><![CDATA[Bug 3535 modified client to prevent the creation of blank \ncollateral if an empty space is in the collatoral portion of the loan edit.]]\n></msg>\n </entry>\n</changelog>\n\n-----------------------------------------------------------------------\nSample xslt result - just the two links, the first link (revision 1.256)\ngenerates a valid url.  The second link (revision 1.255) creates a link\nthat is wanting to download the source file instead of showing the cvs\nrevision information.\n-----------------------------------------------------------------------\n<a href=\"http://localhost/cgi-\nbin/viewcvs/viewcvs.cgi/xinsure/xinsure_client/auto/src/delphi/info3/InfoThinDaa\npi.pas?r1=1.256&r2=1.255\">info3/InfoThinDaapi.pas (1.256)</a>\n\n<a href=\"http://localhost/cgi-\nbin/viewcvs/viewcvs.cgi/xinsure/xinsure_client/auto/src/delphi/info3/InfoThinDaa\npi.pas?rev=1.255&content-type=text/x-cvsweb-markup\">info3/InfoThinDaapi.pas \n(1.255)</a>", "attachment_id": null, "bug_id": 24569, "id": 47123, "time": "2003-11-10T17:08:27Z", "creator": "rick_cromer@hotmail.com", "creation_time": "2003-11-10T17:08:27Z", "is_private": false}, {"count": 1, "tags": [], "text": "Hello,\nwould you mind trying ant 1.6.1 or ant 1.6.2\nThe cvschangelog task implementation has been changed quite a bit between 1.6.0\nand 1.6.1", "is_private": false, "bug_id": 24569, "id": 60769, "time": "2004-07-18T14:53:23Z", "creator": "antoine@apache.org", "creation_time": "2004-07-18T14:53:23Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "rick_cromer@hotmail.com", "is_private": false, "count": 2, "id": 61146, "time": "2004-07-26T17:33:18Z", "bug_id": 24569, "creation_time": "2004-07-26T17:33:18Z", "text": "Here are the results from a single change log report using ANT v1.6.1.   I'll \ntest it with 1.6.2 during tonights build and if I get different results, I'll \nmake note of it on this bug. Included are two links, one works fine the other \ndoesn't.  It appears that if there is more than one link for the same source \nfile, all but the oldest revision works.  \n\nGood URL\n<a href=\"http://cvs.xtria.com/cgi-\nbin/viewcvs/viewcvs.cgi/xfi/xinsure/auto/src/java/com/xtria/insure/auto/services\n/LenderServiceBean.java?\nr1=1.59&r2=1.58\">com/xtria/insure/auto/services/LenderServiceBean.java (1.59)\n</a>\n\n\nBad URL\n<a href=\"http://cvs.xtria.com/cgi-\nbin/viewcvs/viewcvs.cgi/xfi/xinsure/auto/src/java/com/xtria/insure/auto/services\n/LenderServiceBean.java?rev=1.58&content-type=text/x-cvsweb-\nmarkup\">com/xtria/insure/auto/services/LenderServiceBean.java (1.58)</a>\n\n-------------------------\nOne of the things that we do when we run this report is to report on source \nfile changes during the last 10 days.  This means that most of the time a \nsource file is listed only once on the report.  \n\n"}, {"count": 3, "tags": [], "bug_id": 24569, "is_private": false, "text": "Tested using Ant v1.6.2 and it still had the same problem.  I've updated the \nversion number on this bug.", "id": 61148, "time": "2004-07-26T20:31:23Z", "creator": "rick_cromer@hotmail.com", "creation_time": "2004-07-26T20:31:23Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "Can you give us the (relevant snippet) of a cvs log command run on the command\nline?\n\nIf you run ant -verbose you'll see the actual command Ant uses.\n\nIn the case of changelog, Ant expects a line consisting of dashes exclusively\nbetween the comment and a line consisting of equals signs exclusively.  To make\nthings worse (or not, I'm not sure how standardized the format is) Ant expects\na specific number of dashes or equals signs.\n", "attachment_id": null, "bug_id": 24569, "id": 50392, "time": "2005-03-21T15:31:07Z", "creator": "bodewig@apache.org", "creation_time": "2005-03-21T15:31:07Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 24569, "is_private": false, "text": "My build environment to duplicate this doesn't exist anymore.  When I tried to \nset it up again, I couldn't even get the CVSCHANGELOG task to work.  I traced \ndown the ANT source code and found that it's expecting /'s in the date returned \nfrom CVS.  Our version of CVS is returning -'s in the date.\n\nRef: org.apache.tools.ant.taskdefs.cvslib.ChangeLogParser.java\n\n    private static final SimpleDateFormat c_inputDate\n        = new SimpleDateFormat(\"yyyy/MM/dd HH:mm:ss\");\n\nThis causes an exception in parseDate(final String date).\n----------------------------------------------------------------\nRunning cvs from the command line here's a sample output\n\nc:\\>  cvs log -d \">=2005-02-27\" .cvsignore\n\nrevision 1.8\ndate: 2005-04-21 19:54:29 +0000;  author: rcromer;  state: Exp;  lines: +1 -0\nRemoving *.gid help file from repository, it get created when Help is run.\n----------------------------\n\nI ran it with cvs versions:\n\nConcurrent Versions System (CVS) 1.11.5 (client)\nand\nConcurrent Versions System (CVSNT) 2.0.51d (client/server)\n\nwith the same results.\n\nI suspect that the format was determined based on the server version of CVS.  \nOur cvs repository is running a Linux server.", "id": 76241, "time": "2005-06-10T00:03:40Z", "creator": "rick_cromer@hotmail.com", "creation_time": "2005-06-10T00:03:40Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 24569, "text": "Here's the verbose output of the ant run:\n<pre>\nchangeLog:\n     [echo] Creating XML changelog file - \"cvslog_temp.xml\"\n[cvschangelog] log\n[cvschangelog] Executing 'cvs' with arguments:\n[cvschangelog] 'log'\n[cvschangelog] '-d'\n[cvschangelog] '>=2005-05-10'\n[cvschangelog]\n[cvschangelog] The ' characters around the executable and arguments are\n[cvschangelog] not part of the command.\n[cvschangelog] cvs log: Logging .\n</pre>\n\nYou might be missing the point.  The date that I pass into the cvschangelog is \ngetting parsed ok, it's the output xml that get generated that's wrong.  I'm \nalso changing the version number to 1.6.5 which is what I just used and got the \nsame error.  (I had to slightly modify this ANT build to make it work on our \nsystem to get around the parseDate problem noted in my last post.)\n\nHere's the cvschangelog task output with version 1.6.5 (hope this format shows \nbetter in bugzilla) \n\nThis is the good one:\n\n\t\t&lt;file&gt;\n\t\t\t&lt;name&gt;&lt;![CDATA[Loan1.pas]]&gt;&lt;/name&gt;\n\t\t\t&lt;revision&gt;1.21&lt;/revision&gt;\n\t\t\t&lt;prevrevision&gt;1.20&lt;/prevrevision&gt;\n\t\t&lt;/file&gt;\n\nThis is the bad one:\n\n\t\t&lt;file&gt;\n\t\t\t&lt;name&gt;&lt;![CDATA[DataCaddy.pas]]&gt;&lt;/name&gt;\n\t\t\t&lt;revision&gt;1.3&lt;/revision&gt;\n\t\t&lt;/file&gt;\n", "id": 76248, "time": "2005-06-10T00:57:06Z", "creator": "rick_cromer@hotmail.com", "creation_time": "2005-06-10T00:57:06Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 24569, "text": "Didn't work - second try:\n\nGood sample:\n\t\t<file>\n\t\t\t<name><![CDATA[Loan1.pas]]></name>\n\t\t\t<revision>1.21</revision>\n\t\t\t<prevrevision>1.20</prevrevision>\n\t\t</file>\n\nBad sample from same cvschangelog output file:\n\t\t<file>\n\t\t\t<name><![CDATA[DataCaddy.pas]]></name>\n\t\t\t<revision>1.3</revision>\n\t\t</file>\n", "id": 76249, "time": "2005-06-10T01:00:48Z", "creator": "rick_cromer@hotmail.com", "creation_time": "2005-06-10T01:00:48Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 24569, "text": "Based on additional testing, the difference between these two files is that the \nchanges made to the working version had two or more changes within the \ndaysinpast time period where the entry without the prerevision tag only had one \ncvs commit (change) during that time period.", "count": 8, "id": 76264, "time": "2005-06-10T15:56:59Z", "creator": "rick_cromer@hotmail.com", "creation_time": "2005-06-10T15:56:59Z", "is_private": false}, {"count": 9, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 123042, "time": "2008-12-03T06:44:55Z", "bug_id": 24569, "creation_time": "2008-12-03T06:44:55Z", "is_private": false, "text": "first of all: I don't really expect you to be still interested in this after more than three years, sorry.\n\nLooking through the parser code it is pretty clear that prerevision is filled with the \"revision \" line that comes after an entry's log - so yes, if there has only been a single commit in the time the log applies to, the entry cannot get any prerevision attached to it.\n\nI don't see how we could guess the previous revision if it is not part of the log, so I'm just marking it as WONTFIX."}]
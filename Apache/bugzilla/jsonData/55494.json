[{"count": 0, "tags": [], "bug_id": 55494, "attachment_id": null, "id": 169766, "time": "2013-08-28T12:54:09Z", "creator": "Thomas.Hoffmann@speed4trade.com", "creation_time": "2013-08-28T12:54:09Z", "is_private": false, "text": "Our tomcat is configured to use Windows 2012 AD with JNDI-Realm\nWhen the application is running for some hours, the Tomcat logs exceptions because of timeouts.\n\nHere is a stacktrace:\n\nWARNING: Exception performing authentication\njavax.naming.CommunicationException: Connection reset [Root exception is java.net.SocketException: Connection reset]; remaining name 'xxx'\n\tat com.sun.jndi.ldap.LdapCtx.doSearch(Unknown Source)\n\tat com.sun.jndi.ldap.LdapCtx.searchAux(Unknown Source)\n\tat com.sun.jndi.ldap.LdapCtx.c_search(Unknown Source)\n\tat com.sun.jndi.toolkit.ctx.ComponentDirContext.p_search(Unknown Source)\n\tat com.sun.jndi.toolkit.ctx.PartialCompositeDirContext.search(Unknown Source)\n\tat com.sun.jndi.toolkit.ctx.PartialCompositeDirContext.search(Unknown Source)\n\tat javax.naming.directory.InitialDirContext.search(Unknown Source)\n\tat org.apache.catalina.realm.JNDIRealm.getUserBySearch(JNDIRealm.java:1438)\n\tat org.apache.catalina.realm.JNDIRealm.getUser(JNDIRealm.java:1289)\n\tat org.apache.catalina.realm.JNDIRealm.getUser(JNDIRealm.java:1225)\n\tat org.apache.catalina.realm.JNDIRealm.getPrincipal(JNDIRealm.java:2086)\n\tat org.apache.catalina.realm.JNDIRealm.getPrincipal(JNDIRealm.java:2005)\n\tat org.apache.catalina.realm.RealmBase.authenticate(RealmBase.java:523)\n\tat org.apache.catalina.realm.CombinedRealm.authenticate(CombinedRealm.java:295)\n\tat org.apache.catalina.realm.LockOutRealm.authenticate(LockOutRealm.java:249)\n\tat org.apache.catalina.authenticator.SpnegoAuthenticator.authenticate(SpnegoAuthenticator.java:250)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:544)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:99)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:953)\n\tat org.apache.catalina.authenticator.SingleSignOn.invoke(SingleSignOn.java:341)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:408)\n\tat org.apache.coyote.ajp.AjpAprProcessor.process(AjpAprProcessor.java:197)\n\tat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:589)\n\tat org.apache.tomcat.util.net.AprEndpoint$SocketProcessor.run(AprEndpoint.java:1852)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n\tat java.lang.Thread.run(Unknown Source)\nCaused by: java.net.SocketException: Connection reset\n\tat java.net.SocketInputStream.read(Unknown Source)\n\tat java.net.SocketInputStream.read(Unknown Source)\n\tat java.io.BufferedInputStream.fill(Unknown Source)\n\tat java.io.BufferedInputStream.read1(Unknown Source)\n\tat java.io.BufferedInputStream.read(Unknown Source)\n\tat com.sun.jndi.ldap.Connection.run(Unknown Source)\n\t... 1 more\n\nIt seems that the LDAP-Lookup tries to search for the user within LDAP but the server already closed the Connection.\n\nLooks like this cause:\nhttp://stackoverflow.com/questions/10911897/tomcat-7-0-14-ldap-authentication"}, {"count": 1, "tags": [], "bug_id": 55494, "attachment_id": null, "id": 169767, "time": "2013-08-28T12:56:48Z", "creator": "Thomas.Hoffmann@speed4trade.com", "creation_time": "2013-08-28T12:56:48Z", "is_private": false, "text": "Here is our configuration (some values are censored):\n\n  <Realm className=\"org.apache.catalina.realm.JNDIRealm\"\n        connectionName=\"cn=xxx\"\n        connectionPassword=\"xxx\"\n\tadCompat=\"true\"\n\tallRolesMode =\"authOnly\"\n\tconnectionTimeout=\"3000\"\n        connectionURL=\"ldap://srv1:389\"\n\talternateURL=\"ldap://srv2:389\"\n        userBase=\"ou=xxx\"\n        userSearch=\"(sAMAccountName={0})\"\n\tuserSubtree=\"true\"\n\troleSubtree=\"true\"\n        roleBase=\"ou=xxx\"\n        roleName=\"cn\"\n        roleSearch=\"(member={0})\"\n     />"}, {"count": 2, "attachment_id": null, "bug_id": 55494, "is_private": false, "id": 169768, "time": "2013-08-28T13:05:52Z", "creator": "markt@apache.org", "creation_time": "2013-08-28T13:05:52Z", "tags": [], "text": "This bug report only contains statements of fact. It does not identify what the problem is. Arguably, a valid warning is being logged. There is no clear issue that needs addressing.\n\nA bug report needs to include at least one of:\n- what happened that you did not expect to happen\n- what didn't happen that you expected to happen"}, {"count": 3, "tags": [], "text": "Thanks for your comment!\nI assumed that some users failed to logon because of this error.\n\nAccording to the code in JNDIRealm.java, Tomcat will try once more\nafter encoutering the above error.\n\nMaybe it would be an improvement to change the wording, e.g.\n\"failed to authenticate... trying again...\" or something like that.\n\nThank you for your quick reply!", "attachment_id": null, "bug_id": 55494, "id": 169770, "time": "2013-08-28T13:29:22Z", "creator": "Thomas.Hoffmann@speed4trade.com", "creation_time": "2013-08-28T13:29:22Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 55494, "attachment_id": null, "id": 169771, "time": "2013-08-28T14:06:38Z", "creator": "markt@apache.org", "creation_time": "2013-08-28T14:06:38Z", "is_private": false, "text": "This has been fixed for trunk and 7.0.x and will be included in 8.0.0-RC2 onwards and 7.0.43 onwards.\n\nThe log messages for connection errors where the action is automatically re-tried has been reduced from WARN to INFO and the log message makes clear that the action is being re-tried."}]
[{"count": 0, "tags": [], "creator": "earl507@yahoo.com", "is_private": false, "id": 83142, "attachment_id": null, "bug_id": 37756, "creation_time": "2005-12-02T15:31:23Z", "time": "2005-12-02T15:31:23Z", "text": "I am receiving a runtime error when using chainsaw.. This occurs when I am using\na SocketHubReceiver/Appender. The runtime error comes from the core of log4j and\nnot chainsaw, but I only see it in chainsaw. Essentially, the\norg.apache.log4j.PatternLayout object contains a StringBuffer  that is getting\noverwritten by simultaneous calls to PatternLayout.format() during high activity\nperiods. I was able to resolve this locally (I can't check in code due to my\ncompany's firewall) by adding a 'synchronized' keyword to the\norg.apache.log4j.PatternLayout.format() method. \n\nAfter the error occurs, it renders chainsaw unusable. \n\nThanks, \n\nEric\n\nError Text -----------------------------\n\njava.lang.StringIndexOutOfBoundsException: String index out of range: 486\n\tat java.lang.AbstractStringBuilder.insert(AbstractStringBuilder.java:1016)\n\tat java.lang.StringBuffer.insert(StringBuffer.java:455)\n\tat org.apache.log4j.pattern.FormattingInfo.format(FormattingInfo.java:127)\n\tat org.apache.log4j.PatternLayout.format(PatternLayout.java:553)\n\tat\norg.apache.log4j.chainsaw.layout.EventDetailLayout.format(EventDetailLayout.java:273)\n\tat org.apache.log4j.Layout.format(Layout.java:57)\n\tat\norg.apache.log4j.chainsaw.LogPanel$DetailPaneUpdater.updateDetailPane(LogPanel.java:2553)\n\tat\norg.apache.log4j.chainsaw.LogPanel$DetailPaneUpdater.setSelectedRow(LogPanel.java:2532)\n\tat\norg.apache.log4j.chainsaw.LogPanel$DetailPaneUpdater.access$1(LogPanel.java:2529)\n\tat org.apache.log4j.chainsaw.LogPanel$30.valueChanged(LogPanel.java:764)\n\tat\njavax.swing.DefaultListSelectionModel.fireValueChanged(DefaultListSelectionModel.java:187)\n\tat\njavax.swing.DefaultListSelectionModel.fireValueChanged(DefaultListSelectionModel.java:167)\n\tat\njavax.swing.DefaultListSelectionModel.fireValueChanged(DefaultListSelectionModel.java:214)\n\tat\njavax.swing.DefaultListSelectionModel.changeSelection(DefaultListSelectionModel.java:408)\n\tat\njavax.swing.DefaultListSelectionModel.changeSelection(DefaultListSelectionModel.java:417)\n\tat\njavax.swing.DefaultListSelectionModel.setSelectionInterval(DefaultListSelectionModel.java:441)\n\tat javax.swing.JTable.setRowSelectionInterval(JTable.java:1370)\n\tat org.apache.log4j.chainsaw.JSortTable$2.run(JSortTable.java:117)\n\tat java.awt.event.InvocationEvent.dispatch(InvocationEvent.java:209)\n\tat java.awt.EventQueue.dispatchEvent(EventQueue.java:461)\n\tat\njava.awt.EventDispatchThread.pumpOneEventForHierarchy(EventDispatchThread.java:242)\n\tat\njava.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:163)\n\tat\njava.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:153)\n\tat java.awt.Dialog$1.run(Dialog.java:515)\n\tat java.awt.Dialog.show(Dialog.java:536)\n\tat org.apache.log4j.chainsaw.LogUI$42.run(LogUI.java:1304)\n\tat java.awt.event.InvocationEvent.dispatch(InvocationEvent.java:209)\n\tat java.awt.EventQueue.dispatchEvent(EventQueue.java:461)\n\tat\njava.awt.EventDispatchThread.pumpOneEventForHierarchy(EventDispatchThread.java:242)\n\tat\njava.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:163)\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:157)\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:149)\n\tat java.awt.EventDispatchThread.run(EventDispatchThread.java:110)"}, {"count": 1, "tags": [], "bug_id": 37756, "attachment_id": null, "id": 83160, "time": "2005-12-02T23:27:08Z", "creator": "psmith@apache.org", "creation_time": "2005-12-02T23:27:08Z", "is_private": false, "text": "This is actually a Chainsaw bug.  Chainsaw uses log4j's layout mechanism for\nrendering the detail panel.\n\nThe Layouts do not pretend to be thread safe, because they are generally used by\none appender, which is already guarded for thread safety.\n\nI noticed this bug myself yesterday, and I'll fix Chainsaw to prevent this error\noccuring. (A new build is getting prepared.  Maybe within the week).\n\nPaul"}, {"count": 2, "tags": [], "creator": "psmith@apache.org", "attachment_id": null, "is_private": false, "id": 83161, "time": "2005-12-03T01:48:55Z", "bug_id": 37756, "creation_time": "2005-12-03T01:48:55Z", "text": "Fixed by adding a synchronized block in EventDetailLayout around the call to the\ninternal PatternLayout.\n\nI did not think adding the synchronized modifier to the PatternLayout was a good\nidea because of it's wider implications on the rest of log4j.\n\nSince the call to an appender is done in a thread-safe manner, there is not\nreally a need to make Layout's thread-safe.\n\nFixed in revision 351860 in SVN."}]
[{"count": 0, "tags": [], "creator": "eliasen@mindspring.com", "is_private": false, "id": 74651, "attachment_id": null, "bug_id": 34833, "creation_time": "2005-05-10T10:06:01Z", "time": "2005-05-10T10:06:01Z", "text": "JK 1.2.12 doesn't fail over properly if a server cannot be reached.  This\nappears to be a regression--the same scenario works perfectly under 1.2.6.\n\nI have 2 tomcat instances on machines called clemens and feynman.  Apache is\nrunning on Feynman and has a load-balancing workers.properties file.\n\nIf I shut off the tomcat server on Feynman, and leave the server running on\nclemens, I get the following errors:\n\n\n[Tue May 10 00:58:33 2005] [info]  jk_open_socket::jk_connect.c (433): connect \\\nto 127.0.0.1:8009 failed with errno=111\n[Tue May 10 00:58:33 2005] [info]  ajp_connect_to_endpoint::jk_ajp_common.c (89\\\n2): Failed opening socket to (127.0.0.1:8009) with (errno=111)\n[Tue May 10 00:58:33 2005] [info]  ajp_send_request::jk_ajp_common.c (1248): Er\\\nror connecting to the Tomcat process.\n[Tue May 10 00:58:33 2005] [info]  ajp_service::jk_ajp_common.c (1746): Sending\\\n request to tomcat failed,  recoverable operation attempt=1\n[Tue May 10 00:58:33 2005] [info]  jk_open_socket::jk_connect.c (433): connect \\\nto 127.0.0.1:8009 failed with errno=111\n[Tue May 10 00:58:33 2005] [info]  ajp_connect_to_endpoint::jk_ajp_common.c (89\\\n2): Failed opening socket to (127.0.0.1:8009) with (errno=111)\n[Tue May 10 00:58:33 2005] [info]  ajp_send_request::jk_ajp_common.c (1248): Er\\\nror connecting to the Tomcat process.\n[Tue May 10 00:58:33 2005] [info]  ajp_service::jk_ajp_common.c (1746): Sending\\\n request to tomcat failed,  recoverable operation attempt=2\n[Tue May 10 00:58:33 2005] [info]  jk_open_socket::jk_connect.c (433): connect \\\nto 127.0.0.1:8009 failed with errno=111\n[Tue May 10 00:58:33 2005] [info]  ajp_connect_to_endpoint::jk_ajp_common.c (89\\\n2): Failed opening socket to (127.0.0.1:8009) with (errno=111)\n[Tue May 10 00:58:33 2005] [info]  ajp_send_request::jk_ajp_common.c (1248): Er\\\nror connecting to the Tomcat process.\n[Tue May 10 00:58:33 2005] [info]  ajp_service::jk_ajp_common.c (1746): Sending\\\n request to tomcat failed,  recoverable operation attempt=3\n[Tue May 10 00:58:33 2005] [error] ajp_service::jk_ajp_common.c (1755): Error c\\\nonnecting to tomcat. Tomcat is probably not started or is listening on the wron\\\ng port. worker=feynman failed\n[Tue May 10 00:58:33 2005] [error] service::jk_lb_worker.c (632): unrecoverable\\\n error 503, request failed. Tomcat failed in the middle of request, we can't re\\\ncover to another instance.\n\n\nThe diagnostics are incorrect.  Tomcat could not have failed \"in the middle of\nrequest,\" because that server was never reachable in the first place.  There's\nsomething wrong in the logic here.\n\nThe log file never shows JK attempting to fail over to the other (perfectly\nworking) tomcat instance in this case.  The other server handles requests fine\nduring this time--it's just never contacted.\n\nLoad balancing file attached below:\n\n# Define the load-balancing router\nworker.list=router\n\n# Configure the router\nworker.router.type=lb\nworker.router.balanced_workers=clemens,feynman\n#worker.router.balance_workers=clemens,feynman\nworker.router.local_worker_only=0\n\n# Set properties for clemens (ajp13)\nworker.clemens.type=ajp13\nworker.clemens.host=clemens\nworker.clemens.port=8009\nworker.clemens.lbfactor=80\n#worker.clemens.cachesize=10\nworker.clemens.cache_timeout=300\nworker.clemens.socket_keepalive=0\nworker.clemens.socket_timeout=100\nworker.clemens.local_worker=0\n\n# Set properties for feynman (ajp13)\nworker.feynman.type=ajp13\nworker.feynman.host=feynman\nworker.feynman.port=8009\nworker.feynman.lbfactor=300\n#worker.feynman.cachesize=10\nworker.feynman.cache_timeout=300\nworker.feynman.socket_keepalive=0\nworker.feynman.socket_timeout=100\nworker.feynman.local_worker=1\n\n\nAgain, reverting to 1.2.6 works perfectly."}, {"count": 1, "attachment_id": null, "bug_id": 34833, "is_private": false, "id": 74656, "time": "2005-05-10T11:24:36Z", "creator": "mturk@apache.org", "creation_time": "2005-05-10T11:24:36Z", "tags": [], "text": "Fixed in the CVS."}]
[{"count": 0, "attachment_id": null, "bug_id": 19145, "text": "I have the following snippet is defined in the server.xml file:\n\n<Connector className=\"org.apache.coyote.tomcat4.CoyoteConnector\"\n    port=\"8080\" minProcessors=\"5\" maxProcessors=\"75\"\n    enableLookups=\"true\" redirectPort=\"8443\"\n    acceptCount=\"100\" debug=\"10\" connectionTimeout=\"20000\"\n    useURIValidationHack=\"false\" disableUploadTimeout=\"true\" />\n\n<Connector className=\"org.apache.coyote.tomcat4.CoyoteConnector\"\n    port=\"8443\" minProcessors=\"5\" maxProcessors=\"75\"\n    enableLookups=\"true\"\n    acceptCount=\"100\" debug=\"10\" scheme=\"https\" secure=\"true\"\n    useURIValidationHack=\"false\" disableUploadTimeout=\"true\">\n    <Factory className=\"org.apache.coyote.tomcat4.CoyoteServerSocketFactory\"\n             clientAuth=\"false\" protocol=\"TLS\" />\n</Connector> \n\nand the following part is defined in my web.xml\n\n<welcome-file-list>\n    <welcome-file>main/index.jsp</welcome-file>\n</welcome-file-list>\n\n<security-constraint>\n\t<web-resource-collection>\n\t\t<web-resource-name>loginRequired</web-resource-name>\n\t\t<url-pattern>/main/*</url-pattern>\n\t</web-resource-collection>\n\t<auth-constraint>\n\t\t<role-name>admin</role-name>\n\t</auth-constraint>\n</security-constraint>\n\n<security-constraint>\n\t<web-resource-collection>\n\t\t<web-resource-name>SSL login</web-resource-name>\n\t\t<url-pattern>/login.jsp</url-pattern>\n\t</web-resource-collection>\n\t<user-data-constraint>\n\t\t<description>Secured</description>\n\t\t<transport-guarantee>CONFIDENTIAL</transport-guarantee>\n\t</user-data-constraint>\n</security-constraint>\n\n<login-config>\n\t<auth-method>FORM</auth-method>\n\t<form-login-config>\n\t\t<form-login-page>/login.jsp</form-login-page>\n\t\t<form-error-page>/error.jsp</form-error-page>\n\t</form-login-config>\n</login-config>\n\nif I direct my browser to\n\nhttp://127.0.0.1:8080/mywebapp\n\ntomcat correctly switches to https, the URL in my browser changes to\n\nhttps://127.0.0.1:8443/mywebapp/login.jsp\n\nand the page starts loading, but never finishes. If I press the stop button \nand view the source of the page loaded, it is all there. If I press refresh \nthe page gets loaded without any problems. (I have tried his with IE and \nNetscape as well.)\n\nIf I configure http port as 80 and https as 443, the problem does not occur.", "id": 35490, "time": "2003-04-18T11:09:12Z", "creator": "kisst2@freemail.hu", "creation_time": "2003-04-18T11:09:12Z", "tags": [], "is_private": false}, {"count": 1, "text": "*** Bug 8752 has been marked as a duplicate of this bug. ***", "bug_id": 19145, "is_private": false, "id": 35853, "time": "2003-04-23T07:58:27Z", "creator": "remm@apache.org", "creation_time": "2003-04-23T07:58:27Z", "tags": [], "attachment_id": null}, {"count": 2, "text": "I tried to determine if the redirectPort was simply being ignored by leaving \nthe HTTP connector port set to 80 and redirectPort set to 8443 while changing \nthe HTTPS connector port to 443.  Tomcat was unable to perform the redirect \ncorrectly.\n\nI created a second HTTPS connector to see if there was a \"fallback\" happening.  \nThe two connectors were configured to listen on port 443 and 8443.  The HTTP \nconnector port value was 80.  This worked successfully.\n\nWhen the HTTP connector was listening on port 8080, none of the redirection \nconfigurations functioned properly.\n\nThese symptoms seem to suggest that Tomcat is attempting to redirect to the \nredirectPort initially, but later falls back on the default SSL port (443).\n\nThis probably was probably never seen because of Tomcat's reliance on the \nApache web server mod_ajp connector.\n", "bug_id": 19145, "is_private": false, "id": 38217, "time": "2003-06-02T23:52:27Z", "creator": "bugzilla@sbdconsultants.com", "creation_time": "2003-06-02T23:52:27Z", "tags": [], "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 19145, "text": "It should be possible to investigate a bit further using a telnet, and looking\nat the \"Location\" header of the response.", "id": 38239, "time": "2003-06-03T06:26:01Z", "creator": "remm@apache.org", "creation_time": "2003-06-03T06:26:01Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 19145, "text": "I just noticed that this problem does not occur in Opera 7.  That is, with the \nports left to 8080 and 8443, and the HTTP connector redirect port set to 8443, \nOpera 7 correctly forwards the request to the non-standard HTTPS port.  On the \nhunch that this is an IE-only problem, I've been looking for a related \nknowledge base article on the Microsoft web site, but I haven't found it yet.  \nIf I find one, I'll post it here.", "id": 38313, "time": "2003-06-04T06:42:22Z", "creator": "bugzilla@sbdconsultants.com", "creation_time": "2003-06-04T06:42:22Z", "tags": [], "is_private": false}, {"count": 5, "text": "Well, maybe Opera is less strict than the other browsers. Could you check with a\ntelnet and post the result ? If the location header has the correct scheme\n(https) and port number (8443), then the bug is with the clients (and, AFAIK,\nthere's no possible workaround :-( ).\n\ntelnet some_host 8080\n\nGET /some_confidential_url HTTP/1.1\nHost: some_host:8080\n", "bug_id": 19145, "is_private": false, "id": 38316, "time": "2003-06-04T07:55:51Z", "creator": "remm@apache.org", "creation_time": "2003-06-04T07:55:51Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "creator": "bugzilla@sbdconsultants.com", "attachment_id": null, "text": "Here is the response from telnet...\n\nHTTP/1.1 302 Moved Temporarily\nPragma: No-cache\nCache-Control: no-cache\nExpires: Thu, 01 Jan 1970 00:00:00 GMT\nLocation: https://localhost:8443/hello1/greeting\nContent-Type: text/plain\nContent-Length: 0\nDate: Wed, 04 Jun 2003 20:02:25 GMT\nServer: Apache Coyote/1.0\n\n...but I don't think that problem is with the initial redirect.\n\nWhen the initial redirect happens in IE, I am prompted to accept the self-\nsigned certificate that I created for development.  The problem happens after \nthe subsequent redirect to the FORM-style authentication login page...\n\nHere is a little more background...\n\nThe resource that I'm requesting is configured to be CONFIDENTIAL and require \n(FORM-based) authentication.  So this is the request/response story-board that \nI would expect...\n\n1a) Request: http://localhost:8080/hello1/greeting\n1b) Response: 302, https://localhost:8443/hello1/greeting\n2a) Request: https://localhost:8443/hello1/greeting\n2b) Response: 302, https://localhost:8443/hello1/login.jsp\n3a) Request: https://localhost:8443/hello1/login.jsp\n3b) Response: 200 https://localhost:8443/hello1/login.jsp\n\nI am speculating about steps 2b, 3a, and 3b because I am not sure how to go \nabout snooping HTTPS requests.  (I tried using SSH a la PuTTY, but I couldn't \nget it to work.)\n\nIt works if I disable either the auth-constraint or the transport-constraint \n(thus changing the story-board).  It also works if I enter into the original \nstory-board at 2a instead of 1a when both the auth-constraint and transport-\nconstraint are enabled.\n\nIt also works fine in IE if I use BASIC authentication instead of FORM \nauthentication.\n\nIt looks like the problem happens when IE receives two subsequent 302 \nresponses.  In the case of the second 302 response, the port specified in the \nresponse is not used by IE in the subsequent request; it uses the default port \nfor the protocol.  In other words, I suspect that Internet Explorer isn't using \nthe port specified in 2b in its request of 3a, which would explain why having \nthe second Coyote connector on port 443 allowed Internet Explorer to work.  \n\nI should also add that I downloaded Mozilla Firebird and it was successfully \nredirected to the correct page.  It definitely looks to be an Internet Explorer \nrelated bug.  :-(\n\nThanks for your help, Remy.\n", "id": 38382, "time": "2003-06-04T20:49:21Z", "bug_id": 19145, "creation_time": "2003-06-04T20:49:21Z", "is_private": false}, {"count": 7, "tags": [], "creator": "medthomas@ntlworld.com", "is_private": false, "text": "As the root cause of this is an IE bug (see also bug 13861) this will not be \nfixed.", "id": 44710, "time": "2003-09-25T18:57:32Z", "bug_id": 19145, "creation_time": "2003-09-25T18:57:32Z", "attachment_id": null}]
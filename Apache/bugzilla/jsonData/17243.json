[{"count": 0, "tags": [], "bug_id": 17243, "attachment_id": null, "text": "During loading of a JSP file nothing seemed to happen for a minute, so I took a \nthread dump using <ctrl><break>, which revealed the following:\n\n     [java] FOUND A JAVA LEVEL DEADLOCK:\n     [java] ----------------------------\n     [java] \"HttpProcessor[80][4]\":\n     [java]   waiting to lock monitor 0x9244b4 (object 0x10e98400, a \norg.apache.catalina.loader.WebappClassLoader$ResourceEntry),\n     [java]   which is locked by \"HttpProcessor[80][3]\"\n     [java] \"HttpProcessor[80][3]\":\n     [java]   waiting to lock monitor 0x924634 (object 0x103773f8, a \norg.apache.catalina.loader.WebappClassLoader),\n     [java]   which is locked by \"HttpProcessor[80][4]\"\n\n     [java] JAVA STACK INFORMATION FOR THREADS LISTED ABOVE:\n     [java] ------------------------------------------------\n     [java] Java Stack for \"HttpProcessor[80][4]\":\n     [java] ==========\n     [java]     at \norg.apache.catalina.loader.WebappClassLoader.findClassInternal\n(WebappClassLoader.java:1533)\n     [java]     - waiting to lock <10e98400> (a \norg.apache.catalina.loader.WebappClassLoader$ResourceEntry)\n     [java]     at org.apache.catalina.loader.WebappClassLoader.findClass\n(WebappClassLoader.java:852)\n     [java]     at org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1273)\n     [java]     at org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1156)\n     [java]     at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:310)\n     [java]     at java.lang.ClassLoader.defineClass0(Native Method)\n     [java]     at java.lang.ClassLoader.defineClass(ClassLoader.java:488)\n     [java]     at java.security.SecureClassLoader.defineClass\n(SecureClassLoader.java:106)\n     [java]     at \norg.apache.catalina.loader.WebappClassLoader.findClassInternal\n(WebappClassLoader.java:1534)\n     [java]     - locked <10e98440> (a \norg.apache.catalina.loader.WebappClassLoader$ResourceEntry)\n     [java]     at org.apache.catalina.loader.WebappClassLoader.findClass\n(WebappClassLoader.java:852)\n     [java]     at org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1273)\n     [java]     at org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1156)\n     [java]     at org.apache.jasper.servlet.JasperLoader.loadClass\n(JasperLoader.java:198)\n     [java]     at org.apache.jasper.servlet.JasperLoader.loadClass\n(JasperLoader.java:132)\n     [java]     at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:310)\n     [java]     at java.lang.Class.newInstance0(Native Method)\n     [java]     at java.lang.Class.newInstance(Class.java:232)\n     [java]     at org.apache.jasper.servlet.JspServlet$JspServletWrapper.load\n(JspServlet.java:139)\n     [java]     at \norg.apache.jasper.servlet.JspServlet$JspServletWrapper.loadIfNecessary\n(JspServlet.java:179)\n     [java]     at \norg.apache.jasper.servlet.JspServlet$JspServletWrapper.service\n(JspServlet.java:189)\n     [java]     at org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:382)\n     [java]     at org.apache.jasper.servlet.JspServlet.service\n(JspServlet.java:474)\n     [java]     at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n     [java]     at \norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n     [java]     at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n     [java]     at dk.netnord.cmd.servlet.RootFilter$FilterMethodContext.forward\n(RootFilter.java:102)\n     [java]     at dk.netnord.cmd.servlet.GetMethod.execute(GetMethod.java:77)\n     [java]     at dk.netnord.cmd.servlet.RootFilter.doFilter\n(RootFilter.java:52)\n     [java]     at \norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:213)\n     [java]     at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n     [java]     at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:243)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n     [java]     at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n     [java]     at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:943)\n     [java]     at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:201)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n     [java]     at org.apache.catalina.valves.CertificatesValve.invoke\n(CertificatesValve.java:246)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n     [java]     at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n     [java]     at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:943)\n     [java]     at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2344)\n     [java]     at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:164)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n     [java]     at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n     [java]     at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:170)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n     [java]     at org.apache.catalina.valves.AccessLogValve.invoke\n(AccessLogValve.java:462)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n     [java]     at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n     [java]     at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:943)\n     [java]     at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:163)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n     [java]     at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n     [java]     at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:943)\n     [java]     at org.apache.catalina.connector.http.HttpProcessor.process\n(HttpProcessor.java:1011)\n     [java]     at org.apache.catalina.connector.http.HttpProcessor.run\n(HttpProcessor.java:1106)\n     [java]     at java.lang.Thread.run(Thread.java:479)\n     [java] Java Stack for \"HttpProcessor[80][3]\":\n     [java] ==========\n     [java]     at java.lang.ClassLoader.checkCerts(ClassLoader.java:530)\n     [java]     - waiting to lock <103773f8> (a \norg.apache.catalina.loader.WebappClassLoader)\n     [java]     at java.lang.ClassLoader.defineClass(ClassLoader.java:482)\n     [java]     at java.security.SecureClassLoader.defineClass\n(SecureClassLoader.java:106)\n     [java]     at \norg.apache.catalina.loader.WebappClassLoader.findClassInternal\n(WebappClassLoader.java:1534)\n     [java]     - locked <10e98400> (a \norg.apache.catalina.loader.WebappClassLoader$ResourceEntry)\n     [java]     at org.apache.catalina.loader.WebappClassLoader.findClass\n(WebappClassLoader.java:852)\n     [java]     at org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1273)\n     [java]     at org.apache.catalina.loader.WebappClassLoader.loadClass\n(WebappClassLoader.java:1156)\n     [java]     at org.apache.jasper.servlet.JasperLoader.loadClass\n(JasperLoader.java:198)\n     [java]     at org.apache.jasper.servlet.JasperLoader.loadClass\n(JasperLoader.java:132)\n     [java]     at java.lang.ClassLoader.loadClassInternal(ClassLoader.java:310)\n     [java]     at java.lang.Class.newInstance0(Native Method)\n     [java]     at java.lang.Class.newInstance(Class.java:232)\n     [java]     at org.apache.jasper.servlet.JspServlet$JspServletWrapper.load\n(JspServlet.java:139)\n     [java]     at \norg.apache.jasper.servlet.JspServlet$JspServletWrapper.loadIfNecessary\n(JspServlet.java:179)\n     [java]     at \norg.apache.jasper.servlet.JspServlet$JspServletWrapper.service\n(JspServlet.java:189)\n     [java]     at org.apache.jasper.servlet.JspServlet.serviceJspFile\n(JspServlet.java:382)\n     [java]     at org.apache.jasper.servlet.JspServlet.service\n(JspServlet.java:474)\n     [java]     at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n     [java]     at \norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:247)\n     [java]     at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n     [java]     at dk.netnord.cmd.servlet.RootFilter$FilterMethodContext.forward\n(RootFilter.java:102)\n     [java]     at dk.netnord.cmd.servlet.GetMethod.execute(GetMethod.java:77)\n     [java]     at dk.netnord.cmd.servlet.RootFilter.doFilter\n(RootFilter.java:52)\n     [java]     at \norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter\n(ApplicationFilterChain.java:213)\n     [java]     at org.apache.catalina.core.ApplicationFilterChain.doFilter\n(ApplicationFilterChain.java:193)\n     [java]     at org.apache.catalina.core.StandardWrapperValve.invoke\n(StandardWrapperValve.java:243)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n     [java]     at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n     [java]     at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:943)\n     [java]     at org.apache.catalina.core.StandardContextValve.invoke\n(StandardContextValve.java:201)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n     [java]     at org.apache.catalina.valves.CertificatesValve.invoke\n(CertificatesValve.java:246)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n     [java]     at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n     [java]     at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:943)\n     [java]     at org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2344)\n     [java]     at org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:164)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n     [java]     at org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:170)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n     [java]     at org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:170)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n     [java]     at org.apache.catalina.valves.AccessLogValve.invoke\n(AccessLogValve.java:462)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:564)\n     [java]     at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n     [java]     at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:943)\n     [java]     at org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:163)\n     [java]     at org.apache.catalina.core.StandardPipeline.invokeNext\n(StandardPipeline.java:566)\n     [java]     at org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:472)\n     [java]     at org.apache.catalina.core.ContainerBase.invoke\n(ContainerBase.java:943)\n     [java]     at org.apache.catalina.connector.http.HttpProcessor.process\n(HttpProcessor.java:1011)\n     [java]     at org.apache.catalina.connector.http.HttpProcessor.run\n(HttpProcessor.java:1106)\n     [java]     at java.lang.Thread.run(Thread.java:479)\n\n     [java] Found 1 deadlock.", "id": 31673, "time": "2003-02-20T13:42:25Z", "creator": "peter@conscius.com", "creation_time": "2003-02-20T13:42:25Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 17243, "attachment_id": null, "id": 35536, "time": "2003-04-18T14:04:44Z", "creator": "remm@apache.org", "creation_time": "2003-04-18T14:04:44Z", "is_private": false, "text": "I recommend you upgrade to a newer release."}, {"count": 2, "tags": [], "bug_id": 17243, "attachment_id": null, "is_private": false, "id": 35564, "time": "2003-04-18T16:19:59Z", "creator": "Larry.Isaacs@sas.com", "creation_time": "2003-04-18T16:19:59Z", "text": "Reopening for resolution correction."}, {"count": 3, "tags": [], "bug_id": 17243, "attachment_id": null, "id": 35565, "time": "2003-04-18T16:26:45Z", "creator": "Larry.Isaacs@sas.com", "creation_time": "2003-04-18T16:26:45Z", "is_private": false, "text": "This is a vulnerability in Tomcat 4.0.x's WebAppClassLoader where it \nsynchronizes on an external object (i.e. \"synchronized(entry)\") and then calls \ndefineClass() which can synchronize on \"this\".  If some other thread, like \nHttpProcessor[80][4] above, has already synchronized on \"this\" and is waiting \non \"entry\", then you have a classic deadlock as illustrated in the stacktraces.\n\nThis was fixed in Tomcat 4.1.9.  You will need to upgrade to a current Tomcat \n4.1.x to avoid this, as I doubt the fix will be back ported to Tomcat 4.0.x at \nthis point."}]
[{"count": 0, "tags": [], "bug_id": 24491, "text": "Hi!\n\nFor Oracle varchar2 can have maximum 4000 chars. So after 80 PUT commands slide \ncrashes on that document because 'version-set' property length of history object \n(for example /history/1) is exceeded.\n\nSo I would like propose new schema for Oracle (what is really important is \nproperty value stored as clob) and patch to JDBCDescriptorStore that works with \nthis schema:\n\nSCHEMA :\n\n--Slide schema for user_5 9.0.0.0.\n--Modified for named primary keys 11.09.2003.\ndrop table objects;\ndrop table children;\ndrop table links;\ndrop table permissions;\ndrop table locks;\ndrop table revisions;\ndrop table workingrevision;\ndrop table latestrevisions;\ndrop table branches;\ndrop table revision;\ndrop table label;\ndrop table property;\ndrop table revisioncontent;\n\n\ncreate table objects(uri varchar(3200), classname varchar(4000));\n\ncreate table children(uri varchar(4000), childuri varchar(4000));\n\ncreate table links(link varchar(4000), linkto varchar(4000));\n\ncreate table permissions(object varchar(4000), revisionnumber varchar(20), \n  subject varchar(1500), action varchar(400), inheritable int, negative int);\n\ncreate table locks(id varchar(4000), object varchar(4000), \n  subject varchar(4000), type varchar(4000), \n  expirationdate varchar(15), inheritable int, xexclusive int);\n\ncreate table revisions(uri varchar(3200), \n  isversioned int, initialrevision varchar(10));\n\ncreate table workingrevision(uri varchar(4000), \n  baserevision varchar(20), xnumber varchar(20));\n\ncreate table latestrevisions(uri varchar(4000), \n  branchname varchar(4000), xnumber varchar(20));\n\ncreate table branches(uri varchar(4000), xnumber varchar(20), \n  childnumber varchar(20));\n\ncreate table revision(uri varchar(4000), xnumber varchar(20), \n  branchname varchar(4000));\n\ncreate table label(uri varchar(4000), xnumber varchar(20), \n  label varchar(4000));\n\ncreate table property(uri varchar(4000), xnumber varchar(20), \n  name varchar(4000), value clob, namespace varchar(4000), \n  type varchar(100), protected int);\n\ncreate table revisioncontent(uri varchar(4000), xnumber varchar(20), \n  content blob);\n\nalter table objects add constraint pk_objects primary key (uri);\nalter table revisions add constraint pk_revisions primary key (uri);\n  \ncreate index idx_rc_uri_xnumber on revisioncontent (uri, xnumber);\ncreate index idx_chld_uri on children (uri);\ncreate index idx_lnks_linkto on links (linkto);\ncreate index idx_lnks_link on links (link);\ncreate index idx_perm_osar on permissions (object, subject, action, \nrevisionnumber);\ncreate index idx_perm_obj on permissions (object);\ncreate index idx_lcks_id on locks (id);\ncreate index idx_lcks_obj on locks (object);\ncreate index idx_wrkrev_uri on workingrevision (uri);\ncreate index idx_ltstrev_uri on latestrevisions (uri);\ncreate index idx_rev_uri on revision (uri);\ncreate index idx_rev_uri_xnumber on revision (uri, xnumber);\ncreate index idx_brnch_uri_xnumber on branches (uri, xnumber);\ncreate index idx_lbl_uri_xnumber on label (uri, xnumber);\ncreate index idx_prop_uri_xnumber on property (uri, xnumber);\n\n  \nPATCH:\n\n\n1595a1597,1606\n> \t\tClob pValueClob = res.getClob(PROPERTY_VALUE);\n> \t\tString propertyValue = null;\n> \t\tif(pValueClob != null) {\n> \t\t\tlong pValueClobLength = pValueClob.length();\n> \t\t\tchar pValueChars[] = new char[(int)pValueClobLength];\n> \t\t\tReader pValueClobReader = pValueClob.getCharacterStream();\n> \t\t\tpValueClobReader.read(pValueChars);\n> \t\t\tpValueClobReader.close();\n> \t\t\tpropertyValue = new String(pValueChars);\n> \t\t}\n1599c1610\n<                                      res.getString(PROPERTY_VALUE), \n---\n>                                      propertyValue,\n1614c1625,1629\n<         } finally {\n---\n>         } catch (IOException e) {\n>             getLogger().log(e,LOG_CHANNEL,Logger.ERROR);\n>             throw new ServiceAccessException(this, e);\n>         }\n> \tfinally {\n1682c1697,1699\n<                 statement.setString(4, property.getValue().toString());\n---\n> \t\tchar pValueChars[] = property.getValue().toString().toCharArray();\n> \t\tReader pValueReader = new CharArrayReader(pValueChars);\n>                 statement.setCharacterStream(4, pValueReader, pValueChars.\nlength);\n1686a1704\n> \t\tpValueReader.close();\n1692a1711,1713\n>             throw new ServiceAccessException(this, e);\n>         } catch (IOException e) {\n>             getLogger().log(e,LOG_CHANNEL,Logger.ERROR);", "id": 46984, "time": "2003-11-07T12:32:31Z", "creator": "pwalendziak@yahoo.com", "creation_time": "2003-11-07T12:32:31Z", "is_private": false, "attachment_id": null}]
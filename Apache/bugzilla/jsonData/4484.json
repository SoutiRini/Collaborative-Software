[{"count": 0, "tags": [], "creator": "darani@bsintel.com", "text": "Quick click 'new refresh' button of Internet exploer\n\n\"http://www.coderule.com:8080/servlet/MakeImage\"\n \n// MakeImage.java\n \nimport javax.servlet.*;\nimport javax.servlet.http.*;\nimport java.io.*;\nimport java.awt.*;\nimport java.awt.image.*;\nimport com.sun.image.codec.jpeg.*;\nimport java.util.*;\n \npublic class MakeImage extends HttpServlet\n{\n   public void doGet(\n       HttpServletRequest request,\n       HttpServletResponse response)\n         throws ServletException, IOException {\n \n     response.setContentType(\"image/jpeg\");\n \n     // Create image\n     int width=800, height=600;\n     BufferedImage image = new BufferedImage(\n       width, height, BufferedImage.TYPE_INT_RGB);\n \n     // Get drawing context\n     Graphics g = image.getGraphics();\n \n     // Fill background\n     g.setColor(Color.white);\n     g.fillRect(0, 0, width, height);\n \n     // Create random polygon\n     Polygon poly = new Polygon();\n     Random random = new Random();\n     for (int i=0; i < 20; i++) {\n       poly.addPoint(random.nextInt(width),\n         random.nextInt(height));\n     }\n \n     // Fill polygon\n     g.setColor(Color.cyan);\n     g.fillPolygon(poly);\n \n     // Dispose context\n     g.dispose();\n \n     // Send back image\n     ServletOutputStream sos =\n       response.getOutputStream();\n     JPEGImageEncoder encoder =\n       JPEGCodec.createJPEGEncoder(sos);\n     encoder.encode(image);\n \n   }\n}", "id": 7240, "time": "2001-10-28T20:23:38Z", "bug_id": 4484, "creation_time": "2001-10-28T20:23:38Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "remm@apache.org", "text": "Yes the VM crashes (using JDK 1.3.0_02 and JDK 1.4 b2). However, it's a VM bug, \nand not a Tomcat bug. I think it should be filed as a bug against the JDK.\nI have no idea which portion of the code displays the stack trace. Presumably \nthe code in sun.awt.image.codec.JPEGImageEncoderImpl. The native code used by \nthat part could be the source of the problems \n(sun.awt.image.codec.JPEGImageEncoderImpl.writeJPEGStream(Native Method)). It \nmay not like that the underlying stream is abruptly closed (refreshing the page \nin your browser very quickly would do this).\nTo avoid this, you should use a byte array output stream, and then write the \nbuffer to the servlet output stream.", "id": 7242, "time": "2001-10-28T23:27:35Z", "bug_id": 4484, "creation_time": "2001-10-28T23:27:35Z", "is_private": false, "attachment_id": null}]
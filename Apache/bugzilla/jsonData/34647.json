[{"count": 0, "tags": [], "bug_id": 34647, "text": "We have a cluster with two Tomcat servers. When we restart one of the nodes, \nwithout restarting the other one, it seems to be a problem in the communication \nbetween them. This is the log trace in the node that restarts, when it starts:\n\n[main] INFO  org.apache.catalina.cluster.session.DeltaManager  - Starting \nclustering manager...:/TEST\n[main] WARN  org.apache.catalina.cluster.session.DeltaManager  - Manager\n[/TEST], requesting session state from \norg.apache.catalina.cluster.mcast.McastMember\n[tcp://XXX.XXX.XXX.XXX:4001,XXX.XXX.XXX.XXXX,4001, alive=14436991]. This \noperation will timeout if no session state has been received within 60 seconds\n[main] ERROR org.apache.catalina.cluster.session.DeltaManager  - Manager\n[/TEST], No session state received, timing out.\norg.apache.jk.common.ChannelSocket init\n\n\nAnd the trace log in the node that remains alive:\n\norg.apache.catalina.cluster.tcp.SimpleTcpCluster memberDisappeared\nINFO: Received member disappeared:org.apache.catalina.cluster.mcast.McastMember\n[tcp://YYY.YYY.YYY.YYY:4001,YYY.YYY.YYY.YYY,4001, alive=6147693]\norg.apache.catalina.cluster.tcp.SimpleTcpCluster memberAdded\nINFO: Replication member added:org.apache.catalina.cluster.mcast.McastMember\n[tcp://YYY.YYY.YYY.YYY:4001,YYY.YYY.YYY.YYY,4001, alive=2]\n[org.apache.catalina.cluster.tcp.TcpReplicationThread[3]] ERROR \norg.apache.catalina.cluster.session.DeltaManager  - Unable to receive message \nthrough TCP channel\njava.lang.NullPointerException\n        at java.io.ObjectOutputStream$BlockDataOutputStream.getUTFLength\n(ObjectOutputStream.java:1898)\n        at java.io.ObjectOutputStream$BlockDataOutputStream.writeUTF\n(ObjectOutputStream.java:1769)\n        at java.io.ObjectOutputStream.writeUTF(ObjectOutputStream.java:787)\n        at \norg.apache.catalina.cluster.session.SerializablePrincipal.writePrincipal\n(SerializablePrincipal.java:180)\n        at org.apache.catalina.cluster.session.DeltaSession.writeObject\n(DeltaSession.java:1457)\n        at org.apache.catalina.cluster.session.DeltaSession.writeObjectData\n(DeltaSession.java:930)\n        at org.apache.catalina.cluster.session.DeltaManager.doUnload\n(DeltaManager.java:539)\n        at org.apache.catalina.cluster.session.DeltaManager.messageReceived\n(DeltaManager.java:854)\n        at org.apache.catalina.cluster.session.DeltaManager.messageDataReceived\n(DeltaManager.java:762)\n        at org.apache.catalina.cluster.tcp.SimpleTcpCluster.messageDataReceived\n(SimpleTcpCluster.java:576)\n        at org.apache.catalina.cluster.io.ObjectReader.execute\n(ObjectReader.java:70)\n        at org.apache.catalina.cluster.tcp.TcpReplicationThread.drainChannel\n(TcpReplicationThread.java:129)\n        at org.apache.catalina.cluster.tcp.TcpReplicationThread.run\n(TcpReplicationThread.java:67)\n\nI saw another bug similar to this one: 32280, but it finishes without a clear \nsolution.\n\nThanks in advance.", "id": 74170, "time": "2005-04-27T15:25:28Z", "creator": "aleonben@telefonica.net", "creation_time": "2005-04-27T15:25:28Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 34647, "text": "The strack trace indicates that you have a principal (you are logged in) but \nthe login name is null. Could you give us a small test case if you can create \none and reproduce the error?", "id": 74180, "time": "2005-04-27T17:53:53Z", "creator": "fhanik@apache.org", "creation_time": "2005-04-27T17:53:53Z", "is_private": false, "attachment_id": null}, {"count": 2, "attachment_id": null, "creator": "aleonben@telefonica.net", "text": "(In reply to comment #1)\n> The strack trace indicates that you have a principal (you are logged in) but \n> the login name is null. Could you give us a small test case if you can create \n> one and reproduce the error?\n\nHi Filip.\n\nI have just done a test. I stopped one of the nodes in the cluster and started \nit again... as there wasn't any active session in the moment, no problem \nreported when node starts. The two nodes found each other without any problem.\n\nThen, I have logged in with an user. It seems to be no problem with the logon, \nand I can correctly work with the application. When I stopped again one of the \nnodes, I can continue working whith the application because the other node \ntakes the control. But, when I started again the node that was down, the \nsituation that I have explained in my first post, it is repeated.\n\nIn that moment, the solution to communicate correctly the two nodes again is to \nstop and start both of them.\n\nThis is a big problem, because I don't have a real cluster... I only have load \nbalancing and failover for the first time, because if one node fails, I can't \ndo the cluster again... it is only possible if I restarts the two nodes!!!!\n\nBest regards.", "id": 74209, "time": "2005-04-28T08:49:56Z", "bug_id": 34647, "creation_time": "2005-04-28T08:49:56Z", "tags": [], "is_private": false}, {"count": 3, "attachment_id": null, "creator": "aleonben@telefonica.net", "text": "(In reply to comment #1)\n> The strack trace indicates that you have a principal (you are logged in) but \n> the login name is null. Could you give us a small test case if you can create \n> one and reproduce the error?\n\nHi Filip...\n\nHave you any information about the bug reported?\n\nThanks in advance,\n\nAnabel.", "id": 74422, "time": "2005-05-04T10:56:28Z", "bug_id": 34647, "creation_time": "2005-05-04T10:56:28Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 34647, "text": "Please, check your config with tomcat 5.5.12\n\nI fixed the serialization from some realm implementation.\n\nPeter\n\n\n*** This bug has been marked as a duplicate of 36218 ***", "id": 81453, "time": "2005-10-20T08:41:35Z", "creator": "pr@objektpark.de", "creation_time": "2005-10-20T08:41:35Z", "is_private": false, "attachment_id": null}]
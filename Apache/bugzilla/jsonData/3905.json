[{"count": 0, "tags": [], "creator": "tom@58k.com", "attachment_id": null, "is_private": false, "id": 6234, "time": "2001-10-01T10:32:55Z", "bug_id": 3905, "creation_time": "2001-10-01T10:32:55Z", "text": "In trying to write code that sends an xml packet to a servlet in the content of\nthe request, it appears\nthat the tomcat server is not handling the getInputStream() code correctly.\nWhat seems to happen is that the first close on the handle of the input\nstream - closes the stream permanently.  This means that the same exact\nrequest repeated 20 times will work the first time, but not the second\nor any futher beyond the first request.   This problem shows up both\nin 3.3 m4 and 3.3 rc1.  The message that shows up the second time is \"stream\nclosed\"\n\nMy code on the servlet side looks like:\n\npublic class processjdist\n{\n    public String contents =\"\";\n\n    public processjdist()\n    {\n    } \n    \n    public init(HttpServletRequest req, HttpServletResponse resp)\n    {\n        out = resp.getOutputStream();\n        try \n         {\n        if (req.getContentLength() > 0)\n        {\n           Reader r = req.getInputStream();\n           BufferedReader bufReader = new BufferedReader(r);\n\n           /// PROBLEM SHOWS UP HERE!!! Second time code is called\n           /// on the server\n           /// error is \"Stream closed\"\n           while ((line = bufReader.readLine()) != null)\n           {\n                contents += line;\n           }\n         \n           r.close();\n         }\n         } catch (IOException ioe)\n         {  \n              \n         }\n    }\n\n    public doPost(HttpServletRequest req, HttpServletResponse resp)\n    {\n        init(req,resp);\n    }\n}\n\nThe client side looks like\npublic class jdistclient\n{\n     StringBuffer outputBuffer = new StringBuffer();\n     public jdistclient()\n     {\n         String urlString =\"http://www.netmech.com/customer/apprequest/get\";\n        outputBuffer.append(\"<request>foo</request>\");\n        try\n        {\n            log.debug(\"fetch from urlFetch\");\n            // Send request to web server.\n            URL appreq = new URL(urlString);\n            \n  \n           \n            URLConnection c = appreq.openConnection();\n            log.debug(\"fetch 1\"); \n            c.setDoOutput(true);\n            c.setDoInput(true);\n            //c.setDoInput(true);\n            \n            DataOutputStream dout = new DataOutputStream(c.getOutputStream());\n            log.debug(\"fetch 1.5\");\n             \n            log.debug(\"fetch 2\");\n            dout.writeBytes(outputbuffer.toString());\n  \n           \n            log.debug(\"fetch 3\");  \n           \n           \n            dout.close();\n            \n            InputStream is = c.getInputStream();\n            log.debug(\"fetch 3.1\");\n            \n            \n            log.debug(\"fetch 3.1.5\");\n            InputStreamReader r = new InputStreamReader(is);\n            log.debug(\"fetch 3.2\");\n            BufferedReader in = new BufferedReader(r);\n                                          \n            log.debug(\"fetch 3.5\"); \n            \n            \n            String inputLine;\n             log.debug(\"fetch 4\"); \n            while ((inputLine = in.readLine()) != null)\n            {\n                log.debug(inputLine);\n                buffer.append(inputLine);\n                buffer.append(\"\\n\");\n            }\n            is.close();\n            in.close();\n           \n            \n            log.debug(\"fetch 5\"); \n\n        }\n        catch (IOException ioe)\n        {\n            log.error(\"Error:\"+ioe.getMessage());\n            String s = ioe.getMessage();\n            System.out.println(\"Error:\"+s);\n            System.out.println(ioe.getLocalizedMessage());\n            System.out.println(ioe.toString());\n        }\n\n     \n     }\n\n     public static void main(String [] args)\n     {\n        for (int i=0; i < 20; i++)\n         {\n             jdistclient j = new jdistclient();\n\n         }\n     }\n}"}, {"attachment_id": null, "tags": [], "creator": "william.barker@wilshire.com", "text": "Please get the latest code from the CVS.", "count": 1, "id": 6287, "time": "2001-10-02T12:28:37Z", "bug_id": 3905, "creation_time": "2001-10-02T12:28:37Z", "is_private": false}]
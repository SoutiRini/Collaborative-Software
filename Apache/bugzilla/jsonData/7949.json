[{"count": 0, "tags": [], "creator": "bertrand.guiral@lyra-network.com", "attachment_id": null, "text": "A multithread application  create 80 Categories, with a specific FileAppender \nfor every Category.\nSome data of a thread are logged in a  wrong file. Sometime, a part of the \nlayout are not apply.\n\nBertrand Guiral\n\nI write a short program to reproduce the bug:\n\npackage com.lyra.cbcom.pad;\n\nimport java.util.*;\nimport org.apache.log4j.*;\nimport org.apache.log4j.BasicConfigurator;\nimport org.apache.log4j.xml.DOMConfigurator;\n/**\n * Description : Test log4J with multiThread\n * Copyright :    No\n * Soci\u00e9t\u00e9 : Lyra\n * @author : Bertrand Guiral\n */\n\n\npublic class MainTestLog4j {\n\n\nstatic final Category loggerB = Category.getInstance(\"Test\");\n\n\n  public MainTestLog4j() {\n     MainPad.initLogger();\n     this.test();\n  }\n\n  public static void main(String[] args) {\n      new MainTestLog4j();\n  }\n  /**\n   *\n   */\n  protected  void test() {\n      for (int i=0; i< 80 ;i++) {\n          this.createLogger(i);\n      }\n  }\n\nprivate com.lyra.util.log4j.PatternLayout  layout  = new \ncom.lyra.util.log4j.PatternLayout(\"%H %d %-5p   \\t    %m%n\");\n// private  org.apache.log4j.PatternLayout  layout  = new \norg.apache.log4j.PatternLayout(\"%H %d %-5p   \\t    %m%n\");\n\n //private Layout  layout  = new com.lyra.util.log4j.PatternLayout(\"%H %d %-5p \n%-12t  %-19F:%-L\\t    %m%n\");\n  private void createLogger(int i) {\n        try {\n            String fileName = \"a_____\"+i+\"_test.log\";\n            FileAppender appenderTest = new FileAppender(layout,fileName);\n            appenderTest.setName(fileName);\n            //appenderTest.setImmediateFlush(true);\n            appenderTest.setAppend(true);\n            appenderTest.setFile(fileName);\n            appenderTest.setLayout(layout);\n            appenderTest.activateOptions();\n\n            Category logger_ = Category.getInstance(\"Z\"+i+\"_Modem_category\");\n            logger_.setAdditivity(false);\n            logger_.setPriority(Priority.DEBUG);\n            logger_.removeAllAppenders();\n            logger_.addAppender(appenderTest);\n            new ThreadLogTest(logger_,i);\n        } catch(Exception e) {\n        }\n\n }\n /**\n  *\n  */\n private static String getLoggerAppenders(Category categ) {\n              String s =  \" getLoggerAppenders :::: \";\n              Enumeration enu = categ.getAllAppenders();\n              while (enu.hasMoreElements()) {\n                Appender appender = (Appender) enu.nextElement();\n                s += \": @append \" + appender;\n                s += \" : appender.getName : \"+appender.getName();\n                if (FileAppender.class.isInstance(appender)) {\n                    FileAppender fileAppender =(FileAppender) appender;\n                    s += \" FileAppender \"+fileAppender.getFile();\n                }\n              }\n              return s;\n  }\n  \n  \n  class ThreadLogTest extends Thread {\n      private Category category;\n      private int i   ;\n      public ThreadLogTest(Category category_, int i_) {\n          category = category_;\n          this.i = i_;\n          this.setName(\"Test_\"+i);\n          this.start();\n          System.out.println(i+\"    \"+\"start\");\n      }\n      public void run() {\n        int k=0;\n        while (k < 1000) {\n          this.category.info\n(\">>>>>\"+i+\"<<<<<<<__________________\"+MainTestLog4j.getLoggerAppenders\n(category)+    \"__________________\"+i+\"__\");\n          k++;\n        }\n      }\n\n   }\n\n}", "id": 13227, "time": "2002-04-11T08:22:52Z", "bug_id": 7949, "creation_time": "2002-04-11T08:22:52Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 7949, "text": "The problem does not occur when every FileAppender has its own layout.\nIf every FileAppender share the same layout, it doent't work.", "id": 13255, "time": "2002-04-11T15:48:23Z", "creator": "bertrand.guiral@lyra-network.com", "creation_time": "2002-04-11T15:48:23Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 7949, "attachment_id": null, "text": "\nLayouts are not supposed to be shared.", "id": 14783, "time": "2002-04-25T21:28:12Z", "creator": "ceki@apache.org", "creation_time": "2002-04-25T21:28:12Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "jan.schulte@hp.com", "attachment_id": null, "text": "We use Apache 2.2.8 with mod_JK 1.2.26 as a load-balancer for a Tomcat 5.5 cluster.\nWe use Custom HTTP-Error codes like 450 for authentication-purposes. Those\ncodes get remapped to 500.\nThe Error-Code 450 is in the RFC2616 described as valid return code so this is\na bug.\n\nThe custom error-codes worked fine in Apache 1.3.41 with MOD_JK/1.2.25.\n\nYou can easily reproduce this bug by writing a simple jsp-page with the following\nline:\n<%response.setStatus(450);%>", "id": 116767, "time": "2008-05-18T04:16:12Z", "bug_id": 45026, "creation_time": "2008-05-18T04:16:12Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 45026, "text": "With the same version of Tomcat (trunk) and a slightly older mod_jk (1.2.24) this appears to be a difference between httpd 1.3.x and 2.2.x\n\nI've has a quick look in RFC 2616 and I didn't find anything relating to custom status codes. Can you provide a reference to the section of RFC2616 to which you are referring.\n\nI need to take a look at the httpd docs.", "id": 116768, "time": "2008-05-18T05:02:26Z", "creator": "markt@apache.org", "creation_time": "2008-05-18T05:02:26Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 45026, "attachment_id": null, "id": 116772, "time": "2008-05-18T08:43:09Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-05-18T08:43:09Z", "is_private": false, "text": "If necessary, the httpd part of this issue should be discussed in its predecessor BZ 44495 ( https://issues.apache.org/bugzilla/show_bug.cgi?id=44995 )."}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Thanks Rainer. It would of been helpful if that had been included in the original report.\n\nI've taken a look at mod_jk and it seems to be complaining about a lack of a body. I'm not sure if this is a Tomcat or a mod_jk issue at the minute. Need to do more testing.", "id": 116773, "time": "2008-05-18T09:46:34Z", "bug_id": 45026, "creation_time": "2008-05-18T09:46:34Z", "is_private": false}, {"count": 4, "tags": [], "text": "Rainer - this might be quicker for you to track down. The following patch ensures the correct status is returned but the body generated by Tomcat is disappearing somewhere (I suspect inside mod_jk).\n\nIndex: java/org/apache/jk/common/JkInputStream.java\n===================================================================\n--- java/org/apache/jk/common/JkInputStream.java\t(revision 657140)\n+++ java/org/apache/jk/common/JkInputStream.java\t(working copy)\n@@ -278,6 +278,10 @@\n         } else {\n             message = message.replace('\\n', ' ').replace('\\r', ' ');\n         }\n+        if (message == null) {\n+            // mod_jk + httpd 2.x fails with a null status message - bug 45026\n+            message = Integer.toString(res.getStatus());\n+        }\n         tempMB.setString( message );\n         c2b.convert( tempMB );\n         outputMsg.appendBytes(tempMB);\n", "attachment_id": null, "id": 116778, "creator": "markt@apache.org", "time": "2008-05-18T11:27:59Z", "bug_id": 45026, "creation_time": "2008-05-18T11:27:59Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 45026, "attachment_id": null, "id": 116840, "time": "2008-05-20T06:01:31Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-05-20T06:01:31Z", "is_private": false, "text": "That helped a lot. Indeed it seems httpd 2.x forces a status line to contain a non empty reason phrase, although RFC 2616 seems to allow empty ones. I posted to httpd-dev about that.\n\nI would say your patch looks good, because having a trivial one looks better then none and it fixes the problem independent of any httpd fix.\n\nDepending on the httpd discussion, I'll see, if we add the same check to mod_jk as well, to fix the problem for older TC and httpd.\n"}, {"count": 6, "tags": [], "bug_id": 45026, "attachment_id": null, "id": 116842, "time": "2008-05-20T07:24:30Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-05-20T07:24:30Z", "is_private": false, "text": "See: http://marc.info/?t=121128830700002&r=1&w=2"}, {"count": 7, "tags": [], "bug_id": 45026, "attachment_id": null, "id": 116973, "time": "2008-05-26T04:54:52Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-05-26T04:54:52Z", "is_private": false, "text": "A fix will be included in mod_jk version 1.2.27.\n\nAlthough the root problem lies within Apache httpd 2.x, we are able to work around it. We will add \"Unknown Reason\" as a reason phrase in case we receive an http status with empty reason phrase from the backend (as is likely for custom http stati; unfortunately the servlet spec has no method for setting a reason phrase).\n\nA similar approach will be taken for Tomcat, to not return an empty reason phrase.\n\nI guess, the httpd people will also make httpd more tolerant for empty reason phrases."}, {"count": 8, "tags": [], "bug_id": 45026, "attachment_id": null, "id": 117570, "time": "2008-06-11T06:30:51Z", "creator": "jens.scheffler@hp.com", "creation_time": "2008-06-11T06:30:51Z", "is_private": false, "text": "Thanks for the information - while 1.2.27 of the plugin is still not fully released and also the httpd will take a moment to get this implemented we managed to change our code to always include a reason phrase - the servlet spec allows to send one or leave it out. If a correct reason is provided, it is working out fine.\n\nwhen the code...\nresponse.setStatus(int) or\nresponse.sendError(int)\n...is used, the problem is showing up and HTTP 500 is returned to user.\n\nIf we use the both methods...\nresponse.setStatus(int, String) or\nresponse.sendError(int, String)\n...and the String is NOT NULL, then the resulting HTTP response code is correct.\n\nThanks & Best Regards,\n\nJens\n"}, {"count": 9, "tags": [], "text": "A fix has also been applied to TC 6.0 (r762499) and TC 5.5 (r762510) to become part of 6.0.20 and 5.5.28. So updating either one of mod_jk or Tomcat does already solve the problem.", "is_private": false, "id": 126033, "creator": "rainer.jung@kippdata.de", "time": "2009-04-06T15:14:57Z", "bug_id": 45026, "creation_time": "2009-04-06T15:14:57Z", "attachment_id": null}]
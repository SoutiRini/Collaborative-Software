[{"count": 0, "tags": [], "creator": "xshao@ebay.com", "text": "Created attachment 29688\nPatch for BodyContentImpl.java\n\nSimilar as BUG 35410, there is a NPE when calling BodyContentImpl#write(String) if the String is NULL.", "id": 163827, "time": "2012-12-04T07:53:25Z", "bug_id": 54241, "creation_time": "2012-12-04T07:53:25Z", "is_private": false, "attachment_id": 29688}, {"count": 1, "tags": [], "text": "I have a number of concerns with this proposed change:\n\n1. Writers generally do throw NPEs when called with null.\n\n2. I'm not convinced 35410 should have been fixed since toString() should never return null (else all sorts of standard code patterns break).\n\n3. The patch should ideally include a test case.\n\n4. The proposed patch only addresses one possible NPE of many.", "attachment_id": null, "id": 163829, "creation_time": "2012-12-04T08:25:16Z", "time": "2012-12-04T08:25:16Z", "creator": "markt@apache.org", "bug_id": 54241, "is_private": false}, {"count": 2, "tags": [], "bug_id": 54241, "attachment_id": null, "id": 163839, "creation_time": "2012-12-04T12:38:36Z", "time": "2012-12-04T12:38:36Z", "creator": "knst.kolinko@gmail.com", "text": "What is your stacktrace and in what case this issue is triggered?\n\n\n1. I agree with Mark that Writer.write((String)null) should throw an NPE\n\n2. Regarding bug 35410 I think that the fix is wrong but in another way\n\nExpressions are defined in two places in JSP 2.2,\na) JSP.1.12.3 \"Expressions\"\nb) JSP.9.4.3 \"Expressions\"\n\nb) says that <%= expr %> is out.print(expr)\nand JspWriter.print(String) is defined to print null value as \"null\", not \"\".\n\nSo using the test from bug 35410 I expect \"null null null\". The actual result in 7.0.33 is \"null null\".\n\nThe generated java code is\n      out.print( test );\n\nI think it should generate\n      out.print( String.valueOf(test) );\n\n\nThe behaviour of JspWriterImpl.print(Object) could be \"improved\" to handle obj.toString() returning null,  but I do not think that such change is needed, because its current behaviour is consistent with PrintWriter.print(Object) which results in an NPE.\n\nMy reading is that the spec says that the value of the expression should be coerced to String *before* printing it.", "is_private": false}, {"count": 3, "attachment_id": null, "bug_id": 54241, "is_private": false, "id": 164313, "time": "2013-01-02T11:58:36Z", "creator": "markt@apache.org", "creation_time": "2013-01-02T11:58:36Z", "tags": [], "text": "+1 to Konstantin's analysis. I'll work on a test case and patch based on bug 35410. We could re-open that one but since it is for 5.5.x which is now unsupported I'd rather just deal with it here."}, {"count": 4, "tags": [], "bug_id": 54241, "attachment_id": null, "is_private": false, "id": 164319, "time": "2013-01-02T15:59:35Z", "creator": "markt@apache.org", "creation_time": "2013-01-02T15:59:35Z", "text": "The proposed patch was not applied and the previous fix for bug 35410 has been reverted. The changes will be in Tomcat 7.0.35 onwards."}]
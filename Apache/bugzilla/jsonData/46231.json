[{"count": 0, "tags": [], "bug_id": 46231, "text": "Hello,\n\nI think there's a bug with mod_proxy_ajp and connection pooling. I explain myself ...\n\nI've run some tests with brand new Apache 2.2.6 and 2.2.10 instalations.\nAfter that I enable mod_proxy and mod_proxy_ajp and add these lines :\n\nProxyRequests Off\nProxyPass /servlets-examples/servlet/HelloWorldExample ajp://localhost/servlets-examples/servlet/HelloWorldExample\n\nThere's a Tomcat 5.5.25 as the backend server with AJP 8009 port open\n\nThen I use JMeter to pound on the same Servlet, ever and ever, with 10 threads.\n\nApache opens a socket for every HTTP requests and closes it causing a TIME_WAIT.\nWhen too many ports are on TIME_WAIT, Apache cannot create new sockets and this comes to an error in the error.log and a 503 \"server too busy\" for the user browser.\n\nApache can't stand this treatment for more than 30 secs before causing 503s.\n\nThen starts the weird thing :\n\nWhen I change the proxyPass line with this :\nProxyPass /servlets-examples/servlet/HelloWorldExample ajp://localhost:8009/servlets-examples/servlet/HelloWorldExample\n\nThere's no more problem !!! No TIME_WAIT ... connection pool is used ... only 10 ESTABLISHED connections ... It's a kind of magic for me ...\n\nThis is a simple example to reproduce the \"bug\" but I have the same TIME_WAIT 503 bug with another Servlet Name even with the :8009 port specified ...\nI've tried to mess with the pool settings with no more luck than letting the default (no specifiing pool params)\n\nfor testing how many TIME_WAIT I have I use \"netstat -an | find \":8009\" | find /c \"TIME\"\nThis command is supposed to return always 0 if the connection pool is used.\n\nThis behaviour is reproduced on XP too.", "id": 122600, "time": "2008-11-18T09:33:09Z", "creator": "giesyntm@yahoo.com", "creation_time": "2008-11-18T09:33:09Z", "is_private": false, "attachment_id": null}]
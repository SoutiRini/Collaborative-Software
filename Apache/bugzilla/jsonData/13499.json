[{"count": 0, "tags": [], "bug_id": 13499, "attachment_id": null, "id": 24280, "time": "2002-10-10T15:43:58Z", "creator": "aah@acm.org", "creation_time": "2002-10-10T15:43:58Z", "is_private": false, "text": "For starters, I'm using Jetty, not Tomcat, and have no way to test this in\nTomcat.  Here's a copy of my test.jsp:\n\n---\n<%@ page buffer=\"none\" %>\n<% pageContext.forward(\"/index.jsp\"; %>\n---\n\nIn Jetty, this results in the following:\n\njava.lang.IllegalStateException: Illegal to clear() when buffer size == 0\nat org.apache.jasper.runtime.JspWriterImpl.clear(JspWriterImpl.java:184)\nat org.apache.jasper.runtime.PageContextImpl.forward(PageContextImpl.java:410)\n\nSince buffer=\"none\", this seems to be a semantically correct exception, but it\ndoesn't make any sense -- why would this combination be illegal?"}, {"count": 1, "tags": [], "text": "And you have something against using a buffer (which should be faster) ?\n\nOtherwise, it's quite clear why it happens: forward resets the response (well,\nthe buffer since it's JSP), and clearing the non existing buffer raises the ISE.\nSo not using a buffer is currently not supported at all.", "is_private": false, "id": 24281, "creator": "remm@apache.org", "time": "2002-10-10T15:54:42Z", "bug_id": 13499, "creation_time": "2002-10-10T15:54:42Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "aah@acm.org", "attachment_id": null, "id": 24286, "time": "2002-10-10T16:01:29Z", "bug_id": 13499, "creation_time": "2002-10-10T16:01:29Z", "is_private": false, "text": "Sure.  Like I said, the exception makes semantic sense.  But there's nothing in\nthe spec, that I see, that implies this *should* be illegal.  If it *is* illegal\nby spec, I'm more than willing to fix my code.\n\nFor the record, I *do* use a buffer.  But I set it on the servlet level, in a\nbase class that all my JSPs extend.\n\nA quick reading of your comment implies that the spec has no problem with this,\nbut the current implementation of Jasper 2 can't handle this (entirely legal)\ncase.  As I said, I'm more than happy to fix my code if it's wrong, but it's a\nlittle annoying to change upwards of 900 JSPs if it's something that Jasper can,\nand should, be fixed to handle.\n"}, {"count": 3, "tags": [], "creator": "remm@apache.org", "text": "This was just some advice, as the JSP buffer is separate from the servlet buffer\n(and that one is lower level), you'll probably get better performance from that\nsetting.\nBut it's indeed a bug (which I qualified as minor as it shouldn't impact many\npeople, and has an easy workaround). It would probably be fixed faster if you\nsubmitted a patch.", "id": 24293, "time": "2002-10-10T16:58:02Z", "bug_id": 13499, "creation_time": "2002-10-10T16:58:02Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 13499, "attachment_id": null, "id": 24378, "time": "2002-10-11T23:48:12Z", "creator": "aah@acm.org", "creation_time": "2002-10-11T23:48:12Z", "is_private": false, "text": "Well, I looked into this a little.  JspWriterImpl seems a little schizophrenic\nin it's handling of null buffers -- it carefully checks in some cases, and in\nothers it explicitly states that 0-length buffers are in error, but allows them\nin any case.\n\nA patch for this seems as simple as deleting the explicit check for bufferSize\n== 0 in clear(); the check doesn't actually stop anything bad from happening.\n\nI can't imagine that it's needed, but I'll add a patch."}, {"count": 5, "tags": [], "bug_id": 13499, "attachment_id": 3433, "text": "Created attachment 3433\nremoves unnecessary bufferSize check", "id": 24379, "time": "2002-10-11T23:49:40Z", "creator": "aah@acm.org", "creation_time": "2002-10-11T23:49:40Z", "is_private": false}, {"count": 6, "tags": [], "text": "Can I prod someone into taking a look at this?  I realize this is a\nlow-importance bug to most folks, but it seems a simple change.  \n\nFollowing the code path in JspWriterImpl.clear() is simple -- the only actual\ncall is to ensureOpen(), which will throw an exception if the stream has been\nclosed.  This is a legitimate check even in the case of a null buffer.\n\nAs I said in my previous comment, the check and exception I removed don't seem\nto do anything useful.", "is_private": false, "id": 24822, "creator": "aah@acm.org", "time": "2002-10-17T19:00:15Z", "bug_id": 13499, "creation_time": "2002-10-17T19:00:15Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 13499, "attachment_id": null, "id": 33793, "time": "2003-03-25T21:29:42Z", "creator": "aah@acm.org", "creation_time": "2003-03-25T21:29:42Z", "is_private": false, "text": "Prodding again.  This bug is still in evidence it Jasper.  Any chance someone\ncan apply the patch?  Or explain why the patch won't be applied?"}, {"count": 8, "tags": [], "bug_id": 13499, "attachment_id": null, "id": 54240, "time": "2004-03-18T21:06:48Z", "creator": "markt@apache.org", "creation_time": "2004-03-18T21:06:48Z", "is_private": false, "text": "I have just fixed this in CVS for TC4 and TC5.\n\nSorry it took a while to apply this patch."}, {"count": 9, "tags": [], "text": "Sorry, I have had to revert this patch as it broke more than it fixed. I'll \ntry and identify an alternative solution.", "attachment_id": null, "bug_id": 13499, "id": 54276, "time": "2004-03-19T17:39:04Z", "creator": "markt@apache.org", "creation_time": "2004-03-19T17:39:04Z", "is_private": false}, {"count": 10, "tags": [], "text": "I have now committed an improved patch for TC4 and TC5.\n\nYou will need to be very careful that there has been absolutely no output \nbefore the forward. For example a page that starts\n\n<%@ page buffer=\"none\" %>\n<% pageContext.forward(\"/index.jsp\"; %>\n\nwill still throw an exception due to the newline output as a result of the \nfirst line. You would need to format the start of the jsp on a single line eg\n\n<%@ page buffer=\"none\" %><% pageContext.forward(\"/index.jsp\"); %>\n\nor use the (non-spec conformant) trimSpaces option on TC5.\n", "is_private": false, "id": 54304, "creator": "markt@apache.org", "time": "2004-03-20T09:54:11Z", "bug_id": 13499, "creation_time": "2004-03-20T09:54:11Z", "attachment_id": null}]
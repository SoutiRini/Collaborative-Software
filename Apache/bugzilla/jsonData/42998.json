[{"count": 0, "tags": [], "creator": "mark.vollmann@opentext.com", "attachment_id": null, "is_private": false, "id": 106047, "time": "2007-07-30T03:05:03Z", "bug_id": 42998, "creation_time": "2007-07-30T03:05:03Z", "text": "The following snippet does not work because the parameters are not created\ncorrectly.\n\nTo be precise:\n1. Define imageParameters with \"JPEG\" set as encoding\n2. TiffImageWriter#createTIFFEncodeParams(lines 60++) will  NOT call\nsetJPEGEncodeParam\n3. Eventually TiffImageEncoder gets called and in line 467ff a call to\nTIFFEncodeParam#getJPEGEncodeParam() is done, which returns null => NPE in line\n472 int maxSubH = jep.getHorizontalSubsampling(0);\n\n\nThe whole class TiffImageWriter seems untested because if i look at the source i\nsee in line 46 the method public void writeImage(RenderedImage image,\nOutputStream out) which passes null to as ImageWriterParams to 54:public void\nwriteImage(RenderedImage image, OutputStream out,ImageWriterParams params)\nthrows IOException , which in turn passed null to 61:     private\nTIFFEncodeParam createTIFFEncodeParams(ImageWriterParams params).\n\nFirst statement in that method is if (params.getCompressionMethod() == null) ,\nso you will get NPE here too...\n\n\t\torg.apache.xmlgraphics.image.writer.ImageWriter imageWriter = new\nTIFFImageWriter();\n\t\tMultiImageWriter writer = null;\n\t\ttry\n\t\t{\n\t\t\twriter = imageWriter.createMultiImageWriter(stream);\n\t\t\t// retrieve writer\n\t\t\tif (imageWriter != null)\n\t\t\t{\n\t\t\t\tlog.info(\"get image writers parameters\");\n\t\t\t\t\n\t\t\t\tImageWriterParams iwp = new ImageWriterParams();\n\t\t\t\t\tiwp.setCompressionMethod(\"JPEG\");\n\t\t\t\tiwp.setJPEGQuality(compressionQuality, true);\n\t\t\t\tiwp.setResolution(param.getDpi());\n\n\t\t\t\tlog.info(\"render pages\");\n\t\t\t\tfor (int pageNumber = fromPageNumber; pageNumber <= toPageNumber; pageNumber++)\n\t\t\t\t{\n\t\t\t\t\tBufferedImage image;\n\t\t\t\t\t\n\t\t\t\t\t<snip>\n\t\t\t\t\t// do stuff to create image\n\t\t\t\t\t</snip>\n\t\t\t\t\tlog.info(\"write image\");\n\t\t\t\t\twriter.writeImage(image, iwp);\n\t\t\t\t}\n\t\t\t}\n\t\tcatch...\n\t\tfinally\n\t\twriter.close()"}, {"count": 1, "tags": [], "creator": "jeremias@apache.org", "attachment_id": null, "text": "I have managed to get rid of the NPE but this is a bee's nest here. I haven't\nmanaged to produce a proper JPEG-encoded TIFF with either the internal codec or\nImageIO from Java 1.4. I have to give up for the moment. You're welcome to\ninvestigate further and reopen another Bugzilla issue if you have a patch that\nimproves the situation.\n\nBTW, I suggest you lay your focus on ImageIOTIFFImageWriter instead of this\ninternal codec which is also based on code from Sun.\n\nWe've just started putting Sanselan into the Apache Incubator. This could also\nbe an alternative for you if you want a JPEG-capable TIFF encoder. I haven't\nlooked into the code in depth but eventually we will also have an ImageWriter\nimplementation for Sanselan, I can imagine.", "id": 109126, "time": "2007-10-08T08:43:15Z", "bug_id": 42998, "creation_time": "2007-10-08T08:43:15Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "Created attachment 29302\nPatch for FileDirContext.java\n\nWeld's TomcatListener is using the recurse method recited below. In the case I am encountering the DirContext that Tomcat provides is a FileDirContext.\n\nThe discovery code used by Weld encounters what appears to be a bug in FileDirContext where FileDirContexts for child directories are created with the current FileDirContext's path. This causes an infinite loop while it searches the root directory over and over.\n\nAssuming the class discovery code Weld is using is correct, I tracked down the problem to a specific line in FileDirContext.java.  Fixing this line to set the path of the new child FileDirContext to the matching child directory fixes the issue I am encountering. With this change the project appears to still pass all the unit tests ran with \"ant test\". I have attached the patch to this issue.\n\n\nHere is Weld's recurse function which I am assuming is correct...\n\nprotected static void recurse(DirContext context, Set<String> classes, Set<URL> urls, String prefix) throws Exception {\n    if (prefix.length() > 0)\n        prefix += \".\";\n\n    NamingEnumeration ne = context.listBindings(\"\");\n    while (ne.hasMoreElements()) {\n        Binding next = (Binding) ne.nextElement();\n        String name = prefix + next.getName();\n        if (name.endsWith(\".class\")) {\n            classes.add(name.substring(0, name.length() - 6));\n            continue;\n        }\n\n        Object nextObject = next.getObject();\n        if (nextObject instanceof DirContext) {\n            recurse((DirContext) nextObject, classes, urls, name);\n        }\n    }\n}", "attachment_id": 29302, "bug_id": 53800, "id": 161827, "time": "2012-08-30T06:19:19Z", "creator": "kdubb@me.com", "creation_time": "2012-08-30T06:19:19Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 53800, "attachment_id": null, "text": "Fixed in 7.0 with r1378819 and will be in 7.0.30.\nProposed for 6.0.\n\n\n> Here is Weld's recurse function which I am assuming is correct...\n\nIt would be a lot better if they used Servlet API (ServletContext.getResourcePaths(..)) for their task.\nWell, I do not know all circumstances.", "id": 161828, "time": "2012-08-30T06:57:32Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-08-30T06:57:32Z", "is_private": false}, {"count": 2, "tags": [], "text": "Fixed in 6.0.x and will be included in 6.0.36", "is_private": false, "id": 162571, "creation_time": "2012-10-04T16:36:33Z", "time": "2012-10-04T16:36:33Z", "creator": "markt@apache.org", "bug_id": 53800, "attachment_id": null}]
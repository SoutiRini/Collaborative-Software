[{"count": 0, "tags": [], "text": "0. I'm using a Gentoo Linux box (2.6.22-gentoo-r5).\nI experienced the problem using mpm_prefork and mpm_worker.\nThe problem is always reproducible using the following steps.\n\n1.install Apache2 2.2.6(2)(09:34:11 09/10/07) (-debug doc ldap -mpm-event\n-mpm-itk -mpm-peruser -mpm-prefork mpm-worker -no-suexec -selinux ssl\n-static-modules -threads)\n\n2.enable webdav support\nipaq ~ # grep ^APACHE2_OPTS /etc/conf.d/apache2\nAPACHE2_OPTS=\"-D INFO -D LANGUAGE -D MANUAL -D SUEXEC -D PHP5 -D SSL -D DAV -D\nDAV_FS\"\n\nand enable a webdav over ssl in the default virtual host config file:\n\nListen 443\n<VirtualHost _default_:443>\n        ServerAdmin admin@bigip.it\n        DocumentRoot /var/www/www.mydomain.it/htdocs\n        ServerName www.mydomain.it\n        ErrorLog logs/ssl.err\n        TransferLog logs/ssl.log\n\n        <Directory \"/var/www/www.mydomain.it/htdocs\">\n                Options Indexes FollowSymLinks\n                AllowOverride Limit\n                Order allow,deny\n                Allow from all\n        </Directory>\n\n\n<IfModule mod_dav.c>\n        Alias /dav /var/www/www.mydomain.it/htdocs/dav\n        DavMinTimeout 600\n        <Location /dav>\n                Options None Indexes\n                Dav On\n                LimitXMLRequestBody 1000000\n                DavMinTimeout 30\n                DavDepthInfinity off\n                <Limit GET PUT POST DELETE PROPFIND PROPPATCH MKCOL COPY MOVE\nLOCK UNLOCK>\n                        AuthType Basic\n                        AuthName \"WebDav Restricted Repository\"\n                        AuthUserFile /var/www/www.mydomain.it/davpwd/.davpwd\n                        Require valid-user\n                </Limit>\n        </Location>\n</IfModule>\n</VirtualHost>\n\n3. on your client create some data to be transfered to the webdav server\nalberto@nabas ~ $ mkdir ~dav\nalberto@nabas ~ $ cd dav\nalberto@nabas ~dav $ wget\nhttp://downloads.sourceforge.net/filezilla/FileZilla_3.0.0_i586-linux-gnu.tar.bz2\nalberto@nabas ~dav $ wget\nhttp://heanet.dl.sourceforge.net/sourceforge/htop/htop-0.6.6.tar.gz\nalberto@nabas ~dav $ wget http://mirror.tomato.it/apache/httpd/httpd-2.2.6.tar.bz2\nalberto@nabas ~dav $ wget http://hem.bredband.net/jpgraph/jpgraph-1.21b.tar.gz\nalberto@nabas ~dav $ wget\nhttp://www.kernel.org/pub/linux/kernel/v2.6/linux-2.6.22.6.tar.bz2\n\nuntar all the files\n\n4. open Konqueror on the client and try to copy dav folder to you webdav server\nusing ssl:\n\nwebdavs://davusr@www.mydomain.it/dav\n\nThe Linux server after a while experienced an out of memory condition (I have\njust 384MB RAM and 512MB swap area).\nIn the Apache log file no error was found. The web server for a about 3/4\nminutes (on a PIII 700MHZ) is unavailable and then come back online without\nservice restart.\nIn the /var/log/messages I can see a lot of errors as this one:\n\nSep 11 10:18:08 ipaq apache2 invoked oom-killer: gfp_mask=0x201d2, order=0,\noomkilladj=0\nSep 11 10:18:19 ipaq [<c013cecc>] out_of_memory+0x69/0x189\nSep 11 10:18:32 ipaq [<c013e35f>] __alloc_pages+0x203/0x28d\nSep 11 10:18:40 ipaq [<c013f866>] __do_page_cache_readahead+0xbd/0x1dd\nSep 11 10:18:40 ipaq [<c01aee2e>] ext3_get_block+0x0/0xd0\nSep 11 10:18:40 ipaq [<c040e81a>] io_schedule+0x1d/0x27\nSep 11 10:18:40 ipaq [<c040e9fc>] __wait_on_bit_lock+0x4b/0x52\nSep 11 10:18:40 ipaq [<c013a218>] __lock_page+0x58/0x5e\nSep 11 10:18:40 ipaq [<c013c3e4>] filemap_nopage+0x152/0x2a4\nSep 11 10:18:40 ipaq [<c014563d>] __handle_mm_fault+0x15d/0x7f3\nSep 11 10:18:40 ipaq [<c0121ba9>] run_timer_softirq+0x126/0x154\nSep 11 10:18:40 ipaq [<c011d2f4>] do_wait+0x918/0x9ae\nSep 11 10:18:40 ipaq [<c0410d7d>] do_page_fault+0x20d/0x52b\nSep 11 10:18:40 ipaq [<c015f6a9>] sys_select+0x161/0x187\nSep 11 10:18:40 ipaq [<c0410b70>] do_page_fault+0x0/0x52b\nSep 11 10:18:40 ipaq [<c040f9aa>] error_code+0x72/0x78\nSep 11 10:18:40 ipaq [<c0400000>] xprt_connect+0xe/0xfb\nSep 11 10:18:40 ipaq =======================\nSep 11 10:18:40 ipaq Mem-info:\nSep 11 10:18:40 ipaq DMA per-cpu:\nSep 11 10:18:40 ipaq CPU    0: Hot: hi:    0, btch:   1 usd:   0   Cold: hi:   \n0, btch:   1 usd:   0\nSep 11 10:18:40 ipaq Normal per-cpu:\nSep 11 10:18:40 ipaq CPU    0: Hot: hi:  186, btch:  31 usd: 172   Cold: hi:  \n62, btch:  15 usd:   0\nSep 11 10:18:40 ipaq Active:44644 inactive:44277 dirty:0 writeback:0 unstable:0\nSep 11 10:18:40 ipaq free:995 slab:1904 mapped:8 pagetables:482 bounce:0\nSep 11 10:18:40 ipaq DMA free:1552kB min:104kB low:128kB high:156kB\nactive:4792kB inactive:4348kB present:16256kB pages_scanned:15967\nall_unreclaimable? yes\nSep 11 10:18:40 ipaq lowmem_reserve[]: 0 364 364\nSep 11 10:18:40 ipaq Normal free:2428kB min:2384kB low:2980kB high:3576kB\nactive:173784kB inactive:172760kB present:372872kB pages_scanned:624531\nall_unreclaimable? yes\nSep 11 10:18:40 ipaq lowmem_reserve[]: 0 0 0\nSep 11 10:18:40 ipaq DMA: 0*4kB 0*8kB 1*16kB 0*32kB 0*64kB 0*128kB 0*256kB\n1*512kB 1*1024kB 0*2048kB 0*4096kB = 1552kB\nSep 11 10:18:40 ipaq Normal: 1*4kB 10*8kB 1*16kB 0*32kB 0*64kB 0*128kB 1*256kB\n0*512kB 0*1024kB 1*2048kB 0*4096kB = 2404kB\nSep 11 10:18:40 ipaq Swap cache: add 132564, delete 132564, find 1783/2473, race 0+6\nSep 11 10:18:40 ipaq Free swap  = 0kB\nSep 11 10:18:40 ipaq Total swap = 506512kB\nSep 11 10:18:40 ipaq Free swap:            0kB\nSep 11 10:18:40 ipaq 98048 pages of RAM\nSep 11 10:18:40 ipaq 0 pages of HIGHMEM\nSep 11 10:18:40 ipaq 2364 reserved pages\nSep 11 10:18:40 ipaq 2599 pages shared\nSep 11 10:18:40 ipaq 0 pages swap cached\nSep 11 10:18:40 ipaq 0 pages dirty\nSep 11 10:18:40 ipaq 0 pages writeback\nSep 11 10:18:40 ipaq 8 pages mapped\nSep 11 10:18:40 ipaq 1904 pages slab\nSep 11 10:18:40 ipaq 482 pages pagetables\nSep 11 10:18:51 ipaq Out of memory: kill process 8698 (apache2) score 272698 or\na child\nSep 11 10:19:46 ipaq Killed process 8699 (apache2)\nSep 11 10:20:58 ipaq syslog-ng invoked oom-killer: gfp_mask=0x201d2, order=0,\noomkilladj=0\n\n\n5. open Konqueror on the client and try to copy dav folder to the web server\n_without_ ssl:\n\nwebdav://davusr@www.mydomain.it/dav\n\nThe copy go well. No error found.", "attachment_id": null, "id": 108016, "creator": "alberto.avi@gmail.com", "time": "2007-09-11T05:14:02Z", "bug_id": 43352, "creation_time": "2007-09-11T05:14:02Z", "is_private": false}, {"count": 1, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "id": 110235, "creation_time": "2007-11-05T02:15:07Z", "time": "2007-11-05T02:15:07Z", "bug_id": 43352, "text": "Is the client running on a different machine to the server?\n\nPlease follow the instructions below to generate a core dump and backtrace,\nknowing what httpd was doing at the time of the OOM may help:\n\nhttp://httpd.apache.org/dev/debugging.html#crashes", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 43352, "attachment_id": null, "id": 110276, "creation_time": "2007-11-06T11:10:39Z", "time": "2007-11-06T11:10:39Z", "creator": "alberto.avi@gmail.com", "text": "Hi Joe,\n\nI confirm, the client running on a different machine to the http dav server.\nI tryed a lot of webdav client: Konqueror, Windows XP (I defined a network disk\non webdav) and davfs2 (http://dav.sourceforge.net).\nAll of them give me the same result: they working fine with http dav connection.\nAll of them failed after a few minutes (2 or 3) if I try httpS dav connection.\nThe client give me a generic network error.\n\nI followed all the instructions to configure the system and httpd to write the\ncore dump on the file system.\nI generated again the same httpS dav workload I described in the first post but\nno core dump was written on disk. I noticed that during the file copy (about\n230MB total) the resident memory of httpd server grow immoderately (I used htop\nto monitor it). When the RAM (384MB) on the server is full allocated the kernel\nstart using the swap space too (512MB)! When the swap space is full allocated\nthe system became unusable but it don't crash.\n\nI noticed another detail. During http webdav copy, httpd write progressively in\nits access log file:\n\n192.168.1.1 - davusr [05/Nov/2007:19:34:38 +0100] \"HEAD\n/dav/linux-2.6.22.6/sound/oss/emu10k1/ecard.h HTTP/1.1\" 404 -\n192.168.1.1 - davusr [05/Nov/2007:19:34:38 +0100] \"PUT\n/dav/linux-2.6.22.6/sound/oss/emu10k1/ecard.h HTTP/1.1\" 201 287\n192.168.1.1 - davusr [05/Nov/2007:19:34:38 +0100] \"HEAD\n/dav/linux-2.6.22.6/sound/oss/emu10k1/ecard.h HTTP/1.1\" 200 -\n192.168.1.1 - davusr [05/Nov/2007:19:34:38 +0100] \"UNLOCK\n/dav/linux-2.6.22.6/sound/oss/emu10k1/ecard.h HTTP/1.1\" 204 -\n192.168.1.1 - davusr [05/Nov/2007:19:34:38 +0100] \"HEAD\n/dav/linux-2.6.22.6/sound/oss/emu10k1/voicemgr.h HTTP/1.1\" 404 -\n192.168.1.1 - davusr [05/Nov/2007:19:34:38 +0100] \"PUT\n/dav/linux-2.6.22.6/sound/oss/emu10k1/voicemgr.h HTTP/1.1\" 201 290\n192.168.1.1 - davusr [05/Nov/2007:19:34:38 +0100] \"HEAD\n/dav/linux-2.6.22.6/sound/oss/emu10k1/voicemgr.h HTTP/1.1\" 200 -\n192.168.1.1 - davusr [05/Nov/2007:19:34:38 +0100] \"UNLOCK\n/dav/linux-2.6.22.6/sound/oss/emu10k1/voicemgr.h HTTP/1.1\" 204 -\n\n\nDuring httpS webdav copy httpd dont't log neither one line!\nI think that during httpS webdav copy httpd put in memory all the files without\nwrite them on the disk and without update the access log file.\n\nI done another test.\nI tried succesfully to copy just 1MB of data using httpS webdav but no access\nlog were written and the resident httpd memory grow of about 30MB. I retried a\nfew time this test and finally I needed to restart httpd to free memory.\n\nIt's a very strange case.\n\nThanks a lot for your attention,\n\nAlberto.\n\n", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43352, "is_private": false, "text": "I have what appears to be this identical issue running apache 2.2.3-22. I have a subversion repository that is accessed using mod_dav_svn.\n\nHere is the abbreviated config:\n\n<Location /svn>\n    DAV svn\n    SVNPath /stats/svn\n    SSLRequireSSL\n    AuthType Basic\n    AuthName \"***\"\n    AuthBasicProvider external\n    AuthExternal pwauth\n    Require valid-user\n</Location>\n\nWhenever a file is copied to the server (typically via 'svn import' or 'svn commit' with new file additions) it appears memory is not being freed after the transfer completes.\n\nThis has never caused a crash since there is 4GB of ram and an equivalent swap partition so I have no core files. Restarting apache when I notice the low memory condition does free the memory.\n\nIf necessary I can force a core of the httpd pid while in the low memory condition but I would like to avoid if possible since this is a production machine and the issue is easily reproducible.\n\nB.T.W. I see nothing strange in the logs.", "id": 131424, "time": "2009-10-27T09:14:18Z", "creator": "rmcguire@sonusnet.com", "creation_time": "2009-10-27T09:14:18Z", "attachment_id": null}]
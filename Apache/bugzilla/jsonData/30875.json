[{"count": 0, "tags": [], "creator": "cgay@agilecast.com", "attachment_id": null, "id": 62555, "time": "2004-08-26T19:18:52Z", "bug_id": 30875, "creation_time": "2004-08-26T19:18:52Z", "is_private": false, "text": "According to the documentation, the proper way to create application context is by including a file \nnamed \"context.xml\" in the META-INF directory of a webapp.  \n\nIt appears that Tomcat 5.0.27 only recognizes such a context file when the war is deployed using the \nManager tool's \"DEPLOY\" feature.   When \"DEPLOY\" is used, Catalina properly recognizes the context \nand dynamically creates $CATALINA_HOME/conf/Catalina/localhost/<appname>.xml   If Tomcat is \nstarted with the same war file in the webapps dir, the context file is not found and a _directory_ is \ncreated at $CATALINA_HOME/conf/Catalina/localhost/<appname>.xml.\n\nThis bug is _related_ but not identical to BUG #29688.\n\n\nUse Case to create bug\n--------------------------\n1. Stop Tomcat using  $CATALINA_HOME/bin/shutdown.sh. \n2. Make sure $CATALINA_HOME/conf/Catalina/localhost/<webapp>.xml is deleted.\n3. Clear all references to the webapp  $CATALINA_HOME/webapps by deleting the dir <appname> and \nthe file <appname>.war\n3. Clear all the logs in $CATALINA_HOME/logs\n4. Place the webapp's WAR file in $CATALINA_HOME/webapps.  The webapp war has the following basic \nstructure:\n    <appname>.war\n         index.jsp\n         /META-INF\n              context.xml\n         /WEB-INF\n              web.xml\n              /lib\n              /classes\n5. Start Tomcat by running  $CATALINA_HOME/bin/startup.sh\n6. Navigate to the application's URL\n\n\nExcerpt from /logs/catalina.out\n---------------------------\nAug 26, 2004 1:27:06 PM org.apache.catalina.startup.Catalina start\nINFO: Server startup in 11130 ms\nAug 26, 2004 1:27:15 PM org.apache.catalina.core.StandardHostDeployer remove\nINFO: Removing web application at context path /srp\nAug 26, 2004 1:27:15 PM org.apache.catalina.core.StandardHostDeployer install\nINFO: Processing Context configuration file URL file:/usr/local/jakarta-tomcat-5.0.27/conf/Catalina/\nlocalhost/srp.xml\nAug 26, 2004 1:27:15 PM org.apache.catalina.startup.HostConfig deployDescriptors\nSEVERE: Error deploying configuration descriptor srp.xml\njava.io.IOException: java.io.FileNotFoundException: /usr/local/jakarta-tomcat-5.0.27/conf/Catalina/\nlocalhost/srp.xml (No such file or directory)\n        at org.apache.catalina.core.StandardHostDeployer.install(StandardHostDeployer.java:494)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:863)\n        at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:482)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:427)\n        at org.apache.catalina.startup.HostConfig.check(HostConfig.java:1068)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:327)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)\n        at org.apache.catalina.core.StandardHost.backgroundProcess(StandardHost.java:800)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.\njava:1619)\n        at \norg.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.\njava:1628)\n        at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:\n1608)\n        at java.lang.Thread.run(Thread.java:552)\n\n\ncontext.xml from META-INF\n--------------------------\n<Context path=\"/srp\" docBase=\"srp\"  debug=\"1\" reloadable=\"true\">\n  <Resource name=\"jdbc/srp\" type=\"javax.sql.DataSource\" auth=\"Container\"/>\n    <ResourceParams name=\"jdbc/srp\">\n      <parameter>\n        <name>maxWait</name>\n        <value>5000</value>\n      </parameter>\n      <parameter>\n        <name>maxActive</name>\n        <value>20</value>\n      </parameter>\n      <parameter>\n        <name>username</name>\n        <value>test</value>\n      </parameter>\n      <parameter>\n        <name>password</name>\n        <value>test</value>\n      </parameter>\n      <parameter>\n        <name>url</name>\n        <value>jdbc:microsoft:sqlserver://192.168.1.17:1433;databaseName=srp</value>\n      </parameter>\n      <parameter>\n        <name>driverClassName</name>\n        <value>com.microsoft.jdbc.sqlserver.SQLServerDriver</value>\n      </parameter>\n      <parameter>\n        <name>maxIdle</name>\n        <value>2</value>\n      </parameter>\n    </ResourceParams>\n</Context>\n\n\n\n\nDisclaimer:\n---------------------------\nI and my coworker spent 2 days debugging this.   We read all of the Tomcat 5 documentation, the \nnewsgroup bug reports, and reviewed all the outstanding Tomcat 5 bugs in bugzilla.  We tried all \nmanner of context configurations and locations."}, {"count": 1, "tags": [], "text": "It works perfectly out of the box for me on Tomcat 5.0.28 (JDK 1.4.2, Solaris \n8) with server-minimal.xml as server.xml.  I'm attaching a trivial WAR you can \nuse to see for yourself.  It defines the path as \"\" for test.war, which would \nby default be \"/test\".  If you take context.xml out of the WAR, clean the \nwebapps directory, and restart Tomcat it deploys to the /test context path \nautomatically.  Either way I'm not touching server.xml and/or the \nconf/Catalina/localhost directory.", "attachment_id": null, "id": 62812, "creation_time": "2004-08-30T20:49:47Z", "time": "2004-08-30T20:49:47Z", "creator": "yoavs@computer.org", "bug_id": 30875, "is_private": false}, {"count": 2, "tags": [], "bug_id": 30875, "attachment_id": 12571, "text": "Created attachment 12571\nTest WAR", "id": 62813, "time": "2004-08-30T20:50:16Z", "creator": "yoavs@computer.org", "creation_time": "2004-08-30T20:50:16Z", "is_private": false}]
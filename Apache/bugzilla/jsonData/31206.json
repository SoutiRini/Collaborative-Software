[{"count": 0, "tags": [], "bug_id": 31206, "is_private": false, "text": "Some improvements over the new line breaking algorithm (see also Simon's last \ncomment to bug 29124):\n\n- a new interface InlineLayoutManager, implemented by LeafNodeLM, \nInlineStackingLM and ContentLM\n\n- leaders with pattern \"use-content\" and \"dots\" now works\n\n- better handling of preserved linefeeds\n\nI'm going to attach the proposed patch and a few test fo files.\nRegards\n    Luca", "id": 63494, "time": "2004-09-13T20:27:14Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2004-09-13T20:27:14Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "lfurini@cs.unibo.it", "attachment_id": 12716, "text": "Created attachment 12716\npatch file", "id": 63495, "time": "2004-09-13T20:28:12Z", "bug_id": 31206, "creation_time": "2004-09-13T20:28:12Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 31206, "text": "Created attachment 12717\nFo file: leaders with use-content and dots", "id": 63496, "time": "2004-09-13T20:29:28Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2004-09-13T20:29:28Z", "is_private": false, "attachment_id": 12717}, {"count": 3, "tags": [], "creator": "lfurini@cs.unibo.it", "attachment_id": 12718, "text": "Created attachment 12718\nFo file: centered text with larger or smaller inlines", "id": 63497, "time": "2004-09-13T20:30:29Z", "bug_id": 31206, "creation_time": "2004-09-13T20:30:29Z", "is_private": false}, {"count": 4, "tags": [], "creator": "lfurini@cs.unibo.it", "attachment_id": null, "text": "I forgot to say that I fix a bug in the TextLM: KnuthBoxes generated by the \nTLM had height = 0, so the line height was not always correct.", "id": 63498, "time": "2004-09-13T20:33:05Z", "bug_id": 31206, "creation_time": "2004-09-13T20:33:05Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 31206, "is_private": false, "text": "Luca,\n\nI have a few remarks:\n\n1. InlineStackingLM implements InlineLM.  LineLM extends\nInlineStackingLM and thus implements InlineLM. IMHO it should\nnot. Implementing InlineLM should be equivalent to\ngeneratesInlineAreas returning true.\n\n2. TextLM now extends LeafNodeLM instead of AbstractLM. What is the\ngain?  I see no related changes in TextLM.\n\n3. In LineLM:\n    // this constant is used to create elements when text-align is center:\n    // every TextLM descendant of LineLM must use the same value, \n    // otherwise the line breaking algorithm does not find the right\n    // break point\n    public static final int DEFAULT_SPACE_WIDTH = 3336;\n    private static final int INFINITE_RATIO = 1000;\n\nIf these are static final, they might be better placed in\nInlineLM. Alternatively, they might be attributes of the LineLM\nobject, which allows changing them per paragraph, e.g. depending on\nthe font. But then the problem arises how to propagate them to the\ndescendant LMs.\n\n4. The textheight of the large font is rather large. The property\nlineheight is not followed (reproduce existing behaviour).\n\n5. LineLayoutManager:675: line is always 3, so that firstElementIndex\n= 1 for the first line, and the first box is skipped in the line\nheight calculation.\n\nI attach a test fo that illustrates the text and line height issues.\n\nRegards, Simon\n", "id": 63819, "time": "2004-09-19T18:34:15Z", "creator": "spepping@apache.org", "creation_time": "2004-09-19T18:34:15Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "spepping@apache.org", "attachment_id": 12784, "text": "Created attachment 12784\ntest fo that illustrates the text and line height issues", "id": 63820, "time": "2004-09-19T18:36:17Z", "bug_id": 31206, "creation_time": "2004-09-19T18:36:17Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 31206, "text": "I'm going to attach a revised version of the improvement patch:\n\n- it fixes the line-height calculation errors\n- better handling of preserved linefeed\n\nI'm going to attach some test files too.\n\nRegards\n    Luca\n", "id": 65192, "time": "2004-10-15T16:22:01Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2004-10-15T16:22:01Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 31206, "is_private": false, "text": "Created attachment 13099\nrevised patch", "id": 65193, "time": "2004-10-15T16:22:55Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2004-10-15T16:22:55Z", "attachment_id": 13099}, {"count": 9, "tags": [], "creator": "lfurini@cs.unibo.it", "attachment_id": 13100, "text": "Created attachment 13100\nleaders with pattern = rule, dots and use-content with svg graphics", "id": 65194, "time": "2004-10-15T16:24:10Z", "bug_id": 31206, "creation_time": "2004-10-15T16:24:10Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 31206, "text": "Created attachment 13101\nvertical alignment (top, bottom, middle, baseline) of inlines", "id": 65195, "time": "2004-10-15T16:24:45Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2004-10-15T16:24:45Z", "is_private": false, "attachment_id": 13101}, {"count": 11, "tags": [], "creator": "lfurini@cs.unibo.it", "attachment_id": 13102, "text": "Created attachment 13102\nvertical alignment of images", "id": 65196, "time": "2004-10-15T16:25:36Z", "bug_id": 31206, "creation_time": "2004-10-15T16:25:36Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 31206, "attachment_id": 13103, "text": "Created attachment 13103\nfile 15px.gif used in the test fo file", "id": 65197, "time": "2004-10-15T16:26:11Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2004-10-15T16:26:11Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 31206, "text": "Created attachment 13104\nfile 20px.gif used in the test fo file", "id": 65198, "time": "2004-10-15T16:26:32Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2004-10-15T16:26:32Z", "is_private": false, "attachment_id": 13104}, {"count": 14, "tags": [], "creator": "lfurini@cs.unibo.it", "attachment_id": 13105, "is_private": false, "id": 65199, "time": "2004-10-15T16:26:49Z", "bug_id": 31206, "creation_time": "2004-10-15T16:26:49Z", "text": "Created attachment 13105\nfile 30px.gif used in the test fo file"}, {"count": 15, "tags": [], "creator": "spepping@apache.org", "attachment_id": null, "is_private": false, "id": 66563, "time": "2004-11-06T14:24:42Z", "bug_id": 31206, "creation_time": "2004-11-06T14:24:42Z", "text": "Luca,\n\nLeaders with content: in the test file leaders.fo I get PDF errors in\nthe SVG parts.\n\nI have not checked the calculations of the vertical alignment. The\nprovided test fo files, and some test files I created myself, behave\nwell under the new code. I trust the code is OK.\n\nAs Finn pointed out, vertical-align is a shorthand property in\nXSL. The values top, bottom, middle and baseline map to the values\nbefore-edge, after-edge, middle and baseline of the property\nalignment-baseline, with the properties alignment-adjust,\nbaseline-shift and dominant-baseline being at their default\nvalues. Therefore I think if the current property vertical-align is\nrenamed to alignment-baseline, the code will keep working fine, and\nthe way is free to implement vertical-align as a shorthand property.\n\nInlineLM is now a class (created by Finn on Oct. 19). The hierarchy\nis:\n\nInlineStackingLM\n- InlineLM\n- LineLM\n\nThe class InlineLM is at the position in the hierarchy where I think\nInlineLM interface should be. Therefore I think InlineLM class can\nwell be merged with the proposed InlineLM interface.\n\nI think the code in this patch is OK for committing to CVS. The items\nnoted above can be addressed over time.  However, the patch as it is\ncannot be applied to the current version of CVS HEAD, due to the newly\ncreated InlineLM class and extensive changes in property retrieval. If\nyou submit a patch of the same code against the current CVS HEAD, I\nwill commit it. Or you can keep it until you have write access to CVS\nyourself.\n\nRegards, Simon\n"}, {"count": 16, "tags": [], "bug_id": 31206, "text": "I have created a new patch against HEAD.\nI have tested it and it seems to work, but at the moment I'm not yet ready to \ncommit it, sorry; maybe someone could do this in my place?\n\nA few points which may need further work:\n\n- I renamed the new interface from InlineLM to InlineLevelLM. Merging it with \nthe new InlineLM class would involve having TextLM and LeafNodeLM extend \nInlineLM instead of AbstractLM, and this seems a bit strange to me\n\n- the offset of the areas is set according to the value of the vertical-align \nproperty instead of alignment-baseline\n\n- the offset of the viewport area generated by svg graphics is not set, \nbecause I couldn't find its height\n\n- the offset of textAreas is set by the TextLM, which creates them; but \nvertical-align is a property of inline level formatting objects only, so the \nTextLM checks if the parent node is an Inline\n\n- the main problem in applying the changes to the new code involved leaders \nwith use-content; in the old code, the method LeaderLM.getLeaderInlineArea() \ncreated a ContentLM and an InlineStackingLM:\n            LeaderLM\n                |\n                |\n            ContentLM\n                |\n                |\n         InlineStackingLM\n            ____|____\n            |   |   |\n     (LMs handling the use-content)\nbut now InlineStackingLM does no more implement getNextKnuthElements(), and \nthe InlineLM constructor requires an Inline node; I temporarily fixed this by \nadding a constructor for InlineLM with a Leader parameter, but I don't like \nthis very much.\n\nRegards,\n    Luca", "id": 66798, "time": "2004-11-12T15:35:26Z", "creator": "lfurini@cs.unibo.it", "creation_time": "2004-11-12T15:35:26Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "creator": "lfurini@cs.unibo.it", "attachment_id": 13414, "text": "Created attachment 13414\nnew interface InlineLevelLayoutManager.java", "id": 66799, "time": "2004-11-12T15:36:20Z", "bug_id": 31206, "creation_time": "2004-11-12T15:36:20Z", "is_private": false}, {"count": 18, "tags": [], "creator": "lfurini@cs.unibo.it", "attachment_id": 13415, "text": "Created attachment 13415\nupdated patch to existing files", "id": 66800, "time": "2004-11-12T15:37:04Z", "bug_id": 31206, "creation_time": "2004-11-12T15:37:04Z", "is_private": false}, {"count": 19, "tags": [], "bug_id": 31206, "is_private": false, "text": "Applied. \n\nI made BasicLinkLM also extend InlineLM.\n\nThanks. Simon Pepping\n", "id": 66858, "time": "2004-11-13T20:39:29Z", "creator": "spepping@apache.org", "creation_time": "2004-11-13T20:39:29Z", "attachment_id": null}, {"count": 20, "tags": [], "bug_id": 31206, "attachment_id": null, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed", "id": 155947, "time": "2012-04-01T06:50:01Z", "creator": "gadams@apache.org", "creation_time": "2012-04-01T06:50:01Z", "is_private": false}]
[{"count": 0, "attachment_id": null, "bug_id": 31772, "is_private": false, "id": 65305, "time": "2004-10-19T11:46:19Z", "creator": "bruno.antunes@pararede.com", "creation_time": "2004-10-19T11:46:19Z", "tags": [], "text": "If we use in the same JSP the same name with a struts (1.1 or 1.0.2) bean:define\nid=\"name\" tag, that will put in page scop the variable with the same name in the\nid, we will get a JSP compile error if this bean tag are inside if clauses.\n\nThe JSP Error: \"cannot resolve symbol...\"\n\nThis same JSP compiles fine under Tomcat 4.0.6, and not on Tomcat >= 4.1.31\n\n=======================\nSTEPS TO FOLLOW TO REPRODUCE THE PROBLEM :\n=======================\nSample JSP:\n=== START HERE ===\n<%@ page import=\"java.util.*\"%>\n<%@ page import=\"com.whateversoft.sun.bean.*\"%>\n<br><br>\n<%\n  List lst = new ArrayList(); lst.add(new MyForm(\"one\")); lst.add(new\nMyForm(\"two\"));\n  request.setAttribute(\"myList\", lst);\n%>\n\n<%@ taglib uri=\"/WEB-INF/struts-logic.tld\" prefix=\"logic\" %>\n<%@ taglib uri=\"/WEB-INF/struts-bean.tld\" prefix=\"bean\" %>\n\n<logic:present name=\"myList\">\n  <% int index = 0; %>\n  <logic:iterate id=\"myForm\" collection=\"<%= lst %>\">\n   <% index++; %>\n   <% if(index % 2 == 0) { %>\n    <bean:define id=\"myName\" name=\"myForm\" property=\"name\" type=\"java.lang.String\"/>\n    SomeName: <%= myName %><br/>\n   <% } else { %>\n    <bean:define id=\"myName\" name=\"myForm\" property=\"name\" type=\"java.lang.String\"/>\n    SomeNameOdd: <%= myName %><br/>\n   <% } %>\n  </logic:iterate>\n</logic:present>\n=== END HERE ===\n\n=== START SOURCE CODE FOR SIMPLE FORM BEAN ==\npackage com.whateversoft.sun.bean;\n\nimport org.apache.struts.action.*;\n\n\npublic class MyForm extends ActionForm {\n  private String name = \"name\";\n\n  public MyForm() {\n  }\n\n  public MyForm(String aName) {\n    setName(aName);\n  }\n\n\n  public String getName() {\n    return name;\n  }\n\n  public void setName(String name) {\n    this.name = name;\n  }\n\n  public String toString() {\n    return name;\n  }\n\n}\n=== END SOURCE CODE FOR SIMPLE FORM BEAN ==\n\n\nError from JSP:\ntype Exception report\n\nmessage\n\ndescription The server encountered an internal error () that prevented it from\nfulfilling this request.\n\nexception\n\norg.apache.jasper.JasperException: Unable to compile class for JSP\n\nAn error occurred at line: 20 in the jsp file: /index.jsp\nGenerated servlet error:\n/local/java/jakarta-tomcat-5.0.28/work/Catalina/localhost/SampleWebModule1/org/apache/jsp/index_jsp.java:149:\ncannot find symbol\nsymbol  : variable myName\nlocation: class org.apache.jsp.index_jsp\n              myName = (java.lang.String)\n_jspx_page_context.findAttribute(\"myName\");\n              ^\n\n\nGenerated servlet error:\n/local/java/jakarta-tomcat-5.0.28/work/Catalina/localhost/SampleWebModule1/org/apache/jsp/index_jsp.java:152:\ncannot find symbol\nsymbol  : variable myName\nlocation: class org.apache.jsp.index_jsp\n              myName = (java.lang.String)\n_jspx_page_context.findAttribute(\"myName\");\n              ^\n\n\nAn error occurred at line: 21 in the jsp file: /index.jsp\nGenerated servlet error:\n/local/java/jakarta-tomcat-5.0.28/work/Catalina/localhost/SampleWebModule1/org/apache/jsp/index_jsp.java:156:\ncannot find symbol\nsymbol  : variable myName\nlocation: class org.apache.jsp.index_jsp\n              out.print( myName );\n                         ^\nNote:\n/local/java/jakarta-tomcat-5.0.28/work/Catalina/localhost/SampleWebModule1/org/apache/jsp/index_jsp.java\nuses unchecked or unsafe operations.\n\n\nAn error occurred at line: 21 in the jsp file: /index.jsp\nGenerated servlet error:\nNote: Recompile with -Xlint:unchecked for details.\n3 errors\n\n\n\n\torg.apache.jasper.compiler.DefaultErrorHandler.javacError(DefaultErrorHandler.java:84)\n\torg.apache.jasper.compiler.ErrorDispatcher.javacError(ErrorDispatcher.java:332)\n\torg.apache.jasper.compiler.Compiler.generateClass(Compiler.java:412)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:472)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:451)\n\torg.apache.jasper.compiler.Compiler.compile(Compiler.java:439)\n\torg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:511)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:295)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:292)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:236)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\nComplete Stack Trace\n=====================\n2004-10-19 12:29:15 StandardWrapperValve[jsp]: Servlet.service() for servlet jsp\nthrew exception\norg.apache.jasper.JasperException: Unable to compile class for JSP\n\nAn error occurred at line: 20 in the jsp file: /index.jsp\nGenerated servlet error:\n/local/java/jakarta-tomcat-5.0.28/work/Catalina/localhost/SampleWebModule1/org/apache/jsp/index_jsp.java:149:\ncannot find symbol\nsymbol  : variable myName\nlocation: class org.apache.jsp.index_jsp\n              myName = (java.lang.String)\n_jspx_page_context.findAttribute(\"myName\");\n              ^\n\n\nGenerated servlet error:\n/local/java/jakarta-tomcat-5.0.28/work/Catalina/localhost/SampleWebModule1/org/apache/jsp/index_jsp.java:152:\ncannot find symbol\nsymbol  : variable myName\nlocation: class org.apache.jsp.index_jsp\n              myName = (java.lang.String)\n_jspx_page_context.findAttribute(\"myName\");\n              ^\n\n\nAn error occurred at line: 21 in the jsp file: /index.jsp\nGenerated servlet error:\n/local/java/jakarta-tomcat-5.0.28/work/Catalina/localhost/SampleWebModule1/org/apache/jsp/index_jsp.java:156:\ncannot find symbol\nsymbol  : variable myName\nlocation: class org.apache.jsp.index_jsp\n              out.print( myName );\n                         ^\nNote:\n/local/java/jakarta-tomcat-5.0.28/work/Catalina/localhost/SampleWebModule1/org/apache/jsp/index_jsp.java\nuses unchecked or unsafe operations.\n\n\nAn error occurred at line: 21 in the jsp file: /index.jsp\nGenerated servlet error:\nNote: Recompile with -Xlint:unchecked for details.\n3 errors\n\n\n\n\tat\norg.apache.jasper.compiler.DefaultErrorHandler.javacError(DefaultErrorHandler.java:84)\n\tat org.apache.jasper.compiler.ErrorDispatcher.javacError(ErrorDispatcher.java:332)\n\tat org.apache.jasper.compiler.Compiler.generateClass(Compiler.java:412)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:472)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:451)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:439)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:511)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:295)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:292)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:236)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:237)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:157)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:214)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)\n\tat\norg.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:198)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:152)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:137)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:118)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:102)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n\tat\norg.apache.catalina.core.StandardValveContext.invokeNext(StandardValveContext.java:104)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:520)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:929)\n\tat org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:160)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:799)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:705)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:577)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:683)\n\tat java.lang.Thread.run(Thread.java:595)"}, {"count": 1, "tags": [], "creator": "yoavs@computer.org", "attachment_id": null, "id": 66072, "time": "2004-10-29T13:34:15Z", "bug_id": 31772, "creation_time": "2004-10-29T13:34:15Z", "is_private": false, "text": "Does it happen with Struts 1.2?"}, {"count": 2, "tags": [], "text": "Also try it on JDK 1.4 instead of J2SE 5.0.  I'm closing this issue now as not \nreproducible.  If you can confirm that this also happens on JDK 1.4.2 with \nStruts 1.2, AND attach a WAR we can use to reproduce your test to this issue, \nthen you can reopen this issue.  Thanks.", "attachment_id": null, "bug_id": 31772, "id": 67017, "time": "2004-11-17T14:57:04Z", "creator": "yoavs@computer.org", "creation_time": "2004-11-17T14:57:04Z", "is_private": false}, {"count": 3, "text": "This happens also with Struts 1.2.4 and Sun JDK 5.0\n\nError\n\nNov 18, 2004 2:33:06 PM org.apache.catalina.core.StandardWrapperValve invoke\nSEVERE: Servlet.service() for servlet jsp threw exception\norg.apache.jasper.JasperException: Unable to compile class for JSP\n \nGenerated servlet error:\nmyName cannot be resolved\n \nAn error occurred at line: 21 in the jsp file: /index.jsp\nGenerated servlet error:\nmyName cannot be resolved\n \n \n        at\norg.apache.jasper.compiler.DefaultErrorHandler.javacError(DefaultErrorHandler.java:84)\n        at\norg.apache.jasper.compiler.ErrorDispatcher.javacError(ErrorDispatcher.java:328)\n        at\norg.apache.jasper.compiler.JDTCompiler.generateClass(JDTCompiler.java:389)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:288)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:267)\n        at org.apache.jasper.compiler.Compiler.compile(Compiler.java:255)\n        at\norg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:556)\n        at\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:296)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:245)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:802)\n        at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:237)\n        at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:157)\n        at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:214)\n        at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)\n        at\norg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)\n        at\norg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\n        at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)\n        at\norg.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)\n        at\norg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:825)\n        at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:731)\n        at\norg.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:526)\n        at\norg.apache.tomcat.util.net.LeaderFollowerWorkerThread.runIt(LeaderFollowerWorkerThread.java:80)\n        at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:684)\n        at java.lang.Thread.run(Thread.java:595)\n...", "bug_id": 31772, "is_private": false, "id": 67027, "time": "2004-11-17T15:43:56Z", "creator": "bruno.antunes@pararede.com", "creation_time": "2004-11-17T15:43:56Z", "tags": [], "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 31772, "text": "I have posted this same issue to Sun over SSJAS8 (Sun Java System Application\nServer 8, that also uses Tomcat), and to Bea in WebLogic Server 6.1 and WebLogic 8.1\n\nThe SJSAS8 as the same issue found in Tomcat. The sample jsp does not compile\nwith a similiar error.\nUnder WebLogic Server 6.1 and WebLogic 8.1, the sample jsp compiles with not\nproblems.\n\nI have got some feedback from Sun.\n\n<quoting>\nThere are occasions when the various J2EE Specifications allow for ambiguity,\nwhen this happens, different server vendors do things differently, this issue is\nstems from an ambiguity of this type.\n\nIn the JSP Specification, a custom tag is allowed to create a Java variable\ndeclaration, using the `<variable>' element in the tag library descriptor (TLD).\nThe specification is completely silent on how the scripting variable is\ngenerated into the Java code. This means that there will be problems in these\ntwo circumstances:\n\n1. The TLD does not have a <variable> element at all\n2. The custom tag appears more than once in the same JSP page, in circumstances\nwhere Java scoping rules would prevent a conflict in the variable names.\n\nBecause the specification doesn't say what to do, it's up to the server vendors\nto implement a response to these awkward situations as best they can. It is not\npossible to say which vendor is `right' and which is `wrong'.\n</quoting>\n\nThe sample JSP I send here, explorer. The Struts bean TLD does not have a\nvariable element.\n\nThe documentation of Struts said that we can not use the same id by limitation\nof JSP 1.1 (http://struts.apache.org/userGuide/struts-bean.html#define) whitch\nis incorrect, as this is not a limitation from the JSP 1.1 specification.\n", "id": 67029, "time": "2004-11-17T16:00:17Z", "creator": "bruno.antunes@pararede.com", "creation_time": "2004-11-17T16:00:17Z", "tags": [], "is_private": false}, {"count": 5, "text": "As far as I can remember, this is invalid and you cannot use scriplets to do\nthis. I think Kinman closed similar things with TC 4.1. As for your feedback, I\nwill be interested when you can produce something coming from the JSP expert group.", "bug_id": 31772, "is_private": false, "id": 67033, "time": "2004-11-17T16:08:53Z", "creator": "remm@apache.org", "creation_time": "2004-11-17T16:08:53Z", "tags": [], "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 31772, "text": "One thing that I would like to consider.\n\nHaving the scriplet:\n<bean:define id=\"myName\"..../>\n<%= myName %>\n\nAnd assuming that I do not have the variable myName and that I am using the\nstruts the bean tag (with the missing <variable> element in the TLD), should not\ncompile under Tomcat, SJAS8, Weblogic, etc.\n\nI would like to raise a defect report against Tomcat to the effect that it\nshould not define a Java-langauge variable corresponding to JSP tag attribute,\nunless the TLD has a <variable> element.", "id": 67036, "time": "2004-11-17T16:15:23Z", "creator": "bruno.antunes@pararede.com", "creation_time": "2004-11-17T16:15:23Z", "tags": [], "is_private": false}]
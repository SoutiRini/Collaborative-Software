[{"count": 0, "tags": [], "creator": "gespinoza75@gmail.com", "is_private": false, "text": "Hi, I tried posting in the mail list, but the suggested solutions did not work\nso I was asked to open a bug report.\n\nI am running Geronimo+Tomcat v. 1.1.1 and I run apache v. 2.0.53. I use the\nJkMountFile directive to point to a file where I instruct the server how to map\nthe webapps into the httpd server space.  I modify the file as I add webapps,\nbut the uri's are not updated.  In order to have the uri's updated I have to\nrestart apache httpd and then it works.\n\nBelow are the conf files I use and the log output for mod_jk.\n(also available at http://www.espinozas.org/bug/JkMountFile.tar.gz)\n\n### apache_connector.conf ###\n# Load mod_jk module\n# Update this path to match your modules location\n<IfModule !mod_jk.c>\nLoadModule    jk_module  /usr/lib/apache2/mod_jk.so\n</IfModule>\n\n# Declare the module for <IfModule directive> (remove this line on Apache 2.x)\n# AddModule     mod_jk.c\n\n# Where to put jk logs\n# Update this path to match your logs directory location (put mod_jk.log next to\naccess_log)\nJkLogFile     /var/log/apache2/mod_jk.log\n\n# Where to find workers.properties\n# Update this path to match your conf directory location (put workers.properties\nnext to httpd.conf)\nJkWorkersFile /etc/geronimo/workers.properties\n\n# Set the jk log level [debug/error/info]\n#JkLogLevel    debug\nJkLogLevel    trace\n\n# Select the log format\nJkLogStampFormat \"[%a %b %d %H:%M:%S %Y] \"\n\n# JkOptions indicate to send SSL KEY SIZE, \nJkOptions     +ForwardKeySize +ForwardURICompat -ForwardDirectories\n\n# JkRequestLogFormat set the request format \nJkRequestLogFormat     \"%w %V %T\"\n\n# To automatically load the webapps\nJkAutoAlias /srv/www/geronimo/webapps\nJkMountFile /etc/geronimo/uriworkermap.properties\n\n# For Tomcat within Geronimo\nJkAutoAlias /usr/share/geronimo-1.1.1/var/catalina/work/\nJkAutoAlias /usr/share/geronimo-1.1.1/config-store/\n\n# Uncomment below if JkMountFile fails\n# Send everything for context /examples to worker named ajp13 (ajp13)\n# URI Mappings\n#JkMount /servlets-examples/  ajp13\n#JkMount /jsp-examples/  ajp13\n\n#JkMount /servlets-examples/servlet/*  ajp13\n#JkMount /servlets-examples/*.jsp  ajp13\n#JkMount /jsp-examples/*.jsp  ajp13\n#JkMount /jsp-examples/*.jspx  ajp13\n#JkMount /jsp-examples/servlet/*  ajp13\n\n#JkUnMount /jsp-examples/*.html  ajp13\n#JkUnMount /jsp-examples/*.htm  ajp13\n#JkUnMount /jsp-examples/*.png  ajp13\n#JkUnMount /jsp-examples/*.jpg  ajp13\n#JkUnMount /jsp-examples/*.jpeg  ajp13\n#JkUnMount /jsp-examples/*.gif  ajp13\n#JkUnMount /jsp-examples/*.ico  ajp13\n\n#JkUnMount /servlets-examples/*.html  ajp13\n#JkUnMount /servlets-examples/*.htm  ajp13\n#JkUnMount /servlets-examples/*.png  ajp13\n#JkUnMount /servlets-examples/*.jpg  ajp13\n#JkUnMount /servlets-examples/*.jpeg  ajp13\n#JkUnMount /servlets-examples/*.gif  ajp13\n#JkUnMount /servlets-examples/*.ico  ajp13\n\n<Location \"/servlets-examples/WEB-INF/\">\n    AllowOverride None\n    deny from all\n</Location>\n\n<Location \"/jsp-examples/WEB-INF/\">\n    AllowOverride None\n    deny from all\n</Location>\n\n<Location \"/tomcat-docs/WEB-INF/\">\n    AllowOverride None\n    deny from all\n</Location>\n\n### uriworkermap.properties ###\n# URI Mappings\n\n#this is how I test the auto reload\n#I have a .jsp served by Geronimo/Tomcat and .html by apache httpd\n#I remove the ! to serve thru geronimo/tomcat uri map\n!/=ajp13\n!/*=ajp13\n!/*.jsp=ajp13\n\n/servlets-examples/=ajp13\n/jsp-examples/=ajp13\n\n/servlets-examples/servlet/*=ajp13\n/servlets-examples/*.jsp=ajp13\n/jsp-examples/*.jsp=ajp13\n/jsp-examples/*.jspx=ajp13\n/jsp-examples/servlet/*=ajp13\n\n/jsp-examples/*.html=ajp13\n/jsp-examples/*.htm=ajp13\n/jsp-examples/*.png=ajp13\n/jsp-examples/*.jpg=ajp13\n/jsp-examples/*.jpeg=ajp13\n/jsp-examples/*.gif=ajp13\n\n!/servlets-examples/*.html=ajp13\n!/servlets-examples/*.htm=ajp13\n!/servlets-examples/*.png=ajp13\n!/servlets-examples/*.jpg=ajp13\n!/servlets-examples/*.jpeg=ajp13\n!/servlets-examples/*.gif=ajp13\n\n/tomcat-docs/=ajp13\n/tomcat-docs/*=ajp13\n!/tomcat-docs/*.html=ajp13\n!/tomcat-docs/*.htm=ajp13\n!/tomcat-docs/*.png=ajp13\n!/tomcat-docs/*.jpg=ajp13\n!/tomcat-docs/*.jpeg=ajp13\n!/tomcat-docs/*.gif=ajp13\n\n/wiki/=ajp13\n/wiki/*=ajp13\n\n### mod_jk.log (trace level) ###\nvisit http://www.espinozas.org/bug/mod_jk.txt\n\n### workers.properties ###\n# running tomcat within geronimo\n#workers.tomcat_home=/srv/www/geronimo-1.1.1/home\n\n# Define 1 real worker using ajp13\nworker.list=ajp13\n\n# Set properties for ajp13 (ajp13)\nworker.ajp13.type=ajp13\n#worker.ajp13.host=localhost\nworker.ajp13.host=frodo\nworker.ajp13.port=8009\nworker.ajp13.lbfactor=50\nworker.ajp13.cachesize=1\nworker.ajp13.cache_timeout=600\nworker.ajp13.socket_keepalive=1\nworker.ajp13.reclycle_timeout=300", "id": 95959, "time": "2006-11-18T14:43:26Z", "bug_id": 40997, "creation_time": "2006-11-18T14:43:26Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "gespinoza75@gmail.com", "attachment_id": 19140, "is_private": false, "id": 95960, "time": "2006-11-18T14:45:07Z", "bug_id": 40997, "creation_time": "2006-11-18T14:45:07Z", "text": "Created attachment 19140\nconfiguration files and mod_jk log"}, {"count": 2, "tags": [], "text": "A couple of comments:\n\n1) Your shared memory file is /srv/www/logs/jk-runtime-status. It looks like the\napache processes don't have write permissions to the file or to the directory.\nIf you don't like the automaticly chosen file, you can choose another one with\nJkShmFile. This file is necessary.\n\n2) Don't use worker.ajp13.cachesize=1. The directive cachesize is deprecated. It\nhas beend replaced by connection_pool_size. But also connection_pool_size should\nonly be used in very special cases. The default values are usually better.\n\n3) cache_timeout is also deprecated. Use connection_pool_timeout instead.\n\n4) You don't need lbfactor, since you don't use a mod_jk load balancer worker.\n\n5) There's a typo: instead of reclycle_timeout it should by recycle_timeout, but\nyou shouldn't use that. It has the same meaning as connection_pool_timeout.\n\n6) There is a couple of lines in you log:\n\nReloaded urimaps from /etc/geronimo/uriworkermap.properties\n\nso actually reloading happens. To understand if there is really a problem,\nplease give the contents of the uriworkermap file before and after change, and\nthe request URL which does not work as expected after the change.\n", "is_private": false, "bug_id": 40997, "id": 95964, "time": "2006-11-18T16:00:47Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-11-18T16:00:47Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 40997, "text": "Hi Gilberto,\n\ninspired by your uriworkermap.properties, which contained \"!\" rules, I checked\nthe rule and reloading logic. In fact the behaviour when switching between\nnon-\"!\"-rules and \"!\"-rules was undefined at best. So adding or removing an\nexclamation mark did not work.\n\nI added a fix to svn, but tests need to wait until tomorrow. Feel free to test,\nI'm interested in feedback.\n\nPlease do have a look at my previous comments 1)-6) also.", "id": 95966, "time": "2006-11-18T17:59:20Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2006-11-18T17:59:20Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "gespinoza75@gmail.com", "is_private": false, "text": "(In reply to comment #3)\n> Hi Gilberto,\n> \n> inspired by your uriworkermap.properties, which contained \"!\" rules, I checked\n> the rule and reloading logic. In fact the behaviour when switching between\n> non-\"!\"-rules and \"!\"-rules was undefined at best. So adding or removing an\n> exclamation mark did not work.\n> \n> I added a fix to svn, but tests need to wait until tomorrow. Feel free to test,\n> I'm interested in feedback.\n> \n> Please do have a look at my previous comments 1)-6) also.\n\nHi Rainer-\n\nI made the suggested modifications at 1)-6).  I also build the new module from\nthe svn and ran my one test.  It still does not work.  I will attach the\nmd_jk.log for the time period when I made the change of the module.  Please let\nme know if there is more info I can provide to help you out.  I will to run more\ntests to see if there is something goofy in my config.\n\nThanks for your help.\n", "id": 95994, "time": "2006-11-19T20:26:18Z", "bug_id": 40997, "creation_time": "2006-11-19T20:26:18Z", "attachment_id": null}, {"count": 5, "attachment_id": 19146, "bug_id": 40997, "text": "Created attachment 19146\nsection of mod_jk.log of the section after loading module built from svn on nov 19", "id": 95995, "time": "2006-11-19T20:29:49Z", "creator": "gespinoza75@gmail.com", "creation_time": "2006-11-19T20:29:49Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "creator": "rainer.jung@kippdata.de", "is_private": false, "text": "Hi Gilberto,\n\nyou need to give a little info to make your tes understandable for me:\n\n- the uriworkermap.properties before the chagne\n- the same after the change\n- the URL(s) with which you are testing before and after and the results of the\nrequests (expected/actual)\n- the timestamp of the change and of the test requests\n\nSome of that I can guess from the log, but unfortunately not all :(\n", "id": 96010, "time": "2006-11-20T12:20:55Z", "bug_id": 40997, "creation_time": "2006-11-20T12:20:55Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "gespinoza75@gmail.com", "attachment_id": null, "is_private": false, "id": 96022, "time": "2006-11-20T19:03:51Z", "bug_id": 40997, "creation_time": "2006-11-20T19:03:51Z", "text": "Hi Rainer-\n\nHere is the info you requested.  Please let me know if you need more info.  I\nbasically just want to be able to use the \"not\" (!) as quick way to turn on and\noff a webapp.\n\n - the uriworkermap.properties before the chagne:\n# URI Mappings\n\n#this is how I test the auto reload\n#I have a .jsp served by Geronimo/Tomcat and .html by apache httpd\n#I remove the ! to serve thru geronimo/tomcat uri map\n!/bug/=ajp13\n!/bug/*=ajp13\n!/bug/*.txt=ajp13\n!/bug/*.gz=ajp13\n\n/*=ajp13\n/*.jsp=ajp13\n\n/servlets-examples/=ajp13\n/jsp-examples/=ajp13\n\n/servlets-examples/servlet/*=ajp13\n/servlets-examples/*.jsp=ajp13\n/jsp-examples/*.jsp=ajp13\n/jsp-examples/*.jspx=ajp13\n/jsp-examples/servlet/*=ajp13\n\n/jsp-examples/*.html=ajp13\n/jsp-examples/*.htm=ajp13\n/jsp-examples/*.png=ajp13\n/jsp-examples/*.jpg=ajp13\n/jsp-examples/*.jpeg=ajp13\n/jsp-examples/*.gif=ajp13\n\n!/servlets-examples/*.html=ajp13\n!/servlets-examples/*.htm=ajp13\n!/servlets-examples/*.png=ajp13\n!/servlets-examples/*.jpg=ajp13\n!/servlets-examples/*.jpeg=ajp13\n!/servlets-examples/*.gif=ajp13\n\n/tomcat-docs/=ajp13\n/tomcat-docs/*=ajp13\n!/tomcat-docs/*.html=ajp13\n!/tomcat-docs/*.htm=ajp13\n!/tomcat-docs/*.png=ajp13\n!/tomcat-docs/*.jpg=ajp13\n!/tomcat-docs/*.jpeg=ajp13\n!/tomcat-docs/*.gif=ajp13\n\n/wiki/=ajp13\n/wiki/*=ajp13\n\n\n - the same after the change\n# URI Mappings\n\n#this is how I test the auto reload\n#I have a .jsp served by Geronimo/Tomcat and .html by apache httpd\n#I remove the ! to serve thru geronimo/tomcat uri map\n/bug/=ajp13\n/bug/*=ajp13\n/bug/*.txt=ajp13\n/bug/*.gz=ajp13\n\n/*=ajp13\n/*.jsp=ajp13\n\n/servlets-examples/=ajp13\n/jsp-examples/=ajp13\n\n/servlets-examples/servlet/*=ajp13\n/servlets-examples/*.jsp=ajp13\n/jsp-examples/*.jsp=ajp13\n/jsp-examples/*.jspx=ajp13\n/jsp-examples/servlet/*=ajp13\n\n/jsp-examples/*.html=ajp13\n/jsp-examples/*.htm=ajp13\n/jsp-examples/*.png=ajp13\n/jsp-examples/*.jpg=ajp13\n/jsp-examples/*.jpeg=ajp13\n/jsp-examples/*.gif=ajp13\n\n!/servlets-examples/*.html=ajp13\n!/servlets-examples/*.htm=ajp13\n!/servlets-examples/*.png=ajp13\n!/servlets-examples/*.jpg=ajp13\n!/servlets-examples/*.jpeg=ajp13\n!/servlets-examples/*.gif=ajp13\n\n/tomcat-docs/=ajp13\n/tomcat-docs/*=ajp13\n!/tomcat-docs/*.html=ajp13\n!/tomcat-docs/*.htm=ajp13\n!/tomcat-docs/*.png=ajp13\n!/tomcat-docs/*.jpg=ajp13\n!/tomcat-docs/*.jpeg=ajp13\n!/tomcat-docs/*.gif=ajp13\n\n/wiki/=ajp13\n/wiki/*=ajp13\n\n - the URL(s) with which you are testing before and after and the results of the\nrequests (expected/actual)\nwww.espinozas.org/\nwith the ! on, I expect to get an index.html page (white bgcolor)\nwith the ! off, i expect to get an index.jsp (gray bgcolor) from the webapp from\nGeronimo+Tomcat\n\n - the timestamp of the change and of the test requests\n-rw-r--r--  1 root root 1038 Nov 19 22:12 uriworkermap.properties\n-rw-r--r--  1 root root 1034 Nov 20 20:23 uriworkermap.properties\n\n### from access_log (apache) ###\n208.178.101.34 - - [20/Nov/2006:08:37:02 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)\"\n212.95.252.16 - - [20/Nov/2006:10:54:37 -0600] \"HEAD /icons/apache_pb.gif\nHTTP/1.0\" 404 - \"-\" \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\"\n217.232.116.36 - - [20/Nov/2006:14:21:28 -0600] \"GET /bug/JkMountFile.tar.gz\nHTTP/1.1\" 403 - \"http://issues.apache.org/bugzilla/show_bug.cgi?id=40997\"\n\"Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n217.232.116.36 - - [20/Nov/2006:14:21:39 -0600] \"GET /bug/ HTTP/1.1\" 403 - \"-\"\n\"Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n217.232.116.36 - - [20/Nov/2006:14:21:42 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.108.223.168 - - [20/Nov/2006:19:27:44 -0600] \"GET / HTTP/1.0\" 200 357 \"-\" \"-\"\n66.92.134.85 - - [20/Nov/2006:20:23:29 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:21 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:23 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:25 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:26 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:29 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:30 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:32 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:33 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:35 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:36 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:38 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:39 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:40 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:24:43 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:27:45 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:27:47 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n66.92.134.85 - - [20/Nov/2006:20:27:49 -0600] \"GET / HTTP/1.1\" 200 357 \"-\"\n\"Mozilla/5.0 (Windows; U; Win98; en-US; rv:1.8.1) Gecko/20061010 Firefox/2.0\"\n\n\n\nthanks"}, {"attachment_id": null, "tags": [], "creator": "rainer.jung@kippdata.de", "is_private": false, "count": 8, "id": 96026, "time": "2006-11-21T02:52:23Z", "bug_id": 40997, "creation_time": "2006-11-21T02:52:23Z", "text": "So I assume you are deleting the \"!\" in freont of the /bug maps to enable or\ndisable access to the /bug context.\n\nThe correct way is to use a minus sign \"-\" instead of an exclamation mark \"!\".\n\n-XXX says: define a rule XXX and disable it (don't use it).\n!XXX says: after you did the matching and you found a worker, go through all the\n\"!\" rules, and if one of those matches for the same target worker, don't use the\noriginal match, don't forward to tomcat\n\nfile change semantics without restart are: entries learnt from earlier versions\ndo not get deleted. The only way of manipulating old entries is adding or\nremoving a minus sign. Then they get disabled, or a previous disabled state is\nturned into enable again.\n\nYou did:\n\n!XXX: never use a mapping XXX. 1 rule loaded.\n\nChange to XXX: use a mapping XXX, a second rule loaded. Now you have a rule XXX\nthat might match a request, but the check for exclusions afterwards still finds\nthe !XXX and negated the forward.\n\nI suggest:\n\n-XXX: Define a map XXX but disable it.\n\nChange to XXX: Remove the disabling of XXX, ie. enable it.\n\nIf you want to be more secure, so that other rules will not be able to\naccidentily map to /bug, you can also do:\n\n!XXX\n-XXX\n\nand enable the context by changing to:\n\n-!XXX\nXXX\n\nI'm closing this now. In case you don't understand, please proceed via the users\nlist. In case you are pretty sure, that there is still a bug, reopen with your\narguments. "}]
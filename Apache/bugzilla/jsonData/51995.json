[{"count": 0, "tags": [], "bug_id": 51995, "text": "Created attachment 27731\npatch\n\nI noticed an error which was caused by apr_proc_create setting up file descriptors for the child process incorrectly. Specifically, the child's stdin may fail to be connected to the pipe if the parent's stdin is closed.\n\nWhat's happening is that apr allocates a pipe in the parent, and it may get assigned fd 0 if stdin is closed. The child doesn't account for this case, so it proceeds to dup2(0, 0) and close(0), leaving it with no stdin. The same could happen for stdout and stderr. The attached patch will fix it.                                                              \n\nThe way this came up for me was using Subversion to commit to a repository over ssh, with the commit message from stdin (i.e. `svn ci -F -`). There, stdin gets closed once the log message is read. Afterwards, it forks a child to run ssh, but fails with a broken pipe error.\n\n[also reported this to the dev mailing list before finding this bug tracker. On that note, it wouldn't hurt if there were a link to the bug tracker on the APR homepage!]", "id": 150326, "time": "2011-10-07T18:23:39Z", "creator": "drkp@csail.mit.edu", "creation_time": "2011-10-07T18:23:39Z", "is_private": false, "attachment_id": 27731}, {"count": 1, "tags": [], "creator": "trawick@apache.org", "text": "in apr 1.4.6 and later\n\ntrunk: r1183685\n1.5.x: r1183706\n1.4.x: r1183708", "id": 172600, "time": "2014-01-21T13:21:28Z", "bug_id": 51995, "creation_time": "2014-01-21T13:21:28Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 30746, "text": "Under some circumstances request.getProtocol() can return null. This breaks\nHttpServlet\n\nhttp://exo.sourceforge.net/forum/viewtopic.php?p=1835#1835 has the complete\nstory of this bug, but briefly:\n\n1) The Portlet Spec requires \"The following methods of the HttpServletRequest\nmust return null: getProtocol, getRemoteAddr, getRemoteHost, getRealPath, and\ngetRequestURL.\" (from PLT.16.3.3 of the portlet spec).\n\n2) When using the EXO portlet container with the spring framework portlet\nsupport Tomcat throws a NPE when including the view servlet in response to a\nPOSTed request.\n\nWhile it is arguable if this is a bug in Tomcat or something else, it would be\nvery helpful if Tomcat included NP checks when checking the protocol.\n\nie:\n\nHttpServlet.doPost(HttpServletRequest req, HttpServletResponse resp)\n\nshould do:\n\nif ((protocol != null) && protocol.endsWith(\"1.1\")) {...\n\nand doGet(HttpServletRequest req, HttpServletResponse resp) should have the same\nthing", "id": 62163, "time": "2004-08-19T05:43:08Z", "creator": "nlothian@apache.org", "creation_time": "2004-08-19T05:43:08Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "jfarcand@apache.org", "text": "I'm not convinced at all this is a Tomcat problem, and I'm -1 starting adding\nnull check because your of app/portlet. If the bug was in Tomcat, parsing the\nrequest would have fail (check that snippet):\n\nWhen the request is parsed:\n\n    515         if ((end - start) > 0) {\n    516             request.protocol().setChars(ascbuf, start, end - start);\n    517         } else {\n    518             request.protocol().setString(\"\");\n    519         }\n\nThen when we decide which protocol to use:\n\n\n   1101         MessageBytes protocolMB = request.protocol();\n   1102         if (protocolMB.equals(Constants.HTTP_11)) {\n   1103             http11 = true;\n   1104             protocolMB.setString(Constants.HTTP_11);\n   1105         } else if (protocolMB.equals(Constants.HTTP_10)) {\n   1106             http11 = false;\n   1107             keepAlive = false;\n   1108             protocolMB.setString(Constants.HTTP_10);\n   1109         } else if (protocolMB.equals(\"\")) {\n   1110             // HTTP/0.9\n   1111             http09 = true;\n   1112             http11 = false;\n   1113             keepAlive = false;\n   1114         } else {\n   1115             // Unsupported protocol\n   1116             http11 = false;\n   1117             error = true;\n   1118             // Send 505; Unsupported HTTP version\n   1119             response.setStatus(505);\n   1120         }\n\nBoth snoppet are *always* executed.\n\nI'm closing this bug. Please come with a test case that reproduce the problem.\nAnd it's not clear if I read the link (forum) that it's a Tomcat problem at all\n(it says Tomcat 4. 4.0.x of 4.1.x?)\n\nThanks\n\n-- Jeanfrancois", "id": 62173, "attachment_id": null, "bug_id": 30746, "creation_time": "2004-08-19T14:19:26Z", "time": "2004-08-19T14:19:26Z", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 12496\nTest case (WAR fille) to reproduce the issue", "is_private": false, "id": 62218, "creation_time": "2004-08-20T00:29:08Z", "time": "2004-08-20T00:29:08Z", "creator": "nlothian@apache.org", "bug_id": 30746, "attachment_id": 12496}, {"count": 3, "tags": [], "creator": "nlothian@apache.org", "text": "I've attached a test case (a WAR) to reproduce the issue. Deploy it, go to\nhttp://localhost:8080/test/ and press submit.\n\nThis issue occurs in Tomcat 5 - I haven't tried Tomcat 4 at all.", "id": 62219, "attachment_id": null, "bug_id": 30746, "creation_time": "2004-08-20T00:32:01Z", "time": "2004-08-20T00:32:01Z", "is_private": false}, {"count": 4, "tags": [], "creator": "william.barker@wilshire.com", "text": "I agree with Jean-Francois.  The HttpServlet class is for use with HTTP \nrequests, and it is clear from the Servlet spec that ServletRequest.getProtocol\n() may not return null for a HTTP request.\n\n", "id": 62221, "attachment_id": null, "bug_id": 30746, "creation_time": "2004-08-20T01:01:36Z", "time": "2004-08-20T01:01:36Z", "is_private": false}]
[{"count": 0, "tags": [], "text": "When reading a JSP thats inside a JAR, tomcat throws a IllegalStateException: zip file closed\n\nStacktrace:\n\n\njava.lang.IllegalStateException: zip file closed\n\tat java.util.zip.ZipFile.ensureOpen(ZipFile.java:670)\n\tat java.util.zip.ZipFile.getEntry(ZipFile.java:310)\n\tat java.util.jar.JarFile.getEntry(JarFile.java:240)\n\tat org.apache.tomcat.util.scan.JarFileUrlJar.getLastModified(JarFileUrlJar.java:87)\n\tat org.apache.jasper.JspCompilationContext.getLastModified(JspCompilationContext.java:368)\n\tat org.apache.jasper.JspCompilationContext.getLastModified(JspCompilationContext.java:356)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:358)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:336)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:323)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:580)\n\tat org.apache.jasper.servlet.JspServletWrapper.loadTagFile(JspServletWrapper.java:239)\n\tat org.apache.jasper.compiler.TagFileProcessor.loadTagFile(TagFileProcessor.java:584)\n\tat org.apache.jasper.compiler.TagFileProcessor.access$000(TagFileProcessor.java:50)\n\tat org.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit(TagFileProcessor.java:666)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1536)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2376)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2428)\n\tat org.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit(TagFileProcessor.java:670)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1536)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2376)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2428)\n\tat org.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit(TagFileProcessor.java:670)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1536)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2376)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2428)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2434)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:464)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2376)\n\tat org.apache.jasper.compiler.TagFileProcessor.loadTagFiles(TagFileProcessor.java:684)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:229)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:356)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:336)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:323)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:580)\n\tat org.apache.jasper.servlet.JspServletWrapper.loadTagFile(JspServletWrapper.java:239)\n\tat org.apache.jasper.compiler.TagFileProcessor.loadTagFile(TagFileProcessor.java:584)\n\tat org.apache.jasper.compiler.TagFileProcessor.access$000(TagFileProcessor.java:50)\n\tat org.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit(TagFileProcessor.java:666)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1536)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2376)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2428)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2434)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:464)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2376)\n\tat org.apache.jasper.compiler.TagFileProcessor.loadTagFiles(TagFileProcessor.java:684)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:229)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:356)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:336)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:323)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:580)\n\tat org.apache.jasper.servlet.JspServletWrapper.loadTagFile(JspServletWrapper.java:239)\n\tat org.apache.jasper.compiler.TagFileProcessor.loadTagFile(TagFileProcessor.java:584)\n\tat org.apache.jasper.compiler.TagFileProcessor.access$000(TagFileProcessor.java:50)\n\tat org.apache.jasper.compiler.TagFileProcessor$TagFileLoaderVisitor.visit(TagFileProcessor.java:666)\n\tat org.apache.jasper.compiler.Node$CustomTag.accept(Node.java:1536)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2376)\n\tat org.apache.jasper.compiler.Node$Visitor.visitBody(Node.java:2428)\n\tat org.apache.jasper.compiler.Node$Visitor.visit(Node.java:2434)\n\tat org.apache.jasper.compiler.Node$Root.accept(Node.java:464)\n\tat org.apache.jasper.compiler.Node$Nodes.visit(Node.java:2376)\n\tat org.apache.jasper.compiler.TagFileProcessor.loadTagFiles(TagFileProcessor.java:684)\n\tat org.apache.jasper.compiler.Compiler.generateJava(Compiler.java:229)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:356)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:336)\n\tat org.apache.jasper.compiler.Compiler.compile(Compiler.java:323)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:580)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:356)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:396)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:340)", "attachment_id": null, "id": 182825, "creator": "hm1rafael@gmail.com", "time": "2015-05-04T21:26:32Z", "bug_id": 57887, "creation_time": "2015-05-04T21:26:32Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 57887, "attachment_id": null, "id": 182842, "time": "2015-05-05T13:14:12Z", "creator": "markt@apache.org", "creation_time": "2015-05-05T13:14:12Z", "is_private": false, "text": "This works for me with a simple test case (JSP and tag file in JAR, JSP depends on tag file). If you still see this with the latest stable 8.0.x release (8.0.22 is being released as I type this) please re-open and provide the simplest possible test case to demonstrate the issue."}, {"count": 2, "tags": [], "bug_id": 57887, "text": "Created attachment 32717\ntest case\n\nThe problem happens when you have a recursive call inside a tag, created this test case just to point the problem, will try with the new version", "id": 182850, "time": "2015-05-05T16:37:42Z", "creator": "hm1rafael@gmail.com", "creation_time": "2015-05-05T16:37:42Z", "is_private": false, "attachment_id": 32717}, {"count": 3, "attachment_id": null, "creator": "hm1rafael@gmail.com", "is_private": false, "id": 182854, "time": "2015-05-05T19:47:23Z", "bug_id": 57887, "creation_time": "2015-05-05T19:47:23Z", "tags": [], "text": "8.0.22 has the same problem, last version that works is 8.0.15, submit a test case to help analyze the problem"}, {"count": 4, "attachment_id": null, "creator": "markt@apache.org", "is_private": false, "id": 182860, "time": "2015-05-06T14:47:16Z", "bug_id": 57887, "creation_time": "2015-05-06T14:47:16Z", "tags": [], "text": "Thanks for the test case. That made it pretty easy to track down the problem.\n\nThis has been fixed in trunk and 8.0.x and will be included in 8.0.23 onwards."}]
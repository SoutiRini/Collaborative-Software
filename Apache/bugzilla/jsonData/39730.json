[{"count": 0, "tags": [], "creator": "bugzilla@vampire.com.hk", "text": "I had difficulty in getting language negotiation working because I didn't\nrealise LanguagePriority was case sensitive... this is inconsistent with the\nbehaviour of AddLanguage.\n(I found this in version 2.0.54, but I've looked through the latest CHANGES file\nand not found anything indicating there has been a change on this)\n\nMy server configuration included:\n\nAddLanguage en .en \nAddLanguage zh-TW .zh-TW \nAddLanguage zh-CN .zh-CN \nLanguagePriority en zh-TW zh-CN fr de it ja\nForceLanguagePriority Prefer Fallback\n\nIf a client preferred Chinese, but none was available, the English version was\nserved - seeing this, I thought it was working.\n\nHowever, if the client preferred English and none was available, the \"406 Not\nAcceptable\" error was returned instead of a Chinese version.\n\nI changed the LanguagePriority directive to:\nLanguagePriority en zh-tw zh-TW zh-cn zh-CN fr de it ja\nand it worked in both cases. I conclude that the LanguagePriority directive does\ncase-sensitive matching.\n\nInterestingly, the 406 error page included the text:\n\n\"Available variants:\n\n    * haribo.html.zh-CN , type text/html, language zh-cn\n    * haribo.html.zh-TW , type text/html, language zh-tw\"\n\nSo the AddLanguage directive does fold the languge codes to lower case.\n\nI suggest:\n1. Add a note to the LanguagePriority directive documentation saying it is\ncase-sensitive\n\nor\n\n2. Change the behaviour of LanguagePriority so it is case-insensitive.\n\n(2) would be preferable, and it matches the behaviour of AddLanguage.\n\nThanks.", "id": 89806, "time": "2006-06-06T04:45:30Z", "bug_id": 39730, "creation_time": "2006-06-06T04:45:30Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "imacat@mail.imacat.idv.tw", "is_private": false, "text": "    Hi.  This is imacat from Taiwan.  I wonder why there is no answer or update\nto this bug yet for more than 9 months.\n\n    I fould that not only LanguagePriority, but DefaultLanguage is also\ncase-sensitive, too.  But they shouldn't, since (1) Apache documentation did not\nstate it in any place, (2) ISO-636 Language Codes themselves are not case-sensitive.\n\n    The following console log demostrate this bug.  The only difference of\nhttpd-lc.conf and httpd-uc.conf is that in httpd-lc.conf LanguagePriority and\nDefaultLanguage specify language in different cases, while in httpd-uc.conf they\nare the same.\n\n    Please tell me if you need any more information, or if I can be of any help.\n Thank you.\n\n======================\nimacat@rinse ~ % ls /tmp/apache/htdocs\npage.html  page.xhtml\nimacat@rinse ~ % cat /tmp/apache/htdocs/page.html\nThis is page.html.\nimacat@rinse ~ % cat /tmp/apache/htdocs/page.xhtml\nThis is page.xhtml.\nYou have new mail.\nimacat@rinse ~ % cat /tmp/apache/httpd-lc.conf\nUser nobody\nGroup nogroup\nServerName localhost\nServerAdmin webmaster@localhost\nServerRoot /tmp/apache\nDocumentRoot /tmp/apache/htdocs\nPidFile /tmp/apache/httpd.pid\nLoadModule mime_module /usr/lib/apache2/mod_mime.so\nLoadModule negotiation_module /usr/lib/apache2/mod_negotiation.so\nListen 50080\nErrorLog /tmp/apache/error_log\nOptions +MultiViews\nAddType application/xhtml+xml .xhtml\nAddType text/html .html\nForceLanguagePriority Prefer Fallback\n\nLanguagePriority zh-TW\nDefaultLanguage zh-tw\nimacat@rinse ~ % /usr/sbin/httpd -f /tmp/apache/httpd-lc.conf\nimacat@rinse ~ % telnet localhost 50080\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\nGET /page HTTP/1.1\nHost: localhost\nAccept-Language: en\nConnection: close\n\nHTTP/1.1 406 Not Acceptable\nDate: Fri, 16 Mar 2007 14:40:19 GMT\nServer: Apache/2.2.4 (Unix)\nAlternates: {\"page.html\" 1 {type text/html} {language zh-tw} {length 19}},\n{\"page.xhtml\" 1 {type application/xhtml+xml} {language zh-tw} {length 20}}\nVary: negotiate,accept\nTCN: list\nContent-Length: 452\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>406 Not Acceptable</title>\n</head><body>\n<h1>Not Acceptable</h1>\n<p>An appropriate representation of the requested resource /page could not be\nfound on this server.</p>\nAvailable variants:\n<ul>\n<li><a href=\"page.html\">page.html</a> , type text/html, language zh-tw</li>\n<li><a href=\"page.xhtml\">page.xhtml</a> , type application/xhtml+xml, language\nzh-tw</li>\n</ul>\n</body></html>\nConnection closed by foreign host.\nimacat@rinse ~ % kill $(<//tmp/apache/httpd.pid)\nimacat@rinse ~ % cat /tmp/apache/httpd-uc.conf\nUser nobody\nGroup nogroup\nServerName localhost\nServerAdmin webmaster@localhost\nServerRoot /tmp/apache\nDocumentRoot /tmp/apache/htdocs\nPidFile /tmp/apache/httpd.pid\nLoadModule mime_module /usr/lib/apache2/mod_mime.so\nLoadModule negotiation_module /usr/lib/apache2/mod_negotiation.so\nListen 50080\nErrorLog /tmp/apache/error_log\nOptions +MultiViews\nAddType application/xhtml+xml .xhtml\nAddType text/html .html\nForceLanguagePriority Prefer Fallback\n\nLanguagePriority zh-TW\nDefaultLanguage zh-TW\nimacat@rinse ~ % /usr/sbin/httpd -f /tmp/apache/httpd-uc.conf\nimacat@rinse ~ % telnet localhost 50080\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\nGET /page HTTP/1.1\nHost: localhost\nAccept-Language: en\nConnection: close\n\nHTTP/1.1 200 OK\nDate: Fri, 16 Mar 2007 14:40:33 GMT\nServer: Apache/2.2.4 (Unix)\nContent-Location: page.html\nVary: negotiate,accept\nTCN: choice\nLast-Modified: Fri, 16 Mar 2007 14:32:44 GMT\nETag: \"2a955c-13-42bcc1cd6bb00;42bcc1b870980\"\nAccept-Ranges: bytes\nContent-Length: 19\nConnection: close\nContent-Type: text/html\nContent-Language: zh-TW\n\nThis is page.html.\nConnection closed by foreign host.\nimacat@rinse ~ % kill $(<//tmp/apache/httpd.pid)\nimacat@rinse ~ %\n", "id": 100482, "time": "2007-03-16T08:02:32Z", "bug_id": 39730, "creation_time": "2007-03-16T08:02:32Z", "attachment_id": null}]
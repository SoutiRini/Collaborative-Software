[{"count": 0, "text": "The changelog notes for mod_jk 1.2.6/1.2.7 specify that mod_jk properly handle\nmultiple JSESSIONID cookies with overlapping domains as described below:\n\n\"Check all JSESSIONID cookies for a valid jvmRoute. If you have multiple Tomcats\nwith overlapping domains, then you can get multiple cookies without a defined\norder. This will route correctly as long as the different domains don't have any\nTomcats in common. (billbarker)\"\n\nUnfortunately this feature does not work properly because of a bug in the design\n implementation.\n\nIn the source file \"jk_lb_worker.c\", the function \"get_cookie\" should get every\nJSESSIONID cookies contained in the HTTP header but there is a mistake using the\nchar pointers \"id_start/id__end\". The result is that we just get the first\nJESSSIONID cookie, the other are simply lost in memory.\n\nThe bug is reproductible as follow:\n    nc website 80\n    GET /hello.jsp HTTP/1.0\n\nThen you will get a JSESSIONID Cookie in the HTTP header, for example:\n    Set-Cookie: JSESSIONID=297267684ED72B2F3AB38CFDD4402FC5; Path=/\n\nFinally:\n    nc website 80\n    GET /hello.jsp HTTP/1.0\n    Cookie:\nJSESSIONID=297267684ED72B2F3AB38CFDD4402FC6;JSESSIONID=297267684ED72B2F3AB38CFDD4402FC5;\n\nYou should not get another JSESSIONID (Set-Cookie option directive) and your\nrequest should be forwarded to the correct tomcat worker but it does not work.\nActually, mod_jk get the first JSESSIONID which is voluntary invalid but Tomcat\ndoes not know it and send us another \"Set-Cookie\" HTTP option header.", "creator": "david.ramblewski@gmail.com", "attachment_id": null, "id": 111975, "time": "2007-12-21T03:00:15Z", "bug_id": 44116, "creation_time": "2007-12-21T03:00:15Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "david.ramblewski@gmail.com", "attachment_id": 21300, "id": 111976, "time": "2007-12-21T03:04:24Z", "bug_id": 44116, "creation_time": "2007-12-21T03:04:24Z", "is_private": false, "text": "Created attachment 21300\nHandle multiple JSESSIONID cookies with tomcat overlaping domains\n\n\nBugFix for the feature:\n\n\"Check all JSESSIONID cookies for a valid jvmRoute. If you have multiple\nTomcats with overlapping domains, then you can get multiple cookies without a\ndefined order. This will route correctly as long as the different domains don't\nhave any Tomcats in common. (billbarker)\""}, {"count": 2, "tags": [], "creator": "david.ramblewski@gmail.com", "is_private": false, "text": "\nThe patch has been successfully tested with tomcat-connectors version 1.2.25 but\nshould work with versions from 1.2.6 to 1.2.25.\nThe following products are actually used on many production sites:\ntomcat-connectors 1.2.25 patched / apache-tomcat 5.5.12, 5.5.15, 5.5.17 and 5.5.25.\n", "id": 111977, "time": "2007-12-21T03:14:19Z", "bug_id": 44116, "creation_time": "2007-12-21T03:14:19Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 44116, "attachment_id": null, "text": "Reopen, so that we will actually consider the patch for inclusion. Will only be\nclosed/fixed after applied to the code.\n\nThanks for the patch. Unfortunately it's a couple of days to late for 1.2.26,\nwhich we are going to tag today, but we will have a look at the patch for 1.2.27.", "id": 111978, "time": "2007-12-21T03:35:58Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-12-21T03:35:58Z", "is_private": false}, {"count": 4, "tags": [], "text": "Created attachment 21338\nAlternative patch", "attachment_id": 21338, "id": 112443, "creator": "rainer.jung@kippdata.de", "time": "2008-01-02T14:04:11Z", "bug_id": 44116, "creation_time": "2008-01-02T14:04:11Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 44116, "text": "I made a small variation of your patch, which I attach to this issue.\nThe basic idea is the same, but it might copy a little less and also uses id_end\nto move id_start forward, so we have to do a little less earching. Finally it\nterminates at the earlier of ';' and ',' by using strpbrk.\n\nIf you have a good test case, could you do some testing of it? Feedback would be\nnice.\n\nIf all goes well, we'll include this for 1.2.27.", "id": 112444, "time": "2008-01-02T14:06:04Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-01-02T14:06:04Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "text": "The last patch has been successfully tested with tomcat-connectors version\n1.2.25 so there is no feature regression.\nI'm going to package the modules for apache 1.3 and apache 2.0 and it will be\ntagged STABLE on our production sites in few minutes.\n", "attachment_id": null, "id": 112451, "creator": "david.ramblewski@gmail.com", "time": "2008-01-03T02:45:59Z", "bug_id": 44116, "creation_time": "2008-01-03T02:45:59Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 44116, "attachment_id": null, "text": "Thank you for your quick feedback.\nThe patch has been committed and will be part of 1.2.27.\nI'm closing this now, don't hesitate to reopen, if needed.", "id": 112452, "time": "2008-01-03T03:23:18Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2008-01-03T03:23:18Z", "is_private": false}]
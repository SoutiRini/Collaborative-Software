[{"count": 0, "tags": [], "text": "I am trying to compile Apache 2.0.x on RedHat 7.2, with source locations \nof /usr/local/zlib, /usr/local/ssl, ... rather than using the RedHat \ndistributed files.\n\nProblem:\n\n./configure --prefix=/usr/local/apache2 --enable-mods-shared=most --enable-\ndeflate --enable-ssl --with-z=/usr/local/zlib --with-ssl=/usr/local/ssl\n\n<code output>\nchecking for zlib location... /usr\n</code output>\n\nWhat is happening:\n\nIf your system contains zlib.h in usr/include, ./configure will use /usr\n(include) as the source dir of zlib, over specified --with-z=dir.\n\nSolution:\n\nrename /usr/include/zlib.h;\nthan (after more problems)\nrename /usr/include/zutil.h;\n\n---------------------------------\nApache compiled on a virgin system is not a problem.\n\nBut if you have RedHat, or a distro with distributed files: libcrypto.so \nin /lib, zlib.h in /usr/include,... and try to compile apache with zlib(or \nopenssl, or some other modules); you will find out that code in ./configure has \nlocations with hardcoded search locations that are searched BEFORE --with-\nssl=dir or --with-z=dir... Wrong lib files are used, or worse of, the build \nprocess errors out.\n\nIn zlib, the proper --with-z=dir, will be used first; but then, for some \nreason, another code block(in ./configure) will use a hardcoded location and \nchange the zlib field.\n\nNow before someone goes and tells me that \"/usr\" means /usr/local/zlib, I have \nbeen on this for months, following the code and trying different run arounds. \nSearch the code for 'zlib.h', 'zutil.h', 'openssl version'...And you will \nunderstand.\n\nThis is the proper output after the renaming of zutil.h and zlib.h in \nusr/include.  Without this:\n\nadding \"-I/usr/local/zlib/include\" to INCLUDES\nadding \"-L/usr/local/zlib/lib\" to LDFLAGS\n\nnever happens.\n\n\nchecking whether to enable mod_deflate... checking dependencies\n  adding \"-I/usr/local/zlib/include\" to INCLUDES\n  adding \"-L/usr/local/zlib/lib\" to LDFLAGS\n  setting LIBS to \"-lz\"\nchecking for zlib library... found\nchecking zutil.h usability... yes\nchecking zutil.h presence... yes\nchecking for zutil.h... yes\nchecking whether to enable mod_deflate... shared (most)\n\nI believe this code section is the culprit.\n\n# Check whether --with-z or --without-z was given.\nif test \"${with_z+set}\" = set; then\n  withval=\"$with_z\"\n\n    if test \"x$withval\" != \"xyes\" && test \"x$withval\" != \"x\"; then\n      ap_zlib_base=\"$withval\"\n    fi\n\nfi;\n  if test \"x$ap_zlib_base\" = \"x\"; then\n    echo \"$as_me:$LINENO: checking for zlib location\" >&5\necho $ECHO_N \"checking for zlib location... $ECHO_C\" >&6\n    if test \"${ap_cv_zlib+set}\" = set; then\n  echo $ECHO_N \"(cached) $ECHO_C\" >&6\nelse\n\n      for dir in /usr/local /usr ; do\n        if test -d $dir && test -f $dir/include/zlib.h; then\n          ap_cv_zlib=$dir\n          break\n        fi\n      done\n\nfi", "attachment_id": null, "id": 36169, "creator": "towerofpower@operamail.com", "time": "2003-04-26T17:42:20Z", "bug_id": 19349, "creation_time": "2003-04-26T17:42:20Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 19349, "attachment_id": null, "is_private": false, "id": 36176, "time": "2003-04-26T18:56:16Z", "creator": "towerofpower@operamail.com", "creation_time": "2003-04-26T18:56:16Z", "text": "For some reason I can not reproduce this back on my system, as I have before(I \nhave the old output in a file)...I need to check on this, and later I will \nrepost."}]
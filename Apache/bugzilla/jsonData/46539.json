[{"count": 0, "tags": [], "bug_id": 46539, "text": "The QuietWriter class (in org.apache.log4j.helpers) does not live up to its published contract.  The javadocs says that \"QuietWriter does not throw exceptions when things go wrong...\", however, it will allow Runtime Exceptions to bubble up.\n\nI propose that QuietWriter catch Exception (not just IOException) to fullfil its contract.\n\nThis is a real problem running log4j with java 1.5 and the assorted CharsetEncoder state problems.  \n\njava.lang.IllegalStateException: Current state = FLUSHED, new state = CODING\n\tat java.nio.charset.CharsetEncoder.throwIllegalStateException(CharsetEncoder.java:941)\n\tat java.nio.charset.CharsetEncoder.encode(CharsetEncoder.java:537)\n\tat sun.nio.cs.StreamEncoder$CharsetSE.implWrite(StreamEncoder.java:384)\n\tat sun.nio.cs.StreamEncoder.write(StreamEncoder.java:136)\n\tat sun.nio.cs.StreamEncoder.write(StreamEncoder.java:146)\n\tat java.io.OutputStreamWriter.write(OutputStreamWriter.java:204)\n\tat java.io.Writer.write(Writer.java:126)\n\tat org.apache.log4j.helpers.QuietWriter.write(QuietWriter.java:47)\n\tat org.apache.log4j.WriterAppender.subAppend(WriterAppender.java:301)\n\tat org.apache.log4j.DailyRollingFileAppender.subAppend(DailyRollingFileAppender.java:358)\n\tat org.apache.log4j.WriterAppender.append(WriterAppender.java:159)\n\tat org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:230)\n\tat org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:65)\n\tat org.apache.log4j.AsyncAppender.append(AsyncAppender.java:87)\n\tat org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:230)\n\tat org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:65)\n\tat org.apache.log4j.Category.callAppenders(Category.java:203)\n\tat org.apache.log4j.Category.forcedLog(Category.java:388)\n\tat org.apache.log4j.Category.log(Category.java:853)\n\tat org.apache.commons.logging.impl.Log4JLogger.warn(Log4JLogger.java:157)\n\nIn this example The CharsetEncoder threw an IllegalStateException causing the AsyncAppender's Dispatcher thread to die.  Now the appender is synchronous but another IllegalStateException bubbled out of the application code.", "id": 124091, "time": "2009-01-15T07:51:22Z", "creator": "Joseph.Greene@ge.com", "creation_time": "2009-01-15T07:51:22Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 46539, "text": "Committed in revs 823408 and 823409.", "id": 131014, "time": "2009-10-08T21:47:28Z", "creator": "carnold@apache.org", "creation_time": "2009-10-08T21:47:28Z", "is_private": false, "attachment_id": null}]
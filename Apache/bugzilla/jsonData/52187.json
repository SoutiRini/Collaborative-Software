[{"attachment_id": null, "tags": [], "bug_id": 52187, "is_private": false, "count": 0, "id": 151505, "time": "2011-11-15T11:52:14Z", "creator": "rbargezi@infonic.net", "creation_time": "2011-11-15T11:52:14Z", "text": "When loading a test plan with user defined variables, they get duplicated.\n\nReproduction steps:\n- Open JMeter\n- Add a user defined variable to the Test Plan element\n- Save the Test Plan\n- Open the Test Plan\n=> the user defined variables show up twice"}, {"count": 1, "tags": [], "bug_id": 52187, "attachment_id": null, "text": "I can confirm the problem, there is only one UDV, but the UDV entries are duplicated.", "id": 151506, "time": "2011-11-15T12:37:54Z", "creator": "sebb@apache.org", "creation_time": "2011-11-15T12:37:54Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 52187, "attachment_id": null, "text": "This is a regression introduced by 50799.", "id": 151507, "time": "2011-11-15T13:08:39Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-11-15T13:08:39Z", "is_private": false}, {"count": 3, "tags": [], "creator": "rbargezi@infonic.net", "text": "My investigations show the same. It's caused by the fact that during the merge (AbstractTestElement.mergeIn) the properties are cloned. For a CollectionProperty the equality test in MultiProperty.mergeIn then fails, which id did not before the change.\n\nThis may though not be the root cause. I also observed that in the Load.insertLoadedTree method, the test plan gets cleared and initialized with the loaded test plan.\n\npublic static boolean insertLoadedTree(int id, HashTree tree, boolean merging) throws Exception, IllegalUserActionException {\n...\nif(isTestPlan && !merging) {\n   guiInstance.clearTestPlan((TestElement)tree.getArray()[0]);\n}\n...\n\nfurther down in the code, the test plan is then added once more\n...\nHashTree newTree = guiInstance.addSubTree(tree);\n...\n\nwhich effectively results in merging in the test plan with itself. I'm not sure if this is what the designers originally intended.", "id": 151509, "time": "2011-11-15T13:19:26Z", "bug_id": 52187, "creation_time": "2011-11-15T13:19:26Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 52187, "attachment_id": null, "text": "I rollbacked fix to 50799.\nI don't have time to investigate for now, will do it this week-end.\nIn the meantime if you find something feel free to provide a patch.\n\nThanks", "id": 151511, "time": "2011-11-15T13:23:57Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2011-11-15T13:23:57Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 52187, "attachment_id": null, "text": "Additional observation:\nThe cloning of the test elements also floods memory like wild. For each sample, the entire configuration gets cloned. If you have lots of lists of user defined variables or other larger config entries, you soon end up in an OutOfMemoryException.", "id": 151513, "time": "2011-11-15T13:59:23Z", "creator": "rbargezi@infonic.net", "creation_time": "2011-11-15T13:59:23Z", "is_private": false}, {"count": 6, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "text": "Fixed by revert on last 50799 fix.", "id": 151529, "time": "2011-11-15T21:24:28Z", "bug_id": 52187, "creation_time": "2011-11-15T21:24:28Z", "is_private": false, "attachment_id": null}]
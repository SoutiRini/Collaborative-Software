[{"count": 0, "attachment_id": null, "creator": "katzyn@gmail.com", "is_private": false, "id": 202816, "time": "2017-12-17T02:39:44Z", "bug_id": 61914, "creation_time": "2017-12-17T02:39:44Z", "tags": [], "text": "I have a lot of\n\njava.lang.NullPointerException\nat org.apache.tomcat.util.net.AbstractJsseEndpoint.createSSLEngine(AbstractJsseEndpoint.java:180)\nat org.apache.tomcat.util.net.SecureNioChannel.processSNI(SecureNioChannel.java:325)\nat org.apache.tomcat.util.net.SecureNioChannel.handshake(SecureNioChannel.java:175)\nat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1353)\nat org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n\nin system journal with Tomcat 9.0.2 running on Java 9.\n\nCode in SecureNioChannel.processSNI() passes null value of clientRequestedApplicationProtocols if TLSClientHelloExtractor.getResult() is not COMPLETE or NEED_INFO.\n\nBut code in AbstractJsseEndpoint.createSSLEngine does not perform check and unconditionally calls size() method on Java 9 here:\n\nif (JreCompat.isJre9Available() && clientRequestedApplicationProtocols.size() > 0 &&"}, {"count": 1, "attachment_id": null, "creator": "katzyn@gmail.com", "is_private": false, "id": 202817, "time": "2017-12-17T03:47:24Z", "bug_id": 61914, "creation_time": "2017-12-17T03:47:24Z", "tags": [], "text": "SecureNio2Channel.processSNI() is very similar to SecureNioChannel.processSNI() and may have the same issue."}, {"count": 2, "tags": [], "bug_id": 61914, "attachment_id": null, "text": "I've just checked old records in system journal, access log, and atop records.\n\nAfter restart there are a 5\u201310 such warings per hour. But after a few hours the rate of exceptions dramatically increases to 10\u201320 per second. After a some more time (about a day) Tomcat begins to eat slightly more than 100% of CPU on 2-core system and becomes unresponsible.\n\nI also have a heap dump in unresponsible state, but it contains some sensitive information and I cannot see nothing unusual in it. I'm not sure if this failure related to NPEs in createSSLEngine() or not.", "id": 202824, "time": "2017-12-17T15:13:24Z", "creator": "katzyn@gmail.com", "creation_time": "2017-12-17T15:13:24Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 61914, "is_private": false, "text": "I replaced\n\nclientRequestedApplicationProtocols.size() > 0\n\nwith\n\nclientRequestedApplicationProtocols != null && clientRequestedApplicationProtocols.size() > 0\n\non my installation some time ago and with this change server still works as expected. Can someone fix this is SVN?", "id": 202873, "time": "2017-12-21T07:31:44Z", "creator": "katzyn@gmail.com", "creation_time": "2017-12-21T07:31:44Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 61914, "attachment_id": null, "is_private": false, "id": 202875, "time": "2017-12-21T10:29:31Z", "creator": "tkieffer@cora.fr", "creation_time": "2017-12-21T10:29:31Z", "text": "When I start a tomcat 9 with MobaXterm from windows I have these java exceptions, it's since tomcat 9, I never had this issue before and I don't have this issue with Putty :\n\n21-Dec-2017 11:20:24.942 INFO [main] org.apache.catalina.core.ApplicationContext.log Initializing Spring root WebApplicationContext\n21-Dec-2017 11:20:42.708 SEVERE [main] org.apache.catalina.core.StandardContext.filterStart Exception starting filter [javamelody]\n java.lang.UnsatisfiedLinkError: /opt/jdk1.8.0_121/jre/lib/i386/libawt_xawt.so: libXtst.so.6: cannot open shared object file: No such file or directory\n        at java.lang.ClassLoader$NativeLibrary.load(Native Method)\n        at java.lang.ClassLoader.loadLibrary0(ClassLoader.java:1941)\n        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1824)\n        at java.lang.Runtime.load0(Runtime.java:809)\n        at java.lang.System.load(System.java:1086)\n        at java.lang.ClassLoader$NativeLibrary.load(Native Method)\n        at java.lang.ClassLoader.loadLibrary0(ClassLoader.java:1941)\n        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1845)\n        at java.lang.Runtime.loadLibrary0(Runtime.java:870)\n        at java.lang.System.loadLibrary(System.java:1122)\n        at java.awt.Toolkit$3.run(Toolkit.java:1636)\n        at java.awt.Toolkit$3.run(Toolkit.java:1634)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.awt.Toolkit.loadLibraries(Toolkit.java:1633)\n        at java.awt.Toolkit.<clinit>(Toolkit.java:1668)\n        at java.awt.Color.<clinit>(Color.java:275)\n        at net.bull.javamelody.JRobin.<clinit>(JRobin.java:58)\n        at net.bull.javamelody.FilterContext.initCollect(FilterContext.java:230)\n        at net.bull.javamelody.FilterContext.<init>(FilterContext.java:109)\n        at net.bull.javamelody.MonitoringFilter.init(MonitoringFilter.java:130)\n        at org.apache.catalina.core.ApplicationFilterConfig.initFilter(ApplicationFilterConfig.java:277)\n        at org.apache.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:258)\n        at org.apache.catalina.core.ApplicationFilterConfig.<init>(ApplicationFilterConfig.java:104)\n        at org.apache.catalina.core.StandardContext.filterStart(StandardContext.java:4491)\n        at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5131)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\n        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:740)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:716)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:703)\n        at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:976)\n        at org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1847)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)\n        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:112)\n        at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:761)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:431)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1575)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:308)\n        at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:123)\n        at org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:424)\n        at org.apache.catalina.util.LifecycleBase.setState(LifecycleBase.java:367)\n        at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:964)\n        at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:839)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\n        at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1425)\n        at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1415)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)\n        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:134)\n        at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:941)\n        at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:258)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\n        at org.apache.catalina.core.StandardService.startInternal(StandardService.java:422)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\n        at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:770)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:671)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:353)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:493)\n\n21-Dec-2017 11:20:42.847 INFO [main] org.apache.catalina.core.ApplicationContext.log Closing Spring root WebApplicationContext\n21-Dec-2017 11:20:55.707 INFO [main] org.apache.catalina.core.ApplicationContext.log 1 Spring WebApplicationInitializers detected on classpath\n21-Dec-2017 11:20:56.634 INFO [main] org.apache.catalina.core.ApplicationContext.log Initializing Spring root WebApplicationContext\n21-Dec-2017 11:21:01.668 SEVERE [main] org.apache.catalina.core.StandardContext.filterStart Exception starting filter [javamelody]\n java.lang.NoClassDefFoundError: Could not initialize class java.awt.Color\n        at net.bull.javamelody.JRobin.<clinit>(JRobin.java:58)\n        at net.bull.javamelody.FilterContext.initCollect(FilterContext.java:230)\n        at net.bull.javamelody.FilterContext.<init>(FilterContext.java:109)\n        at net.bull.javamelody.MonitoringFilter.init(MonitoringFilter.java:130)\n        at org.apache.catalina.core.ApplicationFilterConfig.initFilter(ApplicationFilterConfig.java:277)\n        at org.apache.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:258)\n        at org.apache.catalina.core.ApplicationFilterConfig.<init>(ApplicationFilterConfig.java:104)\n        at org.apache.catalina.core.StandardContext.filterStart(StandardContext.java:4491)\n        at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5131)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\n        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:740)\n        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:716)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:703)\n        at org.apache.catalina.startup.HostConfig.deployWAR(HostConfig.java:976)\n        at org.apache.catalina.startup.HostConfig$DeployWar.run(HostConfig.java:1847)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)\n        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:112)\n        at org.apache.catalina.startup.HostConfig.deployWARs(HostConfig.java:761)\n        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:431)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1575)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:308)\n        at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:123)\n        at org.apache.catalina.util.LifecycleBase.setStateInternal(LifecycleBase.java:424)\n        at org.apache.catalina.util.LifecycleBase.setState(LifecycleBase.java:367)\n        at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:964)\n        at org.apache.catalina.core.StandardHost.startInternal(StandardHost.java:839)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\n        at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1425)\n        at org.apache.catalina.core.ContainerBase$StartChild.call(ContainerBase.java:1415)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at org.apache.tomcat.util.threads.InlineExecutorService.execute(InlineExecutorService.java:75)\n        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:134)\n        at org.apache.catalina.core.ContainerBase.startInternal(ContainerBase.java:941)\n        at org.apache.catalina.core.StandardEngine.startInternal(StandardEngine.java:258)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\n        at org.apache.catalina.core.StandardService.startInternal(StandardService.java:422)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\n        at org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:770)\n        at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:671)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:498)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:353)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:493)\n\n21-Dec-2017 11:21:01.683 INFO [main] org.apache.catalina.core.ApplicationContext.log Closing Spring root WebApplicationContext"}, {"count": 5, "attachment_id": null, "creator": "remm@apache.org", "is_private": false, "id": 202879, "time": "2017-12-21T12:21:57Z", "bug_id": 61914, "creation_time": "2017-12-21T12:21:57Z", "tags": [], "text": "The fix will be in 9.0.3 and 8.5.25."}]
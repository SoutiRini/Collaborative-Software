[{"count": 0, "tags": [], "bug_id": 27138, "attachment_id": null, "id": 52758, "time": "2004-02-22T03:14:47Z", "creator": "mrfx@wla.pl", "creation_time": "2004-02-22T03:14:47Z", "is_private": false, "text": "After upgrade from 1.3.29 to 2.0.48 httpd works fine\nfor few hours then httpd processes get's more and more\nprocesor's time and do not relase it.\nHttpd restart and stop does not work.\nNormal kill doesn't work either, only\nkill -9 or killall -9 works correct.\nConfiguration is:\nmod_ssl/2.0.48 OpenSSL/0.9.7c mod_fastcgi/2.4.0 PHP/4.3.4\nThe system is Linux PLD."}, {"count": 1, "tags": [], "bug_id": 27138, "is_private": false, "text": "I encounter the same problem on Tru64 Unix. This is a problem with the \nchildren processes. I send a rather detailed description on apache-users list \na couple of month ago.\n\nMichel Jouvin - jouvin@lal.in2p3.fr", "id": 58559, "time": "2004-06-02T15:59:55Z", "creator": "jouvin@lal.in2p3.fr", "creation_time": "2004-06-02T15:59:55Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "does this happen without php installed?", "attachment_id": null, "id": 62691, "creation_time": "2004-08-30T02:33:42Z", "time": "2004-08-30T02:33:42Z", "creator": "chip@force-elite.com", "bug_id": 27138, "is_private": false}, {"count": 3, "tags": [], "bug_id": 27138, "attachment_id": null, "id": 62720, "time": "2004-08-30T06:02:05Z", "creator": "jouvin@lal.in2p3.fr", "creation_time": "2004-08-30T06:02:05Z", "is_private": false, "text": "In our case, this is impossible to test without PHP. As we don't know what \ncause the problem, we cannot reproduce it on a test server. We just know it \nhappens several times a week (2 or 3 at least), sometimes several times a day.\n\nI upgraded to last version of apache (2.0.50) and php (4.3.7) in June but it \ndidn't really improve the situation.\n\nHave you been able to get the materials I posted to httpd-users list or do you \nwant me to post it again ?\n\nMichel"}, {"count": 4, "tags": [], "bug_id": 27138, "attachment_id": null, "id": 62729, "time": "2004-08-30T06:57:33Z", "creator": "jwoolley@apache.org", "creation_time": "2004-08-30T06:57:33Z", "is_private": false, "text": "Posting or attaching any relevant details to this bug report would be useful. \nIn particular, we'll need to know more about your configuration; for example,\nthe output of \"./httpd -V\" as well as the contents of your httpd.conf would be\ngood to have.\n\nThanks,\nCliff"}, {"count": 5, "tags": [], "bug_id": 27138, "text": "Same behaviour as reported by Michel, Apache from standard Mandrake 9.2 packages\n(2.0.47), running with PHP 5.0.3.\n\nIf we turn ExtendedStatus On, the processes that \"hang\" report status \"S\"\n(starting up) and are usually simple GET requests for small GIF files.\n\nThere was a report somewhere (Google search) that placing \"EnableSendfile Off\"\nunder <Location /> would fix this behaviour - not true.\n\n\n\nHere's the output of httpd2 -V:\n\nServer version: Apache-AdvancedExtranetServer/2.0.47\nServer built:   Nov 12 2004 15:35:02\nServer's Module Magic Number: 20020903:4\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/prefork\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/etc/httpd/2.0\"\n -D SUEXEC_BIN=\"/usr/sbin/apache2-suexec\"\n -D DEFAULT_PIDLOG=\"/var/run/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_LOCKFILE=\"/var/run/accept.lock\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd2.conf\"\n\n\n\n\nHere are two processes in /server-status (hostname xxx'd):\n\nSrv\tPID\tAcc\tM\tCPU \tSS\tReq\tConn\tChild\tSlot\tClient\tVHost\tRequest\n1-0\t3424\t0/0/14844\tS \t2.49\t169\t0\t0.0\t0.00\t45.27 \t192.168.11.104\nxxxxxxxxxxxxxxxxxxxxxxxx\tGET /homepage/ HTTP/1.0\n2-0\t3425\t0/0/12946\tS \t15.44\t169\t0\t0.0\t0.00\t36.71 \t10.1.31.161\nxxxxxxxxxxxxxxxxxxxxxxxx\tGET /branches/ HTTP/1.0\n\n\n\n\n\nAnd here are the loaded modules:\n\nLoadModule access_module        modules/mod_access.so\nLoadModule auth_module          modules/mod_auth.so\nLoadModule auth_anon_module     modules/mod_auth_anon.so\nLoadModule auth_digest_module   modules/mod_auth_digest.so\nLoadModule include_module       modules/mod_include.so\nLoadModule log_config_module    modules/mod_log_config.so\nLoadModule env_module           modules/mod_env.so\nLoadModule expires_module       modules/mod_expires.so\nLoadModule headers_module       modules/mod_headers.so\nLoadModule usertrack_module     modules/mod_usertrack.so\nLoadModule setenvif_module      modules/mod_setenvif.so\nLoadModule mime_module          modules/mod_mime.so\nLoadModule status_module        modules/mod_status.so\nLoadModule autoindex_module     modules/mod_autoindex.so\nLoadModule asis_module          modules/mod_asis.so\nLoadModule info_module          modules/mod_info.so\nLoadModule cgi_module           modules/mod_cgi.so\nLoadModule vhost_alias_module   modules/mod_vhost_alias.so\nLoadModule negotiation_module   modules/mod_negotiation.so\nLoadModule dir_module           modules/mod_dir.so\nLoadModule imap_module          modules/mod_imap.so\nLoadModule actions_module       modules/mod_actions.so\nLoadModule userdir_module       modules/mod_userdir.so\nLoadModule alias_module         modules/mod_alias.so\nLoadModule rewrite_module       modules/mod_rewrite.so\nLoadModule php5_module        /usr/lib/apache2/libphp5.so\n", "id": 71817, "time": "2005-03-04T13:08:57Z", "creator": "nelson.menezes@city-link.co.uk", "creation_time": "2005-03-04T13:08:57Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "jorton@redhat.com", "text": "Please attach to one of the spinning processes with gdb and get a backtrace; e.g.:\n\n $ gdb /path/to/bin/httpd2 3425\n ...\n (gdb) backtrace\n\nand paste the output of the backtrace into this bug report.", "id": 71833, "time": "2005-03-04T16:05:01Z", "bug_id": 27138, "creation_time": "2005-03-04T16:05:01Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 27138, "attachment_id": null, "id": 71951, "time": "2005-03-08T10:21:18Z", "creator": "nelson.menezes@city-link.co.uk", "creation_time": "2005-03-08T10:21:18Z", "is_private": false, "text": "Here it is...\n\ngdb /usr/sbin/httpd2 29681\n...\n(gdb) backtrace\n#0  0x4003cc94 in apr_date_parse_rfc () from /usr/lib/libaprutil-0.so.0\n#1  0x4003ce07 in apr_date_parse_rfc () from /usr/lib/libaprutil-0.so.0\n#2  0x4003d47a in apr_rmm_calloc () from /usr/lib/libaprutil-0.so.0\n#3  0x40b564ea in util_ald_alloc () from /etc/httpd/2.0/extramodules/mod_ldap.so\n#4  0x40b56910 in util_ald_create_cache () from\n/etc/httpd/2.0/extramodules/mod_ldap.so\n#5  0x40b563ed in util_ldap_cache_init () from\n/etc/httpd/2.0/extramodules/mod_ldap.so\n#6  0x40b55987 in util_ldap_create_config () from\n/etc/httpd/2.0/extramodules/mod_ldap.so\n#7  0x0806860d in ap_run_child_init ()\n#8  0x08066a66 in ap_graceful_stop_signalled ()\n#9  0x08066f24 in ap_graceful_stop_signalled ()\n#10 0x08067181 in ap_graceful_stop_signalled ()\n#11 0x0806774e in ap_mpm_run ()\n#12 0x0806db23 in main ()\n#13 0x40237c57 in __libc_start_main () from /lib/i686/libc.so.6\n\n\nI also tried this:\nstrace -p 29681\nProcess 29681 attached - interrupt to quit\n\nBut there's no output at all.(?!)"}, {"count": 8, "attachment_id": null, "creator": "jorton@redhat.com", "is_private": false, "id": 71952, "time": "2005-03-08T10:48:31Z", "bug_id": 27138, "creation_time": "2005-03-08T10:48:31Z", "tags": [], "text": "I missed that you're using 2.0.47.  There are a number of known memory\ncorruption issues in the RMM code indicated as the culprit here, which are fixed\nin more recent releases.  Either report this to Mandrake so they can backport\npatches, or build a more recent release from source.\n\n(if you're not using the LDAP auth modules, just don't load them, which should\nalso avoid the issue)"}, {"count": 9, "attachment_id": null, "creator": "nelson.menezes@city-link.co.uk", "text": "(In reply to comment #8)\n> I missed that you're using 2.0.47.  There are a number of known memory\n> corruption issues in the RMM code indicated as the culprit here, which are fixed\n> in more recent releases.  Either report this to Mandrake so they can backport\n> patches, or build a more recent release from source.\n> \n> (if you're not using the LDAP auth modules, just don't load them, which should\n> also avoid the issue)\n\nI see. We'll probably go for the compile-from-source solution. Well, thanks for\nthe help!", "id": 71953, "time": "2005-03-08T10:56:32Z", "bug_id": 27138, "creation_time": "2005-03-08T10:56:32Z", "tags": [], "is_private": false}, {"count": 10, "attachment_id": null, "creator": "jouvin@lal.in2p3.fr", "text": "I still have the problem in 2.0.53. We are just monitoring the ill behaviour \nand killing the slave daemons when needed (they are no longer under control of \nmaster httpd process anyway). We live like that but forgot about solving this \nissue... Not sure if it comes from Apache itself or PHP but we cannot build a \nuseful test config without php...\n\nMichel", "id": 71954, "time": "2005-03-08T11:07:11Z", "bug_id": 27138, "creation_time": "2005-03-08T11:07:11Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 27138, "is_private": false, "text": "Michel, you need to follow the instructions in comment 6 to get a backtrace out\nof the spinning processes, to track the issue down further. ", "id": 71956, "time": "2005-03-08T11:10:38Z", "creator": "jorton@redhat.com", "creation_time": "2005-03-08T11:10:38Z", "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 27138, "text": "(In reply to comment #10)\n> I still have the problem in 2.0.53. We are just monitoring the ill behaviour \n> and killing the slave daemons when needed (they are no longer under control of \n> master httpd process anyway). We live like that but forgot about solving this \n> issue... Not sure if it comes from Apache itself or PHP but we cannot build a \n> useful test config without php...\n> \n> Michel\n\n\nI've trawled the net for answers; apparently this behaviour can also come from a\nmisbehaving PHP script.\n\nThe best way to track it down might be to set \"ExtendedStatus On\" and check the\noffending processes in /server-status/. Also, \"strace -p <PID>\" and \"lsof -p\n<PID>\" could help find any open files that are being written/read/failed in a cycle.\n\nI didn't find anything in my case (seems to be internal to the version of Apache\nwe're running), but those methods should allow you to track down the cause of\nthe problem, if it's a script.", "id": 71958, "time": "2005-03-08T11:18:33Z", "creator": "nelson.menezes@city-link.co.uk", "creation_time": "2005-03-08T11:18:33Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "text": "Here is my traceback of a spinning process (this is Tru64 dbx). Just I don't \nsee anything really useful. It looks like if there is no thread executing \nApache code...\n\n\tThreads traceback for process 1324818\ndbx version 5.1\nType 'help' for help.\n\nstopped at  [thread_block:3303 ,0xfffffc00002eafb0]\t Source not available\n\nwarning: Files compiled -g3: parameter values probably wrong\n\nThread 0xfffffc0037b82700:\n>  0 thread_block() [\"../../../../src/kernel/kern/sched_prim.c\":3303, \n0xfffffc00002eafb0]\n   1 thread_preempt(thread = 0xfffffc0037b82700, may_susp = 1) \n[\"../../../../src/kernel/kern/sched_prim.c\":5192, 0xfffffc00002ee194]\n   2 trap(a0 = (...), a1 = (...), a2 = (...), code = 81, exc_frame = \n0xfffffe04b6def900) [\"../../../../src/kernel/arch/alpha/trap.c\":3004, \n0xfffffc00006bd2d0]\n   3 exception_exit(0x8, 0x30002026b90, 0x30042029bc0, 0x14079d828, \n0x1426f7e30) [\"../../../../src/kernel/arch/alpha/locore.s\":1366, \n0xfffffc00006b6f58]\n\nThread 0xfffffc00664cc380:\n>  0 thread_block() [\"../../../../src/kernel/kern/sched_prim.c\":3303, \n0xfffffc00002eafb0]\n   1 sleep_prim(chan = (nil), pri = 0, wmesg = (unallocated - symbol optimized \naway), timo = 0, lockp = 0xfffffc00422cde00, flags = 257) \n[\"../../../../src/kernel/kern/sched_prim.c\":5633, 0xfffffc00002ee980]\n   2 nxm_extra_idle(arg = 0) \n[\"../../../../src/kernel/kern/syscall_subr.c\":3566, 0xfffffc00002f3294]\n   3 thread_bootstrap(0x8, 0x0, 0x0, 0x0, 0x0) \n[\"../../../../src/kernel/arch/alpha/locore.s\":3222, 0xfffffc00006b84cc]\n\nThread 0xfffffc0037b83180:\n>  0 thread_block() [\"../../../../src/kernel/kern/sched_prim.c\":3303, \n0xfffffc00002eafb0]\n   1 sleep_prim(chan = (nil), pri = 0, wmesg = (unallocated - symbol optimized \naway), timo = 0, lockp = 0xfffffc0037b83388, flags = 1537) \n[\"../../../../src/kernel/kern/sched_prim.c\":5633, 0xfffffc00002ee980]\n   2 mpsleep(chan = (unallocated - symbol optimized away), pri = 0, wmesg = \n(unallocated - symbol optimized away), timo = 0, lockp = (unallocated - symbol \noptimized away), flags = 0) [\"../../../../src/kernel/kern/sched_prim.c\":5539, \n0xfffffc00002ee6ec]\n   3 nxm_thread_block(tid = 8, seconds = 0, flags = 1, action = 0x3ffc01b96e0, \nuseconds = 0) [\"../../../../src/kernel/kern/syscall_subr.c\":4510, \n0xfffffc00002f4730]\n   4 _Xsyscall(0x8, 0x3ff805c1a98, 0x3ffc01c01b0, 0x8, 0x4231c925) \n[\"../../../../src/kernel/arch/alpha/locore.s\":2112, 0xfffffc00006b7524]\n\tEnd of threads traceback for process 1324818\n\n", "attachment_id": null, "id": 72222, "creation_time": "2005-03-11T17:51:01Z", "time": "2005-03-11T17:51:01Z", "creator": "jouvin@lal.in2p3.fr", "bug_id": 27138, "is_private": false}, {"count": 14, "tags": [], "bug_id": 27138, "is_private": false, "text": "Michel: I suggest you try prefork and see if the problems persist.", "id": 72228, "time": "2005-03-11T19:36:19Z", "creator": "jorton@redhat.com", "creation_time": "2005-03-11T19:36:19Z", "attachment_id": null}]
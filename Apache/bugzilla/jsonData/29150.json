[{"count": 0, "tags": [], "creator": "masonjm@ah.org", "attachment_id": null, "id": 57881, "time": "2004-05-21T22:45:04Z", "bug_id": 29150, "creation_time": "2004-05-21T22:45:04Z", "is_private": false, "text": "Quick Overview:\n  I've setup my Domain to use two MySQL databases as stores, one scoped to \"/\"\nand the other scoped to \"/users\". During startup when Slide attempts to\ninitialize the domain it encounters a deadlock trying to create \"/users\". After\na few seconds it tries to continue but dies because \"/actions/read\" never gets\ncreated.\n\nA similar setup using MySQL for one store and TX for the other works fine.\n\nOther Info:\n MySQL version: 4.0.18-nt\n Slide version: 2.0 (The Tomcat 5.0.19 bundle)\n JDBC Driver version: 3.0.11\n\nBelow are snips from my Domain.xml file and a portion of the startup output.\n\nDomain.xml:\n\n<definition>\n\t\t\n\t<store name=\"main\">\n\t\t<nodestore classname=\"org.apache.slide.store.impl.rdbms.JDBCStore\">\n\t\t\t<parameter\nname=\"adapter\">org.apache.slide.store.impl.rdbms.MySqlRDBMSAdapter</parameter>\n\t\t\t<parameter name=\"driver\">com.mysql.jdbc.Driver</parameter>\n\t\t\t<parameter name=\"url\">jdbc:mysql://localhost/slide</parameter>\n\t\t\t<parameter name=\"user\">slide</parameter>\n\t\t\t<parameter name=\"password\">slide</parameter>\n\t\t\t<parameter name=\"dbcpPooling\">true</parameter>\n\t\t\t<parameter name=\"maxPooledConnections\">2</parameter>\n\t\t\t<parameter name=\"isolation\">SERIALIZABLE</parameter>\n\t\t\t<parameter name=\"compress\">false</parameter>\n\t\t</nodestore>\n\t\t<contentstore>\n\t\t\t<reference store=\"nodestore\" />\n\t\t</contentstore>\n\t\t<securitystore>\n\t\t\t<reference store=\"nodestore\" />\n\t\t</securitystore>\n\t\t<lockstore>\n\t\t\t<reference store=\"nodestore\" />\n\t\t</lockstore>\n\t\t<revisiondescriptorsstore>\n\t\t\t<reference store=\"nodestore\" />\n\t\t</revisiondescriptorsstore>\n\t\t<revisiondescriptorstore>\n\t\t\t<reference store=\"nodestore\" />\n\t\t</revisiondescriptorstore>\n\t</store>\n\n\t<store name=\"users\">\n\t\t<nodestore classname=\"org.apache.slide.store.impl.rdbms.JDBCStore\">\n\t\t\t<parameter\nname=\"adapter\">org.apache.slide.store.impl.rdbms.MySqlRDBMSAdapter</parameter>\n\t\t\t<parameter name=\"driver\">com.mysql.jdbc.Driver</parameter>\n\t\t\t<parameter name=\"url\">jdbc:mysql://localhost/slide_users</parameter>\n\t\t\t<parameter name=\"user\">slide_users</parameter>\n\t\t\t<parameter name=\"password\">slide_users</parameter>\n\t\t\t<parameter name=\"dbcpPooling\">true</parameter>\n\t\t\t<parameter name=\"maxPooledConnections\">2</parameter>\n\t\t\t<parameter name=\"isolation\">SERIALIZABLE</parameter>\n\t\t\t<parameter name=\"compress\">false</parameter>\n\t\t</nodestore>\n\t\t<contentstore>\n\t\t\t<reference store=\"nodestore\" />\n\t\t</contentstore>\n\t\t<securitystore>\n\t\t\t<reference store=\"nodestore\" />\n\t\t</securitystore>\n\t\t<lockstore>\n\t\t\t<reference store=\"nodestore\" />\n\t\t</lockstore>\n\t\t<revisiondescriptorsstore>\n\t\t\t<reference store=\"nodestore\" />\n\t\t</revisiondescriptorsstore>\n\t\t<revisiondescriptorstore>\n\t\t\t<reference store=\"nodestore\" />\n\t\t</revisiondescriptorstore>\n\t</store>\n\t\n\t<scope match=\"/\" store=\"main\"/>\n\t<scope match=\"/users\" store=\"users\"/>\n</definition>\n\nConsole Output:\n\n21 May 2004 15:27:37 - org.apache.slide.common.XMLUnmarshaller - INFO - Loading\nobject /\n21 May 2004 15:27:37 - org.apache.slide.store.impl.rdbms.StandardRDBMSAdapter -\nINFO - /1.0\n21 May 2004 15:27:37 - org.apache.slide.store.impl.rdbms.StandardRDBMSAdapter -\nINFO - /1.0\n21 May 2004 15:27:37 - org.apache.slide.common.XMLUnmarshaller - INFO - Loading\nobject /users\n21 May 2004 15:28:28 - org.apache.slide.store.impl.rdbms.MySqlRDBMSAdapter -\nERROR - SQL error 1205 on /users: Deadlock\nfound when trying to get lock; Try restarting transaction,  message from server:\n\"Lock wait timeout exceeded; Try restarting transaction\"\norg.apache.slide.common.ServiceAccessException: Service\norg.apache.slide.store.impl.rdbms.JDBCStore@1b0bdc8 access error : Deadlock\nfound when trying to get lock; Try restarting transaction,  message from server:\n\"Lock wait timeout exceeded; Try restarting transaction\"\n        at\norg.apache.slide.store.impl.rdbms.MySqlRDBMSAdapter.createException(MySqlRDBMSAdapter.java:60)\n        at\norg.apache.slide.store.impl.rdbms.StandardRDBMSAdapter.storeObject(StandardRDBMSAdapter.java:197)\n        at\norg.apache.slide.store.impl.rdbms.StandardRDBMSAdapter.createObject(StandardRDBMSAdapter.java:89)\n        at\norg.apache.slide.store.impl.rdbms.AbstractRDBMSStore.createObject(AbstractRDBMSStore.java:476)\n        at org.apache.slide.store.AbstractStore.createObject(AbstractStore.java:557)\n        at org.apache.slide.store.ExtendedStore.createObject(ExtendedStore.java:436)\n        at org.apache.slide.structure.StructureImpl.create(StructureImpl.java:322)\n        at\norg.apache.slide.common.XMLUnmarshaller.loadObjectNode(XMLUnmarshaller.java:158)\n        at\norg.apache.slide.common.XMLUnmarshaller.loadObjectNode(XMLUnmarshaller.java:295)\n        at\norg.apache.slide.common.XMLUnmarshaller.unmarshal(XMLUnmarshaller.java:90)\n        at\norg.apache.slide.common.NamespaceAccessTokenImpl.importData(NamespaceAccessTokenImpl.java:267)\n        at org.apache.slide.common.Namespace.loadBaseData(Namespace.java:775)\n        at org.apache.slide.common.Domain.initNamespace(Domain.java:814)\n        at org.apache.slide.common.Domain.init(Domain.java:433)\n        at org.apache.slide.common.Domain.selfInit(Domain.java:747)\n        at org.apache.slide.common.Domain.accessNamespace(Domain.java:235)\n        at wrappers.catalina.SlideRealm.start(SlideRealm.java:178)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1118)\n        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:521)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:2345)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:594)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at\nsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:398)\n21 May 2004 15:28:28 - org.apache.slide.common.Namespace - INFO - Namespace base\nconfiguration was already done before\n21 May 2004 15:28:28 - org.apache.slide.common.Namespace - INFO - Loading\nnamespace slide configuration\n21 May 2004 15:28:28 - org.apache.slide.common.Domain - ERROR -\norg.apache.slide.structure.ObjectNotFoundException: No object found at /actions/read\norg.apache.slide.structure.ObjectNotFoundException: No object found at /actions/read\n        at\norg.apache.slide.store.impl.rdbms.StandardRDBMSAdapter.retrieveObject(StandardRDBMSAdapter.java:283)"}]
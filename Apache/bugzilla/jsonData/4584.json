[{"count": 0, "tags": [], "bug_id": 4584, "text": "I'm using the jlink task to aggregate my external JAR files into a monolithic \nJAR file because Tomcat doesn't seem to like long classpath definitions.\n\nHere's my actual task def:\n\n<jlink compress=\"true\" outfile=\"${deploy.lib}/${project-ext.jar}\">\n    <mergefiles>\n        <fileset dir=\"${build.lib}\">\n            <patternset refid=\"external.library.dependencies\"/>\n        </fileset>\n    </mergefiles>\n</jlink>\n\nMy external library dependencies are:\n\n<patternset id=\"external.library.dependencies\" >\n    <include name=\"log4j-1_0_4.jar\"/>   <!-- base logging -->\n    <include name=\"xerces_1_2.jar\"/>\n    <include name=\"jdmkrt.jar\"/>    <!-- snmp -->\n    <include name=\"classes12.zip\"/> <!-- oracle for OMs -->\n    <include name=\"jdom-0.6b.jar\"/> <!-- JDOM XML parsing -->\n    <include name=\"vbjorb.jar\"/> <!-- visibroker -->\n    <include name=\"providerutil.jar\"/>  <!-- JNDI Context Helpers    -->\n    <include name=\"fscontext.jar\"/>     <!-- JNDI FileSystem Context -->\n</patternset>\n\nThis seems to build me a JAR file which is not viewable by using: \"jar tvf \nfile.jar\".\n\nI get the following exception:\n\n> jar tvf external.jar\n\n...outputs a subset of files from the external.jar file...\njava.util.zip.ZipException: invalid stored block lengths\n        at java.util.zip.InflaterInputStream.read(InflaterInputStream.java:139)\n        at java.util.zip.ZipInputStream.read(ZipInputStream.java:142)\n        at java.util.zip.ZipInputStream.closeEntry(ZipInputStream.java:93)\n        at sun.tools.jar.Main.list(Main.java:744)\n        at sun.tools.jar.Main.run(Main.java:193)\n        at sun.tools.jar.Main.main(Main.java:904)", "id": 7473, "attachment_id": null, "creator": "victor.ng@redknee.com", "creation_time": "2001-11-01T21:46:20Z", "time": "2001-11-01T21:46:20Z", "is_private": false}, {"count": 1, "tags": [], "text": "The jlink task is known to have problems when some of the input files are\ncompressed while others are not.\n\njar tf is know to report that some archives are corrupt while they are not\n- as can easily be verified using zip -Tv or similar.\n\nI don't know which is the case here, can you use the generated archive?  If so,\nI wouldn't worry about the comments command line jar is making.\n\nOtherwise, can you use <jar> with nested <zipfileset>s?", "is_private": false, "bug_id": 4584, "id": 7480, "time": "2001-11-02T07:35:08Z", "creator": "bodewig@apache.org", "creation_time": "2001-11-02T07:35:08Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 4584, "text": "I've gotten around this bug by using a set of unzip tasks followed by a zip \ntask.", "id": 7657, "attachment_id": null, "creator": "victor.ng@redknee.com", "creation_time": "2001-11-07T12:07:54Z", "time": "2001-11-07T12:07:54Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 4584, "text": "Here is another possible work around:\n\nDon't use compression=\"yes\". Instead, <jlink> to a temporary jar then use a \nzipfileset in your <jar> task and point to the temp jar. I had to do this and \nit worked fine. (The important part is turning off compression -- that corrupts \nthe generated jar file.)\n\nAn example:\n<target name=\"jar\" depends=\"compile\">\n    <mkdir dir=\"${basedir}/build/lib/temp\" />\n    <!-- Create a temp jar of all the jars to be included in jive.jar: -->\n    <jlink outfile=\"${basedir}/build/lib/temp/temp.jar\">\n        <mergefiles>\n            <fileset dir=\"${build.lib.merge.dir}\" includes=\"*.jar\" />\n        </mergefiles>\n    </jlink>\n    <jar\n        jarfile=\"${jar.dest.dir}/foo.jar\"\n        manifest=\"${resources.dir}/share/manifest.mf\"\n    >\n        <!-- Main .class files: -->\n        <fileset dir=\"${build.dest.dir}\" includes=\"com/foo/**/*.class\" />\n        <!-- Add in merged jars: -->\n        <zipfileset src=\"${basedir}/build/lib/temp/temp.jar\" />\n    </jar>\n    <delete file=\"${basedir}/build/lib/temp/temp.jar\" />\n</target>", "id": 11338, "attachment_id": null, "creator": "bill@jivesoftware.com", "creation_time": "2002-03-01T02:22:46Z", "time": "2002-03-01T02:22:46Z", "is_private": false}, {"count": 4, "tags": [], "creator": "umagesh@apache.org", "text": "Changing severity from Blocker to Normal because a workaround has been provided.\n\nSidenote: This PR, being reported against an 'optional' task, shouldn't block a \nrelease, IMO.\n", "id": 13187, "time": "2002-04-10T14:42:55Z", "bug_id": 4584, "creation_time": "2002-04-10T14:42:55Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "<jlink> is deprecated in 1.5, please use <jar> with <zipfileset>s and\n<zipgroupfileset>s.\n", "attachment_id": null, "bug_id": 4584, "id": 17294, "time": "2002-06-06T07:22:54Z", "creator": "bodewig@apache.org", "creation_time": "2002-06-06T07:22:54Z", "is_private": false}]
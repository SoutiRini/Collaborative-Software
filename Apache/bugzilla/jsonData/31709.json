[{"count": 0, "attachment_id": null, "bug_id": 31709, "is_private": false, "id": 65097, "time": "2004-10-13T21:02:27Z", "creator": "vincent@gryzor.com", "creation_time": "2004-10-13T21:02:27Z", "tags": [], "text": "Greetings,\n\nThis is tested against 2.0.52, not appearing in the version list.\nMy config hosts multiple name based virtualhosts, both HTTP and HTTPS. I have no\n3rd party module running, apart from mod_security.\n\nThis is on Debian Sarge, using Debian official packages for 2.0.52, in case it\nmatters.\n\nThe problem seems to be about SSL vhosts (name based, with wildcard\ncertificate). If I attempt to load them in a certain order, Apache raises an\nerror \"[error] Oops, no RSA or DSA server certificate found?!\" at startup.\n\nI have found out that changing the loading order of virtualhosts solves the\nproblem and gets the server to start fine.\n\nVery strangely, the initial config has worked fine for months, and has started\nraising the error when I updated certificates and keys. (The former certificate\nwas self-signed, and hence, the \"SSLCACertificateFile\" options were not present\nin the original, working config).\n\nI have attached and numbered config files below (this is a debian-like splitted\nconfig).\n\nThe order that leads to the mentionned error is when loading extract configs in\nthe order : 1 - 2 - 3.\n\nThe order that leads to server starting fins is 1 - 3 - 2.\n\nFor the story, and in case it matters, this is a reverse proxy installation,\nwith several IP addresses. You will notice in attached files that the\n<VirtualHost> argument is not the same from one file to another. I tend to\nbelieve that is the source of the problem, and grouping similar IPs together\nsort of solves the problem.\n\nChanging the ServerName of the 2nd VirtualHost block of the file \"3\" also\n\"solves\" the problem, but is not acceptable to my setup.\n\nI am, of course, available for providing more details about this matter if this\ndescription is incomplete or unclear.\n\nCheers,\n\nVincent Deffontaines"}, {"count": 1, "tags": [], "creator": "vincent@gryzor.com", "is_private": false, "text": "Created attachment 13082\nFile 1 included in the config as described inline", "id": 65098, "time": "2004-10-13T21:05:56Z", "bug_id": 31709, "creation_time": "2004-10-13T21:05:56Z", "attachment_id": 13082}, {"count": 2, "tags": [], "bug_id": 31709, "text": "Created attachment 13083\nFile 2 included in the config as described inline", "id": 65099, "time": "2004-10-13T21:06:14Z", "creator": "vincent@gryzor.com", "creation_time": "2004-10-13T21:06:14Z", "is_private": false, "attachment_id": 13083}, {"count": 3, "tags": [], "creator": "vincent@gryzor.com", "attachment_id": 13084, "is_private": false, "id": 65100, "time": "2004-10-13T21:06:32Z", "bug_id": 31709, "creation_time": "2004-10-13T21:06:32Z", "text": "Created attachment 13084\nFile 3 included in the config as described inline"}, {"count": 4, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "text": "Can you put \"LogLevel debug\" in each vhost and then attach the complete\nerror_log output for the failure case?", "id": 65101, "time": "2004-10-13T21:08:41Z", "bug_id": 31709, "creation_time": "2004-10-13T21:08:41Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 31709, "text": "OK, good that you asked, cause your question has caused me to find more details.\nTrying to get back in reproducing the bug, I found out changing the order of\nvhosts is not a solution.\n\nI just found out the problem seems to come from the passphrase from the key.\n\nIf the key has a passphrase, I get the error : \"Oops, no RSA or DSA server\ncertificate found?!\". If I run \"openssl rsa -in cert.key -out cert.key\" on the\nkey to remove the passphrase, apache loads just fine, no matter the order of the\nvhosts. You may want to close this bug, and have me open a new one for more\nclarity? Sorry for the confusion, I'm getting tired, performed the two changes\n[remove passphrase + change vhost order] at the same stage, which screwed my\nanalysis.\n\nAttached is the debug error log you asked for anyway.\n\n", "id": 65102, "time": "2004-10-13T21:32:44Z", "creator": "vincent@gryzor.com", "creation_time": "2004-10-13T21:32:44Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 31709, "text": "Created attachment 13086\nThe error log obtained on the error condition.", "id": 65103, "time": "2004-10-13T21:33:21Z", "creator": "vincent@gryzor.com", "creation_time": "2004-10-13T21:33:21Z", "is_private": false, "attachment_id": 13086}, {"count": 7, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "is_private": false, "id": 79287, "time": "2005-09-01T14:19:16Z", "bug_id": 31709, "creation_time": "2005-09-01T14:19:16Z", "text": "Is this still reproducible in 2.0.54?  It could be one of the random problems\nwhich are caused by not clearing the OpenSSL error stack enough."}, {"count": 8, "tags": [], "text": "Dear Joe,\n\nExactly the same error happened with apache httpd-2.2.2, and as the original\npost proposed, the grouping of VirtualHosts helped. Setting loglevel to debug\njust prints the next three lines into the error log of the errorneous virtualhost:\n\n[Mon Jul 10 12:13:18 2006] [debug] ssl_engine_init.c(405): Creating new SSL\ncontext (protocols: SSLv2, SSLv3, TLSv1)\n[Mon Jul 10 12:13:18 2006] [debug] ssl_engine_init.c(601): Configuring permitted\nSSL ciphers [ALL:!ADH:!EXPORT56:!LOW:RC4+RSA:+HIGH:+MEDIUM:+SSLv2:+EXP]\n[Mon Jul 10 12:13:18 2006] [error] Oops, no RSA or DSA server certificate found\nfor 'my.hostname.hu:0'?!\n\nBest,\nAron Ujvari\n", "is_private": false, "id": 91053, "creator": "xanco@nikhok.hu", "time": "2006-07-10T11:26:28Z", "bug_id": 31709, "creation_time": "2006-07-10T11:26:28Z", "attachment_id": null}, {"count": 9, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "text": "What version of OpenSSL? \n\nCan you narrow this down to an exact reproduction case: a single config file\nusing self-signed certs?  Also try using a vanilla httpd build rather than\nDebian's too.", "id": 91058, "time": "2006-07-10T13:09:59Z", "bug_id": 31709, "creation_time": "2006-07-10T13:09:59Z", "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 31709, "text": "I have the same problem in Apache/2.2.15 (Unix) mod_ssl/2.2.15 OpenSSL/0.9.8e-fips-rhel5 DAV/2", "id": 137878, "time": "2010-06-24T10:42:14Z", "creator": "jcomputacion@hotmail.com", "creation_time": "2010-06-24T10:42:14Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "jorton@redhat.com", "text": "Created attachment 26640\nprobable fix\n\nThe bug fixed in the trunk r1069765 and r1069772 is probably (but not definitely) the issue being seen here.\n\nAttached backport for 2.2.x.", "id": 144185, "time": "2011-02-11T08:16:54Z", "bug_id": 31709, "creation_time": "2011-02-11T08:16:54Z", "is_private": false, "attachment_id": 26640}, {"count": 12, "tags": [], "bug_id": 31709, "text": "*** Bug 41164 has been marked as a duplicate of this bug. ***", "id": 144187, "time": "2011-02-11T08:17:41Z", "creator": "jorton@redhat.com", "creation_time": "2011-02-11T08:17:41Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "*** Bug 39192 has been marked as a duplicate of this bug. ***", "id": 144189, "time": "2011-02-11T08:18:23Z", "bug_id": 31709, "creation_time": "2011-02-11T08:18:23Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 30033, "text": "To get more control over the HTTP-Header i send it via WriteClient (and not via \nServerSupportFunction). This works fine under IIS but under Apache WriteClient \nfails and GetLastError() returns 87 (invalid parameter).", "id": 60432, "time": "2004-07-11T10:21:58Z", "creator": "luckow@eldeo.de", "creation_time": "2004-07-11T10:21:58Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "nick@webthing.com", "is_private": false, "id": 60433, "attachment_id": null, "bug_id": 30033, "creation_time": "2004-07-11T10:43:18Z", "time": "2004-07-11T10:43:18Z", "text": "I've no idea who works on mod_isapi, but I think this bug report really needs an\nexample that demonstrates the problem.  From the description, I'd have thought\nyou could construct a HelloWorld-sized example?"}, {"count": 2, "tags": [], "bug_id": 30033, "text": "Sample:\n\nDWORD WINAPI HttpExtensionProc(LPEXTENSION_CONTROL_BLOCK ecb) {\n  char* buffer = \"HTTP/1.1 200 OK\\r\\nDate: Sun, 11 Jul 2004 09:10:58 \nGMT\\r\\nContent-length: 0\\r\\n\\r\\n\";\n  unsigned long bufferSize = strlen(buffer);\n\n  if (!ecb->WriteClient(ecb->ConnID,buffer,&bufferSize,HSE_IO_SYNC)) {\n    return HSE_STATUS_ERROR;\n  }; // if\n  return HSE_STATUS_SUCCESS_AND_KEEP_CONN;\n};\n\nIIS: WriteClient works, the header is \"nph-\"sent.\nApache: WriteClient fails.", "id": 60436, "time": "2004-07-11T11:03:38Z", "creator": "luckow@eldeo.de", "creation_time": "2004-07-11T11:03:38Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 30033, "is_private": false, "text": "I had a look at the code in mod_isapi.c, I changed line 687 from\n\napr_cpystrn(newstat + 8, stat, statlen + 1);\nto\napr_cpystrn(newstat + 8, stat, statlen);\n\nand that seemed to fix the problem for me. For the example above Apache would\ntry to process the header line \"Status: 200 OK\\r\\nD\", and points out that \"D\" is\nnot a valid header.", "id": 60860, "time": "2004-07-20T11:45:07Z", "creator": "jt@mousehut.com", "creation_time": "2004-07-20T11:45:07Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 30033, "text": "I don't think this is actually the problem. \n\nI use WriteClient to dump out a complete HTTP response which includes header \nand body in the first chunk that gets passed to WriteClient. The header might \nlook like this:\n\n<pre>\nHTTP/1.1 200 OK\nContent-type: text/html; charset=utf-8\nContent-Length: 3042\n\n... some HTML text goes here.\n</pre>\n\nThis works perfect with IIS, but not with Apache. I get the same 87 error as \nmentioned above. There's definitely more going on here than just an extra \ncharacter in the header block...", "id": 68734, "time": "2004-12-20T15:08:13Z", "creator": "rstrahl@west-wind.com", "creation_time": "2004-12-20T15:08:13Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 30033, "text": "Created attachment 18374\nPatch to not clobber the ISAPI's response code.\n\nI've attached a patch to 2.2.2's mod_isapi.c which should correct this\nbehavior. I've run it against a suite of ISAPI extensions, all of which give\ntheir correct responses as far as I can tell.\n\nWhat seems to be the issue is that ap_scan_script_header_err_strs likes to\nreturn 0 (or some other value which is not the HTTP status). The current\nmod_isapi sticks this result in as the HTTP status. Needless to say, this is\nquite unexpected. Since mod_isapi's send_response_header already gets the\ncorrect value, there's no reason that I can see to second-guess it.\n\nIf someone can review this trivial patch for sanity, I'd appreciate it. I can't\nfind any breakage, but I assume that someone did that for a reason.", "id": 89606, "time": "2006-05-31T05:55:27Z", "creator": "matt@iamcode.net", "creation_time": "2006-05-31T05:55:27Z", "is_private": false, "attachment_id": 18374}, {"count": 6, "tags": [], "creator": "matt@iamcode.net", "text": "Created attachment 18375\nMore correct patch, cribbed from mod_cgi\n\nOn the advice of wrowe, I've attached a more correct patch which cribs from\nmod_cgi. As a rule, we probably don't want to use the return from\nap_scan_script_header_err_strs. But if it's non-zero, we should.\n\nThe last patch neglected a case, as well. This one should catch everything.\n\nAgain, I ran it through its paces and was able to get a variety of responses.", "id": 89609, "time": "2006-05-31T08:39:56Z", "bug_id": 30033, "creation_time": "2006-05-31T08:39:56Z", "is_private": false, "attachment_id": 18375}, {"count": 7, "tags": [], "bug_id": 30033, "text": "See bug 16637 for an interrelated issue.", "id": 89637, "attachment_id": null, "creator": "wrowe@apache.org", "creation_time": "2006-06-01T06:12:18Z", "time": "2006-06-01T06:12:18Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 30033, "is_private": false, "text": "Created attachment 18392\nComplete logic overhaul for send_response_header\n\nThis updated patch completely replaces the HTTP response status logic in\nsend_response_header. It likely should correct the issue mentioned in bug 16637\nas well.", "id": 89677, "time": "2006-06-02T03:59:54Z", "creator": "matt@iamcode.net", "creation_time": "2006-06-02T03:59:54Z", "attachment_id": 18392}, {"count": 9, "tags": [], "creator": "wrowe@apache.org", "attachment_id": null, "is_private": false, "id": 90467, "time": "2006-06-22T06:43:22Z", "bug_id": 30033, "creation_time": "2006-06-22T06:43:22Z", "text": "\n  This looks great.  Please review trunk, I've refactored this a bit to make\n  the interrelations between r->status and dwStatus a bit clearer.\n"}, {"count": 10, "tags": [], "creator": "wrowe@apache.org", "text": "\n  I hate when I can't track this stuff down.  The commit to trunk which is\n  expected to resolve this is 416272", "id": 90470, "time": "2006-06-22T07:03:15Z", "bug_id": 30033, "creation_time": "2006-06-22T07:03:15Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 30033, "text": "Will Rowe has posted a zipfile containing compiled mod_isapi modules which\ninclude the patch correcting this bug (for use with 2.0.58 and 2.2.2), for\ntesting purposes. It is available at:\n\nhttp://people.apache.org/~wrowe/mod_isapi-416293.zip\n\nYou may read his full email to the dev@httpd.apache.org list here:\n\nhttp://marc.theaimsgroup.com/?l=apache-httpd-dev&m=115206683718140&w=2\n\nIf you test this version of mod_isapi, please post your feedback to the\ndev@httpd.apache.org list. Your feedback will help ensure that there are no\nregressions or other issues in this version of mod_isapi.", "id": 90895, "time": "2006-07-05T13:11:27Z", "creator": "matt@iamcode.net", "creation_time": "2006-07-05T13:11:27Z", "is_private": false, "attachment_id": null}]
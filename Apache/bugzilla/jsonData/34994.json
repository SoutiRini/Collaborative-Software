[{"count": 0, "tags": [], "text": "This patch allows for basic WebDAV functionality.  Using DreamWeaver you can\ncheckout, edit/checkin documents to the authoring area.  XP web folders don't\nappear to have lock functionality, but I was able to list, get, and put\ndocuments with a network web folder (easy enough to force checkout on get, put\nalready forces a checkin).  This patch requires apache xmlsec jar for decoding\nof auth basic userid/password (Auth header).\n\nI hope to have schema validation, document creation, copy|paste|move, and if\npossible publishing to live area worked out next.", "attachment_id": null, "bug_id": 34994, "id": 75156, "time": "2005-05-20T23:05:47Z", "creator": "dhc4z@virginia.edu", "creation_time": "2005-05-20T23:05:47Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 15096\npatches/new files for WebDAV interface", "attachment_id": 15096, "bug_id": 34994, "id": 75157, "time": "2005-05-20T23:07:22Z", "creator": "dhc4z@virginia.edu", "creation_time": "2005-05-20T23:07:22Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 34994, "text": "***Word of warning***\nWebDAV client must announce itself with a USER_AGENT header that contains \"DAV\"", "id": 75158, "time": "2005-05-20T23:11:13Z", "creator": "dhc4z@virginia.edu", "creation_time": "2005-05-20T23:11:13Z", "tags": [], "is_private": false}, {"count": 3, "text": "Opps, one more thing that I forgot to mention.  You need to rebuild cocoon with\nwebdav block (and all dependant blocks).\n\nTo use dreamweaver use:\nserver: http://yourhost:8888/default\nuserid: yourid\npass: yourpass\nemail: yourid", "bug_id": 34994, "attachment_id": null, "id": 75160, "time": "2005-05-21T00:26:04Z", "creator": "dhc4z@virginia.edu", "creation_time": "2005-05-21T00:26:04Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "gregor@apache.org", "text": "i took a look at your patch, very nice work!\n\nthere are a couple issues with it:\n\n* it uses the authenticator action which does no longer exist:\n\n+<map:match pattern=\"**\">\n+  <map:match type=\"agent-match\" pattern=\"*DAV*\">\n+    <map:act type=\"authenticator\">\n+      <map:act type=\"authorizer\">\n+        <map:mount uri-prefix=\"\" src=\"global-sitemap.xmap\" check-reload=\"true\"\nreload-method=\"synchron\"/> \n+      </map:act>\n+      <map:act type=\"set-header\">\n+        <map:parameter name=\"WWW-Authenticate\" value=\"Basic Realm=lenya\" />\n+        <map:generate type=\"html\" src=\"401error.html\"/>\n+        <map:serialize type=\"xhtml\" status-code=\"401\"/>\n+      </map:act>\n+    </map:act>\n+    <map:act type=\"set-header\">\n+      <map:parameter name=\"WWW-Authenticate\" value=\"Basic Realm=lenya\" />\n+      <map:generate type=\"html\" src=\"401error.html\"/>\n+      <map:serialize type=\"xhtml\" status-code=\"401\"/>\n+    </map:act>\n+  </map:match>\n+</map:match>\n\nan alternative will have to be found. the same can be said for the dicover\ncheckout action: actions are deprecated and should not be used for new development.\n\ni also rewrote your patch to be more self-contained (putting all files under\ndavmap into default/lenya/usecases/webdav/) and also renaming\ndavmap/sitemap.xmap to webdav.xmap\n\nthe dependency chain for required cocoon blocks is:\n\nwebdav -> repository -> eventcache -> jms\n\nalso, it was a lot of work to integrate. please provide a unified diff in the\nfuture. you can do this by right-clicking in eclipse and team-> create patch.\n\nthis is definitely something we want asap, i hope the devs chime in with\nimprovements. i have attached a unified diff with my changes.", "id": 75487, "time": "2005-05-27T06:05:20Z", "bug_id": 34994, "creation_time": "2005-05-27T06:05:20Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 34994, "text": "Created attachment 15182\nAdds webdav support (not yet working)", "id": 75488, "time": "2005-05-27T06:06:35Z", "creator": "gregor@apache.org", "creation_time": "2005-05-27T06:06:35Z", "is_private": false, "attachment_id": 15182}, {"count": 6, "tags": [], "creator": "dhc4z@virginia.edu", "text": "Thanks Gregor, it was exciting to see dreamweaver checkin an edit! :)\nI will apply your patch and take a look.  I was just going to post the question\nabout the use of actions (one of which doesn't exist in 1.4) but you beat me to it.\n\nOne thing to note is that the webDAV clients that I tried didn't care for\nredirects, and didn't seem to care for GET parameters.  This seemed to throw a\nwrench into the current usecase model, well perhaps not, no steps are needed.\n\nSorry about the patch, I posted before I installed eclipse.  ", "id": 75489, "time": "2005-05-27T06:22:45Z", "bug_id": 34994, "creation_time": "2005-05-27T06:22:45Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "gregor@apache.org", "attachment_id": null, "id": 75490, "time": "2005-05-27T06:26:58Z", "bug_id": 34994, "creation_time": "2005-05-27T06:26:58Z", "is_private": false, "text": "(In reply to comment #6)\n> Thanks Gregor, it was exciting to see dreamweaver checkin an edit! :)\n\nno doubt, this has been a loooong time coming.\n\n> I will apply your patch and take a look.  I was just going to post the question\n> about the use of actions (one of which doesn't exist in 1.4) but you beat me\nto it.\n\nnote that i didnt run it :) so i do not expect it to run, but you should get the\nidea. i wanted to keep the new files together\n\n> One thing to note is that the webDAV clients that I tried didn't care for\n> redirects, and didn't seem to care for GET parameters.  This seemed to throw a\n> wrench into the current usecase model, well perhaps not, no steps are needed.\n\nright, since HTTP verbs like PROPFIND substitute for it\n\n> Sorry about the patch, I posted before I installed eclipse.  \n\nno problem"}, {"count": 8, "text": "Created attachment 15269\nworking version of Gregor's cleanup\n\nI had to add authenticator action to 1.4 to get it to work.  Use of this action\nin 1.4 needs to be hashed out on the dev mailing list since the action has been\nretired in favor of the usecase.\n\nWebdav clients don't like redirects, so usecase solution might be tricky. \nGregor suggested looking at servlet filters to handle authentication and\nauthorization.", "bug_id": 34994, "is_private": false, "id": 75815, "time": "2005-06-02T19:45:19Z", "creator": "dhc4z@virginia.edu", "creation_time": "2005-06-02T19:45:19Z", "tags": [], "attachment_id": 15269}, {"count": 9, "attachment_id": null, "bug_id": 34994, "is_private": false, "id": 75928, "time": "2005-06-03T03:49:43Z", "creator": "gregor@apache.org", "creation_time": "2005-06-03T03:49:43Z", "tags": [], "text": "are you sure your version works?\n\nthis part in global-sitemap.xmap looks problematic:\n\n    <map:pipeline>\n      <map:match pattern=\"\">\n        <map:generate type=\"html\"\nsrc=\"fallback://lenya/usecases/webdav/401error.html\"/>\n        <map:serialize type=\"xhtml\" status-code=\"401\"/>\n      </map:match>\n\n\nfirst, this would give everyone hitting http://localhost:8888 a 401 error page,\nno? second, it tries to resolve the fallback, but since 401error is not in the\ncore, and no publication chosen, it fails.\n\ni also got rid of the additional cocoon blocks, they do not seem to be needed.\n\nfinally, i tried to login with multiple clients, and always got a 401\n\ncan you provide some more information?"}, {"count": 10, "text": "Created attachment 15358\nBasic webDAV interface\n\nDid away with the use of cocoon repo block (and dependants)\nUsing lenya usecases, but calling them differently (no redirect or GET param)\nThis patch adds DelegatingAuthenticatorAction\nDiscoverCheckoutAction should be removed in the near future, and functionality\nshould be added to webdav usecases\nput usecase needs to validate (should just be a matter of looking at oneform\nusecase)\nI didn't test this with pub templating (yet), so it most likely don't work ;) \nI only tested this on my PC, don't know if that makes a diff\nI made this for the default pub, and it doesn't take into account other doc\ntypes.\n\nYou should be able to open the default publication in a webDAV client that has\nDAV in it's useragent header value.  PROPFIND, LOCK, GET, OPTIONS, HEAD, PUT,\nDELETE should return something that a webDAV client MIGHT recognize ;). DELETE\nreturns the same error that it does when I try it from the regular web\ninterface, so it might work when the problem is fixed.\n\nHere are steps to follow to look at the Default pub with an XP web folder:\n-Go to \"My Network Places\"\n-click on \"Add a network place\"\n-click next on the wizard dialog\n-click next with \"Choose another network location...\" selected\n-enter \"http://localhost:8888/default/\" into the Internet or network address\ninput\n-enter user name \"lenya\" and password \"levi\" and click ok button\n-name your folder something creative like \"default on localhost\" and click next\n\n-You should get \"You have successfully created this network place\" message,\nclick on finish\n-I was able to open documents with openoffice, but for some reason or another\ncould not open the web folder to save the doc back to lenya.\n-To save my changes, I saved my doc to a folder, and then draged and dropped,\nnot ideal, but a start ;)\n\n\nI will post an image of the DreamWeaver MX configuration that I used to test.\n\n--Doug", "bug_id": 34994, "attachment_id": 15358, "id": 76237, "time": "2005-06-09T23:23:01Z", "creator": "dhc4z@virginia.edu", "creation_time": "2005-06-09T23:23:01Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "creator": "dhc4z@virginia.edu", "text": "Created attachment 15359\ndreamweaver webdav", "id": 76238, "time": "2005-06-09T23:24:11Z", "bug_id": 34994, "creation_time": "2005-06-09T23:24:11Z", "is_private": false, "attachment_id": 15359}, {"count": 12, "tags": [], "text": "applied, thanks", "attachment_id": null, "id": 76251, "creation_time": "2005-06-10T02:37:47Z", "time": "2005-06-10T02:37:47Z", "creator": "gregor@apache.org", "bug_id": 34994, "is_private": false}, {"count": 13, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "id": 96230, "time": "2006-11-27T13:56:32Z", "bug_id": 34994, "creation_time": "2006-11-27T13:56:32Z", "is_private": false, "text": "Is this bug still valid?"}, {"count": 14, "tags": [], "bug_id": 34994, "text": "Nope, this patch was applied.  I don't know if webdav is currently working\nthough, I will test and open new bugs if it is broken.\n\n", "id": 96235, "attachment_id": null, "creator": "dhc4z@virginia.edu", "creation_time": "2006-11-27T14:09:04Z", "time": "2006-11-27T14:09:04Z", "is_private": false}, {"count": 15, "attachment_id": null, "creator": "dagss@student.matnat.uio.no", "text": "Checked out trunk, did a build, deployed it in Tomcat and WebDAV is not working.\n\nCadaver:\ndav:!> open localhost:3000/lenya/default/webdav\n\nimmedeatly returns with 500 error, caused by an exception around line 103 in\nDocumentPolicyManagerWrapper:\n\nString authoringUrl = prefix + Publication.AUTHORING_AREA\n                        + webappUrl.substring(prefixWithArea.length());\n\n...with prefixWithArea==\"default/authoring\" and webappUrl=\"/default/webdav/\".\n\nTemporarily hacking it:\n            try {\n                authoringUrl = prefix + Publication.AUTHORING_AREA\n                        + webappUrl.substring(prefixWithArea.length());\n            } catch (Exception e) {\n                authoringUrl = prefix + Publication.AUTHORING_AREA;\n            }\n\n...causes login in Cadaver to work fine, and apparently control now enter the\nWebDAV module and some flowscript errors (but that might be my hack so...)", "id": 97093, "time": "2006-12-19T13:26:44Z", "bug_id": 34994, "creation_time": "2006-12-19T13:26:44Z", "tags": [], "is_private": false}, {"count": 16, "tags": [], "bug_id": 34994, "attachment_id": null, "text": "What's the state of this issue?", "id": 102489, "time": "2007-04-26T07:58:32Z", "creator": "andreas@apache.org", "creation_time": "2007-04-26T07:58:32Z", "is_private": false}, {"count": 17, "tags": [], "bug_id": 34994, "attachment_id": 20199, "id": 103214, "time": "2007-05-15T00:57:11Z", "creator": "thorsten@apache.org", "creation_time": "2007-05-15T00:57:11Z", "is_private": false, "text": "Created attachment 20199\ntcp dumb\n\ncadaver http://localhost:8888/default/webdav\nCould not open collection:\n500 Internal Server Error\n\nSeems the same as described by Dag."}, {"count": 18, "tags": [], "bug_id": 34994, "attachment_id": null, "text": "As I understand it the patches are applied to 1.4. \n\nFurther the stacktrace fuels the assumption that the ac refactoring messed with\nthe dav support.\n\"org.apache.lenya.ac.AccessControlException:\njava.lang.StringIndexOutOfBoundsException: String index out of range: -2\n\tat\norg.apache.lenya.cms.ac.DocumentPolicyManagerWrapper.getPolicyURL(DocumentPolicyManagerWrapper.java:121)\n\tat\norg.apache.lenya.cms.ac.DocumentPolicyManagerWrapper.getGrantedRoles(DocumentPolicyManagerWrapper.java:320)\n\tat\norg.apache.lenya.ac.impl.PolicyAuthorizer.authorizePolicy(PolicyAuthorizer.java:107)\n\tat org.apache.lenya.ac.impl.PolicyAuthorizer.authorize(PolicyAuthorizer.java:137)\"", "id": 103215, "time": "2007-05-15T01:00:22Z", "creator": "thorsten@apache.org", "creation_time": "2007-05-15T01:00:22Z", "is_private": false}, {"count": 19, "tags": [], "creator": "thorsten@apache.org", "text": "Created attachment 20206\nfixing the first bug\n\nsrc/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java\n\n===================================================================\n---\nsrc/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java\n     (revision 537897)\n+++\nsrc/modules-core/ac/java/src/org/apache/lenya/cms/ac/DocumentPolicyManagerWrapper.java\n     (working copy)\n@@ -104,7 +104,7 @@\n\t     String prefixWithArea = prefix + ((area != null) ? area : \"\");\n\t     // String prefixWithArea = prefix + area;\n\t     String authoringUrl = prefix + Publication.AUTHORING_AREA\n-\t\t     + webappUrl.substring(prefixWithArea.length());\n+\t\t     +\n((webappUrl.length()>prefixWithArea.length())?webappUrl.substring(prefixWithArea.length()):\"/\");\n\n \n\t     if (map.isDocument(authoringUrl)) {\n\t\t Document authoringDoc = map.getFromURL(authoringUrl);\n\nThis patch brings back the auth dialog but now it fails to find the flow.", "id": 103264, "time": "2007-05-16T08:05:05Z", "bug_id": 34994, "creation_time": "2007-05-16T08:05:05Z", "is_private": false, "attachment_id": 20206}, {"count": 20, "text": "Renaming Lenya 1.4 to 2.0", "bug_id": 34994, "attachment_id": null, "id": 105552, "time": "2007-07-16T01:59:14Z", "creator": "thorsten@apache.org", "creation_time": "2007-07-16T01:59:14Z", "tags": [], "is_private": false}]
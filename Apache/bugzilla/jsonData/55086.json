[{"count": 0, "attachment_id": null, "bug_id": 55086, "text": "This took a bit of trial and error to prove to myself that I \nwas seeing something consistent. \n\nA little introduction to the situation : \n\ncore# uname -a \nSunOS trend-core 5.10 Generic_148888-01 sun4v sparc SUNW,T5240\ncore# cat /etc/release\n                   Oracle Solaris 10 8/11 s10s_u10wos_17b SPARC\n  Copyright (c) 1983, 2011, Oracle and/or its affiliates. All rights reserved.\n                            Assembled 23 August 2011\n\ncore# pwd\n/usr/local/www/conf\ncore# ls -lap httpd.conf \n-rw-r--r--   1 webservd webservd   26352 Jun  7 01:33 httpd.conf\n\nIn that httpd.conf file I have the following : \n\n# Deny access to the entirety of your server's filesystem. You must\n# explicitly permit access to web content directories in other\n# <Directory> blocks below.\n<Directory />\n    Options -Indexes\n\n    AllowOverride None\n    AllowOverrideList None\n    Require group appuser\n    AuthType Basic\n    AuthName \"core.myservername.com\"\n    AuthBasicProvider file\n    AuthUserFile /usr/local/www/conf/.htpasswd\n    AuthGroupFile /usr/local/www/conf/.htgroup\n</Directory>\n\nn.b.: I edited the \"AuthName\" data for this bug entry.\n\nI create a new user in the /usr/local/www/conf/.htpasswd file with \nthe /usr/local/bin/htpasswd tool thus : \n\ncore# /usr/local/bin/htpasswd /usr/local/www/conf/.htpasswd testuser    \nNew password: \nRe-type new password: \nAdding password for user testuser\n\nThe password that I enter is f00bar where those are zero digits.\n\nThe entry in the .htpasswd file looks like so : \n\ncore# grep testuser /usr/local/www/conf/.htpasswd\ntestuser:$apr1$MyCZUISh$eX1KOdAVm7GivR8raWNy7/\n\nI edit .htgroup to ensure that \"testuser\" is in the \"appuser\" group thus :\n\ncore# grep \"testuser\" .htgroup\nappuser: dclarke testuser\n\nI even verify that there are no special characters in there or utf8 \nand I do this because that user simply won't be allowed to auth : \n\ncore# grep \"testuser\" .htgroup | od -Ax -t x1 \n0000000 61 70 70 75 73 65 72 3a 20 64 63 6c 61 72 6b 65\n0000010 20 74 65 73 74 75 73 65 72 0a\n\nThis looks correct to me. \n\nI then try to login to the Apache server as the user \"testuser\" with\nthe password \"f00bar\" and get a 401 Unauthorized error. I test with\nboth FireFox and Opera browsers.  I am able to login as myself with\nusername \"dclarke\" just fine. \n\nHere is what I see in the ssl_error_log : \n\n/usr/local/www/var/logs/ssl_error_log:[Sun Jun 09 17:09:16.964401 2013] [auth_basic:error] [pid 11193:tid 22] [client xxx.xxx.xxx.xxx:47811] AH01617: user testuser: authentication failure for \"/cgi-bin/debug_cgi\": Password Mismatch\n\n\nI then try this, which should not be needed, however I try it : \n\ncore# /usr/local/bin/apachectl graceful\n\nThis results in no change. \n\nI then try, out of sheer luck and frustration, this approach to using \nthe htpasswd tool : \n\ncore# /usr/local/bin/htpasswd -b /usr/local/www/conf/.htpasswd testuser f00bar\nUpdating password for user testuser\ncore# grep testuser /usr/local/www/conf/.htpasswd\ntestuser:$apr1$m6npkQv2$.P32kKq3k2stMX4u5eLhF.\n\n\nI am now able to login/auth as the user \"testuser\" just fine. \n\nI ran into this because users I was trying to add to the .htpasswd\nfile simply could not login and it was out of sheer luck that I \ntried the \"-b\" option and saw that it works.  Not sure why. \n\nI could try to single step into the htpasswd process if needed as\nI compiled everything with Oracle Studio 12.3 and with -g and full\ndebug symbols. \n\nOne other item to point out, if I do this, I get the ability to auth\nas the testuser just fine : \n\ncore# grep -v \"testuser\" .htpasswd > foo ; mv foo .htpasswd\ncore# /usr/local/bin/htpasswd -b /usr/local/www/conf/.htpasswd testuser f00bar\nAdding password for user testuser\n\nFeels like, and this is just a WAG ( Wild A++ Guess ) that the input\nof the password read from stdin is not at all a match with the argv[4]\nparameter provided on the command line above. Would love to insert a\nprintf ( foo ); into htpasswd at the correct place to verify that WAG.\n\nThe following info may also be helpful : \n\ncore# /usr/local/bin/httpd -V\nServer version: Apache/2.4.4 (Unix)\nServer built:   Feb 28 2013 10:46:58\nServer's Module Magic Number: 20120211:11\nServer loaded:  APR 1.4.6, APR-UTIL 1.5.1\nCompiled using: APR 1.4.6, APR-UTIL 1.5.1\nArchitecture:   64-bit\nServer MPM:     event\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_USE_PROC_PTHREAD_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=256\n -D HTTPD_ROOT=\"/usr/local\"\n -D SUEXEC_BIN=\"/usr/local/bin/suexec\"\n -D DEFAULT_PIDLOG=\"www/var/logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"www/conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"www/conf/httpd.conf\"\n\ncore# grep \"^LoadModule\" httpd.conf \nLoadModule authn_file_module modules/mod_authn_file.so\nLoadModule authn_anon_module modules/mod_authn_anon.so\nLoadModule authn_core_module modules/mod_authn_core.so\nLoadModule authz_host_module modules/mod_authz_host.so\nLoadModule authz_groupfile_module modules/mod_authz_groupfile.so\nLoadModule authz_user_module modules/mod_authz_user.so\nLoadModule authz_core_module modules/mod_authz_core.so\nLoadModule access_compat_module modules/mod_access_compat.so\nLoadModule auth_basic_module modules/mod_auth_basic.so\nLoadModule auth_digest_module modules/mod_auth_digest.so\nLoadModule file_cache_module modules/mod_file_cache.so\nLoadModule cache_module modules/mod_cache.so\nLoadModule socache_shmcb_module modules/mod_socache_shmcb.so\nLoadModule reqtimeout_module modules/mod_reqtimeout.so\nLoadModule ext_filter_module modules/mod_ext_filter.so\nLoadModule include_module modules/mod_include.so\nLoadModule filter_module modules/mod_filter.so\nLoadModule deflate_module modules/mod_deflate.so\nLoadModule mime_module modules/mod_mime.so\nLoadModule log_config_module modules/mod_log_config.so\nLoadModule logio_module modules/mod_logio.so\nLoadModule env_module modules/mod_env.so\nLoadModule expires_module modules/mod_expires.so\nLoadModule headers_module modules/mod_headers.so\nLoadModule usertrack_module modules/mod_usertrack.so\nLoadModule unique_id_module modules/mod_unique_id.so\nLoadModule setenvif_module modules/mod_setenvif.so\nLoadModule version_module modules/mod_version.so\nLoadModule proxy_module modules/mod_proxy.so\nLoadModule proxy_connect_module modules/mod_proxy_connect.so\nLoadModule proxy_ftp_module modules/mod_proxy_ftp.so\nLoadModule proxy_http_module modules/mod_proxy_http.so\nLoadModule unixd_module modules/mod_unixd.so\nLoadModule dav_module modules/mod_dav.so\nLoadModule status_module modules/mod_status.so\nLoadModule autoindex_module modules/mod_autoindex.so\nLoadModule info_module modules/mod_info.so\nLoadModule suexec_module modules/mod_suexec.so\nLoadModule cgid_module modules/mod_cgid.so\nLoadModule dav_fs_module modules/mod_dav_fs.so\nLoadModule vhost_alias_module modules/mod_vhost_alias.so\nLoadModule negotiation_module modules/mod_negotiation.so\nLoadModule dir_module modules/mod_dir.so\nLoadModule actions_module modules/mod_actions.so\nLoadModule speling_module modules/mod_speling.so\nLoadModule userdir_module modules/mod_userdir.so\nLoadModule alias_module modules/mod_alias.so\nLoadModule rewrite_module modules/mod_rewrite.so\nLoadModule php5_module modules/libphp5.so\nLoadModule ssl_module modules/mod_ssl.so\n\nThe cgi binary that I hit as the user \"testuser\" gives me a pile of \ncgi environment variables, these may not be of use but they prove \nthat I am authenticating as the correct user with basic auth : \n\nOutput to browser Opera from debug_cgi : \n cgiAUTH_TYPE: Basic\n cgiCONTEXT_DOCUMENT_ROOT: /usr/local/www/data/cgi-bin/\n cgiCONTEXT_PREFIX: /cgi-bin/\n cgiDOCUMENT_ROOT: /usr/local/www/data/htdocs\n cgiGATEWAY_INTERFACE: CGI/1.1\n cgiHTTPS: on\n cgiHTTP_ACCEPT: text/html, application/xml;q=0.9, application/xhtml+xml, image/png, image/webp, image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1\n cgiHTTP_ACCEPT_ENCODING: gzip, deflate\n cgiHTTP_ACCEPT_LANGUAGE: en-CA,en;q=0.9\n cgiHTTP_CACHE_CONTROL: no-cache\n cgiHTTP_CONNECTION: Keep-Alive\n cgiHTTP_DNT: \n cgiHTTP_HOST: core.myservername.com\n cgiHTTP_USER_AGENT: Opera/9.80 (X11; Linux x86_64) Presto/2.12.388 Version/12.15\n cgiLD_LIBRARY_PATH: /usr/local/lib\n cgiPATH: /usr/xpg6/bin:/usr/xpg4/bin:/usr/ccs/bin:/usr/bin:/opt/SUNWspro/bin:/sbin:/bin:/usr/sbin:/usr/openwin/bin:/usr/dt/bin:/usr/X11/bin:/opt/schily/bin\n cgiContentLength: NULL\n cgiQUERY_STRING: \n cgiREMOTE_ADDR: xxx.xxx.xxx.xxx\n cgiREMOTE_PORT: 47915\n cgiREMOTE_USER: testuser\n cgiREQUEST_METHOD: GET\n cgiREQUEST_SCHEME: https\n cgiREQUEST_URI: /cgi-bin/debug_cgi\n cgiSCRIPT_FILENAME: /usr/local/www/data/cgi-bin/debug_cgi\n cgiSCRIPT_NAME: /cgi-bin/debug_cgi\n cgiSERVER_ADDR: yyy.yyy.yyy.yyy\n cgiSERVER_ADMIN: dclarke@blastwave.org\n cgiSERVER_NAME: core.myservername.com\n cgiSERVER_PORT: 443\n cgiSERVER_PROTOCOL: HTTP/1.1\n cgiSERVER_SIGNATURE: <address>Apache/2.4.4 (Unix) OpenSSL/1.0.1e PHP/5.4.15 Server at core.myservername.com Port 443</address>\n cgiSERVER_SOFTWARE: Apache/2.4.4 (Unix) OpenSSL/1.0.1e PHP/5.4.15\n cgiSSL_CIPHER: DHE-RSA-AES256-SHA\n cgiSSL_CIPHER_ALGKEYSIZE: 256\n cgiSSL_CIPHER_EXPORT: false\n cgiSSL_CIPHER_USEKEYSIZE: 256\n cgiSSL_CLIENT_VERIFY: NONE\n cgiSSL_COMPRESS_METHOD: NULL\n cgiSSL_PROTOCOL: TLSv1\n cgiSSL_SECURE_RENEG: true\n cgiSSL_SERVER_A_KEY: rsaEncryption\n cgiSSL_SERVER_A_SIG: sha1WithRSAEncryption\n cgiSSL_SERVER_I_DN: CN=VeriSign Class 3 Extended Validation SSL CA,OU=Terms of use at https://www.verisign.com/rpa (c)06,OU=VeriSign Trust Network,O=VeriSign\\, Inc.,C=US\n cgiSSL_SERVER_I_DN_C: US\n cgiSSL_SERVER_I_DN_CN: VeriSign Class 3 Extended Validation SSL CA\n cgiSSL_SERVER_I_DN_O: VeriSign, Inc.\n cgiSSL_SERVER_I_DN_OU: VeriSign Trust Network\n cgiSSL_SERVER_I_DN_OU_1: Terms of use at https://www.verisign.com/rpa (c)06\n.\n.\n.  etc etc lots of SSL and Verisign info\n.\n.\n cgiSSL_SERVER_V_END: Feb  4 23:59:59 2015 GMT\n cgiSSL_SERVER_V_START: Feb  4 00:00:00 2013 GMT\n cgiSSL_SESSION_ID: EF53580D357C3A6DE71EF97B38530D3A4155D500E0DE171FB2FA5A3A3E62D659\n cgiSSL_SESSION_RESUMED: Initial\n cgiSSL_VERSION_INTERFACE: mod_ssl/2.4.4\n cgiSSL_VERSION_LIBRARY: OpenSSL/1.0.1e\n cgiTZ: GMT0\n cgiUNIQUE_ID: UbS7c0Lhl@IAABLCqEYAAABX\n\n\nIf there is something I can do to track this down or data to provide\nI would be glad to try. \n\nDennis Clarke", "id": 167758, "time": "2013-06-09T17:34:56Z", "creator": "dclarke@blastwave.org", "creation_time": "2013-06-09T17:34:56Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 55086, "text": "\n\n*** This bug has been marked as a duplicate of bug 54735 ***", "id": 167759, "time": "2013-06-09T20:20:41Z", "creator": "sf@sfritsch.de", "creation_time": "2013-06-09T20:20:41Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 55086, "attachment_id": null, "text": "tested and documented on Solaris 10 Niagara servers with Oracle Studio 12.3 tools .. \n\nsee details at bottom of bug54735\n\nDennis", "id": 167770, "time": "2013-06-10T18:43:34Z", "creator": "dclarke@blastwave.org", "creation_time": "2013-06-10T18:43:34Z", "is_private": false}]
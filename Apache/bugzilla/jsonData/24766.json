[{"count": 0, "tags": [], "text": "The method \n\n    generic.Instruction.readInstruction()\n\ncalls \n\n    generic.Instruction.className(short)\n\nwhich uses toUpperCase() in its implementation.  \nThis is brittle; in the Turkish locale, for example\n\n \"I\".toLowerCase() != \"i\" \n \"i\".toUpperCase() != \"I\"\n\nThis was reported to me at the AspectJ project from an actual user who \ngets \n\norg.apache.bcel.generic.ClassGenException: Illegal opcode detected.\n\tat org.apache.bcel.generic.Instruction.readInstruction\n(Instruction.java:189)\n\tat org.apache.bcel.generic.InstructionList.<init>\n(InstructionList.java:193)\n\nwhen using AspectJ (which uses BCEL) under the Turkish locale.  So this\nis a problem that's appearing in the wild *smile*.\n\nI may get around to patching it myself before our next release,\nin which case I'll probably just rip out the Class.forName stuff inside\n\n    Instruction.readInstruction()\n\nwhich is the thing really causing the problem (is that there for expansion,\nin case users define their own bytecodes?  I'm confused as to why there\nisn't just a 256-wide dispatch).", "is_private": false, "bug_id": 24766, "id": 47516, "time": "2003-11-18T05:35:04Z", "creator": "eh-apache@tangygnat.org", "creation_time": "2003-11-18T05:35:04Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 9194\nA test file throwing an exception when the Locale is changed", "is_private": false, "bug_id": 24766, "id": 47652, "time": "2003-11-19T21:14:28Z", "creator": "eh-apache@tangygnat.org", "creation_time": "2003-11-19T21:14:28Z", "attachment_id": 9194}, {"count": 2, "tags": [], "creator": "eh-apache@tangygnat.org", "attachment_id": 10102, "id": 51264, "time": "2004-01-27T20:21:25Z", "bug_id": 24766, "creation_time": "2004-01-27T20:21:25Z", "is_private": false, "text": "Created attachment 10102\nreplace calls to class.forName with a big switch"}, {"count": 3, "tags": [], "creator": "mert.nuhoglu@isnet.net.tr", "attachment_id": null, "id": 56161, "time": "2004-04-21T12:53:47Z", "bug_id": 24766, "creation_time": "2004-04-21T12:53:47Z", "is_private": false, "text": "I had encountered a similar problem with Hsqldb. We resolved the problem very \neasily:\n\nJust replace all occurences of toLowerCase() with toLowerCase(Locale.ENGLISH) \nand toUpperCase() with toUpperCase(Locale.ENGLISH).\n\nThis forces the jre to use English character set. So the program works \ncorrectly even the client has Turkish character set as default regional \nsettings.\n\nMert Nuhoglu\nmert.nuhoglu ( @ ) isnet.net.tr"}, {"count": 4, "tags": [], "bug_id": 24766, "is_private": false, "text": "Just applied the change Mert proposed. Please verify.", "id": 86375, "time": "2006-03-02T04:51:15Z", "creator": "tcurdt@apache.org", "creation_time": "2006-03-02T04:51:15Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "eh-apache@tangygnat.org", "attachment_id": null, "id": 89003, "time": "2006-05-10T15:35:45Z", "bug_id": 24766, "creation_time": "2006-05-10T15:35:45Z", "is_private": false, "text": "Hi Torsten; Just a note that I don't use BCEL anymore in my normal life, so I\nwon't be able to verify your bugfix (in AspectJ we used the \"big switch\"\nsolution, since it was unclear that you were getting anything from the\nreflection apart from overhead).  But verification should be pretty easy: just\nwrite a program that uses the IINC bytecode and compile with Locale.TURKISH."}]
[{"count": 0, "tags": [], "bug_id": 59213, "attachment_id": null, "is_private": false, "id": 189647, "time": "2016-03-22T10:11:02Z", "creator": "niscomar@googlemail.com", "creation_time": "2016-03-22T10:11:02Z", "text": "I ran into this problem while working on the Apache Pluto project, which makes use of async features. I boiled it down to come up with two test servlets that are available here:\n\nhttps://github.com/msnicklous/AsyncDebug\n\nI have reproduced the problem on both Tomcat 8.0.28 and 8.0.32.\n\nProblem description:\n\nGiven Servlet1 and Servlet2 running in separate servlet contexts.\n\nServlet1 contains the following code:\n\n   PrintWriter writer = resp.getWriter(); \n   writer.append(\"<h3>Async Debug1</h3>\"); \n   AsyncContext actx = req.startAsync(req, resp);\n   actx.dispatch(\"/WEB-INF/jsp/debug1.jsp\");\n\nWhen Servlet1 is accessed directly, the header \"Async Debug 1\" along with the\ncontents of debug1.jsp is displayed properly.\n\nServlet2 contains the following code:\n\n   ServletContext ctx1 = req.getServletContext().getContext(\"/AsyncDebug1\");\n   RequestDispatcher rd = ctx1.getRequestDispatcher(\"/Debug\");\n   rd.forward(req, resp);\n\nServlet2 performs a cross-context forward to Servlet1. The Servlet2 web module\ncontains a context.xml file that enables cross-context support.\n\nWhen Servlet2 is accessed, the header \"Async Debug 1\" is displayed, but the\ncontents of debug1.jsp is not displayed. Also, the log contains the following\nmessage:\n\n22-Mar-2016 08:47:58.875 SEVERE [http-apr-8080-exec-2]\norg.apache.jasper.servlet.JspServlet.handleMissingResource File\n[/WEB-INF/jsp/debug1.jsp] not found\n\nI think this is incorrect behavior. Since Servlet1 initializes the AsyncContext,\nthis behavior would seen to contradict the Servlet Specification 3.1, page 15\nwhere the description for the AsyncContext#dispatch(String path) method states:\n\"The given path is interpreted as relative to the ServletContext that\ninitialized the AsyncContext.\". \n\nAdditional info: \n\nby hacking around, I noticed that changing the Servlet1 dispatch call as follows causes the async dispatch to work even when Servlet1 is\naccessed through a cross-context forward:\n\n   actx.dispatch(req.getServletContext(), \"/WEB-INF/jsp/debug1.jsp\");\n   \nwhere 'req' is the HttpServletRequest. \n\nThanks for having a look at this!"}, {"count": 1, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "Ok, the dispatch should use the specified wrapped request. The fix will be in 7.0.69, 8.0.34, 8.5.1, and 9M5.", "id": 189724, "time": "2016-03-25T16:26:09Z", "bug_id": 59213, "creation_time": "2016-03-25T16:26:09Z", "attachment_id": null}]
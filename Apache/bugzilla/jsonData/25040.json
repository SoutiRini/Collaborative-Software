[{"count": 0, "tags": [], "text": "Digest auth doesn't cooperate well with subrequests, because it insists on using\nthe URI from the Auth header instead of the URI in the subrequest.\n\nI may be getting some of the subtleties wrong here; please see this mail from\nJustin Erenkrantz for a better description:\n\nhttp://subversion.tigris.org/servlets/ReadMsg?list=dev&msgNo=50876\n\nIt's part of this thread\n\nhttp://subversion.tigris.org/servlets/BrowseList?list=dev&by=thread&from=135712\n\n...which starts with Ben Collins-Sussman explaining why Subversion's recent\nswitch to using subrequests for authorization broke digest auth, for users who\nhad previously been using it successfully.\n\nOh: and later, in a private email exchange, Sander Striker tentatively confirmed\nBrian Fitzpatrick's outline of a solution:\n\n   B. W. Fitzpatrick wrote:\n   > So basically, mod_auth_digest needs to see if it's in\n   > a subreq, and if it is, then ignore the URI in the\n   > Auth header and use the uri from the subreq itself?\n   >\n   > Is that a correct understanding?\n   \n   That sounds about right.\n   \n   Sander", "attachment_id": null, "bug_id": 25040, "id": 48229, "time": "2003-11-27T03:33:39Z", "creator": "kfogel@collab.net", "creation_time": "2003-11-27T03:33:39Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 25040, "attachment_id": null, "text": "I think Fitz has it reversed.\n\nmod_auth_digest needs to use the uri of r->main, not of the subreq because the hashed nonce will \nbe off of the original request's URI.  Right now, I think it's using the subreq's uri (i.e. r->uri), but \nthat isn't what the user sent.  Hence, it can't compute the 'same' hash.", "id": 48996, "time": "2003-12-12T18:39:48Z", "creator": "jerenkrantz@apache.org", "creation_time": "2003-12-12T18:39:48Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 25040, "attachment_id": null, "text": "Actually, I think it shouldn't be doing anything other than checking if\nthe subreq uri is in the same directory/location block (or, in the\nsame auth domain), and if so, just copy what was done for the main\nrequest.", "id": 48998, "time": "2003-12-12T18:53:16Z", "creator": "striker@apache.org", "creation_time": "2003-12-12T18:53:16Z", "is_private": false}, {"count": 3, "tags": [], "text": "My subversion server already had a modified mod_auth_digest, so I went digging.\nIt looks like the subreq is already using fields of the main request to check the\ndigest, with one exception -- digest_header_rec does not have a method field.\nWhen I get these authentication failures, the subreq method doesn't match the main\nreq's method.  I added that field, set it to r->method in\nparse_hdr_and_update_nc(), and modified old_digest() and new_digest() to use\nresp->method instead of r->method, and that fixed the problem.", "attachment_id": null, "bug_id": 25040, "id": 50541, "time": "2004-01-14T14:18:50Z", "creator": "jpd@indecisive.com", "creation_time": "2004-01-14T14:18:50Z", "is_private": false}, {"count": 4, "tags": [], "creator": "jpd@indecisive.com", "attachment_id": 9946, "text": "Created attachment 9946\nThe changes described above in patch form (and stripped of other local changes)", "id": 50547, "time": "2004-01-14T16:04:24Z", "bug_id": 25040, "creation_time": "2004-01-14T16:04:24Z", "is_private": false}, {"count": 5, "tags": [], "creator": "erik@codefaktor.de", "attachment_id": null, "id": 50761, "time": "2004-01-19T19:06:26Z", "bug_id": 25040, "creation_time": "2004-01-19T19:06:26Z", "is_private": false, "text": "Just adding the PatchAvailable keyword..."}, {"count": 6, "tags": [], "creator": "jerenkrantz@apache.org", "attachment_id": null, "text": "Committed to httpd-2.1 as r1.82 of modules/aaa/mod_auth_digest.c.  Proposed for\nbackport to 2.0.  Will be included in the next release.\n\nThanks!", "id": 51424, "time": "2004-01-29T19:22:46Z", "bug_id": 25040, "creation_time": "2004-01-29T19:22:46Z", "is_private": false}]
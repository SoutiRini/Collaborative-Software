[{"count": 0, "tags": [], "bug_id": 20312, "text": "mod_rewrite, RewriteLock directive in global scope \ndoes not chown lockfile ownership to the User/Group\nset. \n\nThis problem seems similar to what has been resolved before.\n\npermissions on Lockfile:\n\n-rw-------   1 root  wheel       0 May 28 21:55 Hacker.lock\n\nSnippet from config-file\n\nListen 0.0.0.0:80\nServerRoot /usr/local/SGN-Apache\nDocumentRoot /usr/local/SGN-Apache/htdocs\n\nUser  nobody\nGroup nogroup\n\nServerTokens Prod\nServerSignature Off\n\n# We put some local CGI-s here, mainly to kill other users.\nScriptAlias /cgi-bin/ \"/usr/local/SGN-Apache/cgi-bin/\"\n\n# This will collect and aggregate all logs on the main PEN-Server\n#CustomLog \"|/usr/local/bin/penlog 10.240.24.42 10000\" common\nLogFormat \"\\\"%{X-Forwarded-For}i\\\" %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\"\n\\\"%{User-Agent}i\\\"\" clustered\nLogFormat \"\\\"%{X-Forwarded-For}i\\\" %l %u %t \\\"%r\\\" %>s %b\" error-clustered\n\nRewriteLock /usr/local/SGN-Apache/conf/Hacker.lock\n\n\nOutput in log:\n\n[Wed May 28 21:19:23 2003] [crit] (13)Permission denied: mod_rewrite: could not\ninit rewrite_mapr_lock_acquire in child\n[Wed May 28 21:19:23 2003] [crit] (13)Permission denied: mod_rewrite: could not\ninit rewrite_mapr_lock_acquire in child\n[Wed May 28 21:19:23 2003] [crit] (13)Permission denied: mod_rewrite: could not\ninit rewrite_mapr_lock_acquire in child\n[Wed May 28 21:19:23 2003] [crit] (13)Permission denied: mod_rewrite: could not\ninit rewrite_mapr_lock_acquire in child\n[Wed May 28 21:19:23 2003] [crit] (13)Permission denied: mod_rewrite: could not\ninit rewrite_mapr_lock_acquire in child\n\nOS:\n\nFreeBSD obelix.sgn.sca.se 5.0-RELEASE FreeBSD 5.0-RELEASE #0: Thu Apr  3\n19:57:53 CEST 2003    \njoed@obelix.sgn.sca.se:/usr/src/sys/i386/compile/SGN-PEN-APACHE  i386\n\nApache:\nbash-2.05b# /usr/local/SGN-Apache/bin/apachectl -V\nServer version: Apache/2.0.46\nServer built:   May 28 2003 21:26:22\nServer's Module Magic Number: 20020903:3\nArchitecture:   32-bit\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/prefork\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses disabled)\n -D APR_USE_FLOCK_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D HTTPD_ROOT=\"/usr/local/SGN-Apache\"\n -D SUEXEC_BIN=\"/usr/local/SGN-Apache/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_LOCKFILE=\"logs/accept.lock\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\nCompiled in modules\n\nbash-2.05b# /usr/local/SGN-Apache/bin/apachectl -l\nCompiled in modules:\n  core.c\n  mod_access.c\n  mod_auth.c\n  mod_cache.c\n  mod_disk_cache.c\n  mod_include.c\n  mod_log_config.c\n  mod_env.c\n  mod_expires.c\n  mod_headers.c\n  mod_usertrack.c\n  mod_setenvif.c\n  mod_proxy.c\n  proxy_connect.c\n  proxy_ftp.c\n  proxy_http.c\n  prefork.c\n  http_core.c\n  mod_mime.c\n  mod_status.c\n  mod_autoindex.c\n  mod_asis.c\n  mod_cgi.c\n  mod_vhost_alias.c\n  mod_negotiation.c\n  mod_dir.c\n  mod_imap.c\n  mod_actions.c\n  mod_userdir.c\n  mod_alias.c\n  mod_rewrite.c\n  mod_so.c", "id": 37939, "time": "2003-05-28T19:57:21Z", "creator": "johan.edstrom@sca.com", "creation_time": "2003-05-28T19:57:21Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 20312, "attachment_id": null, "text": "I did change priority to high, as this unfortunately\nis a little bit of a showstopper...\n\n", "id": 38292, "time": "2003-06-03T20:33:25Z", "creator": "johan.edstrom@sca.com", "creation_time": "2003-06-03T20:33:25Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 20312, "attachment_id": null, "text": "Hopefully you found a local work-around for the missing chown()?  (hacking\nmod_rewrite.c to add an appropriate chown() call)\n\nAfter digging a while, it is clear that there are some serious problems with the\nrewrite log lock that aren't so easy to fix locally.  These could result in some\nmisformatting of the rewrite log.  Other than the missing chown(), I don't see\nany reliability problems with the more important lock that controls\ncommunication with an external RewriteMap program.\n\nHopefully all of this will be resolved in the next release.\n\nThanks for your report!  \n", "id": 38538, "time": "2003-06-07T10:48:04Z", "creator": "trawick@apache.org", "creation_time": "2003-06-07T10:48:04Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 20312, "attachment_id": null, "text": "A fix was committed to 2.1-dev, and requires recent changes to APR.\n\nHopefully this will be merged into stable soon and be in the next\nApache httpd release.\n\nThanks for your report!\n", "id": 38549, "time": "2003-06-07T20:38:34Z", "creator": "trawick@apache.org", "creation_time": "2003-06-07T20:38:34Z", "is_private": false}]
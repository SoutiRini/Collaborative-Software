[{"count": 0, "tags": [], "bug_id": 44144, "text": "Hi. I've been trying to use the JMS point-to-point sampler to execute a simple\nrequest-response test, but without success. I downloaded the source and debugged\norg.apache.jmeter.protocol.jms.sampler.FixedQueueExecutor and\norg.apache.jmeter.protocol.jms.sampler.Receiver. The problem appears to be that\nwhen the message is published by the FixedQueueExecutor, it is keyed in the\nMessageAdmin object with its JMSMessageID (see\nFixedQueueExecutor.sendAndReceive(Message request) at line 65/66), but when the\nReceiver consumers the reply, it looks in MessageAdmin keyed  on\nJMSCorrelationID (see Receiver.run() at line 78).  It never ties the request and\nresponse together and the test will only ever report failures.", "id": 112231, "time": "2007-12-27T03:47:13Z", "creator": "pwoolley@ndsuk.com", "creation_time": "2007-12-27T03:47:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 44144, "attachment_id": 21322, "text": "Created attachment 21322\nProposed fix\n\nHave attached a proposed fix for this bug.", "id": 112232, "time": "2007-12-27T03:55:59Z", "creator": "pwoolley@ndsuk.com", "creation_time": "2007-12-27T03:55:59Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 44144, "attachment_id": null, "text": "Actually, after a bit more investigation, I think keying on JMSCorrelationID\nwould be a better idea for the FixedQueueExecutor and the Receiver.\n\nAlthough, in principle, keying on JMSMessageID should be ok, I've been running\nsome tests with ActiveMQ 4.1.1 and I can see that whenever ActiveMQ sends a\nmessage, it sets a new JMSMessageID, even if you've written a\nMessagePostProcessor to reset/preserve the message id.\n\nThe situation I am seeing fail is:\na) JMeter sends a message to queue A with message id 1\nb) My code reads message id 1 from queue A, does some processing and compiles a\nbrand new message.\nc) My code puts the new message on queue B, and a MessagePostProcessor attempts\nto set the JMSMessageID to 1.\nd) ActiveMQ goes ahead and assigns a new message id just before sending.\ne) JMeter reads from queue B. Its expects message id 1, but thanks to ActiveMQ,\nit finds message id ?. Failure!\n\nA quick retry with a recompiled FixedQueueExecutor and Receiver that key on\nJMSCorrelationID succeeds if I re-run the above test.  This makes more sense as\nsection 3.4.5 of the JMS 1.1 spec states: \"A client can use the JMSCorrelationID\nheader field to link one message with another. A typical use is to link a\nresponse message with its request message.\"\n\nWith this in mind, I think the proposed fix should be to change\norg.apache.jmeter.protocol.jms.sampler.FixedQueueExecutor to key the sent\nmessage in to the MessageAdmin object using JMSCorrelationID.", "id": 112235, "time": "2007-12-27T06:41:03Z", "creator": "pwoolley@ndsuk.com", "creation_time": "2007-12-27T06:41:03Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 44144, "attachment_id": 21323, "text": "Created attachment 21323\nProposed fix\n\nProposed fix", "id": 112236, "time": "2007-12-27T06:43:51Z", "creator": "pwoolley@ndsuk.com", "creation_time": "2007-12-27T06:43:51Z", "is_private": false}, {"count": 4, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "id": 112702, "time": "2008-01-09T09:41:31Z", "bug_id": 44144, "creation_time": "2008-01-09T09:41:31Z", "is_private": false, "text": "Thanks for the patch; applied in SVN r610480.\n\nIn future, please provide patches in unified diff format, rather than entire \nsource files, as that makes the patches easier to review."}]
[{"count": 0, "attachment_id": null, "bug_id": 44731, "is_private": false, "id": 115202, "time": "2008-04-01T13:07:00Z", "creator": "archie@dellroad.org", "creation_time": "2008-04-01T13:07:00Z", "tags": [], "text": "Creating and executing the following file causes ant to throw an exception:\n\n$ cat > bug2.xml\n<project name=\"bug\" default=\"bug\">\n    <target name=\"bug\">\n        <delete dir=\"src\"/>\n        <delete dir=\"dst\"/>\n        <mkdir dir=\"src\"/>\n        <touch file=\"src/foobar-1.2.3.jar\"/>\n        <touch file=\"src/foobar-janfu-1.2.3.jar\"/>\n        <mkdir dir=\"dst\"/>\n        <move todir=\"dst\">\n            <fileset dir=\"src\">\n                <include name=\"**/*.jar\"/>\n            </fileset>\n            <mapper type=\"glob\" from=\"foobar-*-1.2.3.jar\" to=\"*.jar\"/>\n        </move>\n    </target>\n</project>\n$ ant -v -f bug2.xml\nApache Ant version 1.7.0 compiled on September 22 2007\nBuildfile: bug2.xml\nDetected Java version: 1.5 in: /usr/lib/jvm/java-1.5.0-sun-1.5.0_13-sr2/jre\nDetected OS: Linux\nparsing buildfile /home/archie/home.svn/hogwash/oss/jetty/6.1.9/bug2.xml with URI = file:/home/archie/home.svn/hogwash/oss/jetty/6.1.9/bug2.xml\nProject base dir set to: /home/archie/home.svn/hogwash/oss/jetty/6.1.9\nBuild sequence for target(s) `bug' is [bug]\nComplete build sequence is [bug, ]\n\nbug:\n[antlib:org.apache.tools.ant] Could not load definitions from resource org/apache/tools/ant/antlib.xml. It could not be found.\n   [delete] Deleting directory /home/archie/home.svn/hogwash/oss/jetty/6.1.9/src\n   [delete] Deleting /home/archie/home.svn/hogwash/oss/jetty/6.1.9/src/foobar-janfu-1.2.3.jar\n   [delete] Deleting /home/archie/home.svn/hogwash/oss/jetty/6.1.9/src/foobar-1.2.3.jar\n   [delete] Deleting directory /home/archie/home.svn/hogwash/oss/jetty/6.1.9/src\n   [delete] Deleting directory /home/archie/home.svn/hogwash/oss/jetty/6.1.9/dst\n   [delete] Deleting directory /home/archie/home.svn/hogwash/oss/jetty/6.1.9/dst\n    [mkdir] Created dir: /home/archie/home.svn/hogwash/oss/jetty/6.1.9/src\n    [touch] Creating /home/archie/home.svn/hogwash/oss/jetty/6.1.9/src/foobar-1.2.3.jar\n    [touch] Creating /home/archie/home.svn/hogwash/oss/jetty/6.1.9/src/foobar-janfu-1.2.3.jar\n    [mkdir] Created dir: /home/archie/home.svn/hogwash/oss/jetty/6.1.9/dst\n\nBUILD FAILED\n/home/archie/home.svn/hogwash/oss/jetty/6.1.9/bug2.xml:9: java.lang.StringIndexOutOfBoundsException: String index out of range: -1\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:115)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:357)\n        at org.apache.tools.ant.Target.performTasks(Target.java:385)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1298)\n        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1181)\n        at org.apache.tools.ant.Main.runBuild(Main.java:698)\n        at org.apache.tools.ant.Main.startAnt(Main.java:199)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)\nCaused by: java.lang.StringIndexOutOfBoundsException: String index out of range: -1\n        at java.lang.String.substring(String.java:1768)\n        at org.apache.tools.ant.util.GlobPatternMapper.extractVariablePart(GlobPatternMapper.java:150)\n        at org.apache.tools.ant.util.GlobPatternMapper.mapFileName(GlobPatternMapper.java:138)\n        at org.apache.tools.ant.taskdefs.Copy.buildMap(Copy.java:682)\n        at org.apache.tools.ant.taskdefs.Copy.scan(Copy.java:644)\n        at org.apache.tools.ant.taskdefs.Copy.execute(Copy.java:528)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:585)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)\n        ... 11 more\n--- Nested Exception ---\njava.lang.StringIndexOutOfBoundsException: String index out of range: -1\n        at java.lang.String.substring(String.java:1768)\n        at org.apache.tools.ant.util.GlobPatternMapper.extractVariablePart(GlobPatternMapper.java:150)\n        at org.apache.tools.ant.util.GlobPatternMapper.mapFileName(GlobPatternMapper.java:138)\n        at org.apache.tools.ant.taskdefs.Copy.buildMap(Copy.java:682)\n        at org.apache.tools.ant.taskdefs.Copy.scan(Copy.java:644)\n        at org.apache.tools.ant.taskdefs.Copy.execute(Copy.java:528)\n        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:585)\n        at org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:105)\n        at org.apache.tools.ant.Task.perform(Task.java:348)\n        at org.apache.tools.ant.Target.execute(Target.java:357)\n        at org.apache.tools.ant.Target.performTasks(Target.java:385)\n        at org.apache.tools.ant.Project.executeSortedTargets(Project.java:1329)\n        at org.apache.tools.ant.Project.executeTarget(Project.java:1298)\n        at org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\n        at org.apache.tools.ant.Project.executeTargets(Project.java:1181)\n        at org.apache.tools.ant.Main.runBuild(Main.java:698)\n        at org.apache.tools.ant.Main.startAnt(Main.java:199)\n        at org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\n        at org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)\n\nTotal time: 1 second"}, {"count": 1, "tags": [], "text": "Confirmed on trunk and in 1.7.1 beta\n", "is_private": false, "id": 115203, "creator": "peterreilly@apache.org", "time": "2008-04-01T13:32:41Z", "bug_id": 44731, "creation_time": "2008-04-01T13:32:41Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "peterreilly@apache.org", "text": "Thanks for the example/complete build file. This is great for tracking\ndown bugs...!!!\n\nThe problem here is that the src/foobar-1.2.3.jar file\nshould not match the filter - the prefix and postfix overlap,\nresulting in bug.\n\nFixed in trunk.\n", "id": 115267, "time": "2008-04-02T13:39:32Z", "bug_id": 44731, "creation_time": "2008-04-02T13:39:32Z", "is_private": false, "attachment_id": null}]
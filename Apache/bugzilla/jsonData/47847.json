[{"count": 0, "attachment_id": null, "creator": "CHuang3@statestreet.com", "text": "Read the XlS file via HSSFWorkbook and do nothing except write the workbook back, then the file goes unreadable by MS Excel 2003.\n\nThe following is the code:\n\nFileInputStream fis = null;\nHSSFWorkbook wb = null;\ntry{\n\tFile f = new File(\"testUnreadable.xls\");\n\tif (f.exists()){\n\t\tfis = new FileInputStream(f);\n\t\twb = new HSSFWorkbook(fis);\n\t}\n}catch (Throwable th){}\nfinally{\n\tif (fis != null){\n\t\tfis.close();\n\t}\n}\nFileOutputStream stream = null;\ntry{\n\tstream = new FileOutputStream(\"New.xls\");\n\twb.write(stream);\n}catch (Exception e){}\nfinally{\n\tif (stream != null)\n\t{\n\t\tstream.close();\n\t}\n}\n\nwhen opening the generated \"new.xls\" file with MS Excel 2003, the following error message pops up:\n\n\"Excel found unreadable content in \"testUnreadablenew.xls\". Do you want to recover the contents of this workbook?...\"\n\nIs there any work around? Thanks a lot.", "id": 130435, "time": "2009-09-16T00:03:39Z", "bug_id": 47847, "creation_time": "2009-09-16T00:03:39Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 24273\nThe test file\n\nThe file fails to do the read and write.", "attachment_id": 24273, "id": 130436, "creator": "CHuang3@statestreet.com", "time": "2009-09-16T00:06:27Z", "bug_id": 47847, "creation_time": "2009-09-16T00:06:27Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 47847, "text": "Created attachment 24836\npatch to fix bug 47847\n\nThis patch fix the problem for the test file.\nThe problem was coming from a wrong assumption on the ExtRst field.", "id": 133576, "time": "2010-01-13T04:58:10Z", "creator": "pierre.tholence@gmail.com", "creation_time": "2010-01-13T04:58:10Z", "is_private": false, "attachment_id": 24836}, {"count": 3, "tags": [], "creator": "CHuang3@statestreet.com", "text": "Verify the provided patch, the problem has been fixed:-)\n\nThanks a lot.", "id": 133619, "time": "2010-01-14T18:23:01Z", "bug_id": 47847, "creation_time": "2010-01-14T18:23:01Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 47847, "attachment_id": null, "id": 133698, "time": "2010-01-19T04:05:39Z", "creator": "apache@gagravarr.org", "creation_time": "2010-01-19T04:05:39Z", "is_private": false, "text": "I've added support to svn for the ExtRst part of unicode strings. This should hopefully fix the problem, because we now parse the data so can split on more helpful positions."}, {"count": 5, "tags": [], "bug_id": 47847, "text": "Verified on POI version 3.7, the issue still exists.\n\nWill this fix be included in the POI formal release?", "id": 145203, "time": "2011-03-22T21:33:57Z", "creator": "CHuang3@statestreet.com", "creation_time": "2011-03-22T21:33:57Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "creator": "dfisher@jmlafferty.com", "text": "Nick reported the issue as resolved AFTER 3.7 was released.\n\nDoes POI 3.8 beta 1 work? Does trunk work?", "id": 145206, "time": "2011-03-22T22:50:32Z", "bug_id": 47847, "creation_time": "2011-03-22T22:50:32Z", "tags": [], "is_private": false}, {"count": 7, "attachment_id": null, "creator": "dfisher@jmlafferty.com", "text": "Sorry, I saw 2011 and not 2010 in Nick's comments.\n\nIt sure has been awhile. What happens if you do a \"save as\" in Excel with that file?\n\nAlso, what produced your original file?\n\nRegards,\nDave", "id": 145207, "time": "2011-03-22T22:54:47Z", "bug_id": 47847, "creation_time": "2011-03-22T22:54:47Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 47847, "attachment_id": null, "id": 145208, "time": "2011-03-22T23:18:05Z", "creator": "CHuang3@statestreet.com", "creation_time": "2011-03-22T23:18:05Z", "is_private": false, "text": "(In reply to comment #7)\n> Sorry, I saw 2011 and not 2010 in Nick's comments.\n> \n> It sure has been awhile. What happens if you do a \"save as\" in Excel with that\n> file?\n> \n> Also, what produced your original file?\n> \n> Regards,\n> Dave\n\nThe file could be saved successfully. However, trying the above code on the new save file will still generate a corrupted file. \n\nThe file is created manually in MS Excel 2003.\n\nThe patch provided by Nick works fine for POI-3.5, however in POI-3.7, the implementation of the problem class \"UnicodeString\" seems to be totally changed. So I am not sure whether the changes cause the issue again.\n\nThanks."}, {"count": 9, "tags": [], "bug_id": 47847, "attachment_id": null, "text": "I've just tried your code with POI trunk and it works correctly. The output is readable by Excel 2003 and Excel 2010. \n\nYegor", "id": 145215, "time": "2011-03-23T08:42:26Z", "creator": "yegor@dinom.ru", "creation_time": "2011-03-23T08:42:26Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 60985, "attachment_id": 34911, "id": 198282, "time": "2017-04-13T15:28:45Z", "creator": "mr.teterin@gmail.com", "creation_time": "2017-04-13T15:28:45Z", "is_private": false, "text": "Created attachment 34911\nattachment\n\nThe following code throws NPE.\n\nWorkbook workbook = document.getWorkbook();\n        Sheet sheet = workbook.getSheetAt(0);\n        HSSFPrintSetup ps = (HSSFPrintSetup) sheet.getPrintSetup();\n\n        ps.setLandscape(true);"}, {"count": 1, "tags": [], "text": "Could your file have no print settings? Can you try checking for that being null?", "is_private": false, "id": 198285, "creator": "apache@gagravarr.org", "time": "2017-04-13T18:53:45Z", "bug_id": 60985, "creation_time": "2017-04-13T18:53:45Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 60985, "attachment_id": null, "id": 198286, "time": "2017-04-13T19:33:28Z", "creator": "mr.teterin@gmail.com", "creation_time": "2017-04-13T19:33:28Z", "is_private": false, "text": "printsetuprecord == null"}, {"count": 3, "tags": [], "creator": "onealj@apache.org", "is_private": false, "text": "Can you please include a stack trace of the NPE?", "id": 198291, "time": "2017-04-14T08:01:10Z", "bug_id": 60985, "creation_time": "2017-04-14T08:01:10Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 60985, "attachment_id": null, "id": 198296, "time": "2017-04-14T08:30:41Z", "creator": "mr.teterin@gmail.com", "creation_time": "2017-04-14T08:30:41Z", "is_private": false, "text": "java.lang.NullPointerException\n\tat org.apache.poi.hssf.usermodel.HSSFPrintSetup.setLandscape(HSSFPrintSetup.java:112)\n\tat ru.iteterin.project.simpleDoc.document.ReadWriteExcel.setPrintOptions(ReadWriteExcel.java:167)\n\tat ru.iteterin.project.simpleDoc.document.ReadWriteExcel.editExcel(ReadWriteExcel.java:32)\n\tat ru.iteterin.project.simpleDoc.controllers.Controller.saveChenge(Controller.java:68)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat sun.reflect.misc.Trampoline.invoke(MethodUtil.java:71)\n\tat sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat sun.reflect.misc.MethodUtil.invoke(MethodUtil.java:275)\n\tat javafx.fxml.FXMLLoader$MethodHandler.invoke(FXMLLoader.java:1769)\n\tat javafx.fxml.FXMLLoader$ControllerMethodEventHandler.handle(FXMLLoader.java:1657)\n\tat com.sun.javafx.event.CompositeEventHandler.dispatchBubblingEvent(CompositeEventHandler.java:86)\n\tat com.sun.javafx.event.EventHandlerManager.dispatchBubblingEvent(EventHandlerManager.java:238)\n\tat com.sun.javafx.event.EventHandlerManager.dispatchBubblingEvent(EventHandlerManager.java:191)\n\tat com.sun.javafx.event.CompositeEventDispatcher.dispatchBubblingEvent(CompositeEventDispatcher.java:59)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:58)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.EventUtil.fireEventImpl(EventUtil.java:74)\n\tat com.sun.javafx.event.EventUtil.fireEvent(EventUtil.java:49)\n\tat javafx.event.Event.fireEvent(Event.java:198)\n\tat javafx.scene.Node.fireEvent(Node.java:8413)\n\tat javafx.scene.control.Button.fire(Button.java:185)\n\tat com.sun.javafx.scene.control.behavior.ButtonBehavior.mouseReleased(ButtonBehavior.java:182)\n\tat com.sun.javafx.scene.control.skin.BehaviorSkinBase$1.handle(BehaviorSkinBase.java:96)\n\tat com.sun.javafx.scene.control.skin.BehaviorSkinBase$1.handle(BehaviorSkinBase.java:89)\n\tat com.sun.javafx.event.CompositeEventHandler$NormalEventHandlerRecord.handleBubblingEvent(CompositeEventHandler.java:218)\n\tat com.sun.javafx.event.CompositeEventHandler.dispatchBubblingEvent(CompositeEventHandler.java:80)\n\tat com.sun.javafx.event.EventHandlerManager.dispatchBubblingEvent(EventHandlerManager.java:238)\n\tat com.sun.javafx.event.EventHandlerManager.dispatchBubblingEvent(EventHandlerManager.java:191)\n\tat com.sun.javafx.event.CompositeEventDispatcher.dispatchBubblingEvent(CompositeEventDispatcher.java:59)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:58)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.EventUtil.fireEventImpl(EventUtil.java:74)\n\tat com.sun.javafx.event.EventUtil.fireEvent(EventUtil.java:54)\n\tat javafx.event.Event.fireEvent(Event.java:198)\n\tat javafx.scene.Scene$MouseHandler.process(Scene.java:3757)\n\tat javafx.scene.Scene$MouseHandler.access$1500(Scene.java:3485)\n\tat javafx.scene.Scene.impl_processMouseEvent(Scene.java:1762)\n\tat javafx.scene.Scene$ScenePeerListener.mouseEvent(Scene.java:2494)\n\tat com.sun.javafx.tk.quantum.GlassViewEventHandler$MouseEventNotification.run(GlassViewEventHandler.java:381)\n\tat com.sun.javafx.tk.quantum.GlassViewEventHandler$MouseEventNotification.run(GlassViewEventHandler.java:295)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat com.sun.javafx.tk.quantum.GlassViewEventHandler.lambda$handleMouseEvent$354(GlassViewEventHandler.java:417)\n\tat com.sun.javafx.tk.quantum.QuantumToolkit.runWithoutRenderLock(QuantumToolkit.java:389)\n\tat com.sun.javafx.tk.quantum.GlassViewEventHandler.handleMouseEvent(GlassViewEventHandler.java:416)\n\tat com.sun.glass.ui.View.handleMouseEvent(View.java:555)\n\tat com.sun.glass.ui.View.notifyMouse(View.java:937)\n\tat com.sun.glass.ui.win.WinApplication._runLoop(Native Method)\n\tat com.sun.glass.ui.win.WinApplication.lambda$null$148(WinApplication.java:191)\n\tat java.lang.Thread.run(Thread.java:745)\nException in thread \"JavaFX Application Thread\" java.lang.RuntimeException: java.lang.reflect.InvocationTargetException\n\tat javafx.fxml.FXMLLoader$MethodHandler.invoke(FXMLLoader.java:1774)\n\tat javafx.fxml.FXMLLoader$ControllerMethodEventHandler.handle(FXMLLoader.java:1657)\n\tat com.sun.javafx.event.CompositeEventHandler.dispatchBubblingEvent(CompositeEventHandler.java:86)\n\tat com.sun.javafx.event.EventHandlerManager.dispatchBubblingEvent(EventHandlerManager.java:238)\n\tat com.sun.javafx.event.EventHandlerManager.dispatchBubblingEvent(EventHandlerManager.java:191)\n\tat com.sun.javafx.event.CompositeEventDispatcher.dispatchBubblingEvent(CompositeEventDispatcher.java:59)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:58)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.EventUtil.fireEventImpl(EventUtil.java:74)\n\tat com.sun.javafx.event.EventUtil.fireEvent(EventUtil.java:49)\n\tat javafx.event.Event.fireEvent(Event.java:198)\n\tat javafx.scene.Node.fireEvent(Node.java:8413)\n\tat javafx.scene.control.Button.fire(Button.java:185)\n\tat com.sun.javafx.scene.control.behavior.ButtonBehavior.mouseReleased(ButtonBehavior.java:182)\n\tat com.sun.javafx.scene.control.skin.BehaviorSkinBase$1.handle(BehaviorSkinBase.java:96)\n\tat com.sun.javafx.scene.control.skin.BehaviorSkinBase$1.handle(BehaviorSkinBase.java:89)\n\tat com.sun.javafx.event.CompositeEventHandler$NormalEventHandlerRecord.handleBubblingEvent(CompositeEventHandler.java:218)\n\tat com.sun.javafx.event.CompositeEventHandler.dispatchBubblingEvent(CompositeEventHandler.java:80)\n\tat com.sun.javafx.event.EventHandlerManager.dispatchBubblingEvent(EventHandlerManager.java:238)\n\tat com.sun.javafx.event.EventHandlerManager.dispatchBubblingEvent(EventHandlerManager.java:191)\n\tat com.sun.javafx.event.CompositeEventDispatcher.dispatchBubblingEvent(CompositeEventDispatcher.java:59)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:58)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.BasicEventDispatcher.dispatchEvent(BasicEventDispatcher.java:56)\n\tat com.sun.javafx.event.EventDispatchChainImpl.dispatchEvent(EventDispatchChainImpl.java:114)\n\tat com.sun.javafx.event.EventUtil.fireEventImpl(EventUtil.java:74)\n\tat com.sun.javafx.event.EventUtil.fireEvent(EventUtil.java:54)\n\tat javafx.event.Event.fireEvent(Event.java:198)\n\tat javafx.scene.Scene$MouseHandler.process(Scene.java:3757)\n\tat javafx.scene.Scene$MouseHandler.access$1500(Scene.java:3485)\n\tat javafx.scene.Scene.impl_processMouseEvent(Scene.java:1762)\n\tat javafx.scene.Scene$ScenePeerListener.mouseEvent(Scene.java:2494)\n\tat com.sun.javafx.tk.quantum.GlassViewEventHandler$MouseEventNotification.run(GlassViewEventHandler.java:381)\n\tat com.sun.javafx.tk.quantum.GlassViewEventHandler$MouseEventNotification.run(GlassViewEventHandler.java:295)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat com.sun.javafx.tk.quantum.GlassViewEventHandler.lambda$handleMouseEvent$354(GlassViewEventHandler.java:417)\n\tat com.sun.javafx.tk.quantum.QuantumToolkit.runWithoutRenderLock(QuantumToolkit.java:389)\n\tat com.sun.javafx.tk.quantum.GlassViewEventHandler.handleMouseEvent(GlassViewEventHandler.java:416)\n\tat com.sun.glass.ui.View.handleMouseEvent(View.java:555)\n\tat com.sun.glass.ui.View.notifyMouse(View.java:937)\n\tat com.sun.glass.ui.win.WinApplication._runLoop(Native Method)\n\tat com.sun.glass.ui.win.WinApplication.lambda$null$148(WinApplication.java:191)\n\tat java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat sun.reflect.misc.Trampoline.invoke(MethodUtil.java:71)\n\tat sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat sun.reflect.misc.MethodUtil.invoke(MethodUtil.java:275)\n\tat javafx.fxml.FXMLLoader$MethodHandler.invoke(FXMLLoader.java:1769)\n\t... 52 more\nCaused by: junit.framework.AssertionFailedError: sheet.getPrintSetup() return null\n\tat ru.iteterin.project.simpleDoc.document.ReadWriteExcel.setPrintOptions(ReadWriteExcel.java:172)\n\tat ru.iteterin.project.simpleDoc.document.ReadWriteExcel.editExcel(ReadWriteExcel.java:32)\n\tat ru.iteterin.project.simpleDoc.controllers.Controller.saveChenge(Controller.java:68)\n\t... 62 more\n\nhttps://github.com/mrtopgun/simpleDoc"}, {"count": 5, "tags": [], "bug_id": 60985, "attachment_id": null, "is_private": false, "id": 198346, "time": "2017-04-19T08:11:58Z", "creator": "mr.teterin@gmail.com", "creation_time": "2017-04-19T08:11:58Z", "text": "How can you get around this error?"}, {"count": 6, "tags": [], "creator": "onealj@apache.org", "attachment_id": null, "id": 198351, "time": "2017-04-19T08:58:48Z", "bug_id": 60985, "creation_time": "2017-04-19T08:58:48Z", "is_private": false, "text": "Here's what I had in mind for the fix:\n\nIndex: src/java/org/apache/poi/hssf/usermodel/HSSFSheet.java\n===================================================================\n--- src/java/org/apache/poi/hssf/usermodel/HSSFSheet.java       (revision 1791876)\n+++ src/java/org/apache/poi/hssf/usermodel/HSSFSheet.java       (working copy)\n@@ -40,6 +40,7 @@\n import org.apache.poi.hssf.record.ExtendedFormatRecord;\n import org.apache.poi.hssf.record.HyperlinkRecord;\n import org.apache.poi.hssf.record.NameRecord;\n+import org.apache.poi.hssf.record.PrintSetupRecord;\n import org.apache.poi.hssf.record.Record;\n import org.apache.poi.hssf.record.RecordBase;\n import org.apache.poi.hssf.record.RowRecord;\n@@ -1242,7 +1243,8 @@\n      */\n     @Override\n     public HSSFPrintSetup getPrintSetup() {\n-        return new HSSFPrintSetup(_sheet.getPageSettings().getPrintSetup());\n+        final PrintSetupRecord r = _sheet.getPageSettings().getPrintSetup();\n+        return (r==null) ? null : new HSSFPrintSetup(r);\n     }\n \n     @Override\n\nHowever, getMargin and setMargin will also throw NPEs if no PrintSetupRecord is present. Should we change HSSFSheet#getPrintSetup() to add a new PrintSetupRecord if none exists? This would mean that a getter has a side-effect, which may be unexpected (especially for read-only behavior).\nWe could have getPrintSetup() return null, forcing the caller to call HSSFSheet#add/createPrintSetup() (method doesn't exist yet), but this would result in uglier and likely-to-be-incorrect user code.\n\nCurrently Ivan gets an NPE because HSSFSheet#getPrintSetup() returns new HSSFPrintSetup(PrintSetupRecord rec=null), and calling setLandscape(Boolean) on a non-null HSSFPrintSetup that wraps a null PrintSetupRecord doesn't have a logical behavior.\n\nAny opinions on what the best solution is here?"}, {"count": 7, "tags": [], "creator": "apache@gagravarr.org", "text": "On HSSFWorkbook, getSheet(String name) returns null, and requires callers to check that and create a missing sheet if needed. Same with getName(String name)\n\nOn HSSFSheet, getRow(int idx) can return null if none is defined at that index, and requires callers to check that and create a missing row if needed\n\nSo, based on that existing pattern, I'd have getPrintSetup() return null if required, and add a create method", "id": 198354, "time": "2017-04-19T09:10:56Z", "bug_id": 60985, "creation_time": "2017-04-19T09:10:56Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 60985, "attachment_id": 34927, "is_private": false, "id": 198356, "time": "2017-04-19T09:24:50Z", "creator": "onealj@apache.org", "creation_time": "2017-04-19T09:24:50Z", "text": "Created attachment 34927\npatch in progress"}, {"count": 9, "tags": [], "bug_id": 60985, "attachment_id": null, "id": 198357, "time": "2017-04-19T09:26:25Z", "creator": "onealj@apache.org", "creation_time": "2017-04-19T09:26:25Z", "is_private": false, "text": "How should HSSFSheet#getMargin and HSSFSheet#setMargin behave when no PrintSetupRecord exists?"}, {"count": 10, "tags": [], "text": "https://svn.apache.org/viewvc/poi/trunk/src/ooxml/java/org/apache/poi/xssf/usermodel/XSSFSheet.java?revision=1782894&view=markup#l1352\n    public XSSFPrintSetup getPrintSetup() {\n        return new XSSFPrintSetup(worksheet);\n    }\n\nhttps://svn.apache.org/viewvc/poi/trunk/src/ooxml/java/org/apache/poi/xssf/usermodel/XSSFPrintSetup.java?revision=1782114&view=markup#l42\n    protected XSSFPrintSetup(CTWorksheet worksheet) {\n        this.ctWorksheet = worksheet;\n\n        if(ctWorksheet.isSetPageSetup()) {\n           this.pageSetup = ctWorksheet.getPageSetup();\n        } else {\n           this.pageSetup = ctWorksheet.addNewPageSetup();\n        }\n        if(ctWorksheet.isSetPageMargins()) {\n           this.pageMargins = ctWorksheet.getPageMargins();\n        } else {\n           this.pageMargins = ctWorksheet.addNewPageMargins();\n        }\n    }\n\nSo for parity with XSSF, XSSFSheet#getPrintSetup() would create a new page setup if none exists.", "is_private": false, "id": 198359, "creator": "onealj@apache.org", "time": "2017-04-19T09:31:08Z", "bug_id": 60985, "creation_time": "2017-04-19T09:31:08Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 60985, "text": "I think HSSFSheet # getMargin and HSSFSheet # setMargin should call getOrCreatePrintSetup ()", "id": 198360, "time": "2017-04-19T09:39:16Z", "creator": "mr.teterin@gmail.com", "creation_time": "2017-04-19T09:39:16Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 60985, "attachment_id": null, "id": 199605, "time": "2017-07-06T10:13:08Z", "creator": "mr.teterin@gmail.com", "creation_time": "2017-07-06T10:13:08Z", "is_private": false, "text": "Hello, please tell me when this bug will be fixed? Thank you!"}]
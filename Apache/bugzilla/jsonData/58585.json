[{"count": 0, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 186244, "time": "2015-11-04T17:52:20Z", "bug_id": 58585, "creation_time": "2015-11-04T17:52:20Z", "is_private": false, "text": "Encountered while testing Tomcat-Native 1.2.1 release candidate with current Tomcat 9 trunk (at revision 1712593)\n\nFor some reason this issue does not happen with http://localhost:8080/, but it does happen with https://localhost:8443/\n\nI am on Windows 7 using Java 8u66 32-bit\n\nSteps to reproduce:\n1. Copy tcnative-1.dll into ${catalina.home}/bin\n2. Copy the following files from source directory test\\org\\apache\\tomcat\\util\\net\\  into ${catalina.home}/conf:\n\nlocalhost-cert.pem\nlocalhost-key.pem\n\n3. In conf/server.xml configure the following connector\n\n    <Connector port=\"8443\" protocol=\"org.apache.coyote.http11.Http11AprProtocol\"\n               maxThreads=\"150\" SSLEnabled=\"true\" >\n        <UpgradeProtocol className=\"org.apache.coyote.http2.Http2Protocol\" />\n        <SSLHostConfig honorCipherOrder=\"false\" >\n            <Certificate certificateKeyFile=\"conf/localhost-key.pem\"\n                         certificateFile=\"conf/localhost-cert.pem\"\n                         type=\"RSA\" />\n        </SSLHostConfig>\n    </Connector>\n\n(It is the same as commented example, but certificateKeyFile and certificateFile are updated to match file names, s/-rsa-/-/ )\n\n4. Set JAVA_HOME and start Tomcat with SecurityManager enabled.\ncd bin\ncatalina.bat start -security\n\n5. Access https://localhost:8443/\nI am using Firefox 41.0.2\n\nThe page fails with error 500 during execution of JSP page.\n\n java.security.AccessControlException: access denied (\"java.lang.RuntimePermission\" \"accessClassInPackage.org.apache.tomcat.util.buf\")\n\tat java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)\n\tat java.security.AccessController.checkPermission(AccessController.java:884)\n\tat java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\n\tat java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1564)\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:311)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:411)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n\tat org.apache.catalina.connector.OutputBuffer.setConverter(OutputBuffer.java:561)\n\tat org.apache.catalina.connector.OutputBuffer.checkConverter(OutputBuffer.java:546)\n\tat org.apache.catalina.connector.Response.getWriter(Response.java:598)\n\tat org.apache.catalina.connector.ResponseFacade.getWriter(ResponseFacade.java:211)\n\tat org.apache.jasper.runtime.JspWriterImpl.initOut(JspWriterImpl.java:115)\n\tat org.apache.jasper.runtime.JspWriterImpl.flushBuffer(JspWriterImpl.java:108)\n\tat org.apache.jasper.runtime.JspWriterImpl.write(JspWriterImpl.java:326)\n\tat java.io.Writer.write(Writer.java:157)\n\tat org.apache.jsp.index_jsp._jspService(index_jsp.java:322)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:438)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:385)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:329)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\n\n\nIf I refresh the page, it shows up successfully.\n\nIf I restart Tomcat, the first access to https://localhost:8443/ fails as well, so JSP compilation does not affect it.\n\nIf the first access is via https://localhost:8080/, it shows up successfully."}, {"count": 1, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 186245, "time": "2015-11-04T18:03:15Z", "bug_id": 58585, "creation_time": "2015-11-04T18:03:15Z", "is_private": false, "text": "Further testing, with HTTP,\n\nThe following page (A Servlet 4.0 push example) fails as well\nhttp://localhost:8080/examples/servlets/serverpush/simpleimage\n\n java.security.AccessControlException: access denied (\"java.lang.RuntimePermission\" \"accessClassInPackage.org.apache.catalina.core\")\n\tat java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)\n\tat java.security.AccessController.checkPermission(AccessController.java:884)\n\tat java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\n\tat java.lang.SecurityManager.checkPackageAccess(SecurityManager.java:1564)\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:311)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:411)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n\tat org.apache.catalina.connector.Request.getPushBuilder(Request.java:1832)\n\tat org.apache.catalina.connector.RequestFacade.getPushBuilder(RequestFacade.java:1125)\n\tat http2.SimpleImagePush.doGet(SimpleImagePush.java:36)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:622)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:729)"}, {"count": 2, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": 33257, "id": 186246, "time": "2015-11-04T18:04:38Z", "bug_id": 58585, "creation_time": "2015-11-04T18:04:38Z", "is_private": false, "text": "Created attachment 33257\nlocalhost.2015-11-04.log with full stacktrace for Comment 0"}, {"count": 3, "tags": [], "text": "Created attachment 33258\nlocalhost.2015-11-04.log with full stacktrace for Comment 1\n\nFor issue in Comment 1 refreshing the page does not help, access is still denied.", "attachment_id": 33258, "bug_id": 58585, "id": 186247, "time": "2015-11-04T18:07:07Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2015-11-04T18:07:07Z", "is_private": false}, {"count": 4, "tags": [], "text": "Thanks. Fixed, along with a couple of others thsat emerged once these were fixed.", "attachment_id": null, "bug_id": 58585, "id": 186275, "time": "2015-11-05T21:06:20Z", "creator": "markt@apache.org", "creation_time": "2015-11-05T21:06:20Z", "is_private": false}]
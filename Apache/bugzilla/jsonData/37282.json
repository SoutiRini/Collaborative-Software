[{"count": 0, "tags": [], "bug_id": 37282, "is_private": false, "id": 81866, "creation_time": "2005-10-27T22:05:32Z", "time": "2005-10-27T22:05:32Z", "creator": "iwreilly@yahoo.com", "text": "The attached patch for version 1.2.12 fixes two problems in \norg.apache.log4j.net.SyslogAppender.  First, it doesn't close the writer and as \na result leaks UDP sockets.  Second, when logging an exception, it assumes that \nall lines after the first line start with a \\t character.  If this is not the \ncase, it removes the first character from the line (or throws an exception if \nthe line is empty).\n\n--- SyslogAppender.java.orig    2005-10-25 15:50:35.000000000 -0400\n+++ SyslogAppender.java 2005-10-25 15:19:57.000000000 -0400\n@@ -121,8 +121,11 @@\n  public\n  void close() {\n    closed = true; \n-    // A SyslogWriter is UDP based and needs no opening. Hence, it\n-    // can't be closed. We just unset the variables here.\n+    try {\n+       if (sqw != null) sqw.close();\n+    } catch (Exception e) {\n+       // ignore error\n+    }\n    sqw = null;\n  }\n\n@@ -260,7 +263,15 @@\n        if(len > 0) {\n          sqw.write(s[0]);\n          for(int i = 1; i < len; i++) {\n-            sqw.write (TAB+s[i].substring(1));\n+            if (s[i].length() > 0) {\n+               if (s[i].charAt(0) == '\\t') {\n+                  sqw.write(TAB+s[i].substring(1));\n+               } else {\n+                   sqw.write(TAB+s[i]);\n+               }\n+            } else {\n+               sqw.write(s[i]);\n+            }\n          }\n        }\n      }", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 37282, "text": "Could you review your patch against the current SVN for log4j 1.2 and confirm that it actually eliminates \nthe descriptor leakage?  As far as I can see, the sqw.close() statement would have no significant effect \nsince org.apache.log4j.helpers.SyslogWriter.close() is a no-op.\n\nIf you do resubmit a patch, spin the \\t patch into a second bug report and patch.\n\n", "id": 92757, "time": "2006-08-30T21:49:50Z", "creator": "carnold@apache.org", "creation_time": "2006-08-30T21:49:50Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "iwreilly@yahoo.com", "attachment_id": null, "text": "I forgot to include part of my patch.  SyslogWriter must be patched to \nimplement the close method.  The following patch will do that:\n\n*** SyslogWriter.java.orig\t2006-09-13 16:11:07.000000000 -0400\n--- SyslogWriter.java\t2006-09-13 16:11:21.000000000 -0400\n***************\n*** 82,86 ****\n    void flush() {}\n  \n    public\n!   void close() {}\n  }\n--- 82,86 ----\n    void flush() {}\n  \n    public\n!   void close() {if (ds != null) ds.close();}\n  }\n\n\nI have opened a separate bug report for the tab issue.", "id": 93548, "time": "2006-09-13T20:13:08Z", "bug_id": 37282, "creation_time": "2006-09-13T20:13:08Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 37282, "attachment_id": null, "is_private": false, "id": 95758, "time": "2006-11-13T04:14:54Z", "creator": "kay.abendroth@raxion.net", "creation_time": "2006-11-13T04:14:54Z", "text": "This also affects trunk."}, {"count": 4, "tags": [], "bug_id": 37282, "is_private": false, "id": 98598, "creation_time": "2007-01-26T21:29:03Z", "time": "2007-01-26T21:29:03Z", "creator": "genman@noderunner.net", "text": "Fixed in SVN trunk.  Also added unit test to try to reproduce leaks.", "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "carnold@apache.org", "text": "Elias committed changes against log4j/trunk in rev 500483.  Not sure that tests are actually run or if they \nwould fail if the changes if the changes were not made.\n\nReopening since for review of the trunk changes and careful consideration on backporting to log4j 1.2.", "id": 98788, "time": "2007-01-30T13:59:16Z", "bug_id": 37282, "creation_time": "2007-01-30T13:59:16Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 37282, "is_private": false, "id": 99648, "creation_time": "2007-02-21T14:46:24Z", "time": "2007-02-21T14:46:24Z", "creator": "carnold@apache.org", "text": "Tab bug is 40502.\n\nRev 50048 on log4j trunk addresses multiple issues, not just leaks.  Should br reverted and then broken \ndown into discrete changes.\n\nCommitted rev 510279 on 1.2 branch which just addresses close() issue and adds testActualLogging unit \ntest. ", "attachment_id": null}]
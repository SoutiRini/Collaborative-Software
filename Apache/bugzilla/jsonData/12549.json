[{"count": 0, "attachment_id": null, "bug_id": 12549, "text": "The problem occurs when someone attempts to access j_security_check but is\nalready authenticated.\n\nFrom org.apache.catalina.authenticator.AuthenticatorBase:\n\n        // Special handling for form-based logins to deal with the case\n        // where the login form (and therefore the \"j_security_check\" URI\n        // to which it submits) might be outside the secured area\n        String contextPath = this.context.getPath();\n        String requestURI = hrequest.getDecodedRequestURI();\n1:      if (requestURI.startsWith(contextPath) &&\n            requestURI.endsWith(Constants.FORM_ACTION)) {\n2:          if (!authenticate(hrequest, hresponse, config)) {\n               if (debug >= 1)\n                 log(\" Failed authenticate() test\");\n3:              return;\n            }\n4:\n         }\n\nIn (1) the code matches any request to j_security_check, which triggers a call\nto authenticate at (2). \n\nIn a new request to process a form login, authenticate() (in FormAuthenticator)\nwill process the login and (if succesful) it will set a redirect to the original\nrequest (which had been saved) and return FALSE. This ends the processing at\n(3), the redirect is later processed and all is well.\n\nHowever, if the user is already authenticated authenticate() simply return TRUE\nso the code reaches (4) where no action is taken and we fall out of the\nspecial-case block for j_security_check. Then the request processing continues\nas if it were a regular page request, which of course results in a 404.\n\n(Note that the debug message is also incorrect after (2) since here FALSE can be\na success case).", "id": 22706, "time": "2002-09-11T21:30:11Z", "creator": "jyri@eng.sun.com", "creation_time": "2002-09-11T21:30:11Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 12549, "is_private": false, "id": 24837, "time": "2002-10-18T02:22:21Z", "creator": "kare@w4.dion.ne.jp", "creation_time": "2002-10-18T02:22:21Z", "tags": [], "text": "This bug also occurs in Tomcat 4.1.12 on Windows 2000."}, {"count": 2, "tags": [], "creator": "rhoegg@isisnetworks.net", "text": "What is the expected behavior when an authenticated user attempts to access\nj_security_check?  I can imagine several scenarios:\n1. The user types it into the address bar.\n2. The user accesses the login form directly (possibly to log in as a different\nuser).\n3. As a result of a 302 redirect.\n\nI may be missing some more.  I would be happy to work on a patch for this if I\nknew what should happen here.\n\nDevelopers: Shouldn't this code be moved to FormAuthenticator and accessed via a\nprotected method?", "id": 25444, "time": "2002-10-31T19:32:14Z", "bug_id": 12549, "creation_time": "2002-10-31T19:32:14Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 12549, "attachment_id": null, "text": "I've been researching this a little... should this be marked as a suplicate of\nBug 6279?", "id": 25445, "time": "2002-10-31T19:40:33Z", "creator": "rhoegg@isisnetworks.net", "creation_time": "2002-10-31T19:40:33Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 12549, "is_private": false, "text": "It is not valid to address the \"j_security_check\" URL directly in an HTTP\nrequest.  Therefore, any attempt to do so will cause undefined behavior that is\ndependent on which container (and which version of which container) you are\naccessing.  For Tomcat 4.1.x, it will typically generate a 4xx error because\nthis \"magic\" URL is only enabled when the container itself sent the login page.\n\nThe design of form-based authentication was based on creating a user experience\nsimilar to that of BASIC authentication, where the browser pops up the login\ndialog only when necessary, with the additional feature that you can customize\nthe look and feel of the login page.  However, in BASIC authentication, the\nlogin dialog box is never addressed directly (indeed, it has no URL so it cannot\nbe).  You should design webapps for form-based authentication exactly the same\nway.  Think of the form login page as part of the container, not part of the app.\n\n", "id": 25446, "time": "2002-10-31T20:14:17Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2002-10-31T20:14:17Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 12549, "attachment_id": null, "is_private": false, "id": 25448, "time": "2002-10-31T20:27:53Z", "creator": "rhoegg@isisnetworks.net", "creation_time": "2002-10-31T20:27:53Z", "text": "We should mark this as a duplicate and continue the discussion in Bug 6279. \nFrom the original bug report:\n\n<blockquote>\nThis ought to be easy to reproduce...if you go to a page secured by form-based \nauthentication in a webapp under catalina, you are displayed the login form. \nLog in, you see the page you asked for. Now click 'back' in the browser. You \nget the login form again. Resubmit the form.\n\nYou will end up at a tomcat 404 error page, explaining that the \nresource /some/path/to/j_security_check does not exist.\n</blockquote>\n\nI think this is one reason we can not exactly duplicate BASIC authentication as\nin BASIC, the back button takes you to the page you were on before the login prompt.\n\nThis is a problem for usability, as the current behavior is non-intuitive for\nweb users and is not solvable by web developers or tomcat administrators without\nmodifying Tomcat or disabling form based authentication."}, {"text": "It indeed appears to be a duplicate of 6279, I'll mark it as such.\n\nAs Ryan describes, it is indeed a usability problem. Most users seem to hit this\nproblem sooner or later and the behavior is utterly unintuitive from the user's\nperspective. (\"Why in the world can't I hit Back and log in again, it worked\nfine before!\")\n\n\n*** This bug has been marked as a duplicate of 6279 ***", "tags": [], "bug_id": 12549, "is_private": false, "count": 6, "id": 25460, "time": "2002-11-01T03:00:47Z", "creator": "jyri@eng.sun.com", "creation_time": "2002-11-01T03:00:47Z", "attachment_id": null}]
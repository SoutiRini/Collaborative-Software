[{"count": 0, "text": "I have a Tomcat running a web application, which I then want to update remotely. During this deployment a ServletContextListener instance (called InitListener and configured in the web.xml) executes the contextDestroyed method.\n\nIn this method some java classes cannot be loaded. In the tomcat's error log I see errors like:\n\nSEVERE: Exception sending context destroyed event to listener instance of class x.y.z.InitListener\njava.lang.NoClassDefFoundError: org/jboss/netty/util/internal/ConcurrentHashMap$Values\n\nHowever, if I access the same class (in this example the ConcurrentHashMap$Values) at some previous point before the shutdown starts, everything works fine.\n\nIt seems that Tomcat is not able to (newly) load the necessary classes when doing the shutdown part of the remote deployment. To my knowledge at this point arbitrary java code should still be executable.", "creator": "michael.bauland@knipp.de", "attachment_id": null, "id": 178638, "time": "2014-10-21T11:50:19Z", "bug_id": 57122, "creation_time": "2014-10-21T11:50:19Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 57122, "attachment_id": null, "id": 178639, "time": "2014-10-21T12:02:07Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-10-21T12:02:07Z", "is_private": false, "text": "(In reply to michael.bauland from comment #0)\n> \n> SEVERE: Exception sending context destroyed event to listener instance of\n> class x.y.z.InitListener\n> java.lang.NoClassDefFoundError:\n> org/jboss/netty/util/internal/ConcurrentHashMap$Values\n> \n\n1. The full stack trace of the above error = ?\n\n(Was \"Exception sending context destroyed event\" produced by Tomcat?\nWas there a \"root cause\" of the above exception? What class loader was trying to load the class?\nAny other preceding error in the logs?)\n\n2. Are jboss classes in your web application's WEB-INF/lib and absent from Tomcat's lib directory?\n\n3. Can you provide simple sample web application to reproduce this behaviour?"}, {"count": 2, "tags": [], "text": "Created attachment 32132\nerror log", "is_private": false, "id": 178640, "creator": "michael.bauland@knipp.de", "time": "2014-10-21T12:21:34Z", "bug_id": 57122, "creation_time": "2014-10-21T12:21:34Z", "attachment_id": 32132}, {"count": 3, "tags": [], "text": "Thanks for the quick response. \n1. I have attached the full stack trace. There have been no preceding errors in \nthe log, as you can see.\n\n2. No, we do not use jBoss (just richfaces) and have no jBoss classes present.\n\n3. Sorry, the classes that cannot be loaded seem to be arbitrary, one self-written utility class and one from the netty framework (org/jboss/netty/util/internal/ConcurrentHashMap$Values), but I can't reproduce with a simple sample.", "is_private": false, "id": 178641, "creator": "michael.bauland@knipp.de", "time": "2014-10-21T12:25:37Z", "bug_id": 57122, "creation_time": "2014-10-21T12:25:37Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "(In reply to michael.bauland from comment #3)\n> Thanks for the quick response. \n> 1. I have attached the full stack trace. There have been no preceding errors\n> in \n> the log, as you can see.\n> \n> 2. No, we do not use jBoss (just richfaces) and have no jBoss classes\n> present.\n> \n> 3. Sorry, the classes that cannot be loaded seem to be arbitrary, one\n> self-written utility class and one from the netty framework\n> (org/jboss/netty/util/internal/ConcurrentHashMap$Values), but I can't\n> reproduce with a simple sample.\n\nAgain, where are the classes that can't be loaded located?", "attachment_id": null, "id": 178643, "creator": "markt@apache.org", "time": "2014-10-21T12:40:54Z", "bug_id": 57122, "creation_time": "2014-10-21T12:40:54Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 57122, "attachment_id": null, "id": 178644, "time": "2014-10-21T12:42:52Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-10-21T12:42:52Z", "is_private": false, "text": "See bug 56321. Update to 7.0.54 or later.\n\n*** This bug has been marked as a duplicate of bug 56321 ***"}, {"count": 6, "tags": [], "bug_id": 57122, "attachment_id": null, "id": 178646, "time": "2014-10-21T12:45:23Z", "creator": "markt@apache.org", "creation_time": "2014-10-21T12:45:23Z", "is_private": false, "text": "Looks like the classes are located in the web application. I was just about to mark this as a duplicate as well but Konstantin beat me to it."}, {"count": 7, "tags": [], "text": "Yes, sorry, didn't see you question about the location of the classes. They are located in the WEB-INF/lib folder.", "is_private": false, "id": 178647, "creator": "michael.bauland@knipp.de", "time": "2014-10-21T13:20:34Z", "bug_id": 57122, "creation_time": "2014-10-21T13:20:34Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 56639, "text": "Created attachment 31725\nFix event MPM race condition on connection scoreboard handle\n\nIn event.c, process_socket(), if a worker thread is put into the lingering close state, it is put into the linger_q (or short_linger_q). Shortly afterward, the scoreboard handle of the connection handled by that thread is set to NULL. Meanwhile, in the listener thread, process_lingering_close() is called on any connections in the linger_q that are closed. This also clears the transaction pool, making it available for other workers to use. Most of the time, this is fine, but in the worst case, this can result in a race condition; the listener thread may assign the pool to another thread between the time the pool is cleared and the time c->sbh is set to NULL. This can be a problem for third-party modules which access the scoreboard using the connection scoreboard handle at arbitrary times.\n\nThis problem appears to be very close to revision 1538490, but that fix covers every case except for the lingering close fixed here.", "id": 175870, "time": "2014-06-18T18:23:57Z", "creator": "Chaosed0@gmail.com", "creation_time": "2014-06-18T18:23:57Z", "is_private": false, "attachment_id": 31725}, {"count": 1, "tags": [], "creator": "Chaosed0@gmail.com", "attachment_id": 31726, "text": "Created attachment 31726\nFix event MPM race condition on connection scoreboard handle\n\nWrong patch before - still had some things I was experimenting with", "id": 175871, "time": "2014-06-18T18:25:58Z", "bug_id": 56639, "creation_time": "2014-06-18T18:25:58Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 56639, "attachment_id": null, "id": 175958, "time": "2014-06-21T13:22:16Z", "creator": "covener@gmail.com", "creation_time": "2014-06-21T13:22:16Z", "is_private": false, "text": "Thanks, committed and proposed for backport."}, {"count": 3, "tags": [], "bug_id": 56639, "attachment_id": 31747, "id": 176006, "time": "2014-06-24T12:26:22Z", "creator": "Chaosed0@gmail.com", "creation_time": "2014-06-24T12:26:22Z", "is_private": false, "text": "Created attachment 31747\nMove sbh nullification to correct place\n\nI just realized that I nulled the sbh out in the wrong place in the last patch - it's supposed to be before the connection is added to the queue, not the pollset. This patch is on top of what was just committed."}, {"count": 4, "text": "Fixed and released in 2.4.10", "bug_id": 56639, "attachment_id": null, "id": 177220, "time": "2014-08-18T06:59:11Z", "creator": "christophe.jaillet@wanadoo.fr", "creation_time": "2014-08-18T06:59:11Z", "tags": [], "is_private": false}]
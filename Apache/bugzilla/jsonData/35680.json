[{"count": 0, "tags": [], "text": "Once every second, at seemingly random times throughout the day, I'm getting\nthese warnings logged in bunches of ~100 lines:\n\n(97)Address family not supported by protocol: connect to listener on [::]:443\n\nOut of the box, prefork is loaded rather than worker, with my custom settings:\n\n<IfModule prefork.c>\nStartServers            1\nMinSpareServers         2\nMaxSpareServers         3\nServerLimit             4\nMaxClients              4\nMaxRequestsPerChild  4000\n</IfModule>\n\n... reflecting the fact this is possibly one of the worlds smallest production\nservers (Pentium MMX, 166MHz, 140MB, 2.6.12-1.1390_FC4, httpd-2.0.54-10) that\nruns great on otherwise stock settings, using Yum maintained Fedora RPMs.\n\nI'll attach a strace of \"telnet ::1\", a server_status.html and phpinfo.php\nreadout shortly. Again, it's a very stock kit, with no proxy server defined, etc.\n\nIs there anything else I can do to help move the markers forward on this? While\nthis problem is not lethal, I need to keep this museum piece running as lean as\npossible ;)\n\nThanks very much,\n/p2", "attachment_id": null, "id": 77150, "creator": "pinter@p-squared.com", "time": "2005-07-10T20:07:38Z", "bug_id": 35680, "creation_time": "2005-07-10T20:07:38Z", "is_private": false}, {"count": 1, "tags": [], "text": "Created attachment 15639\nstrace of telnet ::1", "attachment_id": 15639, "id": 77151, "creator": "pinter@p-squared.com", "time": "2005-07-10T20:10:10Z", "bug_id": 35680, "creation_time": "2005-07-10T20:10:10Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 35680, "attachment_id": 15640, "id": 77152, "time": "2005-07-10T20:11:12Z", "creator": "pinter@p-squared.com", "creation_time": "2005-07-10T20:11:12Z", "is_private": false, "text": "Created attachment 15640\nreadout of server-status"}, {"count": 3, "tags": [], "creator": "pinter@p-squared.com", "attachment_id": 15641, "text": "Created attachment 15641\nreadout of phpinfo.php", "id": 77153, "time": "2005-07-10T20:11:48Z", "bug_id": 35680, "creation_time": "2005-07-10T20:11:48Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 35680, "attachment_id": 15660, "id": 77241, "time": "2005-07-13T03:01:31Z", "creator": "pinter@p-squared.com", "creation_time": "2005-07-13T03:01:31Z", "is_private": false, "text": "Created attachment 15660\nhttpd strace taken while problem is occuring\n\nThis attachment is a trace of the httpd parent process taken in the midst of\nthe problem occuring in real-time.\n\nThe child processes individually trace as:\n\n[root@server ~]# ps fax | grep httpd\n 1568 ?        Ss     1:02 /usr/sbin/httpd\n32523 ?        S      0:00  \\_ /usr/sbin/httpd\n32525 ?        S      0:00  \\_ /usr/sbin/httpd\n32527 ?        S      0:00  \\_ /usr/sbin/httpd\n  333 ?        S      0:00  \\_ /usr/sbin/httpd\n\n[root@server ~]# strace -p 32523\nProcess 32523 attached - interrupt to quit\nsemop(1343495, 0xd8378c, 1 <unfinished ...>\nProcess 32523 detached\n[root@server ~]# strace -p 32525\nProcess 32525 attached - interrupt to quit\npoll( <unfinished ...>\nProcess 32525 detached\n[root@server ~]# strace -p 32527\nProcess 32527 attached - interrupt to quit\nsemop(1343495, 0xd8378c, 1 <unfinished ...>\nProcess 32527 detached\n[root@server ~]# strace -p 333\nProcess 333 attached - interrupt to quit\nsemop(1343495, 0xd8378c, 1 <unfinished ...>\nProcess 333 detached\n\nDon't know if it's meaningful, but I noted the 'poll' condition on pid 32525\nand the odd number pid (333) for the last (4th) reserved child.\n\nWhile the error condition was still ongoing, I browsed to both 80 and 443 URL's\nand the once-per-second warnings immediately stopped. Now the scene looks like\nthis:\n\n[root@server ~]# ps fax | grep httpd\n  717 pts/0    R+     0:00\t    \\_ grep httpd\n 1568 ?        Ss     1:03 /usr/sbin/httpd\n  687 ?        S      0:00  \\_ /usr/sbin/httpd\n  688 ?        S      0:00  \\_ /usr/sbin/httpd\n  689 ?        S      0:00  \\_ /usr/sbin/httpd\n\nCorrelating the timestamp of the last warning message with the various httpd\naccess, error, ssl_access, ssl_error and ssl_request logs indicate the warnings\nstopped when a simple port 80 request was made, not the 443 request I made\nsubsequently."}, {"count": 5, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "The error is relatively harmless.\n\nThe code in question was changed slightly in 2.0.54.  The problem is that the\nserver has in this case created an AF_INET socket and then tried to connect it\nto an AF_INET6 address.\n\nsocket(PF_INET, SOCK_STREAM, IPPROTO_IP) = 14\n...\nconnect(14, {sa_family=AF_INET6, sin6_port=htons(443), inet_pton(AF_INET6, \"::\",\n&sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, 28) = -1 EAFNOSUPPORT (Address\nfamily not supported by protocol)\n\nI'm not quite sure why this happens.", "id": 77385, "time": "2005-07-18T15:04:24Z", "bug_id": 35680, "creation_time": "2005-07-18T15:04:24Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 35680, "text": "It seems the pathology of this problem has changed lately.\n\nTwo things have changed:\n\n   - the usual schwack of yum updates: now running on 2.6.12-1.1398_FC4\n   - I've changed SElinux from 'disabled' to 'permissive' (targetted) mode\n\nNow, the boatloads o'error messages have changed to:\n\n   (22)Invalid argument: connect to listener on [::]:443\n\n... still once per second, in large batches throughout the day.\n\nDespite my usual reticence on enabling 'enforcing' mode, I'll flip that switch\nand report if the scene changes.", "id": 77878, "time": "2005-07-31T18:50:12Z", "creator": "pinter@p-squared.com", "creation_time": "2005-07-31T18:50:12Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "text": "There's an FC4 SELinux policy setting which affects this, though it should cause\n\"Permission denied\" errors rather than \"Invalid argument\" errors if that's what\nyou're hitting.\n\n  setsebool httpd_can_network_connect=1\n\nto disable that, with -P to make the change permanent.", "attachment_id": null, "id": 77899, "creator": "jorton@redhat.com", "time": "2005-08-01T13:07:30Z", "bug_id": 35680, "creation_time": "2005-08-01T13:07:30Z", "is_private": false}, {"count": 8, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "Can someone give all the Listen statements in use in a configuration which is\nseeing this issue?", "id": 77928, "time": "2005-08-02T10:35:39Z", "bug_id": 35680, "creation_time": "2005-08-02T10:35:39Z", "is_private": false}, {"count": 9, "tags": [], "text": "Here's mine:\n\nListen 198.161.217.10:80\n\nhth,\n/p2", "attachment_id": null, "id": 77979, "creator": "pinter@p-squared.com", "time": "2005-08-03T01:18:30Z", "bug_id": 35680, "creation_time": "2005-08-03T01:18:30Z", "is_private": false}, {"count": 10, "tags": [], "creator": "pinter@p-squared.com", "attachment_id": null, "text": "And, from ssl.conf:\n\nListen 443", "id": 77980, "time": "2005-08-03T04:53:25Z", "bug_id": 35680, "creation_time": "2005-08-03T04:53:25Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 35680, "attachment_id": null, "text": "Thanks.  I'm having trouble reproducing this.\n\nCan you stop the server, then grab the strace output from:\n\n $ strace -ebind,socket /usr/sbin/httpd -X\n <ctrl-c>\n\nand attach that.\n", "id": 77994, "time": "2005-08-03T11:20:17Z", "creator": "jorton@redhat.com", "creation_time": "2005-08-03T11:20:17Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 35680, "attachment_id": 15871, "id": 78043, "time": "2005-08-04T02:10:15Z", "creator": "pinter@p-squared.com", "creation_time": "2005-08-04T02:10:15Z", "is_private": false, "text": "Created attachment 15871\nstrace -ebind,socket /usr/sbin/httpd -X"}, {"count": 13, "tags": [], "bug_id": 35680, "text": "The original error message has returned:\n\n[warn] (97)Address family not supported by protocol: connect to listener on [::]:443\n\nwith no changes other than a weekly 'yum update', which now has the box running\non 2.6.12-1.1447_FC4.\n\nHere's a snippet from httpd/error_log showing the error across the yum update\n(which included a reboot):\n\n[Thu Sep 01 18:11:26 2005] [warn] (22)Invalid argument: connect to listener on\n[::]:443\n[Thu Sep 01 18:11:27 2005] [warn] (22)Invalid argument: connect to listener on\n[::]:443\n[Thu Sep 01 18:11:28 2005] [warn] (22)Invalid argument: connect to listener on\n[::]:443\n[Thu Sep 01 18:11:29 2005] [warn] (22)Invalid argument: connect to listener on\n[::]:443\n[Thu Sep 01 21:09:35 2005] [notice] caught SIGTERM, shutting down\n[Thu Sep 01 21:14:11 2005] [notice] suEXEC mechanism enabled (wrapper:\n/usr/sbin/suexec)\n\n[Thu Sep 01 21:15:05 2005] [notice] Digest: generating secret for digest\nauthentication ...\n[Thu Sep 01 21:15:05 2005] [notice] Digest: done\n[Thu Sep 01 21:15:05 2005] [notice] LDAP: Built with OpenLDAP LDAP SDK\n[Thu Sep 01 21:15:05 2005] [notice] LDAP: SSL support unavailable\n[Thu Sep 01 21:15:06 2005] [notice] mod_python: Creating 4 session mutexes based\non 4 max processes and 0 max threads.\n[Thu Sep 01 21:15:15 2005] [notice] Apache/2.0.54 (Fedora) configured --\nresuming normal operations\n[Thu Sep 01 21:16:54 2005] [warn] (97)Address family not supported by protocol:\nconnect to listener on [::]:443\n[Thu Sep 01 21:16:55 2005] [warn] (97)Address family not supported by protocol:\nconnect to listener on [::]:443\n\nThis error continues once per second until:\n\n[Thu Sep 01 21:28:34 2005] [warn] (97)Address family not supported by protocol:\nconnect to listener on [::]:443\n[Thu Sep 01 21:28:35 2005] [warn] (97)Address family not supported by protocol:\nconnect to listener on [::]:443\n[Thu Sep 01 21:41:35 2005] [error] server reached MaxClients setting, consider\nraising the MaxClients setting\n\nI'm not sure if this MaxClients error is a new symptom.", "id": 79332, "time": "2005-09-02T16:03:26Z", "creator": "pinter@p-squared.com", "creation_time": "2005-09-02T16:03:26Z", "is_private": false, "attachment_id": null}, {"count": 14, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "Ahhh, this is a bug in the Fedora httpd package, I missed the fact that you were\nusing packages.  Please report bugs in packaged versions of httpd to the package\nvendor in the first instance; I've filed this as:\n\nhttps://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=167425", "id": 79335, "time": "2005-09-02T17:25:43Z", "bug_id": 35680, "creation_time": "2005-09-02T17:25:43Z", "is_private": false}]
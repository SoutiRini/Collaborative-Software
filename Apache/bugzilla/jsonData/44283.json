[{"count": 0, "text": "Tomcat 6.0.14 crashes unexpectedly on production server when using APR connector\nwith SSLEnabled. \nPlease look at Java HotSpot Log in attachment", "bug_id": 44283, "attachment_id": null, "id": 113070, "time": "2008-01-23T02:24:54Z", "creator": "gipsec@mail.ru", "creation_time": "2008-01-23T02:24:54Z", "tags": [], "is_private": false}, {"count": 1, "text": "Created attachment 21415\nJava HotSpot 1", "bug_id": 44283, "attachment_id": 21415, "id": 113071, "time": "2008-01-23T02:25:55Z", "creator": "gipsec@mail.ru", "creation_time": "2008-01-23T02:25:55Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "gipsec@mail.ru", "is_private": false, "text": "Created attachment 21416\nJava HotSpot log 2", "id": 113072, "time": "2008-01-23T02:26:52Z", "bug_id": 44283, "creation_time": "2008-01-23T02:26:52Z", "attachment_id": 21416}, {"count": 3, "tags": [], "bug_id": 44283, "attachment_id": null, "text": "In both cases it seems to be having problems in the openssl code.\n\nDid you build the libs from source and what versions are you using?", "id": 113302, "time": "2008-01-30T14:38:10Z", "creator": "markt@apache.org", "creation_time": "2008-01-30T14:38:10Z", "is_private": false}, {"count": 4, "tags": [], "creator": "cpierret@sparus-software.com", "text": "The only call in tomcat native component to SSL_Write is in\nsslnetwork.c:ssl_socket_send().\nSince the offset of failure is 4 in SSL_Write, it seems to me that SSL_Write may\nget a null or invalid pointer as parameter from ssl_socket_send() and crash\nwhile trying to dereference parameter pointer.\nEven if there is no certainty, it may really be an issue in tomcat native code \nand not in openssl.\nRecompiling libtcnative with debug symbols and running the jvm under debugger\nmay help ...\n\nThe simplest and quickest solution is to stop using APR and use standard HTTP\nconnector instead if it is possible (or NIO if you are bold :-).\n", "id": 113309, "attachment_id": null, "bug_id": 44283, "creation_time": "2008-01-30T19:57:46Z", "time": "2008-01-30T19:57:46Z", "is_private": false}, {"count": 5, "text": "(In reply to comment #3)\n> In both cases it seems to be having problems in the openssl code.\n> \n> Did you build the libs from source and what versions are you using?\n\nI had built it from source code (version of tomcat-native 1.1.10 and 1.1.12).\nWith both versions of tomcat-native issue reproduces.  \nUpgrading to OpenSSL version 0.98g didn't help.\n \n", "bug_id": 44283, "attachment_id": null, "id": 113311, "time": "2008-01-31T01:25:33Z", "creator": "gipsec@mail.ru", "creation_time": "2008-01-31T01:25:33Z", "tags": [], "is_private": false}, {"count": 6, "text": "(In reply to comment #4)\n> The only call in tomcat native component to SSL_Write is in\n> sslnetwork.c:ssl_socket_send().\n> Since the offset of failure is 4 in SSL_Write, it seems to me that SSL_Write may\n> get a null or invalid pointer as parameter from ssl_socket_send() and crash\n> while trying to dereference parameter pointer.\n> Even if there is no certainty, it may really be an issue in tomcat native code \n> and not in openssl.\n> Recompiling libtcnative with debug symbols and running the jvm under debugger\n> may help ...\n> \n> The simplest and quickest solution is to stop using APR and use standard HTTP\n> connector instead if it is possible (or NIO if you are bold :-).\n \nThank you for your answer. But it's not a variant to switch to standard HTTP in\nmy case because i am using Comet in my project and i really need scalable\napplication. \nWith NIO situation is very strange because when i am using NIO connector, server\nCPU usage unexpectedly grows to 100% until restarted (I am using Java 1.6 u4 so\nsome bugs with selector fixed there but it didn't help me). \n", "bug_id": 44283, "attachment_id": null, "id": 113312, "time": "2008-01-31T01:33:21Z", "creator": "gipsec@mail.ru", "creation_time": "2008-01-31T01:33:21Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 44283, "attachment_id": null, "text": "upon review, the NIO issues are resolved in 6.0.16", "id": 113327, "time": "2008-01-31T15:51:40Z", "creator": "fhanik@apache.org", "creation_time": "2008-01-31T15:51:40Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 44283, "attachment_id": null, "id": 113356, "time": "2008-02-01T15:34:39Z", "creator": "remm@apache.org", "creation_time": "2008-02-01T15:34:39Z", "is_private": false, "text": "It looks to me like you are doing asynchronous writes to the output stream, and\ncould be writing after the request has ended its processing."}, {"count": 9, "tags": [], "creator": "markt@apache.org", "text": "Based on Remy's and Filip's comments and the lack of follow up from the OP, I am closing this as fixed.", "id": 114790, "attachment_id": null, "bug_id": 44283, "creation_time": "2008-03-19T16:18:39Z", "time": "2008-03-19T16:18:39Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "ed.randall@ingenotech.com", "text": "When using JDK1.2.2 and Apache 1.3 connected to Tomcat via mod_jk/AJP13, \nthe servlet hangs and you get the following error:-\n\njava.lang.NoSuchMethodError: java.net.Socket: method setKeepAlive(Z)V not found\n\tat org.apache.ajp.tomcat4.Ajp13Connector.run(Compiled Code)\n\tat java.lang.Thread.run(Thread.java:479)\n\nTomcat 4 claims to work on any platform using JDK1.2 or higher;  Unfortunately\nthe call to Socket.setKeepAlive prevents this, since setKeepAlive is a method\nthat only came into existance with JDK1.3, this causes a problem on platforms\nfor which JDK1.2 is the best available or where maybe JDK1.2 has to be used for\nsome other reason.\n\nI have successfully tested the following patch to \njakarta-tomcat-connectors-4.1.27-src/\njk/java/org/apache/ajp/tomcat4/Ajp13Connector.java \nwith JDKs 1.2.2, 1.3 and 1.4, whilst the source doesn't compile on 1.2, it will\nrun successfully :-\n\n*** Ajp13Connector.java Thu Jul 31 18:30:40 2003\n--- Ajp13Connector.java.new     Wed Oct  8 16:42:22 2003\n***************\n*** 857,862 ****\n--- 857,878 ----\n       */\n      public void run() {\n  \n+         boolean hasSOKeepAlive = false;\n+         try\n+         {\n+             java.lang.reflect.Method m = Socket.class.getMethod\n(\"setKeepAlive\", new Class[] { boolean.class } );\n+             if (m != null)\n+             {\n+                 hasSOKeepAlive = true;  \n+             }          \n+         }\n+         catch(Exception ex)\n+         {\n+         }\n+         \n+         System.out.println(\"hasSOKeepAlive = \"+hasSOKeepAlive);\n+ \n+         \n          // Loop until we receive a shutdown command\n        while (!stopped) {\n  \n***************\n*** 892,897 ****\n--- 908,914 ----\n                  else\n                        socket.setSoLinger(true, connectionLinger);\n                  \n+                 if (hasSOKeepAlive)\n                      socket.setKeepAlive(true);", "id": 45253, "time": "2003-10-08T15:50:29Z", "bug_id": 23675, "creation_time": "2003-10-08T15:50:29Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 23675, "is_private": false, "text": "Removed the setKeepAlive since the native side will does it\nif required", "id": 45272, "time": "2003-10-09T10:12:46Z", "creator": "hgomez@apache.org", "creation_time": "2003-10-09T10:12:46Z", "attachment_id": null}]
[{"attachment_id": 23823, "tags": [], "bug_id": 47381, "is_private": false, "count": 0, "id": 128011, "time": "2009-06-17T04:28:10Z", "creator": "Gilbert.Rebhan@huk-coburg.de", "creation_time": "2009-06-17T04:28:10Z", "text": "Created attachment 23823\nXmlProperty.java.diff.txt\n\nDiscovered a difference related to the handling of txtproperties and xmlproperties after upgrading from ant 1.6.5 to ant 1.7.1\n\n**Test 1**\n\n* props.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<root>\n  <xmlkey></xmlkey>\n  <xmlfoo>bar</xmlfoo>\n</root>\n\n* props.txt\ntxtfoo=bar\ntxtkey=\n\n*TestScript\n<project name=\"foobar\" default=\"main\" basedir=\".\">\n\n  <!-- // Taskdefs -->\n  <!-- Import AntContrib -->\n  <taskdef resource=\"net/sf/antcontrib/antlib.xml\" />\n  <!-- Taskdefs // -->\n\n  <!-- // Properties -->\n  <property file=\"props.txt\" />\n  <xmlproperty file=\"props.xml\" keeproot=\"false\" />\n  <!-- Properties // -->\n\n  <target name=\"main\">\n\n    <echo>${ant.version}</echo>\n    <echo>$${xmlkey} == ${xmlkey}</echo>\n    <echo>$${txtkey} == ${txtkey}</echo>\n\n    <if>\n      <isset property=\"xmlkey\" />\n      <then>\n        <echo>xmlkey set</echo>\n      </then>\n      <else>\n        <echo>xmlkey not set</echo>\n      </else>\n    </if>\n\n    <if>\n      <isset property=\"txtkey\" />\n      <then>\n        <echo>txtkey set</echo>\n      </then>\n      <else>\n        <echo>txtkey not set</echo>\n      </else>\n    </if>\n\n  </target>\n</project>\n\n\n*Output\n\n[echo] Apache Ant version 1.6.5 compiled on June 2 2005\n[echo] ${xmlkey} == ${xmlkey}\n[echo] ${txtkey} == \n[echo] xmlkey not set\n[echo] txtkey set\n\n[echo] Apache Ant version 1.7.0 compiled on December 13 2006\n[echo] ${xmlkey} == \n[echo] ${txtkey} == \n[echo] xmlkey set\n[echo] txtkey set\n\n[echo] Apache Ant version 1.7.1 compiled on June 27 2008\n[echo] ${xmlkey} == \n[echo] ${txtkey} == \n[echo] xmlkey set\n[echo] txtkey set\n\nthe different handling of empty txt and xml properties seems\nto be fixed in conjunction with Bug 26286 - XmlProperty: empty element semantic problems \n\nbut Test 2 shows another problem when xmlpropertyfile contains a node which has only\n1 or more spaces, which is no problem in a txtpropertyfile\n\n** Test 2 **\n\n* props.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<root>\n  <xmlkey> </xmlkey>\n  <xmlfoo>bar</xmlfoo>\n</root>\n\n* props.txt\ntxtfoo=bar\ntxtkey=*blank*\n\n*Output\n\n[echo] Apache Ant version 1.6.5 compiled on June 2 2005\n[echo] ${xmlkey} == ${xmlkey}\n[echo] ${txtkey} == \n[echo] xmlkey not set\n[echo] txtkey set\n\n[echo] Apache Ant version 1.7.0 compiled on December 13 2006\n[echo] ${xmlkey} == ${xmlkey}\n[echo] ${txtkey} == \n[echo] xmlkey not set\n[echo] txtkey set\n\n[echo] Apache Ant version 1.7.1 compiled on June 27 2008\n[echo] ${xmlkey} == ${xmlkey}\n[echo] ${txtkey} == \n[echo] xmlkey not set\n[echo] txtkey set\n\nwhich is wrong, as value of xmlkey is also = \" \" like value of txtkey\n\nFixed line 469 in org/apache/tools/taskdefs/XmlProperty\n\n<   if (nodeText.trim().length() != 0 || emptyNode) {\n---\n>   if (nodeText.trim().length() >= 0 || emptyNode) {\n\nand it works as expected =\n\n[echo] Apache Ant version 1.7.1 compiled on June 27 2008\n[echo] ${xmlkey} == \n[echo] ${txtkey} == \n[echo] xmlkey set\n[echo] txtkey set"}, {"count": 1, "tags": [], "text": "just checked on my private machine - OpenSUSE 11.1/64bit\nwith jdk 1.5.0_18 and jdk 1.6.0_13 and the same propertyfiles,\nmeans <xmlkey> <xmlkey/> and txtkey=*blank*\nbut the patch has no impact, still the same output !?\n\nUsing a \" \" property may not be of practical importance, but the\nbehaviour should be the same for txtproperty and xmlproperty,\nit is, but diametrical =\n\non my LinuxBox (jdk 5 +6, the same behavior already with ant 1.6.5)\n[echo] ${xmlkey} == ${xmlkey}\n[echo] ${txtkey} == ${txtkey}\n[echo] xmlkey not set\n[echo] txtkey not set\n\nand on Windows and AIX (jdk 5 + 6)\n[echo] ${xmlkey} ==\n[echo] ${txtkey} ==\n[echo] xmlkey set\n[echo] txtkey set\n\nmaybe a 32bit <> 64bit issue ?\nRight now i have no 32bit Linux around to check ..\n\nCan someone confirm my investigations ?", "attachment_id": null, "id": 128032, "creator": "Gilbert.Rebhan@huk-coburg.de", "time": "2009-06-17T13:45:49Z", "bug_id": 47381, "creation_time": "2009-06-17T13:45:49Z", "is_private": false}]
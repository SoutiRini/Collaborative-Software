[{"count": 0, "tags": [], "creator": "ivannikolchov@gmail.com", "attachment_id": null, "is_private": false, "id": 181932, "time": "2015-03-21T18:03:59Z", "bug_id": 57733, "creation_time": "2015-03-21T18:03:59Z", "text": "The cause of the problem is the fix for bug #57190 for version 8.0.16 (https://bz.apache.org/bugzilla/show_bug.cgi?id=57190) \n\nIt is not present in version 8.0.15\n\nI have the following configuration running on Tomcat 8.0.20:\n\nC:\\tomcat\n   conf\n     server.xml\n     context.xml\n   webapps\n     app\n   ......\nC:\\external\n     app3\n        web\n     app4\n        web\nIn context.xml I have <Context crossContext=\"true\"> .... </Context>\n\nAnd in server.xml:\n ..........\n <Host name=\"host.com\"  appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\">\n    <Context \n      docBase=\"C:\\external\\app3\\web\" \n      path=\"\" \n      crossContext=\"true\"\n      reloadable=\"true\" />\n\n    <Context \n      crossContext=\"true\"\n      docBase=\"C:\\external\\app4\\web\" \n      path=\"/app4\"\n      reloadable=\"true\" />\n </Host>\nObtaining the Context of /app works as espected:\n\nrequest.getServletContext().getContext(\"/app\") is not null.\n\nHowever, requesting the Context of the root app (app3) with:\n\nrequest.getServletContext().getContext(\"/\") ALWAYS returns null.\n\nAfter some debugging found out that this is a regression caused by the fix for #57190  in org.apache.catalina.core.ApplicationContext#getContext(String)\n\nhttp://grepcode.com/file/repo1.maven.org/maven2/org.apache.tomcat/tomcat-catalina/8.0.17/org/apache/catalina/core/ApplicationContext.java#286\n\non line 286 we have\n284             // Must be an exact match. It is no good returning the ROOT\n285             // context if the caller is looking for \"/something-else\"\n286             if (mappingData.context.getPath().equals(uri)) {\n287                 child = mappingData.context;\n288             }\n\nHere uri is \"/\" and mappingData.context.getPath() is \"\" hence the null result.\n\nProbably it should be:\nString contextPath = mappingData.context.getPath();\nif (contextPath.equals(uri) || contextPath.isEmpty() && uri.equals(\"/\")) {\n....\n}"}, {"count": 1, "tags": [], "bug_id": 57733, "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of bug 57645 ***", "id": 181934, "time": "2015-03-21T22:06:06Z", "creator": "chris@christopherschultz.net", "creation_time": "2015-03-21T22:06:06Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 57733, "text": "Bug is still existing on tomcat 8.0.30 (and probably tomcat 7.x)\nI debug source code of tomcat and find, that ROOT context (with empty \"path\" in configuration server.xml) is added to ContainerBase class (HashMap name children) in key \"\", but i suppoust it shoud add ROOT context with key \"/\". Bug is probably in line 2036 in class org.apache.catalina.core.StandardContext, when set path.\n \nWhen i want to get root context (class ApplicationContext.getContext(\"/\")) i can't call it with empty string parameter, because method check param and return null (!uri.startsWith(\"/\")). When I call it with param \"/\" , I have null. \n\nPlease check it - it is very important for us.", "id": 187208, "time": "2015-12-29T11:31:49Z", "creator": "tomasz.macnar@comarch.pl", "creation_time": "2015-12-29T11:31:49Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 57733, "text": "The following JSP snippet works as expected:\n\n<%\nout.print(\"[\" + request.getServletContext().getContext(\"/\").getContextPath() + \"]\");\n%>\n\nIf you need assistance debugging why your application doesn't work then please use the users mailing list.\n\n*** This bug has been marked as a duplicate of bug 57645 ***", "id": 187225, "time": "2015-12-29T17:25:35Z", "creator": "markt@apache.org", "creation_time": "2015-12-29T17:25:35Z", "is_private": false, "attachment_id": null}, {"count": 4, "text": "Ok i agree, that this code work OK.\nBut my case is other. I get ServletContext from servlet. Hire is my example:\n\npublic class TestServlet extends HttpServlet {\n\n    @Override\n    public void init() throws ServletException {\n\n        ServletContext servletContext = getServletContext();\n\n        System.out.println(\"Servlet START: \" + servletContext.getContextPath());\n\n        String[] contextTab = { \"/\", \"/app1\", \"/app2\" };\n\n        for (String con : contextTab) {\n            System.out.println(\"Context \" + con + \" : \" + servletContext.getContext(con));\n        }\n    }\n}\n\nAnd in context \"/\" always I have null. In server.xml i have configuration:\n<Context path=\"\" docBase=\"${catalina.base}/webapps/ROOT\" crossContext=\"true\" />\n<Context path=\"/app1\" docBase=\"${catalina.base}/webapps/app1\" crossContext=\"true\" />\n<Context path=\"/app2\" docBase=\"${catalina.base}/webapps/app2\" crossContext=\"true\" />\n\nAnd the output is:\nServlet START: /app1\nContext / : null\nContext /app1 : null\nContext /app2 : null\n\nServlet START: /app2\nContext / : null\nContext /app1 : org.apache.catalina.core.ApplicationContextFacade@8c6fb37\nContext /app2 : null\n\nServlet is added to app1 and app2.", "bug_id": 57733, "attachment_id": null, "id": 187252, "time": "2015-12-30T09:31:07Z", "creator": "tomasz.macnar@comarch.pl", "creation_time": "2015-12-30T09:31:07Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 57733, "text": "Use the users mailing list.\n\nIf you continue to ignore advice you are given and re-open this bug with an unrelated question then your Bugzilla account will be disabled.\n\n*** This bug has been marked as a duplicate of bug 57645 ***", "id": 187267, "time": "2015-12-30T19:32:14Z", "creator": "markt@apache.org", "creation_time": "2015-12-30T19:32:14Z", "is_private": false, "attachment_id": null}]
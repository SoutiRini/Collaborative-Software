[{"count": 0, "tags": [], "bug_id": 40151, "attachment_id": null, "text": "URLs of the form http://www.example.com/dir/;jsessionid=328s1t1289qrt (where\nyou'd expect the welcome file to be served up) don't work with mod_jk and Apache\n2.2.3. Apache returns a 404 and adds the following to the error log: \nFile does not exist: /wwwroot/dir/;jsessionid=328s1t1289qrt\n\nWithout the jsessionid part (http://www.example.com/dir/) works fine.\n\nI've tried this against mod_jk from Tomcat connectors 1.2.18.", "id": 91762, "time": "2006-08-01T11:23:14Z", "creator": "damon@mahuika.co.nz", "creation_time": "2006-08-01T11:23:14Z", "is_private": false}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "Which Jk directives did you use, especially JkMount etc.?", "id": 91915, "time": "2006-08-05T16:55:36Z", "bug_id": 40151, "creation_time": "2006-08-05T16:55:36Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 40151, "attachment_id": null, "text": "Here's all my Jk directives from httpd.conf:\n\nJkWorkersFile /opt/motorweb/conf/jetty/workers.properties\nJkMount /*.jsp motorweb\nJkMount /action/* motorweb\nJkMount /reference/* motorweb\nJkMount /robots.txt motorweb\nJkMount /error/Send404 motorweb\nJkMount / motorweb\nJkEnvVar SSL_CLIENT_S_DN NONE\n\nAnd I use the following to serve up directories:\n\nDirectoryIndex welcome.jsp", "id": 91992, "time": "2006-08-07T02:26:29Z", "creator": "damon@mahuika.co.nz", "creation_time": "2006-08-07T02:26:29Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 40151, "attachment_id": null, "text": "I swear that adding something like this was working for me 2 weeks ago, but now\nit doesn't work, I think I'm going crazy! Can you try adding this to your Apache\nconfig?\n\n<LocationMatch \"/.*;jsessionid=.*\">\n\tJkMount motorweb\n</LocationMatch>\n", "id": 93258, "time": "2006-09-09T01:10:50Z", "creator": "drees76@gmail.com", "creation_time": "2006-09-09T01:10:50Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "drees76@gmail.com", "text": "Here's a hack so that at least you don't get a 404, but you will lose your\nsession if the client was depending on the URL rewrite with jsessionid:\n\nRewriteEngine On\nRewriteRule ^(/.*);jsessionid=.*$ $1 [PT]\n\nIt just strips off the jsessionid for any directory request which has it and\npasses the URL through.", "count": 4, "id": 93556, "time": "2006-09-13T23:49:25Z", "bug_id": 40151, "creation_time": "2006-09-13T23:49:25Z", "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 40151, "text": "See the explanation on tomcat dev list.\nThe SetHandler jakarta-servlet works with Apache2+\n\n<LocationMatch \"/.*;jsessionid=.*\">\n  SetHandler jakarta-servlet\n</LocationMatch>\n\nIn that case your worker list should look like:\nworker.list=motorweb[,...]", "id": 93559, "time": "2006-09-14T05:55:02Z", "creator": "mturk@apache.org", "creation_time": "2006-09-14T05:55:02Z", "tags": [], "is_private": false}, {"attachment_id": null, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "First of all, your problem description is inconsistent. The details are important.\n\nYou gave an example URL without a config, and afterwards a config, but the\nexample URL does not fit to this config. So we have to guess, which URL you\nreally mean.\n\nI canot reproduce the problem, and I do't understand why any config workaround\nshould be necessary.\n\nI used Apache 2.2.3 with mod_jk 1.2.18 and the following configuration:\n\nJkWorkersFile conf/workers.properties\nJkShmFile run/mod_jk.shm\nJkLogFile logs/mod_jk.log\nJkLogLevel trace\nJkMount / motorweb\nJkMount /*.jsp motorweb\n\nand in workers.properties:\n\nworker.list=motorweb\nworker.motorweb.host=mytchost\nworker.motorweb.port=28313\nworker.motorweb.type=ajp13\n\nThen I added an index.jsp into the top level directory of the ROOT context and\nsend the following URL to apache:\n\n'fraxinus:8080/;jsessionid=a'\n\nAnd voila: it returned the correct index.jsp. The mod_jk log file correctly showed:\n\n[Thu Sep 14 19:50:15 2006] [5572:63840] [trace]\nmap_uri_to_worker::jk_uri_worker_map.c (481): enter\n[Thu Sep 14 19:50:15 2006] [5572:63840] [debug]\nmap_uri_to_worker::jk_uri_worker_map.c (502): Removing Session path\n';jsessionid=a' URI '/'\n[Thu Sep 14 19:50:15 2006] [5572:63840] [debug]\nmap_uri_to_worker::jk_uri_worker_map.c (508): Attempting to map URI\n'/;jsessionid=a' from 2 maps\n[Thu Sep 14 19:50:15 2006] [5572:63840] [debug]\nmap_uri_to_worker::jk_uri_worker_map.c (520): Attempting to map context URI '/*.jsp'\n[Thu Sep 14 19:50:15 2006] [5572:63840] [debug]\nmap_uri_to_worker::jk_uri_worker_map.c (520): Attempting to map context URI '/'\n[Thu Sep 14 19:50:15 2006] [5572:63840] [debug]\nmap_uri_to_worker::jk_uri_worker_map.c (545): Found an exact match motorweb -> /\n[Thu Sep 14 19:50:15 2006] [5572:63840] [trace]\nmap_uri_to_worker::jk_uri_worker_map.c (548): exit\n[Thu Sep 14 19:50:15 2006] [5572:63840] [trace] jk_handler::mod_jk.c (1778): enter\n[Thu Sep 14 19:50:15 2006] [5572:63840] [debug] jk_handler::mod_jk.c (1832):\nInto handler jakarta-servlet worker=motorweb r->proxyreq=0\n[Thu Sep 14 19:50:15 2006] [5572:63840] [trace]\nwc_get_worker_for_name::jk_worker.c (101): enter\n[Thu Sep 14 19:50:15 2006] [5572:63840] [debug]\nwc_get_worker_for_name::jk_worker.c (111): found a worker motorweb\n[Thu Sep 14 19:50:15 2006] [5572:63840] [trace]\nwc_get_worker_for_name::jk_worker.c (113): exit\n[Thu Sep 14 19:50:15 2006] [5572:63840] [trace] wc_maintain::jk_worker.c (287):\nenter\n[Thu Sep 14 19:50:15 2006] [5572:63840] [debug] wc_maintain::jk_worker.c (301):\nMaintaining worker motorweb\n[Thu Sep 14 19:50:15 2006] [5572:63840] [trace] ajp_maintain::jk_ajp_common.c\n(2198): enter\n[Thu Sep 14 19:50:15 2006] [5572:63840] [trace] ajp_maintain::jk_ajp_common.c\n(2206): exit\n[Thu Sep 14 19:50:15 2006] [5572:63840] [trace] wc_maintain::jk_worker.c (312): exit\n[Thu Sep 14 19:50:15 2006] [5572:63840] [debug] init_ws_service::mod_jk.c (531):\nService protocol=HTTP/1.1 method=GET host=(null) addrr=192.168.0.69\nname=fraxinus port=8080 auth=(null) user=(null) laddr=192.168.0.69\nraddr=192.168.0.69\n\nSo if you can reproduce your problem, please describe correctly your config\nincluding workers.properties, and your test case including expected and observed\nbehaviour. Finaly please attach the jk log file in trace level.\n\nI keep this ticket as invalid as long as there is no other information available.", "count": 6, "id": 93596, "time": "2006-09-14T17:55:06Z", "bug_id": 40151, "creation_time": "2006-09-14T17:55:06Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 40151, "attachment_id": null, "id": 93599, "time": "2006-09-14T18:19:36Z", "creator": "drees76@gmail.com", "creation_time": "2006-09-14T18:19:36Z", "is_private": false, "text": "(In reply to comment #6)\n> JkMount / motorweb\n> JkMount /*.jsp motorweb\n>\n> Then I added an index.jsp into the top level directory of the ROOT context and\n> send the following URL to apache:\n> \n> 'fraxinus:8080/;jsessionid=a'\n\nThat configuration works for your example, but the reported did not use JkMount\n/ motorweb. While that correctly gets links to / which are rewritten working,\nyou would have to add a JkMount /<dirname>/ motorweb for each directory in your\ndocument root. So for example:\n\n'fraxinus:8080/somedir/;jsessionid=a'\n\nWill return a 404.\n\nI am not the original reporter, but I have the same problem which I have been\ndiscussing on the dev list.\n\nPerhaps this should be left closed and a new bug opened for an enhancement\nrequest to add functionality to mod_jk to allow you to map all URLs with\njsessionid to it."}, {"count": 8, "tags": [], "bug_id": 40151, "attachment_id": null, "text": "The following suggestion doesn't work for me:\n\n<LocationMatch \"/.*;jsessionid=.*\">\n\tJkMount motorweb\n</LocationMatch>\n\nThe hack that involves a RewriteRule isn't really suitable as I need the\nsessions in these pages.\n\nThe following suggestion is working fine:\n\n<LocationMatch \"/.*;jsessionid=.*\">\n  SetHandler jakarta-servlet\n</LocationMatch>\n\nI'm happy for this issue to be closed if an enhancement is opened for mod_jk to\nperform something similar as suggested by David Rees.", "id": 93730, "time": "2006-09-18T10:38:24Z", "creator": "damon@mahuika.co.nz", "creation_time": "2006-09-18T10:38:24Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 40151, "attachment_id": null, "text": "Have you seen the last checkin's from Rainer?\n\nHe has fix that issue. Please, test with newst version http://tomcat.apache.org/dev/dist/tomcat-\nconnectors/jk/source/jk-1.2.19/\n\nPeter\n", "id": 93731, "time": "2006-09-18T10:44:31Z", "creator": "pr@objektpark.de", "creation_time": "2006-09-18T10:44:31Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 40151, "attachment_id": null, "text": "I can confirm that 1.2.19 provides a good solution to the jsessionid problem in\nmy  setup.\n\nDamon, will you try adding this to your config?\n\n<LocationMatch \"/.*;jsessionid=.*\">\n SetEnv JK_WORKER_NAME motorweb\n SetHandler jakarta-servlet\n</LocationMatch>", "id": 93758, "time": "2006-09-18T22:07:04Z", "creator": "drees76@gmail.com", "creation_time": "2006-09-18T22:07:04Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 40151, "attachment_id": null, "text": "I had a look through the 1.2.19 change log and couldn't find anything that\nseemed relevant. \n\nI already have the following with 1.2.18 which works:\n\n<LocationMatch \"/.*;jsessionid=.*\">\n SetHandler jakarta-servlet\n</LocationMatch>\n\nI can add \"SetEnv JK_WORKER_NAME motorweb\" to it. I presume this is in case I\nhave more than one worker in my worker.list? I only have the one worker\n\"motorweb\" at present.\n\nIs the above intended to be the final solution to this problem?", "id": 93759, "time": "2006-09-18T22:20:06Z", "creator": "damon@mahuika.co.nz", "creation_time": "2006-09-18T22:20:06Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 40151, "attachment_id": null, "text": "(In reply to comment #11)\n> I can add \"SetEnv JK_WORKER_NAME motorweb\" to it. I presume this is in case I\n> have more than one worker in my worker.list?\n\nYes, that is correct.\n\n> I only have the one worker \"motorweb\" at present.\n> Is the above intended to be the final solution to this problem?\n\nI think so!", "id": 93761, "time": "2006-09-18T22:25:27Z", "creator": "drees76@gmail.com", "creation_time": "2006-09-18T22:25:27Z", "is_private": false}, {"count": 13, "tags": [], "creator": "smovva03@hotmail.com", "text": "Hi, \nNOTE: I am not the reporter of the bug. I want to add another scenario for the \nsame issue.\nI had a similar issue where tomcat returned 404 when there was ;jsessionid= in \nthe URL. I was using mod_jk 1.2.14 and upgraded to 1.2.20 and expected the \nissue to be fixed but the upgrade did not fix the issue.\nThe \"gotcha\" in my case was I had JkOptions +ForwardURIEscaped set and when I \nremoved this option, I got the expected results even without the \n<LocationMatch> configuration.\nHope this helps some lost soul trying to figure this out.\nThanks,\nSudhir Movva.", "id": 99393, "time": "2007-02-14T13:46:54Z", "bug_id": 40151, "creation_time": "2007-02-14T13:46:54Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "attachment_id": null, "bug_id": 24921, "text": "Context: org.apache.batik.svggen.SVGGeneratorContext \n\nThe problem arises after calling SVGGraphics2D.transform(AffineTransform) with\nan AffineTransform that contains non-whole double values. When drawing onto the\nSVGGraphics2D object, the double values of the transform are converted into\nStrings at SVGGeneratorContext.doubleString(double value). Because the values\nare not whole, the method uses a java.text.DecimalFormat to format the String. A\nNullPointerException is thrown because the decimalFormat instance variable is null. \n\nThe reason and solution are described below:\n\nThere is a static array decimalFormats[] in SVGGeneratorContext which is set in\nan initialisation block which is not static:\n\n    protected static DecimalFormat decimalFormats[] = new DecimalFormat[13];\n\n    {\n        decimalFormats[0] = new DecimalFormat(\"#\", dsf);\n\n        String format = \"#.\";\n        for (int i=0; i<=12; i++) {\n            format += \"#\";\n            decimalFormats[i] = new DecimalFormat(format, dsf);\n        }\n    }\n\nThere is an instance variable decimalFormat which is declared with an initial\nvalue derived from that decimalFormats array:\n\n    protected DecimalFormat decimalFormat = decimalFormats[3];\n\nThe non-static block which initialises the static decimalFormats is obviously\ninvoked *after* the first instance's decimalFormat has been set, meaning that\nthis instance's decimalFormat will be null (unless and until setPrecision() is\ncalled on that instance, when decimalFormat is set again).\n\nThe solution is to make the initialisation block static (which it should be\nanyway, seeing as how it intialises a static variable) i.e:\n\n    protected DecimalFormat decimalFormat = decimalFormats[3];\n\n    protected static DecimalFormatSymbols dsf \n        = new DecimalFormatSymbols(Locale.US);\n\n    protected static DecimalFormat decimalFormats[] = new DecimalFormat[13];\n\n    // Now this is static, it's called when the class is loaded, so \n    // the decimalFormat instance variable won't be null\n    static {\n        decimalFormats[0] = new DecimalFormat(\"#\", dsf);\n\n        String format = \"#.\";\n        for (int i=0; i<=12; i++) {\n            format += \"#\";\n            decimalFormats[i] = new DecimalFormat(format, dsf);\n        }\n    }", "id": 47931, "time": "2003-11-22T17:28:46Z", "creator": "simon.turner@zen.co.uk", "creation_time": "2003-11-22T17:28:46Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "This appears to already be fixed in CVS.\nLet me know if you agree (you can use viewCVS, see the CVS page\nfor Batik, if you don't want to deal with CVS Directly).", "attachment_id": null, "id": 47935, "creator": "deweese@apache.org", "time": "2003-11-22T19:41:11Z", "bug_id": 24921, "creation_time": "2003-11-22T19:41:11Z", "is_private": false}]
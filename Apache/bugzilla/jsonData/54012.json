[{"count": 0, "tags": [], "bug_id": 54012, "attachment_id": 29485, "text": "Created attachment 29485\nPatch for org.apache.jasper.tagplugins.jstl.core.Set.java\n\nThe code generated by the following code from \" org.apache.jasper.tagplugins.jstl.core.Set\" can't work in Tag Files.\n\nThere is no \"PageContext\" in tag file. So this should check \"isTagFile\".\n\n            String strVar = ctxt.getConstantAttribute(\"var\");\n            ctxt.generateJavaSource(\"if(null != \" + resultName + \"){\");\n            ctxt.generateJavaSource(\"    pageContext.setAttribute(\\\"\" + strVar + \"\\\",\" + resultName + \",\" + iScope + \");\");\n            ctxt.generateJavaSource(\"} else {\");\n            if(hasScope){\n                ctxt.generateJavaSource(\"    pageContext.removeAttribute(\\\"\" + strVar + \"\\\",\" + iScope + \");\");\n            }else{\n                ctxt.generateJavaSource(\"    pageContext.removeAttribute(\\\"\" + strVar + \"\\\");\");\n            }\n            ctxt.generateJavaSource(\"}\");", "id": 162775, "time": "2012-10-16T09:01:56Z", "creator": "xshao@ebay.com", "creation_time": "2012-10-16T09:01:56Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 54012, "attachment_id": 29485, "text": "Comment on attachment 29485\nPatch for org.apache.jasper.tagplugins.jstl.core.Set.java\n\n>Index: org/apache/jasper/tagplugins/jstl/core/Set.java\n>===================================================================\n>--- org/apache/jasper/tagplugins/jstl/core/Set.java\t(revision 1370136)\n>+++ org/apache/jasper/tagplugins/jstl/core/Set.java\t(working copy)\n>@@ -70,14 +70,20 @@\n>         \n>         //if the attribute var has been specified then assign the result to the var;\n>         if(hasVar){\n>+            String jspCtxt = null;\n>+            if (ctxt.isTagFile()) {\n>+                jspCtxt = \"this.getJspContext()\";\n>+            } else {\n>+                jspCtxt = \"_jspx_page_context\";\n>+            }\n>             String strVar = ctxt.getConstantAttribute(\"var\");\n>             ctxt.generateJavaSource(\"if(null != \" + resultName + \"){\");\n>-            ctxt.generateJavaSource(\"    pageContext.setAttribute(\\\"\" + strVar + \"\\\",\" + resultName + \",\" + iScope + \");\");\n>+            ctxt.generateJavaSource(\"    \"+jspCtxt+\".setAttribute(\\\"\" + strVar + \"\\\",\" + resultName + \",\" + iScope + \");\");\n>             ctxt.generateJavaSource(\"} else {\");\n>             if(hasScope){\n>-                ctxt.generateJavaSource(\"    pageContext.removeAttribute(\\\"\" + strVar + \"\\\",\" + iScope + \");\");\n>+                ctxt.generateJavaSource(\"    \"+jspCtxt+\".removeAttribute(\\\"\" + strVar + \"\\\",\" + iScope + \");\");\n>             }else{\n>-                ctxt.generateJavaSource(\"    pageContext.removeAttribute(\\\"\" + strVar + \"\\\");\");\n>+                ctxt.generateJavaSource(\"    \"+jspCtxt+\".removeAttribute(\\\"\" + strVar + \"\\\");\");\n>             }\n>             ctxt.generateJavaSource(\"}\");\n>", "id": 162776, "time": "2012-10-16T09:02:18Z", "creator": "xshao@ebay.com", "creation_time": "2012-10-16T09:02:18Z", "is_private": false}, {"count": 2, "text": "Created attachment 29486\nPatch for Compiler.java", "creator": "xshao@ebay.com", "attachment_id": 29486, "id": 162777, "time": "2012-10-16T09:02:40Z", "bug_id": 54012, "creation_time": "2012-10-16T09:02:40Z", "tags": [], "is_private": false}, {"count": 3, "text": "Created attachment 29487\nPatch for PageInfo.java", "creator": "xshao@ebay.com", "attachment_id": 29487, "id": 162778, "time": "2012-10-16T09:03:03Z", "bug_id": 54012, "creation_time": "2012-10-16T09:03:03Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "xshao@ebay.com", "text": "Created attachment 29488\nPatch for TagPluginContext.java", "id": 162779, "time": "2012-10-16T09:03:26Z", "bug_id": 54012, "creation_time": "2012-10-16T09:03:26Z", "is_private": false, "attachment_id": 29488}, {"count": 5, "tags": [], "bug_id": 54012, "text": "Created attachment 29489\nPatch for TagPluginManager.java", "id": 162780, "time": "2012-10-16T09:03:47Z", "creator": "xshao@ebay.com", "creation_time": "2012-10-16T09:03:47Z", "is_private": false, "attachment_id": 29489}, {"count": 6, "attachment_id": null, "bug_id": 54012, "text": "Thanks for the patch. I applied a slightly modified version to trunk and 7.0.x. I also added a test case to trunk. The fix will be in 7.0.33 onwards.", "id": 162925, "time": "2012-10-25T12:04:31Z", "creator": "markt@apache.org", "creation_time": "2012-10-25T12:04:31Z", "tags": [], "is_private": false}]
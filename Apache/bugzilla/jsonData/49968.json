[{"count": 0, "tags": [], "creator": "jeremias@apache.org", "attachment_id": 26061, "text": "Created attachment 26061\nPatch to improve font matching\n\nThe attached patch does three things:\n\n1. Internally register not only the font families but also the actual font names (FontFamilyResolver).\n\nExample: Where \"Univers\" is a font family, the font name \"Univers 45 Light\" is not currently registered. So if this is used, no match is found and the fallback \"SansSerif\" is used.\n\n2. Handle all CSS font weights for Java VMs >= 1.5 (TextUtilities).\n\nThere was a simplification in place for handling cases in JVMs prior to 1.5.\n\n3. Handle the case where a font family with spaces contains an integer value (ex. \"Univers 45 Light\"), but is not in quotes (FontFamilyManager).\n\nUntil now, only the case style=\"font-family: Univers Bold\" would be handled but not style=\"font-family: Univers 45 Light\".", "id": 140029, "time": "2010-09-21T14:14:05Z", "bug_id": 49968, "creation_time": "2010-09-21T14:14:05Z", "is_private": false}, {"count": 1, "tags": [], "creator": "helder.magalhaes@gmail.com", "text": "(In reply to comment #0)\n> Created an attachment (id=26061) [details]\n> Patch to improve font matching\n\nCool stuff. Thanks, Jeremias! ;-)\n\n\n> 3. Handle the case where a font family with spaces contains an integer value\n> (ex. \"Univers 45 Light\"), but is not in quotes (FontFamilyManager).\n\nDoes this mean that bug 44828 gets fixed by this as well? :-)\n\n\n(from the patch)\n+        //Also register all font names, not just font families.\n+        //Example: Font Family: \"Univers\", but Font Name: \"Univers 45 Light\"\n+        //Without this, matching \"Univers 45 Light\" is not possible.\n+        Font[] allFonts = env.getAllFonts();\n+        for (int i = 0; i < allFonts.length; i++) {\n+            Font f = allFonts[i];\n+            fonts.put(f.getFontName().toLowerCase(), f.getFontName());\n+        }\n\nDoes this mean that bug 46374 gets fixed by this as well? :-)\n\n\nGenerally, the patch looks good to me. Thomas, could you also take a look and state whether this is ready to land or if anything else is needed (tests for regard, etc.)?", "id": 140046, "time": "2010-09-22T05:17:50Z", "bug_id": 49968, "creation_time": "2010-09-22T05:17:50Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "deweese@apache.org", "text": "Mostly I think it's fine, just for my understanding under strict CSS rules are you allowed to have font families with numbers w/o quotes or underbars or collapsed spaces?\n\nAlso it looks to me like this is left over from dev/debug:\n@@ -170,6 +176,7 @@\n\n             if (lu == null) {\n                 return result;\n             }\n+            short v1 = lu.getLexicalUnitType();\n             if (lu.getLexicalUnitType() != LexicalUnit.SAC_OPERATOR_COMMA) {\n                 throw createInvalidLexicalUnitDOMException\n                     (lu.getLexicalUnitType());", "id": 140047, "time": "2010-09-22T05:43:44Z", "bug_id": 49968, "creation_time": "2010-09-22T05:43:44Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 49968, "attachment_id": null, "is_private": false, "id": 140058, "time": "2010-09-22T07:59:07Z", "creator": "jeremias@apache.org", "creation_time": "2010-09-22T07:59:07Z", "text": "It definitely fixes bug 44828, but I haven't looked closely at bug 46374, yet. I have to dash of to Germany now and will be online again mid next week. I'll take another look then.\n\nThanks, Thomas, for catching that little mistake. Eclipse was telling me about it, but I've missed it nonetheless."}, {"count": 4, "tags": [], "bug_id": 49968, "attachment_id": null, "is_private": false, "id": 140283, "time": "2010-09-29T01:18:23Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-09-29T01:18:23Z", "text": "(In reply to comment #2)\n> Mostly I think it's fine, just for my understanding under strict CSS rules are\n> you allowed to have font families with numbers w/o quotes or underbars or\n> collapsed spaces?\n\nApparently the specifications are quite unclear regarding that [1] [2]. Nevertheless, there are couple links [3] [4] that hint towards that (allowing numbers in font families) be formally specified in a near future. According to what I was able to investigate, the underspecified behavior in the current specs. make it even possible to use virtually any character (assuming proper escaping, whenever needed). :-)\n\n[1] http://www.w3.org/TR/CSS2/fonts.html#value-def-family-name\n[2] http://www.w3.org/TR/css3-values/#font-families\n[3] http://lists.w3.org/Archives/Public/www-style/2010Mar/0386.html\n[4] http://wiki.csswg.org/spec/css2.1#issue-114"}, {"count": 5, "tags": [], "creator": "helder.magalhaes@gmail.com", "attachment_id": null, "id": 140289, "time": "2010-09-29T05:14:27Z", "bug_id": 49968, "creation_time": "2010-09-29T05:14:27Z", "is_private": false, "text": "*** Bug 44828 has been marked as a duplicate of this bug. ***"}, {"count": 6, "tags": [], "creator": "helder.magalhaes@gmail.com", "text": "*** Bug 48856 has been marked as a duplicate of this bug. ***", "id": 140451, "time": "2010-10-04T11:52:29Z", "bug_id": 49968, "creation_time": "2010-10-04T11:52:29Z", "is_private": false, "attachment_id": null}, {"count": 7, "attachment_id": null, "bug_id": 49968, "text": "(In reply to comment #6)\n> *** Bug 48856 has been marked as a duplicate of this bug. ***\n\nBug 48856 comment 2 might be worth to take a look at, although I suspect (without actually checking) that's what's being done already (within the patch). :-)", "id": 140452, "time": "2010-10-04T11:54:20Z", "creator": "helder.magalhaes@gmail.com", "creation_time": "2010-10-04T11:54:20Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "text": "May this issue address bug 38207 as well?", "attachment_id": null, "id": 140506, "creator": "helder.magalhaes@gmail.com", "time": "2010-10-06T05:23:12Z", "bug_id": 49968, "creation_time": "2010-10-06T05:23:12Z", "is_private": false}, {"count": 9, "attachment_id": null, "bug_id": 49968, "is_private": false, "id": 145189, "time": "2011-03-22T11:25:27Z", "creator": "jeremias@apache.org", "creation_time": "2011-03-22T11:25:27Z", "tags": [], "text": "Patch applied with the modification indicated by Thomas:\nhttp://svn.apache.org/viewvc?rev=1084212&view=rev\n\nHelder wrote: \"May this issue address bug 38207 as well?\"\nI don't know but it sounds like something different. My change is confined to the FontFamilyManager."}, {"count": 10, "tags": [], "bug_id": 49968, "attachment_id": null, "is_private": false, "id": 154067, "time": "2012-02-23T13:51:07Z", "creator": "jeremias@apache.org", "creation_time": "2012-02-23T13:51:07Z", "text": "*** Bug 52747 has been marked as a duplicate of this bug. ***"}]
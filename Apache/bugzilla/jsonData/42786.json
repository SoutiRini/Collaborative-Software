[{"attachment_id": null, "tags": [], "bug_id": 42786, "is_private": false, "count": 0, "id": 104953, "time": "2007-06-30T12:48:22Z", "creator": "frankbugs@x09.de", "creation_time": "2007-06-30T12:48:22Z", "text": "Hi,\nwhen the function call 'apr_dbd_open' fails, noone knows why! 'apr_dbd_error' is\nno help, because the driver object might not exists!\nToday I had the problem that my Apache told me: '[crit] (20014)Internal error:\nDBD: Can't connect to mysql'. Good to know that it cannot connect, but better\nwould be to tell me why it cannot connect!\nThis can be done my adding an additional parameter like 'char **err_message' to\n'apr_dbd_open'. This parameter will be also given to the real driver\nimplementation who then is able to set this variable to a meaningful error\nmessage (E.g. in my case I see now: \"(20014)Internal error: DBD: Can't connect\nto mysql: Too many connections\", because I did this trivial change in my\ninstallation.)"}, {"attachment_id": null, "tags": [], "bug_id": 42786, "text": "This cannot be done for 1.2.x branch, as it would break binary compatibility.\nI'm changing this bug to be against HEAD, where the fix may be possible.", "count": 1, "id": 105014, "time": "2007-07-02T17:04:13Z", "creator": "bojan@rexursive.com", "creation_time": "2007-07-02T17:04:13Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 42786, "is_private": false, "count": 2, "id": 105040, "time": "2007-07-03T14:09:30Z", "creator": "frankbugs@x09.de", "creation_time": "2007-07-03T14:09:30Z", "text": "Yep, you are right.\nMaybe you are interested in a small patch for a quick look/test of my idea?"}, {"attachment_id": 20435, "tags": [], "bug_id": 42786, "is_private": false, "count": 3, "id": 105041, "time": "2007-07-03T14:12:35Z", "creator": "frankbugs@x09.de", "creation_time": "2007-07-03T14:12:35Z", "text": "Created attachment 20435\nI surrounded my patch with some ifdef's for testing of APR version >= 1.3..."}, {"count": 4, "tags": [], "creator": "bojan@rexursive.com", "attachment_id": null, "id": 107927, "time": "2007-09-09T17:28:54Z", "bug_id": 42786, "creation_time": "2007-09-09T17:28:54Z", "is_private": false, "text": "Thanks for the patch. Two comments:\n\n- checks for the version of APU are not required - we keep 1.3 in a separate SVN\ndirectory\n\n- whether the patch will go ahead in this form depends on the decision to ship\n1.3 (where this cannot be done, due to compatibility requirements with 1.2.x) or\n2.0 (where it can be done); this decision is pending\n\nAn alternative would be to create a patch with a function apr_dbd_open_ex() (or\nsome other name), while keeping the existing function as is. Then we could have\nthe patch for 1.3 as well.\n\nAnyhow, thanks!"}, {"attachment_id": 20869, "tags": [], "bug_id": 42786, "is_private": false, "count": 5, "id": 108505, "time": "2007-09-23T07:01:49Z", "creator": "frankbugs@x09.de", "creation_time": "2007-09-23T07:01:49Z", "text": "Created attachment 20869\nPatch introducing apr_dbd_open_ex against native apr-util-1.2.10\n\nI created a patch introducing apr_dbd_open_ex.\n\napr_dbd_open_ex has two additionl parameter: err_message and err_code which\nwill be filled if there is a problem opening the connection to the database. In\ncase of memory problems this variables will be untouched!\nThis solution needs some discussion: Some databases do not have error codes\n(like PostgreSQL or SQLite2)! Currently I just set this to '-1'. But maybe some\ndatabase implementations uses this number! I see two solutions: Look at all\navailable databases and look for a number which noone use and use that! Or (my\nfavorite) introduce a new function call for the dbd driver implementation:\napr_dbd_do_i_support_error_codes which returns TRUE or FALSE..."}, {"count": 6, "tags": [], "bug_id": 42786, "attachment_id": null, "text": "A fix along these lines has been committed to trunk (i.e. 1.3.0) in r590501. Due\nto versioning rules (http://apr.apache.org/versioning.html), we cannot backport\nthis to 1.2.x branch.", "id": 110460, "time": "2007-11-12T14:48:51Z", "creator": "bojan@rexursive.com", "creation_time": "2007-11-12T14:48:51Z", "is_private": false}]
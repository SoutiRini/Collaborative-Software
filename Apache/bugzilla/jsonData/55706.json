[{"count": 0, "tags": [], "creator": "rand@sent.com", "attachment_id": null, "text": "I'm building Tomcat 7.0.47.0 from src on\n\n\tuname -a\n\t\tLinux rand3.int 3.7.10-1.16-desktop #1 SMP PREEMPT Fri May 31 20:21:23 UTC 2013 (97c14ba) x86_64 x86_64 x86_64 GNU/Linux\n\nOnce built,\n\n\tservice tomcat7-custom version\n\t\tjsvc (Apache Commons Daemon) 1.0.15-dev\n\t\tCopyright (c) 1999-2011 Apache Software Foundation.\n\t\tjava version \"1.7.0_15\"\n\t\tOpenJDK Runtime Environment (build 1.7.0_15-b20)\n\t\tOpenJDK 64-Bit Server VM (build 23.7-b01, mixed mode)\n\t\tcommons daemon version \"1.0.15-dev\"\n\t\tcommons daemon process (id: 23245, parent: 23244)\n\t\tServer version: Apache Tomcat/7.0.47\n\t\tServer built:   Oct 25 2013 10:07:09\n\t\tServer number:  7.0.47.0\n\t\tOS Name:        Linux\n\t\tOS Version:     3.7.10-1.16-desktop\n\t\tArchitecture:   amd64\n\t\tJVM Version:    1.7.0_15-b20\n\t\tJVM Vendor:     Oracle Corporation\n\nmoving on to 'native',\n\n\tcd tomcat7/build/bin\n\ttar zxvf tomcat-native.tar.gz\n\tcd tomcat-native-1.1.29-src/jni/native\n\nconfigure fails @ APR version check\n\n\t./configure \\\n\t --prefix=/usr/local \\\n\t --with-apr=/usr/local/apache24x/bin/apr-2-config \\\n\t --with-java-home=/etc/alternatives/java_sdk_openjdk \\\n\t --with-ssl=/usr/local/src/openssl/1.0.1e \\\n\t --libdir=/usr/lib64\n\n\t\t...\n\t\tconfigure: loading site script /usr/share/site/x86_64-unknown-linux-gnu\n\t\tchecking build system type... x86_64-unknown-linux-gnu\n\t\tchecking host system type... x86_64-unknown-linux-gnu\n\t\tchecking target system type... x86_64-unknown-linux-gnu\n\t\tchecking for a BSD-compatible install... /usr/bin/install -c\n\t\tchecking for working mkdir -p... yes\n\t\tTomcat Native Version: 1.1.29\n\t\tchecking for chosen layout... tcnative\n\t\tchecking for APR... yes\n\t\tconfigure: error: You need APR version 1.2.1 or newer installed. For optimal performance version 1.3.0 or newer is needed.\n\nbut,\n\n\t/usr/local/apache24x/bin/apr-2-config --version\n\t\t2.0.0\n\napplying this patch\n\n\tcat /usr/local/src/tc-native.patch\n\t\t\tOnly in native: config.log\n\t\t\tOnly in native: config.nice\n\t\t\tdiff -ur native.ORIG/configure native/configure\n\t\t\t--- native.ORIG/configure\t2013-10-10 05:51:58.000000000 -0700\n\t\t\t+++ native/configure\t2013-10-25 10:11:19.692085473 -0700\n\t\t\t@@ -1903,7 +1903,7 @@\n\t\t\t     TEST_X=\"test -x\"\n\t\t\t   fi\n\n\t\t\t-  acceptable_majors=\"1\"\n\t\t\t+  acceptable_majors=\"2\"\n\n\t\t\t   apr_temp_acceptable_apr_config=\"\"\n\t\t\t   for apr_temp_major in $acceptable_majors\n\t\t\t@@ -2020,20 +2020,20 @@\n\t\t\t   fi\n\t\t\t   sapr_version=\"`echo $sapr_pversion|sed -e 's/\\(a-z*\\)$/.\\1/'`\"\n\t\t\t   tc_save_IFS=$IFS; IFS=.; set $sapr_version; IFS=$tc_save_IFS\n\t\t\t-  if test \"${1}\" -lt \"1\"; then\n\t\t\t-    { { echo \"$as_me:$LINENO: error: You need APR version 1.2.1 or newer installed. For optimal performance version 1.3.0 or newer is needed.\" >&5\n\t\t\t-echo \"$as_me: error: You need APR version 1.2.1 or newer installed. For optimal performance version 1.3.0 or newer is needed.\" >&2;}\n\t\t\t-   { (exit 1); exit 1; }; }\n\t\t\t-  else\n\t\t\t-    if test \"${2}\" -lt \"2\"; then\n\t\t\t-      { { echo \"$as_me:$LINENO: error: You need APR version 1.2.1 or newer installed. For optimal performance version 1.3.0 or newer is needed.\" >&5\n\t\t\t-echo \"$as_me: error: You need APR version 1.2.1 or newer installed. For optimal performance version 1.3.0 or newer is needed.\" >&2;}\n\t\t\t-   { (exit 1); exit 1; }; }\n\t\t\t-    elif test \"${2}\" -lt \"3\"; then\n\t\t\t-      { echo \"$as_me:$LINENO: WARNING: For optimal performance you need APR version 1.3.0 or newer installed.\" >&5\n\t\t\t-echo \"$as_me: WARNING: For optimal performance you need APR version 1.3.0 or newer installed.\" >&2;}\n\t\t\t-    fi\n\t\t\t-  fi\n\t\t\t+#  if test \"${1}\" -lt \"1\"; then\n\t\t\t+#    { { echo \"$as_me:$LINENO: error: You need APR version 1.2.1 or newer installed. For optimal performance version 1.3.0 or newer is needed.\" >&5\n\t\t\t+#echo \"$as_me: error: You need APR version 1.2.1 or newer installed. For optimal performance version 1.3.0 or newer is needed.\" >&2;}\n\t\t\t+#   { (exit 1); exit 1; }; }\n\t\t\t+#  else\n\t\t\t+#    if test \"${2}\" -lt \"2\"; then\n\t\t\t+#      { { echo \"$as_me:$LINENO: error: You need APR version 1.2.1 or newer installed. For optimal performance version 1.3.0 or newer is needed.\" >&5\n\t\t\t+#echo \"$as_me: error: You need APR version 1.2.1 or newer installed. For optimal performance version 1.3.0 or newer is needed.\" >&2;}\n\t\t\t+#   { (exit 1); exit 1; }; }\n\t\t\t+#    elif test \"${2}\" -lt \"3\"; then\n\t\t\t+#      { echo \"$as_me:$LINENO: WARNING: For optimal performance you need APR version 1.3.0 or newer installed.\" >&5\n\t\t\t+#echo \"$as_me: WARNING: For optimal performance you need APR version 1.3.0 or newer installed.\" >&2;}\n\t\t\t+#    fi\n\t\t\t+#  fi\n\n\t\t\t   APR_BUILD_DIR=\"`$apr_config --installbuilddir`\"\n\n\tpatch -p1 <  /usr/local/src/tc-native.patch\n\t\tpatching file configure\n\nremoves the broken check, and the build proceeds,\n\n\t./configure ...\n\tmake\n\tmake install\n\tls -al /usr/lib64/libtcnative*\n\t\t-rw-r--r-- 1 root root 214K Apr 15 14:46 /usr/lib64/libtcnative-1.a\n\t\t-rwxr-xr-x 1 root root 1.1K Apr 15 14:46 /usr/lib64/libtcnative-1.la*\n\t\tlrwxrwxrwx 1 root root   23 Apr 15 14:46 /usr/lib64/libtcnative-1.so -> libtcnative-1.so.0.1.27*\n\t\tlrwxrwxrwx 1 root root   23 Apr 15 14:46 /usr/lib64/libtcnative-1.so.0 -> libtcnative-1.so.0.1.27*\n\t\t-rwxr-xr-x 1 root root 186K Apr 15 14:46 /usr/lib64/libtcnative-1.so.0.1.27*\n\tldd /usr/${LIBDIR}/libtcnative-1.so\n\t\tlinux-vdso.so.1 =>  (0x00007fffc4549000)\n\t\tlibapr-2.so.0 => /usr/local/apache24x/lib/libapr-2.so.0 (0x00007feabdd3a000)\n\t\tlibssl.so.1.0.0 => /usr/local/ssl/lib64/libssl.so.1.0.0 (0x00007feabdacf000)\n\t\tlibcrypto.so.1.0.0 => /usr/local/ssl/lib64/libcrypto.so.1.0.0 (0x00007feabd6e4000)\n\t\tlibuuid.so.1 => /lib64/libuuid.so.1 (0x00007feabd4a1000)\n\t\tlibrt.so.1 => /lib64/librt.so.1 (0x00007feabd298000)\n\t\tlibcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007feabd05d000)\n\t\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007feabce40000)\n\t\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007feabcc3b000)\n\t\tlibexpat.so.1 => /lib64/libexpat.so.1 (0x00007feabca10000)\n\t\tlibc.so.6 => /lib64/libc.so.6 (0x00007feabc680000)\n\t\tlibz.so.1 => /lib64/libz.so.1 (0x00007feabc467000)\n\t\t/lib64/ld-linux-x86-64.so.2 (0x00007feabe1c1000)", "id": 170845, "time": "2013-10-25T18:25:40Z", "bug_id": 55706, "creation_time": "2013-10-25T18:25:40Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 55706, "attachment_id": null, "id": 170898, "time": "2013-10-29T03:57:57Z", "creator": "chris@christopherschultz.net", "creation_time": "2013-10-29T03:57:57Z", "is_private": false, "text": "Some notes:\n\n1. APR 2.x hasn't yet been released\n2. Your patch looks like it would fail to build against apr 1.4.8, the current release version\n3. IIRC, tcnative (or Tomcat?) checks APR version at runtime, too, so you may still have a problem using your binary"}, {"count": 2, "tags": [], "text": "> 1. APR 2.x hasn't yet been released\n\nTrue.  It will be.\n\nThere's value, if not priority, in taking notice now, and handling the case appropriately.\n\n> 2. Your patch looks like it would fail to build against apr 1.4.8, the\n> current release version\n\nI'm not submitting the patch for production, but rather as a crude workaround until a proper fix can be worked out.\n\nIn any case, spec'ing\n\n  --with-apr=/usr/local/apache24x/bin/apr-2-config\n\ncan, and arguably should, trivially return version # in a check, and respond appropriately.\n\n> 3. IIRC, tcnative (or Tomcat?) checks APR version at runtime, too, so you\n> may still have a problem using your binary\n\nUsing apr2, revno sync'd with the httpd src tree, I haven't had any problems as yet.  That I'm aware of.", "is_private": false, "id": 170900, "creator": "rand@sent.com", "time": "2013-10-29T04:17:11Z", "bug_id": 55706, "creation_time": "2013-10-29T04:17:11Z", "attachment_id": null}, {"text": "A few years later and there is still no sign of an APR 2.x.x release. Since that API for 2.x.x is a moving target and there is nothing in 2.x.x that we need (if anything, the direction Tomcat is going in is to remove the dependency on 2.x.x) we can fix this later when/if we need to.", "tags": [], "creator": "markt@apache.org", "is_private": false, "count": 3, "id": 186179, "time": "2015-11-02T11:11:58Z", "bug_id": 55706, "creation_time": "2015-11-02T11:11:58Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "robert.flaherty@oracle.com", "attachment_id": null, "text": "I created a servlet with a jsp and the following web.xml entry:\n\n\t<servlet>\n\t\t<servlet-name>Repository</servlet-name>\n\t\t<jsp-file>/Repository.jsp</jsp-file>\n\t\t<load-on-startup>1</load-on-startup>\n\t</servlet>\n\t<servlet-mapping>\n\t\t<servlet-name>Repository</servlet-name>\n\t\t<url-pattern>/Repository</url-pattern>\n\t</servlet-mapping>\n\nI altered the JSP and started Tomcat.  The initial startup invokes the JSP with the following call stack:\n\n\torg.apache.jsp.Repository_jsp.jspInit(Repository_jsp.java:42)\n\torg.apache.jasper.runtime.HttpJspBase.init(HttpJspBase.java:51)\n\torg.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrapper.java:159)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:329)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:342)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:267)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\torg.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.java:1191)\n\torg.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:992)\n\torg.apache.catalina.core.StandardContext.loadOnStartup(StandardContext.java:4058)\n\torg.apache.catalina.core.StandardContext.start(StandardContext.java:4371)\n\torg.apache.catalina.core.ContainerBase.start(ContainerBase.java:1045)\n\torg.apache.catalina.core.StandardHost.start(StandardHost.java:719)\n\torg.apache.catalina.core.ContainerBase.start(ContainerBase.java:1045)\n\torg.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)\n\torg.apache.catalina.core.StandardService.start(StandardService.java:516)\n\torg.apache.catalina.core.StandardServer.start(StandardServer.java:710)\n\torg.apache.catalina.startup.Catalina.start(Catalina.java:578)\n\tsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tjava.lang.reflect.Method.invoke(Method.java:597)\n\torg.apache.catalina.startup.Bootstrap.start(Bootstrap.java:288)\n\torg.apache.catalina.startup.Bootstrap.main(Bootstrap.java:413)\n\nThen I hit the servlet with a normal request with http://localhost:8080/context/Repository which yields this call stack:\n\n\torg.apache.jsp.Repository_jsp.jspInit(Repository_jsp.java:42)\n\torg.apache.jasper.runtime.HttpJspBase.init(HttpJspBase.java:51)\n\torg.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrapper.java:159)\n\torg.apache.jasper.servlet.JspServletWrapper.getDependants(JspServletWrapper.java:263)\n\torg.apache.jasper.compiler.Compiler.isOutDated(Compiler.java:430)\n\torg.apache.jasper.compiler.Compiler.isOutDated(Compiler.java:351)\n\torg.apache.jasper.JspCompilationContext.compile(JspCompilationContext.java:582)\n\torg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:317)\n\torg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:342)\n\torg.apache.jasper.servlet.JspServlet.service(JspServlet.java:267)\n\tjavax.servlet.http.HttpServlet.service(HttpServlet.java:717)\n\torg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\n\torg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\torg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\n\torg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\torg.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)\n\torg.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\n\torg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n\torg.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)\n\torg.apache.coyote.http11.Http11Processor.process(Http11Processor.java:845)\n\torg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)\n\torg.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447)\n\tjava.lang.Thread.run(Thread.java:619)\n\nThe JSP gets compiled on the request, but not at startup.  I backtracked a little and found StandardWrapper is doing:\n\n\treq.setQueryString(\"jsp_precompile=true\");\n\nwhich is unsafe b/c the precompile param can be specified as system property org.apache.jasper.Constants.PRECOMPILE.  Instead it should be:\n\n\treq.setQueryString(Constants.PRECOMPILE + \"=true\");\n\nAnyway, I wasn't overriding it so that didn't help.", "id": 126186, "time": "2009-04-10T09:26:22Z", "bug_id": 47013, "creation_time": "2009-04-10T09:26:22Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 47013, "text": "I don;t see this with trunk. Looks to be a duplicate of bug 41606 that was fixed recently.\n\n*** This bug has been marked as a duplicate of bug 41606 ***", "id": 126236, "time": "2009-04-14T14:58:08Z", "creator": "markt@apache.org", "creation_time": "2009-04-14T14:58:08Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "robert.flaherty@oracle.com", "text": "Shouldn't that precompile flag be changed though (bottom of the note).", "id": 126238, "time": "2009-04-14T15:07:53Z", "bug_id": 47013, "creation_time": "2009-04-14T15:07:53Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 126239, "time": "2009-04-14T15:19:01Z", "bug_id": 47013, "creation_time": "2009-04-14T15:19:01Z", "is_private": false, "text": "Re-opening to track the secondary issue. It has been fixed in trunk and proposed for 6.0.x."}, {"count": 4, "tags": [], "bug_id": 47013, "attachment_id": null, "id": 126736, "time": "2009-05-02T18:33:11Z", "creator": "markt@apache.org", "creation_time": "2009-05-02T18:33:11Z", "is_private": false, "text": "This has been fixed in trunk and will be in 6.0.20 onwards."}]
[{"count": 0, "attachment_id": null, "creator": "apacheissues@sourceway.eu", "is_private": false, "id": 175104, "time": "2014-05-08T08:43:29Z", "bug_id": 56501, "creation_time": "2014-05-08T08:43:29Z", "tags": [], "text": "we have a webapp with a filter, that generates an index.html file if the app is called on its root directory or with index.html as path.\n\nthere is one edge case where this filter is ignored and tomcat trys to open an actual index.html (which does not exist).\n\nthis happens when the webapp contains a underscore (_) in its name and the app is opened with %5F encoding instead of the underscore and a leading /.\n\nwe found this issue while migrating our apps from tomcat 6 to tomcat 7(.0.52). the manager app links the webapps with \"/test%5Fapp/\" (tomcat 6 used \"/test%5Fapp\" without the leading /) on tomcat 6 clicking the link the webapp opened as expected. on tomcat 7 we get 404 or if we place a real index.html it is shown.\n\non tomcat 8 the real index.html is accessed too, haven't checked how the manager links to the app.\n\neg\nWepApp name: test_app\n\nhttp://tomcat/test_app - Filter\nhttp://tomcat/test_app/ - Filter\nhttp://tomcat/test%5Fapp - Filter\nhttp://tomcat/test%5Fapp/ - index.html (404)\nhttp://tomcat/test_app/index.html - Filter\nhttp://tomcat/test%5Fapp/index.html - Filter\n\nwith name: testapp\nhttp://tomcat/testapp - Filter\nhttp://tomcat/testapp/ - Filter\nhttp://tomcat/testapp/index.html - Filter"}, {"count": 1, "tags": [], "text": "What filter mapping are you using?", "attachment_id": null, "bug_id": 56501, "id": 175111, "time": "2014-05-08T13:11:27Z", "creator": "markt@apache.org", "creation_time": "2014-05-08T13:11:27Z", "is_private": false}, {"count": 2, "attachment_id": null, "creator": "apacheissues@sourceway.eu", "is_private": false, "id": 175112, "time": "2014-05-08T13:42:19Z", "bug_id": 56501, "creation_time": "2014-05-08T13:42:19Z", "tags": [], "text": "\n  <filter>\n    <filter-name>IndexFilter</filter-name>\n    <filter-class>my.package.index.IndexFilter</filter-class>\n  </filter>\n  <filter-mapping>\n    <filter-name>IndexFilter</filter-name>\n    <url-pattern>/*</url-pattern>\n  </filter-mapping>\n\nthis is my mapping"}, {"count": 3, "attachment_id": null, "creator": "markt@apache.org", "is_private": false, "id": 175115, "time": "2014-05-08T15:37:44Z", "bug_id": 56501, "creation_time": "2014-05-08T15:37:44Z", "tags": [], "text": "This works for me with the latest code for 7.0.x.\n\nThe one thing that looks odd with this report is that http://tomcat/test%5Fapp works but http://tomcat/test%5Fapp/ doesn't since the response to the first URL should be a redirect to the latter url so I can;t see how the first works but the second fails.\n\nI suspect something a little more complex is going on, probably with welcome files.\n\nYou need to follow this up on the users mailing list (when ASF e-mail is restored). Until then, I'd suggest trying to put together the simplest test case the demonstrates this issue - I suspect that process will be illuminating."}, {"count": 4, "tags": [], "bug_id": 56501, "attachment_id": null, "is_private": false, "id": 175127, "time": "2014-05-09T06:05:04Z", "creator": "apacheissues@sourceway.eu", "creation_time": "2014-05-09T06:05:04Z", "text": "What Browser did you use to test?\n\nI tested with some and found that Chrome and IE (tested with 8, so 8+ should work too i think) work, but on Firefox this issue occurs.\n\nI'l try to build a little sample app for you to test."}, {"count": 5, "tags": [], "bug_id": 56501, "attachment_id": null, "id": 175128, "time": "2014-05-09T06:56:10Z", "creator": "apacheissues@sourceway.eu", "creation_time": "2014-05-09T06:56:10Z", "is_private": false, "text": "I just uploaded a sample project.\n\n- git clone https://github.com/dodgex/tomcat-issue-56501\n- mvn package\n- deploy on a tomcat server as test_app\n- open http://tomcat/test_app/test.html (in firefox)\n\nclick the links.\nSUCCESS => IndexFilter\nFAILURE => real index.html\n\nas mentioned in the comment before, for Chrome and IE every link yields \"SUCCESS\" but for Firefox it is failure in two cases.\n\na look on the network tab of FireBug and Chrome dev tools i can see that chrome decodes the %5F to _ for the requests while firefox actually sends the request with %5F to the server.\n\ni think there should be some kind on URL decode on tomcat side.\n\n\nKind regards,\nKay"}, {"count": 6, "tags": [], "text": "(In reply to Kay from comment #5)\n\n> i think there should be some kind on URL decode on tomcat side.\n\nThe problem is the exact opposite. Neither getRequestURI() not getContextPath() should return decoded values but currently getContextPath() does.\n\nI'll look into fixing this.", "is_private": false, "bug_id": 56501, "id": 175134, "time": "2014-05-09T16:24:45Z", "creator": "markt@apache.org", "creation_time": "2014-05-09T16:24:45Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "This has been fixed in 8.0.x for 8.0.6 onwards.", "attachment_id": null, "bug_id": 56501, "id": 175135, "time": "2014-05-09T21:03:00Z", "creator": "markt@apache.org", "creation_time": "2014-05-09T21:03:00Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 56501, "attachment_id": null, "is_private": false, "id": 175137, "time": "2014-05-10T00:02:40Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-05-10T00:02:40Z", "text": "For reference:\nhttp://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html#getContextPath%28%29\n\n[quote]The container does not decode this string.[/quote]\n\nThe same in JavaEE 6 and 5 javadocs for getContextPath() method.\n\nThus I agree with this change. ( r1593621 )\n\nThis change also means that any path parameters present in that part of request URI are now returned by getContextPath()."}, {"count": 9, "attachment_id": null, "creator": "markt@apache.org", "is_private": false, "id": 175170, "time": "2014-05-12T16:57:10Z", "bug_id": 56501, "creation_time": "2014-05-12T16:57:10Z", "tags": [], "text": "Fixed in 7.0.x for 7.0.54 onwards."}]
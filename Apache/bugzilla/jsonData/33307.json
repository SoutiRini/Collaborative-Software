[{"count": 0, "attachment_id": null, "bug_id": 33307, "text": "As we know that when a JSP page is invoked for the first time, jspInit() is \nexecuted. It is also possible to configure a JSP container to invoked jspInit() \nfor a given JSP page when the container is started( By introducing the load-\nstart-up in web.xml for that particular JSP page). We are getting the the \nfollowing exception: when we are trying to access the below mentioned JSP page  \n===============================================================================\nExtracting factory bean object\njavax.naming.NamingException: Cannot create resource instance\n        at org.apache.naming.factory.ResourceEnvFactory.getObjectInstance(Resour\nceEnvFactory.java:146)\n        at javax.naming.spi.NamingManager.getObjectInstance(NamingManager.java:3\n01)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:834)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:181)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:822)\n        at org.apache.naming.NamingContext.lookup(NamingContext.java:194)\n        at org.apache.jsp.samplequery04_jsp.jspInit(samplequery04_jsp.java:26)\n        at org.apache.jasper.runtime.HttpJspBase.init(HttpJspBase.java:119)\n        at org.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWrap\nper.java:158)\n        at org.apache.jasper.compiler.Compiler.isOutDated(Compiler.java:440)\n        at org.apache.jasper.compiler.Compiler.isOutDated(Compiler.java:390)\n        at org.apache.jasper.JspCompilationContext.compile(JspCompilationContext\n.java:471)\n        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper\n.java:190)\n        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:2\n95)\n        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n        at org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper.\njava:943)\n        at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:82\n3)\n        at org.apache.catalina.core.StandardContext.loadOnStartup(StandardContex\nt.java:3427)\n        at org.apache.catalina.core.StandardContext.start(StandardContext.java:3\n628)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)\n\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:754)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)\n\n        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:363\n)\n        at org.apache.catalina.core.StandardService.start(StandardService.java:4\n97)\n        at org.apache.catalina.core.StandardServer.start(StandardServer.java:219\n0)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:512)\n        at org.apache.catalina.startup.Catalina.execute(Catalina.java:400)\n        at org.apache.catalina.startup.Catalina.process(Catalina.java:180)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\njava:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\nsorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)\nJan 31, 2005 11:12:36 AM org.apache.struts.util.PropertyMessageResources <init>\nINFO: Initializing, config='org.apache.struts.util.LocalStrings', returnNull=tru\ne\nJan 31, 2005 11:12:36 AM org.apache.struts.util.PropertyMessageResources <init>\nINFO: Initializing, config='org.apache.struts.action.ActionResources', returnNul\nl=true\nJan 31, 2005 11:12:36 AM org.apache.struts.util.PropertyMessageResources <init>\nINFO: Initializing, config='org.apache.webapp.admin.ApplicationResources', retur\nnNull=true\nJan 31, 2005 11:12:39 AM org.apache.coyote.http11.Http11Protocol start\nINFO: Starting Coyote HTTP/1.1 on port 8080\nJan 31, 2005 11:12:39 AM org.apache.jk.common.ChannelSocket init\nINFO: JK2: ajp13 listening on /0.0.0.0:8009\nJan 31, 2005 11:12:39 AM org.apache.jk.server.JkMain start\nINFO: Jk running ID=0 time=16/32  config=D:\\jakarta-tomcat-4.1.30\\bin\\..\\conf\\jk\n2.properties\n\n==========================================================================\n\nour sample jsp page is :\n\n<%@ page errorPage=\"samplequery_error.jsp\" %>\n<%@ page import=\"javax.naming.*\" %>\n<%@ page import=\"javax.sql.*\" %>\n<%@ page import=\"java.sql.*\" %>\n<%@ page import=\"com.mycompany.*\" %>\n\n<html>\n<head>\n<title>\nsamplequery04.jsp\n</title>\n</head>\n<body bgcolor=\"#ffffff\">\n<h1>\nJBuilder Generated JSP\n</h1>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"2\" bordercolor=\"#d0d0a0\" \nbgcolor=\"#FFFFCC\" >\n\n<%!\nDataSource ds = null;\n%>\n\n<%!\npublic void jspInit() {\n  System.out.println(\">>>>>>>>>>>>>jspInit04<<<<<<<<<<<<<\");\n  try{\n    System.out.println(\"Getting InitialContext\");\n    Context initCtx = new InitialContext();\n    System.out.println(\"Doing initContext lookup\");\n    Context envCtx = (Context) initCtx.lookup(\"java:comp/env\");\n    System.out.println(\"Extracting factory bean object\");\n    MyBean bean = (MyBean) envCtx.lookup(\"bean/MyBeanFactory\");\n\n    System.out.println(\"foo = \" + bean.getFoo() + \", bar = \" +    bean.getBar\n());\n\n  }catch(Exception e) {\n  e.printStackTrace();\n  }\n}\n%>\n</table>\n</body>\n</html>\n================================================================================\n\nPlease help us in resolving this issue.", "id": 70260, "time": "2005-01-31T07:35:10Z", "creator": "seshagiri.shyam@wipro.tcpn.com", "creation_time": "2005-01-31T07:35:10Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 33307, "text": "Bugzilla is NOT a support forum. Please ask questions like this on the\ntomcat-user  mailing list.\n\nWhen posting you will also need to include the relevant parts of:\n- server.xml\n- web.xml\n\nIf discussions on the mailing list conclude that there is a bug here, please\nre-open the report and include full details of how to reproduce.", "id": 70285, "time": "2005-01-31T21:24:34Z", "creator": "markt@apache.org", "creation_time": "2005-01-31T21:24:34Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 33307, "text": "Created attachment 14149\ntestcase required to reproduce the naming exception( for the bug:33307)\n\n1) unzip the above attachment in some directory(say test)under\nwebapps(directory) and add the following lines in conf\\server.xml:\n<Context path=\"/test\" docBase=\"d:\\jakarta-tomcat-4.1.30\\webapps\\test\"\ndebug=\"0\"/>\n     \n\t <!-- DefaultContext -->\n\t<DefaultContext reloadable=\"true\" crossContext=\"true\" useNaming=\"true\">\n\n\t\t<!-- bean/MyBeanFactory -->\n\t\t   <Resource name=\"bean/MyBeanFactory\" auth=\"Container\"\ntype=\"com.mycompany.MyBean\"/>\n\t\t   <ResourceParams name=\"bean/MyBeanFactory\">\n\t\t\t<parameter>\n\t\t\t\t<name>factory</name>\n\t\t\t       \n<value>org.apache.naming.factory.BeanFactory</value>\n\t\t\t</parameter>\n\t\t\t<parameter>\n\t\t\t\t<name>bar</name>\n\t\t\t\t<value>23</value>\n\t\t\t</parameter>\n\t\t   </ResourceParams>\n\t   </DefaultContext>\n\t<!-- /DefaultContext -->  \n2) start the server.\n3) the exception will be reported :\n\nStarting service Tomcat-Standalone\nApache Tomcat/4.1.30\n>>>>>>>>>>>>>jspInit04<<<<<<<<<<<<<\nGetting InitialContext\nDoing initContext lookup\nExtracting factory bean object\njavax.naming.NamingException: Cannot create resource instance\n\tat org.apache.naming.factory.ResourceEnvFactory.getObjectInstance(Resou\n\nceEnvFactory.java:146)\n\tat javax.naming.spi.NamingManager.getObjectInstance(NamingManager.java:\n\n01)\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:834)\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:181)\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:822)\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:194)\n\tat org.apache.jsp.samplequery04_jsp.jspInit(samplequery04_jsp.java:26)\n\tat org.apache.jasper.runtime.HttpJspBase.init(HttpJspBase.java:119)\n\tat org.apache.jasper.servlet.JspServletWrapper.getServlet(JspServletWra\n\nper.java:158)\n\tat org.apache.jasper.compiler.Compiler.isOutDated(Compiler.java:440)\n\tat org.apache.jasper.compiler.Compiler.isOutDated(Compiler.java:390)\n\tat org.apache.jasper.JspCompilationContext.compile(JspCompilationContex\n\n.java:471)\n\tat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrappe\n\n.java:190)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:\n\n95)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat org.apache.catalina.core.StandardWrapper.loadServlet(StandardWrapper\n\njava:943)\n\tat org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:8\n\n3)\n\tat org.apache.catalina.core.StandardContext.loadOnStartup(StandardConte\n\nt.java:3427)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:\n\n628)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188\n\n\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:754)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188\n\n\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:36\n\n)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:\n\n97)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:21\n\n0)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:512)\n\tat org.apache.catalina.startup.Catalina.execute(Catalina.java:400)\n\tat org.apache.catalina.startup.Catalina.process(Catalina.java:180)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl\n\njava:39)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcce\n\nsorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)\nFeb 1, 2005 1:25:44 PM org.apache.struts.util.PropertyMessageResources <init>\nINFO: Initializing, config='org.apache.struts.util.LocalStrings', returnNull=tr\n\ne\nFeb 1, 2005 1:25:44 PM org.apache.struts.util.PropertyMessageResources <init>\nINFO: Initializing, config='org.apache.struts.action.ActionResources', returnNu\n\nl=true\nFeb 1, 2005 1:25:45 PM org.apache.struts.util.PropertyMessageResources <init>\nINFO: Initializing, config='org.apache.webapp.admin.ApplicationResources', retu\n\nnNull=true\nFeb 1, 2005 1:25:47 PM org.apache.coyote.http11.Http11Protocol start\nINFO: Starting Coyote HTTP/1.1 on port 8080\nFeb 1, 2005 1:25:47 PM org.apache.jk.common.ChannelSocket init\nINFO: JK2: ajp13 listening on /0.0.0.0:8009\nFeb 1, 2005 1:25:47 PM org.apache.jk.server.JkMain start\nINFO: Jk running ID=0 time=16/47  config=D:\\jakarta-tomcat-4.1.30\\conf\\jk2.prop\n\nrties", "id": 70296, "time": "2005-02-01T09:04:50Z", "creator": "seshagiri.shyam@wipro.tcpn.com", "creation_time": "2005-02-01T09:04:50Z", "is_private": false, "attachment_id": 14149}, {"count": 3, "tags": [], "creator": "seshagiri.shyam@wipro.tcpn.com", "is_private": false, "text": "I feel, we tried many combinations to see if it is a configurations issue, but \nof now use. It seems to be a bug in Tomcat & it is present in all the versions \nwe tried out. We are declaring it as a bug, let us know if any one has any \nother suggestions/soln to try out.\n\nThanks in advance,\nYogi\n\n-----Original Message-----\nFrom: Yogi [mailto:MG.Yogesha@wipro.tcpn.com] \nSent: Thursday, February 03, 2005 7:47 PM\nTo: 'Tomcat Users List'\nSubject: RE: jspInit() throwing NamingException when extracting a factory \nobject from JNDI context\n\nAppreciate if any one has some inputs....We couldn't decide whether it is a bug \nor usage issue,...\n\nDetails @ http://issues.apache.org/bugzilla/show_bug.cgi?id=33307\n\nProblem:\n-------- \n        jspInit() throwing NamingException when extracting a factory object\n\t  from JNDI context.\n\nDescription: \n------------\n         When the container has been configured to load the JSP page \n         during startup by including the Load-On-Startup tag in web.xml, the\n         NamingException has been reported( can be viewed in the attachment).\n\nThe Tomcat Version which we are using is Tomcat 4.1.3.\n\nHow to Reproduce the problem:\n-----------------------------\nStep 1) create a directory under webapps (say test) and unzip the attached \n   jsppax.zip into the test dir under webapps.\nStep 2) add the following lines to server.xml\n   \n   <Context path=\"/test\" docBase=\"d:\\jakarta-tomcat-4.1.30\\webapps\\test\"\ndebug=\"0\"/>\n         <!-- DefaultContext -->\n        <DefaultContext reloadable=\"true\" crossContext=\"true\" useNaming=\"true\">\n                <!-- bean/MyBeanFactory -->\n                   <Resource name=\"bean/MyBeanFactory\" auth=\"Container\" \ntype=\"com.mycompany.MyBean\"/>\n                   <ResourceParams name=\"bean/MyBeanFactory\">\n                        <parameter>\n                                <name>factory</name>\n \n<value>org.apache.naming.factory.BeanFactory</value>\n                        </parameter>\n                        <parameter>\n                                <name>bar</name>\n                                <value>23</value>\n                        </parameter>\n                   </ResourceParams>\n           </DefaultContext>\n        <!-- /DefaultContext -->  \n\nStep 3) start the server \nDuring startup, the NamingException has been reported.\n\nWe tried with couple of other Tomcat versions aswell it is poping that \nNamingException with them also.\n\nPlease letus know if you had any issues while reproducing the above exception. \nYou can refer to the bugid :33307 if you need more information. Please let us \nKnow if it is a configuration issue or a bug in JSP-TomCat. Awaiting yor \nresponse..\n", "id": 70488, "time": "2005-02-04T05:26:54Z", "bug_id": 33307, "creation_time": "2005-02-04T05:26:54Z", "attachment_id": null}, {"count": 4, "tags": [], "creator": "yoavs@computer.org", "text": "Please never change bug states from reopened to new.  It's misleading.  That \ncontains important information for us.  I'm going to resolve and then change \nto reopen.  Also, please don't use Bugzilla as a discussion forum: ask on the \nmailing list, then after resolution there use Bugzilla.  Thanks.", "id": 70499, "time": "2005-02-04T14:33:11Z", "bug_id": 33307, "creation_time": "2005-02-04T14:33:11Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 33307, "text": "By the way, Tomcat 4.x is not being actively developed.  If you have this bug \non Tomcat 5.5, it will get more attention faster.", "count": 5, "id": 70500, "time": "2005-02-04T14:33:53Z", "creator": "yoavs@computer.org", "creation_time": "2005-02-04T14:33:53Z", "is_private": false}, {"count": 6, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "Your zip file is corrupted.", "id": 70526, "time": "2005-02-04T22:55:34Z", "bug_id": 33307, "creation_time": "2005-02-04T22:55:34Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Created attachment 14204\nit contains the required configuration(web.xml) as well as the sample application  required for reproducing the problem", "is_private": false, "id": 70601, "creator": "seshagiri.shyam@wipro.tcpn.com", "time": "2005-02-08T08:04:11Z", "bug_id": 33307, "creation_time": "2005-02-08T08:04:11Z", "attachment_id": 14204}, {"attachment_id": null, "tags": [], "bug_id": 33307, "text": "You have uploaded a .tar file but given it a .zip extension. Now I have figured\nthis out, I'll take a look.\n\nFor future reference, when you upload a file give it the right extension. It\nmakes it so much easier for the people who are trying to help you.", "count": 8, "id": 70643, "time": "2005-02-08T22:05:34Z", "creator": "markt@apache.org", "creation_time": "2005-02-08T22:05:34Z", "is_private": false}, {"count": 9, "tags": [], "text": "I did the following:\n- renamed your war to case.war and placed it in $CATALINA_HOME/webapps\n- added <Resource name=\"bean/MyBeanFactory\"\n                  auth=\"Container\"\n                  type=\"com.mycompany.MyBean\"/>\n            <ResourceParams name=\"bean/MyBeanFactory\">\n                <parameter>\n                   <name>factory</name>\n                   <value>org.apache.naming.factory.BeanFactory</value>\n                </parameter>\n                <parameter>\n                    <name>bar</name>\n                    <value>23</value>\n                </parameter>\n            </ResourceParams>\n\nto the default context element of my server.xml\n- restarted tomcat (to pick up the server.xml changes)\n- noted the following in standard out:\nGetting InitialContext\nDoing initContext lookup\nExtracting factory bean object\nfoo = Default Foo, bar = 23\n\nThis test was with the latest code from CVS.\n\nThere were many bug fixes in 4.1.31. You might want to try your test case with\n4.1.31.\n\nAlso, test with a clean, unmodified installation.", "is_private": false, "id": 70651, "creation_time": "2005-02-08T22:36:14Z", "time": "2005-02-08T22:36:14Z", "creator": "markt@apache.org", "bug_id": 33307, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "toupin@earthlink.net", "attachment_id": null, "id": 909, "time": "2001-02-28T11:12:36Z", "bug_id": 753, "creation_time": "2001-02-28T11:12:36Z", "is_private": false, "text": "If an exception is thrown from a JSP page that has been included from another \npage, tomcat infinitely recurses on that included page, ultimately causing the \nJVM to puke with a stack overflow.\n\nI've traced the problem to the request-scope attributes that are set during an \ninclude (javax.servlet.servlet_path, etc.). When \nPageContextImpl.handlePageException attempts to forward to the error page, it \nuses the javax.servlet.servlet_path to determine what page to execute; in the \nproblem scenario, javax.servlet.servlet_path erroneously contains the servlet \npath of the included page, thus Jasper doesn't forward to the error page.\n\nThe forward (and probably forwardNamed) implementation in \norg.apache.tomcat.core.RequestDispatcherImpl needs to be altered so that it \nremoves the request-scope include attributes for the duration of the forward \n(in the same way that the include implementations work), e.g.:\n\n   public void forward(...)\n   {\n      // ... following code should go immed. before handleRequest ...\n\n      Object old_request_uri=realRequest.getAttribute\n(\"javax.servlet.include.request_uri\");\n      realRequest.removeAttribute(\"javax.servlet.include.request_uri\", path);\n\n      Object old_context_path=realRequest.getAttribute\n(\"javax.servlet.include.context_path\");\n      realRequest.removeAttribute(\"javax.servlet.include.context_path\");\n\n      Object old_servlet_path=realRequest.getAttribute\n(\"javax.servlet.include.servlet_path\");\n      realRequest.removeAttribute(\"javax.servlet.include.servlet_path\");\n\n      Object old_path_info=realRequest.getAttribute\n(\"javax.servlet.include.path_info\");\n      realRequest.removeAttribute(\"javax.servlet.include.path_info\");\n\n      Object old_query_string=realRequest.getAttribute\n(\"javax.servlet.include.query_string\");\n      realRequest.removeAttribute(\"javax.servlet.include.query_string\");\n\n      // ... handleRequest\n\n      // call replaceAttribute with old values before returning...!\n   }"}, {"count": 1, "tags": [], "text": "I can duplicate this in 3.2.1 final, but it works fine in 3.2.2b1.  It appears \nto have been fixed but the bug report was never closed.", "attachment_id": null, "id": 1341, "creation_time": "2001-03-17T09:42:44Z", "time": "2001-03-17T09:42:44Z", "creator": "marc.saegesser@apropos.com", "bug_id": 753, "is_private": false}]
[{"count": 0, "tags": [], "creator": "omichels@web.de", "text": "Servlet reads data with getServletContext().getResourceAsStream(\"filename\"),\nWebapp works with tomcat 5.5.25 but not with tomcat 6.0.16. where it\nis getting a NullPointerException. deployed with the same war file.\ntried with java 1.5 from IBM and Sun on AIX 5.3 and Linux", "id": 113682, "time": "2008-02-13T02:24:35Z", "bug_id": 44405, "creation_time": "2008-02-13T02:24:35Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 44405, "attachment_id": 21514, "text": "Created attachment 21514\nwar file of testcase\n\nwar file of testcase, URL: http://<server>/tomcat6/ViewResource", "id": 113684, "time": "2008-02-13T02:26:10Z", "creator": "omichels@web.de", "creation_time": "2008-02-13T02:26:10Z", "is_private": false}, {"count": 2, "tags": [], "creator": "omichels@web.de", "attachment_id": null, "id": 113685, "time": "2008-02-13T02:29:51Z", "bug_id": 44405, "creation_time": "2008-02-13T02:29:51Z", "is_private": false, "text": "Servlets source code:\n\npublic class ViewResource extends\n\t\tjavax.servlet.http.HttpServlet implements\n\t\tjavax.servlet.Servlet {\n\tstatic final long serialVersionUID = 1L;\n\n\tpublic ViewResource() {\n\t\tsuper();\n\t}\n\n\tprotected void doGet(HttpServletRequest request,\n\t\t\tHttpServletResponse response)\n\t\t\tthrows ServletException, IOException {\n\t\tServletOutputStream servletOutputStream = response\n\t\t\t\t.getOutputStream();\n\t\tbyte[] bytes = new byte[4096];\n\t\tInputStream is;\n\t\ttry {\n\t\t\tis = this.getServletContext()\n\t\t\t\t\t.getResourceAsStream(\n\t\t\t\t\t\t\t\"WEB-INF/foobar.txt\");\n\t\t\tis.read(bytes, 0, 4096);\n\t\t\tresponse.reset();\n\t\t\tresponse.setContentType(\"text/plain\");\n\t\t\tresponse.setContentLength(bytes.length);\n\t\t\tresponse.setHeader(\"Cache-control\",\n\t\t\t\t\t\"must-revalidate\");\n\t\t\tservletOutputStream.write(bytes, 0,\n\t\t\t\t\tbytes.length);\n\t\t\tservletOutputStream.flush();\n\t\t\tservletOutputStream.close();\n\t\t} catch (NullPointerException e) {\n\t\t\tStringWriter stringWriter = new StringWriter();\n\t\t\tPrintWriter printWriter = new PrintWriter(\n\t\t\t\t\tstringWriter);\n\t\t\te.printStackTrace(printWriter);\n\t\t\tresponse.setContentType(\"text/plain\");\n\t\t\tresponse.getOutputStream().print(\n\t\t\t\t\tstringWriter.toString());\n\t\t}\n\t}\n\n\tprotected void doPost(HttpServletRequest request,\n\t\t\tHttpServletResponse response)\n\t\t\tthrows ServletException, IOException {\n\t\tdoGet(request, response);\n\t}\n}"}, {"count": 3, "tags": [], "creator": "fhanik@apache.org", "text": "What does the JavaDoc say about getResource, \nshouldn't it start with a \"/\"\n\ngetResource\n\nURL getResource(String path)\n                throws MalformedURLException\n\n    Returns a URL to the resource that is mapped to a specified path. The path\nmust begin with a \"/\" and is interpreted as relative to the current context root.", "id": 113686, "time": "2008-02-13T03:02:37Z", "bug_id": 44405, "creation_time": "2008-02-13T03:02:37Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 44405, "attachment_id": null, "text": "sorry for not looking up in JavaDoc.\n\nfixing my code to\n  is = this.getServletContext().getResourceAsStream(\"/WEB-INF/foobar.txt\");\nresolved the problem.\n\nAlthough. Let me note, that the code worked perfectly with tomcat 5.5.25.\nPerhaps this should go in the FAQs.\n\nRegards, Oliver\n", "id": 113694, "time": "2008-02-13T03:58:52Z", "creator": "omichels@web.de", "creation_time": "2008-02-13T03:58:52Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 44405, "attachment_id": null, "text": "The check should have been added only with strict servlet compliance enabled.", "id": 113699, "time": "2008-02-13T04:29:40Z", "creator": "remm@apache.org", "creation_time": "2008-02-13T04:29:40Z", "is_private": false}, {"count": 6, "attachment_id": null, "bug_id": 44405, "is_private": false, "id": 113703, "time": "2008-02-13T04:39:33Z", "creator": "fhanik@apache.org", "creation_time": "2008-02-13T04:39:33Z", "tags": [], "text": "It's documented in the change log\n\nhttp://tomcat.apache.org/tomcat-5.5-doc/changelog.html\n\n"}, {"count": 7, "tags": [], "creator": "omichels@web.de", "text": " -Dorg.apache.catalina.STRICT_SERVLET_COMPLIANCE=true\nor\n -Dorg.apache.catalina.STRICT_SERVLET_COMPLIANCE=false\n\nhas no effect on the \nunchanged servlet [ getResourceAsStream(\"WEB-INF/foobar.txt\") ]\nwith the missing leading '/'\n\n\n", "id": 113713, "time": "2008-02-13T06:55:25Z", "bug_id": 44405, "creation_time": "2008-02-13T06:55:25Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "id": 113742, "time": "2008-02-14T05:10:15Z", "bug_id": 44405, "creation_time": "2008-02-14T05:10:15Z", "is_private": false, "text": "I know it doesn't work, I am just saying the check for / should have been added\nonly in strict compliance mode to avoid this \"regression\"."}]
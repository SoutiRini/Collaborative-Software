[{"count": 0, "tags": [], "bug_id": 14171, "text": "When you create an ant task using <antTask> on solaris the hack in \nAntClassLoader.initializeClass() fails if one of the Constructors in the \ndefined task declares an exception it throws that must be loaded from the \nclasspath specified to <antTask>.\n\nHere is the <antTask> tag:\n    <path id=\"xmlc.classpath\">\n        <pathelement location=\"${extlib}/xmlc.jar\"/>\n        <pathelement location=\"${extlib}/gnu-regexp.jar\"/>\n        <pathelement location=\"${extlib}/jtidy-xmlc.jar\"/>\n        <pathelement location=\"${extlib}/xerces-xmlc.jar\"/>\n    </path>\n   <path id=\"xmlcTask.classpath\">\n        <pathelement \nlocation=\"${ENV.CONDOR_HOME}/tools/antTasks/anttasks.jar\" />\n        <path refid=\"xmlc.classpath\" />\n    </path>\n\n\t<taskdef name=\"xmlc\" classname=\"com.valdero.ant.taskdefs.Xmlc\" \nclasspathref=\"xmlcTask.classpath\"/>\n\n\nHere is the output from Ant:\n\nDetected Java version: 1.3 in: /u02/app/bea/jdk130/jre\nDetected OS: SunOS\nparsing buildfile /export/home/smayhew/condor/module/ui/build.xml with URI = \nfile:/export/home/smayhew/condor/module/ui/build.xml\nProject base dir set to: /export/home/smayhew/condor/module/ui\nresolving systemId: \nfile:/export/home/smayhew/condor/module/moduleBuildCommon.xml\n [property] Loading Environment ENV.\n  [taskdef] taskDef Loaded class class com.valdero.ant.taskdefs.CastorSrcGen, \nAntClassLoader with \nclasspath: /export/home/smayhew/condor/tools/antTasks/anttasks.jar:/export/home/\nsmayhew/condor/module/ui/build/classes:/export/home/smayhew/condor/external/lib/\nJREngine.zip:/export/home/smayhew/condor/external/lib/activation.jar:/export/hom\ne/smayhew/condor/external/lib/bsh.jar:/export/home/smayhew/condor/external/lib/c\nlasses12.zip:/export/home/smayhew/condor/external/lib/classes12_g.zip:/export/ho\nme/smayhew/condor/external/lib/cos.jar:/export/home/smayhew/condor/external/lib/\ndbunit.jar:/export/home/smayhew/condor/external/lib/dtdparser.jar:/export/home/s\nmayhew/condor/external/lib/exml.jar:/export/home/smayhew/condor/external/lib/gnu\n-regexp.jar:/export/home/smayhew/condor/external/lib/j2ee-no-\ndom.jar:/export/home/smayhew/condor/external/lib/jai_codec.jar:/export/home/smay\nhew/condor/external/lib/jai_core.jar:/export/home/smayhew/condor/external/lib/ja\nvatools.jar:/export/home/smayhew/condor/external/lib/jaws.jar:/export/home/smayh\new/condor/external/lib/jcchart.jar:/export/home/smayhew/condor/external/lib/jdom\n.jar:/export/home/smayhew/condor/external/lib/jh.jar:/export/home/smayhew/condor\n/external/lib/jhall.jar:/export/home/smayhew/condor/external/lib/jive.jar:/expor\nt/home/smayhew/condor/external/lib/jsearch.jar:/export/home/smayhew/condor/exter\nnal/lib/jtidy-\nxmlc.jar:/export/home/smayhew/condor/external/lib/junit.jar:/export/home/smayhew\n/condor/external/lib/log4j.jar:/export/home/smayhew/condor/external/lib/mail.jar\n:/export/home/smayhew/condor/external/lib/regexp.jar:/export/home/smayhew/condor\n/external/lib/xalan.jar:/export/home/smayhew/condor/external/lib/xerces-\nxmlc.jar:/export/home/smayhew/condor/external/lib/xlrd.jar:/export/home/smayhew/\ncondor/external/lib/xmlc.jar:/export/home/smayhew/condor/external/lib/castor.jar\n:/export/home/smayhew/condor/build/lib/infrastructure.jar:/export/home/smayhew/c\nondor/build/lib/metadata.jar:/export/home/smayhew/condor/build/lib/repository.ja\nr:/export/home/smayhew/condor/build/lib/repository-\nejb.jar:/export/home/smayhew/condor/build/lib/event.jar:/export/home/smayhew/con\ndor/build/lib/event-\nejb.jar:/export/home/smayhew/condor/build/lib/decisionsupport.jar:/export/home/s\nmayhew/condor/build/lib/decisionsupport-\nejb.jar:/export/home/smayhew/condor/tools/ant/lib/xml-\napis.jar:/export/home/smayhew/condor/tools/ant/lib/xercesImpl.jar:/export/home/s\nmayhew/condor/tools/ant/lib/optional.jar:/export/home/smayhew/condor/tools/ant/l\nib/junit.jar:/export/home/smayhew/condor/tools/ant/lib/js.jar:/export/home/smayh\new/condor/tools/ant/lib/jaxp.jar:/export/home/smayhew/condor/tools/ant/lib/jakar\nta-regexp-\n1.2.jar:/export/home/smayhew/condor/tools/ant/lib/bsf.jar:/export/home/smayhew/c\nondor/tools/ant/lib/ant.jar:/u02/app/bea/jdk130/lib/tools.jar\ninitializeClass: class com.valdero.ant.taskdefs.CastorSrcGen\ninitializeClass: class com.valdero.ant.taskdefs.CastorSrcGen  throws: \njava.lang.IllegalArgumentException: wrong number of arguments\n  [taskdef] taskDef Loaded class class com.valdero.ant.taskdefs.Xmlc, \nAntClassLoader with \nclasspath: /export/home/smayhew/condor/tools/antTasks/anttasks.jar:/export/home/\nsmayhew/condor/external/lib/xmlc.jar:/export/home/smayhew/condor/external/lib/gn\nu-regexp.jar:/export/home/smayhew/condor/external/lib/jtidy-\nxmlc.jar:/export/home/smayhew/condor/external/lib/xerces-\nxmlc.jar:/export/home/smayhew/condor/external/lib/castor.jar:/export/home/smayhe\nw/condor/tools/ant/lib/xml-\napis.jar:/export/home/smayhew/condor/tools/ant/lib/xercesImpl.jar:/export/home/s\nmayhew/condor/tools/ant/lib/optional.jar:/export/home/smayhew/condor/tools/ant/l\nib/junit.jar:/export/home/smayhew/condor/tools/ant/lib/js.jar:/export/home/smayh\new/condor/tools/ant/lib/jaxp.jar:/export/home/smayhew/condor/tools/ant/lib/jakar\nta-regexp-\n1.2.jar:/export/home/smayhew/condor/tools/ant/lib/bsf.jar:/export/home/smayhew/c\nondor/tools/ant/lib/ant.jar:/u02/app/bea/jdk130/lib/tools.jar\ninitializeClass: class com.valdero.ant.taskdefs.Xmlc\n  [taskdef] NoClassDefFoundError, AntClassLoader with \nclasspath: /export/home/smayhew/condor/tools/antTasks/anttasks.jar:/export/home/\nsmayhew/condor/external/lib/xmlc.jar:/export/home/smayhew/condor/external/lib/gn\nu-regexp.jar:/export/home/smayhew/condor/external/lib/jtidy-\nxmlc.jar:/export/home/smayhew/condor/external/lib/xerces-xmlc.jar\n\nBUILD FAILED\nfile:/export/home/smayhew/condor/module/ui/build.xml:22: taskdef class \ncom.valdero.ant.taskdefs.Xmlc cannot be found\n        at org.apache.tools.ant.taskdefs.Definer.addDefinition(Definer.java:251)\n        at org.apache.tools.ant.taskdefs.Definer.execute(Definer.java:162)\n        at org.apache.tools.ant.helper.ProjectHelperImpl$TaskHandler.finished\n(ProjectHelperImpl.java:821)\n        at \norg.apache.tools.ant.helper.ProjectHelperImpl$AbstractHandler.endElement\n(ProjectHelperImpl.java:300)\n        at org.apache.xerces.parsers.AbstractSAXParser.endElement\n(AbstractSAXParser.java:572)\n        at org.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement\n(AbstractXMLDocumentParser.java:218)\n        at org.apache.xerces.impl.XMLNamespaceBinder.emptyElement\n(XMLNamespaceBinder.java:594)\n        at org.apache.xerces.impl.dtd.XMLDTDValidator.emptyElement\n(XMLDTDValidator.java:777)\n        at \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement\n(XMLDocumentFragmentScannerImpl.java:748)\n        at \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.\ndispatch(XMLDocumentFragmentScannerImpl.java:1453)\n        at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument\n(XMLDocumentFragmentScannerImpl.java:333)\n        at org.apache.xerces.parsers.DTDConfiguration.parse\n(DTDConfiguration.java:524)\n        at org.apache.xerces.parsers.DTDConfiguration.parse\n(DTDConfiguration.java:580)\n        at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:152)\n        at org.apache.xerces.parsers.AbstractSAXParser.parse\n(AbstractSAXParser.java:1169)\n        at org.apache.tools.ant.helper.ProjectHelperImpl.parse\n(ProjectHelperImpl.java:155)\n        at org.apache.tools.ant.ProjectHelper.configureProject\n(ProjectHelper.java:117)\n        at org.apache.tools.ant.Main.runBuild(Main.java:597)\n        at org.apache.tools.ant.Main.start(Main.java:196)\n        at org.apache.tools.ant.Main.main(Main.java:235)\n--- Nested Exception ---\njava.lang.NoClassDefFoundError: org/enhydra/xml/xmlc/XMLCException\n        at java.lang.Class.getConstructors0(Native Method)\n        at java.lang.Class.getDeclaredConstructors(Class.java:1077)\n        at org.apache.tools.ant.AntClassLoader.initializeClass\n(AntClassLoader.java:483)\n        at org.apache.tools.ant.taskdefs.Definer.addDefinition(Definer.java:236)\n        at org.apache.tools.ant.taskdefs.Definer.execute(Definer.java:162)\n        at org.apache.tools.ant.helper.ProjectHelperImpl$TaskHandler.finished\n(ProjectHelperImpl.java:821)\n        at \norg.apache.tools.ant.helper.ProjectHelperImpl$AbstractHandler.endElement\n(ProjectHelperImpl.java:300)\n        at org.apache.xerces.parsers.AbstractSAXParser.endElement\n(AbstractSAXParser.java:572)\n        at org.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement\n(AbstractXMLDocumentParser.java:218)\n        at org.apache.xerces.impl.XMLNamespaceBinder.emptyElement\n(XMLNamespaceBinder.java:594)\n        at org.apache.xerces.impl.dtd.XMLDTDValidator.emptyElement\n(XMLDTDValidator.java:777)\n        at \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement\n(XMLDocumentFragmentScannerImpl.java:748)\n        at \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.\ndispatch(XMLDocumentFragmentScannerImpl.java:1453)\n        at org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument\n(XMLDocumentFragmentScannerImpl.java:333)\n        at org.apache.xerces.parsers.DTDConfiguration.parse\n(DTDConfiguration.java:524)\n        at org.apache.xerces.parsers.DTDConfiguration.parse\n(DTDConfiguration.java:580)\n        at org.apache.xerces.parsers.XMLParser.parse(XMLParser.java:152)\n        at org.apache.xerces.parsers.AbstractSAXParser.parse\n(AbstractSAXParser.java:1169)\n        at org.apache.tools.ant.helper.ProjectHelperImpl.parse\n(ProjectHelperImpl.java:155)\n        at org.apache.tools.ant.ProjectHelper.configureProject\n(ProjectHelper.java:117)\n        at org.apache.tools.ant.Main.runBuild(Main.java:597)\n        at org.apache.tools.ant.Main.start(Main.java:196)\n        at org.apache.tools.ant.Main.main(Main.java:235)\n\nTotal time: 3 seconds\n\nAnd the source for the anttask:\n/*\n * Enhydra Java Application Server Project\n * \n * The contents of this file are subject to the Enhydra Public License\n * Version 1.1 (the \"License\"); you may not use this file except in\n * compliance with the License. You may obtain a copy of the License on\n * the Enhydra web site ( http://www.enhydra.org/ ).\n * \n * Software distributed under the License is distributed on an \"AS IS\"\n * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See \n * the License for the specific terms governing rights and limitations\n * under the License.\n * \n * The Initial Developer of the Enhydra Application Server is Lutris\n * Technologies, Inc. The Enhydra Application Server and portions created\n * by Lutris Technologies, Inc. are Copyright Lutris Technologies, Inc.\n * All Rights Reserved.\n * \n * Contributor(s):\n * \n * $Id: XMLC.java,v 1.23 2001/12/06 08:33:11 paul Exp $\n */\n\npackage org.enhydra.xml.xmlc.commands.xmlc;\n\nimport org.enhydra.xml.xmlc.*;\nimport org.enhydra.xml.xmlc.compiler.Compiler;\nimport org.enhydra.xml.xmlc.commands.ErrorHandling;\nimport org.enhydra.xml.xmlc.commands.options.*;\nimport org.enhydra.xml.xmlc.metadata.*;\nimport org.enhydra.xml.io.ErrorReporter;\nimport java.io.PrintWriter;\nimport java.io.IOException;\n\n/**\n * XMLC compiler program.  See the user manual for details on the command\n * line.  Will look for a system property `org.enhydra.xml.xmlc.javac' to find\n * the compiler to use if -javac is not specified.\n */\npublic class XMLC {\n    /**\n     * System property to pass default javac.\n     */\n    public static final String JAVAC_PROPERTY = \"org.enhydra.xml.xmlc.javac\";\n\n    /**\n     * Command line parsing object.\n     */\n    private XMLCOptionsParser fOptionsParser = new XMLCOptionsParser();\n\n    /**\n     * Enable verbose output.\n     */\n    private boolean fVerbose = false;\n\n    /*\n     * Stream to use for stdout.\n     */\n    private PrintWriter fStdout;\n\n    /*\n     * Error output.\n     */\n    private ErrorReporter fErrorReporter;\n\n    /*\n     * Trace and verbose output.\n     */\n    private PrintWriter fTraceOut;\n\n    /**\n     * Constructor specifying output stream for error messages.\n     */\n    public XMLC(PrintWriter stdout,\n                PrintWriter stderr) {\n        fStdout = stdout;\n        fErrorReporter = new ErrorReporter(stderr);\n        fTraceOut = stderr;\n    }\n\n    /**\n     * Constructor with standard output streams.\n     */\n    public XMLC() {\n        this(new PrintWriter(System.out, true),\n             new PrintWriter(System.err, true));\n    }\n\n    /*\n     * Print the XMLC version number.\n     */\n    private void printVersion() {\n        fStdout.println(\"Enhydra XMLC version \" + XMLCVersion.VERSION);\n        fStdout.println(\"See http://xmlc.enhydra.org for latest distribution\");\n    }\n\n    /**\n     * Parse arguments.\n     */\n    private MetaData parseArgs(String[] args) throws XMLCException, IOException \n{\n        MetaData metaData = fOptionsParser.parse(args, fErrorReporter);\n        \n        // Default javac if supplied by a property.\n        String defaultJavac = System.getProperty(JAVAC_PROPERTY);\n        if (defaultJavac != null) {\n            JavaCompilerSection compilerSection = \nmetaData.getJavaCompilerSection();\n            if (!compilerSection.isJavacSpecified()) {\n                compilerSection.setJavac(defaultJavac);\n            }\n        }\n        return metaData;\n    }\n\n    /**\n     * Parse arguments and compile the page.  If this method is used,\n     * errors are thrown, exit will not be called.\n     */\n    public void compile(String[] args) throws XMLCException, IOException {\n        \n        // Setup and document parsing.\n        MetaData metaData = parseArgs(args);\n        CompileOptions compileOptions = metaData.getCompileOptions();\n        fVerbose = compileOptions.getVerbose();\n\n        if (compileOptions.getPrintVersion()) {\n            printVersion();\n        }\n\n        if (metaData.getInputDocument().getUrl() != null) {\n            Compiler compiler = new Compiler(fErrorReporter,\n                                             fTraceOut);\n            compiler.compile(metaData);\n        }\n    }\n\n    /*\n     * Parse arguments and compile the page.  Print errors that\n     * are thrown.\n     */\n    private void compileHandleErrors(String[] args) {\n        try {\n            compile(args);\n        } catch (Exception except) {\n            ErrorHandling.handleException(except, fVerbose);\n        }\n    }\n\n    /*\n     * Program entry point.\n     */\n    public static void main(String[] args) {\n        XMLC xmlc = new XMLC();\n        xmlc.compileHandleErrors(args);\n    }\n}", "id": 25486, "time": "2002-11-01T16:39:28Z", "creator": "smayhew@valdero.com", "creation_time": "2002-11-01T16:39:28Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "conor@apache.org", "attachment_id": null, "text": "what is <antTask>?", "id": 31230, "time": "2003-02-13T14:23:58Z", "bug_id": 14171, "creation_time": "2003-02-13T14:23:58Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 14171, "text": "Sorry.  I meant <taskdef> not <antTask>.", "id": 31255, "time": "2003-02-13T18:01:50Z", "creator": "smayhew@valdero.com", "creation_time": "2003-02-13T18:01:50Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 14171, "text": "InitializeClass is no longer used. Standard JDK init is now used. Please try\nnext nightly build.", "id": 40632, "time": "2003-07-14T13:53:08Z", "creator": "conor@apache.org", "creation_time": "2003-07-14T13:53:08Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Created attachment 26213\npatch for MapperListener.java\n\nThe same five MapperListener is registered as ContainerListener of StandardContext. \n\nAt first when I add StandardHost by using \"Engine addChild operation\" via JMX, same MapperListener is registered as ContainerListener of StandardHost.\n\nStandardEngine.addChild()\n->StandardEngine.addChildInternal()\n  ->StandardEngine.fireContainerEvent()\n    ->MapperListener.containerEvent() line: 133 <-- here\n      ...\n    ->MapperListener.containerEvent() line: 135\n      ->MapperListener.registerHost() line: 276 <-- here\n\nTherefore, StandardHost has the same two MapperListener as ContainerListener. \n---\n\nThen, starting StandardHost by using \"Host start operation\", the same five MapperListener is registered as ContainerListener of StandardContext. \n\n(1)LifecycleState of StandardHost is changed to STARTING.\nStandardHost(LifecycleBase).start() line:140\n->StandardHost(ContainerBase).startInternal()\n  ...\n  ->StandardHost(ContainerBase).fireContainerEvent <-- fireContainerEvent fire two times\n    ...\n    ->MapperListener.containerEvent() line:133 <-- here\n    ...\n    ->MapperListener.containerEvent() line:137\n      ->MapperListener.registerContext() line:339 <-- here\n\n(2)LifecycleState of StandardHost is changed to STARTED.\nStandardHost(LifecycleBase).start() line:156\n...\n->MapperListener.registerHost() line:279\n  ->MapperListener.registerContext() line:339 <-- here\n---\nI think that the memory is wasted a little because of the above issue.\n\nOn a related issue, MapperListener is not registered as Container/LifecycleListener for StandardContext on starting up Tomcat.\n\n\nI attached the patch for above issues.\n\nBest regards.", "is_private": false, "bug_id": 50157, "id": 141034, "time": "2010-10-26T03:28:12Z", "creator": "mashmk02@gmail.com", "creation_time": "2010-10-26T03:28:12Z", "attachment_id": 26213}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 141075, "time": "2010-10-26T18:12:30Z", "bug_id": 50157, "creation_time": "2010-10-26T18:12:30Z", "is_private": false, "text": "Thanks for the report and the suggested patch.\n\nAfter some review, I went with a different patch that simplifies when objects get registered and some additional debug logging. I don't think there are any code paths where the listener can get registered twice but if you spot any feel free to re-open this issue.\n\nI also added some debug logging and exposed the listener names via JMX for easier debugging."}]
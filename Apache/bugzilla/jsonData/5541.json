[{"count": 0, "tags": [], "text": "===\n=== OVERVIEW DESCRIPTION:\n===\nThe Javadoc task fails on AIX. The problem is the same problem that was fixed \nin the case of finding the java command inside the ${ant.home}/bin/ant script - \nAIX JDK puts executables in */sh directories instead of */bin directories. The \nJavadoc task, in getJavadocExecutableName() method only looks to */bin \ndirectories (the defacto standard, but IBM breaks this). I am including the \nfull text of the patched version of the method since we are CVS-challenged at \nSchwab (if you really need a diff -u I can provide one by the end of the day).\n\n===\n=== STEPS TO REPRODUCE:\n===\n1. Using Jakarta Ant 1.4.1 on AIX (IBM JDK 1.2.2, but I would guess any IBM JDK \nwill do) attempt to run a build.xml with a target that invokes the Javadoc \ntask. It will always fail since the task is hardcoded to look for javadoc in \nthe wrong directory. More specifically, an invalid version of the javadoc \nexecutable can be found in ${java.home}/bin/javadoc, but the executable that \nshould be used is ${java.home}/sh/javadoc (only on AIX/IBM JDK).\n\n===\n=== ACTUAL RESULTS (always reproduceable without patch described below):\n===\nBuildfile: build.xml\n\napi:\n    [mkdir] Created dir: /CommonJavaComponents/repository/logger/docs/api\n  [javadoc] Generating Javadoc\n  [javadoc] Javadoc execution\n  [javadoc] Exception in thread \"main\" java.lang.NoClassDefFoundError: com/sun/t\nools/javadoc/Main\n\n===\n=== EXPECTED RESULTS (always reproduceable with path described below):\n===\nBuildfile: build.xml\n\napi:\n    [mkdir] Created dir: /CommonJavaComponents/repository/logger/docs/api\n  [javadoc] Generating Javadoc\n  [javadoc] Javadoc execution\n  [javadoc] Loading source files for package com.schwab.base.log...\n  [javadoc] Loading source files for package com.schwab.runtime.log...\n  [javadoc] Loading source files for package com.schwab.domain.system.audit.call\nableservice...\n  [javadoc] Loading source files for package com.schwab.domain.system.audit.log.\n..\n  [javadoc] Loading source files for package com.schwab.domain.system.audit.scen\nario...\n  [javadoc] Loading source files for package com.schwab.domain.system.log.format\nter...\n  [javadoc] Loading source files for package com.schwab.domain.system.log.handle\nr...\n  [javadoc] Loading source files for package com.schwab.logger.util...\n  [javadoc] Constructing Javadoc information...\n  [javadoc] Building tree for all the packages and classes...\n  [javadoc] Building index for all the packages and classes...\n  [javadoc] javadoc: warning - Tag @link: Class or Package not found: Records\n  [javadoc] javadoc: warning - Tag @link: Class or Package not found: Records\n  [javadoc] Building index for all classes...\n  [javadoc] javadoc: warning - Tag @link: Class or Package not found: Records\n  [javadoc] javadoc: warning - Tag @link: Class or Package not found: com.schwab\n.base.BusinessParameters#getLogger\n  [javadoc] javadoc: warning - Tag @link: Class or Package not found: com.schwab\n.base.BusinessResults#getLogger\n  [javadoc] javadoc: warning - Tag @link: Class or Package not found: com.schwab\n.base.presentation.ReplyBroker#getLogger\n  [javadoc] javadoc: warning - com.schwab.base.log.Level.name: Tag @see: can't f\nind Level in com.schwab.base.log.Level\n  [javadoc] javadoc: warning - com.schwab.base.log.Level.name: Tag @see: can't f\nind getName in com.schwab.base.log.Level\n  [javadoc] javadoc: warning - com.schwab.base.log.Level.value: Tag @see: can't\nfind Level in com.schwab.base.log.Level\n  [javadoc] Generating /CommonJavaComponents/repository/logger/docs/api/styleshe\net.css...\n  [javadoc] 9 warnings\n\nBUILD SUCCESSFUL\n\nTotal time: 14 seconds\n\n===\n=== BUILD DATE & PLATFORM:\n===\nAnt version 1.4.1 compiled on December 20 2001\nBuildfile: build.xml\nDetected Java version: 1.2 in: /usr/IBMWebAS/java/jre/sh/..\nDetected OS: AIX\n\n===\n=== PATCHED VERSION OF \ncom.schwab.tools.ant.taskdefs.Javadoc.getJavadocExecutableName() FOLLOWS:\n===\n\n    private String getJavadocExecutableName()\n    {\n\t// This is the most common extension case - exe for windows and OS/2, \n        // nothing for *nix.\n        String os = System.getProperty(\"os.name\").toLowerCase();\n        boolean dosBased = \n            os.indexOf(\"windows\") >= 0 || os.indexOf(\"os/2\") >= 0;\n\tString extension =  dosBased? \".exe\" : \"\";\n\n    // Look for javadoc in the java.home/../sh directory (AIX specific).\n    File jdocExecutable = new File( System.getProperty(\"java.home\") +\n        \"/../sh/javadoc\" + extension );\n    \n    if (jdocExecutable.exists())\n    {\n        return jdocExecutable.getAbsolutePath();\n    }\n    else\n    {\n        // Look for javadoc in the java.home/../bin directory.  Unfortunately\n        // on Windows java.home doesn't always refer to the correct location, \n        // so we need to fall back to assuming javadoc is somewhere on the\n        // PATH.\n        jdocExecutable = new File( System.getProperty(\"java.home\") +\n            \"/../bin/javadoc\" + extension );\n\n        if (jdocExecutable.exists())\n        {\n            return jdocExecutable.getAbsolutePath();\n        }\n        else\n        {\n            log( \"Unable to locate \" + jdocExecutable.getAbsolutePath() +\n                \". Using \\\"javadoc\\\" instead.\", Project.MSG_VERBOSE );\n            return \"javadoc\";\n        }\n    }\n    }\n\n===\n=== END PATCHED VERISON\n===", "attachment_id": null, "id": 9092, "creator": "naresh.sikha@schwab.com", "time": "2001-12-20T08:33:31Z", "bug_id": 5541, "creation_time": "2001-12-20T08:33:31Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 5541, "attachment_id": null, "is_private": false, "id": 9547, "time": "2002-01-11T05:57:14Z", "creator": "bodewig@apache.org", "creation_time": "2002-01-11T05:57:14Z", "text": "When you write\n\n> ===\n> === STEPS TO REPRODUCE:\n> ===\n> 1. Using Jakarta Ant 1.4.1 on AIX \n\nyou point to the biggest problem - I don't think anyone of us committers has\naccess to an AIX box.\n\nCould you please tell us which values the system properties os.name and os.arch\ntake on the VMs in question (so we only look into the sh directories on AIX)."}, {"count": 2, "tags": [], "creator": "clark+apachebugzilla@sitraka.com", "is_private": false, "text": "As a side note, only JDK 1.2.2 on AIX requires that you run java and javac\nfrom the */sh/* \ndirectories. By the time IBM released JDK 1.30 for AIX, they\nrealized how silly that was and \nswicthed to used */bin/*.\n\n-----\n\nAlso, I have found that \nhttp://www.tolstoy.com/samizdat/sysprops.html can\nbe useful for checking the value of \nthe main system properties on platforms\nthat I don't have access to.", "id": 9548, "time": "2002-01-11T06:03:48Z", "bug_id": 5541, "creation_time": "2002-01-11T06:03:48Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 5541, "attachment_id": null, "id": 9553, "time": "2002-01-11T07:02:02Z", "creator": "bodewig@apache.org", "creation_time": "2002-01-11T07:02:02Z", "is_private": false, "text": "Thanks for the link Robert.\n\nNaresh, could you please try nightly build 2002-01-12 and see whether this fixes\nthe problem?\n\nAlso the code now assumes that java is in java.home/../sh and that javac is in\njava.home/../../sh (note that I'm ascending two directories) - could you please\nconfirm these assumptions.\n\nThanks"}, {"count": 4, "tags": [], "creator": "naresh.sikha@schwab.com", "is_private": false, "text": "Sorry for the delay. I will let you know whether or not your fix works by the \nend of this week (2/1/02).\n\nCheers.", "id": 9994, "time": "2002-01-28T21:25:09Z", "bug_id": 5541, "creation_time": "2002-01-28T21:25:09Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "bodewig@apache.org", "is_private": false, "text": "Any news?", "id": 11306, "time": "2002-02-28T15:57:27Z", "bug_id": 5541, "creation_time": "2002-02-28T15:57:27Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "I assume it is fixed now.", "is_private": false, "id": 12681, "creator": "bodewig@apache.org", "time": "2002-04-02T14:32:06Z", "bug_id": 5541, "creation_time": "2002-04-02T14:32:06Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 5541, "attachment_id": null, "text": "Yes. This bug is now fixed. Sorry for lagging on the reply.", "id": 12698, "time": "2002-04-02T17:12:01Z", "creator": "naresh.sikha@schwab.com", "creation_time": "2002-04-02T17:12:01Z", "is_private": false}]
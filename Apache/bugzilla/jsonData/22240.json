[{"count": 0, "attachment_id": null, "bug_id": 22240, "text": "The following buildscript should exclude all files called '.nbattrs' (netBeans \nattributes, pesky little things), but doesn't.\n\n<target name=\"war\" depends=\"build\" description=\"Build WAR file.\">\n\t<war destfile=\"dist/my.war\" excludes=\".nbattrs\"\n\t\twebxml=\"metadata/web.xml\" manifest=\"metadata/manifest.mf\">\n\t\t<webinf dir=\"metadata\">\n\t\t\t<exclude name=\"web.xml\"/>\n\t\t\t<exclude name=\"manifest.mf\"/>\n\t\t</webinf>\n\t\t<webinf dir=\"taglibrary\"/>\n\t\t<classes dir=\"build\"/>\n\t\t<classes dir=\"src/java\" includes=\"*.properties\"/>\n\t\t<lib dir=\"lib\"/>\n\t\t<fileset dir=\"src/jsp\"/>\n\t</war>\n\n\t<echo message=\"WAR file built.\"/>\n\t<echo message=\"======\"/>\n</target>\n\nWhat follows is the verbose output for this target:\n\nwar:\n      [war] Building war: C:\\work\\java\\struts\\blank\\dist\\my.war\n      [war] adding directory META-INF/\n      [war] adding entry META-INF/MANIFEST.MF\n      [war] adding directory WEB-INF/\n      [war] adding entry WEB-INF/struts-config.xml\n      [war] adding entry WEB-INF/struts-bean.tld\n      [war] adding entry WEB-INF/struts-form.tld\n      [war] adding entry WEB-INF/struts-html.tld\n      [war] adding entry WEB-INF/struts-logic.tld\n      [war] adding entry WEB-INF/struts-template.tld\n      [war] adding entry WEB-INF/struts.tld\n      [war] adding directory WEB-INF/classes/\n      [war] adding directory WEB-INF/classes/com/\n      [war] adding directory WEB-INF/classes/com/dcs/\n      [war] adding entry WEB-INF/classes/com/dcs/SubmitAction.class\n      [war] adding entry WEB-INF/classes/com/dcs/SubmitForm.class\n      [war] adding entry WEB-INF/classes/ApplicationResources.properties\n      [war] adding directory WEB-INF/lib/\n      [war] adding entry WEB-INF/lib/struts.jar\n=>    [war] adding entry .nbattrs\n      [war] adding entry index.jsp\n      [war] adding entry submit.jsp\n      [war] adding entry WEB-INF/web.xml\n     [echo] WAR file built.\n     [echo] ======\n\n...as you can see, a .nbattrs is added, most likely the one selected by the \nnested fileset. This was actually run with build 1.6alpha_2003-7-24, so I guess \nit's a bug for all builds.\n\nI tried variations of the pattern, like **/.nbattrs or **/*.nbattrs, but the \nonly thing that keeps it from being added, is adding excludes=\".nbattrs\" to the \nnested fileset.\n\nI think this is not the way the war task is supposed to behave, but maybe this \nis just what nested filesets do, period - I will test to provide more data.", "id": 42382, "time": "2003-08-08T08:28:58Z", "creator": "aalbert.torsius@dcstrans.nl", "creation_time": "2003-08-08T08:28:58Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 22240, "attachment_id": null, "id": 42384, "creation_time": "2003-08-08T08:42:33Z", "time": "2003-08-08T08:42:33Z", "creator": "peter.reilly@corvil.com", "text": "War extends Jar and is an implicit fileset and thus inherits the \"excludes\"\nattribute.\n\nThis attribute does not apply to nested filesets.\nThe attribute needs to be explicity set on the nested filesets.\n\nThe documenation of war may need to be updated to say this.", "is_private": false}, {"count": 2, "tags": [], "bug_id": 22240, "text": "However, the nested elements lib, classes, webinf and metainf all specify \nfilesets. The excludes work for those. It would be more consistent to have it \nwork for nested filesets as well.\nIt seems like the natural thing - the fileset selects some files and offers them \nto the war task, which then rejects some of them.", "id": 42400, "time": "2003-08-08T13:45:45Z", "creator": "aalbert.torsius@dcstrans.nl", "creation_time": "2003-08-08T13:45:45Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "peter.reilly@corvil.com", "attachment_id": null, "is_private": false, "id": 42404, "time": "2003-08-08T14:24:02Z", "bug_id": 22240, "creation_time": "2003-08-08T14:24:02Z", "text": "Except that the excludes does not work for those...\nsee\n<project>\n    <typedef resource=\"net/sf/antcontrib/antlib.xml\"/>\n    <delete quiet=\"yes\" dir=\"src\"/>\n    <delete quiet=\"yes\" file=\"w.war\"/>\n    <mkdir dir=\"src\"/>\n    <touch file=\"app.xml\"/>\n    <touch file=\"src/x.xml\"/>\n    <war destfile=\"w.war\" webxml=\"app.xml\" excludes=\"**/x.xml\">\n        <classes dir=\"src\"/>\n    </war>\n    <shellscript shell=\"bash\">\n        jar tf w.war\n    </shellscript>\n</project>\n\ngives the output:\nBuildfile: /home/preilly/proj/learning/war/build.xml\nDeleting directory /home/preilly/proj/learning/war/src\nDeleting: /home/preilly/proj/learning/war/w.war\nCreated dir: /home/preilly/proj/learning/war/src\nCreating /home/preilly/proj/learning/war/src/x.xml\nBuilding war: /home/preilly/proj/learning/war/w.war\nMETA-INF/\nMETA-INF/MANIFEST.MF\nWEB-INF/\nWEB-INF/classes/\nWEB-INF/classes/x.xml\nWEB-INF/web.xml\n"}, {"count": 4, "tags": [], "bug_id": 22240, "text": "As Peter has said, the excludes in the <war> task applies to the implicit\nfileset used by <war> but this fileset is not used in your case so the excludes\nhas no effect. You will need to add excludes for all the filesets.\n\nIn Ant 1.6, you can set the defaule excludes to exclude these files from every\nfileset in the build.", "id": 42406, "time": "2003-08-08T14:34:00Z", "creator": "conor@apache.org", "creation_time": "2003-08-08T14:34:00Z", "is_private": false, "attachment_id": null}, {"text": "Darn. I see. Those pesky .nbattrs are always all over the place, so I assumed \nthem to be in all directories I selected. As it turns out, the only one having \none of them is the directory selected by the nested fileset.\n\nIt still seems weird to me that excludes doesn't work this way, but then again, \nregular filesets don't have nested filesets.\n\nSo I guess this is either an invalid bug or an RFE?\n", "tags": [], "bug_id": 22240, "is_private": false, "count": 5, "id": 42408, "time": "2003-08-08T14:39:06Z", "creator": "aalbert.torsius@dcstrans.nl", "creation_time": "2003-08-08T14:39:06Z", "attachment_id": null}]
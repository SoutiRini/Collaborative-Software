[{"count": 0, "tags": [], "bug_id": 43574, "attachment_id": null, "is_private": false, "id": 109141, "time": "2007-10-08T15:03:27Z", "creator": "dkingsolver@gmail.com", "creation_time": "2007-10-08T15:03:27Z", "text": "This problem has been identified while migrating from 1.6.5 to 1.7.0.  I have a\nset of build files that worked as expected under 1.6.5, but behave differently\nunder 1.7.0.  The problem is generalized into three test cases below, case 3\nshows this particular failure in detail, cases 1 & 2 serve to show that this\nproblem only seems to manifest while using <delete>.\n\nThe following selector is defined for the next three test cases.  This selector\nshould find files that have not been modified.  It will update the cachefile\nwith the latest checksum.  This selector should only find files that exactly\nmatch, and only after it has reference to those files in the cachefile. \nConversely it should not match new or revised files.\n<selector id=\"cache.selector\">\n    <not>\n      <modified update=\"true\"\n                      seldirs=\"false\"\n                      cache=\"propertyfile\"\n                      algorithm=\"digest\"\n                      comparator=\"equal\">\n                <param name=\"cache.cachefile\"\n                  value=\"${build.images.dir}/cache/cache.properties\"/>\n                <param name=\"algorithm.algorithm\" value=\"MD5\"/>\n        </modified>\n      </not>\n</selector>\n\nThe difference among cases 1,2, and 3 is the use of the <copy>, <move> and\n<delete> tasks respectively.  All other parameters are the same.\n\nCase 1:\nDescription: copy unmodified files to a temporary folder, overwriting\nExpected: On first run, when no cachefile is present, should copy nothing\n          On 2nd through n passes, should copy all files that were logged from\nthe first run\nWhat happens under 1.7.0: works as expected\n<copy verbose=\"true\"  todir=\"${build.images.dir}/temp\" overwrite=\"true\">\n    <fileset dir=\"${build.images.dir}\">\n      <include name=\"*.jpg\" />\n      <selector refid=\"cache.selector\" />\n    </fileset>\n</copy>\n\nCase 2:\nDescription: move unmodified files to a temporary folder, overwriting\nExpected: On first run, when no cachefile is present, should move nothing\n          On 2nd pass, should move all files that were logged from the first run\n          On 3rd pass, should have no files to move\nWhat happens under 1.7.0: works as expected\n<move verbose=\"true\"  todir=\"${build.images.dir}/temp\" overwrite=\"true\">\n    <fileset dir=\"${build.images.dir}\">\n      <include name=\"*.jpg\" />\n      <selector refid=\"cache.selector\" />\n    </fileset>\n</move>\n\nCase 3:\nDescription: delete unmodified files\nExpected: On first run, when no cachefile is present, should delete nothing\n          On 2nd pass, should delete all files that were logged from the first run\n          On 3rd pass, should have no files to delete\nWhat happens under 1.7.0: deletes all files on the first run. \n              This problem did not exist in 1.6.5 and prior\n<delete verbose=\"true\">\n    <fileset dir=\"${build.images.dir}\">\n      <include name=\"*.jpg\" />\n      <selector refid=\"cache.selector\" />\n    </fileset>\n</delete>"}, {"count": 1, "tags": [], "bug_id": 43574, "attachment_id": null, "is_private": false, "id": 129832, "time": "2009-08-21T01:01:43Z", "creator": "bodewig@apache.org", "creation_time": "2009-08-21T01:01:43Z", "text": "fixed by svn revision 806442 and will be further refined\n\nThe underlying problem was that delete was scanning the same fileset three time (at least in trunk, it may have been twice in 1.7.0).  So the modified selector was actually running more than once, practically reversing its selection process."}]
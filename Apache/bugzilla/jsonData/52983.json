[{"count": 0, "text": "Created attachment 28505\npatch against 6.0.x trunk removing problematic lines from 401.jsp\n\nThe Manager app in 6.0.35 sets WWW-Authenticate in 401.jsp.\n\nHowever, this seems to be already set elsewhere, and as a result of setting it again in 401.jsp, DIGEST mode can not be used for the manager app.\n\nFrom what I can see, this is fixed in 7.0.x but doesn't seem to have been backported to 6.0.x yet.\n\nThe result is that DIGEST for Tomcat Manager can't be used on Tomcat 6 which is still very popular.\n\nTo demonstrate, I changed 401.jsp to set the header name to WWW-AuthenticateREDUNDANT and here is the result:\n\nFor BASIC:\n\nHTTP/1.1 401 Unauthorized\nPragma: No-cache\nCache-Control: no-cache\nExpires: Thu, 01 Jan 1970 10:00:00 EST\nWWW-Authenticate: Basic realm=\"Tomcat Manager Application\"\nSet-Cookie: JSESSIONID=****removed****; Path=/manager\nWWW-AuthenticateREDUNDANT: Basic realm=\"Tomcat Manager Application\"\nContent-Type: text/html\nTransfer-Encoding: chunked\nVary: Accept-Encoding\nDate: Mon, 26 Mar 2012 03:39:09 GMT\nServer: Coyote\n\nFor DIGEST:\n\nHTTP/1.1 401 Unauthorized\nPragma: No-cache\nCache-Control: no-cache\nExpires: Thu, 01 Jan 1970 10:00:00 EST\nWWW-Authenticate: Digest realm=\"Tomcat Manager Application\", qop=\"auth\", nonce=\"****removed****\", opaque=\"****removed****\"\nSet-Cookie: JSESSIONID=****removed****; Path=/manager\nWWW-AuthenticateREDUNDANT: Basic realm=\"Tomcat Manager Application\"\nContent-Type: text/html\nTransfer-Encoding: chunked\nVary: Accept-Encoding\nDate: Mon, 26 Mar 2012 03:44:07 GMT\nServer: Coyote\n\nYou can clearly see the REDUNDANT header being set here by 401.jsp.\n\nTo fix on my local versions, I simply removed the line in 401.jsp (patch1.txt).\n\nHowever, this deserves a cross-check by someone else before being committed in case there's some situation where it would remove authentication altogether.\n\nAn alternative solution for this version is to check if the header is set, and only add it where it's not already present (patch2.txt):\n\n  if(!response.containsHeader(\"WWW-Authenticate\"))\n    response.setHeader(\"WWW-Authenticater\", \"Basic realm=\\\"Tomcat Manager Application\\\"\");\n\n... but I'll leave that up to you.\n\nBest Regards,\nNeale", "bug_id": 52983, "attachment_id": 28505, "id": 155280, "time": "2012-03-26T04:08:42Z", "creator": "neale@metawerx.net", "creation_time": "2012-03-26T04:08:42Z", "tags": [], "is_private": false}, {"count": 1, "text": "Created attachment 28506\npatch against 6.0.x trunk eliminating redundant header after checking if it already exists", "creator": "neale@metawerx.net", "is_private": false, "id": 155281, "time": "2012-03-26T04:09:36Z", "bug_id": 52983, "creation_time": "2012-03-26T04:09:36Z", "tags": [], "attachment_id": 28506}, {"attachment_id": null, "tags": [], "bug_id": 52983, "is_private": false, "count": 2, "id": 155362, "time": "2012-03-29T14:16:08Z", "creator": "markt@apache.org", "creation_time": "2012-03-29T14:16:08Z", "text": "I've proposed the fix that was applied to trunk and 7.0.x for 6.0.x."}, {"count": 3, "text": "Fixed in 6.0 by r1343369 and r1343405 and will be in 6.0.36\n\nIn 7.0 it is already fixed by r1084103 which is included in 7.0.12.", "creator": "knst.kolinko@gmail.com", "attachment_id": null, "id": 159417, "time": "2012-05-28T22:33:00Z", "bug_id": 52983, "creation_time": "2012-05-28T22:33:00Z", "tags": [], "is_private": false}]
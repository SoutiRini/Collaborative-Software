[{"attachment_id": null, "tags": [], "bug_id": 50358, "text": "Embedded.stopInternal invokes setState(LifecycleState.STARTING), this should be changed to setState(LifecycleState.STOPPING).\n\nSetting LifecycleState.STARTING during stopInternal leads to a LifecycleException when the Embedded is shut down:\nLifecycleException:  An invalid Lifecycle transition was attempted ([after_stop]) for component [StandardService[null]] in state [STARTING]\n\tat org.apache.catalina.util.LifecycleBase.invalidTransition(LifecycleBase.java:321)\n\tat org.apache.catalina.util.LifecycleBase.stop(LifecycleBase.java:226)\n\tat de.javakaffee.web.msm.MemcachedSessionManagerIntegrationTest.tearDown(MemcachedSessionManagerIntegrationTest.java:112)\n\nThis failure leads to failing tests in my case.\n\nI'm using the (deprecated) Embedded for integration testing the memcached-session-manager (http://code.google.com/p/memcached-session-manager/).\nI'm just working on a tomcat7 branch, which shall diverge as little as possible from the master/trunk, therefore I'm still using Embedded instead of the newly introduced Tomcat.", "count": 0, "id": 142089, "time": "2010-11-28T18:13:10Z", "creator": "martin.grotzke@googlemail.com", "creation_time": "2010-11-28T18:13:10Z", "is_private": false}, {"attachment_id": null, "tags": [], "creator": "markt@apache.org", "text": "Thanks for the report. This has been fixed in 7.0.x and will be included in 7.0.6 onwards.", "count": 1, "id": 142117, "time": "2010-11-29T08:42:42Z", "bug_id": 50358, "creation_time": "2010-11-29T08:42:42Z", "is_private": false}]
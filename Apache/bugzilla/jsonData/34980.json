[{"count": 0, "tags": [], "creator": "vasu.san@gmail.com", "text": "We are going to add new servers for the site www.indianrail.gov.in with Apache \n2.0.53 on HP-UX 11i ver 2 platform. Systems are under offline testing mode. We \nhave configured Apache with the following settings:\n\nStartServers 2\nServerLimit 50\nMaxClients 950\nMinSpareThreads 25\nMaxSpareThreads 75\nThreadsPerChild 25\nMaxRequestsPerChild 0\n\nWe started Apache with the default HP-UX kernel tunables & found that APache \nwas able to take connections around 200 & beyond this error were flashed in \nthe log files as \"Resource Temporarily Unavailable: couldn't create child \nprocess 11 : <name_of_the_cgi_scripts>\"\nwe found that maxuprc parameter (max process per user) was set to 256 hence \nthe error was there. Now we have set this to 1024 & increased the load. I've \nseen Apache have taken connections around 600-700 but suddenly Apache crashed. \nError displayed in the log files are as follows:\n\ni) \"Resource Temporarily Unavailable: couldn't create child process 11 : \n<name_of_the_cgi_scripts>\"\n\nii) \"the listener thread didn't exit\"\n\niii) \"Child <child no> isn't taking over slots very quickly\"\n\niv) \"Resource Temporarily Unavailable: apr_thread_create: unable to create \nworker thread\"\n\nPls suggest solution to rectify this", "id": 75102, "time": "2005-05-20T08:49:11Z", "bug_id": 34980, "creation_time": "2005-05-20T08:49:11Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "It still comes down to operating system tuning.\n\ni) \"Resource Temporarily Unavailable: couldn't create child process 11 :\n<name_of_the_cgi_scripts>\"\niv) \"Resource Temporarily Unavailable: apr_thread_create: unable to create\nworker thread\"\nApache asked the OS to create a child process or thread, and it wouldn't,\npresumably due to an OS tuning issue.  I don't know what HP-UX settings need to\nbe tweaked to allow more threads or processes.  Check ulimit settings again.\n\nii) \"the listener thread didn't exit\"\niii) \"Child <child no> isn't taking over slots very quickly\"\nThese two messages are for debugging and aren't errors that you need to worry about.\n\nAs far as the crash: Apache 2.0.x doesn't recover once you hit the\napr_thread_create() failure.  Greg Ames recently fixed this in 2.1-dev.  See PR\n34514.  There is a patch linked from that PR, as well as a subsequent fix I\nposted to the PR.  Hopefully the fixes can be in Apache 2.0.next as well.\n\n\n*** This bug has been marked as a duplicate of 34514 ***", "is_private": false, "bug_id": 34980, "id": 75121, "time": "2005-05-20T12:24:16Z", "creator": "trawick@apache.org", "creation_time": "2005-05-20T12:24:16Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 34980, "attachment_id": null, "id": 75124, "time": "2005-05-20T12:33:10Z", "creator": "trawick@apache.org", "creation_time": "2005-05-20T12:33:10Z", "is_private": false, "text": "Another comment:\n\nMaxClients 950\n...\nMaxSpareThreads 75\n\nIf you set MaxSpareThreads higher, Apache won't have to destroy/create child\nprocesses so often, so you may avoid some of the thread create failure scenarios.\nI personally would recommend that MaxSpareThreads be at least 20% of MaxClients."}, {"count": 3, "tags": [], "creator": "vasu.san@gmail.com", "text": "I would like to get some more clarification. \n\ni) When the connections are around 600, error log says \"Server reached \nMaxClients setting, consider raising MaxClients setting.\", even though the \nMaxClients setting is 950 & in actual hasn't crossed its limit. \n\nii) ServerLimit is set to 50 but under high load, I always find that httpd \nprocesses are more than 50...around 80. We have worker MPM so isn't it a \nconflict. Pls clarify.\n\nRegards", "id": 75207, "time": "2005-05-23T07:46:37Z", "bug_id": 34980, "creation_time": "2005-05-23T07:46:37Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 34980, "text": "I have openede it again to get some more clarification. \n\ni) When the connections are around 600, error log says \"Server reached \nMaxClients setting, consider raising MaxClients setting.\", even though the \nMaxClients setting is 950 & in actual hasn't crossed its limit. \n\nii) ServerLimit is set to 50 but under high load, I always find that httpd \nprocesses are more than 50...around 80. We have worker MPM so isn't it a \nconflict. \n\nPls clarify the above two points also.\n\nRegards\n", "count": 4, "id": 75208, "time": "2005-05-23T07:50:15Z", "creator": "vasu.san@gmail.com", "creation_time": "2005-05-23T07:50:15Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 34980, "text": "i) [MaxClients hit too early]\nHow are you tracking the connections?\nii) [>ServerLimit processes]\nRead the doc starting with \"In addition to a set of active child processes\" at\nhttp://httpd.apache.org/docs-2.0/mod/worker.html", "count": 5, "id": 75214, "time": "2005-05-23T12:15:24Z", "creator": "trawick@apache.org", "creation_time": "2005-05-23T12:15:24Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 34980, "attachment_id": null, "id": 75219, "time": "2005-05-23T13:53:15Z", "creator": "vasu.san@gmail.com", "creation_time": "2005-05-23T13:53:15Z", "is_private": false, "text": "(In reply to comment #5)\n> i) [MaxClients hit too early]\n> How are you tracking the connections?\n> ii) [>ServerLimit processes]\n> Read the doc starting with \"In addition to a set of active child processes\" at\n> http://httpd.apache.org/docs-2.0/mod/worker.html\n\ni) Regarding first point, we are tracking connections using URL \nas \"http://Site_address/server-status\". With this, we are able to track the \nrequests being currently processed by the server. I assume, this is the number \nof clients being served by the server at a moment & we are comparing this with \nthe MaxClients. This value is quite less than the MaxClients setting when \nsometimes we get the error message.\n\nii) As per the document link, I'm able to percieve that the remaining \nprocesses, apart from the ServerLimit, are the terminating processes & active \nchild processes will always be less than or equal to the ServerLimit. \nIs there a way to know which processes are terminating & which one are the \nactive child processes.\n\nRegards\n"}, {"count": 7, "tags": [], "text": ">Is there a way to know which processes are terminating \n>& which one are the active child processes.\n\nOn AIX and Solaris, I use a ps option to list the number of threads in the\nprocesses.  Then I check the httpd processes for processes with >1 thread and\n<ThreadsPerChild threads.  Those are the terminating processes.  I didn't find\nhow to do that directly on HP-UX, but maybe I have misunderstood the ps man page.\n\nWith Apache 2.1-dev, mod_status will indicate the true process id for each\nthread in the extended status table (the table with one line per request), so\nthreads in a gracefully exiting process will have a different pid from those\naround them.\n\n(Apache 2.0.x does not have the right support to do this with mod_status.)\n", "is_private": false, "id": 75225, "creation_time": "2005-05-23T15:55:57Z", "time": "2005-05-23T15:55:57Z", "creator": "trawick@apache.org", "bug_id": 34980, "attachment_id": null}, {"count": 8, "attachment_id": null, "creator": "jorton@redhat.com", "text": "Marking as duplicate again.  For further discussion please use\nhttp://httpd.apache.org/userslist.html.\n\n*** This bug has been marked as a duplicate of 34514 ***", "id": 79535, "time": "2005-09-07T16:24:24Z", "bug_id": 34980, "creation_time": "2005-09-07T16:24:24Z", "tags": [], "is_private": false}]
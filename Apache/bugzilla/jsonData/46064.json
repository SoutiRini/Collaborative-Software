[{"count": 0, "tags": [], "creator": "christian_boitel@yahoo.fr", "attachment_id": null, "id": 121787, "time": "2008-10-22T09:25:28Z", "bug_id": 46064, "creation_time": "2008-10-22T09:25:28Z", "is_private": false, "text": "Hi,\n\nIf i use apr/apr-util 1.2.x, it works\n\nIf i use apr/apr-util 1.3.x, function call fails\n\nHints: \n=> calls to apr_ldap_init return -1\n=> if i modify code of apr_ldap_init in ldap/apr_ldap_init.c to directly return -5, calls to apr_ldap_init still return -1\n=> if i modify code of apr_ldap_init in ldap/apr_ldap_stub.c to directly return -5, calls to apr_ldap_init do return -5 as expected\n\nLooks like the dso changes in 1.3.x are causing the failure !"}, {"count": 1, "tags": [], "bug_id": 46064, "attachment_id": null, "is_private": false, "id": 121813, "time": "2008-10-23T03:32:25Z", "creator": "christian_boitel@yahoo.fr", "creation_time": "2008-10-23T03:32:25Z", "text": "I have recompiled apr-util-1.3.4 with --disable-util-dso configure options\n=> apr_ldap_init calls are now fine\n\nI looked at the code and the only explanation hint i have is that calls to load_ldap function (in ldap/apr_ldap_stub.c) fail that is causing apr_ldap_init to always return -1. \n\nBy the way, i found that in such cases that apr_ldap_init behaves differently in ldap/apr_ldap_stub.c than in ldap/apr_ldap_init.c\n=> When the dso stub fails, the result_err argument isn't allocated as expected\n=> in Apache/httpd, this is causing sigabort failures: httpd code checks the result_err returned; since it is null, it assumes that call succeeded which is wrong; when httpd tries to later use the connection, openldap sdk fails (assertion failed...) and generates a sigabort signal.\n\n\n"}, {"count": 2, "tags": [], "creator": "christian_boitel@yahoo.fr", "is_private": false, "text": "I have also opened an HTTPD bug to ensure Apache code also checks the apr_ldap_init return code instead of checking only the result parameter.\n\nSee https://issues.apache.org/bugzilla/show_bug.cgi?id=46076", "id": 121891, "time": "2008-10-27T01:09:20Z", "bug_id": 46064, "creation_time": "2008-10-27T01:09:20Z", "attachment_id": null}]
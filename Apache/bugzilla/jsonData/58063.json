[{"count": 0, "tags": [], "bug_id": 58063, "attachment_id": 32840, "text": "Created attachment 32840\nSource to reproduce the issue\n\nI have a test webapp using async with Javamelody 1.56 and Spring-webmvc, in Tomcat 7.0.47 with JDK 1.7.0_80.\n\nWhen running in Tomcat 7.0.47, some async cases do not work and http responses are empty (buttons Async, Callable, Forward Async and Forward Callable),\nwhile others are OK (buttons Ajax, Redirect Ajax, Redirect Async, Redirect Callable, Forward Ajax, ResponseBody Async, ResponseBody Callable).\nWhen running in Jetty 9.1.0_RC2, all cases are OK.\n\nI created this issue as suggested by Mark [1].\n\nTo reproduce the issue:\n- unzip attached test-V3.zip\n- mvn tomcat7:run\n- open http://localhost:8080/ -> 4 buttons do not work and have empty responses, with javamelody\n- mvn jetty:run\n- open http://localhost:8080/ -> all buttons work, with javamelody\n- comment javamelody in pom.xml\n- mvn tomcat7:run\n- open http://localhost:8080/ -> all buttons work, without javamelody\n\nNote: the last change [2], added before flushing the response, does not fix the issue.\n\nIf the httpResponse is not wrapped in a CounterServletResponseWrapper by the MonitoringFilter [3] or if Jetty is used instead of Tomcat,\nthere is no more issue but I do not know why.\n\nThis issue is also 338 in Javamelody:\nhttps://code.google.com/p/javamelody/issues/detail?id=338#c6\n\n[1] http://mail-archives.apache.org/mod_mbox/tomcat-users/201506.mbox/%3C557DA84B.9010100@apache.org%3E\n[2] https://code.google.com/p/javamelody/source/detail?r=4090\n[3] https://code.google.com/p/javamelody/source/browse/trunk/javamelody-core/src/main/java/net/bull/javamelody/MonitoringFilter.java#181", "id": 183665, "time": "2015-06-20T15:52:45Z", "creator": "evernat@free.fr", "creation_time": "2015-06-20T15:52:45Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 58063, "attachment_id": null, "id": 183800, "creation_time": "2015-06-29T20:55:57Z", "time": "2015-06-29T20:55:57Z", "creator": "violetagg@apache.org", "text": "Hello,\n\nIn Javamelody web fragment, the filter MonitoringFilter must specify dispatcher type ASYNC.\n\nRegards,\nVioleta\n\n\nE.g.\n\t<filter-mapping>\n\t\t<filter-name>javamelody</filter-name>\n\t\t<url-pattern>/*</url-pattern>\n                <dispatcher>REQUEST</dispatcher>\n                <dispatcher>ASYNC</dispatcher>\n\t</filter-mapping>", "is_private": false}, {"count": 2, "tags": [], "bug_id": 58063, "text": "I did not know the async dispatcher type in filter mapping.\nSo, many thanks Violeta. You have removed a thorn from my side.\nAnd this is merged in javamelody.", "id": 183844, "time": "2015-07-02T08:54:51Z", "creator": "evernat@free.fr", "creation_time": "2015-07-02T08:54:51Z", "is_private": false, "attachment_id": null}]
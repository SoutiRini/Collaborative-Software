[{"count": 0, "attachment_id": 24261, "creator": "ray@rightsassist.com", "is_private": false, "id": 130379, "time": "2009-09-14T09:17:11Z", "bug_id": 47838, "creation_time": "2009-09-14T09:17:11Z", "tags": [], "text": "Created attachment 24261\nDiff to allow for current server time to be injected into a filter.\n\nI've modified some of the source from the mod_authz_ldap project\n(http://authzldap.othello.ch/) and applied it to the native mod_authnz_ldap\nmodule (http://httpd.apache.org/docs/2.2/mod/mod_authnz_ldap.html).\n\nThe code adds the ability to replace a special keyword of $t in a filter with\nthe current server time in the format of YYYYMMDDhhmmss.\n\nThis allows for a URL like:\n\nAuthLDAPURL\n\"ldaps://server.company.com/ou=users,dc=company,dc=com?uid?sub?(expirationDate>=$tZ)\" \n\nto result in a query being sent to the server similar to:\n\n(&(expirationDate>=200909140101Z)(uid=userj))\n\nThe code has not been heavily tested and my C skills have severely atrophied so\nthe code should be carefully scrutinized before committing.\n\nThe diff should be applied to modules/aaa/mod_authnz_ldap.c.\n\nPlease let me know if you have any questions.  Thanks."}, {"count": 1, "tags": [], "bug_id": 47838, "text": "I'm not that familiar with the LDAP AAA, so somebody else might have a better approach to solve your problem.\n\nJust looking at the patch, C89 doesn't allow new variable declarations in the middle of a block.  Also, see if you can handle the cases where $ is followed by a character other than 't', or $ is at the end.  There should also be a way to include a $ in the string if you really want one.", "id": 130383, "time": "2009-09-14T09:52:41Z", "creator": "poirier@pobox.com", "creation_time": "2009-09-14T09:52:41Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "Created attachment 24263\nBetter handles dollar sign in filter\n\nThis version has variable declarations at the beginning of the method and should pass through any dollar signs ($) not followed by a dynamic tag (currently only t for the server timestamp).", "is_private": false, "id": 130389, "creator": "ray@rightsassist.com", "time": "2009-09-14T11:51:16Z", "bug_id": 47838, "creation_time": "2009-09-14T11:51:16Z", "attachment_id": 24263}, {"count": 3, "tags": [], "creator": "covener@gmail.com", "text": "(In reply to comment #2)\n> Created an attachment (id=24263) [details]\n> Better handles dollar sign in filter\n> \n> This version has variable declarations at the beginning of the method and\n> should pass through any dollar signs ($) not followed by a dynamic tag\n> (currently only t for the server timestamp).\n\nHave you thought about the implication of the cache here?", "id": 130390, "time": "2009-09-14T12:12:03Z", "bug_id": 47838, "creation_time": "2009-09-14T12:12:03Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "Certainly administrators would have to pay careful attention to their caching strategies and (server timezones for that matter) depending on the accuracy needed for any sort of expiration authorization.", "is_private": false, "id": 130391, "creator": "ray@rightsassist.com", "time": "2009-09-14T12:21:16Z", "bug_id": 47838, "creation_time": "2009-09-14T12:21:16Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 61516, "attachment_id": 35324, "text": "Created attachment 35324\ntest cases which demonstrate issue\n\nI am trying to implement cell copying algorithm for spreadsheet editor, and I ran into a problem with a test case.\nConsider following scenario : there is formula \"A1-A2\" in cell C3. Algorithm has to copy C3 to C2. Formula should become A0-A1, that is #REF!-A1.\n\nI use FormulaShifter class for adjusting of cell references, and I initialise it with createForRowCopy() method, setting both firstMovedRowIndex and lastMovedRowIndex parameters to 2, since that's index of row where C3 resides. Method adjustFormula() converts A1 to just A.\n\nI have tried a few other possibilities for initialisation of FormulaShifter instance (since there is no documentation, and I am not really sure how those parameters affect FormulaShifter), but all of them fail.\n\nSo, if this is not a bug in FormulaShifter, please tell me what is correct way to initialise it. And also what is generally idea with ShiftMode.RowCopy value, that is, in what use cases should I use it.\n\n(Source code resides in attached file.)", "id": 200844, "time": "2017-09-13T11:23:41Z", "creator": "drjovanovic@gmail.com", "creation_time": "2017-09-13T11:23:41Z", "is_private": false}, {"count": 1, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 200939, "time": "2017-09-18T19:42:31Z", "bug_id": 61516, "creation_time": "2017-09-18T19:42:31Z", "is_private": false, "text": "Not sure if I understand the testcase correctly, but it looks like you have a formula \"A1-A2\", i.e. row 0, cell 1 and 2 and you are shifting row 2 up by one row, i.e. row 2 (C) onto row 1 (B). Then it seems correct to me that the formula for row 0 (A) is kept in-tact, or?\n\nMaybe you can reduce your test down to the minimum, see the information at https://stackoverflow.com/help/mcve for some hints about that."}, {"count": 2, "tags": [], "creator": "drjovanovic@gmail.com", "text": "Created attachment 35334\nminimized version of test case", "id": 200947, "time": "2017-09-19T10:16:24Z", "bug_id": 61516, "creation_time": "2017-09-19T10:16:24Z", "is_private": false, "attachment_id": 35334}, {"count": 3, "tags": [], "creator": "drjovanovic@gmail.com", "attachment_id": 35335, "id": 200948, "time": "2017-09-19T10:18:57Z", "bug_id": 61516, "creation_time": "2017-09-19T10:18:57Z", "is_private": false, "text": "Created attachment 35335\ntest file, for manual work in Excel"}, {"count": 4, "tags": [], "creator": "drjovanovic@gmail.com", "text": "Ok, I have simplified test case a bit (see  attachment 35334), now it does not include variations on parameter values, and formula is now as trivial as it can be.\n\n\"A\" is reference to column, not row. A1 is [row0, cell0], as you can see in my source code :\nsheet.createRow(0).createCell(0).setCellValue(1); // A1\n\nI am copying from row2 to row1, but these are not C and B (again, letters stand for column references), these are rows marked as 3 and 2 in common spreadsheet editors.\n\nFurther, that means that cell reference from formula should shift one row up, that is, A1 becomes A0 (which is undefined, and excel writes it as \"#REF!\"). You can check this if you open attached xlsx file (attachment 35335) in spreadsheet editor, and copy cell C3 to C2.\n\nTo resume :\n- if you open atached file rowShiftExample.xlsx in Excel, and manually copy C3 to C2, you'll get value #REF! In C2;\n- if you execute attached application (attachment 35334) which should do the same thing, you'll get result \u201cA\u201d in variable shiftedFmla.\n\nI hope it is more clear now.", "id": 200949, "time": "2017-09-19T10:25:58Z", "bug_id": 61516, "creation_time": "2017-09-19T10:25:58Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 200968, "time": "2017-09-19T16:38:30Z", "bug_id": 61516, "creation_time": "2017-09-19T16:38:30Z", "is_private": false, "text": "doh, sorry, must have been asleep already to mix up \"A\" vs. row."}, {"count": 6, "tags": [], "creator": "dominik.stadler@gmx.at", "text": "Thanks, now it was much easier to reproduce and thus fix, see r1809967 for the actual changes.", "id": 201184, "time": "2017-09-28T09:57:25Z", "bug_id": 61516, "creation_time": "2017-09-28T09:57:25Z", "is_private": false, "attachment_id": null}]
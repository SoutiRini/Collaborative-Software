[{"count": 0, "tags": [], "creator": "kustanowitz@choicemedia.com", "text": "I found that after a failed log entry (JdbcAppender) in mysql (I believe 5.0 \nbut I'm not sure), mysql does in fact write the entry, but an error must be \nreturned at some point because it's not removed from the buffer.\n\nThis happened after writing non-ascii characters to the field, or after \nexceeding the 255 character limit I had set on the field.\n\nI fixed this by moving \"removes.add(logEvent);\" to be BEFORE the execute(sql); \nstatement, which ensures it will always get removed, even if an error occurs.\n\nSince this is not necessarily the desired behavior for all apps, I would \nrecommend exposing this as a setting on the class, controlled via some \nvariable like \"removeFromBufferOnError\" or something more creative.\n\nThis is my first posting to a jakarta project -- thanks for all the hard work \nthat makes our lives easier!", "id": 95401, "time": "2006-11-03T07:51:34Z", "bug_id": 40889, "creation_time": "2006-11-03T07:51:34Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 40889, "text": "I'm not a log4j developer, but happened to be looking at this at work.\n\nIt seems to me that chiefly MySQL is at fault here if it is indeed throwing an\nerror and yet still writing it to the db. \n\nIt seems that log4j could solve this by changing the execute() method to be in\ncharge of adding to the removes.add(..) call, and then having a setAutoCommit in\nthere so that a rollback is performed if an Exception is thrown (and the\nremoves.add(...) is not done). This change of responsibility might be bad for\nsubclasses; so the other option would be to change execute() to take a\nConnection parameter and put flushBuffer() in charge of the Connection.", "id": 97171, "time": "2006-12-21T13:56:18Z", "creator": "bayard@apache.org", "creation_time": "2006-12-21T13:56:18Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 40889, "attachment_id": null, "text": "Please provide sample code demonstrating the behaviour described.", "id": 119265, "time": "2008-08-02T12:06:17Z", "creator": "thorbjoern@gmail.com", "creation_time": "2008-08-02T12:06:17Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "dmoss1@hotmail.com", "attachment_id": null, "id": 103001, "time": "2007-05-09T07:50:21Z", "bug_id": 42367, "creation_time": "2007-05-09T07:50:21Z", "is_private": false, "text": "The cookies attribute in the <Context> element within a context.xml  file\ndeployed as part of a webapp is not being honored.  A cookie containing the\nsession id is always being included within an HTTP response even when\ncookies=\"false\" is used.  Both url rewriting and creating a cookie occurs.\n\nSample servlet and client code is included below as well as the web.xml and\ncontext.xml files.\n\npackage test;\n\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\nimport javax.servlet.ServletException;\nimport java.io.IOException;\nimport java.io.PrintWriter;\n\n\n\npublic class SimpleServlet extends HttpServlet {\n\n\n\tpublic void init() throws ServletException\n\t{\n\t\tsuper.init();\n\t\tSystem.out.println(\"Inside servlet init\");\n\t}\n\n\tprotected void doPost(HttpServletRequest req, HttpServletResponse res) throws\nServletException, IOException\n\t{\n\t\tSystem.out.println(\"Inside doPost\");\n\t\tHttpSession session = req.getSession(true);\n\n\t\tString id = session.getId();\n\t\tSystem.out.println(\"Session id \" + id);\n\n\t\tsession.setAttribute(\"hello\", \"there\");\n\t\tString requestUrl = req.getRequestURL().toString();\n\t\tString responseUrl = requestUrl + \"?parameter=ABCD\";\n\t\tString encodedResponse = res.encodeURL(responseUrl);\n\t\tPrintWriter pw = res.getWriter();\n\t\tpw.write(encodedResponse);\n\t\tpw.close();\n\t}\n\n\tprotected void doGet(HttpServletRequest httpServletRequest, HttpServletResponse\nhttpServletResponse) throws ServletException, IOException\n\t{\n\t\tSystem.out.println(\"Inside doGet\");\n\t\tHttpSession session = httpServletRequest.getSession(false);\n\t\tString id = session.getId();\n\t\tSystem.out.println(\"Session id \" + id);\n\t}\n}\n\n--------------------------------------\n\npackage test;\n\nimport java.net.HttpURLConnection;\nimport java.net.URL;\nimport java.io.OutputStream;\nimport java.io.InputStream;\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOException;\n\npublic class SimpleClient {\n\n\tpublic static void main(String [] args) throws IOException\n\t{\n\t\tnew SimpleClient(args[0]);\n\t}\n\n\tpublic SimpleClient(String urlString) throws IOException\n\t{\n\t\tHttpURLConnection connection = (HttpURLConnection) (new\nURL(urlString).openConnection());\n\n\t\t\n\t\tconnection.setDoOutput(true);\n\t\tconnection.setDoInput(true);\n\n\t\tconnection.setRequestMethod(\"POST\");\n\n\t\tOutputStream os = connection.getOutputStream();\n\n\t\tbyte [] request = \"This is a request\".getBytes();\n\t\tos.write(request);\n\t\tos.flush();\n\n\t\tInputStream is = connection.getInputStream();\n\t\tint byteVal;\n\t\tByteArrayOutputStream baos = new ByteArrayOutputStream(1000);\n\t\twhile ((byteVal = is.read()) != -1)\n\t\t{\n\t\t\tbaos.write(byteVal);\n\t\t}\n\n\t\tString response = baos.toString();\n\t\tSystem.out.println(\"response \" + response);\n\n\t\tHttpURLConnection conn2 = (HttpURLConnection) (new\nURL(response).openConnection());\n\t\tconn2.setRequestMethod(\"GET\");\n\t\tInputStream is2 = conn2.getInputStream();\n\t\tis2.close();\n\n\t}\n}\n\n----------------------------------------\n\n\n\n<Context debug=\"10\" cookies=\"false\">\n\n</Context>\n\n\n----------------------------------------\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n<!DOCTYPE web-app\n\tPUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n\t\"http://java.sun.com/dtd/web-app_2_3.dtd\">\n\n<web-app>\n\t<display-name>Simple Servlet Example</display-name>\n\t<description>Simple Servlet for Cookie Handling</description>\n\n\t<servlet>\n\t\t<servlet-name>\n\t\t\tsimple\n\t\t</servlet-name>\n\t\t<servlet-class>\n\t\t\ttest.SimpleServlet\n\t\t</servlet-class>\n        <load-on-startup>1</load-on-startup>\n\t</servlet>\n\n\n\t<!-- servlet URL mappings -->\n\t<servlet-mapping>\n\t\t<servlet-name>\n\t\t\tsimple\n\t\t</servlet-name>\n\t\t<url-pattern>\n\t\t\t/servlet/simple\n\t\t</url-pattern>\n\t</servlet-mapping>\n\t<servlet-mapping>\n\t\t<servlet-name>\n\t\t\tsimple\n\t\t</servlet-name>\n\t\t<url-pattern>\n\t\t\t/simple\n\t\t</url-pattern>\n\t</servlet-mapping>\n\n</web-app>\n\n\n-------------------------------------\n\nAnd here is the HTTP traffic showing both the session id encoded in the URL and\nput into a cookie:\n\n-----------------------------------------\n\nPOST /simple/simple HTTP/1.1\nUser-Agent: Java/1.5.0_11\nHost: damoss-w2:4444\nAccept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2\nConnection: keep-alive\nContent-type: application/x-www-form-urlencoded\nContent-Length: 17\n\nThis is a requestGET\n/simple/simple;jsessionid=B5CB8ED94229822852E390E6503FB887?parameter=ABCD HTTP/1.1\nUser-Agent: Java/1.5.0_11\nHost: damoss-w2:4444\nAccept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2\nConnection: keep-alive\n\n--------------------------------------------------\n\nHTTP/1.1 200 OK\nSet-Cookie: JSESSIONID=B5CB8ED94229822852E390E6503FB887; Path=/simple\nContent-Length: 94\nDate: Tue, 08 May 2007 23:14:53 GMT\nServer: Apache-Coyote/1.1\n\nhttp://damoss-w2:4444/simple/simple;jsessionid=B5CB8ED94229822852E390E6503FB887?parameter=ABCDHTTP/1.1\n200 OK\nContent-Length: 0\nDate: Tue, 08 May 2007 23:14:54 GMT\nServer: Apache-Coyote/1.1"}, {"count": 1, "tags": [], "creator": "chris@sourcelabs.com", "attachment_id": null, "text": "Works fine for me in 5.5.23.  Where are you placing the context.xml?", "id": 103049, "time": "2007-05-10T11:03:16Z", "bug_id": 42367, "creation_time": "2007-05-10T11:03:16Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 42367, "attachment_id": null, "id": 103052, "time": "2007-05-10T13:00:01Z", "creator": "dmoss1@hotmail.com", "creation_time": "2007-05-10T13:00:01Z", "is_private": false, "text": "Yes, this works fine for me as well in Tomcat 5.5 which is why it has been filed\n(only) against Tomcat 5.0. :)\n\nThe context.xml is being placed in the META-INF subfolder in the webapp context\n(e.g. webapps\\simple\\META-INF).\n\n"}, {"count": 3, "tags": [], "bug_id": 42367, "attachment_id": null, "id": 103067, "time": "2007-05-10T21:50:41Z", "creator": "markt@apache.org", "creation_time": "2007-05-10T21:50:41Z", "is_private": false, "text": "I am afraid this will be a WONTFIX. Only security bugs are getting fixed in the\n5.0.x branch these days."}]
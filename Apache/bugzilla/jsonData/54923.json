[{"count": 0, "tags": [], "bug_id": 54923, "text": "When starting iPlanet installed as root on Solaris 11, nsapi_redirect.so fails to init.\n\n[18/Feb/2013:22:37:24] failure (20669): CORE2254: Error running Init function jk_init \n\nRoot cause is this line:\n            s = systhread_start(SYSTHREAD_DEFAULT_PRIORITY,\n                                0, init_workers_on_other_threads, init_map);\nfails to start the thread.\n\nOracle claims that SYSTHREAD_DEFAULT_PRIORITY results in a native thread priority outside of the allowed range and claim that PR_PRIORITY_NORMAL or PR_PRIORITY_LOW should work.\n\n\n@ When running as root, the provided priority of SYSTHREAD_DEFAULT_PRIORITY\n@ gets cast to an NSPR value of PR_PRIORITY_URGENT, which is finally\nmapped to\n@ a native priority value of 85, which in turn happens to be outside the\n@ allowed priority ranges as per system configuration. The provided priority\n@ value is unused when running as non-root, and hence the issue is not seen.\n@ .\n@ In more detail:\n@ .\n@ This issue happens due to the specified thread priority falling\noutside the\n@ configured limits in the system. \"priocntl -l\" displays the priority\nranges\n@ allowed:\n@ .\n@ ...\n@ TS (Time Sharing)\n@ Configured TS User Priority Range: -60 through 60\n@ ...\n@ .\n@ The systhread_start() API internally calls NSPR's PR_CreateThread().\n@ The value of SYSTHREAD_DEFAULT_PRIORITY is 16, and this is cast to the\nNSPR\n@ priority of PR_PRIORITY_URGENT.\n@ .\n@ PR_CreateThread() ultimately calls pthread_create(). Before doing so,\n@ PR_CreateThread() updates the new thread's attributes with the provided\n@ priority, and more importantly, this is done only if root privileges are\n@ available. In the case of a non-root user, the provided priority is\nnot used.\n@ .\n@ Now the problem with PR_PRIORITY_URGENT is the following: NSPR maps\nthe same\n@ to a native priority number (85) before using it to update the new\nthread's\n@ attributes. 85 is outside the allowed priority ranges as reported by\n@ \"priocntl -l\", and hence the pthread_create() ends up failing.\n@ .\n@ The customer has the following options:\n@ .\n@ 1. Use PR_PRIORITY_LOW instead of SYSTHREAD_DEFAULT_PRIORITY.\n@ PR_PRIORITY_NORMAL might work, too.\n@ 2. Check with Solaris team on how to change the system configuration\nto tweak\n@ the allowed range of thread priorities", "id": 167013, "time": "2013-05-03T14:57:45Z", "creator": "dopey@moonteeth.com", "creation_time": "2013-05-03T14:57:45Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 54923, "text": "Sorry for the very delayed response on this.\n\nSYSTHREAD_DEFAULT_PRIORITY is a constant defined in nsapi.h which is provided as part of iPlanet. If that file contains an inappropriate value for Solaris, then that is something that Oracle need to fix.\n\nYou can work around it by modifying locally before building.", "id": 193696, "time": "2016-09-14T11:01:45Z", "creator": "markt@apache.org", "creation_time": "2016-09-14T11:01:45Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 51187, "text": "Created attachment 26986\nFile that will be corrupted if you open and save it.\n\nExecuting this code against the attached file will create a file that is unreadable PPT.  The PPT contains only a single small image.\n\n  OPCPackage docPackage = OPCPackage.openOrCreate(input);\n\nFile output = File.createTempFile(\"office-ooxml-\",null);\n            System.out.println(output.getCanonicalPath());\n            docPackage.save(output);\n\n\nSame was true for 3.7 vs 3.8-beta2\n\nIn ppt/slides/_rels/slide1.xml.rels I notedd that the target on rId3 went from slide1.xml on the good version to \"\" on the bad.   Could be more material differences, I just didn't notice.", "id": 146270, "time": "2011-05-11T23:09:27Z", "creator": "thyde@centraldesktop.com", "creation_time": "2011-05-11T23:09:27Z", "is_private": false, "attachment_id": 26986}, {"count": 1, "attachment_id": 26987, "bug_id": 51187, "is_private": false, "id": 146271, "time": "2011-05-11T23:10:23Z", "creator": "thyde@centraldesktop.com", "creation_time": "2011-05-11T23:10:23Z", "tags": [], "text": "Created attachment 26987\nEnd result of open/close"}, {"count": 2, "tags": [], "creator": "thyde@centraldesktop.com", "attachment_id": null, "text": "Same code scenario as ticket #50154 btw", "id": 146272, "time": "2011-05-11T23:11:54Z", "bug_id": 51187, "creation_time": "2011-05-11T23:11:54Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 51187, "is_private": false, "text": "This looks to be an issue with self references during the save step\n\nI've added a unit test in r1128324 which shows the problem. Someone'll need to dig into the OPC code to try to spot what's going wrong", "id": 146679, "time": "2011-05-27T14:36:16Z", "creator": "apache@gagravarr.org", "creation_time": "2011-05-27T14:36:16Z", "attachment_id": null}, {"count": 4, "attachment_id": null, "bug_id": 51187, "is_private": false, "id": 148539, "time": "2011-08-11T08:13:40Z", "creator": "yegor@dinom.ru", "creation_time": "2011-08-11T08:13:40Z", "tags": [], "text": "Fixed in r1156529\n\nNick is right, it was an issue with saving self references. PackagingURIHelper#relativizeURI resolved self references to an empty string which is wrong. The correct behavior is to return the last segment in the URI. In your case both the source and target URIs are /ppt/slides/slide1.xml and the value written in the relationship part should be slide1.xml (was empty string). \n\nIt appears that self-referencing is legal from the OPC point of view. One way to reproduce the problem in MS Office is to create a .pptx presentation, add a slide and put a hyperlink that points to this slide. The slide will reference itself in /slides/_rels/slide1.xml.rels.  \n\nYegor"}]
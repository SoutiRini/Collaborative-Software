[{"count": 0, "tags": [], "bug_id": 41853, "attachment_id": null, "is_private": false, "id": 100448, "time": "2007-03-15T16:39:34Z", "creator": "janekdb@gmail.com", "creation_time": "2007-03-15T16:39:34Z", "text": "A servlet configured like this is created twice and has it's init method invoked\neach time\n\n  <servlet>\n    <servlet-name>builder</servlet-name>\n    <servlet-class>org.ntropa.adapter.servlet.NtropaBuilder</servlet-class>\n    <load-on-startup>1</load-on-startup>\n  </servlet>\n\nThis is the head of the init method I checked this with,\n\n    private int initCount;\n\n    private static int staticInitCount;\n\n    public void init(ServletConfig config) throws ServletException {\n        initCount++;\n        staticInitCount++;\n        config.getServletContext().log(\n                \"NtropaBuilder: init: id: \" + System.identityHashCode(this) + \"\ninitCount: \" + initCount + \", static: \"\n                        + staticInitCount + \", Runtime id: \" +\nSystem.identityHashCode(Runtime.getRuntime()));\n    ...\n    }\n\nThis is the output.\n\nINFO: NtropaBuilder: init: id: 11587215 initCount: 1, static: 1, Runtime id:\n29959477\nINFO: NtropaBuilder: init: id: 16868914 initCount: 1, static: 1, Runtime id:\n29959477\n\nSo each time init is invoked the servlet object is different and the classloader\nis different.\n\nI have not tried this with 5.5.23 but there was no mention in the fixed bugs\nlist of an issue like this between 5.5.20 and 5.5.23. I did spot this earlier,\nsimilar sounding bug that was fixed in 5.5.13\n\n  36802: Fix problem of double-init when JMX-deploying a Context into a started\nHost. (billbarker)\n\nI don't know if that bug is related to this one or not."}, {"count": 1, "tags": [], "creator": "janekdb@gmail.com", "attachment_id": null, "id": 100976, "time": "2007-03-26T14:36:40Z", "bug_id": 41853, "creation_time": "2007-03-26T14:36:40Z", "is_private": false, "text": "A ServletContextListener is also created and initialized twice.\n\nThis configuration in web.xml\n\n  <listener>\n    <listener-class>org.ntropa.adapter.servlet.NtropaBuilder</listener-class>\n  </listener>\n\nresults in two log entries instead of one.\n\nINFO: NtropaBuilder: init: id: 15277917 initCount: 1, static: 1, Runtime id: \n17447716\nINFO: NtropaBuilder: init: id: 12710158 initCount: 1, static: 1, Runtime id: \n17447716\n\nThis is the code that outputs the above logs entries,\n\n    private int initCount;\n\n    private static int staticInitCount;\n\n    public void contextInitialized(ServletContextEvent sce) {\n\n        initCount++;\n        staticInitCount++;\n        context.log(\"NtropaBuilder: init: id: \" + System.identityHashCode(this) \n+ \" initCount: \" + initCount\n                + \", static: \" + staticInitCount + \", Runtime id: \" + \nSystem.identityHashCode(Runtime.getRuntime()));\n\n   ...}"}, {"count": 2, "tags": [], "bug_id": 41853, "attachment_id": null, "is_private": false, "id": 101067, "time": "2007-03-27T13:34:23Z", "creator": "janekdb@gmail.com", "creation_time": "2007-03-27T13:34:23Z", "text": "This was not a bug but a misconfiguration caused by my failure to be aware of \nthe defaults for deployOnStartup and autoDeploy.\n\nThis is my corrected Host element\n\n      <Host name=\"localhost\" appBase=\"webapps\" deployOnStartup=\"false\" \nautoDeploy=\"false\">\n        <Context path=\"\" docBase=\"builder.war\"/>\n      </Host>\n\nThese other combinations resulted in a double servlet startup when tomcat was \nstarted,\n\ndeployOnStartup=\"true\" autoDeploy=\"true\"\ndeployOnStartup=\"false\" autoDeploy=\"true\"\ndeployOnStartup=\"true\" autoDeploy=\"false\"\n\n\n\n\n"}]
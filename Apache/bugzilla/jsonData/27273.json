[{"count": 0, "tags": [], "text": "Register a listener of type HttpSessionListener in web.xml. Make it log calls \nto sessionCreated() and sessionDestroyed(). Invoke a servlet to create new HTP \nsession. Within the servlet code set session timeout to something like 5 \nseconds. Close client app. Slowly count to 5. See the listener's log.\n\nExpected: one call to sessionCreated() and one to sessionDestroyed().\\\nActual: one call to sessionCreated(), as expected, then two calls to \nsessionDestroyed(). In both calls to sessionDestroyed() event.getSession() \nreturns reference to the same session object.\n\nReason:\n\nHttpSessionListener receives sessionDestroyed() event twice. \n\nHere is a quote from org.apache.catalina.session.StandardManager:\n\n    public void processExpires() {\n\n        long timeNow = System.currentTimeMillis();\n        Session sessions[] = findSessions();\n\n        for (int i = 0; i < sessions.length; i++) {\n            StandardSession session = (StandardSession) sessions[i];\n            if (!session.isValid()) {\n                try {\n                    expiredSessions++;\n                    session.expire();\n                } catch (Throwable t) {\n                    log.error(sm.getString\n                              (\"standardManager.expireException\"), t);\n                }\n            }\n        }\n        long timeEnd = System.currentTimeMillis();\n        processingTime += ( timeEnd - timeNow );\n\n    }\n\nThe problem, apparently is that session.expire() method is invoked not only \ndirect from the above quoted method (StandardManager,java:815), but also \nsession.isValid() method.\n\nI am not familiar with Tomcat codebase to try and suggest a fix, but a method \ncalled \"isValid\" doing something other than assessing and reporting the session \nstate to its caller seems strange.", "attachment_id": null, "bug_id": 27273, "id": 53068, "time": "2004-02-26T22:40:58Z", "creator": "alex_verk@mail.ru", "creation_time": "2004-02-26T22:40:58Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 27273, "is_private": false, "id": 53070, "attachment_id": null, "creator": "remm@apache.org", "creation_time": "2004-02-26T22:54:14Z", "time": "2004-02-26T22:54:14Z", "text": "\n\n*** This bug has been marked as a duplicate of 25234 ***"}]
[{"count": 0, "tags": [], "text": "Hi,\n\nWe have configured an apache to proxy to a ssl backend.  The configurations for the related ssl are\n\nLoadModule ssl_module modules/mod_ssl.so\n\n<VirtualHost 1.2.3.4:443>\n   SSLEngine on\n</VirtualHost>\n\n<IfModule ssl_module>\n   SSLRandomSeed startup builtin\n   SSLRandomSeed connect builtin\n   SSLProtocol -all +SSLv3 +TLSv1\n   SSLCipherSuite AES256-SHA:DES-CBC3-SHA:AES128-SHA\n   SSLCertificateFile ssl/servercert.pem\n   SSLProxyEngine on\n   SSLProxyMachineCertificateFile ssl/servercert.pem\n   SSLProxyMachineCertificateChainFile ssl/cacerts.pem\n</IfModule>\n\nApache fails to start when the servercert.pem  is alike:\n\n-----BEGIN PRIVATE KEY-----\nthe key\n-----END PRIVATE KEY-----\n\nThe error logs are:\n\n[Fri Oct 18 17:32:53.837463 2013] [ssl:debug] [pid 463004:tid 139787389822720] ssl_engine_pphrase.c(181): AH02199: SSL not enabled on vhost foo.com:80, skipping SSL setup\n[Fri Oct 18 17:32:53.837502 2013] [ssl:info] [pid 463004:tid 139787389822720] AH02200: Loading certificate & private key of SSL-aware server myhost.com:8443'\n[Fri Oct 18 17:32:53.837733 2013] [ssl:debug] [pid 463004:tid 139787389822720] ssl_engine_pphrase.c(239): AH02202: Init: Read server certificate from '/opt/apache/ssl/servercert.pem'\n[Fri Oct 18 17:32:53.837938 2013] [ssl:debug] [pid 463004:tid 139787389822720] ssl_engine_pphrase.c(506): AH02249: unencrypted RSA private key - pass phrase not required\n[Fri Oct 18 17:32:53.976865 2013] [ssl:info] [pid 463004:tid 139787389822720] AH01887: Init: Initializing (virtual) servers for SSL\nAH02252: incomplete client cert configured for SSL proxy (missing or encrypted private key?)\n[Fri Oct 18 17:32:53.977284 2013] [ssl:emerg] [pid 463004:tid 139787389822720] AH02312: Fatal error initialising mod_ssl, exiting.\n\n1/ oddly it appears you can workaround the problem by changing the line from -----BEGIN PRIVATE KEY-----   to -----BEGIN RSA PRIVATE KEY-----\n\n2/ the problem happens only with SSLProxyMachineCertificateFile, the same certificate works fine with SSLCACertificateFile\n\nThe problem stems from our CA  generating the certs with openssl 1.0.1e  which changed (comparing to 0.9.8) its default private key format to PKCS#8. \n\nSince SSLCACertificateFile directive appears to supports either format PKCS#1 and #8 it is strange that SSLProxyMachineCertificateFile does not \u2013 is this a bug or am I missing something?\n\nThank you very much,\nRegards - Fred", "attachment_id": null, "id": 170682, "creator": "fredk2@gmail.com", "time": "2013-10-18T21:03:47Z", "bug_id": 55673, "creation_time": "2013-10-18T21:03:47Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 42961, "attachment_id": null, "is_private": false, "id": 105863, "time": "2007-07-23T16:57:35Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-07-23T16:57:35Z", "text": "I'm attaching a file which doesn't render at all in the WMF renderer.  Other\ntools (e.g. Paint) seem to work fine."}, {"count": 1, "tags": [], "bug_id": 42961, "attachment_id": 20536, "id": 105864, "creation_time": "2007-07-23T16:59:17Z", "time": "2007-07-23T16:59:17Z", "creator": "trejkaz@trypticon.org", "text": "Created attachment 20536\nnot rendered.wmf\n\nAttaching sample file.\n\nCode used to test:\n\n    File file = new File(\"not rendered.wmf\");\n    WMFRecordStore store = new WMFRecordStore();\n    store.read(new DataInputStream(new FileInputStream(file)));\n    WMFPainter painter = new WMFPainter(store, 1.0f);\n    BufferedImage image = new BufferedImage(store.getWidthPixels(),\n\t\t\t\t\t    store.getHeightPixels(),\n\t\t\t\t\t    BufferedImage.TYPE_INT_ARGB);\n    Graphics2D graphics = image.createGraphics();\n    painter.paint(graphics);\n    graphics.dispose();\n    ImageIO.write(image, \"png\", new File(\"not rendered.png\"));\n\nResult is a PNG which is entirely transparent.", "is_private": false}, {"count": 2, "attachment_id": 20537, "bug_id": 42961, "is_private": false, "id": 105865, "time": "2007-07-23T18:01:56Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-07-23T18:01:56Z", "tags": [], "text": "Created attachment 20537\nPatch fixes the issue for this file\n\nWow, I didn't think it would be this simple.\n\nWMFRecordStore line 82 was exiting the loop when recSize <= 0.\tIn the WMF file\nI attached here, there was a record of size exactly 0.\tChanging the condidion\nto recSize < 0 fixes the issue."}, {"count": 3, "attachment_id": 20538, "bug_id": 42961, "is_private": false, "id": 105866, "time": "2007-07-23T18:49:03Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-07-23T18:49:03Z", "tags": [], "text": "Created attachment 20538\nAnother WMF that still has a problem\n\nPatch solves about 95% of incidents but I found another eight that still fail. \nHere's one."}, {"count": 4, "tags": [], "bug_id": 42961, "attachment_id": null, "id": 105867, "time": "2007-07-23T19:00:03Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-07-23T19:00:03Z", "is_private": false, "text": "It seems that the new file's problem is that it contains two unimplemented\nfunctions, META_SETSTRETCHBLTMODE and META_STRETCHDIB.\n\nImplementing these is out of my league... feel free to split this into a\ndifferent bug if it makes more sense to do that.  I suspect the remaining files\nare similar because when I look at the files, they do all contain similar\ncharacteristics (they all contain a small image scaled to be bigger.)\n"}, {"count": 5, "tags": [], "bug_id": 42961, "attachment_id": null, "id": 105872, "time": "2007-07-23T20:48:13Z", "creator": "trejkaz@trypticon.org", "creation_time": "2007-07-23T20:48:13Z", "is_private": false, "text": "LOL...\n\nI only just realised this (because I do the diffs relative to our local branch)\nthat the previous fix is dependent on my fix to Bug 42479 which caused the\nproblem. :-)\n"}, {"count": 6, "tags": [], "text": "(In reply to comment #4)\n> It seems that the new file's problem is that it contains two unimplemented\n> functions, META_SETSTRETCHBLTMODE and META_STRETCHDIB.\n> \n> Implementing these is out of my league... feel free to split this into a\n> different bug if it makes more sense to do that.  I suspect the remaining files\n> are similar because when I look at the files, they do all contain similar\n> characteristics (they all contain a small image scaled to be bigger.)\n> \n\nDoes your last fix fix the problem with the new file ? I understand that no.", "is_private": false, "id": 106005, "creator": "herve.girod@club-internet.fr", "time": "2007-07-27T14:01:25Z", "bug_id": 42961, "creation_time": "2007-07-27T14:01:25Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "trejkaz@trypticon.org", "is_private": false, "text": "No, my fix only solved the issue for the first file (which was in turn due to \na fix for another bug, funnily enough.)  The second file has unimplemented \ncommands in it.", "id": 106007, "time": "2007-07-27T23:01:31Z", "bug_id": 42961, "creation_time": "2007-07-27T23:01:31Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 42961, "attachment_id": null, "id": 106008, "creation_time": "2007-07-28T01:58:30Z", "time": "2007-07-28T01:58:30Z", "creator": "herve.girod@club-internet.fr", "text": "(In reply to comment #7)\n> No, my fix only solved the issue for the first file (which was in turn due to \n> a fix for another bug, funnily enough.)  The second file has unimplemented \n> commands in it.\n\nThe second example was incorrectly defined as text, so it seems impossible to\nretrieve it as a WMF file. I tried to change its type as octet/stream, but it\ndoes not work. Can you resubmit it as stream ? ;-)", "is_private": false}, {"count": 9, "tags": [], "text": "Seems to be okay now, if I click on it, it tries to open in Paint.\n", "attachment_id": null, "id": 106031, "creator": "trejkaz@trypticon.org", "time": "2007-07-29T16:06:03Z", "bug_id": 42961, "creation_time": "2007-07-29T16:06:03Z", "is_private": false}, {"count": 10, "tags": [], "text": "(In reply to comment #9)\n> Seems to be okay now, if I click on it, it tries to open in Paint.\n> \n\nI can't open it with Paint on my PC (contrary to the first example). It says\nthat it is not a valid file...\n", "attachment_id": null, "id": 106067, "creator": "herve.girod@club-internet.fr", "time": "2007-07-30T12:29:55Z", "bug_id": 42961, "creation_time": "2007-07-30T12:29:55Z", "is_private": false}, {"count": 11, "tags": [], "creator": "trejkaz@trypticon.org", "attachment_id": null, "id": 106088, "creation_time": "2007-07-30T23:49:34Z", "time": "2007-07-30T23:49:34Z", "bug_id": 42961, "text": "Works fine here.  I don't even get a warning, it just opens quietly.  This is on\nVista, so it's possible some versions of Windows treat the file differently.\n", "is_private": false}, {"count": 12, "attachment_id": null, "bug_id": 42961, "is_private": false, "id": 106176, "time": "2007-08-02T07:22:32Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2007-08-02T07:22:32Z", "tags": [], "text": "(In reply to comment #11)\n> Works fine here.  I don't even get a warning, it just opens quietly.  This is on\n> Vista, so it's possible some versions of Windows treat the file differently.\n> \n\nYou're right, I was trying to open it on my old Windows Me, but it works fine\nwith my other XP box. However, I think this is a little more difficult here:\n- It will be easy to cope with the two META_STRETCHDIB and\nMETA_SETSTRETCHBLTMODE functions, because I have already done something like\nthat (stretching bitmaps) for another existing function before.\n- But there is another problem to cope with: the file does not have an Aldus\nHeader, so it will also be necessary to decode the MAPMODE, which is not done at\nthe moment in the code (in WMFHeaderProperties and WMFRecordStore). Also the\nAbstractWMFReader will need to be slightly modified to take care of this new\ncase (for the moment, it assumes that the Aldus header was present).\n\nI think I will be able to propose a patch for the end of the month, if someone\nhas not done it before...\n"}, {"count": 13, "tags": [], "bug_id": 42961, "attachment_id": null, "is_private": false, "id": 106177, "time": "2007-08-02T07:24:15Z", "creator": "herve.girod@club-internet.fr", "creation_time": "2007-08-02T07:24:15Z", "text": "(In reply to comment #12) \n> I think I will be able to propose a patch for the end of the month, if someone\n> has not done it before...\n> \n\nEnd of the month because I'm going to Japan for holidays tomorrow, returning\nhome the 17th of August ;-) "}, {"count": 14, "tags": [], "text": "You're right, there is no APM header... we handle these by yanking the \nviewport size out and creating a fake APM header, which works for a lot of \npictures but sometimes produces the wrong scaling. Implementing support for \ndoing it properly will certainly add time, although those of us who currently \nwork around it in a shoddy way will certainly thank you. :-)\n\nAnd I envy you.  I had my two weeks in Japan almost a whole year ago, and I'm \nstill pining for Akihabara.\n", "attachment_id": null, "id": 106245, "creator": "trejkaz@trypticon.org", "time": "2007-08-03T02:10:56Z", "bug_id": 42961, "creation_time": "2007-08-03T02:10:56Z", "is_private": false}, {"count": 15, "tags": [], "text": "(In reply to comment #14)\n> You're right, there is no APM header... we handle these by yanking the \n> viewport size out and creating a fake APM header, which works for a lot of \n> pictures but sometimes produces the wrong scaling. Implementing support for \n> doing it properly will certainly add time, although those of us who currently \n> work around it in a shoddy way will certainly thank you. :-)\n> \n> And I envy you.  I had my two weeks in Japan almost a whole year ago, and I'm \n> still pining for Akihabara.\n> \nOK, returned from japan (that was GREAT !!), and had time since my return a few\ndays ago to fix this. Since it is in my local copy, I need to sync before\nsending the patch (I think it will be done before end of the week-end). I had to\nfix 3 things to be able to see the image:\n- implement META_STRETCHDIB\n- implement META_MAPMODE (the file is in ANISOTROPIC mode)\n- allow to read metafiles without APM\n\n", "is_private": false, "id": 107140, "creator": "herve.girod@club-internet.fr", "time": "2007-08-23T02:32:16Z", "bug_id": 42961, "creation_time": "2007-08-23T02:32:16Z", "attachment_id": null}, {"count": 16, "tags": [], "creator": "herve.girod@club-internet.fr", "is_private": false, "id": 107143, "creation_time": "2007-08-23T02:40:34Z", "time": "2007-08-23T02:40:34Z", "bug_id": 42961, "text": "I just created a new bug #43194, because i think this is some \"big\" patch, and\nit is a slightly different issue from this one. I reused your second example for\nthis.", "attachment_id": null}, {"count": 17, "tags": [], "text": "(In reply to comment #16)\n> I just created a new bug #43194, because i think this is some \"big\" patch, and\n> it is a slightly different issue from this one. I reused your second example for\n> this.\n\nOK, patch uploaded for #43194, this should close this bug and the other.", "attachment_id": null, "id": 107264, "creator": "herve.girod@club-internet.fr", "time": "2007-08-26T05:47:58Z", "bug_id": 42961, "creation_time": "2007-08-26T05:47:58Z", "is_private": false}, {"count": 18, "tags": [], "creator": "cam@apache.org", "is_private": false, "id": 108355, "creation_time": "2007-09-18T19:12:52Z", "time": "2007-09-18T19:12:52Z", "bug_id": 42961, "text": "Patch from bug #43194 applied.", "attachment_id": null}]
[{"count": 0, "tags": [], "text": "Created attachment 33714\nTest case output\n\nThe following test case is constantly failing in my environment.\norg.apache.tomcat.websocket.server.TestClose#testWsCloseThenTcpResetWhenOnMessageSends\n\ntest case is run against trunk(r1737152).\n\nEnvironment details:\n\nOS: Mac OS X\nJDK: 1.6.0_65 + 1.7.0_80 (for web socket test cases, 1.7.0_80 should be used)\ntcnative version: 1.2.5 \nAPR version: 1.5.2\nopenssl version:  OpenSSL 1.0.2g  1 Mar 2016\n\n\nTestcase: testWsCloseThenTcpResetWhenOnMessageSends took 0.148 sec\n    FAILED\nRx: NORMAL_CLOSURE\njunit.framework.AssertionFailedError: Rx: NORMAL_CLOSURE\n    at org.apache.tomcat.websocket.server.TestClose.awaitOnClose(TestClose.java:107)\n    at org.apache.tomcat.websocket.server.TestClose.awaitOnClose(TestClose.java:100)\n    at org.apache.tomcat.websocket.server.TestClose.testWsCloseThenTcpResetWhenOnMessageSends(TestClose.java:267)\n\n\nI have confirmed that server received web socket NORMAL_CLOSURE frame before the connection is reset forcely.\n\nMy suggestion is to expect NORMAL_CLOSURE as well as CLOSED_ABNORMALLY, just like what org.apache.tomcat.websocket.server.TestClose#testWsCloseThenTcpCloseWhenOnMessageSends does.", "attachment_id": 33714, "bug_id": 59254, "id": 189852, "time": "2016-03-31T00:33:20Z", "creator": "huxing.zhang@gmail.com", "creation_time": "2016-03-31T00:33:20Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59254, "text": "Created attachment 33715\nPatch to fix the test case", "id": 189853, "time": "2016-03-31T00:36:57Z", "creator": "huxing.zhang@gmail.com", "creation_time": "2016-03-31T00:36:57Z", "is_private": false, "attachment_id": 33715}, {"count": 2, "tags": [], "bug_id": 59254, "attachment_id": null, "text": "Thanks for the report and the patch. It has been applied to 7.0.x for 7.0.70 onwards.", "id": 190147, "time": "2016-04-11T20:51:45Z", "creator": "markt@apache.org", "creation_time": "2016-04-11T20:51:45Z", "is_private": false}]
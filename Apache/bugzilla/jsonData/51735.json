[{"attachment_id": null, "tags": [], "creator": "andrew.chapman@brighterworking.com", "is_private": false, "count": 0, "id": 148877, "time": "2011-08-29T07:43:35Z", "bug_id": 51735, "creation_time": "2011-08-29T07:43:35Z", "text": "I have two tomcat servers:\n- Server 1 has a welcome page which checks for a certain URL parameter and if it is missing redirects to server 2. \n- Server 2 checks for the same URL parameter and if it is present redirects to server 1.\n\nMy tomcat 7.0.16 installations seem to check the welcome page during start-up. Where the result is a redirect, they also seem to check the redirect URL responds correctly. If the response is bad, the server waits a while and then retries.\n\nUnfortunately, this means that if both servers go down then neither can start. They both end up rechecking their welcome page forever (or until a server start-up timeout).\n\nIt would be nice if the start-up checks on the welcome page passed if an external redirect (i.e. to a host not served by this instance) was received as the result.\n\nI don't have the source code available, but the stack leading to the welcome page stack is:\n\nStandardHostValve.invoke(Request, Response) line: 164\t\nErrorReportValve.invoke(Request, Response) line: 100\t\nAccessLogValve.invoke(Request, Response) line: 563\t\nStandardEngineValve.invoke(Request, Response) line: 118\t\nCoyoteAdapter.service(Request, Response) line: 403\t\nHttp11Processor.process(SocketWrapper<Socket>) line: 301\t\nHttp11Protocol$Http11ConnectionHandler.process(SocketWrapper<Socket>, SocketStatus) line: 162\t\nHttp11Protocol$Http11ConnectionHandler.process(SocketWrapper<Socket>) line: 140\t\nJIoEndpoint$SocketProcessor.run() line: 309\t\nThreadPoolExecutor$Worker.runTask(Runnable) line: 886\t\nThreadPoolExecutor$Worker.run() line: 908\t\nTaskThread(Thread).run() line: 662\t\n\nIn case it's relevant, I'm also using various bits of spring security and struts2 filters around the welcome page."}, {"count": 1, "tags": [], "creator": "markt@apache.org", "is_private": false, "id": 148879, "creation_time": "2011-08-29T10:28:15Z", "time": "2011-08-29T10:28:15Z", "bug_id": 51735, "text": "(In reply to comment #0)\n> My tomcat 7.0.16 installations seem to check the welcome page during start-up.\n\nNope. That will be the application.", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 51735, "text": "Thanks. \n\nJust in case anyone else gets this, it looks like it was the Eclipse server launcher which seems to check the context URL as part of it's checks that the server has started (I think).\n\nIf I generate a WAR of the application and stick it into a naked Tomcat 7 install I don't get the same behaviour.", "id": 148884, "time": "2011-08-29T11:55:19Z", "creator": "andrew.chapman@brighterworking.com", "creation_time": "2011-08-29T11:55:19Z", "tags": [], "is_private": false}]
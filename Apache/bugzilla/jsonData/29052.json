[{"count": 0, "tags": [], "creator": "dhananjayan_k@satyam.com", "text": "Hi,\nI have written custom ant task by extending from Task class. In the execute \nmethod i call getProject() method, but it returns null.\nSo i get NullPointerException at the position.\nWhenever I try to get Project object by using getProject() from a custom task \nthe Project object is null.\n\nPlease clarify either its a bug or a behavior.\n\n\n\npackage anttask;\nimport org.apache.tools.ant.Task;\nimport org.apache.tools.ant.Project;\n\npublic class JustBuild extends Task\n\n{\npublic static void main(String[] args)\n{\nJustBuild justBuild = new JustBuild();\n//justBuild.setVersion(\"01.05.2004\");\njustBuild.execute();\n}\nprivate String myVersion;\n\npublic void setVersion(String version) \n{\nmyVersion = version;\n}\n\npublic void execute() \n{\nSystem.out.println(\"In execute\");\n\nmyVersion = getProject().getProperty(\"version\");\nif (myVersion == null) \n{\nSystem.out.println(\"myVersion is null\");\n}\nelse \n{\nSystem.out.println(\" myVersion: \" + myVersion.toString());\nint dot = myVersion.lastIndexOf(\".\");\nSystem.out.println(\" got dot: \" + String.valueOf(dot));\nString buildnum = myVersion.substring(dot+1);\nSystem.out.println(\" got buildnum: \" + buildnum);\nSystem.out.println(\" project is :\");\nSystem.out.println(\" project: \"+ getProject().toString());\ngetProject().setProperty(\"buildnum\", buildnum);\n}\n}\n}", "id": 57582, "time": "2004-05-18T05:43:57Z", "bug_id": 29052, "creation_time": "2004-05-18T05:43:57Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 29052, "attachment_id": null, "id": 57583, "time": "2004-05-18T05:52:00Z", "creator": "dhananjayan_k@satyam.com", "creation_time": "2004-05-18T05:52:00Z", "is_private": false, "text": "java.lang.NullPointerException\nat anttask.JustBuild.execute(JustBuild.java:23)\nat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:193)\nat org.apache.tools.ant.Task.perform(Task.java:341)\nat org.apache.tools.ant.Target.execute(Target.java:309)\nat org.apache.tools.ant.Target.performTasks(Target.java:336)\nat org.apache.tools.ant.Project.executeTarget(Project.java:1339)\nat org.apache.tools.ant.Project.executeTargets(Project.java:1255)\nat org.apache.tools.ant.Main.runBuild(Main.java:609)\nat org.apache.tools.ant.Main.start(Main.java:196)\nat org.apache.tools.ant.Main.main(Main.java:235)"}, {"count": 2, "tags": [], "creator": "dhananjayan_k@satyam.com", "attachment_id": null, "is_private": false, "id": 57584, "time": "2004-05-18T05:52:44Z", "bug_id": 29052, "creation_time": "2004-05-18T05:52:44Z", "text": "java.lang.NullPointerException\nat anttask.JustBuild.execute(JustBuild.java:23)\nat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:193)\nat org.apache.tools.ant.Task.perform(Task.java:341)\nat org.apache.tools.ant.Target.execute(Target.java:309)\nat org.apache.tools.ant.Target.performTasks(Target.java:336)\nat org.apache.tools.ant.Project.executeTarget(Project.java:1339)\nat org.apache.tools.ant.Project.executeTargets(Project.java:1255)\nat org.apache.tools.ant.Main.runBuild(Main.java:609)\nat org.apache.tools.ant.Main.start(Main.java:196)\nat org.apache.tools.ant.Main.main(Main.java:235)\n"}, {"count": 3, "tags": [], "bug_id": 29052, "text": "I have tested your code against Ant 1.4.0, 1.5.4, 1.6.1 and CVS and it works \nwell on all:\n\nJustBuild.java\n--------------\nimport org.apache.tools.ant.Task;\nimport org.apache.tools.ant.Project;\n\npublic class JustBuild extends Task {\n    private String myVersion;\n\n    public void setVersion(String version) {\n        myVersion = version;\n    }\n\n    public void execute() {\n        System.out.println(\"In execute\");\n\n        myVersion = getProject().getProperty(\"version\");\n        if (myVersion == null) {\n            System.out.println(\"myVersion is null\");\n        } else {\n            System.out.println(\" myVersion: \" + myVersion.toString());\n            int dot = myVersion.lastIndexOf(\".\");\n            System.out.println(\" got dot: \" + String.valueOf(dot));\n            String buildnum = myVersion.substring(dot+1);\n            System.out.println(\" got buildnum: \" + buildnum);\n            System.out.println(\" project is :\");\n            System.out.println(\" project: \"+ getProject().toString());\n            getProject().setProperty(\"buildnum\", buildnum);\n        }\n    }\n}\n\n\nbuild.xml\n---------\n<project default=\"run\">\n    <target name=\"compile\">\n        <javac srcdir=\".\"/>\n    </target>\n\n    <target name=\"run\" depends=\"compile\">\n        <taskdef name=\"justbuild\" classname=\"JustBuild\" classpath=\".\"/>\n        <echo>Ant-Version: ${ant.version}</echo>\n        <justbuild/>\n    </target>\n</project>\n\n\noutput:\n-------\nC:\\TEMP\\xxx>ant -version\nAnt version 1.4 compiled on September 3 2001\nC:\\TEMP\\xxx>ant\nBuildfile: build.xml\n\ncompile:\n    [javac] Compiling 1 source file\n\nrun:\n     [echo] Ant-Version: Ant version 1.4 compiled on September 3 2001\n[justbuild] In execute\n[justbuild] myVersion is null\n\nBUILD SUCCESSFUL\n\nTotal time: 1 second\nC:\\TEMP\\xxx>set ant_home=c:\\seu\\ant154\n\nC:\\TEMP\\xxx>ant\nBuildfile: build.xml\n\ncompile:\n\nrun:\n     [echo] Ant-Version: Apache Ant version 1.5.4 compiled on August 12 2003\n[justbuild] In execute\n[justbuild] myVersion is null\n\nBUILD SUCCESSFUL\nTotal time: 1 second\nC:\\TEMP\\xxx>set ant_home=c:\\seu\\ant161\n\nC:\\TEMP\\xxx>ant\nBuildfile: build.xml\n\ncompile:\n\nrun:\n     [echo] Ant-Version: Apache Ant version 1.6.1 compiled on February 12 2004\n[justbuild] In execute\n[justbuild] myVersion is null\n\nBUILD SUCCESSFUL\nTotal time: 2 seconds\nC:\\TEMP\\xxx>set ant_home=c:\\seu\\ant17.5\n\nC:\\TEMP\\xxx>ant\nBuildfile: build.xml\n\ncompile:\n\nrun:\n     [echo] Ant-Version: Apache Ant version 1.7alpha compiled on May 10 2004\n[justbuild] In execute\n[justbuild] myVersion is null\n\nBUILD SUCCESSFUL\nTotal time: 1 second", "id": 57589, "time": "2004-05-18T07:00:37Z", "creator": "jan@materne.de", "creation_time": "2004-05-18T07:00:37Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "stevel@apache.org", "attachment_id": null, "text": "Note you should be using setNewProperty(), not setProperty(). Thanks.", "id": 57598, "time": "2004-05-18T10:23:34Z", "bug_id": 29052, "creation_time": "2004-05-18T10:23:34Z", "is_private": false}, {"count": 5, "tags": [], "creator": "dhananjayan_k@satyam.com", "attachment_id": null, "text": "Actually I got to see that the getProject() returns null.\nThe same custom task works fine in ant 1.4, now iam trying with ant 1.5.3\n", "id": 57600, "time": "2004-05-18T10:44:29Z", "bug_id": 29052, "creation_time": "2004-05-18T10:44:29Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 29052, "attachment_id": null, "id": 57601, "time": "2004-05-18T10:47:00Z", "creator": "dhananjayan_k@satyam.com", "creation_time": "2004-05-18T10:47:00Z", "is_private": false, "text": "Actually I got to see that the getProject() returns null.\nThe same implementation of custom task works fine with Ant 1.4 now iam trying \nwith ant 1.5.3"}, {"count": 7, "tags": [], "text": "Hello I'm getting the same thing with a custom compiler by setting build.compiler.\n\nI also tried Project.getProject(this) with a subclass of AbstractDefaultCompiler \nI also tried changing the superclass to Task. \n\nNull null null.  Any idea? Should I raise a new bug?", "attachment_id": null, "id": 130801, "creation_time": "2009-10-02T00:49:49Z", "time": "2009-10-02T00:49:49Z", "creator": "warren.crossing@mofokom.biz", "bug_id": 29052, "is_private": false}, {"count": 8, "tags": [], "bug_id": 29052, "attachment_id": null, "id": 130804, "time": "2009-10-02T01:05:32Z", "creator": "warren.crossing@mofokom.biz", "creation_time": "2009-10-02T01:05:32Z", "is_private": false, "text": "sorry I forgot to mention that I have seen this on 1.7.1 and 1.7.0"}, {"count": 9, "tags": [], "bug_id": 29052, "text": "After a quick scan of the source (thank apache source license) I see it's happening in the constructor.. so I moved get project to the execute method and it performs as expected. Sorry for the disturbance.", "id": 130832, "time": "2009-10-02T11:47:49Z", "creator": "warren.crossing@mofokom.biz", "creation_time": "2009-10-02T11:47:49Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 29052, "is_private": false, "text": "I am trying to get a custom ant task to work. Once in a while it works fine and the other times it gives me null pointer exceptions. When I put print statements in the code, I found out that it works fine when getProject() returns a valid value and gives me null pointer exceptions when getProject() returns null.  \n\nI read in the previous comment that it worked fine when they moved the code from the constructor to the execute method. My code is already in the execute method. Following is the statement where I am using getProject():\nDirectoryScanner ds = fileset.getDirectoryScanner(getProject());\n\nAre there any work arounds available for this? \nAny help / suggestions will be appreciated!", "id": 131086, "time": "2009-10-12T08:42:36Z", "creator": "gincy.z.varghese@accenture.com", "creation_time": "2009-10-12T08:42:36Z", "attachment_id": null}, {"count": 11, "tags": [], "creator": "bodewig@apache.org", "text": "gzv, adding to an issue that is already RESOLVED won't give you much visibility.\n\nLet me assure that getProject() in general works as expected when invoked inside a task's execute method - provided that task instance has been created by Ant itself, for example because it is part of the build file.  If you create a task instance yourself via Java code, then you are responsible of invoking setProject in the first place.\n\nThis is most likely a user error and I'd recommend you approach the user mailing list.", "id": 131273, "time": "2009-10-21T12:31:24Z", "bug_id": 29052, "creation_time": "2009-10-21T12:31:24Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 4633, "text": "Global filtering does not work with copy task at all following instructions in \nthe manual.\n\nTo reproduce, consider the following example:\n\n1. Make a build.xml that contains the following:\n\n<project name=\"test\" default=\"test\">\n    <property file=\"build.properties\" />\n    <filterset id=\"filterconf\" begintoken=\"@\" endtoken=\"@\">\n\t<filtersfile file=\"./test.properties\"/>\n    </filterset>\n    <target name=\"test\">\n\t<copy file=\"./test.file\" tofile=\"./output\" filtering=\"true\">\n        </copy>\n    </target>\n</project>\n\n\n2. Create a file called test.properties that contains the following:\n\nTEST_TOKEN=nobug\n\n3. Create a file to copy called test.file that contains the folllowing:\n\nIs there a bug?\n\n@TEST_TOKEN@\n\n4. Perform the following command:\n\nant -verbose\n\n5. Output shows that the filter file is loaded initially, but there is no \nconfirmation that replacement took place on test.file. Open the file called \noutput and you will still see:\n\n@TEST_TOKEN@\n\n----------\n\nno replacement was made!\n\n\nI have confirmed a workaround although it seriously will bloat build files:\n\nWrite your copy tasks like this:\n\n\n<copy file=\"./test.file\" tofile=\"./output\">\n    <filterset begintoken=\"@\" endtoken=\"@\">\n         <filtersfile file=\"./test.properties\" />\n    </filterset>\n</copy>\n\n\nIn other words, nested filtersets still work, but the filtering attribute of \nthe copy task does not.\n\n-Peter", "id": 7518, "time": "2001-11-04T11:56:38Z", "creator": "peterwlynch@yahoo.com", "creation_time": "2001-11-04T11:56:38Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 4633, "attachment_id": null, "text": "That was intentional.\nThe filtersets when defined are _not_ put into a global pool that was the whole\nidea of making them.\n\nHowever it would make sense to add a filtersetid attribute to copy.\nThat would take an id for a previously defined filterset.\n\nor perhaps just allow <filterset idref=\"filterconf\"/> in copy..\nwould that be too much bloat?\n\nI was not willing to spend too much more time until the patches were accepted as\nthe changes worked for me.\n\nMichael", "id": 7521, "time": "2001-11-04T19:14:25Z", "creator": "gholam@xtra.co.nz", "creation_time": "2001-11-04T19:14:25Z", "is_private": false}, {"count": 2, "tags": [], "creator": "conor@apache.org", "attachment_id": null, "text": "> allow <filterset idref=\"filterconf\"/> in copy..\n> would that be too much bloat?\n\n\nI believe that should work already. I added that when I committed it. Checkout \nAnt's own build file - here is a snippet.\n\n    <copy todir=\"${build.classes}\" \n          overwrite=\"true\">\n      <fileset dir=\"${java.dir}\">\n        <include name=\"**/version.txt\" />\n        <include name=\"**/defaultManifest.mf\" />\n      </fileset>\n      <filterset refid=\"ant.filters\"/>\n    </copy>\n\nTo the original poster - if you want global filters, use the <filter> task and \nnot filtersets. You get less \"bloat\" but less control over which filters are \napplied to which copy operations. Also, can you let me know where the \ndocumentation describes this and I'll double check it.\n", "id": 7522, "time": "2001-11-04T19:28:55Z", "bug_id": 4633, "creation_time": "2001-11-04T19:28:55Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 4633, "attachment_id": null, "id": 7952, "time": "2001-11-15T11:30:18Z", "creator": "peterwlynch@yahoo.com", "creation_time": "2001-11-15T11:30:18Z", "is_private": false, "text": "In response to the question:\n\"Also, can you let me know where the \ndocumentation describes this and I'll double check it.\"\n\nI think I figured out where I got lost.\n\nThe filter task has the filtersfile attribute. That is clear.\nThe filterset can have nested filter tasks.\nThe filterset can be globally referred to by id.\nThe filter tasks that are nested in filtersets are not allowed to have the \nfiltersfile attribute. When you try this, you **don't** get a message telling \nyou to use filtersfile task nested within a filterset task.\n\nIt seems to be weird overlap here. While the docs technically make clear what \nis available where, it still can be confusing why the filtersfile attribute is \nnot available in the filter task nested inside a filterset.\n\nThe docs between filtersfile and filter are technically correct, but still \nrequire the user to very carefully read.\n\n"}]
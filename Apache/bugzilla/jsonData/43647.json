[{"count": 0, "tags": [], "creator": "oliver.leonhardt@eds.com", "is_private": false, "text": "If one client extensively refreshes a dynamic Java web page (especially a JSF\nweb page) hosted within the Tomcat container through mod_jk the value of the\nContent-Type-HTTP-header-line sometimes unexpectedly changes from\n\u201ctext/html;charset=ISO-8859-1\u201d to \u201ctext/plain\u201d.\n\n\nThe problem seems to exist since mod_jk version 1.2.20. With version 1.2.19 the\nproblem doesn\u2019t occur.\n\nThe problem exists for Apache/mod_jk installations both on Windows and Linux.\n\nThe problem occurs with Firefox and Internet Explorer.\n\nEven if a little effort and patience is needed, the problem is reproducible.\n\n\nProceed as following to reproduce the problem:\nPrerequisites:\nIt is assumed an Apache version >= 2.2.4 with loaded mod_jk version >= 1.2.20 is\npresent. It doesn\u2019t matter whether mod_jk is a static (compiled in) or a shared\nmodule and whether mod_jk is precompiled (from the binary distribution) or\ncompiled on the machine in question.\n\nA recent JDK is in place and the JAVA_HOME environment variable is set correctly.\n\nSteps to reproduce the problem:\nDownload latest JBoss AS from here:\nhttp://labs.jboss.com/jbossas/downloads/\n\nExtract the JBoss archive\n\nDownload the MyFaces Tomahawk examples (tomahawk-examples-1.1.6-bin.tar.gz) from\nhere:\nhttp://myfaces.apache.org/download.html\n\nExtract myfaces-example-simple-1.1.6.war from the archive\n\nExtract the content of myfaces-example-simple-1.1.6.war to a new directory named\nmyfaces-example-simple-1.1.6.war in the directory\n<JBOSS_HOME>/server/default/deploy/\n\nRemove myfaces-api-1.1.5.jar and myfaces-impl-1.1.5.jar from directory\n<JBOSS_HOME>/server/default/deploy/myfaces-example-simple-1.1.6.war/WEB-INF/lib/\n\nStart JBoss by running the run-script in <JBOSS_HOME>/bin/\n\nTest the MyFaces examples by pointing your web browser to:\nhttp://localhost:8080/myfaces-example-simple-1.1.6/jscookmenu.jsf\nand press Ctrl + Shift + the web browser\u2019s refresh button multiple times in\nshort intervals. The page should be displayed correctly after every refresh.\n\nConfigure Apache/mod_jk with the following minimal configuration:\n<IfModule mod_jk.c>\n  JkWorkerProperty worker.list=worker1\n  JkWorkerProperty worker.worker1.type=ajp13\n  JkMount /myfaces-example-simple-1.1.6/* worker1\n</IfModule>\n\nStart Apache\n\nPoint your web browser to:\nhttp://localhost/myfaces-example-simple-1.1.6/jscookmenu.jsf\n\nPress Ctrl + Shift + the web browser\u2019s refresh button multiple times in short\nintervals\n\nAfter some refreshes the plain HTML of the page should be displayed instead of\nthe properly parsed web page\n\nEnvironment used for the procedure described above:\nWindows XP SP2 32bit\nApache 2.2.4\nmod_jk 1.2.25 from the binary distribution as shared module for Apache 2.2.4\nJBoss 4.2.1.GA with Tomcat 6\nInternet Explorer 6 and Mozilla Firefox 2.0.0.7\n\n\nA notice:\nIf the AJP13 traffic between Apache/mod_jk and JBoss/Tomcat/Port 8009 is\nmonitored, it can be seen that the value of the Content-Type-header-line is\nalways \u201ctext/html;charset=ISO-8859-1\u201d and never \u201ctext/plain\u201d.", "id": 109448, "time": "2007-10-18T00:58:40Z", "bug_id": 43647, "creation_time": "2007-10-18T00:58:40Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "We are also seeing this bug with Apache/2.2.4 (Unix) mod_jk/1.2.21.  We are\nseeing this behavior when proxying REST and SOAP service calls, as well as jsps.\n It appears that the text/plain content type is being populated from the\nDefaultType defined in httpd.conf.", "attachment_id": null, "id": 109971, "creator": "dvh75@hotmail.com", "time": "2007-10-30T13:33:28Z", "bug_id": 43647, "creation_time": "2007-10-30T13:33:28Z", "is_private": false}, {"count": 2, "tags": [], "text": "We had similar behavior with bug \nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=43478.  ", "is_private": false, "id": 109974, "creator": "larry@vringo.com", "time": "2007-10-30T13:57:17Z", "bug_id": 43647, "creation_time": "2007-10-30T13:57:17Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 43647, "text": "Just reverted our mod_jk version to 1.2.19, Apache 2.2.4.  Problem persists.", "count": 3, "id": 109978, "time": "2007-10-30T14:26:51Z", "creator": "dvh75@hotmail.com", "creation_time": "2007-10-30T14:26:51Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 43647, "text": "Can you try a build from svn to see if this is the same problem as bug43478?", "count": 4, "id": 109994, "time": "2007-10-30T19:43:47Z", "creator": "markt@apache.org", "creation_time": "2007-10-30T19:43:47Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 43647, "attachment_id": null, "id": 110056, "time": "2007-10-31T08:21:37Z", "creator": "dvh75@hotmail.com", "creation_time": "2007-10-31T08:21:37Z", "is_private": false, "text": "Yes, this does appear to be the same problem, as any custom headers set in the\nbackend resource are lost as the response comes through Apache.  We'll build\nfrom svn and see if this fixes it."}, {"count": 6, "tags": [], "bug_id": 43647, "attachment_id": null, "id": 110132, "time": "2007-11-01T10:45:11Z", "creator": "dvh75@hotmail.com", "creation_time": "2007-11-01T10:45:11Z", "is_private": false, "text": "we checked out the latest build from svn, installed it and the problem appears\nto be resolved.  thanks for the help everyone."}, {"attachment_id": null, "tags": [], "bug_id": 43647, "text": "Oliver: any chance you can check, if this solution fixes your problem as well.\nFrom the comments here i'm not totally convinced, that your problem and Dave's\nare the same.", "count": 7, "id": 110134, "time": "2007-11-01T11:09:07Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-11-01T11:09:07Z", "is_private": false}, {"count": 8, "tags": [], "creator": "oliver.leonhardt@eds.com", "is_private": false, "text": "Thank all of you for your efforts.\n\nThis might sound silly but I'm a little confused about what to build from svn. \nShould I build Tomcat or mod_jk? I would appreciate if someone could paste the \nsvn-URL in question. Thank you.\n\nI'm confident I can build from svn and do a test in the next couple days.\n", "id": 110155, "time": "2007-11-02T00:34:42Z", "bug_id": 43647, "creation_time": "2007-11-02T00:34:42Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 43647, "text": "The question is not silly at all. I think we are talking about:\n\nhttp://svn.apache.org/viewvc/tomcat/connectors/trunk/jk/java/org/apache/jk/core/MsgContext.java?view=diff&r1=580814&r2=580815&pathrev=580815\n\nwhich is a patch to the Tomcat AJP connector.\n", "count": 9, "id": 110161, "time": "2007-11-02T04:37:37Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2007-11-02T04:37:37Z", "is_private": false}, {"count": 10, "tags": [], "text": "Depending on when exactly the flush is done on the Tomcat side, it might be\nenough to use the mod_jk side of the fix, which might be easier for you to\nbuild. A development snapshot of mod_jk can be found at:\n\nhttp://people.apache.org/~rjung/mod_jk-dev/\n\nThis builds exactly with the same procedure like a production release.\n", "is_private": false, "id": 110213, "creator": "rainer.jung@kippdata.de", "time": "2007-11-03T11:16:10Z", "bug_id": 43647, "creation_time": "2007-11-03T11:16:10Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "I\u2019ve managed to checkout and compile the latest source of Tomcat from the svn\nrepo. Revision was 591786. I used Apache 2.2.6 with mod_jk 1.2.25. Unfortunately\nthe problem did not occur and was therefore not reproducible.\n\nAfter that I ran a test with Tomcat version 6.0.14 but surprisingly the problem\ndidn\u2019t occur either.\n\nI switched back JBoss and just to make sure I ran a test once more. The problem\noccurred as described in the first post.\n\nAfter that I compiled mod_jk version 1.2.26-dev from Rainer\u2019s URL above and the\nproblem disappeared. No more text/plain output was given at any time.\n\nFrom my point of view the fix in the mod_jk dev-version does the job. In that\ncase I\u2019m looking forward to mod_jk version 1.2.26!\n\nThank you all, especially Rainer, for your support.\n", "is_private": false, "id": 110233, "creator": "oliver.leonhardt@eds.com", "time": "2007-11-05T00:40:04Z", "bug_id": 43647, "creation_time": "2007-11-05T00:40:04Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "rainer.jung@kippdata.de", "is_private": false, "text": "OK, seems that the reason for everyone was flushing before headers. The mod_jk\nside will be released with 1.2.26, expected somewhere in November, the\nTomcat-AJP side will be included in all subsequent 5.5 and 6.0 releases.\n\nThanks everyone for testing!", "id": 110234, "time": "2007-11-05T01:36:44Z", "bug_id": 43647, "creation_time": "2007-11-05T01:36:44Z", "attachment_id": null}]
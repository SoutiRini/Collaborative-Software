[{"count": 0, "tags": [], "creator": "ruhland@telmat.fr", "attachment_id": null, "text": "We are using Apache 2.0.53 as intranet server and proxy server.\nWhen loading PHP 5.0.4 as Apache module, some Apache childs, after few minutes, \ntake 100% cpu load. This also occurs with PHP 4.3.10 and other PHP 5.0.X \nlibraries.\n\nTracing this processes with strace give nothing.", "id": 73298, "time": "2005-04-05T14:57:05Z", "bug_id": 34301, "creation_time": "2005-04-05T14:57:05Z", "is_private": false}, {"count": 1, "tags": [], "creator": "trawick@apache.org", "is_private": false, "text": "Part of the info for diagnosing this is the strace results, which you have\nsupplied (apparently a tight loop which doesn't involve syscalls).\n\nThe other critical part is the backtrace of the process.\n\ngdb /path/to/httpd PID\n(gdb) bt full\n(gdb) detach\n(gdb) quit\n\n(This is probably a PHP problem which we can't do anything about, but just in\ncase we should take a look at the backtrace.)\n", "id": 73300, "time": "2005-04-05T15:17:35Z", "bug_id": 34301, "creation_time": "2005-04-05T15:17:35Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 34301, "attachment_id": null, "is_private": false, "id": 73303, "time": "2005-04-05T15:40:18Z", "creator": "ruhland@telmat.fr", "creation_time": "2005-04-05T15:40:18Z", "text": "(In reply to comment #1)\n> Part of the info for diagnosing this is the strace results, which you have\n> supplied (apparently a tight loop which doesn't involve syscalls).\n> The other critical part is the backtrace of the process.\n> gdb /path/to/httpd PID\n> (gdb) bt full\n> (gdb) detach\n> (gdb) quit\n> (This is probably a PHP problem which we can't do anything about, but just in\n> case we should take a look at the backtrace.)\n\nThanks for your answer.\n\nHere, the result with gdb :\n\n(gdb) bt full\n#0  0x406e993f in execute (op_array=0x824de24) at /root/sources/php-\n5.0.4/Zend/zend_execute.c:1406\n        execute_data = {opline = 0x825f2a4, function_state = \n{function_symbol_table = 0x140, function = 0x824de24, reserved = {0x403e0d24, \n0x403e0d05,\n      0x82554e4, 0x824ddf4}}, fbc = 0x0, fbc_constructor = 0x406a98e0, op_array \n= 0x824de24, object = 0x0, Ts = 0xbfffc190,\n  original_in_execution = 1 '\\001', calling_scope = 0xbfffd300, \nprev_execute_data = 0xbfffd300}\n#1  0x406ee195 in zend_include_or_eval_handler (execute_data=0xbfffd300, \nopline=0x82520b8, op_array=0x825f2a4)\n    at /root/sources/php-5.0.4/Zend/zend_execute.c:3581\n        new_op_array = (zend_op_array *) 0x824de24\n        original_return_value = (zval **) 0xbfffd37c\n        inc_filename = (zval *) 0x0\n        tmp_inc_filename = {value = {lval = 136633720, dval = \n2.1895018180807644e-314, str = {val = 0x824dd78 \"\u00b0d%\\b@x%\\b\\005\", len = 1}, ht \n= 0x824dd78,\n    obj = {handle = 136633720, handlers = 0x1}}, refcount = 0, type = 172 '\u00ac', \nis_ref = 223 '\u00df'}\n        failure_retval = 0 '\\0'\n#2  0x406e9942 in execute (op_array=0x824dcf4) at /root/sources/php-\n5.0.4/Zend/zend_execute.c:1406\n        execute_data = {opline = 0x82520b8, function_state = \n{function_symbol_table = 0xbffff630, function = 0x824de24, reserved = {0x0, \n0x0, 0x0, 0x0}},\n  fbc = 0x0, fbc_constructor = 0xbffff630, op_array = 0x824dcf4, object = 0x0, \nTs = 0xbfffd2e0, original_in_execution = 0 '\\0',\n  calling_scope = 0xbffff630, prev_execute_data = 0x0}\n#3  0x406cd08b in zend_execute_scripts (type=8, retval=0x0, file_count=3) \nat /root/sources/php-5.0.4/Zend/zend.c:1069\n        files = 0xbfffd434 \"\"\n        i = 1\n        file_handle = (zend_file_handle *) 0xbffff630\n        orig_op_array = (zend_op_array *) 0x0\n        local_retval = (zval *) 0x0\n#4  0x4069c3b8 in php_execute_script (primary_file=0xbffff630) \nat /root/sources/php-5.0.4/main/main.c:1632\n        prepend_file_p = (zend_file_handle *) 0x0\n        append_file_p = (zend_file_handle *) 0xbffff630\n        prepend_file = {type = 0 '\\0', filename = 0x0, opened_path = 0x0, \nhandle = {fd = 0, fp = 0x0, stream = {handle = 0x0, reader = 0, closer = 0,\n      interactive = 0}}, free_filename = 0 '\\0'}\n        append_file = {type = 0 '\\0', filename = 0x0, opened_path = 0x0, handle \n= {fd = 0, fp = 0x0, stream = {handle = 0x0, reader = 0, closer = 0,\n      interactive = 0}}, free_filename = 0 '\\0'}\n        old_cwd = 0xbfffd440 \"/\"\n        old_primary_file_path = 0x0\n        retval = 0\n#5  0x406f3320 in php_handler (r=0x8239e28) at /root/sources/php-\n5.0.4/sapi/apache2handler/sapi_apache2.c:555\n        ctx = (php_struct *) 0x8241e58\n        brigade = (apr_bucket_brigade *) 0x8241ed0\n        bucket = (apr_bucket *) 0x825f2a4\n        rv = 136704676\n        parent_req = (request_rec *) 0x0\n#6  0x08067c06 in ap_run_handler (r=0x8239e28) at config.c:153\n        pHook = (ap_LINK_handler_t *) 0x825f2a4\n        n = 10\n        rv = 136704676\n#7  0x080681d8 in ap_invoke_handler (r=0x8239e28) at config.c:364\n        handler = 0x8142cf8 \"application/x-httpd-php\"\n        result = 136583672\n        old_handler = 0x0\n#8  0x08065696 in ap_internal_redirect (new_uri=0x81430c8 \"/error.php3?\nerror=502\", r=0x8238840) at http_request.c:462\n        new = (request_rec *) 0x8239e28\n        access_status = 136704676\n#9  0x0806512a in ap_process_request (r=0x8238840) at http_request.c:262\n        access_status = 136646948\n#10 0x08060cb9 in ap_process_http_connection (c=0x8232800) at http_core.c:251\n        r = (request_rec *) 0x8238840\n        csd_set = 0\n        csd = (apr_socket_t *) 0x0\n#11 0x08070d96 in ap_run_process_connection (c=0x8232800) at connection.c:43\n        pHook = (ap_LINK_process_connection_t *) 0x3\n        n = 0\n        rv = 3\n#12 0x08066574 in child_main (child_num_arg=3) at prefork.c:610\n        ptrans = (apr_pool_t *) 0x82326f0\n        allocator = (apr_allocator_t *) 0x8230660\n---Type <return> to continue, or q <return> to quit---\n        current_conn = (conn_rec *) 0x8232800\n        status = 136521728\n        i = 136646948\n        lr = (ap_listen_rec *) 0x8232800\n        curr_pollfd = 136646948\n        last_pollfd = 2\n        pollset = (apr_pollfd_t *) 0x82307b8\n        offset = 3\n        csd = (void *) 0x8232728\n        sbh = (ap_sb_handle_t *) 0x8230760\n        rv = 3\n        bucket_alloc = (apr_bucket_alloc_t *) 0x8236800\n#13 0x080666a0 in make_child (s=0x809fb88, slot=15) at prefork.c:704\n        pid = 0\n#14 0x08066927 in perform_idle_server_maintenance (p=0x809ddd8) at prefork.c:839\n        i = 0\n        idle_count = 0\n        ws = (worker_score *) 0x3\n        free_length = 8\n        free_slots = {12, 13, 14, 15, 16, 17, 18, 19, 0, 0, 0, 0, 1075714220, \n1000000, 0, 1075685459, 0, 0, 0, 0, -1073743584, 0, 1000000, 0, 0, 0,\n  -1073743528, -1073743488, 134871944, 0, -1073743528, 134682967}\n        last_non_dead = 11\n        total_non_dead = 12\n#15 0x08066f2e in ap_mpm_run (_pconf=0x809ddd8, plog=0x80c7e80, s=0x809fb88) at \nprefork.c:1040\n        index = 0\n        remaining_children_to_start = 0\n        rv = 3\n#16 0x0806c6f8 in main (argc=4, argv=0xbffffa64) at main.c:618\n        c = 68 'D'\n        configtestonly = 0\n        confname = 0x8089b5f \"conf/httpd.conf\"\n        def_server_root = 0x808aa85 \"/usr/local/apache\"\n        temp_error_log = 0x0\n        process = (process_rec *) 0x809be50\n        server_conf = (server_rec *) 0x809fb88\n        pglobal = (apr_pool_t *) 0x809bdd0\n        pconf = (apr_pool_t *) 0x809ddd8\n        plog = (apr_pool_t *) 0x80c7e80\n        ptemp = (apr_pool_t *) 0x80b7e40\n        pcommands = (apr_pool_t *) 0x809fde0\n        opt = (apr_getopt_t *) 0x809fe78\n        rv = 3\n        mod = (module **) 0x809fb88\n        optarg = 0xbffffb93 \"SSL\"\n        signal_server = (apr_OFN_ap_signal_server_t *) 0x8251124\n#17 0x402c3d06 in __libc_start_main () from /lib/libc.so.6\nNo symbol table info available."}, {"count": 3, "tags": [], "bug_id": 34301, "text": "The backtrace shows that the loop is deep in PHP-land.  Report the problem to\nthem and show them the same info you've posted here.  Assume for now it isn't an\nApache problem.\n\n", "id": 73320, "time": "2005-04-05T22:41:05Z", "creator": "trawick@apache.org", "creation_time": "2005-04-05T22:41:05Z", "is_private": false, "attachment_id": null}]
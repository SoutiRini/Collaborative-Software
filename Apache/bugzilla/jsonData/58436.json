[{"count": 0, "tags": [], "bug_id": 58436, "attachment_id": null, "id": 185380, "time": "2015-09-21T10:03:46Z", "creator": "krieger.thomas@gmx.de", "creation_time": "2015-09-21T10:03:46Z", "is_private": false, "text": "Using http://vmlens.com to find data races I found the following data race:\nIn ClassLoaderLogManager the method addLogger access the classLoaderLoggers hashmap synchronized but the method shutdown does not use any synchronization.\n\nHere are example stacktraces:\nlocalhost-startStop-1 (16)\njava/util/concurrent/ThreadPoolExecutor$Worker.run \njava/util/concurrent/ThreadPoolExecutor.runWorker \njava/util/concurrent/FutureTask.run \njava/util/concurrent/Executors$RunnableAdapter.call\norg/apache/catalina/startup/HostConfig$DeployWar.run\norg/apache/catalina/startup/HostConfig.deployWAR\norg/apache/catalina/core/StandardHost.addChild\norg/apache/catalina/core/ContainerBase.addChild\norg/apache/catalina/core/ContainerBase.addChildInternal\norg/apache/catalina/util/LifecycleBase.start\norg/apache/catalina/core/StandardContext.startInternal\norg/apache/catalina/core/ContainerBase.getLogger\norg/apache/juli/logging/LogFactory.getLog\norg/apache/juli/logging/LogFactory.getInstance\norg/apache/juli/logging/DirectJDKLog.getInstance\norg/apache/juli/logging/DirectJDKLog.<init>\njava/util/logging/Logger.getLogger\njava/util/logging/Logger.demandLogger\njava/util/logging/LogManager.demandLogger\norg/apache/juli/ClassLoaderLogManager.getLogger\norg/apache/juli/ClassLoaderLogManager.getClassLoaderInfo\norg/apache/juli/ClassLoaderLogManager$2.run\norg/apache/juli/ClassLoaderLogManager$2.run\norg/apache/juli/ClassLoaderLogManager.readConfiguration\njava/util/WeakHashMap.put \n\nThread-1 (12)\njava/util/concurrent/ThreadPoolExecutor$Worker.run\t\norg/apache/juli/ClassLoaderLogManager$Cleaner.run\t\norg/apache/juli/ClassLoaderLogManager.shutdown\t\njava/util/WeakHashMap$HashIterator.nextEntry"}, {"count": 1, "tags": [], "text": "Thanks for the report. Fixed in trunk, 8.0.x (for 8.0.27 onwards) and 7.0.x (for 7.0.65 onwards).", "attachment_id": null, "id": 185384, "creator": "markt@apache.org", "time": "2015-09-21T13:01:22Z", "bug_id": 58436, "creation_time": "2015-09-21T13:01:22Z", "is_private": false}]
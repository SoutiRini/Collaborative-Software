[{"count": 0, "tags": [], "creator": "kakvicky@yahoo.co.in", "text": "Attached is the sample app whose index.jsp would explain the error, call this jsp \nhttp://localhost:8080/sampleapp/index.jsp\n\nThe TomcatCL does not resolve the array class e.g \nloader.loadClass(\"[Lsample.SampleClass;\")\n\nAnd here is the fix \n\nIndex: src/share/classes/org/apache/catalina/loader/WebappClassLoader.java\n===================================================================\n--- src/share/classes/org/apache/catalina/loader/WebappClassLoader.java (revision 1335)\n+++ src/share/classes/org/apache/catalina/loader/WebappClassLoader.java (working copy)\n@@ -902,8 +902,22 @@\n                throw new ClassNotFoundException(name);\n            }\n        } catch (ClassNotFoundException e) {\n-            if (log.isTraceEnabled())\n-                log.trace(\"    --> Passing on ClassNotFoundException\");\n+         if (log.isTraceEnabled())\n+         log.trace(\"We need to check for array class \"+name);\n+            if( name.charAt(0) == '[' )\n+            {\n+               clazz = Class.forName(name, true, this);\n+               if (log.isTraceEnabled())\n+               log.debug(\"      Returning class \" + clazz);\n+               if ((log.isTraceEnabled()) && (clazz != null))\n+                   log.debug(\"      Loaded by \" + clazz.getClassLoader());\n+               return clazz;\n+            }\n+            else\n+            {\n+            if (log.isTraceEnabled())\n+                log.trace(\"    --> Passing on ClassNotFoundException\");\n+            }\n            throw e;\n        }", "id": 133337, "time": "2010-01-05T05:19:36Z", "bug_id": 48489, "creation_time": "2010-01-05T05:19:36Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "kakvicky@yahoo.co.in", "attachment_id": 24795, "id": 133338, "time": "2010-01-05T05:21:45Z", "bug_id": 48489, "creation_time": "2010-01-05T05:21:45Z", "is_private": false, "text": "Created attachment 24795\nProposed Fix.\n\nI did try the patch here \nhttp://svn.apache.org/repos/asf/tomcat/trunk/java/org/apache/catalina/loader/WebappClassLoader.java"}, {"count": 2, "tags": [], "bug_id": 48489, "attachment_id": 24796, "text": "Created attachment 24796\nsample test application.", "id": 133339, "time": "2010-01-05T05:23:24Z", "creator": "kakvicky@yahoo.co.in", "creation_time": "2010-01-05T05:23:24Z", "is_private": false}, {"count": 3, "tags": [], "text": "Created attachment 24797\nBug48489.patch", "attachment_id": 24797, "bug_id": 48489, "id": 133340, "time": "2010-01-05T05:29:48Z", "creator": "kakvicky@yahoo.co.in", "creation_time": "2010-01-05T05:29:48Z", "is_private": false}, {"count": 4, "tags": [], "text": " Bug48489.patch is the required fix.", "attachment_id": null, "bug_id": 48489, "id": 133341, "time": "2010-01-05T05:30:26Z", "creator": "kakvicky@yahoo.co.in", "creation_time": "2010-01-05T05:30:26Z", "is_private": false}, {"count": 5, "tags": [], "creator": "fhanik@apache.org", "text": "couldn't you just use\n\n-Dsun.lang.ClassLoader.allowArraySyntax=true", "id": 133342, "time": "2010-01-05T05:54:58Z", "bug_id": 48489, "creation_time": "2010-01-05T05:54:58Z", "is_private": false, "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 48489, "is_private": false, "id": 133345, "time": "2010-01-05T08:30:05Z", "creator": "kakvicky@yahoo.co.in", "creation_time": "2010-01-05T08:30:05Z", "tags": [], "text": "(In reply to comment #5)\n> couldn't you just use\n> \n> -Dsun.lang.ClassLoader.allowArraySyntax=true\n\nI don't see it useful, here is the related bug\nhttp://bugs.sun.com/view_bug.do?bug_id=6434149\n\nThe TomcatCL does not resolve the custom class array, this should be done via system classloader call as \n>>+               clazz = Class.forName(name, true, this);"}, {"count": 7, "tags": [], "creator": "kschneider@gmail.com", "text": "(In reply to comment #6)\n> http://bugs.sun.com/view_bug.do?bug_id=6434149\n\nThat bug, as well as others, implies that your JSP code is wrong. Instead of this:\n\nloader.loadClass(\"[Lsample.SampleClass;\")\n\nyou should do this:\n\nClass.forName(\"[Lsample.SampleClass;\", false, loader)", "id": 133346, "time": "2010-01-05T08:41:17Z", "bug_id": 48489, "creation_time": "2010-01-05T08:41:17Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 133355, "time": "2010-01-05T13:54:40Z", "bug_id": 48489, "creation_time": "2010-01-05T13:54:40Z", "is_private": false, "text": "This is a 'feature' of the underlying JDK rather than a Tomcat bug. The workarounds already described should be sufficient."}, {"count": 9, "tags": [], "bug_id": 48489, "attachment_id": null, "text": "(In reply to comment #8)\n> This is a 'feature' of the underlying JDK rather than a Tomcat bug. The\n> workarounds already described should be sufficient.\n\nCould you please explain in detail why don't you think it is an issue with the TomcatCL implementation?\nWhat workaround you are referring to, enabling -Dsun.lang.ClassLoader.allowArraySyntax=true does not help as I tried it even though it does not make sense to me.", "id": 133358, "time": "2010-01-05T19:50:39Z", "creator": "kakvicky@yahoo.co.in", "creation_time": "2010-01-05T19:50:39Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 48489, "text": "(In reply to comment #9)\n> Could you please explain in detail why don't you think it is an issue with the\n> TomcatCL implementation?\n\nI thought I did that in comment 7. Here's another Sun bug that should help to illustrate that the problem is with your JSP code:\n\nhttp://bugs.sun.com/view_bug.do?bug_id=6500212\n\nRead the \"Evaluation\" section...", "count": 10, "id": 133359, "time": "2010-01-05T20:06:43Z", "creator": "kschneider@gmail.com", "creation_time": "2010-01-05T20:06:43Z", "is_private": false}, {"count": 11, "tags": [], "creator": "markt@apache.org", "text": "Please use the users list if you need further assistance.", "id": 133363, "time": "2010-01-05T23:44:34Z", "bug_id": 48489, "creation_time": "2010-01-05T23:44:34Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "kakvicky@yahoo.co.in", "text": " Bug48489.patch is the required fix.", "id": 133370, "time": "2010-01-06T01:15:30Z", "bug_id": 48489, "creation_time": "2010-01-06T01:15:30Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 48489, "is_private": false, "text": "(In reply to comment #12)\n>  Bug48489.patch is the required fix.\n\nSorry...\n\nIf loader.loadClass(\"[Ljava.lang.String;\") works fine then I would expect loader.loadClass(\"[Lsample.SampleClass;\") too a proper usage.\n\nI don't think loader.loadClass(\"[Lsample.SampleClass;\") is wrong usage, the TocmatCL should resolve the custom class array also which could internally be done by delegating to system CL.", "id": 133371, "time": "2010-01-06T01:18:25Z", "creator": "kakvicky@yahoo.co.in", "creation_time": "2010-01-06T01:18:25Z", "attachment_id": null}]
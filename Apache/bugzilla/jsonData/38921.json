[{"count": 0, "text": "The method always return the last Color of the palette because the variable\nminDistance is not updated and the Color distance shoul be in absolute value.\nRegards\n\nThe resolution is \n\npublic HSSFColor findSimilarColor(byte red, byte green, byte blue)\n{\n    HSSFColor result = null;\n    int minColorDistance = Integer.MAX_VALUE;\n    byte[] b = palette.getColor(PaletteRecord.FIRST_COLOR_INDEX);\n    for (short i = (short) PaletteRecord.FIRST_COLOR_INDEX; b != null;\n       b = palette.getColor(++i))\n    {\n       int colorDistance = Math.abs(red - b[0] + green - b[1] + blue - b[2]);\n       if (colorDistance < minColorDistance)\n        {\n          minColorDistance = colorDistance;  \n          result = getColor(i);\n        }\n    }\n    return result;\n}", "bug_id": 38921, "attachment_id": null, "id": 86681, "time": "2006-03-10T15:48:53Z", "creator": "victornie2002@yahoo.com", "creation_time": "2006-03-10T15:48:53Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "thenestruo@gmail.com", "is_private": false, "text": "That resolution wouldn't work properly, as long as distance isn't being\ncalculated properly:\nIf the desired color is 254,0,0:\n- The color 0,254,0 will have colorDistance==0, but colors are really different.\n- The color 255,0,0, although is really similar (colorDistance==1), won't be\nchosen because there is another color (the previous one) with less colorDistance.\n\nIn my opinion, a better way for calculating the colorDistance would be:\nint colorDistance = Math.abs(r - comp[0]) + Math.abs(g - comp[1]) + Math.abs(b -\ncomp[2])\n\nOnce the colorDistance is calculated properly, a breaking condition can be added\nbefore the comparision (colorDistance < minColorDistance) when the exact color\nis found:\nif (colorDistance==0) {\n    return getColor(i);\n}", "id": 87099, "time": "2006-03-22T11:31:50Z", "bug_id": 38921, "creation_time": "2006-03-22T11:31:50Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 38921, "text": "I agree with N\u00e9stor.", "id": 113928, "time": "2008-02-20T11:58:00Z", "creator": "superpalhares@gmail.com", "creation_time": "2008-02-20T11:58:00Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "apache@gagravarr.org", "text": "I've applied N\u00e9stor's suggested fix to svn trunk. I've also written some tests,\nwhich show that it is now working as one would expect it to.", "id": 113953, "attachment_id": null, "bug_id": 38921, "creation_time": "2008-02-21T03:35:52Z", "time": "2008-02-21T03:35:52Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 38921, "is_private": false, "id": 114921, "creation_time": "2008-03-24T10:14:22Z", "time": "2008-03-24T10:14:22Z", "creator": "apache@gagravarr.org", "text": "*** Bug 44664 has been marked as a duplicate of this bug. ***", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "fanningpj@yahoo.com", "is_private": false, "id": 194284, "creation_time": "2016-10-09T17:52:10Z", "time": "2016-10-09T17:52:10Z", "bug_id": 60230, "text": "Created attachment 34349\ntest case that hightlights the issue\n\nI have a test case that passes ok in POI 3.15 but that fails in latest 3.16-beta1 codebase.\nThis is the stacktrace. I will attach a patch file with a test case.\n\norg.apache.poi.EncryptedDocumentException: Input length not multiple of 16 bytes\n\tat org.apache.poi.poifs.crypt.ChunkedCipherInputStream.read(ChunkedCipherInputStream.java:108)\n\tat org.apache.poi.poifs.crypt.ChunkedCipherInputStream.read(ChunkedCipherInputStream.java:91)\n\tat java.io.FilterInputStream.read(FilterInputStream.java:133)\n\tat java.io.PushbackInputStream.read(PushbackInputStream.java:186)\n\tat org.apache.poi.util.IOUtils.readFully(IOUtils.java:139)\n\tat org.apache.poi.util.IOUtils.readFully(IOUtils.java:119)\n\tat org.apache.poi.openxml4j.opc.internal.ZipHelper.verifyZipHeader(ZipHelper.java:167)\n\tat org.apache.poi.openxml4j.opc.internal.ZipHelper.openZipStream(ZipHelper.java:229)\n\tat org.apache.poi.openxml4j.opc.ZipPackage.<init>(ZipPackage.java:97)\n\tat org.apache.poi.openxml4j.opc.OPCPackage.open(OPCPackage.java:328)\n\tat org.apache.poi.util.PackageHelper.open(PackageHelper.java:37)\n\tat org.apache.poi.xssf.usermodel.XSSFWorkbook.<init>(XSSFWorkbook.java:285)\n\tat org.apache.poi.xssf.TestWorkbookProtection.testAbc(TestWorkbookProtection.java:226)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:497)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n\tat org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:86)\n\tat org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:675)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)\nCaused by: javax.crypto.IllegalBlockSizeException: Input length not multiple of 16 bytes\n\tat com.sun.crypto.provider.CipherCore.finalNoPadding(CipherCore.java:1016)\n\tat com.sun.crypto.provider.CipherCore.doFinal(CipherCore.java:960)\n\tat com.sun.crypto.provider.AESCipher.engineDoFinal(AESCipher.java:479)\n\tat javax.crypto.Cipher.doFinal(Cipher.java:2297)\n\tat org.apache.poi.poifs.crypt.ChunkedCipherInputStream.invokeCipher(ChunkedCipherInputStream.java:215)\n\tat org.apache.poi.poifs.crypt.ChunkedCipherInputStream.nextChunk(ChunkedCipherInputStream.java:202)\n\tat org.apache.poi.poifs.crypt.ChunkedCipherInputStream.read(ChunkedCipherInputStream.java:105)\n\t... 35 more", "attachment_id": 34349}, {"count": 1, "text": "Possibly related to the changes for https://bz.apache.org/bugzilla/show_bug.cgi?id=59857\nI reverted locally to the commit before those changes and the attached test case passed.", "bug_id": 60230, "is_private": false, "id": 194285, "time": "2016-10-09T17:56:47Z", "creator": "fanningpj@yahoo.com", "creation_time": "2016-10-09T17:56:47Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "creator": "onealj@apache.org", "attachment_id": null, "text": "I can reproduce the regression that you found with attachment 34349.\nOn the trunk at r1763997, if I revert r1762875 and r1762726 the unit test passes.\n\nNow for the tricky part: which portion of r1762726 is no longer padding the content to 16 bytes?", "id": 194287, "time": "2016-10-09T18:49:53Z", "bug_id": 60230, "creation_time": "2016-10-09T18:49:53Z", "is_private": false}, {"count": 3, "tags": [], "creator": "onealj@apache.org", "is_private": false, "text": "Committed disabled unit test in r1763998.", "id": 194288, "time": "2016-10-09T19:04:18Z", "bug_id": 60230, "creation_time": "2016-10-09T19:04:18Z", "attachment_id": null}, {"count": 4, "text": "I suspect that the issue is with the encryption when outputting the xlsx. Test cases that read pre-saved xlsx files seem unaffected.", "bug_id": 60230, "is_private": false, "id": 194289, "time": "2016-10-09T20:09:52Z", "creator": "fanningpj@yahoo.com", "creation_time": "2016-10-09T20:09:52Z", "tags": [], "attachment_id": null}, {"count": 5, "tags": [], "creator": "kiwiwings@apache.org", "is_private": false, "text": "Patched via r1764008\n\nLeft open for further discoveries :)", "id": 194290, "time": "2016-10-09T20:35:53Z", "bug_id": 60230, "creation_time": "2016-10-09T20:35:53Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 60230, "text": "I need to have another look an, as it came to my mind, that depending on the padding there might be more than <chunk-size> bytes in the result, which would be chopped off ... which is not such a good idea for block-based ciphers\n\nThe implementation of ChunkedCipherIn/OutputStream is a bit tricky in that regard, as it handles stream-based (XOR/RC4) and block-based (AES/...) encryption modes.", "id": 194303, "time": "2016-10-10T14:16:59Z", "creator": "kiwiwings@apache.org", "creation_time": "2016-10-10T14:16:59Z", "is_private": false, "attachment_id": null}, {"count": 7, "text": "This xlsx works in poi 3.16", "bug_id": 60230, "is_private": false, "id": 199056, "time": "2017-06-04T19:31:28Z", "creator": "fanningpj@yahoo.com", "creation_time": "2017-06-04T19:31:28Z", "tags": [], "attachment_id": null}]
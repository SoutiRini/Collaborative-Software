[{"count": 0, "tags": [], "creator": "highnoon@yahoo.com", "text": "When a corrupted zip is read the method \"resolveLocalFileHeaderData()\" will throw a RuntimeException. This exception is never caught so the archive file is never closed and remains opened.  The code calling constructor never gets a handle on the object, so you can't close the archive.  The Archive remains open until JVM exits.\n\n    public ZipFile(File f, String encoding) throws IOException {\n        this.encoding = encoding;\n        archive = new RandomAccessFile(f, \"r\");\n        try {\n            populateFromCentralDirectory();\n            resolveLocalFileHeaderData();\n        } catch (IOException e) {\n            try {\n                archive.close();\n            } catch (IOException e2) {\n                // swallow, throw the original exception instead\n            }\n            throw e;\n        }\n    }\n\n\nThe RuntimeException stack\nRuntimeException: data starting at 49679 is in unknown format\nat org.apache.tools.zip.ZipEntry.setExtra(ZipEntry.java:268)\nat org.apache.tools.zip.ZipFile.resolveLocalFileHeaderData(ZipFile.java:445)\nat org.apache.tools.zip.ZipFile.<init>(ZipFile.java:144)\nat org.apache.tools.zip.ZipFile.<init>(ZipFile.java:102)", "id": 124183, "time": "2009-01-19T04:59:28Z", "bug_id": 46559, "creation_time": "2009-01-19T04:59:28Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "I can easily think of a patch, but would love to have a test case.\n\nCan you provide a testcase that will trigger a RuntimeExcpetion inside the constructor?\n", "is_private": false, "id": 124381, "creator": "bodewig@apache.org", "time": "2009-01-26T21:09:31Z", "bug_id": 46559, "creation_time": "2009-01-26T21:09:31Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 46559, "is_private": false, "text": "For now I've used the jar attached to bug 42940 which will need to be changed once that bug is fixed.\n\nTestcase added and Ant fixed with svn revision 738853", "id": 124467, "time": "2009-01-29T05:25:02Z", "creator": "bodewig@apache.org", "creation_time": "2009-01-29T05:25:02Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 45376, "is_private": false, "text": "From Meandron <Matthias.Igel@gmx.net> on the mailing list:\n\nI've uploaded a sheet called \"Test.xls\" \nhttp://www.nabble.com/file/p18357579/Test.xls Test.xls , which I query using\nthe following program:\n\nimport java.io.FileInputStream;\n\nimport org.apache.poi.hssf.usermodel.HSSFCell;\nimport org.apache.poi.hssf.usermodel.HSSFFormulaEvaluator;\nimport org.apache.poi.hssf.usermodel.HSSFRow;\nimport org.apache.poi.hssf.usermodel.HSSFSheet;\nimport org.apache.poi.hssf.usermodel.HSSFWorkbook;\n\npublic class Test {\n\n        public static void main(String[] args) throws Exception{\n                final HSSFWorkbook book = new HSSFWorkbook(new\nFileInputStream(\"c:\\\\Test.xls\"));\n                final String SHEET = \"Eingabe\";\n                final int row = 6;\n                final HSSFSheet document = book.getSheet(SHEET);\n\n                final HSSFRow excelRow = document.getRow(row);\n                for (short i = 4; i < 15; i++) {\n                        final HSSFCell excelCell = excelRow.getCell(i);\n                        final HSSFFormulaEvaluator evaluator = new\nHSSFFormulaEvaluator(book.getSheet(SHEET), book);\n\n                        evaluator.setCurrentRow(excelRow);\n                        long now = System.currentTimeMillis();\n                        evaluator.evaluate(excelCell);\n                        System.out.println(\"evaluation took: \" +\n(System.currentTimeMillis() -\nnow));\n                }\n        }\n}\n\nAnd here are the results I've received (in millis):\n\nevaluation for cell (6, 4) took: 0\nevaluation for cell (6, 5) took: 15\nevaluation for cell (6, 6) took: 0\nevaluation for cell (6, 7) took: 31\nevaluation for cell (6, 8) took: 94\nevaluation for cell (6, 9) took: 156\nevaluation for cell (6, 10) took: 391\nevaluation for cell (6, 11) took: 1406\nevaluation for cell (6, 12) took: 5188\nevaluation for cell (6, 13) took: 20265\nevaluation for cell (6, 14) took: 81766\n\nPerhaps \"evaluateInCell\" would help me out here, but I think that poi should\nbe able to evaluate such kind of formulas in an acceptable way.", "id": 118506, "time": "2008-07-10T15:00:15Z", "creator": "apache@gagravarr.org", "creation_time": "2008-07-10T15:00:15Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": null, "id": 118509, "time": "2008-07-10T15:23:59Z", "bug_id": 45376, "creation_time": "2008-07-10T15:23:59Z", "is_private": false, "text": "Are you sure that your formulas aren't recursive? That would explain the timings we're seeing on evaluating them\n\n(I can't actually figure out what your formula does, clearly I don't know enough about what can be done with excel formulas....)\n\nThere's a test in src/testcases/org/apache/poi/hssf/usermodel/TestFormulaEvaluatorBugs.java for anyone who's interested"}, {"count": 2, "tags": [], "creator": "Matthias.Igel@gmx.net", "attachment_id": null, "text": "The formula is indeed a recursive one, but the time needed to evaluate it, especially for column 9 to 15, is not acceptable, I think (compared to the time excel needs to evaluate it, which is almost null).\n\nWhen you have a look at the sheet, you can see that the formula is also set for columns with index greater than 15. The time to evaluate these formulas would of course grow exponentially. \n\nWhat the formula does, can be expressed in the following way:\n\n- get the date (year and month) of your left neighbour cell and add \"1\" to the month.\n- look, if that date is smaller or equal to the date in column (3,4).\n- if so, put it the new date into the actual cell\n- else, write down #nv\n\nIt is clear, that the recursive formula evaluation is executed twice for each cell, but compared to the low complexicity of the formula, that should not result in such a long running evaluation.\n\n\n", "id": 118539, "time": "2008-07-11T00:12:10Z", "bug_id": 45376, "creation_time": "2008-07-11T00:12:10Z", "is_private": false}, {"count": 3, "tags": [], "creator": "mail@sebastian-brocks.de", "attachment_id": null, "is_private": false, "id": 118670, "time": "2008-07-15T04:34:36Z", "bug_id": 45376, "creation_time": "2008-07-15T04:34:36Z", "text": "In my case, it's also recursive formulas."}, {"count": 4, "tags": [], "creator": "josh@apache.org", "attachment_id": null, "is_private": false, "id": 120371, "time": "2008-09-04T16:17:49Z", "bug_id": 45376, "creation_time": "2008-09-04T16:17:49Z", "text": "Fixed in svn r692300.\n\nJunit modfied slightly and re-enabled "}]
[{"count": 0, "tags": [], "creator": "atsharma9@gmail.com", "attachment_id": null, "id": 180713, "time": "2015-02-03T07:32:53Z", "bug_id": 57526, "creation_time": "2015-02-03T07:32:53Z", "is_private": false, "text": "Hello,\n\nEnvironment Details:\n\nApache: apache-2.2.29_openssl-1.0.1k_x86_64\nLinux: Linux 2.6.18-400.1.1.el5 #1 SMP Sun Dec 14 06:01:17 EST 2014 x86_64 x86_64 x86_64 GNU/Linux\nProxy servers: 34 instances (httpd)\nVirtual Proxy: 68 instances\n\nProblem:\n\nWe have recently updated apache from apache-2.2.27_openssl-1.0.1g_x86_64 to apache-2.2.29_openssl-1.0.1k_x86_64 in PROD server (details above). We have stated receiving the semaphore issues.\n\n[26/Jan/2015:18:53:28] [Info] [CA WebAgent IPC] [3033] [CSmSem::getSem] Attempted to attach to non-existent semaphore with key 0xc8b9bf3c\n[26/Jan/2015:18:53:28] [Error] [CA WebAgent IPC] [3033] [CSmSem::getSem] Error creating semaphore using key 0xc8b9bf3c - No space left on device (28)\n\n\nThe same was done to QA servers also, but no errors found(varies because of load)\n\nCurrent Configuration:\n#kernel.sem=<SEMMSL> <SEMMNS> <SEMOPM> <SEMMNI>\nkernel.sem=512 524288 100 1024 \n# Controls the maximum shared segment size, in bytes\nkernel.shmmax = 68719476736\n# Controls the maximum number of shared memory segments, in pages\nkernel.shmall = 4294967296\n\n\nQuestion:\n\n1. Does apache-2.2.29 have more memory requirement than apache-2.2.27?\n2. Could you please help us in checking the thread-safety for below modules used in our environement:\nlibmod_sm22.so\nmod_actions.so\nmod_alias.so\nmod_asis.so\nmod_authz_host.so\nmod_autoindex.so\nmod_deflate.so\nmod_dir.so\nmod_filter.so\nmod_headers.so\nmod_include.so\nmod_negotiation.so\nmod_proxy_balancer.so\nmod_rewrite.so\nmod_setenvif.so\nmod_status.so\nmod_logio.so\n3. Do you consider updating the kernel semaphore on sysctl.conf based on the values shown above?\n\nThanks in advance.\n\nBest Regards,\nAtul Sharma"}, {"attachment_id": null, "tags": [], "bug_id": 57526, "is_private": false, "count": 1, "id": 180714, "time": "2015-02-03T10:13:54Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2015-02-03T10:13:54Z", "text": "(In reply to Atul Sharma from comment #0)\n> \n> [26/Jan/2015:18:53:28] [Info] [CA WebAgent IPC] [3033] [CSmSem::getSem]\n> Attempted to attach to non-existent semaphore with key 0xc8b9bf3c\n> [26/Jan/2015:18:53:28] [Error] [CA WebAgent IPC] [3033] [CSmSem::getSem]\n> Error creating semaphore using key 0xc8b9bf3c - No space left on device (28)\n\nThis is a SiteMinder's module error.\n\n> 1. Does apache-2.2.29 have more memory requirement than apache-2.2.27?\n\nNo it does not.\n\n> 2. Could you please help us in checking the thread-safety for below modules\n> used in our environement:\n> libmod_sm22.so\n\nWe can't talk about this module which is not maintained by the ASF nor supported in this bugzilla.\n\n> mod_actions.so\n> mod_alias.so\n> mod_asis.so\n> mod_authz_host.so\n> mod_autoindex.so\n> mod_deflate.so\n> mod_dir.so\n> mod_filter.so\n> mod_headers.so\n> mod_include.so\n> mod_negotiation.so\n> mod_proxy_balancer.so\n> mod_rewrite.so\n> mod_setenvif.so\n> mod_status.so\n> mod_logio.so\n\nThis ones are thread-safe (when used with a threaded MPM).\n\n> 3. Do you consider updating the kernel semaphore on sysctl.conf based on the\n> values shown above?\n\nThe values look good for your httpd's use, but it also depends on other software using SysV IPC on the system.\n\nThe issue is probably more about semaphores which are not cleaned when httpd stops (or is it killed? crashes? libmod_sm22 cleanup?), and hence previous ones stay on the system until no more is available.\n\nI'm rejecting this report since it's not an httpd issue, please contact SiteMinder's support."}, {"attachment_id": null, "tags": [], "bug_id": 57526, "text": "To resolve the same issue increased the amount of semaphores avalible by editing /etc/sysctl.conf and adding the below line, also comment the old setting\n/etc/sysctl.conf:\n#kernel.sem=512 524288 100 1024  <--Old value\nkernel.sem = 512 1048576 100 2048\n\n----\n Even this limit is getting crossed now and I suspect some issue of memory leak or somehow apache is leaving many stale connections.\n\nCould you please help us in determining the problem.\n\nBest Regards,\nAtul Sharma", "count": 2, "id": 182273, "time": "2015-04-08T10:55:22Z", "creator": "atsharma9@gmail.com", "creation_time": "2015-04-08T10:55:22Z", "is_private": false}, {"count": 3, "tags": [], "text": "lsof on 2 different servers varies a lot:\n\n4901 vs 43818", "attachment_id": null, "id": 182274, "creator": "atsharma9@gmail.com", "time": "2015-04-08T10:57:07Z", "bug_id": 57526, "creation_time": "2015-04-08T10:57:07Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 57526, "text": "Even when the lsof values are same the semaphores doesn't gets cleared:\n\nlsof values:\n\n4781 vs 4529\n\n\n------ Semaphore Status --------\nused arrays = 498\nallocated semaphores = 500\n\nvs \n\n------ Semaphore Status --------\nused arrays = 1169\nallocated semaphores = 1171\n\n\nvice-versa values.", "id": 182275, "time": "2015-04-08T11:13:41Z", "creator": "atsharma9@gmail.com", "creation_time": "2015-04-08T11:13:41Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "toscano.luca@gmail.com", "is_private": false, "text": "This seems not a bug report and it belongs to a version of httpd not supported anymore because EOL. Please follow up in #httpd (Freenode IRC) or the users@ mailing list.\n\nThanks!", "id": 202234, "time": "2017-11-18T19:00:00Z", "bug_id": 57526, "creation_time": "2017-11-18T19:00:00Z", "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 12017, "attachment_id": null, "id": 21694, "time": "2002-08-25T00:46:46Z", "creator": "cowwoc@bbs.darktech.org", "creation_time": "2002-08-25T00:46:46Z", "is_private": false, "text": "If I reload a JSP file, which makes use of a bean which makes use of JNI a\nlot of times, a lot of times I will eventually get the following error. The only\nway to fix the page is to restart Tomcat:\n\njavax.servlet.ServletException: Native Library\nD:\\tomcat\\webapps\\root\\WEB-INF\\classes\\com\\shadowcraft\\util\\env.dll already\nloaded in another classloader\n\tat\norg.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:471)\n\tat org.apache.jsp.speedtest$jsp._jspService(speedtest$jsp.java:129)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:107)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.jasper.servlet.JspServlet$JspServletWrapper.service(JspServlet.java:201)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:381)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:473)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:243)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:190)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2347)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:468)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat\norg.apache.catalina.connector.http.HttpProcessor.process(HttpProcessor.java:1027)\n\tat org.apache.catalina.connector.http.HttpProcessor.run(HttpProcessor.java:1125)\n\tat java.lang.Thread.run(Thread.java:512)\n\nroot cause\n\njava.lang.UnsatisfiedLinkError: Native Library\nD:\\tomcat\\webapps\\root\\WEB-INF\\classes\\com\\shadowcraft\\util\\env.dll already\nloaded in another classloader\n\tat java.lang.ClassLoader.loadLibrary0(ClassLoader.java:1763)\n\tat java.lang.ClassLoader.loadLibrary(ClassLoader.java:1685)\n\tat java.lang.Runtime.loadLibrary0(Runtime.java:780)\n\tat java.lang.System.loadLibrary(System.java:865)\n\tat com.shadowcraft.util.RuntimeUtilities.(RuntimeUtilities.java:19)\n\tat com.shadowcraft.web.External.run(External.java:131)\n\tat org.apache.jsp.speedtest$jsp._jspService(speedtest$jsp.java:112)\n\tat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:107)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.jasper.servlet.JspServlet$JspServletWrapper.service(JspServlet.java:201)\n\tat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:381)\n\tat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:473)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:247)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:243)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:190)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2347)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:170)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:564)\n\tat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:468)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:564)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat org.apache.catalina.core.StandardPipeline.invokeNext(StandardPipeline.java:566)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:472)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:943)\n\tat\norg.apache.catalina.connector.http.HttpProcessor.process(HttpProcessor.java:1027)\n\tat org.apache.catalina.connector.http.HttpProcessor.run(HttpProcessor.java:1125)\n\tat java.lang.Thread.run(Thread.java:512)"}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "It is your responability to only load the library once.", "id": 21719, "time": "2002-08-26T07:40:03Z", "bug_id": 12017, "creation_time": "2002-08-26T07:40:03Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 12017, "attachment_id": null, "id": 21735, "time": "2002-08-26T13:02:55Z", "creator": "cowwoc@bbs.darktech.org", "creation_time": "2002-08-26T13:02:55Z", "is_private": false, "text": "Request for clarification: how is this accomplished?\n\nAll I have in my code is:\n\nstatic\n{\n  System.loadLibrary()\n}\n\n      Why would this ever execute more than once per JVM session? What is the\n\"correct\" way of doing this?\n\nThanks,\nGili"}, {"count": 3, "tags": [], "creator": "cowwoc@bbs.darktech.org", "text": "I've reviewed the issue on Sun's Bug Parade but I don't understand how their\nworkaround is meant to be used. I tried getting the root ClassLoader to load a\nclass which loads the DLL but the class is not the in the root-classloader's\nclasspath (even though it is present in the current classloader's classpath) so\nbasically loadClass() yields ClassNotFound.\n\nPlease clarify what one is to do under Tomcat to make this work.\nThanks,\nGili", "id": 21888, "time": "2002-08-28T13:15:27Z", "bug_id": 12017, "creation_time": "2002-08-28T13:15:27Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 12017, "attachment_id": null, "id": 21889, "time": "2002-08-28T13:19:39Z", "creator": "remm@apache.org", "creation_time": "2002-08-28T13:19:39Z", "is_private": false, "text": "Using JNI, forking threads, modifying the thread context classloader, etc, is\nnot supported within a J2EE environment. If you do, then it is your\nresponsability to make it work. You can use a shutdown hook, a try { } catch or\nwhatever else would work for you.\n\nBTW, this issue is explicitely mentioned in the release notes."}]
[{"count": 0, "tags": [], "bug_id": 47428, "text": "<c:if test=\"{foo==0}\">\n   do something\n</c:if>\nIf foo is a BigDecimal,JSTL converts its type to Long,which means if foo is in the range [0,1), for example,0.01,it always return true! That is not correct.\n\nI checked SUN's JSP2.0 specification,in the JSP.2.3.5.7 section. It says:\n A {==,!=,eq,ne} B\n\u2022 If A==B, apply operator\n\u2022 If A is null or B is null return false for == or eq, true for != or ne.\n\u2022 If A or B is BigDecimal, coerce both A and B to BigDecimal and then:\n\u0001 If operator is == or eq, return A.equals( B )\n\u0001 If operator is != or ne, return !A.equals( B )\n\u2022 If A or B is Float or Double coerce both A and B to Double, apply operator\n\u2022 If A or B is BigInteger, coerce both A and B to BigInteger and then:\n\u0001 If operator is == or eq, return A.equals( B )\n\u0001 If operator is != or ne, return !A.equals( B )\n\u2022 If A or B is Byte, Short, Character, Integer, or Long coerce both A and B to\nLong, apply operator\n\u2022 If A or B is Boolean coerce both A and B to Boolean, apply operator\n\u2022 If A or B is String coerce both A and B to String, compare lexically\n\u2022 Otherwise if an error occurs while calling A.equals(B), error\n\u2022 Otherwise, apply operator to result of A.equals(B)\n\nAccording to the third rule,it seems like no problem.\n\nbut when I checked apache's implementation of JSTL, in the class  org.apache.taglibs.standard.lang.jstl.Coercions,I found apache didn't implement the third specification.so the preceding example will be processed according to this rule:\nIf A or B is Byte, Short, Character, Integer, or Long coerce both A and B to\nLong, apply operator\n\nthat is, it will convert BigDecimal to Long!\n\nso, is this a bug or something?\n\nlooking forward to your answering.Thanks!", "id": 128279, "time": "2009-06-25T09:05:59Z", "creator": "hhfdna@163.com", "creation_time": "2009-06-25T09:05:59Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 47428, "text": "Maybe I missed something, but I didn't see *any* Big(Decimal|Integer) coercions in org.apache.taglibs.standard.lang.jstl.Coercions. Strange. So, I'd say it's a bug - the spec clearly states that BigDecimal coercion should take place before Long coercion.", "id": 128289, "time": "2009-06-25T11:01:06Z", "creator": "kschneider@gmail.com", "creation_time": "2009-06-25T11:01:06Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 47428, "attachment_id": null, "is_private": false, "id": 128301, "time": "2009-06-26T00:57:16Z", "creator": "hhfdna@163.com", "creation_time": "2009-06-26T00:57:16Z", "text": "ok,gotcha.\n\nWill apache fix it in the next version?\n\nThe bug exists in the latest version:jakarta-taglibs-standard-1.1.2.zip\n\nBy the way,do you know if there are other JSTL implementations besides apache's\n\nthanks!"}, {"count": 3, "tags": [], "bug_id": 47428, "text": "Well, I *did* miss something. I forgot that the EL implementation is now part of the container (as of JSP 2.0, I believe), and not part of JSTL. So, I guess I'm inclined to reject the bug. Any chance you can test your code on different containers to see if your results change?\n\nThe Standard taglib code you reviewed should have been targeted at implementing the JSTL 1.0 spec (JSP 1.2), which doesn't use Big(Decimal|Integer) in its coercions for relational operators.", "id": 128391, "time": "2009-06-29T07:59:19Z", "creator": "kschneider@gmail.com", "creation_time": "2009-06-29T07:59:19Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 47428, "is_private": false, "text": "(In reply to comment #3)\n> Well, I *did* miss something. I forgot that the EL implementation is now part\n> of the container (as of JSP 2.0, I believe), and not part of JSTL. So, I guess\n> I'm inclined to reject the bug. Any chance you can test your code on different\n> containers to see if your results change?\n> The Standard taglib code you reviewed should have been targeted at implementing\n> the JSTL 1.0 spec (JSP 1.2), which doesn't use Big(Decimal|Integer) in its\n> coercions for relational operators.\n\nWe tried in Tomcat 5.0.28, and WebSphere 5. Both performed uncorrectly.\nSince it is as you said,what we gonna do for now?\nIs there a finnal solution for this situation?\n\nThanks!", "id": 128394, "time": "2009-06-29T08:42:36Z", "creator": "hhfdna@163.com", "creation_time": "2009-06-29T08:42:36Z", "attachment_id": null}, {"count": 5, "tags": [], "text": "Maybe you can provide some more detail on exactly what you're doing. Here's a test page, coerce.jsp (webapps/ROOT):\n\n<%@ page contentType=\"text/plain\" %>\n<%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\n<% pageContext.setAttribute(\"decimal\", new java.math.BigDecimal(\"0.01\")); %>\ndecimal: ${decimal}\ndecimal == 0: ${decimal == 0}\n<c:if test=\"${decimal == 0}\">true</c:if>\n\nTC 5.0.28\ndecimal: 0.01\ndecimal == 0: false\n\nNotice that \"true\" does *not* get output.\n\nHang on, is this exactly what you have in your page:\n\n<c:if test=\"{foo==0}\">\n\nBecause it should be this:\n\n<c:if test=\"${foo==0}\">\n\nThis discussion should also be moved to taglibs-user<<at>>jakarta.apache.org", "attachment_id": null, "id": 128401, "creator": "kschneider@gmail.com", "time": "2009-06-29T10:40:11Z", "bug_id": 47428, "creation_time": "2009-06-29T10:40:11Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 47428, "is_private": false, "text": "Update assignee to Tomcat dev list", "id": 129731, "time": "2009-08-17T01:55:50Z", "creator": "markt@apache.org", "creation_time": "2009-08-17T01:55:50Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Closing as lack of response.", "attachment_id": null, "id": 129805, "creator": "bayard@apache.org", "time": "2009-08-20T00:47:09Z", "bug_id": 47428, "creation_time": "2009-08-20T00:47:09Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "BryanXTong@gmail.com", "attachment_id": null, "is_private": false, "id": 138690, "time": "2010-07-27T08:19:43Z", "bug_id": 49654, "creation_time": "2010-07-27T08:19:43Z", "text": "The example below comes from the POI website and I make some minor changes. By running it,we can get the error \"unreable content in xls\"\n\npublic class POIExport{\n public static void main(String[] args) throws IOException{\n  Workbook wb = new HSSFWorkbook(); //or new HSSFWorkbook();\n     CreationHelper createHelper = wb.getCreationHelper();\n\n     //cell style for hyperlinks\n     //by default hypelrinks are blue and underlined\n     CellStyle hlink_style = wb.createCellStyle();\n     Font hlink_font = wb.createFont();\n     hlink_font.setUnderline(Font.U_SINGLE);\n     hlink_font.setColor(IndexedColors.BLUE.getIndex());\n     hlink_style.setFont(hlink_font);\n\n     \n     Sheet sheet = wb.createSheet(\"Hyperlinks\");\n     //number of rows\n     for (int i = 0; i < 14000 ; i++){\n      Row row = sheet.createRow(i);\n      //number of columns \n      for(int j = 0 ; j < 5; j++){\n       Cell cell = row.createCell((short)j);\n       cell.setCellValue(\"URL Link\");\n       Hyperlink link = createHelper.createHyperlink(Hyperlink.LINK_URL);\n       link.setAddress(\"http://poi.apache.org/\");\n       cell.setHyperlink(link);\n       cell.setCellStyle(hlink_style);\n      }\n     }\n     FileOutputStream out = new FileOutputStream(\"hyperinks.xls\");\n     wb.write(out);\n     out.close();\n }\n}\n\nIt seems that if the number of columns with Hyperlink is getting more,we will get this error(check above example).but if we limit the rows and columns to a small number,It does not have problem."}, {"attachment_id": null, "tags": [], "creator": "BryanXTong@gmail.com", "is_private": false, "count": 1, "id": 138700, "time": "2010-07-27T20:45:13Z", "bug_id": 49654, "creation_time": "2010-07-27T20:45:13Z", "text": "sorry,It should be the \"unreadable\" and I wrongly spelled it. \n\nI have tested poi-3.5-beta5-20090219 and poi-3.6-20091214 and these two version produces the same error."}, {"count": 2, "tags": [], "text": "Please don't abuse Bugzilla. Changing the priority of a bug to Critical will not help us to fix it sooner.\n\nIf you are really interested in fixing this issue - you are welcome to do a research. If you need a guidance, please ask, we will be happy to help.\n\nYegor", "attachment_id": null, "id": 138723, "creation_time": "2010-07-29T02:38:23Z", "time": "2010-07-29T02:38:23Z", "creator": "yegor@dinom.ru", "bug_id": 49654, "is_private": false}, {"count": 3, "tags": [], "text": "I am sorry for that.\nas currently,our project has encountered this issue and we need to solve it quickly,but currently,we find not solution.\n\nwe try to use setformula(String) ,but the problem is that we cannot style the cell value(part of the string).1ABCHHHHH,we only want to color the CH,but after research,we found the current POI also doesnot support this.\n\nThanks for your reply.", "is_private": false, "id": 138724, "creator": "BryanXTong@gmail.com", "time": "2010-07-29T03:19:59Z", "bug_id": 49654, "creation_time": "2010-07-29T03:19:59Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 49654, "attachment_id": null, "id": 138725, "time": "2010-07-29T04:21:31Z", "creator": "BryanXTong@gmail.com", "creation_time": "2010-07-29T04:21:31Z", "is_private": false, "text": "we are trying to use the following way instead.\n\ncell.setCellFormula(\"HYPERLINK(\\\"\" + \"http://www.google.ca\"+ \"\\\",\\\"\" + \"Goolge\" + \"\\\")\");   \n\n\nbut we have to color part of the \"Goolge\" string ,suppose ool,It seems that POI also doesnot support it.By this way ,the \"unreadable content in xls\" error will disappear, but It cannot color part of a string.\n\nCould you give us some advice on how to solve it.\n\nThanks a lot."}, {"count": 5, "tags": [], "text": "I would suggest that you create two simple files:\n* one in POI, with a single cell containing your problem hyperlink\n* one in Excel, with a single cell containing your problem hyperlink\n\nThen, use org.apache.poi.hssf.dev.BiffViewer to figure out what Excel has done differently to POI. Once you know that, you're hopefully most of the way to knowing what the POI fix will be.\n\nIf the problem is very very urgent for you, then there are people (not myself!) who can offer you paid-for support for POI. Otherwise, you'll need to do some of the work yourself, sorry...", "is_private": false, "id": 138730, "creator": "apache@gagravarr.org", "time": "2010-07-29T06:56:51Z", "bug_id": 49654, "creation_time": "2010-07-29T06:56:51Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 49654, "attachment_id": null, "is_private": false, "id": 138733, "time": "2010-07-29T08:32:32Z", "creator": "BryanXTong@gmail.com", "creation_time": "2010-07-29T08:32:32Z", "text": "I have done what you suggest,but could not understand the output.\n\nThanks all the same."}, {"attachment_id": null, "tags": [], "bug_id": 49654, "is_private": false, "count": 7, "id": 138734, "time": "2010-07-29T09:25:38Z", "creator": "apache@gagravarr.org", "creation_time": "2010-07-29T09:25:38Z", "text": "You want to figure out how the two files differ\n\nIgnoring the file offsets, how does the BiffViewer output of the two files compare? Which record(s) are in one but not the other? Which record(s) are different between them?"}, {"count": 8, "tags": [], "text": "Bryan,\n\nIt looks to be a limitation of Excel - the number of hyperlinks in a workbook cannot exceed 65534. I didn't find it in the spec but confirmed it empirically. If your code inserts 65533 hyperlinks then the workbook is OK, if the number of hyperlinks is greater or equal to 65534 then the workbook is unreadable. \n\nI guess Excel tracks the number of hyperlinks as unsigned short and when this number rolls over the workbook becomes corrupted. \n\nYegor", "attachment_id": null, "id": 138742, "creation_time": "2010-07-29T14:23:39Z", "time": "2010-07-29T14:23:39Z", "creator": "yegor@dinom.ru", "bug_id": 49654, "is_private": false}, {"count": 9, "tags": [], "bug_id": 49654, "attachment_id": null, "id": 138750, "time": "2010-07-29T18:39:12Z", "creator": "BryanXTong@gmail.com", "creation_time": "2010-07-29T18:39:12Z", "is_private": false, "text": "Yegor ,\n\nFrom the begging ,we also suppose that maybe the reason .but after research,I try to add over 180000 of Hyperlink in the Excel manually and find no problem ,only by POI , It seems that number of HyperLinks is limited,so we think It 's a bug there.\n\nHowever,for one week ,we still find not way to solve it."}, {"count": 10, "tags": [], "text": "I have done research and find that for POI 3.5 and 3.6 version,one sheet of a workbook,It can only have 65530 Hyperlink cells. but for Microsoft Excel, there is not such limitation.", "attachment_id": null, "bug_id": 49654, "id": 138751, "time": "2010-07-29T23:16:18Z", "creator": "BryanXTong@gmail.com", "creation_time": "2010-07-29T23:16:18Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 49654, "attachment_id": null, "id": 138752, "time": "2010-07-30T00:32:26Z", "creator": "BryanXTong@gmail.com", "creation_time": "2010-07-30T00:32:26Z", "is_private": false, "text": "Hi Nick,\n\nI have used the POI  \n\ncell.setCellValue(\"URL Link\");\n    \t\t    Hyperlink link = createHelper.createHyperlink(Hyperlink.LINK_URL);\n    \t\t    link.setAddress(\"http://poi.apache.org/\");"}, {"attachment_id": 25817, "tags": [], "creator": "BryanXTong@gmail.com", "is_private": false, "count": 12, "id": 138753, "time": "2010-07-30T00:38:19Z", "bug_id": 49654, "creation_time": "2010-07-30T00:38:19Z", "text": "Created attachment 25817\nPOI output"}, {"count": 13, "tags": [], "text": "Created attachment 25818\ninput the same url link mannually", "attachment_id": 25818, "id": 138754, "creation_time": "2010-07-30T00:39:09Z", "time": "2010-07-30T00:39:09Z", "creator": "BryanXTong@gmail.com", "bug_id": 49654, "is_private": false}, {"count": 14, "tags": [], "bug_id": 49654, "attachment_id": null, "id": 138829, "time": "2010-08-03T04:26:47Z", "creator": "BryanXTong@gmail.com", "creation_time": "2010-08-03T04:26:47Z", "is_private": false, "text": "Hi Yegor Kozlov,\n\nI have read the source of Hyperlink related files and could not understand where the number of Hyperlinks are limited.Could you please give me some advice so that I can continue.\n\nint eofLoc = _sheet.getSheet().findFirstRecordLocBySid( EOFRecord.sid );\n_sheet.getSheet().getRecords().add( eofLoc, link.record );\n\n\nmeanwhile,what doesnot rhe eofLoc exactly mean? Thanks a lot if you can explain more to me."}, {"count": 15, "text": "> \n> I have read the source of Hyperlink related files and could not understand\n> where the number of Hyperlinks are limited.Could you please give me some advice\n> so that I can continue.\n>\n\nThe number of hyperlinks is not limited in the Excel binary format, it seems to be a limitation of MS Excel application. I searched the format spec and MSDN and did not find this limitation. \n \n> int eofLoc = _sheet.getSheet().findFirstRecordLocBySid( EOFRecord.sid );\n> _sheet.getSheet().getRecords().add( eofLoc, link.record );\n> \n> \n> meanwhile,what doesnot rhe eofLoc exactly mean? Thanks a lot if you can explain\n> more to me.\n\nExcel workbook consists of records and the order of records is determined by the Excel binary format. Hyperlink records are appended to the sheet records and EOFRecord marks the end of the sheet. \n\nI think this code can be improved. EOFRecord seems to be always the last record in the collection  and a better version would look as follows:\n\n        List<RecordBase> records = _sheet.getSheet().getRecords();\n        int eofLoc = records.size() - 1;\n        records.add( eofLoc, link.record );\n\nThis should significantly improve performance because findFirstRecordLocBySid takes O(N) operations to find a record in a sheet consisting of N records. \n\nI'm going commit the fix soon.\n\nRegards,\nYegor", "creator": "yegor@dinom.ru", "is_private": false, "id": 138840, "time": "2010-08-03T08:29:45Z", "bug_id": 49654, "creation_time": "2010-08-03T08:29:45Z", "tags": [], "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 49654, "attachment_id": null, "is_private": false, "id": 138841, "time": "2010-08-03T08:35:02Z", "creator": "yegor@dinom.ru", "creation_time": "2010-08-03T08:35:02Z", "text": "> \n> From the begging ,we also suppose that maybe the reason .but after research,I\n> try to add over 180000 of Hyperlink in the Excel manually and find no problem\n> ,only by POI , It seems that number of HyperLinks is limited,so we think It 's\n> a bug there.\n> \n> However,for one week ,we still find not way to solve it.\n\n\nHow did you create that file with over  180000 of hyperlinks? \n\nI wrote a small VBA script identical to your Java sample. It crashes if the total number of created hyperlinks is greater than 64K. Can you run it on your machine and see if it works for 180000 links?\n\n\nRegards,\nYegor"}, {"attachment_id": 25832, "tags": [], "bug_id": 49654, "is_private": false, "count": 17, "id": 138842, "time": "2010-08-03T08:36:16Z", "creator": "yegor@dinom.ru", "creation_time": "2010-08-03T08:36:16Z", "text": "Created attachment 25832\nVBA script to create workbook with hyperlinks"}, {"attachment_id": null, "tags": [], "creator": "BryanXTong@gmail.com", "is_private": false, "count": 18, "id": 138857, "time": "2010-08-03T21:54:31Z", "bug_id": 49654, "creation_time": "2010-08-03T21:54:31Z", "text": "(In reply to comment #17)\n> Created an attachment (id=25832) [details]\n> VBA script to create workbook with hyperlinks\n\nI have run this script and It also crashed.\n\nfor the 180000 hyperlinks, I  input several mannually and then copy paste,then I save the workbook and reopen it again,It has no problem.That means that MS Excel can store many hyperlinks.\n\nIt seems only by program which generates the excel file,It has such limitation,I have tries the JXL excel export and It has the same problem."}, {"attachment_id": null, "tags": [], "creator": "yegor@dinom.ru", "is_private": false, "count": 19, "id": 147487, "time": "2011-06-25T12:29:20Z", "bug_id": 49654, "creation_time": "2011-06-25T12:29:20Z", "text": "I'm resolving it as WONTFIX. \n\nI don't see how we can fix this issue - POI is correct in terms of writing the .xls format. The number of hyperlinks is somehow limited in Excel, if you find any information that may help to overcome this limitation in POI, please post it into this (or new) issue.\n\nI can see two workarounds:\n (a) use the HYPERLINK function instead of the Hyperlink object. \n (b) try .xlsx format\n\nYegor"}]
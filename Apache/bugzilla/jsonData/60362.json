[{"count": 0, "tags": [], "text": "Tomcat 8.5 removed the reason phrase from the response. This breaks legacy clients. Can it not be brought back as a config option?", "attachment_id": null, "bug_id": 60362, "id": 194922, "time": "2016-11-11T03:43:53Z", "creator": "todd.pierce@intelematics.com", "creation_time": "2016-11-11T03:43:53Z", "is_private": false}, {"count": 1, "tags": [], "creator": "remm@apache.org", "is_private": false, "text": "No.", "id": 194923, "time": "2016-11-11T08:16:35Z", "bug_id": 60362, "creation_time": "2016-11-11T08:16:35Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 194929, "time": "2016-11-11T18:06:01Z", "creator": "chris@christopherschultz.net", "creation_time": "2016-11-11T18:06:01Z", "tags": [], "text": "I would argue that Tomcat 8.0.x should not have removed the reason phrase as that represents a fairly big change. Removal from 8.5.x is okay with me."}, {"count": 3, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 194959, "time": "2016-11-14T00:34:03Z", "creator": "todd.pierce@intelematics.com", "creation_time": "2016-11-14T00:34:03Z", "tags": [], "text": "Reinstating the reason phrase to 8.0.x would be a good outcome."}, {"count": 4, "tags": [], "creator": "todd.pierce@intelematics.com", "is_private": false, "text": "I suggest that the spec for HTTTP 1.1 is ambiguous regarding whether the reason phrase is optional at all. It says that the reson phrase is defined as zero or more text characters. This could be interpreted to mean, by example, So there -could- be a response code that has with a zero length reason phrase, but when a response code has a corresponding reason phrase, it will be returned.", "id": 195069, "time": "2016-11-18T00:01:58Z", "bug_id": 60362, "creation_time": "2016-11-18T00:01:58Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "*** Bug 60618 has been marked as a duplicate of this bug. ***", "id": 196252, "time": "2017-01-20T17:14:18Z", "bug_id": 60362, "creation_time": "2017-01-20T17:14:18Z", "attachment_id": null}, {"count": 6, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 196324, "time": "2017-01-23T13:14:37Z", "creator": "matihost@o2.pl", "creation_time": "2017-01-23T13:14:37Z", "tags": [], "text": "Facts: \n8.0.39 still returns the reason phase.\n8.5.x and onward do not return the reason phase.\n\nPurpose of this story is to add a config option to bring it back in 8.5.x and onward.\n\nApache Tomcat Team & Product Owner,\n\nDo you agree to add configuration option for this?\n\nIf yes, what the potential ETA is?\n\nThis information is needed to decide what kind of actions I need to perform (whether change all legacy / old clients & postpone or not  migration to the latest Tomcat 8.5.x)"}, {"count": 7, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 196325, "time": "2017-01-23T13:47:00Z", "creator": "1983-01-06@gmx.net", "creation_time": "2017-01-23T13:47:00Z", "tags": [], "text": "(In reply to Mateusz Nowakowski from comment #6)\n> Facts: \n> 8.0.39 still returns the reason phase.\n> 8.5.x and onward do not return the reason phase.\n> \n> Purpose of this story is to add a config option to bring it back in 8.5.x\n> and onward.\n> \n> Apache Tomcat Team & Product Owner,\n> \n> Do you agree to add configuration option for this?\n> \n> If yes, what the potential ETA is?\n> \n> This information is needed to decide what kind of actions I need to perform\n> (whether change all legacy / old clients & postpone or not  migration to the\n> latest Tomcat 8.5.x)\n\nDo your clients require just some text after the space or do they really analyze the text for predefined values?"}, {"count": 8, "tags": [], "creator": "matihost@o2.pl", "attachment_id": null, "text": ">Do your clients require just some text after the space or do they really analyze >the text for predefined values?\n\nThey analyze the text, however they are compatible with previous behavior.\nThey analyze/require:  \"HTTP/1.1 200 OK\" to be returned.\n\nI thought about just a boolean configuration option to bring back previous behavior.", "id": 196326, "time": "2017-01-23T14:56:32Z", "bug_id": 60362, "creation_time": "2017-01-23T14:56:32Z", "is_private": false}, {"count": 9, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 196333, "time": "2017-01-23T15:29:59Z", "creator": "1983-01-06@gmx.net", "creation_time": "2017-01-23T15:29:59Z", "tags": [], "text": "(In reply to Mateusz Nowakowski from comment #8)\n> >Do your clients require just some text after the space or do they really analyze >the text for predefined values?\n> \n> They analyze the text, however they are compatible with previous behavior.\n> They analyze/require:  \"HTTP/1.1 200 OK\" to be returned.\n> \n> I thought about just a boolean configuration option to bring back previous\n> behavior.\n\nWhat about \"HTTP/1.1 200 Fine, mate!\"? This would work or hard requirement for \"OK\"?"}, {"count": 10, "tags": [], "bug_id": 60362, "attachment_id": null, "id": 196357, "time": "2017-01-24T06:11:31Z", "creator": "apache@soref.com", "creation_time": "2017-01-24T06:11:31Z", "is_private": false, "text": "https://github.com/jech/polipo/blob/master/tunnel.c#L302\nconst char *message = \"HTTP/1.1 200 Tunnel established\\r\\n\\r\\n\";"}, {"count": 11, "tags": [], "text": ">What about \"HTTP/1.1 200 Fine, mate!\"? This would work or hard requirement for \"OK\"?\n\nFor me it is not a requirement to tune reason phase.\n\nHowever I dig into it and saw that there is some System property org.apache.coyote.USE_CUSTOM_STATUS_MSG_IN_HEADER:\nand org.apache.coyote.Response with String message\nin Tomcat 8.0.x\n\nand response.sendError(int,String) and response.sendStatus(int,String) \nsets coyote Response message.\n\n\nIn principle I agree with Apache Tomcat decision to not return reason phase I just want to simplify upgrades.", "is_private": false, "bug_id": 60362, "id": 196367, "time": "2017-01-24T16:12:10Z", "creator": "matihost@o2.pl", "creation_time": "2017-01-24T16:12:10Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "kenwdelong@yahoo.com", "is_private": false, "text": "Our software interfaces with IoT devices which contain firmware (beyond our control) that expects the \"OK\" (they parse for \"200 OK\"; just \"200\" is parsed as an error).\n\nI'm sympathetic with the argument that these devices are not spec-compliant.  However, getting a new build from the manufacturer, and replacing thousands of units in the field around the world with spec-compliant IC boards would be, to say the least, prohibitively expensive.\n\nLeave the reason phrase off by default; but give those of us stuck between a rock and a hard place an option that we can configure so that we can continue to use Tomcat.", "id": 196504, "time": "2017-01-27T19:39:06Z", "bug_id": 60362, "creation_time": "2017-01-27T19:39:06Z", "attachment_id": null}, {"count": 13, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "Is running on 7.0.x or 8.0.x not an option?", "id": 196506, "time": "2017-01-27T19:48:53Z", "bug_id": 60362, "creation_time": "2017-01-27T19:48:53Z", "is_private": false}, {"count": 14, "tags": [], "creator": "kenwdelong@yahoo.com", "attachment_id": null, "text": "For a short time, I'm happy to run on 8.0.x (that's what I'm doing now).  But that's unsustainable; eventually the rest of my tech stack (Spring Boot) will outpace me and I'll be in a can't-upgrade-ever-again situation.  Been there, done that before.\n\nEven if there was a way to add a Valve or something that could decorate the response, that would work for me.  I poked around the source code a bit but could not figure out how one might do that.", "id": 196513, "time": "2017-01-27T21:21:48Z", "bug_id": 60362, "creation_time": "2017-01-27T21:21:48Z", "is_private": false}, {"count": 15, "tags": [], "text": "The only good place to put all these non upgradeable IoT devices is the trash.", "attachment_id": null, "bug_id": 60362, "id": 196514, "time": "2017-01-27T21:25:50Z", "creator": "remm@apache.org", "creation_time": "2017-01-27T21:25:50Z", "is_private": false}, {"count": 16, "tags": [], "creator": "1983-01-06@gmx.net", "attachment_id": null, "id": 196515, "time": "2017-01-27T22:25:30Z", "bug_id": 60362, "creation_time": "2017-01-27T22:25:30Z", "is_private": false, "text": "(In reply to Remy Maucherat from comment #15)\n> The only good place to put all these non upgradeable IoT devices is the\n> trash.\n\nTherefore, IoT = Internet of Trash"}, {"count": 17, "tags": [], "creator": "apache@soref.com", "attachment_id": null, "is_private": false, "id": 196547, "time": "2017-01-29T17:48:16Z", "bug_id": 60362, "creation_time": "2017-01-29T17:48:16Z", "text": "These devices should be behind a firewall/proxy (to protect them from the scary Internet).\n\nYour firewall/proxy can manage the 200 OK fix for you. That way if you upgrade to Tomcat 9, you'll still be ok."}, {"count": 18, "tags": [], "creator": "todd.pierce@intelematics.com", "is_private": false, "text": "(In reply to Remy Maucherat from comment #15)\n> The only good place to put all these non upgradeable IoT devices is the\n> trash.\n\nIn my case the devices are head units inside cars. A bit expensive to throw in the trash.", "id": 196549, "time": "2017-01-29T22:39:53Z", "bug_id": 60362, "creation_time": "2017-01-29T22:39:53Z", "attachment_id": null}, {"count": 19, "tags": [], "creator": "kenwdelong@yahoo.com", "attachment_id": null, "is_private": false, "id": 196550, "time": "2017-01-30T02:37:54Z", "bug_id": 60362, "creation_time": "2017-01-30T02:37:54Z", "text": "And mine are in consumer electronic devices..."}, {"count": 20, "tags": [], "text": "(In reply to Michael Osipov from comment #16)\n> (In reply to Remy Maucherat from comment #15)\n> > The only good place to put all these non upgradeable IoT devices is the\n> > trash.\n> \n> Therefore, IoT = Internet of Trash\n\nIoT: the 'S' stands for \"security\"\n\nPlease have a look at http://markmail.org/message/pqzvca26hihiysiu", "is_private": false, "bug_id": 60362, "id": 196571, "time": "2017-01-30T19:52:06Z", "creator": "chris@christopherschultz.net", "creation_time": "2017-01-30T19:52:06Z", "attachment_id": null}, {"count": 21, "tags": [], "creator": "hauser@acm.org", "is_private": false, "text": "I am also in favour of allowing the reason code.\n\nAlthough the discussion so far appears to be odd.\n\n> \"HTTP/1.1 200 Fine, mate!\" \nis probably of little value.\n\nHowever in particular in the 4XX and 5XX case, there is value for the client to learn more specifically what is wrong.\n\nThere is org.apache.catalina.valves.ErrorReportValve that might partially fix the problem.\n\nBut in particular non-HTML Clients like DAV clients using the\norg.apache.catalina.servlets.WebdavServlet\nfor file transfers will not necessarily expect/render html-responses.\n\nTherefore, I second the plea of Todd !", "id": 196626, "time": "2017-02-01T15:47:19Z", "bug_id": 60362, "creation_time": "2017-02-01T15:47:19Z", "attachment_id": null}, {"count": 22, "tags": [], "bug_id": 60362, "attachment_id": null, "id": 196632, "time": "2017-02-01T16:51:16Z", "creator": "kenwdelong@yahoo.com", "creation_time": "2017-02-01T16:51:16Z", "is_private": false, "text": "I talked to our firmware guys - the offending code is actually in Texas Instruments firmware on the chip we use.  So there are likely many devices affected, although I'm sure not all use Tomcat."}, {"count": 23, "tags": [], "creator": "1983-01-06@gmx.net", "is_private": false, "text": "(In reply to Ralf Hauser from comment #21)\n> I am also in favour of allowing the reason code.\n> \n> Although the discussion so far appears to be odd.\n> \n> > \"HTTP/1.1 200 Fine, mate!\" \n> is probably of little value.\n> \n> However in particular in the 4XX and 5XX case, there is value for the client\n> to learn more specifically what is wrong.\n> \n> There is org.apache.catalina.valves.ErrorReportValve that might partially\n> fix the problem.\n\nNo, it won't. The ErrorReportValve satisfies the Servlet Spefication for Respose#sendError(). This valve does not have access to the status line.", "id": 196633, "time": "2017-02-01T17:38:54Z", "bug_id": 60362, "creation_time": "2017-02-01T17:38:54Z", "attachment_id": null}, {"count": 24, "tags": [], "creator": "1983-01-06@gmx.net", "attachment_id": null, "id": 196634, "time": "2017-02-01T17:39:47Z", "bug_id": 60362, "creation_time": "2017-02-01T17:39:47Z", "is_private": false, "text": "(In reply to Ken DeLong from comment #22)\n> I talked to our firmware guys - the offending code is actually in Texas\n> Instruments firmware on the chip we use.  So there are likely many devices\n> affected, although I'm sure not all use Tomcat.\n\nYou don't have a support contract with TI to raise this obvious bug in ther FW?"}, {"count": 25, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 196635, "time": "2017-02-01T17:51:36Z", "creator": "kenwdelong@yahoo.com", "creation_time": "2017-02-01T17:51:36Z", "tags": [], "text": "We have switched to another chip maker, and in any event, the chips that are out in the field are out there, no way to upgrade except by replacing them."}, {"count": 26, "tags": [], "text": "(In reply to Ken DeLong from comment #25)\n> We have switched to another chip maker, and in any event, the chips that are\n> out in the field are out there, no way to upgrade except by replacing them.\n\nSo there is no way to perform an OTA upgrade of the firmware just like Tesla does or at the auto repair when the custumer arrives for an inspection? How do you handle serious issues in such devices when the car is sold?", "is_private": false, "bug_id": 60362, "id": 196636, "time": "2017-02-01T17:54:35Z", "creator": "1983-01-06@gmx.net", "creation_time": "2017-02-01T17:54:35Z", "attachment_id": null}, {"count": 27, "tags": [], "creator": "todd.pierce@intelematics.com", "attachment_id": null, "is_private": false, "id": 196654, "time": "2017-02-01T23:04:20Z", "bug_id": 60362, "creation_time": "2017-02-01T23:04:20Z", "text": "(In reply to Michael Osipov from comment #26)\n> (In reply to Ken DeLong from comment #25)\n> > We have switched to another chip maker, and in any event, the chips that are\n> > out in the field are out there, no way to upgrade except by replacing them.\n> \n> So there is no way to perform an OTA upgrade of the firmware just like Tesla\n> does or at the auto repair when the custumer arrives for an inspection? How\n> do you handle serious issues in such devices when the car is sold?\n\nYou're conflating two people here. You are replying to Ken DeLong, who has consumer electronic devices. I'm the one with in-car. \n\nWe do upgrades all the time. The problem is within manufacturer code we can't change. In older cars. It is not practicable to do what you suggest."}, {"count": 28, "tags": [], "creator": "kenwdelong@yahoo.com", "attachment_id": null, "text": "Our situation is the same as Todd's: we can and do upgrade our own firmware, but cannot update the manufacturer's.\n\nI tried making a Valve that wrapped the Response object, and forwarded the setStatus(int code), if code == 200, to setStatus(200, \"OK\").  That did not work either as a Context valve or an Engine valve.", "id": 196895, "time": "2017-02-10T01:31:08Z", "bug_id": 60362, "creation_time": "2017-02-10T01:31:08Z", "is_private": false}, {"count": 29, "tags": [], "creator": "blazej.bucko@gmail.com", "attachment_id": null, "id": 197220, "time": "2017-02-23T09:25:54Z", "bug_id": 60362, "creation_time": "2017-02-23T09:25:54Z", "is_private": false, "text": "Are you sure that you are still spec-compliant? rfc2616 defines Reason Phrase as part of Status Line. Additionally, spec suggests that it is for automata only clients are not required to read it but it doesn't say that it is OK for the server to drop it. This is not an \"obvious bug\" as someone suggested because \"not required to read\" is completely different from \"are not supposed to read it\". Do you have an API that allows me to set a Reason Phrase even for 200/300/400 responses? Especially when spec clearly states that I can \"replace recommended Reason Phrase with local equivalent without affecting the protocol\"."}, {"count": 30, "tags": [], "creator": "1983-01-06@gmx.net", "attachment_id": null, "id": 197221, "time": "2017-02-23T09:42:46Z", "bug_id": 60362, "creation_time": "2017-02-23T09:42:46Z", "is_private": false, "text": "(In reply to Blazej Bucko from comment #29)\n> Are you sure that you are still spec-compliant? rfc2616 defines Reason\n> Phrase as part of Status Line. Additionally, spec suggests that it is for\n> automata only clients are not required to read it but it doesn't say that it\n> is OK for the server to drop it. This is not an \"obvious bug\" as someone\n> suggested because \"not required to read\" is completely different from \"are\n> not supposed to read it\". Do you have an API that allows me to set a Reason\n> Phrase even for 200/300/400 responses? Especially when spec clearly states\n> that I can \"replace recommended Reason Phrase with local equivalent without\n> affecting the protocol\".\n\nAs far as I know the Tomcat, there is no such option."}, {"count": 31, "tags": [], "creator": "blazej.bucko@gmail.com", "attachment_id": null, "is_private": false, "id": 197222, "time": "2017-02-23T12:00:56Z", "bug_id": 60362, "creation_time": "2017-02-23T12:00:56Z", "text": "OK. I'd also like to point out that RFC 7230 mentioned in some of the comments is quite new (2014). Even legacy systems (in this case systems that are older than 2-3 years), which are fully compliant with rfc2616, will be affected by this change."}, {"count": 32, "tags": [], "text": "(In reply to Blazej Bucko from comment #31)\n> OK. I'd also like to point out that RFC 7230 mentioned in some of the\n> comments is quite new (2014). Even legacy systems (in this case systems that\n> are older than 2-3 years), which are fully compliant with rfc2616, will be\n> affected by this change.\n\nZero length reason phrases are valid in RFC 2616 as well. Any client that can't handle a zero length reason phrase is not spec compliant.", "attachment_id": null, "bug_id": 60362, "id": 197225, "time": "2017-02-23T12:25:33Z", "creator": "markt@apache.org", "creation_time": "2017-02-23T12:25:33Z", "is_private": false}, {"count": 33, "tags": [], "text": "That's true. But client that relies on information provided in Reason Phrase is also spec-compliant. And you are implying that it's not.", "is_private": false, "bug_id": 60362, "id": 197228, "time": "2017-02-23T13:25:17Z", "creator": "blazej.bucko@gmail.com", "creation_time": "2017-02-23T13:25:17Z", "attachment_id": null}, {"count": 34, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 197229, "time": "2017-02-23T13:41:14Z", "bug_id": 60362, "creation_time": "2017-02-23T13:41:14Z", "is_private": false, "text": "(In reply to Blazej Bucko from comment #33)\n> That's true. But client that relies on information provided in Reason Phrase\n> is also spec-compliant. And you are implying that it's not.\n\nThat certainly goes against the intention of RFC2626:\n\n<quote>\nThe Status-Code is intended for use by automata and the Reason-Phrase is intended for the human user.\n</quote>"}, {"count": 35, "tags": [], "creator": "blazej.bucko@gmail.com", "attachment_id": null, "is_private": false, "id": 197236, "time": "2017-02-23T14:50:33Z", "bug_id": 60362, "creation_time": "2017-02-23T14:50:33Z", "text": "But it is not explicitly forbidden (especially when one reads the next sentence). It would also mean that, according to rfc2616, humans are forbidden to look at Status Code.\n\nI understand that there's an ambiguity in rfc2616 and subsequent RFCs are more strict about this topic but it is quite possible that there are embedded systems that are fully compliant with rfc2616 and rely on Reason Phrase just because someone decided to use it in regexp check."}, {"count": 36, "tags": [], "text": "Appeal to Reason (phrase).\n\nAs I stated in comment 4, my interpretation is the spec does not state that the reason phrase is optional, it simply says it is allowed to be zero characters. This doesn't say that the reason phrase should be abandoned in all instances. \n\nHowever, if we consider that it is optional, surely the best way to comply with the spec is for tomcat to allow the reason phrase to be optional.\n\nAnd if these arguments don't resonate, how about just agreeing that the removal of the reason phrase from Tomcat 8+ is creating some major headaches and restoring it?", "attachment_id": null, "bug_id": 60362, "id": 197254, "time": "2017-02-23T23:19:31Z", "creator": "todd.pierce@intelematics.com", "creation_time": "2017-02-23T23:19:31Z", "is_private": false}, {"count": 37, "tags": [], "text": "Hi,\n\nI've read through the discussion of this issue to date, in both the original bug report and this enhancement request.\n\nThe Reason Phrase may be optional in the HTTP spec, but it's nonetheless useful to human beings. Given it's part of the HTTP/1.1 spec, I feel Tomcat users should be able to decide whether its usefulness is or isn't more important than the efficiency of not returning it.\n\nMore importantly, removing the Reason Phrase, whether it is optional or not, represents a breaking change. Obviously it's up to the Tomcat team to decide whether the benefits of a breaking change outweighs its costs - the additional hit their users will take on upgrading. As an example, we have many APIs, running on older versions of Tomcat, with a large external user base. Whilst we have a suite of functional tests for these APIs (which include checking the Reason Phrase in the HTTP response status line) that can be easily fixed, we have no way of knowing whether existing customer's integrations currently rely on matching the Reason Phrase. Like many other users, we therefore couldn't risk upgrading to Tomcat 8.5+ without first going through an additional testing phase with these customers. Depending on the outcome, we would then need to take a view on whether it's acceptable to ask our customers to make changes to their API clients. \n\nI'd therefore like to add my vote for reinstating support for Reason Phrase, making it a configurable option if necessary. \n\nThanks.", "is_private": false, "bug_id": 60362, "id": 197681, "time": "2017-03-15T13:42:14Z", "creator": "neil.brown.apache@gmail.com", "creation_time": "2017-03-15T13:42:14Z", "attachment_id": null}, {"count": 38, "tags": [], "creator": "ralph.twentyone@gmail.com", "attachment_id": null, "is_private": false, "id": 197943, "time": "2017-03-23T17:30:57Z", "bug_id": 60362, "creation_time": "2017-03-23T17:30:57Z", "text": "Please provide some option to reenable the reason phrase. We have several embedded systems which are not able to work without it. Yes they are not standard compliant but it's not feasible to fix them all.\nI also tried to add the phrase with our Apache HTTP Server which we use as reverse proxy but as it looks it's not possible."}, {"count": 39, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 197997, "time": "2017-03-27T07:36:35Z", "creator": "violetagg@apache.org", "creation_time": "2017-03-27T07:36:35Z", "tags": [], "text": "Hi,\n\nI created a patch that adds an option for sending a reason phrase with the response.\nhttps://github.com/apache/tomcat85/pull/7\n\nBy default a reason phrase will not be sent and also this option is marked as deprecated and will not be available in Tomcat9.\n\nThe change is based on r1702765 and r1785641.\n\nWhat do you think?\n\nRegards,\nVioleta"}, {"count": 40, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 197998, "time": "2017-03-27T07:49:46Z", "creator": "remm@apache.org", "creation_time": "2017-03-27T07:49:46Z", "tags": [], "text": "-1. It should be removed at some point, so let it be now. It turns out (given what I see) that we're going to maintain 7.0 and 8.0 for at least as long as 8.5, so it's good enough."}, {"count": 41, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 197999, "time": "2017-03-27T08:11:01Z", "bug_id": 60362, "creation_time": "2017-03-27T08:11:01Z", "is_private": false, "text": "One of the main reasons 8.0.x is maintained is because this option isn't available in 8.5.x. (The other is the sendfile issues which I think we are getting to the bottom of).\n\nThe patch looks reasonable. A couple of minor whitespace issues but nothing significant.\n\nI think we should apply this patch with a view to reducing / halting 8.0.x releases. I don't have a specific time-frame in mind, but certainly much earlier than 8.5.x."}, {"count": 42, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 198000, "time": "2017-03-27T08:16:09Z", "creator": "remm@apache.org", "creation_time": "2017-03-27T08:16:09Z", "tags": [], "text": "Ok, I thought the 8.0 plan was long gone. But the patch is only for 8.5 then ? If so, then I can withdraw the -1."}, {"count": 43, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 198001, "time": "2017-03-27T08:28:58Z", "creator": "violetagg@apache.org", "creation_time": "2017-03-27T08:28:58Z", "tags": [], "text": "(In reply to Remy Maucherat from comment #42)\n> Ok, I thought the 8.0 plan was long gone. But the patch is only for 8.5 then\n> ? If so, then I can withdraw the -1.\n\nThe patch is only for Tomcat 8.5 and I explicitly specified in the documentation and in the code that this option is deprecated and removed in Tomcat 9. Also the default remains false i.e. we will not send reason phrase by default."}, {"count": 44, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 198003, "time": "2017-03-27T09:47:10Z", "creator": "mgrigorov@apache.org", "creation_time": "2017-03-27T09:47:10Z", "tags": [], "text": "+1 for the change!"}, {"count": 45, "tags": [], "creator": "violetagg@apache.org", "attachment_id": null, "text": "Hi,\n\nA new Connector configuration 'sendReasonPhrase' is added. When this attribute is set to 'true', a reason phrase will be sent with the response.\nBy default a reason phrase will not be sent. This option is deprecated and is not available in Tomcat 9.\n\nThe functionality will be available in 8.5.13 onwards.\n\nRegards,\nVioleta", "id": 198007, "time": "2017-03-27T11:16:56Z", "bug_id": 60362, "creation_time": "2017-03-27T11:16:56Z", "is_private": false}, {"count": 46, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "text": "Ok, it's a good compromise then if 8.0 indeed does not go on (I'll believe that when it actually happens ;) ).", "id": 198009, "time": "2017-03-27T12:59:59Z", "bug_id": 60362, "creation_time": "2017-03-27T12:59:59Z", "is_private": false}, {"count": 47, "tags": [], "text": "(In reply to Violeta Georgieva from comment #45)\n> Hi,\n> \n> A new Connector configuration 'sendReasonPhrase' is added. When this\n> attribute is set to 'true', a reason phrase will be sent with the response.\n> By default a reason phrase will not be sent. This option is deprecated and\n> is not available in Tomcat 9.\n> \n> The functionality will be available in 8.5.13 onwards.\n> \n> Regards,\n> Violeta\n\nI have left a few comments on your patch on GitHub. Please have a look.", "is_private": false, "bug_id": 60362, "id": 198037, "time": "2017-03-28T09:31:39Z", "creator": "1983-01-06@gmx.net", "creation_time": "2017-03-28T09:31:39Z", "attachment_id": null}, {"count": 48, "tags": [], "creator": "violetagg@apache.org", "attachment_id": null, "text": "Hi,\n\n(In reply to Michael Osipov from comment #47)\n> (In reply to Violeta Georgieva from comment #45)\n> > Hi,\n> > \n> > A new Connector configuration 'sendReasonPhrase' is added. When this\n> > attribute is set to 'true', a reason phrase will be sent with the response.\n> > By default a reason phrase will not be sent. This option is deprecated and\n> > is not available in Tomcat 9.\n> > \n> > The functionality will be available in 8.5.13 onwards.\n> > \n> > Regards,\n> > Violeta\n> \n> I have left a few comments on your patch on GitHub. Please have a look.\n\nI replied to the comments.\nBoolean#getBoolean is used for the reading of the system property as proposed.\n\nThanks,\nVioleta", "id": 198050, "time": "2017-03-28T21:18:48Z", "bug_id": 60362, "creation_time": "2017-03-28T21:18:48Z", "is_private": false}, {"count": 49, "tags": [], "creator": "slavb18@gmail.com", "attachment_id": null, "id": 198216, "time": "2017-04-10T05:16:12Z", "bug_id": 60362, "creation_time": "2017-04-10T05:16:12Z", "is_private": false, "text": "Cannot understand, why, without any reason, all legacy clients should be broken with server update."}, {"count": 50, "tags": [], "text": "(In reply to slavb18 from comment #49)\n> Cannot understand, why, without any reason, all legacy clients should be\n> broken with server update.\n\nThey where already broken before. You just haven't noticed it.", "is_private": false, "bug_id": 60362, "id": 198217, "time": "2017-04-10T09:03:49Z", "creator": "1983-01-06@gmx.net", "creation_time": "2017-04-10T09:03:49Z", "attachment_id": null}, {"count": 51, "tags": [], "text": "I agree, but there lot of \"broken\" software, working everywhere in the world\nIsn't too early to drop legacy support?\nEven apache 2.4 proxy stops working without reason phrase\n\n<Location /test/>\n  ProxyPass http://backend/test/....", "is_private": false, "bug_id": 60362, "id": 198220, "time": "2017-04-10T10:25:27Z", "creator": "slavb18@gmail.com", "creation_time": "2017-04-10T10:25:27Z", "attachment_id": null}, {"count": 52, "tags": [], "creator": "blazej.bucko@gmail.com", "attachment_id": null, "is_private": false, "id": 198402, "time": "2017-04-20T08:57:50Z", "bug_id": 60362, "creation_time": "2017-04-20T08:57:50Z", "text": "They were not broken according to the first RFC. They broke around 2014 when new RFC was published."}, {"count": 53, "tags": [], "creator": "markt@apache.org", "is_private": false, "text": "(In reply to Blazej Bucko from comment #52)\n> They were not broken according to the first RFC. They broke around 2014 when\n> new RFC was published.\n\nNope. From RFC 2616 (dated 1999):\n\nReason-Phrase  = *<TEXT, excluding CR, LF>\n\nThe text around section 6.1.1 suggests that reason phrases will normally be non-zero length but the ABNF is clear that zero length reason phrases are valid (and should therefore be accepted by spec compliant user agents).", "id": 198404, "time": "2017-04-20T09:51:25Z", "bug_id": 60362, "creation_time": "2017-04-20T09:51:25Z", "attachment_id": null}, {"count": 54, "tags": [], "creator": "blazej.bucko@gmail.com", "attachment_id": null, "id": 198583, "time": "2017-04-28T08:25:39Z", "bug_id": 60362, "creation_time": "2017-04-28T08:25:39Z", "is_private": false, "text": "Yes, that's true. But, according to older spec, it's perfectly legal for clients to rely on this information. And removing the reason phrase breaks them."}, {"count": 55, "tags": [], "creator": "silas.smith@gmail.com", "attachment_id": null, "id": 198620, "time": "2017-05-01T22:23:17Z", "bug_id": 60362, "creation_time": "2017-05-01T22:23:17Z", "is_private": false, "text": "I'm missing the point about why it's so important for tomcat to no longer send the reason phrase, such that even keeping it as optional is being so strongly argued against? \n\nI'm glad an option was added for 8.5 to enable it.\n\nBut why limit that option to only 8.5, and not keep it (optional) for 9 and beyond? Aren't we just going to have the same argument then too?"}, {"count": 56, "tags": [], "creator": "mgrigorov@apache.org", "attachment_id": null, "is_private": false, "id": 198626, "time": "2017-05-02T08:18:05Z", "bug_id": 60362, "creation_time": "2017-05-02T08:18:05Z", "text": "(In reply to Silas Smith from comment #55)\n> I'm missing the point about why it's so important for tomcat to no longer\n> send the reason phrase, such that even keeping it as optional is being so\n> strongly argued against? \n> \n> I'm glad an option was added for 8.5 to enable it.\n> \n> But why limit that option to only 8.5, and not keep it (optional) for 9 and\n> beyond? Aren't we just going to have the same argument then too?\n\nWhy you can use old clients and not use old servers ?!\n6.x has been just discontinued, so I expect that 8.5.x will be maintained for the next 5+ years or so."}, {"count": 57, "tags": [], "text": "(In reply to mgrigorov from comment #56)\n> \n> Why you can use old clients and not use old servers ?!\n> 6.x has been just discontinued, so I expect that 8.5.x will be maintained\n> for the next 5+ years or so.\n\nBecause we have hundreds of thousands of distinct clients representing just about every type of device that is capable of sending an HTTP request, and we have few servers in comparison. We cannot simply break all of those clients with a shrug.\n\nI totally get changing the default behavior, and I agree with it. But I don't get why it's so important to not allow it to be configurable going forward.", "is_private": false, "bug_id": 60362, "id": 198633, "time": "2017-05-02T15:01:24Z", "creator": "silas.smith@gmail.com", "creation_time": "2017-05-02T15:01:24Z", "attachment_id": null}, {"count": 58, "tags": [], "creator": "thorsten.meinl@knime.com", "attachment_id": null, "id": 198643, "time": "2017-05-03T16:34:52Z", "bug_id": 60362, "creation_time": "2017-05-03T16:34:52Z", "is_private": false, "text": "Even if this change doesn't break clients it will give a very bad impression to users. For example if you use Java to issue HTTP request and and error was returned by the server, the exception message reads \"Server returned error 404: Not Found\" (or similar). Even for uses not knowing the HTTP status code the \"Not Found\" is descriptive. Therefore I guess many Java applications displays the exception message as is. With Tomcat 8.5 the exception message is \"Server returned error 404: null\". Normal users don't have clue any more what's going on and even for programmers this more looks like a NullPointerException somewhere deep in the code. In order to restore a good user experience you now have to interpret the exception messages and create new ones for every possible status code.\n\nTherefore my question is: why on earth has the reason phrase been removed in the first place? In order to save a few bytes of traffic?"}, {"count": 59, "tags": [], "creator": "mgrigorov@apache.org", "attachment_id": null, "id": 198646, "time": "2017-05-03T18:57:29Z", "bug_id": 60362, "creation_time": "2017-05-03T18:57:29Z", "is_private": false, "text": "(In reply to thorsten.meinl from comment #58)\n> Even if this change doesn't break clients it will give a very bad impression\n> to users. For example if you use Java to issue HTTP request and and error\n> was returned by the server, the exception message reads \"Server returned\n> error 404: Not Found\" (or similar). Even for uses not knowing the HTTP\n\n$ http http://localhost:8080/aaa\nHTTP/1.1 404 \nContent-Language: en\nContent-Length: 1073\nContent-Type: text/html;charset=utf-8\nDate: Wed, 03 May 2017 18:35:43 GMT\n\n\nThose are the response headers returned by Tomcat. \nThe client may add \"null\", emojis, unicorns, ... and Tomcat (or any server) is not to blame here!\n\n\n> status code the \"Not Found\" is descriptive. Therefore I guess many Java\n> applications displays the exception message as is. With Tomcat 8.5 the\n\nNo! It seems your client shows something it just made up!\n\n> exception message is \"Server returned error 404: null\". Normal users don't\n> have clue any more what's going on and even for programmers this more looks\n> like a NullPointerException somewhere deep in the code. In order to restore\n> a good user experience you now have to interpret the exception messages and\n> create new ones for every possible status code.\n\nWell, the HTTP protocol is pretty old! The error codes are very well known.\nIf a developer is confused that 404 may mean 500 then I think the time spend on debugging this problem will be very well spend time in education! This developer will learn something that will be very useful for him/her for the rest of his/her career!\nIf a software (i.e. non-human) makes the mistake then it is really a bug in this client software. Old clients can use old servers. Tomcat 8.5.x will be maintained for several more years. Just switch the property on and continue.\n\n> \n> Therefore my question is: why on earth has the reason phrase been removed in\n> the first place? In order to save a few bytes of traffic?\n\nThe simple answer is that the HTTP specification has been updated. HTTP2 is all about improvements and optimizations. And this is one of them.\nFew bytes here, few bytes there and my web app can serve few more hundreds/thousands users more!"}, {"count": 60, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 198650, "time": "2017-05-03T21:44:07Z", "bug_id": 60362, "creation_time": "2017-05-03T21:44:07Z", "is_private": false, "text": "To provide a some context / background.\n\n7.0.x, 8.0.x always send the reason phrase\n8.5.x does not send the reason phrase by default but can be configured to do so\n9.0.x does not send the reason phrase and can not be configured to do so\n\nBased on the typical lifetime of Tomcat release branches (roughly a decade or a little over and seemingly getting longer) there will be a Tomcat version (8.5.x) that can provide a reason phrase for at least 6 years, probably longer.\n\nThere were multiple reasons for dropping the reason phrase in 9.0.x:\n- RFC 7230 states that clients SHOULD ignore it and therefore why bother sending it\n- HTTP/2 doesn't support the reason phrase at all\n- It has always (going back to at least RFC 2616) been optional - i.e. spec compliant clients should accept a zero length reason phrase\n- It does save a few bytes although this will be in the noise for most users\n- It allowed a little complexity to be removed (the possibility of custom reason phrases and ensuring that they were safe) from the processing of every request. This will be in the noise for most users.\n\nGenerally, the view was (and is) that the change is beneficial for the majority of spec compliant clients and for those clients that can't handle a missing reason phrase there is a viable option (8.5.x) for a relatively (in IT terms) long period.\n\nOn a related point, it is worth noting that, as a result of vulnerabilities such as CVE-2016-6816, Tomcat, and HTTP servers generally, are becoming more strict in what will be accepted. Clients that do not follow the relevant specifications and cannot be easily fixed when problems are identified are likely to become increasingly problematic."}, {"count": 61, "attachment_id": null, "bug_id": 60362, "is_private": false, "id": 198651, "time": "2017-05-03T22:00:34Z", "creator": "ralph.twentyone@gmail.com", "creation_time": "2017-05-03T22:00:34Z", "tags": [], "text": "Ok. \nYou have the code to add the reason phrase. It's in contrast to headers not easily fixable in most reverse proxies. Why aren't you just keeping the option to add it? We have 3000 devices out there which rely on the reason phrase. Yes we could update them but it's cumbersome. You know embedded developers? They don't read standards. They just tailor their firmware to the servers. \nYour next argument is that you are going to provide maintenance forever for 8.5. That's great but we may want to use new features. Also we regularly upgrade our spring boot version which also updates Tomcat."}, {"count": 62, "tags": [], "creator": "mgrigorov@apache.org", "attachment_id": null, "is_private": false, "id": 198652, "time": "2017-05-03T22:18:45Z", "bug_id": 60362, "creation_time": "2017-05-03T22:18:45Z", "text": "(In reply to Ralph Moser from comment #61)\n> Your next argument is that you are going to provide maintenance forever for\n> 8.5. That's great but we may want to use new features. Also we regularly\n\nHow your old embedded devices will use the new features (e.g. HTTP2 features) without being upgraded ? You will need HTTP2 enabled client in the embedded device!\nIf you are going to update the client then it is a perfect time to relax the check for the reason phrase!\n\n> upgrade our spring boot version which also updates Tomcat.\n\nThe version of the dependencies in Spring Boot applications is *very* easy to control with Maven/Gradle properties/settings! I.e. in your application!\n\nTomcat 9 won't be released until Java EE 8 / Servlet 4.0 is released. So this will take a while!\nBut even when Tomcat 9 is released \n1) Spring Boot won't upgrade to it immediately. They will wait for a while so any newly introduced bugs are flushed.\n2) you will be still able to use 8.5.x by overriding the version"}, {"count": 63, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "is_private": false, "id": 198672, "time": "2017-05-04T16:54:20Z", "bug_id": 60362, "creation_time": "2017-05-04T16:54:20Z", "text": "First of all, let's all settle down. Reasonable people can disagree about whether this change is a Good Thing or a Bad Thing and whether options should exist to re-enable it. With that in mind, let's continue the conversation...\n\n(In reply to Ralph Moser from comment #61)\n> You have the code to add the reason phrase. It's in contrast to headers not\n> easily fixable in most reverse proxies. Why aren't you just keeping the\n> option to add it?\n\nThis is a conversation. There hasn't been a \"last word\" on this quite yet.\n\n> We have 3000 devices out there which rely on the reason\n> phrase.\n\nNote that there is no supported stable version of Tomcat where the reason phrase isn't available.\n\n> Yes we could update them but it's cumbersome. You know embedded\n> developers? They don't read standards. They just tailor their firmware to\n> the servers. \n\nI see this change as motivation for embedded developers to tailor their firmware to standards-compliant servers. This is very similar to the SSL vs TLS chicken-in-an-egg scenario we had several years ago: no servers were implementing TLS because no clients supported it yet and no clients were supporting it because no servers had support, either. Someone must move first.\n\n> Your next argument is that you are going to provide maintenance forever for\n> 8.5. That's great but we may want to use new features. Also we regularly\n> upgrade our spring boot version which also updates Tomcat.\n\nIf Spring Boot suddenly gives you a new major version of Tomcat without asking or being configured explicitly to do so, I think you should re-think your use of that technology.\n\nMy position has been that 8.5 should not have removed the reason phrase, so I was motivated to lobby for the introduction of a setting that would restore that feature. I have no such feelings about Tomcat 9.0 which won't be released as stable until Servlet 4.0 is finalized which could be anytime between now and when I die of old age.\n\nWe have plenty of time to discuss whether the HTTP reason phrase is something worth continuing to support in Tomcat 9 and later.\n\nWe should probably move this conversation back to the dev list, because this enhancement was filed against Tomcat 8.5 and, in fact, fixed. Let's leave this BZ issue in peace and re-locate to dev@ until we can decide whether Tomcat 9 should also be changed."}, {"count": 64, "tags": [], "creator": "chris@christopherschultz.net", "attachment_id": null, "is_private": false, "id": 198704, "time": "2017-05-05T18:54:07Z", "bug_id": 60362, "creation_time": "2017-05-05T18:54:07Z", "text": "*** Bug 60183 has been marked as a duplicate of this bug. ***"}, {"count": 65, "tags": [], "text": "Hi, \n\nJust so you know, BitKinex WebDAV client is impacted by this missing reason phrase and it can no longer access any webdav servlet configured in Tomcat unless sendReasonPhrase=\"true\" is configured.\n\nI just created the following bug report to make sure it gets identified if some user look for those symptoms : \nhttps://bz.apache.org/bugzilla/show_bug.cgi?id=61160\n\nIt might help you revise current tomcat decision to remove the phrase, if you were to consider BitKinex a widespread enough client.", "is_private": false, "bug_id": 60362, "id": 199079, "time": "2017-06-06T13:26:35Z", "creator": "olivier.jaquemet@jalios.com", "creation_time": "2017-06-06T13:26:35Z", "attachment_id": null}, {"count": 66, "tags": [], "creator": "freds@jfrog.org", "is_private": false, "text": "For info Debian Apt (some may think it's also IoT - as Trash) is also hardcoded to expect a reason phrase :(\nWas fixed for http: https://github.com/Debian/apt/commit/dda7233c5d3879f2580543ead0ad7cd76196a160#diff-c8367b0733401af8a29f502c70434b89\n\nBut not https: https://www.jfrog.com/jira/browse/RTFACT-15315", "id": 202299, "time": "2017-11-21T09:44:24Z", "bug_id": 60362, "creation_time": "2017-11-21T09:44:24Z", "attachment_id": null}, {"count": 67, "tags": [], "bug_id": 60362, "attachment_id": null, "id": 202321, "time": "2017-11-21T22:05:32Z", "creator": "1983-01-06@gmx.net", "creation_time": "2017-11-21T22:05:32Z", "is_private": false, "text": "(In reply to Fred Simon from comment #66)\n> For info Debian Apt (some may think it's also IoT - as Trash) is also\n> hardcoded to expect a reason phrase :(\n> Was fixed for http:\n> https://github.com/Debian/apt/commit/\n> dda7233c5d3879f2580543ead0ad7cd76196a160#diff-\n> c8367b0733401af8a29f502c70434b89\n> \n> But not https: https://www.jfrog.com/jira/browse/RTFACT-15315\n\nIf I understand scanf correctly, the apt code is broken even after the call. The RFC mandates that after the status code a mandatory space (U+0020) has follow along with an optional reason phrase. The mandatory space has been removed with that commit."}]
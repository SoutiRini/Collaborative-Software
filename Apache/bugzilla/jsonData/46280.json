[{"count": 0, "attachment_id": null, "creator": "josh@apache.org", "is_private": false, "id": 122803, "time": "2008-11-24T14:12:21Z", "bug_id": 46280, "creation_time": "2008-11-24T14:12:21Z", "tags": [], "text": "This bugzilla was opened in response to the mailing list posting made by Axel Roeslein:\n\nhttp://mail-archives.apache.org/mod_mbox/poi-user/200811.mbox/%3C29bf25ca0811200724y620db645p1783ac1c0bd5085d@mail.gmail.com%3E\n\nThe following stack trace occurred:\n\nException in thread \"main\" java.lang.RuntimeException: Unexpected record type (org.apache.poi.hssf.record.ContinueRecord)\n       at org.apache.poi.hssf.record.aggregates.RowRecordsAggregate.<init>(RowRecordsAggregate.java:87)\n       at org.apache.poi.hssf.model.Sheet.<init>(Sheet.java:197)\n       at org.apache.poi.hssf.model.Sheet.createSheet(Sheet.java:159)\n       at org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:286)\n       at org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:200)\n       at org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:182)\n\nUnfortunately the workbook had sensitive data in it, so it couldn't be uploaded.  Re-saving in Excel makes the problem go away, and the problem has not been reproduced with another workbook yet.\n\nFurther investigation revealed that the offending ContinueRecord was an extension to a \"SXLI - Line Item Array\" (0x00B5) record, which is a PivotTable record.  Indeed, the workbook does contain a large pivot table."}, {"count": 1, "tags": [], "bug_id": 46280, "text": "Fix applied in svn r720318\n\nThe logic inside RowRecordsAggregate was changed to allow for ContinueRecords after any UnknownRecord.\n\nThe arrangement of PivotTable records in the worksheet stream is not discussed in the OOO documentation.  Brief investigation suggests that they come after all of the row-block records of the current sheet (regardless of the actually positioning of the pivot table(s) on the sheet).\n\nHowever, Excel 2007 seems to put MSODRAWING(0x00EC) before the PivotTable records, and this should have prevented this bug, since RowBlocksReader stops at DrawingRecord.sid(0x00EC).  I am assuming that the offending file does not have an MSODRAWING record before the PivotTable records, so I added a fix in RecordOrderer.isEndOfRowBlock(int) to make sure PivotTable records are not included in the 'row blocks'.\n\nMy original assumption was that re-saving with Excel removed the offending ContinueRecord.  Now I am guessing that re-saving with Excel put the MSODRAWING record in the right place.\n\n", "id": 122805, "time": "2008-11-24T15:05:42Z", "creator": "josh@apache.org", "creation_time": "2008-11-24T15:05:42Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 46280, "text": "Created attachment 22935\nBiffViewer analysis\n\nI updated my sources from svn and rechecked. Reading works as expcected.\n\n    I would like to know if MSODRAWING (0x00EC) is\n    missing before the PivotTable records (0x00B* etc).\n\nNo, as far as I can see.\n\n    Is the first PivotTable record 0x00B0?\n\nNo.\n\n    Does re-saving with Excel insert MSODRAWING\n    in the expected place?\n\nWhat is the expected place?\n \n\nPlease see the attached file. It was produces outputting the BiffViewer result\nto \"note23.1\" and then doing \"grep sid=0x note23.1 > note23.sid.txt\"", "id": 122825, "time": "2008-11-25T03:17:37Z", "creator": "axel.roeslein@googlemail.com", "creation_time": "2008-11-25T03:17:37Z", "is_private": false, "attachment_id": 22935}, {"count": 3, "tags": [], "bug_id": 46280, "attachment_id": 22947, "is_private": false, "id": 122849, "time": "2008-11-25T11:00:45Z", "creator": "josh@apache.org", "creation_time": "2008-11-25T11:00:45Z", "text": "Created attachment 22947\nsummary of previous attachment\n\nI have summarized the attached 'note23.sid.txt' to just the following records:\n - All BOFs and EOFs to see where the sheets start and stop\n - For each sheet containing SXVIEW, all Records from DBCELL to SXVIEW\n - All continued records (only 2 in the whole workbook)\n\nIn the summary, it can be seen that only in the fifth sheet is SXVIEW not preceeded with MSODRAWING. This also happens to be the only sheet with a continued PivotTable record (recno=7750). Both conditions had to occur together to make this bug occur."}]
[{"count": 0, "tags": [], "creator": "rsanders@trustedcs.com", "attachment_id": null, "is_private": false, "id": 174496, "time": "2014-04-11T18:45:14Z", "bug_id": 56396, "creation_time": "2014-04-11T18:45:14Z", "text": "Initially report in https://issues.apache.org/bugzilla/show_bug.cgi?id=56027\n  On a RHEL6 system configured to be in FIPS 140 mode at boot time the Tomcat Native library will not start, due to the inability to generate a 512 bit RSA temporary key.  Commenting out the SSL_TMP_KEY_INIT_RSA(512) line in the SSL_TMP_KEYS_INIT() macro and rebuilding allows TCN to successfully start in FIPS mode.\n\n  The logic used in the SSL_TMP_KEYS_INIT() macro will cause the startup to fail if any of the temporary keys being generated fails.  Should this be changed to pass if at least one key generates, or one key of each type (RSA,DH, etc...)?  The following note is taken from the comments on the original 56027 bug:\n\nhttps://issues.apache.org/bugzilla/show_bug.cgi?id=56027#c14"}, {"count": 1, "tags": [], "creator": "mturk@apache.org", "attachment_id": null, "text": "When you say at boot time, this means started as a service?\nThis looks like a blocked read from /dev/urandom due to not enough entropy.\n\nThink there are some solutions to that. Google.", "id": 174498, "time": "2014-04-11T19:15:14Z", "bug_id": 56396, "creation_time": "2014-04-11T19:15:14Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 56396, "text": "I think we should just drop support for RSA-512, anyway. It should be considered insecure, which is probably why ken-generation fails (due to FIPS restrictions).", "id": 174506, "time": "2014-04-11T20:10:12Z", "creator": "chris@christopherschultz.net", "creation_time": "2014-04-11T20:10:12Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 56396, "text": "OK. Think I get more clearer picture now.\n\nThere are two things we should do inside\nssl_tmp_key_init_rsa function\n\n1. Use RSA_generate_key_ex function\n2. Be tolerant on keys < 1024 bits if OPENSSL_FIPS is defined\n   because they are supposed to fail as per fips-140 spec.", "id": 174507, "time": "2014-04-11T20:32:43Z", "creator": "mturk@apache.org", "creation_time": "2014-04-11T20:32:43Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 56396, "text": "Note that there is a long-standing bug in httpd for what appears to be the same issue: bug #51186.", "id": 174567, "time": "2014-04-15T01:14:05Z", "creator": "chris@christopherschultz.net", "creation_time": "2014-04-15T01:14:05Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "creator": "mturk@apache.org", "attachment_id": null, "text": "Please verify if the patch in SVN fixes the issue\nhttps://svn.apache.org/viewvc/tomcat/native/branches/1.1.x/native/src/ssl.c?r1=1559182&r2=1587896&view=patch\n\nAlso verify if everything is working as expected, not just if it boots so I can resolve this issue.", "id": 174630, "time": "2014-04-16T12:54:37Z", "bug_id": 56396, "creation_time": "2014-04-16T12:54:37Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 56396, "text": "Mladen,\n  Confirm, your patch resolves the issue with Tomcat Native failing to start in FIPS mode.  Pulled the stock 1.1.30 TCN source, applied your patch, and built/installed TCN.  On our RHEL6 box with FIPS enabled at boot, our webapp started just fine and performed as expected.  \n  I think a case could be made for also tweaking the logic in SSL_TMP_KEYS_INIT() so that things should continue if at least one temporary key can be created.  There may be reasons for aborting if all 'required' keys are not able to be created.  \n  Not familiar with the Tomcat BZ system for closing bugs - do I need to mark as resolved?", "id": 174634, "time": "2014-04-16T15:01:28Z", "creator": "rsanders@trustedcs.com", "creation_time": "2014-04-16T15:01:28Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 56396, "text": "OK, Thanks for confirming the fix.\nI think that this is special issue caused by FIPS standard which rejects all RSA keys less then 1024 bit, so no further tweaking is needed thought.\n\nClosing the issue.", "id": 174640, "time": "2014-04-16T15:34:27Z", "creator": "mturk@apache.org", "creation_time": "2014-04-16T15:34:27Z", "is_private": false, "attachment_id": null}]
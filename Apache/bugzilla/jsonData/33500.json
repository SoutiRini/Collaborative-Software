[{"count": 0, "tags": [], "text": "I'm trying to install apache 2.0.52 on an AIX 5.1:\n./configure                                 \\\n  CPPFLAGS=-D\"OPENSSL_NO_KRB5\"              \\\n  --prefix=/usr/local/etc/apache_2.0.52     \\\n  --enable-auth_dbm                         \\\n  --enable-proxy                            \\\n  --with-mpm=prefork                        \\\n  --enable-ssl=shared                       \\\n  --with-ssl=/usr/local/openssl_0.9.7e      \\\n  --enable-so                               \\\n  --enable-mods-shared=most                 \\\n  --enable-static-support                   \\\n  --enable-suexec                           \\\n  --with-suexec-caller=www                  \\\n  --with-suexec-userid=public_html          \\\n  --with-suexec-uidmin=10                   \\\n  --with-suexec-gidmin=100                  \\\n  --with-ndbm\n\nTesting has been completed, and when I put it up on production so that the users\nwere putting a load on it, I saw the following in error_log:\n\n[Mon Jan 31 21:30:05 2005] [warn] (68)Can't assign requested address: connect to\n listener\n[Mon Jan 31 21:30:06 2005] [warn] (68)Can't assign requested address: connect to\n listener\n[Mon Jan 31 21:30:07 2005] [warn] (68)Can't assign requested address: connect to\n listener\n[Mon Jan 31 21:30:08 2005] [warn] (68)Can't assign requested address: connect to\n listener\n[Mon Jan 31 21:30:09 2005] [warn] (68)Can't assign requested address: connect to\n listener\n[Mon Jan 31 21:30:10 2005] [warn] (68)Can't assign requested address: connect to\n listener\n[Mon Jan 31 21:30:11 2005] [warn] (68)Can't assign requested address: connect to\n listener\n\nThese errors messages are repeated throughout the log, one per second every few\nseconds.  I saw over 640 of these warning messages in less than 2 hours of\nrunning it in \"production\" mode with a load.  Sometimes there is a single\nwarning generated at a given time, or there could be up to 12 in a row spread\nover the next 12 seconds.\n\nMy theory is that these warnings are related to the prefork MPM which is trying\nto fork additional spare child servers.  I'm basing this on the fact that the\nwarnings occur once per second.  I have not changed any defaults as far as\nMinSpareServers or MaxSpareServers.  My Listen directive is set to 80, since the\nmachine does answer to multiple IP addresses.\n\nThanks for any insight you can give me on these warnings.\nJackie", "attachment_id": null, "bug_id": 33500, "id": 70784, "time": "2005-02-10T20:22:01Z", "creator": "jackie@colostate.edu", "creation_time": "2005-02-10T20:22:01Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 33500, "attachment_id": null, "id": 70803, "time": "2005-02-11T00:40:32Z", "creator": "trawick@apache.org", "creation_time": "2005-02-11T00:40:32Z", "is_private": false, "text": "This message is appearing when the load changes and, due to MaxSpareServers\nprocessing, the Apache parent process wants to tell a child process to go away.\n It does that by connecting to the listening socket.  The connect is failing\nintermittently, leading to that error message.\n\nI suspect that the error is due to a temporary out-of-ephemeral ports condition.\n Check that theory via netstat, during a time where the error messages appears.\n\nYou could increase the range of ephemeral ports and/or you could set\nMaxSpareServers to a higher value so that Apache wouldn't try to kill off child\nprocesses as frequently.\n"}, {"count": 2, "tags": [], "text": "It might also be useful to try the patches:\n\nhttp://cvs.apache.org/viewcvs.cgi/httpd-2.0/server/mpm_common.c?r1=1.117&r2=1.118\nhttp://cvs.apache.org/viewcvs.cgi/httpd-2.0/server/mpm_common.c?r1=1.122&r2=1.123\n\nI think some reports of this type could well be due to resolver oddness, since\nthe address-used-to-connect has come back out of a getnameinfo() call in 2.0.", "attachment_id": null, "bug_id": 33500, "id": 70846, "time": "2005-02-11T17:17:04Z", "creator": "jorton@redhat.com", "creation_time": "2005-02-11T17:17:04Z", "is_private": false}, {"count": 3, "tags": [], "creator": "jackie@colostate.edu", "text": "Thanks so much for your responses.  I investigated and found that the ephemeral\nport range for AIX 5.1 is:\n  tcp_ephemeral_low = 32768\n  tcp_ephemeral_high = 65535\nI watched netstat while apache was generating the warnings and I didn't see an\nout of ports condition.  I also tried increasing MaxSpareServers and saw the\nwarning messages continue to occur.\n\nI just read the posting about the patches.  I will try those next and let you\nknow the results.  Thanks again.", "id": 70849, "time": "2005-02-11T18:57:20Z", "bug_id": 33500, "creation_time": "2005-02-11T18:57:20Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "jorton@redhat.com", "text": "Rediffed patch which will apply to 2.0.x is here:\n\nhttp://cvs.apache.org/~jorton/ap_dummy.diff\n\nany update on results from testing?", "id": 71481, "attachment_id": null, "bug_id": 33500, "creation_time": "2005-02-24T18:17:45Z", "time": "2005-02-24T18:17:45Z", "is_private": false}, {"count": 5, "tags": [], "creator": "jackie@colostate.edu", "text": "Joe,\n\nYes I have found a solution, though perhaps not a clean one.  I attempted the\ntwo patches you referred me to.  The first patch results in the\napr_socket_create routine having another parameter added to it.  I started\nlooking though the apache source and found that would involve patching updating\nmany files in order to test this.  Sounded like a great deal of time, and no\nguarantee it would work.  \n\nThen I discovered 2.0.53 had been released, so I downloaded it, thinking maybe\nit would have the patches your referred me to included.  No difference, the\npatches weren't included and I still saw the warnings.\n\nI then did a search on the apache development mailing list and found a posting\nfrom Dave Hill, which reported exactly the same problem I saw.  The posting is\nbelow.  I tried his change and it worked great.  We are not using IPv6 so it's\nnot an issue for us.\n\nI do hope future releases of apache have this problem fixed.  If there is\nanything more I need to do to report it, please let me know.  Thanks much for\nyour help.\n\nJackie\n\nhttp://marc.theaimsgroup.com/?l=apache-httpd-dev&m=101852845214058&w=2\n\nList:       apache-httpd-dev\nSubject:    Re: connect to listener warning message\nFrom:       \"David Hill\" <ddhill () zk3 ! dec ! com>\nDate:       2002-04-11 12:34:01\n[Download message RAW]\n\nJeff,\n    remember this one ?\n\nFound my answer to what is going on, have a workaround but not a fix.\nThought you might be interested in what I found.\n\nWhen I build, I get (and want) IPv6 support, but when I run the image on a\nIPv4 only machine, everything seems to work but the POD. Turns out that this\nfails because getaddrinfo(\"::\"...) is not providing a usefull value on an\nIPv4 only machine, at least as far as the POD connection goes. When I hacked\nlisten.c changing \"::\" to \"0.0.0.0\" then everything seems to work fine. I am\ntalking with my network guys about correcting this, but in the mean time the\nlisten.c hack is simple for me and works.\n\nDave Hill\n----- Original Message -----\nFrom: \"Jeff Trawick\" <trawick@attglobal.net>\nTo: <dev@httpd.apache.org>\nSent: Saturday, March 30, 2002 8:51 PM\nSubject: Re: connect to listener warning message\n\n\n> \"David Hill\" <ddhill@zk3.dec.com> writes:\n>\n> > Hi all,\n> >     When I run 2.0.32 on Compaq Tru64 and give it a bit of a load (ok, I\nwhack it good :-), I get warnings similar to the following looping into the\nerror log file. I am getting one per second, even well after the load is\nremoved.I do not get any of these until after the load has been applied for\na 10 seconds or so.\n> >\n> > [Thu Mar 28 13:11:43 2002] [warn] (49)Can't assign requested address:\nconnect to listener>\n> \"one per second\" sounds like idle server maintenance\n>\n> \"can't assign requested address\" on a connect sounds like your machine\n> is out of ephemeral ports (you were whacking it over loopback I'll\n> bet) to assign to the source socket doing the dummy connection\n>\n> > Any suggestions ?\n>\n> tune the os to have more ephemeral ports??\n>\n> --\n> Jeff Trawick | trawick@attglobal.net\n> Born in Roswell... married an alien...\n>\n>", "id": 71496, "time": "2005-02-24T22:21:48Z", "bug_id": 33500, "creation_time": "2005-02-24T22:21:48Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "jorton@redhat.com", "text": "The patch which has been applied for 2.0.54 is:\nhttp://cvs.apache.org/~jorton/ap_dummy.diff\n\n(this will apply cleanly to 2.0.53)\n\nit would be great if you could try this out in the mean time.", "id": 71522, "attachment_id": null, "bug_id": 33500, "creation_time": "2005-02-25T17:27:06Z", "time": "2005-02-25T17:27:06Z", "is_private": false}, {"count": 7, "tags": [], "text": "Joe,\n\nI tried the patch you gave me and it worked.  My test was only for 10 minutes in\nproduction, but I didn't see a single warning log, so I say it looks good.\n\nI can't leave it up and running yet.  We have run into an issue with the users\n.htaccess files.  Users have the lines\n\nAddType text/x-server-parsed-html .html\n\nwhich causes the file type given to the browser to be x-server-parsed-html, and\nthe browser chokes.  We're having to contact all our users and have them modify\ntheir .htaccess files before we upgrade apache from 1.3.x to 2.0.  You don't\nknow of a fix for that do you?  <grin>\n\nI'll be putting apache 2 with the patch you gave me into \"production mode\" next\nWednesday.  Thanks for your help.\n\nJackie", "is_private": false, "bug_id": 33500, "id": 71925, "time": "2005-03-07T21:16:04Z", "creator": "jackie@colostate.edu", "creation_time": "2005-03-07T21:16:04Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "jorton@redhat.com", "is_private": false, "count": 8, "id": 72126, "time": "2005-03-10T14:32:24Z", "bug_id": 33500, "creation_time": "2005-03-10T14:32:24Z", "text": "Good to hear, thanks for trying it out.  This is merged now for 2.0.54.\n\nhttp://svn.apache.org/viewcvs.cgi?rev=155213&view=rev"}]
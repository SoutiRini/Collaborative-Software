[{"count": 0, "tags": [], "bug_id": 11674, "attachment_id": null, "is_private": false, "id": 20982, "time": "2002-08-13T19:11:27Z", "creator": "rainer.klute@epost.de", "creation_time": "2002-08-13T19:11:27Z", "text": "I have a simple little JSP file that includes another one. However, Tomcat\nthrows an IllegalStateException when it comes to the include. I tested two\nvariants: the first one with \"<jsp:include page=\"included.jspf\"/>\", and the\nsecond one with \"<% pageContext.include(\"included.jspf\"); %>\". Both throw the\nexception in a call to\norg.apache.jasper.runtime.ServletResponseWrapperInclude.getOutputStream().\n\nAttached you'll find the test application as a WAR."}, {"count": 1, "tags": [], "bug_id": 11674, "is_private": false, "text": "This bug existed in 4.0.3 already. I upgraded to 4.1.8 to try to get rid of it,\nbut... :-(", "id": 20986, "time": "2002-08-13T19:14:17Z", "creator": "rainer.klute@epost.de", "creation_time": "2002-08-13T19:14:17Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "jspf isn't a register text file type. So it cannot be included in your JSP \n(which outputs text).\nAdd a \"jspf\" MIME type (like text/jsp - it must start with \"text/\") to fix the \nproblem.", "is_private": false, "id": 22498, "creator": "remm@apache.org", "time": "2002-09-09T10:49:59Z", "bug_id": 11674, "creation_time": "2002-09-09T10:49:59Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 11674, "attachment_id": null, "text": "Not quite. When I replace the extension \".jspf\" to \".jsp\" and thus change\n<jsp:include page=\"included.jspf\"/> to <jsp:include page=\"included.jsp\"/>\neverything works fine. However, <% pageContext.include(\"included.jsp\"); %>\"\nstill throws an exception. See below for the first lines of the stack trace.\n\nOn the other hand I think it would be good if Tomcat as the JSP reference\nimplementation supported the \".jsf\" and \".jspf\" extensions out of the box. The\nJSP 1.2 Specification suggests them in chapter 2.1.7:\n\n\"We recommend, but do not mandate, that:\n- \".jsp\" files correspond to top level JSP files containing a JSP page.\n- \"Included fragments not use the \".jsp\" extension. Any other extension will do,\nalthough \".jspf\" and \".jsf\" seem reasonable extensions and are offered as\nsuggestions.\"\n\nAnd here's the stack trace:\n\n2002-09-09 13:12:05 JspFactoryImpl: Exception initializing page context\njava.lang.IllegalStateException: Cannot create a session after the response has\nbeen committed\n        at\norg.apache.coyote.tomcat4.CoyoteRequest.doGetSession(CoyoteRequest.java:1871)\n        at\norg.apache.coyote.tomcat4.CoyoteRequest.getSession(CoyoteRequest.java:1718)\n        at\norg.apache.coyote.tomcat4.CoyoteRequestFacade.getSession(CoyoteRequestFacade.java:365)\n        at\norg.apache.coyote.tomcat4.CoyoteRequestFacade.getSession(CoyoteRequestFacade.java:375)\n        at\njavax.servlet.http.HttpServletRequestWrapper.getSession(HttpServletRequestWrapper.java:268)\n        at\norg.apache.jasper.runtime.PageContextImpl._initialize(PageContextImpl.java:138)\n        at\norg.apache.jasper.runtime.PageContextImpl.initialize(PageContextImpl.java:114)\n        at\norg.apache.jasper.runtime.JspFactoryImpl.internalGetPageContext(JspFactoryImpl.java:175)\n        at\norg.apache.jasper.runtime.JspFactoryImpl.getPageContext(JspFactoryImpl.java:154)\n        at org.apache.jsp.included_jsp._jspService(included_jsp.java:33)\n        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:136)\n", "id": 22514, "time": "2002-09-09T13:25:20Z", "creator": "rainer.klute@epost.de", "creation_time": "2002-09-09T13:25:20Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 11674, "is_private": false, "text": "I think there's a logical explanation to the difference in behavior (not being \na JSP expert, I won't comment further; it's a separate issue anyway). I added \nthe two MIME types (it will be in 4.1.11).", "id": 22524, "time": "2002-09-09T14:46:01Z", "creator": "remm@apache.org", "creation_time": "2002-09-09T14:46:01Z", "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "rich_kraft@yahoo.com", "text": "ExpressionEvaluatorManager has a synchronized method that causes every use of\nevaluate to block.  This causes major issues when the taglibs are used in a high\nthroughput environment.\n\n\nI have patched the code as indicated below:\n\n--- ExpressionEvaluatorManager.java.orig\t2004-04-08 03:42:02.000000000 -0500\n+++ ExpressionEvaluatorManager.java\t2004-04-08 08:58:40.302582400 -0500\n@@ -99,20 +99,22 @@\n      * Gets an ExpressionEvaluator from the cache, or seeds the cache\n      * if we haven't seen a particular ExpressionEvaluator before.\n      */\n-    public static synchronized\n-\t    ExpressionEvaluator getEvaluatorByName(String name)\n-            throws JspException {\n+    public static ExpressionEvaluator getEvaluatorByName(String name) throws\nJspException\n+    {\n+        Object oEvaluator = nameMap.get(name);\n+        if (oEvaluator != null)\n+            return ((ExpressionEvaluator) oEvaluator);\n         try {\n-\n-            Object oEvaluator = nameMap.get(name);\n-            if (oEvaluator == null) {\n-                ExpressionEvaluator e = (ExpressionEvaluator)\n-                    Class.forName(name).newInstance();\n-                nameMap.put(name, e);\n-                return (e);\n-            } else\n+                synchronized (nameMap)\n+                {\n+                    oEvaluator = nameMap.get(name);\n+                    if (oEvaluator != null)\n+                        return ((ExpressionEvaluator) oEvaluator);\n+                    ExpressionEvaluator e = (ExpressionEvaluator)\nClass.forName(name).newInstance();\n+                    nameMap.put(name, e);\n+                    oEvaluator = e;\n+                }\n                 return ((ExpressionEvaluator) oEvaluator);\n-\n         } catch (ClassCastException ex) {\n             // just to display a better error message\n             throw new JspException(\"invalid ExpressionEvaluator: \" +", "id": 55520, "time": "2004-04-08T14:05:48Z", "bug_id": 28282, "creation_time": "2004-04-08T14:05:48Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "text": "Created attachment 11184\nRemove synchronized from the getEvaluatorByName method", "attachment_id": 11184, "id": 55521, "creation_time": "2004-04-08T14:06:59Z", "time": "2004-04-08T14:06:59Z", "creator": "rich_kraft@yahoo.com", "bug_id": 28282, "is_private": false}, {"count": 2, "tags": [], "bug_id": 28282, "attachment_id": null, "id": 55527, "time": "2004-04-08T16:37:49Z", "creator": "rich_kraft@yahoo.com", "creation_time": "2004-04-08T16:37:49Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of 25967 ***"}]
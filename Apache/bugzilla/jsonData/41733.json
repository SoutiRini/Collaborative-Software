[{"count": 0, "tags": [], "bug_id": 41733, "text": "Here's the stacktrace:\n\njava.lang.NegativeArraySizeException\n        at org.apache.batik.svggen.font.table.HmtxTable.init(HmtxTable.java:59)\n        at org.apache.batik.svggen.font.Font.read(Font.java:178)\n        at org.apache.batik.svggen.font.Font.create(Font.java:196)\n\nIf I had to take a guess at a solution, from that stacktrace it appears Batik\nfailed to read a value for numberOfHMetrics from the HHEA table in the TTF. I\ntook a quick look at the TTF specification from Microsoft and it appears this\nvalue is an unsigned short:\n \nhttp://www.microsoft.com/OpenType/OTSpec/hhea.htm\n \n...however, Apache Batik is reading it in as a normal Java short (which is\nsigned) on line 58 of org.apache.batik.svggen.font.table.HheaTable. The huge\nnumber of glyph entries in Arial Unicode probably means the number of entries in\nthe HMTX table exceeds 32768 hence the short wraps around to a negative value,\nand thus the initialization of the hMetrics Array fails. Using an int to store\nthis value and correcting for the negative bit with a mask should solve the problem.\n\nNote that we think we've successfully run tests with Arial Unicode in the past,\nso perhaps this is a regression in Batik 1.6?", "id": 99907, "time": "2007-02-28T11:02:50Z", "creator": "pfarland@adobe.com", "creation_time": "2007-02-28T11:02:50Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "cam@apache.org", "attachment_id": null, "text": "Hi Peter.\n\nThis seems to have been fixed since the 1.6 release.  The numberOfHMetrics entry\nis indeed stored in an int now (see\nhttp://svn.apache.org/repos/asf/xmlgraphics/batik/trunk/sources/org/apache/batik/svggen/font/table/HheaTable.java).\n\nThanks,\n\nCameron", "id": 99924, "time": "2007-02-28T20:23:17Z", "bug_id": 41733, "creation_time": "2007-02-28T20:23:17Z", "is_private": false}]
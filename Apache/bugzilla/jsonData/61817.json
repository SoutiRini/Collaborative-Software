[{"count": 0, "tags": [], "creator": "tutimura@nn.iij4u.or.jp", "text": "Created attachment 35555\npatch to server/util.c (ap_get_exec_line)\n\nap_get_exec_line() calls apr_file_close(), but it is not enough to terminate the child process; it should call apr_proc_wait().\nI'll attach a patch.\n\nThis will occur only when we use\nAuthLDAPBindPassword exec:/path/to/command/to/echo/password\ndirective. Thus it is difficult to reproduce.\n\nSo I checked my patch with customized server/log.c.\nI added last two lines.\n\nvoid ap_logs_child_init(apr_pool_t *p, server_rec *s)\n{\n    read_handle_t *cur = read_handles;\n\n    while (cur) {\n        apr_file_close(cur->handle);\n        cur = cur->next;\n    }\n    const char *argv[] = {\"dummyXXXX\"};  /* added for test */\n    ap_get_exec_line(p, \"/bin/mktemp\", argv);  /* added for test */\n}\n\nWe can easily see defunct mktemp without patch. With patch, we don't see.\n\n% ./apachectl start\n% ps aux | grep Z\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nme       19398  0.0  0.0      0     0 ?        Z    14:42   0:00 [mktemp] <defunct>\nme       19399  0.0  0.0      0     0 ?        Z    14:42   0:00 [mktemp] <defunct>\nme       19400  0.0  0.0      0     0 ?        Z    14:42   0:00 [mktemp] <defunct>\nme       19485  0.0  0.0  14860  2184 pts/3    S+   14:42   0:00 grep --color=auto Z\n\nNOTE: Sorry, argv have no effect. I may misunderstand how to use argv.", "id": 202409, "time": "2017-11-25T06:35:10Z", "bug_id": 61817, "creation_time": "2017-11-25T06:35:10Z", "is_private": false, "attachment_id": 35555}]
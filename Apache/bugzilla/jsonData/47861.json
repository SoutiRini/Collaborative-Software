[{"text": "I am using an apache server with perl on a VMS platform, and I get the newline character inserted just before the 32k mark is reached. Both Mozilla and IE have similar results, just slightly different locations. The newline character is inserted within 1k of the 32k byte marker, before I can make my first read. After that, the newline character is inserted inserted randomly (about once every 32k).  \n\nFor a test files, I created an image with vertical stripes. This gives me a quick visual check.  I also created a binary file 32k in size which has repeating blocks of 256 bytes starting from 0x00 to 0xff.  Using a hex dump, I can locate the shift in data.\n\nI don't know if it is the Apache setup, or if a cache is inserting the newline characters.\n\nI have tried to set the cache-control (http) when I create the form but only the \"cache-control: no-cache\" has any effect where the result is a truncating the output to about 32k, roughly where the first newline was being inserted. \n\nThe form is pretty standard stuff\n----------\n  <script language=\"Javascript\" type = \"text/javascript\">\n\n\n      function openWindow() \n      {\n\t   newWindow = window.open(\"\", \"uploadWin\", \n           \"toolbar=no, location=no, scrollbars=no, width=500, height=200\" );\n      }\n      function submitUpload(frm)\n      {\n \n         if(frm.uploadFile.value ==\"\")\n         {\n            alert(\"File is not specified\");\n            frm.uploadFile.focus();\n            frm.uploadFile.select();\n            return false;\n         }\n         else \n         {\n            frm.action=\"/bin/upload\";   \n             \n            return true;\n\n         }\n      }\n      function closeWindow()\n      {\n         this.close();\n         return false;\n      } \n   </script>\n\n         <form id=\"frmUpload\" method=\"post\" enctype=\"multipart/form-data\" \n\t       onsubmit=\"return submitUpload(this);\" >\n\n         <table border=\"0\">\n\n\n         <caption><strong>Upload File</strong><br><sup>(filesize < 32k)</sup> </caption>\n \n<<<< snip >>>>\n\n\n        <tr>            \n            <td colspan=\"4\">File: &nbsp;\n               <input type=\"file\" name=\"uploadFile\" size=\"45\">\n            </td>  \n         </tr>\n\n         <tr><td>&nbsp;</td></tr>\n         <tr>\n            <td>&nbsp;</td>\n            <td>\n               <input size=\"20\" name=\"Submit\" type=\"Submit\" \n                  value=\"Upload\" >\n            </td>\n           <td>\n               <input size=\"20\" name=\"Close\" type=\"Reset\" \n                  value=\"Close\" onclick=\"return closeWindow();\" >\n           </td>\n\n         </tr>\n         </table>     \n         </form>\n\n\n-----------", "tags": [], "bug_id": 47861, "is_private": false, "count": 0, "id": 130488, "time": "2009-09-17T09:16:12Z", "creator": "harold.brauer@megasys.com", "creation_time": "2009-09-17T09:16:12Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 47861, "attachment_id": 24299, "id": 130566, "time": "2009-09-21T14:35:15Z", "creator": "harold.brauer@megasys.com", "creation_time": "2009-09-21T14:35:15Z", "is_private": false, "text": "Created attachment 24299\nA jpeg with vertical stripes.\n\nWhen the newline is inserted, the stripes are offset and the colors are altered."}, {"count": 2, "attachment_id": null, "creator": "poirier@pobox.com", "is_private": false, "id": 130608, "time": "2009-09-23T07:43:59Z", "bug_id": 47861, "creation_time": "2009-09-23T07:43:59Z", "tags": [], "text": "Are the newlines inserted during the upload or the download?\n\nWhat happens if you don't use/load cache?\n\nPlease attach your httpd.conf file so we can see your configuration.\n\nWhat is /bin/upload?  What happens if you replace it with some alternative way of handling uploads?"}, {"count": 3, "text": "Created attachment 24358\nhttpd.conf (vms file)", "bug_id": 47861, "attachment_id": 24358, "id": 130949, "time": "2009-10-07T10:42:27Z", "creator": "harold.brauer@megasys.com", "creation_time": "2009-10-07T10:42:27Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 47861, "attachment_id": null, "id": 130950, "time": "2009-10-07T10:44:14Z", "creator": "harold.brauer@megasys.com", "creation_time": "2009-10-07T10:44:14Z", "is_private": false, "text": "(In reply to comment #2)\n> Are the newlines inserted during the upload or the download?\n> \n\nThe newline characters are inserted on upload.  Download works fine. \nI have uploaded files using ftp and downloaded the via http (i.e putting the URL link to the file). I have no problem downloading files.\n\n> What happens if you don't use/load cache?\n> \n\nIf I try to prevent the cache from storing data, the file is truncated. \nIf I don't try to control the cache, I get the entire file downloaded with the newline characters inserted randomly.\n\n> Please attach your httpd.conf file so we can see your configuration.\n> \n\nOK.\n\n> What is /bin/upload?  What happens if you replace it with some alternative way\n> of handling uploads?\n\n/bin/upload is my perl script which I use to handle the upload request. \n\nI don't have trouble coping files from one VMS host to another.  The ftp protocol is turned off on the host where the webserver resides."}, {"count": 5, "tags": [], "bug_id": 47861, "attachment_id": null, "id": 130955, "time": "2009-10-07T13:09:04Z", "creator": "harold.brauer@megasys.com", "creation_time": "2009-10-07T13:09:04Z", "is_private": false, "text": "Correction: I am able to ftp to this machine. I just cannot do it from my Windows PC, however I can from a Sun workstation."}, {"count": 6, "tags": [], "bug_id": 47861, "attachment_id": null, "id": 131114, "time": "2009-10-13T13:08:33Z", "creator": "trawick@apache.org", "creation_time": "2009-10-13T13:08:33Z", "is_private": false, "text": "Here's some information that seems to be missing or incorrect:\n\n* the httpd.conf file in a format that we can read (not a VMS file)\n* the suspected component\nThe bug is filed against mod_cache, but mod_cache isn't loaded in the provided httpd.conf file.  Is mod_cache built-in?  I think the references to \"cache\" in the discussion are the browser cache.\nAll I can tell for sure is that there is some corruption somewhere between the browser posting the data to httpd and Perl handing data to your Perl script.\n* the exact httpd version number\nThe httpd.conf file refers to version 2.0.x documentation (but also has some 1.3-isms).  The bug is filed against version 2.3-head.\n* who is supplying this server?\nhttpd 2+ doesn't support VMS.  (e.g., \"AcceptMutex vmsdlm\", VmsServerStartup, etc.)  It is cool that somebody taught it to support VMS, but we don't know what code you are running.  I'm not aware of anyone in httpd development that uses VMS and can try to reproduce this.\n* can you reproduce on another platform (Linux, Solaris, Windows, *BSD)?"}, {"count": 7, "tags": [], "bug_id": 47861, "attachment_id": null, "id": 131120, "time": "2009-10-14T09:51:28Z", "creator": "harold.brauer@megasys.com", "creation_time": "2009-10-14T09:51:28Z", "is_private": false, "text": "(In reply to comment #6)\n> Here's some information that seems to be missing or incorrect:\n> \n> * the httpd.conf file in a format that we can read (not a VMS file)\n> * the suspected component\n\nI assumed the VMS format would have been appropriate, being this is a VMS platform. I will put it in a file you can read with notepad.  \n\n> The bug is filed against mod_cache, but mod_cache isn't loaded in the provided\n> httpd.conf file.  Is mod_cache built-in?  I think the references to \"cache\" in\n> the discussion are the browser cache.\n\nI assumed that if the server uses mod perl, it uses mod_cache.  There does not seem to be any reference to cache in the httpd.conf.  As usual, the information for the VMS platform is hard to find!\n\nThe http cache-control, the text which preceeds the <HTML> tags, would affect the either the server cache-control or the browser cache-control.  I assumed that if either of these two cache were the source of the newline character being inserted, then I could turn off this undesirable newline.  It has not been the case.\n\n> All I can tell for sure is that there is some corruption somewhere between the\n> browser posting the data to httpd and Perl handing data to your Perl script.\n\nAgreed. The endpoints, server/client,  are the places I tend to check first.  I don't know where else I should be checking. \n\n> * the exact httpd version number\n> The httpd.conf file refers to version 2.0.x documentation (but also has some\n> 1.3-isms).  The bug is filed against version 2.3-head.\n> * who is supplying this server?\n> httpd 2+ doesn't support VMS.  (e.g., \"AcceptMutex vmsdlm\", VmsServerStartup,\n> etc.)  It is cool that somebody taught it to support VMS, but we don't know\n> what code you are running.  I'm not aware of anyone in httpd development that\n> uses VMS and can try to reproduce this.\n> * can you reproduce on another platform (Linux, Solaris, Windows, *BSD)?\n\nThe html help for httpd has \"http://www.apache.org/licenses/LICENSE-2.0\"\nI just assumed that this was the latest and greatest. But for VMS, V2.0, must be the latest version.\n\n\nNo.  We have Apache only installed the VMS hosts.  This is where we want it running."}, {"count": 8, "tags": [], "bug_id": 47861, "attachment_id": null, "id": 131123, "time": "2009-10-14T10:14:02Z", "creator": "trawick@apache.org", "creation_time": "2009-10-14T10:14:02Z", "is_private": false, "text": "It seems that this web server is the HP Secure Web Server (based on Apache 2.0.ancient and apparently modified in significant ways).\n\nSee http://h71000.www7.hp.com/openvms/products/ips/apache/csws.html.\n\nWe can't support that here.\n\nThe mysterious newlines may have something to do with STREAM_LF record format, which is somehow addressed by release 2.1 of this HP web server.  Maybe you can find a definitive description of that somewhere.\n\nIf you can't get help from HP (this is a commercially supported product), maybe one of the httpd user mailing lists can be used to help narrow down the suspected component further.  If the suspected component is indeed the web server, we still can't address it here."}, {"count": 9, "tags": [], "bug_id": 47861, "attachment_id": null, "is_private": false, "id": 131138, "time": "2009-10-15T07:08:24Z", "creator": "harold.brauer@megasys.com", "creation_time": "2009-10-15T07:08:24Z", "text": "Thank you for at least pointing me in the right direction."}]
[{"count": 0, "tags": [], "bug_id": 59154, "attachment_id": null, "text": "We're using JAAS authentication and after upgrading to Tomcat 8.0.32 from 7.0.26, I'm getting a NullPointerException:\n\nAuthentication failed: java.lang.NullPointerException\nat org.apache.catalina.realm.MemoryRealm.authenticate(MemoryRealm.java:127)\nat org.apache.catalina.realm.JAASMemoryLoginModule.login(JAASMemoryLoginModule.java:288)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat javax.security.auth.login.LoginContext.invoke(Unknown Source)\nat javax.security.auth.login.LoginContext.access$000(Unknown Source)\nat javax.security.auth.login.LoginContext$4.run(Unknown Source)\nat javax.security.auth.login.LoginContext$4.run(Unknown Source)\nat java.security.AccessController.doPrivileged(Native Method)\nat javax.security.auth.login.LoginContext.invokePriv(Unknown Source)\nat javax.security.auth.login.LoginContext.login(Unknown Source)\nat com.lizardtech.es.adminui.vaadin.jaas.LoginController.onLogin(Unknown Source)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nat java.lang.reflect.Method.invoke(Unknown Source)\nat com.vaadin.event.ListenerMethod.receiveEvent(ListenerMethod.java:510)\nat com.vaadin.event.EventRouter.fireEvent(EventRouter.java:164)\nat com.vaadin.ui.AbstractComponent.fireEvent(AbstractComponent.java:1219)\nat com.vaadin.ui.LoginForm$2.handleParameters(LoginForm.java:103)\nat com.vaadin.ui.Window.handleParameters(Window.java:515)\nat com.vaadin.terminal.gwt.server.AbstractApplicationServlet.service(AbstractApplicationServlet.java:528)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:729)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:292)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:207)\nat org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:240)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:207)\nat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:212)\nat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:106)\nat org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:502)\nat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:141)\nat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:79)\nat org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:616)\nat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:88)\nat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:522)\nat org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1095)\nat org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:672)\nat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1500)\nat org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1456)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\nat org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\nat java.lang.Thread.run(Unknown Source)\n\nWhile using the following configuration:\n\nserver.xml:\n\n  <GlobalNamingResources>\n    <!-- Editable user database that can also be used by\n         UserDatabaseRealm to authenticate users\n    -->\n    <Resource auth=\"Container\" description=\"User database that can be\nupdated and saved\"\nfactory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\"\nname=\"UserDatabase\" pathname=\"conf/tomcat-users.xml\"\ntype=\"org.apache.catalina.UserDatabase\"/>\n  </GlobalNamingResources>\n\n  ...\n\n  <Realm className=\"org.apache.catalina.realm.MemoryRealm\" digest=\"SHA\">\n    <CredentialHandler algorithm=\"SHA\"\nclassName=\"org.apache.catalina.realm.MessageDigestCredentialHandler\"/>\n  </Realm>\n\n\njaas.config:\n/** JAAS Login Configuration for the Application **/\n\nJAASTomcat {\n   org.apache.catalina.realm.JAASMemoryLoginModule required debug=true;\n};\n\n\nThe problem appears to be as follows:\n\nJAASMemoryLoginModule implements MemoryRealm.  In Tomcat 8, realms are required to have a CredentialHandler.  However there is currently no way to configure JAASMemoryLoginModule to set a CredentialHandler.  A solution proposed by Christopher Schultz is to add a \"digest=SHA\" option to jaas.config and handle it in the JAASMemoryLoginModule's initializer.\n\nFor reference, this is discussed in more depth on the tomcat user mailing list in the thread \"NullPointerException in MemoryRealm after upgrading to Tomcat 8.0.32 from 7.0.26\".", "id": 189316, "time": "2016-03-09T18:35:55Z", "creator": "jasonoverland@gmail.com", "creation_time": "2016-03-09T18:35:55Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59154, "text": "Fixed in trunk for 9.0.0.M4 onwards and 8.0.x for 8.0.33 onwards.", "id": 189348, "time": "2016-03-10T22:04:13Z", "creator": "markt@apache.org", "creation_time": "2016-03-10T22:04:13Z", "is_private": false, "attachment_id": null}]
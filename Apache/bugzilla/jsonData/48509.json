[{"count": 0, "tags": [], "bug_id": 48509, "attachment_id": null, "is_private": false, "id": 133441, "time": "2010-01-07T18:14:27Z", "creator": "ricemaster@fastem.com", "creation_time": "2010-01-07T18:14:27Z", "text": "To reproduce: \n-------------\nsend a valid POST request to your ISAPI dll\nstart fiddler2 and copy the request to the 'Request Builder'\ngo to 'Request Builder'->'Options' and untick 'Fix Content-Length header'\ngo to 'Request Builder'->'Parsed' and manually change the 'Content-Length:' to 1\nnow press execute a few times fast, in my test Apache crashes after 1-10 clicks\n\n\nReason:\n-------\nwhen the post command is tampered with as above, the call to ap_get_client_block in isapi_handler (sometimes?) fails.\nas a result the isapi dll is unloaded - this is dangerous !! other threads processing other requests have already acquired the pointer to the dll function and now try to call it with the dll not in memory which crashes apache.\n\nSolution:\n---------\nthere is no reason to unload the isapi dll in isapi_handler, it is dagerous and does not provide any benefit. In mod_isapi.c I have remarked all (2) calls to isapi_unload and left only the one in cleanup_isapi which if I understand correctly only gets called when Apache exits (although I think it can be removed as well). In testing this solves the issue.\n\nSecurity\n--------\nI can't see how a hacker can manipulate the address pointer but it's still a fact that the server tries to jump to an invalid function pointer."}, {"count": 1, "tags": [], "text": "Fixed in version 2.2.15", "attachment_id": null, "id": 135389, "creator": "ricemaster@fastem.com", "time": "2010-03-16T22:24:19Z", "bug_id": 48509, "creation_time": "2010-03-16T22:24:19Z", "is_private": false}]
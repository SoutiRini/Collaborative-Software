[{"count": 0, "tags": [], "text": "The SQL task will replace all ANT properties, e.g. ${basedir}, from the SQL \nstring before executing it. This is probably desirable in many cases, but in \nsome cases it's destructive. We want to store the string without property \nreplacement.\n\nConsider this:\nCREATE TABLE TEST (TEST_COL VARCHAR2(100));\nINSERT INTO TEST (TEST_COL) VALUES ('${basedir}');\nSELECT TEST_COL FROM TEST;\n\nResulting in:\nTEST_COL\n-----------------------------------------\nC:\\temp\n\nWhat I want is:\nTEST_COL\n-----------------------------------------\n${basedir}\n\nMy proposal is to add an attribute 'replaceProperties' to the SQL task, which \ncould be used to turn of the replacing. The default value would be 'true' so \nthat existing scripts wont break.\n\nThis problem is especially serious when using the task on Oracle Wrapped files \n(.plb), which won't work at all if the properties have been replaced.\n\nI have tried this on my own by adding the following code in SQLExec.java:\n\nAdded instance attribute:\n\n>      * <p>\n>      * Replace ANT properties in the SQL.\n>      * </p>\n>      */\n>     private boolean replaceProperties = true;\n\nAdded instance method:\n\n>     /**\n>      * Set the replace properties flag. Defaults to true.\n>      */\n>     public void setReplaceProperties(boolean replace) {\n>         replaceProperties = replace;\n>     }\n\nModified runStatements()\n\n>            if (replaceProperties) {\n>                line = project.replaceProperties(line);\n>            }\n\nThe SQL task would then look like this:\n\n       <sql driver=\"oracle.jdbc.driver.OracleDriver\" \n            url=\"jdbc:oracle:thin:@localhost:1521:SID\" \n            userid=\"USER\" \n            password=\"PWD\" \n            autocommit=\"true\" \n            replaceProperties=\"true\"> \n          <![CDATA[\nDROP TABLE TEST;\nCREATE TABLE TEST (TEST_COL VARCHAR2(100));\nINSERT INTO TEST (TEST_COL) VALUES ('${XYZ}');\nINSERT INTO TEST (TEST_COL) VALUES ('${basedir}');\nSELECT TEST_COL FROM TEST;\n          ]]>\n          <classpath>\n            <pathelement location=\"lib/classes12.zip\"/>\n          </classpath>          \n       </sql>", "is_private": false, "id": 37197, "creator": "christer.holmer@corustechnologies.com", "time": "2003-05-14T14:56:49Z", "bug_id": 19921, "creation_time": "2003-05-14T14:56:49Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "what is wrong, pray, with double escaping the $ sign as in $${basedir} to\nindicate that it should not be evaluated?", "is_private": false, "bug_id": 19921, "id": 37205, "time": "2003-05-14T15:35:43Z", "creator": "stevel@apache.org", "creation_time": "2003-05-14T15:35:43Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 19921, "attachment_id": null, "id": 37323, "time": "2003-05-16T13:29:16Z", "creator": "christer.holmer@corustechnologies.com", "creation_time": "2003-05-16T13:29:16Z", "is_private": false, "text": "The escaping works OK for many, but not all scenarios. The replacement of the \nproperties is a useful feature, but it is still a sideeffect, which isn't \ndirectly SQL related. I don't want to remove the feature, I just want to be \nable to turn it off. The proposed change does not break existing code, it is \nbasically just one extra if-statement. If I was to use the escaping strategy, \nthat would mean I had to add a $ just so that ANT can remove it. There are some \nCPU cycles to gain, by doing less.\n\nThe escaping does not work with Oracle wrapped (scrambled code) files. Oracle \nrequires the file to be unmodified, which rules out escaping. SQLExec works \ngreat with Oracle wrapped files (which I think is cool), as long as there are \nno ANT properties. Why not take it all the way?"}, {"count": 3, "tags": [], "text": "\n\n*** This bug has been marked as a duplicate of bug 38546 ***", "attachment_id": null, "id": 129880, "creator": "bodewig@apache.org", "time": "2009-08-24T06:29:47Z", "bug_id": 19921, "creation_time": "2009-08-24T06:29:47Z", "is_private": false}, {"count": 4, "tags": [], "text": "\n\n*** This bug has been marked as a duplicate of bug 38245 ***", "is_private": false, "id": 129882, "creator": "bodewig@apache.org", "time": "2009-08-24T06:30:20Z", "bug_id": 19921, "creation_time": "2009-08-24T06:30:20Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 19921, "attachment_id": null, "text": "No matterh whether I'll get the bug number correct, this has been added in ant 1.7 with svn revision 368466", "id": 129884, "time": "2009-08-24T06:31:35Z", "creator": "bodewig@apache.org", "creation_time": "2009-08-24T06:31:35Z", "is_private": false}]
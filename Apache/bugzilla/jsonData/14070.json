[{"count": 0, "tags": [], "creator": "bjh@capgroup.com", "attachment_id": null, "text": "I have Apache 2.0.42 running on a Windows 2000 machine, configured as a reverse \nproxy with caching, which proxies requests to a WebLogic 7.0 application \nserver.  Here is the configuration:\n\nLoadModule cache_module modules/mod_cache.so\nLoadModule file_cache_module modules/mod_file_cache.so\nLoadModule disk_cache_module modules/mod_disk_cache.so\nLoadModule proxy_module modules/mod_proxy.so\nLoadModule proxy_http_module modules/mod_proxy_http.so\n...\n\n<IfModule mod_cache.c> \n<IfModule mod_disk_cache.c> \nCacheRoot \"C:\\Program Files\\Apache Group\\Apache2\\proxy\"\nCacheSize 2000\nCacheForceCompletion 100\nCacheEnable disk / \nCacheDefaultExpire 3600 \nCacheDirLevels 5\nCacheDirLength 4\nCacheMaxFileSize 1000000\n</IfModule> \n</IfModule>\n\n<IfModule mod_proxy.c>\nProxyRequests Off\nProxyPass / http://localhost:7001/\nProxyPassReverse / http://localhost:7001/\nProxyPreserveHost On\n</IfModule>\n\nWhen I set Last-Modified and Expires headers from a JSP page, the apache \nproxy/cache is able to correctly cache the document (document is served from \ncache instead of the app server until the page expires).  However, when pages \nare larger in size, the application server switches from inline content (with \nspecified Content-Length header) to Transfer-Encoding = chunked (no Content-\nLength header) - when this happens, pages are no longer served from the cache.\n\nHere are what the headers look like (using wfetch.exe utility) when the cache \nworks properly:\n\nHTTP/1.1 200 OK\\r\\n\nDate: Tue, 29 Oct 2002 18:47:55 GMT\\r\\n\nServer: WebLogic WebLogic Server 7.0 SP1  Mon Sep 9 22:46:58 PDT 2002 206753\\r\\n\nExpires: Tue, 29 Oct 2002 18:47:58 GMT\\r\\n\nCache-control: no-cache=\"set-cookie\"\\r\\n\nSet-cookie: JSESSIONID=92Xiyh11NT29ofYs8DpqEIU68JX2OSh4OCttGVE7G4AgxaiVJAO9!\n1062744203;path=/\\r\\n\nLast-Modified: Tue, 29 Oct 2002 18:46:58 GMT\\r\\n\nContent-Type: text/html; charset=ISO-8859-1\\r\\n\nAge: 57047420\\r\\n\nContent-Length: 468\\r\\n\n\\r\\n\n\nHere is what they look like when the cache doesn't serve from cache:\n\nHTTP/1.1 200 OK\\r\\n\nDate: Tue, 29 Oct 2002 18:48:01 GMT\\r\\n\nServer: WebLogic WebLogic Server 7.0 SP1  Mon Sep 9 22:46:58 PDT 2002 206753\\r\\n\nContent-Type: text/html; charset=ISO-8859-1\\r\\n\nExpires: Tue, 29 Oct 2002 18:49:05 GMT\\r\\n\nLast-Modified: Tue, 29 Oct 2002 18:48:05 GMT\\r\\n\nSet-cookie: JSESSIONID=92XlfvInQoNJp0PerCwY31jTjizeDzRA011UvV2RXA4QQDU09fWo!\n1062744203;path=/\\r\\n\nCache-control: no-cache=\"set-cookie\"\\r\\n\nTransfer-Encoding: chunked\\r\\n\n\\r\\n", "id": 25348, "time": "2002-10-29T21:46:05Z", "bug_id": 14070, "creation_time": "2002-10-29T21:46:05Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 14070, "attachment_id": null, "text": "I received a patch from BEA that makes WebLogic disable chunked transfer \nencoding - but the cache still didn't work.  After turning on a higher level of \ndebug info from Apache, one of the log messages led me to the fix, which was to \nse CacheMaxStreamingBuffer to 32767 (default is 0, which means don't cache any \nstreaming content).  Then the cache started working with chunked transfer \nencoded data coming from the application server...still have some intermittent \nproblems, but that's a different issue which I will log if I can isolate it a \nbit further.", "id": 25838, "time": "2002-11-07T00:56:29Z", "creator": "bjh@capgroup.com", "creation_time": "2002-11-07T00:56:29Z", "is_private": false}]
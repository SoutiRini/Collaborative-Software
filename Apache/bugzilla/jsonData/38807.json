[{"attachment_id": null, "tags": [], "bug_id": 38807, "is_private": false, "count": 0, "id": 86300, "time": "2006-02-28T13:44:30Z", "creator": "ats37@hotmail.com", "creation_time": "2006-02-28T13:44:30Z", "text": "I'm using the <sql> task with a fileset to read in a whole bunch of stored proc\ndefinitions into our unit test database prior to running the tests.  Although I\ncould use onerror=\"abort\" (or stop) to make the build fail if there are any\nproblems, this only reports the first file.  What I'd find more useful would be\nto use onerror=\"continue\" in conjunction with an errorproperty attribute (like\nthe junit task has) so that all the errors appear in my log file, but a property\ngets set which I can check later in the build (and either fail or skip the unit\ntests).\nAnd, while I'm wishing, a warningproperty property which gets set if the\nconn.getWarnings() call returns anything in execSQL() might also be useful."}, {"count": 1, "tags": [], "creator": "stevel@apache.org", "attachment_id": null, "text": "I see what you want here andrew, but I'm not sure what we are going to do about\nit. To an extent the error handling of ant is a bit, well, messy; we have\nlimited policy hard coded into the tasks themselves.\n\nTake a look at the ant-contrib project on sf.net, in particular their try/catch\ntask. Then look at <macrodef> and see what it would take to actually implement\nwhat you want in a macro. something like (\n\n<macrodef name=\"mysql\">\n <attribute name=\"errors\"/>\n <attribute name=\"file\" />\n <sequential>\n<trycatch property=\"errormessage\" >\n  <try>\n   <sql >\n    <transaction file=\"@{file}\" />\n   </sql>\n  </try>\n  <catch>\n   <echo level=\"verbose\" >${errormessage}</echo>\n   <property name=\"@{errors}\" value=\"${errormessage}\"/>\n  </catch>\n</trycatch>\n</sequential>\n</macrodef>\n\nIf you fill the <sql> bit in with your DB connection, you get a task you can use\nlike\n <mysql errorproperty=\"errs\" file=\"drop-db.sql\" />\n <mysql errorproperty=\"errs\" file=\"create-db.sql\" />\n <mysql errorproperty=\"errs\" file=\"create-user.sql\" />\n <mysql errorproperty=\"errs\" file=\"populate-db.sql\" />\n\n-steve", "id": 86301, "time": "2006-02-28T14:47:02Z", "bug_id": 38807, "creation_time": "2006-02-28T14:47:02Z", "is_private": false}, {"count": 2, "tags": [], "creator": "ats37@hotmail.com", "is_private": false, "text": "> I see what you want here andrew, but I'm not sure what we are going to do about\n> it. \n\nDoes the attached patch help the decision any? :-)\n\n>To an extent the error handling of ant is a bit, well, messy; we have\n> limited policy hard coded into the tasks themselves.\n> \n> Take a look at the ant-contrib project on sf.net, in particular their try/catch\n> task. Then look at <macrodef> and see what it would take to actually implement\n> what you want in a macro. something like (\n> \n> <macrodef name=\"mysql\">\n>  <attribute name=\"errors\"/>\n>  <attribute name=\"file\" />\n>  <sequential>\n> <trycatch property=\"errormessage\" >\n>   <try>\n>    <sql >\n>     <transaction file=\"@{file}\" />\n>    </sql>\n>   </try>\n>   <catch>\n>    <echo level=\"verbose\" >${errormessage}</echo>\n>    <property name=\"@{errors}\" value=\"${errormessage}\"/>\n>   </catch>\n> </trycatch>\n> </sequential>\n> </macrodef>\n> \n> If you fill the <sql> bit in with your DB connection, you get a task you can use\n> like\n>  <mysql errorproperty=\"errs\" file=\"drop-db.sql\" />\n>  <mysql errorproperty=\"errs\" file=\"create-db.sql\" />\n>  <mysql errorproperty=\"errs\" file=\"create-user.sql\" />\n>  <mysql errorproperty=\"errs\" file=\"populate-db.sql\" />\n\nThat won't work with a fileset, though, will it? (I don't much fancy having to\nadd another line every time there's a new stored proc)  And even if I could come\nup with a similar macro that passed through a fileset, it would still stop after\nthe first sql file & statement that threw an error (at least, the first from\neach call to the macro), instead of dumping all the errors to the log.  Or am I\nmissing something?", "id": 86362, "time": "2006-03-02T02:49:16Z", "bug_id": 38807, "creation_time": "2006-03-02T02:49:16Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Created attachment 17815\nPatch for SQLExec task", "is_private": false, "bug_id": 38807, "id": 86363, "time": "2006-03-02T02:50:28Z", "creator": "ats37@hotmail.com", "creation_time": "2006-03-02T02:50:28Z", "attachment_id": 17815}, {"count": 4, "tags": [], "text": "Created attachment 17822\nPatch for 1.6.x branch\n\nSame patch, backported to ANT_16_BRANCH.", "is_private": false, "id": 86424, "creator": "ats37@hotmail.com", "time": "2006-03-03T02:27:38Z", "bug_id": 38807, "creation_time": "2006-03-03T02:27:38Z", "attachment_id": 17822}, {"count": 5, "tags": [], "text": "svn revision 807228", "is_private": false, "id": 129894, "creator": "bodewig@apache.org", "time": "2009-08-24T07:09:48Z", "bug_id": 38807, "creation_time": "2009-08-24T07:09:48Z", "attachment_id": null}]
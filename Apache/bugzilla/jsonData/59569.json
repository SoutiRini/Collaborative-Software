[{"count": 0, "tags": [], "creator": "batterseapower@hotmail.com", "text": "In org.apache.tomcat.jdbc.pool.DataSourceProxy, isWrapperFor/unwrap always return false/null respectively. This is a spec violation, not least becaues unwrap should throw instead of returning null.\n\nA similar issue affects org.apache.tomcat.jdbc.pool.ProxyConnection.\n\nCorrect implementations of these functions should look something like this (for DataSourceProxy):\n\n   @SuppressWarnings(\"unused\") // Has to match signature in DataSource\n   public boolean isWrapperFor(Class<?> iface) throws SQLException {\n       return poolProperties.getDataSource() instanceof DataSource && ((DataSource)poolProperties.getDataSource()).isWrapperFor(iface);\n   }\n\n\n   @SuppressWarnings(\"unused\") // Has to match signature in DataSource\n   public <T> T unwrap(Class<T> iface) throws SQLException {\n       if (poolProperties.getDataSource() instanceof DataSource) {\n           return ((DataSource)poolProperties.getDataSource()).unwrap(iface);\n       } else {\n           throw new SQLException(\"Not a wrapper for \" + iface);\n       }\n   }\n\nAnd for ProxyConnection:\n\n   public boolean isWrapperFor(Class<?> iface) throws SQLException {\n       if (iface == XAConnection.class && connection.getXAConnection()!=null) {\n           return true;\n       } else {\n           return connection.getConnection().isWrapperFor(iface);\n       }\n   }\n\n\n   public Object unwrap(Class<?> iface) throws SQLException {\n       if (iface == PooledConnection.class) {\n           return connection;\n       }else if (iface == XAConnection.class) {\n           return connection.getXAConnection();\n       } else {\n           return connection.getConnection().unwrap(iface);\n       }\n   }", "id": 191063, "time": "2016-05-18T20:37:10Z", "bug_id": 59569, "creation_time": "2016-05-18T20:37:10Z", "is_private": false, "attachment_id": null}]
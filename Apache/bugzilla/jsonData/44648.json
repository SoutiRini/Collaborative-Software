[{"count": 0, "tags": [], "bug_id": 44648, "attachment_id": null, "id": 114822, "time": "2008-03-20T11:19:58Z", "creator": "neel.goyal@gmail.com", "creation_time": "2008-03-20T11:19:58Z", "is_private": false, "text": "I have a simple module which handles certain urls and then issues a file subrequest based on the url.  I have found this crash with files that are larger than 2^32 bytes.\n\nI stepped into it with MS VS 2005.  The error occurs in byterange_filter.c in the libhttpd component.\n\nLines 266 to 282 execute a do while loop:\n\ndo {\n    apr_bucket *foo;\n    const char *str;\n    apr_size_t len;\n\n    if (apr_bucket_copy(ec, &foo) != APR_SUCCESS) {\n        /* As above; this should not fail since the bucket has\n         * a known length, but just to be sure, this takes\n         * care of uncopyable buckets that do somehow manage\n         * to slip through.  */\n        /* XXX: check for failure? */\n        apr_bucket_read(ec, &str, &len, APR_BLOCK_READ);\n        apr_bucket_copy(ec, &foo);\n    }\n    APR_BRIGADE_INSERT_TAIL(bsend, foo);\n    ec = APR_BUCKET_NEXT(ec);\n} while (ec != e2);\n\nI get a bogus apr_bucket* near the end of the brigade.  It has a null value for the ec->type->copy variable, which is what apr_bucket_copy uses.  A quick change of the while condition to make it:\n\nwhile (ec != e2 && ec->type->copy != NULL) fixed my problem, but I do not think it is the proper thing to do."}, {"count": 1, "tags": [], "bug_id": 44648, "attachment_id": null, "id": 114827, "time": "2008-03-20T13:30:03Z", "creator": "rpluem@apache.org", "creation_time": "2008-03-20T13:30:03Z", "is_private": false, "text": "Can you please try if the following patch from r631559 (http://svn.apache.org/viewvc?view=rev&revision=631559) of apr-util 1.2.x branch fixes your problem?\n\nhttp://svn.apache.org/viewvc/apr/apr-util/branches/1.2.x/buckets/apr_brigade.c?r1=631559&r2=631558&pathrev=631559&view=patch"}, {"count": 2, "tags": [], "creator": "neel.goyal@gmail.com", "attachment_id": null, "text": "The patch fixes my issue.  Thank you very much.", "id": 114922, "time": "2008-03-24T10:28:05Z", "bug_id": 44648, "creation_time": "2008-03-24T10:28:05Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 42285, "attachment_id": null, "id": 102599, "time": "2007-04-28T12:49:39Z", "creator": "john.tracy@covenant.edu", "creation_time": "2007-04-28T12:49:39Z", "is_private": false, "text": "Bug has been reproduced in Apache 2.2.3 and 2.2.4. When we try to authenticate a\nuser against a Windows 2003 LDAP server, we occasionally get an Internal Server\n500, and the error_log shows an entry like this:\n\n[Sat Apr 28 15:42:02 2007] [warn] [client 10.0.15.12] [13775] auth_ldap\nauthenticate: user covenant authentication failed; URI /em/gs\n[ldap_search_ext_s() for user failed][Can't contact LDAP server]\n\nRestarting Apache makes this error go away, or even opening up the .htaccess\nfile and resaving it with vi (making no modifications) will make it go away.\nAlso, when the user click reload within their web browser, it will usually go\naway after two or three reloads.\n\nI've tried using both anonymous binds and authenticated binds and multiple ldap\nservers, and all ultimately exhibit the same 500 Internal Server Error symptoms.\nThe more users using the website, the more frequently this error occurs. I was\ninitially thinking it was related to Apache bug 40878, but the changes proposed\nin it were committed to version 2.2.4, and I still have the same problems.\n\nIt seems to occur when different users authenticate to the given resource--for\nexample if user tracy authenticates successfully and then user john comes next,\nuser john will get the \"500 internal server error\" after being prompted for\nauthentication. After the reloading, the page will come up without being\nreprompted for authentication.\n\nThis is running on Solaris 10, on the Sparc platform.\n\nmod_authnz_ldap internal server 500 ldap_search_ext_s ldap"}, {"count": 1, "tags": [], "bug_id": 42285, "attachment_id": null, "id": 102605, "time": "2007-04-28T19:10:43Z", "creator": "covener@gmail.com", "creation_time": "2007-04-28T19:10:43Z", "is_private": false, "text": "Do you have a packet trace of the communication between Apache and MSAD for one\nof these failures?"}, {"count": 2, "tags": [], "bug_id": 42285, "attachment_id": 20074, "id": 102664, "time": "2007-04-30T08:30:54Z", "creator": "john.tracy@covenant.edu", "creation_time": "2007-04-30T08:30:54Z", "is_private": false, "text": "Created attachment 20074\nPacket capture of traffic between ldap and web server, five failures and one success (at the end)\n\nApache logged this during the failures:\n[Mon Apr 30 09:04:11 2007] [info] Initial (No.1) HTTPS request received for\nchild 8 (server huss.covenant.edu:443)\n[Mon Apr 30 09:04:11 2007] [debug] mod_authnz_ldap.c(870): [24970] auth_ldap\nurl parse:\n`ldap://ldap.covenant.edu:3268/OU=covenant,DC=covenant,DC=edu?sAMAccountName?sub?(objectClass=user)'\n\n[Mon Apr 30 09:04:11 2007] [debug] mod_authnz_ldap.c(879): [24970] auth_ldap\nurl parse: Host: ldap.covenant.edu:3268\n[Mon Apr 30 09:04:11 2007] [debug] mod_authnz_ldap.c(881): [24970] auth_ldap\nurl parse: Port: 3268\n[Mon Apr 30 09:04:11 2007] [debug] mod_authnz_ldap.c(883): [24970] auth_ldap\nurl parse: DN: OU=covenant,DC=covenant,DC=edu\n[Mon Apr 30 09:04:11 2007] [debug] mod_authnz_ldap.c(885): [24970] auth_ldap\nurl parse: attrib: sAMAccountName\n[Mon Apr 30 09:04:11 2007] [debug] mod_authnz_ldap.c(887): [24970] auth_ldap\nurl parse: scope: subtree\n[Mon Apr 30 09:04:11 2007] [debug] mod_authnz_ldap.c(892): [24970] auth_ldap\nurl parse: filter: (objectClass=user)\n[Mon Apr 30 09:04:11 2007] [debug] mod_authnz_ldap.c(972): LDAP: auth_ldap not\nusing SSL connections\n[Mon Apr 30 09:04:11 2007] [debug] mod_authnz_ldap.c(376): [client 10.0.15.12]\n[24970] auth_ldap authenticate: using URL\nldap://ldap.covenant.edu:3268/OU=covenant,DC=covenant,DC=edu?sAMAccountName?sub?(objectClass=user)\n\n[Mon Apr 30 09:04:11 2007] [warn] [client 10.0.15.12] [24970] auth_ldap\nauthenticate: user tracy authentication failed; URI /em/gs [LDAP:\nldap_simple_bind_s() failed][Can't contact LDAP server]\n[Mon Apr 30 09:04:11 2007] [info] [client 10.0.15.12] Connection closed to\nchild 8 with unclean shutdown (server huss.covenant.edu:443)"}, {"count": 3, "tags": [], "text": "The error was actually caused by having multiple ldap libraries installed during\ncompile time. I had at least two different versions of the OpenLDAP libraries\ninstalled and at various points during compiling, it was linking against each. I\nremoved these from the libraries path and compiled directly against the Sun\nSolaris LDAP libraries (--with-ldap-lib=/usr/lib/sparcv9) and everything started\nworking perfectly.", "attachment_id": null, "bug_id": 42285, "id": 102718, "time": "2007-05-01T11:43:18Z", "creator": "john.tracy@covenant.edu", "creation_time": "2007-05-01T11:43:18Z", "is_private": false}]
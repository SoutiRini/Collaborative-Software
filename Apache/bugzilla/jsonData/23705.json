[{"count": 0, "tags": [], "bug_id": 23705, "attachment_id": null, "text": "I have this two files to configure my log4j in a web context, using tomcat \n4.0.6(included in netbeans 3.5) and jdk 1.4.1-b21\n\n\n<!--\n 1.    log4j.xml, in WEB-INF/classes\n->\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n\n<!DOCTYPE log4j:configuration SYSTEM \"log4j.dtd\" [\n  <!ENTITY pool-categories SYSTEM \"pool-categories.ent\">\n]>\n\n<log4j:configuration debug=\"true\">\n\n  <appender name=\"AppenderConsola\" class=\"org.apache.log4j.ConsoleAppender\">\n    <layout class=\"org.apache.log4j.PatternLayout\">\n      <param name=\"ConversionPattern\" value=\"%m%n\"/>\n    </layout>\n  </appender>\n\n  <appender name=\"AppenderTexto\" class=\"org.apache.log4j.RollingFileAppender\">\n    <param name=\"File\" value=\"C:\\\\Archivos de programa\\\\NetBeans IDE 3.5\n\\\\tomcat406\\\\webapps\\\\ipsa\\\\errores\\\\Log.log\" />\n    <layout class=\"org.apache.log4j.PatternLayout\">\n      <param name=\"ConversionPattern\" value=\"%p %c - %m%n\"/>\n    </layout>\n  </appender>\n\n  <appender name=\"AppenderFactor5\" \nclass=\"org.apache.log4j.RollingFileAppender\">\n    <param name=\"File\" value=\"C:\\\\Archivos de programa\\\\NetBeans IDE 3.5\n\\\\tomcat406\\\\webapps\\\\ipsa\\\\errores\\\\LogFactor5.log\" />\n    <param name=\"MaxFileSize\" value=\"500KB\" />\n    <layout class=\"org.apache.log4j.PatternLayout\">\n      <param name=\"ConversionPattern\" value=\"[slf5s.start]%d{yyyy/MM/dd \nHH:mm:ss}[slf5s.DATE]%p[slf5s.PRIORITY]%c[slf5s.CATEGORY]%m[slf5s.MESSAGE]%n\"/>\n    </layout>\n  </appender>\n\n\n  <!-- \n   - Se definen las categorias para el pool.\n  -->\n  &pool-categories;\n\n</log4j:configuration>\n\n\n\n\n<!--\n 2.    pool-categories.ent, in WEB-INF/classes\n->\n\n\n  <category name=\"co.com.winet.util.connpool\">\n    <priority value=\"DEBUG\" />\n    <appender-ref ref=\"AppenderConsola\" /> \n    <appender-ref ref=\"AppenderTexto\" /> \n  </category>\n\n  <category name=\"co.com.winet.util.connpool.ConexionesPool$GeneradorLog\">\n    <priority value=\"DEBUG\" />\n    <appender-ref ref=\"AppenderFactor5\" /> \n  </category>\n\n\n\nThe tomcat console is as follows:\n\n\nStarting service Tomcat-Standalone\nApache Tomcat/4.0.6\nStarting service Tomcat-Apache\nApache Tomcat/4.0.6\nlog4j:ERROR Parsing error on line 0 and column 0\nlog4j:ERROR File \"dummy://log4j.dtdpool-categories.ent\" not found.\nlog4j:ERROR Could not parse input source [org.xml.sax.InputSource@1e4853f].\norg.xml.sax.SAXException: Stopping after fatal error: \nFile \"dummy://log4j.dtdpool-categories.ent\" not found.\n        at org.apache.xerces.framework.XMLParser.reportError\n(XMLParser.java:1245)\n        at \norg.apache.xerces.readers.DefaultEntityHandler.startReadingFromExternalEntity\n(DefaultEntityHandler.java:780)\n        at \norg.apache.xerces.readers.DefaultEntityHandler.startReadingFromEntity\n(DefaultEntityHandler.java:663)\n        at \norg.apache.xerces.framework.XMLDocumentScanner$ContentDispatcher.dispatch\n(XMLDocumentScanner.java:1264)\n        at org.apache.xerces.framework.XMLDocumentScanner.parseSome\n(XMLDocumentScanner.java:381)\n        at org.apache.xerces.framework.XMLParser.parse(XMLParser.java:1098)\n        at org.apache.xerces.jaxp.DocumentBuilderImpl.parse\n(DocumentBuilderImpl.java:195)\n        at org.apache.log4j.xml.DOMConfigurator.doConfigure\n(DOMConfigurator.java:665)\n        at org.apache.log4j.xml.DOMConfigurator.doConfigure\n(DOMConfigurator.java:616)\n        at org.apache.log4j.xml.DOMConfigurator.doConfigure\n(DOMConfigurator.java:602)\n        at org.apache.log4j.helpers.OptionConverter.selectAndConfigure\n(OptionConverter.java:460)\n        at org.apache.log4j.LogManager.<clinit>(LogManager.java:113)\n        at org.apache.log4j.Logger.getLogger(Logger.java:85)\n        at co.com.winet.util.connpool.PoolManager.<clinit>(PoolManager.java:50)\n        ...", "id": 45310, "time": "2003-10-09T18:43:09Z", "creator": "jzulu2000@hotmail.com", "creation_time": "2003-10-09T18:43:09Z", "is_private": false}, {"count": 1, "tags": [], "creator": "mwomack@apache.org", "text": "1.2.12 candidate\n\nIs there a \"simple\" fix that can be applied for this?", "id": 76891, "time": "2005-07-01T19:55:08Z", "bug_id": 23705, "creation_time": "2005-07-01T19:55:08Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 23705, "attachment_id": null, "id": 76899, "time": "2005-07-01T20:29:36Z", "creator": "carnold@apache.org", "creation_time": "2005-07-01T20:29:36Z", "is_private": false, "text": "I'll take this one.  I fixed a similar issue with the JoranConfigurator.  The problem is that the call to the \nparser used an InputStream (just a series of bytes) instead of an InputSource, URL or a File which would \nprovide both the sequence of bytes and a base for resolving relative URL's. "}, {"count": 3, "tags": [], "creator": "carnold@apache.org", "attachment_id": null, "id": 77311, "time": "2005-07-14T23:45:47Z", "bug_id": 23705, "creation_time": "2005-07-14T23:45:47Z", "is_private": false, "text": "The problem had been fixed as part of the Joran development on the CVS HEAD, but there were no tests \nfor it.  The fix for this bug added DOMTest::test4 to both the CVS HEAD and v1.2_branch to check for \nthe proper handling of external entities.\n\nThe fix on the v1.2 branch is mimicked the approach in the Joran configuration by introducing a \ndelegate that is called to actually perform the parsing.  The original approach was to create an \nInputSource. Since there is no clean way prior to create a URL for an arbitrary file prior to JDK 1.4, the \nInputSource would not have a valid URL and attempts to resolve entities relative to the InputSource \nwould fail.  Using the delegate, the parser can be passed a File which it knows how to use to resolve \nrelative URL's.\n\nThe change should not change any successful call to DOMConfigurator.  For most error conditions, the \nchange should only result in improved diagnostic messages since the parser now knows more about \nthe source and has more robust error reporting code than we had.  If there are multiple error \nconditions, the change may affect which one gets reported.  For example, if there is no XML parser \navailable and the configuration file does not exist, the original code will report the missing file and the \nnew code will report the missing parser.\n"}]
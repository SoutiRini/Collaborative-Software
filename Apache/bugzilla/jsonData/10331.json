[{"count": 0, "tags": [], "bug_id": 10331, "text": "this is the scenario:\nAll am trying to do is put a 'HttpServletResponse' object in a vector, wait a \nrandom amount of time, get the object from the vector, get a 'PrintWriter' \nobject from the 'HttpServletResponse' object and write a response back.\n\nThe error occurs when I try to get the 'PrintWriter' object.\n\nBelow is the code and the error:\n\npublic class testServ extends HttpServlet implements Runnable\n{\n\n  public Vector pendingReqs = new Vector();\n  private Thread kicker = new Thread(this);\n\n  ....\n  ...\n  public void doGet(HttpServletRequest req, HttpServletResponse resp)\n\tthrows ServletException, java.io.IOException\n  {\n    pendingReqs.addElement(resp);\n    try\n    {\n\tkicker.sleep(5000);\n    }\n    catch(InterruptedException ie){}\n    try\n    {\n      resp.setContentType(\"text/plain\");\n      PrintWriter out = resp.getWriter();\n      out.println(s);\n      out.flush();\n    }\n    catch(UnsupportedEncodingException use)\n    {\nSystem.out.println(\"UnsupportedEncodingException: \" + use.getMessage());\n    }\n    catch(IllegalStateException ise)\n    {\nSystem.out.println(\"IllegalStateException: \" + ise.getMessage());\n    }\n    catch(IOException ioe)\n    {\nSystem.out.println(\"IOException: \" + ioe.getMessage());\n    }\n  }\n\n}\n\nERROR:\njava.lang.NullPointerException\n        at org.apache.catalina.connector.http.HttpResponseStream.checkHead(HttpR\nesponseStream.java:253)\n        at org.apache.catalina.connector.http.HttpResponseStream.<init>(HttpResp\nonseStream.java:104)\n        at org.apache.catalina.connector.http.HttpResponseImpl.createOutputStrea\nm(HttpResponseImpl.java:220)\n        at org.apache.catalina.connector.ResponseBase.getWriter(ResponseBase.jav\na:758)\n        at org.apache.catalina.connector.ResponseFacade.getWriter(ResponseFacade\n.java:165)", "id": 18729, "time": "2002-06-28T16:50:25Z", "creator": "cyrus@microaut.com", "creation_time": "2002-06-28T16:50:25Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 10331, "text": "It is not valid to reference the request or response object that the servlet\ncontainer passes you outside the context of the service() method on the original\nrequest processing thread.\n", "id": 18739, "time": "2002-06-28T17:57:48Z", "creator": "craig.mcclanahan@sun.com", "creation_time": "2002-06-28T17:57:48Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "cyrus@microaut.com", "attachment_id": null, "text": "Actually, I missed some code in my previous listing.\n\npublic class testServ extends HttpServlet implements Runnable\n{\n\n  public Vector pendingReqs = new Vector();\n  private Thread kicker = new Thread(this);\n\n  ....\n  ...\n  public void doGet(HttpServletRequest req, HttpServletResponse resp)\n\tthrows ServletException, java.io.IOException\n  {\n    pendingReqs.addElement(resp);\n    try\n    {\n\tkicker.sleep(5000);\n    }\n    catch(InterruptedException ie){}\n    try\n    {\n      if(pendingReqs.size() > 0)\n      {\n\tHttpServletResponse httpResp = \n           (HttpServletResponse)pendingReqs.remove(0);\n\n      httpResp .setContentType(\"text/plain\");\n      PrintWriter out = httpResp .getWriter();\n      out.println(s);\n      out.flush();\n      }\n    }\n    catch(UnsupportedEncodingException use)\n    {\nSystem.out.println(\"UnsupportedEncodingException: \" + use.getMessage());\n    }\n    catch(IllegalStateException ise)\n    {\nSystem.out.println(\"IllegalStateException: \" + ise.getMessage());\n    }\n    catch(IOException ioe)\n    {\nSystem.out.println(\"IOException: \" + ioe.getMessage());\n    }\n  }\n\n}\n\nERROR:\njava.lang.NullPointerException\n        at org.apache.catalina.connector.http.HttpResponseStream.checkHead(HttpR\nesponseStream.java:253)\n        at org.apache.catalina.connector.http.HttpResponseStream.<init>(HttpResp\nonseStream.java:104)\n        at org.apache.catalina.connector.http.HttpResponseImpl.createOutputStrea\nm(HttpResponseImpl.java:220)\n        at org.apache.catalina.connector.ResponseBase.getWriter(ResponseBase.jav\na:758)\n        at org.apache.catalina.connector.ResponseFacade.getWriter(ResponseFacade\n.java:165)", "id": 18741, "time": "2002-06-28T18:17:36Z", "bug_id": 10331, "creation_time": "2002-06-28T18:17:36Z", "is_private": false}, {"count": 3, "tags": [], "text": "Your extra code does not matter -- your code is still violating the servlet spec\nrestrictions on accessing the response object from one thread in another thread.\n   Your expectation that this is ever going to work is incorrect.\n", "attachment_id": null, "id": 18742, "creator": "craig.mcclanahan@sun.com", "time": "2002-06-28T18:23:52Z", "bug_id": 10331, "creation_time": "2002-06-28T18:23:52Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "dopey@moonteeth.com", "attachment_id": null, "text": "This results in Apache 2.2.9 failing to load apr-util-1/apr_ldap-1.so when required in a bindist situation.  I think the built in envvars generation needs to handle this additional directory.", "id": 118204, "time": "2008-07-02T15:45:35Z", "bug_id": 45327, "creation_time": "2008-07-02T15:45:35Z", "is_private": false}, {"text": "i left the platform as linux, but we've confirmed the library load problem on solaris and linux, and at least visually the library structure and envvars LIBPATH variable show the same characteristics on AIX.", "tags": [], "creator": "dopey@moonteeth.com", "attachment_id": null, "count": 1, "id": 118205, "time": "2008-07-02T15:47:51Z", "bug_id": 45327, "creation_time": "2008-07-02T15:47:51Z", "is_private": false}, {"count": 2, "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "text": "I doubt there is a one-size-fits-all solution here.\n\n1) using \"$ORIGIN/lib/apr-util-1/blah.so\" as the path rather than a hard-coded \nabsolute string would allow a relocatable binary with many ELF dynamic linkers. This would still allow bin/httpd to work if invoked directly\n\n2) using a relative filename like \"apr-util-1/blah.so\" as the path would allow a relocatable binary with (I think) a wider range of linkers, but would mean bin/httpd could not be invoked directly, only via apachectl\n\n3) if your complaint is specifically about the binary builds created by the shipped binbuild script, that should simply turn off the DSO support in apr-util; arguably it should be off by default", "id": 118282, "time": "2008-07-04T02:56:34Z", "bug_id": 45327, "creation_time": "2008-07-04T02:56:34Z", "is_private": false}, {"count": 3, "tags": [], "creator": "dopey@moonteeth.com", "attachment_id": null, "text": "--disable-util-apr does indeed work wonderfully.\n\nBased on the apache-dev thread about this issue, it's possible that the APR devs might decide to revisit it so I'm marking this as an APR bug.  Feel free to close as I agree with Joe that a redistributable bindist apache should just use --disable-util-apr.", "id": 118392, "time": "2008-07-08T09:12:34Z", "bug_id": 45327, "creation_time": "2008-07-08T09:12:34Z", "is_private": false}, {"count": 4, "attachment_id": null, "bug_id": 45327, "text": "oops\n--disable-util-dso i mean.", "id": 118394, "time": "2008-07-08T09:31:25Z", "creator": "dopey@moonteeth.com", "creation_time": "2008-07-08T09:31:25Z", "tags": [], "is_private": false}, {"text": "Have you tried setting APR_DSOPATH in your environment? If you do that, does it still fail to load apr-util-1/apr_ldap-1.so?", "tags": [], "creator": "bojan@rexursive.com", "attachment_id": null, "count": 5, "id": 118434, "time": "2008-07-09T14:46:51Z", "bug_id": 45327, "creation_time": "2008-07-09T14:46:51Z", "is_private": false}, {"count": 6, "tags": [], "creator": "bojan@rexursive.com", "attachment_id": null, "text": "Sorry, that would be LD_LIBRARY_PATH on Linux and most likely something else on some other platforms. APR_DSOPATH is a macro.", "id": 118435, "time": "2008-07-09T14:51:10Z", "bug_id": 45327, "creation_time": "2008-07-09T14:51:10Z", "is_private": false}, {"count": 7, "tags": [], "creator": "dopey@moonteeth.com", "attachment_id": null, "text": "\"I think the built in envvars generation needs\nto handle this additional directory.\"\n\nSorry I wasn't clear.  The above statement was meant to state that I added the apache_home/lib/apr-util-1 directory to the LD_LIBRARY_PATH in the envvars script and it did indeed work.  However, currently the apache build doesn't populate this into the envvars directory, which is why I filed this bug.\n", "id": 118438, "time": "2008-07-09T21:14:23Z", "bug_id": 45327, "creation_time": "2008-07-09T21:14:23Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 45327, "attachment_id": null, "id": 118439, "time": "2008-07-09T21:20:01Z", "creator": "bojan@rexursive.com", "creation_time": "2008-07-09T21:20:01Z", "is_private": false, "text": "OK, thanks for that. So, that part of the search mechanism works.\n\nThe other part is related to APU_DSO_LIBDIR, which gets defined as $libdir/apr-util-1. Could you go into your apr-util source directory and grep APU_DSO_LIBDIR in config.log?"}, {"count": 9, "tags": [], "creator": "dopey@moonteeth.com", "attachment_id": null, "text": "APU_DSO_LIBDIR appears in\napr-util/config.log:  APU_DSO_LIBDIR='${libdir}/apr-util-1'\n\nand of course apr-util/Makefile: APU_DSO_LIBDIR = ${libdir}/apr-util-1", "id": 118486, "time": "2008-07-10T09:49:11Z", "bug_id": 45327, "creation_time": "2008-07-10T09:49:11Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 45327, "text": "I get this on my test build of apr-util (current tip of the 1.3.x branch):\n------------------\n$ grep APU_DSO_LIBDIR config.log \nAPU_DSO_LIBDIR='${libdir}/apr-util-1'\n#define APU_DSO_LIBDIR \"/home/groups/devel/run/apache/lib/apr-util-1\"\n------------------\n\nIt is that macro that is added to the list gotten from LD_LIBRARY_PATH (if any) and then searched. This then ends up here:\n------------------\n$ grep APU_DSO_LIBDIR include/private/apu_config.h\n#define APU_DSO_LIBDIR \"/home/groups/devel/run/apache/lib/apr-util-1\"\n------------------\n\nSo, as long as your ${libdir} is pointing to the right place during build time, you should be OK. I am not sure why you don't get that #define...", "id": 118507, "time": "2008-07-10T15:03:10Z", "creator": "bojan@rexursive.com", "creation_time": "2008-07-10T15:03:10Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "creator": "dopey@moonteeth.com", "attachment_id": null, "text": "Oh, I'm sorry, I didn't understand exactly where you were going so I only pasted APU_DSO_LIBDIR=.\n\nfgrep APU_DSO_LIBDIR config.log\nAPU_DSO_LIBDIR='${libdir}/apr-util-1'\n#define APU_DSO_LIBDIR \"/opt/ptc/apache2.2/lib/apr-util-1\"\n\nHowever, that doesn't work in the relocated scenario I'm referring to.  It only works if you always install into the --prefix=blahblahblah build location.\n\nThe problem is, we are rebuilding and redistributing Apache, so the --prefix location can't be guaranteed to always be the install location.  See this e-mail message from Bill Rowe for a good summary of the exact problem.\n\nhttp://www.mail-archive.com/dev@httpd.apache.org/msg41176.html\n\nSo we have two options:\n1) fix for the bindist script and configure script to include APU_DSO_LIBDIR in the share library path environment variable (LD_LIBRARY_PATH, LIBPATH, SHLIB_PATH depending on platform)\n2) Or the suggestion from Joe about in Comment #2 about just disabling apr-util DSO support which makes the most sense.  Only reason I reassigned this bug to APR was based on the e-mail thread above, it seems like maybe the apache folk would want to visit this bug and come up with the perfect solution for all worlds :).", "id": 118508, "time": "2008-07-10T15:18:20Z", "bug_id": 45327, "creation_time": "2008-07-10T15:18:20Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 45327, "text": "Commenting on Bill's comment:\n\n\"In the long term, we have to fix apr-util, really not httpd's problem,\nto teach apr-util's apu_dso to hunt in each shlibpath dir and its\napr-1-config subdir.\"\n\nAnd your reply:\n\n\"Ahh I see. So your thoughts are to fix the bindist relocation problem, having apr-util look in all the shlibpath dirs to find apr-util-1/* would be the solution.\"\n\nWe can teach APU to do this easily. I'll have a patch for you to test soon.\n", "id": 118510, "time": "2008-07-10T15:32:02Z", "creator": "bojan@rexursive.com", "creation_time": "2008-07-10T15:32:02Z", "is_private": false, "attachment_id": null}, {"count": 13, "tags": [], "bug_id": 45327, "text": "Created attachment 22243\nAdd apr-util-APU_MAJOR_VERSION to DSO search patch\n\nDoes this help you?", "id": 118521, "time": "2008-07-10T16:05:25Z", "creator": "bojan@rexursive.com", "creation_time": "2008-07-10T16:05:25Z", "is_private": false, "attachment_id": 22243}, {"count": 14, "tags": [], "creator": "bojan@rexursive.com", "attachment_id": 22243, "text": "Comment on attachment 22243\nAdd apr-util-APU_MAJOR_VERSION to DSO search patch\n\nAh, not quite. Let me rework that a bit...", "id": 118528, "time": "2008-07-10T16:15:09Z", "bug_id": 45327, "creation_time": "2008-07-10T16:15:09Z", "is_private": false}, {"count": 15, "tags": [], "bug_id": 45327, "attachment_id": null, "id": 118530, "time": "2008-07-10T16:23:06Z", "creator": "wrowe@apache.org", "creation_time": "2008-07-10T16:23:06Z", "is_private": false, "text": "Reviewing the not-quite-right patch, you are headed in the same direction I was\nthinking, so I suspect we are on the right track :)\n\nReassigning to APR, do NOT change the product without flipping the assigned\nbug list address"}, {"count": 16, "tags": [], "bug_id": 45327, "text": "Created attachment 22244\nAdd apr-util-APU_MAJOR_VERSION to DSO search patch\n\nThis should work. No, really - it should :-)", "id": 118531, "time": "2008-07-10T16:30:38Z", "creator": "bojan@rexursive.com", "creation_time": "2008-07-10T16:30:38Z", "is_private": false, "attachment_id": 22244}, {"count": 17, "tags": [], "bug_id": 45327, "text": "Sorry about that Bill - I must have clicked something wrong on the form by accident.", "id": 118532, "time": "2008-07-10T16:31:56Z", "creator": "bojan@rexursive.com", "creation_time": "2008-07-10T16:31:56Z", "is_private": false, "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 45327, "text": "Trunk r675816. 1.3.x r675817.", "id": 118533, "time": "2008-07-10T17:27:10Z", "creator": "bojan@rexursive.com", "creation_time": "2008-07-10T17:27:10Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "bug_id": 45327, "attachment_id": null, "id": 118662, "time": "2008-07-14T14:54:45Z", "creator": "bojan@rexursive.com", "creation_time": "2008-07-14T14:54:45Z", "is_private": false, "text": "Closing, given that fix is now committed. If the fix doesn't quite work for you, please reopen."}]
[{"text": "When using DBAppender with the jTDS driver, it gave the following error: \n\njava.sql.SQLException: No current row in the ResultSet. \nat net.sourceforge.jtds.jdbc.JtdsResultSet.getColumn(JtdsResultSet.java:269) \nat net.sourceforge.jtds.jdbc.JtdsResultSet.getInt(JtdsResultSet.java:630) \nat org.apache.log4j.db.DBAppender.append(DBAppender.java:226) \nat org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:239) \nat\norg.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:67)\n\nat org.apache.log4j.Category.callAppenders(Category.java:219) \nat org.apache.log4j.Category.forcedLog(Category.java:588) \nat org.apache.log4j.Category.log(Category.java:1169) \nat org.apache.commons.logging.impl.Log4JLogger.info(Log4JLogger.java:135) \n \nThe jTDS developer believe that it's a bug in DBAppender with the following comment:\n\nMoving on to the error itself it's indeed caused by DBAppender. It tries to\nretrieve auto generated keys although it didn't request them in the first place:\nit calls prepareStatement(String) instead of prepareStatement(String, int),\nwhich is needed if auto generated keys are to be retrieved. A second problem is\nthat it doesn't even check whether ResultSet.next() returned true or not and it\njust goes for the value which isn't there. Here's the code in question: \n \nhttp://fisheye.cenqua.com/viewrep/jakarta/jakarta-log4j/src/java/org/apache/log4j/db/DBAppender.java?r=1.17&k=\n\n\nFor more information, please refer to:\n\nhttp://sourceforge.net/forum/forum.php?thread_id=1377897&forum_id=104389\n\nURL of jTDS: http://jtds.sourceforge.net/", "tags": [], "creator": "gingming@hotmail.com", "attachment_id": null, "count": 0, "id": 82111, "time": "2005-11-03T23:15:41Z", "bug_id": 37349, "creation_time": "2005-11-03T23:15:41Z", "is_private": false}, {"text": "Here is what I have found when I experienced the same problem.  I don't think\nthis is a bug in the DBAppender:\n\nAfter tracing through the code, it also supports the getGeneratedKeys method...\nsort of. They have provided an implementation of getGeneratedKeys that simply\nreturns a dummy resultset.  I'm not sure there's anything that can be done about\nthis until their implementation is fixed, aside from removing the dependency on\n\"getGeneratedKeys\", which seems like it would take a lot of refactoring.\n    \n    Exception: java.sql.SQLException: No current row in the ResultSet. \n    Line# 268 of DBAppender\n    Explanation: DBAppender successfully invokes getGeneratedKeys method on the\nStatement implementation class, but fail to get the actual generated value from\nthe resultset, cause it seems the returned resultset is a fake (empty) one     \n (according to the sources comments in JtdsStatement class)\n\n\n(In reply to comment #0)\n> When using DBAppender with the jTDS driver, it gave the following error: \n> \n> java.sql.SQLException: No current row in the ResultSet. \n> at net.sourceforge.jtds.jdbc.JtdsResultSet.getColumn(JtdsResultSet.java:269) \n> at net.sourceforge.jtds.jdbc.JtdsResultSet.getInt(JtdsResultSet.java:630) \n> at org.apache.log4j.db.DBAppender.append(DBAppender.java:226) \n> at org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:239) \n> at\n>\norg.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:67)\n> \n> at org.apache.log4j.Category.callAppenders(Category.java:219) \n> at org.apache.log4j.Category.forcedLog(Category.java:588) \n> at org.apache.log4j.Category.log(Category.java:1169) \n> at org.apache.commons.logging.impl.Log4JLogger.info(Log4JLogger.java:135) \n>  \n> The jTDS developer believe that it's a bug in DBAppender with the following\ncomment:\n> \n> Moving on to the error itself it's indeed caused by DBAppender. It tries to\n> retrieve auto generated keys although it didn't request them in the first place:\n> it calls prepareStatement(String) instead of prepareStatement(String, int),\n> which is needed if auto generated keys are to be retrieved. A second problem is\n> that it doesn't even check whether ResultSet.next() returned true or not and it\n> just goes for the value which isn't there. Here's the code in question: \n>  \n>\nhttp://fisheye.cenqua.com/viewrep/jakarta/jakarta-log4j/src/java/org/apache/log4j/db/DBAppender.java?r=1.17&k=\n> \n> \n> For more information, please refer to:\n> \n> http://sourceforge.net/forum/forum.php?thread_id=1377897&forum_id=104389\n> \n> URL of jTDS: http://jtds.sourceforge.net/", "tags": [], "creator": "jonathan.beer@gmail.com", "attachment_id": null, "count": 1, "id": 86649, "time": "2006-03-09T17:39:59Z", "bug_id": 37349, "creation_time": "2006-03-09T17:39:59Z", "is_private": false}, {"count": 2, "tags": [], "creator": "tim.mcnamara@gmail.com", "is_private": false, "text": "Both comments are correct: there is a bug in both the jTDS driver and\nDBAppender.  When using the Microsoft SQL Server 2005 JDBC Driver, without using\nconnection.prepareStatement(insertSQL, Statement.RETURN_GENERATED_KEYS) causes a\nSQLException\n\n(In reply to comment #0)\n> When using DBAppender with the jTDS driver, it gave the following error: \n> \n> java.sql.SQLException: No current row in the ResultSet. \n> at net.sourceforge.jtds.jdbc.JtdsResultSet.getColumn(JtdsResultSet.java:269) \n> at net.sourceforge.jtds.jdbc.JtdsResultSet.getInt(JtdsResultSet.java:630) \n> at org.apache.log4j.db.DBAppender.append(DBAppender.java:226) \n> at org.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:239) \n> at\n>\norg.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:67)\n> \n> at org.apache.log4j.Category.callAppenders(Category.java:219) \n> at org.apache.log4j.Category.forcedLog(Category.java:588) \n> at org.apache.log4j.Category.log(Category.java:1169) \n> at org.apache.commons.logging.impl.Log4JLogger.info(Log4JLogger.java:135) \n>  \n> The jTDS developer believe that it's a bug in DBAppender with the following\ncomment:\n> \n> Moving on to the error itself it's indeed caused by DBAppender. It tries to\n> retrieve auto generated keys although it didn't request them in the first place:\n> it calls prepareStatement(String) instead of prepareStatement(String, int),\n> which is needed if auto generated keys are to be retrieved. A second problem is\n> that it doesn't even check whether ResultSet.next() returned true or not and it\n> just goes for the value which isn't there. Here's the code in question: \n>  \n>\nhttp://fisheye.cenqua.com/viewrep/jakarta/jakarta-log4j/src/java/org/apache/log4j/db/DBAppender.java?r=1.17&k=\n> \n> \n> For more information, please refer to:\n> \n> http://sourceforge.net/forum/forum.php?thread_id=1377897&forum_id=104389\n> \n> URL of jTDS: http://jtds.sourceforge.net/", "id": 88705, "time": "2006-05-01T19:48:24Z", "bug_id": 37349, "creation_time": "2006-05-01T19:48:24Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "This bug was reported against 1.3 which has been discontinued.  Is this also an issue with the latest 1.2 release?  If not, it may be appropriate to close this bug with WONTFIX or similar.", "attachment_id": null, "id": 118210, "creator": "thorbjoern@gmail.com", "time": "2008-07-02T17:07:12Z", "bug_id": 37349, "creation_time": "2008-07-02T17:07:12Z", "is_private": false}, {"text": "No response within a month.  Changing to NEEDINFO.", "tags": [], "creator": "thorbjoern@gmail.com", "attachment_id": null, "count": 4, "id": 119260, "time": "2008-08-02T10:23:24Z", "bug_id": 37349, "creation_time": "2008-08-02T10:23:24Z", "is_private": false}, {"count": 5, "tags": [], "text": "I can recreate the error with: \n    log4j-all-1.3alpha-8.jar. \n\n\nWhen I change to the following: \n    log4j-1.2.14.jar\n    apache-log4j-receivers-1.0-SNAPSHOT.jar\n    apache-log4j-extras-1.0.jar\n    apache-log4j-component-1.0-SNAPSHOT.jar\n\nI get:\n    The content of element type \"appender\" must match \"(errorHandler?,param*,layout?,filter*,appender-ref*)\".\n\nsame xml file. \n", "is_private": false, "id": 119953, "creator": "patschwarz@mt.gov", "time": "2008-08-20T10:44:18Z", "bug_id": 37349, "creation_time": "2008-08-20T10:44:18Z", "attachment_id": null}, {"count": 6, "tags": [], "text": "I have done the latest build of log4j and the issue I reported earlier clears up:\n    log4j-1.2.16-SNAPSHOT.jar\n\nEverything seems to work fine and data is getting logged to the database via JNDI connection. ", "attachment_id": null, "id": 119957, "creator": "patschwarz@mt.gov", "time": "2008-08-20T12:53:06Z", "bug_id": 37349, "creation_time": "2008-08-20T12:53:06Z", "is_private": false}]
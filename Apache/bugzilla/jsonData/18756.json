[{"count": 0, "tags": [], "bug_id": 18756, "text": "Hi all,\n\nI just upgraded my 2.0.44 apache to 2.0.45 due to the last security warning.\n\nUnfortunatly, everytime I'm trying to access to a page protected by LDAP, the \nchild crash : The error log says \n\n[Mon Apr 07 12:08:30 2003] [notice] child pid 23255 exit signal Bus error (10)\n\nMy .htaccess is :\n\nAuthName \"Protected\"\nAuthType Basic\n\nAuthLDAPURL \"ldap://ldapmain.mydomain.com \nldapsecond.mydomain.com/ou=people,dc=mycompany,dc=com?uid?sub\"\nrequire valid-user\n\nIt seems it fails only when the authentification succeed (because w/ a wrong \ninformation, the authentification is reasked and the \"access denied page\" is \ndisplayed w/o problem).\n\nSame behaviour on both HP-UX 10.20 and 11 :-(\n\nCompiled using :\n\n./configure --with-mpm=prefork -with-ldap --enable-ldap --enab\nle-auth-ldap --enable-info --enable-cgi --enable-expires --enable-so\n\nI have reinstalled 2.0.44 ...\n\nBye\n\nLaurent", "id": 34616, "time": "2003-04-07T10:39:30Z", "creator": "l_faillie@yahoo.com", "creation_time": "2003-04-07T10:39:30Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 18756, "text": "I have almost the same issue on Win32 -- at least when using Microsoft's LDAP \n(which is the default).  The difference: I get a crash on failed authentication \nchallenges too...", "id": 35056, "time": "2003-04-12T12:44:55Z", "creator": "jessh@ptc.com", "creation_time": "2003-04-12T12:44:55Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 18756, "attachment_id": null, "is_private": false, "id": 35967, "time": "2003-04-24T10:03:02Z", "creator": "dbb@st-andrews.ac.uk", "creation_time": "2003-04-24T10:03:02Z", "text": "\n\nI've the same problem on Solaris.\n\n\n2.0.44 and 2.0.43 seem ok, but if you look at http://servername/ldap-status on \nthese builds it says ldap cache is disabled.\n\n\n\n\nUsing OpenLdap libraries 2.1.8 originally, upgraded to 2.1.17, gives no change.\n\n\n\n\n2.0.45 core dumps with Bus Error or Seg Fault when asking for a page (seems to \ndo it every request)  I've tested on Suse linux and it segfaults far less \nfrequently, <10 times for 5000 hits. I've set up an LDAP server with 5000 dummy \nusers and a script to use wget to ask for an authenticated page using different \nusers.\n\n\n\n\nConfigure options were \n\n\n./configure --prefix=/opt/apache/httpd/2.0.44 --with-ssl=/opt/SSL/default \n--enable-so --enable-ssl --enable-auth-ldap --with-ldap --enable-ldap \n--enable-proxy --sysconfdir=/etc/apache2/conf --with-ldap-include=/opt/ldap/2.1.\n8/include --with-ldap-lib=/opt/ldap/2.1.8/lib --enable-rewrite \n\n\n\n\nThough I've removed everything but the ldap flags and still get the same \nproblem.  Tried removing the ldap module and using the mod_auth_ldap from www.\nmuquit.com - works fine, but I don't want to have to get my users to change all \ntheir access files :)\n"}, {"count": 3, "tags": [], "text": "Hmmm...\n\nMy problem on Windows went away when I installed and used the latest MSVC++\nService Pack and the latest Microsoft Platform SDK.\n\nI had the LDAP modules working fine on Solaris at 2.0.43, but have not tried\nthem since (as the motivation to move to Apache 2 is not as great on UNIX).\n\nFor those trying 2.0.45 on HP you may be interested to note that HP now provides\na 2.0.45 build for their platform with an LDAP module, though I'm not sure which\none...", "is_private": false, "bug_id": 18756, "id": 35985, "time": "2003-04-24T14:30:53Z", "creator": "jessh@ptc.com", "creation_time": "2003-04-24T14:30:53Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "Hello,\n\n> For those trying 2.0.45 on HP you may be interested to note that HP now \nprovides\n> a 2.0.45 build for their platform with an LDAP module, though I'm not \nsure which one...\n\nI only use source tarball because I use several architectures (Sparc64/Solaris,\nSparc/NetBSD, HP-UX) and don't want to have many different customised version of\napache flying around. Anyway, I will check if HP has made some modification\nabout this problem ... I hope, if they found something, they have warn apache team.\n\nBye\n\nLaurent", "id": 36163, "time": "2003-04-26T10:22:05Z", "creator": "l_faillie@yahoo.com", "creation_time": "2003-04-26T10:22:05Z", "is_private": false}, {"count": 5, "tags": [], "text": "I have since learned that HP's 2.0.45 still contains their own port of auth_ldap\nto Apache 2.0 from 1.3, unfortunately.\n\nI'm guessing they'll jump to the normal Apache modules one of these days... ", "is_private": false, "id": 36235, "creator": "jessh@ptc.com", "time": "2003-04-28T14:07:07Z", "bug_id": 18756, "creation_time": "2003-04-28T14:07:07Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 18756, "is_private": false, "count": 6, "id": 36284, "time": "2003-04-29T13:11:44Z", "creator": "dxmwml@rit.edu", "creation_time": "2003-04-29T13:11:44Z", "text": "I successfully installed Apache 2.0.45 with mod_auth_ldap and mod_ldap using\nthe openldap 2.1.17 SDK and openSSL.\n\nI created a test directory with the following .htaccess file:\n\nAuthName \"Test\"\nAuthType Basic\nAuthLDAPURL \"ldap://ldap.rit.edu:389/o=University Name, st=New\nYork, c=US?uid\"\nrequire valid-user\n\nWhen trying to access the directory I get prompted for username & password\n(as I should) but then I get a page cannot be displayed error (I know there\nis no problem with the page) no matter what i type in.\n\n\nI checked the Apache error log and this is what I see:\n\n[Mon Apr 21 12:45:17 2003] [notice] child pid 22179 exit signal Bus error\n(10)\n[Mon Apr 21 12:45:17 2003] [notice] child pid 22166 exit signal Bus error\n(10)\n[Mon Apr 21 12:51:12 2003] [notice] child pid 22182 exit signal Bus error\n(10)\n[Mon Apr 21 12:55:42 2003] [notice] child pid 22169 exit signal Bus error\n(10)\n[Mon Apr 21 12:55:42 2003] [notice] child pid 22180 exit signal Bus error\n(10)\n[Mon Apr 21 12:56:56 2003] [notice] child pid 22224 exit signal Bus error\n(10)\n[Mon Apr 21 12:56:56 2003] [notice] child pid 22223 exit signal Bus error\n(10)\n\n\nThank you very much,\n\nDamian Marinaccio\nRochester Institute of Technology\nRIT Library\n585-475-7741\ndxmwml@rit.edu\n"}, {"count": 7, "tags": [], "bug_id": 18756, "attachment_id": null, "is_private": false, "id": 37352, "time": "2003-05-16T17:59:39Z", "creator": "erik@codefaktor.de", "creation_time": "2003-05-16T17:59:39Z", "text": "*** Bug 19820 has been marked as a duplicate of this bug. ***"}, {"count": 8, "tags": [], "text": "*** Bug 19993 has been marked as a duplicate of this bug. ***", "is_private": false, "id": 37354, "creator": "erik@codefaktor.de", "time": "2003-05-16T18:00:08Z", "bug_id": 18756, "creation_time": "2003-05-16T18:00:08Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 18756, "attachment_id": 6512, "id": 37850, "time": "2003-05-27T15:46:58Z", "creator": "max@faidor.de", "creation_time": "2003-05-27T15:46:58Z", "is_private": false, "text": "Created attachment 6512\nTermporary work-around"}, {"count": 10, "tags": [], "bug_id": 18756, "is_private": false, "text": "I have tried the suggestion for the workaround, but it only work for the first \nconnection, subsequent requests returned a failed id.\n\nI am using apache 2.0.46, netscape ldap sdk, on solaris.", "id": 38746, "time": "2003-06-12T02:36:01Z", "creator": "leesaikc@hq.psa.com.sg", "creation_time": "2003-06-12T02:36:01Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "I have the bug on apache to 2.0.46 on win2k (standard binary distribution) \nwhile binding to an AD on a win2k server.\n\nThe error log contains :\n[Fri Jun 20 10:49:02 2003] [notice] Parent: child process exited with status \n3221225477 -- Restarting.\n\nThis error occurs when I first to access a protected page.\n\nThe only workaround was to use the mod_auth_ldap from www.muquit.com. It works \nworks but I'd like to use the standard one, not using IPlanet libraries!", "attachment_id": null, "id": 39145, "creator": "bertrand_patrice@hotmail.com", "time": "2003-06-20T09:41:43Z", "bug_id": 18756, "creation_time": "2003-06-20T09:41:43Z", "is_private": false}, {"count": 12, "tags": [], "text": "I forgot to say that the bug happens with 2.0.44 too.", "is_private": false, "bug_id": 18756, "id": 39146, "time": "2003-06-20T09:45:28Z", "creator": "bertrand_patrice@hotmail.com", "creation_time": "2003-06-20T09:45:28Z", "attachment_id": null}, {"count": 13, "tags": [], "text": "It doesn't seem like the developers who made all those changes to auth_ldap \nfor version 2.0.45 tested it very well. Where are they now? 2.0.46 is already \nout and doesn't include a fix. While I'm appreciative of the workaround. \nHaving an authentication occur everytime a protected resource is accessed \nwithout caching is pretty unacceptable. So is having to run an old version of \nthe HTTP server that has security vulnerabilities. IMHO, if the developers \naren't going to come up with a fix for version 2.0.47, they should roll the \nauth_ldap code back to 2.0.44 (which worked just fine).\n", "attachment_id": null, "id": 39175, "creator": "jemiller@uchicago.edu", "time": "2003-06-20T15:44:26Z", "bug_id": 18756, "creation_time": "2003-06-20T15:44:26Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 18756, "attachment_id": null, "is_private": false, "id": 39847, "time": "2003-07-02T11:53:32Z", "creator": "softspt@gchq.gsi.gov.uk", "creation_time": "2003-07-02T11:53:32Z", "text": "I believe the error is in the shared memory handling. After a lot of \nscaffolding, I found it was dying at line 396 of util_ldap_cache_mgr.c, in \nutil_ald_cache_insert(), when node->add_time is set to the current time.\n\nOn the assumption this indicated some sort of memory allocation problem when \ncreating node, I then had a look at util_ald_alloc(). If the call to \napr_rmm_addr_get() is replaced with a simple calloc(), the problem goes away.\n"}, {"attachment_id": 7099, "tags": [], "bug_id": 18756, "text": "Created attachment 7099\nThis patch correct ldap cache shm which is broken in apache 2.0", "count": 15, "id": 39989, "time": "2003-07-04T11:15:20Z", "creator": "apache@moresecurity.org", "creation_time": "2003-07-04T11:15:20Z", "is_private": false}, {"count": 16, "tags": [], "bug_id": 18756, "is_private": false, "text": "Created attachment 7100\nThis patch correct ldap cache shm which is broken in apache 2.0", "id": 39990, "time": "2003-07-04T11:16:02Z", "creator": "apache@moresecurity.org", "creation_time": "2003-07-04T11:16:02Z", "attachment_id": 7100}, {"count": 17, "tags": [], "text": "I have just posted a patch i made one month ago to fix problems in ldap cache\nand shm. This code has been ported from apache 1.3 and was broken when using SHM.\n\nI tested the patch and it's working with worker MPM, i sent it on dev@httpd, but\ndidn't get answer at this time.\n\nfeedback are welcome\n\nMatthieu\n\nSorry if i posted twice, i am new with bugzilla", "is_private": false, "bug_id": 18756, "id": 39991, "time": "2003-07-04T11:21:38Z", "creator": "apache@moresecurity.org", "creation_time": "2003-07-04T11:21:38Z", "attachment_id": null}, {"count": 18, "tags": [], "bug_id": 18756, "text": "The patch provided by Matthieu Estrade partially worked for me.  I applied the\npatch to a clean 2.0.47 tree, and now I properly get a \"LDAP: using file:\n/var/run/apache2/mod_ldap_cache for shm cache\" message in the logfile (after\nsetting the LDAPShmCacheFile option).  I still get the \"ldap cache init: Error\n0\" message though (even though the configured shm file is correctly created),\nbut now the /ldap-status page correctly updates with cache information about the\nLDAP entries that have been attempted (stayed empty before).\n\nAs mentioned in early comments, I also get the \"exit signal Bus error (10)\",\nwhich has not changed after patching of 2.0.47 (also have same problem with 2.0.45).", "id": 40622, "time": "2003-07-14T10:30:35Z", "creator": "kate.ward@forestent.com", "creation_time": "2003-07-14T10:30:35Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "bug_id": 18756, "text": "Commenting out the LDAP cache directives from the Apache config now allows me to\nsuccessfully authenticate against my OpenLDAP 2.0.27 server, but no caching is\nhappening.  As my load is light, I can live with this :)\n\nIn my previous 2.0.44 install, I was not using the LDAP cache directives, so I\ncannot comment as to whether they used to work or not.  I had enabled them for\nmy 2.0.47 install attempting to work around above mentioned bus errors.\n\nNote, the provided patch was required before my original config that did not\ninclude the LDAP cache directives worked successfully.  For my case (no\ncaching), the patch now works beautifully.", "id": 40629, "time": "2003-07-14T13:04:07Z", "creator": "kate.ward@forestent.com", "creation_time": "2003-07-14T13:04:07Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 18756, "text": "I have tryed to enable caching on my 2.0.44 environment.\n\nI have added following lines in my httpd.conf (as explained in mod_ldap \ndocumentation):\n\n#LDAP\nLDAPSharedCacheSize 200000\nLDAPCacheEntries 1024\nLDAPCacheTTL 600\nLDAPOpCacheEntries 1024\nLDAPOpCacheTTL 600\n\n<Location /ldap-status>\n\tSetHandler ldap-status\n\tOrder deny,allow\n\tDeny from all\n\tAllow from mydomain.com\n\n\tAuthName \"Protected\"\n\tAuthType Basic\n\tAuthLDAPEnabled on\n\tAuthLDAPURL \"ldap://ldapmain.mydomain.com \nldapsecond.mydomain.com/ou=people,dc=mycompany,dc=com?uid?sub\"\n\n\tAuthLDAPAuthoritative on\n\trequire user \"webmaster\"\n</Location>\n\n\nWell, perhasp I miss something but /ldap-status always display :\nCache has not been enabled/initialised.\n\nDoes someone know if LDAP caching is always disabled in 2.0.44 or if I made a \nmistake ?\n\nBye\n\nLaurent\n", "count": 20, "id": 43152, "time": "2003-08-22T09:40:45Z", "creator": "l_faillie@yahoo.com", "creation_time": "2003-08-22T09:40:45Z", "is_private": false}, {"count": 21, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 43441, "time": "2003-08-28T16:32:00Z", "creator": "l_faillie@yahoo.com", "creation_time": "2003-08-28T16:32:00Z", "is_private": false, "text": "I just make a test w/ latest 2.0.47\n\nIt doesn't crash but, /ldap-status says ldap caching is not enabled even if I\nput directive of my previous messages in the configuration file.\n\nI miss something or caching can't be done on my plateforme ?\n\nLaurent\n"}, {"attachment_id": 8185, "tags": [], "bug_id": 18756, "is_private": false, "count": 22, "id": 44104, "time": "2003-09-12T10:32:39Z", "creator": "apache@moresecurity.org", "creation_time": "2003-09-12T10:32:39Z", "text": "Created attachment 8185\nMy latest patch for ldap cache using shared memory"}, {"count": 23, "tags": [], "bug_id": 18756, "text": "This is my latest and new patch fixing ldap cache using shared memory.\nIt is different than the latest one and more clean.\n\nI fix a bug which could appear when apache is running vhosts\nI tested it on httpd-2.0.47 and latest cvs version and it's working well on linux\nldap-status is displaying the correct information and it's caching ldap request\nin each vhost using ldap Auth.\n\nI added a directive: LDAPSharedCacheFile (filename)\ni used LDAPSharedCacheFile logs/ldap_cache_file\n\ni hope it will work entirely now\n\nregards,\n\nMatthieu", "id": 44106, "time": "2003-09-12T10:43:19Z", "creator": "apache@moresecurity.org", "creation_time": "2003-09-12T10:43:19Z", "is_private": false, "attachment_id": null}, {"count": 24, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "to summarize a few observations i made with 2.0.47, worker-mpm, solaris8 and \nopenldap2.1.22:\n\n1.) i must place the following statements outside of any virtual host \nstatement otherwise the ldap-cache will not work (checked with the\nldap-status handler).\n\nLDAPSharedCacheSize 200000\nLDAPCacheEntries 1024 <- this seems to be the important one\nLDAPCacheTTL 600\nLDAPOpCacheEntries 1024\nLDAPOpCacheTTL 600\n[LDAPSharedCacheFile logs/ldap_cache_file]\n\nusing this configuration the ldap-cache seems to initialize just fine, e.g.\n...\nCache Name Entries Avg. Chain Len. Hits Ins/Rem Purges Avg Purge Time \nLDAP URL Cache 0 (0% full) 0.0 0/0 100% 0/0 (none) 0 \n...\n\nbut after the first successfull authentication the connection aborts.\nerror_log:\n...\n[Sat Sep 20 14:18:35 2003] [notice] child pid 14848 exit signal Bus error (10)\n...\n\n2. placing the above statement inside a virtual-host statement or setting the \nparameter LDAPCacheEntries to 0, results in a disabled LDAP cache, but \nauthentication works at least.\n\n3. applying the latest patch from Matthieu Estrade (09/12/03) doesn't help \neither. httpd creates a 6 byte LDAPSharedCacheFile, but the results are the \nsame listed in 1) and 2)\n", "id": 44377, "time": "2003-09-20T12:39:55Z", "creator": "apache@schiegl.com", "creation_time": "2003-09-20T12:39:55Z", "is_private": false}, {"count": 25, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "For you folks who are getting crashes with the LDAP crashing (exit signal SIGBUS\nor whatever)...  Can you post a backtrace from a core dump pretty please so we\nknow exactly which code is crashing?  Thanks!\n", "id": 44742, "time": "2003-09-26T13:03:24Z", "creator": "trawick@apache.org", "creation_time": "2003-09-26T13:03:24Z", "is_private": false}, {"count": 26, "tags": [], "bug_id": 18756, "attachment_id": null, "is_private": false, "id": 44743, "time": "2003-09-26T13:31:45Z", "creator": "swaltner@lsil.com", "creation_time": "2003-09-26T13:31:45Z", "text": "dumbo:~/apache-2.0.47/bin> ./apachectl startssl\nSegmentation Fault - core dumped\ndumbo:~/apache-2.0.47/bin> gdb httpd core\nGNU gdb 5.3\nCopyright 2002 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"sparc-sun-solaris2.9\"...\nCore was generated by `/home/backuppc/apache-2.0.47/bin/httpd -k start -DSSL'.\nProgram terminated with signal 11, Segmentation fault.\nReading symbols from /home/backuppc/apache-2.0.47/lib/libaprutil-0.so.0...done.\nLoaded symbols for /home/backuppc/apache-2.0.47/lib/libaprutil-0.so.0\nReading symbols from /usr/lib/libldap.so.5...done.\nLoaded symbols for /usr/lib/libldap.so.5\nReading symbols from /usr/local/lib/liblber.so.2...dbxread.c:1732:\ngdb-internal-error: sect_index_data not initialized\n\nAn internal GDB error was detected.  This may make further\ndebugging unreliable.  Quit this debugging session? (y or n) n\n\nCreate a core file containing the current state of GDB? (y or n) n\n\nReading symbols from /home/backuppc/apache-2.0.47/lib/libexpat.so.0...done.\nLoaded symbols for /home/backuppc/apache-2.0.47/lib/libexpat.so.0\nReading symbols from /home/backuppc/apache-2.0.47/lib/libapr-0.so.0...done.\nLoaded symbols for /home/backuppc/apache-2.0.47/lib/libapr-0.so.0\nReading symbols from /usr/lib/libsendfile.so.1...done.\nLoaded symbols for /usr/lib/libsendfile.so.1\nReading symbols from /usr/lib/librt.so.1...done.\nLoaded symbols for /usr/lib/librt.so.1\nReading symbols from /usr/lib/libm.so.1...done.\nLoaded symbols for /usr/lib/libm.so.1\nReading symbols from /usr/lib/libsocket.so.1...done.\nLoaded symbols for /usr/lib/libsocket.so.1\nReading symbols from /usr/lib/libnsl.so.1...done.\nLoaded symbols for /usr/lib/libnsl.so.1\n---Type <return> to continue, or q <return> to quit---\nReading symbols from /usr/lib/libresolv.so.2...done.\nLoaded symbols for /usr/lib/libresolv.so.2\nReading symbols from /usr/lib/libdl.so.1...done.\nLoaded symbols for /usr/lib/libdl.so.1\nReading symbols from /usr/lib/libpthread.so.1...done.\nLoaded symbols for /usr/lib/libpthread.so.1\nReading symbols from /usr/lib/libc.so.1...done.\nLoaded symbols for /usr/lib/libc.so.1\nReading symbols from /usr/lib/libmd5.so.1...done.\nLoaded symbols for /usr/lib/libmd5.so.1\nReading symbols from /usr/lib/libaio.so.1...done.\nLoaded symbols for /usr/lib/libaio.so.1\nReading symbols from /usr/lib/libmp.so.2...done.\nLoaded symbols for /usr/lib/libmp.so.2\nReading symbols from /usr/platform/SUNW,Ultra-Enterprise/lib/libc_psr.so.1...done.\nLoaded symbols for /usr/platform/SUNW,Ultra-Enterprise/lib/libc_psr.so.1\nReading symbols from /usr/lib/libthread.so.1...done.\nLoaded symbols for /usr/lib/libthread.so.1\n#0  0xfeeb2f68 in strlen () from /usr/lib/libc.so.1\n(gdb) bt\n#0  0xfeeb2f68 in strlen () from /usr/lib/libc.so.1\n#1  0xff16c990 in apr_pstrdup () from /home/backuppc/apache-2.0.47/lib/libapr-0.so.0\n#2  0x0002ee48 in mod_auth_ldap_parse_url ()\n#3  0x0006a4ec in invoke_cmd ()\n#4  0x0006bda0 in ap_walk_config_sub ()\n#5  0x0006be9c in ap_walk_config ()\n#6  0x0008bc2c in dirsection ()\n#7  0x0006a36c in invoke_cmd ()\n#8  0x0006bda0 in ap_walk_config_sub ()\n#9  0x0006be9c in ap_walk_config ()\n#10 0x0006d2fc in ap_process_config_tree ()\n#11 0x000716d8 in main ()\n(gdb) quit\ndumbo:~/apache-2.0.47/bin>\n\n.../httpd.conf\n==============\n<Directory \"/home/backuppc/apache-2.0.47/cgi-bin\">\n    AllowOverride None\n    Options None\n    Order allow,deny\n    Allow from all\n\n    AuthName \"BackupPC Admin Page\"\n    AuthType Basic\n    AuthLDAPEnabled on\n    AuthLDAPAuthoritative on\n    AuthLDAPURL ldap://...obfuscated...\n    require valid-user\n</Directory>\n\nNo matter what I put in the AuthLDAPURL config entry, the software segfaults on\nstartup. Looking at the backtrace, it is having trouble parsing the line for\nsome reason. This is Solaris 9 with Apache 2.0.47 compiled with GNU Make 3.80,\nGCC 3.3 and OpenLDAP 2.1.22. I am not setting any entries related to LDAP\ncaching. The same config entries work fine on Apache 2.0.47 compiled on Linux\n(RedHat 9, x86)."}, {"count": 27, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 44747, "time": "2003-09-26T16:52:11Z", "creator": "trawick@apache.org", "creation_time": "2003-09-26T16:52:11Z", "is_private": false, "text": "nice backtrace :)\n\nthere are a bunch of apr_pstrdup() calls in that function...  normal way to get\nthe debugger to tell us is to rebuild the server with debug symbols (add\n--enable-maintainer-mode to configure invocation), start the server to get a new\ncoredump, and use gdb again... gdb this time should display the actual source\nfile line numbers\n\nthe ldap function that calls apr_pstrdup() also has a bunch of debug statements...\ncan you try starting Apache with \"-e debug\" option first to see if\nmod_auth_ldap's debug messages get to the console or to the error log?  if this\nworks, we may be able to get a good hint without you rebuilding your server\n"}, {"count": 28, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "my error_log (loglevel debug):\n\n...starting apache...\n[Sat Sep 27 11:18:23 2003] [notice] LDAP: Built with OpenLDAP LDAP SDK\n[Sat Sep 27 11:18:23 2003] [notice] LDAP: SSL support unavailable\n[Sat Sep 27 11:18:23 2003] [info] Init: Initializing OpenSSL library\n[Sat Sep 27 11:18:23 2003] [info] Init: Seeding PRNG with 512 bytes of entropy\n[Sat Sep 27 11:18:23 2003] [info] Init: Generating temporary RSA private keys \n(512/1024 bits)\n[Sat Sep 27 11:18:24 2003] [info] Init: Generating temporary DH parameters \n(512/1024 bits)\n[Sat Sep 27 11:18:24 2003] [debug] ssl_scache_dbm.c(422): Inter-Process \nSession Cache (DBM) Expiry: old: 0, new: 0, removed: 0\n[Sat Sep 27 11:18:24 2003] [info] Init: Initializing (virtual) servers for SSL\n[Sat Sep 27 11:18:24 2003] [info] Server: Apache/2.0.47, Interface: \nmod_ssl/2.0.47, Library: OpenSSL/0.9.7b\n[Sat Sep 27 11:18:24 2003] [notice] LDAP: Built with OpenLDAP LDAP SDK\n[Sat Sep 27 11:18:24 2003] [notice] LDAP: SSL support unavailable\n[Sat Sep 27 11:18:24 2003] [info] Init: Initializing OpenSSL library\n[Sat Sep 27 11:18:25 2003] [info] Init: Seeding PRNG with 512 bytes of entropy\n[Sat Sep 27 11:18:25 2003] [info] Init: Generating temporary RSA private keys \n(512/1024 bits)\n[Sat Sep 27 11:18:25 2003] [info] Init: Generating temporary DH parameters \n(512/1024 bits)\n[Sat Sep 27 11:18:25 2003] [info] Init: Initializing (virtual) servers for SSL\n[Sat Sep 27 11:18:25 2003] [info] Server: Apache/2.0.47, Interface: \nmod_ssl/2.0.47, Library: OpenSSL/0.9.7b\n[Sat Sep 27 11:18:25 2003] [debug] util_ldap.c(1104): [5795] ldap cache init: \nError 0\n[Sat Sep 27 11:18:25 2003] [notice] Apache configured -- resuming normal \noperations\n[Sat Sep 27 11:18:25 2003] [info] Server built: Sep 13 2003 13:31:41\n[Sat Sep 27 11:18:25 2003] [debug] worker.c(1736): AcceptMutex: pthread \n(default: pthread)\n[Sat Sep 27 11:18:42 2003] [notice] child pid 5795 exit signal Bus error (10)\n[Sat Sep 27 11:18:43 2003] [debug] util_ldap.c(1104): [5796] ldap cache init: \nError 0\n[Sat Sep 27 11:18:44 2003] [notice] child pid 5796 exit signal Bus error (10)\n[Sat Sep 27 11:18:45 2003] [debug] util_ldap.c(1104): [5797] ldap cache init: \nError 0\n[Sat Sep 27 11:19:10 2003] [info] removed PID file /opt/httpd/logs/httpd.pid \n(pid=5793)\n[Sat Sep 27 11:19:10 2003] [notice] caught SIGTERM, shutting down\n...shutdown...\n\nat 11:18:42 i tried to authenticate the first time...\n\noutput to console on startup:\n\n[Sat Sep 27 11:18:23 2003] [debug] util_ldap.c(958): [5792] ldap cache: \nSetting shared memory cache size to 200000 bytes.\n[Sat Sep 27 11:18:23 2003] [debug] util_ldap.c(992): [5792] ldap cache: \nSetting search cache size to 1024 entries.\n[Sat Sep 27 11:18:23 2003] [debug] util_ldap.c(973): [5792] ldap cache: \nSetting cache TTL to 600000000 microseconds.\n[Sat Sep 27 11:18:23 2003] [debug] util_ldap.c(1025): [5792] ldap cache: \nSetting operation cache size to 1024 entries.\n[Sat Sep 27 11:18:23 2003] [debug] util_ldap.c(1007): [5792] ldap cache: \nSetting operation cache TTL to 600000000 microseconds.\n[Sat Sep 27 11:18:23 2003] [debug] mod_auth_ldap.c(737): [5792] auth_ldap url \nparse: `ldap://localhost:389/CN=AAAA,DC=BBBB,DC=CCCC?DDDD?one?\n(objectClass=person)'\n[Sat Sep 27 11:18:23 2003] [debug] mod_auth_ldap.c(758): [5792] auth_ldap url \nparse: Host: localhost\n[Sat Sep 27 11:18:23 2003] [debug] mod_auth_ldap.c(760): [5792] auth_ldap url \nparse: Port: 389\n[Sat Sep 27 11:18:23 2003] [debug] mod_auth_ldap.c(762): [5792] auth_ldap url \nparse: DN: CN=AAAA,DC=BBBB,DC=CCCC\n[Sat Sep 27 11:18:23 2003] [debug] mod_auth_ldap.c(764): [5792] auth_ldap url \nparse: attrib: DDDD\n[Sat Sep 27 11:18:23 2003] [debug] mod_auth_ldap.c(766): [5792] auth_ldap url \nparse: scope: onelevel\n[Sat Sep 27 11:18:23 2003] [debug] mod_auth_ldap.c(771): [5792] auth_ldap url \nparse: filter: (objectClass=person)\n[Sat Sep 27 11:18:23 2003] [debug] mod_auth_ldap.c(836): LDAP: auth_ldap not \nusing SSL connections\n...and a few more of these statements.\n\nno core file was created, although coredump's should work\n\n# coreadm \n     global core file pattern: \n       init core file pattern: core\n            global core dumps: disabled\n       per-process core dumps: enabled\n      global setid core dumps: disabled\n per-process setid core dumps: disabled\n     global core dump logging: disabled\n# coreadm `ps -ef | grep httpd | grep root | awk '{print $2}'`\n5529:   core\n#\n\nany hints how i can retrieve more helpful informations are appreciated.\n", "id": 44762, "time": "2003-09-27T09:36:21Z", "creator": "apache@schiegl.com", "creation_time": "2003-09-27T09:36:21Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 18756, "text": "okay, this one (being unable to create a core file) was my fault, after \nadjusting a few paramters if got the desired result:\n\n# gdb httpd core\nGNU gdb 5.0\nCopyright 2000 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"sparc-sun-solaris2.8\"...\nCore was generated by `/opt/httpd/bin/httpd -k start'.\nProgram terminated with signal 9, Killed.\nReading symbols from /opt/httpd/lib/libaprutil-0.so.0...done.\nLoaded symbols for /opt/httpd/lib/libaprutil-0.so.0\nReading symbols from /opt/openldap/lib/libldap.so.2...done.\nLoaded symbols for /opt/openldap/lib/libldap.so.2\nReading symbols from /usr/lib/libgen.so.1...done.\nLoaded symbols for /usr/lib/libgen.so.1\nReading symbols from /opt/openldap/lib/liblber.so.2...done.\nLoaded symbols for /opt/openldap/lib/liblber.so.2\nReading symbols from /opt/httpd/lib/libexpat.so.0...done.\nLoaded symbols for /opt/httpd/lib/libexpat.so.0\nReading symbols from /usr/local/lib/libiconv.so.2...done.\nLoaded symbols for /usr/local/lib/libiconv.so.2\nReading symbols from /opt/httpd/lib/libapr-0.so.0...done.\nLoaded symbols for /opt/httpd/lib/libapr-0.so.0\nReading symbols from /usr/lib/libsendfile.so.1...done.\nLoaded symbols for /usr/lib/libsendfile.so.1\nReading symbols from /usr/lib/librt.so.1...done.\nLoaded symbols for /usr/lib/librt.so.1\nReading symbols from /usr/lib/libm.so.1...done.\nLoaded symbols for /usr/lib/libm.so.1\nReading symbols from /usr/lib/libsocket.so.1...done.\nLoaded symbols for /usr/lib/libsocket.so.1\nReading symbols from /usr/lib/libnsl.so.1...done.\nLoaded symbols for /usr/lib/libnsl.so.1\nReading symbols from /usr/lib/libresolv.so.2...done.\nLoaded symbols for /usr/lib/libresolv.so.2\nReading symbols from /usr/lib/libpthread.so.1...done.\nLoaded symbols for /usr/lib/libpthread.so.1\nReading symbols from /usr/lib/libc.so.1...done.\nLoaded symbols for /usr/lib/libc.so.1\nReading symbols from /usr/lib/libdl.so.1...done.\nLoaded symbols for /usr/lib/libdl.so.1\nReading symbols from /usr/lib/libaio.so.1...done.\nLoaded symbols for /usr/lib/libaio.so.1\nReading symbols from /usr/lib/libmp.so.2...done.\nLoaded symbols for /usr/lib/libmp.so.2\nReading symbols from /usr/platform/SUNW,UltraAX-i2/lib/libc_psr.so.1...done.\nLoaded symbols for /usr/platform/SUNW,UltraAX-i2/lib/libc_psr.so.1\nReading symbols from /usr/lib/libthread.so.1...done.\nLoaded symbols for /usr/lib/libthread.so.1\nReading symbols from /usr/lib/nss_files.so.1...done.\nLoaded symbols for /usr/lib/nss_files.so.1\nReading symbols from /opt/httpd/modules/libphp4.so...done.\nLoaded symbols for /opt/httpd/modules/libphp4.so\nReading symbols from /opt/httpd/modules/mod_security.so...done.\nLoaded symbols for /opt/httpd/modules/mod_security.so\n#0  0x4a4f8 in util_ald_cache_insert (cache=0xfed501b0, payload=0xfe303828) at \nutil_ldap_cache_mgr.c:396\n396         node->add_time = apr_time_now();\n(gdb) bt\n#0  0x4a4f8 in util_ald_cache_insert (cache=0xfed501b0, payload=0xfe303828) at \nutil_ldap_cache_mgr.c:396\n#1  0x49184 in util_ldap_cache_checkuserid (r=0x350fe0, ldc=0x20d4a8, url=0x1 \n<Address 0x1 out of bounds>, \n    basedn=0x36b260 \"MyUsername\", scope=0, attrs=0x233b00, \nfilter=0xfe3038f0 \"(&(objectClass=person)(sAMAccountName=MyUsername))\", \n    bindpw=0x36b22f \"MyPassword\", binddn=0xfe3038e8, retvals=0xfe3038e4) at \nutil_ldap.c:923\n#2  0x4af14 in mod_auth_ldap_check_user_id (r=0x350fe0) at mod_auth_ldap.c:366\n#3  0xaaa4c in ap_run_check_user_id (r=0x350fe0) at request.c:112\n#4  0xab398 in ap_process_request_internal (r=0x350fe0) at request.c:235\n#5  0x77b28 in ap_process_request (r=0x350fe0) at http_request.c:286\n#6  0x72f7c in ap_process_http_connection (c=0x346ba0) at http_core.c:293\n#7  0x9ef6c in ap_run_process_connection (c=0x346ba0) at connection.c:85\n#8  0x9f258 in ap_process_connection (c=0x346ba0, csd=0x346ac0) at \nconnection.c:211\n#9  0x90448 in process_socket (p=0x346ba0, sock=0x346ac0, my_child_num=0, \nmy_thread_num=2, bucket_alloc=0x2e53e0) at worker.c:632\n#10 0x90b34 in worker_thread (thd=0x1e6830, dummy=0x346ba0) at worker.c:947\n#11 0xff2756d0 in dummy_worker (opaque=0x1e6830) at thread.c:127\n(gdb) quit\n", "count": 29, "id": 44775, "time": "2003-09-27T22:51:57Z", "creator": "apache@schiegl.com", "creation_time": "2003-09-27T22:51:57Z", "is_private": false}, {"count": 30, "tags": [], "bug_id": 18756, "is_private": false, "text": "\nSunOS neutrino 5.8 Generic_108528-16 sun4u sparc SUNW,Sun-Fire-480R\nOpenSSL 0.9.7c\nOpenLdap 2.1.22\nApache 2.0.47\n./configure --with-ssl --enable-so --enable-ssl --with-ldap --enable-ldap \n--enable-auth-ldap --enable-proxy --enable-rewrite --enable-maintainer-mode\n\nIt doesn't coredump, is there a way to keep it in the foreground & debug\nfor more info?\n\n  Duncan\n\n./httpd -e debug\n\nerror_log when logging -> debug\n[Fri Oct 03 12:18:38 2003] [notice] LDAP: Built with OpenLDAP LDAP SDK\n[Fri Oct 03 12:18:38 2003] [notice] LDAP: SSL support available\n[Fri Oct 03 12:18:38 2003] [info] Init: Initializing OpenSSL library\n[Fri Oct 03 12:18:38 2003] [info] Init: Seeding PRNG with 0 bytes of entropy\n[Fri Oct 03 12:18:38 2003] [info] Init: Generating temporary RSA private keys \n(512/1024 bits)\n[Fri Oct 03 12:18:38 2003] [info] Init: Generating temporary DH parameters \n(512/1024 bits)\n[Fri Oct 03 12:18:38 2003] [warn] Init: Session Cache is not configured [hint: \nSSLSessionCache]\n[Fri Oct 03 12:18:38 2003] [info] Init: Initializing (virtual) servers for SSL\n[Fri Oct 03 12:18:38 2003] [info] Server: Apache/2.0.47, Interface: mod_ssl/2.0.\n47, Library: OpenSSL/0.9.7c\n[Fri Oct 03 12:18:38 2003] [notice] LDAP: Built with OpenLDAP LDAP SDK\n[Fri Oct 03 12:18:38 2003] [notice] LDAP: SSL support available\n[Fri Oct 03 12:18:38 2003] [info] Init: Initializing OpenSSL library\n[Fri Oct 03 12:18:38 2003] [info] Init: Seeding PRNG with 0 bytes of entropy\n[Fri Oct 03 12:18:38 2003] [info] Init: Generating temporary RSA private keys \n(512/1024 bits)\n[Fri Oct 03 12:18:38 2003] [info] Init: Generating temporary DH parameters \n(512/1024 bits)\n[Fri Oct 03 12:18:38 2003] [info] Init: Initializing (virtual) servers for SSL\n[Fri Oct 03 12:18:38 2003] [info] Server: Apache/2.0.47, Interface: mod_ssl/2.0.\n47, Library: OpenSSL/0.9.7c\n[Fri Oct 03 12:18:38 2003] [debug] util_ldap.c(1104): [5615] ldap cache init: \nError 0\n[Fri Oct 03 12:18:38 2003] [notice] Apache/2.0.47 (Unix) mod_ssl/2.0.47 \nOpenSSL/0.9.7c configured -- resuming normal operations\n[Fri Oct 03 12:18:38 2003] [info] Server built: Oct  3 2003 12:07:30\n[Fri Oct 03 12:18:38 2003] [debug] prefork.c(1037): AcceptMutex: pthread \n(default: pthread)\n[Fri Oct 03 12:18:38 2003] [debug] util_ldap.c(1104): [5616] ldap cache init: \nError 0\n[Fri Oct 03 12:18:38 2003] [debug] util_ldap.c(1104): [5617] ldap cache init: \nError 0\n[Fri Oct 03 12:18:38 2003] [debug] util_ldap.c(1104): [5619] ldap cache init: \nError 0\n[Fri Oct 03 12:18:39 2003] [debug] util_ldap.c(1104): [5620] ldap cache init: \nError 0\n[Fri Oct 03 12:19:13 2003] [debug] mod_auth_ldap.c(343): [client xxx] [5615] \nauth_ldap authenticate: using URL ...\n[Fri Oct 03 12:19:13 2003] [debug] mod_auth_ldap.c(343): [client xxx] [5616] \nauth_ldap authenticate: using URL ...\n[Fri Oct 03 12:19:13 2003] [debug] mod_auth_ldap.c(343): [client xxx] [5617] \nauth_ldap authenticate: using URL ...\n[Fri Oct 03 12:19:14 2003] [debug] mod_auth_ldap.c(343): [client xxx] [5619] \nauth_ldap authenticate: using URL ...\n[Fri Oct 03 12:19:14 2003] [debug] mod_auth_ldap.c(343): [client xxx] [5620] \nauth_ldap authenticate: using URL ...\n[Fri Oct 03 12:19:14 2003] [notice] child pid 5620 exit signal Bus error (10)\n[Fri Oct 03 12:19:14 2003] [notice] child pid 5619 exit signal Bus error (10)\n[Fri Oct 03 12:19:14 2003] [notice] child pid 5617 exit signal Bus error (10)\n[Fri Oct 03 12:19:14 2003] [notice] child pid 5616 exit signal Bus error (10)\n[Fri Oct 03 12:19:14 2003] [notice] child pid 5615 exit signal Bus error (10)\n[Fri Oct 03 12:19:14 2003] [debug] util_ldap.c(1104): [5644] ldap cache init: \nError 0\n[Fri Oct 03 12:19:15 2003] [debug] util_ldap.c(1104): [5646] ldap cache init: \nError 0\n[Fri Oct 03 12:19:15 2003] [debug] util_ldap.c(1104): [5647] ldap cache init: \nError 0\n[Fri Oct 03 12:19:16 2003] [debug] util_ldap.c(1104): [5651] ldap cache init: \nError 0\n[Fri Oct 03 12:19:16 2003] [debug] util_ldap.c(1104): [5653] ldap cache init: \nError 0\n[Fri Oct 03 12:19:16 2003] [debug] util_ldap.c(1104): [5652] ldap cache init: \nError 0\n[Fri Oct 03 12:19:16 2003] [debug] util_ldap.c(1104): [5657] ldap cache init: \nError 0\n[Fri Oct 03 12:19:18 2003] [info] removed PID file /etc/apache2/logs/httpd.pid \n(pid=5614)\n[Fri Oct 03 12:19:18 2003] [notice] caught SIGTERM, shutting down\n", "id": 45035, "time": "2003-10-03T11:27:26Z", "creator": "dbb@st-andrews.ac.uk", "creation_time": "2003-10-03T11:27:26Z", "attachment_id": null}, {"count": 31, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "Hello All,\n\nI just compiled Apache 2.0.47 using ldap modules on Solaris with ldap libraires \ngenerated by compiling OpenLDAP 2.1.23. Apache core dump systematically in the \nmod_auth_ldap_parse_url function. Apparently the ldap url is never correctly \nparsed.\n\nWhen I'm trying to access a page protected by an LDAP .htaccess, \nthe child crashs and generates the following errors log on LDAP url parsing \nwith strange server and port info:\n[Wed Oct 22 17:52:32 2003] [debug] prefork.c(1037): AcceptMutex: pthread\n(default: pthread)\n[Wed Oct 22 17:52:39 2003] [debug] mod_auth_ldap.c(737): [25927] auth_ldap url \nparse: `ldap://myserver:389/mysearchbase?sAMAccountName?sub?(objectClass=*)'\n[Wed Oct 22 17:52:39 2003] [debug] mod_auth_ldap.c(758): [25927] auth_ldap url \nparse: Host: mysearchbase\n[Wed Oct 22 17:52:39 2003] [debug] mod_auth_ldap.c(760): [25927] auth_ldap url \nparse: Port: 1230072\n[Wed Oct 22 17:52:40 2003] [notice] child pid 25927 exit signal Segmentation \nfault (11)\n\nWhen I include the LDAP restrictions in my httpd.conf file, apachectl core \ndumps in the LDAP url parsing too. Here is the gdb traces:\n\n#0  0x0002ae14 in mod_auth_ldap_parse_url (cmd=0xffbefbd8, config=0xdfb20, \n    url=0xdfc20 \"ldap://myserver:389/searchBase?sAMAccountName?sub?\n(objectClass=*)\") at mod_auth_ldap.c:764\n764         ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0,\n\nMy configure options were:\n./configure --prefix=/usr/local/apache2_withldap --enable-so --with-ldap --\nenable-ldap --enable-auth-ldap --libdir=/usr/local/openldap-2.1.23/li\nb --includedir=/usr/local/openldap-2.1.23/include\n \nHere is my .htaccess file:\nAuthName \"RCS Staff only\"\nAuthType Basic\nAuthLDAPEnabled on\nAuthLDAPAuthoritative on\n#AuthLDAPBindDN username\n#AuthLDAPBindPassword password\nAuthLDAPURL \"ldap://myserver:389/mysearchbase?sAMAccountName?sub(objectClass=*)\"\nrequire valid-user \n\nI followed the temporary workaround (disabling ldap cache) and recompile Apache \nafter adding the last patch without success.\n\nChristian", "id": 46073, "time": "2003-10-22T16:58:44Z", "creator": "cleclerc@ilog.fr", "creation_time": "2003-10-22T16:58:44Z", "is_private": false}, {"count": 32, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "Hi,\n\nFor the last comment, i agree it's not normal apache segfault parsing the url, \n\nYou seem want to do authentication against active directory which is impossible\nwith mod_auth_ldap. \nDealing with active directory for user/access is different than ldap auth.\nFirst you have to bind with a authorized user/pass to the active directory and\nget the name of the user (not the login), then you have to bind with this name\nand password you receive and look if bind is ok,\nif bind ok, then the user is valid.\n\nI should get an access on a solaris (sparc) box soon (finally) and then continue\nworking on all these bugs. Somebody could tell me with which compiler (gcc or\nsun) did they use to compile Apache ?\n\nMatthieu", "id": 46432, "time": "2003-10-29T11:50:52Z", "creator": "apache@moresecurity.org", "creation_time": "2003-10-29T11:50:52Z", "is_private": false}, {"count": 33, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "Patch id #8185 appears to work fine on FreeBSD 4.8-STABLE.", "id": 46836, "time": "2003-11-05T02:44:08Z", "creator": "bugzilla-apache@thewrittenword.com", "creation_time": "2003-11-05T02:44:08Z", "is_private": false}, {"count": 34, "tags": [], "text": "Hi,\n\nI'm using the following combinations with netscape sdk:\nSolaris 9 with gcc version 3.3\nSolaris 8 with gcc version 2.95.3\n\nBoth combinations produce the error \"exit signal Bus error\".\n\nErwin", "attachment_id": null, "bug_id": 18756, "id": 46912, "time": "2003-11-06T09:37:50Z", "creator": "erwin.horjus@virgil.nl", "creation_time": "2003-11-06T09:37:50Z", "is_private": false}, {"count": 35, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 46930, "time": "2003-11-06T15:01:39Z", "creator": "jemiller@uchicago.edu", "creation_time": "2003-11-06T15:01:39Z", "is_private": false, "text": "What happened to the developer that made the changes that broke it? Why \ndoesn't someone roll the changes back? It worked fine before. It's been broken \nfor 8 months now. This is ridiculus."}, {"count": 36, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "I dunno what you want to roll back, but after check again the CVS, nothing\nimportant has been done after the port of ldap cache to apache 2.0., and it's\nolder more than 1 year...\n\nMaybe you speak about apache 1.3 ??\n\nI agree it maybe worked with mpm prefork, a lucky day, but be sure that\nconsidering what the patch do, it's impossible it worked a day with mpm using\nthreads.\n\nFor the developper who did \"the changes that brokes it\", i hope he is still\nalive and i don't think somebody should do something to him, even if he did an\nerror.\n\nI think people are doing here an effort to make the shared memory ldap cache\nworking better and be stable, so please don't post such message if you find it\nridiculous...\n\n", "id": 46932, "time": "2003-11-06T15:21:25Z", "creator": "apache@moresecurity.org", "creation_time": "2003-11-06T15:21:25Z", "is_private": false}, {"count": 37, "tags": [], "text": "All I know is that I had it working fine with 2.0.44. They made changes in \n2.0.45 including changes in the syntax for using TLS/SSL and it hasn't worked \nsince.\n", "is_private": false, "id": 46936, "creator": "jemiller@uchicago.edu", "time": "2003-11-06T16:37:49Z", "bug_id": 18756, "creation_time": "2003-11-06T16:37:49Z", "attachment_id": null}, {"count": 38, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "Hi again jemiller,\n\nTo help, you could tell us what OS are you using, the LDAP library you are\nusing, if you setup cache, the mpm you compiled with, and if you applyied one\npatch posted here.\n\nThem if your problem is when you startup apache \n-> so probably the url parsing problem\n\nOr if the problem is when a client is trying to authenticate.\n-> so probably the cache problem.\n\nThanks in advance", "id": 46938, "time": "2003-11-06T17:07:17Z", "creator": "apache@moresecurity.org", "creation_time": "2003-11-06T17:07:17Z", "is_private": false}, {"count": 39, "tags": [], "bug_id": 18756, "is_private": false, "text": "My original bug report is located at \nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=19993.\n\nI just tried it again using Solaris 8 with a recent patch cluster installed, \nApache 2.0.48, OpenLDAP 2.1.23, and OpenSSL 0.9.7c. I'm using the default \ncache setting. According the the configure log, it's using \"prefork\" MPM. I \ndidn't use any patches.\n\nI used the following command line to configure it.\n\nCPPFLAGS=-I/opt/include LDFLAGS=-L/opt/lib ./configure --\nprefix=/opt/pkgs/httpd-2.0.48 --enable-ssl --with-ldap --enable-ldap --enable-\nauth-ldap 2>&1 | tee configure.txt\n\nAccording the the LDAP server logs, it is able to connection and bind \nsuccessfully. I receive the following error in the error_log file.\n\n[Thu Nov 06 15:35:56 2003] [notice] child pid 24270 exit signal Bus error (10)\n\nAlso, it doesn't appear to be using TLS like it should be. Until version \n2.0.45, you could use the AuthLDAPStartTLS directive to enable TLS. In version \n2.0.45, according to the documentation you have to use LDAPTrustedCA and \nLDAPTrustedCAType directives (AuthLDAPStartTLS is no longer recognized). This \nseemed to work in version 2.0.45. However, now, it doesn't seem to work.\n\nTo work around that problem, I reconfigured my LDAP server to allow non-\nencrypted binds. This resulted in the bus error listed above.\n", "id": 46948, "time": "2003-11-06T21:56:52Z", "creator": "jemiller@uchicago.edu", "creation_time": "2003-11-06T21:56:52Z", "attachment_id": null}, {"count": 40, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 46980, "time": "2003-11-07T11:54:39Z", "creator": "apache@moresecurity.org", "creation_time": "2003-11-07T11:54:39Z", "is_private": false, "text": "New patch fixing another possible segfault condition.\nYou can find all patches and howto at the following address:\n\nhttp://www.apache.org/~trawick/\nldap.20031107.readme and ldap.20031107.tar.gz\n\nPlease when you report bugs here, be sure you applied correctly all patches.\nYou can also use CVS to checkout the latest and patched code of HTTP (2.1)\n\nThanks for your help\n\n"}, {"count": 41, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 47001, "time": "2003-11-07T16:34:07Z", "creator": "erwin.horjus@virgil.nl", "creation_time": "2003-11-07T16:34:07Z", "is_private": false, "text": "The patch ldap.20031107.tar.gz works for me on Solaris 9 and Apache 2.0.48 with\nmost simply settings (no ldap cache directives):\n\n <LocationMatch / >\n    AuthName \"some realm\"\n    AuthType basic\n    AuthLDAPEnabled on\n    AuthLDAPURL \"<ldap-url>\"\n    AuthLDAPAuthoritative on\n    require valid-user\n </LocationMatch>\n\nThanks"}, {"count": 42, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "results when using the new patch (from Matthieu):\n\nsystem:\nSunOS 5.8 Generic_108528-23 sun4u sparc SUNW,UltraAX-i2\nOpenSSL 0.9.7c\nOpenLdap 2.1.23\nApache 2.0.48\n\nthis time i even have to use the LDAPSharedCacheFile statement\nto enable the LDAP Cache, my settings:\n\n   LDAPCacheEntries 1024\n   LDAPCacheTTL 600\n   LDAPOpCacheEntries 1024\n   LDAPOpCacheTTL 600\n   LDAPSharedCacheFile logs/ldap_cache_file\n\nif i do not use this tag, the ldap-cache will not become initialized (verified \nwith ldap-status) but authentication works ok.\n\nnevertheless enabling the ldap-cache and authenticating a user with the \ncorrect password results in the following message in the error log\n\n[Fri Nov 07 22:20:31 2003] [notice] child pid 29464 exit signal Bus error \n(10), possible coredump in /opt/httpd\n\nbacktrage of core file:\n\n(gdb) bt\n#0  util_ald_create_cache (st=0x1eab08, hashfunc=0x49b90 \n<util_ldap_search_node_hash>, \n    comparefunc=0x49ba8 <util_ldap_search_node_compare>, copyfunc=0x49bc8 \n<util_ldap_search_node_copy>, \n    freefunc=0x49cfc <util_ldap_search_node_free>) at util_ldap_cache_mgr.c:330\n#1  0x4a44c in util_ald_create_caches (st=0x1eab08, \n    url=0x1db410 \"ldap://host:389/CN=Users,DC=part1,DC=part2?sAMAccountName?\none?(objectClass=person)\") at util_ldap_cache_mgr.c:258\n#2  0x48f24 in util_ldap_cache_checkuserid (r=0x30dd90, ldc=0x20db28, \n    url=0x1db410 \"ldap://host:389/CN=Users,DC=part1,DC=part2?sAMAccountName?\none?(objectClass=person)\", basedn=0x1db480 \"CN=Users,DC=part1,DC=part2\", \nscope=1, attrs=0x1db4a0, \n    filter=0xfe2018f0 \"(&(objectClass=person)(sAMAccountName=username))\", \nbindpw=0x30faef \"password\", \n    binddn=0xfe2018e8, retvals=0xfe2018e4) at util_ldap.c:764\n#3  0x4b228 in mod_auth_ldap_check_user_id (r=0x30dd90) at mod_auth_ldap.c:366\n#4  0xab174 in ap_run_check_user_id (r=0x30dd90) at request.c:112\n#5  0xabac0 in ap_process_request_internal (r=0x30dd90) at request.c:235\n#6  0x77f90 in ap_process_request (r=0x30dd90) at http_request.c:286\n#7  0x73378 in ap_process_http_connection (c=0x2e6890) at http_core.c:293\n#8  0x9f66c in ap_run_process_connection (c=0x2e6890) at connection.c:85\n#9  0x9f958 in ap_process_connection (c=0x2e6890, csd=0x2e67a0) at \nconnection.c:211\n#10 0x90964 in process_socket (p=0x2e6890, sock=0x2e67a0, my_child_num=0, \nmy_thread_num=3, \n    bucket_alloc=0x2f7d88) at worker.c:632\n#11 0x91044 in worker_thread (thd=0x1eb510, dummy=0x3) at worker.c:946\n#12 0xff275d84 in dummy_worker (opaque=0x1eb510) at thread.c:127\n\nif anyone needs more informations or if i should test anything feel free to \nask...\n\nhave a nice day,\n   MarkuS\n", "id": 47121, "time": "2003-11-10T16:50:44Z", "creator": "apache@schiegl.com", "creation_time": "2003-11-10T16:50:44Z", "is_private": false}, {"count": 43, "tags": [], "text": "All built from Source from CVS -HEAD\nOS: FreeBSD 5.1-CURRENT\n\nbacktrace:\n#0  apr_rmm_calloc (rmm=0xd0d0d0d0, reqsize=99) at apr_rmm.c:344\n#1  0x2908c8a2 in util_ald_alloc (cache=0x8139288, size=3503345872) at\nutil_ldap_cache_mgr.c:141\n#2  0x2908cbc0 in util_ald_create_cache (st=0x80d15b8, hashfunc=0xd0d0d0d0,\ncomparefunc=0xd0d0d0d0, copyfunc=0xd0d0d0d0, freefunc=0xd0d0d0d0)\n    at util_ldap_cache_mgr.c:304\n#3  0x2908c804 in util_ldap_cache_init (pool=0x809b018, st=0x80d15b8) at\nutil_ldap_cache.c:324\n#4  0x2908c044 in util_ldap_post_config (p=0x809b018, plog=0x80c5018,\nptemp=0x80c7018, s=0x80b51e0) at util_ldap.c:1147\n#5  0x08063752 in ap_run_post_config (pconf=0x809b018, plog=0x80c5018,\nptemp=0x80c7018, s=0x80b51e0) at config.c:131\n#6  0x08068658 in main (argc=3, argv=0xbfbffb48) at main.c:618\n#7  0x0805c269 in _start ()\n\nIt seems that in util_ldap_cache_mgr.c around line 300 we do this:\n\n#if APR_HAS_SHARED_MEMORY\ncache = (util_ald_cache_t *)util_ald_alloc(st->cache_rmm, sizeof(util_ald_cache_t));\n#else\n\n\nBut the util_ald_alloc function expects a util_ald_cache_t type, and we are\npassing in a apr_rmm_t. util_ald_alloc then does:\n\nif (cache->rmm_addr) {\n/* allocate from shared memory */\nreturn (void *)apr_rmm_addr_get(cache->rmm_addr, apr_rmm_calloc(cache->rmm_addr,\nsize));\n}\n\nSince we passed in an apr_rmm_t, it does a nice crash when we try todo all the\nstuff with cache->rmm_addr.\n", "is_private": false, "bug_id": 18756, "id": 47437, "time": "2003-11-16T19:35:00Z", "creator": "chip@cyan.com", "creation_time": "2003-11-16T19:35:00Z", "attachment_id": null}, {"count": 44, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "\nSolaris 8\nOpenLDAP 2.1.23\nApache 2.0.48 with Mathieu's patch\n\nSame problems as everyone else reports.  Apache child processes die with bus \nerrors on the first LDAP query.  Applying the patch recommended above had no \neffect whatsoever.  I get bus errors multiple times, but I cannot get it to dump \ncore anywhere.", "id": 47572, "time": "2003-11-18T20:14:45Z", "creator": "dave@arcuri.us", "creation_time": "2003-11-18T20:14:45Z", "is_private": false}, {"count": 45, "tags": [], "text": "\n\nNevermind, I figured it out.  Sorry for the double.\n\n\nGNU gdb 5.0\nCopyright 2000 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"sparc-sun-solaris2.8\"...\nCore was generated by `bin/httpd -f conf/MYSITE_CENSORED.com.conf -k start'.\nProgram terminated with signal 9, Killed.\nReading symbols from /usr/local/apache2/lib/libaprutil-0.so.0...done.\nLoaded symbols for /usr/local/apache2/lib/libaprutil-0.so.0\nReading symbols from /usr/local/lib/libldap.so.2...done.\nLoaded symbols for /usr/local/lib/libldap.so.2\nReading symbols from /usr/lib/libgen.so.1...done.\nLoaded symbols for /usr/lib/libgen.so.1\nReading symbols from /usr/local/ssl/lib/libssl.so.0.9.7...done.\nLoaded symbols for /usr/local/ssl/lib/libssl.so.0.9.7\nReading symbols from /usr/local/ssl/lib/libcrypto.so.0.9.7...done.\nLoaded symbols for /usr/local/ssl/lib/libcrypto.so.0.9.7\nReading symbols from /usr/local/lib/liblber.so.2...done.\nLoaded symbols for /usr/local/lib/liblber.so.2\nReading symbols from /usr/local/BerkeleyDB.4.1/lib/libdb-4.1.so...done.\nLoaded symbols for /usr/local/BerkeleyDB.4.1/lib/libdb-4.1.so\nReading symbols from /usr/local/lib/libexpat.so.0...done.\nLoaded symbols for /usr/local/lib/libexpat.so.0\nReading symbols from /usr/local/apache2/lib/libapr-0.so.0...done.\nLoaded symbols for /usr/local/apache2/lib/libapr-0.so.0\nReading symbols from /usr/lib/libsendfile.so.1...done.\nLoaded symbols for /usr/lib/libsendfile.so.1\nReading symbols from /usr/lib/librt.so.1...done.\nLoaded symbols for /usr/lib/librt.so.1\nReading symbols from /usr/lib/libm.so.1...done.\nLoaded symbols for /usr/lib/libm.so.1\nReading symbols from /usr/lib/libsocket.so.1...done.\nLoaded symbols for /usr/lib/libsocket.so.1\nReading symbols from /usr/lib/libnsl.so.1...done.\nLoaded symbols for /usr/lib/libnsl.so.1\nReading symbols from /usr/lib/libresolv.so.2...done.\nLoaded symbols for /usr/lib/libresolv.so.2\nReading symbols from /usr/lib/libdl.so.1...done.\nLoaded symbols for /usr/lib/libdl.so.1\nReading symbols from /usr/lib/libpthread.so.1...done.\nLoaded symbols for /usr/lib/libpthread.so.1\nReading symbols from /usr/lib/libc.so.1...done.\nLoaded symbols for /usr/lib/libc.so.1\nReading symbols from /usr/local/lib/libgcc_s.so.1...done.\nLoaded symbols for /usr/local/lib/libgcc_s.so.1\nReading symbols from /usr/lib/libaio.so.1...done.\nLoaded symbols for /usr/lib/libaio.so.1\nReading symbols from /usr/lib/libmp.so.2...done.\nLoaded symbols for /usr/lib/libmp.so.2\nReading symbols from /usr/platform/SUNW,Ultra-250/lib/libc_psr.so.1...done.\nLoaded symbols for /usr/platform/SUNW,Ultra-250/lib/libc_psr.so.1\nReading symbols from /usr/lib/libthread.so.1...done.\nLoaded symbols for /usr/lib/libthread.so.1\nReading symbols from /usr/lib/nss_nisplus.so.1...done.\nLoaded symbols for /usr/lib/nss_nisplus.so.1\nReading symbols from /usr/lib/libdoor.so.1...done.\nLoaded symbols for /usr/lib/libdoor.so.1\n#0  util_ald_create_cache (st=0x105048, hashfunc=0x32068 \n<util_ldap_search_node_hash>, \n    comparefunc=0x3207c <util_ldap_search_node_compare>, \n    copyfunc=0x320a0 <util_ldap_search_node_copy>, freefunc=0x321c4 \n<util_ldap_search_node_free>)\n    at util_ldap_cache_mgr.c:332\n332     util_ldap_cache_mgr.c: No such file or directory.\n(gdb) bt\n#0  util_ald_create_cache (st=0x105048, hashfunc=0x32068 \n<util_ldap_search_node_hash>, \n    comparefunc=0x3207c <util_ldap_search_node_compare>, \n    copyfunc=0x320a0 <util_ldap_search_node_copy>, freefunc=0x321c4 \n<util_ldap_search_node_free>)\n    at util_ldap_cache_mgr.c:332\n#1  0x328a8 in util_ald_create_caches (st=0x0, \n    url=0x10e9d8 \"ldap://CENSORED:389/o=CENSORED,c=us?uid?sub\") at \nutil_ldap_cache_mgr.c:258\n#2  0x31834 in util_ldap_cache_checkuserid (r=0x179558, ldc=0x114468, \n    url=0x10e9d8 \"ldap://CENSORED:389/o=CENSORED,c=us?uid?sub\", basedn=0x10ea20 \n\"o=CENSORED,c=us\", \n    scope=2, attrs=0x10ea30, filter=0xfdd07960 \"(&(objectclass=*)(uid=CENSORED))\n\", \n    bindpw=0x17b304 \"MY_PLAINTEXT_PASSWORD\", binddn=0xfdd07958, \nretvals=0xfdd07954) at util_ldap.c:764\n#3  0x335ac in mod_auth_ldap_check_user_id (r=0x179558) at mod_auth_ldap.c:366\n#4  0x802ac in ap_run_check_user_id (r=0x179558) at request.c:112\n#5  0x80b64 in ap_process_request_internal (r=0x179558) at request.c:259\n#6  0x54ac4 in ap_process_request (r=0x179558) at http_request.c:286\n#7  0x4ffb4 in ap_process_http_connection (c=0x173630) at http_core.c:293\n#8  0x74d50 in ap_run_process_connection (c=0x173630) at connection.c:85\n#9  0x66298 in process_socket (p=0x173508, sock=0x173540, my_child_num=0, \nmy_thread_num=0, \n    bucket_alloc=0x177518) at worker.c:632\n#10 0x669c0 in worker_thread (thd=0x115570, dummy=0x173508) at worker.c:946\n#11 0xfef9459c in dummy_worker (opaque=0x115570) at thread.c:127\n(gdb) \n", "is_private": false, "id": 47573, "creator": "dave@arcuri.us", "time": "2003-11-18T20:36:40Z", "bug_id": 18756, "creation_time": "2003-11-18T20:36:40Z", "attachment_id": null}, {"count": 46, "tags": [], "bug_id": 18756, "is_private": false, "text": "And again ... Wish I could edit comments.\n\nI manually defined APR_HAS_SHARED_MEMORY to be 0 and I successfully got the LDAP \ncache functionality to work without erroring.  The relevant file is \nmodules/experimental/util_ldap_cache_mgr.c.  You basically want it to use the \ncalloc() and free() functions instead of the apr_rmm_xxxx functions.\n\nI hope this points someone in the right direction to make a real fix, but if you \nabsolutely need this functionality, this is how you can get it.  Sorry, I have \nno official patch, because this is a temporary hack to get this to work in my \nenvironment.\n\nSolaris 8, OpenLDAP 2.1.23, Apache 2.0.48 (with Matthieu's patch)\n", "id": 47574, "time": "2003-11-18T21:11:45Z", "creator": "dave@arcuri.us", "creation_time": "2003-11-18T21:11:45Z", "attachment_id": null}, {"count": 47, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 47577, "time": "2003-11-18T21:23:43Z", "creator": "apache@moresecurity.org", "creation_time": "2003-11-18T21:23:43Z", "is_private": false, "text": "Hi,\n\nAs you said it's a hack to work in your environment.\nAdding and modifying the Tags for SHM just disabled it, and no, we have to \nmake it work with shm :)\n\nDisabling shm, you make the ldap cache not working well on threaded mpm. \nFor example, with worker mpm, you will have a cache context for all forked \nserver, and only thread inside will be able to use the cache, in each server.\n\nShared memory is providing a common cache data for all threaded and forked \nserver.\n\nSo yes, you did a hack to make it work, but it's not a solution here :)\nWhat i will do in the next patch is to display in debug mode, which memory \nmanagement it will use, and continue effort to make it stable.\n\nMatthieu\n\n"}, {"count": 48, "tags": [], "bug_id": 18756, "attachment_id": null, "is_private": false, "id": 47881, "time": "2003-11-21T22:17:30Z", "creator": "trawick@apache.org", "creation_time": "2003-11-21T22:17:30Z", "text": "enabling the PatchAvailable keyword\nupdated doc on submitting patches is at http://httpd.apache.org/dev/patches.html\n"}, {"count": 49, "tags": [], "bug_id": 18756, "text": "Hi all,\n\nmy Problem in this Kontext:\n\nif i add the line AuthLDAPURL in httpd.conf i cant start apache without SIGSEGV.\n\nSystem is:\nSolaris 8\ngcc 3.1\nhttpd 2.0.48\nopenssl 0.9.7c\nopenldap 2.1.25\n\nmy ConfigureScript looks like:\nLIBS=\"-L/opt/openldap/current/lib\" \\\nINCLUDES=\"-I/opt/openldap/current/include\" \\\n./configure \\\n--disable-autoindex \\\n--disable-asis \\\n--disable-userdir \\\n--disable-cgid \\\n--disable-cgi \\\n--disable-imap \\\n--enable-info \\\n--enable-proxy \\\n--enable-ssl \\\n--enable-headers \\\n--enable-ldap \\\n--enable-auth-ldap \\\n--with-ssl=/opt/openssl/current \\\n--with-ldap \\\n--with-mpm=worker \n\nhttpd.conf:\n------------------------------\n......\n........\nLDAPSharedCacheSize 200000\nLDAPCacheEntries 1024\nLDAPCacheTTL 600\nLDAPOpCacheEntries 1024\nLDAPOpCacheTTL 600\n\n<VirtualHost  10.1.1.11:443>\n    ServerName test\n....\n...\n    <Location /cbt>\n#\tAuthType Basic\n#\tAuthName cbt\n#\tAuthUserFile conf/auth_user_file\n#\trequire valid-user\n\n\tAuthLDAPEnabled on\n\tAuthLDAPAuthoritative on\n\tAuthLDAPURL \"ldap://ldap.net.de/c=DE\"\n\trequire valid-user\n    </Location>\n.........\n........\n.......\n</VirtualHost>\n-------------------------------------------\n\nwhen i uncomment the line:\n\nAuthLDAPURL \"ldap://ldap.net.de/c=DE\"\n\ni can start Apache.\n\n\nhere ist my Backtrace:\n-------------------------------------------\nGNU gdb 6.0\nCopyright 2003 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"sparc-sun-solaris2.8\"...\nCore was generated by `/opt/webservers/apache/test0/2.0.48/bin/httpd -k st'.\nProgram terminated with signal 11, Segmentation fault.\nReading symbols from /opt/webservers/apache/test0/2.0.48/lib/libaprutil-\n0.so.0...done.\nLoaded symbols for /opt/webservers/apache/test0/2.0.48/lib/libaprutil-0.so.0\nReading symbols from /usr/local/lib/libldapssl30.so...done.\nLoaded symbols for /usr/local/lib/libldapssl30.so\nReading symbols \nfrom /opt/webservers/apache/test0/2.0.48/lib/libexpat.so.0...done.\nLoaded symbols for /opt/webservers/apache/test0/2.0.48/lib/libexpat.so.0\nReading symbols from /usr/local/lib/libiconv.so.2...done.\nLoaded symbols for /usr/local/lib/libiconv.so.2\nReading symbols from /opt/webservers/apache/test0/2.0.48/lib/libapr-\n0.so.0...done.\nLoaded symbols for /opt/webservers/apache/test0/2.0.48/lib/libapr-0.so.0\nReading symbols from /lib/libsendfile.so.1...done.\nLoaded symbols for /lib/libsendfile.so.1\nReading symbols from /lib/librt.so.1...done.\nLoaded symbols for /lib/librt.so.1\nReading symbols from /lib/libm.so.1...done.\nLoaded symbols for /lib/libm.so.1\nReading symbols from /lib/libsocket.so.1...done.\nLoaded symbols for /lib/libsocket.so.1\nReading symbols from /lib/libnsl.so.1...done.\nLoaded symbols for /lib/libnsl.so.1\nReading symbols from /lib/libresolv.so.2...done.\nLoaded symbols for /lib/libresolv.so.2\nReading symbols from /lib/libdl.so.1...done.\nLoaded symbols for /lib/libdl.so.1\nReading symbols from /lib/libpthread.so.1...done.\nLoaded symbols for /lib/libpthread.so.1\nReading symbols from /lib/libc.so.1...done.\nLoaded symbols for /lib/libc.so.1\nReading symbols from /lib/libthread.so.1...done.\nLoaded symbols for /lib/libthread.so.1\nReading symbols from /lib/libaio.so.1...done.\nLoaded symbols for /lib/libaio.so.1\nReading symbols from /lib/libmp.so.2...done.\nLoaded symbols for /lib/libmp.so.2\nReading symbols from /usr/platform/SUNW,Ultra-250/lib/libc_psr.so.1...done.\nLoaded symbols for /usr/platform/SUNW,Ultra-250/lib/libc_psr.so.1\n#0  0xfee33174 in strlen () from /lib/libc.so.1\n(gdb) run\nStarting program: /opt/webservers/apache/test0/2.0.48/bin/httpd \n[New LWP 1]\n[New LWP 2]\n[New LWP 3]\n[New LWP 4]\n\nProgram received signal SIGSEGV, Segmentation fault.\n0xfee33174 in strlen () from /lib/libc.so.1\n(gdb) \n-------------------------------------------\n\n\nSo i read all the Reports, is there a Patch for this Problem ?? \nI read something about caching and shm but i dont really know, i think my Bug \nis a little diffrent.\n\nSteve Waltner had the same Problem in 2003 i think.\n\ni'd like to know what is happening with this bug ? its NEW since beginning of \n2003\n\nfriendly Regards\nChristian\n", "id": 52355, "time": "2004-02-16T15:52:45Z", "creator": "masro@llbc.de", "creation_time": "2004-02-16T15:52:45Z", "is_private": false, "attachment_id": null}, {"count": 50, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 52446, "time": "2004-02-17T16:40:45Z", "creator": "jessh@ptc.com", "creation_time": "2004-02-17T16:40:45Z", "is_private": false, "text": "Note: I still get the core dump when I apply the very latest (i.e. latest \navailable yesterday) sources from the Apache 2.0 branch.  On a positive note, \nthese just compile against 2.0.48 and don't have to be fiddled with (like those \nfrom Apache 2.1 did to work with 2.0.48).  Unfortunately, the core dump on \nfirst attempt to authenticate with the cache enabled is still there.\n\n[2.0.48, worker, Solaris 8]\n"}, {"count": 51, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 52447, "time": "2004-02-17T16:59:25Z", "creator": "jessh@ptc.com", "creation_time": "2004-02-17T16:59:25Z", "is_private": false, "text": "Backtrace (using latest 2.0 branch sources for util_ldap and mod_auth_ldap +\n2.0.48 base):\n\ncurrent thread: t@6\n=>[1] util_ald_create_cache(0xb7688, 0xfea53cb8, 0xfea53cd0, 0xfea53cf0,\n0xfea53e20, 0x148), at 0xfea54850\n  [2] util_ald_create_caches(), at 0xfea545e0\n  [2] util_ald_create_caches(0xb7688, 0xd81f0, 0x84da0, 0x0, 0xfea33623, 0x6e),\nat 0xfea545e0\n  [3] util_ldap_cache_checkuserid(r = 0x15b0c8, ldc = 0xfda00, url = 0xd81f0 \"ld\nap://jholle03l.ptcnet.ptc.com/ou=people,cn=pdm7,cn=jholle03l,cn=Application%20Se\nrvices,o=ptc\", basedn = 0xd8270 \"ou=people,cn=pdm7,cn=jholle03l,cn=Application S\nervices,o=ptc\", scope = 2, attrs = (nil), filter = 0xfd8058f0 \"(&(objectclass=*)\n(uid=wcadmin))\", bindpw = 0x15c5d0 \"wcadmin\", binddn = 0xfd8058e8, retvals =\n0xfd8058e4), line 725 in \"util_ldap.c\"\n  [4] mod_auth_ldap_check_user_id(r = 0x15b0c8), line 327 in \"mod_auth_ldap.c\"\n  [5] ap_run_check_user_id(0x15b0c8, 0x62c00, 0x0, 0x2d, 0x29, 0x15b248), at 0x4c784\n  [6] ap_process_request_internal(0x15b0c8, 0x0, 0x4, 0x15b0c8, 0x60000,\n0x15bdc8), at 0x4d0d0\n  [7] ap_process_request(0x15b0c8, 0xc8, 0x15b0c8, 0x14b178, 0x0, 0x0), at 0x321c0\n  [8] ap_process_http_connection(0x14b178, 0x2d55c, 0x79400, 0x79400, 0x0,\n0x14b1cd), at 0x2d5a8\n  [9] ap_run_process_connection(0x14b178, 0x80000000, 0x14b088, 0x1, 0x14b170,\n0x159088), at 0x40eec\n  [10] ap_process_connection(0x14b178, 0x14b088, 0x14b088, 0x1, 0x14b170,\n0x159088), at 0x411d8\n  [11] process_socket(0x14b178, 0x14b088, 0x0, 0x1, 0x159088, 0x0), at 0x335b8\n  [12] worker_thread(0x0, 0x1, 0x5c400, 0x5c400, 0x1117e, 0x9d410), at 0x33c98\n  [13] dummy_worker(0x9d410, 0xfebd5d10, 0x0, 0x5, 0x1, 0xfe401000), at 0xfef15838\n"}, {"count": 52, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "This appears to be triggering a gcc on Sparc bug -- read on...\n\nNote the backtrace given above was hard to obtain, e.g. I could only obtain it \nwhen *not* using maintainer mode on configure, etc.\n\nOnce I put breakpoints in the routine in question in each child process I \ncould single step through the assembly (for some reason I did not have source-\nlevel information even when building with maintainer mode enabled and thus -g -\n- pointers as to how this might happen would be appreciated) until it blew up.\n\nThe offending assembly instruction is 'std' (this is on Sparc Solaris 8) and \nthe error is an invalid alignment error.  This smelled of a compiler bug -- \nand sure enough google has lots of claims of various versions of gcc making 8-\nbyte alignment assumptions when it can't legitimately do so -- and then using \nldd and std instructions which require such alignment.  Thus seeing this only \nas assembly was not a bad thing -- except that I need to carefully verify \nwhich struct field its blowing up on...\n\nDoes anyone know of a gcc version that is known to have this error fixed?  \nAlternatively, does someone know of flags to pass gcc to work around this?  \nNote this error appears to be specific to -O2 optimization (which I removed \nfrom my configure env vars, but I can't seem to get rid of it).  Ideally the \nsource for this module or the gcc compilation options for just it (not all of \nApache) could be adjusted to skirt this issue.\n\nI'll be playing with the possibilities here...\n\n[I'm currently still using the ancient gcc 2.95.2 as it's what's already \ninstalled on the machine.]", "id": 52525, "time": "2004-02-19T02:47:36Z", "creator": "jessh@ptc.com", "creation_time": "2004-02-19T02:47:36Z", "is_private": false}, {"count": 53, "tags": [], "text": "I *believe* that the field causing issues (from the latest Apache 2 branch \nsources) is avg_purgetime.  I'll try replacing it with a float tomorrow as a \ndouble seems unnecessary (apart from an insignificant purge speed difference).", "is_private": false, "bug_id": 18756, "id": 52526, "time": "2004-02-19T03:09:06Z", "creator": "jessh@ptc.com", "creation_time": "2004-02-19T03:09:06Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 18756, "text": "Okay on a little further examination I am still getting an alignment bus error \nfrom an std instruction BUT it would appear all the structure offsets are 8-\nbyte aligned -- which I guess means the structure allocated by APR's rmm is \nnot?!?  If so, this would appear *not* to be the gcc bug.\n\nThis all seems hard to believe...\n\n[I applied the latest apr_rmm.c to no avail.]\n\nNote that diffing the rudedog.org and latest Apache 2 sources for \nutil_ldap_cache_mgr.c seems to indicate that the main switch in the routine \nthat's crashing is from MM to APR's rmm....", "count": 54, "id": 52622, "time": "2004-02-19T23:38:33Z", "creator": "jessh@ptc.com", "creation_time": "2004-02-19T23:38:33Z", "is_private": false}, {"count": 55, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 52692, "time": "2004-02-20T21:29:10Z", "creator": "jessh@ptc.com", "creation_time": "2004-02-20T21:29:10Z", "is_private": false, "text": "I have finally cried \"uncle\" for now (i.e. given up) and am simply replacing \nall \"#if APR_HAS_SHARED_MEMORY\" occurences with \"#if 0\" in the mod_ldap .c \nfiles (I left the headers alone).  This results in 1 LDAP cache per process.\n\nI was already using mod_worker, so now I'm just increasing the number of \nthreads per process a bit and thus limiting the number of processes and thus \nlimiting the number of redundant LDAP caches and entries.\n\nThe result seems to work just fine -- and should be faster than disabling the \ncache entirely."}, {"attachment_id": null, "tags": [], "bug_id": 18756, "text": "Has the issue where the apr_rmm_*alloc return values are ignored been fixed?", "count": 56, "id": 52696, "time": "2004-02-20T22:56:04Z", "creator": "jorton@redhat.com", "creation_time": "2004-02-20T22:56:04Z", "is_private": false}, {"count": 57, "tags": [], "bug_id": 18756, "attachment_id": null, "is_private": false, "id": 53239, "time": "2004-02-29T23:03:11Z", "creator": "gantzm@gantzgulch.com", "creation_time": "2004-02-29T23:03:11Z", "text": "Has an official fix for this bug been created?  I've been able to work around\nthis using the disable shared memory hack, but that is not an elegant solution.\n This bug does not appear in the httpd delivered with Fedora Core 1, but I need\nto compile my own, and am bouncing into this issue.\n\nAny help would be appreciated.\n"}, {"count": 58, "tags": [], "text": "Note: I got what appears to be the same exact crash with a mod_worker Apache \n2.0.48 + latest LDAP related patches from 2.0 branch (same stuff I tested on \nSolaris) built with iPlanet LDAP SDK.\n\nAs soon as I applied the patch to pretend shared memory does not exist in to \nthe module sources, it seemed to work fine...\n\nWhatever the problem is, shm, rmm, or mod/util_ldap, a fix would be *very* much \nappreciated!", "attachment_id": null, "bug_id": 18756, "id": 53452, "time": "2004-03-04T18:23:41Z", "creator": "jessh@ptc.com", "creation_time": "2004-03-04T18:23:41Z", "is_private": false}, {"count": 59, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 53453, "time": "2004-03-04T18:24:55Z", "creator": "jessh@ptc.com", "creation_time": "2004-03-04T18:24:55Z", "is_private": false, "text": "Ooops.  I forgot to include the most relevant piece of information in my last \ncomment.  The Apache I just tested was on AIX 5.1.  Thus this is by no means \nlimited to Solaris."}, {"count": 60, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 56962, "time": "2004-05-06T23:40:23Z", "creator": "chip@force-elite.com", "creation_time": "2004-05-06T23:40:23Z", "is_private": false, "text": "*** Bug 28716 has been marked as a duplicate of this bug. ***"}, {"count": 61, "tags": [], "text": "Can someone confirm whether this bug still bites using the latest LDAP from\nv2.1.0-dev? There have been a number of bugfix commits, I would like to know if\nthis bug has been squashed.\n", "is_private": false, "id": 57795, "creator": "minfrin@sharp.fm", "time": "2004-05-21T14:05:12Z", "bug_id": 18756, "creation_time": "2004-05-21T14:05:12Z", "attachment_id": null}, {"count": 62, "tags": [], "text": "I can confirm that this bug exists in 2.0.49 (with or without Brad Nicholes\nlatest changes to squash the authenticated LDAP access issues).  I have not\ntried 2.1.0 anything.\n\nAlso, the cache overflow crash is still present in 2.0.49.  [I forget the bug #,\nbut when more distinct users authenticate against Apache than what you've sized\nthe cache for the child process will die.  If this does not happen on cache size\n+ 1 users it always happens by cache size + 5 or so users.]\n\nSquashing these 2 issues would do wonders for LDAP authentication via Apache and\nwould, in my opinion, justify moving this module out of experimental.  Both of\nthese issues are pretty severe, however.  They don't preclude use of the module\nfor LDAP authentication, but they require some hefty workarounds (disabling\ncache sharing between processes and sizing the LDAP cache to hold your entire\nuser population -- which may be excessive).", "attachment_id": null, "id": 57796, "creator": "jessh@ptc.com", "time": "2004-05-21T14:16:20Z", "bug_id": 18756, "creation_time": "2004-05-21T14:16:20Z", "is_private": false}, {"count": 63, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "Note to all: this bug report is discussing many different bugs in the same\nplace. These include:\n\n- crash inside mod_auth_ldap_parse_url(): #21719\n- crash in LDAP cache util_ldap_search_node_copy(): #28250\n- crashes when distinct users exceeds LDAPCacheEntries: #24801\n\nI think it would be more helpful to continue the discussion under each specific\nreport above.\n", "id": 57846, "time": "2004-05-21T17:24:24Z", "creator": "minfrin@sharp.fm", "creation_time": "2004-05-21T17:24:24Z", "is_private": false}, {"count": 64, "tags": [], "text": "Hmmm...  I guess I don't know where exactly it crashes recently, but at least\none of my previous notes was of it crashing in util_ald_create_cache().\n\nIn any event, I consistently have it crash on the very first request requiring\nLDAP authentication (with 2.0.49 on Solaris and AIX, but not on Windows)\nunless/until I disable sharing of the caches across processes -- at which point\nI only have the cache overflow issue, which I agree is a very separate and\ndistinct bug.", "attachment_id": null, "bug_id": 18756, "id": 57848, "time": "2004-05-21T17:30:15Z", "creator": "jessh@ptc.com", "creation_time": "2004-05-21T17:30:15Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 18756, "is_private": false, "count": 65, "id": 57891, "time": "2004-05-22T01:34:29Z", "creator": "minfrin@sharp.fm", "creation_time": "2004-05-22T01:34:29Z", "text": "So if I am understanding right, sharing across processes causes an immediate\ncrash, while sharing across threads works - until the cache is full, then crash?\n"}, {"count": 66, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "Try this patch attached to bug 24801:\nhttp://nagoya.apache.org/bugzilla/showattachment.cgi?attach_id=11633", "id": 57895, "time": "2004-05-22T02:09:35Z", "creator": "minfrin@sharp.fm", "creation_time": "2004-05-22T02:09:35Z", "is_private": false}, {"count": 67, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "Yep!", "id": 57933, "time": "2004-05-23T19:55:08Z", "creator": "jessh@ptc.com", "creation_time": "2004-05-23T19:55:08Z", "is_private": false}, {"count": 68, "tags": [], "bug_id": 18756, "text": "Yup the patch works, or yup that was the problem...? :)\n", "id": 57937, "time": "2004-05-23T20:34:13Z", "creator": "minfrin@sharp.fm", "creation_time": "2004-05-23T20:34:13Z", "is_private": false, "attachment_id": null}, {"count": 69, "tags": [], "bug_id": 18756, "attachment_id": null, "id": 57963, "time": "2004-05-24T13:49:56Z", "creator": "jessh@ptc.com", "creation_time": "2004-05-24T13:49:56Z", "is_private": false, "text": "Yup, that was the problem.\n\nI've not had a chance to test the patch yet.\n\nI will try to get to it today."}, {"count": 70, "tags": [], "bug_id": 18756, "attachment_id": null, "text": "Patches for fixing the segfaults have been applied to v2.1.0-dev and v2.0.50-dev.\n\nThe underlying brokenness that caused the segfaults remains however, and is\ndescribed in bug 29207. I'm marking this bug as a duplicate of that one to\ncontinue getting to the root of the problem.\n\n\n*** This bug has been marked as a duplicate of 29207 ***", "id": 58066, "time": "2004-05-25T17:20:04Z", "creator": "minfrin@sharp.fm", "creation_time": "2004-05-25T17:20:04Z", "is_private": false}]
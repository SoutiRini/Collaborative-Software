[{"count": 0, "tags": [], "bug_id": 28904, "is_private": false, "id": 57209, "attachment_id": null, "creator": "ben@newview.co.uk", "creation_time": "2004-05-11T17:19:00Z", "time": "2004-05-11T17:19:00Z", "text": "I am trying to create a page that uploads an image from a client machine using a \nmultipart form. This is part of a process of moving a site over from an old \nserver running jdk 1.3 and tomcat 3.3.2 where this page worked correctly.\n\nI found that using the com.oreilly.servlets package I was getting a 500 error \n(in spite of the fact I was making sure I was doing everything inside a \ntry/catch block which should have enabled me to catch any errors thrown by it) \nand I thought it may be the fault of the package so I switched to the commons \nFileUpload package but I got exactly the same error message.\n\nHere is a sample jsp that should enable you to reproduce the error - it requires \nthe presence of the org.apache.commons.fileupload package.\n<%@page import=\"org.apache.commons.fileupload.*\"%>\n<%\n   \n    System.out.println(\"request data: \");\n    System.out.println(\"    > method: \" + request.getMethod());\n    Enumeration ender = request.getHeaderNames();\n    while (ender.hasMoreElements())\n    {\n        String box = (String) ender.nextElement();\n        System.out.println(\"     > \" + box + \": \" + request.getHeader(box));\n    }\n    System.out.println(\"is it multipart?\");\n    System.out.println( \"the answer is: \"+FileUpload.isMultipartContent(request) \n);\n<html>\n<head><title>Test Page</title></head>\n<body>\n<p>Multipart test, see catalina.out for more information.</p>\n</body>\n</html>\n\nThis compiles fine on the live system and catalina.out contains all the System.\nout messages until I actually make the request to FileUpload.\nisMultipartRequest() whereupon the whole thing falls over, producing a massive \nerror stack that makes no reference to the fileupload stuff at all. The header \nlisting is probably extraneous but is useful to check whether it is working at \nall.\n\nOn my development machine, running tomcat 4.0 it works correctly.\n\nThe live system is running on Redhat Enterprise with Tomcat connected to Apache \n2.0.46 through an Ajp13 connector. Other jsps are running without a problem.\n\nI've tried pretty much everything I can think of and I'm pretty much at my wits \nend to find a working solution here.\n\nThis is the error stack I receive:\n\ndescription The server encountered an internal error () that prevented it from \nfulfilling this request.\n\nexception \n\norg.apache.jasper.JasperException: javax/servlet/ServletInputStream\nat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:\n254)\nat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)\nat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\nat org.apache.catalina.core.ApplicationFilterChain.\ninternalDoFilter(ApplicationFilterChain.java:247)\nat org.apache.catalina.core.ApplicationFilterChain.\ndoFilter(ApplicationFilterChain.java:193)\nat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.\njava:256)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:643)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\nat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\nat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.\njava:191)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:643)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\nat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\nat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2422)\nat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:643)\nat org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.\njava:171)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:641)\nat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:163)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:641)\nat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:577)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:641)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\nat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\nat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:\n174)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:643)\nat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:577)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:641)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\nat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\nat org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:199)\nat org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:324)\nat org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:395)\nat org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)\nat org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:615)\nat org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)\nat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.\njava:683)\nat java.lang.Thread.run(Thread.java:534)\n\nroot cause \n\njavax.servlet.ServletException: javax/servlet/ServletInputStream\nat org.apache.jasper.runtime.PageContextImpl.\nhandlePageException(PageContextImpl.java:536)\nat org.apache.jsp.imageUploader1_jsp._jspService(imageUploader1_jsp.java:128)\nat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:137)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\nat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:\n210)\nat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:295)\nat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:241)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\nat org.apache.catalina.core.ApplicationFilterChain.\ninternalDoFilter(ApplicationFilterChain.java:247)\nat org.apache.catalina.core.ApplicationFilterChain.\ndoFilter(ApplicationFilterChain.java:193)\nat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.\njava:256)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:643)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\nat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\nat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.\njava:191)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:643)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\nat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\nat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2422)\nat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:643)\nat org.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.\njava:171)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:641)\nat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:163)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:641)\nat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:577)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:641)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\nat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\nat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:\n174)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:643)\nat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:577)\nat org.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.\ninvokeNext(StandardPipeline.java:641)\nat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\nat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\nat org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:199)\nat org.apache.jk.server.JkCoyoteHandler.invoke(JkCoyoteHandler.java:324)\nat org.apache.jk.common.HandlerRequest.invoke(HandlerRequest.java:395)\nat org.apache.jk.common.ChannelSocket.invoke(ChannelSocket.java:673)\nat org.apache.jk.common.ChannelSocket.processConnection(ChannelSocket.java:615)\nat org.apache.jk.common.SocketConnection.runIt(ChannelSocket.java:786)\nat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.\njava:683)\nat java.lang.Thread.run(Thread.java:534)"}, {"count": 1, "tags": [], "bug_id": 28904, "attachment_id": null, "id": 57968, "time": "2004-05-24T14:19:06Z", "creator": "ben@newview.co.uk", "creation_time": "2004-05-24T14:19:06Z", "is_private": false, "text": "I am working around this by using a servlet to handle multipart requests, which \nappears to work correctly and implies a problem with the JSP compilation even \nmore strongly. I took a look at the source code, but I don't really understand \ntomcat well enough to be able to find anything."}, {"count": 2, "text": "I have tested this with a simple JSP using the latest tomcat sources and it works.\n\nGiven that it works for you with a servlet I don't think the Apache-Tomcat\nconnector is an issue.\n\nHowever, if you still see this with the latest version of Tomcat 4.1.x and the\nlatest JK connector, please re-open this bug.", "bug_id": 28904, "is_private": false, "id": 69509, "time": "2005-01-10T22:28:27Z", "creator": "markt@apache.org", "creation_time": "2005-01-10T22:28:27Z", "tags": [], "attachment_id": null}]
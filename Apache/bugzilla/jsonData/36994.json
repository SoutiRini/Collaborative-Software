[{"attachment_id": null, "tags": [], "bug_id": 36994, "is_private": false, "count": 0, "id": 80958, "time": "2005-10-10T17:15:43Z", "creator": "lbe.tech@spree.de", "creation_time": "2005-10-10T17:15:43Z", "text": "After a http session is invalidated a call to getId() throws an\nIllegalStateException(\"already invalidated\").\n\nI think this doesn't conform to the servlet spec that doesn't say anything about\nan ISE in the api doc. All ISEs that can be thrown by the session-methods are\nexplicit listed.\n\nBeside this it is very essential to have the sessionId at least during\nHttpSessionBindingListener.valueUnbound() if this method is called during the\ninvalidation.\nThe api doc of valueUnbound() says:\n\"Notifies the object that it is being unbound from a session and identifies the\nsession.\"\nThe session is identified by its Id, but if the Id is not accessible anymore...\n\nThe ISE was inserted in Version 5.5.10: excerpt from the changelog:\n\"Re-add patch causing Session.getId to throw an ISE, and make all internal\ncomponents use a safe getIdInternal\"\n\n\nThanks\nLars"}, {"count": 1, "tags": [], "bug_id": 36994, "text": "I agree with Lars.\nI use a Map (stored as an attribute of the ServletContext) to keep track of the\nactive http sessions.\nUsing Tomcat 5.5.9 I didn't have any problem logging-out, but with Tomcat 5.5.12\nwhen I try to invalidate a session I get an ISE (\"getId: Session already\ninvalidated\").\n\n(In reply to comment #0)\n> After a http session is invalidated a call to getId() throws an\n> IllegalStateException(\"already invalidated\").\n> \n> I think this doesn't conform to the servlet spec that doesn't say anything about\n> an ISE in the api doc. All ISEs that can be thrown by the session-methods are\n> explicit listed.\n> \n> Beside this it is very essential to have the sessionId at least during\n> HttpSessionBindingListener.valueUnbound() if this method is called during the\n> invalidation.\n> The api doc of valueUnbound() says:\n> \"Notifies the object that it is being unbound from a session and identifies the\n> session.\"\n> The session is identified by its Id, but if the Id is not accessible anymore...\n> \n> The ISE was inserted in Version 5.5.10: excerpt from the changelog:\n> \"Re-add patch causing Session.getId to throw an ISE, and make all internal\n> components use a safe getIdInternal\"\n> \n> \n> Thanks\n> Lars\n\n", "id": 81002, "time": "2005-10-11T17:15:13Z", "creator": "perlitip@dpinfo.it", "creation_time": "2005-10-11T17:15:13Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 36994, "attachment_id": null, "is_private": false, "id": 81003, "time": "2005-10-11T19:19:30Z", "creator": "william.barker@wilshire.com", "creation_time": "2005-10-11T19:19:30Z", "text": "This is now required by the servlet spec, so it can't be changed by Tomcat. \nSee:\nhttp://jcp.org/aboutJava/communityprocess/maintenance/jsr154/154errata.txt\n\nIf the Servlet Expert Group decides to change this at some future point, then \nTomcat can consider removing the ISE.  Until then, the only place to complain \nabout this is:  servletapi-feedback@eng.sun.com"}, {"attachment_id": null, "tags": [], "bug_id": 36994, "text": "Hi William, the servlet spec 2.4 doesn't throw the ISE. The new servlet spec 2.5\nthrows the ISE. So that's a change between 2.4 and 2.5. Strange on this is, that\nthis change isn't listed in der change list between 2.4 and 2.5.\n\nI know that in the future the ISE will come, but the TC homepage says that the\ncurrent TC 5.5 is an impl for the final 2.4 spec - not for the non-final 2.5 spec.\n", "count": 3, "id": 81035, "time": "2005-10-12T14:34:15Z", "creator": "lbe.tech@spree.de", "creation_time": "2005-10-12T14:34:15Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 36994, "text": "(In reply to comment #3)\n> Hi William, the servlet spec 2.4 doesn't throw the ISE. The new servlet spec 2.5\n> throws the ISE. So that's a change between 2.4 and 2.5. Strange on this is, that\n> this change isn't listed in der change list between 2.4 and 2.5.\n> \n> I know that in the future the ISE will come, but the TC homepage says that the\n> current TC 5.5 is an impl for the final 2.4 spec - not for the non-final 2.5 spec.\n> \n\nNo the spec didn't change. However, it turned out that getId should have thrown\nan ISE, while in Tomcat it did not. If you want to work around it, you can\nmodify the Tomcat code easily.\n\nhttp://jcp.org/aboutJava/communityprocess/maintenance/jsr154/errata204.txt\n", "count": 4, "id": 81036, "time": "2005-10-12T14:41:50Z", "creator": "remm@apache.org", "creation_time": "2005-10-12T14:41:50Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 36994, "is_private": false, "text": "To let me come to an end, I think slowly I got it. The errata belongs to the 2.4\nspec. The correct german translation of \"errata\" was very helpful :-)\n\nUnfortunatly I could not find (easily) any official spec-2.4-document about the\ngetId/ISE on javasoft.com or any document that refers to your explicit link.\n\nThanks \nLars\n", "id": 81102, "time": "2005-10-13T10:17:22Z", "creator": "lbe.tech@spree.de", "creation_time": "2005-10-13T10:17:22Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "creator": "chr.seiler@web.de", "is_private": false, "count": 6, "id": 83890, "time": "2005-12-21T19:10:39Z", "bug_id": 36994, "creation_time": "2005-12-21T19:10:39Z", "text": "I think this is a serious issue, the change will beak many systems. For instance\nit breaks the use of OSCache:\n\njava.lang.IllegalStateException: getId: Session already invalidated\n        at\norg.apache.catalina.session.StandardSession.getId(StandardSession.java:328)\n        at\norg.apache.catalina.session.StandardSessionFacade.getId(StandardSessionFacade.java:78)\n        at\ncom.opensymphony.oscache.web.ServletCache.valueUnbound(ServletCache.java:96)\n        at\norg.apache.catalina.session.StandardSession.removeAttributeInternal(StandardSession.java:1607)\n        at\norg.apache.catalina.session.StandardSession.expire(StandardSession.java:737)\n        at\norg.apache.catalina.session.StandardSession.expire(StandardSession.java:643)\n        at\norg.apache.catalina.session.StandardSession.invalidate(StandardSession.java:1088)\n        at\norg.apache.catalina.session.StandardSessionFacade.invalidate(StandardSessionFacade.java:149)\n\nObtaining, patching and building each new version is not really an option to me"}, {"count": 7, "tags": [], "creator": "ltorunski@t-online.de", "attachment_id": null, "text": "(In reply to comment #5)\n> No the spec didn't change. However, it turned out that getId should have thrown\n> an ISE, while in Tomcat it did not. If you want to work around it, you can\n> modify the Tomcat code easily.\n> \n> http://jcp.org/aboutJava/communityprocess/maintenance/jsr154/errata204.txt\n> \n\nThe final 2.4 spec.\nhttp://jcp.org/aboutJava/communityprocess/final/jsr154/index.html doesn't\ncontain no information that HttpSession::getId() may throw the ISE.\n\nIn the current maintenance draft review\nhttp://jcp.org/aboutJava/communityprocess/maintenance/jsr154/index3.html the ISE\nis documented.\n\nIn my opinion this change will have a deep impact to a lot of frameworks which\ne.g. try to access the session's id to remove it from a HashMap.", "id": 83930, "time": "2005-12-22T21:19:43Z", "bug_id": 36994, "creation_time": "2005-12-22T21:19:43Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 36994, "text": "The JSR-154 Expert Group has reversed themselves on this issue.\n\nFrom page 289 of Maintenance Draft Review 4 of the Servlet 2.4 Specification (\nobtained from http://jcp.org/en/jsr/detail?id=154):\n\nSRV.17.0.3 Removal of IllegalStateException from HttpSession.getId()\n\nThe HttpSessionBindingListener calls the valueUnbound event after the session\nhas been expired, unfortunately, the HttpSession.getId() method is often used in\nthis scenario and is supposed to throw an IllegalStateException. The servlet EG\nagreed to remove the exception from the API to prevent these types of exceptions.", "id": 86698, "time": "2006-03-10T22:15:25Z", "creator": "jlewis@unicon.net", "creation_time": "2006-03-10T22:15:25Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 36994, "is_private": false, "count": 9, "id": 86699, "time": "2006-03-10T22:21:09Z", "creator": "jlewis@unicon.net", "creation_time": "2006-03-10T22:21:09Z", "text": "Looks like Remy already addressed this issue in 5.5.16 -- from the change log:\n\nHttpSession.getId will no longer throw an ISE when the session is invalid (remm)\n"}]
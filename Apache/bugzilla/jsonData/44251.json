[{"count": 0, "tags": [], "bug_id": 44251, "attachment_id": null, "text": "The ap_proxy_connect_backend() function currently considers only the\nworker->timeout and server->timeout settings when setting the socket timeout. As\na result a configuration such as\n\nProxyPass / http://www.marden.org/ timeout=10\n\ncan be configured to have a specific timeout value, but this does not work:\n\nProxyTimeout 10\nRewriteRule /(.*) http://www.marden.org/$1 [P,L]\n\nCurrently the only workaround is to use the Timeout (server timeout) value to\nconfigure this behavior - which is not ideal in all cases (c.f. bug 43598).\n\nAttached is a simple patch that would consider the mod_proxy ProxyTimeout\nconfiguration in deference to the worker config but in preference to the server\nconfig.\n\n--- httpd-2.2.4.orig/modules/proxy/proxy_util.c\t2006-12-19 13:56:16.000000000 -0800\n+++ httpd-2.2.4/modules/proxy/proxy_util.c\t2008-01-13 05:38:42.000000000 -0800\n@@ -1990,6 +1990,7 @@\n     int loglevel;\n     apr_sockaddr_t *backend_addr = conn->addr;\n     apr_socket_t *newsock;\n+    proxy_server_conf *conf;\n \n     if (conn->sock) {\n         /*\n@@ -2032,11 +2033,24 @@\n #endif\n \n         /* Set a timeout on the socket */\n+        conf = (proxy_server_conf *) ap_get_module_config(s->module_config,\n&proxy_module);\n         if (worker->timeout_set == 1) {\n-            apr_socket_timeout_set(newsock, worker->timeout);\n+             apr_socket_timeout_set(newsock, worker->timeout);\n+             ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,\n+                          \"proxy: %s: Set timeout to %d from worker config\",\n+                          proxy_function, worker->timeout );\n+        }\n+        else if( conf && conf->timeout ) {\n+             apr_socket_timeout_set(newsock, conf->timeout);\n+             ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,\n+                          \"proxy: %s: Set timeout to %d from mod_proxy config\",\n+                          proxy_function, conf->timeout );\n         }\n         else {\n              apr_socket_timeout_set(newsock, s->timeout);\n+             ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,\n+                          \"proxy: %s: Set timeout to %d from server config\",\n+                          proxy_function, s->timeout );\n         }\n         /* Set a keepalive option */\n         if (worker->keepalive) {", "id": 112917, "time": "2008-01-16T10:53:31Z", "creator": "nick@marden.org", "creation_time": "2008-01-16T10:53:31Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 44251, "is_private": false, "id": 112920, "time": "2008-01-16T11:50:40Z", "creator": "rpluem@apache.org", "creation_time": "2008-01-16T11:50:40Z", "tags": [], "text": "This is already fixed in 2.2.6. Please upgrade and if you can wait a few days\nyou will be even able to update to 2.2.8."}]
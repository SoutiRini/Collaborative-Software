[{"count": 0, "tags": [], "bug_id": 47070, "attachment_id": null, "id": 126424, "time": "2009-04-21T22:50:15Z", "creator": "kostjn@peterhost.ru", "creation_time": "2009-04-21T22:50:15Z", "is_private": false, "text": "I`m get crash apache.\nBacktrace \nGNU gdb 6.1.1 [FreeBSD]\nCopyright 2004 Free Software Foundation, Inc.\nGDB is free software, covered by the GNU General Public License, and you are\nwelcome to change it and/or distribute copies of it under certain conditions.\nType \"show copying\" to see the conditions.\nThere is absolutely no warranty for GDB.  Type \"show warranty\" for details.\nThis GDB was configured as \"i386-marcel-freebsd\"...\n\nwarning: exec file is newer than core file.\nCore was generated by `httpd'.\nProgram terminated with signal 11, Segmentation fault.\nReading symbols from /lib/libcrypt.so.3...done.\nLoaded symbols for /lib/libcrypt.so.3\nReading symbols from /usr/local/lib/libexpat.so.6...done.\nLoaded symbols for /usr/local/lib/libexpat.so.6\nReading symbols from /lib/libutil.so.5...done.\nLoaded symbols for /lib/libutil.so.5\nReading symbols from /usr/local/lib/libsqlite3.so.8...done.\nLoaded symbols for /usr/local/lib/libsqlite3.so.8\nReading symbols from /lib/libc.so.6...done.\nLoaded symbols for /lib/libc.so.6\nReading symbols from /usr/local/libexec/apache/mod_env.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_env.so\nReading symbols from /usr/local/libexec/apache/mod_log_config.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_log_config.so\nReading symbols from /usr/local/libexec/apache/mod_mime_magic.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_mime_magic.so\nReading symbols from /usr/local/libexec/apache/mod_mime.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_mime.so\nReading symbols from /usr/local/libexec/apache/mod_negotiation.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_negotiation.so\nReading symbols from /usr/local/libexec/apache/mod_status.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_status.so\nReading symbols from /usr/local/libexec/apache/mod_info.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_info.so\nReading symbols from /usr/local/libexec/apache/mod_include.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_include.so\nReading symbols from /usr/local/libexec/apache/mod_autoindex.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_autoindex.so\nReading symbols from /usr/local/libexec/apache/mod_dir.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_dir.so\nReading symbols from /usr/local/libexec/apache/mod_cgi.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_cgi.so\nReading symbols from /usr/local/libexec/apache/mod_actions.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_actions.so\nReading symbols from /usr/local/libexec/apache/mod_speling.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_speling.so\nReading symbols from /usr/local/libexec/apache/mod_alias.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_alias.so\nReading symbols from /usr/local/libexec/apache/mod_rewrite.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_rewrite.so\nReading symbols from /usr/local/libexec/apache/mod_access.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_access.so\nReading symbols from /usr/local/libexec/apache/mod_auth.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_auth.so\nReading symbols from /usr/local/libexec/apache/mod_expires.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_expires.so\nReading symbols from /usr/local/libexec/apache/mod_headers.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_headers.so\nReading symbols from /usr/local/libexec/apache/mod_setenvif.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_setenvif.so\nReading symbols from /usr/local/libexec/apache/libphp5.so...done.\nLoaded symbols for /usr/local/libexec/apache/libphp5.so\nReading symbols from /usr/lib/libssl.so.4...done.\nLoaded symbols for /usr/lib/libssl.so.4\nReading symbols from /lib/libcrypto.so.4...done.\nLoaded symbols for /lib/libcrypto.so.4\nReading symbols from /lib/libm.so.4...done.\nLoaded symbols for /lib/libm.so.4\nReading symbols from /usr/local/lib/libxml2.so.5...done.\nLoaded symbols for /usr/local/lib/libxml2.so.5\nReading symbols from /lib/libz.so.3...done.\nLoaded symbols for /lib/libz.so.3\nReading symbols from /usr/local/lib/libiconv.so.3...done.\nLoaded symbols for /usr/local/lib/libiconv.so.3\nReading symbols from /usr/local/libexec/apache/mod_extract_forwarded.so...done.\nLoaded symbols for /usr/local/libexec/apache/mod_extract_forwarded.so\nReading symbols from /usr/local/php5/lib/php/20060613/ZendExtensionManager.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/ZendExtensionManager.so\nReading symbols from /usr/local/php5/lib/php/20060613/bcmath.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/bcmath.so\nReading symbols from /usr/local/php5/lib/php/20060613/bz2.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/bz2.so\nReading symbols from /usr/lib/libbz2.so.2...done.\nLoaded symbols for /usr/lib/libbz2.so.2\nReading symbols from /usr/local/php5/lib/php/20060613/calendar.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/calendar.so\nReading symbols from /usr/local/php5/lib/php/20060613/ctype.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/ctype.so\nReading symbols from /usr/local/php5/lib/php/20060613/curl.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/curl.so\nReading symbols from /usr/local/lib/libcurl.so.5...done.\nLoaded symbols for /usr/local/lib/libcurl.so.5\nReading symbols from /usr/local/php5/lib/php/20060613/dba.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/dba.so\nReading symbols from /usr/local/php5/lib/php/20060613/dbase.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/dbase.so\nReading symbols from /usr/local/php5/lib/php/20060613/dom.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/dom.so\nReading symbols from /usr/local/php5/lib/php/20060613/exif.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/exif.so\nReading symbols from /usr/local/php5/lib/php/20060613/ftp.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/ftp.so\nReading symbols from /usr/local/php5/lib/php/20060613/gd.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/gd.so\nReading symbols from /usr/local/lib/libt1.so.5...done.\nLoaded symbols for /usr/local/lib/libt1.so.5\nReading symbols from /usr/local/lib/libfreetype.so.9...done.\nLoaded symbols for /usr/local/lib/libfreetype.so.9\nReading symbols from /usr/local/lib/libpng.so.5...done.\nLoaded symbols for /usr/local/lib/libpng.so.5\nReading symbols from /usr/local/lib/libjpeg.so.9...done.\nLoaded symbols for /usr/local/lib/libjpeg.so.9\nReading symbols from /usr/local/php5/lib/php/20060613/gettext.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/gettext.so\nReading symbols from /usr/local/lib/libintl.so.8...done.\nLoaded symbols for /usr/local/lib/libintl.so.8\nReading symbols from /usr/local/php5/lib/php/20060613/iconv.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/iconv.so\nReading symbols from /usr/local/php5/lib/php/20060613/mbstring.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/mbstring.so\nReading symbols from /usr/local/php5/lib/php/20060613/mcrypt.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/mcrypt.so\nReading symbols from /usr/local/lib/libmcrypt.so.8...done.\nLoaded symbols for /usr/local/lib/libmcrypt.so.8\nReading symbols from /usr/local/lib/libltdl.so.4...done.\nLoaded symbols for /usr/local/lib/libltdl.so.4\nReading symbols from /usr/local/php5/lib/php/20060613/mhash.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/mhash.so\nReading symbols from /usr/local/lib/libmhash.so.2...done.\nLoaded symbols for /usr/local/lib/libmhash.so.2\nReading symbols from /usr/local/php5/lib/php/20060613/mysql.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/mysql.so\nReading symbols from /usr/local/lib/mysql/libmysqlclient.so.14...done.\nLoaded symbols for /usr/local/lib/mysql/libmysqlclient.so.14\nReading symbols from /usr/local/php5/lib/php/20060613/zlib.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/zlib.so\nReading symbols from /usr/local/php5/lib/php/20060613/pdo.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/pdo.so\nReading symbols from /usr/local/php5/lib/php/20060613/pdo_sqlite.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/pdo_sqlite.so\nReading symbols from /usr/local/php5/lib/php/20060613/pdo_mysql.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/pdo_mysql.so\nReading symbols from /usr/local/php5/lib/php/20060613/posix.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/posix.so\nReading symbols from /usr/local/php5/lib/php/20060613/readline.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/readline.so\nReading symbols from /usr/lib/libhistory.so.6...done.\nLoaded symbols for /usr/lib/libhistory.so.6\nReading symbols from /lib/libreadline.so.6...done.\nLoaded symbols for /lib/libreadline.so.6\nReading symbols from /lib/libncurses.so.6...done.\nLoaded symbols for /lib/libncurses.so.6\nReading symbols from /usr/local/php5/lib/php/20060613/session.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/session.so\nReading symbols from /usr/local/php5/lib/php/20060613/simplexml.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/simplexml.so\nReading symbols from /usr/local/php5/lib/php/20060613/soap.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/soap.so\nReading symbols from /usr/local/php5/lib/php/20060613/sockets.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/sockets.so\nReading symbols from /usr/local/php5/lib/php/20060613/spl.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/spl.so\nReading symbols from /usr/local/php5/lib/php/20060613/tokenizer.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/tokenizer.so\nReading symbols from /usr/local/php5/lib/php/20060613/xml.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/xml.so\nReading symbols from /usr/local/php5/lib/php/20060613/wddx.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/wddx.so\nReading symbols from /usr/local/php5/lib/php/20060613/xmlreader.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/xmlreader.so\nReading symbols from /usr/local/php5/lib/php/20060613/xmlrpc.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/xmlrpc.so\nReading symbols from /usr/local/php5/lib/php/20060613/xmlwriter.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/xmlwriter.so\nReading symbols from /usr/local/php5/lib/php/20060613/xsl.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/xsl.so\nReading symbols from /usr/local/lib/libexslt.so.8...done.\nLoaded symbols for /usr/local/lib/libexslt.so.8\nReading symbols from /usr/local/lib/libxslt.so.2...done.\nLoaded symbols for /usr/local/lib/libxslt.so.2\nReading symbols from /usr/local/php5/lib/php/20060613/zip.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/zip.so\nReading symbols from /usr/local/php5/lib/php/20060613/mysqli.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/mysqli.so\nReading symbols from /usr/local/php5/lib/php/20060613/hash.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/hash.so\nReading symbols from /usr/local/php5/lib/php/20060613/json.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/json.so\nReading symbols from /usr/local/php5/lib/php/20060613/eaccelerator.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/eaccelerator.so\nReading symbols from /usr/local/php5/lib/php/20060613/Optimizer/php-5.2.x/ZendOptimizer.so...done.\nLoaded symbols for /usr/local/php5/lib/php/20060613/Optimizer/php-5.2.x/ZendOptimizer.so\nReading symbols from /libexec/ld-elf.so.1...done.\nLoaded symbols for /libexec/ld-elf.so.1\n#0  ap_rflush (r=0x842a3bc) at http_protocol.c:2824\n2824\thttp_protocol.c: No such file or directory.\n\tin http_protocol.c\n(gdb) btfull\nUndefined command: \"btfull\".  Try \"help\".\n(gdb) bt full\n#0  ap_rflush (r=0x842a3bc) at http_protocol.c:2824\nNo locals.\n#1  0x383d9474 in sapi_flush () at /home/subadm/ports/lang/php5/work/php-5.2.8/main/SAPI.c:922\nNo locals.\n#2  0x383d3102 in php_module_shutdown () at /home/subadm/ports/lang/php5/work/php-5.2.8/main/main.c:1904\nNo locals.\n#3  0x383d31bb in php_module_shutdown_wrapper (sapi_globals=0x385329c0)\n    at /home/subadm/ports/lang/php5/work/php-5.2.8/main/main.c:1877\nNo locals.\n#4  0x08053ff3 in ap_child_exit_modules (p=0x841d00c, s=0x808d034) at http_config.c:1637\n\tm = (module *) 0x38532880\n#5  0x0805945d in clean_child_exit (code=0) at http_main.c:546\nNo locals.\n#6  0x0805a91b in child_main (child_num_arg=138580020) at http_main.c:4927\n\tconn_io = (BUFF *) 0x8\n\tr = (request_rec *) 0xc3\n\tclen = 16\n\tsa_server = {sa_len = 16 '\\020', sa_family = 2 '\\002', \n  sa_data = \"\\000P\\177\\000\\000\\001\\000\\000\\000\\000\\000\\000\\000\"}\n\tsa_client = {sa_len = 16 '\\020', sa_family = 2 '\\002', \n  sa_data = \"\u0422\\037\\177\\000\\000\\001\\000\\000\\000\\000\\000\\000\\000\"}\n#7  0x0805ae77 in make_child (s=0x1e, slot=123, now=944275504) at http_main.c:5071\n\tpid = 0\n#8  0x0805c2d6 in standalone_main (argc=0, argv=0x38488030) at http_main.c:5272\n\tps = (parent_score *) 0x1\n\tremaining_children_to_start = 0\n#9  0x0805cd10 in main (argc=1, argv=0xbfbfeca0) at http_main.c:5795\n\tc = 0\n\tsock_in = -1077941088\n\tsock_out = 940043145\n\ts = 0x0\n\n-------------------------------------------------------------------------\nuname -a\nFreeBSD point.z8.ru 6.4-RELEASE-p3 FreeBSD 6.4-RELEASE-p3 #0: Mon Mar 23 15:01:39 MSK 2009     root@build.pht:/usr/src/sys/i386/compile/VH_6.4_32_01  i386\n-------------------------------------------------------------------------\n/usr/local/sbin/httpd -V\nServer version: Apache/1.3.41 (Unix)\nServer built:   Apr 21 2009 09:35:38\nServer's Module Magic Number: 19990320:18\nServer compiled with....\n -D BIG_SECURITY_HOLE\n -D HAVE_MMAP\n -D USE_MMAP_SCOREBOARD\n -D USE_MMAP_FILES\n -D HAVE_FLOCK_SERIALIZED_ACCEPT\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D DYNAMIC_MODULE_LIMIT=64\n -D HARD_SERVER_LIMIT=512\n -D SO_ACCEPTFILTER\n -D ACCEPT_FILTER_NAME=\"httpready\"\n -D HTTPD_ROOT=\"/usr/local\"\n -D SUEXEC_BIN=\"/usr/local/sbin/suexec\"\n -D DEFAULT_PIDLOG=\"/var/run/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"/var/run/httpd.scoreboard\"\n -D DEFAULT_LOCKFILE=\"/var/run/httpd.lock\"\n -D DEFAULT_ERRORLOG=\"/var/log/httpd-error.log\"\n -D TYPES_CONFIG_FILE=\"etc/apache/mime.types\"\n -D SERVER_CONFIG_FILE=\"etc/apache/httpd.conf\"\n -D ACCESS_CONFIG_FILE=\"etc/apache/access.conf\"\n -D RESOURCE_CONFIG_FILE=\"etc/apache/srm.conf\"\n------------------------------------------------------------\nI`m write simple patch to avoid this problem\n\n--- /usr/ports/www/apache13/work/apache_1.3.41/src/main/http_protocol.c\t2006-07-12 12:16:05.000000000 +0400\n+++ ./src/main/http_protocol.c\t2009-04-21 09:33:44.000000000 +0400\n@@ -2820,6 +2820,9 @@\n \n API_EXPORT(int) ap_rflush(request_rec *r)\n {\n+\tif (r->connection == NULL){\n+\t\treturn EOF;\n+\t}\n     if (ap_bflush(r->connection->client) < 0) {\n         if (!r->connection->aborted) {\n             ap_log_rerror(APLOG_MARK, APLOG_INFO, r,"}, {"count": 1, "tags": [], "bug_id": 47070, "text": "Your traceback shows ap_rflush being called during shutdown.  There is no valid request_rec, so of course it segfaults.  The bug is in the caller, which is PHP.", "id": 126426, "time": "2009-04-21T23:56:19Z", "creator": "nick@webthing.com", "creation_time": "2009-04-21T23:56:19Z", "is_private": false, "attachment_id": null}]
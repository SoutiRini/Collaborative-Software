[{"count": 0, "tags": [], "creator": "john@smadness.com", "attachment_id": null, "id": 168106, "time": "2013-06-28T01:37:36Z", "bug_id": 55152, "creation_time": "2013-06-28T01:37:36Z", "is_private": false, "text": "Using a load balancer to split traffic roughly evenly between a few servers, I have a conf block like this:\n\n      ProxyPass /munin balancer://balancer-group\n      ProxyPassReverse /munin balancer://balancer-group\n      ProxyTimeout 3600\n      <Proxy \"balancer://balancer-group\">\n         BalancerMember http://10.0.1.1:1234/munin route=munin1\n         BalancerMember http://10.0.1.2:1234/munin route=munin2\n         BalancerMember http://10.0.1.3:1234/munin route=munin3\n#        BalancerMember http://10.0.1.4:1234/munin route=munin4\n      </Proxy>\n\nTo find out which worker route the query is taking I have adjusted the log to be this:\n\n   CustomLog \"/var/log/apache2/access_log\" \"%h direct port %p fwd %{BALANCER_WORKER_ROUTE}e %l %u %t \\\"%r\\\" %>s %b %D micsec\"\n\nIn attempting to add, remove, and maintain the members, I comment out some of them and uncomment as I bring them offline and online.  After adjusting this conf block I gracefully restart the server with a kill -USR1.\n\nI have noticed that although a graceful restart succeeds in blocking the flow of traffic to a commented out server, sometimes I got into a situation where apache would direct traffic only to the first server in the list, ignoring all the other supposedly live members.  When this occurred, the access log would mention it's attempting to send traffic to \"munin4\", which was commented out. Likely it then would default to the first member in the list.\n\nAfter a full (not graceful) restart of httpd, it succeeded in balancing traffic between all live members.\n\nIt could be a bug that a graceful restart does not successfully restart the load balancing algorithm, even though it reloads the member configuration settings. Or if this is intentional, it does not seem to be called out in the documentation, and causes angst among those trying to debug their setups."}, {"count": 1, "tags": [], "creator": "john@smadness.com", "attachment_id": null, "is_private": false, "id": 168107, "time": "2013-06-28T01:40:22Z", "bug_id": 55152, "creation_time": "2013-06-28T01:40:22Z", "text": "Possibly related to another \"graceful doesn't fully reset\" bug, https://issues.apache.org/bugzilla/show_bug.cgi?id=49771"}, {"count": 2, "tags": [], "text": "Sounds like it's related to https://issues.apache.org/bugzilla/show_bug.cgi?id=44736", "is_private": false, "bug_id": 55152, "id": 174104, "time": "2014-03-26T13:32:56Z", "creator": "michael.bittorf@heidelberg-mobil.com", "creation_time": "2014-03-26T13:32:56Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "egarreau@gmail.com", "attachment_id": null, "id": 174157, "time": "2014-03-28T09:09:04Z", "bug_id": 55152, "creation_time": "2014-03-28T09:09:04Z", "is_private": false, "text": "LB problems are so use-case dependent that this one might also look like  https://issues.apache.org/bugzilla/show_bug.cgi?id=56261"}, {"count": 4, "attachment_id": 31525, "creator": "chillmein11@gmail.com", "is_private": false, "id": 174577, "time": "2014-04-15T06:22:31Z", "bug_id": 55152, "creation_time": "2014-04-15T06:22:31Z", "tags": [], "text": "Created attachment 31525\nAdded change can fix this issue\n\nafter graceful restart lbstatus and lbfactor (0 )is not initialized for added balancers.\nIf lbfactor is 0 initialize it to 1. \n\nI have tested with this and load balancing for newly added servers are working for me, but not sure about side effects."}]
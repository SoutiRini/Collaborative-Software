[{"count": 0, "tags": [], "creator": "paulvancingel@gmail.com", "attachment_id": 29838, "text": "Created attachment 29838\nXLSX file that fails sheet rename.\n\nFor one particular spreadsheet, renaming a sheet returns \njava.lang.IllegalArgumentException: Sheet index (-1) is out of range (0..1)\n\n\tat org.apache.poi.xssf.usermodel.XSSFWorkbook.validateSheetIndex(XSSFWorkbook.java:1043)\n\tat org.apache.poi.xssf.usermodel.XSSFWorkbook.getSheetName(XSSFWorkbook.java:876)\n\tat org.apache.poi.xssf.usermodel.XSSFEvaluationWorkbook.getSheetNameByExternSheet(XSSFEvaluationWorkbook.java:135)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFFormulaUtils$1.getSheetNameByExternSheet(XSSFFormulaUtils.java:81)\n\tat org.apache.poi.ss.formula.ptg.ExternSheetNameResolver.prependSheetName(ExternSheetNameResolver.java:42)\n\tat org.apache.poi.ss.formula.ptg.Area3DPtg.toFormulaString(Area3DPtg.java:100)\n\tat org.apache.poi.ss.formula.FormulaRenderer.toFormulaString(FormulaRenderer.java:92)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFFormulaUtils.updateName(XSSFFormulaUtils.java:143)\n\tat org.apache.poi.xssf.usermodel.helpers.XSSFFormulaUtils.updateSheetName(XSSFFormulaUtils.java:97)\n\tat org.apache.poi.xssf.usermodel.XSSFWorkbook.setSheetName(XSSFWorkbook.java:1230)\n\nCode is:\n\nimport org.apache.poi.ss.usermodel.*;\nimport java.io.*;\n      \nFileInputStream fileInputStream = new FileInputStream(filePath);  \nWorkbook workbook = WorkbookFactory.create(fileInputStream);  \n\nSystem.out.println(\"sheets:\" + workbook.getNumberOfSheets());\n\nfor (int i = 0; i < workbook.getNumberOfSheets(); i++) {  \n  System.out.println(\"i:\" + i);\n  workbook.setSheetName(i, \"Sheet\" + (i + 1));\n}  \nfileInputStream.close();  \n\nFileOutputStream fileOutputStream = new FileOutputStream(filePath); \nworkbook.write(fileOutputStream);\nfileOutputStream.close();  \n\nThis outputs \nsheets:1\ni:0\n\n\nTested on POI versions 3.8 and 3.9.", "id": 164549, "time": "2013-01-10T05:04:18Z", "bug_id": 54399, "creation_time": "2013-01-10T05:04:18Z", "is_private": false}, {"count": 1, "tags": [], "text": "The error happens at a point where the external references are resolved in order to adjust all formulas/references for the new sheet-name. FormularParser.createAreaRefParseNode() tries to read the external sheet index, but does not find the referenced external sheets and thus ends up using -1. \n\nI still lack details of how it is supposed to work, though, to say if this is somehow expected here or an invalid .xlsx or really a bug in POI...", "attachment_id": null, "id": 169664, "creator": "dominik.stadler@gmx.at", "time": "2013-08-22T20:38:52Z", "bug_id": 54399, "creation_time": "2013-08-22T20:38:52Z", "is_private": false}, {"count": 2, "tags": [], "creator": "dominik.stadler@gmx.at", "attachment_id": null, "id": 184983, "time": "2015-09-05T19:55:06Z", "bug_id": 54399, "creation_time": "2015-09-05T19:55:06Z", "is_private": false, "text": "This seems to work with the current trunk version of POI, some other fix seems to have fixed this too."}, {"count": 3, "tags": [], "creator": "aliyev.jafar@gmail.com", "attachment_id": null, "is_private": false, "id": 189530, "time": "2016-03-17T12:06:59Z", "bug_id": 54399, "creation_time": "2016-03-17T12:06:59Z", "text": "I downloaded the latest version 3.14 from 2016-03-07 and checked.\nIt was fixed in XSSFWorkbook class, but the problem remains on HSSFWorkbook."}]
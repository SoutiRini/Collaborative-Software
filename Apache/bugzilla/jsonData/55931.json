[{"count": 0, "tags": [], "bug_id": 55931, "attachment_id": null, "text": "I run 7.0.47 using Java 1.7.0_45-b18 on Centos6.\nI enabled JMX using the following options:\n\nCATALINA_OPTS=\"${CATALINA_OPTS} -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=9123 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.local.only=true\"\n\nUnfortunately, when I check what ports are opened I discover 2 additional random ports:\n\nnetstat -plunt | grep java\nProto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name\ntcp        0      0 :::60555                    \t\t:::*                LISTEN      22752/java\ntcp        0      0 ::ffff:127.0.0.1:8080       \t\t:::*                LISTEN      22752/java\ntcp        0      0 :::9123                     \t\t:::*                LISTEN      22752/java\ntcp        0      0 :::40867                    \t\t:::*                LISTEN      22752/java\n\n\nPlease note that each restart only configured ports 8080 and 9123 remains same, and two additional ports change values.\nIt is security problem, since Tomcat listen for all IPs.\n\nWhy JMX in Tomcat opens 2 additional ports?\nHow can I configure these ports?\nHow can I configure `::ffff:127.0.0.1` will appear before all ports opened by JMX?\n\nI have configured JmxRemoteLifecycleListener http://tomcat.apache.org/tomcat-7.0-doc/config/listeners.html#JMX_Remote_Lifecycle_Listener_-_org.apache.catalina.mbeans.JmxRemoteLifecycleListener\nUsing the following configuration:\n\n<Listener className=\"org.apache.catalina.mbeans.JmxRemoteLifecycleListener\" rmiRegistryPortPlatform=\"9123\" rmiServerPortPlatform=\"10002\" rmiBindAddress=\"localhost\"/>\n\nIn this case only one random port (60714 in the list below) appears: \n\ntcp 0 0 ::ffff:127.0.0.1:8080 :::* \ntcp 0 0 ::ffff:127.0.0.1:10002 :::* \ntcp 0 0 ::ffff:127.0.0.1:9123 :::* \ntcp 0 0 :::60714 :::*\n\nWhy JMX in Tomcat opens 1 additional port?\nHow can I configure the port?\nHow can I configure `::ffff:127.0.0.1` will appear before all ports opened by JMX?", "id": 171924, "time": "2013-12-25T10:11:36Z", "creator": "michael_furman@hotmail.com", "creation_time": "2013-12-25T10:11:36Z", "is_private": false}, {"count": 1, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "That is how JMX works. It is controlled by the JVM, not Tomcat.\n\nIf you want greater control of those ports, use the JMXLifecylceListener in JMXREmote.jar from the extras package.", "id": 171925, "time": "2013-12-25T15:40:05Z", "bug_id": 55931, "creation_time": "2013-12-25T15:40:05Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 55931, "attachment_id": null, "text": "Dear Mark,\nWhat do you mean by \u201cJMXLifecylceListener in JMXREmote.jar\u201d?\nI configured JmxRemoteLifecycleListener from catalina-jmx-remote.jar. \n\nDo you mean this class or something else?\n\nRegarding JMX \nYou absolutely correct: Java is opened 3 ports when JMX is configured and not Tomcat.\n\nWhen I configured JmxRemoteLifecycleListener I can control over 2 ports:\nrmiRegistryPortPlatform and rmiServerPortPlatform\n\nMy questions:\n1)\tWhat is 3-d port opened by Java? Why it is not used when connecting with JConsole?\n2)\tWhy it is not controlled by JmxRemoteLifecycleListener? \nCan it be controlled by JmxRemoteLifecycleListener? Is it enhancement request or it is not possible?", "id": 172017, "time": "2014-01-02T11:41:29Z", "creator": "michael_furman@hotmail.com", "creation_time": "2014-01-02T11:41:29Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 55931, "attachment_id": null, "text": "(In reply to Michael from comment #2)\n> My questions:\n\nBugzilla is not a support forum; post your questions on the Tomcat users' mailing list.", "id": 172023, "time": "2014-01-02T13:55:31Z", "creator": "chuck.caldarale@unisys.com", "creation_time": "2014-01-02T13:55:31Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 55931, "attachment_id": null, "text": "(In reply to Michael from comment #2)\n\nThere are two cases in OP's report\n\"Case A\": without JmxRemoteLifecycleListener\n\"Case B\": with JmxRemoteLifecycleListener\n\n\n> What is 3-d port opened by Java?\n\nTake a thread dump. You will see what threads actually listen on network ports.\nFrom there you may guess why.\n\n\nMy result on Fedora 19 with OpenJDK \"1.7.0_45\" (OpenJDK Client VM (build 24.45-b08, mixed mode, sharing)) running without JmxRemoteLifecycleListener (\"Case A\") is that I also see 3 open IPv6 ports.\n\nThe thread dumps shows that there is one thread named \"RMI TCP Accept-9123\" and two threads named \"RMI TCP Accept-0\" and all three of them have the following stack trace:\n        at java.net.ServerSocket.accept(ServerSocket.java:498)\n        at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.executeAcceptLoop(TCPTransport.java:388)\n        at sun.rmi.transport.tcp.TCPTransport$AcceptLoop.run(TCPTransport.java:360)\n        at java.lang.Thread.run(Thread.java:744)\n\nIf I add the following to the setenv.sh, it turns on debug logging [1]\n\nCATALINA_OPTS=\"${CATALINA_OPTS} -Dsun.rmi.transport.tcp.logLevel=VERBOSE\"\n\n[1] http://docs.oracle.com/javase/7/docs/technotes/guides/rmi/sunrmiproperties.html\n\nWith the logging I see how those three ports are being opened, but I do not know why.\n\n\nI suspect that the cause for the additional port is some bug in initialization of RMI Registry. As such, it should be fixed in the JRE.", "id": 172051, "time": "2014-01-03T04:03:12Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2014-01-03T04:03:12Z", "is_private": false}]
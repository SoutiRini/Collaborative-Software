[{"count": 0, "tags": [], "bug_id": 15423, "attachment_id": null, "id": 27912, "time": "2002-12-17T00:58:33Z", "creator": "koreth-apache@midwinter.com", "creation_time": "2002-12-17T00:58:33Z", "is_private": false, "text": "If I have the following .shtml file:\n\n<!--#include virtual=\"/cgi-bin/redir\" --> Got to end!\n\nAnd /cgi-bin/redir is a script like:\n\n#!/bin/sh\necho 'Location: /foo.html'\necho ''\n\nThen I'll see the contents of foo.html, but not the \"Got to end\" message.  This\nworks fine in Apache 1.x."}, {"count": 1, "tags": [], "bug_id": 15423, "attachment_id": null, "id": 31379, "time": "2003-02-17T00:09:41Z", "creator": "jerenkrantz@apache.org", "creation_time": "2003-02-17T00:09:41Z", "is_private": false, "text": "Works for me with HEAD of httpd.  Please try Apache 2.0.44.\n\nThanks for using Apache HTTP Server!"}, {"count": 2, "tags": [], "bug_id": 15423, "text": "Still broken under 2.0.44.  I've poked around a bit more and figured out some\nadditional details; it looks like this is a problem with interaction between\nchunked encoding and mod_include:\n\n---\ndozer% cat test-apache2-redir.shtml\n<!--#include virtual=\"/cgi-bin/redirtest\" --> Got to end!\ndozer% cat foo.html\nhiya\ndozer% cat ~/apache/cgi-bin/redirtest\n#!/bin/sh\necho Location: /foo.html\necho ''\ndozer% nc dozer 8763\nGET /test-apache2-redir.shtml HTTP/1.1\nHost: dozer.ironplanet.com:8763\n\nHTTP/1.1 200 OK\nDate: Mon, 17 Feb 2003 19:09:24 GMT\nServer: Apache/2.0.44 (Unix) mod_fastcgi/mod_fastcgi-SNAP-0210222112\nAccept-Ranges: bytes\nConnection: close\nTransfer-Encoding: chunked\nContent-Type: text/html; charset=ISO-8859-1\n\n5\nhiya\n\n0\n\n0\n\nd\n Got to end!\n\n0\n\n---\n\nNotice that although the \"got to end\" message *does* make it through, it comes\nthrough *after* not one but two 0-length chunks, each of which is supposed to\nindicate the end of the document (see RFC2616 section 3.6.1).  If you hit this\nURL with Mozilla or MSIE or links, you just see the \"hiya\" message.\n\nNow, if I replace the include of the CGI script with a direct include of\n/foo.html, the result is much more reasonable:\n\n---\ndozer% cat test-apache2-redir2.shtml\n<!--#include virtual=\"/foo.html\" --> Got to end!\ndozer% nc dozer 8763\nGET /test-apache2-redir2.shtml HTTP/1.1\nHost: dozer.ironplanet.com:8763\n\nHTTP/1.1 200 OK\nDate: Mon, 17 Feb 2003 19:22:29 GMT\nServer: Apache/2.0.44 (Unix) mod_fastcgi/mod_fastcgi-SNAP-0210222112\nAccept-Ranges: bytes\nConnection: close\nTransfer-Encoding: chunked\nContent-Type: text/html; charset=ISO-8859-1\n\n5\nhiya\n\nd\n Got to end!\n\n0\n\n---\nI'd expect to see exactly the same output whether or not there's an internal\nredirect in the middle of the server-side processing of the .shtml file.", "id": 31474, "time": "2003-02-17T19:28:27Z", "creator": "koreth-apache@midwinter.com", "creation_time": "2003-02-17T19:28:27Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 15423, "attachment_id": null, "id": 31810, "time": "2003-02-23T14:28:44Z", "creator": "trawick@apache.org", "creation_time": "2003-02-23T14:28:44Z", "is_private": false, "text": "I can easily reproduce this on current code.\n\nThe problem is that we're getting down to the chunk filter on an internal redirect.\n\nI'll attach a patch that fixes it for me in just a second.  I'm not sure\nif the patch is complete, so I'm not ready to commit it.\n"}, {"count": 4, "tags": [], "creator": "trawick@apache.org", "attachment_id": 4981, "text": "Created attachment 4981\npatch file for adding the subrequest filter in internal_internal_redirect()", "id": 31812, "time": "2003-02-23T14:30:05Z", "bug_id": 15423, "creation_time": "2003-02-23T14:30:05Z", "is_private": false}, {"count": 5, "tags": [], "creator": "koreth-apache@midwinter.com", "attachment_id": null, "is_private": false, "id": 31822, "time": "2003-02-23T18:39:18Z", "bug_id": 15423, "creation_time": "2003-02-23T18:39:18Z", "text": "This patch appears to fix the problem for me."}, {"count": 6, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "text": "Thanks for the quick feedback.  After reviewing my patch some more I understand\nit well enough, so I've committed it to 2.1-dev.  I'll propose that it be merged\ninto\nthe stable tree (2.0.45-dev).\n\nThanks for using Apache, and thanks for your report!\n", "id": 31828, "time": "2003-02-24T01:00:22Z", "bug_id": 15423, "creation_time": "2003-02-24T01:00:22Z", "is_private": false}, {"count": 7, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "text": "*** Bug 16673 has been marked as a duplicate of this bug. ***", "id": 31831, "time": "2003-02-24T04:07:20Z", "bug_id": 15423, "creation_time": "2003-02-24T04:07:20Z", "is_private": false}, {"count": 8, "tags": [], "text": "FYI, the fix for this problem has been merged into the stable tree for 2.0.45.", "attachment_id": null, "bug_id": 15423, "id": 33075, "time": "2003-03-12T18:28:24Z", "creator": "trawick@apache.org", "creation_time": "2003-03-12T18:28:24Z", "is_private": false}]
[{"count": 0, "tags": [], "creator": "gkiessling@teradici.com", "text": "Both 1.1.x and 1.2.x branches of Tomcat Native have numerous comparisons between OPENSSL_VERSION_NUMBER and 0x10100000L, the latter being an alpha release version of OpenSSL that only became available in December 2015 (the 1.2.0 version of Tomcat Native was released in October 2015):\n\n[tomcat-native-1.2.0-src]# grep -r \"OPENSSL_VERSION_NUMBER.*0x101\" *\nnative/src/sslutils.c:#if OPENSSL_VERSION_NUMBER < 0x10100000L\nnative/src/sslutils.c:#if OPENSSL_VERSION_NUMBER < 0x10100000L\nnative/src/ssl.c:#if (OPENSSL_VERSION_NUMBER < 0x10100000L) || defined(OPENSSL_USE_DEPRECATED)\nnative/src/ssl.c:#if (OPENSSL_VERSION_NUMBER < 0x10100000L) || defined(OPENSSL_USE_DEPRECATED)\nnative/src/ssl.c:#if (OPENSSL_VERSION_NUMBER < 0x10100000L) || defined(OPENSSL_USE_DEPRECATED)\nnative/src/sslinfo.c:#if OPENSSL_VERSION_NUMBER < 0x10100000L\nnative/src/sslinfo.c:#if OPENSSL_VERSION_NUMBER < 0x10100000L\nnative/src/sslinfo.c:#if OPENSSL_VERSION_NUMBER < 0x10100000L\nnative/src/sslinfo.c:#if OPENSSL_VERSION_NUMBER < 0x10100000L\nnative/src/sslcontext.c:#if OPENSSL_VERSION_NUMBER < 0x10100000L\n\nAccording to the openssl_version_number man page (http://linux.die.net/man/3/openssl_version_number), OPENSSL_VERSION_NUMBER is a numeric release version identifier in this format: MMNNFFPPS: major minor fix patch status\n\nThus 0x10100000L refers to OpenSSL version 1.1.0. According to the comments of SVN revision 1681092 (Git SHA-1 fda408291a5557cacad7259248f6632ad5ae264a), the intended OpenSSL version was 1.0.1:\n\n\"this commit also removes all code with #if or #ifdef checks which only apply to OpenSSL 1.0.1 or earlier\"\n\nThe value that should be used in all the comparisons above is 0x10001000L.", "id": 188543, "time": "2016-02-17T23:31:08Z", "bug_id": 59025, "creation_time": "2016-02-17T23:31:08Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "gkiessling@teradici.com", "text": "I should add that the consequence of this bug is that all current OpenSSL release versions are falling into the \"true\" part of the #if clauses when only versions before 1.0.1 should fall into the \"true\" part.", "id": 188544, "time": "2016-02-17T23:37:42Z", "bug_id": 59025, "creation_time": "2016-02-17T23:37:42Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 59025, "attachment_id": null, "text": "In genereral using 0x10100000L is correct. Those parts provide support for the forthcoming OpenSSL version 1.1.0 which is not ABI compatible with previous versions. So some code parts need to differ depending on the OpenSSL version.\n\nAPI stability was higher for previous versions, thus there was much less need for such a differentiation. In OpenSSL 1.1.0 many structs have been made opaque and accessor functions must be used to access the struct members.\n\nThe svn log message you cite is only a small part of a long message that is prefixed with \"Below is a list of revisions added to 1.1.x which are part\nof the forward port. The only remaining changes that have not been\nforward ported all concern sslnetwork.c:\". It is not related to the OpenSSL 1.1.0 ifdefs.", "id": 188554, "time": "2016-02-18T06:44:29Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2016-02-18T06:44:29Z", "is_private": false}]
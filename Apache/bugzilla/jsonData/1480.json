[{"count": 0, "tags": [], "bug_id": 1480, "text": "If you have a malformed environment variable ant will die if you\nuse the <properties environment=\"foo\"/> property.\n\nHere is some code from org.apache.tools.ant.taskdefs.Property,\nroutine loadEnvironment:\n\n        try {\n            Vector osEnv = Execute.getProcEnvironment();\n            for (Enumeration e = osEnv.elements(); e.hasMoreElements(); ) {\n                String entry = (String)e.nextElement();\n                int pos = entry.indexOf('=');\n                props.put(prefix + entry.substring(0, pos), \n                          entry.substring(pos + 1));\n            }\n            addProperties(props);\n        } catch (Exception ex) {\n            throw new BuildException(ex, location);\n        }\n\nThe problem is if there is no '=' sign in an environment\nvariable the entry.substring() call fails (pos will be -1).\n\nMy suggested fix:\n\n            for (Enumeration e = osEnv.elements(); e.hasMoreElements(); ) {\n                String entry = (String)e.nextElement();\n                int pos = entry.indexOf('=');\n                if (pos > 0) {\n                        props.put(prefix + entry.substring(0, pos), \n                                entry.substring(pos + 1));\n                }\n            }", "id": 2066, "time": "2001-04-24T09:23:24Z", "creator": "neil+apache@askneil.com", "creation_time": "2001-04-24T09:23:24Z", "is_private": false, "attachment_id": null}, {"count": 1, "attachment_id": null, "creator": "nico@apache.org", "is_private": false, "id": 2067, "time": "2001-04-24T10:36:44Z", "bug_id": 1480, "creation_time": "2001-04-24T10:36:44Z", "tags": [], "text": "Already fixed in CVS - current code reads: \n\n            for (Enumeration e = osEnv.elements(); e.hasMoreElements(); ) {\n                String entry = (String)e.nextElement();\n                int pos = entry.indexOf('=');\n                if (pos == -1) {\n                    log(\"Ignoring: \" + entry, Project.MSG_WARN);\n                } else {\n                    props.put(prefix + entry.substring(0, pos), \n                              entry.substring(pos + 1));\n                }\n            }\n"}]
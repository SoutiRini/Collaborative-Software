[{"count": 0, "tags": [], "creator": "dawszy@arhea.net", "text": "apache2 doesn't properly handle binding to sockets when there is no 127.0.0.1 \niface.\nThe only one Listen line in my config file is:\nListen [::]:80\nand apache doesn't start\nsollution is to assign 127.0.0.1 to loopback iface, but I wan't to make this \nmachine IPv6 only so it isn't sollution :)", "id": 12568, "time": "2002-03-31T13:21:11Z", "bug_id": 7642, "creation_time": "2002-03-31T13:21:11Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "trawick@apache.org", "text": "Could you provide a syscall trace (truss/strace/whatever) showing the \nsequence leading up to whatever syscall failed and caused startup to\nfail?  It would be helpful to see what the use of 127.0.0.1 is.\n\nDo you see this message in error_log?\n\n  \"Could not determine the server's fully qualified domain name...\"\n\nThanks!", "id": 12570, "time": "2002-03-31T16:35:42Z", "bug_id": 7642, "creation_time": "2002-03-31T16:35:42Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "dawszy@arhea.net", "text": "Hmm apachectl start with\nListen [::]:80 writes:\nprehistoric# apachectl start\n[Sun Mar 31 17:42:46 2002] [crit] (22007)No address associated with hostname: \nalloc_listener: failed to set up sockaddr for [::]\nhttpd: Could not determine the server's fully qualified domain name, using \n127.0.0.1 for ServerName\nno listening sockets available, shutting down\n/usr/pkg/sbin/apachectl start: httpd could not be started\n\nSame thing happens with:\nListen [3ffe:8210:f000:d:250:baff:fefb:1f25]:80\n\nprehistoric# apachectl start\n[Sun Mar 31 17:51:21 2002] [crit] (22007)No address associated with hostname: \nalloc_listener: failed to set up sockaddr for \n[3ffe:8210:f000:d:250:baff:fefb:1f25]\nhttpd: Could not determine the server's fully qualified domain name, using \n127.0.0.1 for ServerName\nno listening sockets available, shutting down\n/usr/pkg/sbin/apachectl start: httpd could not be started\n\n\nktrace httpd\nkdump ktrace.out > ktrace.apache2\nfile is avaiable on\nhttp://people.arhea.net/dawszy/NetBSD/ktrace.apache2 (533164)\n\nI can give an account with root perms on this machine if my work isn't enough ..", "id": 12574, "time": "2002-03-31T17:32:25Z", "bug_id": 7642, "creation_time": "2002-03-31T17:32:25Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "trawick@apache.org", "text": "Something weird is happening in your build with the parsing of the Listen\nstatement.  Your log messages (\"alloc_listener: failed to set up sockaddr...\")\nstill have the square brackets around the IPv6 address, but on my machine\n(running HEAD or 2.0.32) they are properly parsed off.  Can you step through\nap_set_listener() and see what is going wrong with parsing the argument to\nListen?  Here is what it looks with 2.0.32 on my machine:\n\n(gdb)\n349         rv = apr_parse_addr_port(&host, &scope_id, &port, ips, cmd->pool);\n(gdb) p ips\n$3 = 0x80f6248 \"[3ffe:8210:f000:d:250:baff:fefb:1f25]:80\"\n(gdb) n\n350         if (rv != APR_SUCCESS) {\n(gdb) p host\n$4 = 0x80f6278 \"3ffe:8210:f000:d:250:baff:fefb:1f25\"\n(gdb) p scope_id\n$5 = 0x0\n(gdb) p port\n$6 = 80\n\nOh, perhaps a dumb question, but what is the value of APR_HAVE_IPV6 in\nsrclib/apr/include/apr.h?  When APR_HAVE_IPV6 is 0 (disabled), then \napr_parse_addr_port() doesn't process/strip off square brackets.\n\nI'm willing to log in to your machine if absolutely necessary (don't need\nroot), but it would be very helpful if you can first see how far you can take\nit.\n", "id": 12624, "time": "2002-04-01T13:57:39Z", "bug_id": 7642, "creation_time": "2002-04-01T13:57:39Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "dawszy@arhea.net", "is_private": false, "text": "Em I think that you will have to login I've recompiled apache with APR_HAVE_IPV6 1 becouse default was 0 but it still doesn't work I'm not fammiliar with gdb so .. ;) In private e-mail I'm sending you user host and pass ", "id": 12632, "time": "2002-04-01T15:05:34Z", "bug_id": 7642, "creation_time": "2002-04-01T15:05:34Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 7642, "is_private": false, "count": 5, "id": 12638, "time": "2002-04-01T17:14:21Z", "creator": "trawick@apache.org", "creation_time": "2002-04-01T17:14:21Z", "text": "Note that APR_HAVE_IPV6 was initially 0 because APR couldn't find the\nsupport it needed on your system (not saying your system doesn't have the\nright support; maybe APR doesn't know how/where to look).  But changing\nAPR_HAVE_IPV6 manually from 0 to 1 isn't going to help APR (and thus Apache)\nknow what to do, since APR still thinks that some required feature (e.g.,\nworking getaddrinfo()) is missing).\n\nWhen I get your e-mail with account info I'll reproduce the IPv6 detection\nproblem and try to see what to do about it.\n\n"}, {"count": 6, "tags": [], "bug_id": 7642, "attachment_id": null, "text": "Please do a fresh unpack of the tarball and run configure and send me\nsrclib/apr/config.log to see why IPv6 support was not enabled.\n", "id": 13111, "time": "2002-04-09T16:34:00Z", "creator": "trawick@apache.org", "creation_time": "2002-04-09T16:34:00Z", "is_private": false}, {"count": 7, "tags": [], "creator": "trawick@apache.org", "text": "(after some off-line correspondence)\nIPv6 was disabled because getnameinfo() wasn't found.\ngetnameinfo() wasn't found because the test for working getnameinfo()\ntries to get a name for 127.0.0.1 and it failed on this box.\nWith a work-around for this (entry in /etc/hosts) we're trying to determine\nwhat other problems remain.\n", "id": 14282, "time": "2002-04-22T10:46:25Z", "bug_id": 7642, "creation_time": "2002-04-22T10:46:25Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "trawick@apache.org", "text": "A fix for the inability to find getnameinfo() will be in the next Apache \nrelease after 2.0.36.  A fix for mod_unique_id requiring an IPv4 address \nwill be in Apache 2.0.36.  Both of these fixes are in current CVS.\n\n", "id": 15106, "time": "2002-04-30T11:04:32Z", "bug_id": 7642, "creation_time": "2002-04-30T11:04:32Z", "is_private": false, "attachment_id": null}]
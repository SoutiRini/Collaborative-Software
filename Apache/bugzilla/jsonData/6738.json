[{"count": 0, "tags": [], "text": "DependClassLoader12 is not getting the proper Manifest information in the \ndefineClassCompat(...) method.  It seems that the return value from String JarN \n= res.getFile() is not a proper filename -- instead it returns a File URL with \na suffixed reference that can be used to resolve a specific JarEntry (something \nlike file:D:/foo/WEB-INF/lib/jndi.jar!/javax/naming/NamingException.class).  I \ndon't know if this String format should really be considered a canonical form \nbut, if it is, a possible fix is to remove the \"file:\" prefix and any content \nfollowing \"!\":\n\n--- DependClassLoader12.java.orig\tWed Feb 27 12:33:03 2002\n+++ DependClassLoader12.java\tWed Feb 27 12:54:53 2002\n@@ -70,6 +70,10 @@\n  * \n  */\n public class DependClassLoader12 extends DependClassLoader {\n+\t\n+    private final static String FILE_PROTOCOL = \"file:\";\n+    private final static String BANG = \"!\";\n+\t\n     DependClassLoader12() {\n     }\n     \n@@ -115,7 +119,9 @@\n             if ( \"jar\".equals(res.getProtocol()) ) {\n               try {\n \t\t  String JarN = res.getFile();\n-\t\t  System.out.println(JarN);\n+\t\t  if (JarN.startsWith(FILE_PROTOCOL)) JarN = JarN.substring\n(FILE_PROTOCOL.length());\n+\t\t  int bang = JarN.indexOf(BANG);\n+\t\t  if (bang != -1) JarN = JarN.substring(0, bang);\n \t\t  JarFile JarF = new JarFile(JarN);\n \t\t  Manifest mf = JarF.getManifest();\n \t\t  if(mf == null) // Jar may not be Java2", "attachment_id": null, "bug_id": 6738, "id": 11242, "time": "2002-02-27T18:18:06Z", "creator": "emiller@planalytics.com", "creation_time": "2002-02-27T18:18:06Z", "is_private": false}, {"count": 1, "tags": [], "creator": "emiller@planalytics.com", "attachment_id": null, "id": 11246, "time": "2002-02-27T18:23:52Z", "bug_id": 6738, "creation_time": "2002-02-27T18:23:52Z", "is_private": false, "text": "Ignore the previous patch (I had tweaked the original file).  Try this one:\n\n--- DependClassLoader12.java.orig\tWed Feb 27 13:20:02 2002\n+++ DependClassLoader12.java\tWed Feb 27 13:15:40 2002\n@@ -70,6 +70,10 @@\n  * \n  */\n public class DependClassLoader12 extends DependClassLoader {\n+\t\n+    private final static String FILE_PROTOCOL = \"file:\";\n+    private final static String BANG = \"!\";\n+\t\n     DependClassLoader12() {\n     }\n     \n@@ -115,6 +119,9 @@\n             if ( \"jar\".equals(res.getProtocol()) ) {\n               try {\n \t\t  String JarN = res.getFile();\n+\t\t  if (JarN.startsWith(FILE_PROTOCOL)) JarN = JarN.substring\n(FILE_PROTOCOL.length());\n+\t\t  int bang = JarN.indexOf(BANG);\n+\t\t  if (bang != -1) JarN = JarN.substring(0, bang);\n \t\t  JarFile JarF = new JarFile(JarN);\n \t\t  Manifest mf = JarF.getManifest();\n \t\t  if(mf == null) // Jar may not be Java2\n"}, {"count": 2, "tags": [], "creator": "william.barker@wilshire.com", "text": "Your patch has been checked into the CVS, and will appear in 3.3.1-RC1.\n\nThank's much for catching this and the patch!", "id": 11273, "time": "2002-02-28T03:17:03Z", "bug_id": 6738, "creation_time": "2002-02-28T03:17:03Z", "is_private": false, "attachment_id": null}]
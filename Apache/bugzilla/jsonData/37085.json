[{"count": 0, "tags": [], "text": "Can some please take a look at this problem? Also I was not able to add a bug \nto bugzilla. How do I add a bug report?\n\n \n\nI have verified that this is indeed a problem with ant class loader. While \ndebugging I found that this problem is due to conversion of white space to %20 \nin AntClassLoader2 class. (This conversion is done in FileUtils.getFileURL())\n\n \n\n \n\nI verified with ant which comes with netbeans 4.1 (ant 1.6.2), netbeans5.0beta \nas well as latest ant 1.6.5. All fails to run my test program if jar which \ncontains test ant task is located in a directory which has space.\n\n \n\n \n\nAttached is the test program. Two files:\n\n AntTaskLibraryWithClass-PathExtension.zip and build.xml\n\n \n\nAntTaskLibraryWithClass-PathExtension.zip contains:\n\n \n\n AntTaskLibrary.jar\n\n+ext\n\n  +AntTaskDepedentLibrary.jar\n\n \n\n \n\nAntTaskLibrary.jar has following manifest entry referring to \nAntTaskDepedentLibrary.jar\n\n \n\nClass-Path: ext/AntTaskDepedentLibrary.jar\n\n \n\n \n\nTo run follow the steps below:\n\n \n\n(a) Unzip AntTaskLibraryWithClass-PathExtension.zip to a directory which has \nspace in its name. (Ex: c:\\program Files)\n\n \n\n(b) Extract build.xml to some directory.\n\n \n\n(c) Go to directory where build.xml is and run:\n\n \n\n \n\nant -DAntTaskLibrary.jar= <location of AntTaskLibrary.jar as specified in step\n(a) >  testAntTask\n\n \n\n \n\n \n\nEx:\n\n \n\nant -DAntTaskLibrary.jar= \"c:\\Program \nFiles\\Alaska\\antTaskLibrary\\AntTaskLibrary.jar\" testAntTask\n\n \n\n \n\n \n\nNote that it will fail to find AntTestTaskHelper class which is defined in \nAntTaskDepedentLibrary.jar\n\n \n\n \n\n \n\nBUILD FAILED\n\n \n\njava.lang.NoClassDefFoundError: AntTestTaskHelper\n\n \n\n \n\n \n\nThis is not a problem if AntTaskLibrary.jar is located in a dir which does not \nhave space. (In step (a) choose a dir which does not have space)", "is_private": false, "bug_id": 37085, "id": 81149, "time": "2005-10-14T03:11:41Z", "creator": "ritesh.adval@sun.com", "creation_time": "2005-10-14T03:11:41Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 37085, "attachment_id": 16692, "id": 81150, "time": "2005-10-14T03:13:17Z", "creator": "ritesh.adval@sun.com", "creation_time": "2005-10-14T03:13:17Z", "is_private": false, "text": "Created attachment 16692\nAntTaskLibraryWithClass-PathExtension.zip\n\nAntTaskLibraryWithClass-PathExtension.zip"}, {"count": 2, "tags": [], "bug_id": 37085, "attachment_id": 16693, "id": 81151, "time": "2005-10-14T03:13:54Z", "creator": "ritesh.adval@sun.com", "creation_time": "2005-10-14T03:13:54Z", "is_private": false, "text": "Created attachment 16693\nbuild.xml\n\nbuild.xml"}, {"count": 3, "tags": [], "bug_id": 37085, "attachment_id": null, "id": 81344, "time": "2005-10-18T20:20:35Z", "creator": "antoine@apache.org", "creation_time": "2005-10-18T20:20:35Z", "is_private": false, "text": "OK, I have downloaded your attachments and tested what you say.\n\nI can summarize your problem as follow :\n\n1) you have a jar containing a custom ant task called \"AntTaskLibrary.jar\"\n\n2) this jar says in his manifest that it wants to load\n\"ext/AntTaskDepedentLibrary.jar\"\n\n3) in your buildfile, you taskdef your custom AntTestTask using a classpath\ncontaining only \"AntTaskLibrary.jar\"\n\nyou rely on the feature that a jar will tell the class loader to also load jars\nlisted in the Class-Path manifest attribute\n\n4) the problem is that this works as long as \"AntTaskLibrary.jar\" is in a\ndirectory whose name does not include spaces\n\n5) I can confirm that this is an issue, but I doubt this is an ant issue\n\n6) Sounds more like a Java Bug. I would look for this in the Bug parade. For\nyour info, I have tested your problem using  1.5.0_04-b05.\n\nI will close this problem report as invalid, since the problem does exist, but\nit is not caused by ant.\n\nCheers,\n\nAntoine"}, {"count": 4, "tags": [], "text": "This is an Ant Bug.\nSee:\n\nprotected void addPathFile(File pathComponent) method in \norg.apache.tools.ant.loader.AntClassLoader2\n\nThere it reads the Manifest and look for (Class-Path)\n\nThe problem is in this line\n\nURL baseURL = fileUtils.getFileURL(pathComponent);\n(search for above line. it is way down in addPathFile() method)\n\n\nAfter FileUtils.getFileURL() the converted url has\n%20 for white space (ex for c:\\program%20file)\nand because of this it is not working.\n\nThe problem is in conversion done by fileUtils.getFileURL(pathComponent);\n\n\n", "attachment_id": null, "id": 81345, "creator": "ritesh.adval@sun.com", "time": "2005-10-18T20:32:00Z", "bug_id": 37085, "creation_time": "2005-10-18T20:32:00Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 37085, "attachment_id": null, "id": 81347, "time": "2005-10-18T20:42:17Z", "creator": "antoine@apache.org", "creation_time": "2005-10-18T20:42:17Z", "is_private": false, "text": "OK :-) you might well be right. Sorry for the quick (and wrong) conclusion."}, {"attachment_id": null, "tags": [], "bug_id": 37085, "is_private": false, "count": 6, "id": 81412, "time": "2005-10-19T21:54:40Z", "creator": "antoine@apache.org", "creation_time": "2005-10-19T21:54:40Z", "text": "I have done a little bit of debugging and used the findings of Ritesh Adval.\nLine 503 of AntClassLoader is the one which might be doing the wrong assumptions.\nIt says :                 File libraryFile = new File(libraryURL.getFile());\nThis returns a file located in\n/C:/Dokumente%20und%20Einstellungen/antoine/ext/AntTaskDepedentLibrary.jar\n\nfor C:/Dokumente und Einstellungen/antoine/ext/AntTaskDependentLibrary.jar.\n\n\nThe wrong assumption is that java.net.URL#getFile() returns a string with which\none can instantiate a java.io.File.\n\nI am wondering whether it is not possible to simplify the loop between the lines\n491 and 506 of AntClassLoader, by not converting \nString (representing a path) -> URL\nthen URL -> String (representing a path)\nbut working with java.io.File or String all the way.\n\nOr is there a reason why we do this all this walk ?\n\nCheers,\nAntoine"}, {"attachment_id": null, "tags": [], "bug_id": 37085, "is_private": false, "count": 7, "id": 81492, "time": "2005-10-21T02:55:02Z", "creator": "antoine@apache.org", "creation_time": "2005-10-21T02:55:02Z", "text": "fixed in CVS."}]
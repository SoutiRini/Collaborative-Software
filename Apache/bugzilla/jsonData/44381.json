[{"count": 0, "tags": [], "bug_id": 44381, "attachment_id": null, "is_private": false, "id": 113570, "time": "2008-02-08T09:36:47Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-02-08T09:36:47Z", "text": "Running a forward proxy, I occasionally see an Apache process eat 90% of CPU.\nThis problem is somewhat rare. Would like to provide a better bug report but not\nsure what information would be useful."}, {"count": 1, "tags": [], "bug_id": 44381, "attachment_id": null, "text": "We can't help without more information.  \n\nPlease use the mailing list, users@httpd.apache.org, or IRC to get extra help on\ndebugging this.  \n\nThis doesn't sound like a bug, at the moment at least.\n\nIf you can obtain extra debug info, then we can re-open this.", "id": 113572, "time": "2008-02-08T09:56:27Z", "creator": "tony@pc-tony.com", "creation_time": "2008-02-08T09:56:27Z", "is_private": false}, {"count": 2, "tags": [], "text": "I'd appreciate you not closing this bug. My bug reporting rate is 100% so far.\nI'd be happy to provide more info as necessary but it would appear to be a bug.", "attachment_id": null, "id": 113573, "creator": "pbelau1@yahoo.com", "time": "2008-02-08T09:57:45Z", "bug_id": 44381, "creation_time": "2008-02-08T09:57:45Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 44381, "is_private": false, "id": 113581, "attachment_id": null, "creator": "tony@pc-tony.com", "creation_time": "2008-02-08T14:20:37Z", "time": "2008-02-08T14:20:37Z", "text": "I am changing the status of this bug to needinfo, and lowering the severity to\nnormal.\n\nPeter, we need some repoduceable data, so we can investigate.\nUntil we get this we cannot help you any further.  If this does indeed turn out\nto be a bug, then the level and status can be re-addressed then.\n\nPlease attach your backtraces as was suggested in #apache, earlier today.\n\nCheers,\nTony\n\n"}, {"count": 4, "tags": [], "bug_id": 44381, "is_private": false, "id": 113774, "attachment_id": null, "creator": "pbelau1@yahoo.com", "creation_time": "2008-02-14T23:08:02Z", "time": "2008-02-14T23:08:02Z", "text": "I attached GDB to a process running in the CPU hogging state and discovered the\nfollowing looping stacktrace:\n\n#0  apr_pool_cleanup_kill (p=0xf1100030, data=0xf1101130, cleanup_fn=0xf7f90e90\n<brigade_cleanup>) at memory/unix/apr_pools.c:2022\n        c = (cleanup_t *) 0xf1101040\n        lastp = (cleanup_t **) 0xf1100fd0\n#1  0xf7f91e12 in apr_brigade_destroy (b=0xf1101130) at buckets/apr_brigade.c:58\nNo locals.\n#2  0x56584755 in ap_core_output_filter (f=0xf1100670, b=0xf1101130) at\ncore_filters.c:876\n        temp = <value optimized out>\n        next = <value optimized out>\n        temp_brig = (apr_bucket_brigade *) 0xee3e32a8\n        nbytes = 0\n        nvec_trailers = 0\n        vec = {{iov_base = 0xef5f13b8, iov_len = 5}, {iov_base = 0xe83b0148,\niov_len = 910}, {iov_base = 0x565d6b1f, iov_len = 2}, {\n    iov_base = 0x0, iov_len = 4031307968}, {iov_base = 0xf53b64f8, iov_len =\n4160298675}, {iov_base = 0xf1a2c980, iov_len = 4031307928}, {\n    iov_base = 0x1f40, iov_len = 4160358428}, {iov_base = 0x1117e, iov_len =\n4160303534}, {iov_base = 0xf53b6538, iov_len = 4160304487}, {\n    iov_base = 0xef5f1bf8, iov_len = 4160353204}, {iov_base = 0x0, iov_len =\n4160298775}, {iov_base = 0x565d6b1f, iov_len = 4047184992}, {\n    iov_base = 0xf53b6538, iov_len = 4160298775}, {iov_base = 0x11e1a300,\niov_len = 0}, {iov_base = 0xf53b6558, iov_len = 4160358428}, {\n    iov_base = 0xef5f1bf8, iov_len = 3997052964}}\n        flen = <value optimized out>\n        last_e = <value optimized out>\n        e = <value optimized out>\n        nvec = 0\n        fd = (apr_file_t *) 0x0\n        last_merged_bucket = (apr_bucket *) 0x0\n        vec_trailers = {{iov_base = 0xef5ef160, iov_len = 1448999480}, {iov_base\n= 0xf1101130, iov_len = 4015976800}, {\n    iov_base = 0xf53b6468, iov_len = 1448675696}, {iov_base = 0xef5efef0,\niov_len = 4044362032}, {iov_base = 0xf048e2c3,\n    iov_len = 1448999480}, {iov_base = 0x565dfa38, iov_len = 4114310437},\n{iov_base = 0x493e0, iov_len = 0}, {iov_base = 0x11e1a300,\n    iov_len = 0}, {iov_base = 0xf7e90c59, iov_len = 1}, {iov_base = 0xf53b6498,\niov_len = 4159153768}, {iov_base = 0x0,\n    iov_len = 4160158260}, {iov_base = 0x493e0, iov_len = 4114310340}, {iov_base\n= 0xf53b64d8, iov_len = 4160136804}, {\n    iov_base = 0xf53b64c4, iov_len = 1}, {iov_base = 0x493e0, iov_len =\n4160099041}, {iov_base = 0xf00dff48, iov_len = 4023555248}}\n        foffset = 0\n        rv = 0\n        more = (apr_bucket_brigade *) 0x0\n        c = (conn_rec *) 0xf1100220\n        net = (core_net_rec *) 0xf1100648\n        ctx = (core_output_filter_ctx_t *) 0xee3e3030\n        eblock = APR_NONBLOCK_READ\n        input_pool = (apr_pool_t *) 0xf1100030\n#3  0x56590970 in ap_pass_brigade (next=0xf1100fd0, bb=0xf1101130) at\nutil_filter.c:526\n        e = (apr_bucket *) 0xf1101040\n#4  0x565bcbe5 in ap_http_chunk_filter (f=0xe83ca870, b=0xf1101130) at\nchunk_filter.c:189\n        bytes = 0\n        eos = (apr_bucket *) 0x0\n        flush = (apr_bucket *) 0xef5f1bf8\n        chunk_hdr = \"38e\\r&#65533;\\037\\000\\000\\000\\000\\000\\0008f;&#65533;&#65533;&#65533;[V\"\n        c = (conn_rec *) 0xf1100220\n        more = (apr_bucket_brigade *) 0x0\n        e = <value optimized out>\n        rv = <value optimized out>\n#5  0x56590970 in ap_pass_brigade (next=0xf1100fd0, bb=0xf1101130) at\nutil_filter.c:526\n        e = (apr_bucket *) 0xf1101040\n#6  0x565ba5e2 in ap_http_outerror_filter (f=0xef5efef0, b=0xf1101130) at\nhttp_filters.c:1550\n        r = (request_rec *) 0xef5ef160\n        e = <value optimized out>\n#7  0x56590970 in ap_pass_brigade (next=0xf1100fd0, bb=0xf1101130) at\nutil_filter.c:526\n        e = (apr_bucket *) 0xf1101040\n#8  0x56579c1d in ap_content_length_filter (f=0xef5efec0, b=0xf1101130) at\nprotocol.c:1338\n        r = (request_rec *) 0xef5ef160\n---Type <return> to continue, or q <return> to quit---\n        ctx = (struct content_length_ctx *) 0xe83ca758\n        e = <value optimized out>\n        eblock = 4044361680\n#9  0x56590970 in ap_pass_brigade (next=0xf1100fd0, bb=0xf1101130) at\nutil_filter.c:526\n        e = (apr_bucket *) 0xf1101040\n#10 0x565ad11b in ap_proxy_http_process_response (p=0xf1100030, r=0xef5ef160,\nbackend=0x5950c1d8, origin=0xf1100808, conf=0x565efb08,\n    server_portstr=0xf53ba8af \"\") at mod_proxy_http.c:1648\n        readbytes = 910\n        rv = <value optimized out>\n        mode = <value optimized out>\n        finish = 0\n        c = (conn_rec *) 0xf1100220\n        buffer = \"\\000\\npported\\000 com.microsoft.wm.srvppair,\ncom.microsoft.wm.sswitch, com.microsoft.wm.predstrm, com.microsoft.wm.fastcac\nhe, com.microsoft.wm.startupprofile\\000\\n\\000\\000\\000\\000\\034\\b&#65533;&#65533;`J&#65533;&#65533;\na\\002&#65533;X\\210;&#65533;\\217\\036&#65533;&#65533;P&#65533;\\024&#65533;H&#65533;\\004&#65533;'\\n\\000\\000`\\020&#65533;&#65533;&#1577;;&#65533;\\034\\b&#65533;&#65533;\"...\n        buf = <value optimized out>\n        keepchar = <value optimized out>\n        rp = (request_rec *) 0xf1101140\n        e = <value optimized out>\n        bb = (apr_bucket_brigade *) 0xf1101130\n        tmp_bb = (apr_bucket_brigade *) 0xee3e2ec8\n        len = 15\n        backasswards = 0\n        interim_response = 0\n        pread_len = 0\n        save_table = (apr_table_t *) 0xef5f0fd0\n        backend_broke = 0\n        te = 0xe83ca488 \"chunked\"\n        hop_by_hop_hdrs = {0x565d188d \"Keep-Alive\", 0x565ccb45\n\"Proxy-Authenticate\", 0x565d8aa9 \"TE\", 0x565d6a9f \"Trailer\",\n  0x565d18a1 \"Upgrade\", 0x0}\n#11 0x565af055 in proxy_http_handler (r=0xef5ef160, worker=0x565f3ea8,\nconf=0x565efb08,\n    url=0xf11007a0\n\"/trailer_er/er_tiefverborgenephantasien1_tr_300.wmv?px_cip=88.226.112.161.ip&px_host=cyber-tv.at.host\",\nproxyname=0x0,\n    proxyport=0) at mod_proxy_http.c:1885\n        data = 0xef5ef160 \"(&#65533;^&#65533; \\002\\020&#65533; &#65533;^V\"\n        bytes_read = 4044358176\n        bytes_written = 4044361792\n        status = <value optimized out>\n        server_portstr =\n\"\\000&#65533;&#65533;&#65533;&#65533;\\000\\000\\000\\000(&#65533;;&#65533;\\204\\034&#65533;&#65533;(&#65533;^&#65533;\\b&#65533;^V&#65533;\\t_&#65533;\\000\\000\"\n        scheme = 0xf1100700 \"http\"\n        proxy_function = 0x565d6a0d \"HTTP\"\n        backend = (proxy_conn_rec *) 0x5950c1d8\n        is_ssl = <value optimized out>\n        p = (apr_pool_t *) 0xf1100030\n#12 0x5659e5d0 in proxy_run_scheme_handler (r=0xef5ef160, worker=0x565f3ea8,\nconf=0x565efb08,\n    url=0xef5f09a6\n\"http://194.50.253.10/trailer_er/er_tiefverborgenephantasien1_tr_300.wmv?px_cip=88.226.112.161.ip&px_host=cyber-tv.at.hos\nt\", proxyhost=0x0, proxyport=0) at mod_proxy.c:2240\n        n = 0\n        rv = <value optimized out>\n#13 0x565a2c36 in proxy_handler (r=0xef5ef160) at mod_proxy.c:884\n        url = 0xef5f09a6\n\"http://194.50.253.10/trailer_er/er_tiefverborgenephantasien1_tr_300.wmv?px_cip=88.226.112.161.ip&px_host=cyber-tv.\nat.host\"\n        uri = 0xef5f09a6\n\"http://194.50.253.10/trailer_er/er_tiefverborgenephantasien1_tr_300.wmv?px_cip=88.226.112.161.ip&px_host=cyber-tv.\nat.host\"\n        scheme = 0xef5f0c20 \"http\"\n        p = 0x4 <Address 0x4 out of bounds>\n        p2 = 0xef5ef2e8 \"&#65533;&#65533;^&#65533;h\\b_&#65533;&#65533;&#65533;^&#65533;h\\b_\n        conf = (proxy_server_conf *) 0x565efb08\n---Type <return> to continue, or q <return> to quit---\n        proxies = (apr_array_header_t *) 0x565efbd0\n        ents = (struct proxy_remote *) 0x565efbe8\n        i = -250609048\n        access_status = 0\n        direct_connect = <value optimized out>\n        str = <value optimized out>\n        maxfwd = <value optimized out>\n        balancer = (proxy_balancer *) 0x0\n        worker = (proxy_worker *) 0x565f3ea8\n        attempts = 0\n        max_attempts = 0\n#14 0x565857dd in ap_run_handler (r=0xef5ef160) at config.c:157\n        n = 0\n        rv = <value optimized out>\n#15 0x56588f97 in ap_invoke_handler (r=0xef5ef160) at config.c:372\n        handler = 0x0\n        result = <value optimized out>\n        old_handler = 0x565d4994 \"proxy-server\"\n        ignore = <value optimized out>\n#16 0x565ba4fe in ap_process_request (r=0xef5ef160) at http_request.c:258\n        access_status = <value optimized out>\n#17 0x565b728f in ap_process_http_connection (c=0xf1100220) at http_core.c:190\n        r = (request_rec *) 0xef5ef160\n        csd = (apr_socket_t *) 0x0\n#18 0x5658d4dd in ap_run_process_connection (c=0xf1100220) at connection.c:43\n        n = 0\n        rv = <value optimized out>\n#19 0x5658d5dc in ap_process_connection (c=0xf1100220, csd=0xf1100070) at\nconnection.c:178\n        rc = -250605504\n#20 0x565bfb2f in worker_thread (thd=0x569976a0, dummy=0x58e39370) at worker.c:544\n        process_slot = 3\n        thread_slot = 41\n        csd = (apr_socket_t *) 0xf1100070\n        bucket_alloc = (apr_bucket_alloc_t *) 0xef5f1130\n        last_ptrans = (apr_pool_t *) 0x0\n        ptrans = (apr_pool_t *) 0xf1100030\n        rv = <value optimized out>\n        is_idle = <value optimized out>\n#21 0xf7f6ba26 in dummy_worker (opaque=0x569976a0) at threadproc/unix/thread.c:142\nNo locals.\n#22 0xf7eff45b in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#23 0xf7e8424e in clone () from /lib/libc.so.6\n"}, {"count": 5, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 113789, "time": "2008-02-15T04:45:56Z", "bug_id": 44381, "creation_time": "2008-02-15T04:45:56Z", "is_private": false, "text": "(In reply to comment #4)\n> I attached GDB to a process running in the CPU hogging state and discovered the\n> following looping stacktrace:\n> \n> #0  apr_pool_cleanup_kill (p=0xf1100030, data=0xf1101130,\n> cleanup_fn=0xf7f90e90\n> <brigade_cleanup>) at memory/unix/apr_pools.c:2022\n>         c = (cleanup_t *) 0xf1101040\n>         lastp = (cleanup_t **) 0xf1100fd0\n\nIt would be very helpful if you could follow c->next until its value is NULL or\nyou detect a loop. Whats the value of p->cleanups and what of\nc->data and c->plain_cleanup_fn in each iteration?\n\n\n> #1  0xf7f91e12 in apr_brigade_destroy (b=0xf1101130) at buckets/apr_brigade.c:58\n> No locals.\n> #2  0x56584755 in ap_core_output_filter (f=0xf1100670, b=0xf1101130) at\n> core_filters.c:876\n>         temp = <value optimized out>\n>         next = <value optimized out>\n>         temp_brig = (apr_bucket_brigade *) 0xee3e32a8\n>         nbytes = 0\n>         nvec_trailers = 0\n>         vec = {{iov_base = 0xef5f13b8, iov_len = 5}, {iov_base = 0xe83b0148,\n> iov_len = 910}, {iov_base = 0x565d6b1f, iov_len = 2}, {\n>     iov_base = 0x0, iov_len = 4031307968}, {iov_base = 0xf53b64f8, iov_len =\n> 4160298675}, {iov_base = 0xf1a2c980, iov_len = 4031307928}, {\n>     iov_base = 0x1f40, iov_len = 4160358428}, {iov_base = 0x1117e, iov_len =\n> 4160303534}, {iov_base = 0xf53b6538, iov_len = 4160304487}, {\n>     iov_base = 0xef5f1bf8, iov_len = 4160353204}, {iov_base = 0x0, iov_len =\n> 4160298775}, {iov_base = 0x565d6b1f, iov_len = 4047184992}, {\n>     iov_base = 0xf53b6538, iov_len = 4160298775}, {iov_base = 0x11e1a300,\n> iov_len = 0}, {iov_base = 0xf53b6558, iov_len = 4160358428}, {\n>     iov_base = 0xef5f1bf8, iov_len = 3997052964}}\n>         flen = <value optimized out>\n>         last_e = <value optimized out>\n>         e = <value optimized out>\n>         nvec = 0\n>         fd = (apr_file_t *) 0x0\n>         last_merged_bucket = (apr_bucket *) 0x0\n>         vec_trailers = {{iov_base = 0xef5ef160, iov_len = 1448999480}, {iov_base\n> = 0xf1101130, iov_len = 4015976800}, {\n>     iov_base = 0xf53b6468, iov_len = 1448675696}, {iov_base = 0xef5efef0,\n> iov_len = 4044362032}, {iov_base = 0xf048e2c3,\n>     iov_len = 1448999480}, {iov_base = 0x565dfa38, iov_len = 4114310437},\n> {iov_base = 0x493e0, iov_len = 0}, {iov_base = 0x11e1a300,\n>     iov_len = 0}, {iov_base = 0xf7e90c59, iov_len = 1}, {iov_base = 0xf53b6498,\n> iov_len = 4159153768}, {iov_base = 0x0,\n>     iov_len = 4160158260}, {iov_base = 0x493e0, iov_len = 4114310340}, {iov_base\n> = 0xf53b64d8, iov_len = 4160136804}, {\n>     iov_base = 0xf53b64c4, iov_len = 1}, {iov_base = 0x493e0, iov_len =\n> 4160099041}, {iov_base = 0xf00dff48, iov_len = 4023555248}}\n>         foffset = 0\n>         rv = 0\n>         more = (apr_bucket_brigade *) 0x0\n>         c = (conn_rec *) 0xf1100220\n>         net = (core_net_rec *) 0xf1100648\n>         ctx = (core_output_filter_ctx_t *) 0xee3e3030\n>         eblock = APR_NONBLOCK_READ\n>         input_pool = (apr_pool_t *) 0xf1100030\n> #3  0x56590970 in ap_pass_brigade (next=0xf1100fd0, bb=0xf1101130) at\n> util_filter.c:526\n>         e = (apr_bucket *) 0xf1101040\n> #4  0x565bcbe5 in ap_http_chunk_filter (f=0xe83ca870, b=0xf1101130) at\n> chunk_filter.c:189\n>         bytes = 0\n>         eos = (apr_bucket *) 0x0\n>         flush = (apr_bucket *) 0xef5f1bf8\n>         chunk_hdr =\n\"38e\\r&#65533;\\037\\000\\000\\000\\000\\000\\0008f;&#65533;&#65533;&#65533;[V\"\n>         c = (conn_rec *) 0xf1100220\n>         more = (apr_bucket_brigade *) 0x0\n>         e = <value optimized out>\n>         rv = <value optimized out>\n> #5  0x56590970 in ap_pass_brigade (next=0xf1100fd0, bb=0xf1101130) at\n> util_filter.c:526\n>         e = (apr_bucket *) 0xf1101040\n> #6  0x565ba5e2 in ap_http_outerror_filter (f=0xef5efef0, b=0xf1101130) at\n> http_filters.c:1550\n>         r = (request_rec *) 0xef5ef160\n>         e = <value optimized out>\n> #7  0x56590970 in ap_pass_brigade (next=0xf1100fd0, bb=0xf1101130) at\n> util_filter.c:526\n>         e = (apr_bucket *) 0xf1101040\n> #8  0x56579c1d in ap_content_length_filter (f=0xef5efec0, b=0xf1101130) at\n> protocol.c:1338\n>         r = (request_rec *) 0xef5ef160\n> ---Type <return> to continue, or q <return> to quit---\n>         ctx = (struct content_length_ctx *) 0xe83ca758\n>         e = <value optimized out>\n>         eblock = 4044361680\n> #9  0x56590970 in ap_pass_brigade (next=0xf1100fd0, bb=0xf1101130) at\n> util_filter.c:526\n>         e = (apr_bucket *) 0xf1101040\n> #10 0x565ad11b in ap_proxy_http_process_response (p=0xf1100030, r=0xef5ef160,\n> backend=0x5950c1d8, origin=0xf1100808, conf=0x565efb08,\n>     server_portstr=0xf53ba8af \"\") at mod_proxy_http.c:1648\n>         readbytes = 910\n>         rv = <value optimized out>\n>         mode = <value optimized out>\n>         finish = 0\n>         c = (conn_rec *) 0xf1100220\n>         buffer = \"\\000\\npported\\000 com.microsoft.wm.srvppair,\n> com.microsoft.wm.sswitch, com.microsoft.wm.predstrm, com.microsoft.wm.fastcac\n> he,\ncom.microsoft.wm.startupprofile\\000\\n\\000\\000\\000\\000\\034\\b&#65533;&#65533;`J&#65533;&#65533;\n>\na\\002&#65533;X\\210;&#65533;\\217\\036&#65533;&#65533;P&#65533;\\024&#65533;H&#65533;\\004&#65533;'\\n\\000\\000`\\020&#65533;&#65533;&#1577;;&#65533;\\034\\b&#65533;&#65533;\"...\n>         buf = <value optimized out>\n>         keepchar = <value optimized out>\n>         rp = (request_rec *) 0xf1101140\n>         e = <value optimized out>\n>         bb = (apr_bucket_brigade *) 0xf1101130\n>         tmp_bb = (apr_bucket_brigade *) 0xee3e2ec8\n>         len = 15\n>         backasswards = 0\n>         interim_response = 0\n>         pread_len = 0\n>         save_table = (apr_table_t *) 0xef5f0fd0\n>         backend_broke = 0\n>         te = 0xe83ca488 \"chunked\"\n>         hop_by_hop_hdrs = {0x565d188d \"Keep-Alive\", 0x565ccb45\n> \"Proxy-Authenticate\", 0x565d8aa9 \"TE\", 0x565d6a9f \"Trailer\",\n>   0x565d18a1 \"Upgrade\", 0x0}\n> #11 0x565af055 in proxy_http_handler (r=0xef5ef160, worker=0x565f3ea8,\n> conf=0x565efb08,\n>     url=0xf11007a0\n>\n\"/trailer_er/er_tiefverborgenephantasien1_tr_300.wmv?px_cip=88.226.112.161.ip&px_host=cyber-tv.at.host\",\n> proxyname=0x0,\n>     proxyport=0) at mod_proxy_http.c:1885\n>         data = 0xef5ef160 \"(&#65533;^&#65533; \\002\\020&#65533; &#65533;^V\"\n>         bytes_read = 4044358176\n>         bytes_written = 4044361792\n>         status = <value optimized out>\n>         server_portstr =\n>\n\"\\000&#65533;&#65533;&#65533;&#65533;\\000\\000\\000\\000(&#65533;;&#65533;\\204\\034&#65533;&#65533;(&#65533;^&#65533;\\b&#65533;^V&#65533;\\t_&#65533;\\000\\000\"\n>         scheme = 0xf1100700 \"http\"\n>         proxy_function = 0x565d6a0d \"HTTP\"\n>         backend = (proxy_conn_rec *) 0x5950c1d8\n>         is_ssl = <value optimized out>\n>         p = (apr_pool_t *) 0xf1100030\n> #12 0x5659e5d0 in proxy_run_scheme_handler (r=0xef5ef160, worker=0x565f3ea8,\n> conf=0x565efb08,\n>     url=0xef5f09a6\n>\n\"http://194.50.253.10/trailer_er/er_tiefverborgenephantasien1_tr_300.wmv?px_cip=88.226.112.161.ip&px_host=cyber-tv.at.hos\n> t\", proxyhost=0x0, proxyport=0) at mod_proxy.c:2240\n>         n = 0\n>         rv = <value optimized out>\n> #13 0x565a2c36 in proxy_handler (r=0xef5ef160) at mod_proxy.c:884\n>         url = 0xef5f09a6\n>\n\"http://194.50.253.10/trailer_er/er_tiefverborgenephantasien1_tr_300.wmv?px_cip=88.226.112.161.ip&px_host=cyber-tv.\n> at.host\"\n>         uri = 0xef5f09a6\n>\n\"http://194.50.253.10/trailer_er/er_tiefverborgenephantasien1_tr_300.wmv?px_cip=88.226.112.161.ip&px_host=cyber-tv.\n> at.host\"\n>         scheme = 0xef5f0c20 \"http\"\n>         p = 0x4 <Address 0x4 out of bounds>\n>         p2 = 0xef5ef2e8\n\"&#65533;&#65533;^&#65533;h\\b_&#65533;&#65533;&#65533;^&#65533;h\\b_\n>         conf = (proxy_server_conf *) 0x565efb08\n> ---Type <return> to continue, or q <return> to quit---\n>         proxies = (apr_array_header_t *) 0x565efbd0\n>         ents = (struct proxy_remote *) 0x565efbe8\n>         i = -250609048\n>         access_status = 0\n>         direct_connect = <value optimized out>\n>         str = <value optimized out>\n>         maxfwd = <value optimized out>\n>         balancer = (proxy_balancer *) 0x0\n>         worker = (proxy_worker *) 0x565f3ea8\n>         attempts = 0\n>         max_attempts = 0\n> #14 0x565857dd in ap_run_handler (r=0xef5ef160) at config.c:157\n>         n = 0\n>         rv = <value optimized out>\n> #15 0x56588f97 in ap_invoke_handler (r=0xef5ef160) at config.c:372\n>         handler = 0x0\n>         result = <value optimized out>\n>         old_handler = 0x565d4994 \"proxy-server\"\n>         ignore = <value optimized out>\n> #16 0x565ba4fe in ap_process_request (r=0xef5ef160) at http_request.c:258\n>         access_status = <value optimized out>\n> #17 0x565b728f in ap_process_http_connection (c=0xf1100220) at http_core.c:190\n>         r = (request_rec *) 0xef5ef160\n>         csd = (apr_socket_t *) 0x0\n> #18 0x5658d4dd in ap_run_process_connection (c=0xf1100220) at connection.c:43\n>         n = 0\n>         rv = <value optimized out>\n> #19 0x5658d5dc in ap_process_connection (c=0xf1100220, csd=0xf1100070) at\n> connection.c:178\n>         rc = -250605504\n> #20 0x565bfb2f in worker_thread (thd=0x569976a0, dummy=0x58e39370) at worker.c:544\n>         process_slot = 3\n>         thread_slot = 41\n>         csd = (apr_socket_t *) 0xf1100070\n>         bucket_alloc = (apr_bucket_alloc_t *) 0xef5f1130\n>         last_ptrans = (apr_pool_t *) 0x0\n>         ptrans = (apr_pool_t *) 0xf1100030\n>         rv = <value optimized out>\n>         is_idle = <value optimized out>\n> #21 0xf7f6ba26 in dummy_worker (opaque=0x569976a0) at threadproc/unix/thread.c:142\n> No locals.\n> #22 0xf7eff45b in start_thread () from /lib/libpthread.so.0\n> No symbol table info available.\n> #23 0xf7e8424e in clone () from /lib/libc.so.6\n> \n\n"}, {"count": 6, "tags": [], "bug_id": 44381, "attachment_id": null, "id": 113792, "time": "2008-02-15T06:35:59Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-02-15T06:35:59Z", "is_private": false, "text": "Well I killed that process but here's another one doing something similar.\nGerman porn again it seems :)\n\nI don't see any of the structure variables in C, but the value of p->cleanups is:\n\n$2 = (cleanup_t *) 0x5764f740\n\n\n\n#0  0xf7f91e89 in apr_brigade_cleanup (data=0x57674d48)\n    at buckets/apr_brigade.c:54\n        e = <value optimized out>\n#1  0x56590923 in ap_get_brigade (next=0x57674d60, bb=0x5764fa38,\n    mode=AP_MODE_READBYTES, block=APR_BLOCK_READ, readbytes=8192)\n    at util_filter.c:489\nNo locals.\n#2  0x565ad0b5 in ap_proxy_http_process_response (p=0x5764e940, r=0x57670a00,\n    backend=0x565f5de8, origin=0x5764f100, conf=0x565efb08,\n    server_portstr=0xf3c1a8af \"\") at mod_proxy_http.c:1637\n        readbytes = 1443\n        rv = <value optimized out>\n        mode = <value optimized out>\n        finish = 0\n        c = (conn_rec *) 0x5764eb30\n        buffer = \"\\000\\npported\\000 com.microsoft.wm.srvppair,\ncom.microsoft.wm.sswitch, com.microsoft.wm.predstrm, com.microsoft.wm.fastcache,\ncom.microsoft.wm.startupprofile\\000\\n\\000\\000\\000\\000\\034\\030&#65533;&#65533;&#555;\\201&#65533;&#65533;@#[X\\210&#65533;&#65533;\\217.&#65533;&#65533;&#65533;l&#65533;&#65533;\\230&#65533;*[\\235\\022\\000\\000`\n&#65533;&#65533;&#1577;&#65533;&#65533;\\034\\030&#65533;&#65533;\"...\n        buf = <value optimized out>\n        keepchar = <value optimized out>\n        rp = (request_rec *) 0x5764fa48\n        e = <value optimized out>\n        bb = (apr_bucket_brigade *) 0x5764fa38\n        tmp_bb = (apr_bucket_brigade *) 0x57674c58\n        len = 15\n        backasswards = 0\n        interim_response = 0\n        pread_len = 0\n        save_table = (apr_table_t *) 0x576727f8\n        backend_broke = 0\n        te = 0x57688de8 \"chunked\"\n        hop_by_hop_hdrs = {0x565d188d \"Keep-Alive\",\n  0x565ccb45 \"Proxy-Authenticate\", 0x565d8aa9 \"TE\", 0x565d6a9f \"Trailer\",\n  0x565d18a1 \"Upgrade\", 0x0}\n#3  0x565af055 in proxy_http_handler (r=0x57670a00, worker=0x565f3ef8,\n    conf=0x565efb08,\n    url=0x5764f0a0\n\"/trailer.at/trailer_er/er_dervoyeur1_tr_300.wmv?px_cip=86.59.37.76.ip&px_host=trailer.at.host\",\nproxyname=0x0, proxyport=0)\n    at mod_proxy_http.c:1885\n        data = 0x57670a00 \"&#65533;\\tgW0&#65533;dW &#65533;^V\"\n        bytes_read = 1466231600\n        bytes_written = 0\n        status = <value optimized out>\n        server_portstr = \"\\000&#65533;&#65533;&#65533;&#65533;\\000\\000\\000\\000(&#65533;&#65533;&#65533;\\204,&#65533;&#65533;&#65533;\\tgW\\b&#65533;^V&#65533;!gW\\000\\000\"\n        scheme = 0x5764f010 \"http\"\n        proxy_function = 0x565d6a0d \"HTTP\"\n        backend = (proxy_conn_rec *) 0x565f5de8\n        is_ssl = <value optimized out>\n        p = (apr_pool_t *) 0x5764e940\n#4  0x5659e5d0 in proxy_run_scheme_handler (r=0x57670a00, worker=0x565f3ef8,\n    conf=0x565efb08,\n    url=0x576721e6\n\"http://194.50.253.10/trailer.at/trailer_er/er_dervoyeur1_tr_300.wmv?px_cip=86.59.37.76.ip&px_host=trailer.at.host\",\nproxyhost=0x0,\n---Type <return> to continue, or q <return> to quit---\n    proxyport=0) at mod_proxy.c:2240\n        n = 0\n        rv = <value optimized out>\n#5  0x565a2c36 in proxy_handler (r=0x57670a00) at mod_proxy.c:884\n        url = 0x576721e6\n\"http://194.50.253.10/trailer.at/trailer_er/er_dervoyeur1_tr_300.wmv?px_cip=86.59.37.76.ip&px_host=trailer.at.host\"\n        uri = 0x576721e6\n\"http://194.50.253.10/trailer.at/trailer_er/er_dervoyeur1_tr_300.wmv?px_cip=86.59.37.76.ip&px_host=trailer.at.host\"\n        scheme = 0x57672458 \"http\"\n        p = 0x4 <Address 0x4 out of bounds>\n        p2 = 0x57670b88 \"`\\027gW&#65533; gW`\\027gW&#65533; gW\"\n        conf = (proxy_server_conf *) 0x565efb08\n        proxies = (apr_array_header_t *) 0x565efbd0\n        ents = (struct proxy_remote *) 0x565efbe8\n        i = 1466231672\n        access_status = 0\n        direct_connect = <value optimized out>\n        str = <value optimized out>\n        maxfwd = <value optimized out>\n        balancer = (proxy_balancer *) 0x0\n        worker = (proxy_worker *) 0x565f3ef8\n        attempts = 0\n        max_attempts = 0\n#6  0x565857dd in ap_run_handler (r=0x57670a00) at config.c:157\n        n = 0\n        rv = <value optimized out>\n#7  0x56588f97 in ap_invoke_handler (r=0x57670a00) at config.c:372\n        handler = 0x0\n        result = <value optimized out>\n        old_handler = 0x565d4994 \"proxy-server\"\n        ignore = <value optimized out>\n#8  0x565ba4fe in ap_process_request (r=0x57670a00) at http_request.c:258\n        access_status = <value optimized out>\n#9  0x565b728f in ap_process_http_connection (c=0x5764eb30) at http_core.c:190\n        r = (request_rec *) 0x57670a00\n        csd = (apr_socket_t *) 0x0\n#10 0x5658d4dd in ap_run_process_connection (c=0x5764eb30) at connection.c:43\n        n = 0\n        rv = <value optimized out>\n#11 0x5658d5dc in ap_process_connection (c=0x5764eb30, csd=0x5764e980)\n    at connection.c:178\n        rc = 0\n#12 0x565bfb2f in worker_thread (thd=0x569c2208, dummy=0x573d6cb0)\n    at worker.c:544\n        process_slot = 21\n        thread_slot = 137\n        csd = (apr_socket_t *) 0x5764e980\n        bucket_alloc = (apr_bucket_alloc_t *) 0x576c8a78\n        last_ptrans = (apr_pool_t *) 0x0\n        ptrans = (apr_pool_t *) 0x5764e940\n        rv = <value optimized out>\n        is_idle = <value optimized out>\n#13 0xf7f6ca26 in dummy_worker (opaque=0x569c2208)\n    at threadproc/unix/thread.c:142\nNo locals.\n---Type <return> to continue, or q <return> to quit---\n#14 0xf7f0045b in start_thread () from /lib/libpthread.so.0\nNo symbol table info available.\n#15 0xf7e8524e in clone () from /lib/libc.so.6\n"}, {"count": 7, "tags": [], "bug_id": 44381, "is_private": false, "id": 114050, "attachment_id": null, "creator": "rpluem@apache.org", "creation_time": "2008-02-27T05:20:36Z", "time": "2008-02-27T05:20:36Z", "text": "*** Bug 44496 has been marked as a duplicate of this bug. ***"}, {"count": 8, "tags": [], "bug_id": 44381, "is_private": false, "id": 114051, "attachment_id": null, "creator": "rpluem@apache.org", "creation_time": "2008-02-27T05:23:30Z", "time": "2008-02-27T05:23:30Z", "text": "Does this happen under high request load? If yes, then you may should try the patch committed to fix PR44402 (http://svn.apache.org/viewvc?rev=631362&view=rev)."}, {"count": 9, "attachment_id": null, "bug_id": 44381, "text": "(In reply to comment #8)\n> Does this happen under high request load? If yes, then you may should try the\n> patch committed to fix PR44402\n> (http://svn.apache.org/viewvc?rev=631362&view=rev).\n> \n\n\nYes, it generally happens under high load although for a while I was seeing a bunch of requests to www.lonelywivesdatingclub.com which caused the server to start spinning. I was able to reproduce this state myself a few times but not with any one request or reliable sequence so it's hard to provide a test-case...\n\nI'll try this patch and will let you know how it goes.", "id": 114085, "time": "2008-02-27T16:07:14Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-02-27T16:07:14Z", "tags": [], "is_private": false}, {"count": 10, "attachment_id": null, "creator": "pbelau1@yahoo.com", "text": "Ruediger,\n\nThe proposed patch has mixed results. The frequency of occurrence seems to have gone down but Apache still continues to spin on occasion. I did a stack dump of two spinning processes -- both of them got stuck on lonelywivesdatingclub.com again.\n\nPlease let me know what I can do in order to provide you with more useful info.\n\nPeter\n", "id": 114140, "time": "2008-02-29T12:05:19Z", "bug_id": 44381, "creation_time": "2008-02-29T12:05:19Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 44381, "text": "Ruediger,\n\nThe proposed patch has mixed results. The frequency of occurrence seems to have\ngone down but Apache still continues to spin on occasion. I did a stack dump of\ntwo spinning processes -- both of them got stuck on lonelywivesdatingclub.com\nagain.\n\nPlease let me know what I can do in order to provide you with more useful info.\n\nPeter", "id": 114141, "time": "2008-02-29T12:06:14Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-02-29T12:06:14Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 44381, "text": "Please provide the stack traces of the spinning processes.", "id": 114145, "attachment_id": null, "creator": "rpluem@apache.org", "creation_time": "2008-02-29T13:47:08Z", "time": "2008-02-29T13:47:08Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 44381, "attachment_id": null, "id": 114149, "time": "2008-02-29T14:28:20Z", "creator": "rpluem@apache.org", "creation_time": "2008-02-29T14:28:20Z", "is_private": false, "text": "I don't know if you have, but if not please try to create core dumps of the spinning processes. That makes it easier later on to analyze the stack traces if there are questions that require additional debug commands to be executed. You can create a core dump by attaching to the process with gdb and executing the gdb command gcore.\nMaybe you should also try to compile with -g -Wall -O0 to reduce the numbers of variables in the stack trace shown as optimized out."}, {"count": 14, "attachment_id": 21611, "bug_id": 44381, "text": "Created attachment 21611\nSpinning process backtrace #1", "id": 114208, "time": "2008-03-03T12:17:41Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-03-03T12:17:41Z", "tags": [], "is_private": false}, {"count": 15, "tags": [], "creator": "pbelau1@yahoo.com", "text": "Created attachment 21612\nSpinning process backtrace #2", "id": 114209, "time": "2008-03-03T12:18:01Z", "bug_id": 44381, "creation_time": "2008-03-03T12:18:01Z", "is_private": false, "attachment_id": 21612}, {"count": 16, "tags": [], "bug_id": 44381, "attachment_id": null, "text": "Thanks for the backtraces, but they are somewhat hard to read. It would be a great help if you could tell me which of the threads was actually spinning and consuming CPU (a recent top and top -H -p <pid of spinning apache process> should be your friend here) and if you could issue an \"info threads\" command in gdb as this would give a quick overview about all the available threads and their stackframe #0.", "id": 114212, "time": "2008-03-03T13:28:44Z", "creator": "rpluem@apache.org", "creation_time": "2008-03-03T13:28:44Z", "is_private": false}, {"count": 17, "attachment_id": null, "bug_id": 44381, "text": "Ok I have a suspect and you are not going to like it :-). Its thread 26040 in the first backtrace:\n\n[Switching to thread 108 (Thread 4079500176 (LWP 26040))]#0  0xf7e244f2 in strcasecmp () from /lib/libc.so.6\n#0  0xf7e244f2 in strcasecmp () from /lib/libc.so.6\nNo symbol table info available.\n#1  0xf7f598cb in apr_table_unset (t=0xef3546f0, key=0xf7da7cde \"X-AF-Serial\")\n    at tables/apr_tables.c:629\n        k = <value optimized out>\n        next_elt = (apr_table_entry_t *) 0xec579980\n        end_elt = (apr_table_entry_t *) 0xec7f0e20\n        dst_elt = <value optimized out>\n        checksum = <value optimized out>\n        hash = -135510720\n#2  0xf7da7453 in AdInsertFilterOutFilter (f=0xef3549e0, pbbIn=0x5c4c62d8)\n    at mod_afads_filter.c:160\n        r = (request_rec *) 0xef3280a0\n        c = (conn_rec *) 0x5c4c5458\n        request_string = 0xef329478 \"http://www.lonelywivesdatingclub.com/controller2.php?wm_login=uncjordan3&geo=y&view=gallery&bb=y&prev_sit\ne=thebigswallow.com&ref_url=\"\n        userAgent = 0xef329a88 \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.\n0.04506; InfoPath.2);afcid=Wa2b8d01e73e4892f0361fdb9981a41f4\"\n        bufsize = 60000\n        rv = <value optimized out>\n        len = <value optimized out>\n        data = <value optimized out>\n        insTextBucket = <value optimized out>\n        inputBucket = <value optimized out>\n        pp = <value optimized out>\n        ctxt = (AdInsertState *) 0xef354c18\n#3  0x56591140 in ap_pass_brigade (next=0xf7ec4540, bb=0x5c4c62d8)\n    at util_filter.c:526\n        e = (apr_bucket *) 0x2d\n\nand thread 27974 in the second stacktrace:\n\n[Switching to thread 14 (Thread 4031372176 (LWP 27974))]#0  0xf7e244e0 in strcasecmp () from /lib/libc.so.6\n#0  0xf7e244e0 in strcasecmp () from /lib/libc.so.6\nNo symbol table info available.\n#1  0xf7f598cb in apr_table_unset (t=0x593854a8, key=0xf7da7cde \"X-AF-Serial\")\n    at tables/apr_tables.c:629\n        k = <value optimized out>\n        next_elt = (apr_table_entry_t *) 0xec6d1390\n        end_elt = (apr_table_entry_t *) 0xec7f7054\n        dst_elt = <value optimized out>\n        checksum = <value optimized out>\n        hash = -135510720\n#2  0xf7da7453 in AdInsertFilterOutFilter (f=0x59385798, pbbIn=0x5c110478)\n    at mod_afads_filter.c:160\n        r = (request_rec *) 0x5c101508\n        c = (conn_rec *) 0x5932e208\n        request_string = 0x5c1029e8 \"http://lonelywivesdatingclub.com/index.php?wm_login=cenerror&app=y&geo=y&page=main&ref_url=http%3A%2F%2Fw\nww.lonelywivesdatingclub.com%2Findex3.php%3Fwm_login%3Duncjordan3%26geo%3Dy%26view%3Dgallery%26\"...\n        userAgent = 0x5c103280 \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.\n0.04506; InfoPath.2);afcid=Wa2b8d01e73e4892f0361fdb9981a41f4\"\n        bufsize = 60000\n        rv = <value optimized out>\n        len = <value optimized out>\n        data = <value optimized out>\n        insTextBucket = <value optimized out>\n        inputBucket = <value optimized out>\n        pp = <value optimized out>\n        ctxt = (AdInsertState *) 0x593859d0\n#3  0x56591140 in ap_pass_brigade (next=0xf7ec4540, bb=0x5c110478)\n    at util_filter.c:526\n        e = (apr_bucket *) 0xf7ef2380\n\n\nBoth are stuck in apr_table_unset which is called from your third party module mod_afads_filter.c. So there might be some sort of loop in this module provided the table used by apr_table_unset is not corrupt and apr_table_unset works properly which is likely as its code is very old and bullet proof.\nAnyway to be sure, please do the following in gdb:\n\nthread 108   or thread 14  (depends on first or second backtrace).\nframe 2\np *r\nframe 1\ndump_table t\n\n\nBe sure to store https://svn.apache.org/repos/asf/httpd/httpd/trunk/.gdbinit in the home directory of the user whith whom you call gdb before.\n\n", "id": 114213, "time": "2008-03-03T13:45:01Z", "creator": "rpluem@apache.org", "creation_time": "2008-03-03T13:45:01Z", "tags": [], "is_private": false}, {"count": 18, "tags": [], "bug_id": 44381, "is_private": false, "text": "Ruediger,\n\nI'll do that in the future but for the first process take a look at thread #108, #14 in the second one. These are the spinning threads. Again, these are both stuck in apr_table_unset but this is a coincidence. I've seen spinning threads in other functions as well. What's not a coincidence is lonelywivesdatingclub.com. This site seems to intermittently give Apache problems.\n\nAlso, again, please let me know if you'd like to see the associated core files. They're around 300mb each but I can upload them somewhere...\n\nPeter\n", "id": 114214, "time": "2008-03-03T13:51:57Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-03-03T13:51:57Z", "attachment_id": null}, {"count": 19, "tags": [], "text": "Ruediger,\n\nSorry, I missed this message. As I mentioned, the fact that the spin happened in my code is a coincidence. I can show you a backtrace where it's happening outside of it...\n\nPeter\n\n\n(In reply to comment #17)\n> Ok I have a suspect and you are not going to like it :-). Its thread 26040 in\n> the first backtrace:\n> \n> [Switching to thread 108 (Thread 4079500176 (LWP 26040))]#0  0xf7e244f2 in\n> strcasecmp () from /lib/libc.so.6\n> #0  0xf7e244f2 in strcasecmp () from /lib/libc.so.6\n> No symbol table info available.\n> #1  0xf7f598cb in apr_table_unset (t=0xef3546f0, key=0xf7da7cde \"X-AF-Serial\")\n>     at tables/apr_tables.c:629\n>         k = <value optimized out>\n>         next_elt = (apr_table_entry_t *) 0xec579980\n>         end_elt = (apr_table_entry_t *) 0xec7f0e20\n>         dst_elt = <value optimized out>\n>         checksum = <value optimized out>\n>         hash = -135510720\n> #2  0xf7da7453 in AdInsertFilterOutFilter (f=0xef3549e0, pbbIn=0x5c4c62d8)\n>     at mod_afads_filter.c:160\n>         r = (request_rec *) 0xef3280a0\n>         c = (conn_rec *) 0x5c4c5458\n>         request_string = 0xef329478\n> \"http://www.lonelywivesdatingclub.com/controller2.php?wm_login=uncjordan3&geo=y&view=gallery&bb=y&prev_sit\n> e=thebigswallow.com&ref_url=\"\n>         userAgent = 0xef329a88 \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT\n> 6.0; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.\n> 0.04506; InfoPath.2);afcid=Wa2b8d01e73e4892f0361fdb9981a41f4\"\n>         bufsize = 60000\n>         rv = <value optimized out>\n>         len = <value optimized out>\n>         data = <value optimized out>\n>         insTextBucket = <value optimized out>\n>         inputBucket = <value optimized out>\n>         pp = <value optimized out>\n>         ctxt = (AdInsertState *) 0xef354c18\n> #3  0x56591140 in ap_pass_brigade (next=0xf7ec4540, bb=0x5c4c62d8)\n>     at util_filter.c:526\n>         e = (apr_bucket *) 0x2d\n> \n> and thread 27974 in the second stacktrace:\n> \n> [Switching to thread 14 (Thread 4031372176 (LWP 27974))]#0  0xf7e244e0 in\n> strcasecmp () from /lib/libc.so.6\n> #0  0xf7e244e0 in strcasecmp () from /lib/libc.so.6\n> No symbol table info available.\n> #1  0xf7f598cb in apr_table_unset (t=0x593854a8, key=0xf7da7cde \"X-AF-Serial\")\n>     at tables/apr_tables.c:629\n>         k = <value optimized out>\n>         next_elt = (apr_table_entry_t *) 0xec6d1390\n>         end_elt = (apr_table_entry_t *) 0xec7f7054\n>         dst_elt = <value optimized out>\n>         checksum = <value optimized out>\n>         hash = -135510720\n> #2  0xf7da7453 in AdInsertFilterOutFilter (f=0x59385798, pbbIn=0x5c110478)\n>     at mod_afads_filter.c:160\n>         r = (request_rec *) 0x5c101508\n>         c = (conn_rec *) 0x5932e208\n>         request_string = 0x5c1029e8\n> \"http://lonelywivesdatingclub.com/index.php?wm_login=cenerror&app=y&geo=y&page=main&ref_url=http%3A%2F%2Fw\n> ww.lonelywivesdatingclub.com%2Findex3.php%3Fwm_login%3Duncjordan3%26geo%3Dy%26view%3Dgallery%26\"...\n>         userAgent = 0x5c103280 \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT\n> 6.0; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.\n> 0.04506; InfoPath.2);afcid=Wa2b8d01e73e4892f0361fdb9981a41f4\"\n>         bufsize = 60000\n>         rv = <value optimized out>\n>         len = <value optimized out>\n>         data = <value optimized out>\n>         insTextBucket = <value optimized out>\n>         inputBucket = <value optimized out>\n>         pp = <value optimized out>\n>         ctxt = (AdInsertState *) 0x593859d0\n> #3  0x56591140 in ap_pass_brigade (next=0xf7ec4540, bb=0x5c110478)\n>     at util_filter.c:526\n>         e = (apr_bucket *) 0xf7ef2380\n> \n> \n> Both are stuck in apr_table_unset which is called from your third party module\n> mod_afads_filter.c. So there might be some sort of loop in this module provided\n> the table used by apr_table_unset is not corrupt and apr_table_unset works\n> properly which is likely as its code is very old and bullet proof.\n> Anyway to be sure, please do the following in gdb:\n> \n> thread 108   or thread 14  (depends on first or second backtrace).\n> frame 2\n> p *r\n> frame 1\n> dump_table t\n> \n> \n> Be sure to store https://svn.apache.org/repos/asf/httpd/httpd/trunk/.gdbinit in\n> the home directory of the user whith whom you call gdb before.\n> \n\n", "attachment_id": null, "id": 114215, "creator": "pbelau1@yahoo.com", "time": "2008-03-03T13:55:18Z", "bug_id": 44381, "creation_time": "2008-03-03T13:55:18Z", "is_private": false}, {"count": 20, "tags": [], "creator": "pbelau1@yahoo.com", "text": "Created attachment 21613\nSpinning process backtrace #3\n\nSpinning outside of my filter code.", "id": 114216, "time": "2008-03-03T13:59:44Z", "bug_id": 44381, "creation_time": "2008-03-03T13:59:44Z", "is_private": false, "attachment_id": 21613}, {"count": 21, "tags": [], "bug_id": 44381, "text": "Take a look at  thread #172.\n\n\n(In reply to comment #20)\n> Created an attachment (id=21613) [details]\n> Spinning process backtrace #3\n> \n> Spinning outside of my filter code.\n> \n\n", "id": 114217, "attachment_id": null, "creator": "pbelau1@yahoo.com", "creation_time": "2008-03-03T14:01:34Z", "time": "2008-03-03T14:01:34Z", "is_private": false}, {"count": 22, "tags": [], "bug_id": 44381, "attachment_id": null, "is_private": false, "id": 114218, "time": "2008-03-03T14:17:05Z", "creator": "rpluem@apache.org", "creation_time": "2008-03-03T14:17:05Z", "text": "(In reply to comment #18)\n> Ruediger,\n> \n> \n> Also, again, please let me know if you'd like to see the associated core files.\n> They're around 300mb each but I can upload them somewhere...\n\nNo thanks. I guess they are only of use in your environment. For the third stacktrace, please execute the following gdb commands:\n\nthread 172\ndump_brigade 0x588b3e80\n\nAnother issue: Please do NOT change this bug to assigned and put me on CC. I get notified about ANY changes on ANY bug anyway. \n\n"}, {"count": 23, "tags": [], "bug_id": 44381, "is_private": false, "id": 114219, "creation_time": "2008-03-03T14:28:46Z", "time": "2008-03-03T14:28:46Z", "creator": "pbelau1@yahoo.com", "text": "Ruediger,\n\nSorry about that. I'm not actively changing the bug status -- perhaps it's happening because of the \"if you are providing additional info, check this box\" option. \n\nAnyway, I don't have the third process running anymore so I cannot attach GDB to it (I don't have the core either). I'll wait for something similar to happen again and will attach both the stack-trace and the execute the commands you requested.\n\nPeter\n", "attachment_id": null}, {"count": 24, "tags": [], "bug_id": 44381, "text": "Created attachment 21614\nSpinning process backtrace #4", "id": 114220, "attachment_id": 21614, "creator": "pbelau1@yahoo.com", "creation_time": "2008-03-03T14:38:22Z", "time": "2008-03-03T14:38:22Z", "is_private": false}, {"count": 25, "tags": [], "bug_id": 44381, "attachment_id": null, "text": "(In reply to comment #24)\n> Created an attachment (id=21614) [details]\n> Spinning process backtrace #4\n> \n\nIs anyone looking at this bug ? I can provide some more backtraces but I'd really appreciate it if someone could take a loko at this issue. It's a real bug. Also, I'm not quire sure \n(In reply to comment #24)\n> Created an attachment (id=21614) [details]\n> Spinning process backtrace #4\n> \n\nIs anyone looking into this bug ? It's kind of frustrating to provide reports and have them completely ignored. Some help would be greatly appreciated. Also, I have generated a core-dump of the Apache process spinning outside of my filter calls.", "id": 114514, "time": "2008-03-11T17:43:49Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-03-11T17:43:49Z", "is_private": false}, {"count": 26, "tags": [], "bug_id": 44381, "attachment_id": null, "is_private": false, "id": 114515, "time": "2008-03-12T01:05:32Z", "creator": "rpluem@apache.org", "creation_time": "2008-03-12T01:05:32Z", "text": "(In reply to comment #24)\n> Created an attachment (id=21614) [details]\n> Spinning process backtrace #4\n> \n\nWhich thread(s) are spinning?"}, {"count": 27, "tags": [], "bug_id": 44381, "attachment_id": 21656, "is_private": false, "id": 114519, "time": "2008-03-12T03:22:13Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-03-12T03:22:13Z", "text": "Created attachment 21656\nSpinning process backtrace #5"}, {"count": 28, "tags": [], "bug_id": 44381, "attachment_id": null, "is_private": false, "id": 114520, "time": "2008-03-12T03:23:01Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-03-12T03:23:01Z", "text": "(In reply to comment #26)\n> (In reply to comment #24)\n> > Created an attachment (id=21614) [details] [details]\n> > Spinning process backtrace #4\n> > \n> \n> Which thread(s) are spinning?\n> \n\nThanks for responding. I've attached another trace which shows the thread spinning outside of my custom module calls. The spinning thread is #234. I have a core file for this trace as well so I can provide state information via GDB."}, {"count": 29, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 114527, "time": "2008-03-12T08:03:14Z", "bug_id": 44381, "creation_time": "2008-03-12T08:03:14Z", "is_private": false, "text": "(In reply to comment #28)\n> (In reply to comment #26)\n> > (In reply to comment #24)\n> > > Created an attachment (id=21614) [details] [details] [details]\n> > > Spinning process backtrace #4\n> > > \n> > \n> > Which thread(s) are spinning?\n> > \n> \n> Thanks for responding. I've attached another trace which shows the thread\n> spinning outside of my custom module calls. The spinning thread is #234. I have\n\nAs it is somewhat unlikely that the code is spinning there how did you find out that thread #234 is spinning?\n\n"}, {"count": 30, "tags": [], "creator": "pbelau1@yahoo.com", "text": "(In reply to comment #29)\n> (In reply to comment #28)\n> > (In reply to comment #26)\n> > > (In reply to comment #24)\n> > > > Created an attachment (id=21614) [details] [details] [details] [details]\n> > > > Spinning process backtrace #4\n> > > > \n> > > \n> > > Which thread(s) are spinning?\n> > > \n> > \n> > Thanks for responding. I've attached another trace which shows the thread\n> > spinning outside of my custom module calls. The spinning thread is #234. I have\n> \n> As it is somewhat unlikely that the code is spinning there how did you find out\n> that thread #234 is spinning?\n> \n\nStack dumps repeated many times over the course of several minutes continue to show the same backtrace for thread 234. Also, this bug is semi-reproducible. I have been able to provoke 100% CPU utilization by browsing lonelywivesdatingclub.com.\n", "id": 114535, "time": "2008-03-12T10:52:05Z", "bug_id": 44381, "creation_time": "2008-03-12T10:52:05Z", "is_private": false, "attachment_id": null}, {"count": 31, "tags": [], "creator": "rpluem@apache.org", "text": "(In reply to comment #30)\n\n> \n> Stack dumps repeated many times over the course of several minutes continue to\n> show the same backtrace for thread 234. Also, this bug is semi-reproducible. I\n> have been able to provoke 100% CPU utilization by browsing\n> lonelywivesdatingclub.com.\n> \n\nCan you please check if the following patch fixes your problem?\n\nIndex: modules/http/http_filters.c\n===================================================================\n--- modules/http/http_filters.c (Revision 636503)\n+++ modules/http/http_filters.c (Arbeitskopie)\n@@ -425,6 +425,10 @@\n                           (APR_STATUS_IS_EAGAIN(rv)) )) {\n                         return APR_EAGAIN;\n                     }\n+                    /* If we get an error, then leave */\n+                    if (rv != APR_SUCCESS) {\n+                        return rv;\n+                    }\n                     /*\n                      * We really don't care whats on this line. If it is RFC\n                      * compliant it should be only \\r\\n. If there is more\n\n\n", "id": 114541, "attachment_id": null, "bug_id": 44381, "creation_time": "2008-03-12T14:51:29Z", "time": "2008-03-12T14:51:29Z", "is_private": false}, {"count": 32, "tags": [], "bug_id": 44381, "attachment_id": null, "is_private": false, "id": 114673, "time": "2008-03-17T01:23:10Z", "creator": "pbelau1@yahoo.com", "creation_time": "2008-03-17T01:23:10Z", "text": "Ruediger,\n\nThe latest patch seems to have done the trick. I'd like to wait a few more days before closing out the bug report but things are looking good. The spinning used to happen a few times per day but I have not seen it in two days now.\n\n\nUntil the next bug report :)\n\nPeter\n"}, {"count": 33, "tags": [], "bug_id": 44381, "text": "Ruediger,\n\nYour patch to http_filters.c also fixes our spinning Apache.\n\nWe have a Heartbeat pair of servers running 2.2.8 as load balancers using mod_proxy_balancer, feeding 3 2.2.8 backends.  Typically 2 or 3 times a week one of the load balancers would start spinning at 100% CPU, first logging:\n\n  [info] [client n.n.n.n] (70007)The timeout specified has expired: SSL input filter read failed.\n\nand then furiously logging tens of times a second until killed:\n\n  [info] [client n.n.n.n] (70014)End of file found: SSL input filter read failed.\n\nwhere n.n.n.n is IP address of a backend server. We moved from prefork MPM to worker, but it didn't help.  I rebuilt load balancers with fix from http://svn.apache.org/viewvc?view=rev&revision=631362, but also your suggested patch of 2008-03-12 to httpd_filters.c, with an additional logging line before the \"return rv\".  Now (using worker MPM, not tested prefork) we get no spinning, but instead 2 or 3 times a week just a pair of logging lines:\n\n  [info] [client n.n.n.n] (70007)The timeout specified has expired: SSL input filter read failed.\n  [error] [client n.n.n.n] ap_http_filter: error 70007\n\n(the 2nd line is mine) and no obvious problem with the service.  Looks like your patch could usefully be pushed into the main source tree.\n\nCheers,\n\nColin\n", "id": 117233, "attachment_id": null, "creator": "colin@xvpsource.org", "creation_time": "2008-06-02T01:14:17Z", "time": "2008-06-02T01:14:17Z", "is_private": false}, {"count": 34, "attachment_id": null, "creator": "rpluem@apache.org", "is_private": false, "id": 117244, "time": "2008-06-02T04:00:20Z", "bug_id": 44381, "creation_time": "2008-06-02T04:00:20Z", "tags": [], "text": "Both patches will be part of 2.2.9."}]
[{"count": 0, "tags": [], "bug_id": 60261, "text": "Created attachment 34377\nProposed patch\n\nOverview:\n\nThis problem occurs mainly with Docker (or other containerization technologies) with the main process being Apache because it always have the same PID (PID 1). \n\nThe issue arises when the container (or the process inside) fails without proper error handling (kill -9 for example). In this case, Apache can't remove its PID file (which contains \"1\").\nOnce the container is restarted, Apache restarts inside with PID 1 but fails when reading the PID file which also contains \"1\" (with error: \"http (pid 1) already running\").\n\n\nSteps to Reproduce:\n\n* docker run -it httpd:latest bash\n* get current PID counter: `ps -ef`, then get \"ps\" current PID (let's assume it's 5)\n* set this PID + 1 to logs/httpd.pid: `echo 6 > logs/httpd.pid`\n* try to run Apache: it fails with: httpd (pid 6) already running\n\n\nActual Results:\n\nApache fails to start although there is no reason to fail.\n\n\nExpected Results:\n\nApache can realize the PID in the file is actually himself and can then proceed to launch.\n\n\nBuild Date & Hardware:\n\n2016-10-14 on Linux (CentOS 7.2.1511, Docker 1.12.0, Apache from 2.4.6 to 2.4.23)", "id": 194464, "time": "2016-10-17T07:38:13Z", "creator": "valentin.bremond@gmail.com", "creation_time": "2016-10-17T07:38:13Z", "is_private": false, "attachment_id": 34377}, {"count": 1, "tags": [], "creator": "ylavic.dev@gmail.com", "is_private": false, "text": "Created attachment 34378\nSame PID can't be running\n\nThanks for the report (and patch).\n\nThis other approach handles the case as if httpd were not running (it can't be), no particular logging (possibly obscure, especially if some stop is asked).\n\nThere is still later message about \"pid file %s overwritten -- Unclean shutdown of previous Apache run?\", which I think is enough as notice for (re)starts.\n\nDoes it work for you?", "id": 194465, "time": "2016-10-17T08:25:43Z", "bug_id": 60261, "creation_time": "2016-10-17T08:25:43Z", "attachment_id": 34378}, {"count": 2, "attachment_id": null, "creator": "valentin.bremond@gmail.com", "text": "Hello,\n\nYep it works too. Your patch is indeed simpler but still understandable.\n\nOK for me!", "id": 194466, "time": "2016-10-17T09:26:46Z", "bug_id": 60261, "creation_time": "2016-10-17T09:26:46Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "bug_id": 60261, "attachment_id": null, "text": "Committed in r1766160 and proposed for backport to 2.4.x.", "id": 194631, "time": "2016-10-21T21:49:17Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2016-10-21T21:49:17Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 60261, "attachment_id": null, "is_private": false, "id": 194825, "time": "2016-11-04T22:23:22Z", "creator": "ylavic.dev@gmail.com", "creation_time": "2016-11-04T22:23:22Z", "text": "Backported to upcoming 2.4.24 in r1768078."}]
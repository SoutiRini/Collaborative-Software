[{"count": 0, "attachment_id": null, "bug_id": 40128, "is_private": false, "id": 91664, "time": "2006-07-27T20:23:20Z", "creator": "leo.torbochkin@gdc4s.com", "creation_time": "2006-07-27T20:23:20Z", "tags": [], "text": "After making sure that the cell is in numeric format:\n\nWhen calling the HSSFDateUtil.isCellDateFormatted(cell) method, it returns false\nfor all excel date formats other than M/DD/YYYY.\n  \nIf you use a custom date format it works but not the actual excel date format.\n\nI believe this is because it calls the\n \nisInternalDateFormat(int format) method which checks against these hex values:\n \n                case 0x0e:\n                case 0x0f:\n                case 0x10:\n                case 0x11:\n                case 0x12:\n                case 0x13:\n                case 0x14:\n                case 0x15:\n                case 0x16:\n                case 0x2d:\n                case 0x2e:\n                case 0x2f:\n\nhowever these values are only for the custom date formats, not actual date formats.\n\nAdding the following should recognize the actual date formats instead of only\ncustom ones:\n\nValues were found through experimentation with excell's date formatting.\nThey correspond to the HSSFCell.getCellStyle().getDataFormat() values for excel\ndates.\n\nThe format they represent is shown next to them.\n\n      case 0xA6: // Monday, July 24, 2006\n      case 0xA7: // 7/24\n\n      case 0xA8: // 7/24/06\n\n      case 0xA9: // 07/24/06\n\n      case 0xAA: // 24-Jul\n\n      case 0xAB: // 24-Jul-06\n\n\n      case 0xAD: // 24-Jul-06\n\n      case 0xAE: // Jul-06\n\n      case 0xAF: // July-06\n\n      case 0xB0: // July 24, 2006\n\n      case 0xB1: // 7/24/06 12:00 AM\n\n      case 0xB2: // 7/24/06 0:00\n\n      case 0xB3: // J\n\n      case 0xB4: // J-06\n\n      case 0xB5: // 7/24/2006\n\n      case 0xB6: // 24-Jul-2006"}, {"attachment_id": null, "tags": [], "bug_id": 40128, "text": "Dont suppose that you could attach an excel file with the first row of the first\nsheet containing cells which include a date, with each cell having the different\nformat as you indicate below.\n\nWe can then include it in a unit test and get it fixed.\n\nMaybe you could even make the appropriate changes to isInternalDateFormat,\ninclude a test case and attach a patch to this bug\n\nJason", "count": 1, "id": 91679, "time": "2006-07-28T00:49:15Z", "creator": "jheight@apache.org", "creation_time": "2006-07-28T00:49:15Z", "is_private": false}, {"attachment_id": 18660, "tags": [], "bug_id": 40128, "text": "Created attachment 18660\nThe excel sheet with dates formatted to each excel date format.\n\nI have attached a spreadsheet with the 17 date formats that excel currently\nuses.", "count": 2, "id": 91697, "time": "2006-07-28T13:29:39Z", "creator": "leo.torbochkin@gdc4s.com", "creation_time": "2006-07-28T13:29:39Z", "is_private": false}, {"count": 3, "tags": [], "creator": "indra@feeddex.nl", "text": "I believe also the value 164 (equals 0xA4 i think?) should be added to this list.\nIn my OpenOffice browser it shows up in the format\n\ndd-MM-yyyy\n\nwhile the double value is something like 38898.0\n\nAfter adding this value to the accepted list, I could get the proper date \nof this value as \n30-6-2006 (In a dd-MM-yyyy format :).\n\nWhat is the definitive word on this issue? Should the \n\n// Internal Date Formats as described on page 427 in\n\n// Microsoft Excel Dev's Kit...\n\ncomment be read as \n\n// Some of the Internal Date Formats as described on page 427 in\n// Microsoft Excel Dev's Kit...\n\nIf you come across a complete list (or the correct version of the\nisInternalDateFormat function) please mail it to me at \nindra@feeddex.nl\n\nFor now, I just add some additional constants when I encounter them...\nMaybe we can ask the guys from OpenOffice since they apparently know how to do\nit. (Version 2.0)\n\nIsn't that program open source as well? I'll look it up there...(In reply to\ncomment #2)\n> Created an attachment (id=18660) [edit]\n> The excel sheet with dates formatted to each excel date format.\n> \n> I have attached a spreadsheet with the 17 date formats that excel currently\n> uses.", "id": 92492, "time": "2006-08-24T13:45:46Z", "bug_id": 40128, "creation_time": "2006-08-24T13:45:46Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": 19003, "bug_id": 40128, "is_private": false, "id": 94815, "time": "2006-10-13T10:14:50Z", "creator": "mail@paulhaeder.de", "creation_time": "2006-10-13T10:14:50Z", "tags": [], "text": "Created attachment 19003\nProposed patch of HSSFUtil.Java\n\nAdditional values in isInternalDateFormat() for better recognition of date\nformatted cells."}, {"count": 5, "tags": [], "bug_id": 40128, "attachment_id": 19003, "is_private": false, "id": 94816, "time": "2006-10-13T10:23:44Z", "creator": "mail@paulhaeder.de", "creation_time": "2006-10-13T10:23:44Z", "text": "Comment on attachment 19003\nProposed patch of HSSFUtil.Java\n\nI did some experimenting, too and I came up with some of the same values as\nJason did. I found some additional ones too. \n\nI also noticed that the same date format can have different format codes. (I\ncopy/pasted a date cell from one sheet to another and it had a different hex\nvalue there.)\n\nI'm attaching a proposed patch that checks for the union of Jason's and my\nvalues hoping that most (all?) date formatted cells are recognized that way."}, {"count": 6, "attachment_id": null, "bug_id": 40128, "is_private": false, "id": 94865, "time": "2006-10-16T10:42:53Z", "creator": "mail@paulhaeder.de", "creation_time": "2006-10-16T10:42:53Z", "tags": [], "text": "I guess that was Leo, not Jason. Sorry about that."}, {"attachment_id": null, "tags": [], "bug_id": 40128, "text": "I'm not sure this approach is correct. I'm not an MS Excel format expert but if\nthey say that there are only several formats described as date/time formats in\nMicrosoft Excel Dev's Kit then only those formats should be guarantied to be\ndate/time.\n\nI bring this up because I have an Excel file created in OpenOffice that has\n\"standard number\" format for some numbers (data format 164 in my case) and this\nformat is evaluated by the patch as being date cell (which it definitely is not\nin my case). On the opposite, there are cells formated as date (Czech format,\ndata format 165) and this format is evaluated as not being date cell (which it\ndefinitely is in my case).\n\nI thougth about a more general approach that would determine whether the cell is\ndate/time or not using the format string specified in the data format and not an\nindex which seems it really doesn't work across different Excel files. So simply\nsaid, if the formatting string contains date/time formatters then the cell would\nbe evaluated as date cell, otherwise it is a numeric cell.\n\nI went through the API looking for a way to get HSSFDataFormat for given cell\nbut found only that I can create instance of it using Workbook object which I\ndon't know how to get from HSSFWorkbook object. I would like to verify that this\napproach will work and eventually write the patch.", "count": 7, "id": 95318, "time": "2006-11-02T01:47:41Z", "creator": "miroslav.sulc@startnet.cz", "creation_time": "2006-11-02T01:47:41Z", "is_private": false}, {"count": 8, "attachment_id": null, "bug_id": 40128, "text": "The problem is differentiating actual excel \"date\" formats from \"custom\" formats\nthat are normally dates.  For instance, dd-MM-yyyy is not an actual supported\n\"date\" format however there are \"custom\" formats available (in excel and open\noffice) that define the format dd-MM-yyyy as a date.\n\nPerhaps there should be two separate methods, one for actual \"date\" formats and\none for formats that usually look like dates.", "id": 95338, "time": "2006-11-02T07:09:20Z", "creator": "leo.torbochkin@gdc4s.com", "creation_time": "2006-11-02T07:09:20Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "bug_id": 40128, "is_private": false, "text": "There are also localized date formats that are not English date formats nor ISO\ndate formats so \"guessing\" the date format using date time formatters would be\nIMO appropriate 'cos users want date values to be processed as dates no matter\nwhether it is Excel \"native\" or custom format. When reading Excel file, I do not\nreally care whether the date format is Excel \"native\" or it is a custom format.\nI just want to read the value from cell as date if the data format says that the\ncell value should be formatted as date.\n\nAny suggestion how to implement this? I have idea how to implement it but I\ncannot get HSSFDataFormat object for a cell as noted in comment #7.", "id": 95339, "time": "2006-11-02T07:22:50Z", "creator": "miroslav.sulc@startnet.cz", "creation_time": "2006-11-02T07:22:50Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 40128, "text": "Since custom formats may be specified it is difficult to gaurantee what a\ncertain format may represent.  \n\nThe custom format 0xA4 may represent dd-MM-yyyy or something else if it was\ndefined differently.  \n\nHowever, a native date format like 0xA6 should always represent a date since it\nis not customized.", "count": 10, "id": 95342, "time": "2006-11-02T07:33:38Z", "creator": "leo.torbochkin@gdc4s.com", "creation_time": "2006-11-02T07:33:38Z", "is_private": false}, {"count": 11, "tags": [], "creator": "miroslav.sulc@startnet.cz", "text": "(In reply to comment #10)\n> Since custom formats may be specified it is difficult to gaurantee what a\n> certain format may represent.  \n> \n> The custom format 0xA4 may represent dd-MM-yyyy or something else if it was\n> defined differently.  \n> \n> However, a native date format like 0xA6 should always represent a date since it\n> is not customized.\n\nAnd that's the reason why it think that using index to determine whether cell\ncontains date or not is not safe and appropriate. Using the formatting string\nwould be better approach I think.", "id": 95348, "time": "2006-11-02T07:51:02Z", "bug_id": 40128, "creation_time": "2006-11-02T07:51:02Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "text": "Created attachment 19084\ndate cell resolution patch\n\nI have created patch that determines more safely whether the cell is a date or\nnot. Because I need to get format specification to determine the cell format, I\ndid not patch HSSFDateUtil but used HSSFWorkbook and Workbook to implement it.\nThe code uses same approach as is used in JExcelApi.", "is_private": false, "bug_id": 40128, "id": 95406, "time": "2006-11-03T12:30:00Z", "creator": "miroslav.sulc@startnet.cz", "creation_time": "2006-11-03T12:30:00Z", "attachment_id": 19084}, {"count": 13, "tags": [], "text": "Is there anything new about this bug?", "is_private": false, "id": 96867, "creator": "miroslav.sulc@startnet.cz", "time": "2006-12-13T04:54:47Z", "bug_id": 40128, "creation_time": "2006-12-13T04:54:47Z", "attachment_id": null}, {"count": 14, "attachment_id": null, "bug_id": 40128, "is_private": false, "id": 106832, "time": "2007-08-16T12:48:46Z", "creator": "dannynip@gmail.com", "creation_time": "2007-08-16T12:48:46Z", "tags": [], "text": "I was trying out the proposed code below,\n \nProposed patch of HSSFUtil.Java patch 2006-10-13 10:14 10.19 KB Edit\n \nAnd it failed when I used the default format of:\n12/31/06 (English US)\n31/12/06 (English Canada)\n \nI fixed this by adding\n \ncase 0xa5:\n \nNote, I did save my .xls (97/2000/XP) Spreadsheet in OpenOffice in Vista.\nAlso I have not read the Microsoft SDK, I just did a\nHSSFCellStyle.getDataFormat() to find the hex value.\n\nPS. vote for this bug!!!"}, {"count": 15, "tags": [], "creator": "apache@gagravarr.org", "text": "There has been quite a lot of work on cell dates in trunk over the last month or\nso. This might well have been fixed, could you try it with SVN trunk and see if\nit now works for you?", "id": 106849, "time": "2007-08-17T03:16:38Z", "bug_id": 40128, "creation_time": "2007-08-17T03:16:38Z", "is_private": false, "attachment_id": null}, {"count": 16, "tags": [], "bug_id": 40128, "text": "(In reply to comment #15)\n\nWhich SVN trunk are you talking about?\n\nOkay, I have confirmed that the hex values for OpenOffice .xls files are\ndifferent.  For a Spreadsheet created in Office XP, default format is \"case\n0x0e:\" (which is fixed in the latest POI 3.0.1 version).\n\ncase 0xa5: is the default Date value in OpenOffice.\ncase 0xa4: is NOT a date format in OpenOffice.  (2006-10-13 proposed fix\nincludes this as a Date)\n\nSo it's Spreadsheets saved in OpenOffice that may potentially cause a ruckus. \nCustom date formats are also suspect.  Anyone test with Office on a Mac?", "id": 106867, "time": "2007-08-17T10:22:33Z", "creator": "dannynip@gmail.com", "creation_time": "2007-08-17T10:22:33Z", "is_private": false, "attachment_id": null}, {"count": 17, "tags": [], "text": "(In reply to comment #16)\n> Which SVN trunk are you talking about?\n\nThe POI svn trunk. If you can't do an svn checkout, there are nightly builds at \nhttp://encore.torchbox.com/poi-svn-build/", "is_private": false, "id": 106922, "creator": "apache@gagravarr.org", "time": "2007-08-20T02:10:08Z", "bug_id": 40128, "creation_time": "2007-08-20T02:10:08Z", "attachment_id": null}, {"count": 18, "tags": [], "creator": "sakari.maaranen@gmail.com", "text": "POI should check if any date-formatting tokens are used in a custom format or if\nthe format is some locale-specific (e.g. Finnish dates), or of course any\nstandard or usual date format.  It doesn't matter which date format is in use as\nlong as the cell contains a date.  POI should detect all formats that are dates,\ncustom, localized, standard, everything.\n\nWe had this problem in our project (with Finnish dates) and our developers had\nto implement a local solution for us.  They did not do it well enough to be\npublished here, but the principle was that if any date or time formatting tokens\nwere used, the cell was interpreted as being a date.  Worked well enough for us.\n\nPlease fix this asap. Localized and custom dates processing is a very basic\nfeature that badly needs support from POI!", "id": 109945, "time": "2007-10-30T04:23:10Z", "bug_id": 40128, "creation_time": "2007-10-30T04:23:10Z", "is_private": false, "attachment_id": null}, {"count": 19, "tags": [], "bug_id": 40128, "text": "(In reply to comment #18)\n> POI should detect all formats that are dates,\n> custom, localized, standard, everything.\n\nPlease feel free to suggest a patch to do this. Unfortunately, excel doesn't\nactually store dates as such. Instead, it just stores a number, then uses the\nformatting rules to decide if it's really a number or a date. It sucks, but\nthat's just what they did.\n\nFor the standard date formats, everything is easy. For custom date formats, we\nhave to try and spot if the formatting rules seem to be numeric, or date based,\nand guess from that.\n\nPatches to allow POI to detect other date formats are gladly received :)", "id": 110259, "time": "2007-11-06T04:35:07Z", "creator": "apache@gagravarr.org", "creation_time": "2007-11-06T04:35:07Z", "is_private": false, "attachment_id": null}, {"count": 20, "tags": [], "creator": "apache@gagravarr.org", "text": "This bug references a very old version of POI. As no new comments have been added in a long time, and lots of work on this area has taken place in POI in the mean time, I'm assuming that this bug has now been fixed\n\nIf the bug still exists with the latest version of POI, please re-open the bug and add a comment indicating this, ideally also with a failing unit test", "id": 137324, "time": "2010-06-03T12:42:39Z", "bug_id": 40128, "creation_time": "2010-06-03T12:42:39Z", "is_private": false, "attachment_id": null}]
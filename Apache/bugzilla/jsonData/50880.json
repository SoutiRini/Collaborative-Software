[{"count": 0, "tags": [], "bug_id": 50880, "attachment_id": 26733, "id": 144775, "time": "2011-03-06T12:34:23Z", "creator": "mark@catseye.org", "creation_time": "2011-03-06T12:34:23Z", "is_private": false, "text": "Created attachment 26733\nPerl script for a test SCGI server that returns the environment passed to it by mod_proxy_scgi\n\nmod_proxy_scgi in trunk currently sets PATH_INFO, SCRIPT_NAME, and\nPATH_TRANSLATED incorrectly per RFC 3875 (CGI 1.1).\n\nThis bug report is for completeness and consistency with respect to\nthe fix for bug 50851.\n\nTo reproduce the problem, run the attached 28 line Perl script, which\nwill create an SCGI server listening on port 4000.  This SCGI server\njust returns environment variables passed to it by mod_proxy_scgi.\nThen configure mod_proxy_scgi with\n\nProxyPass /scgi-test/ scgi://127.0.0.1:4000/www/perl-ssl/\n\nThis presumes that a directory /www/perl-ssl exists in the filesystem,\nunder which are Perl scripts executed by the SCGI server.  However,\nthe SCGI server in the attachment does not actually execute external\nscripts and hence the directory /www/perl-ssl does not need to exist.\n\nWhen the end user requests\n\nhttps://f14dev1.catseye.org/scgi-test/some-script.pl/extra/stuff?foo=1&bar=2\n\nmod_proxy_scgi passes the following environment variables to the SCGI server:\n\nCONTENT_LENGTH=\"0\"\nDOCUMENT_ROOT=\"/www/html-ssl\"\nHTTPS=\"on\"\nHTTP_ACCEPT=\"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\"\nHTTP_ACCEPT_CHARSET=\"ISO-8859-1,utf-8;q=0.7,*;q=0.7\"\nHTTP_ACCEPT_ENCODING=\"gzip,deflate\"\nHTTP_ACCEPT_LANGUAGE=\"en-us,en;q=0.7,ja;q=0.3\"\nHTTP_CONNECTION=\"keep-alive\"\nHTTP_HOST=\"f14dev1.catseye.org\"\nHTTP_KEEP_ALIVE=\"115\"\nHTTP_USER_AGENT=\"Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.15) Gecko/20110303 Firefox/3.6.15\"\nPATH=\"/sbin:/usr/sbin:/bin:/usr/bin\"\nPATH_INFO=\"/www/perl-ssl/some-script.pl/extra/stuff\"\nPATH_TRANSLATED=\"/www/html-ssl/www/perl-ssl/some-script.pl/extra/stuff\"\nQUERY_STRING=\"foo=1&bar=2\"\nREMOTE_ADDR=\"172.16.168.1\"\nREMOTE_PORT=\"49651\"\nREMOTE_USER=\"markmont\"\nREQUEST_METHOD=\"GET\"\nREQUEST_SCHEME=\"https\"\nREQUEST_URI=\"/scgi-test/some-script.pl/extra/stuff?foo=1&bar=2\"\nSCGI=\"1\"\nSCRIPT_FILENAME=\"proxy:scgi://127.0.0.1:4000/www/perl-ssl/some-script.pl/extra/stuff\"\nSCRIPT_NAME=\"/scgi-test\"\nSERVER_ADDR=\"172.16.168.128\"\nSERVER_ADMIN=\"webmaster@catseye.org\"\nSERVER_NAME=\"f14dev1.catseye.org\"\nSERVER_PORT=\"443\"\nSERVER_PROTOCOL=\"HTTP/1.1\"\nSERVER_SIGNATURE=\"<address>Apache/2.3.12-dev (Fedora) Server at <a href=\\\"mailto:webmaster@catseye.org\\\">f14dev1.catseye.org</a> Port 443</address>\\n\"\nSERVER_SOFTWARE=\"Apache/2.3.12-dev (Fedora)\"\nSSL_TLS_SNI=\"f14dev1.catseye.org\"\n\nThis violates the requirement for script-URI in section 3.3 of RFC 3875,\nresulting in a script-URI of\n\nhttps://f14dev1.catseye.org:443/scgi-test/www/perl-ssl/some-script.pl/extra/stuff?foo=1&bar=2\n\ninstead of the correct script-URI, which is\n\nhttps://f14dev1.catseye.org:443/scgi-test/some-script.pl/extra/stuff?foo=1&bar=2\n\nSee bug 50851 for additional discussion."}, {"count": 1, "tags": [], "bug_id": 50880, "attachment_id": 26734, "id": 144776, "time": "2011-03-06T12:39:20Z", "creator": "mark@catseye.org", "creation_time": "2011-03-06T12:39:20Z", "is_private": false, "text": "Created attachment 26734\nPrevent mod_proxy_scgi from setting PATH_INFO unless requested\n\nThe attached patch fixes the problem with mod_proxy_scgi in the same way\nthat r1078089 fixes the same problem for mod_proxy_fcgi.  Thanks to\nJim Jagielski for creating the mod_proxy_fcgi patch.\n\nA new mod_proxy_scgi env-var, proxy-scgi-pathinfo, allows for PATH_INFO\nto be exposed. Otherwise, it's not.\n\nSee bug 50581 for additional details and discussion.\n\nI have looked for other modules with similar problems and have not found\nany."}, {"count": 2, "tags": [], "bug_id": 50880, "attachment_id": null, "is_private": false, "id": 146469, "time": "2011-05-19T16:04:05Z", "creator": "jim@apache.org", "creation_time": "2011-05-19T16:04:05Z", "text": "r1124979"}]
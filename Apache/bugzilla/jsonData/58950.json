[{"count": 0, "tags": [], "bug_id": 58950, "attachment_id": null, "id": 188082, "time": "2016-01-31T17:26:02Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-01-31T17:26:02Z", "is_private": false, "text": "http://mail-archives.apache.org/mod_mbox/jmeter-dev/201601.mbox/%3CCAH9fUpbwMk3e8TDDbHr8xfJ_g2ktxsUz1CU8FdrondToHkoDFQ%40mail.gmail.com%3E"}, {"count": 1, "tags": [], "bug_id": 58950, "attachment_id": 33504, "is_private": false, "id": 188083, "time": "2016-01-31T17:29:03Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-01-31T17:29:03Z", "text": "Created attachment 33504\nModified MeasuringConnectionManager\n\nSome changes tried on KeepAlive management."}, {"count": 2, "tags": [], "bug_id": 58950, "attachment_id": 33505, "id": 188084, "time": "2016-01-31T17:29:37Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-01-31T17:29:37Z", "is_private": false, "text": "Created attachment 33505\nHack to enable better stale management"}, {"attachment_id": null, "tags": [], "bug_id": 58950, "is_private": false, "count": 3, "id": 188085, "time": "2016-01-31T17:32:04Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-01-31T17:32:04Z", "text": "Regression affecting Nightly build as of 30 jan 2016"}, {"count": 4, "tags": [], "text": "Created attachment 33506\nAWS Monitoring showing the difference in behaviour between versions\n\nHigh metrics are for r1715087, low are for current trunk", "is_private": false, "id": 188086, "creator": "p.mouawad@ubik-ingenierie.com", "time": "2016-01-31T17:34:06Z", "bug_id": 58950, "creation_time": "2016-01-31T17:34:06Z", "attachment_id": 33506}, {"count": 5, "tags": [], "text": "Created attachment 33507\nTest case to reproduce the keepalive issue\n\nThe server under test is configured with a keepalive timeout of 2 seconds. The test waits 3 seconds after each request.\n\nThis results in a Exception on the second request: org.apache.http.NoHttpResponseException: localhost:8080 failed to respond", "is_private": false, "id": 188087, "creator": "felix.schumacher@internetallee.de", "time": "2016-01-31T17:44:05Z", "bug_id": 58950, "creation_time": "2016-01-31T17:44:05Z", "attachment_id": 33507}, {"count": 6, "tags": [], "bug_id": 58950, "attachment_id": 33575, "id": 188637, "time": "2016-02-20T17:41:13Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-20T17:41:13Z", "is_private": false, "text": "Created attachment 33575\nTest Plan that reproduces the issues with a Tomcat 8\n\nHi,\nI have a strange issue which also occurs with 2.13 by the way.\n\nTomcat configuration:\n\napache-tomcat-8.0.30/webapps/ROOT/WEB-INF/web.xml contains:\n  <session-config>\n\t  <session-timeout>1</session-timeout>\n</session-config>\n\nsetenv.sh in tomcat/bin contains:\nexport CATALINA_OPTS=\"-Xmx1024m -Xms1024m\"\n\n\nserver.xml:\n    <Connector port=\"8080\" protocol=\"HTTP/1.1\"\n               connectionTimeout=\"20000\"\n               enableLookups=\"false\"\n               keepAliveTimeout=\"2000\"\n               minSpareThreads=\"25\"\n               compression=\"off\"\n               redirectPort=\"8443\" />\n\n\n\nWhen I run the test, I get a boost in CPU, then a pause (a thread dump shows threads stuck:\njava.lang.Thread.State: RUNNABLE\n\tat java.net.PlainSocketImpl.socketConnect(Native Method)\n\tat java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:345)\n\t- locked <0x00000007a2804870> (a java.net.SocksSocketImpl)\n\n\nThen after some time a new peak in CPU and then the pause....\n\n\nJMeter config at defaults and Java options:\n-server -Xms1024m -Xmx1024m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Xss256k -Dcom.sun.management.jmxremote.port=3333 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false  -XX:+UseThreadPriorities -XX:ThreadPriorityPolicy=42  -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintGCDetails -XX:+PrintGCApplicationConcurrentTime -XX:+PrintGCApplicationStoppedTime -XX:+PrintTenuringDistribution -XX:+PrintGCDetails -XX:+PrintHeapAtGC -XX:+PrintGCCause  -Xloggc:/data/jmeter/verbose-3.0.log -Djava.net.preferIPv4Stack=true -Djava.net.preferIPv6Addresses=false\n\n\nIt could be my machine TCP configuration but could somebody check on Linux machine ?\nThanks"}, {"count": 7, "tags": [], "bug_id": 58950, "is_private": false, "id": 188638, "attachment_id": 33576, "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-20T17:43:01Z", "time": "2016-02-20T17:43:01Z", "text": "Created attachment 33576\nThread Dump during low CPU"}, {"count": 8, "tags": [], "bug_id": 58950, "attachment_id": null, "is_private": false, "id": 188639, "time": "2016-02-20T18:14:17Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-20T18:14:17Z", "text": "There might be an explanation to this issue related to starvation of ephemeral ports as http request downloads embedded resources.\nHaving the tomcat and jmeter colocated is not great.\nParallel downloads is more aggressive than a real client in terms of ephemeral ports usage as a new thread pool is created for each request that does not reuse httpclient (as spotted in another issue)\n\n- My test has no timer as it aims at comparing throughput between versions."}, {"count": 9, "tags": [], "bug_id": 58950, "is_private": false, "id": 188641, "attachment_id": null, "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-21T08:16:20Z", "time": "2016-02-21T08:16:20Z", "text": "(In reply to Philippe Mouawad from comment #6)\n> Created attachment 33575 [details]\n> Test Plan that reproduces the issues with a Tomcat 8\n> \n> Hi,\n> I have a strange issue which also occurs with 2.13 by the way.\n> \n> Tomcat configuration:\n> \n> apache-tomcat-8.0.30/webapps/ROOT/WEB-INF/web.xml contains:\n>   <session-config>\n> \t  <session-timeout>1</session-timeout>\n> </session-config>\n> \n> setenv.sh in tomcat/bin contains:\n> export CATALINA_OPTS=\"-Xmx1024m -Xms1024m\"\n> \n> \n> server.xml:\n>     <Connector port=\"8080\" protocol=\"HTTP/1.1\"\n>                connectionTimeout=\"20000\"\n>                enableLookups=\"false\"\n>                keepAliveTimeout=\"2000\"\n>                minSpareThreads=\"25\"\n>                compression=\"off\"\n>                redirectPort=\"8443\" />\n> \n> \n> \n> When I run the test, I get a boost in CPU, then a pause (a thread dump shows\n> threads stuck:\n> java.lang.Thread.State: RUNNABLE\n> \tat java.net.PlainSocketImpl.socketConnect(Native Method)\n> \tat\n> java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:345)\n> \t- locked <0x00000007a2804870> (a java.net.SocksSocketImpl)\n> \n> \n> Then after some time a new peak in CPU and then the pause....\n> \n> \n> JMeter config at defaults and Java options:\n> -server -Xms1024m -Xmx1024m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Xss256k\n> -Dcom.sun.management.jmxremote.port=3333\n> -Dcom.sun.management.jmxremote.authenticate=false\n> -Dcom.sun.management.jmxremote.ssl=false  -XX:+UseThreadPriorities\n> -XX:ThreadPriorityPolicy=42  -verbose:gc -XX:+PrintGCDetails\n> -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintGCDetails\n> -XX:+PrintGCApplicationConcurrentTime -XX:+PrintGCApplicationStoppedTime\n> -XX:+PrintTenuringDistribution -XX:+PrintGCDetails -XX:+PrintHeapAtGC\n> -XX:+PrintGCCause  -Xloggc:/data/jmeter/verbose-3.0.log\n> -Djava.net.preferIPv4Stack=true -Djava.net.preferIPv6Addresses=false\n> \n> \n> It could be my machine TCP configuration but could somebody check on Linux\n> machine ?\n> Thanks\n\nHello,\nThe issue was due to ephemeral ports saturation.\nAfter fixing my machine configuration, I was able to run the test in better conditions.\nOn Mac OSX, I setup socket reuse time to 1s (it was 15s before) and the CPU drop falled down to 1s range vs 15s range before.\n\nSo this benchmark, confirms what Bug 59034 mentions regarding management of Connections when Parallel download is used for embedded resources.\nBut there are good news with it, with 15 threads we make 138% more samples with 3.0 than with 2.13 thanks to fixing of Bug 57804."}, {"count": 10, "tags": [], "bug_id": 58950, "attachment_id": null, "is_private": false, "id": 188649, "time": "2016-02-21T21:13:52Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-21T21:13:52Z", "text": "(In reply to Philippe Mouawad from comment #9)\n> (In reply to Philippe Mouawad from comment #6)\n> > Created attachment 33575 [details]\n> > Test Plan that reproduces the issues with a Tomcat 8\n> > \n> > Hi,\n> > I have a strange issue which also occurs with 2.13 by the way.\n> > \n> > Tomcat configuration:\n> > \n> > apache-tomcat-8.0.30/webapps/ROOT/WEB-INF/web.xml contains:\n> >   <session-config>\n> > \t  <session-timeout>1</session-timeout>\n> > </session-config>\n> > \n> > setenv.sh in tomcat/bin contains:\n> > export CATALINA_OPTS=\"-Xmx1024m -Xms1024m\"\n> > \n> > \n> > server.xml:\n> >     <Connector port=\"8080\" protocol=\"HTTP/1.1\"\n> >                connectionTimeout=\"20000\"\n> >                enableLookups=\"false\"\n> >                keepAliveTimeout=\"2000\"\n> >                minSpareThreads=\"25\"\n> >                compression=\"off\"\n> >                redirectPort=\"8443\" />\n> > \n> > \n> > \n> > When I run the test, I get a boost in CPU, then a pause (a thread dump shows\n> > threads stuck:\n> > java.lang.Thread.State: RUNNABLE\n> > \tat java.net.PlainSocketImpl.socketConnect(Native Method)\n> > \tat\n> > java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:345)\n> > \t- locked <0x00000007a2804870> (a java.net.SocksSocketImpl)\n> > \n> > \n> > Then after some time a new peak in CPU and then the pause....\n> > \n> > \n> > JMeter config at defaults and Java options:\n> > -server -Xms1024m -Xmx1024m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -Xss256k\n> > -Dcom.sun.management.jmxremote.port=3333\n> > -Dcom.sun.management.jmxremote.authenticate=false\n> > -Dcom.sun.management.jmxremote.ssl=false  -XX:+UseThreadPriorities\n> > -XX:ThreadPriorityPolicy=42  -verbose:gc -XX:+PrintGCDetails\n> > -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintGCDetails\n> > -XX:+PrintGCApplicationConcurrentTime -XX:+PrintGCApplicationStoppedTime\n> > -XX:+PrintTenuringDistribution -XX:+PrintGCDetails -XX:+PrintHeapAtGC\n> > -XX:+PrintGCCause  -Xloggc:/data/jmeter/verbose-3.0.log\n> > -Djava.net.preferIPv4Stack=true -Djava.net.preferIPv6Addresses=false\n> > \n> > \n> > It could be my machine TCP configuration but could somebody check on Linux\n> > machine ?\n> > Thanks\n> \n> Hello,\n> The issue was due to ephemeral ports saturation.\n> After fixing my machine configuration, I was able to run the test in better\n> conditions.\n> On Mac OSX, I setup socket reuse time to 1s (it was 15s before) and the CPU\n> drop falled down to 1s range vs 15s range before.\n> \n> So this benchmark, confirms what Bug 59034 mentions regarding management of\n> Connections when Parallel download is used for embedded resources.\n> But there are good news with it, with 15 threads we make 138% more samples\n> with 3.0 than with 2.13 thanks to fixing of Bug 57804.\n\nI meant fixing of Bug 58099 (not Bug 57804)"}, {"count": 11, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "id": 188779, "creation_time": "2016-02-24T19:13:49Z", "time": "2016-02-24T19:13:49Z", "bug_id": 58950, "text": "Not a JMeter problem", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 58950, "is_private": false, "count": 12, "id": 188819, "time": "2016-02-25T22:21:20Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-25T22:21:20Z", "text": "This issue mentions 1 issue related to HttpClient 4.5.1 fixed in 4.5.2\nSee comment 5 from Felix"}, {"attachment_id": null, "tags": [], "bug_id": 58950, "is_private": false, "count": 13, "id": 188871, "time": "2016-02-26T22:52:12Z", "creator": "p.mouawad@ubik-ingenierie.com", "creation_time": "2016-02-26T22:52:12Z", "text": "Author: pmouawad\nDate: Fri Feb 26 22:35:18 2016\nNew Revision: 1732569\n\nURL: http://svn.apache.org/viewvc?rev=1732569&view=rev\nLog:\nUpgrade to HttpClient/httpmime 4.5.2 which fixes at the same time:\n- Bug 58881 - HTTP Request : HTTPHC4Impl shows exception when server uses \"deflate\" compression\n- Bug 58583 - HTTP client fails to close connection if server misbehaves by not sending \"connection: close\", violating HTTP RFC 2616 / RFC 7230\n- Bug 56358 - Cookie manager supports cross port cookies and RFC6265\n- Bug 57319 - Upgrade to HttpClient 4.5.2\nBugzilla Id: 57319\n\nModified:\n    jmeter/trunk/build.properties\n    jmeter/trunk/eclipse.classpath\n    jmeter/trunk/lib/   (props changed)\n    jmeter/trunk/lib/aareadme.txt\n    jmeter/trunk/licenses/bin/README.txt\n    jmeter/trunk/res/maven/ApacheJMeter_parent.pom\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/control/TestCookieManager.java\n    jmeter/trunk/test/src/org/apache/jmeter/protocol/http/sampler/TestHTTPSamplersAgainstHttpMirrorServer.java\n    jmeter/trunk/xdocs/changes.xml\n\n\nAuthor: pmouawad\nDate: Fri Feb 26 22:50:37 2016\nNew Revision: 1732574\n\nURL: http://svn.apache.org/viewvc?rev=1732574&view=rev\nLog:\nBug 58950 - NoHttpResponseException when Pause between samplers exceeds keepalive sent by server\nBugzilla Id: 58950\n\nModified:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n    jmeter/trunk/xdocs/changes.xml"}]
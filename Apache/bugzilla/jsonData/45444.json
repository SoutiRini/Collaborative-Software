[{"count": 0, "tags": [], "creator": "frederic.heem@telsey.it", "text": "Hi,\nValgrind has found a problem related to an overlapping memcpy in mod_ssl (Apache/2.2.9 (Unix)), here is the output:\n\n==18546== Thread 5:\n==18546== Source and destination overlap in memcpy(0x425E0E8, 0x425E10E, 141)\n==18546==    at 0x4007A42: memcpy (mc_replace_strmem.c:402)\n==18546==    by 0x446C464: ssl_io_input_read (in /usr/local/apache2/modules/mod_ssl.so)\n==18546==    by 0x446C781: ssl_io_filter_input (in /usr/local/apache2/modules/mod_ssl.so)\n==18546==    by 0x8068DB5: ap_rgetline_core (in /usr/local/apache2/bin/httpd)\n==18546==    by 0x80690CE: ap_get_mime_headers_core (in /usr/local/apache2/bin/httpd)\n==18546==    by 0x80696FC: ap_read_request (in /usr/local/apache2/bin/httpd)\n==18546==    by 0x80799DA: ap_process_http_connection (in /usr/local/apache2/bin/httpd)\n==18546==    by 0x8076CEC: ap_run_process_connection (in /usr/local/apache2/bin/httpd)\n==18546==    by 0x807FFD3: worker_thread (in /usr/local/apache2/bin/httpd)\n==18546==    by 0x4057603: dummy_worker (in /usr/local/apache2/lib/libapr-1.so.0.3.0)\n==18546==    by 0x8E145A: start_thread (in /lib/libpthread-2.5.so)\n==18546==    by 0x71323D: clone (in /lib/libc-2.5.so) \n\n\nThis happens when a client sends a https request, regardless on the type of request.\nLet me know if you need more information.", "id": 118862, "time": "2008-07-21T02:51:01Z", "bug_id": 45444, "creation_time": "2008-07-21T02:51:01Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 45444, "is_private": false, "text": "Is it possible that you can get it to dump core, and get a backtrace with line numbers from the core dump?", "id": 118934, "time": "2008-07-23T07:03:51Z", "creator": "jorton@redhat.com", "creation_time": "2008-07-23T07:03:51Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 45444, "is_private": false, "text": "Here you are:\n==23377== Thread 5:\n==23377== Source and destination overlap in memcpy(0x427DE58, 0x427DE7E, 142)\n==23377==    at 0x4007A42: memcpy (mc_replace_strmem.c:402)\n==23377==    by 0x44795FE: ssl_io_input_read (ssl_engine_io.c:353)\n==23377==    by 0x44798DC: ssl_io_filter_input (ssl_engine_io.c:727)\n==23377==    by 0x806ACA2: ap_rgetline_core (protocol.c:231)\n==23377==    by 0x806B08B: ap_get_mime_headers_core (protocol.c:690)\n==23377==    by 0x806B8C2: ap_read_request (protocol.c:918)\n==23377==    by 0x8081864: ap_process_http_connection (http_core.c:183)\n==23377==    by 0x807DA48: ap_run_process_connection (connection.c:43)\n==23377==    by 0x80898C2: worker_thread (worker.c:544)\n==23377==    by 0x4060D05: dummy_worker (thread.c:142)\n==23377==    by 0x8E145A: start_thread (in /lib/libpthread-2.5.so)\n==23377==    by 0x71323D: clone (in /lib/libc-2.5.so)\n\n", "id": 118937, "time": "2008-07-23T08:13:46Z", "creator": "frederic.heem@telsey.it", "creation_time": "2008-07-23T08:13:46Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 45444, "text": "It seems like the code is indeed bogus, for the input getline case:\n\n-> getline the first time\n -> inctx->cbuf is empty\n -> read block from SSL layer into inctx->buffer\n -> pass back first line, stash remainder of inctx->buffer at inctx->cbuf\n\n-> getline the second time\n -> inctx->cbuf non-empty! copy entire inctx->cbuf into inctx->buffer\n\nwhich results in the overlapping memcpy, and is pretty inefficient to boot; for N GETLINE calls to read the entire HTTP request, the buffer gets copied over itself N times.\n\nChanging it to a memmove seems safe enough.", "id": 119491, "time": "2008-08-06T05:57:40Z", "creator": "jorton@redhat.com", "creation_time": "2008-08-06T05:57:40Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 45444, "text": "Fixed on trunk - thanks for the report and getting the backtrace.\n\nhttp://svn.apache.org/viewvc?rev=683280&view=rev\n\nCode made more efficient in following commit:\n\nhttp://svn.apache.org/viewvc?rev=683283&view=rev", "id": 119503, "time": "2008-08-06T07:58:25Z", "creator": "jorton@redhat.com", "creation_time": "2008-08-06T07:58:25Z", "is_private": false, "attachment_id": null}]
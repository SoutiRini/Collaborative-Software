[{"count": 0, "tags": [], "bug_id": 17149, "attachment_id": null, "text": "I'm not sure if this is actually a bug, but since there's no indication as to\nany special cases involving SSL in\nhttp://httpd.apache.org/docs-2.0/mod/mod_rewrite.html then I'm assuming the\nbehavior is unintended.\n\nNote: I've only tested this using a server running on a non-standard port, so\nthat may be a contributing factor.\n\nHere's how to reproduce:\n\n1. create a cgi-directory with the following properties\n\n    Options +ExecCGI\n    AddHandler cgi-script .cgi\n    DirectoryIndex index.html ... index.cgi\n\n2. create a file called index.cgi in that directory:\n\n- - - - - - - - %< CUT HERE >% - - - - - - - -\n#!/bin/sh                                                                       \necho 'Content-type: text/html'\necho\necho '<pre>'\necho \"\\$SCRIPT_URI = $SCRIPT_URI\"\necho '</pre>'\n\nexit 0\n- - - - - - - - %< CUT HERE >% - - - - - - - -\n\n3. Navigate to that file on your server. For example:\n\n    lynx -source http://somehost.somedomain/cgi-bin/index.cgi\n\nYou should see the following output:\n\n<pre>\n$SCRIPT_URI = http://somehost.somedomain/cgi-bin/index.cgi\n</pre>\n\n4. Now navigate to the file using the SSL connection. For example:\n\n    lynx -source https://somehost.somedomain/cgi-bin/index.cgi\n\nYou should now see the following output:\n\n<pre>\n$SCRIPT_URI = \n</pre>\n\nAnother way to see this is when running PHP in Apache. The\n$_SERVER['SCRIPT_URI'] entry will be missing for any script arrived at through\nthe SSL port(s).\n\nI have not tried this in Apache 1.x.", "id": 31495, "time": "2003-02-18T03:21:45Z", "creator": "mtb19@columbia.edu", "creation_time": "2003-02-18T03:21:45Z", "is_private": false}, {"count": 1, "tags": [], "creator": "mtb19@columbia.edu", "attachment_id": null, "id": 41992, "time": "2003-08-02T04:45:32Z", "bug_id": 17149, "creation_time": "2003-08-02T04:45:32Z", "is_private": false, "text": "This may also be related to bug #17148."}, {"count": 2, "tags": [], "bug_id": 17149, "attachment_id": null, "text": "Yes, SCRIPT_URI is missing in Apache 2.0.50 too. I use Apache with mod_ssl,\nmod_rewrite and suEXEC. The SCRIPT_URI is enabled in suexec.c. \n\nThis is a critical issue. Since HTTPS is not available when accessing via\nhttp://, there no other way to determine whether the access method is http://\nwithout checking the SCRIPT_URI.\n\nAppreciate very much an immediate fix.", "id": 60749, "time": "2004-07-17T15:45:09Z", "creator": "sagaralists@yahoo.com", "creation_time": "2004-07-17T15:45:09Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 17149, "text": "From ssl_engine_vars.c (2.0.50):\n\n     ...         ...\n     102         else if (strcEQ(var, \"REQUEST_METHOD\"))\n     103             result = (char *)(r->method);\n     104         else if (strcEQ(var, \"REQUEST_SCHEME\"))\n     105             result = (char *)ap_http_method(r);\n     106         else if (strcEQ(var, \"REQUEST_URI\"))\n     107             result = r->uri;\n     108         else if (strcEQ(var, \"SCRIPT_FILENAME\") ||\n     109                  strcEQ(var, \"REQUEST_FILENAME\"))\n     110             result = r->filename;\n     ...         ...\n\nI'm not sure if this is the right place, but SCRIPT_URI and SCRIPT_URL are\nconspicuously absent from this list.\n\nDoes that mean that mod_ssl must be aware of the two non standard ENV variables\nset by mod_rewrite? I noticed that SCRIPT_FILENAME is in the list, but\nSCRIPT_NAME is not.\n\nAm I totally off base here? Can anyone verify that if, in addition to SCRIPT_URI\nnot showing up on SSL connections, are SCRIPT_URL and SCRIPT_NAME absent as well?", "id": 60754, "time": "2004-07-17T16:55:24Z", "creator": "mtb19@columbia.edu", "creation_time": "2004-07-17T16:55:24Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "sagaralists@yahoo.com", "attachment_id": null, "id": 60762, "time": "2004-07-18T01:49:04Z", "bug_id": 17149, "creation_time": "2004-07-18T01:49:04Z", "is_private": false, "text": "The SCRIPT_URI is missing in both SSL and non-SSL connections.\n\nTo list all CGI environment variables, put the following Perl code to a CGI\nscript (listenv.cgi) and access in both SSL and non-SSL:\n#!/usr/bin/perl\n\nprint \"Content-type: text/html\\r\\n\\r\\n\";\n\n@env_keys = keys %ENV;\n\nforeach $env_key (@env_keys)\n{\n $val = $ENV{\"$env_key\"}; \n \n print \"$env_key\".\": \".\"$val\".\"<br>\";\n}"}, {"count": 5, "tags": [], "creator": "sagaralists@yahoo.com", "attachment_id": null, "id": 60763, "time": "2004-07-18T04:05:55Z", "bug_id": 17149, "creation_time": "2004-07-18T04:05:55Z", "is_private": false, "text": "I'm not sure whether this issue is anything to do with mod_ssl. But the\nSCRIPT_URL and SCRIPT_URI are set in mod_rewrite.c (in\nhttpd-2.0.50/modules/mappers) in hook_uri2file() function. Looks like they are\nset properly. May be they are not exported properly in apr_table_setn()\nfunction. I still did not find where apr_table_setn() function is defined.\nAppreciate if somebody can help me to find in which file its defined."}, {"count": 6, "tags": [], "bug_id": 17149, "text": "I tested the problem (2.0.50) and found out that both variables appear (SSL /\nnon SSL) in the environment as soon as you add \"RewriteEngine on\" to the virtual\nhost in which your cgi-script lives.", "id": 61503, "time": "2004-08-03T21:32:19Z", "creator": "ruediger.pluem@vodafone.com", "creation_time": "2004-08-03T21:32:19Z", "is_private": false, "attachment_id": null}, {"count": 7, "attachment_id": null, "creator": "sagaralists@yahoo.com", "text": "Please note, the SCRIPT_URI is not available in Apache 2.0.50 under ** suEXEC **\nas I wrote on 2004-07-17.", "id": 62280, "time": "2004-08-21T11:06:19Z", "bug_id": 17149, "creation_time": "2004-08-21T11:06:19Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 17149, "is_private": false, "id": 62306, "attachment_id": null, "creator": "ruediger.pluem@vodafone.com", "creation_time": "2004-08-22T15:14:47Z", "time": "2004-08-22T15:14:47Z", "text": "Although I did not consider suexec for my first response it does not change\nanything. I did the same tests again with a cgi script executed by suexec and\nthe result remains the same:\nAs soon as you add \"RewriteEngine on\" to the virtual\nhost in which your cgi-script lives SCRIPT_URL and SCRIPT_URI appear in the\nenvironment of the script. If you do not turn on the Rewrite Engine these\nvariables are not present in the environment."}, {"count": 9, "tags": [], "text": "Thanks R\u00fcdiger Pl\u00fcm, you are right. \n\nAs soon as you add \"RewriteEngine on\" to the virtual host in which your\ncgi-script lives SCRIPT_URL and SCRIPT_URI appear in the environment of the script.\n\nThis behaviour is acceptable since the SCRIPT_URI is required to do rewriting.\n\nTherefore, this issue now could be considered Resolved.", "attachment_id": null, "bug_id": 17149, "id": 62318, "time": "2004-08-23T01:29:02Z", "creator": "sagaralists@yahoo.com", "creation_time": "2004-08-23T01:29:02Z", "is_private": false}, {"count": 10, "tags": [], "bug_id": 17149, "attachment_id": null, "id": 62323, "time": "2004-08-23T05:14:27Z", "creator": "nd@perlig.de", "creation_time": "2004-08-23T05:14:27Z", "is_private": false, "text": "The issue was never a bug, but a configuration problem."}, {"count": 11, "text": "Please try a user forum next time first.", "bug_id": 17149, "attachment_id": null, "id": 62324, "time": "2004-08-23T05:15:04Z", "creator": "nd@perlig.de", "creation_time": "2004-08-23T05:15:04Z", "tags": [], "is_private": false}]
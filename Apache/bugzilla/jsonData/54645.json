[{"attachment_id": null, "tags": [], "bug_id": 54645, "is_private": false, "count": 0, "id": 165676, "time": "2013-03-06T14:11:44Z", "creator": "imsandli@gmail.com", "creation_time": "2013-03-06T14:11:44Z", "text": "Hi, \n\nIn my application I found from time to time some hanging Threads. The Threaddumps are always pointing to the POI IntMapper class\n\n    at java.util.HashMap.get(java.lang.Object)\n    at org.apache.poi.util.IntMapper.getIndex(java.lang.Object)\n    at org.apache.poi.hssf.record.SSTRecord.addString(org.apache.poi.hssf.record.UnicodeString)\n    at org.apache.poi.hssf.model.Workbook.addSSTString(org.apache.poi.hssf.record.UnicodeString)\n    at org.apache.poi.hssf.usermodel.HSSFCell.setCellValue(org.apache.poi.ss.usermodel.RichTextString)\n\nWe are using POI 3.6 but since then, only some code clean up (0111e33d) happened. This problem probably exists in newer Versions too.\n\n\nI even found some references in the internet with the same problem:\n- http://mail-archives.apache.org/mod_mbox/poi-user/201212.mbox/%3Cloom.20121220T112250-206@post.gmane.org%3E\n- http://cueabsorb.wordpress.com/2010/12/15/%E4%BD%BF%E7%94%A8hashmap%E5%AF%BC%E8%87%B4cpu-200%E6%88%96%E8%80%85%E5%AF%BC%E8%87%B4%E7%9A%84load-%E9%A3%99%E9%AB%98%E9%97%AE%E9%A2%98/"}, {"count": 1, "tags": [], "text": "What are you doing to trigger it?\n\nIs there any chance you could be allowing two different threads to work on the same open workbook? \n\n(POI is designed to allow multiple different threads to each access their own different workbooks, but it isn't designed to let multiple threads work on the very same workbook object)\n\nAs it stands, I can't see anything that might explain why the code would lock up in regular operation (other than a JVM bug)", "is_private": false, "bug_id": 54645, "id": 165679, "time": "2013-03-06T15:28:58Z", "creator": "apache@gagravarr.org", "creation_time": "2013-03-06T15:28:58Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 54645, "text": "(In reply to comment #1)\n> What are you doing to trigger it?\nI profiled the JVM to get the stacktrace. It's a race condition, as the application is already running several days.\n\n> Is there any chance you could be allowing two different threads to work on\n> the same open workbook? \n\nYes. It seems like a new bug in our application circumvents the synchronization of the workbook.\n\nI'm closing the bug.\nThx.", "id": 165683, "time": "2013-03-06T15:54:55Z", "creator": "imsandli@gmail.com", "creation_time": "2013-03-06T15:54:55Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 54645, "text": "Just to confirm for anyone looking later and wondering about threading with POI:\n\nTwo threads, each working on different workbooks (or other file formats) should always be fine\n\nTwo threads, trying to work on the same workbook object (or same slideshow, word doc, poifsfilesystem etc) is not supported\n\nEach workbook / filesystem / etc must only be worked on by one thread. Multiple threads must each work with their own objects", "id": 165685, "time": "2013-03-06T16:02:24Z", "creator": "apache@gagravarr.org", "creation_time": "2013-03-06T16:02:24Z", "is_private": false, "attachment_id": null}]
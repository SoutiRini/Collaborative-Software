[{"count": 0, "tags": [], "bug_id": 57016, "attachment_id": null, "id": 178093, "time": "2014-09-25T00:06:07Z", "creator": "matthauck@gmail.com", "creation_time": "2014-09-25T00:06:07Z", "is_private": false, "text": "PersistentValve is broken as it stands and always delete sessions right after it creates them.  \n\ncf. the following lines in https://github.com/apache/tomcat/blob/TOMCAT_7_0_42/java/org/apache/catalina/valves/PersistentValve.java#L178-L179\n\n  store.save(session);\n  ((PersistentManager) manager).removeSuper(session);\n\n\nI have setup my PersistentManager with a JDBCStore, and if I set a breakpoint between these two lines, I can see the `save` call inserts a row into the database properly, and then take one step past the `removeSuper` call, and it deletes the row from the database.\n\nThe removeSuper (used by PersistentValve) method has the following comment on it:\n\"Remove this Session from the active Sessions for this Manager, but not from the Store.\"\n\nThe implementation of remove in PersistentManagerBase has the following comment:\n\"Remove this Session from the active Sessions for this Manager, and from the Store.\"\n\nThere is clearly a break in the API here. The PersistentValve is expecting the PersistentManager.removeSuper to do one thing (which method has a comment saying it exists only for the sake of PersistentValve, btw.), but PersistentManagerBase which implements this does a different thing than expected."}, {"count": 1, "tags": [], "bug_id": 57016, "attachment_id": null, "id": 178121, "time": "2014-09-25T19:53:20Z", "creator": "markt@apache.org", "creation_time": "2014-09-25T19:53:20Z", "is_private": false, "text": "Thanks for the report. This is fixed in 8.0.x for 8.0.15 onwards and in 7.0.x for 7.0.56 onwards."}, {"count": 2, "tags": [], "bug_id": 57016, "attachment_id": null, "id": 178125, "time": "2014-09-25T22:06:07Z", "creator": "matthauck@gmail.com", "creation_time": "2014-09-25T22:06:07Z", "is_private": false, "text": "Wow, that was fast. thanks!"}]
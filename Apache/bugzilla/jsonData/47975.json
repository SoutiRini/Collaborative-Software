[{"count": 0, "text": "Line 359 of org.apache.batik.ext.awt.MultipleGradientContextPaint compares the float value of Imin to 0.0. However, due to float-point limitations, under some conditions this value can be negative - leading to this exception stack trace:\n\njava.lang.NegativeArraySizeException\n\tat org.apache.batik.ext.awt.MultipleGradientPaintContext.calculateSingleArrayGradient(MultipleGradientPaintContext.java:460)\n\tat org.apache.batik.ext.awt.MultipleGradientPaintContext.calculateGradientFractions(MultipleGradientPaintContext.java:378)\n\tat org.apache.batik.ext.awt.MultipleGradientPaintContext.<init>(MultipleGradientPaintContext.java:297)\n\tat org.apache.batik.ext.awt.RadialGradientPaintContext.<init>(RadialGradientPaintContext.java:137)\n\tat org.apache.batik.ext.awt.RadialGradientPaint.createContext(RadialGradientPaint.java:464)\n\tat sun.java2d.pipe.AlphaPaintPipe.startSequence(AlphaPaintPipe.java:65)\n\tat sun.java2d.pipe.DuctusShapeRenderer.renderPath(DuctusShapeRenderer.java:74)\n\tat sun.java2d.pipe.DuctusShapeRenderer.fill(DuctusShapeRenderer.java:49)\n\tat sun.java2d.pipe.ValidatePipe.fill(ValidatePipe.java:142)\n\tat sun.java2d.SunGraphics2D.fill(SunGraphics2D.java:2261)\n\nThe negative value is around 1e-07, and can be addressed by changing the condition from (Imin == 0) to (Imin <= 0)\n\nThanks\nKirill", "bug_id": 47975, "is_private": false, "id": 131043, "time": "2009-10-09T16:50:19Z", "creator": "kirillcool@yahoo.com", "creation_time": "2009-10-09T16:50:19Z", "tags": [], "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 47975, "attachment_id": null, "id": 131044, "time": "2009-10-09T16:51:17Z", "creator": "kirillcool@yahoo.com", "creation_time": "2009-10-09T16:51:17Z", "is_private": false, "text": "Changing the version to 1.7 - haven't tested against the head."}, {"count": 2, "tags": [], "creator": "helder.magalhaes@gmail.com", "attachment_id": null, "is_private": false, "id": 131048, "time": "2009-10-10T08:43:12Z", "bug_id": 47975, "creation_time": "2009-10-10T08:43:12Z", "text": "(In reply to comment #0)\n> [...] due to float-point limitations, under some\n> conditions this value can be negative\n\nCould you be a little bit more specific (i.e., attach a test case or sample application)? Even if it's just my low knowledge on the matter showing up, I guess it would be valuable to have such test case available in order to potentially add it to the Batik regression test infrastructure [1]. ;-)\n\n\n(In reply to comment #1)\n> Changing the version to 1.7 - haven't tested against the head.\n\nIf there's actually an issue with this code, then I've just checked that the trunk (version 1.8) currently also seems to have it [2].\n\n\n[1] http://xmlgraphics.apache.org/batik/dev/test.html#regard\n[2] http://svn.apache.org/viewvc/xmlgraphics/batik/trunk/sources/org/apache/batik/ext/awt/MultipleGradientPaintContext.java?annotate=501922#l359"}, {"count": 3, "tags": [], "bug_id": 47975, "text": "Created attachment 24374\nTest case that shows the exception\n\nRun the attached test case under JDK 5.0_21 on Windows XP (has not tested on other environments) and see the stack trace mentioned in the original post.\n\nThanks\nKirill", "id": 131087, "time": "2009-10-12T09:14:48Z", "creator": "kirillcool@yahoo.com", "creation_time": "2009-10-12T09:14:48Z", "is_private": false, "attachment_id": 24374}, {"count": 4, "tags": [], "bug_id": 47975, "attachment_id": null, "id": 131101, "time": "2009-10-13T03:09:31Z", "creator": "deweese@apache.org", "creation_time": "2009-10-13T03:09:31Z", "is_private": false, "text": "(In reply to comment #3)\n> Created an attachment (id=24374) [details]\n> Test case that shows the exception\n\nFrom the Test case:\n\nRadialGradientPaint groupFillPaint = new RadialGradientPaint(329, 203,\n\t\t114.1f, new float[] { 0.0f, 0.20634921f, 1.0000001f },\n\t\tnew Color[] { new Color(0, 255, 0), new Color(0, 255, 0),\n\t\t\t      new Color(0, 255, 255) });\n\nFrom the documentation of RadialGradientPaint:\n\n     * @param fractions numbers ranging from 0.0 to 1.0 specifying the\n     * distribution of colors along the gradient\n\n   You will note that your last fractions value is 1.0000001 which is not\nin the range 0.0->1.0.  Our code should probably throw an IllegalArgument\nexception in this case, but the end result will be similar for you.\n\n> Run the attached test case under JDK 5.0_21 on Windows XP (has not tested on\n> other environments) and see the stack trace mentioned in the original post.\n\n   I think it's fair to classify this as a bug in your code, although it\nwould be good if Batik handled the case more cleanly."}, {"count": 5, "tags": [], "bug_id": 47975, "text": "You're right. After changing my code to make sure that the fractions stay in 0.0-1.0 range (that value was due to floating point arithmetic errors) i no longer see the exception - in the latest, as well as earlier releases of Batik.\n\nI would prefer having an IllegalArgumentException thrown in the constructor of RadialGradientPaint to make the lives of users easier.\n\nThanks\nKirill", "id": 131392, "time": "2009-10-26T13:12:09Z", "creator": "kirillcool@yahoo.com", "creation_time": "2009-10-26T13:12:09Z", "is_private": false, "attachment_id": null}]
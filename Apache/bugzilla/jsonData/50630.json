[{"count": 0, "tags": [], "creator": "iblanco@flumotion.com", "attachment_id": null, "is_private": false, "id": 143550, "time": "2011-01-21T08:36:03Z", "bug_id": 50630, "creation_time": "2011-01-21T08:36:03Z", "text": "We have Linux RHEL6 with httpd 2.2.15, and after loged with LDAP username and\npassword, apache return 500 error. Return this error only if you use ldaps (port 636), for ldap (port 389) works fine.\n\nNo information available about this error in the server error log.\n\nWith the follow configuration:\n\n# vim: syntax=apache\n\n<VirtualHost _default_:443>\n    SSLEngine On\n    SSLProtocol all -SSLv2\n    SSLCipherSuite HIGH:MEDIUM\n    SSLCertificateFile /etc/pki/tls/certs/xxx.crt\n    SSLCertificateKeyFile /etc/pki/tls/private/xxxxxxxxx.key\n    ServerName xxxxxxxxxx\n    ServerAlias xxxxxxxxxxxxx\n    DocumentRoot /var/www/xxxxxxxx\n    # Specific configuration\n    <Location /private/status>\n        SetHandler server-status\n    </Location>\n    <Location />\n        AuthType Basic\n        AuthName \"Admin xxxxxx\"\n        AuthBasicProvider ldap\n        AuthzLDAPAuthoritative on\n        AuthLDAPURL ldaps://ldap.xxxxxxxx.com/ou=People,dc=xxxxx,dc=com?uid?one\n        Require ldap-user xxxx xxxx\n    </Location>\n    ErrorLog logs/xxxxxxxx-ssl-error_log\n    CustomLog logs/xxxxxxxxx-ssl-access_log combined\n</VirtualHost>\n\nModules loaded:\n\nauth_basic_module\nldap_module\nauthnz_ldap_module\n\n\nThe same configuration works with RHEL5.x and httpd 2.2.3"}, {"attachment_id": null, "tags": [], "bug_id": 50630, "is_private": false, "count": 1, "id": 143553, "time": "2011-01-21T09:16:26Z", "creator": "covener@gmail.com", "creation_time": "2011-01-21T09:16:26Z", "text": "Set LogLevel debug and attach the messages that accompany the LDAP authentication/authorization.  If you don't see any, you're not looking in the right log."}, {"count": 2, "tags": [], "creator": "iblanco@flumotion.com", "attachment_id": null, "id": 143555, "time": "2011-01-21T10:01:23Z", "bug_id": 50630, "creation_time": "2011-01-21T10:01:23Z", "is_private": false, "text": "We stopped httpd, we deleted all the logs and then we started httpd and tried to access the site, just once. Apache does not write anything in any error log file when the 500 Internal Server Error happens. \n\n# ls -al /var/log/httpd/\ntotal 16\ndrwx------. 2 apache apache 4096 Jan 21 15:56 .\ndrwxr-xr-x. 8 root   root   4096 Jan 18 13:50 ..\n-rw-r--r--. 1 root   root      0 Jan 21 15:56 access_log\n-rw-r--r--. 1 root   root   3038 Jan 21 15:56 error_log\n-rw-r--r--. 1 root   root    595 Jan 21 15:56 takeover-ssl-access_log\n-rw-r--r--. 1 root   root      0 Jan 21 15:56 takeover-ssl-error_log\n\n# cat /var/log/httpd/*\n[Fri Jan 21 15:56:13 2011] [notice] SELinux policy enabled; httpd running as context unconfined_u:system_r:httpd_t:SystemLow\n[Fri Jan 21 15:56:13 2011] [info] Init: Seeding PRNG with 0 bytes of entropy\n[Fri Jan 21 15:56:13 2011] [info] Init: Generating temporary RSA private keys (512/1024 bits)\n[Fri Jan 21 15:56:13 2011] [info] Init: Generating temporary DH parameters (512/1024 bits)\n[Fri Jan 21 15:56:13 2011] [warn] Init: Session Cache is not configured [hint: SSLSessionCache]\n[Fri Jan 21 15:56:13 2011] [info] Init: Initializing (virtual) servers for SSL\n[Fri Jan 21 15:56:13 2011] [info] mod_ssl/2.2.15 compiled against Server: Apache/2.2.15, Library: OpenSSL/1.0.0-fips\n[Fri Jan 21 15:56:13 2011] [debug] util_ldap.c(2058): LDAP merging Shared Cache conf: shm=0x7fe25bad19f8 rmm=0x7fe25bad1a50 for VHOST: takeover.fluendo.lan\n[Fri Jan 21 15:56:13 2011] [info] APR LDAP: Built with OpenLDAP LDAP SDK\n[Fri Jan 21 15:56:13 2011] [info] LDAP: SSL support available\n[Fri Jan 21 15:56:13 2011] [info] Init: Seeding PRNG with 0 bytes of entropy\n[Fri Jan 21 15:56:13 2011] [info] Init: Generating temporary RSA private keys (512/1024 bits)\n[Fri Jan 21 15:56:13 2011] [info] Init: Generating temporary DH parameters (512/1024 bits)\n[Fri Jan 21 15:56:13 2011] [info] Init: Initializing (virtual) servers for SSL\n[Fri Jan 21 15:56:13 2011] [info] mod_ssl/2.2.15 compiled against Server: Apache/2.2.15, Library: OpenSSL/1.0.0-fips\n[Fri Jan 21 15:56:13 2011] [debug] proxy_util.c(1818): proxy: grabbed scoreboard slot 0 in child 25893 for worker proxy:reverse\n[Fri Jan 21 15:56:13 2011] [debug] proxy_util.c(1934): proxy: initialized single connection worker 0 in child 25893 for (*)\n[Fri Jan 21 15:56:14 2011] [debug] proxy_util.c(1818): proxy: grabbed scoreboard slot 0 in child 25894 for worker proxy:reverse\n[Fri Jan 21 15:56:14 2011] [debug] proxy_util.c(1837): proxy: worker proxy:reverse already initialized\n[Fri Jan 21 15:56:14 2011] [debug] proxy_util.c(1934): proxy: initialized single connection worker 0 in child 25894 for (*)\n[Fri Jan 21 15:56:14 2011] [debug] proxy_util.c(1818): proxy: grabbed scoreboard slot 0 in child 25895 for worker proxy:reverse\n[Fri Jan 21 15:56:14 2011] [debug] proxy_util.c(1837): proxy: worker proxy:reverse already initialized\n[Fri Jan 21 15:56:14 2011] [debug] proxy_util.c(1934): proxy: initialized single connection worker 0 in child 25895 for (*)\n[Fri Jan 21 15:56:14 2011] [notice] Apache/2.2.15 (Unix) mod_ssl/2.2.15 OpenSSL/1.0.0-fips configured -- resuming normal operations\n[Fri Jan 21 15:56:14 2011] [info] Server built: Aug 14 2010 08:53:20\n[Fri Jan 21 15:56:14 2011] [debug] prefork.c(1013): AcceptMutex: sysvsem (default: sysvsem)\n[Fri Jan 21 15:56:14 2011] [debug] proxy_util.c(1818): proxy: grabbed scoreboard slot 0 in child 25896 for worker proxy:reverse\n[Fri Jan 21 15:56:14 2011] [debug] proxy_util.c(1837): proxy: worker proxy:reverse already initialized\n[Fri Jan 21 15:56:14 2011] [debug] proxy_util.c(1934): proxy: initialized single connection worker 0 in child 25896 for (*)\n172.17.5.59 - - [21/Jan/2011:15:56:32 +0100] \"GET / HTTP/1.1\" 401 401 \"-\" \"Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.224 Safari/534.10\"\n172.17.5.59 - sgafsgaf [21/Jan/2011:15:56:42 +0100] \"GET / HTTP/1.1\" 500 536 \"-\" \"Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.224 Safari/534.10\"\n172.17.5.59 - sgafsgaf [21/Jan/2011:15:56:42 +0100] \"GET /favicon.ico HTTP/1.1\" 500 536 \"-\" \"Mozilla/5.0 (X11; U; Linux x86_64; en-US) AppleWebKit/534.10 (KHTML, like Gecko) Chrome/8.0.552.224 Safari/534.10\""}, {"count": 3, "tags": [], "bug_id": 50630, "is_private": false, "text": "I don't see any way for mod_authnz_ldap to return an error before logging anything.  It should be quite noisy at LogLevel debug.", "id": 143557, "time": "2011-01-21T10:26:58Z", "creator": "covener@gmail.com", "creation_time": "2011-01-21T10:26:58Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 50630, "is_private": false, "id": 143558, "creation_time": "2011-01-21T10:42:37Z", "time": "2011-01-21T10:42:37Z", "creator": "iblanco@flumotion.com", "text": "What do you recommend? \n\nI don't know if httpd version 2.2.15 with RHEL6 can be important. Because the same configuration works with httpd (2.2.3) and RHEL5.2.", "attachment_id": null}, {"count": 5, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 143559, "time": "2011-01-21T10:54:13Z", "bug_id": 50630, "creation_time": "2011-01-21T10:54:13Z", "text": "You might ask RedHat, the Apache user support mailing list, or another forum such as serverfault.com."}, {"count": 6, "tags": [], "bug_id": 50630, "attachment_id": null, "text": "The exact same thing is happening to us. We're also using RHEL 6 and Apache 2.2.15 and the error only occurs after a successful login. Nothing is sent to the log files even with LogLevel debug.", "id": 148151, "time": "2011-07-25T23:17:41Z", "creator": "Scott.A.Hendrickson@aero.org", "creation_time": "2011-07-25T23:17:41Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 50630, "is_private": false, "id": 149771, "creation_time": "2011-09-26T18:10:56Z", "time": "2011-09-26T18:10:56Z", "creator": "fillot.nicolas@gmail.com", "text": "Happening when the ldap server is using self-signed certificates.\n\nTry :\n    LDAPVerifyServerCert Off\n\nor more secure :\n   LDAPTrustedGlobalCert with your ca certificate\n\nNf", "attachment_id": null}, {"count": 8, "tags": [], "creator": "advax@triumf.ca", "attachment_id": null, "id": 149923, "time": "2011-09-28T19:08:20Z", "bug_id": 50630, "creation_time": "2011-09-28T19:08:20Z", "is_private": false, "text": "I have seen this on httpd.2.15-9 on SL 6.1 (RHEL 6.1 recompile)\nwith openssl-1.0.0 and openldap-2.4.23\n\nOpenldap now checks the certificate chain against a certificate bundle. On RHEL6 this is located in /etc/pki/tls/certs/ca-bundle.crt\nOpenldap reads a configuration file /etc/openldap/ldap.conf and uses the value of TLS_CACERT to locate this bundle.\nIf it does not locate the bundle, or the LDAP server certificate chains to a root certificate that is not included in the bundle, openldap returns an error.\n\n(ldapsearch on the command line returns \n ldap_start_tls: Connect error (-11)\n    additional info: TLS error -8172:Unknown code ___f 20\nWith the \"-d 1\" option, it says that the server certificate is not valid.)\n\nFrom the point of view of mod_authnz_ldap, I infer that the module is not properly handling an error return from the LDAP library. It should generate an error message in the webserver log to give the server admin a clue to the real problem."}, {"count": 9, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "is_private": false, "id": 149925, "time": "2011-09-28T19:47:16Z", "bug_id": 50630, "creation_time": "2011-09-28T19:47:16Z", "text": "> From the point of view of mod_authnz_ldap, I infer that the module is not\n> properly handling an error return from the LDAP library. It should generate an\n> error message in the webserver log to give the server admin a clue to the real\n> problem.\n\nno logs at all currently as in OP? Or just not alluding to trust issue?"}, {"count": 10, "tags": [], "bug_id": 50630, "attachment_id": null, "id": 149926, "creation_time": "2011-09-28T19:54:28Z", "time": "2011-09-28T19:54:28Z", "creator": "advax@triumf.ca", "text": "I could not see any error message in /var/log/httpd/* apart from a single\n192.168.2.1  - advax [28/Sep/2011:12:51:01 -0700] \"GET /index.shtml HTTP/1.0\" 500 631\n\nwget as client returns \n  HTTP/1.1 500 Internal Server Error\n\nGenerally, errors in CGI scripts etc. generate something in error_log from the script itself, e.g. sigsegv, runtime errors etc.", "is_private": false}, {"count": 11, "tags": [], "text": "Same issue here - httpd-2.2.22, compiled against openldap-2.4.29 under RHEL 5.7.\n\nAdding \"LDAPVerifyServerCert Off\" works.  However, I prefer the more secure option of using \"LDAPTrustedGlobalCert\" - but this does not work, and still, no logging to help point to why.\n\nI did add the same certificate to ldap.conf using TLS_CACERT - and this allows ldapsearch to work using the command line ldapsearch (with -Z for \"Start TLS request\").  However, this doesn't seem to help httpd any.", "is_private": false, "bug_id": 50630, "id": 154150, "time": "2012-02-25T20:09:52Z", "creator": "bugs@mark.ziesemer.com", "creation_time": "2012-02-25T20:09:52Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "jirong.hu@gmail.com", "attachment_id": null, "id": 170251, "time": "2013-09-24T15:17:02Z", "bug_id": 50630, "creation_time": "2013-09-24T15:17:02Z", "is_private": false, "text": "I am running into the exact same issue, \"Internal Server Error\" with no error message at all. Log message same as Comment 2. Even we are using port 389, and set LDAPVerifyServerCert Off also doesn\u2019t resolve my issue.\n\nHere is my software versions:\n\nLinux 2.6.32-358.18.1.el6.x86_64 x86_64\nApache/2.2.15 (Red Hat) Server at cmtoldsvnapp01.dev.bmocm.com Port 443\nsvn, version 1.6.11 (r934486)  compiled Apr  2 2013, 08:56:54"}, {"count": 13, "tags": [], "creator": "d.george@tarent.de", "attachment_id": null, "is_private": false, "id": 175559, "time": "2014-05-30T07:08:04Z", "bug_id": 50630, "creation_time": "2014-05-30T07:08:04Z", "text": "We have a very related issue here. The funny thing is, however, that the problem only starts to occur a few hours after Apache was started. Before that, the LDAPS connections work just fine.\n\nWhen the problem occurs, we see the LDAP server send TCP connection resets after the SSL negotiation.\n\nApache Server version: 2.2.22\nOS version: Debian GNU/Linux 7.5 amd64\n\nCheers,\nDominik George\n\n-- \ntarent solutions GmbH\nRochusstra\u00dfe 2-4, D-53123 Bonn \u2022 http://www.tarent.de/\nTel: +49 228 54881-319 \u2022 Fax: +49 228 54881-235\nHRB 5168 (AG Bonn) \u2022 USt-ID (VAT): DE122264941\nGesch\u00e4ftsf\u00fchrer: Dr. Stefan Barth, Kai Ebenrett, Boris Esser, Alexander Steeg"}]
[{"count": 0, "tags": [], "bug_id": 21775, "attachment_id": null, "is_private": false, "id": 41090, "time": "2003-07-21T17:02:59Z", "creator": "apache_bugzilla@zwiers.ca", "creation_time": "2003-07-21T17:02:59Z", "text": "The Corel Presentation software (at least versions 8 and 9) fake the recognized \nheader signature that POIFS recognizes (0xE11AB1A1E011CFD0L) and the properties \nare then read from this file which causes a problem.  The net result is that \nSummaryInformation.getWordCount() throws a ClassCastException in this \nsituation.  I will attach (if possible on a later screen) a small test class \nand .shw file for demonstration purposes."}, {"count": 1, "tags": [], "creator": "apache_bugzilla@zwiers.ca", "attachment_id": 7425, "text": "Created attachment 7425\nAn offending Corel Presentation File", "id": 41091, "time": "2003-07-21T17:04:14Z", "bug_id": 21775, "creation_time": "2003-07-21T17:04:14Z", "is_private": false}, {"count": 2, "tags": [], "creator": "apache_bugzilla@zwiers.ca", "attachment_id": 7426, "id": 41092, "time": "2003-07-21T17:08:24Z", "bug_id": 21775, "creation_time": "2003-07-21T17:08:24Z", "is_private": false, "text": "Created attachment 7426\nSource Code to demonstrate ClassCastException on SummaryInformation.getWordCount() for .shw files"}, {"count": 3, "tags": [], "bug_id": 21775, "attachment_id": null, "id": 41093, "time": "2003-07-21T17:25:04Z", "creator": "poi-support@buni.org", "creation_time": "2003-07-21T17:25:04Z", "is_private": false, "text": "Just because it doesn't have SummaryInformation or does SummaryInformation wrong, that doesn't \nmean POIFS is wrong to recognize it as an OLE 2 Compound Document format file.   Is this a \nproblem just with HPSF not recognizing the SummaryInformation stream isn't what it thinks it is?"}, {"count": 4, "tags": [], "creator": "apache_bugzilla@zwiers.ca", "attachment_id": null, "id": 41096, "time": "2003-07-21T18:14:34Z", "bug_id": 21775, "creation_time": "2003-07-21T18:14:34Z", "is_private": false, "text": "Here's what I've figured out.  I'll let you decide which it is.   \n\nIf I spin through all the properties that I get back, the following is returned \nfor the word count (ID#15 according to the PropertyIDMap.PID_WORDCOUNT \nconstant); element 13 in the array of properties).\n\nDocumentPropertyReader - props[13].getID() = 15\nDocumentPropertyReader - props[13].getType() = 0\nDocumentPropertyReader - props[13].getValue() = [B@9eca9c26\nDocumentPropertyReader - props[13].getValue().getClass() = class [B\n\nThe type that's created here (in the default of the  switch in the \norg.apache.poi.hpsf.Property constructor based on the return of \norg.apache.poi.hpsf.littleendian.DWord.intValue()) means that value was not \nrecognized as a Variant.VT_I4.  Instead, it's a zero == VT_EMPTY.  This gets put \ninto the properties as a byte array which causes the ClassCastException when \ncalling getWordCount().\n\nI'm not sure (not knowing the nuts and bolts) if the Corel doc is actually \nbehaving properly as an OLE2 doc.  If it isn't, I guess the problem is that \nPOIFS thinks it is.  If it is, the the problem is either that the VT_EMPTY \ndoesn't get treated as a null  OR that the getWordCount() doesn't propertly take \nthis into account.\n"}, {"count": 5, "tags": [], "bug_id": 21775, "is_private": false, "id": 41434, "attachment_id": null, "creator": "poi-support@buni.org", "creation_time": "2003-07-24T17:24:02Z", "time": "2003-07-24T17:24:02Z", "text": "POIFS is right, HPSF is wrong."}, {"count": 6, "tags": [], "bug_id": 21775, "is_private": false, "id": 41491, "creation_time": "2003-07-25T09:30:24Z", "time": "2003-07-25T09:30:24Z", "creator": "klute@apache.org", "text": "HPSF does not yet support VT_EMPTY. A proper implementation would be to return\nnull. See\nhttp://msdn.microsoft.com/library/default.asp?url=/library/en-us/automat/htm/chap6_7zdz.asp\nfor an explanation of the variant types. I'll prepare a patch.", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 21775, "attachment_id": null, "is_private": false, "id": 41575, "time": "2003-07-26T21:52:57Z", "creator": "klute@apache.org", "creation_time": "2003-07-26T21:52:57Z", "text": "HPSF is now able to read properties which are given in the property set stream\nbut which don't have a value. The type of such properties is VT_EMPTY.\nPropertySet's getXXX methods return either a null or a 0 whichever is\nappropriate. Details about return types can be found in the API documentation."}]
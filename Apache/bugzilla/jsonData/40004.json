[{"count": 0, "tags": [], "bug_id": 40004, "attachment_id": null, "id": 91080, "time": "2006-07-10T23:20:27Z", "creator": "pfudd@ubc.pkts.ca", "creation_time": "2006-07-10T23:20:27Z", "is_private": false, "text": "I have two rules:\n    RewriteBase /db/\n    RewriteRule ^experiment-1 experiment-2 [L]\n    RewriteRule ^experiment-2 experiment-3\n\nThe url http://localhost/db/experiment-1 should be rewritten to experiment-2,\nand that should be the last rewriting to be done.  However, the actual file\nretrieved is experiment-3.\n\nThe output of rewritelog (at level 2) is:\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa45668/initial] (2) init rewrite engine with\nrequested uri /db/experiment-1\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa45668/initial] (1) pass through /db/experiment-1\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa45668/initial] (2) [perdir /var/www/html/db/]\nrewrite 'experiment-1' -> 'experiment-2'\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa45668/initial] (2) [perdir /var/www/html/db/]\ntrying to replace prefix /var/www/html/db/ with /db/\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa45668/initial] (1) [perdir /var/www/html/db/]\ninternal redirect with /db/experiment-2 [INTERNAL REDIRECT]\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa4a040/initial/redir#1] (2) init rewrite engine\nwith requested uri /db/experiment-2\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa4a040/initial/redir#1] (1) pass through\n/db/experiment-2\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa4a040/initial/redir#1] (2) [perdir\n/var/www/html/db/] rewrite 'experiment-2' -> 'experiment-3'\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa4a040/initial/redir#1] (2) [perdir\n/var/www/html/db/] trying to replace prefix /var/www/html/db/ with /db/\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa4a040/initial/redir#1] (1) [perdir\n/var/www/html/db/] internal redirect with /db/experiment-3 [INTERNAL REDIRECT]\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa4bcb8/initial/redir#2] (2) init rewrite engine\nwith requested uri /db/experiment-3\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa4bcb8/initial/redir#2] (1) pass through\n/db/experiment-3\n127.0.0.1 - - [10/Jul/2006:16:07:25 --0700]\n[localhost/sid#989a608][rid#aa4bcb8/initial/redir#2] (1) [perdir\n/var/www/html/db/] pass through /var/www/html/db/experiment-3\n\nI don't know what [L] is supposed to do, if this is correct behaviour."}, {"count": 1, "tags": [], "bug_id": 40004, "attachment_id": null, "id": 91082, "time": "2006-07-10T23:41:22Z", "creator": "pfudd@ubc.pkts.ca", "creation_time": "2006-07-10T23:41:22Z", "is_private": false, "text": "These rules are inside a <Directory /var/www/html/db> section, if that helps."}, {"count": 2, "tags": [], "bug_id": 40004, "attachment_id": null, "id": 91092, "time": "2006-07-11T05:44:01Z", "creator": "nd@perlig.de", "creation_time": "2006-07-11T05:44:01Z", "is_private": false, "text": "Yes. That was obvious from the description and the rewrite log. ;-)\n\nThe [L] flag works as expected (finishing the Ruleset). What you probably didn't\nexpect was that the internal redirect finds the whole ruleset again and again.\nThat's a different issue and a side effect of RewriteRules in the directory context.\n\n-> invalid."}, {"count": 3, "attachment_id": null, "creator": "pfudd@ubc.pkts.ca", "text": "Well, as my teacher used to say, it's either a bug in the program or a bug in\nthe documentation.  This behaviour isn't documented; who do I send requests like\nthis to?\n\nThanks!", "id": 91143, "time": "2006-07-11T16:04:11Z", "bug_id": 40004, "creation_time": "2006-07-11T16:04:11Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "bug_id": 40004, "attachment_id": null, "id": 91151, "time": "2006-07-11T17:30:09Z", "creator": "pfudd@ubc.pkts.ca", "creation_time": "2006-07-11T17:30:09Z", "is_private": false, "text": "If someone updates the RewriteEngine documentation, some of the points from\nhttp://www.sitepoint.com/print/mod_rewrite-no-endless-loops would be good to\ninclude."}, {"count": 5, "tags": [], "bug_id": 40004, "attachment_id": null, "id": 91195, "time": "2006-07-12T07:39:58Z", "creator": "nd@perlig.de", "creation_time": "2006-07-12T07:39:58Z", "is_private": false, "text": "It's kinda documented, but too implicit and so quite bad. The place for such\nrequests is here ;)\nYou can also place patches here or enter the docs list\n(http://httpd.apache.org/docs-project/) :-)"}, {"count": 6, "tags": [], "creator": "kernel@pkts.ca", "attachment_id": null, "text": "I'd love to supply a patch, but I don't know enough about what's going on to\nwrite one for this.  I'd be supplying some 'G' for the GIGO process.", "id": 91199, "time": "2006-07-12T07:47:36Z", "bug_id": 40004, "creation_time": "2006-07-12T07:47:36Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 40004, "text": "The new rewrite flags documentation (httpd.apache.org/docs/rewrite/flags.html)\nwill be providing more detail on things like this. I'll be certain to cover this\nparticular annoyance there. Thanks for the reminder.", "id": 91201, "time": "2006-07-12T10:47:43Z", "creator": "rbowen@apache.org", "creation_time": "2006-07-12T10:47:43Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 40004, "attachment_id": null, "id": 91221, "time": "2006-07-12T16:57:34Z", "creator": "pfudd@ubc.pkts.ca", "creation_time": "2006-07-12T16:57:34Z", "is_private": false, "text": "The more I think about it, the more I think this is a misfeature.  If '[L]'\ndoesn't stop further rewriting (in directory rules), then it doesn't serve a\npurpose (in directory rules).  Is there a workaround?"}, {"count": 9, "tags": [], "creator": "bobsiegen@googlemail.com", "attachment_id": null, "text": "(In reply to comment #8)\n> The more I think about it, the more I think this is a misfeature.  If '[L]'\n> doesn't stop further rewriting (in directory rules), then it doesn't serve a\n> purpose (in directory rules).\n\nWell, as  Andr\u00e9 said, it stops processing in that round of processing. The\ninternal redirect is nearly a new request (well, not everything is being\nre-processed). The L-Flag is usefull in per-dir context, just think about 20\nrules and the first did match. With out the L-flag everything below would be\ntested in that round of processing, too. That saves processing. I don't think\nthat writing something like \"don't apply rewrite rules any more\" into\nrequest_rec is a solution, think about the situation rewriting /a to /b while\nthere are rewriteRules in palce fpr <directory /var/www/b>.\n\n> Is there a workaround?\n\nEither use THE_REQUEST or ENV:REDIRECT_STATUS\n\n    RewriteBase /db/\n    RewriteRule ^experiment-1 experiment-2 [L]\n    RewriteCond %{ENV:REDIRECT_STATUS} =\"\"\n    RewriteRule ^experiment-2 experiment-3\n\nor\n\n    RewriteBase /db/\n    RewriteRule ^experiment-1 experiment-2 [L]\n    RewriteCond %{THE_REQUEST} experiment-2\n    RewriteRule ^experiment-2 experiment-3\n\n> The new rewrite flags documentation (httpd.apache.org/docs/rewrite/flags.html)\n\nThere is a small mistake:\nRewriteRule %{REQUEST_URI} \\.(png|gif|jpg) - [E=image:1]\n\nshould be\n\nRewriteRule \\.(png|gif|jpg) - [E=image:1]", "id": 91265, "time": "2006-07-13T10:41:31Z", "bug_id": 40004, "creation_time": "2006-07-13T10:41:31Z", "is_private": false}, {"count": 10, "tags": [], "creator": "rbowen@apache.org", "attachment_id": null, "text": "(In reply to comment #9)\n\n> There is a small mistake:\n> RewriteRule %{REQUEST_URI} \\.(png|gif|jpg) - [E=image:1]\n> \n> should be\n> \n> RewriteRule \\.(png|gif|jpg) - [E=image:1]\n\nThanks. Fixed in r559494 in trunk. Will fix in 2.2 also.", "id": 105940, "time": "2007-07-25T08:39:37Z", "bug_id": 40004, "creation_time": "2007-07-25T08:39:37Z", "is_private": false}, {"count": 11, "tags": [], "bug_id": 40004, "text": "Fixed on trunk to note the reinjection possibility in the docs for the L flag.", "id": 106163, "time": "2007-08-01T11:49:38Z", "creator": "slive@apache.org", "creation_time": "2007-08-01T11:49:38Z", "is_private": false, "attachment_id": null}]
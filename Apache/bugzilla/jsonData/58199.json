[{"count": 0, "tags": [], "creator": "kencosgrove@live.com", "attachment_id": null, "id": 184254, "time": "2015-07-31T15:02:03Z", "bug_id": 58199, "creation_time": "2015-07-31T15:02:03Z", "is_private": false, "text": "I'm not sure if this is related to the fix that just went in for: https://bz.apache.org/bugzilla/show_bug.cgi?id=58125\n\nI'm getting this error on Tomcat 8 startup when using my own custom security manager:\njava.lang.ClassCircularityError: java/security/Permission\n\tat com.mytest.MySecurityManager.checkPermission(MySecurityManager.java:15)\n\tat java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:1298)\n\tat java.lang.System.getProperty(System.java:708)\n\tat sun.security.action.GetPropertyAction.run(GetPropertyAction.java:84)\n\tat sun.security.action.GetPropertyAction.run(GetPropertyAction.java:49)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.io.PrintWriter.<init>(PrintWriter.java:116)\n\tat java.io.PrintWriter.<init>(PrintWriter.java:100)\n\tat java.util.logging.SimpleFormatter.format(SimpleFormatter.java:155)\n\tat java.util.logging.StreamHandler.publish(StreamHandler.java:196)\n\tat java.util.logging.ConsoleHandler.publish(ConsoleHandler.java:105)\n\tat java.util.logging.Logger.log(Logger.java:616)\n\tat java.util.logging.Logger.doLog(Logger.java:641)\n\tat java.util.logging.Logger.logp(Logger.java:841)\n\tat org.apache.juli.logging.DirectJDKLog.log(DirectJDKLog.java:167)\n\tat org.apache.juli.logging.DirectJDKLog.fatal(DirectJDKLog.java:143)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:627)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.springsource.loaded.ri.ReflectiveInterceptor.jlrMethodInvoke(ReflectiveInterceptor.java:1426)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:351)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:485)\n\nNote that I'm using tc Server with Tocmat 8.0.20 rather than Tomcat 8 directly.  Not sure if that's relevant.\n\nIt works fine with tc Server with Tomcat 7.0.59.\n\nHere's a sample MySecurityManager:\npackage com.mytest;\n\npublic class MySecurityManager extends SecurityManager\n{ \n  public MySecurityManager()\n  {\n    super();\n  }\n\n  @Override\n  public void checkPermission(java.security.Permission perm)\n  {\n    if (perm == null) {\n      throw new NullPointerException(\"permission can't be null\");\n    }\n    \n    String propertyName = perm.getName();\n  }\n\n  @Override\n  public void checkPermission(java.security.Permission perm, Object context)\n  {\n    checkPermission(perm);\n  }\n}\n\nIt seems to blow up when I get to the perm.getName() check.\n\nAny ideas?\n\nThanks,\n\nKen"}, {"count": 1, "tags": [], "text": "I'm running JDK 1.7.0_60 if that is significant.", "attachment_id": null, "bug_id": 58199, "id": 184256, "time": "2015-07-31T17:56:11Z", "creator": "kencosgrove@live.com", "creation_time": "2015-07-31T17:56:11Z", "is_private": false}, {"count": 2, "tags": [], "creator": "kencosgrove@live.com", "attachment_id": null, "id": 184307, "time": "2015-08-04T18:39:31Z", "bug_id": 58199, "creation_time": "2015-08-04T18:39:31Z", "is_private": false, "text": "I just realized that a bunch of Maven dependencies will still referencing Tomcat 7.  After switching these to Tomcat 8, everything seems to be fine.\nSorry about that.\n\nMarking this as resolved."}, {"count": 3, "tags": [], "creator": "kencosgrove@live.com", "attachment_id": null, "is_private": false, "id": 184308, "time": "2015-08-04T20:07:04Z", "bug_id": 58199, "creation_time": "2015-08-04T20:07:04Z", "text": "Actually, I was wrong this is still an issue.  I got things up and running because I had dropped a jar with just my custom security manager in the endorsed directory when I was looking for a workaround.\n\nI shouldn't have to do that though."}, {"count": 4, "tags": [], "bug_id": 58199, "attachment_id": null, "id": 184334, "creation_time": "2015-08-05T12:18:06Z", "time": "2015-08-05T12:18:06Z", "creator": "markt@apache.org", "text": "This works for me using your SecurityManager and the latest 8.0.x code.\n\nI can't tell if this is related to using tc Server (unlikely given at the point you see this error you won't have touched any of the tc Server specific extensions), something to do with the presence of org.springsource.loaded.ri.ReflectiveInterceptor.jlrMethodInvoke in the stack trace which is neither a Tomcat nor tc Server class or if it is something else.\n\nIt is also possible that the fix for bug 58125 will have fixed the error although I couldn't repeat the error with or without that fix in place.\n\nIf you still see this error with the latest 8.0.x code then please provide the simplest possible set of steps to reproduce this starting from a clean build of 8.0.x/trunk.", "is_private": false}, {"count": 5, "tags": [], "creator": "kencosgrove@live.com", "attachment_id": null, "id": 184341, "time": "2015-08-05T13:53:44Z", "bug_id": 58199, "creation_time": "2015-08-05T13:53:44Z", "is_private": false, "text": "That stack trace had a springloaded jar in there that is used for hot deploys in STS (which is based on Eclipse).\n\nHere's the stack trace with springloaded removed:\njava.lang.ClassCircularityError: java/security/Permission\n\tat com.mytest.MySecurityManager.checkPermission(MySecurityManager.java:17)\n\tat java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:1298)\n\tat java.lang.System.getProperty(System.java:708)\n\tat sun.security.action.GetPropertyAction.run(GetPropertyAction.java:84)\n\tat sun.security.action.GetPropertyAction.run(GetPropertyAction.java:49)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.io.PrintWriter.<init>(PrintWriter.java:116)\n\tat java.io.PrintWriter.<init>(PrintWriter.java:100)\n\tat org.apache.juli.OneLineFormatter.format(OneLineFormatter.java:131)\n\tat org.apache.juli.FileHandler.publish(FileHandler.java:196)\n\tat java.util.logging.Logger.log(Logger.java:616)\n\tat java.util.logging.Logger.doLog(Logger.java:641)\n\tat java.util.logging.Logger.logp(Logger.java:841)\n\tat org.apache.juli.logging.DirectJDKLog.log(DirectJDKLog.java:182)\n\tat org.apache.juli.logging.DirectJDKLog.fatal(DirectJDKLog.java:158)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:627)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:606)\n\tat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:351)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:485)"}, {"count": 6, "tags": [], "creator": "kencosgrove@live.com", "attachment_id": null, "is_private": false, "id": 184342, "time": "2015-08-05T13:54:10Z", "bug_id": 58199, "creation_time": "2015-08-05T13:54:10Z", "text": "I will attach a reduced war."}, {"count": 7, "tags": [], "creator": "kencosgrove@live.com", "attachment_id": 32964, "is_private": false, "id": 184343, "time": "2015-08-05T13:55:07Z", "bug_id": 58199, "creation_time": "2015-08-05T13:55:07Z", "text": "Created attachment 32964\nWar that illustrates this issue"}, {"count": 8, "tags": [], "bug_id": 58199, "attachment_id": 32965, "id": 184344, "creation_time": "2015-08-05T13:56:05Z", "time": "2015-08-05T13:56:05Z", "creator": "kencosgrove@live.com", "text": "Created attachment 32965\nSource code for the web app", "is_private": false}, {"count": 9, "tags": [], "bug_id": 58199, "is_private": false, "text": "Thanks for the test case. If I remove the fix for bug 58125 I see the error so this is another symptom of that bug.\n\nMany thanks.\n\n*** This bug has been marked as a duplicate of bug 58125 ***", "id": 184347, "time": "2015-08-05T14:03:40Z", "creator": "markt@apache.org", "creation_time": "2015-08-05T14:03:40Z", "attachment_id": null}]
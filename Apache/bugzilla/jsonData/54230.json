[{"count": 0, "tags": [], "bug_id": 54230, "text": "Created attachment 29661\nTCP Sampler patch file and images\n\nPlease find the attached diff file for source code and screen capture images for xdoc.\nI made a patch for TCP Sampler and TCP Sampler Config. This patch was originally made for our company\u2019s testing.\n\nThings changed\n- On TCP Sampler Config\nAdd \u201cSO_LINGER\u201d checkbox and \u201cLINGER Timeout\u201d text input box to prevent large numbers of sockets sitting around with a TIME_WAIT status. It\u2019s related to https://issues.apache.org/bugzilla/show_bug.cgi?id=40499\nAdd \u201cEnd of line(EOL) byte value\u201d text input box to set eolByte value on GUI. Setting on GUI will overwrite the setting in properties file. If user doesn\u2019t set the value on GUI, It will use the setting on properties file.\nRemove \u201cRe-Use Connection\u201d checkbox, and it will be shown only on TCP Sampler as in case of checkbox, if user utilizes TCP Sampler and TCP Sampler Config together, the settings on the TCP Sampler Config are meaningless.\nRemove \u201cTCP Nodelay\u201d checkbox, and it will be shown only on TCP Sampler.\n\n- On TCP Sampler\nAdd \u201cClose Connection\u201d checkbox to be able to close connection even if user checks \u201cRe-Use Connection\u201d option. In our company\u2019s test, we needed to close the connection at the end of each thread.\n           \nAlso the diff contains a little GUI adjustment for TCP Sampler and Config.\n\nAttached two images\u2019 location is /jmeter/xdocs/images/screenshots.\n\nThe issue - https://issues.apache.org/bugzilla/show_bug.cgi?id=40499 \u2013 is related to this patch but, he said too generally, not particularly about TCP Sampler. So I will not change the status of the issue.\n\nTODO(Next time)\n- Change check boxes to select boxes for those options.", "id": 163752, "time": "2012-12-01T13:31:02Z", "creator": "kurt@uangel.com", "creation_time": "2012-12-01T13:31:02Z", "is_private": false, "attachment_id": 29661}, {"count": 1, "tags": [], "bug_id": 54230, "attachment_id": 29662, "id": 163753, "time": "2012-12-01T13:38:10Z", "creator": "kurt@uangel.com", "creation_time": "2012-12-01T13:38:10Z", "is_private": false, "text": "Created attachment 29662\nTCP Sampler patch file\n\nPlease find this file..."}, {"count": 2, "tags": [], "bug_id": 54230, "attachment_id": 29663, "id": 163754, "time": "2012-12-01T13:39:12Z", "creator": "kurt@uangel.com", "creation_time": "2012-12-01T13:39:12Z", "is_private": false, "text": "Created attachment 29663\nTCP Sampler Config screenshot for xdoc"}, {"count": 3, "attachment_id": 29664, "creator": "kurt@uangel.com", "text": "Created attachment 29664\nTCP Sampler screenshot for xdoc", "id": 163755, "time": "2012-12-01T13:39:55Z", "bug_id": 54230, "creation_time": "2012-12-01T13:39:55Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "text": "I'm not sure how the new \"Close Connection\" option  helps.\n\nSurely, just deselecting \"Re-use connection\" has the same effect?\n\nThe method getSoLingerTimeut() is misspelt, but that could be easily fixed.\n\nAlso, I don't think one needs both the boolean SO linger and the Linger timeout fields on the GUI.\n\nIf the timeout field is non-empty, only then set SO linger. The documentation needs to make it clear that the linger timeout is only applied when the socket is created.", "attachment_id": null, "id": 163756, "creator": "sebb@apache.org", "time": "2012-12-01T21:04:15Z", "bug_id": 54230, "creation_time": "2012-12-01T21:04:15Z", "is_private": false}, {"count": 5, "attachment_id": null, "creator": "kurt@uangel.com", "text": "(In reply to comment #4)\n> I'm not sure how the new \"Close Connection\" option helps.\nAt the moment, there is no way to control connections in TCP Sampler on behalf of client. \n\nEven if the server close the connection, the connection will not be closed immediately. There could effect next loop of the thread. \n\nIn our case, sending \"quit\" message to server, the server ideally responds \"bye\" and close the connection. But the response also could be an event message which is made by another sampler of another thread, asynchronously. Then the first sampler of next loop could try to send message to the closed socket. \n\nSo I thought it would be better if we can control the connection on client behalf. \n\n> Surely, just deselecting \"Re-use connection\" has the same effect? \nYes, if you deselect \"Re-Use Connection\", the \"Close connection\" checkbox will be disabled, set as \"checked\" on GUI.\n\n> The method getSoLingerTimeut() is misspelt, but that could be easily fixed.\nSorry for that. I will fix that.\n\n> Also, I don't think one needs both the boolean SO linger and the Linger\n> timeout fields on the GUI.\n> \n> If the timeout field is non-empty, only then set SO linger. The\n> documentation needs to make it clear that the linger timeout is only applied\n> when the socket is created.\nYes, I think that's good idea. I'll apply that.\n\n(In reply to comment #4)\n> I'm not sure how the new \"Close Connection\" option  helps.\n> \n> Surely, just deselecting \"Re-use connection\" has the same effect?\n> \n> The method getSoLingerTimeut() is misspelt, but that could be easily fixed.\n> \n> Also, I don't think one needs both the boolean SO linger and the Linger\n> timeout fields on the GUI.\n> \n> If the timeout field is non-empty, only then set SO linger. The\n> documentation needs to make it clear that the linger timeout is only applied\n> when the socket is created.\n\n(In reply to comment #4)\n> I'm not sure how the new \"Close Connection\" option  helps.\n> \n> Surely, just deselecting \"Re-use connection\" has the same effect?\n> \n> The method getSoLingerTimeut() is misspelt, but that could be easily fixed.\n> \n> Also, I don't think one needs both the boolean SO linger and the Linger\n> timeout fields on the GUI.\n> \n> If the timeout field is non-empty, only then set SO linger. The\n> documentation needs to make it clear that the linger timeout is only applied\n> when the socket is created.", "id": 163760, "time": "2012-12-02T03:12:24Z", "bug_id": 54230, "creation_time": "2012-12-02T03:12:24Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 54230, "text": "(In reply to comment #4)\n> Surely, just deselecting \"Re-use connection\" has the same effect?\nActually no,\ndeselecting \"Re-Use Connection\" will not re-use connection and creat new connection but selecting both of them will try re-use connection and after running the sampler, close the connection.", "id": 163761, "time": "2012-12-02T03:25:30Z", "creator": "kurt@uangel.com", "creation_time": "2012-12-02T03:25:30Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "(In reply to comment #6)\n> (In reply to comment #4)\n> > Surely, just deselecting \"Re-use connection\" has the same effect?\n> Actually no,\n> deselecting \"Re-Use Connection\" will not re-use connection and creat new\n> connection but selecting both of them will try re-use connection and after\n> running the sampler, close the connection.\n\nOK< I see now.", "id": 163763, "time": "2012-12-02T12:12:03Z", "bug_id": 54230, "creation_time": "2012-12-02T12:12:03Z", "is_private": false}, {"count": 8, "tags": [], "bug_id": 54230, "attachment_id": 29670, "id": 163791, "time": "2012-12-03T12:48:17Z", "creator": "kurt@uangel.com", "creation_time": "2012-12-03T12:48:17Z", "is_private": false, "text": "Created attachment 29670\nChanged  SO_LINGER checkbox to text input box and minor changes.\n\n- Changed  SO_LINGER checkbox to text input box\n- Fixed misspelled one\n- Modified component_reference.xml to reflect above change."}, {"count": 9, "tags": [], "text": "Created attachment 29671\nTCP Sampler screenshot for xdoc\n\nto reflect above change....", "attachment_id": 29671, "id": 163792, "creator": "kurt@uangel.com", "time": "2012-12-03T12:49:37Z", "bug_id": 54230, "creation_time": "2012-12-03T12:49:37Z", "is_private": false}, {"count": 10, "attachment_id": 29672, "creator": "kurt@uangel.com", "text": "Created attachment 29672\nTCP Sampler Config screenshot for xdoc\n\nto reflect above change....", "id": 163793, "time": "2012-12-03T12:50:08Z", "bug_id": 54230, "creation_time": "2012-12-03T12:50:08Z", "tags": [], "is_private": false}, {"count": 11, "tags": [], "bug_id": 54230, "attachment_id": null, "id": 163803, "time": "2012-12-03T21:48:54Z", "creator": "sebb@apache.org", "creation_time": "2012-12-03T21:48:54Z", "is_private": false, "text": "The existing TCP Config and Sampler GUIs differ only in that the login section is only present on the sampler.\n\nHowever, your screen shot shows the additional Close Connection box on the Sampler. The TCP config screen shot shows SO_LINGER and EOL only - the Reuse connection and Set NoDelay check-boxes are missing, and there is no Close Connection.\n\nThis seems wrong. Existing test plans that use the config element check-boxes will no longer work.\n\nGenerally, the config screen is the same as the sampler screen, except for any fields that just don't make sense for a sampler. I'm not sure that applies to any of the new settings. For example if Re-use connection is not selected, then all the settings would apply to a TCP sampler."}, {"count": 12, "tags": [], "creator": "kurt@uangel.com", "attachment_id": null, "text": "(In reply to comment #11)\n> The existing TCP Config and Sampler GUIs differ only in that the login\n> section is only present on the sampler.\n> \n> However, your screen shot shows the additional Close Connection box on the\n> Sampler. The TCP config screen shot shows SO_LINGER and EOL only - the Reuse\n> connection and Set NoDelay check-boxes are missing, and there is no Close\n> Connection.\n> \n> This seems wrong. Existing test plans that use the config element\n> check-boxes will no longer work.\n> \n> Generally, the config screen is the same as the sampler screen, except for\n> any fields that just don't make sense for a sampler. I'm not sure that\n> applies to any of the new settings. For example if Re-use connection is not\n> selected, then all the settings would apply to a TCP sampler.\n\nBut the problem is the checkbox, if a checkbox option is placed on both of sampler and config, the value of the checkbox on the config is useless. So in case of checkbox option, those should be placed only on one of them. So I arranged like that.\n\nAnd furthermore, Philippe Mouawad suggested replacing checkbox by selectbox like several options on HTTP Sampler. And I agreed with that. I will use select boxes and place them on both of TCP Sampler and TCP Sampler Config on my next patch.\n\nSo how do you think I would rearrange those options for now?\n\nThank you!\n\n(In reply to comment #11)\n> The existing TCP Config and Sampler GUIs differ only in that the login\n> section is only present on the sampler.\n> \n> However, your screen shot shows the additional Close Connection box on the\n> Sampler. The TCP config screen shot shows SO_LINGER and EOL only - the Reuse\n> connection and Set NoDelay check-boxes are missing, and there is no Close\n> Connection.\n> \n> This seems wrong. Existing test plans that use the config element\n> check-boxes will no longer work.\n> \n> Generally, the config screen is the same as the sampler screen, except for\n> any fields that just don't make sense for a sampler. I'm not sure that\n> applies to any of the new settings. For example if Re-use connection is not\n> selected, then all the settings would apply to a TCP sampler.", "id": 163804, "time": "2012-12-03T23:24:03Z", "bug_id": 54230, "creation_time": "2012-12-03T23:24:03Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 54230, "text": "(In reply to comment #12)\n> (In reply to comment #11)\n> > The existing TCP Config and Sampler GUIs differ only in that the login\n> > section is only present on the sampler.\n> > \n> > However, your screen shot shows the additional Close Connection box on the\n> > Sampler. The TCP config screen shot shows SO_LINGER and EOL only - the Reuse\n> > connection and Set NoDelay check-boxes are missing, and there is no Close\n> > Connection.\n> > \n> > This seems wrong. Existing test plans that use the config element\n> > check-boxes will no longer work.\n> > \n> > Generally, the config screen is the same as the sampler screen, except for\n> > any fields that just don't make sense for a sampler. I'm not sure that\n> > applies to any of the new settings. For example if Re-use connection is not\n> > selected, then all the settings would apply to a TCP sampler.\n> \n> But the problem is the checkbox, if a checkbox option is placed on both of\n> sampler and config, the value of the checkbox on the config is useless. So\n> in case of checkbox option, those should be placed only on one of them. So I\n> arranged like that.\n\nRegardless, this Bugzilla is an enhancement request, so should not change the existing behaviour unnecessarily.\n \nAlso, the text fields should appear on both screens.\n\n> And furthermore, Philippe Mouawad suggested replacing checkbox by selectbox\n> like several options on HTTP Sampler. And I agreed with that. I will use\n> select boxes and place them on both of TCP Sampler and TCP Sampler Config on\n> my next patch.\n\nThat is one possible option.\n\nIt would be nicer to implement 3-state checkboxes, as that would not require extra screen-space. The indeterminate state would mean to use the default.\n\nSo it's not appropriate to fix this as part of this enhancement.\n\n> So how do you think I would rearrange those options for now?\n\nThe new fields should be added to the existing GUI, to both config and sampler.\n\nHowever, the Close Connection makes slightly less sense for the config screen, so could perhaps be omitted from that.", "id": 163809, "time": "2012-12-04T00:40:36Z", "creator": "sebb@apache.org", "creation_time": "2012-12-04T00:40:36Z", "is_private": false, "attachment_id": null}, {"count": 14, "tags": [], "text": "Created attachment 29675\napplied what Sebb said\n\nall options will be shown on both of TCP Sampler and TCP Sampler Config.", "attachment_id": 29675, "id": 163811, "creator": "kurt@uangel.com", "time": "2012-12-04T03:55:27Z", "bug_id": 54230, "creation_time": "2012-12-04T03:55:27Z", "is_private": false}, {"count": 15, "attachment_id": 29676, "creator": "kurt@uangel.com", "text": "Created attachment 29676\nto reflect above change...", "id": 163812, "time": "2012-12-04T03:56:35Z", "bug_id": 54230, "creation_time": "2012-12-04T03:56:35Z", "tags": [], "is_private": false}, {"count": 16, "attachment_id": 29677, "creator": "kurt@uangel.com", "text": "Created attachment 29677\nTCP Sampler Config screenshot for xdoc\n\nto reflect above change...", "id": 163813, "time": "2012-12-04T03:57:29Z", "bug_id": 54230, "creation_time": "2012-12-04T03:57:29Z", "tags": [], "is_private": false}, {"count": 17, "attachment_id": 29678, "creator": "kurt@uangel.com", "text": "Created attachment 29678\nTCP Sampler screenshot for xdoc\n\nto reflect above change....", "id": 163814, "time": "2012-12-04T03:58:16Z", "bug_id": 54230, "creation_time": "2012-12-04T03:58:16Z", "tags": [], "is_private": false}, {"count": 18, "tags": [], "bug_id": 54230, "attachment_id": 29679, "id": 163816, "time": "2012-12-04T05:03:25Z", "creator": "kurt@uangel.com", "creation_time": "2012-12-04T05:03:25Z", "is_private": false, "text": "Created attachment 29679\napplied what Sebb said with some GUI adjustments\n\nI'm not sure if you like this or not, so upload both diff files. \nIn case of the first one, align of option components looks ugly. So I tried a little adjustments. You may choose whatever you want.\n\nThank you."}, {"count": 19, "tags": [], "bug_id": 54230, "text": "Created attachment 29680\nCleanning...\n\njust cleanning...", "id": 163818, "time": "2012-12-04T06:13:15Z", "creator": "kurt@uangel.com", "creation_time": "2012-12-04T06:13:15Z", "is_private": false, "attachment_id": 29680}, {"count": 20, "attachment_id": 29681, "creator": "kurt@uangel.com", "text": "Created attachment 29681\nTCP Sampler patch file", "id": 163819, "time": "2012-12-04T06:14:25Z", "bug_id": 54230, "creation_time": "2012-12-04T06:14:25Z", "tags": [], "is_private": false}, {"count": 21, "attachment_id": 29682, "creator": "kurt@uangel.com", "text": "Created attachment 29682\nTCP Sampler Config screenshot for xdoc\n\nreflect above change", "id": 163820, "time": "2012-12-04T06:17:39Z", "bug_id": 54230, "creation_time": "2012-12-04T06:17:39Z", "tags": [], "is_private": false}, {"count": 22, "tags": [], "text": "Created attachment 29683\nTCP Sampler screenshot for xdoc\n\nreflect above change", "attachment_id": 29683, "id": 163821, "creator": "kurt@uangel.com", "time": "2012-12-04T06:18:40Z", "bug_id": 54230, "creation_time": "2012-12-04T06:18:40Z", "is_private": false}, {"count": 23, "tags": [], "bug_id": 54230, "attachment_id": null, "id": 163834, "time": "2012-12-04T10:27:32Z", "creator": "sebb@apache.org", "creation_time": "2012-12-04T10:27:32Z", "is_private": false, "text": "Thanks, that looks much better."}, {"count": 24, "tags": [], "bug_id": 54230, "attachment_id": null, "id": 163957, "time": "2012-12-07T16:00:40Z", "creator": "sebb@apache.org", "creation_time": "2012-12-07T16:00:40Z", "is_private": false, "text": "Thanks for the patches and your patience.\n\nCode patch was applied with minor changes - had to change the re-use connection item listener, as that was setting the connection close checkbox. Ok when disabling re-use connection, but when re-use connection is re-enable, the original close connection state was not restored.\n\nURL: http://svn.apache.org/viewvc?rev=1418365&view=rev\nLog:\nTCP Sampler, additions of \"Close Connection\", \"SO_LINGER\" and \"End of line(EOL) byte value\" options\nBugzilla Id: 54230\n\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/resources/messages.properties\n    jmeter/trunk/src/protocol/tcp/org/apache/jmeter/protocol/tcp/config/gui/TCPConfigGui.java\n    jmeter/trunk/src/protocol/tcp/org/apache/jmeter/protocol/tcp/sampler/TCPSampler.java\n    jmeter/trunk/xdocs/changes.xml\n    jmeter/trunk/xdocs/usermanual/component_reference.xml\n\nURL: http://svn.apache.org/viewvc?rev=1418368&view=rev\nLog:\nUpdated screenshots\nBugzilla Id: 54230\n\nModified:\n    jmeter/trunk/docs/images/screenshots/tcpsampler.png\n    jmeter/trunk/docs/images/screenshots/tcpsamplerconfig.png\n    jmeter/trunk/xdocs/images/screenshots/tcpsampler.png\n    jmeter/trunk/xdocs/images/screenshots/tcpsamplerconfig.png\n    jmeter/trunk/xdocs/usermanual/component_reference.xml"}, {"count": 25, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "*** Bug 40499 has been marked as a duplicate of this bug. ***", "id": 164190, "time": "2012-12-20T22:33:35Z", "bug_id": 54230, "creation_time": "2012-12-20T22:33:35Z", "is_private": false}]
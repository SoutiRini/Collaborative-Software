[{"count": 0, "tags": [], "bug_id": 44697, "attachment_id": null, "id": 115054, "time": "2008-03-27T18:17:57Z", "creator": "ggerard@mac.com", "creation_time": "2008-03-27T18:17:57Z", "is_private": false, "text": "Here's my Valve (ripped off from the Tomcat docs):\n        <Valve className=\"org.apache.catalina.valves.AccessLogValve\"\n          directory=\"logs\"  prefix=\"trovix_access_log.\" suffix=\".txt\"\n          pattern='%h %l %u %t \"%r\" %s %b \"%{Referer}i\" \"%{User-Agent}i\" %A %v \"%{x-forwarded-for}i\" og=%{og}c Session=%S Time=%D' resolveHosts=\"false\"/>\n\nWhen I do:\ncurl 'http://localhost:8080/\"'\n\nThe quote shows up literally in the log.\n\nOn httpd 2.2.3 I get a backslash escaped quote. I don't know what other naughty characters also mess up logging.\n127.0.0.1 - - [27/Mar/2008:18:07:48 -0700] \"GET /\\\" HTTP/1.1\" 404 278 \"-\" \"curl/7.15.5 (x86_64-redhat-linux-gnu) libcurl/7.15.5 OpenSSL/0.9.8b zlib/1.2.3 libidn/0.6.5\"\n\nhttpd again:\ncurl -D - 'http://localhost/ HTTP/1.1\"'\n127.0.0.1 - - [27/Mar/2008:18:15:30 -0700] \"GET / HTTP/1.1\\\" HTTP/1.1\" 200 916 \"-\" \"curl/7.15.5 (x86_64-redhat-linux-gnu) libcurl/7.15.5 OpenSSL/0.9.8b zlib/1.2.3 libidn/0.6.5\"\n\nI believe this is major because I cannot parse the logs without also looking out for people injecting garbage to poison the logs."}, {"count": 1, "tags": [], "text": "This has been raised before and the conclusion reached that it is more useful when debugging issues to have the real data in the logs than to use escaping.\n\nYou should be able to wrap the valve to create your own valve that does what you want. Alternatively you could add an escaping option to the valve. I suspect that a patch for such an option would be accepted. If you choose to go down that route, feel free to re-open this issue and attach the patch.", "is_private": false, "id": 115065, "creation_time": "2008-03-28T00:57:40Z", "time": "2008-03-28T00:57:40Z", "creator": "markt@apache.org", "bug_id": 44697, "attachment_id": null}]
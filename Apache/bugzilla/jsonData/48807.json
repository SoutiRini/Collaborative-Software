[{"count": 0, "tags": [], "creator": "develop-subscribe@lepidum.co.jp", "text": "Created attachment 25050\nfor protocol.c\n\nI'm coding a new authentication module and have some trouble with adding a proper 'WWW-Authenticate' header.\n\nApaceh2 separates aaa module to mod_auth_X and mod_authz_Y.\nIn current implementation, if mod_auth_X authenticates user 'foo' successfully and\nmod_authz_Y does not authorize 'foo', mod_authz_Y calls function 'ap_note_auth_failure()'.\nThis function gets the authentication scheme by calling 'ap_auth_type(r)' and adds the associated 'WWW-Authenticate' header.\n\nThere are hard-coded invocations of 'ap_note_X_auth_failure' where X is 'basic' or 'digest', and there are almost same function in mod_auth_X as 'ap_note_X_auth_failure'.\nThis design also causes problem when making a new authentication module without editing 'server/protocol.c'.\n\nI think the routine should reside only in mod_auth_X.\nThe following patch solves only the new scheme problem by setting a 'note-auth-failure' property in mod_auth_X.\n'ap_note_X_auth_failure' in 'server/protocol.c' are not touched but can be removed by the same way.\n\nThe reason of the list structure has multiple headers.\n\n(This issue was found during \"HTTP Mutual Access Authentication Protocol\" development. \nhttp://tools.ietf.org/html/draft-oiwa-http-mutualauth , \nhttps://www.rcis.aist.go.jp/special/MutualAuth/index-en.html ,\nhttps://www.rcis.aist.go.jp/special/MutualAuth/software/mod_auth_mutual/index-en.html )", "id": 134856, "time": "2010-02-24T12:09:01Z", "bug_id": 48807, "creation_time": "2010-02-24T12:09:01Z", "is_private": false, "attachment_id": 25050}, {"count": 1, "tags": [], "bug_id": 48807, "attachment_id": null, "text": "In trunk, I have solved this by allowing modules to hook into ap_note_auth_failure. Commited in r960399", "id": 138135, "time": "2010-07-04T17:20:38Z", "creator": "sf@sfritsch.de", "creation_time": "2010-07-04T17:20:38Z", "is_private": false}, {"count": 2, "tags": [], "creator": "sf@sfritsch.de", "attachment_id": null, "id": 154230, "time": "2012-02-26T17:02:41Z", "bug_id": 48807, "creation_time": "2012-02-26T17:02:41Z", "is_private": false, "text": "fixed in 2.4.1"}]
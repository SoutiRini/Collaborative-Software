[{"count": 0, "tags": [], "creator": "jchampion@apache.org", "attachment_id": null, "text": "Partial duplicate of 50851, but that bug is an omnibus with quite a bit of history behind it and this issue is more easily patched.\n\nWhen using mod_proxy_fcgi with the recommended SetHandler/Proxy architecture:\n\n  Alias /cgi-bin/ \"/usr/local/apache2/cgi-bin/\"\n  <Location /cgi-bin/>\n    SetHandler \"proxy:fcgi://localhost:4000\"\n  </Location>\n\n  <Proxy \"fcgi://localhost:4000\">\n  </Proxy>\n\n...the SCRIPT_FILENAME passed to the backend is prefixed with proxy:fcgi:\n\n  [Fri May 20 12:08:40.299263 2016] [proxy_fcgi:trace8] [pid 21189:tid 139785465222912] mod_proxy_fcgi.c(294): [client 127.0.0.1:51060] AH01062: sending env var 'SCRIPT_FILENAME' value 'proxy:fcgi://localhost:4000/usr/local/apache2/cgi-bin/test-cgi'\n\nThis makes it difficult to use with general-purpose FCGI backends, since they cannot understand the file path. PHP-FPM appears to have been hard-coded to ignore the prefix as a workaround; see https://bugs.php.net/bug.php?id=54152 .\n\nmod_proxy_fcgi already strips the proxy:balancer prefix; I propose that we add the proxy:fcgi prefix to that logic as well (or refactor the logic so that the internal prefixes aren't considered by the environment variable generation, but that would be significantly more work).", "id": 191195, "time": "2016-05-23T16:21:29Z", "bug_id": 59618, "creation_time": "2016-05-23T16:21:29Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 59618, "text": "Created attachment 33865\nStrip proxy:fcgi as well as proxy:balancer\n\nOne possible approach. Patch was made against 2.4.20.", "id": 191196, "time": "2016-05-23T16:40:03Z", "creator": "jchampion@apache.org", "creation_time": "2016-05-23T16:40:03Z", "is_private": false, "attachment_id": 33865}, {"count": 2, "tags": [], "bug_id": 59618, "text": "Created attachment 33867\nAn Apache::Test case\n\nHere's a test case for the SCRIPT_FILENAME variable.\n\nRegarding the XXX marker in the patch: I couldn't find a way to get the value of a @NextAvailablePort@ from inside the test client. Maybe a new Apache::Test feature is needed? Or we could just hardcode the port number.", "id": 191207, "time": "2016-05-23T23:10:58Z", "creator": "jchampion@apache.org", "creation_time": "2016-05-23T23:10:58Z", "is_private": false, "attachment_id": 33867}, {"count": 3, "tags": [], "bug_id": 59618, "attachment_id": null, "text": "Thanks Jacob, fixed in http://svn.apache.org/r1747810 and proposed for 2.4.x.", "id": 191545, "time": "2016-06-10T22:55:21Z", "creator": "covener@gmail.com", "creation_time": "2016-06-10T22:55:21Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 59618, "attachment_id": null, "text": "Backported to v2.4.21.", "id": 191617, "time": "2016-06-13T22:54:28Z", "creator": "minfrin@sharp.fm", "creation_time": "2016-06-13T22:54:28Z", "is_private": false}, {"count": 5, "tags": [], "creator": "covener@gmail.com", "attachment_id": null, "text": "Need go to back to the drawing board on this one, php-fpm was using this prefix as a hint that this was a non mod_fastcgi / non Action kind of invocation. When its gone, they're using PATH_TRANSLATED instead of SCRIPT_FILENAME because I guess that's how some Action-based mod_fastcgi configs worked.\n\nI am tempted to flip the default and just guard it under a directive.", "id": 195898, "time": "2017-01-08T02:40:53Z", "bug_id": 59618, "creation_time": "2017-01-08T02:40:53Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 59618, "text": "Modifications in 2.4.26 and later provide workarounds for this.", "id": 198408, "time": "2017-04-20T13:20:44Z", "creator": "jim@apache.org", "creation_time": "2017-04-20T13:20:44Z", "is_private": false, "attachment_id": null}]
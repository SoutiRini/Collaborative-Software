[{"count": 0, "tags": [], "creator": "kristofd@online.no", "text": "A (for me) completely normal http POST is refused by Tomcat (returns 503) when\nserved through mod_jk. The request works fine when served directly (through\nCatalina).\n\nIt seems that mod_jk receives the request, and that Tomcat thinks it is a bad\nrequest (responds with 400). Then a retry is initiated, but the second time\nTomcat just refuses with 503.\n\nHere is the request:\n\n---------\nPOST /servlet/FlushServer HTTP/1.1\nConnection: close\nHOST_SERVICE: FutureTenseContentServer:6.3.0\nUser-Agent: Jakarta Commons-HttpClient/3.0-rc3\nHost: content-test2.website.no:7500\nContent-Length: 6450\nContent-Type: multipart/form-data; boundary=n9NyrUUS0FIvX9Fqn-iBCN6bhqfLRHoVM\n\n--n9NyrUUS0FIvX9Fqn-iBCN6bhqfLRHoVM\nContent-Disposition: form-data; name=\"password\"\nContent-Type: text/plain; charset=ISO-8859-1\nContent-Transfer-Encoding: 8bit\n\n(topsecret)\n--n9NyrUUS0FIvX9Fqn-iBCN6bhqfLRHoVM\nContent-Disposition: form-data; name=\"tags\"\nContent-Type: text/plain; charset=ISO-8859-1\nContent-Transfer-Encoding: 8bit\n\n<com.fatwire.satellite.page pagename=\"WebSite/RenderAssets\"\ncachecontrol=\"default\" cid=\"1181049931138\" rendermode=\"live\"\nattributeType=\"Vedlegg_flex\" attrid=\"1098976538607\"\nattributedef=\"Informasjonsattributt\" site=\"WebSite\" attributename=\"Vedlegg\"\nc=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderAssets\"\ncachecontrol=\"default\" cid=\"1181049931138\"\nrendermode=\"preview-frankw-1138643678332\" attributeType=\"Person\"\nattrid=\"1137742915171\" attributedef=\"Informasjonsattributt\" site=\"WebSite\"\nattributename=\"InterneKontaktpersoner\" c=\"Informasjonstekst\"\n/com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderText\" cachecontrol=\"default\"\ncid=\"1181049931138\" rendermode=\"live\" attributedef=\"Informasjonsattributt\"\nsite=\"WebSite\" attributename=\"Ingress\" c=\"Informasjonstekst\"\n/com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderAssets\"\ncachecontrol=\"default\" cid=\"1181049931138\" rendermode=\"live\"\nattributeType=\"Person\" attrid=\"1137742915171\"\nattributedef=\"Informasjonsattributt\" site=\"WebSite\"\nattributename=\"InterneKontaktpersoner\" c=\"Informasjonstekst\"\n/com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderText\" cachecontrol=\"default\"\ncid=\"1181049931138\" rendermode=\"preview-frankw-1138643678332\"\nattributedef=\"Informasjonsattributt\" site=\"WebSite\" attributename=\"Ingress\"\nc=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderEksternLinkList\"\ncachecontrol=\"default\" cid=\"1181049931138\" rendermode=\"live\" listtype=\"updown\"\nattributetype=\"Informasjonsattributt\" site=\"WebSite\"\nattributename=\"EksterneLinker\" c=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/Informasjonstekst/Detaljvisning\"\ncachecontrol=\"default\" cid=\"1181049931138\" rendermode=\"live\" p=\"1181049931162\"\nsite=\"WebSite\" c=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderInternLinkList\"\ncachecontrol=\"default\" cid=\"1181049931138\"\nrendermode=\"preview-frankw-1138643678332\" listtype=\"updown\"\nattributetype=\"Informasjonsattributt\" site=\"WebSite\"\nattributename=\"InterneLinker\" c=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/Informasjonstekst/Detaljvisning\"\ncachecontrol=\"default\" cid=\"1181049931138\"\nrendermode=\"preview-frankw-1138643678332\" p=\"1181049931162\" site=\"WebSite\"\nc=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderAssets\"\ncachecontrol=\"default\" cid=\"1181049931138\"\nrendermode=\"preview-frankw-1138643678332\" attributeType=\"Person\"\nattrid=\"1137742915553\" attributedef=\"Informasjonsattributt\" site=\"WebSite\"\nattributename=\"InterneKontaktpersoner\" c=\"Informasjonstekst\"\n/com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderAssets\"\ncachecontrol=\"default\" cid=\"1181049931138\" rendermode=\"live\"\nattributeType=\"Vedlegg_flex\" attrid=\"1144676186079\"\nattributedef=\"Informasjonsattributt\" site=\"WebSite\" attributename=\"Vedlegg\"\nc=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderAssets\"\ncachecontrol=\"default\" cid=\"1181049931138\" rendermode=\"live\"\nattributeType=\"Person\" attrid=\"1137742915553\"\nattributedef=\"Informasjonsattributt\" site=\"WebSite\"\nattributename=\"InterneKontaktpersoner\" c=\"Informasjonstekst\"\n/com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderEksternLinkList\"\ncachecontrol=\"default\" cid=\"1181049931138\"\nrendermode=\"preview-frankw-1138643678332\" listtype=\"updown\"\nattributetype=\"Informasjonsattributt\" site=\"WebSite\"\nattributename=\"EksterneLinker\" c=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderAssets\"\ncachecontrol=\"default\" cid=\"1181049931138\"\nrendermode=\"preview-frankw-1138643678332\" attributeType=\"Vedlegg_flex\"\nattrid=\"1098976538607\" attributedef=\"Informasjonsattributt\" site=\"WebSite\"\nattributename=\"Vedlegg\" c=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderRightColumn\"\ncachecontrol=\"default\" cid=\"1181049931138\"\nrendermode=\"preview-frankw-1138643678332\" attributedef=\"Informasjonsattributt\"\nsite=\"WebSite\" c=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/Informasjonstekst/Detaljvisning\"\ncachecontrol=\"default\" cid=\"1181049931138\" rendermode=\"live\" p=\"1173185591012\"\nsite=\"WebSite\" c=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderRightColumn\"\ncachecontrol=\"default\" cid=\"1181049931138\" rendermode=\"live\"\nattributedef=\"Informasjonsattributt\" site=\"WebSite\" c=\"Informasjonstekst\"\n/com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderAssets\"\ncachecontrol=\"default\" cid=\"1181049931138\"\nrendermode=\"preview-frankw-1138643678332\" attributeType=\"Vedlegg_flex\"\nattrid=\"1144676186079\" attributedef=\"Informasjonsattributt\" site=\"WebSite\"\nattributename=\"Vedlegg\" c=\"Informasjonstekst\" /com.fatwire.satellite.page>\n<com.fatwire.satellite.page pagename=\"WebSite/RenderInternLinkList\"\ncachecontrol=\"default\" cid=\"1181049931138\" rendermode=\"live\" listtype=\"updown\"\nattributetype=\"Informasjonsattributt\" site=\"WebSite\"\nattributename=\"InterneLinker\" c=\"Informasjonstekst\" /com.fatwire.satellite.page>\n--n9NyrUUS0FIvX9Fqn-iBCN6bhqfLRHoVM\nContent-Disposition: form-data; name=\"username\"\nContent-Type: text/plain; charset=ISO-8859-1\nContent-Transfer-Encoding: 8bit\n\nadmin\n--n9NyrUUS0FIvX9Fqn-iBCN6bhqfLRHoVM--\n\n---------\n\nHere is the log output from my mod_jk log:\n\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_uri_worker_map.c (597):\nAttempting to map URI '/servlet/FlushServer' from 1 maps\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_uri_worker_map.c (609):\nAttempting to map context URI '/servlet/*=ajp13' source 'JkMount'\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_uri_worker_map.c (624):\nFound a wildchar match '/servlet/*=ajp13'\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] mod_jk.c (2131): Into handler\njakarta-servlet worker=ajp13 r->proxyreq=0\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_worker.c (115): found a\nworker ajp13\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_worker.c (292): Found\nworker type 'ajp13'\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] mod_jk.c (811): Service\nprotocol=HTTP/1.1 method=POST host=(null) addr=158.36.112.211\nname=esak-webtest.website.no port=80 auth=(null) user=(null) laddr=158.36.125.14\nraddr=158.36.112.211 uri=/servlet/FlushServer\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (2498):\nacquired connection pool slot=0\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (551): ajp\nmarshaling done\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (1935):\nprocessing ajp13 with 2 retries\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): sending\nto ajp13 pos=4 len=293 max=8192\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0000  \n 12 34 01 21 02 04 00 08 48 54 54 50 2F 31 2E 31  - .4.!....HTTP/1.1\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0010  \n 00 00 14 2F 73 65 72 76 6C 65 74 2F 46 6C 75 73  - .../servlet/Flus\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0020  \n 68 53 65 72 76 65 72 00 00 0E 31 35 38 2E 33 36  - hServer...158.36\n(.....)\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0110  \n 5A 78 41 6B 65 64 6D 37 2D 44 58 69 42 4A 70 75  - ZxAkedm7-DXiBJpu\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0120  \n 35 76 6C 00 FF 00 00 00 00 00 00 00 00 00 00 00  - 5vl.............\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (1325):\n(ajp13) request body to send 1690 - request body to resend 0\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): sending\nto ajp13 pos=4 len=1696 max=8192\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0000  \n 12 34 06 9C 06 9A 2D 2D 4B 46 77 34 49 32 51 65  - .4....--KFw4I2Qe\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0010  \n 71 36 70 5A 78 41 6B 65 64 6D 37 2D 44 58 69 42  - q6pZxAkedm7-DXiB\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0020  \n 4A 70 75 35 76 6C 0D 0A 43 6F 6E 74 65 6E 74 2D  - Jpu5vl..Content-\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0030  \n 44 69 73 70 6F 73 69 74 69 6F 6E 3A 20 66 6F 72  - Disposition:.for\n(.....)\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 03f0  \n 74 65 6C 6C 69 74 65 2E 70 61 67 65 20 70 61 67  - tellite.page.pag\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (1058):\nreceived from ajp13 pos=0 len=19 max=8192\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (1058): 0000 \n  04 01 90 00 0B 42 61 64 20 52 65 71 75 65 73 74  - .....Bad.Request\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (1058): 0010 \n  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  - ................\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (606): status\n= 400\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (613): Number\nof headers is = 0\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [error] jk_ajp_common.c (966): (ajp13)\ncan't receive the response message from tomcat, network problems or tomcat\n(127.0.0.1:8009) is down (errno=53)\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [error] jk_ajp_common.c (1699):\n(ajp13) Tomcat is down or network problems. Part of the response has already\nbeen sent to the client\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [info] jk_ajp_common.c (2046): (ajp13)\nreceiving from tomcat failed, recoverable operation attempt=0\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [info] jk_ajp_common.c (2085): (ajp13)\nsending request to tomcat failed,  recoverable operation attempt=1\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): sending\nto ajp13 pos=4 len=293 max=8192\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0000  \n 12 34 01 21 02 04 00 08 48 54 54 50 2F 31 2E 31  - .4.!....HTTP/1.1\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0010  \n 00 00 14 2F 73 65 72 76 6C 65 74 2F 46 6C 75 73  - .../servlet/Flus\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0020  \n 68 53 65 72 76 65 72 00 00 0E 31 35 38 2E 33 36  - hServer...158.36\n(.....)\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0110  \n 5A 78 41 6B 65 64 6D 37 2D 44 58 69 42 4A 70 75  - ZxAkedm7-DXiBJpu\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0120  \n 35 76 6C 00 FF 00 00 00 00 00 00 00 00 00 00 00  - 5vl.............\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (1325):\n(ajp13) request body to send 0 - request body to resend 15\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): sending\nto ajp13 pos=4 len=1696 max=8192\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0000  \n 12 34 06 9C 06 9A 2D 2D 4B 46 77 34 49 32 51 65  - .4....--KFw4I2Qe\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0010  \n 71 36 70 5A 78 41 6B 65 64 6D 37 2D 44 58 69 42  - q6pZxAkedm7-DXiB\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0020  \n 4A 70 75 35 76 6C 0D 0A 43 6F 6E 74 65 6E 74 2D  - Jpu5vl..Content-\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 0030  \n 44 69 73 70 6F 73 69 74 69 6F 6E 3A 20 66 6F 72  - Disposition:.for\n(.....)\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (911): 03f0  \n 74 65 6C 6C 69 74 65 2E 70 61 67 65 20 70 61 67  - tellite.page.pag\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (1352): Resent\nthe request body (1696)\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [error] jk_ajp_common.c (966): (ajp13)\ncan't receive the response message from tomcat, network problems or tomcat\n(127.0.0.1:8009) is down (errno=53)\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [error] jk_ajp_common.c (1658):\n(ajp13) Tomcat is down or refused connection. No response has been sent to the\nclient (yet)\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [info] jk_ajp_common.c (2046): (ajp13)\nreceiving from tomcat failed, recoverable operation attempt=1\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [info] jk_ajp_common.c (2085): (ajp13)\nsending request to tomcat failed,  recoverable operation attempt=2\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [error] jk_ajp_common.c (2097):\n(ajp13) Connecting to tomcat failed. Tomcat is probably not started or is\nlistening on the wrong port\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [debug] jk_ajp_common.c (2441):\nrecycling connection pool slot=0 for worker ajp13\n[Mon Oct 08 14:00:07.156 2007] [632:5336] [info] mod_jk.c (2277): Service\nerror=0 for worker=ajp13", "id": 109130, "time": "2007-10-08T09:43:04Z", "bug_id": 43572, "creation_time": "2007-10-08T09:43:04Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "rainer.jung@kippdata.de", "text": "Hi,\n\nthanks for the debug log. Unfortunately, a lot of request forwarding lines are\nmissing. Did you check, if the full request got forwarded? The lines posted look\nlike the request got truncated before its end.\n\nThen: the request says it's body is 6450 Bytes but the request you pasted in\nhere is smaller. If this holds true, then yes: it's a bad request.\n\nIf the is no confidential data in the request, could you increase log level to\ntrace and attach a full log? In case of small confidential parts, you can cross\nthem out (but don't forget to cross the ascii part and the hex part.\n\nRegards,\n\nRainer\n", "id": 109150, "time": "2007-10-08T16:43:28Z", "bug_id": 43572, "creation_time": "2007-10-08T16:43:28Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "creator": "kristofd@online.no", "attachment_id": null, "id": 109852, "time": "2007-10-29T02:32:01Z", "bug_id": 43572, "creation_time": "2007-10-29T02:32:01Z", "is_private": false, "text": "It turned out that the request itself was bad (actual content length did not\nmatch the content length header value).\n\nSo, this can safely be closed."}]
[{"count": 0, "tags": [], "bug_id": 15599, "text": "If you set the ReconnectionDelay of a SocketAppender to zero, it is supposed to\nnot retry when it fails to connect.\n\nIf it successfully connects the first time, it honors the zero setting (with a\ntest in SocketAppender.java append(LoggingEvent event)).\n\nHowever, if it fails to connect the first time, it will try to connect an\ninfinite number of times, with no delay between tries.\n\nThe reason is that there's no test for a zero setting in SocketAppender.java\nconnect() before calling fireConnector().\n\nI have a proposed fix for this bug, and it includes two minor enhancements:\n\n1) If ReconnectionDelay is zero, the message won't say that it \"will try again\nlater'.\n\n2) If ReconnectionDelay is zero, it does not output the lengthy exception that\nyou get if it can't connect.\n\nThe rationale for this second improvement is that we use ReconnectionDelay of\nzero when we are testing on our development machines.  If we are running\nchainsaw, we want to see the logging info in chainsaw.  However, if chainsaw\nisn't running, we'd like it to fail with a brief message instead of the lengthy\nexception to the console.\n\nSetting ReconnectionDelay of zero strongly implies that \"it's not that\nimportant\" if it gets a connection, or tries to bring it back up, so I don't\nthink I'm creating too much controversy with that change.  Further, there are\nprobably not too many people setting it to zero because nobody reported this bug\nyet. :)\n\nHere's my proposed replacement:\n\n  void connect(InetAddress address, int port) {\n    if(this.address == null)\n      return;\n    try {\n      // First, close the previous connection if any.\n      cleanUp();\n      oos = new ObjectOutputStream(new Socket(address, port).getOutputStream());\n    } catch(IOException e) {\n      String msg = \"Could not connect to remote log4j server at [\"\n\t\t   +address.getHostName()+\"].\";\n\n      if(reconnectionDelay > 0) {\n        msg += \" We will try again later.\";\n        LogLog.error(msg, e);\n      }\n      else {\n        LogLog.error(msg);\n      }\n          \n      if(reconnectionDelay > 0) {      \n        fireConnector();\n      }\n    }\n  }", "id": 28152, "time": "2002-12-21T22:49:17Z", "creator": "scott@schram.net", "creation_time": "2002-12-21T22:49:17Z", "is_private": false, "attachment_id": null}, {"attachment_id": 4250, "tags": [], "creator": "scott@schram.net", "text": "Created attachment 4250\nProposed fix.  Lemme know if I did this patch right.", "count": 1, "id": 28153, "time": "2002-12-21T23:00:40Z", "bug_id": 15599, "creation_time": "2002-12-21T23:00:40Z", "is_private": false}, {"count": 2, "tags": [], "creator": "scott@schram.net", "is_private": false, "text": "I see we could move fireConnector(); into the first\n\nif(reconnectionDelay > 0)\n\nright after\n\nLogLog.error(msg, e);\n\nand eliminate the second test.", "id": 28158, "time": "2002-12-22T06:02:53Z", "bug_id": 15599, "creation_time": "2002-12-22T06:02:53Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 15599, "is_private": false, "id": 28861, "creation_time": "2003-01-03T21:34:07Z", "time": "2003-01-03T21:34:07Z", "creator": "mwomack@apache.org", "text": "I'll take a look at applying this change.", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 15599, "text": "\nThanks for reporting this bug. I applied your patch, except that the stack \ntrace is still reported. Altough you might not be interesed in the stack trace \nother users might be. It is hard to tell. I thus prefer to err on the safe \nside. ", "id": 31487, "time": "2003-02-18T00:54:11Z", "creator": "ceki@apache.org", "creation_time": "2003-02-18T00:54:11Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "creator": "guillermo.grandes@gmail.com", "attachment_id": null, "id": 146328, "time": "2011-05-15T14:36:48Z", "bug_id": 51201, "creation_time": "2011-05-15T14:36:48Z", "is_private": false, "text": "An example (or three), is worth a thousand words :-)\n\n=== Test 1 === FAIL ==========================================\nRewriteCond %{REQUEST_METHOD} !^(HEAD|POST|GET)$\nRewriteRule (.*) - [L]\n# Should not come here\nRewriteRule ^/ http://test.localhost/?method=%{REQUEST_METHOD} [R=302,L]\n\n=== Request Test 1:\nNONE / HTTP/1.0\nAccept: */*\nHost: localhost\n\n=== Response Test 1:\nHTTP/1.1 302 Found\nDate: Sun, 15 May 2011 14:21:34 GMT\nServer: Apache\nLocation: http://test.localhost/?method=GET\nContent-Length: 217\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>302 Found</title>\n</head><body>\n<h1>Found</h1>\n<p>The document has moved <a href=\"http://test.localhost/?method=GET\">here</a>.</p>\n</body></html>\n\n=== Test 2 === FAIL ==========================================\nRewriteCond %{REQUEST_METHOD} !=HEAD\nRewriteCond %{REQUEST_METHOD} !=POST\nRewriteCond %{REQUEST_METHOD} !=GET\nRewriteRule (.*) - [L]\n# Should not come here\nRewriteRule ^/ http://test.localhost/?method=%{REQUEST_METHOD} [R=302,L]\n\n=== Request Test 2:\nNONE / HTTP/1.0\nAccept: */*\nHost: localhost\n\n=== Response Test 2:\nHTTP/1.1 302 Found\nDate: Sun, 15 May 2011 14:27:25 GMT\nServer: Apache\nLocation: http://test.localhost/?method=GET\nContent-Length: 217\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>302 Found</title>\n</head><body>\n<h1>Found</h1>\n<p>The document has moved <a href=\"http://test.localhost/?method=GET\">here</a>.</p>\n</body></html>\n\n=== Test 3 === OK ============================================\nRewriteCond %{THE_REQUEST} !^(HEAD|POST|GET)\nRewriteRule (.*) - [L]\n# Should not come here\nRewriteRule ^/ http://test.localhost/?method=%{REQUEST_METHOD} [R=302,L]\n\n=== Request Test 3:\nNONE / HTTP/1.0\nAccept: */*\nHost: localhost\n\n=== Response Test 3:\nHTTP/1.1 501 Method Not Implemented\nDate: Sun, 15 May 2011 14:30:31 GMT\nServer: Apache\nAccept-Ranges: bytes\nContent-Length: 93\nConnection: close\nContent-Type: text/plain\n\nERROR-501 NOT_IMPLEMENTED\n\nThe server does not support the action requested by the browser.\n\n============================================\n\nThis is a bug?"}, {"count": 1, "tags": [], "bug_id": 51201, "attachment_id": null, "id": 146329, "time": "2011-05-15T15:29:57Z", "creator": "nick@webthing.com", "creation_time": "2011-05-15T15:29:57Z", "is_private": false, "text": "Works for me.  This is with 2.2.17, but I can't see anything relevant in the change log since 2.2.15.\n\nYour apache version contains something non-standard (evidenced by the 501 error message and the unhelpful servertokens).  Please tell us what happens when you remove third-party components.\n\nAn explanation for what you describe would be that when mod_rewrite performs an internal redirect it's defaulting to GET and ignoring the bogus method."}, {"count": 2, "tags": [], "text": "Thanks Nick,\n\nThere is no third-party components, the error you mention is standard core directive \"ErrorDocument\", a cutted/minimalist english text version of the standard error (HTTP_NOT_IMPLEMENTED.html.var):\n\nErrorDocument 501 /errors/501.txt\n\n$ cat 501.txt\n---- begin ---\nERROR-501 NOT_IMPLEMENTED\n\nThe server does not support the action requested by the browser.\n---- end -----\n\n==================\n\nHe repeated the test 1 & 3, disabling the ErrorDocument directive, the result is different in Test 1, returns 501 instead of 302 (correct behavior):\n\n=== Test 1 === OK ==========================================\nRewriteCond %{REQUEST_METHOD} !^(HEAD|POST|GET)$\nRewriteRule (.*) - [L]\n# Should not come here\nRewriteRule ^/ http://test.localhost/?method=%{REQUEST_METHOD} [R=302,L]\n\n=== Request Test 1:\nNONE / HTTP/1.0\nAccept: */*\nHost: localhost\n\n=== Response Test 1:\nHTTP/1.1 501 Method Not Implemented\nDate: Sun, 15 May 2011 17:01:26 GMT\nServer: Apache\nAllow: GET,HEAD,POST,OPTIONS\nContent-Length: 206\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>501 Method Not Implemented</title>\n</head><body>\n<h1>Method Not Implemented</h1>\n<p>NONE to / not supported.<br />\n</p>\n</body></html>\nConnection closed by foreign host.\n\n=== Test 3 === OK ============================================\nRewriteCond %{THE_REQUEST} !^(HEAD|POST|GET)\nRewriteRule (.*) - [L]\n# Should not come here\nRewriteRule ^/ http://test.localhost/?method=%{REQUEST_METHOD} [R=302,L]\n\n=== Request Test 3:\nNONE / HTTP/1.0\nAccept: */*\nHost: localhost\n\n=== Response Test 3:\nHTTP/1.1 501 Method Not Implemented\nDate: Sun, 15 May 2011 16:53:08 GMT\nServer: Apache\nAllow: GET,HEAD,POST,OPTIONS\nContent-Length: 206\nConnection: close\nContent-Type: text/html; charset=iso-8859-1\n\n<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">\n<html><head>\n<title>501 Method Not Implemented</title>\n</head><body>\n<h1>Method Not Implemented</h1>\n<p>NONE to / not supported.<br />\n</p>\n</body></html>\n============================================\n\nThe combination of ErrorDocument & mod_rewrite causes this strange effect... (\u00bf?) Is a bug? or... there is a standard/workarround way for both to coexist?", "is_private": false, "id": 146330, "creator": "guillermo.grandes@gmail.com", "time": "2011-05-15T17:28:44Z", "bug_id": 51201, "creation_time": "2011-05-15T17:28:44Z", "attachment_id": null}]
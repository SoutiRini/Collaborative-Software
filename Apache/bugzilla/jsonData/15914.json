[{"text": "The following code in the file srclib/apr/shmem/unix/shm.c\n        status = apr_file_open(&file, filename, \n                               APR_WRITE | APR_CREATE | APR_EXCL,\n                               APR_OS_DEFAULT, pool);\n        if (status != APR_SUCCESS) {\n            return status;\n        }\n\n        /* ftok() (on solaris at least) requires that the file actually\n         * exist before calling ftok(). */\n        shmkey = ftok(filename, 1);\n        if (shmkey == (key_t)-1) {\n            return errno;\n        }\n\n        if ((new_m->shmid = shmget(shmkey, new_m->realsize,\n                                   SHM_R | SHM_W | IPC_CREAT | IPC_EXCL)) < 0) {\n            return errno;\n        }\n\n\nResults in the folowing systrace:\n[pid  3806] unlink(\"/var/adm/httpd/httpd.scoreboard\") = 0\n[pid  3806] open(\"/var/adm/httpd/httpd.scoreboard\", O_WRONLY|O_CREAT|O_EXCL,\n0666) = 9\n[pid  3806] stat64(\"/var/adm/httpd/httpd.scoreboard\", {st_mode=S_IFREG|0644,\nst_size=0, ...}) = 0\n[pid  3806] shmget(16908467, 209176, IPC_CREAT|IPC_EXCL|0x180|0600) = -1 EEXIST\n(File exists)\n\n\nQuite obviously, creating a file exlusively will fail if tried twice.", "tags": [], "creator": "eskil@e.kth.se", "attachment_id": null, "count": 0, "id": 29058, "time": "2003-01-09T09:07:44Z", "bug_id": 15914, "creation_time": "2003-01-09T09:07:44Z", "is_private": false}, {"text": "The shmget() call isn't trying to create the file, but a shared memory segment -\nthis error happens after the server isn't shut down properly in a previous run.\nYou need to\n\n# ipcrm -m 16908467\n\nto remove the old shared mem segment.", "tags": [], "creator": "jorton@redhat.com", "attachment_id": null, "count": 1, "id": 29118, "time": "2003-01-10T12:13:23Z", "bug_id": 15914, "creation_time": "2003-01-10T12:13:23Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 40305, "attachment_id": null, "id": 92458, "time": "2006-08-23T12:03:04Z", "creator": "suzuki.yuichiro@jp.fujitsu.com", "creation_time": "2006-08-23T12:03:04Z", "is_private": false, "text": "I noticed that the counter \"accessCount\" of StandardSession is not synchronized \nto the session table of the Manager.\nThat cause a problem.\n\nThe Specification 2.4 says:\n---\nThe session invalidation will not take effect until all servlets using that \nsession have exited the service method.\n---\n\nThe problem is:\n1. First request creates a session.\n2. Next request invokes getSession(false).\n     In the Request#doGetSession() method,\n        2.1. The manager's findSession() method is called.\n        2.2. It is checked whether the session is valid by using the session's \nisValid() method.\n     We assume that the current thread changes before StandardSession#access() \nis called. \n3. ManagerBase#processExpires() is called.\n   In this timing, the session will be invalidated if the session is time-out,\n   because the counter \"accessCount\" is 0.\n4. StandardSession#access() is called with the former thread.\n5. The getSession(false) method returns invalid session.\n\nHowever, we were expecting Null or an valid session. \n\nI think that it is necessary to do some synchronous processing between \naccessCounter and the session table."}, {"count": 1, "tags": [], "text": "Note that if it gets too convoluted, we really don't care.\n\n*** This bug has been marked as a duplicate of 37356 ***", "is_private": false, "id": 92586, "creator": "remm@apache.org", "time": "2006-08-27T14:34:42Z", "bug_id": 40305, "creation_time": "2006-08-27T14:34:42Z", "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 40305, "is_private": false, "count": 2, "id": 99363, "time": "2007-02-14T00:33:43Z", "creator": "suzuki.yuichiro@jp.fujitsu.com", "creation_time": "2007-02-14T00:33:43Z", "text": "This issue is different from Bug37356. \nThe synchronization of accessCount by Bug37356 is not useful for this issue.\n\nI will return with a simple patch."}]
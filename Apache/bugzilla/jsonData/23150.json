[{"count": 0, "tags": [], "text": "JUnitTask now reports that tasks that have timed out by adding an error\nto the JUnitResultFormatter (in logTimeout()), but the test itself is\nnot marked as having failed, since the retVal is not marked as failed\nin executeAsForked().\n\nDave", "attachment_id": null, "bug_id": 23150, "id": 44138, "time": "2003-09-13T01:09:11Z", "creator": "daveg@permabit.com", "creation_time": "2003-09-13T01:09:11Z", "is_private": false}, {"count": 1, "tags": [], "creator": "jkf@apache.org", "attachment_id": null, "id": 44157, "time": "2003-09-13T16:15:01Z", "bug_id": 23150, "creation_time": "2003-09-13T16:15:01Z", "is_private": false, "text": "on both head and 1.5.4 it works for me.\n\nOutput with timeout\n:\nBuildfile: test.xml\n \nall:\n    [junit] TEST Test2 FAILED (timeout)\n \nBUILD SUCCESSFUL\nTotal time: 6 seconds\n\nOutput with normal error (increased timeout to after the moment the error occurs:\n\nBuildfile: test.xml\n \nall:\n    [junit] TEST Test2 FAILED\n \nBUILD SUCCESSFUL\nTotal time: 12 seconds\n\n\nbuild file used while trying to reproduce the fault:\n\n<?xml version=\"1.0\"?>\n<project name=\"test\" default=\"all\">\n   <target name=\"all\">\n       <junit fork=\"yes\" timeout=\"5000\">\n           <classpath>\n               <pathelement path=\".\"/>\n           </classpath>\n           <test name=\"Test2\" outfile=\"result\">\n               <formatter type=\"xml\"/>\n           </test>\n       </junit>\n   </target>\n</project>\n\nThe resulting xml file also contains an error for the suite (both 1.5.4 and head):\n\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<testsuite errors=\"1\" failures=\"0\" name=\"Test2\" tests=\"0\" time=\"0.0\">\n  <properties></properties>\n  <testcase classname=\"org.apache.tools.ant.taskdefs.optional.junit.JUnitTask$1\"\nname=\"unknown\" time=\"0.011\">\n    <error message=\"Timeout occurred\"\ntype=\"junit.framework.AssertionFailedError\">junit.framework.AssertionFailedError:\nTimeout occurred\n</error>\n  </testcase>\n</testsuite>\n\nPlatform used trying to reproduce the report: RedHat 9 / jdk 1.4.2"}, {"count": 2, "tags": [], "bug_id": 23150, "attachment_id": null, "id": 44159, "time": "2003-09-13T17:59:11Z", "creator": "daveg@permabit.com", "creation_time": "2003-09-13T17:59:11Z", "is_private": false, "text": "I'm sorry, but I'm unable to reproduce your results with a freshly\ndownloaded and built Ant 1.5.4 tree.  I'm using JUnit 3.8.1 if that perhaps\nis the deciding factor.\n\nI've slightly modified your build.xml as shown below:\n<?xml version=\"1.0\"?>\n<project name=\"test\" default=\"all\">\n   <target name=\"all\">\n       <junit fork=\"yes\" timeout=\"5000\" haltOnFailure=\"true\" printsummary=\"yes\">\n           <classpath>\n               <pathelement path=\".\"/>\n           </classpath>\n           <test name=\"Test2\" outfile=\"result\">\n               <formatter type=\"xml\"/>\n           </test>\n       </junit>\n   </target>\n</project>\n\n\nAnd I get the following output:\n~/opt/ant/bin/ant -version\nApache Ant version 1.5.4 compiled on September 13 2003\n\n~/quux $~/opt/ant/bin/ant \nBuildfile: build.xml\n\nall:\n    [junit] Running Test2\n\nBUILD SUCCESSFUL\nTotal time: 8 seconds\n\nIf I remove the timeout on the same test (which simply has a 10 second delay in\nit), I get:\n\n~/opt/ant/bin/ant \nBuildfile: build.xml\n\nall:\n    [junit] Running Test2\n    [junit] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 10.167 sec\n\nBUILD SUCCESSFUL\nTotal time: 13 seconds"}, {"count": 3, "tags": [], "bug_id": 23150, "attachment_id": null, "id": 44164, "time": "2003-09-13T22:28:53Z", "creator": "jkf@apache.org", "creation_time": "2003-09-13T22:28:53Z", "is_private": false, "text": "could we please have linux + jdk version?\n\n(Please not a unstable debian, i recall we had some glibc problems there recently)"}, {"attachment_id": null, "tags": [], "bug_id": 23150, "text": "please also verify the case when an error in the testcase occurs w/o timeout\noccuring.\n(i.e change the code of the simple test case to throw an uncaught exception and\nlet the timeout not occur)\n\nwhen running with the haltonfailure option and printsummary options on I get the\nfollowing output:\n\n[jkf@user ant]$ /opt/java/apache-ant-1.5.4/bin/ant -file test.xml\nBuildfile: test.xml\n \nall:\n    [junit] Running Test2\n \nBUILD FAILED\nfile:/data/jkf_nobak/ant_eclipse/workspace/ant/test.xml:4: Test Test2 failed\n(timeout)\n \nTotal time: 7 seconds\n\n(So no summary, but BUILD FAILED and not the SUCCESS you reported.)\n\nIf I give the testcase the time to fail I get:\n\n[jkf@user ant]$ /opt/java/apache-ant-1.5.4/bin/ant -file testl.xml\nBuildfile: testl.xml\n \nall:\n    [junit] Running Test2\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 10.619 sec\n \nBUILD FAILED\nfile:/data/jkf_nobak/ant_eclipse/workspace/ant/testl.xml:4: Test Test2 failed\n \nTotal time: 12 seconds\n\n\nSo there seam to be 2 issues: 1 you don't get a summary - reproduced and fixed\nin patch (separate bug 23160)\n\nand 1 the build does not fail - not reproduced.", "count": 4, "id": 44172, "time": "2003-09-14T10:57:45Z", "creator": "jkf@apache.org", "creation_time": "2003-09-14T10:57:45Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 23150, "attachment_id": null, "id": 44208, "time": "2003-09-15T15:14:30Z", "creator": "daveg@permabit.com", "creation_time": "2003-09-15T15:14:30Z", "is_private": false, "text": "I'm running Debian/stable, but with the Ant package pulled in off of testing\n(this happens even if I download the package though).  \n\nLibc is: 2.2.5-11.5 \n\nJava is:\njava version \"1.4.1\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.1)\nClassic VM (build 1.4.1, J2RE 1.4.1 IBM build cxia32141-20030522 (JIT enabled:\njitc))\n\nI'm not sure I understand the two parts of your second request.  I get\nthe expected errors when my code throws:\n\nTest2.java:\nimport junit.framework.TestCase;\npublic class Test2 extends TestCase {\n  public Test2(String name) { super(name); }\n  public void testFoo() throws Exception {\n    throw new RuntimeException(\"hi\");\n  }\n}\n\nresults in:~/quux $ant\nBuildfile: build.xml\n\nall:\n    [junit] Running Test2\n    [junit] Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 0.154 sec\n\nBUILD FAILED\nfile:/permabit/user/daveg/quux/build.xml:4: Test Test2 failed\n\nI'd be happy to run other tests, I just don't understand which you're\nasking for.\n\nThanks for your assistance,\nDave"}, {"attachment_id": null, "tags": [], "bug_id": 23150, "text": "The testcase you ran was the one I requested, thanks.\n\nThe BUILD FAILED occurs when an error occurs, but not when the timeout occurs.\nIt seems you are using a jikes. I will now try to reproduce the fault using the\nIBM runtime.", "count": 6, "id": 44211, "time": "2003-09-15T16:46:24Z", "creator": "jkf@apache.org", "creation_time": "2003-09-15T16:46:24Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 23150, "attachment_id": null, "id": 44218, "time": "2003-09-15T18:58:07Z", "creator": "jkf@apache.org", "creation_time": "2003-09-15T18:58:07Z", "is_private": false, "text": "While the Execute class claims that the Exit Value is set to 1 in case the\nprocess is killed, it actually isn't. Especially when killed by the watchdog via\ndestroy the exit value may on certain java versions be set to 0 indicating\nnormal successful termination. \n\nThe IBM JRE 1.4.1 on linux is known to show this behaviour. A patch is included\nto set the exit value to 1 in case the watchdog kills the process as already\ndocumented in getExitValue method of the Execute class. The exit value is also\nset to one if the process is killed due to an InterruptedException.\n\n\n"}, {"attachment_id": 8236, "tags": [], "bug_id": 23150, "text": "Created attachment 8236\nMakes execute set the exit value to 1 in case of kill as documented.", "count": 8, "id": 44219, "time": "2003-09-15T18:59:39Z", "creator": "jkf@apache.org", "creation_time": "2003-09-15T18:59:39Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 23150, "attachment_id": null, "id": 44260, "time": "2003-09-17T08:36:43Z", "creator": "bodewig@apache.org", "creation_time": "2003-09-17T08:36:43Z", "is_private": false, "text": "should be fixed with nightly build 2003-09-18.\n\nI've taken a different approach than you Martijn, Ant will now explicitly mark\ntimed out tests as errors.\n\nYour approach makes Execute#getExitCode match its documentation, but I think\nwe should better change the Javadocs instead.  There always is the additional\nExecute#killedProcess and unconditionally returning 1 for a kille process would\nmake such a process look perfectly good on OpenVMS (where 1 means success - like\nany other odd exit code)."}]
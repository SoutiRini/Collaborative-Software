[{"count": 0, "tags": [], "bug_id": 51028, "attachment_id": 26860, "id": 145575, "time": "2011-04-06T05:13:52Z", "creator": "1983-01-06@gmx.net", "creation_time": "2011-04-06T05:13:52Z", "is_private": false, "text": "Created attachment 26860\nBuild failure logfile\n\nI am not able to build Tomcat with \"ant release\" because the XSL stylesheets fail with saxon. They contain illegal chars.\n\nIf I remove Saxon from Ant's classpath the work again. So there something with the stylesheets and Saxon.\nI have found this post from Michael Kay which says that the stylesheets are invalid and have to be fixed: http://web.archiveorange.com/archive/v/rNJIEC48MBLYfxAORgpH\nA logfile is attached too."}, {"count": 1, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "Which version of Tomcat7 ?\n\nI've had a look at the file in SVN and the current XSL code does not match what you are reporting.\n\nWhat does the $Id line near the top of the XSL file say? \nIt should start like this:\n\n<!-- $Id: tomcat-docs.xsl", "id": 145577, "time": "2011-04-06T07:00:33Z", "bug_id": 51028, "creation_time": "2011-04-06T07:00:33Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 51028, "attachment_id": null, "text": "Reduce severity since, assuming this issue is valid, there is a simple workaround (remove Saxon from Ant's classpath).", "id": 145579, "time": "2011-04-06T07:07:07Z", "creator": "markt@apache.org", "creation_time": "2011-04-06T07:07:07Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 51028, "attachment_id": null, "id": 145586, "time": "2011-04-06T09:11:14Z", "creator": "1983-01-06@gmx.net", "creation_time": "2011-04-06T09:11:14Z", "is_private": false, "text": "(In reply to comment #1)\n> Which version of Tomcat7 ?\n> \n> I've had a look at the file in SVN and the current XSL code does not match what\n> you are reporting.\n> \n> What does the $Id line near the top of the XSL file say? \n> It should start like this:\n> \n> <!-- $Id: tomcat-docs.xsl\n\nSVN revision is 1089355\n$Id$ of file is <!-- $Id: tomcat-docs.xsl 1036949 2010-11-19 17:18:04Z markt $ -->"}, {"count": 4, "tags": [], "bug_id": 51028, "attachment_id": null, "id": 145587, "time": "2011-04-06T09:12:04Z", "creator": "1983-01-06@gmx.net", "creation_time": "2011-04-06T09:12:04Z", "is_private": false, "text": "(In reply to comment #2)\n> Reduce severity since, assuming this issue is valid, there is a simple\n> workaround (remove Saxon from Ant's classpath).\n\nThis cannot be done unless you have root priviliges on the System to modify the global installation. Eventhough if I had, the removal would affect others."}, {"text": "(In reply to comment #1)\n> Which version of Tomcat7 ?\n> \n> I've had a look at the file in SVN and the current XSL code does not match what\n> you are reporting.\n> \n> What does the $Id line near the top of the XSL file say? \n> It should start like this:\n> \n> <!-- $Id: tomcat-docs.xsl\n\nI am building from trunk.", "tags": [], "creator": "1983-01-06@gmx.net", "is_private": false, "count": 5, "id": 145588, "time": "2011-04-06T09:15:55Z", "bug_id": 51028, "creation_time": "2011-04-06T09:15:55Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "sebb@apache.org", "attachment_id": null, "text": "The relevant part of the log file says:\n\n     [xslt] Processing E:\\Projekte\\tomcat-trunk\\webapps\\docs\\changelog.xml to E:\\Projekte\\tomcat-trunk\\output\\build\\webapps\\docs\\changelog.html\n     [xslt] E:\\Projekte\\tomcat-trunk\\webapps\\docs\\tomcat-docs.xsl:470: Fatal Error! Illegal HTML character: decimal 150\n\nLine 470 of tomcat-docs.xsl is\n\n  <xsl:template match=\"changelog/fix\">\n    <tr>\n      <xsl:variable name=\"src\"><xsl:value-of select=\"$relative-path\"/>/images/fix.gif</xsl:variable>\n      <td><img alt=\"fix\" class=\"icon\" src=\"{$src}\"/></td>\n      <td><xsl:apply-templates/></td> <!-- 470 -->\n    </tr>\n  </xsl:template>\n\nThe character 150 is clearly not present in the XSL file.\nThe Saxon error message is somewhat misleading, as the invalid character seems to be in changelog.xml at line 1488:\n\n        <bug>49428</bug>: Re-implement the fix for bug <bug>49428</bug> &#150;\n\nPerhaps you can try temporarily editting that out, and see if that makes Saxon happy.", "id": 145591, "time": "2011-04-06T09:27:47Z", "bug_id": 51028, "creation_time": "2011-04-06T09:27:47Z", "is_private": false}, {"count": 7, "tags": [], "text": "(In reply to comment #6)\n> The relevant part of the log file says:\n> \n>      [xslt] Processing E:\\Projekte\\tomcat-trunk\\webapps\\docs\\changelog.xml to\n> E:\\Projekte\\tomcat-trunk\\output\\build\\webapps\\docs\\changelog.html\n>      [xslt] E:\\Projekte\\tomcat-trunk\\webapps\\docs\\tomcat-docs.xsl:470: Fatal\n> Error! Illegal HTML character: decimal 150\n> \n> Line 470 of tomcat-docs.xsl is\n> \n>   <xsl:template match=\"changelog/fix\">\n>     <tr>\n>       <xsl:variable name=\"src\"><xsl:value-of\n> select=\"$relative-path\"/>/images/fix.gif</xsl:variable>\n>       <td><img alt=\"fix\" class=\"icon\" src=\"{$src}\"/></td>\n>       <td><xsl:apply-templates/></td> <!-- 470 -->\n>     </tr>\n>   </xsl:template>\n> \n> The character 150 is clearly not present in the XSL file.\n> The Saxon error message is somewhat misleading, as the invalid character seems\n> to be in changelog.xml at line 1488:\n> \n>         <bug>49428</bug>: Re-implement the fix for bug <bug>49428</bug> &#150;\n> \n> Perhaps you can try temporarily editting that out, and see if that makes Saxon\n> happy.\n\nSebb,\n\nI removed the suspicious ref and it worked. I started digging and realized that the document is really broken. In contrast to the built-in Xalan Saxon is not lenient and strictly follows the specs.\nThe change was made by Konstantin, he doesn't seem to be encoding-savvy. If you check the changelog.xml's encoding, you'll see UTF-8 is set in the XML prolog. The entity ref '&#150;' (0x96, char 'en dash') (http://en.wikipedia.org/wiki/Dash#Common_dashes) does only exist in Windows 1252 (http://en.wikipedia.org/wiki/Windows-1252#Codepage_layout) but translated to Unicode, this is a contol char which is forbidden in XML.\nTo make this work, you have to reference a valid Unicode char. In this case it would be '&#8211;' (U+2013) see http://www.utf8-zeichentabelle.de/unicode-utf8-table.pl?start=8192\n\nI changed that and 'ant release' ran perfectly. I guess this is a really simple fix in SVN and the build should work on both XSLT processors.", "is_private": false, "id": 145593, "creator": "1983-01-06@gmx.net", "time": "2011-04-06T09:57:27Z", "bug_id": 51028, "creation_time": "2011-04-06T09:57:27Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 51028, "attachment_id": null, "id": 145594, "time": "2011-04-06T10:38:28Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2011-04-06T10:38:28Z", "is_private": false, "text": "So, the bug is not in the XSLT sheet, but in the data that it was processing.\nFixed with r1089469"}]
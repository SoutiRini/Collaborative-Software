[{"count": 0, "tags": [], "text": "Created attachment 21988\nzip contains excel file which crashes when tries to edit and save it and screenshot to show error\n\nWe are creating excel sheet using HSSF work book.\n\nWhen we tried to edit and save we are getting an error popup saying this microsoft excel has encountered a problem and needs to close.Generated Excel sheet has only 2 rows in the the sheet.we are using Microsoft Excel 2003 version.we are facing this problem with both poi3.0.1 and poi3.0.2 versions.i have attached the zip which contains the excel sheet and also screenshot which shows the error condition.", "attachment_id": 21988, "id": 116898, "creation_time": "2008-05-22T05:10:49Z", "time": "2008-05-22T05:10:49Z", "creator": "jagannadham.nangunoori@cognizant.com", "bug_id": 45061, "is_private": false}, {"count": 1, "tags": [], "bug_id": 45061, "attachment_id": null, "id": 116921, "time": "2008-05-23T01:06:21Z", "creator": "josh@apache.org", "creation_time": "2008-05-23T01:06:21Z", "is_private": false, "text": "I am having trouble reproducing this error.  I have Excel 2007.  The version may be important.\n\nThe attached file opens in excel OK for me.  I can directly save it in Excel. I can manually edit it in Excel and save it OK.  With POI, I read the file and re-wrote it back, then did all those manual operations again in Excel.  I did this with POI versions 3.0, 3.0.2 and svn trunk.  No errors occurred.\n\n\nYou need to be more clear about:\n - What exact action in excel causes the error. (does the error occur when opening the spreadsheet, when saving immediately, or saving after making a manual change)\n - Is the attached spreadsheet input to or output from POI?\n - How was the attached spreadsheet was produced? If it was by POI, please attach the exact source code that produced it."}, {"count": 2, "tags": [], "creator": "jagannadham.nangunoori@cognizant.com", "attachment_id": 22002, "text": "Created attachment 22002\nThe attached zip has two java files which are self explanatory", "id": 116967, "time": "2008-05-26T04:13:12Z", "bug_id": 45061, "creation_time": "2008-05-26T04:13:12Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 45061, "attachment_id": null, "id": 116968, "time": "2008-05-26T04:19:08Z", "creator": "jagannadham.nangunoori@cognizant.com", "creation_time": "2008-05-26T04:19:08Z", "is_private": false, "text": "(In reply to comment #2)\n> Created an attachment (id=22002) [details]\n> The attached zip has two java files which are self explanatory\n\n(In reply to comment #1)\n> I am having trouble reproducing this error.  I have Excel 2007.  The version\n> may be important.\n> The attached file opens in excel OK for me.  I can directly save it in Excel. I\n> can manually edit it in Excel and save it OK.  With POI, I read the file and\n> re-wrote it back, then did all those manual operations again in Excel.  I did\n> this with POI versions 3.0, 3.0.2 and svn trunk.  No errors occurred.\n> You need to be more clear about:\n>  - What exact action in excel causes the error. (does the error occur when\n> opening the spreadsheet, when saving immediately, or saving after making a\n> manual change)\n>  - Is the attached spreadsheet input to or output from POI?\n>  - How was the attached spreadsheet was produced? If it was by POI, please\n> attach the exact source code that produced it.\n\nSorry for the clarity on the issue. Here are the exact details as requested.\n\n1) The exact version is excel 2003\n2) The attached spread sheet is the output of POI.\n3) The spread sheet is generated using the POI (3.0.1 and 3.0.2) (The problem persists with both the versions. The POI zip attached herewith has the source code.\n4) The problem occurs when the spread sheet generated using the POI is either saved with or without editing"}, {"count": 4, "tags": [], "bug_id": 45061, "attachment_id": null, "id": 117177, "time": "2008-05-30T05:32:44Z", "creator": "jagannadham.nangunoori@cognizant.com", "creation_time": "2008-05-30T05:32:44Z", "is_private": false, "text": "Could you ple(In reply to comment #3)\n> (In reply to comment #2)\n> > Created an attachment (id=22002) [details] [details]\n> > The attached zip has two java files which are self explanatory\n> (In reply to comment #1)\n> > I am having trouble reproducing this error.  I have Excel 2007.  The version\n> > may be important.\n> > The attached file opens in excel OK for me.  I can directly save it in Excel. I\n> > can manually edit it in Excel and save it OK.  With POI, I read the file and\n> > re-wrote it back, then did all those manual operations again in Excel.  I did\n> > this with POI versions 3.0, 3.0.2 and svn trunk.  No errors occurred.\n> > You need to be more clear about:\n> >  - What exact action in excel causes the error. (does the error occur when\n> > opening the spreadsheet, when saving immediately, or saving after making a\n> > manual change)\n> >  - Is the attached spreadsheet input to or output from POI?\n> >  - How was the attached spreadsheet was produced? If it was by POI, please\n> > attach the exact source code that produced it.\n> Sorry for the clarity on the issue. Here are the exact details as requested.\n> 1) The exact version is excel 2003\n> 2) The attached spread sheet is the output of POI.\n> 3) The spread sheet is generated using the POI (3.0.1 and 3.0.2) (The problem\n> persists with both the versions. The POI zip attached herewith has the source\n> code.\n> 4) The problem occurs when the spread sheet generated using the POI is either\n> saved with or without editing\n\nDo you have any update on this issue. Thanks in advance for your help."}, {"count": 5, "tags": [], "creator": "josh@apache.org", "attachment_id": null, "text": "Thanks for the clarification.  So the steps to reproduce are: generate with POI, open in Excel, save.\n\nI ran the attached code against 3.0.2 and svn trunk(3.1-beta2+). No change in observations.  BTW the attached code had 2 compiler errors for which I guessed a fix.  I hope that this did not affect the problem.\n\nThere doesn't seem to be anything unusual in your code.  It looks like very normal usage of POI.  Without being able to reproduce the bug, there is not much I can do besides blame it on differences in Excel versions.  Perhaps someone else with Excel 2003 could try this code out.\n\nOn your side, you could help by cutting down the example code to the simplest/smallest version that will reproduce the bug for you.  Re-attach that code (without compiler errors, please).  Also specify which of the remaining lines of code you have observed to be critical (i.e. can't be removed) for creating the problem. \n", "id": 117180, "time": "2008-05-30T09:21:08Z", "bug_id": 45061, "creation_time": "2008-05-30T09:21:08Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 45061, "text": "Created attachment 22050\ncode that generates a xls sheet using POI\n\nCode that generates a xls sheet using POI (3.0.1 or 3.0.2)", "id": 117230, "time": "2008-06-02T00:34:30Z", "creator": "jagannadham.nangunoori@cognizant.com", "creation_time": "2008-06-02T00:34:30Z", "is_private": false, "attachment_id": 22050}, {"count": 7, "tags": [], "text": "(In reply to comment #5)\n> Thanks for the clarification.  So the steps to reproduce are: generate with\n> POI, open in Excel, save.\n> I ran the attached code against 3.0.2 and svn trunk(3.1-beta2+). No change in\n> observations.  BTW the attached code had 2 compiler errors for which I guessed\n> a fix.  I hope that this did not affect the problem.\n> There doesn't seem to be anything unusual in your code.  It looks like very\n> normal usage of POI.  Without being able to reproduce the bug, there is not\n> much I can do besides blame it on differences in Excel versions.  Perhaps\n> someone else with Excel 2003 could try this code out.\n> On your side, you could help by cutting down the example code to the\n> simplest/smallest version that will reproduce the bug for you.  Re-attach that\n> code (without compiler errors, please).  Also specify which of the remaining\n> lines of code you have observed to be critical (i.e. can't be removed) for\n> creating the problem. \n\nPlease find attached the one single java file which generates the xls sheet using the POI. Execute the attached java file by including the poi.jar in the classpath and open the xls sheet (generated in the same directory from where the java program is executed) using the excel 2003. Open it and save it. You would get the error. The reported problem does not persist if excel 2007 is used instead.\nThe attached code does not have any compilation errors now.\nCould you please confirm this problem with excel 2003 using POI (3.0.1 or 3.0.2) and a probable solution as we are not intending for upgrading to excel 2007", "attachment_id": null, "id": 117231, "creator": "jagannadham.nangunoori@cognizant.com", "time": "2008-06-02T00:35:20Z", "bug_id": 45061, "creation_time": "2008-06-02T00:35:20Z", "is_private": false}, {"count": 8, "tags": [], "creator": "josh@apache.org", "attachment_id": null, "text": "(In reply to comment #7)\nThanks for the new sample code.  That's way simpler.  No change on my side (Excel 2007 open+save OK).  Someone with Excel 2003 might need to look at this one.\n\n\nYou haven't mentioned which lines of this new code are critical to re-creating the bug.  It will be useful to know which line/lines (when removed) make the bug go away.\n", "id": 117232, "time": "2008-06-02T00:47:23Z", "bug_id": 45061, "creation_time": "2008-06-02T00:47:23Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 45061, "text": "(In reply to comment #8)\n> (In reply to comment #7)\n> Thanks for the new sample code.  That's way simpler.  No change on my side\n> (Excel 2007 open+save OK).  Someone with Excel 2003 might need to look at this\n> one.\n> You haven't mentioned which lines of this new code are critical to re-creating\n> the bug.  It will be useful to know which line/lines (when removed) make the\n> bug go away.\n\nThanks for your quick response. We are not sure as to which lines are critical. The whole idea is to generate a xls sheet using the POI api. When the so generated xls sheet is opened using 2003, the problem occurs.The java file attached is very small as such. Could you please help us in identifying the problem in the code as you are now aware as to what the problem is.", "id": 117235, "time": "2008-06-02T01:57:20Z", "creator": "jagannadham.nangunoori@cognizant.com", "creation_time": "2008-06-02T01:57:20Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 45061, "text": "(In reply to comment #9)\n> ... as you are now aware as to what the problem is.\nI'm sorry if I gave the impression that I know what the problem is.  To be clear, the problem has not been reproduced yet, and until someone else does, the only lead we have is *your* observation of the failure.  \n\n> ... We are not sure as to which lines are critical. ...\nThis sounds ominous.  What steps did you take to reduce the first example java code you supplied (attachment id=22002) down to this latest (attachment id=22050)?  To determine critical lines, all you have to do is pick a line at random and remove it.  It the same problem occurs, the line was not critical for this bug.  If the problem goes away, the line was critical.  For example, this line:\n\t\tstr.applyFont(HSSFFont.BOLDWEIGHT_BOLD);\nWhat happens if you remove it.  Does the bug still occur.\n\n\n", "id": 117252, "time": "2008-06-02T08:49:56Z", "creator": "josh@apache.org", "creation_time": "2008-06-02T08:49:56Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 45061, "text": "(In reply to comment #10)\n> (In reply to comment #9)\n> > ... as you are now aware as to what the problem is.\n> I'm sorry if I gave the impression that I know what the problem is.  To be\n> clear, the problem has not been reproduced yet, and until someone else does,\n> the only lead we have is *your* observation of the failure.  \n> > ... We are not sure as to which lines are critical. ...\n> This sounds ominous.  What steps did you take to reduce the first example java\n> code you supplied (attachment id=22002) down to this latest (attachment\n> id=22050)?  To determine critical lines, all you have to do is pick a line at\n> random and remove it.  It the same problem occurs, the line was not critical\n> for this bug.  If the problem goes away, the line was critical.  For example,\n> this line:\n>                 str.applyFont(HSSFFont.BOLDWEIGHT_BOLD);\n> What happens if you remove it.  Does the bug still occur.\n\nHi\n\nThanks for your qucik response. When we remove the line as mentioned in your comment above, the problem does not persist. But what is the alternate way of making the font bold. We need to make it bold. \nWith the above line bolding does not work even with excel 2007.\n\nPlease clarify.", "id": 117279, "time": "2008-06-03T00:30:55Z", "creator": "jagannadham.nangunoori@cognizant.com", "creation_time": "2008-06-03T00:30:55Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "creator": "apache@gagravarr.org", "attachment_id": 22082, "text": "Created attachment 22082\nOutput of JobEmail from svn trunk, and repaired file\n\nHave tried with svn trunk and excel 2003\n\nExcel still crashes for me having made a small edit. Attached is the file output by poi, and the edited version as repaired by excel", "id": 117387, "time": "2008-06-05T08:25:30Z", "bug_id": 45061, "creation_time": "2008-06-05T08:25:30Z", "is_private": false}, {"count": 13, "tags": [], "bug_id": 45061, "attachment_id": null, "id": 117418, "time": "2008-06-05T15:59:26Z", "creator": "josh@apache.org", "creation_time": "2008-06-05T15:59:26Z", "is_private": false, "text": "(In reply to comment #12)\n> Have tried with svn trunk and excel 2003...\n\n\nI noticed a small difference while investigating with BiffViewer.  The dbcells values in the INDEX records were being set wrong.  I opened a separate bugzilla (bug 45145) for this because it seems unrelated to the str.applyFont() call that is critical to this bug.  Bug 45145 was fixed in svn r663765.  I'm guessing that did not fix this bug, but someone with 2003 will have to confirm.\n\n\nThere are many diffs I see in the BiffViewer output between the file written with and without the str.applyFont() call.  Perhaps too many to consider individually.\n\nIt would be helpful to simplify the sample code even more (or find other critical lines).  For example if the call to createUserRow() is skipped, does the bug still occur?  What happens if the titlesArray has fewer elements?  What about the line: \"dataCell.setCellType(HSSFCell.CELL_TYPE_STRING);\" ?\n\n"}, {"count": 14, "tags": [], "bug_id": 45061, "attachment_id": null, "id": 117426, "time": "2008-06-06T02:44:11Z", "creator": "apache@gagravarr.org", "creation_time": "2008-06-06T02:44:11Z", "is_private": false, "text": "I can confirm that with r663765, the problem still remains - the text in A1 is not bold, and attempting to change the file and save crashes excel 2003\n\nIf I comment out lines 31-37 (userRow and dataCell), the problem remains. Text in A1 is not bold, and change+save crashes excel 2003\n\nCommenting out\n  titleCell.setCellType(HSSFCell.CELL_TYPE_STRING);\nmakes no difference either\n\nIf I change titlesArray to be \"JobJobJobJob\", there is no change. If I change it to be just \"J\", still no change"}, {"count": 15, "tags": [], "creator": "awm@mbcli.com", "attachment_id": null, "text": "Tried with 3.7 (release) and Excel 2010, resaved as .xls (binary) - no issues.", "id": 142911, "time": "2010-12-22T07:51:06Z", "bug_id": 45061, "creation_time": "2010-12-22T07:51:06Z", "is_private": false}]
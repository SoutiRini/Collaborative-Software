[{"count": 0, "tags": [], "text": "Hi,\nI wrote an JdbcInterceptor that flag connection as discarded in case of Exception that makes the connection unusable.\nThe problem is:\nwhen I call close on the connection, it is not returned to the pool and it is still considered as an active connection in the pool.\nThe cause of the problem is those pieces of code in ProxyConnection:\n\nif (compare(CLOSE_VAL,method)) {\n            if (isClosed()) return null; //noop for already closed.\n            PooledConnection poolc = this.connection;\n            this.connection = null;\n            pool.returnConnection(poolc);\n            return null;\n        }\n\n\nand\n\npublic boolean isClosed() {\n        return connection==null || connection.isDiscarded();\n    }", "attachment_id": null, "bug_id": 51786, "id": 149105, "time": "2011-09-08T11:50:52Z", "creator": "julien@vaudour.net", "creation_time": "2011-09-08T11:50:52Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 51786, "attachment_id": null, "text": "Thanks for report.\nThis is  fixed in r1170479 and r1170485 and  will be in 7.0.22 onwards.", "id": 149205, "time": "2011-09-14T09:30:45Z", "creator": "kfujino@apache.org", "creation_time": "2011-09-14T09:30:45Z", "is_private": false}]
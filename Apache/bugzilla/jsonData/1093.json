[{"count": 0, "tags": [], "bug_id": 1093, "text": "The Jasper runs into a race condition at compilation of JSPs. The modifications \nin the supplied file fix this.\n\nJspServlet.java:\n\nprotected boolean doLoadJSP(String jspUri, String classpath, \n boolean isErrorPage, HttpServletRequest req, HttpServletResponse res) \n throws JasperException, FileNotFoundException \n{\n\tJspServletWrapper jsw = null;\n        synchronized (this) {\n\t    jsw = (JspServletWrapper) jsps.get(jspUri);\n        }\n\tif( jsw==null ) {\n\t    throw new JasperException(\"Can't happen - JspServletWrapper=null\");\n\t}\n\t//\tClass jspClass = (Class) loadedJSPs.get(jspUri);\n\tboolean firstTime = jsw.servletClass == null;\n        JspCompilationContext ctxt = new JspEngineContext(loader, classpath,\n                                                     context, jspUri, \n                                                     isErrorPage, options,\n                                                     req, res);\n\tboolean outDated = false; \n\n        Compiler compiler = null;\n\n        try {\n                synchronized (jsw) {\n                    compiler = ctxt.createCompiler();\n                    outDated = compiler.compile();\n\t\t}\n        } catch (FileNotFoundException ex) {\n            throw ex;\n        } catch (JasperException ex) {\n            throw ex;\n        } catch (Exception ex) {\n\t    throw new JasperException(Constants.getString\n(\"jsp.error.unable.compile\"), ex);\n\t}\n\n\t// Reload only if it's outdated\n\tif((jsw.servletClass == null) || outDated) {\n\t    try {\n\t\tif( null ==ctxt.getServletClassName() ) {\n                    synchronized (jsw) {\n\t\t        compiler.computeServletClassName();\n                    }\n\t\t}\n\t\tjsw.servletClass = loader.loadClass(ctxt.getFullClassName());\n                        //loadClass(ctxt.getFullClassName(), true);\n\t    } catch (ClassNotFoundException cex) {\n\t\tthrow new JasperException(Constants.getString\n(\"jsp.error.unable.load\"), \n\t\t\t\t\t  cex);\n\t    }\n\t    \n\t    //\t    loadedJSPs.put(jspUri, jspClass);\n\t}\n\t\n\treturn outDated;\n    }", "id": 1572, "time": "2001-03-23T06:39:29Z", "creator": "sven@diedrichsen.com", "creation_time": "2001-03-23T06:39:29Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "marc.saegesser@apropos.com", "attachment_id": null, "text": "This is fixed in Tomcat 3.2.2.  Please try the just release Tomcat 3.2.2 beta \nrelease to make sure the problem has been resolved for you.", "id": 1584, "time": "2001-03-23T16:08:18Z", "bug_id": 1093, "creation_time": "2001-03-23T16:08:18Z", "is_private": false}]
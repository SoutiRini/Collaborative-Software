[{"count": 0, "attachment_id": null, "bug_id": 15390, "text": "There is bug in implementation of regexp factory\n(org.apache.tools.ant.util.regexp.RegexpMatcherFactory and Regexp factory). It\nis incorrect to do a Class.forName for classes which are part of the Ant\ndistribution and expect it to throw every possible linkage error. JLS ss. 12.3 says:\n\n\"For example, an implementation may choose to resolve each symbolic reference in\na class or interface individually, only when it is used (lazy or late\nresolution), or to resolve them all at once while the class is being verified\n(static resolution). This means that the resolution process may continue, in\nsome implementations, after a class or interface has been initialized.\"\n\nIf the runtime system is \"lazy\" the factory will always succeed on the first\nclass (Jdk14RegexpRegexp) although the actual JDK1.4 classes are not present.\nThis is what we are experiencing in NetBeans because we by default start the IDE\nwith \"-J-Xverify:none\" (turn off class verification) to achieve faster startup.\n\nPlease consider the attached patch which fixes this problem. It is trivial, it\ntests for presence of concrete regexp classes. Thank you.", "id": 27867, "time": "2002-12-16T11:30:59Z", "creator": "david.konecny@volny.cz", "creation_time": "2002-12-16T11:30:59Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 15390, "attachment_id": 4178, "id": 27868, "creation_time": "2002-12-16T11:33:12Z", "time": "2002-12-16T11:33:12Z", "creator": "david.konecny@volny.cz", "text": "Created attachment 4178\npatch for the problem", "is_private": false}, {"count": 2, "tags": [], "bug_id": 15390, "attachment_id": null, "text": "FYI:\n\nhttp://www.netbeans.org/issues/show_bug.cgi?id=29245\n\nis the corresponding bug report against NetBeans, I think.", "id": 27872, "time": "2002-12-16T13:00:29Z", "creator": "jesse.glick@netbeans.com", "creation_time": "2002-12-16T13:00:29Z", "is_private": false}, {"count": 3, "tags": [], "creator": "bodewig@apache.org", "attachment_id": null, "id": 28908, "time": "2003-01-06T13:58:11Z", "bug_id": 15390, "creation_time": "2003-01-06T13:58:11Z", "is_private": false, "text": "Fixed in both branches, which means it is supposed to be fixed in nightly builds\nstarting with 2003-01-06 and in Ant 1.6 (and 1.5.2 if we decide to release it).\n\nJesse, I think you are correct (of course 8-).\n\nDefining a property named ant.regexp.regexpimpl and setting its value to\norg.apache.tools.ant.util.regexp.JakartaOroRegexp should work (or\norg.apache.tools.ant.util.regexp.JakartaRegexpRegexp if you want regexp instead of\nORO, but why would anybody)."}, {"count": 4, "attachment_id": null, "creator": "david.konecny@volny.cz", "text": "Stefan, thank you. I wanted to test it, but the fix is not in nightly build\n\"/builds/jakarta-ant/nightly/2003-01-06\". I will try it later this week.\n\nOne question about \"ant.regexp.regexpimpl\" property. If I set it as System\nProperty then it works. But it does not work as Ant Property. The factory is\nalways created (I found factory creation only in one place:\norg.apache.tools.ant.types.RegularExpression) by RegexpFactory.newRegexp() what\nmeans that project is null and that only System.getProperty is called and never\nthe project.getProperty. Is this bug? Or am I missing something?", "id": 28936, "time": "2003-01-07T10:54:12Z", "bug_id": 15390, "creation_time": "2003-01-07T10:54:12Z", "tags": [], "is_private": false}, {"count": 5, "tags": [], "bug_id": 15390, "attachment_id": null, "text": "I've been too late for the -06 run, will be in the -07 nightly.\n\nYou seem to be right that the Project argument versions of the newInstance methods\nare not used (I haven't grepped extensively, but it seems to be that way).  Looks\nlike premature optimization to me (factory is also created in\noata.util.RegularExpressionMapper).\n\nReopening to remind myself to look into it, changing the summary at the same time.\n", "id": 28939, "time": "2003-01-07T12:59:05Z", "creator": "bodewig@apache.org", "creation_time": "2003-01-07T12:59:05Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 15390, "text": "I tested original problem and it works fine in nightly/2003-01-07.", "id": 29001, "time": "2003-01-08T09:47:08Z", "creator": "david.konecny@volny.cz", "creation_time": "2003-01-08T09:47:08Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "creator": "r_shammi@yahoo.com", "text": "I have developed a custom Task that uses IBM RegExp package. I have added the \nclasspath to the RegEx.jar explicily in the target using classpath tag. But \nstill I keep getting NoClassDefFoundError for com.ibm.regex.REUtil, I have \ntried all the combinations of classpath tag given in the documentation.\nEg:\n<taskdef name=\"DoStuff\" classname=\"tasks.Searcher\" \nclasspath=\"C:/ANTI/regex.jar\"/>\n\nNOTE: This works fine, when the RegEx.jar is in my system classpath variable.\n\nany quick fix solutions??", "id": 39361, "time": "2003-06-24T18:47:40Z", "bug_id": 15390, "creation_time": "2003-06-24T18:47:40Z", "is_private": false, "attachment_id": null}, {"count": 8, "attachment_id": null, "bug_id": 15390, "text": "rshammi, your report is completely unrelated.\n\nI assume your tasks.Searcher class lives in the system classpath (or ANT_HOME/lib).\nThis is covered extensively in http://ant.apache.org/faq.html#delegating-classloader", "id": 44680, "time": "2003-09-25T14:12:42Z", "creator": "bodewig@apache.org", "creation_time": "2003-09-25T14:12:42Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "bug_id": 15390, "text": "ant.regexp.regexpimpl still only works if it is a system property", "id": 48074, "attachment_id": null, "creator": "bodewig@apache.org", "creation_time": "2003-11-25T09:31:58Z", "time": "2003-11-25T09:31:58Z", "is_private": false}, {"count": 10, "tags": [], "creator": "antoine@apache.org", "text": "fixed in CVS HEAD. Do we need it in 1.6 ?", "id": 48361, "time": "2003-12-01T22:06:48Z", "bug_id": 15390, "creation_time": "2003-12-01T22:06:48Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 15390, "text": "Stefan, why do you say it was broken again? I don't see anything in CVS in\neither RegexpFactory.java or RegexpMatcherFactory.java that would indicate a\nregression since the original fix. Nor (Antoine) do I see anything that would\nindicate that something was fixed in the HEAD but not in 1.6. So AFAICT this is\nstill FIXED in 1.5.3 (or 1.5.2?) and later, as it was marked before Stefan's\nchanges of 2003-11-25.\n\nFYI: the NetBeans integration no longer really cares about this bug since NB (in\nthe trunk) now requires JDK 1.4+ anyway, in which case the first test for\njava.util.regex.Matcher will always work.", "id": 48740, "time": "2003-12-09T16:30:20Z", "creator": "jglick@apache.org", "creation_time": "2003-12-09T16:30:20Z", "is_private": false, "attachment_id": null}, {"count": 12, "tags": [], "bug_id": 15390, "attachment_id": null, "id": 48742, "creation_time": "2003-12-09T16:45:15Z", "time": "2003-12-09T16:45:15Z", "creator": "bodewig@apache.org", "text": "Jesse, see that the Summary of this bug has changed.\n\nThe original bug reported by David has been fixed and remains fixed.\n\nWhile we fixed the bug, we discovered a flaw in the system (ant.regexp.regexpimpl\nmust be system property, it doesn't work when defined inside the build file). This\nproblem remained until Antoine fixed it in HEAD.\n\nIf your NB users prefer ORO over JDK 1.4 regexp (and there are very good reasons\nto do so), this would still be a problem for you.", "is_private": false}, {"count": 13, "tags": [], "creator": "jglick@apache.org", "text": "1. Forgive my confusion; I would have expected a separate bug to be opened to\nreflect the new problem.\n\n2. Now I see Antoine's patch (thanks to cvsps):\nsrc/main/org/apache/tools/ant/types/RegularExpression.java:1.15->1.16\n\n3. Yes, the (new) bug would indeed still affect users of NetBeans as much as\nanyone else. To switch regexp impls you would have to set a command-line switch,\nI guess.", "id": 48746, "time": "2003-12-09T17:06:18Z", "bug_id": 15390, "creation_time": "2003-12-09T17:06:18Z", "is_private": false, "attachment_id": null}]
[{"count": 0, "tags": [], "bug_id": 3577, "attachment_id": null, "text": "When DecodeInterceptor guesses the wrong charset (e.g guesses iso-latin-1 when \nit is really utf-8) you get the following:\n\njava.lang.NullPointerException\n\tat java.util.Hashtable.containsKey(Hashtable.java:299)\n\tat org.apache.tomcat.util.http.Parameters.addParam(Parameters.java:321)\n\tat org.apache.tomcat.util.http.Parameters.processParameters\n(Parameters.java:395)\n\tat org.apache.tomcat.core.Request.handlePostParameters(Request.java:436)\n\tat org.apache.tomcat.facade.HttpServletRequestFacade.getParameter\n(HttpServletRequestFacade.java:255)\n\tat BadServlet.doPost(BadServlet.java:14)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java)\n\tat org.apache.tomcat.facade.ServletHandler.doService\n(ServletHandler.java:500)\n\tat org.apache.tomcat.core.Handler.invoke(Handler.java:322)\n\tat org.apache.tomcat.core.Handler.service(Handler.java:235)\n\tat org.apache.tomcat.facade.ServletHandler.service\n(ServletHandler.java:448)\n\tat org.apache.tomcat.core.ContextManager.internalService\n(ContextManager.java:914)\n\tat org.apache.tomcat.core.ContextManager.service\n(ContextManager.java:831)\n\tat org.apache.tomcat.modules.server.Ajp13Interceptor.processConnection\n(Ajp13Interceptor.java:167)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:477)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:517)\n\tat java.lang.Thread.run(Thread.java:484)", "id": 5440, "time": "2001-09-12T14:43:24Z", "creator": "william.barker@wilshire.com", "creation_time": "2001-09-12T14:43:24Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 3577, "attachment_id": 531, "text": "Created attachment 531\nExample servlet", "id": 5441, "time": "2001-09-12T14:45:18Z", "creator": "william.barker@wilshire.com", "creation_time": "2001-09-12T14:45:18Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 3577, "attachment_id": null, "text": "I forgot to include instructions:\n1) point your browser to http://myserver/servlet/BadServlet\n2) Enter some non-iso-latin-1 characters in the box and submit\nSo far, so good. Now hit the browser \"back\" button.  The browser will show you \nthe cached page.\n3) Hit the submit button again.\nDecodeInterceptor will think that the charset is iso-latin-1 (since the browser \ndoesn't send it one), but the browser is sending utf-8.", "id": 5442, "time": "2001-09-12T15:06:34Z", "creator": "william.barker@wilshire.com", "creation_time": "2001-09-12T15:06:34Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 3577, "attachment_id": null, "id": 5490, "time": "2001-09-13T15:30:47Z", "creator": "cmanolache@yahoo.com", "creation_time": "2001-09-13T15:30:47Z", "is_private": false, "text": "Very strange bug. The NPE is easy to solve ( I'll check in tonight ), however\nswitching the encoding in a session with bad browser is not something I know how\nto solve... We do our best to remember/guess the encoding in a session, and\nthat's quite difficult - but there's a limit on how much we can guess. The bug\nis of course in the browser  that doesn't send the encoding in the first place.\nIf you have any sugestion on how to improve the guessing alghoritm to deal with\nthis case - please reopen this ( as an enhancement request - for post 3.3 ).\nI'll mark it as fixed ( the NPE ), the second part would be a WONTFIX or LATER (\nrather the first, as I don't know any solution and I don't want to mess with the\ncurrent guessing ). Thanks for the report."}]
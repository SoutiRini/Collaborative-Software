[{"text": "Created attachment 28121\nTestprogram\n\nHi,\n\nim facing a problem to add comments in a cloned sheet.\n\nAdding comments to a new created sheet is no problem, but if I want to add comments to a cloned sheet a get the following NullPointerException.\n\nException in thread \"main\" java.lang.NullPointerException\n\tat org.apache.poi.xssf.usermodel.XSSFDrawing.createCellComment(XSSFDrawing.java:294)\n\tat org.apache.poi.xssf.usermodel.XSSFDrawing.createCellComment(XSSFDrawing.java:50)\n\tat src.CloneBug.addComments(CloneBug.java:50)\n\tat src.CloneBug.main(CloneBug.java:32)\n\nThe command:\nXSSFVMLDrawing vml = sheet.getVMLDrawing(true);\nin line 293 is returning a null-Object.\n\nFurthermore this Exception is occuring only after the second comment. The first comment is not running into this exception. But after opening the document after adding the first comment, the comment is not there. Cell-Value is set but not comment is present.\n\nFile to reproduce the exception is attached.", "tags": [], "creator": "stefan.helfert@googlemail.com", "attachment_id": 28121, "count": 0, "id": 152581, "time": "2012-01-05T09:01:15Z", "bug_id": 52425, "creation_time": "2012-01-05T09:01:15Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 52425, "text": "Please attach the xlsx-file mentioned in the Bug.", "id": 169696, "time": "2013-08-25T18:23:49Z", "creator": "dominik.stadler@gmx.at", "creation_time": "2013-08-25T18:23:49Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 52425, "attachment_id": null, "text": "Same error in the same condition.\nThe first comment creates the VMLDrawing.\nThe second failed to load the right VMLDrawing.\n\nLooking at the code, the drawing is null because the search did not ends, because of the (second) break in line 420. The search ends as soon as the first VMLDrawing is not the right one.\n\nfor(POIXMLDocumentPart p : getRelations()){\n    if(p instanceof XSSFVMLDrawing) {\n        XSSFVMLDrawing dr = (XSSFVMLDrawing)p;\n        String drId = dr.getPackageRelationship().getId();\n        if(drId.equals(ctDrawing.getId())){\n            drawing = dr;\n            break;\n        }\n        break; // line 420\n    }\n}\nif(drawing == null){\n    logger.log(POILogger.ERROR, \"Can't find VML drawing with id=\" + ctDrawing.getId() + \" in the list of the sheet's relationships\");\n}", "id": 169809, "time": "2013-08-29T17:01:41Z", "creator": "thibaud.raison@gmail.com", "creation_time": "2013-08-29T17:01:41Z", "is_private": false}, {"count": 3, "tags": [], "text": "Can you share your sample document so we can put a reproducer test in place together with a fix?", "is_private": false, "id": 169812, "creator": "dominik.stadler@gmx.at", "time": "2013-08-29T18:19:15Z", "bug_id": 52425, "creation_time": "2013-08-29T18:19:15Z", "attachment_id": null}, {"text": "No response for a long time on this one and I could not reproduce this with another sample file. Therefore I am resolfing this for now, please reopen this bug with the required information if you are still affected by it with recent releases of POI, e.g. 3.12-beta1.", "tags": [], "creator": "dominik.stadler@gmx.at", "is_private": false, "count": 4, "id": 181880, "time": "2015-03-18T19:18:37Z", "bug_id": 52425, "creation_time": "2015-03-18T19:18:37Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 52425, "attachment_id": 34151, "id": 193115, "time": "2016-08-15T07:28:24Z", "creator": "misc.daniel@stucki.me", "creation_time": "2016-08-15T07:28:24Z", "is_private": false, "text": "Created attachment 34151\nTestfile\n\nTestfile which can be used with the previous posted Testprogram."}, {"count": 6, "tags": [], "text": "Issue still exists, tested on version 3.14 --> reopening bug", "is_private": false, "id": 193116, "creator": "misc.daniel@stucki.me", "time": "2016-08-15T07:32:22Z", "bug_id": 52425, "creation_time": "2016-08-15T07:32:22Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Created attachment 34158\nPatch\n\nPatch with testcase", "is_private": false, "id": 193152, "creator": "misc.daniel@stucki.me", "time": "2016-08-17T11:32:12Z", "bug_id": 52425, "creation_time": "2016-08-17T11:32:12Z", "attachment_id": 34158}, {"count": 8, "tags": [], "bug_id": 52425, "text": "Thanks for the patch! Applied in r1760221. Will likely be included in POI 3.15 final.", "id": 193629, "attachment_id": null, "creator": "onealj@apache.org", "creation_time": "2016-09-11T04:06:21Z", "time": "2016-09-11T04:06:21Z", "is_private": false}]
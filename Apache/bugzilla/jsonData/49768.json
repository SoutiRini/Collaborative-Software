[{"count": 0, "tags": [], "bug_id": 49768, "attachment_id": null, "text": "Hello ;\n\nWith Apache version 2.2.16 (under Debian Squeeze) I've problem with a Piped log script.\n\nExplanation:\n\nWhen run under Debian Lenny (Apache version 2.2.9), Apache spawn the log script directly. So, only one process appert when I run the 'px aux' command'.\n\nExample for the Piped Error log:\n\nroot      1253  0.0  0.2   5208  1364 pts/0    S+   18:16   0:00 /usr/bin/perl /var/www/ispcp/engine/ispcp-apache-logger -e\n\n\nBut under the latest Apache version (2.2.16), the script seem to be run over the '/bin/sh -c' command.\n\nroot      1550  0.0  0.0   1748   484 pts/0    S+   18:16   0:00 /bin/sh -c /var/www/ispcp/engine/ispcp-apache-logger -e\nroot      1551  0.0  0.2   5208  1364 pts/0    S+   18:16   0:00 /usr/bin/perl /var/www/ispcp/engine/ispcp-apache-logger\n\nI don't know why apache process like this now but this way is not good for me because now, I unable to trap any signal from my perl script.\n\nSome info about my configuration:\n\nMy relevant Apache configuration:\n\nLogFormat \"%v %h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\" %I %O\" ispcplog\n\nCustomLog \"| /var/www/ispcp/engine/ispcp-apache-logger\" ispcplog\nErrorLog \"| /var/www/ispcp/engine/ispcp-apache-logger -e\"\n\ndev:/home/nuxwin# uname -a\nLinux dev 2.6.26-2-686 #1 SMP Mon Jun 21 05:58:44 UTC 2010 i686 GNU/Linux\n\nroot@ispcp:~# apachectl -V\nServer version: Apache/2.2.16 (Debian)\nServer built:   Jul 24 2010 20:24:16\nServer's Module Magic Number: 20051115:24\nServer loaded:  APR 1.4.2, APR-Util 1.3.9\nCompiled using: APR 1.4.2, APR-Util 1.3.9\nArchitecture:   32-bit\nServer MPM:     Worker\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APACHE_MPM_DIR=\"server/mpm/worker\"\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=128\n -D HTTPD_ROOT=\"/etc/apache2\"\n -D SUEXEC_BIN=\"/usr/lib/apache2/suexec\"\n -D DEFAULT_PIDLOG=\"/var/run/apache2.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"mime.types\"\n -D SERVER_CONFIG_FILE=\"apache2.conf\"\nroot@ispcp:~# uname -a\nLinux ispcp 2.6.32-5-686 #1 SMP Sat Jul 24 02:27:10 UTC 2010 i686 GNU/Linux\n\nNote: Sorry for my poor English, I'm french.", "id": 139157, "time": "2010-08-17T13:30:00Z", "creator": "l.declercq@nuxwin.com", "creation_time": "2010-08-17T13:30:00Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 49768, "attachment_id": null, "id": 139159, "time": "2010-08-17T13:33:24Z", "creator": "l.declercq@nuxwin.com", "creation_time": "2010-08-17T13:33:24Z", "is_private": false, "text": "Update:\n\nTruly uname result for my squeeze:\n\nroot@ispcp:/etc/apache2/sites-available# uname -a\nLinux ispcp 2.6.32-5-686 #1 SMP Sat Jul 24 02:27:10 UTC 2010 i686 GNU/Linux"}, {"count": 2, "tags": [], "creator": "l.declercq@nuxwin.com", "attachment_id": null, "id": 139160, "time": "2010-08-17T13:50:38Z", "bug_id": 49768, "creation_time": "2010-08-17T13:50:38Z", "is_private": false, "text": "Fixed:\n\nLake of documentation.\n\nLenny have Apache 2.2.9 so no problem but Debian Squeeze has Apache 2.2.16 and since Apache 2.2.12 :\n\n\n  *) New piped log syntax: Use \"||process args\" to launch the given process\n     without invoking the shell/command interpreter.  Use \"|$command line\"\n     (the default behavior of \"|command line\" in 2.2) to invoke using shell,\n     consuming an additional shell process for the lifetime of the logging\n     pipe program but granting additional process invocation flexibility.\n     [William Rowe]\n\n\nInfo get from the Changelog. Please Update the documentation."}, {"count": 3, "tags": [], "bug_id": 49768, "attachment_id": null, "text": "Note that calling the piped logger using \"/bin/sh -c\" didn't change during the 2.2.x lifetime. But shells differ in what they actually do when using \"-c\". Some of them fork the final program and some exec. So depending on that the logger stays as a child of the shell, or the shell is immediately replaced with the piped logger as the immediate child of Apache.\n\nThe new syntax lets you choose to not involve the shell at all. Default is still using the shell! The incompatibility here is likely due to a changed shell behaviour on your platform.\n\nYou can test the shell behaviour on your old and new platforms without using Apache via calling\n\n/bin/sh -c \"sleep 60\" &\n\ndirectly in a shell, and then checking in the process list, whether you can see the shell *and* the sleep command, or only the sleep command.", "id": 139162, "time": "2010-08-17T14:19:25Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2010-08-17T14:19:25Z", "is_private": false}, {"text": "Re ;\n\nYou right on this issue:\n\nOn Lenny:\nnuxwin    4433  0.0  0.0   3016   504 pts/4    S    21:47   0:00 sleep 60\n\n# ls -la /bin/sh\nlrwxrwxrwx 1 root root 4 avr 28 10:27 /bin/sh -> bash\n\nOn Squeeze:\n\nroot      2421  0.3  0.0   1748   484 pts/1    S    21:45   0:00 /bin/sh -c sleep 60\nroot      2422  0.0  0.0   3420   496 pts/1    S    21:45   0:00 sleep 60\n\nOn squeeze:\n# ls -la /bin/sh\nlrwxrwxrwx 1 root root 4  9 ao\u00fbt  02:51 /bin/sh -> dash\n\nIt's the reason. It's just shell version issue.\n\nThank for your explaination here. You can close this ticket.", "tags": [], "bug_id": 49768, "is_private": false, "count": 4, "id": 139169, "time": "2010-08-17T15:50:17Z", "creator": "l.declercq@nuxwin.com", "creation_time": "2010-08-17T15:50:17Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 49768, "attachment_id": null, "id": 139339, "time": "2010-08-22T11:19:46Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2010-08-22T11:19:46Z", "is_private": false, "text": "*** Bug 49798 has been marked as a duplicate of this bug. ***"}]
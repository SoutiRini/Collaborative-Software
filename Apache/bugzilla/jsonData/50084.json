[{"count": 0, "tags": [], "creator": "roos@symentis.com", "text": "The pid handling fix in #49728 breaks PID handling again.\n\nThe fix now removes empty PID files before start.\nThis doesn't work on RHEL5/CentOS5 (and maybe others), where tomcat is started as non-root user.\n\nThe pid files on these OS's are in /var/run, which is only writeable by root.\nTherefore, the init.d script creates the pid file and sets the permissions accordinghly.\nThis is not working anymore, as catalina.sh tries to remove this empty file and skips filling the file as it cant remove it.", "id": 140708, "time": "2010-10-13T08:06:57Z", "bug_id": 50084, "creation_time": "2010-10-13T08:06:57Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 50084, "attachment_id": null, "is_private": false, "id": 140711, "time": "2010-10-13T08:42:26Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2010-10-13T08:42:26Z", "text": "What is your suggestion how to deal with it?\n\nI might think about truncating the stale PID file instead of deleting it.\n\n\nTo truncate a file one might redirect empty output to it, as shown in [1], using the \"colon\" (no-op) command:\n\n:>\"$CATALINA_PID\"\n\n[1] http://linuxdemon.blogspot.com/2007/06/how-to-truncate-file-in-unixlinux.html\n\nThe following also works:\ntrue>\"$CATALINA_PID\""}, {"count": 2, "attachment_id": null, "bug_id": 50084, "text": "In my opinion, thats not necessary.\n\nI will add a patch to this ticket with my workaround to the problem.\nBasically, when an empty pid file exists, its' just filled by catalina.sh", "id": 140712, "time": "2010-10-13T08:48:16Z", "creator": "roos@symentis.com", "creation_time": "2010-10-13T08:48:16Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "roos@symentis.com", "attachment_id": 26167, "id": 140713, "time": "2010-10-13T08:56:37Z", "bug_id": 50084, "creation_time": "2010-10-13T08:56:37Z", "is_private": false, "text": "Created attachment 26167\nPatch to fix existing, empty pid file handling\n\nNote: echo $! > \"$CATALINA_PID\" creates the file if not existent and fills existing files (overwrites existing content)"}, {"count": 4, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 140823, "time": "2010-10-19T10:55:58Z", "bug_id": 50084, "creation_time": "2010-10-19T10:55:58Z", "is_private": false, "text": "Thanks for the report and the suggested patch.\n\nI applied a different patch that retained the current behavior where the containing dir is writable but better handles (without error messages) the case where it is not.\n\nFixed for 7.0.x and will be included in 7.0.5 onwards.\n\nProposed for 6.0.x."}, {"count": 5, "tags": [], "bug_id": 50084, "is_private": false, "text": "*** Bug 50130 has been marked as a duplicate of this bug. ***", "id": 140897, "time": "2010-10-21T07:58:33Z", "creator": "markt@apache.org", "creation_time": "2010-10-21T07:58:33Z", "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 50084, "attachment_id": null, "is_private": false, "id": 141066, "time": "2010-10-26T12:15:36Z", "creator": "markt@apache.org", "creation_time": "2010-10-26T12:15:36Z", "text": "Fixed in trunk and will be in 6.0.30 onwards."}]
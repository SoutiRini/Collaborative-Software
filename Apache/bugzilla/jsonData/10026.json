[{"count": 0, "tags": [], "bug_id": 10026, "text": "When I stop or remove a struts application there is a lock on struts.jar and \nthe applications directory under webapps cannot be removed.  Cross posted under \nstruts.\n\nTo reproduce:\n  Get file 'struts-blank.war' from the struts 1.0 or 1.1Beta binary \ndistribution.\n  Put above file in webapps directory.\n  Start Tomcat\n  In browser type: 'http://localhost:8080/manager/stop?path=/struts-blank\n     Answer password prompt - see tomcat-users.xml in conf directory\n     Verify an 'OK' response.\n  Delete 'struts-blank' directory from webapps directory.\n  Delete fails because struts.jar is locked.", "id": 18100, "time": "2002-06-19T19:55:44Z", "creator": "rogernell@yahoo.com", "creation_time": "2002-06-19T19:55:44Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 10026, "text": "I can't reproduce this problem with Tomcat 4.1.18. Please let me know if you\nare still having problems with this.  If you are, could you please test with\nTomcat 4.1.18 to see if it still exists.", "id": 29101, "time": "2003-01-10T02:32:42Z", "creator": "glenn@apache.org", "creation_time": "2003-01-10T02:32:42Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "text": "Tomcat: 4.1.18/4.1.19\nJDK: 1.4.1\nSystem: W2K SP3\n\nI can reproduce this bug on 4.1.18 and 4.1.19 (also with other applications \nusing struts.jar), but it seems rather related to Struts itself since removal \nof any other webapps works fine for me.", "is_private": false, "id": 29528, "creator": "yannc76@yahoo.de", "time": "2003-01-16T12:54:42Z", "bug_id": 10026, "creation_time": "2003-01-16T12:54:42Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 10026, "text": "I will mark this bug as invalid for Tomcat then.  Please work with the\nstruts team to resolve it.  Thanks for checking.", "id": 29530, "time": "2003-01-16T13:21:51Z", "creator": "glenn@apache.org", "creation_time": "2003-01-16T13:21:51Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "yannc76@yahoo.de", "attachment_id": null, "text": "Sorry, apparently I got to reopen this, please read Craig's comments on #10027:\n\nhttp://nagoya.apache.org/bugzilla/show_bug.cgi?id=10027\n\nSeems this problem is related to Tomcat locking (at least some) JARs on WIN", "id": 29642, "time": "2003-01-18T12:19:38Z", "bug_id": 10026, "creation_time": "2003-01-18T12:19:38Z", "is_private": false}, {"count": 5, "tags": [], "text": "This also occurs with axis.jar.  Very frustrating!", "is_private": false, "id": 35022, "creator": "mark.volkmann@agedwards.com", "time": "2003-04-11T19:30:00Z", "bug_id": 10026, "creation_time": "2003-04-11T19:30:00Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "sys@yahoo.com", "attachment_id": null, "id": 38803, "time": "2003-06-13T18:14:42Z", "bug_id": 10026, "creation_time": "2003-06-13T18:14:42Z", "is_private": false, "text": "A similar bug was fixed in Log4J. While it's arguable whether it's a struts \nbug, tomcat bug, or a windows bug, I thought I'd post the details to see if \nanyone has ideas on how tomcat can fix this.\n\nThe bug (from what I understand) is that when dtd's are loaded from the jar \n(while running on windows), the jar is locked b/c the input stream for the dtd \nhas not be properly closed. In log4j, this is fixed by using a custom \nEntityResolver to load the dtd. (the resolver makes a copy of the dtd input \nstream in memory and return the copied stream after closing the real input \nstream)\n\nreferences to this can be found in the log4j code, but this url from the \nbarracuda project has a pretty good summary:\nhttp://barracuda.enhydra.org/software/cvs/cvsweb.cgi/Projects/EnhydraOrg/toolsT\nech/Barracuda/WEB-INF/lib/log4j-1.2.7a.jar?rev=1.1&content-type=text/x-cvsweb-\nmarkup\n\nthe files of interest in log4j are:\norg/apache/log4j/xml/Log4jEntityResolver.java\norg/apache/log4j/xml/DOMConfigurator.java\n\nis there some way for tomcat to always use a custom EntityResolver if the \nsystem is windows?\n\nSomething that may also be of interest:\nI've found that if I expand the jar and dump all the files into WEB-\nINF/classes, there are problems undeploy/removing the app"}, {"count": 7, "tags": [], "bug_id": 10026, "attachment_id": null, "id": 38804, "time": "2003-06-13T18:15:37Z", "creator": "sys@yahoo.com", "creation_time": "2003-06-13T18:15:37Z", "is_private": false, "text": "sorry, typo.\n\nthat should read:\n\nI've found that if I expand the jar and dump all the files into \nWEB-INF/classes, there are NO problems undeploy/removing the app"}, {"count": 8, "tags": [], "bug_id": 10026, "attachment_id": null, "id": 38809, "time": "2003-06-13T18:35:56Z", "creator": "remm@apache.org", "creation_time": "2003-06-13T18:35:56Z", "is_private": false, "text": "I have specifically investigated this problem during the past few days, and can\ndraw the same conclusions. There's unfortunately little or nothing that Tomcat\ncan do.\n\nHere's what happens:\n- XML paser uses get resource to load the DTD\n- Tomcat returns a jar:file: URL, as the DTD is inside a JAR\n- XML parser does read from that without setting setUseCaches(false), so this\ncauses the JAR to be locked until the VM is terminated\n\nTomcat cannot do anything about it, unless we add custom code in getResource to\nhandle non class resources (ex: we could extract the resource to teh work dir,\nand return a file URL to there). AFAIK, there's nothing which forbids that, so\nI'll experiment with doing that in TC 5."}, {"count": 9, "text": "*** Bug 8763 has been marked as a duplicate of this bug. ***", "bug_id": 10026, "is_private": false, "id": 38985, "time": "2003-06-17T22:31:40Z", "creator": "sys@yahoo.com", "creation_time": "2003-06-17T22:31:40Z", "tags": [], "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 10026, "text": "WORKSFORME for struts.jar in TC5.0.4 on WinXP (both stop and undeploy)", "id": 40759, "time": "2003-07-15T19:30:14Z", "creator": "yannc76@yahoo.de", "creation_time": "2003-07-15T19:30:14Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 10026, "text": "*** Bug 15484 has been marked as a duplicate of this bug. ***", "id": 73669, "time": "2005-04-14T23:13:13Z", "creator": "markt@apache.org", "creation_time": "2005-04-14T23:13:13Z", "is_private": false, "attachment_id": null}, {"count": 12, "attachment_id": null, "bug_id": 10026, "text": "I have ported the antiJARLocking functionality from TC5 and successfully tested\nit with antiJARLocking=\"true\" using a struts app (a copy of the Tomcat Admin app).\n\nThe fix will be included in 4.1.32 onwards. Note there is no date currently\nplanned for a 4.1.32 release.", "id": 80400, "time": "2005-09-23T22:08:40Z", "creator": "markt@apache.org", "creation_time": "2005-09-23T22:08:40Z", "tags": [], "is_private": false}]
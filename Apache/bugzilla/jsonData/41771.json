[{"count": 0, "tags": [], "creator": "sebastien.bilbeau@univ-rennes1.fr", "attachment_id": null, "id": 100077, "time": "2007-03-06T02:12:41Z", "bug_id": 41771, "creation_time": "2007-03-06T02:12:41Z", "is_private": false, "text": "I have some errors when I use mod_proxy_ajp or mod_prox_balancer under solicited\nserver.\n\nI have this problem under apache 2.2.3 too."}, {"count": 1, "tags": [], "bug_id": 41771, "attachment_id": null, "id": 100078, "creation_time": "2007-03-06T02:13:33Z", "time": "2007-03-06T02:13:33Z", "creator": "sebastien.bilbeau@univ-rennes1.fr", "text": "My virtualhost configuration :\n------------------------------\n<VirtualHost ***.***.116:443>\n   ServerName ***website***\n   VirtualDocumentRoot /data/webapps/***website***\n   # Options repartition de charge logiciel\n   ProxyPass /balancer-manager !\n   ProxyPass / balancer://mycluster/ stickysession=JSESSIONID\n   <Proxy balancer://mycluster>\n     BalancerMember ajp://server.*******:9514 min=0 max=200 smax=100 ttl=10\nroute=**** loadfactor=25\n     BalancerMember ajp://server.*******:9514 min=0 max=200 smax=100 ttl=10\nroute=**** loadfactor=25\n     BalancerMember ajp://server.*******:9514 min=0 max=200 smax=100 ttl=10\nroute=**** loadfactor=50\n   </Proxy>\n   # Options pour le https\n   SSLEngine on\n   SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP\n   SSLCertificateFile           /etc/certificats/***website***.crt\n   SSLCertificateKeyFile        /etc/certificats/***website***.key\n   SSLCertificateChainFile      /etc/certificats/chainage.txt\n   SetEnvIf User-Agent \".*MSIE.*\" nokeepalive ssl-unclean-shutdown downgrade-1.0\nforce-response-1.0\n   CustomLog logs/ssl_request_log \"%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \\\"%r\\\" %b\"\n   # Ajout car sinon ne loggue pas ce virtualhost\n   CustomLog logs/access_log comonvhost\n   ErrorLog  logs/error_log\n</VirtualHost>", "is_private": false}, {"count": 2, "tags": [], "text": "Created attachment 19670\nextra/httpd-mpm.conf configuration", "attachment_id": 19670, "bug_id": 41771, "id": 100079, "time": "2007-03-06T02:15:07Z", "creator": "sebastien.bilbeau@univ-rennes1.fr", "creation_time": "2007-03-06T02:15:07Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 41771, "attachment_id": 19671, "text": "Created attachment 19671\nError_log extract", "id": 100080, "time": "2007-03-06T02:16:29Z", "creator": "sebastien.bilbeau@univ-rennes1.fr", "creation_time": "2007-03-06T02:16:29Z", "is_private": false}, {"count": 4, "tags": [], "creator": "sebastien.bilbeau@univ-rennes1.fr", "attachment_id": null, "is_private": false, "id": 100081, "time": "2007-03-06T02:23:33Z", "bug_id": 41771, "creation_time": "2007-03-06T02:23:33Z", "text": "I think the socket does not get closed properly."}, {"count": 5, "tags": [], "text": "When I have errors, if I launch netstat command, the result is :\n\n[root@**** httpd_80]$ netstat -tn | egrep \"^tcp.*:9514\" | tr -s \" \" | cut -f6 -d\n\" \" | sort | uniq -c\n     30 CLOSE_WAIT\n    177 ESTABLISHED\n      1 FIN_WAIT2\n[root@**** httpd_80]$ netstat -tn | egrep \"^tcp.*:9514\" | tr -s \" \" | cut -f6 -d\n\" \" | sort | uniq -c\n     30 CLOSE_WAIT\n    174 ESTABLISHED\n      1 FIN_WAIT2\n[root@**** httpd_80]$ netstat -tn | egrep \"^tcp.*:9514\" | tr -s \" \" | cut -f6 -d\n\" \" | sort | uniq -c\n     30 CLOSE_WAIT\n    176 ESTABLISHED\n      1 TIME_WAIT", "is_private": false, "bug_id": 41771, "id": 100082, "time": "2007-03-06T02:30:32Z", "creator": "sebastien.bilbeau@univ-rennes1.fr", "creation_time": "2007-03-06T02:30:32Z", "attachment_id": null}, {"count": 6, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "id": 100100, "time": "2007-03-06T13:07:52Z", "bug_id": 41771, "creation_time": "2007-03-06T13:07:52Z", "is_private": false, "text": "Thanks for your detailed analysis. Although this is not obvious from the error\nmessages they simply state that the client has closed the connection before all\ndata from the backend has been transfered to the client (usually because someone\npressed the stop button in the browser). So no need to worry about this.\nRegarding the connections in CLOSE_WAIT state: Is any of the balancer members\nrunning on the same box as your webserver?"}, {"count": 7, "tags": [], "text": "Thanks for your answer, Ruediger. As you ask, there is one balancer member\nrunning on the same box as the webserver.", "is_private": false, "bug_id": 41771, "id": 100115, "time": "2007-03-07T00:28:09Z", "creator": "sebastien.bilbeau@univ-rennes1.fr", "creation_time": "2007-03-07T00:28:09Z", "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 41771, "attachment_id": null, "id": 100164, "creation_time": "2007-03-07T12:20:17Z", "time": "2007-03-07T12:20:17Z", "creator": "rpluem@apache.org", "text": "(In reply to comment #7)\n> Thanks for your answer, Ruediger. As you ask, there is one balancer member\n> running on the same box as the webserver.\n\nSo I currently assume that the sockets in CLOSE_WAIT state belong to the\nbalancer member on your box. If httpd is not able to sent the full contents to\nthe client it closes the connection to the backend to\n\n1. Avoid any hickups with stuck content when reusing this connection.\n2. To give the backend a chance to discover that the content requested will not\n   be consumed and thus possible expensive operations to generate the remaining\n   part of the content can be stopped.\n\nSo I assume that the application in your balancer has not closed its part of the\nsocket after httpd has closed its side of the socket. Can you please cross check?", "is_private": false}, {"count": 9, "tags": [], "text": "How do you sugest me to cross check ?", "attachment_id": null, "bug_id": 41771, "id": 100294, "time": "2007-03-12T02:10:25Z", "creator": "sebastien.bilbeau@univ-rennes1.fr", "creation_time": "2007-03-12T02:10:25Z", "is_private": false}, {"count": 10, "tags": [], "text": "netstat -apn executed as root should be your friend. It shows which process owns\nthe respective socket.", "is_private": false, "bug_id": 41771, "id": 100325, "time": "2007-03-12T14:53:28Z", "creator": "rpluem@apache.org", "creation_time": "2007-03-12T14:53:28Z", "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 41771, "is_private": false, "id": 100336, "attachment_id": 19701, "creator": "sebastien.bilbeau@univ-rennes1.fr", "creation_time": "2007-03-13T02:29:24Z", "time": "2007-03-13T02:29:24Z", "text": "Created attachment 19701\nResult of netstat command\n\nResult of this command :\nnetstat -apn > /tmp/toto && netstat -tn | egrep \"^tcp.*:9514\" | tr -s \" \" | cut\n-f6 -d \" \" | sort | uniq -c >> /tmp/toto"}, {"count": 12, "tags": [], "text": "Ok, as the sockets being in CLOSE_WAIT state belong to httpd processes, my\ntheory seems to be wrong :-).\nAnother approach: I do not know the application server to which you connect via\najp. Possibly it has a timeout for these ajp connections and closes them after a\ncertain idle period or it closes them for any other reason. The socket will\nremain in CLOSE_WAIT status on httpd side until the connection is chosen again\nfrom the connection pool by the specific worker. httpd will notice that the\nconnection has been closed by the other end, will close its end of the\nconnection and create a new socket for a new connection.", "is_private": false, "bug_id": 41771, "id": 100350, "time": "2007-03-13T13:52:44Z", "creator": "rpluem@apache.org", "creation_time": "2007-03-13T13:52:44Z", "attachment_id": null}, {"count": 13, "tags": [], "creator": "carnold@apache.org", "is_private": false, "id": 106994, "attachment_id": null, "bug_id": 41771, "creation_time": "2007-08-21T15:30:41Z", "time": "2007-08-21T15:30:41Z", "text": "Somehow got assigned as a log4j bug."}]
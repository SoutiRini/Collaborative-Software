[{"text": "I'm trying to port a web app to tomcat 5.0.2 beta release.\nThis web application works fine on 4.1.18 and 4.0.2.\n\nThe problem comes from filter initilization, stack trace attached below.\nThis web app uses log4j.jar, and the filters has logging calls. One special\nthing about this web app is that it is depolyed under a directory outside \n'webapps' and does have 'allowingLinking' flag in context 'Resouces' \ndefinition. \n\nSeems it's complaining about log4j not found during filter initialization.\nThis is so weird for the following reasons:\n \n1. sample filters under jsp-exmaples and servlet-examples work fine.\n2. I didn't see log4.jar either under tomcat 4.1.18 or 4.0.2\n3. If I put a copy of log4j.jar under CATALIAN_HOME/server/lib, all error\nmessages are gone, but the context is not available (I didn't see it admin) \nscreen), and the displayed error msg when accessing index.jsp is:\n\norg.apache.jasper.JasperException: Mandatory TLD element missing or empty: jsp-\nversion\n\tat org.apache.jasper.compiler.DefaultErrorHandler.jspError\n(DefaultErrorHandler.java:94)\n\tat org.apache.jasper.compiler.ErrorDispatcher.dispatch\n(ErrorDispatcher.java:365)\n\nThe catalina.out for filter initialization:\nMay 22, 2003 6:33:32 PM org.apache.catalina.core.StandardContext filterStart\n\nSEVERE: Exception starting filter Form Filter\njava.lang.ExceptionInInitializerError\n        at org.apache.catalina.core.StandardContext.filterStart\n(StandardContext.java:3559)\n        at org.apache.catalina.core.StandardContext.start\n(StandardContext.java:4112)\n        at org.apache.catalina.core.ContainerBase.addChildInternal\n(ContainerBase.java:843)\n        at org.apache.catalina.core.ContainerBase.addChild\n(ContainerBase.java:827)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:623)\n        at org.apache.catalina.core.StandardHostDeployer.addChild\n(StandardHostDeployer.java:794)        at \nsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)        at java.lang.reflect.Method.invoke\n(Method.java:324)\n        at org.apache.commons.beanutils.MethodUtils.invokeMethod\n(MethodUtils.java:252)\n        at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:256)\n        at org.apache.commons.digester.Rule.end(Rule.java:276)\n        at org.apache.commons.digester.Digester.endElement(Digester.java:1058)\n        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1536)\n        at org.apache.crimson.parser.Parser2.parseInternal(Parser2.java:500)\n        at org.apache.crimson.parser.Parser2.parse(Parser2.java:305)\n        at org.apache.crimson.parser.XMLReaderImpl.parse(XMLReaderImpl.java:442)\n        at org.apache.commons.digester.Digester.parse(Digester.java:1567)\n        at org.apache.catalina.core.StandardHostDeployer.install\n(StandardHostDeployer.java:488)\n\nt org.apache.catalina.core.StandardHost.install(StandardHost.java:868)\n        at org.apache.catalina.startup.HostConfig.deployDescriptors\n(HostConfig.java:511)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:468)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:835)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:429)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1241)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:804)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1233)\n        at org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:532)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:2314)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:576)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)        at java.lang.reflect.Method.invoke\n(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\n\n\nCaused by: org.apache.commons.logging.LogConfigurationException: \norg.apache.commons.logging.LogConfigurationException: No suitable Log \nconstructor [Ljava.lang.Class;@1e82b72 for \norg.apache.commons.logging.impl.Log4JLogger\n        at org.apache.commons.logging.impl.LogFactoryImpl.newInstance\n(LogFactoryImpl.java:532)\n        at org.apache.commons.logging.impl.LogFactoryImpl.getInstance\n(LogFactoryImpl.java:272)\n        at org.apache.commons.logging.impl.LogFactoryImpl.getInstance\n(LogFactoryImpl.java:246)\n        at org.apache.commons.logging.LogFactory.getLog(LogFactory.java:395)\n        at org.apache.catalina.core.ApplicationFilterConfig.<clinit>\n(ApplicationFilterConfig.java:95)\n        ... 39 more\n\n\nCaused by: org.apache.commons.logging.LogConfigurationException: No suitable \nLog constructor [Ljava.lang.Class;@1e82b72 for \norg.apache.commons.logging.impl.Log4JLogger\n        at org.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor\n(LogFactoryImpl.java:432)\n        at org.apache.commons.logging.impl.LogFactoryImpl.newInstance\n(LogFactoryImpl.java:525)\n        ... 43 more\nCaused by: java.lang.NoClassDefFoundError: org/apache/log4j/Logger\n        at java.lang.Class.getDeclaredConstructors0(Native Method)\n        at java.lang.Class.privateGetDeclaredConstructors(Class.java:1590)\n        at java.lang.Class.getConstructor0(Class.java:1762)\n        at java.lang.Class.getConstructor(Class.java:1002)\n        at org.apache.commons.logging.impl.LogFactoryImpl.getLogConstructor\n(LogFactoryImpl.java:429)\n        ... 44 more\n\n\nMay 22, 2003 6:33:32 PM org.apache.catalina.core.StandardContext filterStart\n\nSEVERE: Exception starting filter Master Filter\njava.lang.NoClassDefFoundError\n        at org.apache.catalina.core.StandardContext.filterStart\n(StandardContext.java:3559)\n        at org.apache.catalina.core.StandardContext.start\n(StandardContext.java:4112)\n        at org.apache.catalina.core.ContainerBase.addChildInternal\n(ContainerBase.java:843)\n        at org.apache.catalina.core.ContainerBase.addChild\n(ContainerBase.java:827)\n        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:623)\n        at org.apache.catalina.core.StandardHostDeployer.addChild\n(StandardHostDeployer.java:794)        at \nsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)        at java.lang.reflect.Method.invoke\n(Method.java:324)\n        at org.apache.commons.beanutils.MethodUtils.invokeMethod\n(MethodUtils.java:252)\n        at org.apache.commons.digester.SetNextRule.end(SetNextRule.java:256)\n        at org.apache.commons.digester.Rule.end(Rule.java:276)\n        at org.apache.commons.digester.Digester.endElement(Digester.java:1058)\n        at org.apache.crimson.parser.Parser2.maybeElement(Parser2.java:1536)\n        at org.apache.crimson.parser.Parser2.parseInternal(Parser2.java:500)\n        at org.apache.crimson.parser.Parser2.parse(Parser2.java:305)\n        at org.apache.crimson.parser.XMLReaderImpl.parse(XMLReaderImpl.java:442)\n        at org.apache.commons.digester.Digester.parse(Digester.java:1567)\n        at org.apache.catalina.core.StandardHostDeployer.install\n(StandardHostDeployer.java:488)\n        at org.apache.catalina.core.StandardHost.install(StandardHost.java:868)\n        at org.apache.catalina.startup.HostConfig.deployDescriptors\n(HostConfig.java:511)\n        at org.apache.catalina.startup.HostConfig.deployApps\n(HostConfig.java:468)\n        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:835)\n        at org.apache.catalina.startup.HostConfig.lifecycleEvent\n(HostConfig.java:429)\n        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent\n(LifecycleSupport.java:166)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1241)\n        at org.apache.catalina.core.StandardHost.start(StandardHost.java:804)\n        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1233)\n        at org.apache.catalina.core.StandardEngine.start\n(StandardEngine.java:532)\n        at org.apache.catalina.core.StandardService.start\n(StandardService.java:519)\n        at org.apache.catalina.core.StandardServer.start\n(StandardServer.java:2314)\n        at org.apache.catalina.startup.Catalina.start(Catalina.java:576)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke\n(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke\n(DelegatingMethodAccessorImpl.java:25)        at java.lang.reflect.Method.invoke\n(Method.java:324)\n        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:297)\n        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:394)\nMay 22, 2003 6:33:32 PM org.apache.catalina.core.StandardContext filterStart", "tags": [], "creator": "xliu@capitalthinking.com", "attachment_id": null, "count": 0, "id": 37648, "time": "2003-05-22T23:05:33Z", "bug_id": 20171, "creation_time": "2003-05-22T23:05:33Z", "is_private": false}, {"count": 1, "tags": [], "text": "I'll have to ask for a test case here to investigate further.\n\nDeploying a webapp outside the Host appBase doesn't (shoudln't) make a\ndifference, and doesn't require allowLinking to work fine. You only need that\nflag if your webapp needs to access items which are symlinked to outside its\ndirectory.\n\nJARs which are put in server/lib are not visible to web applications (except\nprivileged webapps, which get to \"see\" the container classes). You need to put\nthem in common/lib or shared/lib.\n\nOne last note: Tomcat 5.0.2 is an alpha release.", "is_private": false, "id": 37655, "creator": "remm@apache.org", "time": "2003-05-23T07:50:10Z", "bug_id": 20171, "creation_time": "2003-05-23T07:50:10Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 20171, "text": "It turns out that the problem was in our application. In catalina.sh, we messed\nup classpath a little bit to include log4j.jar for developement, this makes\ncommons-logging to look for log4j even for catalina's internal logging calls\n(as I understand it). ", "id": 38270, "attachment_id": null, "creator": "xliu@capitalthinking.com", "creation_time": "2003-06-03T15:33:58Z", "time": "2003-06-03T15:33:58Z", "is_private": false}]
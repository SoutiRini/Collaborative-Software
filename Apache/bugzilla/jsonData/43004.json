[{"count": 0, "tags": [], "bug_id": 43004, "is_private": false, "text": "Included a simple build script that causes an OutOfMemory (OOM)\nwhen the JUnit test is run.\n\n1. if showoutput=\"false\", the OOM appears almost immediately\n2. if showoutput=\"true\", the messages are logged to the console but after a\nwhile the OOM also occurs\n\nIt seems that the messages written to stdout are cumulated somewhere, causing\nthe OOM.\n\nThe same problem also occurs when using ANT 1.7.0.", "id": 106095, "time": "2007-07-31T08:40:37Z", "creator": "Davy.Toch@belgacom.net", "creation_time": "2007-07-31T08:40:37Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 43004, "text": "Created attachment 20573\nANT script", "id": 106096, "time": "2007-07-31T08:41:41Z", "creator": "Davy.Toch@belgacom.net", "creation_time": "2007-07-31T08:41:41Z", "is_private": false, "attachment_id": 20573}, {"attachment_id": 20574, "tags": [], "creator": "Davy.Toch@belgacom.net", "text": "Created attachment 20574\nSimple JUnit testcase causing OOM", "count": 2, "id": 106097, "time": "2007-07-31T08:42:13Z", "bug_id": 43004, "creation_time": "2007-07-31T08:42:13Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 43004, "text": "If you get java.lang.OutOfMemoryError: Java heap space  in some of your tests\nthen you need to raise the heaps size like maxmemory=\"128m\".\n\nCan you try?", "id": 107685, "time": "2007-09-04T03:06:58Z", "creator": "thorsten@apache.org", "creation_time": "2007-09-04T03:06:58Z", "is_private": false, "attachment_id": null}, {"count": 4, "attachment_id": null, "creator": "Davy.Toch@belgacom.net", "text": "But the reason I opened this case was: is it normal that stdout messages are\ncumulated in memory when running the tests from ANT, since you would expect them\nto be written directly to stdout?\n\n(In reply to comment #3)\n> If you get java.lang.OutOfMemoryError: Java heap space  in some of your tests\n> then you need to raise the heaps size like maxmemory=\"128m\".\n> \n> Can you try?\n\n", "id": 107734, "time": "2007-09-05T01:20:22Z", "bug_id": 43004, "creation_time": "2007-09-05T01:20:22Z", "tags": [], "is_private": false}, {"count": 5, "attachment_id": null, "creator": "machisuji@googlemail.com", "text": "I agree that there shouldn't be an OutOfMemoryError.\nBut let's say it is a bug, how realistic is it that it ever occurs?\n\nDid you encounter it with \"normal\" tests\nor only with that example printing 200,000 lines \"all at once\"?", "id": 132191, "time": "2009-11-21T06:13:19Z", "bug_id": 43004, "creation_time": "2009-11-21T06:13:19Z", "tags": [], "is_private": false}, {"count": 6, "tags": [], "bug_id": 43004, "is_private": false, "text": "What additional information do we need for this issue? Is this a memory leak?\n\nWe're also seeing this with latest ant 1.9.4. Even setting max memory to 512m does not help.\n\nYes, it's a realistic issue. We encounter it in our testing environment. I think it's normal for stress tests that needs to do highly repeated work that contains a log statement.", "id": 176450, "time": "2014-07-17T08:21:38Z", "creator": "hotterd@gmail.com", "creation_time": "2014-07-17T08:21:38Z", "attachment_id": null}, {"count": 7, "tags": [], "text": "Ant's JUnit runner captures all output in order to pass it to the formatters after the test suite has completed.  This isn't anything that could be changed without breaking the TestFormatter API as far as I can tell.\n\nOne thing that might help is forking new VMs for the tests more often, i.e. don't run them in the same VM as Ant itself and don't use forkMode \"once\".  Try to spread your tests across multiple VMs.  But most likely the output of a single test is causing the OOM and there really isn't anything you can do apart from changing your code to allow the logging to be silenced during stress tests.", "is_private": false, "bug_id": 43004, "id": 178005, "time": "2014-09-21T11:22:42Z", "creator": "bodewig@apache.org", "creation_time": "2014-09-21T11:22:42Z", "attachment_id": null}]
[{"count": 0, "attachment_id": null, "creator": "petterb@gmail.com", "is_private": false, "id": 155006, "time": "2012-03-17T22:11:04Z", "bug_id": 52933, "creation_time": "2012-03-17T22:11:04Z", "tags": [], "text": "MPM: Event\nOS: Amazon Linux AMI release 2011.09 (CentOS)\nAPR: 1.4.6\nAPR-UTIL: 1.4.1\n\nOur system is 1 sandbox server, 2 test and 3 prod. It has occured once (one test server). 2.4.1 in use less than a week. Servers are clones. (Actually based on the server in mind.)\n\nChild finally killed with -5.\n\nPost compiled and installed mod_geoip2_1.2.7 + 4 of my own modules.\n\n$ sudo strace -ff -F -s200 -o /tmp/strace.out -p 27203\n$ sort /tmp/strace.out.272*\nepoll_wait(85, {}, 25, 100)             = 0\nepoll_wait(85, {}, 25, 100)             = 0\nepoll_wait(85, {}, 25, 100)             = 0\n...more of same\nfutex(0x17a65bc, FUTEX_WAIT_PRIVATE, 41, NULL) = -1 EAGAIN (Resource temporarily unavailable)\nfutex(0x17a65bc, FUTEX_WAIT_PRIVATE, 43, NULL) = -1 EAGAIN (Resource temporarily unavailable)\nfutex(0x17a65bc, FUTEX_WAIT_PRIVATE, 45, NULL) = -1 EAGAIN (Resource temporarily unavailable)\n...more of same\nfutex(0x17a65bc, FUTEX_WAIT_PRIVATE, 88, NULL\nfutex(0x17a65bc, FUTEX_WAIT_PRIVATE, 88, NULL\nfutex(0x17a65bc, FUTEX_WAIT_PRIVATE, 88, NULL\n...more of same\nfutex(0x7fa11bfe79d0, FUTEX_WAIT, 27284, NULL\ngettimeofday({1332018558, 639020}, NULL) = 0\ngettimeofday({1332018560, 550880}, NULL) = 0\ngettimeofday({1332018560, 550985}, NULL) = 0\n...more of same\n\n\n$ /usr/local/apache2/bin/apachectl -V\nServer version: Apache/2.4.1 (Unix)\nServer built:   Mar  9 2012 18:36:08\nServer's Module Magic Number: 20120211:0\nServer loaded:  APR 1.4.6, APR-UTIL 1.4.1\nCompiled using: APR 1.4.6, APR-UTIL 1.4.1\nArchitecture:   64-bit\nServer MPM:     event\n  threaded:     yes (fixed thread count)\n    forked:     yes (variable process count)\nServer compiled with....\n -D APR_HAS_SENDFILE\n -D APR_HAS_MMAP\n -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT\n -D APR_HAS_OTHER_CHILD\n -D AP_HAVE_RELIABLE_PIPED_LOGS\n -D DYNAMIC_MODULE_LIMIT=256\n -D HTTPD_ROOT=\"/usr/local/apache2\"\n -D SUEXEC_BIN=\"/usr/local/apache2/bin/suexec\"\n -D DEFAULT_PIDLOG=\"logs/httpd.pid\"\n -D DEFAULT_SCOREBOARD=\"logs/apache_runtime_status\"\n -D DEFAULT_ERRORLOG=\"logs/error_log\"\n -D AP_TYPES_CONFIG_FILE=\"conf/mime.types\"\n -D SERVER_CONFIG_FILE=\"conf/httpd.conf\"\n\n\n$ cat config.nice \n#! /bin/sh\n#\n# Created by configure\n\n\"./configure\" \\\n\"--enable-sed\" \\\n\"--enable-usertrack\" \\\n\"--enable-unique-id\" \\\n\"--enable-proxy\" \\\n\"--enable-unixd\" \\\n\"--enable-rewrite\" \\\n\"--with-mpm=event\" \\\n\"--with-included-apr\" \\\n\"--enable-deflate\" \\\n\"--enable-ssl\" \\\n\"--enable-log-debug\" \\\n\"--enable-log-forensic\" \\\n\"--enable-logio\" \\\n\"$@\""}, {"attachment_id": null, "tags": [], "bug_id": 52933, "text": "A stack trace would be much more useful than strace output. Use\n\n$ gdb -p <pid of looping process>\n\n(gdb) thread apply all bt full", "count": 1, "id": 155066, "time": "2012-03-19T20:00:21Z", "creator": "sf@sfritsch.de", "creation_time": "2012-03-19T20:00:21Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 52933, "is_private": false, "text": "I'll do that if it happens again.", "id": 155069, "time": "2012-03-19T20:07:40Z", "creator": "petterb@gmail.com", "creation_time": "2012-03-19T20:07:40Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "For completeness: If you had mod_dumpio and DumpIOInput enabled at the time of the problem, this is likely a duplicate of PR 52914.", "is_private": false, "bug_id": 52933, "id": 155071, "time": "2012-03-19T20:20:17Z", "creator": "sf@sfritsch.de", "creation_time": "2012-03-19T20:20:17Z", "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 52933, "attachment_id": null, "is_private": false, "id": 155072, "time": "2012-03-19T20:26:17Z", "creator": "petterb@gmail.com", "creation_time": "2012-03-19T20:26:17Z", "text": "I had not."}, {"count": 5, "tags": [], "text": "It happened again, here's three gdb screens:\n\n\nNo symbol table info available.\n#1  0x0000000000466ad5 in ap_queue_pop_something (queue=0x9ae530, sd=0x7f0336ffce78, ecs=0x7f0336ffce70, p=0x7f0336ffce68, te_out=0x7f0336ffce60) at fdqueue.c:438\n        elem = <value optimized out>\n        rv = <value optimized out>\n#2  0x00000000004644ad in worker_thread (thd=0x9af0a8, dummy=<value optimized out>) at event.c:1702\n        ti = <value optimized out>\n        process_slot = 0\n        thread_slot = 5\n        csd = 0x7f0338037600\n        cs = 0x7f0338037808\n        ptrans = 0x7f0338037578\n        rv = <value optimized out>\n        is_idle = 1\n        te = 0x0\n#3  0x00007f03451e27f1 in start_thread () from /lib64/libpthread.so.0\nNo symbol table info available.\n#4  0x00007f0344f1f92d in clone () from /lib64/libc.so.6\nNo symbol table info available.\n\nThread 21 (Thread 0x7f03367fc700 (LWP 4357)):\n#0  0x00007f03451e63dc in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0\nNo symbol table info available.\n#1  0x0000000000466ad5 in ap_queue_pop_something (queue=0x9ae530, sd=0x7f03367fbe78, ecs=0x7f03367fbe70, p=0x7f03367fbe68, te_out=0x7f03367fbe60) at fdqueue.c:438\n        elem = <value optimized out>\n        rv = <value optimized out>\n#2  0x00000000004644ad in worker_thread (thd=0x9af0d8, dummy=<value optimized out>) at event.c:1702\n        ti = <value optimized out>\n        process_slot = 0\n        thread_slot = 6\n        csd = 0x7f03380396d0\n        cs = 0x0\n        ptrans = 0x7f0338039658\n        rv = <value optimized out>\n        is_idle = 1\n        te = 0x0\n#3  0x00007f03451e27f1 in start_thread () from /lib64/libpthread.so.0\nNo symbol table info available.\n#4  0x00007f0344f1f92d in clone () from /lib64/libc.so.6\nNo symbol table info available.\n\nThread 20 (Thread 0x7f0335ffb700 (LWP 4358)):\n#0  0x00007f03451e63dc in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0\nNo symbol table info available.\n#1  0x0000000000466ad5 in ap_queue_pop_something (queue=0x9ae530, sd=0x7f0335ffae78, ecs=0x7f0335ffae70, p=0x7f0335ffae68, te_out=0x7f0335ffae60) at fdqueue.c:438\n        elem = <value optimized out>\n        rv = <value optimized out>\n#2  0x00000000004644ad in worker_thread (thd=0x9af108, dummy=<value optimized out>) at event.c:1702\n        ti = <value optimized out>\n        process_slot = 0\n        thread_slot = 7\n        csd = 0x7f0338037600\n        cs = 0x7f0338037808\n        ptrans = 0x7f0338037578\n        rv = <value optimized out>\n---Type <return> to continue, or q <return> to quit---\n\n        is_idle = 1\n        te = 0x0\n#3  0x00007f03451e27f1 in start_thread () from /lib64/libpthread.so.0\nNo symbol table info available.\n#4  0x00007f0344f1f92d in clone () from /lib64/libc.so.6\nNo symbol table info available.\n\nThread 19 (Thread 0x7f03357fa700 (LWP 4359)):\n#0  apr_file_write (thefile=0x7f031001af78, buf=<value optimized out>, nbytes=<value optimized out>) at file_io/unix/readwrite.c:176\n        pos = <value optimized out>\n        blocksize = 0\n        size = 68\n        rv = 0\n#1  0x00007f0340b37fb4 in savefiltermethod (f=0x7f0310006a58, bb=0x7f0310007eb8) at ufmodules/mod_savecontent.c:128\n        ctxt = 0x7f0310007ed8\n        bytes = 68\n        buff = 0x7f0310019002 \"<html xmlns=\\\"http://www.w3.org/1999/xhtml\\\" xml:lang=\\\"no\\\" lang=\\\"no\\\">\\n<head>\\n<title>Panelet Plug</title>\\n<meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=UTF-8\\\" /> \\n\\n<style type=\\\"text/css\\\">\\n \"...\n        b = 0x7f0310087a18\n        rv = <value optimized out>\n#2  0x00007f03433a7c8a in filter_harness (f=0x7f0310006a58, bb=0x7f0310007eb8) at mod_filter.c:313\n        ret = <value optimized out>\n        cachecontrol = <value optimized out>\n        str = <value optimized out>\n        ctx = 0x7f0310006af0\n        filter = <value optimized out>\n#3  0x00007f0340d3ad0a in substitute_filter (f=0x7f0310006a30, bb=0x7f0310007e10) at ufmodules/mod_ouf_substitute.c:566\n        bytes = 0\n        len = <value optimized out>\n        fbytes = 139651759166952\n        buff = 0x7f0310019046 \"<head>\\n<title>Panelet Plug</title>\\n<meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=UTF-8\\\" /> \\n\\n<style type=\\\"text/css\\\">\\n    \\n    body {\\n        \\n        font-family: Arial, Tahoma, Verdana;\"...\n        nl = <value optimized out>\n        bflat = 0x6b <Address 0x6b out of bounds>\n        b = <value optimized out>\n        tmp_b = <value optimized out>\n        tmp_bb = 0x0\n        rv = <value optimized out>\n        ctx = 0x7f0310007e30\n#4  0x00007f03433a7c8a in filter_harness (f=0x7f0310006a30, bb=0x7f0310007e10) at mod_filter.c:313\n        ret = <value optimized out>\n        cachecontrol = <value optimized out>\n        str = <value optimized out>\n        ctx = 0x7f0310006ad8\n        filter = <value optimized out>\n#5  0x00007f03431a4a0c in substitute_filter (f=0x7f0310006a08, bb=0x7f0310007d90) at mod_substitute.c:511\n        bytes = 0\n        len = <value optimized out>\n        fbytes = 139651130075384\n        buff = 0x7f03100199a0 \"        <div class=\\\"question\\\"><a href=\\\"http://politisk.tv2.no//spesial/panelet/sporsmaal/h\"\n        nl = <value optimized out>\n        bflat = 0x1fa0 <Address 0x1fa0 out of bounds>\n        b = <value optimized out>\n        tmp_b = <value optimized out>\n---Type <return> to continue, or q <return> to quit---\n\n        tmp_bb = 0x0\n        rv = <value optimized out>\n        ctx = 0x7f0310004898\n#6  0x00007f03433a7c8a in filter_harness (f=0x7f0310006a08, bb=0x7f0310007d90) at mod_filter.c:313\n        ret = <value optimized out>\n        cachecontrol = <value optimized out>\n        str = <value optimized out>\n        ctx = 0x7f0310006ac0\n        filter = <value optimized out>\n#7  0x00007f0340933115 in inflate_out_filter (f=0x7f03100069e0, bb=0x7f0310007630) at mod_deflate.c:1316\n        rv = <value optimized out>\n        data = 0x114630b \"\"\n        b = <value optimized out>\n        len = 1093\n        zlib_method = <value optimized out>\n        zlib_flags = <value optimized out>\n        e = 0x7f0310087b58\n        r = 0x7f031000aa50\n        ctx = 0x7f0310007ce0\n        zRC = <value optimized out>\n        rv = <value optimized out>\n        c = 0x98e478\n#8  0x00007f03433a7c8a in filter_harness (f=0x7f03100069e0, bb=0x7f0310007630) at mod_filter.c:313\n        ret = <value optimized out>\n        cachecontrol = <value optimized out>\n        str = <value optimized out>\n        ctx = 0x7f0310006aa8\n        filter = <value optimized out>\n#9  0x00007f0341d68599 in ap_proxy_http_process_response (p=0x7f031000a9d8, r=<value optimized out>, backend_ptr=0x7f03357f9b18, worker=0xa6c4f8, conf=0xa6c268, \n    server_portstr=0x7f03357f9af0 \"\") at mod_proxy_http.c:1973\n        readbytes = 1103\n        rv = <value optimized out>\n        mode = <value optimized out>\n        finish = 0\n        rc = <value optimized out>\n        c = 0x7f0338039950\n        buffer = \"\\000\\nntent-Encoding\\000 gzip\\000\\nser-Agent\\000\\n\\000\\n8\\000\\n\\000\\000\\000\\000!\\000\\000\\000\\000\\000\\000\\000\\001\\000\\000\\000!\", '\\000' <repeats 11 times>, \"\\001\\000\\000\\000,{\\177\\065\\003\\177\", '\\000' <repeats 14 times>, \"\\005\\000\\000\\000\\350\\220\\177\\065\\003\\177\\000\\000\\232\\020\\335\\361\\001\\000\\000\\000@\\204\\226;\\000\\000\\000\\000\\360\\220\\177\\065\\003\\177\\000\\000\u04c8\\177\\065\\003\\177\\000\\000\\350\\220\\177\\065\\003\\177\\000\\000\\f\\221\\177\\065\\003\\177\\000\\000\\060{\\177\\065\\003\\177\\000\\000${\\177\\065\\003\\177\\000\\000\\b\\221\\177\\065\\003\\177\\000\\000\\020{\\177\\065\\003\\177\\000\\000\\001\\000\\000\\000\\000\\b\\000\\000({\\177\\065\\003\\177\\000\\000 L`t\", '\\000' <repeats 12 times>\"\\370, z\\177\\065\\003\\177\"...\n        buf = <value optimized out>\n        keepchar = <value optimized out>\n        e = <value optimized out>\n        bb = 0x7f0310007630\n        tmp_bb = 0x7f0310007678\n        pass_bb = 0x7f0310007650\n        len = 15\n        backasswards = <value optimized out>\n        interim_response = 0\n        pread_len = <value optimized out>\n        save_table = <value optimized out>\n        backend_broke = 0\n        hop_by_hop_hdrs = {0x7f0341d6a716 \"Keep-Alive\", 0x7f0341d6a9c7 \"Proxy-Authenticate\", 0x7f0341d6a721 \"TE\", 0x7f0341d6a724 \"Trailer\", 0x7f0341d6a72c \"Upgrade\", 0x0}\n        i = <value optimized out>\n---Type <return> to continue, or q <return> to quit---", "is_private": false, "bug_id": 52933, "id": 155378, "time": "2012-03-29T19:09:12Z", "creator": "petterb@gmail.com", "creation_time": "2012-03-29T19:09:12Z", "attachment_id": null}]
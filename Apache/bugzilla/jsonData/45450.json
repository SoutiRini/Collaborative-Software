[{"count": 0, "tags": [], "creator": "mkevac@gmail.com", "is_private": false, "text": "As a result of bug 45407 ( https://issues.apache.org/bugzilla/show_bug.cgi?id=45407 ), new option 'reconnect' was introduced to MySQL dbd driver.\n\nThis option, when set to 0, allows us to avoid problem with prepared statements.\n\nIf reconnect is 1 (which was by default) and connection with MySQL server is broken, mysql_ping will reconnect, but all prepared statements will not work as a result.\n\nIf reconnect is 0, than mysql_ping will return error and reslist element will be invalidated. So next time new connection will be created and statements will be prepared one more time.\n\nI think that information about this issue should be in mod_dbd documentation.", "id": 118891, "time": "2008-07-22T00:11:56Z", "bug_id": 45450, "creation_time": "2008-07-22T00:11:56Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 45450, "attachment_id": null, "text": "Good point.  I've just committed to /trunk/.\n\nIt may be premature in 2.2, but you've highlighted what may be a more-serious documentation bug in 2.2.9 and 2.2-trunk.  Flagging this report as must-investigate.", "id": 118893, "time": "2008-07-22T01:33:59Z", "creator": "nick@webthing.com", "creation_time": "2008-07-22T01:33:59Z", "is_private": false}, {"count": 2, "tags": [], "creator": "rbowen@apache.org", "attachment_id": null, "id": 141188, "time": "2010-10-29T11:05:43Z", "bug_id": 45450, "creation_time": "2010-10-29T11:05:43Z", "is_private": false, "text": "Moving docs bugs to docs@httpd.a.o ownership."}, {"count": 3, "tags": [], "creator": "rbowen@apache.org", "attachment_id": null, "id": 155392, "time": "2012-03-30T12:02:38Z", "bug_id": 45450, "creation_time": "2012-03-30T12:02:38Z", "is_private": false, "text": "Pinging on this four-year-old issue.\n\nIs it sufficient to insert the paragraphs from the initial bug report to document this behavior? Is the behavior described still the case in 2.4?\n\nPlease let me know so that we can resolve this ticket. Thanks."}, {"count": 4, "tags": [], "creator": "humbedooh@apache.org", "is_private": false, "text": "From what I can read in apr_dbd_mysql.c in trunk, the reconnect value still defaults to 1, in which case it is still an issue. Perhaps this is something to be appended to the \"SQL Prepared Statements\" section?\n\nFrom what I can gather, Marko's initial comment is still valid:\nIf the MySQL reconnect option is set to 1 (default) and the connection is somehow severed, mysql_ping() will cause a reconnect WITHOUT informing mod_dbd of this ('cause that's just how MySQL likes to operate), and thus the prepared statements will be fubar since it's a brand new connection.\n\nIf reconnect is set to 0, then mod_dbd WILL be notified that the connection is broken and by itself reconnect and set up the statements.\n\nThe MYSQL documentation recommends using a chain of commands to check for any change caused by mysql_ping() - roughly something like:\n\nid1 = mysql_thread_id(conn);\nmyslq_ping(conn);\nid2 = mysql_thread_id(conn)\nif (id1 != id2) { borked(); }\n\nBut I'll leave that up to Niq or anyone else wanting to change the actual code to reflect this behavior properly. For now, a notice should probably be put in the mod_dbd docs :)", "id": 155432, "time": "2012-03-31T06:53:34Z", "bug_id": 45450, "creation_time": "2012-03-31T06:53:34Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 45450, "attachment_id": null, "text": "I have added a caveat in the documentation now (both 2.2, 2.4 and trunk), nudging people towards setting reconnect to 0 when prepared statements are in use. I'm marking this ticket as resolved (fixed).", "id": 157095, "time": "2012-04-03T06:52:42Z", "creator": "humbedooh@apache.org", "creation_time": "2012-04-03T06:52:42Z", "is_private": false}]
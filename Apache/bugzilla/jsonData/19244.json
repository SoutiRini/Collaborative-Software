[{"count": 0, "tags": [], "bug_id": 19244, "attachment_id": null, "id": 35859, "time": "2003-04-23T08:30:00Z", "creator": "david@pastornet.net.au", "creation_time": "2003-04-23T08:30:00Z", "is_private": false, "text": "I am experiencing situations where an exception happens in tomcat 4 and the\nbrowser receives a totally blank page when it happens, and no substantial detail\nof the cause is logged.  Tomcat is not at fault for the exception, but I think\nthat tomcat is at fault for not making the full detail of the exception available.\n\nThe fault might be at lines 408-412 (of the coyote rc2 release) of coyote's\nHttp11Processor.java where it doesn't explicitly handle ServletExceptions with\nwrapped content.\n\nMy investigations show that ApplicationFilterChain.java rethrows various\nexceptions with a ServletException and this causes the detail of the exception\nto not be logged because the logging mechanism doesn't realise that the\nexception is a wrapper, and it doesn't log the underlying exception.\n\nFor example, the following code from ApplicationFilterChain.java throws a\nwrapped exception:\n        } catch (Throwable e) {\n            support.fireInstanceEvent(InstanceEvent.AFTER_SERVICE_EVENT,\n                                      servlet, request, response, e);\n            throw new ServletException\n              (sm.getString(\"filterChain.servlet\"), e);\n        }\n\nThere seem to be other places where this is done too [in the same source file at\nleast].\n\nI'm getting exceptions like the one below logged, but the wrapped exception is\nescaping being logged [it is shown after the one below - I had to hack the\ntomcat source to get it].\n\nStandardWrapperValve[AxisServlet]: Servlet.service() for servlet AxisServlet\nthrew exception\njavax.servlet.ServletException: Servlet execution threw an exception\njavax.servlet.ServletException: Servlet execution threw an exception\n    at\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:269)\n    at\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:193)\n    at\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:263)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at\norg.apache.catalina.authenticator.AuthenticatorBase.invokeAnonymous(AuthenticatorBase.java:597)\n    at\ncom.borland.catalina.authenticator.AnonymousValve.invoke(AnonymousValve.java:37)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2489)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n    at\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n    at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n    at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n    at org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:223)\n    at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:413)\n    at\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)\n    at org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:537)\n    at\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n    at java.lang.Thread.run(Thread.java:536)\n\n\n\n\nBelow is the exception that was being wrapped, but I had to hack the tomcat\nsource to get the detail of it (this stack trace below is a problem that I have\nto solve - just reporting it for good measure).  I wouldn't have known the cause\nwithout hacking the tomcat sources.\n\n\n\n\njava.lang.NoClassDefFoundError: javax/ejb/_EJBHome_Stub\n\tat java.lang.ClassLoader.defineClass0(Native Method)\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:502)\n\tat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:123)\n\tat\ncom.borland.enterprise.module.reflection.classes.custom.CustomClassLoader.findClassInternal(CustomClassLoader.java:371)\n\tat\ncom.borland.enterprise.module.reflection.classes.custom.CustomClassLoader.findClass(CustomClassLoader.java:248)\n\tat\ncom.borland.enterprise.module.reflection.classes.custom.CustomClassLoader.loadClass(CustomClassLoader.java:864)\n\tat\ncom.borland.enterprise.module.reflection.classes.custom.CustomClassLoader.loadClass(CustomClassLoader.java:719)\n\tat java.lang.ClassLoader.loadClassInternal(ClassLoader.java:315)\n\tat java.lang.Class.forName0(Native Method)\n\tat java.lang.Class.forName(Class.java:217)\n\tat com.inprise.vbroker.rmi.CORBA.UtilImpl._loadClass(UtilImpl.java:724)\n\tat com.inprise.vbroker.rmi.CORBA.UtilImpl.loadClass(UtilImpl.java:1022)\n\tat javax.rmi.CORBA.Util.loadClass(Util.java:233)\n\tat\ncom.inprise.vbroker.rmi.CORBA.PortableRemoteObjectImpl.narrow(PortableRemoteObjectImpl.java:222)\n\tat javax.rmi.PortableRemoteObject.narrow(PortableRemoteObject.java:134)\n\tat org.apache.axis.providers.java.EJBProvider.getServiceClass(EJBProvider.java:234)\n\tat\norg.apache.axis.providers.java.JavaProvider.initServiceDesc(JavaProvider.java:535)\n\tat org.apache.axis.providers.java.EJBProvider.initServiceDesc(EJBProvider.java:382)\n\tat\norg.apache.axis.handlers.soap.SOAPService.getInitializedServiceDesc(SOAPService.java:322)\n\tat\norg.apache.axis.deployment.wsdd.WSDDService.makeNewInstance(WSDDService.java:477)\n\tat\norg.apache.axis.deployment.wsdd.WSDDDeployableItem.getNewInstance(WSDDDeployableItem.java:312)\n\tat\norg.apache.axis.deployment.wsdd.WSDDDeployableItem.getInstance(WSDDDeployableItem.java:298)\n\tat\norg.apache.axis.deployment.wsdd.WSDDDeployment.getService(WSDDDeployment.java:492)\n\tat org.apache.axis.configuration.FileProvider.getService(FileProvider.java:262)\n\tat org.apache.axis.AxisEngine.getService(AxisEngine.java:275)\n\tat org.apache.axis.MessageContext.setTargetService(MessageContext.java:586)\n\tat org.apache.axis.handlers.http.URLMapper.invoke(URLMapper.java:89)\n\tat org.apache.axis.handlers.http.URLMapper.generateWSDL(URLMapper.java:97)\n\tat org.apache.axis.strategies.WSDLGenStrategy.visit(WSDLGenStrategy.java:72)\n\tat org.apache.axis.SimpleChain.doVisiting(SimpleChain.java:156)\n\tat org.apache.axis.SimpleChain.generateWSDL(SimpleChain.java:143)\n\tat org.apache.axis.server.AxisServer.generateWSDL(AxisServer.java:456)\n\tat\norg.apache.axis.transport.http.AxisServlet.processWsdlRequest(AxisServlet.java:428)\n\tat org.apache.axis.transport.http.AxisServlet.doGet(AxisServlet.java:280)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:740)\n\tat org.apache.axis.transport.http.AxisServletBase.service(AxisServletBase.java:335)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:853)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:122)\n\tat\norg.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:72)\n\tat\norg.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:263)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.authenticator.AuthenticatorBase.invokeAnonymous(AuthenticatorBase.java:597)\n\tat com.borland.catalina.authenticator.AnonymousValve.invoke(AnonymousValve.java:37)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke(StandardContext.java:2489)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:180)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat\norg.apache.catalina.valves.ErrorDispatcherValve.invoke(ErrorDispatcherValve.java:170)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:172)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat\norg.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:174)\n\tat\norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNext(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat4.CoyoteAdapter.service(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:413)\n\tat\norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnection(Http11Protocol.java:380)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt(PoolTcpEndpoint.java:537)\n\tat\norg.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run(ThreadPool.java:533)\n\tat java.lang.Thread.run(Thread.java:536)"}, {"count": 1, "tags": [], "bug_id": 19244, "is_private": false, "id": 35865, "creation_time": "2003-04-23T09:58:25Z", "time": "2003-04-23T09:58:25Z", "creator": "remm@apache.org", "text": "The wrapping is as specified by the specification, and the exception is logged\nway before going all the way down to the main request processor. The error\nreport page will only be output if the response hasn't been committed, or\nsomething similar.\nIf you'd like to reopen this report, please attach a ready to run test case.", "attachment_id": null}]
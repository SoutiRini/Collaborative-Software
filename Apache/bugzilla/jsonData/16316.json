[{"count": 0, "tags": [], "bug_id": 16316, "attachment_id": null, "id": 29846, "time": "2003-01-22T09:02:51Z", "creator": "3ca28f66@mail.ru", "creation_time": "2003-01-22T09:02:51Z", "is_private": false, "text": "Exception is\n\n2003-01-22 11:12:54 DataSourceRealm[/esljsp]: Exception performing authentication\njavax.naming.NameNotFoundException: Name java: is not bound in this Context\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:811)\n\tat org.apache.naming.NamingContext.lookup(NamingContext.java:194)\n\tat org.apache.catalina.realm.DataSourceRealm.open(DataSourceRealm.java:463)\n\tat org.apache.catalina.realm.DataSourceRealm.start(DataSourceRealm.java:582)\n\tat org.apache.catalina.core.StandardContext.start(StandardContext.java:3543)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)\n\tat org.apache.catalina.core.StandardHost.start(StandardHost.java:738)\n\tat org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1188)\n\tat org.apache.catalina.core.StandardEngine.start(StandardEngine.java:347)\n\tat org.apache.catalina.core.StandardService.start(StandardService.java:497)\n\tat org.apache.catalina.core.StandardServer.start(StandardServer.java:2189)\n\tat org.apache.catalina.startup.Catalina.start(Catalina.java:512)\n\tat org.apache.catalina.startup.Catalina.execute(Catalina.java:400)\n\tat org.apache.catalina.startup.Catalina.process(Catalina.java:180)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n\tat\nsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n\tat java.lang.reflect.Method.invoke(Method.java:324)\n\tat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:203)\n\nIt is throwed _before_ <Resource ...> is processed, so it may be the issue, or\nit might be different context/classloaders issue.\nVarious configurations tried -- DataSource resource declaration inside Context,\nHost, Engine, GlobalNamingResource (with ResourceLink inside Context). It works\nfine inside a test servlet -- javax.sql.DataSource is returned, but fails to be\nfound by Realm.\n\nRealm declaration:\n<Realm className=\"org.apache.catalina.realm.DataSourceRealm\"\n       dataSourceName=\"java:/comp/env/jdbc/esljsp\"\n       debug=\"99\"\n       userTable=\"T_USERS\"\n       userNameCol=\"NAME\"\n       userCredCol=\"PASSWORD\"\n       userRolesTable=\"T_USERROLES\"\n       roleNameCol=\"ROLENAME\" />\n\nAlso, some stupid dataSourceName values tried:\n* java:/comp/env/jdbc/esljsp\n* /comp/env/jdbc/esljsp\n* jdbc/esljsp"}, {"count": 1, "attachment_id": 4510, "bug_id": 16316, "is_private": false, "id": 29847, "time": "2003-01-22T09:19:13Z", "creator": "3ca28f66@mail.ru", "creation_time": "2003-01-22T09:19:13Z", "tags": [], "text": "Created attachment 4510\nCorresponding server.xml"}, {"count": 2, "tags": [], "bug_id": 16316, "attachment_id": null, "id": 29917, "time": "2003-01-23T07:04:38Z", "creator": "3ca28f66@mail.ru", "creation_time": "2003-01-23T07:04:38Z", "is_private": false, "text": "After trying all possible variations it's finally done. Unfortunately, IMHO it\nwas too hard for a newbie to figure out the problem and its solution."}, {"count": 3, "tags": [], "bug_id": 16316, "attachment_id": null, "id": 29935, "time": "2003-01-23T14:33:02Z", "creator": "glenn@apache.org", "creation_time": "2003-01-23T14:33:02Z", "is_private": false, "text": "You are welcome to submit a patch to the documentation if you feel it\ncould be improved."}, {"count": 4, "tags": [], "text": "Sad but true, I've forced to reopen this bug. I tried all the possible variants\nin configuration files (config.xml , web.xml) with no luck.\nI have a servlet that looks up JNDI for DataSource object, and a DataSourceRealm\nrelied on JNDI resource defined in config.xml . With one configuration,\nDataSource obtains successfully, but Realm doesn't work, throwing an exception;\nwith another, DataSource throwing an exception, but database access works fine.\nHow can I have it work both siumltaneuosly? Seems like nobody uses this\ntechnique for now because I asked similar questions several time in tomcat-dev\nlist, and nobody helped to make it work both, but separately only.\nException is the same:\n\njavax.naming.NameNotFoundException: Name java:comp is not bound in this Context", "is_private": false, "id": 30566, "creator": "3ca28f66@mail.ru", "time": "2003-02-03T15:27:45Z", "bug_id": 16316, "creation_time": "2003-02-03T15:27:45Z", "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 16316, "attachment_id": 4686, "id": 30567, "time": "2003-02-03T15:30:25Z", "creator": "3ca28f66@mail.ru", "creation_time": "2003-02-03T15:30:25Z", "is_private": false, "text": "Created attachment 4686\nTestcase: server.xml , web.xml , index.jsp test file."}, {"count": 6, "tags": [], "bug_id": 16316, "attachment_id": null, "is_private": false, "id": 30601, "time": "2003-02-03T22:05:35Z", "creator": "glenn@apache.org", "creation_time": "2003-02-03T22:05:35Z", "text": "Try configuring your JNDI Named DataSource which is used\nby the DataSourceRealm in the \nGlobalNamingResources section of your server.xml config."}, {"count": 7, "tags": [], "bug_id": 16316, "attachment_id": null, "is_private": false, "id": 30637, "time": "2003-02-04T12:43:00Z", "creator": "3ca28f66@mail.ru", "creation_time": "2003-02-04T12:43:00Z", "text": "Yes, it works now, but it's not good to have one DataSource for Realm\nauthentication only, useless waste of resources I think, if users authentication\noccurs rarely, as in my case.\nI agree, this is a good workaround, but should I leave this bug REOPENED? (I\nthink so.)"}, {"count": 8, "tags": [], "text": "I have committed a patch to CVS which removes the validation of the db\nconnection for the JNDI named DataSource from the start code for the\nrealm so that the realm can start if the DataSource has not been setup yet.\nBug fix will be available in the next Tomcat 4.1 release.", "is_private": false, "id": 30643, "creator": "glenn@apache.org", "time": "2003-02-04T13:25:50Z", "bug_id": 16316, "creation_time": "2003-02-04T13:25:50Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 16316, "attachment_id": null, "id": 33365, "time": "2003-03-18T18:54:23Z", "creator": "sideshowfry@yahoo.com", "creation_time": "2003-03-18T18:54:23Z", "is_private": false, "text": "I've made my own realm which uses DataSource, based on the DataSourceRealm code,\nand dealt with the\n\n   javax.naming.NameNotFoundException: Name java: is not bound in this Context\n\nproblem. In addition to removing the connection check from the start method (as\nGlenn indicated), I also changed these lines in open():\n\n   StandardServer server = (StandardServer) ServerFactory.getServer();\n   Context context = server.getGlobalNamingContext();\n\nto:\n\n   Context context = new InitialContext();\n\nI think this is what allowed me to put my realm and datasource within the\ncontext of my webapp, rather than in GlobalNamingResources.  This seems like a\nworthwhile change to me. On the other hand, the InitialContext class is\nimported, but not used, in DataSourceRealm - so, maybe my way had problems in\nthe past that were corrected with the getGlobalNamingContext() approach."}, {"count": 10, "tags": [], "bug_id": 16316, "attachment_id": null, "id": 38751, "time": "2003-06-12T05:11:49Z", "creator": "dan@mojavelinux.com", "creation_time": "2003-06-12T05:11:49Z", "is_private": false, "text": "I would like to second this last suggestion.  The bug became apparent to me when\nI was using securityfilter to complete container-like managed security.  At\nfirst I thought the bug was in securityfilter, but after breaking it back down\nto container managed security, I still could not avoid an exception being thrown\ndue to the JNDI context not being available.  I could obtain a connection to the\ndatasource using the test case in the realm docs for Tomcat, but not when trying\nto use container managed security.  After copying DataSourceRealm to my own\npackage, changing the lines recommended in the previous post and using the\nresult, I could authenticate my user.  This is clearly a huge bug rendering the\nDataSource realm impossible to use in a specified context."}, {"count": 11, "tags": [], "text": "It is an obvious nonsense that a realm (ie, an object scoped inside the\ncontainer) depends on a webapp level object. I don't undestand how this could\nwork, except by pure coincidence.\nWith the data source realm (or any JNDI powered), you should use a global data\nsource (and you can easily reuse it by linking to it from your contexts). Maybe\nit's not so easy to configure, but unfortunately I don't see any way to make it\neasier ...\nPlease do not reopen this \"bug\", it cannot be addressed.", "attachment_id": null, "bug_id": 16316, "id": 38757, "time": "2003-06-12T08:00:59Z", "creator": "remm@apache.org", "creation_time": "2003-06-12T08:00:59Z", "is_private": false}, {"count": 12, "tags": [], "bug_id": 16316, "attachment_id": null, "is_private": false, "id": 38763, "time": "2003-06-12T13:27:53Z", "creator": "dan@mojavelinux.com", "creation_time": "2003-06-12T13:27:53Z", "text": "I don't understand this WONTFIX status.  You mean to tell me that two people\nrunning webapps on the same server can't use different databases for container\nmanaged security?  Suppost Joe is running a shopping cart and I have a weblog. \nThat doesn't mean we have the same users and therefore doesn't mean we should\nuse the same JNDI to get a database connection.  If you use the JDBCRealm you\ncan specify all the parameters you want for container managed security, why\ncan't you use an JNDI too?  This makes no sense to me.\n\np.s. How did I get it to run?  Check out securityfilter.sourceforge.net, which\nallows pseudo-container managed security so the specification for the realm can\nbe anywhere.  securityfilter get's over some of the pitfalls of container\nmanaged security such as not being able to have a login on any page."}, {"count": 13, "attachment_id": null, "bug_id": 16316, "is_private": false, "id": 38764, "time": "2003-06-12T14:01:42Z", "creator": "remm@apache.org", "creation_time": "2003-06-12T14:01:42Z", "tags": [], "text": "There's nothing preventing you from defining more than one global datasource.\nI think you are not understanding the scoping of the JNDI context correctly,\nwhich is associated with the classloader context (if you're inside Catalina, you\ncan access its internal JNDI context, containing the \"global\" resources;\nstarting from the invocation of the Servlet wrapper, you access the per-webapp\ncontext, since you switched to the webapp classloading context)."}, {"count": 14, "tags": [], "bug_id": 16316, "attachment_id": null, "id": 38765, "time": "2003-06-12T14:33:41Z", "creator": "unico@hippo.nl", "creation_time": "2003-06-12T14:33:41Z", "is_private": false, "text": "I also have to object to the dismissal of this issue. I understand the logic\nthat a Realm can have wider scope (Host, Container) and therefore should not\ndepend on an object of more narrow scope (Context) in those cases. But this does\nnot mean that once a Realm is defined inside Context scope it shouldn't be\nallowed to access an object inside that same scope. I simply do not wish to\nexpose that datasource to any other application than the one I need it for, and\nso I need to be able to define it inside the application Context."}, {"count": 15, "tags": [], "bug_id": 16316, "attachment_id": null, "id": 39524, "time": "2003-06-26T20:34:14Z", "creator": "rnmixon@custco.biz", "creation_time": "2003-06-26T20:34:14Z", "is_private": false, "text": "I too believe this should be re-opened and fixed. Our manifestation of the \ndefect is a little different. Again, our \"webapps/appname.xml\" file defines \nboth the JDBCRealm and our application datasource.\n\nBoth authentication and application database access work initially - UNTIL \nthings go inactive and the MySQL 8hr timeout occurs. The fix for this is \nsupposed to be to add \"?autoReconnect=true\" to the end of the JDBC URL - so we \nadded this.\n\nHowever this does not fix the problem, the timeouts during authentication still \noccur. Moving the entire context (with both datasource and JDBCRealm within) to \nserver.xml appears  to fix the timeouts."}, {"count": 16, "tags": [], "bug_id": 16316, "attachment_id": null, "id": 45073, "time": "2003-10-04T14:46:53Z", "creator": "raphael.druener@syngenio.de", "creation_time": "2003-10-04T14:46:53Z", "is_private": false, "text": "Please reopen this Bug. With the current implementation, a context scoped Realm \nmakes no sense if it depends on a global resource. IMHO this a serious security \nissue because my user db for my context should NOT be globally visible."}, {"count": 17, "attachment_id": null, "bug_id": 16316, "is_private": false, "id": 48844, "time": "2003-12-10T18:18:38Z", "creator": "graham@darkcoding.net", "creation_time": "2003-12-10T18:18:38Z", "tags": [], "text": "*** Bug 23634 has been marked as a duplicate of this bug. ***"}, {"count": 18, "tags": [], "text": "Greetings. It appears that a bug I had open has been marked as duplicate to this one which \nis marked as \"resolved/wontfix\".  \n \nMy problem (and that of many others) is that if you define a JNDI resource in \nGlobalNamingResources or DefaultContext it is not available to web applications. If \nhowever you move the definition into a Context specific to the webapp it will work - however \nthat breaks automatic deployment. \n \nBug 23634 provides some more detail of the issue. What we need is a way to be able to \ndeploy a web application using autodeploy and have a database JNDI configuration in the \nDefaultContext or the GlobalNamingResources. This was working just fine in 4.0.4, but it has \nnot been working with the 4.1 versions that I have tested. \n \nI'm not actually sure if my bug is a duplicate of this one. I don't mind any resolution that \nmeans I can autodeploy again. \n \nPS : I have downloaded the code and spent a couple of hours trying to work this out myself, \nhowever I really need some some days to get the hang of the tomcat code to even really \nstart to understand how everything hangs together. \n \n ", "attachment_id": null, "bug_id": 16316, "id": 48850, "time": "2003-12-10T19:04:56Z", "creator": "peter.harrison@nothingbutnet.co.nz", "creation_time": "2003-12-10T19:04:56Z", "is_private": false}]
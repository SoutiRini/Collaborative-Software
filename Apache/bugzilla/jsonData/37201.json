[{"count": 0, "attachment_id": null, "bug_id": 37201, "is_private": false, "id": 81539, "time": "2005-10-21T21:14:14Z", "creator": "glenn@apache.org", "creation_time": "2005-10-21T21:14:14Z", "tags": [], "text": "This patch adds the <IfInterface IP> configuration syntax.\nIt works similar to the <IfModule ..> syntax except that it\nincludes the nested configuration commands if the IP address\nis configured on the interface for the server.\n\nThis makes mass virtual hosting with automatic failover using\ntechnology like spread/wackamole easier.\n\nHere is an example:\n\n<IfInterface 204.185.42.129>\n  Listen 204.185.42.129:80\n  NameVirtualHost 204.185.42.129:80\n  Include /export/kinetic/conf/apache/204.185.42.129/*.conf\n</IfInterface>"}, {"count": 1, "tags": [], "text": "Created attachment 16773\nserver/core.c patch", "attachment_id": 16773, "id": 81541, "creator": "glenn@apache.org", "time": "2005-10-21T21:15:05Z", "bug_id": 37201, "creation_time": "2005-10-21T21:15:05Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 37201, "is_private": false, "count": 2, "id": 81547, "time": "2005-10-21T21:52:58Z", "creator": "colm@apache.org", "creation_time": "2005-10-21T21:52:58Z", "text": "Kinda cool, can you describe the use-case a bit more? Is this for when an IP address is added to a \nsystem and you want httpd to behave differently after a restart? \n\nFrom a brief inspecion: Hard-coding APR_INET means that this patch will not work with IPv6, at all. You \nneed to do the info_get first, with APR_UNSPEC as the family argument. Then create the socket using \nthe sa->family variable. \n\nThe EADDRINUSE error condition for bind() might need to be handled, for restarts - though I havn't \ntested this.\n\nThe syntax and log messages are majorly confusing, because \"arg\" is not a network interface; it's an IP \naddress. "}, {"count": 3, "tags": [], "bug_id": 37201, "attachment_id": null, "is_private": false, "id": 81549, "time": "2005-10-21T22:26:46Z", "creator": "glenn@apache.org", "creation_time": "2005-10-21T22:26:46Z", "text": "> Kinda cool, can you describe the use-case a bit more? Is this for when an IP\n> address is added to a  system and you want httpd to behave differently after\n> a restart?\n\nThanks. Here is the use case in more depth.\n\nSay you have 500 virtual host's. A mix of IP based for SSL and name based for\nnon SSL. You have three servers in a cluster to host these 500 virtual hosts.\nYou place each virtual host config in a directory named by the IP address used\nfor the virtual host. These directories are located on an NFS server which is \nshared with each of the three servers. All three servers can see the config\nfiles for all virtual hosts by IP address. But when apache starts on each\nserver it will only configure those virtual hosts for which the IP address\nis configured on its interface.\n\nThe hosts in the cluster use spread and wackamole to provide automatic failover.\nIf server 1 goes down the IP's for virtual hosted websites currently on server 1\nget split up between server 2 and 3. Then just doing an apachectl graceful will\ninstantiate those new virtual hosts on the other two servers.\n\nApache is also using mod_log_spread and spreadlogd for setting up a log server.\n\n> From a brief inspecion: Hard-coding APR_INET means that this patch will not\n> work with IPv6, at all. You  need to do the info_get first, with APR_UNSPEC\n> as the family argument. Then create the socket using the sa->family variable.\n\nThanks, I was wondering how to best provide IPV6 support.\n\n> The EADDRINUSE error condition for bind() might need to be handled, for\n> restarts - though I havn't  tested this.\n\nI have tested doing an apachectl graceful and <IfInterface ...> seems to\nwork fine. This has only been tested on FreeBSD 5.3.\n\n> The syntax and log messages are majorly confusing, because \"arg\" is not\na network interface; it's an IP address.\n\nYes, the log messages could be cleaned up.\n\nPerhaps <IfBind ...> rather than <IfInterface ...> ?\n\n\n"}, {"count": 4, "tags": [], "creator": "glenn@apache.org", "is_private": false, "text": "Created attachment 16776\nSecond version of patch, now has IPV6 support.\n\nSecond version of patch, now has both IPV4 and IPV6 support.\nRenamed to <IfBind ...>, cleaned up log messages.", "id": 81550, "time": "2005-10-21T23:37:49Z", "bug_id": 37201, "creation_time": "2005-10-21T23:37:49Z", "attachment_id": 16776}, {"count": 5, "tags": [], "bug_id": 37201, "attachment_id": null, "id": 124177, "time": "2009-01-18T16:19:22Z", "creator": "pgollucci@apache.org", "creation_time": "2009-01-18T16:19:22Z", "is_private": false, "text": "CC myself on FreeBSD related bugs"}]
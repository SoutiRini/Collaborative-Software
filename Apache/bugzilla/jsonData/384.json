[{"attachment_id": null, "tags": [], "bug_id": 384, "is_private": false, "count": 0, "id": 358, "time": "2000-12-30T17:01:19Z", "creator": "dev@tomcat.apache.org", "creation_time": "2000-12-30T17:01:19Z", "text": "AJP13 returns only Status Code, but no Status Message\r\n(aka Reason-Phrase as in RFC 2616)\r\n\r\nIn file service/copnnectors/Ajp13ConnectorResponse.java the code looks like:\r\n\r\n   122          MsgBuffer msg=con.getMsgBuffer();\r\n   123          msg.reset();\r\n   124          msg.appendByte(JK_AJP13_SEND_HEADERS);\r\n   125\r\n   126          msg.appendInt(getStatus());\r\n   127          msg.appendString(\"\");\r\n   128\r\n   129          // No need for these two!!!\r\n   130          headers.removeHeader(\"Status\");\r\n   131          headers.removeHeader(\"Servlet-Engine\");\r\n\r\nIn line 127 the Status Message is just set to \"\". \r\nThis does not conform to the HTTP protocol because\r\n\r\nStatus-Line = \r\nHTTP-Version SP Status-Code SP Reason-Phrase CRLF\r\n\r\nThis Reason-Phrase is missing \r\n(OK: to be precise in the RFCs the Phrase is allowed to be empty).\r\n\r\nInstead one should use something like in file \r\ncore/ResponseImpl.java\r\n\r\npublic class ResponseImpl implements Response {\r\n    protected static StringManager sm =\r\n        StringManager.getManager(\"org.apache.tomcat.core\");\r\n\r\n...\r\n\r\n    // utility method - should be in a different class\r\n    public static String getMessage( int status ) {\r\n        return sm.getString(\"sc.\"+ status);\r\n    }\r\n\r\n}\r\n\r\nand then use getMessage to set the Status Message from the\r\nStatus Code. In fact everything is already prepared to do that,\r\nincluding the table of codes and messages in core/LocalStrings.properties.\r\n\r\nAnybody willing to officially do the fix?\r\n\r\nThanks!\r\n"}, {"attachment_id": 337, "tags": [], "bug_id": 384, "is_private": false, "count": 1, "id": 3820, "time": "2001-07-18T11:45:09Z", "creator": "rainer.jung@kippdata.de", "creation_time": "2001-07-18T11:45:09Z", "text": "Created attachment 337\nPatch for bug 384"}, {"count": 2, "tags": [], "creator": "cmanolache@yahoo.com", "attachment_id": null, "id": 6236, "time": "2001-10-01T10:48:06Z", "bug_id": 384, "creation_time": "2001-10-01T10:48:06Z", "is_private": false, "text": "Fixed in 3.3\n( Marc - you may want to add it to 3.2.x )"}]
[{"count": 0, "tags": [], "bug_id": 56805, "text": "The getConnection() method invokes borrowConnection(). The later polls the idle collection for available existing connections. If a connection is available, the method attempts to lock() it to gain exclusive access. It may happen the connection is already locked by the PoolCleaner for validation for instance. In this case, getConnection() will have to wait until the validation is completed - even if other idle connections are available.\n\nThe attach test case illustrates the phenomenon. The pool starts with two connections and uses a custom Validator waiting for 1000ms to simulate a slow validation process. An attempt to get a connection from the pool is made when the first connection is being validated by the PoolCleaner. At the end, the test shows that the application gets the connection after 1000ms: it had to wait for the completion of the validation although another connection was immediately available in the idle pool.\n\nThe outcome becomes even worst if the validation never returns (because of a missing validationQueryTimeout - see bug 56804): in this case, the application thread is blocked forever as well.\n\nIdeally, the borrow connection logic should somehow ignore connections under validation and immediately consider the other connections available in the pool.", "id": 176848, "time": "2014-08-02T22:27:05Z", "creator": "brenuart@gmail.com", "creation_time": "2014-08-02T22:27:05Z", "is_private": false, "attachment_id": null}, {"attachment_id": 31867, "tags": [], "bug_id": 56805, "text": "Created attachment 31867\nTestCase", "count": 1, "id": 176849, "time": "2014-08-02T22:28:09Z", "creator": "brenuart@gmail.com", "creation_time": "2014-08-02T22:28:09Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 15655, "attachment_id": null, "is_private": false, "id": 28248, "time": "2002-12-24T18:20:05Z", "creator": "karlheg@hegbloom.net", "creation_time": "2002-12-24T18:20:05Z", "text": "When I run \"make test\" after building mod_perl 1.99_07, Apache2 mpm threadpool\ndumps core.  I rebuilt Apache2 from the Debian sources, with \"-g -O0\" and not\nstripped (patch to support DEB_BUILD_OPTIONS for \"debug,nostrip\" submitted\nagainst Debian Apache2), then ran \"export LD_LIBRARY_PATH=/usr/lib/debug\" to get\nthe debug libc and libpthread involved.  I then removed the core file, and ran\n\"make test\" again.  I found that it's probably trying to free memory that has\nalready been freed.  Here's the output of \"where full\":\n\n(gdb) where full\n#0  _int_free (av=0x40347480, mem=0x9e5f248) at malloc.c:4150\n\tp = (struct malloc_chunk *) 0xa01a668\n\tsize = 0x9e5f248\n\tfb = (struct malloc_chunk **) 0x9e5f248\n\tnextchunk = (struct malloc_chunk *) 0x13e798b0\n\tnextsize = 0x40011850\n\tprevsize = 0x9e5f248\n\tbck = (struct malloc_chunk *) 0x9e5f248\n\tfwd = (struct malloc_chunk *) 0x0\n#1  0x402a1e6a in __libc_free (mem=0xa01a670) at malloc.c:3344\n\tar_ptr = (struct malloc_state *) 0x40347480\n\tp = (struct malloc_chunk *) 0x9e5f248\n\thook = (void (*)(void *, const void *)) 0x9e5f248\n#2  0x4017dd3b in apr_allocator_destroy (allocator=0xa064120)\n    at\n/usr/local/src/debian/apache2/apache2-2.0.43/build-tree/apache2/srclib/apr/memory/unix/apr_pools.c:138\n\tindex = 0x0\n\tnode = (apr_memnode_t *) 0xa01a670\n\tref = (apr_memnode_t **) 0xa064134\n#3  0x40128dd4 in alloc_cleanup (data=0xa18eb88)\n    at\n/usr/local/src/debian/apache2/apache2-2.0.43/build-tree/apache2/srclib/apr-util/buckets/apr_buckets_alloc.c:86\n\tlist = (apr_bucket_alloc_t *) 0xa18eb88\n---Type <return> to continue, or q <return> to quit---\n\tallocator = (apr_allocator_t *) 0xa064120\n#4  0x4017eecb in apr_pool_cleanup_run (p=0x8d2fe08, data=0xa18eb88, \n    cleanup_fn=0x40128d90 <alloc_cleanup>)\n    at\n/usr/local/src/debian/apache2/apache2-2.0.43/build-tree/apache2/srclib/apr/memory/unix/apr_pools.c:1955\nNo locals.\n#5  0x40128ec6 in apr_bucket_alloc_destroy (list=0xa18eb88)\n    at\n/usr/local/src/debian/apache2/apache2-2.0.43/build-tree/apache2/srclib/apr-util/buckets/apr_buckets_alloc.c:113\nNo locals.\n#6  0x0807f0e1 in worker_thread (thd=0x8d27fb0, dummy=0x9c755f0)\n    at\n/usr/local/src/debian/apache2/apache2-2.0.43/build-tree/apache2/server/mpm/experimental/threadpool/threadpool.c:1099\n\tti = (proc_info *) 0x9c755f0\n\tprocess_slot = 0x0\n\tthread_slot = 0x1\n\tbucket_alloc = (apr_bucket_alloc_t *) 0xa18eb88\n\ttpool = (apr_pool_t *) 0x8d2fe08\n\tptrans = (apr_pool_t *) 0xa18cb80\n\tallocator = (apr_allocator_t *) 0xa04a710\n\trv = 0x0\n\twakeup = (worker_wakeup_info *) 0x8d2fe50\n#7  0x4017826c in dummy_worker (opaque=0x8d27fb0)\n---Type <return> to continue, or q <return> to quit---\n    at\n/usr/local/src/debian/apache2/apache2-2.0.43/build-tree/apache2/srclib/apr/threadproc/unix/thread.c:127\n\tthread = (apr_thread_t *) 0x8d27fb0\n#8  0x401ee06f in pthread_start_thread (arg=0xbf1ffbe0) at manager.c:300\n\tself = (struct _pthread_descr_struct *) 0xbf1ffbe0\n\trequest = {req_thread = 0x0, req_kind = REQ_CREATE, req_args = {\n    create = {attr = 0x0, fn = 0, arg = 0x0, mask = {__val = {\n          0x0 <repeats 32 times>}}}, free = {thread_id = 0x0}, exit = {\n      code = 0x0}, post = 0x0, for_each = {fn = 0, arg = 0x0}}}\n\toutcome = (void *) 0x9e5f248\n(gdb) \n\nI hope that's not horribly wrapped by this text entry box!\n\nI will save the core file, so let me know if you need any more information. \nSource level debugging in XEmacs is fully operational, but I am not familiar\nwith the apache internals at all.  I can let you log in if you need to poke\naround, just email me or /msg me in irc.openprojects.net, #orlug, karlheg.\n\nldd =apache2\n\tlibz.so.1 => /lib/libz.so.1 (0x4002d000)\n\tlibssl.so.0.9.6 => /usr/lib/i686/libssl.so.0.9.6 (0x4003c000)\n\tlibcrypto.so.0.9.6 => /usr/lib/i686/libcrypto.so.0.9.6 (0x40069000)\n\tlibaprutil.so.0 => /usr/lib/libaprutil.so.0 (0x40121000)\n\tlibgdbm.so.1 => /usr/lib/libgdbm.so.1 (0x4013a000)\n\tlibexpat.so.1 => /usr/lib/libexpat.so.1 (0x40140000)\n\tlibapr.so.0 => /usr/lib/libapr.so.0 (0x40161000)\n\tlibm.so.6 => /usr/lib/debug/libm.so.6 (0x40184000)\n\tlibcrypt.so.1 => /usr/lib/debug/libcrypt.so.1 (0x401a5000)\n\tlibnsl.so.1 => /usr/lib/debug/libnsl.so.1 (0x401d2000)\n\tlibdl.so.2 => /usr/lib/debug/libdl.so.2 (0x401e5000)\n\tlibpthread.so.0 => /usr/lib/debug/libpthread.so.0 (0x401e8000)\n\tlibc.so.6 => /usr/lib/debug/libc.so.6 (0x40238000)\n\t/lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)\n\nThe libapr is built from Debian apache2 2.0.43-1 source, modified only to\nprovide -g -O0 -pipe in CFLAGS.  The exact configuration is stored on my machine\nif you need more information.  I will keep it for several weeks, since this is\nthe holiday season and I expect many of you are taking some time off."}, {"count": 1, "tags": [], "creator": "jerenkrantz@apache.org", "attachment_id": null, "id": 31387, "time": "2003-02-17T01:22:18Z", "bug_id": 15655, "creation_time": "2003-02-17T01:22:18Z", "is_private": false, "text": "The threadpool MPM is experimental.  Does it work with the worker MPM?\n\nCould you also please try with recent versions of APR, httpd, and mod_perl?\n\nThanks for using Apache HTTP Server!"}, {"count": 2, "tags": [], "text": "I am sorry, but I don't have much time for this right now.  I am in college full\ntime.", "attachment_id": null, "bug_id": 15655, "id": 31389, "time": "2003-02-17T02:09:45Z", "creator": "karlheg@hegbloom.net", "creation_time": "2003-02-17T02:09:45Z", "is_private": false}, {"count": 3, "tags": [], "text": "any update on this Karl?\n\nFWIW I can successfully run mod_perl 1.0.99_09 with worker without it crashing.\nmarking this as 'worksforme', please feel free to re-open this if you still have\na problem karl", "is_private": false, "id": 34295, "creator": "ianh@apache.org", "time": "2003-04-02T05:59:15Z", "bug_id": 15655, "creation_time": "2003-04-02T05:59:15Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "I have not had time to try.  I hope that it is really fixed.  Leaving as\n\"worksforme\".", "is_private": false, "id": 34339, "creator": "karlheg@hegbloom.net", "time": "2003-04-02T14:25:32Z", "bug_id": 15655, "creation_time": "2003-04-02T14:25:32Z", "attachment_id": null}]
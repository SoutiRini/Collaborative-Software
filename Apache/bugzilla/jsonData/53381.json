[{"count": 0, "attachment_id": null, "bug_id": 53381, "text": "I get this exception sometimes. I think that occurs in re-deploys but I am not sure if only occurs in this case.\n\n\njava.lang.NullPointerException\n\tat org.apache.catalina.loader.WebappClassLoader.findResourceInternal(WebappClassLoader.java:2963)\n\tat org.apache.catalina.loader.WebappClassLoader.findResource(WebappClassLoader.java:1242)\n\tat org.apache.catalina.loader.WebappClassLoader.getResource(WebappClassLoader.java:1389)\n\tat org.aspectj.apache.bcel.util.ClassLoaderRepository.toURL(ClassLoaderRepository.java:276)\n\tat org.aspectj.apache.bcel.util.ClassLoaderRepository.loadClass(ClassLoaderRepository.java:289)\n\tat org.aspectj.weaver.bcel.BcelWorld.lookupJavaClass(BcelWorld.java:402)\n\tat org.aspectj.weaver.bcel.BcelWorld.resolveDelegate(BcelWorld.java:376)\n\tat org.aspectj.weaver.ltw.LTWWorld.resolveDelegate(LTWWorld.java:107)\n\tat org.aspectj.weaver.World.resolveToReferenceType(World.java:488)\n\tat org.aspectj.weaver.World.resolve(World.java:329)\n\tat org.aspectj.weaver.World.resolve(World.java:239)\n\tat org.aspectj.weaver.ResolvedTypeMunger.matches(ResolvedTypeMunger.java:110)\n\tat org.aspectj.weaver.ConcreteTypeMunger.matches(ConcreteTypeMunger.java:82)\n\tat org.aspectj.weaver.bcel.BcelWeaver.weaveNormalTypeMungers(BcelWeaver.java:1627)\n\tat org.aspectj.weaver.bcel.BcelWeaver.addNormalTypeMungers(BcelWeaver.java:1437)\n\tat org.aspectj.weaver.bcel.BcelWeaver.weave(BcelWeaver.java:1128)\n\tat org.aspectj.weaver.tools.WeavingAdaptor.getWovenBytes(WeavingAdaptor.java:525)\n\tat org.aspectj.weaver.tools.WeavingAdaptor.weaveClass(WeavingAdaptor.java:361)\n\tat org.aspectj.weaver.loadtime.Aj.preProcess(Aj.java:100)\n\tat org.aspectj.weaver.loadtime.ClassPreProcessorAgentAdapter.transform(ClassPreProcessorAgentAdapter.java:54)\n\tat sun.instrument.TransformerManager.transform(Unknown Source)\n\tat sun.instrument.InstrumentationImpl.transform(Unknown Source)\n\tat java.lang.ClassLoader.defineClass1(Native Method)\n\tat java.lang.ClassLoader.defineClassCond(Unknown Source)\n\tat java.lang.ClassLoader.defineClass(Unknown Source)\n\tat java.security.SecureClassLoader.defineClass(Unknown Source)\n\tat org.apache.catalina.loader.WebappClassLoader.findClassInternal(WebappClassLoader.java:2818)\n\tat org.apache.catalina.loader.WebappClassLoader.findClass(WebappClassLoader.java:1159)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1647)\n\tat org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1526)\n\tat java.lang.Class.getDeclaredFields0(Native Method)\n\tat java.lang.Class.privateGetDeclaredFields(Unknown Source)\n\tat java.lang.Class.getDeclaredFields(Unknown Source)\n\tat org.apache.catalina.loader.WebappClassLoader.clearReferencesStaticFinal(WebappClassLoader.java:2034)\n\tat org.apache.catalina.loader.WebappClassLoader.clearReferences(WebappClassLoader.java:1929)\n\tat org.apache.catalina.loader.WebappClassLoader.stop(WebappClassLoader.java:1833)\n\tat org.apache.catalina.loader.WebappLoader.stop(WebappLoader.java:740)\n\tat org.apache.catalina.core.StandardContext.stop(StandardContext.java:4920)\n\tat org.apache.catalina.core.StandardContext.reload(StandardContext.java:3454)\n\tat org.apache.catalina.loader.WebappLoader.backgroundProcess(WebappLoader.java:426)\n\tat org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1361)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1653)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1662)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1662)\n\tat org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1642)\n\tat java.lang.Thread.run(Unknown Source)\n\n\n\nAny idea about", "id": 159805, "time": "2012-06-07T16:13:02Z", "creator": "randd@lucierna.com", "creation_time": "2012-06-07T16:13:02Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "bug_id": 53381, "attachment_id": null, "id": 159806, "time": "2012-06-07T17:08:12Z", "creator": "knst.kolinko@gmail.com", "creation_time": "2012-06-07T17:08:12Z", "is_private": false, "text": "The stacktrace mentions\n\norg.apache.catalina.loader.WebappClassLoader.clearReferencesStaticFinal(WebappClassLoader.java:2034)\norg.apache.catalina.loader.WebappClassLoader.clearReferences(WebappClassLoader.java:1929)\norg.apache.catalina.loader.WebappClassLoader.stop(WebappClassLoader.java:1833)\n\n1. So it happens during cleanup of static fields on web application shutdown. It is one of those features to remedy memory leaks in stopped applications.\n\nThis particular cleanup can be turned off in Tomcat 6 by setting the following system property to the value of false (e.g. in conf/catalina.properties file):\n\norg.apache.catalina.loader.WebappClassLoader.ENABLE_CLEAR_REFERENCES\n\nSee http://tomcat.apache.org/tomcat-7.0-doc/config/systemprops.html\n\nMaybe this feature does not play well with\norg.aspectj.weaver.loadtime.ClassPreProcessorAgentAdapter\n\nDo you use some form of lazy initialization/loading of classes?\n\n\n2. Looking at WebappClassLoader.stop() line 1833, closing the JARs happens later than this call to clearReferences(). So it is unclear why JARs appear to be closed.\n\nTo exclude bug 53225, a question: do you have \"JreMemoryLeakPreventionListener\" in your server.xml?  It should not be an issue in 6.0.x - just confirming."}, {"count": 2, "tags": [], "creator": "randd@lucierna.com", "text": "Hi Konstantin\n\nyes to both questions. Aspectj uses lazy initialization and JreMemoryLeakPreventionListener is enabled\n\nThanks!\n\n\n(In reply to comment #1)\n> The stacktrace mentions\n> \n> org.apache.catalina.loader.WebappClassLoader.\n> clearReferencesStaticFinal(WebappClassLoader.java:2034)\n> org.apache.catalina.loader.WebappClassLoader.\n> clearReferences(WebappClassLoader.java:1929)\n> org.apache.catalina.loader.WebappClassLoader.stop(WebappClassLoader.java:\n> 1833)\n> \n> 1. So it happens during cleanup of static fields on web application\n> shutdown. It is one of those features to remedy memory leaks in stopped\n> applications.\n> \n> This particular cleanup can be turned off in Tomcat 6 by setting the\n> following system property to the value of false (e.g. in\n> conf/catalina.properties file):\n> \n> org.apache.catalina.loader.WebappClassLoader.ENABLE_CLEAR_REFERENCES\n> \n> See http://tomcat.apache.org/tomcat-7.0-doc/config/systemprops.html\n> \n> Maybe this feature does not play well with\n> org.aspectj.weaver.loadtime.ClassPreProcessorAgentAdapter\n> \n> Do you use some form of lazy initialization/loading of classes?\n> \n> \n> 2. Looking at WebappClassLoader.stop() line 1833, closing the JARs happens\n> later than this call to clearReferences(). So it is unclear why JARs appear\n> to be closed.\n> \n> To exclude bug 53225, a question: do you have\n> \"JreMemoryLeakPreventionListener\" in your server.xml?  It should not be an\n> issue in 6.0.x - just confirming.", "id": 159811, "time": "2012-06-08T08:37:29Z", "bug_id": 53381, "creation_time": "2012-06-08T08:37:29Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "knst.kolinko@gmail.com", "attachment_id": null, "text": "Anyway,\n1. In a well-behaving web application one should be able to turn off this cleanup.\n\n2. This exception should not hurt.\n\nThe call to getDeclaredFields() on WebappClassLoader.java:2034 of Tomcat 6.0.32 is wrapped by try{}catch(Throwable){ //ignore }\n\nSo there should be no consequences.\n\n3. The web application is stopping and would not serve web requests anymore, so its state does not matter much.\n\nMaybe there are ideas how to better handle it, but I do not see one. I think it can be left as is.", "id": 159820, "time": "2012-06-08T11:34:14Z", "bug_id": 53381, "creation_time": "2012-06-08T11:34:14Z", "is_private": false}, {"count": 4, "tags": [], "creator": "markt@apache.org", "text": "Agreed.", "id": 159836, "time": "2012-06-08T17:04:53Z", "bug_id": 53381, "creation_time": "2012-06-08T17:04:53Z", "is_private": false, "attachment_id": null}]
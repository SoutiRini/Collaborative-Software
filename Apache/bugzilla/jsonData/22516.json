[{"attachment_id": null, "tags": [], "bug_id": 22516, "is_private": false, "count": 0, "id": 42920, "time": "2003-08-18T14:17:25Z", "creator": "arthur.luimes@ins.com", "creation_time": "2003-08-18T14:17:25Z", "text": "During a loadtest with 20 concurrent users, Apache 2.0.47 (using all default \nconfig values) crashes on HP-UX 11.00. The error messages are:\n[Mon Aug 18 15:35:06 2003] [emerg] (28)No space left on device: couldn't grab \nthe accept mutex\n[Mon Aug 18 15:35:06 2003] [alert] Child 2349 returned a Fatal error...\nApache is exiting!\n[Mon Aug 18 15:35:06 2003] [emerg] (36)Identifier removed: couldn't grab the \naccept mutex\n[Mon Aug 18 15:35:06 2003] [emerg] (36)Identifier removed: couldn't grab the \naccept mutex\n[Mon Aug 18 15:35:06 2003] [emerg] (36)Identifier removed: couldn't grab the \naccept mutex\n... etc....\n\nThere is plenty of space on all devices: this could not be the issue. I've \ntried adjusting some HP paramateres as in the HP thread:\nhttp://forums.itrc.hp.com/cm/QuestionAnswer/0,,0xf91e36e69499d611abdb0090277a778\nc,00.html\n\nAll to no avail. \n\nMy system is now an easy target for DOS attacks. What to do?\n\nP.S. I've load-tested the sever with 10 concurrent users and find no problems."}, {"count": 1, "tags": [], "bug_id": 22516, "text": "What kind of accept mutex are you using?\n\nTo determine this:\n\n1st see if there is an AcceptMutex directive in your configuration file\nif not, the output of \"apachectl -V\" tells what is the compiled-in default\n\nI think it will say\n\n -D APR_USE_SYSVSEM_SERIALIZE\n -D APR_USE_PTHREAD_SERIALIZE\n\nwhich means that SysV semaphores are used for cross-process locks\nand pthread mutexes are used for intra-process locks\n\nmeanwhile, ENOSPC (no space left on device) is an error associated with SysV\nsemaphores, and it has nothing to do with available filesystem space\n\nAssuming you're really using SysV semaphores:\n\na) the problem may be some OS tuning issue...  increase any system tuning\nassociated with SysV sems until the problem goes away\nb) if you can't get it tuned properly, switch to a different mutex mechanism,\nsuch as fcntl, by putting something like this in your config file:\n\n  AcceptMutex fcntl\n\nNote that fcntl mutexes have their own issues.  For starters, if your server\nroot is on a remote filesystem, you'll need to use the LockFile directive.", "id": 42922, "attachment_id": null, "creator": "trawick@apache.org", "creation_time": "2003-08-18T14:27:58Z", "time": "2003-08-18T14:27:58Z", "is_private": false}, {"count": 2, "tags": [], "creator": "arthur.luimes@ins.com", "text": "Jeff,\n\nThe setting AcceptMutex fcntl solved the issue! Thanks a lot!!\n\nWhat kind of issues you mentioned below can I expect with fcntl?", "id": 42926, "time": "2003-08-18T15:24:13Z", "bug_id": 22516, "creation_time": "2003-08-18T15:24:13Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "trawick@apache.org", "text": "What issues to expect with fcntl?  I have relatively little HP-UX specific\nknowledge.  Some of the issues that have come up on other platforms include:\n\nfcntl may not perform as well as SysV semaphore or cross-process pthread locks\n\nfcntl may have tuning requirements also, and if you add additional child\nprocesses to the server to handle increased load you may suddenly hit an\nfcntl-related tuning issue\n\nBTW, somebody reported the same problem a couple of days earlier (PR 22484). \nI'll change the closing status of this one to a dup of that one.\n", "id": 42976, "time": "2003-08-19T11:20:37Z", "bug_id": 22516, "creation_time": "2003-08-19T11:20:37Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 22516, "text": "\n\n*** This bug has been marked as a duplicate of 22484 ***", "count": 4, "id": 42977, "time": "2003-08-19T11:20:51Z", "creator": "trawick@apache.org", "creation_time": "2003-08-19T11:20:51Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 51392, "text": "Created attachment 27169\nPatches apr_pools.c and apr_pools.h to add thread-safe pools\n\nThere are times that I want to use a data structure across multiple threads, adding to it if necessary. Not in Apache Web Server, but in dedicated projects that use the APR library.\n\nI have proposed to add the apr_pool_create_threadsafe and (_ex and _ex_debug functions) which set a boolean flag in apr_pool_t to indicate that allocations should be protected by the pool's mutex.\n\nConsider the situation where you create two apr_hash_t variables, and then spawn off n threads to process a CPU intensive operation, each thread updating the two variables as they see fit (appropriately locking each one as it is accessed). If the two hashes are from the same pool it is possible they could corrupt the pool if grown at the same time.\n\nAlso stopped apr_pool_check_integrity() from complaining if a thread-safe pool is not owned by current thread (in fact, it shouldn't complain at all when creating pools because pool creation is thread-safe anyway).\n\nUntested - but should give a taste for others should they wish to have such functionality.", "id": 147227, "attachment_id": 27169, "creator": "bugzilla@pirosa.co.uk", "creation_time": "2011-06-17T11:02:35Z", "time": "2011-06-17T11:02:35Z", "is_private": false}]
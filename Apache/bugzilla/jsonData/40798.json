[{"count": 0, "tags": [], "bug_id": 40798, "attachment_id": null, "id": 94975, "time": "2006-10-19T05:46:18Z", "creator": "mikev@ci-inc.com", "creation_time": "2006-10-19T05:46:18Z", "is_private": false, "text": "I have two page-masters defined, with one having a different footer than the \nother.\n\nWhen this renders to a 2+ page document, the last page gets the last footer \nand the other pages get the other footer.\n\nWhen it renders to a 1 page document, I get the \"any\" page footer, even though \nthe the page is the last page....\n\nI've posted on nabble.com, and gotten replies that it is possibly a bug.\n\nThis is used to create business forms (like an order), so the total number of \npages is unknown. The last footer is used to display a Sub-Total, Tax and \nGrand Total.\n\nSnippet of the code:\n\n<fo:layout-master-set> \n  <fo:simple-page-master master-name=\"default-page\" \n                         page-height=\"11in\" \n                         page-width=\"8.50in\" \n                         margin-top=\"0.25in\" \n                         margin-left=\"0.25in\" \n                         margin-right=\"0.25in\" \n                         margin-bottom=\"0.25in\"> \n<!-- space needed for header & footer tables --> \n  <fo:region-body           \n   region-name=\"body\" \n   margin-top=\"0in\" \n                         margin-bottom=\"1.50in\"/> \n  <fo:region-before region-name=\"header\" extent=\"10.0in\"/> <!-- space needed \nfor header table --> \n  <fo:region-after region-name=\"footer\" extent=\"1.50in\"/> <!-- space needed \nfor footer table --> \n  <fo:region-start  extent=\"0.00in\"/> \n  <fo:region-end    extent=\"0.00in\"/> \n  </fo:simple-page-master> \n  \n  \n  <fo:simple-page-master master-name=\"last-page\" \n   page-height=\"11in\" \n   page-width=\"8.50in\" \n   margin-top=\"0.25in\" \n   margin-left=\"0.25in\" \n   margin-right=\"0.25in\" \n   margin-bottom=\"0.25in\"> \n   <!-- space needed for header & footer tables --> \n   <fo:region-body           \n    region-name=\"body\" \n    margin-top=\"0in\" \n    margin-bottom=\"1.50in\"/> \n   <fo:region-before region-name=\"header\" extent=\"10.0in\"/> <!-- space needed \nfor header table --> \n   <fo:region-after  region-name=\"last-footer\" extent=\"1.50in\"/> <!-- space \nneeded for footer table --> \n   <fo:region-start  extent=\"0.00in\"/> \n   <fo:region-end    extent=\"0.00in\"/> \n  </fo:simple-page-master> \n  \n  \n  <fo:page-sequence-master master-name=\"all\"> \n   <fo:repeatable-page-master-alternatives> \n\n    <fo:conditional-page-master-reference \n     page-position=\"last\" master-reference=\"last-page\"/> \n    \n    <fo:conditional-page-master-reference \n     page-position=\"any\" master-reference=\"default-page\" /> \n\n   </fo:repeatable-page-master-alternatives> \n  </fo:page-sequence-master> \n </fo:layout-master-set>"}, {"count": 1, "tags": [], "text": "The problem is in\nConditionalPageMasterReference.isValid(isOddPage, isFirstPage, isLastPage,\nisBlankPage), which says explicitly that a conditional pagemaster reference with\npage-position=\"last\" is not valid for a first page. I do not know at this moment\nif that is correct in view of the FO spec.\n", "attachment_id": null, "bug_id": 40798, "id": 97148, "time": "2006-12-21T04:43:04Z", "creator": "spepping@apache.org", "creation_time": "2006-12-21T04:43:04Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 40798, "attachment_id": null, "id": 98223, "time": "2007-01-18T09:29:26Z", "creator": "ccardelli@iv-srl.it", "creation_time": "2007-01-18T09:29:26Z", "is_private": false, "text": "I am having this same problem in fop on windows.\nIf you do not know if that is correct in view of the FO spec, you may \nleave 'last' as is and support the 'only' trait (both first and last) as \nspecified in XSL-FO 1.1 Recommendation.\nSo, the example stated would work as:\n<fo:conditional-page-master-reference \n     page-position=\"only\" master-reference=\"last-page\"/> \n<fo:conditional-page-master-reference \n     page-position=\"last\" master-reference=\"last-page\"/> \n<fo:conditional-page-master-reference \n     page-position=\"any\" master-reference=\"default-page\" /> \n"}, {"count": 3, "tags": [], "bug_id": 40798, "attachment_id": null, "id": 112204, "time": "2007-12-26T12:17:53Z", "creator": "basura2400@yahoo.es", "creation_time": "2007-12-26T12:17:53Z", "is_private": false, "text": "I have the same problem and I don\u00b4t know the solution for this problem or bug. \nCan you help me?\nI have tried use: page-position=\"only\" but it doesn`t work, I have the next \nerror:\n\norg.apache.fop.fo.PropertyList convertAttributeToProperty\nGRAVE: Ignoring property: page-position=\"only\" <No conversion defined only; \nproperty: 'page-position'>"}, {"count": 4, "tags": [], "text": "Indeed, page-position=\"only\" (which is a XSL 1.1 feature) hasn't been\nimplemented, yet.", "attachment_id": null, "bug_id": 40798, "id": 112222, "time": "2007-12-27T00:34:49Z", "creator": "jeremias@apache.org", "creation_time": "2007-12-27T00:34:49Z", "is_private": false}, {"count": 5, "tags": [], "creator": "basura2400@yahoo.es", "attachment_id": null, "text": "I think must be another solution to get the same thing:\n\n- the last page have a footer (last_footer).\n- the other pages don\u00b4t have a footer.\n\nWhen it renders to a 1 page document, I want this page have a footer\n(last_footer).\n\n\u00bfHow can I get this?\u00bfCan you help me? I have tried other things, such as use a \nfootnote at the end of the body but when the body is filled the footnote is \nplaced at the beginnig of the page (not at the end) or the footnote is cut.\n <fo:block>text of the body</fo:block>\n <fo:block>text of the body</fo:block>\n <fo:block>text of the body</fo:block>\n <fo:block>text of the body</fo:block>\n <fo:block>\t\n  <fo:footnote >\n\t <fo:inline></fo:inline>\n\t <fo:footnote-body>\n\t     <xsl:call-template name=\"last_footer\"></xsl:call-template>\n\t </fo:footnote-body> \n  </fo:footnote>\n</fo:block>\n\n\n\n", "id": 112224, "time": "2007-12-27T02:11:39Z", "bug_id": 40798, "creation_time": "2007-12-27T02:11:39Z", "is_private": false}, {"count": 6, "tags": [], "text": "Hi,\n\nI have been searching a solution for this bug but it's impossible!!! I think \nthe only solution will be implement page-position=\"only\" (which is a XSL 1.1 \nfeature)in the next version of FOP.\n\n\n\n", "is_private": false, "id": 112460, "creator": "basura2400@yahoo.es", "time": "2008-01-03T06:18:20Z", "bug_id": 40798, "creation_time": "2008-01-03T06:18:20Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 40798, "attachment_id": null, "id": 118398, "time": "2008-07-08T13:59:23Z", "creator": "dgerdt@bju.edu", "creation_time": "2008-07-08T13:59:23Z", "is_private": false, "text": "Looking for a solution to this first page/last page problem I found a potential solution written by Ken Holman [1]. I assumed because he used it (and he seems to know a little about the subject ;)  ) I had found my solution. (I hadn't discovered this bug yet...)\n\nHowever, the solution he provides doesn't work with FOP because as Simon points out above \"ConditionalPageMasterReference.isValid(isOddPage, isFirstPage, isLastPage,isBlankPage) ... says explicitly that a conditional pagemaster reference with page-position=\"last\" is not valid for a first page.\" Looking at the spec [2][3] I can't see any reason why that should be the case, though I'm no expert in the spec, to be sure. Can one of the devs comment on this?\n\nAs a fix, I reordered the if statement in ConditionalPageMasterReference.isValid so that the block for isLastPage comes before the block for isFirstPage and removed 'return false' when pagePosition == EN_FIRST in the isLastPage block (see code below). This appears to fix the problem, at least for Ken's test file. Anyone see where this might blow up in my face somewhere else? I ran the test suite and everything seemed to come out fine.\n\nThe test case is attached.\n\n[1] http://services.renderx.com/lists/xep-support/3856.html\n[2] http://www.w3.org/TR/2001/REC-xsl-20011015/slice6.html#fo_repeatable-page-master-alternatives\n[3] http://www.w3.org/TR/2001/REC-xsl-20011015/slice7.html#page-position\n\nReordered 'if' from ConditionalPageMasterReference.isValid:\n==================\nif (isOnlyPage) {\n    if (pagePosition != EN_ONLY) {\n\treturn false;\n    }\n} else if (isLastPage) {\n    if (pagePosition == EN_REST) {\n\treturn false;\n    } else if (pagePosition == EN_FIRST) {\n\t//return false;\n    }\n} else if (isFirstPage) {\n    if (pagePosition == EN_REST) {\n\treturn false;\n    } else if (pagePosition == EN_LAST) {\n\treturn false;\n    }\n} else {\n    if (pagePosition == EN_FIRST) {\n\treturn false;\n    } else if (pagePosition == EN_LAST) {\n\treturn false;\n    }\n}"}, {"count": 8, "tags": [], "text": "Created attachment 22237\nTest whether a 'first' page can also be a 'last' page\n\nTest case for last page as first page bug.", "is_private": false, "id": 118399, "creator": "dgerdt@bju.edu", "time": "2008-07-08T14:02:49Z", "bug_id": 40798, "creation_time": "2008-07-08T14:02:49Z", "attachment_id": 22237}, {"count": 9, "tags": [], "bug_id": 40798, "attachment_id": 22617, "id": 120821, "time": "2008-09-20T06:40:26Z", "creator": "adelmelle@apache.org", "creation_time": "2008-09-20T06:40:26Z", "is_private": false, "text": "Created attachment 22617\nChanges necessary to implement page-position=\"last\"\n\nJust thought I'd have a look into this, and AFAICT, implementing page-position=\"only\" would not really be that complex. Parts of it already have, but org.apache.fop.layoutmgr.PageProvider always passes false for the 'isOnlyPage' parameter.\n\nNow, I'm wondering whether this should be a parameter at all... If we pass isFirstPage and isLastPage, then isOnlyPage is always implied (?)\n\nLooking at the tests in ConditionalPageMasterReference.isValid() a little closer, this also needed some work to /properly/ take into account page-position=\"only\". Before the patch, a master-reference with this attribute-value will make isValid() always return true, even if isOnlyPage is set to false.\n\nThe small patch in attach fixes the issue in PageProvider (but does not yet eliminate the superfluous parameter). The changes in ConditionalPageMasterReference, IMO, perfectly reflect the definition of the values in the XSL-FO 1.1 Rec 6.4.12: ... \"first\", \"last\", \"only\" (both first and last), \"rest\" (not first nor last) or \"any\" (all of the previous).\n\nSo, it does not really 'fix' the issue of not being able to use a 'last' page-master-reference for a first page. The only ones eligible in that case are those with page-position 'only' or 'any'.\n\nThe correct specification for the document in attachment 22237 would be (IIC):\n\n...\n   <page-sequence-master master-name=\"whatever\">\n     <repeatable-page-master-alternatives maximum-repeats=\"no-limit\">\n       <conditional-page-master-reference master-reference=\"only-page-layout\"\n                                          page-position=\"only\"/>\n       <conditional-page-master-reference master-reference=\"first-page-layout\"\n                                          page-position=\"first\"/>\n       <conditional-page-master-reference master-reference=\"last-page-layout\"\n                                          page-position=\"last\"/>\n       <conditional-page-master-reference master-reference=\"rest-page-layout\"\n                                          page-position=\"rest\"/>\n     </repeatable-page-master-alternatives>\n   </page-sequence-master>\n...\n\nThis works perfectly after applying the patch, and breaks no other testcases, so I'm contemplating a commit."}, {"count": 10, "tags": [], "bug_id": 40798, "attachment_id": null, "is_private": false, "id": 120822, "time": "2008-09-20T07:02:28Z", "creator": "adelmelle@apache.org", "creation_time": "2008-09-20T07:02:28Z", "text": "(In reply to comment #9)\n> So, it does not really 'fix' the issue of not being able to use a 'last'\n> page-master-reference for a first page. The only ones eligible in that case are\n> those with page-position 'only' or 'any'.\n> \n> The correct specification for the document in attachment 22237 [details] would be (IIC):\n\nOTOH, just tested some more, and the workaround with using multiple repeatable page-master-alternatives also works correctly after the patch.\n"}, {"count": 11, "tags": [], "bug_id": 40798, "attachment_id": 22619, "id": 120827, "time": "2008-09-20T10:47:44Z", "creator": "adelmelle@apache.org", "creation_time": "2008-09-20T10:47:44Z", "is_private": false, "text": "Created attachment 22619\nPath including a bit more refactoring\n\nA more invasive patch, basically with the same result. \nThe isOnlyPage parameter has been removed from the picture. This affects a handful of classes in the org.apache.fop.fo.pagination package and the RTFHandler. \nThe isValid() method has been rewritten entirely as one compact boolean expression, clearly reflecting when a the conditional-page-master is considered valid (at least to me... :-/)\n\nIf no one objects, I'll commit those changes along with some testcases somewhere next week."}, {"count": 12, "tags": [], "text": "Created attachment 22621\nSame as the previous, but with two added testcases", "is_private": false, "id": 120833, "creator": "adelmelle@apache.org", "time": "2008-09-21T03:09:17Z", "bug_id": 40798, "creation_time": "2008-09-21T03:09:17Z", "attachment_id": 22621}, {"count": 13, "tags": [], "text": "\nPatch in attachment 22621 applied to FOP Trunk.\n\nsee: http://svn.apache.org/viewvc?rev=698280&view=rev\n\nApologies for the rather long delay...\n\nThanks for reporting, and for the input/feedback!", "attachment_id": null, "bug_id": 40798, "id": 120894, "time": "2008-09-23T11:50:55Z", "creator": "adelmelle@apache.org", "creation_time": "2008-09-23T11:50:55Z", "is_private": false}, {"count": 14, "tags": [], "bug_id": 40798, "attachment_id": null, "id": 121184, "time": "2008-10-03T11:48:13Z", "creator": "dgerdt@bju.edu", "creation_time": "2008-10-03T11:48:13Z", "is_private": false, "text": "(In reply to comment #13)\n> Patch in attachment 22621 [details] applied to FOP Trunk.\n> \n> see: http://svn.apache.org/viewvc?rev=698280&view=rev\n> \n> Apologies for the rather long delay...\n> \n> Thanks for reporting, and for the input/feedback!\n> \n\nThanks for this work, Andreas! This means I can now use an unmodified version of FOP. Very helpful."}, {"count": 15, "tags": [], "bug_id": 40798, "attachment_id": null, "id": 135200, "time": "2010-03-09T15:09:18Z", "creator": "mark.anderson@technique-group.com", "creation_time": "2010-03-09T15:09:18Z", "is_private": false, "text": "Hi Guys\n\nI'm using FOP 0.95 and page-properties=\"only\" doesn't seem to work. (Every page is treated as an only page.) It's working OK in several other FO Processors so I assume my FO is OK.\n\nif it's fixed in 0.92 shouldn't it work in 0.95?\n\nRegards\n\nMark"}, {"count": 16, "tags": [], "bug_id": 40798, "attachment_id": null, "id": 155893, "time": "2012-04-01T06:47:15Z", "creator": "gadams@apache.org", "creation_time": "2012-04-01T06:47:15Z", "is_private": false, "text": "batch transition pre-FOP1.0 resolved+fixed bugs to closed+fixed"}]
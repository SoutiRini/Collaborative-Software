[{"count": 0, "tags": [], "bug_id": 47432, "text": "Created attachment 23884\nxlsx file generated by POI that cannot be opened by OpenOffice\n\nAfter creating an xlsx file with the following sample code, and opening it with OpenOffice 3.x, first it prompts me for the file type, then I choose Microsoft Office 2007 XML, then I get a \"General Error. General input/output error\".  \n\nIf you open the xlsx file with Excel 2007, then save it, it is then openable by OpenOffice.  Also, OpenOffice automatically detects the file type, so it opens immediately.\n\nI did some investigation, and found that after opening/saving the xlsx file with Excel, the _rels/.rels file is changed (by Excel) to remove the leading slashes from the Target property of the Relationship tag.  If I take the file generated by the code below, and manually remove the leading slashes from the Target entries in the _rels/.rels file, the file is openable by OpenOffice.  \n\nWhen looking at the ECMA-376 docs, page 67, it shows the Relationship/Target entries without leading slashes on them.  So I believe POI is creating files that aren't valid with respect to the Target tag.  Excel seems to be lenient in reading them, (and removing the badness when re-saving), and OpenOffice is just failing completely upon trying to parse the files.\n\nI will attach two xlsx files.  One generated by the code below that cannot be opened by OpenOffice (test-bad.xlsx) and one that has been manually fixed that can be opened by OpenOffice (test-fixed.xlsx).\n\nI looked into trying to fix POI to remove the leading slashes, but I quickly ran into some issues with the code in openxml4j which has special checking to make SURE these entries have leading slashes!    (Line 391 in org.apache.poi.openxlm4j.opc.PackagePartName.java)\n\nSample code to generate a workbook.  (Every workbook I have generated with POI 3.5-beta6 cannot be opened by OpenOffice in my testing)\n\n  try {\n    XSSFWorkbook wb = new XSSFWorkbook();\n    Sheet sheet = wb.createSheet();\n    OutputStream out = new FileOutputStream(new File(\"test-bad.xlsx\"));\n    wb.write(out);\n    out.flush();\n    out.close(); \n  } catch (Exception e) {\n    e.printStackTrace();\n  }\n\n\n\n_rels/.rels contents that OpenOffice errors parsing:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">\n    <Relationship Id=\"rId1\" Target=\"/xl/workbook.xml\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument\"/>\n    <Relationship Id=\"rId2\" Target=\"/docProps/core.xml\" Type=\"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties\"/>\n</Relationships>\n\n_rels/.rels contents that makes OpenOffice able to read files (only removed leading slashes from Target entries):\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Relationships xmlns=\"http://schemas.openxmlformats.org/package/2006/relationships\">\n    <Relationship Id=\"rId1\" Target=\"xl/workbook.xml\" Type=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument\"/>\n    <Relationship Id=\"rId2\" Target=\"docProps/core.xml\" Type=\"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties\"/>\n</Relationships>\n\nThanks,\n--Leif", "id": 128297, "time": "2009-06-25T17:33:41Z", "creator": "lnelson@llnl.gov", "creation_time": "2009-06-25T17:33:41Z", "is_private": false, "attachment_id": 23884}, {"count": 1, "tags": [], "creator": "lnelson@llnl.gov", "attachment_id": 23885, "text": "Created attachment 23885\nxlsx file that has been \"fixed\" to be readable by OpenOffice", "id": 128298, "time": "2009-06-25T17:34:17Z", "bug_id": 47432, "creation_time": "2009-06-25T17:34:17Z", "is_private": false}, {"count": 2, "tags": [], "creator": "lnelson@llnl.gov", "text": "\n\n*** This bug has been marked as a duplicate of bug 46419 ***", "id": 128323, "time": "2009-06-26T08:14:49Z", "bug_id": 47432, "creation_time": "2009-06-26T08:14:49Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 47432, "attachment_id": null, "text": "Leif,\n\nI suggest you vote for this bug on openoffice.org: http://www.openoffice.org/issues/show_bug.cgi?id=97460\n\nAccording to their rules, additional vote should prioritize this bug to an upper level. I hope it will influence OO developers to fix it.\n\nRegards,\nYegor", "id": 128340, "time": "2009-06-27T04:43:54Z", "creator": "yegor@dinom.ru", "creation_time": "2009-06-27T04:43:54Z", "is_private": false}, {"count": 4, "tags": [], "creator": "lnelson@llnl.gov", "text": "Yegor,\n\nI added as many votes as I could for the OpenOffice issue.\n\nThanks!\n--Leif", "id": 128389, "time": "2009-06-29T07:51:48Z", "bug_id": 47432, "creation_time": "2009-06-29T07:51:48Z", "is_private": false, "attachment_id": null}]
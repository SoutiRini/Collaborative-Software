[{"count": 0, "tags": [], "creator": "bjoern@syltonline.de", "is_private": false, "text": "I set up a proof-of-concept on a Windows 2k3 Server std-ed (patched up-to-\ndate) with IIS6, JK 2.0.4 and Tomcat 5.0.27. IIS acts as the frontend-\nwebserver and does the authentication. It passes requests to the application-\ncontexts to the tomcats via JK2 / AJP13.\n\nI was glad to hear that you lot work on runtime reconfiguration for JK2, so \nthat draining a tomcat-node of the cluster is possible  without loosing a \nsingle request or session. I got it all working nicely, having a close eye on \nthe docu and status page of JK.\n\nProblem: When i reconfigure the workers2.properties , the status page of JK \nrecognizes the change nicely (scoreboard info increases version and \nsays \"Updated config version to 1 Status information for child 0\n\"). But it doesn't update to the new values! And yes, I did increase the \nversion number. I can't set a worker graceful=1 or alter the LB-Factor. But \none thing works in runtime: When I add a worker, the JK takes it without a \nproblem while running. But not when I delete one. As soon as i restart the \nApplication-pool, all changes are taken nicely, but that's equivalent to \nrestarting the Webserver.\n\n-----------------------------------------------------------------------\nmy workers.properties:\n# Config-Reconfiguration ?!\n[config:]\ninfo=Defined in mod_jk2.conf.\n# file=${serverRoot}/conf/workers2.properties\nversion=2\ndebug=0\ndebugEnv=0\n\n[shm:]\ninfo=Shared Memory for Scoreboard. Required for reconfiguration and status \nwith multiprocess servers.\nversion=2\n#file=D:\\Java\\shm\\jkconector.sharedmemfile.shm\nfile=anonymous\n\n# Global Parameters\n[workerEnv:]\ninfo=Global server options.\nsslEnable=0\ntiming=0\nlogger=logger.file:0\n\n# Alternate file logger (Default is System Log (Events))\n[logger.file:0]\ninfo=Where to put the mod_jk2 mainlog.\nfile=D:\\Java\\Jakarta-connector\\web_tom5test-jk2.0.4\\jk2.2.log\nlevel=info\n\n# Channel-Konfiguration\n[channel.socket:localhost:8009]\ninfo=LOCAL Worker Channel 1\nversion=21\nport=8009\nhost=localhost\n\n[channel.socket:localhost:9009]\ninfo=LOCAL Worker Channel 2\nversion=21\nport=9009\nhost=localhost\n\n[status:status]\ninfo=Status worker, displays runtime information\n\n# Loadbalancer-Konfiguration\n# Use even if you only have one machine.\n[lb:loadbalancer]\nversion=18\n#worker=localhost:8009\n#worker=localhost:9009\ntimeout=10\nrecovery=10\nattempts=3\nstickySession=0\n\n# Worker-Konfiguration\n[ajp13:localhost:8009]\nversion=21\nchannel=channel.socket:localhost:8009\ntimeout=10\nlb_factor=100\nlevel=1\ngroup=loadbalancer\ntomcatId=TSPS1_I1\nroute=TSPS1_I1\ngraceful=0\n\n[ajp13:localhost:9009]\nversion=21\nchannel=channel.socket:localhost:9009\ntimeout=10\nlb_factor=100\nlevel=1\ngroup=loadbalancer\ntomcatId=TSPS1_I2\nroute=TSPS1_I2\ngraceful=0\n\n# URI-Mapping-Konfiguration\n# Map the Tomcat examples webapp to the Web server uri space\n#[uri:/jsp-examples/*]\n#info=Standard-Examples, u.a. Snoop.jsp\n#version=200407233\n#group=lb:loadbalancer\n\n[uri:tom5test-jk1.2.4.app.pw.de/jsp-examples/*]\n#info=Standard-Examples, u.a. Snoop.jsp\n#version=200407232\n#debug=1\n#disables=0\n#context=/jsp-examples/\ngroup=lb:loadbalancer\n\n[uri:tom5test-jk2.0.4.app.pw.de/jsp-examples/*]\n#info=Standard-Examples, u.a. Snoop.jsp\n#version=200407232\n#debug=1\n#disables=0\n#context=/jsp-examples/\ngroup=lb:loadbalancer\n\n\n[uri:/jkstatus/*]\ninfo=The Tomcat /jkstatus handler\nworker=status:status\n\n\n-----------------------------------------------------------------------\nMy Registry-settings:\nsome are not nessesary, I know. ServerRoot is intended to be a random string, \nsee BUG 30286.\n\nWindows Registry Editor Version 5.00\n\n[HKEY_LOCAL_MACHINE\\SOFTWARE\\Apache Software Foundation\\Jakarta Isapi \nRedirector\\2.0]\n\"extensionUri\"=\"/jakarta/isapi_redirector2.dll\"\n\"workersFile\"=\"D:\\\\Java\\\\Jakarta-connector\\\\web_tom5test-jk2.0.4\n\\\\conf\\\\workers2.properties\"\n\"logLevel\"=\"debug\"\n\"uri_select\"=\"parsed\"\n\"log_file\"=\"D:\\\\Java\\\\Jakarta-connector\\\\web_tom5test-jk2.0.4\\\\log.txt\"\n\"serverRoot\"=\"c:\\\\prrrrruuu\"\n\nPlease help on this one, because Draining of nodes is vital for a clustered \nhigh-availability environment.\n\nthanks\nBj\u00f6rn Andersen", "id": 61309, "time": "2004-07-29T13:58:17Z", "bug_id": 30383, "creation_time": "2004-07-29T13:58:17Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "bjoern@syltonline.de", "is_private": false, "text": "First, sorry for pasting my config - I should have attached it, i konw. But \nnow I can't change it.\n\nI\u2019ve tried to reconfigure JK2 via configfile and JMX.\n\n1. Via configfile, it displays that the file has changed in the scoreboard, \nbut doesn't update the settings.\n\n2. Via JMX, the JK2 takes the changes, but it doesn't write the configfile \n(workers2.properties) as mentioned in \nso other threads have no chance to get the changes - which I'd doubt the'd do \nanyway, because of point 1.\n\nHas anyone ever got runtime-reconfiguration working on W2k3, IIS6 (IIS6-Mode) \nand JK2.0.4?\n", "id": 61803, "time": "2004-08-11T10:53:12Z", "bug_id": 30383, "creation_time": "2004-08-11T10:53:12Z", "attachment_id": null}, {"count": 2, "tags": [], "text": "Created attachment 12389\nJK2 log when reconfigure JK2 via config-file", "is_private": false, "id": 61808, "creator": "bjoern@syltonline.de", "time": "2004-08-11T12:00:56Z", "bug_id": 30383, "creation_time": "2004-08-11T12:00:56Z", "attachment_id": 12389}, {"count": 3, "tags": [], "bug_id": 30383, "attachment_id": null, "text": "I made it work. Problem was that the Website was outdated.\nThe info on \nhttp://jakarta.apache.org/tomcat/connectors-\ndoc/jk2/jk2/configwebcom.html#Common%20properties\nis invalid! It sais that \"version\" is a common property, instead, it is \"ver\".\nAlso on \nhttp://jakarta.apache.org/tomcat/connectors-\ndoc/jk2/jk2/installhowto.html#Installation\nit sais that the registry entry HKEY_LOCAL_MACHINE\\SOFTWARE\\Apache Software \nFoundation\\Jakarta Isapi Redirector\\2.0\" -> \"serverRoot\" has to point to the \ntomcat Installation. This does not apply on windows-systems, when the tomcat \nis on a different server. Instead, this entriy HAS TO point to the dir where \nworkers2.properties resides.\n\nWith that corrected, it works.\n", "id": 61812, "time": "2004-08-11T13:06:08Z", "creator": "bjoern@syltonline.de", "creation_time": "2004-08-11T13:06:08Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 30383, "attachment_id": null, "id": 61816, "time": "2004-08-11T13:21:42Z", "creator": "bjoern@syltonline.de", "creation_time": "2004-08-11T13:21:42Z", "is_private": false, "text": "*** Bug 30286 has been marked as a duplicate of this bug. ***"}]
[{"count": 0, "tags": [], "bug_id": 13843, "is_private": false, "id": 24983, "creation_time": "2002-10-22T09:55:59Z", "time": "2002-10-22T09:55:59Z", "creator": "cmarton@calendra.com", "text": "Some JSP are locked by Tomcat at runtime. The file is locked after the first\naccess to the web page with the browser.\n\nAfter investigation I found that the following code performs the lock on some\nfiles: \n\nClass org.apache.servlet.JspServlet\n\nprivate void serviceJspFile(HttpServletRequest request,\n                                HttpServletResponse response, String jspUri,\n                                Throwable exception, boolean precompile)\n        throws ServletException, IOException {\n\n   JspServletWrapper wrapper =\n            (JspServletWrapper) rctxt.getWrapper(jspUri);\n   if (wrapper == null) {\n       // First check if the requested JSP page exists, to avoid\n       // creating unnecessary directories and files.\n            \n       if (context.getResourceAsStream(jspUri)== null) {\n              response.sendError(HttpServletResponse.SC_NOT_FOUND, jspUri);\n              return;\n       }\n       .....\n\n\ncontext.getResourceAsStream(jspUri) locks some files on Windows. It seems to be\nrelated to file size. I tried on a dumb big page filled with only text (50ko):\nit locks, with the same page with less text (5ko) the page is not locked.\n\nAs a concequence, the opened inputStream should be closed even if it is not read.\nThe following code do not lock files anymore:\n\n   java.io.InputStream resourceStream=context.getResourceAsStream(jspUri);\n   if (resourceStream == null) {\n       response.sendError(HttpServletResponse.SC_NOT_FOUND, jspUri);\n       return;\n    }else{\n        try{\n            resourceStream.close();\n        }catch(IOException e) { /* ignore */ }\n    }\n\nIMPORTANT: to reproduce problem. Files seems not be locked on a new compiled\npage. After modiying a JSP, restart Tomcat, access the web page and check if you\ncan rename the corresponding JSP file.", "attachment_id": null}, {"count": 1, "tags": [], "creator": "jakarta@trollingers.com", "attachment_id": null, "id": 24984, "time": "2002-10-22T11:19:14Z", "bug_id": 13843, "creation_time": "2002-10-22T11:19:14Z", "is_private": false, "text": "\n\n*** This bug has been marked as a duplicate of 12628 ***"}]
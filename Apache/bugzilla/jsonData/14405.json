[{"count": 0, "tags": [], "bug_id": 14405, "attachment_id": null, "id": 25991, "time": "2002-11-09T06:10:47Z", "creator": "rajeshb@sapient.com", "creation_time": "2002-11-09T06:10:47Z", "is_private": false, "text": "- We have got solaris 8 with 4 CPUs and 8Gb RAM.\n\n- One instance of tomcat 3.3.1 is installed with JDK 1.3.1_05. We use apache \n1.3.27 as the web server.\n\n- After 20 minutes, even when there is not much load, tomcat utilizes 90% of \nthe CPU for no reason.\n\n- There is no i/o wait. Restarting tomcat helps. But after 20 minutes, we face \nthe same problem.\n\n- Tomcat logs do not show anything wrong."}, {"count": 1, "tags": [], "bug_id": 14405, "attachment_id": null, "id": 25992, "time": "2002-11-09T06:30:42Z", "creator": "william.barker@wilshire.com", "creation_time": "2002-11-09T06:30:42Z", "is_private": false, "text": "At a guess, it is either GC or JIT kicking in (the second should be considered \nnormal, and is the most likely if leaving the machine alone, the load drops and \nstays down).  If it is a persistant GC problem, then you'll likely have to \nreview your webapp code.\n\nWithout more information (e.g. a test case), this is likely to get marked as \nINVALID once there is a release plan for 3.3.2."}, {"count": 2, "attachment_id": null, "bug_id": 14405, "text": "GC is not a problem in our case. I tried with -verbose:gc option. Its not \ntaking much time. We have set the following parameters\n\n-XX:PermSize=64M -xms:256Mb -xmx:778Mb. All these parameters are used by JVM \nhotspot and moreover we run tomcat in -server mode of JVM.\n\nWe considered resizing heap size also. But didn't help much. We don't have a \nexact test case as to reproduce the problem\n", "id": 25993, "time": "2002-11-09T06:35:10Z", "creator": "rajeshb@sapient.com", "creation_time": "2002-11-09T06:35:10Z", "tags": [], "is_private": false}, {"count": 3, "tags": [], "creator": "william.barker@wilshire.com", "text": "As I've hinted before, I've seen spikes in usage shortly after restarting on \nSolaris systems due to hotspot's JIT.  In my case, it is usually < 20min, but \nyour mileage may vary depending on what your webapp does.  \n\nWithout a test case, my best advice is to leave it up for at least 30min when \nthis happens.  If the load doesn't drop, then do a \"kill -3 `cat \n$TOMCAT_HOME/logs/tomcat.pid`\" and post the javacore file as an attachment to \nthis bug.", "id": 25997, "time": "2002-11-09T07:04:02Z", "bug_id": 14405, "creation_time": "2002-11-09T07:04:02Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "Sorry about this silly question.\n\ni did a 'ps -ef | grep java' and found out the process id of tomcat and after \nthat i ran \" kill -3 'pid of tomcat' \". It didn't create a coredump. And also \nit didn't kill the java process. Where will the coredump file would be \ngenerated?. It would be great if you could guide me on this.", "attachment_id": null, "bug_id": 14405, "id": 25998, "time": "2002-11-09T07:27:04Z", "creator": "rajeshb@sapient.com", "creation_time": "2002-11-09T07:27:04Z", "is_private": false}, {"count": 5, "attachment_id": null, "bug_id": 14405, "text": "It's in the directory that Tomcat was started from (assuming that the user that \nTomcat is running under has write-permissions to that directory).  I think that \nunder the Sun JVM, it goes to stderr otherwise.  The \"kill -3\" doesn't actually \nkill the JVM, it just tells it to dump the javacore file that says what it is \ndoing at that particular moment.", "id": 25999, "time": "2002-11-09T08:00:25Z", "creator": "william.barker@wilshire.com", "creation_time": "2002-11-09T08:00:25Z", "tags": [], "is_private": false}, {"count": 6, "text": "It seems to be a problem with your web application.\n\nCould you tell use what it does and use (jdbc connections, kind of SQL database).\n\nCould you try it on another platform with another SDK (ie an IBM SDK) ?", "bug_id": 14405, "attachment_id": null, "id": 26052, "time": "2002-11-11T09:03:52Z", "creator": "hgomez@apache.org", "creation_time": "2002-11-11T09:03:52Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "bug_id": 14405, "attachment_id": null, "id": 26054, "time": "2002-11-11T09:52:31Z", "creator": "rajeshb@sapient.com", "creation_time": "2002-11-11T09:52:31Z", "is_private": false, "text": "Thankx a lot for your prompt response.\n\nYes..we are using oracle database in solaris 2.8. We do not see any i/o wait or \nswapping. I read a couple of articles in mailing lists. They claim that, mod_jk \nmight run into a race condition when tomcat is not able to respond for whatever \nreason.\n\nWe are also using mod_jk which was shipped with tomact 3.2.1. We use this for \ntomcat 3.3 with ajp12 protocol.\n\nFrom the mailing list, i got the following code.\n\nstatic int ajpv12_handle_response(ajp12_endpoint_t *p,\n                                  jk_ws_service_t *s,\n                                  jk_logger_t *l)\n{\n    while(1) {\n        unsigned to_read = READ_BUF_SIZE;\n        unsigned acc = 0;\n        char *buf = NULL;\n\n        if(!jk_sb_read(&p->sb, &buf, to_read, &acc)) {\n            jk_log(l, JK_LOG_ERROR, \"ajpv12_handle_response, error\nreading\n from \\n\"); return JK_FALSE;\n        }\n\n        if(!acc) {\n            jk_log(l, JK_LOG_DEBUG, \"ajpv12_handle_response, response\nbody is\n done\\n\"); break;\n        }\n\n        if(write_to_ws) {\n            if(!s->write(s, buf, acc)) {\n                jk_log(l, JK_LOG_ERROR, \"ajpv12_handle_response, error\n writing back to server\\n\"); write_to_ws = JK_FALSE;    <<<<<<<<<HERE\n            }\n        }\n    }\n\nI could see \"ajpv12_handle_response, error writing back to server\" in the \nmod_jk logs. \n\nMy question is :\n- At what condition this will run into a race condition\n- Do we need to upgrade to mod_jk that is shipped with tomcat 3.3\n- What causes this error to happen?\n\n\n"}, {"count": 8, "attachment_id": null, "bug_id": 14405, "text": "Please have a look at the following link to know more about the mod_jk bug.\n\nhttp://marc.theaimsgroup.com/?l=tomcat-user&m=99112351628144&w=2\n\n", "id": 26055, "time": "2002-11-11T09:53:08Z", "creator": "rajeshb@sapient.com", "creation_time": "2002-11-11T09:53:08Z", "tags": [], "is_private": false}, {"count": 9, "tags": [], "creator": "william.barker@wilshire.com", "attachment_id": null, "id": 53582, "time": "2004-03-07T07:17:31Z", "bug_id": 14405, "creation_time": "2004-03-07T07:17:31Z", "is_private": false, "text": "AJP12 is nolonger actively supported."}]
[{"count": 0, "tags": [], "creator": "ssasa@iskon.hr", "is_private": false, "text": "Hi,\n\nwe have a system with two Apache web servers (1.3.26) on Debian Linux\n(Intel) and one Tomcat 4.0.4 final on Solaris 8 (Sparc). The system is\nexperiencing heavy loads. Daily, Tomcat serves 200 000 - 300 000 requests.\nWe have two frontends because of lot of static content. Tomcat runs\non j2se1_4_0_01. We have set maxProcessors in Tomcat Ajp13 connector\nto 800.\n\nFrom time to time on our Apaches jk.log we see these messages:\n\n[Thu Jul 11 16:18:30 2002]  [jk_ajp_common.c (652)]:\najp_connection_tcp_get_message: Error - jk_tcp_socket_recvfull failed\n[Thu Jul 11 16:18:30 2002]  [jk_ajp_common.c (1013)]: Error reading reply\n[Thu Jul 11 16:18:30 2002]  [jk_ajp_common.c (1150)]: In jk_endpoint_t::service,\najp_get_reply failed in send loop 0\n[Thu Jul 11 16:18:44 2002]  [jk_ajp_common.c (652)]:\najp_connection_tcp_get_message: Error - jk_tcp_socket_recvfull failed\n[Thu Jul 11 16:18:44 2002]  [jk_ajp_common.c (1013)]: Error reading reply\n[Thu Jul 11 16:18:44 2002]  [jk_ajp_common.c (1150)]: In jk_endpoint_t::service,\najp_get_reply failed in send loop 0\n[Thu Jul 11 16:19:08 2002]  [jk_ajp_common.c (652)]:\najp_connection_tcp_get_message: Error - jk_tcp_socket_recvfull failed\n[Thu Jul 11 16:19:08 2002]  [jk_ajp_common.c (1013)]: Error reading reply\n[Thu Jul 11 16:19:08 2002]  [jk_ajp_common.c (1150)]: In jk_endpoint_t::service,\najp_get_reply failed in send loop 0\n\nSometimes we see also these errors:\n\n[Thu Jul 11 16:19:16 2002]  [jk_ajp_common.c (933)]: Error ajp_process_callback\n- write failed\n[Thu Jul 11 16:19:51 2002]  [jk_ajp_common.c (933)]: Error ajp_process_callback\n- write failed\n\nThese errors as a result do not show web pages.\n\nRestart of web servers helps a bit, but when we leave the Apaches to run\nmore hours we run out of Tomcat worker threads (the limit is 800).\nIn the thread dump we can see that almost all of 800 Threads have this\nstack trace:\n\n\"Ajp13Processor[8090][24]\" daemon prio=5 tid=0x327778 nid=0x29 runnable\n[da481000..da4819c0]\n        at java.net.SocketInputStream.socketRead0(Native Method)\n        at java.net.SocketInputStream.read(SocketInputStream.java:116)\n        at org.apache.ajp.Ajp13.readN(Ajp13.java:429)\n        at org.apache.ajp.Ajp13.receive(Ajp13.java:469)\n        at org.apache.ajp.Ajp13.receiveNextRequest(Ajp13.java:274)\n        at org.apache.ajp.tomcat4.Ajp13Processor.process(Ajp13Processor.java:371)\n        at org.apache.ajp.tomcat4.Ajp13Processor.run(Ajp13Processor.java:495)\n        at java.lang.Thread.run(Thread.java:536)\n\nThey are all (almost :) waiting for mod_jk to send something, and mod_jk\ndoesn't send anything. These pointed us that the problem might be in mod_jk.\n\nThere is another problem that we didn't succeed to correlate to the first\none, and this is shown in catalina.out log:\n\nBAD packet 18516\nIn: : [B@9b86ea 4/21588\n48 54 54 50 02 02 00 08 48 54 54 50 2f 31 2e 31  | HTTP....HTTP.1.1\n00 00 0f 2f 73 65 72 76 6c 65 74 2f 61 6e 6b 65  | ....servlet.anke\n74 61 00 00 0f 32 31 33 2e 31 39 31 2e 31 34 33  | ta...213.191.143\n2e 31 33 39 00 ff ff 00 0c 77 77 77 2e 69 73 6b  | .139.....www.isk\n6f 6e 2e 68 72 00 00 50 00 00 08 a0 01 00 38 69  | on.hr..P...?..8i\n6d 61 67 65 2f 67 69 66 2c 20 69 6d 61 67 65 2f  | mage.gif..image.\n78 2d 78 62 69 74 6d 61 70 2c 20 69 6d 61 67 65  | x.xbitmap..image\n2f 6a 70 65 67 2c 20 69 6d 61 67 65 2f 70 6a 70  | .jpeg..image.pjp\n65 67 2c 20 2a 2f 2a 00 a0 03 00 0d 67 7a 69 70  | eg......?...gzip\n2c 20 64 65 66 6c 61 74 65 00 a0 04 00 05 65 6e  | ..deflate.?...en\n2d 75 73 00 a0 06 00 0a 4b 65 65 70 2d 41 6c 69  | .us.?...Keep.Ali\n76 65 00 a0 0b 00 0c 77 77 77 2e 69 73 6b 6f 6e  | ve.?...www.iskon\n2e 68 72 00 a0 0d 00 13 68 74 74 70 3a 2f 2f 77  | .hr.?...http...w\n77 77 2e 69 73 6b 6f 6e 2e 68 72 00 a0 0e 00 2e  | ww.iskon.hr.?...\n4d 6f 7a 69 6c 6c 61 2f 34 2e 30 20 28 63 6f 6d  | Mozilla.4.0..com\n70 61 74 69 62 6c 65 3b 20 4d 53 49 45 20 36 2e  | patible..MSIE.6.\n30 3b 20 57 69 6e 64 6f 77 73 20 39 38 29 00 a0  | 0..Windows.98..?\n08 00 01 30 00 05 00 4a 71 75 65 73 74 69 6f 6e  | ...0...Jquestion\n69 64 3d 32 30 30 32 30 37 31 30 30 32 34 39 30  | id.2002071002490\n31 33 26 6f 70 74 69 6f 6e 69 64 3d 32 30 30 32  | 13.optionid.2002\n30 37 31 30 30 32 35 33 30 31 34 26 73 75 62 6d  | 07100253014.subm\n69 74 2e 78 3d 32 35 26 73 75 62 6d 69 74 2e 79  | it.x.25.submit.y\n3d 38 00 ff 00 00 00 00 00 00 00 00 00 00 00 00  | .8..............\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  | ................\n00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  | ................\n\nDoes anyone have an idea what to investigate further ?\n(or how to solve this problems)\n\nThanks,\n\nSasa Skevin\nssasa@iskon.hr", "id": 19327, "time": "2002-07-11T14:41:26Z", "bug_id": 10698, "creation_time": "2002-07-11T14:41:26Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 10698, "attachment_id": null, "id": 19328, "time": "2002-07-11T14:56:30Z", "creator": "thom@planetarytramp.net", "creation_time": "2002-07-11T14:56:30Z", "is_private": false, "text": "This is a problem report regarding mod_jk, not with apache.\nI have reassigned the problem to tomcat4.\nThanks for using apache!"}, {"attachment_id": null, "tags": [], "bug_id": 10698, "is_private": false, "count": 2, "id": 50665, "time": "2004-01-16T21:03:46Z", "creator": "markt@apache.org", "creation_time": "2004-01-16T21:03:46Z", "text": "I closed this accidentially when clearing up the mess left by the unhelp soul \nthat re-opened a stack of bugs back in October last year."}, {"count": 3, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "text": "This component is now deprecated. If you still experience this issue, please \nupgrade to the Coyote JK2 connector.\n\nNo further work will take place against this bug report.\n\n", "id": 59501, "time": "2004-06-18T18:43:01Z", "bug_id": 10698, "creation_time": "2004-06-18T18:43:01Z", "is_private": false}]
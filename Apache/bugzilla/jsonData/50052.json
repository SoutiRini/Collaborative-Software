[{"count": 0, "tags": [], "creator": "a6537691@bofthew.com", "text": "The LVLF structure contains both PAPX and CHPX. PAPX contains additional SPRMs to be applied to paragraph, CHPX contains SPRMs for formatting the list number.\n\nI will upload a patch that modifies the ListEntry class: in the constructor the internal _props variable will be modified: first SPRMs from ListLevel will be applied, then the SPRMs from Paragraph. Additionally, getter for NumberProperties will be added to ListLevel.", "id": 140537, "time": "2010-10-07T03:55:51Z", "bug_id": 50052, "creation_time": "2010-10-07T03:55:51Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "a6537691@bofthew.com", "attachment_id": 26133, "id": 140541, "time": "2010-10-07T04:56:05Z", "bug_id": 50052, "creation_time": "2010-10-07T04:56:05Z", "is_private": false, "text": "Created attachment 26133\nPatch to support list number format (with testcase)\n\nThe patch contains one inconsistency, but I don't know how to handle it. See the FIXME comment in the test and in the ListEntry class."}, {"count": 2, "tags": [], "creator": "a6537691@bofthew.com", "attachment_id": 26134, "id": 140542, "time": "2010-10-07T04:56:26Z", "bug_id": 50052, "creation_time": "2010-10-07T04:56:26Z", "is_private": false, "text": "Created attachment 26134\nAdded files for the patch"}, {"count": 3, "tags": [], "creator": "yegor@dinom.ru", "text": "The patch breaks a unit test. I'm getting the following exception if I apply the supplied code to trunk (r1005447) :\n\n\njava.lang.IndexOutOfBoundsException: Index: 8, Size: 8\n\tat java.util.ArrayList.RangeCheck(ArrayList.java:547)\n\tat java.util.ArrayList.get(ArrayList.java:322)\n\tat org.apache.poi.hwpf.usermodel.Range.findRange(Range.java:976)\n\tat org.apache.poi.hwpf.usermodel.Range.initCharacterRuns(Range.java:925)\n\tat org.apache.poi.hwpf.usermodel.Range.getCharacterRun(Range.java:785)\n\tat org.apache.poi.hwpf.usermodel.ListEntry.<init>(ListEntry.java:61)\n\tat org.apache.poi.hwpf.usermodel.Range.getParagraph(Range.java:831)\n\tat org.apache.poi.hwpf.usermodel.TestLists.testWriteRead(TestLists.java:206)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\n\n\nYegor", "id": 140560, "time": "2010-10-07T10:14:25Z", "bug_id": 50052, "creation_time": "2010-10-07T10:14:25Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "creator": "a6537691@bofthew.com", "text": "I think this problem is not related to my patch. Problem is in initCharacterRuns() for paragraph 21 in the test document after writing a re-reading the document. If I remove the patch and add:\n  r.getParagraph(21).numCharacterRuns();\nafter line 206 in TestLists.java, it will fail. \n\nAnyway, I will modify my patch not to rely on a single character run to be present in the paragraph. If there is none, it will take the paragraph style as a base.\n\nI will create a new bug with a test case that fails on a version without a patch for this bug applied.", "id": 140590, "time": "2010-10-08T10:05:18Z", "bug_id": 50052, "creation_time": "2010-10-08T10:05:18Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "text": "Created attachment 26139\nPatch to support list number format (with testcase)", "attachment_id": 26139, "bug_id": 50052, "id": 140591, "time": "2010-10-08T10:06:08Z", "creator": "a6537691@bofthew.com", "creation_time": "2010-10-08T10:06:08Z", "is_private": false}, {"count": 6, "tags": [], "creator": "apache@gagravarr.org", "text": "Thinking about your description in comment 1, isn't the inheritance order the wrong way around? If memory serves, if you apply some formatting to a paragraph, then a different value to the same property on a character run, then the one on the character run takes priority. So, shouldn't we apply all the paragraph properties first, then override them with the character ones?\n\nFor the FIXME question on properties, did you take a look in [MS-DOC].pdf to see what that had to say? If there's not an answer in there on how to identify the appropriate properties, then please drop me an email off-list, and I'll try to put you in touch with some contacts in the microsoft docs team who will hopefully be able to find the answer.", "id": 140937, "time": "2010-10-22T12:23:00Z", "bug_id": 50052, "creation_time": "2010-10-22T12:23:00Z", "is_private": false, "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 50052, "text": "Can PAPX and CHPX really modify the same property? PAPX modifies properties of PAP while CHPX modifies properties of CHP, which are two different structures. We don't apply CHPX over PAP, we apply it over another CHP or over default values. We have default CHP for the paragraph - the stylesheet, maybe that's made you wrong. That's how I understand it so far...\n\nFor ListEntries, we have another CHPX for the list level, according to ms spec it should be used to format the list number. Applying it over anything seems incorrect in my tests: over default values is incorrect in all cases, applying over style's CHP is incorrect in some cases and applying it over first character run CHP is incorrect in some other cases.\n\nI could not find any answer in the ms pdf, I'll write you an e-mail from my real address.", "id": 141032, "attachment_id": null, "creator": "a6537691@bofthew.com", "creation_time": "2010-10-26T02:33:00Z", "time": "2010-10-26T02:33:00Z", "is_private": false}]
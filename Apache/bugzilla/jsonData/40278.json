[{"count": 0, "tags": [], "creator": "croller@generali.fr", "attachment_id": null, "is_private": false, "id": 92302, "time": "2006-08-17T14:54:18Z", "bug_id": 40278, "creation_time": "2006-08-17T14:54:18Z", "text": "Hi,\n\nwith an Apache 2.2.3 acting as a reverse proxy (with mod_disk_cache enabled and\nworker), mod_disk_cache delays response (14,95 seconds to get the response) if \nobject (/resources/overlay.png in the capture below) is not expired and mime\ntype is incorrect (text/plain which is default mime type when none is set\ninstead of image/png). Before in the capture, the response is quite\ninstantaneous (0.0009 second) when object is expired.\n\nI solved my problem by setting correct mime type in the webserver for this\nobject, but in my understanding, the behaviour should not be different in both\ncase. Is there any reason that Apache reacts like this ?\n\nThanks in advance\n\n\nIn the following capture, client is 172.30.2.21.\nIncoming Apache's interface is 172.30.13.98 (client side).\nOutgoing Apache's interface is 172.30.13.80 (server side).\nWeb server (Websphere) is 172.30.5.43.\n\nRelevant config is :\nTimeout 1200\nKeepAlive On\nMaxKeepAliveRequests 0\nKeepAliveTimeout 15\n\nServerLimit             32\nStartServers             2\nMaxClients             200\nMinSpareThreads         50\nMaxSpareThreads        125\nThreadsPerChild         50\nMaxRequestsPerChild  10000\n\nTypesConfig conf/mime.types\nDefaultType text/plain\nDeflateBufferSize 8192\nDeflateCompressionLevel 6\nDeflateFilterNote Ratio ratio\nDeflateMemLevel 9\nDeflateWindowSize 15\n\nSetEnvIfNoCase Request_URI\n\"\\.(gif|jpe?g|jpe|jfif|pjpeg|pjp|dcx|xif|png|xbm|ico)$\" no-gzip dont-vary\nSetEnvIfNoCase Request_URI\n\"\\.(mp3|mp2|mpa|abs|mpe?ga|midi?|rmi|wax|wma|ram?|rmm?|wav|m3u|pls|xpl|as|it|mod|s3m|xm|mp1)$\"\nno-gzip dont-vary\nSetEnvIfNoCase Request_URI\n\"\\.(mpv2|mp2v|avi|wmv|asf|asx|wm|ivf|mpe?g|mpe|mpv|m1v|mov|qt|wvx|swf)$\" no-gzip\ndont-vary\nSetEnvIfNoCase Request_URI \"\\.(zip|gz|bz2|rar|ace)$\" no-gzip dont-vary\nSetEnvIfNoCase Request_URI \"\\.(js|css)$\" no-gzip dont-vary\nSetEnvIfNoCase Request_URI \"\\.(pdf)$\" no-gzip dont-vary\nHeader append Vary User-Agent env=!dont-vary\nBrowserMatch MSIE gzip-only-text/html\nAddOutputFilterByType DEFLATE text/html text/plain text/xml text/javascript"}, {"count": 1, "tags": [], "bug_id": 40278, "text": "Created attachment 18728\ntcpdump", "id": 92303, "time": "2006-08-17T14:56:23Z", "creator": "croller@generali.fr", "creation_time": "2006-08-17T14:56:23Z", "is_private": false, "attachment_id": 18728}, {"count": 2, "tags": [], "creator": "kaiowas@gentoo.org", "attachment_id": null, "id": 97118, "time": "2006-12-20T05:34:00Z", "bug_id": 40278, "creation_time": "2006-12-20T05:34:00Z", "is_private": false, "text": "\nI also end up waiting exactly KeepAliveTimeout seconds if I use both mod_deflate\nand mod_disk_cache for cached pages to load (due to a poll() function - as seen\nin the attached strace output). if I disable AddOutputFilterByType, the delay\ngoes away. also the delay is zero if the page has not been cached yet or if it\nexpired. in my case I see no link between the mime type and the delay.\n\nthese are the related configuration settings:\n\nKeepAlive On\nKeepAliveTimeout 15\n\nAddOutputFilterByType DEFLATE text/html text/plain text/xml text/css\n\nCacheEnable disk /\nCacheRoot /var/share/www/vhosts/www.foobar.com/cache\nCacheDisable /images\nCacheStoreNoStore On\nCacheDefaultExpire 3600\nCacheMaxExpire 3600\nCacheMinFileSize 128\nCacheMaxFileSize 128000\n\nthis bug is easily replicable on both linux (mpm-prefork) and even windows."}, {"count": 3, "tags": [], "bug_id": 40278, "attachment_id": 19292, "id": 97119, "time": "2006-12-20T05:34:41Z", "creator": "kaiowas@gentoo.org", "creation_time": "2006-12-20T05:34:41Z", "is_private": false, "text": "Created attachment 19292\napache worker strace"}, {"count": 4, "tags": [], "bug_id": 40278, "text": "That looks very similar to PR40090 for me. Could you please give the patch a try\nthat is attached to this PR and report back?", "id": 97133, "time": "2006-12-20T13:55:47Z", "creator": "rpluem@apache.org", "creation_time": "2006-12-20T13:55:47Z", "is_private": false, "attachment_id": null}, {"count": 5, "tags": [], "bug_id": 40278, "text": "I tried the patch from PR40090, and it solved my problem.(In reply to comment #4)\n> That looks very similar to PR40090 for me. Could you please give the patch a try\n> that is attached to this PR and report back?\n\nthanks, that patch works great. it solved the problem I was having with the\ndelays and no regressions have been found so far. \n\nwill that fix be pushed into version 2.2.4?\n", "id": 97152, "time": "2006-12-21T05:25:46Z", "creator": "kaiowas@gentoo.org", "creation_time": "2006-12-21T05:25:46Z", "is_private": false, "attachment_id": null}, {"text": "\n\n*** This bug has been marked as a duplicate of 40090 ***", "tags": [], "bug_id": 40278, "is_private": false, "count": 6, "id": 97165, "time": "2006-12-21T12:45:41Z", "creator": "rpluem@apache.org", "creation_time": "2006-12-21T12:45:41Z", "attachment_id": null}, {"count": 7, "tags": [], "creator": "rpluem@apache.org", "attachment_id": null, "text": "Proposed for backport as r489460\n(http://svn.apache.org/viewvc?rev489460=&view=rev). I fear it will miss the boat\nfor 2.2.4.", "id": 97168, "time": "2006-12-21T13:08:02Z", "bug_id": 40278, "creation_time": "2006-12-21T13:08:02Z", "is_private": false}]
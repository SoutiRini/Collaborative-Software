[{"count": 0, "tags": [], "bug_id": 36955, "is_private": false, "text": "I build up a path through some init-targets.\nA path reference in a target (target \"init.moreLibs\" in the example below) is\ndefined on execution, even though the enclosing task is *never* executed !\nThe path element with id=\"ref_libs2\" behaves as if it was defined at the top-level.\n\n========== Example build file ===============\n<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<project name=\"test.v1\" default=\"test\" basedir=\".\">\n\n\n<target name=\"init\" depends=\"init.libs\">\n\t<path id=\"ref_cp\">\n\t\t<path refid=\"ref_libs1\"/>\n\t\t<path refid=\"ref_libs2\"/>\n\t</path>\n</target>\n\n\n<target name=\"init.libs\">\n\t<path id=\"ref_libs1\">\n\t\t<pathelement location=\"${ant.home}/lib/xercesImpl.jar\"/>\n\t</path>\t\n</target>\n\n\n<target name=\"init.moreLibs\">\n\t<echo message=\"Executing target 'init.moreLibs'.\"/>\n\t<path id=\"ref_libs2\">\n\t\t<fileset dir=\"${ant.home}/lib\">\n\t\t\t<include name=\"ant*.jar\"/>\n\t\t</fileset>\n\t</path>\t\n</target>\n\n\n<target name=\"test\" depends=\"init\">\n\t<pathconvert property=\"_cp\" refid=\"ref_cp\" pathsep=\"${line.separator}\"/>\n\t<echo>\n\t\t${_cp}\n\t</echo>\n</target>\n\n</project>\n\n====== Result with Ant 1.6.4 and 1.6.5 =====================================\n...\\ant\\bin\\ant.bat -f test1.xml test\njava version \"1.4.2_09\"\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_09-b05)\nJava HotSpot(TM) Client VM (build 1.4.2_09-b05, mixed mode)\n\nBuildfile: test1.xml\n\ninit.libs:\n\ninit:\n\ntest:\n     [echo]\n     [echo]             C:\\seu\\Aus\\Aus_SP\\ant\\lib\\xercesImpl.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-antlr.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-apache-bcel.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-apache-bsf.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-apache-log4j.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-apache-oro.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-apache-regexp.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-apache-resolver.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-commons-logging.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-commons-net.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-icontract.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-jai.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-javamail.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-jdepend.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-jmf.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-jsch.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-junit.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-launcher.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-netrexx.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-nodeps.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-starteam.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-stylebook.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-swing.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-trax.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-vaj.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-weblogic.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-xalan1.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant-xslp.jar\n     [echo] C:\\seu\\Aus\\Aus_SP\\ant\\lib\\ant.jar\n     [echo]\n\nBUILD SUCCESSFUL\nTotal time: 1 second\n\n============== Expected Result - with Ant 1.5.4 ====================\n...\\ant\\bin\\ant.bat -f test1.xml test\nBuildfile: test1.xml\n\ninit.libs:\n\ninit:\nCaught exception (org.apache.tools.ant.BuildException) while expanding ref_cp:\nReference ref_libs2 not found.\n\ntest:\n\nBUILD FAILED\nfile:C:/Projekte/POI/Tde/bin/test1.xml:31: Reference ref_libs2 not found.\n\nTotal time: 0 seconds\n==========================================================================", "id": 80867, "time": "2005-10-06T21:26:38Z", "creator": "avy.sharell@web.de", "creation_time": "2005-10-06T21:26:38Z", "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 36955, "is_private": false, "text": "Created attachment 16621\nShorter example ant-script that demonstrates the behaviour.\n\nAfter further tests it seems that all elements that define references like\nfileset, path, filelist and also the property-task are executed in the order in\nwhich they appear in the file - independent of the execution of enclosing\ntarget.\nIf a target is than executed the value of the reference is redefined.\nSee the attachement \"test3a.xml\".\nTarget test1 shows that the reference is redefined one time.\nTarget test2 shows that the reference is redefined a 2nd time by the\ninit-target.", "id": 80917, "time": "2005-10-07T21:57:10Z", "creator": "avy.sharell@web.de", "creation_time": "2005-10-07T21:57:10Z", "attachment_id": 16621}, {"count": 2, "tags": [], "creator": "peterreilly@apache.org", "text": "Fixed in svn.", "id": 94601, "attachment_id": null, "bug_id": 36955, "creation_time": "2006-10-06T14:26:13Z", "time": "2006-10-06T14:26:13Z", "is_private": false}, {"text": "Despite the claim to the contrary in file WHATSNEW, this bug is NOT fixed in\nversion 1.7.0.\n\nThis is what WHATSNEW says:\n\n* Defer reference process. Bugzilla 36955, 34458, 37688.\n  This may break build files in which a reference was set in a target which was\nnever executed. Historically, Ant would set the reference early on, during parse\ntime, so the datatype would be defined. Now it requires the reference to have\nbeen in a bit of the build file which was actually executed. If you get an error\nabout an undefined reference, locate the reference and move it somewhere where\nit is used, or fix the depends attribute of the target in question to depend on\nthe target which defines the reference/datatype.\n\n---\n\nHere is a test script to prove the point:\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project name=\"test\" default=\"test\">\n    <echo message=\"${ant.version}\"/>\n    <target name=\"never-call\">\n        <path id=\"test.path\" path=\".\"/>\n    </target>\n    <target name=\"test\">\n        <condition property=\"test.path.set\" else=\"false\">\n            <isreference refid=\"test.path\"/>\n        </condition>\n        <echo message=\"test.path setting = ${test.path.set}\"/>\n    </target>\n</project>\n\n---\n\nHere are the results from the test:\n\nC:\\work>ant -f test_build.xml\nBuildfile: test_build.xml\n     [echo] Apache Ant version 1.7.0 compiled on December 13 2006\n\ntest:\nWarning: Reference test.path has not been set at runtime, but was found during\nbuild file parsing, attempting to resolve. Future versions of Ant may support \nreferencing ids defined in non-executed targets.\n     [echo] test.path setting = true\n\nBUILD SUCCESSFUL\nTotal time: 0 seconds\nC:\\work>\n\nIf the fix was in place I would expect \"[echo] test.path setting = false\".\n\n---\n\nFurther info - comment in reply posted to 'user@ant.apache.org':\n\nI've just tested this with svn trunk compiled today (1.7.1alpha) and I get the\nsame behaviour - an 'unexecuted' target containing the ref and an executed\ntarget using the ref and the ref set:\n\nkev@ubuntu-dev:~/workspace/ant-core-trunk$ ant -f test-id.xml\nBuildfile: test-id.xml\n     [echo] Apache Ant version 1.7.1alpha compiled on August 30 2007\n\ntest:\nWarning: Reference test.path has not been set at runtime, but was found during\nbuild file parsing, attempting to resolve. Future versions of Ant may support \nreferencing ids defined in non-executed targets.\n     [echo] test.path setting = true\n\nBUILD SUCCESSFUL\nTotal time: 0 seconds\nkev@ubuntu-dev:~/workspace/ant-core-trunk$\n\n---\n\nFurther info - another comment in reply posted to 'user@ant.apache.org':\n\nThe behavior as described in the WHATSNEW is what was initially was done.\nHowever this broke too many builds - with references to out-of-band ids. So the\ncode was modified to store all the out-of-band ids and if the reference could\nnot be found, to look up that and if found to use that reference and to output a\nlong message.\n\nIn ant 1.8.0, this out-of-band resolution will probably be removed. One could\nchange the <isreference> implementation to report false for out-of-band\nreferences, but I do not think that is a good idea.\n\n", "tags": [], "bug_id": 36955, "attachment_id": null, "count": 3, "id": 107679, "time": "2007-09-04T01:55:52Z", "creator": "george.czernuszka@nscgroup.co.uk", "creation_time": "2007-09-04T01:55:52Z", "is_private": false}, {"text": "Hi, I have updated the WHATSNEW to specify\nthere is a out-of-band reference resolution in\nant 1.7.*.\nWhen this was first put in, there were too many\nant build scripts written by ant developers that\nused out-of-band reference resolution by accident\n(including a number in the ant test set), so it\nwas felt that it would be too big a jump to make the\nchange in ant 1.7.*.\n\nI have modifed ant 1.8.0alpha to disallow out-of-band\nreference resolution.\n", "tags": [], "bug_id": 36955, "is_private": false, "count": 4, "id": 107680, "time": "2007-09-04T02:03:12Z", "creator": "peterreilly@apache.org", "creation_time": "2007-09-04T02:03:12Z", "attachment_id": null}, {"count": 5, "tags": [], "creator": "stevel@apache.org", "attachment_id": null, "id": 107681, "time": "2007-09-04T02:26:47Z", "bug_id": 36955, "creation_time": "2007-09-04T02:26:47Z", "is_private": false, "text": "I worry that blocking OOB resolution, even in Ant1.8, will cause problems. It\nstops you being able to build old build files, which makes it near-impossible to\ncheck out and build old stuff. \n\nif it is to be done, then it has to be optional"}, {"count": 6, "attachment_id": null, "bug_id": 36955, "text": "Perhaps we could have a command line option to enable oob reference\nto allow old build scripts to work.\n\nI would rather not enable this by default, one does get silly\nresults with OOB reference resolution.", "id": 107686, "time": "2007-09-04T03:16:04Z", "creator": "peterreilly@apache.org", "creation_time": "2007-09-04T03:16:04Z", "tags": [], "is_private": false}, {"count": 7, "tags": [], "text": "-I'd be happy with a switch, either on the command line and/or as an ant\nproperty that could be loaded up (though that's a funny about timing)\n\n", "is_private": false, "bug_id": 36955, "id": 107696, "time": "2007-09-04T05:53:40Z", "creator": "stevel@apache.org", "creation_time": "2007-09-04T05:53:40Z", "attachment_id": null}]
[{"text": "I am compiling Apache 2.0.58 on AIX 5.2 as follows following the guidance of\nhttp://people.apache.org/~trawick/apache-2-on-aix.html\n\nI am using:\n\nCC=xlc_r ./configure --prefix=/usr/apache2 --with-mpm=worker --enable-so\n--enable-layout=Apache --enable-mods-shared=most\n--with-expat=`pwd`/srclib/apr-util/xml/expat --enable-static-support\n--without-berkeley-db && make && make install\n\nI have also tried --enable-mods-shared=all as well as CC=gcc (2.9-aix51-020209)\nand CC=cc_r\n\nApache compiles fine, but when I try to run it (stock httpd.conf) the result is\nthe same:\n\n/usr/apache2/bin>./apachectl start\nSyntax error on line 233 of /usr/apache2/conf/httpd.conf:\nCannot load /usr/apache2/modules/mod_access.so into server: \n/usr/apache2/bin>\n\n../logs is empty.\n\nIf I comment out the LoadModule directive on line 233 -- and all other\nLoadModule directives, I instead get the expected error: \"Invalid command\n'Order', perhaps mis-spelled or defined by a module not included in the server\nconfiguration\"\n\nThere is already on the system an httpd (Apache 1.3.34) that works quite fine\nwith LoadModule, but an upgrade is necessary if a third party system is to be\nsupported.\n\nStatically compiling the modules is the last resort...\n\nI have tried contacting Jeff Trawick, as well as the Apache Users mailing list,\nwith no results, so I turn to bugzilla.  I am not sure if this is a bug or me\nnot configuring properly, but I hope someone can help me here because I have run\nout of options :)\n\nThanks for your time,\n\nPhil", "tags": [], "bug_id": 39788, "attachment_id": null, "count": 0, "id": 90103, "time": "2006-06-12T15:33:09Z", "creator": "phil@redthreeconsulting.com", "creation_time": "2006-06-12T15:33:09Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 39788, "is_private": false, "text": "I guess thinking too hard about a problem only makes this worse.  This is not a\nbug at all as I suspected.\n\nChanging the configure to be:\n\n./configure && make && make install\n\nFixed it.  One of those configure flags must have confused AIX somehow.  It\nmight be interesting to investigate which one and why (and might be indicative\nof a hidden bug), but my issue is resolved.", "id": 90105, "time": "2006-06-12T16:37:06Z", "creator": "phil@redthreeconsulting.com", "creation_time": "2006-06-12T16:37:06Z", "attachment_id": null}, {"count": 2, "tags": [], "creator": "phil@redthreeconsulting.com", "text": "Well, this bug/issue is still unresolved.\n\nUsing ./configure without options resulted in an install where ./apachectl start\nworks.  However, this install still doesnt work with LoadModule directives in\nthe conf file.  It appears it simply statically compiled all the modules into httpd.\n\nSo I am still unable to load modules, as before.", "id": 90218, "time": "2006-06-14T20:07:52Z", "bug_id": 39788, "creation_time": "2006-06-14T20:07:52Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "id": 90220, "time": "2006-06-14T20:50:35Z", "bug_id": 39788, "creation_time": "2006-06-14T20:50:35Z", "is_private": false, "text": "Can you run \n\nhttp://people.apache.org/~trawick/cantloaddso.pl\n\nand post the output here?  Often it can find symbol resolution problems which\nprevent module loading.\n"}, {"count": 4, "tags": [], "creator": "phil@redthreeconsulting.com", "attachment_id": null, "text": ">./cantloaddso.pl /usr/apache2/modules/mod_jk.so /usr/apache2       \nlibapr[-0].so wasn't found; is prefix /usr/apache2 correct?\n>find /usr/apache2 | grep libapr\n/usr/apache2/lib/libapr-0.0.9.12\n/usr/apache2/lib/libapr-0.0\n/usr/apache2/lib/libapr-0\n/usr/apache2/lib/libapr-0.la\n/usr/apache2/lib/libapr-0.a\n/usr/apache2/lib/libaprutil-0.0\n/usr/apache2/lib/libaprutil-0.0.9.12\n/usr/apache2/lib/libaprutil-0\n/usr/apache2/lib/libaprutil-0.la\n/usr/apache2/lib/libaprutil-0.a\n\nHere is something that might shed light\nhttp://publib.boulder.ibm.com/infocenter/pseries/v5r3/index.jsp?topic=/com.ibm.vacpp7a.doc/getstart/overview/port_aix_obj_lib.htm\nbut I do not have the technical competency to make heads or tails out of it...", "id": 90221, "time": "2006-06-14T21:03:39Z", "bug_id": 39788, "creation_time": "2006-06-14T21:03:39Z", "is_private": false}, {"count": 5, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "is_private": false, "id": 90224, "time": "2006-06-14T22:44:45Z", "bug_id": 39788, "creation_time": "2006-06-14T22:44:45Z", "text": "./cantloaddso.pl /usr/apache2/modules/mod_jk.so /usr/apache2 \n\nI wouldn't have tried mod_jk.so first since we dont own tat, but the next stuff\nis the scary part:\n      \nlibapr[-0].so wasn't found; is prefix /usr/apache2 correct?\n>find /usr/apache2 | grep libapr\n\n(no libapr-0.so.xxxxx or libaprutil-0.so.xxxxx; libtool doing something weird)\n\n2.0.58 built/ran fine for me on 5.3; I'm trying on 5.2 now with your same\ninvocation."}, {"count": 6, "tags": [], "text": "I get a good lib directory (has .so files), and DSOs load fine for me:\n$ dir lib/\ntotal 5384\ndrwxr-xr-x   2 trawick  staff           512 Jun 14 19:56 .\ndrwxr-xr-x  15 trawick  staff           512 Jun 14 19:57 ..\n-rw-r--r--   1 trawick  staff          7891 Jun 14 19:56 apr.exp\n-rw-r--r--   1 trawick  staff          3692 Jun 14 19:56 aprutil.exp\n-rw-r--r--   1 trawick  staff        706793 Jun 14 19:56 libapr-0.a\n-rw-r--r--   1 trawick  staff           834 Jun 14 19:56 libapr-0.la\nlrwxrwxrwx   1 trawick  staff            18 Jun 14 19:56 libapr-0.so ->\nlibapr-0.so.0.9.12\nlrwxrwxrwx   1 trawick  staff            18 Jun 14 19:56 libapr-0.so.0 ->\nlibapr-0.so.0.9.12\n-rwxr-xr-x   1 trawick  staff        733098 Jun 14 19:56 libapr-0.so.0.9.12\n-rw-r--r--   1 trawick  staff        419509 Jun 14 19:56 libaprutil-0.a\n-rw-r--r--   1 trawick  staff           940 Jun 14 19:56 libaprutil-0.la\nlrwxrwxrwx   1 trawick  staff            22 Jun 14 19:56 libaprutil-0.so ->\nlibaprutil-0.so.0.9.12\nlrwxrwxrwx   1 trawick  staff            22 Jun 14 19:56 libaprutil-0.so.0 ->\nlibaprutil-0.so.0.9.12\n-rwxr-xr-x   1 trawick  staff        417791 Jun 14 19:56 libaprutil-0.so.0.9.12\n-rwxr-xr-x   1 trawick  staff        455132 Jun 14 19:56 libexpat.a\n-rwxr-xr-x   1 trawick  staff           775 Jun 14 19:56 libexpat.la\n\nThis is on AIX 5.2 ML5, \"VisualAge C++ Professional / C for AIX Compiler,\nVersion 6\", httpd-2.0.58.tar.gz.\n\nI did not run buildconf (so I used the libtool included in the httpd tarball),\nand my configure invocation is this (only prefix changed from your invocation):\n\nCC=xlc_r ./configure --prefix=/home/trawick/2058 --with-mpm=worker --enable-so\n--enable-layout=Apache --enable-mods-shared=most\n--with-expat=`pwd`/srclib/apr-util/xml/expat --enable-static-support\n--without-berkeley-db && make && make install\n\nI should have saved the configure output.  I guess libtool is making some\ndecisions differently between our two machines.\n\nAre you running buildconf after unpacking the tarball and before configure? \nThat brings in some other variables, and you shouldn't have to do that anyway.", "attachment_id": null, "bug_id": 39788, "id": 90239, "time": "2006-06-15T10:25:32Z", "creator": "trawick@apache.org", "creation_time": "2006-06-15T10:25:32Z", "is_private": false}, {"count": 7, "tags": [], "creator": "phil@redthreeconsulting.com", "attachment_id": null, "is_private": false, "id": 90241, "time": "2006-06-15T11:39:59Z", "bug_id": 39788, "creation_time": "2006-06-15T11:39:59Z", "text": "No I did not run buildconf.  It seems to me like the .a files are some kind of\narchives inside which there are .so files?\n\nDazed and confused..."}, {"count": 8, "tags": [], "text": "Okay. I make clean-ed and recompiled apache using the ./configure options you \nspecified (leaving out --with-mod_jk for now).  Using no options \non ./configure gave me an apache that started, but did not work with \nLoadModule.  Using the options you recomment gives an apache that does not \nstart, because the modules that enable stuff like 'Order' cannot be loaded via \nLoadModule.  So either way, I am unable to use 'LoadModule':\n\n/usr/apache2/bin>./apachectl start\nSyntax error on line 233 of /usr/apache2/conf/httpd.conf:\nCannot load /usr/apache2/modules/mod_access.so into server: \n\nNow I use your tool cantloaddso.pl and I get the same error:\n\n/usr/apache2/modules>/tmp/cantloaddso.pl ./mod_access.so /usr/apache2\nlibapr[-0].so wasn't found; is prefix /usr/apache2 correct?\n\nInspecting the apache2 and apache 1.3 modules I see they look like they are in \nthe same format:\n\n/usr/apache2/modules>file ./mod_access.so\n./mod_access.so: executable (RISC System/6000) or object module not stripped\n/usr/apache2/modules>file /usr/apache/libexec/mod_jk.so\n/usr/apache/libexec/mod_jk.so: executable (RISC System/6000) or object module \nnot stripped\n\nBut I still do not know where to start to fix it.", "attachment_id": null, "bug_id": 39788, "id": 90245, "time": "2006-06-15T14:13:55Z", "creator": "phil@redthreeconsulting.com", "creation_time": "2006-06-15T14:13:55Z", "is_private": false}, {"count": 9, "tags": [], "creator": "phil@redthreeconsulting.com", "attachment_id": null, "is_private": false, "id": 90360, "time": "2006-06-19T14:05:03Z", "bug_id": 39788, "creation_time": "2006-06-19T14:05:03Z", "text": "Followup:\n\nI tried recompiling with --enable-access=shared as per\nhttp://www.linuxquestions.org/questions/showthread.php?t=450020 but the results\nare exactly the same.\n\nI did notice, during installation, either during make or make install, make was\ntelling the following about every module:\n\n----------------------------------------------------------------------\nrm -f /usr/apache2/modules/mod_dir.so\n/scratch/a2.0_tc5.0/httpd-2.0.58/srclib/apr/libtool --silent --mode=install cp\nmod_dir.la /usr/apache2/modules/\n----------------------------------------------------------------------\nLibraries have been installed in:\n   /usr/apache2/modules\n\nIf you ever happen to want to link against installed libraries\nin a given directory, LIBDIR, you must either use libtool, and\nspecify the full pathname of the library, or use the `-LLIBDIR'\nflag during linking and do at least one of the following:\n   - add LIBDIR to the `LIBPATH' environment variable\n     during execution\n   - use the `-Wl,-blibpath:LIBDIR:/usr/lpp/xlopt:/usr/lib/threads:/usr/lib:/lib\n' linker flag\n\nSee any operating system documentation about shared libraries for\nmore information, such as the ld(1) and ld.so(8) manual pages.\n----------------------------------------------------------------------\n\nI am not sure if that is relevant information.\n\nUnable to use Apache on AIX,\n\nPhil"}, {"text": ">not sure if that is relevant information.\nIZt isn't.\n\nI'm pretty sure the wrong link flags are used by libtool, such that run-time\nlinking is not enabled and apr and friends are not built as shared libraries. \nWhen I get a chance I'll look through my 2.0.58 tree to see what influences the\nlink.\n\nThe only software I know of that differs between your build and mine is\n\nAIX 5.2: we're almost certainly at different service levels; mine is ML5,\npossibly with additional fixes\n\ncompiler: we're possibly at different service levels, though I'm sure that\ndoesn't matter; I haven't seen any of this linking change across different major\nversions of the compiler and AIX 4.3.3-5.3.", "tags": [], "bug_id": 39788, "is_private": false, "count": 10, "id": 90363, "time": "2006-06-19T14:31:36Z", "creator": "trawick@apache.org", "creation_time": "2006-06-19T14:31:36Z", "attachment_id": null}, {"count": 11, "tags": [], "text": "libtool decides to use old-style libraries vs. new-style libraries based on\nwhether or not it sees \"brtl\" in LDFLAGS.\n\nAPR always turns that on for AIX >= 4.2 to select new-style libraries\n(apr/build/apr_hints.m4).\n\nHere's something you can try to narrow down where something is going wrong on\nyour system.  Attach the output of these commands in your httpd-2.0.58 tree:\n\ncd srclib/apr\nrm libapr-0.la\nmake LTFLAGS=' '\nls -l .libs\n\nThanks!", "is_private": false, "bug_id": 39788, "id": 90374, "time": "2006-06-19T20:07:05Z", "creator": "trawick@apache.org", "creation_time": "2006-06-19T20:07:05Z", "attachment_id": null}, {"count": 12, "tags": [], "creator": "phil@redthreeconsulting.com", "attachment_id": null, "is_private": false, "id": 90439, "time": "2006-06-21T13:57:43Z", "bug_id": 39788, "creation_time": "2006-06-21T13:57:43Z", "text": "...........omitting long compile lines..........\nranlib .libs/libapr-0.a\ncreating libapr-0.la\n(cd .libs && rm -f libapr-0.la && ln -s ../libapr-0.la libapr-0.la)\nTarget \"local-all\" is up to date.\nTarget \"all\" is up to date.\n/scratch/a2.0_tc5.0/httpd-2.0.58/srclib/apr>ls -l .libs\ntotal 9096\nlrwxrwxrwx   1 root     sys              15 Jun 21 10:13 libapr-0 -> libapr-\n0.0.9.12\nlrwxrwxrwx   1 root     sys              15 Jun 21 10:13 libapr-0.0 -> libapr-\n0.0.9.12\n-rwxr-xr-x   1 root     sys         1562744 Jun 21 10:13 libapr-0.0.9.12\n-rw-r--r--   1 root     sys         3074285 Jun 21 10:13 libapr-0.a\n-rw-r--r--   1 root     sys            8276 Jun 21 10:13 libapr-0.exp\nlrwxrwxrwx   1 root     sys              14 Jun 21 10:13 libapr-0.la -\n> ../libapr-0.la\n-rw-r--r--   1 root     sys             729 Jun 21 10:13 libapr-0.lai\n"}, {"count": 13, "tags": [], "bug_id": 39788, "attachment_id": null, "text": "We have applied ML5 to AIX 5.2, did `make clean && ./configure --tons-of-options\n--see-original-comment-for-details && make && make install`, and are now\nexperiencing new errors that I am looking into.\n\nThe errors are:\n\n/usr/apache2/bin>./apachectl configtest\nSyntax error on line 233 of /usr/apache2/conf/httpd.conf:\nCannot load /usr/apache2/modules/mod_access.so into server: rtld: 0712-001 Symbo\nl apr_table_get was referenced\\n      from module /usr/apache2/modules/mod_acces\ns.so(), but a runtime definition\\n      of the symbol was not found.\\nrtld: 0712\n-001 Symbol apr_ipsubnet_test was referenced\\n      from module /usr/apache2/mod\nules/mod_access.so(), but a runtime definition\\n      of the symbol was not foun\nd.\\nrtld: 0712-001 Symbol apr_pstrdup was referenced\\n      from module /usr/apa\nche2/modules/mod_access.so(), but a runtime definition\\n      of the symbol was\nnot found.\\nrtld: 0712-001 Symbol apr_array_push was referenced\\n      from modu\nle /usr/apache2/modules/mod_access.so(), but a runtime definition\\n      of the\nsymbol was not found.\\nrtld: 0712-001 Symbol apr_ipsubnet_create was referenced\\\nn      from module /usr/apache2/modules/mod_access.so(), but a runtime definitio\nn\\n      of the symbol was not found.\\nrtld: 0712-001 Symbol apr_strerror was re\nferenced\\n      from module /usr/apache2/modules/mod_access.so(), but a runtime\ndefinition\\n      of the symbol was not found.\\nrtld: 0712-001 Symbol apr_palloc\n was referenced\\n      from module /usr/apache2/modules/mod_access.so(), but a r\nuntime definition\\n      of the symbol was not found.\\nrtld: 0712-001 Symbol apr\n_array_make was referenced\\n      from module /usr/apache2/modules/mod_access.so\n(), but a runtime definition\\n      of the symbol was not found.", "id": 96826, "time": "2006-12-12T11:24:23Z", "creator": "phil@redthreeconsulting.com", "creation_time": "2006-12-12T11:24:23Z", "is_private": false}, {"count": 14, "tags": [], "creator": "phil@redthreeconsulting.com", "attachment_id": null, "is_private": false, "id": 96834, "time": "2006-12-12T12:23:19Z", "bug_id": 39788, "creation_time": "2006-12-12T12:23:19Z", "text": "Update.\n\nApache 2.2.3 compiles and runs fine with LoadModule for us now, using configure\nline:\n\nCC=gcc ./configure --prefix=/usr/apache2 --with-mpm=worker --enable-so\n--enable-layout=Apache --enable-mods-shared=most\n--with-expat=`pwd`/srclib/apr-util/xml/expat --enable-static-support\n--without-berkeley-db\n\nUsing the same line with Apache 2.0.58 source gives the symbol not found errors\nabove.  (We need Apache 2.0.x not 2.2.x)\n\nI am now trying 2.0.59, but after that I am out of options.  But at least I have\nerror messages to give you guys now.  Any pointers/ideas?"}, {"count": 15, "tags": [], "bug_id": 39788, "is_private": false, "text": "The above errors were generated using 2.0.58 sources.\n\nUsing 2.0.59 sources, I have successfully compiled LoadModule support on AIX 5.2\nML 5 using:\n\nmake clean\n\nCC=gcc ./configure --prefix=/usr/apache2 --with-mpm=worker --enable-so\n--enable-layout=Apache --enable-mods-shared=most\n--with-expat=`pwd`/srclib/apr-util/xml/expat --enable-static-support\n--without-berkeley-db && make && make install\n\n(not tested, but CC=xlc_r should concievably work as well, as it worked for 2.2.3)", "id": 96844, "time": "2006-12-12T13:47:17Z", "creator": "phil@redthreeconsulting.com", "creation_time": "2006-12-12T13:47:17Z", "attachment_id": null}]
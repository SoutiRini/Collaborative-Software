[{"count": 0, "attachment_id": null, "creator": "blanchard@medinst.com", "text": "I am trying to setup JNDI authentication for the Administrator and Manager \npages to learn how to use the JNDI Realm.  But if debug is enabled (I have it \nset to 99 to be really verbose) I am getting a java null pointer exception.  \nLooking at the JNDIRealm.java file it appears it is barfing in a debug \nstatement.\n\nBelow is how I did it...\n\nI created a JNDI Realm in the server.xml file.\n\n<Realm className=\"org.apache.catalina.realm.JNDIRealm\" debug=\"99\"\n\tconnectionURL=\"ldap://192.168.1.23:389\"\n\tconnectionName=\"cn=adminx,ou=zpar,o=med\"\n\tconnectionPassword=\"zparpwd\"\n\tuserPattern=\"cn={0},ou=zpar,o=med\"\n\troleBase=\"ou=zpar,o=med\"\n\troleName=\"cn\"\n\troleSearch=\"(uniqueMember={0})\"\n\t/>\n\nI Created an admin user to authenticate the ldap directory named:\ncn=adminx,ou=zpar,o=med\n\nI created a test user\ncn=test,ou=zpar,o=med\n\nI created two groups\ncn=admin,ou=zpar,o=med and\ncn=manager,ou=zpar,o=med.\n\nI added the test user to both groups.\n\nI then launched my browser and tried to access the Adminstrator page.  When the \nlogin page appears, I enter the information for my test user, and I never get \nthe admin page, but...\n\nThis is an excerpt from my ldap trace on my netware server:\n\nDoBind on connection 0xc9206aa0\nDoBind: name = 'cn=adminx,ou=zpar,o=med', client version = 3, method = 0x80\nSending operation result 0:\"\":\"\" to connection 0xc9206aa0\nDoSearch on connection 0xc9206aa0\nSearch request:\n\tbase: \"ou=zpar,o=med\"\n\tscope:1  derefence:3  sizelimit:0  timelimit:0  attrsonly:0\n\tfilter: \"(uniqueMember=cn=test,ou=zpar,o=med)\"\n\tattribute: \"cn\"\nSending search result entry \"cn=manager,ou=zpar,o=med\" to connection 0xc9206aa0\nSending search result entry \"cn=admin,ou=zpar,o=med\" to connection 0xc9206aa0\nSending operation result 0:\"\":\"\" to connection 0xc9206aa0\n\nThis is an excerpt from my catalina log file (catalina_log.2003-08-07.txt):\n2003-08-07 22:23:16 JNDIRealm[Standalone]: lookupUser(test)\n2003-08-07 22:23:16 JNDIRealm[Standalone]:   dn=cn=test,ou=zpar,o=med\n2003-08-07 22:23:16 JNDIRealm[Standalone]:   validating credentials by binding \nas the user\n2003-08-07 22:23:16 JNDIRealm[Standalone]:   binding as cn=test,ou=zpar,o=med\n2003-08-07 22:23:16 JNDIRealm[Standalone]: Username test successfully \nauthenticated\n2003-08-07 22:23:16 JNDIRealm[Standalone]:   getRoles(cn=test,ou=zpar,o=med)\n2003-08-07 22:23:16 JNDIRealm[Standalone]:   Searching role \nbase 'ou=zpar,o=med' for attribute 'cn'\n2003-08-07 22:23:16 JNDIRealm[Standalone]:   With filter \nexpression '(uniqueMember=cn=test,ou=zpar,o=med)'\n2003-08-07 22:23:16 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2003-08-07 22:23:16 JNDIRealm[Standalone]:   retrieving values for attribute cn\n2003-08-07 22:23:16 CoyoteAdapter An exception or error occurred in the \ncontainer during the request processing\njava.lang.NullPointerException\n\tat org.apache.catalina.realm.JNDIRealm.getRoles(JNDIRealm.java:1282)\n\tat org.apache.catalina.realm.JNDIRealm.authenticate(JNDIRealm.java:871)\n\tat org.apache.catalina.realm.JNDIRealm.authenticate(JNDIRealm.java:788)\n\tat org.apache.catalina.authenticator.FormAuthenticator.authenticate\n(FormAuthenticator.java:263)\n\tat org.apache.catalina.authenticator.AuthenticatorBase.invoke\n(AuthenticatorBase.java:481)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardContext.invoke\n(StandardContext.java:2416)\n\tat org.apache.catalina.core.StandardHostValve.invoke\n(StandardHostValve.java:180)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.valves.ErrorDispatcherValve.invoke\n(ErrorDispatcherValve.java:171)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke\n(ErrorReportValve.java:172)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:641)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.catalina.core.StandardEngineValve.invoke\n(StandardEngineValve.java:174)\n\tat \norg.apache.catalina.core.StandardPipeline$StandardPipelineValveContext.invokeNex\nt(StandardPipeline.java:643)\n\tat org.apache.catalina.core.StandardPipeline.invoke\n(StandardPipeline.java:480)\n\tat org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:995)\n\tat org.apache.coyote.tomcat4.CoyoteAdapter.service\n(CoyoteAdapter.java:223)\n\tat org.apache.coyote.http11.Http11Processor.process\n(Http11Processor.java:601)\n\tat \norg.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.processConnectio\nn(Http11Protocol.java:392)\n\tat org.apache.tomcat.util.net.TcpWorkerThread.runIt\n(PoolTcpEndpoint.java:565)\n\tat org.apache.tomcat.util.threads.ThreadPool$ControlRunnable.run\n(ThreadPool.java:619)\n\tat java.lang.Thread.run(Thread.java:536)", "id": 42376, "time": "2003-08-08T03:32:13Z", "bug_id": 22236, "creation_time": "2003-08-08T03:32:13Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "creator": "funkman@joedog.org", "is_private": false, "text": "addAttributeValues() has the ability to return null on certain conditions.\n\nThen later in getRoles(), if debug >=2, then the list returned by \naddAttributeValues is iterated for debug reasons.\n\nThe temporary workaround is keep debug < 2. (Ick :( )\n\nPatch to be made soon which will check for null while in the debug statement.", "id": 42394, "time": "2003-08-08T12:53:06Z", "bug_id": 22236, "creation_time": "2003-08-08T12:53:06Z", "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 22236, "is_private": false, "text": "Patch applied to tomcat 4.1.28 (or better) and tomcat5", "id": 42420, "time": "2003-08-08T16:43:34Z", "creator": "funkman@joedog.org", "creation_time": "2003-08-08T16:43:34Z", "attachment_id": null}, {"count": 3, "attachment_id": null, "creator": "ladams@ccc.edu", "text": "I've been running into the same problem.  Coincidentally, also using Novell\neDirectory.  Perhaps Novell is unique in returning roles with null attributes?\n\nI have a user, it belonged to a group called intranet.  I was able to\nauthenticate an application using this role.  Then my Novell admin added the\nuser to a new group, and I started getting the NPE.  Turns out the second group\nI was added to returns null attributes.\n\nI got around the NPE a while back by adding that null check, but I think the\nright thing to do is to modify the addAttributeValues method to return the\noriginal \"values\" argument that was passed to the method.  In my case, the null\nvalues on the second role returned in my SearchResults were causing the whole\nlist to be nullified, and I couldn't authenticate even though the intranet role\nwas found.", "id": 42646, "time": "2003-08-12T21:45:48Z", "bug_id": 22236, "creation_time": "2003-08-12T21:45:48Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "funkman@joedog.org", "attachment_id": null, "text": "Can I get a stacktrace? I thought I squished any NPE. But I *might* see one more\nspot which might through a NPE. Please make sure the stacktrace is also against\n4.1.27 and/or 5.0.9", "id": 43285, "time": "2003-08-25T23:29:37Z", "bug_id": 22236, "creation_time": "2003-08-25T23:29:37Z", "is_private": false}, {"count": 5, "tags": [], "bug_id": 22236, "is_private": false, "text": "Re-closing due to lack of feedback from the re-open. Please reopen with and\nprovide stacktrace  (and tomcat version used) if this particular problem still\nexists.", "id": 49025, "time": "2003-12-12T22:45:52Z", "creator": "funkman@joedog.org", "creation_time": "2003-12-12T22:45:52Z", "attachment_id": null}]
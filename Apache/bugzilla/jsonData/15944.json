[{"count": 0, "tags": [], "bug_id": 15944, "attachment_id": null, "id": 29106, "time": "2003-01-10T06:47:49Z", "creator": "peilinz@hotmail.com", "creation_time": "2003-01-10T06:47:49Z", "is_private": false, "text": "If the JSP file does not set content type, the following line is automatically \ngenerated in the compiled .java file:\nresponse.setContentType(\"text/html;charset=ISO-8859-1\");\nIn cases where the content type is set in the servlet (e.g.: a subclass of \nstruts Action class) and the JSP page is forwarded to, this behavior overwrites \nthe intended content type with \"text/html;charset=ISO-8859-1\"."}, {"count": 1, "tags": [], "creator": "peilinz@hotmail.com", "attachment_id": null, "id": 29107, "time": "2003-01-10T07:01:00Z", "bug_id": 15944, "creation_time": "2003-01-10T07:01:00Z", "is_private": false, "text": "I'm using the optional task jspc in ANT 1.5.1 to compile all JSP pages. Right \nnow, I have to use the \"replace\" task to remove the \nline \"response.setContentType(\"text/html;charset=ISO-8859-1\");\"\n"}, {"count": 2, "tags": [], "creator": "div@yandex.ru", "attachment_id": null, "id": 29108, "time": "2003-01-10T07:13:08Z", "bug_id": 15944, "creation_time": "2003-01-10T07:13:08Z", "is_private": false, "text": "See also bug #11197."}, {"count": 3, "tags": [], "bug_id": 15944, "text": "\naccording to jsp spec 1.2, section 2.10.1:\njsp pages always generate a setContentType that defaults to \ntext/html;charset:iso-8859-1.\n\nDynamic setting of content type relies on an underlying invocation on\nresponse.setContentType(). That method can be invoked as long as no content has\nbeen been sent to the response stream.\n", "id": 29112, "attachment_id": null, "creator": "tfohrer@t-online.de", "creation_time": "2003-01-10T08:53:36Z", "time": "2003-01-10T08:53:36Z", "is_private": false}, {"count": 4, "tags": [], "text": "You need to use a servlet filter to hide the call to setContentType().  Use\nsomething like:\n\n       filterChain.doFilter(servletRequest,\n                new HttpServletResponseWrapper((HttpServletResponse)\nservletResponse)\n                {\n                    public void setContentType(String s)\n                    {\n                        int index = -1;\n\n                        if ((index = s.indexOf(';')) != -1)\n                        {\n                            String contentType = s.substring(0, index) +\n\";charset=\" + getEncoding();\n                            //This call could be trying to set the charset to\nanother charset.\n                            //This is the case with Tomcat & Jetty, whose JSP\ncompiler sets the charset, whether it\n                            //is specified in the JSP page or not.\n\n                            //NB - this can also be accomplished by setting the\ncharset manually in the JSP page & the decorator,\n                            //but this approach allows for run-time flexibility\nof choosing the charsets.\n                            super.setContentType(contentType);\n                        }\n                        else\n                        {\n                            super.setContentType(s);\n                        }\n                    }\n\n                });\n\nCheers,\nScott", "attachment_id": null, "id": 33889, "creation_time": "2003-03-27T05:26:31Z", "time": "2003-03-27T05:26:31Z", "creator": "scott@atlassian.com", "bug_id": 15944, "is_private": false}, {"count": 5, "tags": [], "text": "Invalid per commetns below. (Spec limitation)", "is_private": false, "id": 42206, "creation_time": "2003-08-05T21:07:25Z", "time": "2003-08-05T21:07:25Z", "creator": "funkman@joedog.org", "bug_id": 15944, "attachment_id": null}]
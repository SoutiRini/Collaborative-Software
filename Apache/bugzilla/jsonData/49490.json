[{"count": 0, "tags": [], "bug_id": 49490, "attachment_id": null, "is_private": false, "id": 137817, "time": "2010-06-22T09:25:53Z", "creator": "uldisk@ctco.lv", "creation_time": "2010-06-22T09:25:53Z", "text": "I already red a lot of similar issues but still don`t see a working fix or workaround.\n\nFor example, this is my code:\n\n<java classname=\"com.google.gwt.dev.Compiler\" fork=\"true\" maxmemory=\"${config.gwt.javac.maxmemory}\" dir=\"${basedir}\" failonerror=\"true\" \n\t\t\t\t\tresultproperty=\"gwt.compile.error.code\" jvmargs=\"${config.gwt.javac.jvmargs}\">\n\t\t\t\t<arg line=\"-style ${config.gwt.style}\" />\n\t\t\t\t<arg line=\"-war ${work.web.gwt.web.main.gwt-generated.dir}\" />\n\t\t\t\t<arg line=\"${config.gwt.validateOnly}\" />\n\t\t\t\t<arg value=\"${gwt-class}\" />\n\t\t\t\t<classpath refid=\"gwt.libs.snapshot.classpath\" />\n\t\t\t\t<classpath refid=\"gwt.libs.classpath\" />\n\t\t\t\t<classpath path=\"${src.main.dir}\" />\n\t\t\t</java>\n\nIf I run my build, wait for GWT compilation to start and then press ctrl-c (kill), Ant process exits but GWT compilation is still running. GWT compilation like other tasks may take a lot of time and if I press ctrl-c that means I want to abort whole build.\n\nAs understand this is related to shutdownhooks in Java. I see kind of their implementation in ProcessDestroyer class which is used in Execute class which is used from <java/> task, but seems it still is not working or doing something else.\n\nI know this must be possible couse I already had implemented something similar in my tool which starts up Ant process. If I kill my tool, Ant process gets killed too. Should I give a try?"}, {"count": 1, "text": "Due to limitations in the Java APIs for process control, a general fix may not be possible without native code, such as in:\n\nhttps://hudson.dev.java.net/svn/hudson/trunk/hudson/main/core/src/main/java/hudson/util/ProcessTree.java\n\nA shutdown hook in Ant would likely make it possible to kill off direct subprocesses, but not subsubprocesses.", "creator": "jglick@apache.org", "is_private": false, "id": 137825, "time": "2010-06-22T12:46:29Z", "bug_id": 49490, "creation_time": "2010-06-22T12:46:29Z", "tags": [], "attachment_id": null}, {"count": 2, "tags": [], "text": "I can`t access these hudson sources.\nHowever, killing direct subprocesses should be enough for start.\n\n(In reply to comment #1)\n> Due to limitations in the Java APIs for process control, a general fix may not\n> be possible without native code, such as in:\n> \n> https://hudson.dev.java.net/svn/hudson/trunk/hudson/main/core/src/main/java/hudson/util/ProcessTree.java\n> \n> A shutdown hook in Ant would likely make it possible to kill off direct\n> subprocesses, but not subsubprocesses.", "is_private": false, "bug_id": 49490, "id": 137945, "time": "2010-06-28T08:34:14Z", "creator": "uldisk@ctco.lv", "creation_time": "2010-06-28T08:34:14Z", "attachment_id": null}, {"count": 3, "tags": [], "text": "Checked out sources and finally understood where is my problem. Ant itself has all needed shutdownhooks and they work as expected. Since I`m using special tool which starts Ant, I run into problem with uncontrolled Java sub-sub-processes. There are few complicated options how to resolve my problem, but that`s not just worth of it :( going to wait for fix in Java.\n\nRelated articles:\nhttp://bugs.sun.com/view_bug.do?bug_id=4244896\nhttp://bugs.sun.com/view_bug.do?bug_id=4770092\nhttp://www.rgagnon.com/javadetails/java-0467.html", "attachment_id": null, "id": 137971, "creator": "uldisk@ctco.lv", "time": "2010-06-29T04:54:52Z", "bug_id": 49490, "creation_time": "2010-06-29T04:54:52Z", "is_private": false}]
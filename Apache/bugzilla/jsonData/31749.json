[{"attachment_id": null, "tags": [], "bug_id": 31749, "text": "I am running into series of problems.\nHere is the sample code which i m executing.\n\n********\nimport java.io.*;\n\nimport org.apache.poi.hssf.usermodel.HSSFWorkbook;\n\npublic class TestPoi {\n\t\n\tpublic static void main(String[] args) throws Exception{\n\t\t\n\t\tHSSFWorkbook workbook = new HSSFWorkbook(new FileInputStream\n(new File(\"c://test//uw.xls\")),true);\n\t\tFileOutputStream fos = new FileOutputStream(new File\n(\"c://test//uw_output.xls\"));\n\t\tworkbook.write(fos);\n\t\tfos.close();\n\t}\n\n}\n******************\n\nThe output file uw_output.xls is totally unusable as i am not able to open \nthis file.\nHere are series of steps which i performed.\n\n1. When i executed this programe for the first time i got  warnings  like \nbelow one.\n\n[WARNING] Unknown Ptg 3c (60) at cell (36,2)\n\nThen i deleted all the rows having the junk characters and  i executed the \nprograme again.This time it did not generate any warnings but the excel file \nwhich it created was unreadable.", "count": 0, "id": 65227, "time": "2004-10-16T22:24:18Z", "creator": "ash_sha_21@yahoo.com", "creation_time": "2004-10-16T22:24:18Z", "is_private": false}, {"count": 1, "tags": [], "creator": "ash_sha_21@yahoo.com", "text": "********uw_output.xls file did not get corrputed when i used \nPOIFSFileSystem.write() method and i could open this(uw_output.xls) file \nsuccessfully.\n\n\t\tFileOutputStream fos = new FileOutputStream(new File\n(\"c://test//uw_output.xls\"));\t\t\n\t\tPOIFSFileSystem pfs =  new POIFSFileSystem(new FileInputStream\n(new File(\"c://test//uw.xls\")));\n\t\tpfs.writeFilesystem(fos);\n\nI am not sure why workbook.write() corrupts the file.\n\nBut i am running into some other issue now.\nWhen i make the change in this xls file andclick save in the file menu , it \ngive me excel error saying 'document not saved'??\nany clues..\n\n", "id": 65228, "time": "2004-10-17T01:42:32Z", "bug_id": 31749, "creation_time": "2004-10-17T01:42:32Z", "is_private": false, "attachment_id": null}, {"count": 2, "tags": [], "bug_id": 31749, "attachment_id": null, "text": "Please attach your template file uw.xls to this bug using the \"Create a new\nattachment\" hyperlink.\n\nWithout this it makes it impossible to debug.", "id": 65258, "time": "2004-10-17T22:24:13Z", "creator": "jheight@apache.org", "creation_time": "2004-10-17T22:24:13Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 31749, "attachment_id": 13135, "text": "Created attachment 13135\nthis is one sheet from the orig file.The complete file is very big but this sheet has also the same problem.", "id": 65296, "time": "2004-10-19T02:39:47Z", "creator": "ash_sha_21@yahoo.com", "creation_time": "2004-10-19T02:39:47Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 31749, "text": "Created attachment 13136\ntest", "id": 65297, "time": "2004-10-19T02:53:24Z", "creator": "ash_sha_21@yahoo.com", "creation_time": "2004-10-19T02:53:24Z", "is_private": false, "attachment_id": 13136}, {"count": 5, "tags": [], "bug_id": 31749, "text": "Hi there, If you are too busy to look into the defect right now ,Please give me \nsome pointers where you think poi library can fail and fix so that i can debug \nit myself ..i will really be thankful if someone can look into it..but one \nthing is sure that this my excel sheet contains VB code it and i m not sure how \nmuch u support that.", "id": 65378, "time": "2004-10-20T19:08:41Z", "creator": "ash_sha_21@yahoo.com", "creation_time": "2004-10-20T19:08:41Z", "is_private": false, "attachment_id": null}, {"count": 6, "tags": [], "creator": "jheight@apache.org", "attachment_id": null, "id": 65398, "time": "2004-10-20T23:07:15Z", "bug_id": 31749, "creation_time": "2004-10-20T23:07:15Z", "is_private": false, "text": "Easiest way to debug this stuff is to use the biff viewer to get a text dump of\nthe original file, and then do the same with the one re-written by poi. \n\nThen do a diff on the files to check for differences. Aside for some records\nthat are marked as unknown, and not written by poi (they are not required) there\nshould be very few differences.\n\nI could do this but not for another week.\n\nJason"}, {"count": 7, "tags": [], "creator": "ash_sha_21@yahoo.com", "text": "What tool i should use as i downloaded the ExcelFile viewer v1.2 it does show \nexcel records but i am not able to take dump to text file so that i can  \ncompare the files.\n", "id": 65405, "time": "2004-10-21T02:54:23Z", "bug_id": 31749, "creation_time": "2004-10-21T02:54:23Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "bug_id": 31749, "attachment_id": null, "id": 65406, "time": "2004-10-21T03:13:31Z", "creator": "jheight@apache.org", "creation_time": "2004-10-21T03:13:31Z", "is_private": false, "text": "http://jakarta.apache.org/poi/hssf/how-to.html\n\nsearch for biffview\n\nhere is the .bat file that i use in windows to run it:\n\njava -classpath f:/home/jmheight/poi/clean/jakarta-poi/build/dist/poi-2.1-\n20041013.jar org.apache.poi.hssf.dev.BiffViewer %1"}, {"count": 9, "tags": [], "bug_id": 31749, "text": "thanks a lot Jason! really appreciate this!! :)", "id": 65407, "time": "2004-10-21T03:21:09Z", "creator": "ash_sha_21@yahoo.com", "creation_time": "2004-10-21T03:21:09Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "creator": "ash_sha_21@yahoo.com", "text": "hi there, i was trying to biffview the input and output files but i could get \npartial dump of the file as i got the exception\n\nHere is the exception while i was trying to biffview input file\n\n*********\njava.lang.ArrayIndexOutOfBoundsException\n        at java.lang.System.arraycopy(Native Method)\n        at org.apache.poi.ddf.EscherArrayProperty.getElement\n(EscherArrayProperty\n.java:110)\n        at org.apache.poi.ddf.EscherArrayProperty.toString\n(EscherArrayProperty.j\nava:131)\n        at org.apache.poi.ddf.EscherOptRecord.toString\n(EscherOptRecord.java:138)\n\n        at org.apache.poi.ddf.EscherContainerRecord.toString\n(EscherContainerReco\nrd.java:158)\n        at org.apache.poi.hssf.record.AbstractEscherHolderRecord.toString\n(Abstra\nctEscherHolderRecord.java:126)\n        at org.apache.poi.hssf.dev.BiffViewer.dumpNormal(BiffViewer.java:148)\n        at org.apache.poi.hssf.dev.BiffViewer.access$1(BiffViewer.java:144)\n        at org.apache.poi.hssf.dev.BiffViewer$RecordDetails.dump\n(BiffViewer.java\n:700)\n        at org.apache.poi.hssf.dev.BiffViewer.createRecords\n(BiffViewer.java:120)\n\n        at org.apache.poi.hssf.dev.BiffViewer.run(BiffViewer.java:73)\n        at org.apache.poi.hssf.dev.BiffViewer.main(BiffViewer.java:652)\n***************\n\nAnd here is the exception while i was trying to biff view output file \n(generated by poi library)\n\n**********\njava.lang.ArrayIndexOutOfBoundsException\n        at java.lang.System.arraycopy(Native Method)\n        at org.apache.poi.ddf.EscherArrayProperty.getElement\n(EscherArrayProperty\n.java:110)\n        at org.apache.poi.ddf.EscherArrayProperty.toString\n(EscherArrayProperty.j\nava:131)\n        at org.apache.poi.ddf.EscherOptRecord.toString\n(EscherOptRecord.java:138)\n\n        at org.apache.poi.ddf.EscherContainerRecord.toString\n(EscherContainerReco\nrd.java:158)\n        at org.apache.poi.hssf.record.AbstractEscherHolderRecord.toString\n(Abstra\nctEscherHolderRecord.java:126)\n        at org.apache.poi.hssf.dev.BiffViewer.dumpNormal(BiffViewer.java:148)\n        at org.apache.poi.hssf.dev.BiffViewer.access$1(BiffViewer.java:144)\n        at org.apache.poi.hssf.dev.BiffViewer$RecordDetails.dump\n(BiffViewer.java\n:700)\n        at org.apache.poi.hssf.dev.BiffViewer.createRecords\n(BiffViewer.java:120)\n\n        at org.apache.poi.hssf.dev.BiffViewer.run(BiffViewer.java:73)\n        at org.apache.poi.hssf.dev.BiffViewer.main(BiffViewer.java:652)\n**************\n\nCan this be the reason , why the output file is getting corrupt while writing?\n\n", "id": 65411, "time": "2004-10-21T04:47:47Z", "bug_id": 31749, "creation_time": "2004-10-21T04:47:47Z", "is_private": false, "attachment_id": null}, {"count": 11, "tags": [], "bug_id": 31749, "attachment_id": null, "id": 65467, "time": "2004-10-21T20:21:34Z", "creator": "ash_sha_21@yahoo.com", "creation_time": "2004-10-21T20:21:34Z", "is_private": false, "text": "i think i have reached the dead end in this debugging.\nNeed urgent help in this...."}, {"count": 12, "tags": [], "bug_id": 31749, "attachment_id": null, "id": 65644, "time": "2004-10-25T11:35:08Z", "creator": "glens@apache.org", "creation_time": "2004-10-25T11:35:08Z", "is_private": false, "text": "Done some tracing through.  The problem seems to be related to the little up and\ndown arrow's you have in the sheet.  I removed them and the sheet started\nrewriting without corruption."}, {"count": 13, "text": "Okay... I think I've narrowed down the issue.  It's actually an instance of the\nreally wierd problem I encountered in the way Excel sometimes writes it's\ncontinue records.  See\nhttp://www.jroller.com/page/gstamp/20040817#excel_and_the_escher_format for more\ninformation.\n\nBasically what's happening at the moment is the system is (incorrectly) trying\nto call processContinueRecord() for the preceeding OBJ record.  Probably what\nshould happen in this case is that the continue record is applied last record\ncapable of handling a continue (or left along otherwise).\n\nYou can hack around this problem by altering the line:\n\n179 in RecordFactory.java (CVS HEAD) to:\n\n                            if (rectype == ContinueRecord.sid &&\n                                ! (last_record instanceof ContinueRecord) && //\ninclude continuation records after\n                                ! (last_record instanceof UnknownRecord) && //\nunknown records or previous continuation records\n                                ! (last_record instanceof ObjRecord) &&\n                                ! (last_record instanceof TextObjectBaseRecord) \n                            )\n\n\nUnfortunately this doesn't completely cure the problem.  There still seems to be\nmessages that come up when you open the sheet.", "bug_id": 31749, "attachment_id": null, "id": 65646, "time": "2004-10-25T12:09:43Z", "creator": "glens@apache.org", "creation_time": "2004-10-25T12:09:43Z", "tags": [], "is_private": false}, {"count": 14, "tags": [], "creator": "ash_sha_21@yahoo.com", "text": "Yes, the situation is little better when i made the code change suggested by \nyou.Now I could open the output file and it seems the structure of excel is \nintact..but now the other problem is that excel crashes when i try to save the \nfile and i am not able to open the output file after i set the cell values \nprogammatically, excel gives me nasty error \"Excel.exe has generated error\".", "id": 65649, "time": "2004-10-25T13:54:26Z", "bug_id": 31749, "creation_time": "2004-10-25T13:54:26Z", "is_private": false, "attachment_id": null}, {"count": 15, "tags": [], "creator": "ash_sha_21@yahoo.com", "attachment_id": null, "id": 66217, "time": "2004-11-01T01:01:49Z", "bug_id": 31749, "creation_time": "2004-11-01T01:01:49Z", "is_private": false, "text": "Glen, thanks for the fix..that has helped me as i can open the output  excel \nsheet  but i am not able to save the excel document.It gives  excel \nmessage 'document not saved' and if i try to close the document excel \napplication crashes.\n\n"}, {"count": 16, "tags": [], "creator": "glens@apache.org", "text": "When I get some more free time I'll look into it some more.  Can't make any\npromises though.  ", "id": 66236, "time": "2004-11-01T10:17:58Z", "bug_id": 31749, "creation_time": "2004-11-01T10:17:58Z", "is_private": false, "attachment_id": null}, {"count": 17, "attachment_id": null, "creator": "ash_sha_21@yahoo.com", "text": "Glen.. the solution u suggested works for me..and the only small thing left is \nthe problem which i mentioned in bug#31979 and i have been trying to debug \nthis for long time and i m stumped on this issue..need some help or pointers \nin this issue.", "id": 66603, "time": "2004-11-08T05:56:04Z", "bug_id": 31749, "creation_time": "2004-11-08T05:56:04Z", "tags": [], "is_private": false}, {"count": 18, "tags": [], "creator": "avik@apache.org", "attachment_id": null, "id": 98108, "time": "2007-01-16T01:40:54Z", "bug_id": 31749, "creation_time": "2007-01-16T01:40:54Z", "is_private": false, "text": "Works as of 12Jan2007, Testcase added. \nhttp://issues.apache.org/bugzilla/show_bug.cgi?id=41366"}]
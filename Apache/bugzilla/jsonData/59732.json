[{"count": 0, "tags": [], "bug_id": 59732, "attachment_id": null, "text": "I don't know why the file I write using POI cant be opened by Ms Excel , but the file is still readable by POI. (cell value can be changed) \n\nLink file: http://www.corteconti.it/export/sites/portalecdc/_documenti/controllo/sez_autonomie/2016/schemi_di_bilancio_armonizzato_2015_ens_art_1_delibera_12_2016_sezaut_inpr.xls\n\nhere is the code\n\n    String nomeFileArt1 = \"schemi_di_bilancio_armonizzato_2015_ens_art_1_delibera_12_2016_sezaut_inpr.xls\";\n        NPOIFSFileSystem fs = new NPOIFSFileSystem(new File(System.getProperty(\"java.io.tmpdir\") + nomeFileArt1));\n        HSSFWorkbook wb = new HSSFWorkbook(fs.getRoot(), true);\n\n        FileOutputStream stream = new FileOutputStream(System.getProperty(\"java.io.tmpdir\") + \"schemi_di_bilancio_armonizzato.xls\");\n        HSSFSheet sheet = wb.getSheet(\"Dati_Anagrafici\");\n        HSSFRow sheetrow = sheet.getRow(10);\n        if (sheetrow == null) {\n            sheetrow = sheet.createRow(10);\n        }\n        HSSFCell cell = sheetrow.getCell(0);\n        if (cell == null) {\n            cell = sheetrow.createCell(0);\n            cell.setCellType(HSSFCell.CELL_TYPE_STRING);\n        }\n        cell.setCellValue(\"test\");\n        wb.write(stream);\n        stream.close();", "id": 191818, "time": "2016-06-20T07:22:48Z", "creator": "stefanoto@gmail.com", "creation_time": "2016-06-20T07:22:48Z", "is_private": false}, {"count": 1, "tags": [], "creator": "onealj@apache.org", "attachment_id": null, "id": 191819, "time": "2016-06-20T07:41:40Z", "bug_id": 59732, "creation_time": "2016-06-20T07:41:40Z", "is_private": false, "text": "LibreOffice can read schemi_di_bilancio_armonizzato_2015_ens_art_1_delibera_12_2016_sezaut_inpr.xls and doesn't report any errors.\n\nDoes Excel give you any meaningful errors?\n\nAlso, could you try the following:\n\n1. Without modifying the cells\n> String nomeFileArt1 = \"in.xls\";\n> NPOIFSFileSystem fs = new NPOIFSFileSystem(new File(System.getProperty(\"java.io.tmpdir\") + nomeFileArt1));\n> HSSFWorkbook wb = new HSSFWorkbook(fs.getRoot(), true);\n> FileOutputStream stream = new FileOutputStream(System.getProperty(\"java.io.tmpdir\") + \"out.xls\");\n> wb.write(stream);\n> stream.close();\n\n2. Opening the workbook with preserveNodes=false (both with and without modifying the file)\n> ...\n> HSSFWorkbook wb = new HSSFWorkbook(fs.getRoot(), true);\n> ...\n\n3. Opening the workbook through more common methods\n> WorkbookFactory.create(new File(\"in.xls\"));\nor\n> WorkbookFactory.create(new FileInputStream(\"in.xls\"));"}, {"count": 2, "tags": [], "bug_id": 59732, "is_private": false, "text": "I've tried all the solutions , but without success. to open the file I used ms excel 2010.\nThe error message is:\nExcel found unreadable content", "id": 191820, "time": "2016-06-20T07:51:34Z", "creator": "stefanoto@gmail.com", "creation_time": "2016-06-20T07:51:34Z", "attachment_id": null}, {"count": 3, "tags": [], "creator": "onealj@apache.org", "attachment_id": null, "id": 191822, "time": "2016-06-20T08:49:38Z", "bug_id": 59732, "creation_time": "2016-06-20T08:49:38Z", "is_private": false, "text": "So what you're saying is that if you start with a non-corrupt workbook and run it through the following code, you get a corrupt (according to Excel) workbook?\n\n> @Test\n> public void test59732() {\n>     File f = new File(\"in.xls\");\n>     Workbook wb = WorkbookFactory.create(f);\n>     OutputStream fos = new FileOutputStream(\"out.xls\");\n>     wb.write(fos);\n>     fos.close();\n>     wb.close();\n> }\n\nDoes this happen using other workbooks?\nWhat version of POI are you using?\nDoes Excel 2010 give any more detail on the error?"}, {"count": 4, "tags": [], "creator": "stefanoto@gmail.com", "attachment_id": null, "id": 191826, "time": "2016-06-20T09:11:42Z", "bug_id": 59732, "creation_time": "2016-06-20T09:11:42Z", "is_private": false, "text": "So what you're saying is that if you start with a non-corrupt workbook and run it through the following code, you get a corrupt (according to Excel) workbook?\nYes\n\nDoes this happen using other workbooks?\nWith other workbooks it works\n\nWhat version of POI are you using?\n3.10 Final and 3.14\n\nDoes Excel 2010 give any more detail on the error?\nNo"}]
[{"count": 0, "tags": [], "creator": "treeck@yahoo.com", "is_private": false, "text": "When a corresponding resource is not defined in a server.xml, the following \nweb.xml segment:\n\n<web-app>\n  <resource-ref>\n    <res-ref-name>jdbc/test</res-ref-name>\n    <res-type>javax.sql.DataSource</res-type>\n    <res-auth>Container</res-auth>\n  </resource-ref>\n ...\n</web-app>\n\nGenerates the following SAX parser error:\n\nJul 20, 2004 9:58:55 PM org.apache.coyote.http11.Http11Protocol init INFO: \nInitializing Coyote HTTP/1.1 on port 8080 Starting service Tomcat-Standalone \nApache Tomcat/4.1.30 Jul 20, 2004 9:58:57 PM \norg.apache.commons.digester.Digester error SEVERE: Parse Error at line 72 \ncolumn 11: The content of element type \"web-app\" must match \"(icon?,display-\nname?,description?,distributable?,context-param*,filter*,filter-\nmapping*,listener*,servlet*,servlet-mapping*,session-config?,mime-\nmapping*,welcome-file-list?,error-page*,taglib*,resource-env-ref*,resource-\nref*,security-constraint*,login-config?,security-role*,env-entry*,ejb-ref*,ejb-\nlocal-ref*)\". org.xml.sax.SAXParseException: The content of element type \"web-\napp\" must match \"(icon?,display-name?,description?,distributable?,context-\nparam*,filter*,filter-mapping*,listener*,servlet*,servlet-mapping*,session-\nconfig?,mime-mapping*,welcome-file-list?,error-page*,taglib*,resource-env-\nref*,resource-ref*,security-constraint*,login-config?,security-role*,env-\nentry*,ejb-ref*,ejb-local-ref*)\".  at \norg.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException(Unknown \nSource)  at org.apache.xerces.util.ErrorHandlerWrapper.error(Unknown Source)  \nat org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)  at \norg.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)  at \norg.apache.xerces.impl.dtd.XMLDTDValidator.handleEndElement(Unknown Source)  \nat org.apache.xerces.impl.dtd.XMLDTDValidator.endElement(Unknown Source)  at \norg.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanEndElement(Unknown \nSource)  at ...\n\nThis is a \"blocker\" for the following use case: You create a .war containing a \nservlet which first attempts to locate a DataSource. If a DataSource is not \nfound (null returned), then the servlet uses a jdbc URL, username, and \npassword specified via servlet init parameters to attempt a \"default\" \nDriverManager connection. Because the parse fails on the last line (the </web-\napp> element), all the init parameters are read as null -- that is, opening \nvia a default jdbc URL also fails.\n\nThis bug makes it virtually impossible to create a \"commercial\" .war that can \nrun on any app server. Instead one has to eliminate the <resource-ref>, have \nthe customer unpack the .war and edit the web.xml with appropriate URL, etc. \nfor their computer.", "id": 60900, "time": "2004-07-21T05:48:19Z", "bug_id": 30225, "creation_time": "2004-07-21T05:48:19Z", "attachment_id": null}, {"count": 1, "tags": [], "creator": "treeck@yahoo.com", "attachment_id": null, "id": 61094, "creation_time": "2004-07-25T07:52:55Z", "time": "2004-07-25T07:52:55Z", "bug_id": 30225, "text": "Actually, the problem is with the documentation on the Apache website. It \ngives examples with the <resource-ref> being the first element under a <web-\napp>. The actual location should be after the servlet mapping elements, etc.\n\nEven when <resource-ref> is in the proper location, Tomcat 4.1.30 does not \nbehave properly (4.1.27 does behave properly). 4.1.30 throws an exception that \nnulls out all the servlet's init parameters when the server.xml lacks the JNDI \njdbc definitiion.", "is_private": false}, {"count": 2, "tags": [], "creator": "markt@apache.org", "attachment_id": null, "id": 69361, "time": "2005-01-07T16:03:21Z", "bug_id": 30225, "creation_time": "2005-01-07T16:03:21Z", "is_private": false, "text": "The web.xml in the JNDI how-to is correct. There are no servlets, therefore no\nentires for them in the web.xml. If there were servlets in the example they\nwould, of course, have to be specified in the correct location in web.xml as per\nthe servet spec.\n\nI'll look into the exception issue and update when I have more info."}, {"count": 3, "tags": [], "bug_id": 30225, "attachment_id": null, "id": 69364, "time": "2005-01-07T16:35:06Z", "creator": "markt@apache.org", "creation_time": "2005-01-07T16:35:06Z", "is_private": false, "text": "Just tested this with the latest TC4 source and I see no exception and the init\npaarameters are available when a <resource-ref> element is present but the\nresource is not defined in server.xml.\n\nChances are this works in TC4.1.31 as well but I haven't tested it. Neither have\nI reviewed the change logs to see if anything looks relevant."}]
[{"count": 0, "tags": [], "bug_id": 42871, "attachment_id": null, "text": "While running performance testes, we have run into an issue when an Apache web \nserver is set in front of a tomcat (ajp in between).\n\nWhen POST http requests were forwarded, we were experiencing the following \nnetwork sequence:\n- a first ajp packet containing headers/request was forwarded by Web server to \ntomcat: body data aren't included in it\n- Web server would wait for tomcat server to send back an TCP/IP ACK\n- Web server would then send the second ajp packet containing the POST body \ndata\n=> TCP/IP ACK can take as much as 150ms to be sent (Naggle algorithm)\n=> if tomcat app needs to process post data, it will block this amount of time \nbefore being able to process it\n\nIn proxy_util.c, sockets being created do not have the TCP_NODELAY option set: \ni have patched the module and performed testes again. Now, web server no \nlonger waits for the tomcat ack to be sent and post data are sent immediately \nafter the first packet. Response time have then been lowered.\n\nI will attach the patch to proxy_util.c: it applies to non ftp proxy \nconnections. For ftp, i have found that mod_proxy_ftp.c opens its own sockets \nand would require a similar patch not provided here.", "id": 105327, "time": "2007-07-12T07:38:24Z", "creator": "christian_boitel@yahoo.fr", "creation_time": "2007-07-12T07:38:24Z", "is_private": false}, {"count": 1, "tags": [], "creator": "christian_boitel@yahoo.fr", "text": "Created attachment 20497\nPatch for modules/proxy/proxy_util.c\n\nHope this will help and don't forget to patch mod_proxy_ftp.c also", "id": 105328, "time": "2007-07-12T07:39:33Z", "bug_id": 42871, "creation_time": "2007-07-12T07:39:33Z", "is_private": false, "attachment_id": 20497}, {"count": 2, "tags": [], "bug_id": 42871, "attachment_id": null, "text": "In trunk. potential backport for 2.2.x", "id": 106299, "time": "2007-08-03T08:57:21Z", "creator": "jim@apache.org", "creation_time": "2007-08-03T08:57:21Z", "is_private": false}, {"count": 3, "tags": [], "bug_id": 42871, "attachment_id": null, "text": "Proposed for backport as r571936 (http://svn.apache.org/viewvc?rev=571936&view=rev).", "id": 107601, "time": "2007-09-02T02:59:44Z", "creator": "rpluem@apache.org", "creation_time": "2007-09-02T02:59:44Z", "is_private": false}, {"count": 4, "tags": [], "text": "Backported to 2.2.x as r572419 (http://svn.apache.org/viewvc?rev=572419&view=rev).", "attachment_id": null, "id": 107668, "creator": "rpluem@apache.org", "time": "2007-09-03T13:57:06Z", "bug_id": 42871, "creation_time": "2007-09-03T13:57:06Z", "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 54709, "is_private": false, "text": "Created attachment 30056\nPatch to address issue\n\nAccording to the WebSocket specification RFC6455 [1], the official URI schemes for the WebSocket protocol are \"ws\" and \"wss.\" However, o.a.t.websocket.WsWebSocketContainer#connectToServer(...) throws an exception if anything other than \"http\" or \"https\" are specified. I agree with allowing \"http\" and \"https\" for reasons of friendliness (although the correctness of this could be debated; I did not address that in my patch), but \"ws\" and \"wss\" should ALWAYS be allowed here.\n\nAlso, one should be allowed to specify a port for EITHER ws/http OR wss/https. However, the way it was written, you could only specify a port for ws/http, and wss/https always tried to use 443 (I understand that SSL wasn't fully implemented here yet). Imagine the scenario where Tomcat is running on 8080/8443. You would need to specify 8443 as the wss/https port.\n\nI have attached a patch that addresses these issues.\n\n[1] http://tools.ietf.org/html/rfc6455#page-54", "id": 165888, "time": "2013-03-17T08:54:31Z", "creator": "nicholas@nicholaswilliams.net", "creation_time": "2013-03-17T08:54:31Z", "attachment_id": 30056}, {"count": 1, "tags": [], "bug_id": 54709, "attachment_id": null, "is_private": false, "id": 165908, "time": "2013-03-17T18:52:08Z", "creator": "markt@apache.org", "creation_time": "2013-03-17T18:52:08Z", "text": "Thanks for the report.\n\nI fixed this with a slightly different patch. http/https are now not permitted for WebSocket URIs."}, {"count": 2, "tags": [], "bug_id": 54709, "attachment_id": null, "is_private": false, "id": 165909, "time": "2013-03-17T19:02:18Z", "creator": "nicholas@nicholaswilliams.net", "creation_time": "2013-03-17T19:02:18Z", "text": "Note one potential problem:\n\n        if (port == -1) {\n            if (\"ws\".equalsIgnoreCase(scheme)) {\n                sa = new InetSocketAddress(host, 80);\n            } else {\n                // TODO HTTPS support\n                // sa = new InetSocketAddress(host, 443);\n                throw new DeploymentException(\"TODO: HTTPS\");\n            }\n        } else {\n            sa = new InetSocketAddress(host, port);\n        }\n\nNow, I understand that SSL support is not complete yet, but as-written this won't allow customization of the port when connecting via SSL (wss). It is imperative that this be allowed (consider port 8443 as an example). Suggestion:\n\n        if (\"ws\".equalsIgnoreCase(scheme)) {\n            if (port == -1) {\n                port = 80;\n            }\n            sa = new InetSocketAddress(host, port);\n        } else {\n            if (port == -1) {\n                port = 443;\n            }\n            // TODO HTTPS support\n            // sa = new InetSocketAddress(host, port);\n            throw new DeploymentException(\"TODO: HTTPS\");\n        }\n\nOf course, you may be planning on doing that anyway when you complete SSL support."}, {"count": 3, "text": "(In reply to comment #2)\n> Note one potential problem:\n\nI must be being blind. What is the problem here?", "bug_id": 54709, "attachment_id": null, "id": 165910, "time": "2013-03-17T19:08:08Z", "creator": "markt@apache.org", "creation_time": "2013-03-17T19:08:08Z", "tags": [], "is_private": false}, {"count": 4, "tags": [], "creator": "nicholas@nicholaswilliams.net", "attachment_id": null, "id": 165912, "time": "2013-03-17T19:33:27Z", "bug_id": 54709, "creation_time": "2013-03-17T19:33:27Z", "is_private": false, "text": "If SSL support is completed by commenting out:\n\nsa = new InetSocketAddress(host, 443);\n\nThen if someone specifies a URL:\n\nwss://localhost:8443/webSocketEndpoint\n\nThe code will attempt to connect to this instead:\n\nwss://localhost:443/webSocketEndpoint"}, {"count": 5, "tags": [], "bug_id": 54709, "is_private": false, "text": "Scratch that previous comment. I was the one that was blind. Your code will work fine.", "id": 165913, "time": "2013-03-17T19:35:11Z", "creator": "nicholas@nicholaswilliams.net", "creation_time": "2013-03-17T19:35:11Z", "attachment_id": null}]
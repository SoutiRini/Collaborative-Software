[{"count": 0, "tags": [], "bug_id": 51947, "is_private": false, "id": 150111, "attachment_id": 27682, "creator": "freakrob@gmail.com", "creation_time": "2011-10-04T09:24:41Z", "time": "2011-10-04T09:24:41Z", "text": "Created attachment 27682\nTestcase showing a simple reproducable bug.\n\nOverview:\n\nThe bug seems to be related to the bugfix for Bug 43114.\nI encountered the bug while compiling the output of an xjc task, but really any Java folder structure can be used to reproduce the bug.\n\nBasically, the javac task will create empty package-info.class files relative to its current working directory. However, the source tree it sees is relative to the source directory.\n\nHence, when compiling files for source dir srcdir=\"/a/b/c\" where \"/\" is my working directory. Package \"d\" is at \"/a/b/c/d\" and its package-info is at \"/a/b/c/d/package-info.java\". The empty package-info.class file will be created at \"/d/package-info.class\". This is obviously undesired, as the empty class file should be generated in \"/a/b/c/d/package-info.class\".\n\nThis however is generated by javac on its own. It seems the generateMissingPackageInfoClasses() inside the javac task will also search the wrong path for previously compiled package-info.class files.\n\nNotice that my working directory could be any other directory, unrelated to srcdir.\n\nSteps to Reproduce:\n\nPlease see the attached testcase. Reproducible always.\n\nThe folder \"test\" stands for any source tree folder, e.g. folders created by xjc or a regular java project.\n\nBasically call javac task with srcdir != working directory and empty package-info.class files will be generated for package names inside srcdir, but relative to working directory.\n\nActual Results: \n\npackage-info.class is generated at \"com/example/ant_test/package-info.class\" (test_top_level_directory task) resp. \"ant_test/package-info.class\" (test_xml_package_directory task).\n\nExpected Results:\n\nI expected the package-info.class to be generated at \"test/com/example/ant_test/package-info.class\".\n\nOther Platforms:\n\nI think this is a general bug and not restricted to my host OS. However, I could not and dir not test on Linux or Mac or any other Windows platform."}, {"count": 1, "tags": [], "text": "I think this happens because you don't provide the destdir attribute, if you specify destdir=\"test\" things look better.\n\nIt seems as if the default destdir (same as srcdir) isn't applied correctly and I'll look into it, but explicitly setting the destdir should fix your immediate problem (and is recommended anyway).", "attachment_id": null, "id": 150125, "creator": "bodewig@apache.org", "time": "2011-10-04T14:02:02Z", "bug_id": 51947, "creation_time": "2011-10-04T14:02:02Z", "is_private": false}, {"count": 2, "tags": [], "text": "fixed with svn revision 1178820", "attachment_id": null, "id": 150128, "creator": "bodewig@apache.org", "time": "2011-10-04T14:54:35Z", "bug_id": 51947, "creation_time": "2011-10-04T14:54:35Z", "is_private": false}]
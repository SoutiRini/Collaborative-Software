[{"count": 0, "tags": [], "text": "I run Xindice under Windows 98 and use this classpath:\n\nD:\\JDK\\lib\\tools.jar (tried at first and last position of the classpath)\nD:\\XINDICE\\Java\\Lib\\xmldb.jar\nD:\\XINDICE\\Java\\Lib\\XIndice.jar\nD:\\XINDICE\\Java\\Lib\\xalan-2.0.1.jar\nD:\\XINDICE\\Java\\Lib\\XERCES-1.4.3.jar\nD:\\XINDICE\\Java\\Lib\\openorb-1.2.0.jar\nD:\\XINDICE\\Java\\Lib\\ANT-1.4.1.jar\n+ JSDK 1.3.1 or JDK 1.4.01 (tried both)\n\nwhen I start the server with startup.bat, my screen is filled with exceptions \nlike these:\n\n\u0007DEBUG> \njava.lang.IndexOutOfBoundsException\nat java.io.ByteArrayOutputStream.write(ByteArrayOutputStream.java:89)\nat org.apache.xindice.core.filer.Paged$Page.streamTo(Paged.java:992)\nat org.apache.xindice.core.filer.Paged.readValue(Paged.java:163)\nat org.apache.xindice.core.filer.BTreeFiler.readRecord(BTreeFiler.java:131)\nat org.apache.xindice.core.Collection.getDocument(Collection.java:714)\nat org.apache.xindice.core.Collection.putDocument(Collection.java:624)\nat org.apache.xindice.core.Collection.putObject(Collection.java:795)\nat org.apache.xindice.core.Collection.setObject(Collection.java:807)\nat org.apache.xindice.core.SystemCollection.saveSymbols\n(SystemCollection.java:202)\nat org.apache.xindice.core.SystemCollection.loadSymbols\n(SystemCollection.java:185)\nat org.apache.xindice.core.Collection.setConfig(Collection.java:175)\nat org.apache.xindice.core.CollectionManager$1.process\n(CollectionManager.java:96)\nat org.apache.xindice.util.Configuration.processChildren(Configuration.java:684)\nat org.apache.xindice.core.CollectionManager.setConfig\n(CollectionManager.java:92)\nat org.apache.xindice.core.Collection.setConfig(Collection.java:216)\nat org.apache.xindice.core.SystemCollection.init(SystemCollection.java:155)\nat org.apache.xindice.core.Database.setConfig(Database.java:155)\nat org.apache.xindice.server.services.XindiceService.initialize\n(XindiceService.java:106)\nat org.apache.xindice.server.standard.StdServiceManager.addService\n(StdServiceManager.java:166)\nat org.apache.xindice.server.standard.StdServiceManager$1.process\n(StdServiceManager.java:104)\nat org.apache.xindice.util.Configuration.processChildren(Configuration.java:684)\nat org.apache.xindice.server.standard.StdServiceManager.setConfig\n(StdServiceManager.java:90)\nat org.apache.xindice.server.Kernel.loadAPI(Kernel.java:336)\nat org.apache.xindice.server.Kernel.<init>(Kernel.java:150)\nat org.apache.xindice.server.Kernel.<init>(Kernel.java:117)\nat org.apache.xindice.server.Xindice.main(Xindice.java:96)\n\u0007DEBUG> \njava.io.IOException: Negative seek offset\nat java.io.RandomAccessFile.seek(Native Method)\nat org.apache.xindice.core.filer.Paged$Page.read(Paged.java:921)\nat org.apache.xindice.core.filer.Paged.getPage(Paged.java:130)\nat org.apache.xindice.core.filer.Paged.getPage(Paged.java:144)\nat org.apache.xindice.core.filer.Paged.writeValue(Paged.java:207)\nat org.apache.xindice.core.filer.BTreeFiler.writeRecord(BTreeFiler.java:173)\nat org.apache.xindice.core.Collection.putDocument(Collection.java:629)\nat org.apache.xindice.core.Collection.putObject(Collection.java:795)\nat org.apache.xindice.core.Collection.setObject(Collection.java:807)\nat org.apache.xindice.core.SystemCollection.saveSymbols\n(SystemCollection.java:202)\nat org.apache.xindice.core.SystemCollection.loadSymbols\n(SystemCollection.java:185)\nat org.apache.xindice.core.Collection.setConfig(Collection.java:175)\nat org.apache.xindice.core.CollectionManager$1.process\n(CollectionManager.java:96)\nat org.apache.xindice.util.Configuration.processChildren(Configuration.java:684)\nat org.apache.xindice.core.CollectionManager.setConfig\n(CollectionManager.java:92)\nat org.apache.xindice.core.Collection.setConfig(Collection.java:216)\nat org.apache.xindice.core.SystemCollection.init(SystemCollection.java:155)\nat org.apache.xindice.core.Database.setConfig(Database.java:155)\nat org.apache.xindice.server.services.XindiceService.initialize\n(XindiceService.java:106)\nat org.apache.xindice.server.standard.StdServiceManager.addService\n(StdServiceManager.java:166)\nat org.apache.xindice.server.standard.StdServiceManager$1.process\n(StdServiceManager.java:104)\nat org.apache.xindice.util.Configuration.processChildren(Configuration.java:684)\nat org.apache.xindice.server.standard.StdServiceManager.setConfig\n(StdServiceManager.java:90)\nat org.apache.xindice.server.Kernel.loadAPI(Kernel.java:336)\nat org.apache.xindice.server.Kernel.<init>(Kernel.java:150)\nat org.apache.xindice.server.Kernel.<init>(Kernel.java:117)\nat org.apache.xindice.server.Xindice.main(Xindice.java:96)\n\n\nBy editing the Xindice sources I added some messages to track a bit more my \ntrouble and discovered that the readValue function in BTreeFiler::readRecord is \nthe one who failed.\n\npublic synchronized Record readRecord(Key key) throws DBException {\ncheckOpened();\ntry {\nlong pos = findValue(key);\nPage startPage = getPage(pos);\nValue v = readValue(startPage);\nBTreeFilerPageHeader sph = (BTreeFilerPageHeader)startPage.getPageHeader();\n\nHashMap meta = new HashMap(2);\nmeta.put(Record.CREATED, new Long(sph.getCreated()));\nmeta.put(Record.MODIFIED, new Long(sph.getModified()));\n\nreturn new Record(key, v, meta);\n}\ncatch ( BTreeNotFoundException b ) {\n}\ncatch ( BTreeException b ) {\nthrow b;\n}\ncatch ( Exception e ) {\norg.apache.xindice.Debug.printStackTrace(e);\n}\nreturn null;\n}\n\n\nHere the steps:\n1) the system ask for the pos of the key 'database.xml' and got the result 1.\n\n2) then it asks for the startpage at this position: the page header he receive \nis '(pageNum: 1, keyPos: 64, dataPos: -262, offset: 8 192)'\nIt's a sample, but these numbers are most of the time negative and appears to \nhave no sense.\n\n3) it calls the readValue function who fail, acting on a negative number this \nfunction should not use.\n\n\nHowever, even with theses troubles, the server is launched and creating a \ncollection then adding a document is possible. Even queries seems then to work.\n\nbut I have to say that when I stop the server with a:\nxindiceadmin shutdown -c /db\n\nI receive the following dump:\n\norg.omg.CORBA.COMM_FAILURE: vmcid: SUN minor code: 208 completed: Maybe\nat com.sun.corba.se.internal.iiop.IIOPConnection.purge_calls(IIOPConnect\nion.java:438)\nat com.sun.corba.se.internal.iiop.ReaderThread.run(ReaderThread.java:70)\n\nERROR : org.omg.CORBA.COMM_FAILURE: vmcid: SUN minor code: 201 completed: No\nVerify the Xindice server is running\norg.omg.CORBA.COMM_FAILURE: ERROR : org.omg.CORBA.COMM_FAILURE: vmcid: SUN mi\nnor code: 201 completed: No Verify the Xindice server is running vmcid: 0x0 m\ninor code: 0 completed: No\nat org.apache.xindice.tools.XMLTools.process(XMLTools.java:267)\nat org.apache.xindice.tools.XMLAdminTools.main(XMLAdminTools.java:89)\n\n\nand all data I may have stored during this session are lost. At the next \nrestart of Xindice I will only find the collection system available.\n\nMarc.", "is_private": false, "bug_id": 12083, "id": 21806, "time": "2002-08-27T14:39:31Z", "creator": "grunt@noos.fr", "creation_time": "2002-08-27T14:39:31Z", "attachment_id": null}, {"count": 1, "tags": [], "text": "Please try out 1.1 or the cvs head and reopen the bug if you have issues with \nthat version.\n\nYou have done significant work on this, and I would be interested to know if \nthis issue exists in 1.1 core.  If you do find it, please submit the patch in \ndiff -u format (I use eclipse, it's really easy) and I will expedite the \ncommit.\n\nIf you were to be able to create a junit first, that would be great.", "attachment_id": null, "id": 38085, "creation_time": "2003-05-30T23:31:29Z", "time": "2003-05-30T23:31:29Z", "creator": "Kevin.Ross@iVerticalLeap.com", "bug_id": 12083, "is_private": false}]
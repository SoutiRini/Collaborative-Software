[{"count": 0, "tags": [], "bug_id": 47186, "attachment_id": null, "text": "http://httpd.apache.org/docs/2.2/rewrite/rewrite_guide.html#canonicalhost\nneeds to be corrected as follows, or else it will fail outside of ASCII.\n-RewriteRule ^/(.*) http://fully.qualified.domain.name/$1 [L,R]\n+RewriteRule ^/(.*) http://fully.qualified.domain.name/$1 [L,R,NE]\nOtherwise the QUERY_STRING will get doubly escaped!:\n$ set radioscanningtw.jidanni.org/index.php?title=%E9%A6%96%E9%A0%81\\&uselang=en\n$ w3m -dump http://$1|head\nJump to: navigation, search...\n$ w3m -dump http://www.$1|head\nThe requested page title was invalid, empty, or an incorrectly linked...\n$ HEAD -PS http://$1|head -n 2\nHEAD http://radioscanningtw.jidanni.org/index.php?title=%E9%A6%96%E9%A0%81&uselang=en --> 200 OK\n$ HEAD -PS http://www.$1|head -n 2\nHEAD http://www.radioscanningtw.jidanni.org/index.php?title=%E9%A6%96%E9%A0%81&uselang=en --> 301 Moved Permanently\nHEAD http://radioscanningtw.jidanni.org/index.php?title=%25E9%25A6%2596%25E9%25A0%2581&uselang=en --> 200 OK\n(I will tell the MediaWiki people to return 404.)\n\nThe preceding is the situation on Dreamhost when one clicks their\n\"rewrite my URL without WWW\" option on their control panel, and not the\nproduct of junior programmer me. It also probably affects those who\nchose their \"Always add WWW\" option.\n\nSo any of their hundreds of thousands of users are affected, the moment\nany non ASCII is attempted... all presumably due to poor advice there in\nthe Apache manual, perhaps.\n\nAnd the problem was not detected earlier because most of their users are\nUSA ASCII website making people, perhaps.\n\nI will tell Dreamhost to have a look at this bug report.\n\nHowever I would also like to note that on my home machine, I needed to change\n-RewriteRule ^/(.*) http://fully.qualified.domain.name/$1 [L,R,NE]\n+RewriteRule   (.*) http://fully.qualified.domain.name/$1 [L,R,NE]\nduring my experiments too.", "id": 126961, "time": "2009-05-12T14:19:54Z", "creator": "jidanni@jidanni.org", "creation_time": "2009-05-12T14:19:54Z", "is_private": false}, {"count": 1, "tags": [], "bug_id": 47186, "attachment_id": null, "text": "That doesn't seem right at all. Surely the query string shouldn't be included in what RewriteRule matches at all. Adding [NE] certainly won't hurt, but I don't quite get why it would fix this particular problem.", "id": 126964, "time": "2009-05-12T18:33:33Z", "creator": "rbowen@apache.org", "creation_time": "2009-05-12T18:33:33Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 47186, "text": "Done in r774161: although it won't do anything for the query string, it does indeed prevent URIs from getting double-escaped. Thanks for the report.", "id": 126965, "time": "2009-05-12T18:36:50Z", "creator": "rbowen@apache.org", "creation_time": "2009-05-12T18:36:50Z", "is_private": false, "attachment_id": null}]
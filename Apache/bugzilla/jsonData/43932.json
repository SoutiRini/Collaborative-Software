[{"count": 0, "tags": [], "bug_id": 43932, "is_private": false, "id": 110945, "attachment_id": null, "creator": "jann.forrer@id.unizh.ch", "creation_time": "2007-11-21T11:41:02Z", "time": "2007-11-21T11:41:02Z", "text": "If i start to edit a document with Kupu or BXE and save the changes the\nnamespaces are removed from the html Tag and the Form Editor throws an exception\n if i try to save changes\n\nhtml Tag Before editing (let's say) with Kupu: \n\n<html xmlns=\"http://www.w3.org/1999/xhtml\" \n      xmlns:xhtml=\"http://www.w3.org/1999/xhtml\" \n      xmlns:lenya=\"http://apache.org/cocoon/lenya/page-envelope/1.0\"\n>\n\nAfter editing with Kupu:\n\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\n\nThe Error itself is thrown by  \norg.apache.lenya.cms.editors.form.FormsEditor.java (line 397) and the problem is\nwithin the \norg.xmldb.xupdate.lexus.XUpdateQueryImpl execute method."}, {"count": 1, "tags": [], "text": "I am not sure how to fix it. Is this rather a problem of the save method of the\nWysiwyg editors?", "attachment_id": null, "id": 110946, "creator": "jann.forrer@id.unizh.ch", "time": "2007-11-21T11:43:58Z", "bug_id": 43932, "creation_time": "2007-11-21T11:43:58Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 43932, "text": "I get\n\norg.apache.xpath.domapi.XPathStylesheetDOM3Exception: Das Pr\u00e4fix muss in einen\nNamensbereich aufgel\u00f6st werden: xhtml\n\tat org.apache.xpath.compiler.XPathParser.errorForDOM3(XPathParser.java:653)\n\tat org.apache.xpath.compiler.Lexer.mapNSTokens(Lexer.java:638)\n\tat org.apache.xpath.compiler.Lexer.tokenize(Lexer.java:265)\n\tat org.apache.xpath.compiler.Lexer.tokenize(Lexer.java:96)\n\tat org.apache.xpath.compiler.XPathParser.initXPath(XPathParser.java:110)\n\tat org.apache.xpath.XPath.<init>(XPath.java:176)\n\tat org.apache.xpath.XPathAPI.eval(XPathAPI.java:273)\n\tat\norg.xmldb.common.xml.queries.xalan2.XPathQueryImpl.execute(XPathQueryImpl.java:109)\n\tat org.xmldb.xupdate.lexus.commands.CommandObject.selectNodes(Unknown Source)\n\tat org.xmldb.xupdate.lexus.commands.InsertAfterCommand.execute(Unknown Source)\n\tat org.xmldb.xupdate.lexus.XUpdateQueryImpl.execute(Unknown Source)\n\tat\norg.apache.lenya.cms.editors.forms.FormsEditor.processElements(FormsEditor.java:397)", "id": 110947, "attachment_id": null, "creator": "andreas@apache.org", "creation_time": "2007-11-21T11:58:06Z", "time": "2007-11-21T11:58:06Z", "is_private": false}, {"count": 3, "tags": [], "text": "IMO it's a forms editor problem. The documents are fine, and the forms editor\ncomplains about the XHTML namespace.", "attachment_id": null, "id": 110948, "creator": "andreas@apache.org", "time": "2007-11-21T12:00:14Z", "bug_id": 43932, "creation_time": "2007-11-21T12:00:14Z", "is_private": false}, {"count": 4, "tags": [], "bug_id": 43932, "is_private": false, "id": 110949, "attachment_id": null, "creator": "andreas@apache.org", "creation_time": "2007-11-21T12:24:20Z", "time": "2007-11-21T12:24:20Z", "text": "The XUpdate statement looks like this:\n\n<?xml version=\"1.0\"?>\n<xupdate:modifications xmlns:xupdate=\"http://www.xmldb.org/xupdate\"\n  xmlns=\"http://www.w3.org/1999/xhtml\">\n  <xupdate:insert-after select=\"/*/xhtml:body/xhtml:h1[@tagID='tag.0.1.0'] \">\n    <xupdate:element name=\"xhtml:h1\"\nnamespace=\"http://www.w3.org/1999/xhtml\"><xupdate:attribute\n        name=\"tagID\">temp</xupdate:attribute>Hello and welcome to the Lenya\ndefault publication!\n      \u00e4\u00f6\u00fc\u00df foo</xupdate:element>\n  </xupdate:insert-after>\n  <xupdate:remove select=\"/*/xhtml:body/xhtml:h1[@tagID='tag.0.1.0'] \"/>\n  <xupdate:update select=\"/*/xhtml:body/xhtml:h1[@tagID='temp']/@tagID\n\">tag.0.1.0</xupdate:update>\n</xupdate:modifications>"}, {"count": 5, "tags": [], "text": "The XUpdate statements in the form contain namespace prefixes which are not\ndeclared in the document:\n\n<input value=\"true\" name=\"&lt;xupdate:remove\nselect=&quot;/*/xhtml:body/xhtml:h1[@tagID='tag.0.1.0']&quot;/&gt;\"\n\nThat's why the XUpdate query fails.", "attachment_id": null, "id": 110950, "creator": "andreas@apache.org", "time": "2007-11-21T12:34:52Z", "bug_id": 43932, "creation_time": "2007-11-21T12:34:52Z", "is_private": false}, {"count": 6, "tags": [], "creator": "andreas@apache.org", "attachment_id": null, "text": "The prefixes are hardcoded in\nsrc/pubs/default/lenya/modules/editors/usecases/forms/xhtml.xsl\n\n----\n\n<namespace prefix=\"xhtml\" uri=\"http://www.w3.org/1999/xhtml\"/>\n<namespace prefix=\"lenya\" uri=\"http://apache.org/cocoon/lenya/page-envelope/1.0\"/>\n<namespace prefix=\"dc\" uri=\"http://purl.org/dc/elements/1.1/\"/>\n  \n<node name=\"Title\"\nselect=\"/xhtml:html/lenya:meta/dc:title[@tagID='{lenya:meta/dc:title/@tagID}']\">\n  <content><input type=\"text\" name=\"&lt;xupdate:update\nselect=&quot;/xhtml:html/lenya:meta/dc:title[@tagID='{lenya:meta/dc:title/@tagID}']&quot;&gt;\"\nsize=\"40\"><xsl:attribute name=\"value\"><xsl:value-of\nselect=\"lenya:meta/dc:title\"/></xsl:attribute></input></content>\n</node>\n", "id": 110952, "time": "2007-11-21T12:48:51Z", "bug_id": 43932, "creation_time": "2007-11-21T12:48:51Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 43932, "text": "http://www.mail-archive.com/xupdate-dev@xmldb.org/msg00295.html\n\n\"3) I will attempt to modify how namespace prefixes are resolved so that\nnamespace declarations *within the XUpdate <modifications> XML* will be\nused rather than the declarations within the target document(s). This\nchange may be within Xindice code or it could be in the Lexus code. I'm\nnot sure how to go about getting the latest Lexus code, or how to submit\nchanges if it becomes necessary to do so: Any advice on how to proceed\nwith possible changes in Lexus code would be appreciated.\"", "id": 110959, "time": "2007-11-21T13:56:24Z", "creator": "andreas@apache.org", "creation_time": "2007-11-21T13:56:24Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "text": "It doesn't work even when the namespaces are declared in the XUpdate query:\n\n<?xml version=\"1.0\"?>\n<xupdate:modifications xmlns:xupdate=\"http://www.xmldb.org/xupdate\"\n  xmlns:xhtml=\"http://www.w3.org/1999/xhtml\" xmlns=\"http://www.w3.org/1999/xhtml\">\n  <xupdate:insert-after select=\"/*/xhtml:body/xhtml:h1[@tagID='tag.0.1.0'] \">\n    <xupdate:element name=\"xhtml:h1\"\nnamespace=\"http://www.w3.org/1999/xhtml\"><xupdate:attribute\n        name=\"tagID\">temp</xupdate:attribute>Hello and welcome to the Lenya\ndefault publication!\n      \u00e4\u00f6\u00fc\u00df asdf</xupdate:element>\n  </xupdate:insert-after>\n  <xupdate:remove select=\"/*/xhtml:body/xhtml:h1[@tagID='tag.0.1.0'] \"/>\n  <xupdate:update select=\"/*/xhtml:body/xhtml:h1[@tagID='temp']/@tagID\n\">tag.0.1.0</xupdate:update>\n</xupdate:modifications>", "attachment_id": null, "id": 110961, "creator": "andreas@apache.org", "time": "2007-11-21T14:00:47Z", "bug_id": 43932, "creation_time": "2007-11-21T14:00:47Z", "is_private": false}, {"count": 9, "tags": [], "creator": "andreas@apache.org", "is_private": false, "id": 110968, "attachment_id": null, "bug_id": 43932, "creation_time": "2007-11-21T16:42:24Z", "time": "2007-11-21T16:42:24Z", "text": "Should be fixed in revision 597275."}]
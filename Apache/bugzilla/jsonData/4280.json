[{"count": 0, "tags": [], "bug_id": 4280, "text": "Symptom:\nWe are using a load balancer that listens on port 80. And tomcat 4 is running \non several different machines on port 8080. When I accessed the virtual host on \nthe local balancer http://somehostname.com/, it redirected me to the welcome \nfile \"start.jsp\" (defined in my web.xml). But it set the port number \nincorrectly to http://somehostname.com:8080/start.jsp in the redirect location.\n\nSolution:\nI found that in org.apache.catalina.connector.http.HttpProcessor, it checks the \nhost header in the http request. But if the port number is not found in the \nhost, it simply ignores it, which means it use the port number defined in \nserver.xml for this connector. It should set the port to 80 in the request \nobject if the port number is not found in the host header.\n\nHere is the modified code in the parseHeaders(SocketInputStream) method:\n\n           } else if (header.equals(DefaultHeaders.HOST_NAME)) {\n                int n = value.indexOf(':');\n                if (n < 0) {\n                    if (proxyName != null)\n                        request.setServerName(proxyName);\n                    else\n                    {\n                        request.setServerName(value);\n                        request.setServerPort(80);\n                    }\n...\n...\n\nChi", "id": 6854, "time": "2001-10-18T15:39:36Z", "creator": "chi@atypon.com", "creation_time": "2001-10-18T15:39:36Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "remm@apache.org", "attachment_id": null, "is_private": false, "id": 6859, "time": "2001-10-18T16:46:10Z", "bug_id": 4280, "creation_time": "2001-10-18T16:46:10Z", "text": "Shouldn't you be using the proxyPort attribute to do that (in addition to the \nproxyName attribute) ?\nIf I misunderstood the bug, please reopen it."}]
[{"count": 0, "tags": [], "creator": "phocis@gmail.com", "text": "All of my permissions are correct.\n\nsu apache ls /my/vfat/mount/my-conf-include.conf\nshows me that my permissions are okay.\n\n\nAnd my symlinks are okay.\nsu apache ls /my/symlink-to-my-vfat-mount/my-conf-include.conf\nshows me that my symlink is peachy.\n\nHowever, whenever I try to start apache with an include to an conf file that\nresides on my vfat partition, apache fails to start or even yield an error. My\n/var/log/httpd/error_log is empty!\n\nI've looked for help for this everywhere, and it seems that there is no solution\nand other people are having this problem too.", "id": 77641, "time": "2005-07-25T21:58:13Z", "bug_id": 35856, "creation_time": "2005-07-25T21:58:13Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "bug_id": 35856, "attachment_id": null, "text": "Start the web server under strace and look at the open calls to see if Apache is\nopening the expected file, and what the OS is returning when it does.\n\nstrace -o /tmp/tracefile -f /path/to/apachectl start\n(this should exit when the failure occurs)\n\ngrep open /tmp/tracefile\n", "id": 77658, "time": "2005-07-26T12:31:05Z", "creator": "trawick@apache.org", "creation_time": "2005-07-26T12:31:05Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 35856, "attachment_id": null, "id": 77683, "time": "2005-07-26T22:27:01Z", "creator": "phocis@gmail.com", "creation_time": "2005-07-26T22:27:01Z", "is_private": false, "text": "(In reply to comment #1)\n> Start the web server under strace and look at the open calls to see if Apache is\n> opening the expected file, and what the OS is returning when it does.\n> \n> strace -o /tmp/tracefile -f /path/to/apachectl start\n> (this should exit when the failure occurs)\n> \n> grep open /tmp/tracefile\n> \nThe error is this:\n3359  open(\"/os_share/sites/linux-httpd.inc.conf\", O_RDONLY) = -1 EACCES\n(Permission denied)\n\nHowever:\n[root@localhost halion]# su apache\nbash-3.00$ cat /os_share/sites/linux-httpd.inc.conf\n#Empty conf file. Except for this comment.\n\nAlso, to prove that my httpd service is being run as the user apache (note, this\nis when apache does NOT try to include a conf off of a vfat):\n[root@localhost halion]# ps aux |grep apache\napache    4026  0.0  1.3  20904 10692 ?        S    13:19   0:00 /usr/sbin/httpd\napache    4027  0.0  1.3  20904 10692 ?        S    13:19   0:00 /usr/sbin/httpd\napache    4028  0.0  1.3  20904 10692 ?        S    13:19   0:00 /usr/sbin/httpd\napache    4029  0.0  1.3  20904 10692 ?        S    13:19   0:00 /usr/sbin/httpd\napache    4030  0.0  1.3  20904 10692 ?        S    13:19   0:00 /usr/sbin/httpd\napache    4031  0.0  1.3  20904 10692 ?        S    13:19   0:00 /usr/sbin/httpd\napache    4032  0.0  1.3  20904 10692 ?        S    13:19   0:00 /usr/sbin/httpd\napache    4033  0.0  1.3  20904 10692 ?        S    13:19   0:00 /usr/sbin/httpd\nroot      4082  0.0  0.0   3764   696 pts/2    R+   13:23   0:00 grep apache\n\n\nUpon further inspection a trace grepped with \"= \\1\" gives the following:\n\n[root@localhost halion]# cat trace-without-include\naccess(\"/etc/ld.so.preload\", R_OK)      = -1 ENOENT (No such file or directory)\nioctl(3, SNDCTL_TMR_TIMEBASE or TCGETS, 0xbfa43b38) = -1 ENOTTY (Inappropriate\nioctl for device)\nwaitpid(-1, 0xbfa430ec, WNOHANG)        = -1 ECHILD (No child processes)\nwaitpid(-1, 0xbfa430ec, WNOHANG)        = -1 ECHILD (No child processes)\nstat64(\"/sbin/env\", 0xbfa43574)         = -1 ENOENT (No such file or directory)\nstat64(\"/usr/sbin/env\", 0xbfa43574)     = -1 ENOENT (No such file or directory)\nwaitpid(-1, 0xbfa4329c, WNOHANG)        = -1 ECHILD (No child processes)\n\n\nThe above works. It runs. It's good. I like it. However, it doesnt do the\ninclude. Below is the same grepped trace, except the httpd.conf file has the\ninclude in it.\n\n[root@localhost halion]# cat trace-with-include\n3527  access(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory)\n3527  ioctl(3, SNDCTL_TMR_TIMEBASE or TCGETS, 0xbf8f3888) = -1 ENOTTY\n(Inappropriate ioctl for device)\n3528  stat64(\"/sbin/basename\", 0xbf8f2e84) = -1 ENOENT (No such file or directory)\n3528  stat64(\"/usr/sbin/basename\", 0xbf8f2e84) = -1 ENOENT (No such file or\ndirectory)\n3528  access(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory)\n3527  waitpid(-1, 0xbf8f2e3c, WNOHANG)  = -1 ECHILD (No child processes)\n3529  stat64(\"/sbin/basename\", 0xbf8f2e84) = -1 ENOENT (No such file or directory)\n3529  stat64(\"/usr/sbin/basename\", 0xbf8f2e84) = -1 ENOENT (No such file or\ndirectory)\n3529  access(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory)\n3527  waitpid(-1, 0xbf8f2e3c, WNOHANG)  = -1 ECHILD (No child processes)\n3527  stat64(\"/sbin/env\", 0xbf8f32c4)   = -1 ENOENT (No such file or directory)\n3527  stat64(\"/usr/sbin/env\", 0xbf8f32c4) = -1 ENOENT (No such file or directory)\n3530  access(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory)\n3530  access(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory)\n3530  connect(3, {sa_family=AF_FILE, path=\"/var/run/nscd/socket\"}, 110) = -1\nECONNREFUSED (Connection refused)\n3530  connect(3, {sa_family=AF_FILE, path=\"/var/run/nscd/socket\"}, 110) = -1\nECONNREFUSED (Connection refused)\n3530  ioctl(3, SNDCTL_TMR_TIMEBASE or TCGETS, 0xbf8e43e8) = -1 ENOTTY\n(Inappropriate ioctl for device)\n3532  access(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory)\n3531  waitpid(-1, 0xbf8e2e5c, WNOHANG)  = -1 ECHILD (No child processes)\n3530  waitpid(-1, 0xbf8e3294, WNOHANG)  = -1 ECHILD (No child processes)\n3530  access(\"/etc/sysconfig/i18n\", X_OK) = -1 EACCES (Permission denied)\n3530  access(\"/etc/sysconfig/init\", X_OK) = -1 EACCES (Permission denied)\n3530  open(\"/usr/share/locale/en_US.UTF-8/LC_MESSAGES/initscripts.mo\", O_RDONLY)\n= -1 ENOENT (No such file or directory)\n3530  open(\"/usr/share/locale/en_US.utf8/LC_MESSAGES/initscripts.mo\", O_RDONLY)\n= -1 ENOENT (No such file or directory)\n3530  open(\"/usr/share/locale/en_US/LC_MESSAGES/initscripts.mo\", O_RDONLY) = -1\nENOENT (No such file or directory)\n3530  open(\"/usr/share/locale/en.UTF-8/LC_MESSAGES/initscripts.mo\", O_RDONLY) =\n-1 ENOENT (No such file or directory)\n3530  open(\"/usr/share/locale/en.utf8/LC_MESSAGES/initscripts.mo\", O_RDONLY) =\n-1 ENOENT (No such file or directory)\n3530  open(\"/usr/share/locale/en/LC_MESSAGES/initscripts.mo\", O_RDONLY) = -1\nENOENT (No such file or directory)\n3530  access(\"/etc/sysconfig/httpd\", X_OK) = -1 EACCES (Permission denied)\n3530  stat64(\"/sbin/grep\", 0xbf8e1314)  = -1 ENOENT (No such file or directory)\n3530  stat64(\"/usr/sbin/grep\", 0xbf8e1314) = -1 ENOENT (No such file or directory)\n3533  access(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory)\n3530  waitpid(-1, 0xbf8e103c, WNOHANG)  = -1 ECHILD (No child processes)\n3530  stat64(\"/var/run/httpd.pid\", 0xbf8e0458) = -1 ENOENT (No such file or\ndirectory)\n3534  access(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory)\n3534 \nopen(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/tls/i686/sse2/libperl.so\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534 \nopen(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/tls/i686/libperl.so\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534 \nopen(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/tls/sse2/libperl.so\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534  open(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/tls/libperl.so\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534 \nopen(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/i686/sse2/libperl.so\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534  open(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/i686/libperl.so\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534  open(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/sse2/libperl.so\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534 \nopen(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/tls/i686/sse2/libutil.so.1\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534 \nopen(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/tls/i686/libutil.so.1\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534 \nopen(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/tls/sse2/libutil.so.1\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534  open(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/tls/libutil.so.1\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534 \nopen(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/i686/sse2/libutil.so.1\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534 \nopen(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/i686/libutil.so.1\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534 \nopen(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/sse2/libutil.so.1\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534  open(\"/usr/lib/perl5/5.8.6/i386-linux-thread-multi/CORE/libutil.so.1\",\nO_RDONLY) = -1 ENOENT (No such file or directory)\n3534  stat64(\"/os_share/sites/linux-httpd.inc.conf\", 0xbfebbe54) = -1 EACCES\n(Permission denied)\n3534  open(\"/os_share/sites/linux-httpd.inc.conf\", O_RDONLY) = -1 EACCES\n(Permission denied)\n3530  waitpid(-1, 0xbf8e13fc, WNOHANG)  = -1 ECHILD (No child processes)\n3535  access(\"/etc/ld.so.preload\", R_OK) = -1 ENOENT (No such file or directory)\n3535  fcntl64(3, 0x800 /* F_??? */, 0)  = -1 EINVAL (Invalid argument)\n3535  connect(3, {sa_family=AF_FILE, path=\"/etc/rhgb/temp/rhgb-socket\"}, 110) =\n-1 ENOENT (No such file or directory)\n3530  waitpid(-1, 0xbf8e061c, WNOHANG)  = -1 ECHILD (No child processes)\n3527  waitpid(-1, 0xbf8f2fec, WNOHANG)  = -1 ECHILD (No child processes)\n\nThe apache start with the trace above fails.\n\nIncase you just scrolled down this document, it contains console exerpts of\napache's cat of the vfat file (works), proof that httpd is being run as user\napache (true), the strace of the apache run without the include (works), and the\napache run with the include (fails).\n\nThe big error that I see is that the permission is denied, even though the\nprocess really has permisison.\n\nI'm not a very smart guy, but I have a partial theory. Does apache use it's own\nfilesystem handlers to speed up file loading? Would these not have support for\nvfat? If not, would there be any way of being able to create support for them?\n\nI've also experienced this problem with mysql."}, {"count": 3, "tags": [], "bug_id": 35856, "text": "I guess this is Fedora, you have SELinux enabled, and you haven't labelled the\nconfig files properly.  Do:\n\n  chcon -t httpd_config_t /path/to/included/config/file.conf\n\n(if that works for a FAT filesystem) on each of the config files you need to\nload outside /etc/httpd, and I'd recommend reading up on SELinux:\n\n  http://fedora.redhat.com/docs/selinux-apache-fc3/\n  http://fedora.redhat.com/docs/selinux-faq-fc3/\n\ntry fedora-selinux-list@redhat.com for more help.\n", "id": 77690, "time": "2005-07-26T23:36:00Z", "creator": "jorton@redhat.com", "creation_time": "2005-07-26T23:36:00Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "text": "Wow, you were completly right. Too bad I had to submit a bug for that. Honestly,\nthis is the last place I decided to look (after a few days of headscratching,\nforum searching, and doc reading). I wish SElinux was alittle more verbose about\nwhat it was blocking.\n\nYou, buy the way, rock my world.", "attachment_id": null, "bug_id": 35856, "id": 77701, "time": "2005-07-27T04:35:15Z", "creator": "phocis@gmail.com", "creation_time": "2005-07-27T04:35:15Z", "is_private": false}]
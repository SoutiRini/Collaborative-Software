[{"count": 0, "tags": [], "creator": "Rolf.Sponsel@kstr.lth.se", "text": "The return links, i.e. the links linking back to the refering page, in the\nCustomizable ErrorDocument Pages fail to return to their refering page, if the\nrefering page's URI had a non-null QUERY_STRING, e.g. '/index.html?query_string'.\n\nThe return link is represented as '/index.html%3fquery_string', i.e. to an page\nthat most likely does not exist, and thus will result in a \"HTTP 404 : Object\nnot found\" error instead of returning to the user back to\n'/index.html?query_string'.\n\nI noticed that the URL in these pages is inserted as <!--#echo encoding=\"url\"\nvar=\"HTTP_REFERER\" -->, and thus url-encodes the separating '?' between the\nDOCUMENT_URI and QUERY_STRING, i.e. represents it as '%3f' instead of just '?'.\n\nThe following pages are affected by this, IMHO, bug:\n\nHTTP_GONE.html.var         ( one instance per locale )\nHTTP_NOT_FOUND.html.var    ( two instance per locale )\n\nand possibly also:\n\nHTTP_UNATUHORIZED.html.var ( one instance per locale )\n\n\nI'm not sure if it is sufficient to change the encoding to \"none\", or if there\nis need to explicitly represent these return-links with an explicit '?'\nseparating the DOCUMENT_URI and QUERY_STRING. Probably the latter approach is\nneeded.\n\n\nYou should be able to trigger this behaviour by:\n\n1). Enable Customizable ErrorDocuments, and restart httpd.\n2). Create a page, e.g. index.html, containing a link to\n    a page that doesn't exsit, e.g. '/FILE-DOES-NOT-EXIST'.\n3). Access that page via 'http://localhost/index.html?query_string'.\n4). Click on the (broken) link to '/FILE-DOES-NOT-EXIST',\n    which should trigger a 'Error: 404 - Object not found!'\n    error response.\n5). Click on either the 'referring page', or 'that page' link\n    in order to - at least intending to - return to your\n    '/index.html' page. This will fail, and trigger another\n     404 error instead of returning to '/index.html?query_string'.\n\n\nAs always; should you need more information, the just let me know.\n\nBest Regards,\nRolf Sponsel", "id": 56343, "time": "2004-04-24T23:57:53Z", "bug_id": 28574, "creation_time": "2004-04-24T23:57:53Z", "is_private": false, "attachment_id": null}, {"count": 1, "tags": [], "creator": "slive@apache.org", "text": "Not so easy to fix.  Although the Referer will almost certainly already by\nURL-encoded when we get it, we need to encode it again to prevent cross-site\nscripting problems.  But double-encoding results in a bunch of problems.  In\naddition to the \"?\", there are probably issues with \"%\", \"&\", etc.  I have no\nidea how to fix that.", "id": 56364, "time": "2004-04-25T15:22:45Z", "bug_id": 28574, "creation_time": "2004-04-25T15:22:45Z", "is_private": false, "attachment_id": null}, {"attachment_id": null, "tags": [], "bug_id": 28574, "is_private": false, "count": 2, "id": 56367, "time": "2004-04-25T16:26:36Z", "creator": "nd@perlig.de", "creation_time": "2004-04-25T16:26:36Z", "text": "It should be sufficient to html encode it (to prevent XSS). If it's not a valid\nURL - *shrug*. Then the browser may be broken or whatever."}, {"attachment_id": null, "tags": [], "bug_id": 28574, "is_private": false, "count": 3, "id": 56368, "time": "2004-04-25T16:33:49Z", "creator": "Rolf.Sponsel@kstr.lth.se", "creation_time": "2004-04-25T16:33:49Z", "text": "FYI, the browser that fails is Mozilla 1.5 (on Windows/NT).\n\n\n"}, {"attachment_id": null, "tags": [], "bug_id": 28574, "text": "Seems to me like changing the encoding to \"none\" fixes the problem.\n\nAfter that go to '/index.html?test&hello&%3with space', and trigger the error as\ninitially described, follow the additional steps.\n\nThis works for me, i.e. I manage to get back to the refering page *with* the\ninitial options in place as the are expected.\n\n\nDo you have any exceptional situations in mind, that you wan't me to try?\n\n\nBest Regards,\nRolf Sponsel", "count": 4, "id": 56369, "time": "2004-04-25T17:28:43Z", "creator": "Rolf.Sponsel@kstr.lth.se", "creation_time": "2004-04-25T17:28:43Z", "is_private": false}, {"attachment_id": null, "tags": [], "bug_id": 28574, "text": "Nope, encoding needs to be set to \"entity\" (which is default, so just leave the\nparameter out).", "count": 5, "id": 56370, "time": "2004-04-25T17:34:07Z", "creator": "nd@perlig.de", "creation_time": "2004-04-25T17:34:07Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 28574, "attachment_id": null, "text": "Yepp! Removing the encoding attribute entirely seems to work.\n", "id": 56371, "time": "2004-04-25T17:48:47Z", "creator": "Rolf.Sponsel@kstr.lth.se", "creation_time": "2004-04-25T17:48:47Z", "is_private": false}, {"count": 7, "tags": [], "creator": "nick@webthing.com", "text": "Comment #6 seems to indicate that this was a user issue, and the fix was in the\ncustom errordocuments rather than in apache.  Correct me if I'm wrong?", "id": 113900, "time": "2008-02-19T14:10:34Z", "bug_id": 28574, "creation_time": "2008-02-19T14:10:34Z", "is_private": false, "attachment_id": null}]
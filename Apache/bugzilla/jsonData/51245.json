[{"count": 0, "attachment_id": null, "creator": "alexander.chingarev@duallab.com", "text": "See attachment: zip includes source fo file and dstination pdf.\n\nIf display-align is \"after\" and actual text height is a bit bigger than block-container height then text is shifted down and clipped by the block-container border.", "id": 146544, "time": "2011-05-23T13:46:06Z", "bug_id": 51245, "creation_time": "2011-05-23T13:46:06Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": 27046, "creator": "alexander.chingarev@duallab.com", "text": "Created attachment 27046\nsource fo and destination pdf", "id": 146545, "time": "2011-05-23T13:46:44Z", "bug_id": 51245, "creation_time": "2011-05-23T13:46:44Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 51245, "text": "Hi Alexander,\n\nThanks for your simple test case. In short, this is because the content of the block-container doesn't fit within the given height. You must have seen the following warning given by FOP:\n\"Content overflows the viewport of an fo:block-container in block-progression direction by 600 millipoints. Content will be clipped.\"\nIf you extend the height of the block-container to 58pt then you should get what you want.\n\nIf you're happy with that solution, brilliant. If for some reason you don't want to extend the height of the block-container accordingly, then you are hitting a bug in FOP whose gory details are below.\n\nIn BlockContainerLM.getNextKnuthElementsAbsolute, FOP creates an instance of BlockContainerBreaker that in turn creates a PageBreakingAlgorithm instance. Since the content doesn't fit in the block-container, the algorithm breaks it into two parts. The second part just contains the last line, so most of the second part is filled with empty space (42.6pt in the present case). And this is this amount that is being taken into account to shift the content down to the bottom of the b-c. This is done in AbstractBreaker.addAreas (\"if (pbp.difference != 0 && displayAlign == Constants.EN_AFTER) {\"). 0 should be used instead.\n\nI don't currently have an idea of how to fix this issue. This part of the code is very tricky and even a minor modification may lead to regressions.\n\nVincent", "id": 147727, "time": "2011-07-04T18:17:23Z", "creator": "vhennebert@gmail.com", "creation_time": "2011-07-04T18:17:23Z", "is_private": false, "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 51245, "text": "Hi Vincent,\n\nThank you very much for so detailed explanation. Unfortunately we cannot extend the block-container.\n\nBut it gives me some thoughts on how to deal with the issue. At least I can try to pop up the warning.\n\nKind Regards,\nAlexander", "id": 147827, "time": "2011-07-08T09:30:36Z", "creator": "alexander.chingarev@duallab.com", "creation_time": "2011-07-08T09:30:36Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 51245, "is_private": false, "text": "Created attachment 27381\nPatched AbstractBreaker.java", "id": 148586, "time": "2011-08-12T09:55:07Z", "creator": "alexander.chingarev@duallab.com", "creation_time": "2011-08-12T09:55:07Z", "attachment_id": 27381}, {"attachment_id": null, "tags": [], "creator": "alexander.chingarev@duallab.com", "text": "Hi Vincent,\n\nWe dived into internals of page breaking algorithm and seems it is not correctly applied to fo:block-container.\n\nWe overrided doLayout method in BlockContainerLayoutManager.java so it implements different page pareaking logics. The only difference in overriden function is:\nint optimalPageCount = alg.findBreakingPoints(effectiveList, 1, true,      BreakingAlgorithm.ONLY_FORCED_BREAKS);\ninstead of\nint optimalPageCount = alg.findBreakingPoints(effectiveList, 1, true,      BreakingAlgorithm.ALL_BREAKS);\n\nSeems it fixes the issue. \n\nCan you please take a look at the fix? Do you see any potencial regressions of it?\n\nModified AbstractBreaker.java and BlockContainerLayoutManager.java are attached.\n\nKind Regards,\nAlexander", "count": 5, "id": 148587, "time": "2011-08-12T09:55:38Z", "bug_id": 51245, "creation_time": "2011-08-12T09:55:38Z", "is_private": false}, {"count": 6, "tags": [], "bug_id": 51245, "is_private": false, "text": "Created attachment 27382\nPatched BlockContainerLayoutManager.java", "id": 148588, "time": "2011-08-12T09:56:22Z", "creator": "alexander.chingarev@duallab.com", "creation_time": "2011-08-12T09:56:22Z", "attachment_id": 27382}, {"count": 7, "attachment_id": null, "creator": "vhennebert@gmail.com", "text": "Hi Alexander,\n\nFrom which Subversion revision of FOP did you work? When I diff the attached files against the Trunk I find many differences that are clearly not related to your changes.\n\nIt would be really helpful if you could attach a diff instead of the whole files. You can do this by checking out the latest Trunk [1], applying your changes and then running 'svn diff'.\n\n[1] http://xmlgraphics.apache.org/fop/download.html#source\n\nThanks,\nVincent", "id": 150503, "time": "2011-10-12T18:57:29Z", "bug_id": 51245, "creation_time": "2011-10-12T18:57:29Z", "tags": [], "is_private": false}, {"count": 8, "tags": [], "bug_id": 51245, "is_private": false, "text": "resetting P2 open bugs to P3 pending further review", "id": 157302, "time": "2012-04-07T01:41:20Z", "creator": "gadams@apache.org", "creation_time": "2012-04-07T01:41:20Z", "attachment_id": null}, {"count": 9, "tags": [], "bug_id": 51245, "text": "increase priority due to presence of a patch", "id": 157682, "time": "2012-04-08T09:10:51Z", "creator": "gadams@apache.org", "creation_time": "2012-04-08T09:10:51Z", "is_private": false, "attachment_id": null}, {"count": 10, "tags": [], "bug_id": 51245, "attachment_id": null, "is_private": false, "id": 157707, "time": "2012-04-08T20:27:45Z", "creator": "gadams@apache.org", "creation_time": "2012-04-08T20:27:45Z", "text": "please provide a single patch file containing context diffs (not entire files) against a known SVN revision; please ensure that only the intended fix diffs are present in the patch"}, {"count": 11, "tags": [], "bug_id": 51245, "text": "(In reply to comment #10)\n> please provide a single patch file containing context diffs (not entire files)\n> against a known SVN revision; please ensure that only the intended fix diffs\n> are present in the patch\n\nAlexander, I am still awaiting your input as requested above. if I see no further input by April 30, I will close this bug due to lack of requested information. Regards, Glenn", "id": 158358, "time": "2012-04-24T05:53:38Z", "creator": "gadams@apache.org", "creation_time": "2012-04-24T05:53:38Z", "is_private": false, "attachment_id": null}]
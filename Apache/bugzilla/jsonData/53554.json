[{"count": 0, "attachment_id": 29069, "bug_id": 53554, "text": "Created attachment 29069\nUse uppercase hexadecimal digits in mod_rewrite\n\nApache mod_rewrite encodes special characters using lowercase hexadecimal digits, for example Chr\u00e1n\u011bn\u00e1 becomes Chr%c3%a1n%c4%9bn%c3%a1 instead of Chr%C3%A1n%C4%9Bn%C3%A1. The use of a non-canonical URL breaks our caching system. We can't use lowercase hexadecimal digits as our canonical URLs because no browser sends URLs like that, so the cache would be even more badly broken. Please use uppercase hexadecimal digits in URLs.", "id": 160680, "time": "2012-07-16T23:55:18Z", "creator": "tstarling@wikimedia.org", "creation_time": "2012-07-16T23:55:18Z", "tags": [], "is_private": false}, {"count": 1, "attachment_id": null, "creator": "christophe.jaillet@wanadoo.fr", "text": "In RFC 1738, about Uniform Resource Locators (URL)\n(http://www.rfc-editor.org/rfc/rfc1738.txt)\n\n\nit is written that :\n\n>>>\n2.2. URL Character Encoding Issues\n\n[...]\nIn addition, octets may be encoded by a character triplet consisting\nof the character \"%\" followed by the two hexadecimal digits (from\n\"0123456789ABCDEF\") which forming the hexadecimal value of the octet.\n(The characters \"abcdef\" may also be used in hexadecimal encodings.)\n[...]\n\n<<<\n\n\nSo, I guess that httpd is correct when encoding with lower case.\n\n\nI left the report open, just in case, but I think that it should be marked as FIXED, WONTFIX.", "id": 162467, "time": "2012-09-30T06:26:35Z", "bug_id": 53554, "creation_time": "2012-09-30T06:26:35Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "tstarling@wikimedia.org", "attachment_id": null, "id": 162479, "creation_time": "2012-10-01T04:54:06Z", "time": "2012-10-01T04:54:06Z", "bug_id": 53554, "text": "(In reply to comment #1)\n> In RFC 1738, about Uniform Resource Locators (URL)\n> (http://www.rfc-editor.org/rfc/rfc1738.txt)\n> \n> \n> it is written that :\n> \n> >>>\n> 2.2. URL Character Encoding Issues\n> \n> [...]\n> In addition, octets may be encoded by a character triplet consisting\n> of the character \"%\" followed by the two hexadecimal digits (from\n> \"0123456789ABCDEF\") which forming the hexadecimal value of the octet.\n> (The characters \"abcdef\" may also be used in hexadecimal encodings.)\n> [...]\n> \n> <<<\n> \n> \n> So, I guess that httpd is correct when encoding with lower case.\n> \n> \n> I left the report open, just in case, but I think that it should be marked\n> as FIXED, WONTFIX.\n\nI think the RFC is pretty clear about which encoding is preferred, and it's not the one httpd is using. You seem to be using a very loose definition of \"correct\". There are two ways of doing it: one is preferred, the other is idiosyncratic and breaks caching. It is a simple change and the patch is attached.", "is_private": false}, {"count": 3, "tags": [], "text": "Apache is not incorrect here; the cache is not performing its job as well as it could: a well-written cache would compare URLs more intelligently than just a simple string compare.\n\nThe RFC does say that software should encode URLs with upper-case hex encoding, though, and many clients do have bugs like this one when it comes to comparing URLs, so I think it would be reasonable for apache to change its behavior here. (\"Be strict in what you produce, but liberal in what you accept\", and all that.)\n\nhttp://tools.ietf.org/html/rfc3986#section-6.2 has more discussion on URL comparison and normalization.", "is_private": false, "bug_id": 53554, "id": 166020, "time": "2013-03-19T23:15:22Z", "creator": "wiml@omnigroup.com", "creation_time": "2013-03-19T23:15:22Z", "attachment_id": null}]
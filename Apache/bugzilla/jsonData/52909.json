[{"attachment_id": 28465, "tags": [], "bug_id": 52909, "text": "Created attachment 28465\nForm patch\n\nWithin the form package, the default value handling is not able to treat multiple selected items.\n\nExample:\n\npackage require form\nload_response response\nform form_request -method get -name request -defaults response\nform_request start -defaults response\nform_request select countries -values {1 2 3} -multiple multiple\nform_request submit action -value \"Submit\"\nform_request end\n\n---\n\nIf zero or one items are selected, they are reselcted on submit.\nIf two or three items are selected, none is reselected on submit.\n\n---\n\nThe attached patch solves the issue in a semi-optimal manner.\nOn multiple select widgets, it is supposed, that the default values are a list.\nUnfortunately, this is only the case, if more than one item is selected.\nAs stated in Bug 52653, it depends on the data and not on the type if a default is a list.\nIt would be helpful to:\n- output from \"load_response\" if a key is a list or not.\n- check this output in form and list or unlist accordingly.\nOr:\n- \"load_responses\" always outputs lists\n- form is rewritten to suppose lists as default values.\n\nIn the mean-time, the attached patch makes it work for all cases, but:\n- a non-multiple box has multiple answers for a value\n- a multiple box has values which may be broken-up into lists and only one element is selected. To check, change the following line in the example:\nform_request select countries -values {{2 3} 2 3} -multiple multiple\nIf the element \"2 3\" is selected and submitted, the elements \"2\" and \"3\" are selected and \"2 3\" not. This worked before.", "count": 0, "id": 154900, "time": "2012-03-14T13:51:20Z", "creator": "harald.oehlmann@elmicron.de", "creation_time": "2012-03-14T13:51:20Z", "is_private": false}, {"count": 1, "text": "I ran mad within the code, that\n    info exists data(multiple)\nreturn 0, but\n    array names data multiple\nreturns \"multiple\".\n\nPossible explanations:\n- I have no idea about itcl, which may handle \"info exists\" differently\n- I am overlooking something obvious...\n\nAnyway, as this did not work, the line a bit upper:\n    info exists data(multiple)\nshould not work neither....\n\nAny help welcome !\n-Harald", "bug_id": 52909, "attachment_id": null, "id": 154902, "time": "2012-03-14T13:59:05Z", "creator": "harald.oehlmann@elmicron.de", "creation_time": "2012-03-14T13:59:05Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "creator": "harald.oehlmann@elmicron.de", "attachment_id": null, "is_private": false, "id": 154909, "time": "2012-03-14T16:09:28Z", "bug_id": 52909, "creation_time": "2012-03-14T16:09:28Z", "text": "There is another case, which does not work with the patch:\n- value element is an empty string.\nform_request select countries -values {\"\" 2 3} -multiple multiple\nIf the empty element is selected allone, it is not reselected."}, {"count": 3, "tags": [], "creator": "harald.oehlmann@elmicron.de", "attachment_id": 28485, "is_private": false, "id": 155050, "time": "2012-03-19T15:23:51Z", "bug_id": 52909, "creation_time": "2012-03-19T15:23:51Z", "text": "Created attachment 28485\nPatch with both fixes\n\nAnother nit-picker contribution.\n\nIf a selection box item has the value \"\", the default does not work.\n\nExample:\nset response(country) [vars get country)\nform form_request -method get -defaults response\nform_request start\nform_request submit action -value Submit\nform_request select country\\\n\t-values {A {} B}\\\n\t-labels {Aha Empty Bee}\nform_request end\n\nIf the second item \"Empty\" is selected, it jumps back to \"Aah\" on submit.\n\nThe attached revised patch also treats this case.\n\nAs before, I am quite struggeling with the for me unknown OO system.\n[info exists] does not work as I suppose:\nset default 1\nputs ***[info exists default]***\nreturns 0 !\nDue to this fact, I have inserted a helper variable \"fDefault\" which montirors if \"default\" should exist.\nThus it is equal to:\nset fDefault [info exists default]\n\nAnyway, enjoy the patch,\nHarald"}, {"attachment_id": 28489, "tags": [], "bug_id": 52909, "text": "Created attachment 28489\nPatch with both fixes, revised\n\n\"info exists\" may return errorneously 0 due to a Incr Tcl-ng bug.\nA workaround is to use \"::info\" instead \"info\".\n\nThe former patch has avoided the \"info exists\" command.\nHere it is reintroduced leading to a better implementation.\n\nN.B.1 The TCL 8.5 expr operator \"in\" is used:\nif { ... && $value in $defaultlist }\nwhich might be replaced by:\nif { ... && -1 != [lsearch -exact $defaultlist $value] }\n\nN.B.2: IMHO, \"::info\" should be replaced by \"info\"\nThe \"::info\" was only necessary to test the patch.\n\nThank you,\nHarald", "count": 4, "id": 155168, "time": "2012-03-21T10:01:15Z", "creator": "harald.oehlmann@elmicron.de", "creation_time": "2012-03-21T10:01:15Z", "is_private": false}, {"count": 5, "tags": [], "creator": "mxmanghi@apache.org", "attachment_id": null, "is_private": false, "id": 159012, "time": "2012-05-13T16:49:52Z", "bug_id": 52909, "creation_time": "2012-05-13T16:49:52Z", "text": "Harald, I'm going to commit form.tcl with the patch fixing bug #52650. I won't group together also this bug with it. I confess I got lost in the sequence of your comments. I'll try to catch up with one issue at a time. It seems to me the package has an issue with parameters shipping multiple values, I will start from this problem. I think your approach forcing the concept of 'type' ('lists' as opposed to 'scalars') can be deceptive on Tcl: what we can do is to return parameters which can be coherently interpreted as lists when they come as result of a group of checkboxes, unless they go through further manipulations (such as argument expansion) which may change a list structure."}, {"count": 6, "tags": [], "creator": "mxmanghi@apache.org", "attachment_id": null, "id": 159135, "time": "2012-05-17T20:46:39Z", "bug_id": 52909, "creation_time": "2012-05-17T20:46:39Z", "is_private": false, "text": "Bug assigned to component 'form'"}, {"count": 7, "tags": [], "creator": "mxmanghi@apache.org", "attachment_id": null, "id": 162196, "time": "2012-09-15T19:51:04Z", "bug_id": 52909, "creation_time": "2012-09-15T19:51:04Z", "is_private": false, "text": "already fixed, bug marked resolved and waiting to be closed"}]
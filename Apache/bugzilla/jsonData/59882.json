[{"count": 0, "tags": [], "text": "I've been profiling jmeter memory allocation under different conditions\nthe PR linked to this bug gives substantial improvements.\n\nGain really depends on the test but in the worst case (compressed content, no embedded resources) it's about 15% less allocations (in bytes)\nWhen not compressed (no embedded resources) and if content-length is sent by the server my test gives 30% reduction in bytes allocated\nAs always YMMV but this PR is always a win in all my different tests.\n\nReduction in memory allocated comes from\nBetter usage of ByteArrayOutputStream  by\n  - directly accessing the buffer instead of copying it\n  - or by using the commons-lang implementation which avoid copying memory around when extending the buffer\n  - or by creating the string directly from the buffer instead of a temporary copy\n\nAvoid unneeded string concatenation due to missing log.isDebugEnabled()\nif possible use httpclient CharArrayBuffer to avoid memory allocations\nDo not create unneeded silent exceptions\nDo not allocate 2 empty iterators on each call to executeSamplePackage\n  - LinkedList.iterator() is a stinky monkey. Also see HTTPCORE-361\nSet better default size to StringBuilder buffers\nimprove JOrphanUtils#replaceAllChars : provides a fast path which does not allocate memory\netc..\n\nRemark : \nWhen using ssl, jsse is a major source of unneeded allocation !!!!  (sun.security.ssl.SSLContextImpl#getDefaultCipherSuiteList(boolean))\nhttps://bugs.openjdk.java.net/browse/JDK-8133070 should improve the situation (I did not test it)\nthe title of the bug is misleading as it's also about an internal cache beeing cleared on each method call.", "attachment_id": null, "id": 192504, "creator": "benoit.wiart@gmail.com", "time": "2016-07-18T21:01:08Z", "bug_id": 59882, "creation_time": "2016-07-18T21:01:08Z", "is_private": false}, {"count": 1, "tags": [], "text": "PR : https://github.com/apache/jmeter/pull/217", "attachment_id": null, "id": 192505, "creator": "benoit.wiart@gmail.com", "time": "2016-07-18T21:02:11Z", "bug_id": 59882, "creation_time": "2016-07-18T21:02:11Z", "is_private": false}, {"count": 2, "tags": [], "creator": "p.mouawad@ubik-ingenierie.com", "attachment_id": null, "text": "Added:\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/util/DirectAccessByteArrayOutputStream.java   (with props)\nModified:\n    jmeter/trunk/src/core/org/apache/jmeter/testelement/AbstractTestElement.java\n    jmeter/trunk/src/core/org/apache/jmeter/threads/JMeterThread.java\n    jmeter/trunk/src/jorphan/org/apache/jorphan/util/JOrphanUtils.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPHC4Impl.java\n    jmeter/trunk/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerBase.java\n    jmeter/trunk/xdocs/changes.xml", "id": 192741, "time": "2016-07-31T14:42:07Z", "bug_id": 59882, "creation_time": "2016-07-31T14:42:07Z", "is_private": false}]
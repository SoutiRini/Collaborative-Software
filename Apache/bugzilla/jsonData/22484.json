[{"count": 0, "tags": [], "creator": "vt@vorsprung-durch-denken.de", "attachment_id": null, "text": "Hello,\n\nBasically I run into the problem which is discussed here:\n\nhttp://forums.itrc.hp.com/cm/QuestionAnswer/1,,0xf91e36e69499d611abdb0090277a778c,00.html\n\nBut the proposed fix (rising semaphore-related kernel parameters) does not help.\nWe run 11.11 at a fairly recent patch level. A full trace of Apache 2.0.47 until\nit's \"suicide\" is available (given httpd is alive...) at:\n\nhttp://vorsprung-durch-denken.de/apache-trace.txt\n\nAnd the main error log holds:\n\ntons of: [emerg] (22)Invalid argument: couldn't grab the accept mutex\nsome: [emerg] (36)Identifier removed: couldn't grab the accept mutex\nfew: [emerg] (28)No space left on device: couldn't grab the accept mutex\n\nThe symptom does not appear to be related to the number of children. I watched\nthe parent die with 46 and another time with 17 child processes. The load of the\nmachine is around 0.2 all the time.\n\nTo put it straight: I'm stuck and hoping some good soul out there can help!\n\nAny hint is appreciated - TIA\nvt", "id": 42858, "time": "2003-08-16T19:42:45Z", "bug_id": 22484, "creation_time": "2003-08-16T19:42:45Z", "is_private": false}, {"count": 1, "attachment_id": null, "bug_id": 22484, "text": "We worked around the problem by temporarily setting AcceptMutex to fcntl.", "id": 42871, "time": "2003-08-17T12:54:35Z", "creator": "vt@vorsprung-durch-denken.de", "creation_time": "2003-08-17T12:54:35Z", "tags": [], "is_private": false}, {"count": 2, "tags": [], "bug_id": 22484, "is_private": false, "text": "*** Bug 22516 has been marked as a duplicate of this bug. ***", "id": 42978, "time": "2003-08-19T11:20:53Z", "creator": "trawick@apache.org", "creation_time": "2003-08-19T11:20:53Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 22484, "text": "BTW, the trace provided is just of the parent process, so it doesn't show the\nsemaphore errors encountered in the children.\n\nI don't think this is an Apache or APR problem.  (The APR codebase has the code\nthat uses SysV semaphores.)  While there have been at least a few people\nencountering this on HP-UX, semaphore problems that could not be resolved by\nsystem tuning haven't been reported elsewhere, and presumably many other HP-UX\nusers are running Apache successfully.  Maybe there is further tuning necessary\non your system, maybe you have a bad level of some kernel code, maybe I don't\nknow what I'm talking about :)\n\nIf you want to pursue this further with us, we need a trace that shows\nApache+APR doing something invalid with the semaphores.  If you have OS support\nfrom HP, you might describe to them what tuning you performed already and see if\nthey have additional recommendations.\n", "id": 42979, "time": "2003-08-19T11:36:28Z", "creator": "trawick@apache.org", "creation_time": "2003-08-19T11:36:28Z", "is_private": false, "attachment_id": null}, {"count": 4, "tags": [], "bug_id": 22484, "text": "Jeff,\n\nI read about other HP-UX und Solaris users who appear to face the very same\nsymptom. HP suppplies a compiled binary so many users will stick with this I\nsuppose.\n\nMy trace has the capability to follow forks but there are a couple of\nshowstoppers here on my side: the affected server is productive and we are\nrather in the process of downgrading back to 1.3 . Then there are about 170\nvhosts configured; httpd has approximately 50-60 concurrent active childs during\nthe day.\n\nOne of our first thoughts here was that one of the vhosts may generate an error\nthat causes the parent to shut down but we could not confirm this when searching\nthe logs. And I have to admit we haven't got the time to trace down this any\nfurther right now.\n\nWe are about to set up an 11i system with current patch level during the next\nweek. We can possibly set up 2.0.47 there and see if httperf can reproduce the\nproblem.\n\nCheers,\nvt", "id": 42989, "time": "2003-08-19T12:51:12Z", "creator": "vt@vorsprung-durch-denken.de", "creation_time": "2003-08-19T12:51:12Z", "is_private": false, "attachment_id": null}, {"count": 5, "attachment_id": null, "creator": "trawick@apache.org", "is_private": false, "id": 43158, "time": "2003-08-22T11:56:53Z", "bug_id": 22484, "creation_time": "2003-08-22T11:56:53Z", "tags": [], "text": ">I read about other HP-UX und Solaris users who appear to face the very same\n>symptom. HP suppplies a compiled binary so many users will stick with this I\n>suppose.\n\nIf there is some fix for this in the HP-supplied binary but not in Apache or\nAPR, we'd love to hear about it :)  I hope that isn't the situation.\n\n>One of our first thoughts here was that one of the vhosts may generate an error\n>that causes the parent to shut down but we could not confirm this when >searching\n>the logs. And I have to admit we haven't got the time to trace down this any\n>further right now.\n\nIn the case that a child returned a fatal error which forced a shutdown, there\nshould be a message in error_log written by the parent by this code:\n\n            ap_log_error(APLOG_MARK, APLOG_ALERT,\n                         0, ap_server_conf,\n                         \"Child %\" APR_PID_T_FMT\n                         \" returned a Fatal error...\" APR_EOL_STR\n                         \"Apache is exiting!\",\n                         pid->pid);\n\nIn all likelihood the fatal error was simply the first unexpected ENOSPC from\nattempting to acquire the mutex, then that child returned a fatal error, then\nthe semaphore got cleaned up, then remaining children that hadn't already died\ndue to shutdown started getting EINVAL on their semaphore operations.\n"}, {"count": 6, "tags": [], "bug_id": 22484, "is_private": false, "text": "Hi Jeff,\n\nOk, I have to admit we have those:\n[Sat Aug 16 16:08:16 2003] [notice] Apache/2.0.47 configured -- resuming normal\noperations\n[Sat Aug 16 16:38:09 2003] [emerg] (28)No space left on device: couldn't grab\nthe accept mutex\n[Sat Aug 16 16:38:09 2003] [alert] Child 16480 returned a Fatal error...\nApache is exiting!\n[Sat Aug 16 16:38:10 2003] [emerg] (36)Identifier removed: couldn't grab the\naccept mutex\n[...]\n\nUnfortunately a colleague deleted the client' logs of that day so... :(\n\nThen hp: from what I see in their relasenotes they fixed a bug related to\nsemaphores/modssl/dbm in 2.0.43 so it seems that is s/th different. Besides I\ntake it for granted that they'll report problems once they find/fix them.\n\nAt this time, I'm a bit clueless because I see no way how we could track this\ndown. Can you give me a hint where I can read about what could cause a child to\nproduce an \"Fatal error\"? (I googled but didn't find s/th hot). I'm willing to\ninvestigate, but I can't trace 170 vhosts one after the other - many of them\nusing PHP.\n\nThanks, vt", "id": 43179, "time": "2003-08-22T17:29:39Z", "creator": "vt@vorsprung-durch-denken.de", "creation_time": "2003-08-22T17:29:39Z", "attachment_id": null}, {"count": 7, "tags": [], "bug_id": 22484, "text": "This first error message from your last error log submission is the entire story:\n\n[Sat Aug 16 16:38:09 2003] [emerg] (28)No space left on device: couldn't grab\nthe accept mutex\n\nThe kernel failed the semaphore acquire.  If you can't fix it with OS tuning,\nthan avoid it with \"AcceptMutex fcntl\" or some other mutex type.\n", "id": 45388, "time": "2003-10-10T18:18:28Z", "creator": "trawick@apache.org", "creation_time": "2003-10-10T18:18:28Z", "is_private": false, "attachment_id": null}, {"count": 8, "tags": [], "creator": "trawick@apache.org", "attachment_id": null, "text": "*** Bug 25418 has been marked as a duplicate of this bug. ***", "id": 48846, "time": "2003-12-10T18:24:41Z", "bug_id": 22484, "creation_time": "2003-12-10T18:24:41Z", "is_private": false}, {"count": 9, "tags": [], "bug_id": 22484, "is_private": false, "text": "Not a problem in httpd or APR as far as anyone can tell...   If OS tuning can't\nresolve the problems, then use AcceptMutex directive to try a different mutex\nmechanism.\n\nThe not-uncommon occurrences with mutex problems that defy easy resolution or\neven explanation is why there is an AcceptMutex directive to start with :)\n", "id": 48847, "time": "2003-12-10T18:29:58Z", "creator": "trawick@apache.org", "creation_time": "2003-12-10T18:29:58Z", "attachment_id": null}, {"count": 10, "attachment_id": null, "creator": "cerise-apache@l.armory.com", "text": "This bug is cropping up in a gentoo build of 2.0.54 (revision 31, if anyone cares).\n\nI've tried removing user limits on apache without success.  Is there a definitive\nsolution for Linux which doesn't involve switching the AcceptMutex directive?", "id": 84321, "time": "2006-01-07T04:44:10Z", "bug_id": 22484, "creation_time": "2006-01-07T04:44:10Z", "tags": [], "is_private": false}]
[{"count": 0, "tags": [], "bug_id": 19182, "attachment_id": null, "id": 35671, "time": "2003-04-20T17:35:01Z", "creator": "towerofpower@operamail.com", "creation_time": "2003-04-20T17:35:01Z", "is_private": false, "text": "Apache 2.0.45, Openssl-0.9.7b, Zlib, compiled under WinNT.SP3 VS.NET(2002) \nrelease build.\n\nStd configs with minor dir changes and ssl support. Everything that worked \nunder 2.0.44.\n\nUnless I am mistaken: \nChange in 2.0.45(over 2.0.44) needs ssl.conf updated.\n\nC:\\Apache2\\bin\\apache -D SSL -k install\n\n<output>\nSyntax error on line 62 of E:/www/Apache2/conf/ssl.conf:\nInvalid SSLMutex argument file:logs/ssl_mutex (Valid SSLMutex mechanisms are: \n`none', `default' )\n</output>\n\nIn ssl.conf, [SSLMutex file:logs/ssl_mutex] is no longer valid; replace with \n[SSLMutex default];\n[SSLMutex default] implies [SSLMutex sed]. \n\n\n\n\n***<httpd-2.0.45\\modules\\ssl\\mod_ssl.c>***\n------------------------------------\nconst char ssl_valid_ssl_mutex_string[] =\n\"Valid SSLMutex mechanisms are: `none', `default'\"\n[...]\n#if APR_HAS_FLOCK_SERIALIZE || APR_HAS_FCNTL_SERIALIZE\n     \", `file:/path/to/file'\"\n#endif\n#if (APR_HAS_SYSVSEM_SERIALIZE && !defined(PERCHILD_MPM)) || \nAPR_HAS_POSIXSEM_SERIALIZE\n     \", `sem'\"\n#endif\n------------------------------------\n\n\n\n\n***<httpd-2.0.45\\modules\\ssl\\ssl_engine_config.c>***\n------------------------------------\nconst char *ssl_cmd_SSLMutex(cmd_parms *cmd,\n                             void *dcfg,\n                             const char *arg)\n{\n    const char *err;\n    SSLModConfigRec *mc = myModConfig(cmd->server);\n\n    if ((err = ap_check_cmd_context(cmd, GLOBAL_ONLY))) {\n        return err;\n    }\n\n    if (ssl_config_global_isfixed(mc)) {\n        return NULL;\n    }\n\n    if (strcEQ(arg, \"none\") || strcEQ(arg, \"no\")) {\n        mc->nMutexMode  = SSL_MUTEXMODE_NONE;\n    }\n    /* NOTE: previously, 'yes' implied 'sem' */\n    else if (strcEQ(arg, \"default\") || strcEQ(arg, \"yes\")) {\n        mc->nMutexMode  = SSL_MUTEXMODE_USED;\n        mc->nMutexMech = APR_LOCK_DEFAULT;\n        mc->szMutexFile = NULL; /* APR determines temporary filename */\n    }\n#if APR_HAS_FLOCK_SERIALIZE\n    else if (strlen(arg) > 6 && strcEQn(arg, \"flock:\", 6)) {\n        const char *file = ap_server_root_relative(cmd->pool, arg+6);\n        if (!file) {\n            return apr_pstrcat(cmd->pool, \"Invalid SSLMutex flock: path \", \n                               arg+6, NULL);\n        }\n        mc->nMutexMode  = SSL_MUTEXMODE_USED;\n        mc->nMutexMech = APR_LOCK_FLOCK;\n        mc->szMutexFile = apr_psprintf(mc->pPool, \"%s.%lu\",\n                                       file, (unsigned long)getpid());\n        mc->ChownMutexFile = TRUE;\n    }\n#endif\n#if APR_HAS_FCNTL_SERIALIZE\n    else if (strlen(arg) > 6 && strcEQn(arg, \"fcntl:\", 6)) {\n        const char *file = ap_server_root_relative(cmd->pool, arg+6);\n        if (!file) {\n            return apr_pstrcat(cmd->pool, \"Invalid SSLMutex fcntl: path \", \n                               arg+6, NULL);\n        }\n        mc->nMutexMode  = SSL_MUTEXMODE_USED;\n        mc->nMutexMech = APR_LOCK_FCNTL;\n        mc->szMutexFile = apr_psprintf(mc->pPool, \"%s.%lu\",\n                                       file, (unsigned long)getpid());\n    }\n#endif\n#if APR_HAS_SYSVSEM_SERIALIZE && !defined(PERCHILD_MPM)\n    else if (strcEQ(arg, \"sysvsem\")) {\n        mc->nMutexMode  = SSL_MUTEXMODE_USED;\n        mc->nMutexMech = APR_LOCK_SYSVSEM;\n        mc->szMutexFile = NULL; /* APR determines temporary filename */\n    }\n#endif\n#if APR_HAS_POSIXSEM_SERIALIZE\n    else if (strcEQ(arg, \"posixsem\")) {\n        mc->nMutexMode  = SSL_MUTEXMODE_USED;\n        mc->nMutexMech = APR_LOCK_POSIXSEM;\n        mc->szMutexFile = NULL; /* APR determines temporary filename */\n    }\n#endif\n#if APR_HAS_PROC_PTHREAD_SERIALIZE\n    else if (strcEQ(arg, \"pthread\")) {\n        mc->nMutexMode  = SSL_MUTEXMODE_USED;\n        mc->nMutexMech = APR_LOCK_PROC_PTHREAD;\n        mc->szMutexFile = NULL; /* APR determines temporary filename */\n    }\n#endif\n#if APR_HAS_FLOCK_SERIALIZE || APR_HAS_FCNTL_SERIALIZE\n    else if (strlen(arg) > 5 && strcEQn(arg, \"file:\", 5)) {\n        const char *file = ap_server_root_relative(cmd->pool, arg+5);\n        if (!file) {\n            return apr_pstrcat(cmd->pool, \"Invalid SSLMutex file: path \", \n                               arg+5, NULL);\n        }\n        mc->nMutexMode  = SSL_MUTEXMODE_USED;\n#if APR_HAS_FLOCK_SERIALIZE\n        mc->nMutexMech  = APR_LOCK_FLOCK;\n        mc->ChownMutexFile = TRUE;\n#endif\n#if APR_HAS_FCNTL_SERIALIZE\n        mc->nMutexMech  = APR_LOCK_FCNTL;\n#endif\n        mc->szMutexFile =\n            apr_psprintf(mc->pPool, \"%s.%lu\",\n                         file, (unsigned long)getpid());\n    }\n#endif\n#if (APR_HAS_SYSVSEM_SERIALIZE && !defined(PERCHILD_MPM)) || \nAPR_HAS_POSIXSEM_SERIALIZE\n    else if (strcEQ(arg, \"sem\")) {\n        mc->nMutexMode  = SSL_MUTEXMODE_USED;\n#if APR_HAS_SYSVSEM_SERIALIZE && !defined(PERCHILD_MPM)\n        mc->nMutexMech  = APR_LOCK_SYSVSEM;\n#endif\n#if APR_HAS_POSIXSEM_SERIALIZE\n        mc->nMutexMech  = APR_LOCK_POSIXSEM;\n#endif\n        mc->szMutexFile = NULL; /* APR determines temporary filename */\n    }\n#endif\n    else {\n        return apr_pstrcat(cmd->pool, \"Invalid SSLMutex argument \", \n                           arg, \" (\", ssl_valid_ssl_mutex_string, \")\", NULL);\n    }\n\n    return NULL;\n}\n------------------------------------"}, {"count": 1, "tags": [], "text": "***<httpd-2.0.44\\modules\\ssl\\ssl_engine_config.c>***\n\n\nconst char *ssl_cmd_SSLMutex(cmd_parms *cmd,\n                             void *dcfg,\n                             const char *arg)\n{\n    const char *err;\n    SSLModConfigRec *mc = myModConfig(cmd->server);\n\n    if ((err = ap_check_cmd_context(cmd, GLOBAL_ONLY))) {\n        return err;\n    }\n\n    if (ssl_config_global_isfixed(mc)) {\n        return NULL;\n    }\n\n    if (strcEQ(arg, \"none\") || strcEQ(arg, \"no\")) {\n        mc->nMutexMode  = SSL_MUTEXMODE_NONE;\n    }\n    else if (strlen(arg) > 5 && strcEQn(arg, \"file:\", 5)) {\n        const char *file = ap_server_root_relative(cmd->pool, arg+5);\n        if (!file) {\n            return apr_pstrcat(cmd->pool, \"Invalid SSLMutex file: path \", \n                               arg+5, NULL);\n        }\n        mc->nMutexMode  = SSL_MUTEXMODE_USED;\n        mc->szMutexFile =\n            apr_psprintf(mc->pPool, \"%s.%lu\",\n                         file, (unsigned long)getpid());\n    }\n    else if (strcEQ(arg, \"sem\") || strcEQ(arg, \"yes\")) {\n        mc->nMutexMode  = SSL_MUTEXMODE_USED;\n        mc->szMutexFile = NULL; /* APR determines temporary filename */\n    }\n    else {\n        return apr_pstrcat(cmd->pool, \"Invalid SSLMutex argument \", \n                           arg, NULL);\n    }\n\n    return NULL;\n}", "is_private": false, "bug_id": 19182, "id": 35724, "time": "2003-04-21T20:53:51Z", "creator": "towerofpower@operamail.com", "creation_time": "2003-04-21T20:53:51Z", "attachment_id": null}, {"count": 2, "attachment_id": null, "bug_id": 19182, "is_private": false, "id": 35725, "time": "2003-04-21T21:08:10Z", "creator": "towerofpower@operamail.com", "creation_time": "2003-04-21T21:08:10Z", "tags": [], "text": "Yup, I think that is correct, 2.0.45 over 2.0.44 needs to have the SSLMutex \nfield in ssl.conf changed to \"default\" or \"none\".\n\nUnless APR_HAS_FLOCK_SERIALIZE || APR_HAS_FCNTL_SERIALIZE is valid for win32 \nand the \"file:\" option can be used as it was in 2.0.44.\n\nWhy was it used in 2.0.44, if it can not be used in 2.0.45?"}, {"count": 3, "tags": [], "bug_id": 19182, "attachment_id": null, "id": 75873, "time": "2005-06-03T01:25:52Z", "creator": "chip@force-elite.com", "creation_time": "2005-06-03T01:25:52Z", "is_private": false, "text": "Is this still an issue in 2.0.54?"}, {"count": 4, "tags": [], "bug_id": 19182, "attachment_id": null, "id": 81878, "time": "2005-10-28T04:06:08Z", "creator": "eflash@gmx.net", "creation_time": "2005-10-28T04:06:08Z", "is_private": false, "text": "yes, and still with 2.0.55 - in addition I just found that my #28923 is a \nduplicate of this bug....\nso \"Opened: 2003-04-20 17:35\" means that we are now discussing a one-word change \nof a conf file from 'file' to 'default' for over two and a half years...\nhmmm, but I'm still in hope;\nI guess perhaps in 20 years with Apache 2.5 (I dont think we will get much \nfurther in that short time) we will have fixed it - or a young dynamic \nprogrammer participates the httpd project, and makes the C code perfect so it \nignores the wrong settings on platforms where it doesnt apply...., and we dont \nneed the fix at all!!\none day in the very far future....\n\nmeet you there, Guenter.\n\n"}, {"count": 5, "tags": [], "bug_id": 19182, "attachment_id": null, "id": 97732, "time": "2007-01-06T16:33:39Z", "creator": "eflash@gmx.net", "creation_time": "2007-01-06T16:33:39Z", "is_private": false, "text": "REMINDER:\nsoon this configuration file bug will be 4 yours old since first report with \n#19182.....\nA lot of folks looked at it, wasted time with writing comments here - but \nnobody was willing to just take a minute and CHANGE ONE LINE although we \ncommonly agreed that its currently wrong at least on Win32 and NetWare...\nNow 2.2.4 is out the door, and still same bug, and still the need that I've to \npatch the ssl.conf again, arghhhhh! Why cant we just set:\nSSLMutex default\nand trust that the default is the right default on the platform build for?\nIsnt that what defaults are good for??\nSure that nobody else reports here nor votes for that bug because I'm the idiot \nwho provides builds with mod_ssl for Win32 and NetWare, and my users get a \nfixed ssl.conf - while the ASF refuses to distribute SSL-enabled versions at \nall. I should probably stop fixing that, and let all the users get frustrated \nand google for the issue.....\n"}, {"count": 6, "tags": [], "creator": "eflash@gmx.net", "attachment_id": null, "text": "(In reply to comment #5)\n> Now 2.2.4 is out the door, and still same bug, and still the need that I've \nto \n> patch the ssl.conf again, arghhhhh!\nMy apologies here - it is now only still an issue on NetWare - Win32 seems to \ngot a fix in the build process which was the reason I didnt realize it until I \nbuild it:\nhttp://svn.apache.org/viewvc/httpd/httpd/trunk/Makefile.win?r1=397647&r2=398284\nSo I believe this bug here ist solved and can now be finally closed.\n", "id": 98299, "time": "2007-01-20T04:39:33Z", "bug_id": 19182, "creation_time": "2007-01-20T04:39:33Z", "is_private": false}]
[{"count": 0, "attachment_id": null, "bug_id": 34622, "is_private": false, "id": 74131, "time": "2005-04-26T13:30:28Z", "creator": "mzaki@e-mail.ne.jp", "creation_time": "2005-04-26T13:30:28Z", "tags": [], "text": "CGI script can output SSI directives in Apache 2.0.x servers.\nUnder 'XBitHack on' and the file mode of the script is 0745,\nthe CGI output should be parsed with mod_include and modified\naccording to the SSI directives.\n\nBut I found, in some cases, the SSI directives were ommited.\nIt seems this issue depends on the content of CGI script files,\nand not on the output of CGI script.\n\nHOW TO REPEAT:\n\nA sample script reproducing the issue is below.\n\n-------------------------------------: test.cgi (mode 0745)\n#!/bin/sh\n# the comment !!!\ncat <<_HTML_\nContent-Type: text/html\n\n<html>\n<head>\n<title>SSI test</title>\n</head>\n<body>\nDATE_LOCAL: <!--#echo var=\"DATE_LOCAL\" -->\n</body>\n</html>\n_HTML_\n------------------------------------------------------------\n\nThe SSI directive is expected to be replaced with the time,\nbut is omitted.\n\nThis is not caused by mis-configuration,\nsince I can see the expected replacemant\nwhen the comment string ('the comment') is modified to 'tee comment'.\nThis single byte modification ('tee' <-> 'the') is responsible for this issue.\nPlease note that the output of the CGI script is not changed, \nand only the script comment is modified."}, {"count": 1, "tags": [], "bug_id": 34622, "attachment_id": null, "text": "Is this problem still present in the most 2.0.55/2.2?", "id": 83440, "time": "2005-12-08T19:35:37Z", "creator": "slive@apache.org", "creation_time": "2005-12-08T19:35:37Z", "is_private": false}, {"count": 2, "attachment_id": null, "bug_id": 34622, "is_private": false, "id": 83520, "time": "2005-12-10T18:05:15Z", "creator": "mzaki@e-mail.ne.jp", "creation_time": "2005-12-10T18:05:15Z", "tags": [], "text": "(In reply to comment #1)\n> Is this problem still present in the most 2.0.55/2.2?\n\nYes. \nOn FreeBSD 6.0-RELEASE machine,\nboth 2.0.54 (binary package) and 2.0.55 (built by ports) has still this problem."}, {"count": 3, "tags": [], "creator": "slive@apache.org", "is_private": false, "text": "Please don't change bug assignments.", "id": 83523, "time": "2005-12-10T19:20:38Z", "bug_id": 34622, "creation_time": "2005-12-10T19:20:38Z", "attachment_id": null}, {"count": 4, "tags": [], "text": "This is because you let mod_mime_magic detect the mime type of the cgi script.\nAs this script is not identified by the magic table, mod_mime_magic falls back\nto some rather simple keyword matching method (ascmagic in mod_mime_type). One\nof these rules says: if the word \"the\" can be found in the beginning of the\nfiles (first 1024 bytes), then this an English text and its mime type is\ntext/plain. Another rule says: If I find the string \"<!--\" then it is html and\nits mime type is html/text. As the first rule that matches decides, the mime\ntype is text/html for the script with \"tee\" (<!-- is found) and text/plain for\nthe script with the word \"the\" (\"the\" is found).\nBut the script needs to be of content-type text/html for XBitHack to work. And\nthis must be the content-type that must be detected by httpd BEFORE the script\nis run. So that you set content-type to text-html in the script does not work.\nIn order to solve this problem add the following directive to your configuration:\n\nAddType text/html .cgi\n\nwhich sets the mime type for all .cgi files to text/html.", "attachment_id": null, "bug_id": 34622, "id": 83528, "time": "2005-12-11T00:35:48Z", "creator": "rpluem@apache.org", "creation_time": "2005-12-11T00:35:48Z", "is_private": false}]
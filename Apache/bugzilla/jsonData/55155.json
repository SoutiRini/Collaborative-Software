[{"count": 0, "tags": [], "bug_id": 55155, "attachment_id": 30493, "is_private": false, "id": 168113, "time": "2013-06-28T14:38:52Z", "creator": "clucas@e-miles.com", "creation_time": "2013-06-28T14:38:52Z", "text": "Created attachment 30493\npatch to add java.awt.headless=true for junit tests\n\nOn osx, when running tomcat tests via \"ant test\", \"ant test-nio\" or similar, the terminal window running the tests grabs window focus each time a new jvm is launched for the junit tests.  This makes it difficult/annoying to do other things in other windows while the tests are running.  I am seeing the problem on a mac - it is likely not a problem on other platforms.\n\nSetting java.awt.headless=true fixes the issue.  I can't think of any reason this shouldn't be set for tomcat tests - maybe there is a reason I don't know.  Anyway, the attached patch adds the property (for junit tests)."}, {"count": 1, "tags": [], "bug_id": 55155, "attachment_id": null, "id": 168114, "creation_time": "2013-06-28T15:09:14Z", "time": "2013-06-28T15:09:14Z", "creator": "markt@apache.org", "text": "Try again with 7.0.x HEAD please", "is_private": false}, {"count": 2, "tags": [], "creator": "clucas@e-miles.com", "attachment_id": 30494, "is_private": false, "id": 168115, "time": "2013-06-28T15:27:03Z", "bug_id": 55155, "creation_time": "2013-06-28T15:27:03Z", "text": "Created attachment 30494\nagainst head?\n\nis this what you wanted?  if not, please provide a tip or link."}, {"count": 3, "tags": [], "bug_id": 55155, "attachment_id": null, "is_private": false, "id": 168116, "time": "2013-06-28T15:29:52Z", "creator": "markt@apache.org", "creation_time": "2013-06-28T15:29:52Z", "text": "No, that isn't what I meant.\n\nPlease re-test with the latest source code for 7.0.x/trunk from subversion."}, {"count": 4, "tags": [], "bug_id": 55155, "attachment_id": null, "id": 168120, "creation_time": "2013-06-28T18:26:32Z", "time": "2013-06-28T18:26:32Z", "creator": "markt@apache.org", "text": "I don;t see the described behaviour on OSX. This sounds like the AWT issue that has already been fixed in trunk. (change log entry: Update the JreMemoryLeakPreventionListener to take account of changes in the behaviour of java.beans.Introspector.flushCaches() and sun.awt.AppContext.getAppContext() in Java 7.)", "is_private": false}, {"count": 5, "text": "I ran the tests (again) after updating trunk. Same results (lots of window focus change). Are you trying the osx built-in Terminal app?  Maybe that has something to do with it.  I'm running tests under jdk6.  I'll try some more variations.", "bug_id": 55155, "is_private": false, "id": 168121, "time": "2013-06-28T19:08:07Z", "creator": "clucas@e-miles.com", "creation_time": "2013-06-28T19:08:07Z", "tags": [], "attachment_id": null}, {"count": 6, "tags": [], "bug_id": 55155, "attachment_id": null, "text": "OK, I do see it with Java 6. It would have helped if you mentioned that in your original report.", "id": 168122, "time": "2013-06-28T19:36:14Z", "creator": "markt@apache.org", "creation_time": "2013-06-28T19:36:14Z", "is_private": false}, {"count": 7, "tags": [], "bug_id": 55155, "attachment_id": null, "id": 168123, "time": "2013-06-28T19:59:51Z", "creator": "clucas@e-miles.com", "creation_time": "2013-06-28T19:59:51Z", "is_private": false, "text": "Sorry for not mentioning the jdk version originally.  More digging revealed what I believe to be a better fix for the problem:\n\nhttps://developer.apple.com/library/mac/#documentation/Java/Reference/Java_PropertiesRef/Articles/JavaSystemProperties.html  (See apple.awt.UIElement property.)\n\nSetting it to true allows awt calls but does not steal focus. I'll add a new patch."}, {"count": 8, "tags": [], "bug_id": 55155, "attachment_id": 30497, "id": 168124, "time": "2013-06-28T20:00:56Z", "creator": "clucas@e-miles.com", "creation_time": "2013-06-28T20:00:56Z", "is_private": false, "text": "Created attachment 30497\nset apple.awt.UIElement=true"}, {"count": 9, "tags": [], "bug_id": 55155, "attachment_id": null, "is_private": false, "id": 168187, "time": "2013-07-01T14:05:09Z", "creator": "markt@apache.org", "creation_time": "2013-07-01T14:05:09Z", "text": "I haven't dug into this far enough to idenitfy the trigger for this but it looks like whatever change triggered the probem in Java 7 has been back-ported to Java 6 but the change that allowed us to change the default for appContextProtection hasn't been back-ported.\n\nI can't tell if this is an Apple specific issue or one that will affect anyone using the Oracle (commerical) supported Java 6 binaries.\n\nAn additional factor to take into consideration is the general reluctance of the Tomcat dev community to add work-arounds for bugs in third-party products (yes the JreMemoryLeakPreventionListener is a pretty big exception to that rule).\n\nGiven that OSX seems to be a fairly popular platform amongst Java developers then I think your second patch is the way to go for now. If this emerges as a wider Java 6 issue we can look at using java.awt.headless=true instead.\n\nThe patch has been applied to 7.0.x and will be included in 7.0.42 onwards."}]
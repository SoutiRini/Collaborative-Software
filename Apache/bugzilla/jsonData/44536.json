[{"count": 0, "text": "This is for version 3.0.2 FINAL.\n\nIf you open an XLS file and save with the 'read only recommended' option set, POI fails to read the file:\n\nException in thread \"main\" org.apache.poi.hssf.record.RecordFormatException: Unable to construct record instance\n        at org.apache.poi.hssf.record.RecordFactory.createRecord(RecordFactory.java:199)\n        at org.apache.poi.hssf.record.RecordFactory.createRecords(RecordFactory.java:117)\n        at org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:207)\n        at org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:259)\n        at org.apache.poi.hssf.usermodel.HSSFWorkbook.<init>(HSSFWorkbook.java:240)\n        at rde.tests.poi.XLTest.main(XLTest.java:30)\nCaused by: java.lang.reflect.InvocationTargetException\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)\n        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)\n        at java.lang.reflect.Constructor.newInstance(Constructor.java:513)\n        at org.apache.poi.hssf.record.RecordFactory.createRecord(RecordFactory.java:187)\n        ... 5 more\nCaused by: java.lang.IllegalArgumentException: Illegal length\n        at org.apache.poi.hssf.record.RecordInputStream.readCompressedUnicode(RecordInputStream.java:270)\n        at org.apache.poi.hssf.record.FileSharingRecord.fillFields(FileSharingRecord.java:62)\n        at org.apache.poi.hssf.record.Record.<init>(Record.java:55)\n        at org.apache.poi.hssf.record.FileSharingRecord.<init>(FileSharingRecord.java:48)\n        ... 10 more\n\nThe code to parse the FILESHARING record does not seem to take account of changes from BIFF5 to BIFF8.  Here is an extract from the openoffice xls file format document:\n\n0 2 1 = Recommend read-only state while loading the file\n2 2 Hash value calculated from the read-only password (\u279c4.18.4)\n4 var. User name of the file creator\nBIFF2-BIFF5: Byte string, 8-bit string length (\u279c2.5.2)\nBIFF8: Unicode string, 16-bit string length (\u279c2.5.3)\n170\n\nA trivial XLS file is attached", "bug_id": 44536, "attachment_id": null, "id": 114279, "time": "2008-03-05T02:12:02Z", "creator": "richard.evans@datanomic.com", "creation_time": "2008-03-05T02:12:02Z", "tags": [], "is_private": false}, {"count": 1, "tags": [], "text": "What version of excel did you generate your file with?\n\n(I think all our supported versions of excel ought to be generating biff8 files)", "attachment_id": null, "id": 114339, "creator": "apache@gagravarr.org", "time": "2008-03-06T07:44:29Z", "bug_id": 44536, "creation_time": "2008-03-06T07:44:29Z", "is_private": false}, {"count": 2, "tags": [], "bug_id": 44536, "is_private": false, "text": "It was Excel 2003.  You are right in that POI supports BIFF8 only, I had not realized that when I posted the original report.  \n\nSo it must be that the handling of the FILESHARING record is not quite right.", "id": 114340, "time": "2008-03-06T07:47:55Z", "creator": "richard.evans@datanomic.com", "creation_time": "2008-03-06T07:47:55Z", "attachment_id": null}, {"count": 3, "tags": [], "bug_id": 44536, "is_private": false, "id": 114357, "attachment_id": null, "creator": "apache@gagravarr.org", "creation_time": "2008-03-06T09:51:03Z", "time": "2008-03-06T09:51:03Z", "text": "Could you please upload the problem file, so we can see if it's possible to detect this odd state in the filesharing record?"}, {"attachment_id": 21641, "tags": [], "bug_id": 44536, "is_private": false, "count": 4, "id": 114361, "time": "2008-03-06T10:08:26Z", "creator": "richard.evans@datanomic.com", "creation_time": "2008-03-06T10:08:26Z", "text": "Created attachment 21641\ntrivial xls with 'read only recommended' flag set\n\nApologies.  Was convinced I had included an attachment with the original report"}, {"attachment_id": null, "tags": [], "bug_id": 44536, "text": "OK, looks like there was no username set, but there was a username length, so was running off the end of the record\n\nFix in svn, along with tests, and a new HSSFWorkBook method to test for the read-only flag", "count": 5, "id": 114406, "time": "2008-03-07T03:35:55Z", "creator": "apache@gagravarr.org", "creation_time": "2008-03-07T03:35:55Z", "is_private": false}]